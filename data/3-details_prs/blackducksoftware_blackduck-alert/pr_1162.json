{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDg0MDAyMTA0", "number": 1162, "title": "Create a better well defined API for actions and controllers", "bodyText": "", "createdAt": "2020-09-10T15:29:04Z", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1162", "merged": true, "mergeCommit": {"oid": "518a9c5565c17dc45a70539bf0566ce4ad00b8e7"}, "closed": true, "closedAt": "2020-09-14T15:47:15Z", "author": {"login": "psantos1113"}, "timelineItems": {"totalCount": 46, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdFqwRsAH2gAyNDg0MDAyMTA0OmM0ZDE3MjVkZjJiMGEwZDU1YzM4ZDMzN2U4OGYxMWYwYWVjN2VjY2Q=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdI037hgFqTQ4Nzg4Njk3MQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "c4d1725df2b0a0d55c38d337e88f11f0aec7eccd", "author": {"user": {"login": "psantos1113", "name": null}}, "url": "https://github.com/blackducksoftware/blackduck-alert/commit/c4d1725df2b0a0d55c38d337e88f11f0aec7eccd", "committedDate": "2020-09-04T19:55:36Z", "message": "feat: Start implementing abstract actions."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f4e01de4a6ffc1b7f1c7b3855faffb4685f3abee", "author": {"user": {"login": "psantos1113", "name": null}}, "url": "https://github.com/blackducksoftware/blackduck-alert/commit/f4e01de4a6ffc1b7f1c7b3855faffb4685f3abee", "committedDate": "2020-09-08T12:49:25Z", "message": "feat: Initial implementation of abstract action class."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "04acb3ca495ab8e01e4dfa46b59897671e81abeb", "author": {"user": {"login": "psantos1113", "name": null}}, "url": "https://github.com/blackducksoftware/blackduck-alert/commit/04acb3ca495ab8e01e4dfa46b59897671e81abeb", "committedDate": "2020-09-08T20:35:50Z", "message": "refactor: Change the certificates controller to implement new interface."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "39bdee6e6897d739cd249e6f274bb61965219968", "author": {"user": {"login": "psantos1113", "name": null}}, "url": "https://github.com/blackducksoftware/blackduck-alert/commit/39bdee6e6897d739cd249e6f274bb61965219968", "committedDate": "2020-09-09T15:28:22Z", "message": "feat: Implement Job and Config actions."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "523364897938337d95bbf45c9937e32207192e25", "author": {"user": {"login": "psantos1113", "name": null}}, "url": "https://github.com/blackducksoftware/blackduck-alert/commit/523364897938337d95bbf45c9937e32207192e25", "committedDate": "2020-09-09T15:48:15Z", "message": "fix: Fix the reset password test."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c1786e339713ce0ddfa6e42c011a7a4712329292", "author": {"user": {"login": "psantos1113", "name": null}}, "url": "https://github.com/blackducksoftware/blackduck-alert/commit/c1786e339713ce0ddfa6e42c011a7a4712329292", "committedDate": "2020-09-09T19:18:42Z", "message": "refactor: ConfigController and ConfigActions use new abstract classes."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "283c521bd308a36c351d62a6d21dcd7411a890c3", "author": {"user": {"login": "psantos1113", "name": null}}, "url": "https://github.com/blackducksoftware/blackduck-alert/commit/283c521bd308a36c351d62a6d21dcd7411a890c3", "committedDate": "2020-09-10T13:07:41Z", "message": "refactor: Change Job controller and actions."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7b95e78e638862ea3c404f3196d1e0ccbcae81d2", "author": {"user": {"login": "psantos1113", "name": null}}, "url": "https://github.com/blackducksoftware/blackduck-alert/commit/7b95e78e638862ea3c404f3196d1e0ccbcae81d2", "committedDate": "2020-09-10T14:06:39Z", "message": "refactor: Rename some methods to make more sense in the Swagger doc."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "374d1dddcdb270528498838ae5bbd469ce46b21e", "author": {"user": {"login": "psantos1113", "name": null}}, "url": "https://github.com/blackducksoftware/blackduck-alert/commit/374d1dddcdb270528498838ae5bbd469ce46b21e", "committedDate": "2020-09-10T14:34:10Z", "message": "Merge remote-tracking branch 'origin/feat_action_response' into ps_abstract_actions"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ca034814b5fdcd5b0d66f95ceb7870ce8f6c3583", "author": {"user": {"login": "psantos1113", "name": null}}, "url": "https://github.com/blackducksoftware/blackduck-alert/commit/ca034814b5fdcd5b0d66f95ceb7870ce8f6c3583", "committedDate": "2020-09-10T15:27:40Z", "message": "fix: Fix parsing the job id to avoid an exception."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg2MDY1OTI2", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1162#pullrequestreview-486065926", "createdAt": "2020-09-10T15:38:42Z", "commit": {"oid": "ca034814b5fdcd5b0d66f95ceb7870ce8f6c3583"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMFQxNTozODo0M1rOHP6FuQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMFQxNTozODo0M1rOHP6FuQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjQ0MjQyNQ==", "bodyText": "The PKIX SSL error that displays an error message in the UI.  The object that needs to be created for the PKIX exception is a message and an isDetailed boolean.  This object was created to supply the same result object for a PKIX error.", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1162#discussion_r486442425", "createdAt": "2020-09-10T15:38:43Z", "author": {"login": "psantos1113"}, "path": "alert-common/src/main/java/com/synopsys/integration/alert/common/action/SSLValidationResponseModel.java", "diffHunk": "@@ -0,0 +1,40 @@\n+/**\n+ * alert-common\n+ *\n+ * Copyright (c) 2020 Synopsys, Inc.\n+ *\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements. See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership. The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied. See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+package com.synopsys.integration.alert.common.action;\n+\n+import java.util.Map;\n+\n+import com.synopsys.integration.alert.common.rest.model.ValidationResponseModel;\n+\n+public class SSLValidationResponseModel extends ValidationResponseModel {\n+    private boolean isDetailed;\n+\n+    public SSLValidationResponseModel(String message) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ca034814b5fdcd5b0d66f95ceb7870ce8f6c3583"}, "originalPosition": 32}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg2MDY4NzE3", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1162#pullrequestreview-486068717", "createdAt": "2020-09-10T15:41:37Z", "commit": {"oid": "ca034814b5fdcd5b0d66f95ceb7870ce8f6c3583"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMFQxNTo0MTozN1rOHP6OJA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMFQxNTo0MTozN1rOHP6OJA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjQ0NDU4MA==", "bodyText": "This class checks permissions and validates the content first.  The abstract methods are to be implemented by a concrete class to perform the functionality.", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1162#discussion_r486444580", "createdAt": "2020-09-10T15:41:37Z", "author": {"login": "psantos1113"}, "path": "alert-common/src/main/java/com/synopsys/integration/alert/common/action/api/AbstractConfigResourceActions.java", "diffHunk": "@@ -0,0 +1,182 @@\n+/**\n+ * alert-common\n+ *\n+ * Copyright (c) 2020 Synopsys, Inc.\n+ *\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements. See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership. The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied. See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+package com.synopsys.integration.alert.common.action.api;\n+\n+import java.util.List;\n+import java.util.Optional;\n+import java.util.Set;\n+import java.util.stream.Collectors;\n+\n+import org.springframework.http.HttpStatus;\n+\n+import com.synopsys.integration.alert.common.action.ActionResponse;\n+import com.synopsys.integration.alert.common.action.ValidationActionResponse;\n+import com.synopsys.integration.alert.common.enumeration.ConfigContextEnum;\n+import com.synopsys.integration.alert.common.exception.AlertException;\n+import com.synopsys.integration.alert.common.persistence.accessor.DescriptorAccessor;\n+import com.synopsys.integration.alert.common.persistence.model.RegisteredDescriptorModel;\n+import com.synopsys.integration.alert.common.rest.model.FieldModel;\n+import com.synopsys.integration.alert.common.rest.model.ValidationResponseModel;\n+import com.synopsys.integration.alert.common.security.authorization.AuthorizationManager;\n+\n+public abstract class AbstractConfigResourceActions implements ResourceActions<FieldModel>, TestAction<FieldModel>, ValidateAction<FieldModel> {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ca034814b5fdcd5b0d66f95ceb7870ce8f6c3583"}, "originalPosition": 42}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg2MDczMTgy", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1162#pullrequestreview-486073182", "createdAt": "2020-09-10T15:46:13Z", "commit": {"oid": "ca034814b5fdcd5b0d66f95ceb7870ce8f6c3583"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMFQxNTo0NjoxM1rOHP6bIA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMFQxNTo0NjoxM1rOHP6bIA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjQ0NzkwNA==", "bodyText": "This class can be used by classes that deal with resources other than FieldModel or JobFieldModel i.e. CertificateActions, UserActions,RoleActions, and TaskActions.", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1162#discussion_r486447904", "createdAt": "2020-09-10T15:46:13Z", "author": {"login": "psantos1113"}, "path": "alert-common/src/main/java/com/synopsys/integration/alert/common/action/api/AbstractResourceActions.java", "diffHunk": "@@ -0,0 +1,143 @@\n+/**\n+ * alert-common\n+ *\n+ * Copyright (c) 2020 Synopsys, Inc.\n+ *\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements. See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership. The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied. See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+package com.synopsys.integration.alert.common.action.api;\n+\n+import java.util.List;\n+\n+import org.springframework.http.HttpStatus;\n+\n+import com.synopsys.integration.alert.common.action.ActionResponse;\n+import com.synopsys.integration.alert.common.action.ValidationActionResponse;\n+import com.synopsys.integration.alert.common.descriptor.DescriptorKey;\n+import com.synopsys.integration.alert.common.enumeration.ConfigContextEnum;\n+import com.synopsys.integration.alert.common.rest.model.ValidationResponseModel;\n+import com.synopsys.integration.alert.common.security.authorization.AuthorizationManager;\n+\n+public abstract class AbstractResourceActions<T> implements ResourceActions<T>, ValidateAction<T>, TestAction<T> {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ca034814b5fdcd5b0d66f95ceb7870ce8f6c3583"}, "originalPosition": 36}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b81d6d6bdf34e0c2f392c0b9ceb07e4affd827d1", "author": {"user": {"login": "psantos1113", "name": null}}, "url": "https://github.com/blackducksoftware/blackduck-alert/commit/b81d6d6bdf34e0c2f392c0b9ceb07e4affd827d1", "committedDate": "2020-09-10T19:08:42Z", "message": "refactor: Remove unused code in certificates and fix tests."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg2NzczNDg5", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1162#pullrequestreview-486773489", "createdAt": "2020-09-11T12:47:00Z", "commit": {"oid": "b81d6d6bdf34e0c2f392c0b9ceb07e4affd827d1"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMVQxMjo0NzowMFrOHQdY4g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMVQxMjo0NzowMFrOHQdY4g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzAyMDc3MA==", "bodyText": "I'm thinking that when we further separate Alert into sub-projects, the models for the REST API stuff should be moved into that sub-project as well. That way we can avoid misusing the models and bogging down alert-common.", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1162#discussion_r487020770", "createdAt": "2020-09-11T12:47:00Z", "author": {"login": "gkillough"}, "path": "alert-common/src/main/java/com/synopsys/integration/alert/common/action/ValidationActionResponse.java", "diffHunk": "@@ -22,12 +22,32 @@\n  */\n package com.synopsys.integration.alert.common.action;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b81d6d6bdf34e0c2f392c0b9ceb07e4affd827d1"}, "originalPosition": 2}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f79d758c6a9f2d558b2728c4089863a4791796c5", "author": {"user": {"login": "psantos1113", "name": null}}, "url": "https://github.com/blackducksoftware/blackduck-alert/commit/f79d758c6a9f2d558b2728c4089863a4791796c5", "committedDate": "2020-09-11T12:48:19Z", "message": "fix: Rename FieldValueModel  to  to fix serialization."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg2Nzc5MzE3", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1162#pullrequestreview-486779317", "createdAt": "2020-09-11T12:54:44Z", "commit": {"oid": "b81d6d6bdf34e0c2f392c0b9ceb07e4affd827d1"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMVQxMjo1NDo0NVrOHQdqCg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMVQxMjo1NDo0NVrOHQdqCg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzAyNTE2Mg==", "bodyText": "Looking at these names and how they are used below, we might want to distinguish them a little more from each other. Maybe instead of the public create and the protected createResource, the public method could be called createWithPermissionCheck and the protected method could be called createWithoutPermissionCheck or something along those lines.", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1162#discussion_r487025162", "createdAt": "2020-09-11T12:54:45Z", "author": {"login": "gkillough"}, "path": "alert-common/src/main/java/com/synopsys/integration/alert/common/action/api/AbstractConfigResourceActions.java", "diffHunk": "@@ -0,0 +1,182 @@\n+/**\n+ * alert-common\n+ *\n+ * Copyright (c) 2020 Synopsys, Inc.\n+ *\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements. See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership. The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied. See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+package com.synopsys.integration.alert.common.action.api;\n+\n+import java.util.List;\n+import java.util.Optional;\n+import java.util.Set;\n+import java.util.stream.Collectors;\n+\n+import org.springframework.http.HttpStatus;\n+\n+import com.synopsys.integration.alert.common.action.ActionResponse;\n+import com.synopsys.integration.alert.common.action.ValidationActionResponse;\n+import com.synopsys.integration.alert.common.enumeration.ConfigContextEnum;\n+import com.synopsys.integration.alert.common.exception.AlertException;\n+import com.synopsys.integration.alert.common.persistence.accessor.DescriptorAccessor;\n+import com.synopsys.integration.alert.common.persistence.model.RegisteredDescriptorModel;\n+import com.synopsys.integration.alert.common.rest.model.FieldModel;\n+import com.synopsys.integration.alert.common.rest.model.ValidationResponseModel;\n+import com.synopsys.integration.alert.common.security.authorization.AuthorizationManager;\n+\n+public abstract class AbstractConfigResourceActions implements ResourceActions<FieldModel>, TestAction<FieldModel>, ValidateAction<FieldModel> {\n+    private AuthorizationManager authorizationManager;\n+    private DescriptorAccessor descriptorAccessor;\n+\n+    public AbstractConfigResourceActions(AuthorizationManager authorizationManager, DescriptorAccessor descriptorAccessor) {\n+        this.authorizationManager = authorizationManager;\n+        this.descriptorAccessor = descriptorAccessor;\n+    }\n+\n+    public AbstractConfigResourceActions(AuthorizationManager authorizationManager) {\n+        this.authorizationManager = authorizationManager;\n+    }\n+\n+    protected abstract ActionResponse<FieldModel> createResource(FieldModel resource);\n+\n+    protected abstract ActionResponse<FieldModel> deleteResource(Long id);\n+\n+    protected abstract ActionResponse<List<FieldModel>> readAllResources();\n+\n+    protected abstract ActionResponse<List<FieldModel>> readAllByContextAndDescriptor(String context, String descriptorName);\n+\n+    protected abstract Optional<FieldModel> findFieldModel(Long id);\n+\n+    protected abstract ValidationActionResponse testResource(FieldModel resource);\n+\n+    protected abstract ActionResponse<FieldModel> updateResource(Long id, FieldModel resource);\n+\n+    protected abstract ValidationActionResponse validateResource(FieldModel resource);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b81d6d6bdf34e0c2f392c0b9ceb07e4affd827d1"}, "originalPosition": 69}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg2NzgzMTEy", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1162#pullrequestreview-486783112", "createdAt": "2020-09-11T12:59:48Z", "commit": {"oid": "b81d6d6bdf34e0c2f392c0b9ceb07e4affd827d1"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMVQxMjo1OTo0OFrOHQd1QQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMVQxMjo1OTo0OFrOHQd1QQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzAyODAzMw==", "bodyText": "It might be worthwhile to create an enhancement request for AuthorizationManager to have methods that also take collections of enums.", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1162#discussion_r487028033", "createdAt": "2020-09-11T12:59:48Z", "author": {"login": "gkillough"}, "path": "alert-common/src/main/java/com/synopsys/integration/alert/common/action/api/AbstractConfigResourceActions.java", "diffHunk": "@@ -0,0 +1,182 @@\n+/**\n+ * alert-common\n+ *\n+ * Copyright (c) 2020 Synopsys, Inc.\n+ *\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements. See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership. The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied. See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+package com.synopsys.integration.alert.common.action.api;\n+\n+import java.util.List;\n+import java.util.Optional;\n+import java.util.Set;\n+import java.util.stream.Collectors;\n+\n+import org.springframework.http.HttpStatus;\n+\n+import com.synopsys.integration.alert.common.action.ActionResponse;\n+import com.synopsys.integration.alert.common.action.ValidationActionResponse;\n+import com.synopsys.integration.alert.common.enumeration.ConfigContextEnum;\n+import com.synopsys.integration.alert.common.exception.AlertException;\n+import com.synopsys.integration.alert.common.persistence.accessor.DescriptorAccessor;\n+import com.synopsys.integration.alert.common.persistence.model.RegisteredDescriptorModel;\n+import com.synopsys.integration.alert.common.rest.model.FieldModel;\n+import com.synopsys.integration.alert.common.rest.model.ValidationResponseModel;\n+import com.synopsys.integration.alert.common.security.authorization.AuthorizationManager;\n+\n+public abstract class AbstractConfigResourceActions implements ResourceActions<FieldModel>, TestAction<FieldModel>, ValidateAction<FieldModel> {\n+    private AuthorizationManager authorizationManager;\n+    private DescriptorAccessor descriptorAccessor;\n+\n+    public AbstractConfigResourceActions(AuthorizationManager authorizationManager, DescriptorAccessor descriptorAccessor) {\n+        this.authorizationManager = authorizationManager;\n+        this.descriptorAccessor = descriptorAccessor;\n+    }\n+\n+    public AbstractConfigResourceActions(AuthorizationManager authorizationManager) {\n+        this.authorizationManager = authorizationManager;\n+    }\n+\n+    protected abstract ActionResponse<FieldModel> createResource(FieldModel resource);\n+\n+    protected abstract ActionResponse<FieldModel> deleteResource(Long id);\n+\n+    protected abstract ActionResponse<List<FieldModel>> readAllResources();\n+\n+    protected abstract ActionResponse<List<FieldModel>> readAllByContextAndDescriptor(String context, String descriptorName);\n+\n+    protected abstract Optional<FieldModel> findFieldModel(Long id);\n+\n+    protected abstract ValidationActionResponse testResource(FieldModel resource);\n+\n+    protected abstract ActionResponse<FieldModel> updateResource(Long id, FieldModel resource);\n+\n+    protected abstract ValidationActionResponse validateResource(FieldModel resource);\n+\n+    public ActionResponse<List<FieldModel>> getAllByContextAndDescriptor(String context, String descriptorName) {\n+        if (!authorizationManager.hasReadPermission(context, descriptorName)) {\n+            return new ActionResponse<>(HttpStatus.FORBIDDEN, AbstractResourceActions.FORBIDDEN_MESSAGE);\n+        }\n+        return readAllByContextAndDescriptor(context, descriptorName);\n+    }\n+\n+    @Override\n+    public ActionResponse<FieldModel> create(FieldModel resource) {\n+        if (!authorizationManager.hasCreatePermission(resource.getContext(), resource.getDescriptorName())) {\n+            return new ActionResponse<>(HttpStatus.FORBIDDEN, AbstractResourceActions.FORBIDDEN_MESSAGE);\n+        }\n+        ValidationActionResponse validationResponse = validateResource(resource);\n+        if (validationResponse.isError()) {\n+            return new ActionResponse<>(validationResponse.getHttpStatus(), validationResponse.getMessage().orElse(null));\n+        }\n+        return createResource(resource);\n+    }\n+\n+    @Override\n+    public ActionResponse<List<FieldModel>> getAll() {\n+        try {\n+            Set<String> descriptorNames = descriptorAccessor.getRegisteredDescriptors()\n+                                              .stream()\n+                                              .map(RegisteredDescriptorModel::getName)\n+                                              .collect(Collectors.toSet());\n+            if (!authorizationManager.anyReadPermission(List.of(ConfigContextEnum.DISTRIBUTION.name(), ConfigContextEnum.GLOBAL.name()), descriptorNames)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b81d6d6bdf34e0c2f392c0b9ceb07e4affd827d1"}, "originalPosition": 97}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg2Nzg1MzIz", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1162#pullrequestreview-486785323", "createdAt": "2020-09-11T13:02:42Z", "commit": {"oid": "b81d6d6bdf34e0c2f392c0b9ceb07e4affd827d1"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMVQxMzowMjo0MlrOHQd7PQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMVQxMzowMjo0MlrOHQd7PQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzAyOTU2NQ==", "bodyText": "Based on the way this class is used (i.e. in a controller) is this case actually possible? If the RequestMapping requires an id, and an id is missing from the request, then it will either be a call to the \"getAll\" endpoint (if one exists) or Spring will return a 404.", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1162#discussion_r487029565", "createdAt": "2020-09-11T13:02:42Z", "author": {"login": "gkillough"}, "path": "alert-common/src/main/java/com/synopsys/integration/alert/common/action/api/AbstractConfigResourceActions.java", "diffHunk": "@@ -0,0 +1,182 @@\n+/**\n+ * alert-common\n+ *\n+ * Copyright (c) 2020 Synopsys, Inc.\n+ *\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements. See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership. The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied. See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+package com.synopsys.integration.alert.common.action.api;\n+\n+import java.util.List;\n+import java.util.Optional;\n+import java.util.Set;\n+import java.util.stream.Collectors;\n+\n+import org.springframework.http.HttpStatus;\n+\n+import com.synopsys.integration.alert.common.action.ActionResponse;\n+import com.synopsys.integration.alert.common.action.ValidationActionResponse;\n+import com.synopsys.integration.alert.common.enumeration.ConfigContextEnum;\n+import com.synopsys.integration.alert.common.exception.AlertException;\n+import com.synopsys.integration.alert.common.persistence.accessor.DescriptorAccessor;\n+import com.synopsys.integration.alert.common.persistence.model.RegisteredDescriptorModel;\n+import com.synopsys.integration.alert.common.rest.model.FieldModel;\n+import com.synopsys.integration.alert.common.rest.model.ValidationResponseModel;\n+import com.synopsys.integration.alert.common.security.authorization.AuthorizationManager;\n+\n+public abstract class AbstractConfigResourceActions implements ResourceActions<FieldModel>, TestAction<FieldModel>, ValidateAction<FieldModel> {\n+    private AuthorizationManager authorizationManager;\n+    private DescriptorAccessor descriptorAccessor;\n+\n+    public AbstractConfigResourceActions(AuthorizationManager authorizationManager, DescriptorAccessor descriptorAccessor) {\n+        this.authorizationManager = authorizationManager;\n+        this.descriptorAccessor = descriptorAccessor;\n+    }\n+\n+    public AbstractConfigResourceActions(AuthorizationManager authorizationManager) {\n+        this.authorizationManager = authorizationManager;\n+    }\n+\n+    protected abstract ActionResponse<FieldModel> createResource(FieldModel resource);\n+\n+    protected abstract ActionResponse<FieldModel> deleteResource(Long id);\n+\n+    protected abstract ActionResponse<List<FieldModel>> readAllResources();\n+\n+    protected abstract ActionResponse<List<FieldModel>> readAllByContextAndDescriptor(String context, String descriptorName);\n+\n+    protected abstract Optional<FieldModel> findFieldModel(Long id);\n+\n+    protected abstract ValidationActionResponse testResource(FieldModel resource);\n+\n+    protected abstract ActionResponse<FieldModel> updateResource(Long id, FieldModel resource);\n+\n+    protected abstract ValidationActionResponse validateResource(FieldModel resource);\n+\n+    public ActionResponse<List<FieldModel>> getAllByContextAndDescriptor(String context, String descriptorName) {\n+        if (!authorizationManager.hasReadPermission(context, descriptorName)) {\n+            return new ActionResponse<>(HttpStatus.FORBIDDEN, AbstractResourceActions.FORBIDDEN_MESSAGE);\n+        }\n+        return readAllByContextAndDescriptor(context, descriptorName);\n+    }\n+\n+    @Override\n+    public ActionResponse<FieldModel> create(FieldModel resource) {\n+        if (!authorizationManager.hasCreatePermission(resource.getContext(), resource.getDescriptorName())) {\n+            return new ActionResponse<>(HttpStatus.FORBIDDEN, AbstractResourceActions.FORBIDDEN_MESSAGE);\n+        }\n+        ValidationActionResponse validationResponse = validateResource(resource);\n+        if (validationResponse.isError()) {\n+            return new ActionResponse<>(validationResponse.getHttpStatus(), validationResponse.getMessage().orElse(null));\n+        }\n+        return createResource(resource);\n+    }\n+\n+    @Override\n+    public ActionResponse<List<FieldModel>> getAll() {\n+        try {\n+            Set<String> descriptorNames = descriptorAccessor.getRegisteredDescriptors()\n+                                              .stream()\n+                                              .map(RegisteredDescriptorModel::getName)\n+                                              .collect(Collectors.toSet());\n+            if (!authorizationManager.anyReadPermission(List.of(ConfigContextEnum.DISTRIBUTION.name(), ConfigContextEnum.GLOBAL.name()), descriptorNames)) {\n+                return new ActionResponse<>(HttpStatus.FORBIDDEN, AbstractResourceActions.FORBIDDEN_MESSAGE);\n+            }\n+            return readAllResources();\n+        } catch (AlertException ex) {\n+            return new ActionResponse<>(HttpStatus.INTERNAL_SERVER_ERROR, String.format(\"Error reading configurations: %s\", ex.getMessage()));\n+        }\n+    }\n+\n+    @Override\n+    public ActionResponse<FieldModel> getOne(Long id) {\n+        if (null == id) {\n+            return new ActionResponse<>(HttpStatus.BAD_REQUEST, AbstractResourceActions.RESOURCE_IDENTIFIER_MISSING);\n+        }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b81d6d6bdf34e0c2f392c0b9ceb07e4affd827d1"}, "originalPosition": 110}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg2NzkxNTQ4", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1162#pullrequestreview-486791548", "createdAt": "2020-09-11T13:10:48Z", "commit": {"oid": "b81d6d6bdf34e0c2f392c0b9ceb07e4affd827d1"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMVQxMzoxMDo0OFrOHQeNUA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMVQxMzoxMDo0OFrOHQeNUA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzAzNDE5Mg==", "bodyText": "Same thought as the previous class. We should make it more explicit what the difference between something like ActionResponse<JobFieldModel> create(JobFieldModel resource) and ActionResponse<JobFieldModel> createResource(JobFieldModel resource) is.", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1162#discussion_r487034192", "createdAt": "2020-09-11T13:10:48Z", "author": {"login": "gkillough"}, "path": "alert-common/src/main/java/com/synopsys/integration/alert/common/action/api/AbstractJobResourceActions.java", "diffHunk": "@@ -0,0 +1,211 @@\n+/**\n+ * alert-common\n+ *\n+ * Copyright (c) 2020 Synopsys, Inc.\n+ *\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements. See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership. The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied. See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+package com.synopsys.integration.alert.common.action.api;\n+\n+import java.util.Collection;\n+import java.util.EnumSet;\n+import java.util.LinkedList;\n+import java.util.List;\n+import java.util.Optional;\n+import java.util.Set;\n+import java.util.UUID;\n+import java.util.function.BiFunction;\n+import java.util.stream.Collectors;\n+\n+import org.springframework.http.HttpStatus;\n+\n+import com.synopsys.integration.alert.common.action.ActionResponse;\n+import com.synopsys.integration.alert.common.action.ValidationActionResponse;\n+import com.synopsys.integration.alert.common.enumeration.ConfigContextEnum;\n+import com.synopsys.integration.alert.common.enumeration.DescriptorType;\n+import com.synopsys.integration.alert.common.exception.AlertException;\n+import com.synopsys.integration.alert.common.persistence.accessor.DescriptorAccessor;\n+import com.synopsys.integration.alert.common.persistence.model.RegisteredDescriptorModel;\n+import com.synopsys.integration.alert.common.rest.model.FieldModel;\n+import com.synopsys.integration.alert.common.rest.model.JobFieldModel;\n+import com.synopsys.integration.alert.common.rest.model.ValidationResponseModel;\n+import com.synopsys.integration.alert.common.security.authorization.AuthorizationManager;\n+\n+public abstract class AbstractJobResourceActions implements JobResourceActions, ValidateAction<JobFieldModel>, TestAction<JobFieldModel> {\n+    private static final EnumSet<DescriptorType> ALLOWED_JOB_DESCRIPTOR_TYPES = EnumSet.of(DescriptorType.PROVIDER, DescriptorType.CHANNEL);\n+    private AuthorizationManager authorizationManager;\n+    private DescriptorAccessor descriptorAccessor;\n+\n+    public AbstractJobResourceActions(AuthorizationManager authorizationManager, DescriptorAccessor descriptorAccessor) {\n+        this.authorizationManager = authorizationManager;\n+        this.descriptorAccessor = descriptorAccessor;\n+        this.descriptorAccessor = descriptorAccessor;\n+    }\n+\n+    protected abstract Optional<JobFieldModel> findJobFieldModel(UUID id);\n+\n+    protected abstract ActionResponse<JobFieldModel> createResource(JobFieldModel resource);\n+\n+    protected abstract ActionResponse<JobFieldModel> deleteResource(UUID id);\n+\n+    protected abstract ActionResponse<List<JobFieldModel>> readAllResources();\n+\n+    protected abstract ValidationActionResponse testResource(JobFieldModel resource);\n+\n+    protected abstract ActionResponse<JobFieldModel> updateResource(UUID id, JobFieldModel resource);\n+\n+    protected abstract ValidationActionResponse validateResource(JobFieldModel resource);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b81d6d6bdf34e0c2f392c0b9ceb07e4affd827d1"}, "originalPosition": 72}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg2NzkyMjA0", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1162#pullrequestreview-486792204", "createdAt": "2020-09-11T13:11:36Z", "commit": {"oid": "b81d6d6bdf34e0c2f392c0b9ceb07e4affd827d1"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMVQxMzoxMTozNlrOHQePUQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMVQxMzoxMTozNlrOHQePUQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzAzNDcwNQ==", "bodyText": "Same thought as the previous class.", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1162#discussion_r487034705", "createdAt": "2020-09-11T13:11:36Z", "author": {"login": "gkillough"}, "path": "alert-common/src/main/java/com/synopsys/integration/alert/common/action/api/AbstractJobResourceActions.java", "diffHunk": "@@ -0,0 +1,211 @@\n+/**\n+ * alert-common\n+ *\n+ * Copyright (c) 2020 Synopsys, Inc.\n+ *\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements. See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership. The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied. See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+package com.synopsys.integration.alert.common.action.api;\n+\n+import java.util.Collection;\n+import java.util.EnumSet;\n+import java.util.LinkedList;\n+import java.util.List;\n+import java.util.Optional;\n+import java.util.Set;\n+import java.util.UUID;\n+import java.util.function.BiFunction;\n+import java.util.stream.Collectors;\n+\n+import org.springframework.http.HttpStatus;\n+\n+import com.synopsys.integration.alert.common.action.ActionResponse;\n+import com.synopsys.integration.alert.common.action.ValidationActionResponse;\n+import com.synopsys.integration.alert.common.enumeration.ConfigContextEnum;\n+import com.synopsys.integration.alert.common.enumeration.DescriptorType;\n+import com.synopsys.integration.alert.common.exception.AlertException;\n+import com.synopsys.integration.alert.common.persistence.accessor.DescriptorAccessor;\n+import com.synopsys.integration.alert.common.persistence.model.RegisteredDescriptorModel;\n+import com.synopsys.integration.alert.common.rest.model.FieldModel;\n+import com.synopsys.integration.alert.common.rest.model.JobFieldModel;\n+import com.synopsys.integration.alert.common.rest.model.ValidationResponseModel;\n+import com.synopsys.integration.alert.common.security.authorization.AuthorizationManager;\n+\n+public abstract class AbstractJobResourceActions implements JobResourceActions, ValidateAction<JobFieldModel>, TestAction<JobFieldModel> {\n+    private static final EnumSet<DescriptorType> ALLOWED_JOB_DESCRIPTOR_TYPES = EnumSet.of(DescriptorType.PROVIDER, DescriptorType.CHANNEL);\n+    private AuthorizationManager authorizationManager;\n+    private DescriptorAccessor descriptorAccessor;\n+\n+    public AbstractJobResourceActions(AuthorizationManager authorizationManager, DescriptorAccessor descriptorAccessor) {\n+        this.authorizationManager = authorizationManager;\n+        this.descriptorAccessor = descriptorAccessor;\n+        this.descriptorAccessor = descriptorAccessor;\n+    }\n+\n+    protected abstract Optional<JobFieldModel> findJobFieldModel(UUID id);\n+\n+    protected abstract ActionResponse<JobFieldModel> createResource(JobFieldModel resource);\n+\n+    protected abstract ActionResponse<JobFieldModel> deleteResource(UUID id);\n+\n+    protected abstract ActionResponse<List<JobFieldModel>> readAllResources();\n+\n+    protected abstract ValidationActionResponse testResource(JobFieldModel resource);\n+\n+    protected abstract ActionResponse<JobFieldModel> updateResource(UUID id, JobFieldModel resource);\n+\n+    protected abstract ValidationActionResponse validateResource(JobFieldModel resource);\n+\n+    @Override\n+    public ActionResponse<JobFieldModel> create(JobFieldModel resource) {\n+        boolean hasPermissions = hasRequiredPermissions(resource.getFieldModels(), authorizationManager::hasCreatePermission);\n+        if (!hasPermissions) {\n+            return new ActionResponse<>(HttpStatus.FORBIDDEN, AbstractResourceActions.FORBIDDEN_MESSAGE);\n+        }\n+        ValidationActionResponse validationResponse = validateResource(resource);\n+        if (validationResponse.isError()) {\n+            return new ActionResponse<>(validationResponse.getHttpStatus(), validationResponse.getMessage().orElse(null));\n+        }\n+        return createResource(resource);\n+    }\n+\n+    @Override\n+    public ActionResponse<List<JobFieldModel>> getAll() {\n+        try {\n+            Set<String> descriptorNames = descriptorAccessor.getRegisteredDescriptors()\n+                                              .stream()\n+                                              .filter(descriptor -> ALLOWED_JOB_DESCRIPTOR_TYPES.contains(descriptor.getType()))\n+                                              .map(RegisteredDescriptorModel::getName)\n+                                              .collect(Collectors.toSet());\n+            if (!authorizationManager.anyReadPermission(List.of(ConfigContextEnum.DISTRIBUTION.name()), descriptorNames)) {\n+                return new ActionResponse<>(HttpStatus.FORBIDDEN, AbstractResourceActions.FORBIDDEN_MESSAGE);\n+            }\n+            List<JobFieldModel> models = new LinkedList<>();\n+            ActionResponse<List<JobFieldModel>> response = readAllResources();\n+            List<JobFieldModel> allModels = response.getContent().orElse(List.of());\n+            for (JobFieldModel jobModel : allModels) {\n+                boolean includeJob = hasRequiredPermissions(jobModel.getFieldModels(), authorizationManager::hasReadPermission);\n+                if (includeJob) {\n+                    models.add(jobModel);\n+                }\n+            }\n+            return new ActionResponse<>(HttpStatus.OK, models);\n+        } catch (AlertException ex) {\n+            return new ActionResponse<>(HttpStatus.INTERNAL_SERVER_ERROR, String.format(\"Error reading job configurations: %s\", ex.getMessage()));\n+        }\n+\n+    }\n+\n+    @Override\n+    public ActionResponse<JobFieldModel> getOne(UUID id) {\n+        if (null == id) {\n+            return new ActionResponse<>(HttpStatus.BAD_REQUEST, AbstractResourceActions.RESOURCE_IDENTIFIER_MISSING);\n+        }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b81d6d6bdf34e0c2f392c0b9ceb07e4affd827d1"}, "originalPosition": 118}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg2Nzk0Mzc0", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1162#pullrequestreview-486794374", "createdAt": "2020-09-11T13:14:21Z", "commit": {"oid": "b81d6d6bdf34e0c2f392c0b9ceb07e4affd827d1"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMVQxMzoxNDoyMVrOHQeViw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMVQxMzoxNDoyMVrOHQeViw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzAzNjI5OQ==", "bodyText": "When the constructor for ActionResponse would take a null parameter, we should either add a static initializer or a new constructor without the message parameter.", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1162#discussion_r487036299", "createdAt": "2020-09-11T13:14:21Z", "author": {"login": "gkillough"}, "path": "alert-common/src/main/java/com/synopsys/integration/alert/common/action/api/AbstractJobResourceActions.java", "diffHunk": "@@ -0,0 +1,211 @@\n+/**\n+ * alert-common\n+ *\n+ * Copyright (c) 2020 Synopsys, Inc.\n+ *\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements. See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership. The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied. See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+package com.synopsys.integration.alert.common.action.api;\n+\n+import java.util.Collection;\n+import java.util.EnumSet;\n+import java.util.LinkedList;\n+import java.util.List;\n+import java.util.Optional;\n+import java.util.Set;\n+import java.util.UUID;\n+import java.util.function.BiFunction;\n+import java.util.stream.Collectors;\n+\n+import org.springframework.http.HttpStatus;\n+\n+import com.synopsys.integration.alert.common.action.ActionResponse;\n+import com.synopsys.integration.alert.common.action.ValidationActionResponse;\n+import com.synopsys.integration.alert.common.enumeration.ConfigContextEnum;\n+import com.synopsys.integration.alert.common.enumeration.DescriptorType;\n+import com.synopsys.integration.alert.common.exception.AlertException;\n+import com.synopsys.integration.alert.common.persistence.accessor.DescriptorAccessor;\n+import com.synopsys.integration.alert.common.persistence.model.RegisteredDescriptorModel;\n+import com.synopsys.integration.alert.common.rest.model.FieldModel;\n+import com.synopsys.integration.alert.common.rest.model.JobFieldModel;\n+import com.synopsys.integration.alert.common.rest.model.ValidationResponseModel;\n+import com.synopsys.integration.alert.common.security.authorization.AuthorizationManager;\n+\n+public abstract class AbstractJobResourceActions implements JobResourceActions, ValidateAction<JobFieldModel>, TestAction<JobFieldModel> {\n+    private static final EnumSet<DescriptorType> ALLOWED_JOB_DESCRIPTOR_TYPES = EnumSet.of(DescriptorType.PROVIDER, DescriptorType.CHANNEL);\n+    private AuthorizationManager authorizationManager;\n+    private DescriptorAccessor descriptorAccessor;\n+\n+    public AbstractJobResourceActions(AuthorizationManager authorizationManager, DescriptorAccessor descriptorAccessor) {\n+        this.authorizationManager = authorizationManager;\n+        this.descriptorAccessor = descriptorAccessor;\n+        this.descriptorAccessor = descriptorAccessor;\n+    }\n+\n+    protected abstract Optional<JobFieldModel> findJobFieldModel(UUID id);\n+\n+    protected abstract ActionResponse<JobFieldModel> createResource(JobFieldModel resource);\n+\n+    protected abstract ActionResponse<JobFieldModel> deleteResource(UUID id);\n+\n+    protected abstract ActionResponse<List<JobFieldModel>> readAllResources();\n+\n+    protected abstract ValidationActionResponse testResource(JobFieldModel resource);\n+\n+    protected abstract ActionResponse<JobFieldModel> updateResource(UUID id, JobFieldModel resource);\n+\n+    protected abstract ValidationActionResponse validateResource(JobFieldModel resource);\n+\n+    @Override\n+    public ActionResponse<JobFieldModel> create(JobFieldModel resource) {\n+        boolean hasPermissions = hasRequiredPermissions(resource.getFieldModels(), authorizationManager::hasCreatePermission);\n+        if (!hasPermissions) {\n+            return new ActionResponse<>(HttpStatus.FORBIDDEN, AbstractResourceActions.FORBIDDEN_MESSAGE);\n+        }\n+        ValidationActionResponse validationResponse = validateResource(resource);\n+        if (validationResponse.isError()) {\n+            return new ActionResponse<>(validationResponse.getHttpStatus(), validationResponse.getMessage().orElse(null));\n+        }\n+        return createResource(resource);\n+    }\n+\n+    @Override\n+    public ActionResponse<List<JobFieldModel>> getAll() {\n+        try {\n+            Set<String> descriptorNames = descriptorAccessor.getRegisteredDescriptors()\n+                                              .stream()\n+                                              .filter(descriptor -> ALLOWED_JOB_DESCRIPTOR_TYPES.contains(descriptor.getType()))\n+                                              .map(RegisteredDescriptorModel::getName)\n+                                              .collect(Collectors.toSet());\n+            if (!authorizationManager.anyReadPermission(List.of(ConfigContextEnum.DISTRIBUTION.name()), descriptorNames)) {\n+                return new ActionResponse<>(HttpStatus.FORBIDDEN, AbstractResourceActions.FORBIDDEN_MESSAGE);\n+            }\n+            List<JobFieldModel> models = new LinkedList<>();\n+            ActionResponse<List<JobFieldModel>> response = readAllResources();\n+            List<JobFieldModel> allModels = response.getContent().orElse(List.of());\n+            for (JobFieldModel jobModel : allModels) {\n+                boolean includeJob = hasRequiredPermissions(jobModel.getFieldModels(), authorizationManager::hasReadPermission);\n+                if (includeJob) {\n+                    models.add(jobModel);\n+                }\n+            }\n+            return new ActionResponse<>(HttpStatus.OK, models);\n+        } catch (AlertException ex) {\n+            return new ActionResponse<>(HttpStatus.INTERNAL_SERVER_ERROR, String.format(\"Error reading job configurations: %s\", ex.getMessage()));\n+        }\n+\n+    }\n+\n+    @Override\n+    public ActionResponse<JobFieldModel> getOne(UUID id) {\n+        if (null == id) {\n+            return new ActionResponse<>(HttpStatus.BAD_REQUEST, AbstractResourceActions.RESOURCE_IDENTIFIER_MISSING);\n+        }\n+\n+        Optional<JobFieldModel> optionalModel = findJobFieldModel(id);\n+\n+        if (optionalModel.isPresent()) {\n+            JobFieldModel fieldModel = optionalModel.get();\n+            boolean hasPermissions = hasRequiredPermissions(fieldModel.getFieldModels(), authorizationManager::hasReadPermission);\n+            if (!hasPermissions) {\n+                return new ActionResponse<>(HttpStatus.FORBIDDEN, AbstractResourceActions.FORBIDDEN_MESSAGE);\n+            }\n+            return new ActionResponse<>(HttpStatus.OK, fieldModel);\n+        }\n+\n+        return new ActionResponse<>(HttpStatus.NOT_FOUND, null);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b81d6d6bdf34e0c2f392c0b9ceb07e4affd827d1"}, "originalPosition": 131}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg2Nzk4OTQz", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1162#pullrequestreview-486798943", "createdAt": "2020-09-11T13:20:10Z", "commit": {"oid": "b81d6d6bdf34e0c2f392c0b9ceb07e4affd827d1"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMVQxMzoyMDoxMFrOHQei7g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMVQxMzoyMDoxMFrOHQei7g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzAzOTcyNg==", "bodyText": "Should this extend ResourceActions?", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1162#discussion_r487039726", "createdAt": "2020-09-11T13:20:10Z", "author": {"login": "gkillough"}, "path": "alert-common/src/main/java/com/synopsys/integration/alert/common/action/api/JobResourceActions.java", "diffHunk": "@@ -0,0 +1,41 @@\n+/**\n+ * alert-common\n+ *\n+ * Copyright (c) 2020 Synopsys, Inc.\n+ *\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements. See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership. The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied. See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+package com.synopsys.integration.alert.common.action.api;\n+\n+import java.util.List;\n+import java.util.UUID;\n+\n+import com.synopsys.integration.alert.common.action.ActionResponse;\n+import com.synopsys.integration.alert.common.rest.model.JobFieldModel;\n+\n+public interface JobResourceActions {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b81d6d6bdf34e0c2f392c0b9ceb07e4affd827d1"}, "originalPosition": 31}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg2ODAxMjkz", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1162#pullrequestreview-486801293", "createdAt": "2020-09-11T13:22:56Z", "commit": {"oid": "b81d6d6bdf34e0c2f392c0b9ceb07e4affd827d1"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMVQxMzoyMjo1NlrOHQepvA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMVQxMzoyMjo1NlrOHQepvA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzA0MTQ2OA==", "bodyText": "Should this call setValues with Set.of() if the parameter is null?", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1162#discussion_r487041468", "createdAt": "2020-09-11T13:22:56Z", "author": {"login": "gkillough"}, "path": "alert-common/src/main/java/com/synopsys/integration/alert/common/rest/model/FieldValueModel.java", "diffHunk": "@@ -60,7 +60,9 @@ public void setValues(Collection<String> values) {\n     }\n \n     public void setValue(String value) {\n-        setValues(Set.of(value));\n+        if (null != value) {\n+            setValues(Set.of(value));\n+        }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b81d6d6bdf34e0c2f392c0b9ceb07e4affd827d1"}, "originalPosition": 7}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg2ODAyOTU4", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1162#pullrequestreview-486802958", "createdAt": "2020-09-11T13:25:04Z", "commit": {"oid": "b81d6d6bdf34e0c2f392c0b9ceb07e4affd827d1"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMVQxMzoyNTowNFrOHQeujw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMVQxMzoyNTowNFrOHQeujw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzA0MjcwMw==", "bodyText": "Won't configActions.update check write permissions? Should the if-statement check if the id is present to determine whether to create or update?", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1162#discussion_r487042703", "createdAt": "2020-09-11T13:25:04Z", "author": {"login": "gkillough"}, "path": "src/main/java/com/synopsys/integration/alert/channel/azure/boards/web/AzureBoardsCustomFunctionAction.java", "diffHunk": "@@ -155,11 +155,13 @@ private OAuthEndpointResponse createErrorResponse(String errorMessage) {\n         if (StringUtils.isNotBlank(fieldModel.getId())) {\n             if (authorizationManager.hasWritePermission(ConfigContextEnum.GLOBAL.name(), azureBoardsChannelKey.getUniversalKey())) {\n                 Long id = Long.parseLong(fieldModel.getId());\n-                return Optional.ofNullable(configActions.updateConfig(id, fieldModel));\n+                ActionResponse<FieldModel> response = configActions.update(id, fieldModel);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b81d6d6bdf34e0c2f392c0b9ceb07e4affd827d1"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg2ODA3MjAz", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1162#pullrequestreview-486807203", "createdAt": "2020-09-11T13:30:11Z", "commit": {"oid": "f79d758c6a9f2d558b2728c4089863a4791796c5"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMVQxMzozMDoxMVrOHQe6qw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMVQxMzozMDoxMVrOHQe6qw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzA0NTgwMw==", "bodyText": "Will this clash with the overridden validate method?", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1162#discussion_r487045803", "createdAt": "2020-09-11T13:30:11Z", "author": {"login": "gkillough"}, "path": "src/main/java/com/synopsys/integration/alert/web/api/job/JobConfigController.java", "diffHunk": "@@ -22,316 +22,83 @@\n  */\n package com.synopsys.integration.alert.web.api.job;\n \n-import java.util.Collection;\n-import java.util.EnumSet;\n-import java.util.LinkedList;\n import java.util.List;\n-import java.util.Optional;\n-import java.util.Set;\n import java.util.UUID;\n-import java.util.function.BiFunction;\n-import java.util.stream.Collectors;\n \n-import org.apache.commons.lang3.StringUtils;\n-import org.slf4j.Logger;\n-import org.slf4j.LoggerFactory;\n import org.springframework.beans.factory.annotation.Autowired;\n import org.springframework.http.HttpStatus;\n-import org.springframework.http.ResponseEntity;\n-import org.springframework.web.bind.annotation.DeleteMapping;\n import org.springframework.web.bind.annotation.GetMapping;\n-import org.springframework.web.bind.annotation.PathVariable;\n import org.springframework.web.bind.annotation.PostMapping;\n-import org.springframework.web.bind.annotation.PutMapping;\n import org.springframework.web.bind.annotation.RequestBody;\n import org.springframework.web.bind.annotation.RequestMapping;\n import org.springframework.web.bind.annotation.RestController;\n \n-import com.synopsys.integration.alert.common.ContentConverter;\n-import com.synopsys.integration.alert.common.descriptor.Descriptor;\n-import com.synopsys.integration.alert.common.descriptor.DescriptorKey;\n-import com.synopsys.integration.alert.common.descriptor.DescriptorMap;\n-import com.synopsys.integration.alert.common.descriptor.config.field.errors.AlertFieldStatus;\n-import com.synopsys.integration.alert.common.enumeration.ConfigContextEnum;\n-import com.synopsys.integration.alert.common.enumeration.DescriptorType;\n-import com.synopsys.integration.alert.common.exception.AlertException;\n-import com.synopsys.integration.alert.common.exception.AlertFieldException;\n-import com.synopsys.integration.alert.common.exception.AlertMethodNotAllowedException;\n-import com.synopsys.integration.alert.common.message.model.MessageResult;\n-import com.synopsys.integration.alert.common.persistence.accessor.DescriptorAccessor;\n-import com.synopsys.integration.alert.common.persistence.model.PermissionKey;\n-import com.synopsys.integration.alert.common.persistence.model.RegisteredDescriptorModel;\n+import com.synopsys.integration.alert.common.action.ValidationActionResponse;\n import com.synopsys.integration.alert.common.rest.ResponseFactory;\n-import com.synopsys.integration.alert.common.rest.model.FieldModel;\n+import com.synopsys.integration.alert.common.rest.api.BaseJobResourceController;\n+import com.synopsys.integration.alert.common.rest.api.ReadAllController;\n+import com.synopsys.integration.alert.common.rest.api.TestController;\n+import com.synopsys.integration.alert.common.rest.api.ValidateController;\n import com.synopsys.integration.alert.common.rest.model.JobFieldModel;\n-import com.synopsys.integration.alert.common.security.authorization.AuthorizationManager;\n+import com.synopsys.integration.alert.common.rest.model.JobFieldStatuses;\n+import com.synopsys.integration.alert.common.rest.model.ValidationResponseModel;\n import com.synopsys.integration.alert.web.api.config.ConfigController;\n-import com.synopsys.integration.alert.web.common.BaseController;\n-import com.synopsys.integration.alert.web.common.PKIXErrorResponseFactory;\n-import com.synopsys.integration.exception.IntegrationException;\n-import com.synopsys.integration.function.ThrowingFunction;\n-import com.synopsys.integration.rest.exception.IntegrationRestException;\n \n @RestController\n @RequestMapping(JobConfigController.JOB_CONFIGURATION_PATH)\n-public class JobConfigController extends BaseController {\n+public class JobConfigController implements BaseJobResourceController, ReadAllController, TestController<JobFieldModel>, ValidateController<JobFieldModel> {\n     public static final String JOB_CONFIGURATION_PATH = ConfigController.CONFIGURATION_PATH + \"/job\";\n-    private static final EnumSet<DescriptorType> ALLOWED_JOB_DESCRIPTOR_TYPES = EnumSet.of(DescriptorType.PROVIDER, DescriptorType.CHANNEL);\n-    private final Logger logger = LoggerFactory.getLogger(JobConfigController.class);\n     private final JobConfigActions jobConfigActions;\n-    private final ResponseFactory responseFactory;\n-    private final ContentConverter contentConverter;\n-    private final AuthorizationManager authorizationManager;\n-    private final DescriptorAccessor descriptorAccessor;\n-    private final DescriptorMap descriptorMap;\n-    private final PKIXErrorResponseFactory pkixErrorResponseFactory;\n \n     @Autowired\n-    public JobConfigController(JobConfigActions jobConfigActions, ResponseFactory responseFactory, ContentConverter contentConverter, AuthorizationManager authorizationManager,\n-        DescriptorAccessor descriptorAccessor, PKIXErrorResponseFactory pkixErrorResponseFactory, DescriptorMap descriptorMap) {\n+    public JobConfigController(JobConfigActions jobConfigActions) {\n         this.jobConfigActions = jobConfigActions;\n-        this.responseFactory = responseFactory;\n-        this.contentConverter = contentConverter;\n-        this.authorizationManager = authorizationManager;\n-        this.descriptorAccessor = descriptorAccessor;\n-        this.pkixErrorResponseFactory = pkixErrorResponseFactory;\n-        this.descriptorMap = descriptorMap;\n     }\n \n-    @GetMapping\n-    public ResponseEntity<String> getJobs() {\n-        try {\n-            Set<String> descriptorNames = descriptorAccessor.getRegisteredDescriptors()\n-                                              .stream()\n-                                              .filter(descriptor -> ALLOWED_JOB_DESCRIPTOR_TYPES.contains(descriptor.getType()))\n-                                              .map(RegisteredDescriptorModel::getName)\n-                                              .collect(Collectors.toSet());\n-            if (!authorizationManager.anyReadPermission(List.of(ConfigContextEnum.DISTRIBUTION.name()), descriptorNames)) {\n-                return responseFactory.createForbiddenResponse();\n-            }\n-            List<JobFieldModel> models = new LinkedList<>();\n-            List<JobFieldModel> allModels = jobConfigActions.getAllJobs();\n-\n-            for (JobFieldModel jobModel : allModels) {\n-                boolean includeJob = hasRequiredPermissions(jobModel.getFieldModels(), authorizationManager::hasReadPermission);\n-                if (includeJob) {\n-                    models.add(jobModel);\n-                }\n-            }\n-            return responseFactory.createOkContentResponse(contentConverter.getJsonString(models));\n-        } catch (AlertException e) {\n-            logger.error(e.getMessage(), e);\n-            return responseFactory.createMessageResponse(HttpStatus.INTERNAL_SERVER_ERROR, \"There was an issue retrieving data from the database.\");\n-        }\n-    }\n-\n-    @GetMapping(\"/{id}\")\n-    public ResponseEntity<String> getJob(@PathVariable UUID id) {\n-        Optional<JobFieldModel> optionalModel;\n-        try {\n-            optionalModel = jobConfigActions.getJobById(id);\n-        } catch (AlertException e) {\n-            logger.error(e.getMessage(), e);\n-            return responseFactory.createMessageResponse(HttpStatus.INTERNAL_SERVER_ERROR, \"There was an issue retrieving data from the database for ID: \" + id);\n-        }\n-\n-        if (optionalModel.isPresent()) {\n-            JobFieldModel fieldModel = optionalModel.get();\n-            boolean hasPermissions = hasRequiredPermissions(fieldModel.getFieldModels(), authorizationManager::hasReadPermission);\n-            if (!hasPermissions) {\n-                return responseFactory.createForbiddenResponse();\n-            }\n-            return responseFactory.createOkContentResponse(contentConverter.getJsonString(fieldModel));\n-        }\n-\n-        return responseFactory.createNotFoundResponse(\"Configuration not found for the specified id\");\n-    }\n-\n-    @PostMapping\n-    public ResponseEntity<String> postConfig(@RequestBody(required = true) JobFieldModel restModel) {\n-        boolean hasPermissions = hasRequiredPermissions(restModel.getFieldModels(), authorizationManager::hasCreatePermission);\n-        if (!hasPermissions) {\n-            return responseFactory.createForbiddenResponse();\n-        }\n-\n-        try {\n-            return runPostConfig(restModel);\n-        } catch (AlertException e) {\n-            logger.error(e.getMessage(), e);\n-            return responseFactory.createInternalServerErrorResponse(restModel.getJobId(), e.getMessage());\n-        }\n-    }\n-\n-    private ResponseEntity<String> runPostConfig(JobFieldModel restModel) throws AlertException {\n-        String id = restModel.getJobId();\n-        if (StringUtils.isNotBlank(id) && jobConfigActions.doesJobExist(id)) {\n-            return responseFactory.createConflictResponse(id, \"Provided id must not be in use. To update an existing configuration, use PUT.\");\n-        }\n-\n-        try {\n-            JobFieldModel updatedEntity = jobConfigActions.saveJob(restModel);\n-            return responseFactory.createCreatedResponse(updatedEntity.getJobId(), \"Created\");\n-        } catch (AlertFieldException e) {\n-            return responseFactory.createFieldErrorResponse(id, \"There were errors with the configuration.\", e.getFieldErrors());\n-        }\n-    }\n-\n-    @PutMapping(\"/{id}\")\n-    public ResponseEntity<String> putConfig(@PathVariable UUID id, @RequestBody(required = true) JobFieldModel restModel) {\n-        boolean hasPermissions = hasRequiredPermissions(restModel.getFieldModels(), authorizationManager::hasWritePermission);\n-        if (!hasPermissions) {\n-            return responseFactory.createForbiddenResponse();\n-        }\n-\n-        try {\n-            return runPutConfig(id, restModel);\n-        } catch (AlertException e) {\n-            logger.error(e.getMessage(), e);\n-            return responseFactory.createInternalServerErrorResponse(restModel.getJobId(), e.getMessage());\n-        }\n+    @GetMapping(\"/validate\")\n+    public List<JobFieldStatuses> validateJobs() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f79d758c6a9f2d558b2728c4089863a4791796c5"}, "originalPosition": 181}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg2ODE4OTEy", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1162#pullrequestreview-486818912", "createdAt": "2020-09-11T13:44:36Z", "commit": {"oid": "f79d758c6a9f2d558b2728c4089863a4791796c5"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMVQxMzo0NDozNlrOHQfdGQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMVQxMzo0NDozNlrOHQfdGQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzA1NDYxNw==", "bodyText": "Missing a space before \"{}\"", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1162#discussion_r487054617", "createdAt": "2020-09-11T13:44:36Z", "author": {"login": "gkillough"}, "path": "src/main/java/com/synopsys/integration/alert/web/api/certificate/CertificateActions.java", "diffHunk": "@@ -28,77 +28,116 @@\n import java.util.stream.Collectors;\n \n import org.apache.commons.lang3.StringUtils;\n+import org.apache.commons.lang3.math.NumberUtils;\n import org.slf4j.Logger;\n import org.slf4j.LoggerFactory;\n import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.http.HttpStatus;\n import org.springframework.stereotype.Component;\n \n+import com.synopsys.integration.alert.common.action.ActionResponse;\n+import com.synopsys.integration.alert.common.action.ValidationActionResponse;\n+import com.synopsys.integration.alert.common.action.api.AbstractResourceActions;\n import com.synopsys.integration.alert.common.descriptor.config.field.errors.AlertFieldStatus;\n-import com.synopsys.integration.alert.common.exception.AlertDatabaseConstraintException;\n+import com.synopsys.integration.alert.common.enumeration.ConfigContextEnum;\n import com.synopsys.integration.alert.common.exception.AlertException;\n-import com.synopsys.integration.alert.common.exception.AlertFieldException;\n import com.synopsys.integration.alert.common.persistence.accessor.CustomCertificateAccessor;\n import com.synopsys.integration.alert.common.persistence.model.CustomCertificateModel;\n import com.synopsys.integration.alert.common.rest.model.ValidationResponseModel;\n import com.synopsys.integration.alert.common.security.CertificateUtility;\n+import com.synopsys.integration.alert.common.security.authorization.AuthorizationManager;\n import com.synopsys.integration.alert.component.certificates.CertificatesDescriptor;\n+import com.synopsys.integration.alert.component.certificates.CertificatesDescriptorKey;\n import com.synopsys.integration.util.IntegrationEscapeUtil;\n \n @Component\n-public class CertificateActions {\n+public class CertificateActions extends AbstractResourceActions<CertificateModel> {\n     private final Logger logger = LoggerFactory.getLogger(CertificateActions.class);\n     private static final String ERROR_DUPLICATE_ALIAS = \"A certificate with this alias already exists.\";\n     private final CertificateUtility certificateUtility;\n     private final CustomCertificateAccessor certificateAccessor;\n     private final IntegrationEscapeUtil escapeUtil;\n \n     @Autowired\n-    public CertificateActions(CustomCertificateAccessor certificateAccessor, CertificateUtility certificateUtility) {\n+    public CertificateActions(CertificatesDescriptorKey descriptorKey, AuthorizationManager authorizationManager, CustomCertificateAccessor certificateAccessor, CertificateUtility certificateUtility) {\n+        super(descriptorKey, ConfigContextEnum.GLOBAL, authorizationManager);\n         this.certificateAccessor = certificateAccessor;\n         this.certificateUtility = certificateUtility;\n         escapeUtil = new IntegrationEscapeUtil();\n     }\n \n-    public List<CertificateModel> readCertificates() {\n-        return certificateAccessor.getCertificates().stream()\n-                   .map(this::convertFromDatabaseModel)\n-                   .collect(Collectors.toList());\n+    @Override\n+    public ActionResponse<List<CertificateModel>> readAllResources() {\n+        List<CertificateModel> certificates = certificateAccessor.getCertificates().stream()\n+                                                  .map(this::convertFromDatabaseModel)\n+                                                  .collect(Collectors.toList());\n+        return new ActionResponse<>(HttpStatus.OK, certificates);\n     }\n \n-    public Optional<CertificateModel> readCertificate(Long id) {\n-        return certificateAccessor.getCertificate(id)\n-                   .map(this::convertFromDatabaseModel);\n+    @Override\n+    public ActionResponse<CertificateModel> readResource(Long id) {\n+        Optional<CertificateModel> model = certificateAccessor.getCertificate(id)\n+                                               .map(this::convertFromDatabaseModel);\n+        if (model.isPresent()) {\n+            return new ActionResponse<>(HttpStatus.OK, model.get());\n+        }\n+\n+        return new ActionResponse<>(HttpStatus.NOT_FOUND, String.format(\"Certificate with id:%d not found.\", id));\n     }\n \n-    public ValidationResponseModel validateCertificate(CertificateModel certificateModel) {\n-        List<AlertFieldStatus> fieldErrors = validateCertificateFields(certificateModel);\n+    @Override\n+    public ValidationActionResponse testResource(CertificateModel resource) {\n+        return validateResource(resource);\n+    }\n+\n+    @Override\n+    public ValidationActionResponse validateResource(CertificateModel resource) {\n+        ValidationResponseModel responseModel;\n+        if (StringUtils.isNotBlank(resource.getId()) && !NumberUtils.isCreatable(resource.getId())) {\n+            responseModel = ValidationResponseModel.withoutFieldStatuses(\"Invalid resource id\");\n+            return new ValidationActionResponse(HttpStatus.BAD_REQUEST, responseModel);\n+        }\n+        List<AlertFieldStatus> fieldErrors = validateCertificateFields(resource);\n         if (fieldErrors.isEmpty()) {\n-            return ValidationResponseModel.withoutFieldStatuses(\"The certificate configuration is valid\");\n+            responseModel = ValidationResponseModel.withoutFieldStatuses(\"The certificate configuration is valid\");\n+            return new ValidationActionResponse(HttpStatus.OK, responseModel);\n         }\n-        return ValidationResponseModel.fromStatusCollection(\"There were problems with the certificate configuration\", fieldErrors);\n+        responseModel = ValidationResponseModel.fromStatusCollection(\"There were problems with the certificate configuration\", fieldErrors);\n+        return new ValidationActionResponse(HttpStatus.BAD_REQUEST, responseModel);\n     }\n \n-    public CertificateModel createCertificate(CertificateModel certificateModel) throws AlertException {\n-        if (null != certificateModel.getId()) {\n-            throw new AlertDatabaseConstraintException(\"id cannot be present to create a new certificate on the server.\");\n-        }\n-        validateCertificateModel(certificateModel);\n-        String loggableAlias = escapeUtil.replaceWithUnderscore(certificateModel.getAlias());\n+    @Override\n+    public ActionResponse<CertificateModel> createResource(CertificateModel resource) {\n+        String loggableAlias = escapeUtil.replaceWithUnderscore(resource.getAlias());\n         logger.info(\"Importing certificate with alias {}\", loggableAlias);\n-        return importCertificate(certificateModel);\n+        try {\n+            CertificateModel certificateModel = importCertificate(resource);\n+            return new ActionResponse<>(HttpStatus.OK, certificateModel);\n+        } catch (AlertException ex) {\n+            String message = ex.getMessage();\n+            logger.error(\"There was an issue importing the certificate.{}\", message);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f79d758c6a9f2d558b2728c4089863a4791796c5"}, "originalPosition": 113}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg2ODE5ODIz", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1162#pullrequestreview-486819823", "createdAt": "2020-09-11T13:45:40Z", "commit": {"oid": "f79d758c6a9f2d558b2728c4089863a4791796c5"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMVQxMzo0NTo0MFrOHQfgLA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMVQxMzo0NTo0MFrOHQfgLA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzA1NTQwNA==", "bodyText": "null passed to the constructor", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1162#discussion_r487055404", "createdAt": "2020-09-11T13:45:40Z", "author": {"login": "gkillough"}, "path": "src/main/java/com/synopsys/integration/alert/web/api/certificate/CertificateActions.java", "diffHunk": "@@ -113,19 +152,22 @@ private CertificateModel importCertificate(CertificateModel certificateModel) th\n         }\n     }\n \n-    /**\n-     * @return true if the certificate existed\n-     */\n-    public boolean deleteCertificate(Long id) throws AlertException {\n-        Optional<CustomCertificateModel> certificate = certificateAccessor.getCertificate(id);\n-        if (certificate.isPresent()) {\n-            CustomCertificateModel certificateModel = certificate.get();\n-            logger.info(\"Delete certificate with id: {} and alias: {}\", certificateModel.getNullableId(), certificateModel.getAlias());\n-            certificateUtility.removeCertificate(certificateModel);\n-            certificateAccessor.deleteCertificate(id);\n-            return true;\n+    @Override\n+    public ActionResponse<CertificateModel> deleteResource(Long id) {\n+        try {\n+            Optional<CustomCertificateModel> certificate = certificateAccessor.getCertificate(id);\n+            if (certificate.isPresent()) {\n+                CustomCertificateModel certificateModel = certificate.get();\n+                logger.info(\"Delete certificate with id: {} and alias: {}\", certificateModel.getNullableId(), certificateModel.getAlias());\n+                certificateUtility.removeCertificate(certificateModel);\n+                certificateAccessor.deleteCertificate(id);\n+            }\n+        } catch (AlertException ex) {\n+            logger.error(\"Error deleting certificate\", ex);\n+            return new ActionResponse<>(HttpStatus.INTERNAL_SERVER_ERROR, String.format(\"Error deleting certificate: %s\", ex.getMessage()));\n         }\n-        return false;\n+\n+        return new ActionResponse<>(HttpStatus.NO_CONTENT, null);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f79d758c6a9f2d558b2728c4089863a4791796c5"}, "originalPosition": 180}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg2ODIwMjE3", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1162#pullrequestreview-486820217", "createdAt": "2020-09-11T13:46:08Z", "commit": {"oid": "f79d758c6a9f2d558b2728c4089863a4791796c5"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMVQxMzo0NjowOFrOHQfhQA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMVQxMzo0NjowOFrOHQfhQA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzA1NTY4MA==", "bodyText": "If the certificate is not present, we should return a 404", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1162#discussion_r487055680", "createdAt": "2020-09-11T13:46:08Z", "author": {"login": "gkillough"}, "path": "src/main/java/com/synopsys/integration/alert/web/api/certificate/CertificateActions.java", "diffHunk": "@@ -113,19 +152,22 @@ private CertificateModel importCertificate(CertificateModel certificateModel) th\n         }\n     }\n \n-    /**\n-     * @return true if the certificate existed\n-     */\n-    public boolean deleteCertificate(Long id) throws AlertException {\n-        Optional<CustomCertificateModel> certificate = certificateAccessor.getCertificate(id);\n-        if (certificate.isPresent()) {\n-            CustomCertificateModel certificateModel = certificate.get();\n-            logger.info(\"Delete certificate with id: {} and alias: {}\", certificateModel.getNullableId(), certificateModel.getAlias());\n-            certificateUtility.removeCertificate(certificateModel);\n-            certificateAccessor.deleteCertificate(id);\n-            return true;\n+    @Override\n+    public ActionResponse<CertificateModel> deleteResource(Long id) {\n+        try {\n+            Optional<CustomCertificateModel> certificate = certificateAccessor.getCertificate(id);\n+            if (certificate.isPresent()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f79d758c6a9f2d558b2728c4089863a4791796c5"}, "originalPosition": 168}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg2ODIyNzg0", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1162#pullrequestreview-486822784", "createdAt": "2020-09-11T13:49:07Z", "commit": {"oid": "f79d758c6a9f2d558b2728c4089863a4791796c5"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMVQxMzo0OTowN1rOHQfohA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMVQxMzo0OTowN1rOHQfohA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzA1NzU0MA==", "bodyText": "Eventually, we should wrap this list in an object before returning.", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1162#discussion_r487057540", "createdAt": "2020-09-11T13:49:07Z", "author": {"login": "gkillough"}, "path": "src/main/java/com/synopsys/integration/alert/web/api/config/ConfigController.java", "diffHunk": "@@ -22,241 +22,69 @@\n  */\n package com.synopsys.integration.alert.web.api.config;\n \n-import java.util.ArrayList;\n import java.util.List;\n-import java.util.Optional;\n \n-import org.slf4j.Logger;\n-import org.slf4j.LoggerFactory;\n import org.springframework.beans.factory.annotation.Autowired;\n import org.springframework.http.HttpStatus;\n-import org.springframework.http.ResponseEntity;\n-import org.springframework.web.bind.annotation.DeleteMapping;\n import org.springframework.web.bind.annotation.GetMapping;\n-import org.springframework.web.bind.annotation.PathVariable;\n-import org.springframework.web.bind.annotation.PostMapping;\n-import org.springframework.web.bind.annotation.PutMapping;\n-import org.springframework.web.bind.annotation.RequestBody;\n import org.springframework.web.bind.annotation.RequestMapping;\n import org.springframework.web.bind.annotation.RequestParam;\n import org.springframework.web.bind.annotation.RestController;\n \n-import com.synopsys.integration.alert.common.ContentConverter;\n-import com.synopsys.integration.alert.common.descriptor.DescriptorKey;\n-import com.synopsys.integration.alert.common.descriptor.DescriptorMap;\n+import com.synopsys.integration.alert.common.action.ValidationActionResponse;\n import com.synopsys.integration.alert.common.enumeration.ConfigContextEnum;\n-import com.synopsys.integration.alert.common.exception.AlertException;\n-import com.synopsys.integration.alert.common.exception.AlertFieldException;\n-import com.synopsys.integration.alert.common.exception.AlertMethodNotAllowedException;\n import com.synopsys.integration.alert.common.rest.ResponseFactory;\n+import com.synopsys.integration.alert.common.rest.api.ConfigResourceController;\n+import com.synopsys.integration.alert.common.rest.api.TestController;\n+import com.synopsys.integration.alert.common.rest.api.ValidateController;\n import com.synopsys.integration.alert.common.rest.model.FieldModel;\n-import com.synopsys.integration.alert.common.security.authorization.AuthorizationManager;\n+import com.synopsys.integration.alert.common.rest.model.ValidationResponseModel;\n import com.synopsys.integration.alert.web.common.BaseController;\n-import com.synopsys.integration.alert.web.common.PKIXErrorResponseFactory;\n-import com.synopsys.integration.exception.IntegrationException;\n-import com.synopsys.integration.rest.exception.IntegrationRestException;\n \n @RestController\n @RequestMapping(ConfigController.CONFIGURATION_PATH)\n-public class ConfigController extends BaseController {\n+public class ConfigController implements ConfigResourceController, TestController<FieldModel>, ValidateController<FieldModel> {\n     public static final String CONFIGURATION_PATH = BaseController.BASE_PATH + \"/configuration\";\n-    public static final String EXCEPTION_FORMAT_CONFIGURATIONS_NOT_FOUND_FOR_CONTEXT_AND_DESCRIPTOR = \"Configurations not found for the context '%s' and descriptor '%s'.\";\n-    private final Logger logger = LoggerFactory.getLogger(ConfigController.class);\n     private final ConfigActions configActions;\n-    private final ContentConverter contentConverter;\n-    private final ResponseFactory responseFactory;\n-    private final AuthorizationManager authorizationManager;\n-    private final DescriptorMap descriptorMap;\n-    private final PKIXErrorResponseFactory pkixErrorResponseFactory;\n \n     @Autowired\n-    public ConfigController(ConfigActions configActions, ContentConverter contentConverter, ResponseFactory responseFactory, AuthorizationManager authorizationManager,\n-        DescriptorMap descriptorMap, PKIXErrorResponseFactory pkixErrorResponseFactory) {\n+    public ConfigController(ConfigActions configActions) {\n         this.configActions = configActions;\n-        this.contentConverter = contentConverter;\n-        this.responseFactory = responseFactory;\n-        this.authorizationManager = authorizationManager;\n-        this.descriptorMap = descriptorMap;\n-        this.pkixErrorResponseFactory = pkixErrorResponseFactory;\n     }\n \n     @GetMapping\n-    public ResponseEntity<String> getConfigs(@RequestParam ConfigContextEnum context, @RequestParam(required = false) String descriptorName) {\n-        List<FieldModel> models;\n-        if (!authorizationManager.hasReadPermission(context.name(), descriptorName)) {\n-            return responseFactory.createForbiddenResponse();\n-        }\n-        try {\n-            DescriptorKey descriptorKey = descriptorMap.getDescriptorKey(descriptorName).orElseThrow(() -> new AlertException(\"Could not find a Descriptor with the name: \" + descriptorName));\n-            models = configActions.getConfigs(context, descriptorKey);\n-        } catch (AlertException e) {\n-            logger.error(\"Was not able to find configurations with the context {}, and descriptorName {} to get.\", context, descriptorName);\n-            return responseFactory.createNotFoundResponse(String.format(EXCEPTION_FORMAT_CONFIGURATIONS_NOT_FOUND_FOR_CONTEXT_AND_DESCRIPTOR, context, descriptorName));\n-        }\n-\n-        if (models.isEmpty()) {\n-            return responseFactory.createNotFoundResponse(String.format(EXCEPTION_FORMAT_CONFIGURATIONS_NOT_FOUND_FOR_CONTEXT_AND_DESCRIPTOR, context, descriptorName));\n-        }\n-\n-        return responseFactory.createOkContentResponse(contentConverter.getJsonString(models));\n+    public List<FieldModel> getAll(@RequestParam ConfigContextEnum context, @RequestParam(required = false) String descriptorName) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f79d758c6a9f2d558b2728c4089863a4791796c5"}, "originalPosition": 88}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg2ODI0MTY5", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1162#pullrequestreview-486824169", "createdAt": "2020-09-11T13:50:46Z", "commit": {"oid": "f79d758c6a9f2d558b2728c4089863a4791796c5"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMVQxMzo1MDo0NlrOHQfsuw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMVQxMzo1MDo0NlrOHQfsuw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzA1ODYxOQ==", "bodyText": "null used in constructor", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1162#discussion_r487058619", "createdAt": "2020-09-11T13:50:46Z", "author": {"login": "gkillough"}, "path": "src/main/java/com/synopsys/integration/alert/web/api/config/ConfigActions.java", "diffHunk": "@@ -31,85 +30,128 @@\n import java.util.Optional;\n \n import org.apache.commons.lang3.EnumUtils;\n-import org.apache.commons.lang3.StringUtils;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.http.HttpStatus;\n import org.springframework.stereotype.Component;\n \n+import com.synopsys.integration.alert.common.action.ActionResponse;\n import com.synopsys.integration.alert.common.action.TestAction;\n+import com.synopsys.integration.alert.common.action.ValidationActionResponse;\n+import com.synopsys.integration.alert.common.action.api.AbstractConfigResourceActions;\n import com.synopsys.integration.alert.common.descriptor.DescriptorKey;\n+import com.synopsys.integration.alert.common.descriptor.DescriptorMap;\n import com.synopsys.integration.alert.common.descriptor.config.field.errors.AlertFieldStatus;\n import com.synopsys.integration.alert.common.enumeration.ConfigContextEnum;\n+import com.synopsys.integration.alert.common.exception.AlertDatabaseConstraintException;\n import com.synopsys.integration.alert.common.exception.AlertException;\n import com.synopsys.integration.alert.common.exception.AlertFieldException;\n-import com.synopsys.integration.alert.common.exception.AlertMethodNotAllowedException;\n import com.synopsys.integration.alert.common.persistence.accessor.ConfigurationAccessor;\n+import com.synopsys.integration.alert.common.persistence.accessor.DescriptorAccessor;\n import com.synopsys.integration.alert.common.persistence.accessor.FieldAccessor;\n import com.synopsys.integration.alert.common.persistence.model.ConfigurationFieldModel;\n import com.synopsys.integration.alert.common.persistence.model.ConfigurationModel;\n import com.synopsys.integration.alert.common.persistence.util.ConfigurationFieldModelConverter;\n import com.synopsys.integration.alert.common.rest.model.FieldModel;\n+import com.synopsys.integration.alert.common.rest.model.ValidationResponseModel;\n+import com.synopsys.integration.alert.common.security.authorization.AuthorizationManager;\n+import com.synopsys.integration.alert.web.common.PKIXErrorResponseFactory;\n import com.synopsys.integration.alert.web.common.descriptor.DescriptorProcessor;\n import com.synopsys.integration.alert.web.common.field.FieldModelProcessor;\n import com.synopsys.integration.exception.IntegrationException;\n+import com.synopsys.integration.rest.exception.IntegrationRestException;\n \n @Component\n-public class ConfigActions {\n+public class ConfigActions extends AbstractConfigResourceActions {\n+    private final Logger logger = LoggerFactory.getLogger(ConfigActions.class);\n     private final ConfigurationAccessor configurationAccessor;\n     private final FieldModelProcessor fieldModelProcessor;\n     private final DescriptorProcessor descriptorProcessor;\n     private final ConfigurationFieldModelConverter modelConverter;\n+    private final DescriptorMap descriptorMap;\n+    private final PKIXErrorResponseFactory pkixErrorResponseFactory;\n \n     @Autowired\n-    public ConfigActions(ConfigurationAccessor configurationAccessor, FieldModelProcessor fieldModelProcessor, DescriptorProcessor descriptorProcessor, ConfigurationFieldModelConverter modelConverter) {\n+    public ConfigActions(AuthorizationManager authorizationManager, DescriptorAccessor descriptorAccessor, ConfigurationAccessor configurationAccessor,\n+        FieldModelProcessor fieldModelProcessor, DescriptorProcessor descriptorProcessor, ConfigurationFieldModelConverter modelConverter,\n+        DescriptorMap descriptorMap, PKIXErrorResponseFactory pkixErrorResponseFactory) {\n+        super(authorizationManager, descriptorAccessor);\n         this.configurationAccessor = configurationAccessor;\n         this.fieldModelProcessor = fieldModelProcessor;\n         this.descriptorProcessor = descriptorProcessor;\n         this.modelConverter = modelConverter;\n+        this.descriptorMap = descriptorMap;\n+        this.pkixErrorResponseFactory = pkixErrorResponseFactory;\n     }\n \n-    public boolean doesConfigExist(String id) throws AlertException {\n-        return StringUtils.isNotBlank(id) && doesConfigExist(Long.parseLong(id));\n+    @Override\n+    protected ActionResponse<List<FieldModel>> readAllResources() {\n+        return new ActionResponse<>(HttpStatus.NOT_IMPLEMENTED, null);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f79d758c6a9f2d558b2728c4089863a4791796c5"}, "originalPosition": 75}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg2ODI1Nzky", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1162#pullrequestreview-486825792", "createdAt": "2020-09-11T13:52:36Z", "commit": {"oid": "f79d758c6a9f2d558b2728c4089863a4791796c5"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMVQxMzo1MjozNlrOHQfxew==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMVQxMzo1MjozNlrOHQfxew==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzA1OTgzNQ==", "bodyText": "null passed in constructor", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1162#discussion_r487059835", "createdAt": "2020-09-11T13:52:36Z", "author": {"login": "gkillough"}, "path": "src/main/java/com/synopsys/integration/alert/web/api/job/JobConfigActions.java", "diffHunk": "@@ -258,53 +324,80 @@ public MessageResult validateJob(JobFieldModel jobFieldModel) {\n             }\n         }\n \n-        return errorsList;\n+        return new ActionResponse<>(HttpStatus.OK, errorsList);\n     }\n \n-    // TODO abstract duplicate functionality\n-    public MessageResult testJob(JobFieldModel jobFieldModel) throws IntegrationException {\n-        MessageResult jobValidationResult = validateJob(jobFieldModel);\n-        if (jobValidationResult.hasErrors()) {\n-            return jobValidationResult;\n-        }\n-\n-        Collection<FieldModel> otherJobModels = new LinkedList<>();\n-        FieldModel channelFieldModel = getChannelFieldModelAndPopulateOtherJobModels(jobFieldModel, otherJobModels);\n-\n-        if (null != channelFieldModel) {\n-            Optional<TestAction> testActionOptional = descriptorProcessor.retrieveTestAction(channelFieldModel);\n-            if (testActionOptional.isPresent()) {\n-                Map<String, ConfigurationFieldModel> fields = createFieldsMap(channelFieldModel, otherJobModels);\n-                // The custom message fields are not written to the database or defined fields in the database.  Need to manually add them.\n-                // TODO Create a mechanism to create the field accessor with a combination of fields in the database and fields that are not.\n-                Optional<ConfigurationFieldModel> topicField = convertFieldToConfigurationField(channelFieldModel, TestAction.KEY_CUSTOM_TOPIC);\n-                Optional<ConfigurationFieldModel> messageField = convertFieldToConfigurationField(channelFieldModel, TestAction.KEY_CUSTOM_MESSAGE);\n-                topicField.ifPresent(model -> fields.put(TestAction.KEY_CUSTOM_TOPIC, model));\n-                messageField.ifPresent(model -> fields.put(TestAction.KEY_CUSTOM_MESSAGE, model));\n-                TestAction testAction = testActionOptional.get();\n-                FieldAccessor fieldAccessor = new FieldAccessor(fields);\n-                String jobId = channelFieldModel.getId();\n-\n-                MessageResult providerTestResult = testProviderConfig(fieldAccessor, jobId, channelFieldModel);\n-                if (providerTestResult.hasErrors()) {\n-                    return providerTestResult;\n+    @Override\n+    protected ValidationActionResponse testResource(JobFieldModel resource) {\n+        ValidationResponseModel responseModel;\n+        String id = resource.getJobId();\n+        try {\n+\n+            Collection<FieldModel> otherJobModels = new LinkedList<>();\n+            FieldModel channelFieldModel = getChannelFieldModelAndPopulateOtherJobModels(resource, otherJobModels);\n+\n+            if (null != channelFieldModel) {\n+                Optional<TestAction> testActionOptional = descriptorProcessor.retrieveTestAction(channelFieldModel);\n+                if (testActionOptional.isPresent()) {\n+                    Map<String, ConfigurationFieldModel> fields = createFieldsMap(channelFieldModel, otherJobModels);\n+                    // The custom message fields are not written to the database or defined fields in the database.  Need to manually add them.\n+                    // TODO Create a mechanism to create the field accessor with a combination of fields in the database and fields that are not.\n+                    Optional<ConfigurationFieldModel> topicField = convertFieldToConfigurationField(channelFieldModel, TestAction.KEY_CUSTOM_TOPIC);\n+                    Optional<ConfigurationFieldModel> messageField = convertFieldToConfigurationField(channelFieldModel, TestAction.KEY_CUSTOM_MESSAGE);\n+                    topicField.ifPresent(model -> fields.put(TestAction.KEY_CUSTOM_TOPIC, model));\n+                    messageField.ifPresent(model -> fields.put(TestAction.KEY_CUSTOM_MESSAGE, model));\n+                    TestAction testAction = testActionOptional.get();\n+                    FieldAccessor fieldAccessor = new FieldAccessor(fields);\n+                    String jobId = channelFieldModel.getId();\n+\n+                    MessageResult providerTestResult = testProviderConfig(fieldAccessor, jobId, channelFieldModel);\n+                    if (providerTestResult.hasErrors()) {\n+                        responseModel = ValidationResponseModel.fromStatusCollection(providerTestResult.getStatusMessage(), providerTestResult.getFieldStatuses());\n+                        return new ValidationActionResponse(HttpStatus.OK, responseModel);\n+                    }\n+\n+                    MessageResult testActionResult = testAction.testConfig(jobId, channelFieldModel, fieldAccessor);\n+                    List<AlertFieldStatus> resultFieldStatuses = testActionResult.getFieldStatuses();\n+                    responseModel = ValidationResponseModel.fromStatusCollection(testActionResult.getStatusMessage(), resultFieldStatuses);\n+                    return new ValidationActionResponse(HttpStatus.OK, responseModel);\n+                } else {\n+                    String descriptorName = channelFieldModel.getDescriptorName();\n+                    logger.error(\"Test action did not exist: {}\", descriptorName);\n+                    responseModel = ValidationResponseModel.withoutFieldStatuses(\"Test functionality not implemented for \" + descriptorName);\n+                    return new ValidationActionResponse(HttpStatus.METHOD_NOT_ALLOWED, responseModel);\n                 }\n-\n-                List<AlertFieldStatus> resultFieldStatuses = concatStatuses(jobValidationResult.getFieldStatuses(), providerTestResult.getFieldStatuses());\n-                MessageResult testActionResult = testAction.testConfig(jobId, channelFieldModel, fieldAccessor);\n-                resultFieldStatuses = concatStatuses(resultFieldStatuses, testActionResult.getFieldStatuses());\n-                return new MessageResult(testActionResult.getStatusMessage(), resultFieldStatuses);\n-            } else {\n-                String descriptorName = channelFieldModel.getDescriptorName();\n-                logger.error(\"Test action did not exist: {}\", descriptorName);\n-                throw new AlertMethodNotAllowedException(\"Test functionality not implemented for \" + descriptorName);\n             }\n+            responseModel = ValidationResponseModel.withoutFieldStatuses(\"No field model of type channel was was sent to test.\");\n+            return new ValidationActionResponse(HttpStatus.BAD_REQUEST, responseModel);\n+        } catch (IntegrationRestException e) {\n+            logger.error(e.getMessage(), e);\n+            return ValidationActionResponse.createResponseFromIntegrationRestException(e);\n+        } catch (AlertFieldException e) {\n+            logger.error(\"Test Error with field Errors\", e);\n+            responseModel = ValidationResponseModel.fromStatusCollection(e.getMessage(), e.getFieldErrors());\n+            return new ValidationActionResponse(HttpStatus.OK, responseModel);\n+        } catch (AlertMethodNotAllowedException e) {\n+            logger.error(e.getMessage(), e);\n+            return new ValidationActionResponse(HttpStatus.METHOD_NOT_ALLOWED, ValidationResponseModel.withoutFieldStatuses(e.getMessage()));\n+        } catch (IntegrationException e) {\n+            responseModel = pkixErrorResponseFactory.createSSLExceptionResponse(id, e)\n+                                .orElse(ValidationResponseModel.withoutFieldStatuses(e.getMessage()));\n+            return new ValidationActionResponse(HttpStatus.OK, responseModel);\n+        } catch (Exception e) {\n+            logger.error(e.getMessage(), e);\n+            responseModel = pkixErrorResponseFactory.createSSLExceptionResponse(id, e)\n+                                .orElse(ValidationResponseModel.withoutFieldStatuses(e.getMessage()));\n+            return new ValidationActionResponse(HttpStatus.OK, responseModel);\n         }\n-        return new MessageResult(\"No field model of type channel was was sent to test.\");\n     }\n \n-    public Optional<String> checkGlobalConfigExists(String descriptorName) {\n-        return globalConfigExistsValidator.validate(descriptorName);\n+    public ActionResponse<String> checkGlobalConfigExists(String descriptorName) {\n+        Optional<String> configMissingMessage = globalConfigExistsValidator.validate(descriptorName);\n+        if (configMissingMessage.isPresent()) {\n+            String message = configMissingMessage.get();\n+            return new ActionResponse<>(HttpStatus.BAD_REQUEST, message);\n+        }\n+        return new ActionResponse<>(HttpStatus.NO_CONTENT, null);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f79d758c6a9f2d558b2728c4089863a4791796c5"}, "originalPosition": 475}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c513540ae543cb01250d0bcae9601dce6950e1aa", "author": {"user": {"login": "psantos1113", "name": null}}, "url": "https://github.com/blackducksoftware/blackduck-alert/commit/c513540ae543cb01250d0bcae9601dce6950e1aa", "committedDate": "2020-09-11T14:50:07Z", "message": "refactor: Implement current PR suggestions."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "21256a169e148361ee2907b34c3c351b652ff130", "author": {"user": {"login": "psantos1113", "name": null}}, "url": "https://github.com/blackducksoftware/blackduck-alert/commit/21256a169e148361ee2907b34c3c351b652ff130", "committedDate": "2020-09-11T16:41:33Z", "message": "refactor: Implement PR feedback for additional interfaces."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg3MDQ4NjUz", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1162#pullrequestreview-487048653", "createdAt": "2020-09-11T18:57:41Z", "commit": {"oid": "21256a169e148361ee2907b34c3c351b652ff130"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMVQxODo1Nzo0MlrOHQqO-g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMVQxODo1Nzo0MlrOHQqO-g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzIzMTIyNg==", "bodyText": "Do we prefer calling the other constructor ('this' keyword) in cases like this?", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1162#discussion_r487231226", "createdAt": "2020-09-11T18:57:42Z", "author": {"login": "bamandel"}, "path": "alert-common/src/main/java/com/synopsys/integration/alert/common/action/api/AbstractConfigResourceActions.java", "diffHunk": "@@ -0,0 +1,184 @@\n+/**\n+ * alert-common\n+ *\n+ * Copyright (c) 2020 Synopsys, Inc.\n+ *\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements. See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership. The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied. See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+package com.synopsys.integration.alert.common.action.api;\n+\n+import java.util.List;\n+import java.util.Optional;\n+import java.util.Set;\n+import java.util.stream.Collectors;\n+\n+import org.springframework.http.HttpStatus;\n+\n+import com.synopsys.integration.alert.common.action.ActionResponse;\n+import com.synopsys.integration.alert.common.action.ValidationActionResponse;\n+import com.synopsys.integration.alert.common.enumeration.ConfigContextEnum;\n+import com.synopsys.integration.alert.common.exception.AlertException;\n+import com.synopsys.integration.alert.common.persistence.accessor.DescriptorAccessor;\n+import com.synopsys.integration.alert.common.persistence.model.RegisteredDescriptorModel;\n+import com.synopsys.integration.alert.common.rest.model.FieldModel;\n+import com.synopsys.integration.alert.common.rest.model.ValidationResponseModel;\n+import com.synopsys.integration.alert.common.security.authorization.AuthorizationManager;\n+\n+public abstract class AbstractConfigResourceActions implements LongResourceActions<FieldModel>, TestAction<FieldModel>, ValidateAction<FieldModel> {\n+    private AuthorizationManager authorizationManager;\n+    private DescriptorAccessor descriptorAccessor;\n+\n+    public AbstractConfigResourceActions(AuthorizationManager authorizationManager, DescriptorAccessor descriptorAccessor) {\n+        this.authorizationManager = authorizationManager;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "21256a169e148361ee2907b34c3c351b652ff130"}, "originalPosition": 47}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg3MDUyNDA4", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1162#pullrequestreview-487052408", "createdAt": "2020-09-11T19:03:46Z", "commit": {"oid": "21256a169e148361ee2907b34c3c351b652ff130"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMVQxOTowMzo0N1rOHQqaNA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMVQxOTowMzo0N1rOHQqaNA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzIzNDEwMA==", "bodyText": "This statement is written a lot. Should we have a private method or static method in ActionResponse to ensure it's always the same message?", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1162#discussion_r487234100", "createdAt": "2020-09-11T19:03:47Z", "author": {"login": "bamandel"}, "path": "alert-common/src/main/java/com/synopsys/integration/alert/common/action/api/AbstractConfigResourceActions.java", "diffHunk": "@@ -0,0 +1,184 @@\n+/**\n+ * alert-common\n+ *\n+ * Copyright (c) 2020 Synopsys, Inc.\n+ *\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements. See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership. The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied. See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+package com.synopsys.integration.alert.common.action.api;\n+\n+import java.util.List;\n+import java.util.Optional;\n+import java.util.Set;\n+import java.util.stream.Collectors;\n+\n+import org.springframework.http.HttpStatus;\n+\n+import com.synopsys.integration.alert.common.action.ActionResponse;\n+import com.synopsys.integration.alert.common.action.ValidationActionResponse;\n+import com.synopsys.integration.alert.common.enumeration.ConfigContextEnum;\n+import com.synopsys.integration.alert.common.exception.AlertException;\n+import com.synopsys.integration.alert.common.persistence.accessor.DescriptorAccessor;\n+import com.synopsys.integration.alert.common.persistence.model.RegisteredDescriptorModel;\n+import com.synopsys.integration.alert.common.rest.model.FieldModel;\n+import com.synopsys.integration.alert.common.rest.model.ValidationResponseModel;\n+import com.synopsys.integration.alert.common.security.authorization.AuthorizationManager;\n+\n+public abstract class AbstractConfigResourceActions implements LongResourceActions<FieldModel>, TestAction<FieldModel>, ValidateAction<FieldModel> {\n+    private AuthorizationManager authorizationManager;\n+    private DescriptorAccessor descriptorAccessor;\n+\n+    public AbstractConfigResourceActions(AuthorizationManager authorizationManager, DescriptorAccessor descriptorAccessor) {\n+        this.authorizationManager = authorizationManager;\n+        this.descriptorAccessor = descriptorAccessor;\n+    }\n+\n+    public AbstractConfigResourceActions(AuthorizationManager authorizationManager) {\n+        this.authorizationManager = authorizationManager;\n+    }\n+\n+    protected abstract ActionResponse<FieldModel> createAfterChecks(FieldModel resource);\n+\n+    protected abstract ActionResponse<FieldModel> deleteAfterChecks(Long id);\n+\n+    protected abstract ActionResponse<List<FieldModel>> readAllAfterChecks();\n+\n+    protected abstract ActionResponse<List<FieldModel>> readAllByContextAndDescriptorAfterChecks(String context, String descriptorName);\n+\n+    protected abstract Optional<FieldModel> findFieldModel(Long id);\n+\n+    protected abstract ValidationActionResponse testAfterChecks(FieldModel resource);\n+\n+    protected abstract ActionResponse<FieldModel> updateAfterChecks(Long id, FieldModel resource);\n+\n+    protected abstract ValidationActionResponse validateAfterChecks(FieldModel resource);\n+\n+    public ActionResponse<List<FieldModel>> getAllByContextAndDescriptor(String context, String descriptorName) {\n+        if (!authorizationManager.hasReadPermission(context, descriptorName)) {\n+            return new ActionResponse<>(HttpStatus.FORBIDDEN, AbstractResourceActions.FORBIDDEN_MESSAGE);\n+        }\n+        return readAllByContextAndDescriptorAfterChecks(context, descriptorName);\n+    }\n+\n+    @Override\n+    public ActionResponse<FieldModel> create(FieldModel resource) {\n+        if (!authorizationManager.hasCreatePermission(resource.getContext(), resource.getDescriptorName())) {\n+            return new ActionResponse<>(HttpStatus.FORBIDDEN, AbstractResourceActions.FORBIDDEN_MESSAGE);\n+        }\n+        ValidationActionResponse validationResponse = validateAfterChecks(resource);\n+        if (validationResponse.isError()) {\n+            return new ActionResponse<>(validationResponse.getHttpStatus(), validationResponse.getMessage().orElse(null));\n+        }\n+        return createAfterChecks(resource);\n+    }\n+\n+    @Override\n+    public ActionResponse<List<FieldModel>> getAll() {\n+        try {\n+            Set<String> descriptorNames = descriptorAccessor.getRegisteredDescriptors()\n+                                              .stream()\n+                                              .map(RegisteredDescriptorModel::getName)\n+                                              .collect(Collectors.toSet());\n+            if (!authorizationManager.anyReadPermission(List.of(ConfigContextEnum.DISTRIBUTION.name(), ConfigContextEnum.GLOBAL.name()), descriptorNames)) {\n+                return new ActionResponse<>(HttpStatus.FORBIDDEN, AbstractResourceActions.FORBIDDEN_MESSAGE);\n+            }\n+            return readAllAfterChecks();\n+        } catch (AlertException ex) {\n+            return new ActionResponse<>(HttpStatus.INTERNAL_SERVER_ERROR, String.format(\"Error reading configurations: %s\", ex.getMessage()));\n+        }\n+    }\n+\n+    @Override\n+    public ActionResponse<FieldModel> getOne(Long id) {\n+        Optional<FieldModel> fieldModel = findFieldModel(id);\n+        if (fieldModel.isPresent()) {\n+            FieldModel model = fieldModel.get();\n+            if (!authorizationManager.hasReadPermission(model.getContext(), model.getDescriptorName())) {\n+                return new ActionResponse<>(HttpStatus.FORBIDDEN, AbstractResourceActions.FORBIDDEN_MESSAGE);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "21256a169e148361ee2907b34c3c351b652ff130"}, "originalPosition": 112}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg3MDU3MzAz", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1162#pullrequestreview-487057303", "createdAt": "2020-09-11T19:11:04Z", "commit": {"oid": "21256a169e148361ee2907b34c3c351b652ff130"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMVQxOToxMTowNVrOHQqnzA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMVQxOToxMTowNVrOHQqnzA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzIzNzU4MA==", "bodyText": "Instead of the Set object, could we return the statement in the try block otherwise return Set.of?", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1162#discussion_r487237580", "createdAt": "2020-09-11T19:11:05Z", "author": {"login": "bamandel"}, "path": "alert-common/src/main/java/com/synopsys/integration/alert/common/action/api/AbstractJobResourceActions.java", "diffHunk": "@@ -0,0 +1,216 @@\n+/**\n+ * alert-common\n+ *\n+ * Copyright (c) 2020 Synopsys, Inc.\n+ *\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements. See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership. The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied. See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+package com.synopsys.integration.alert.common.action.api;\n+\n+import java.util.Collection;\n+import java.util.EnumSet;\n+import java.util.LinkedList;\n+import java.util.List;\n+import java.util.Optional;\n+import java.util.Set;\n+import java.util.UUID;\n+import java.util.function.BiFunction;\n+import java.util.stream.Collectors;\n+\n+import org.springframework.http.HttpStatus;\n+\n+import com.synopsys.integration.alert.common.action.ActionResponse;\n+import com.synopsys.integration.alert.common.action.ValidationActionResponse;\n+import com.synopsys.integration.alert.common.enumeration.ConfigContextEnum;\n+import com.synopsys.integration.alert.common.enumeration.DescriptorType;\n+import com.synopsys.integration.alert.common.exception.AlertDatabaseConstraintException;\n+import com.synopsys.integration.alert.common.persistence.accessor.DescriptorAccessor;\n+import com.synopsys.integration.alert.common.persistence.model.RegisteredDescriptorModel;\n+import com.synopsys.integration.alert.common.rest.model.FieldModel;\n+import com.synopsys.integration.alert.common.rest.model.JobFieldModel;\n+import com.synopsys.integration.alert.common.rest.model.ValidationResponseModel;\n+import com.synopsys.integration.alert.common.security.authorization.AuthorizationManager;\n+\n+public abstract class AbstractJobResourceActions implements JobResourceActions, ValidateAction<JobFieldModel>, TestAction<JobFieldModel> {\n+    private static final EnumSet<DescriptorType> ALLOWED_JOB_DESCRIPTOR_TYPES = EnumSet.of(DescriptorType.PROVIDER, DescriptorType.CHANNEL);\n+    private AuthorizationManager authorizationManager;\n+    private DescriptorAccessor descriptorAccessor;\n+\n+    public AbstractJobResourceActions(AuthorizationManager authorizationManager, DescriptorAccessor descriptorAccessor) {\n+        this.authorizationManager = authorizationManager;\n+        this.descriptorAccessor = descriptorAccessor;\n+    }\n+\n+    protected abstract Optional<JobFieldModel> findJobFieldModel(UUID id);\n+\n+    protected abstract ActionResponse<JobFieldModel> createAfterChecks(JobFieldModel resource);\n+\n+    protected abstract ActionResponse<JobFieldModel> deleteAfterChecks(UUID id);\n+\n+    protected abstract ActionResponse<List<JobFieldModel>> readAllAfterChecks();\n+\n+    protected abstract ValidationActionResponse testAfterChecks(JobFieldModel resource);\n+\n+    protected abstract ActionResponse<JobFieldModel> updateAfterChecks(UUID id, JobFieldModel resource);\n+\n+    protected abstract ValidationActionResponse validateAfterChecks(JobFieldModel resource);\n+\n+    private Set<String> getDescriptorNames() {\n+        Set<String> descriptorNames = Set.of();\n+        try {\n+            descriptorNames = descriptorAccessor.getRegisteredDescriptors()\n+                                  .stream()\n+                                  .filter(descriptor -> ALLOWED_JOB_DESCRIPTOR_TYPES.contains(descriptor.getType()))\n+                                  .map(RegisteredDescriptorModel::getName)\n+                                  .collect(Collectors.toSet());\n+        } catch (AlertDatabaseConstraintException ex) {\n+            // ignore or add a logger.\n+        }\n+\n+        return descriptorNames;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "21256a169e148361ee2907b34c3c351b652ff130"}, "originalPosition": 85}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg3MDU4Mzgx", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1162#pullrequestreview-487058381", "createdAt": "2020-09-11T19:12:00Z", "commit": {"oid": "21256a169e148361ee2907b34c3c351b652ff130"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMVQxOToxMjowMFrOHQqpoA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMVQxOToxMjowMFrOHQqpoA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzIzODA0OA==", "bodyText": "More of these calls to FORBIDDEN and FORBIDDEN_MESSAGE. Makes me this we should put this object creation in a static variable somewhere.", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1162#discussion_r487238048", "createdAt": "2020-09-11T19:12:00Z", "author": {"login": "bamandel"}, "path": "alert-common/src/main/java/com/synopsys/integration/alert/common/action/api/AbstractJobResourceActions.java", "diffHunk": "@@ -0,0 +1,216 @@\n+/**\n+ * alert-common\n+ *\n+ * Copyright (c) 2020 Synopsys, Inc.\n+ *\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements. See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership. The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied. See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+package com.synopsys.integration.alert.common.action.api;\n+\n+import java.util.Collection;\n+import java.util.EnumSet;\n+import java.util.LinkedList;\n+import java.util.List;\n+import java.util.Optional;\n+import java.util.Set;\n+import java.util.UUID;\n+import java.util.function.BiFunction;\n+import java.util.stream.Collectors;\n+\n+import org.springframework.http.HttpStatus;\n+\n+import com.synopsys.integration.alert.common.action.ActionResponse;\n+import com.synopsys.integration.alert.common.action.ValidationActionResponse;\n+import com.synopsys.integration.alert.common.enumeration.ConfigContextEnum;\n+import com.synopsys.integration.alert.common.enumeration.DescriptorType;\n+import com.synopsys.integration.alert.common.exception.AlertDatabaseConstraintException;\n+import com.synopsys.integration.alert.common.persistence.accessor.DescriptorAccessor;\n+import com.synopsys.integration.alert.common.persistence.model.RegisteredDescriptorModel;\n+import com.synopsys.integration.alert.common.rest.model.FieldModel;\n+import com.synopsys.integration.alert.common.rest.model.JobFieldModel;\n+import com.synopsys.integration.alert.common.rest.model.ValidationResponseModel;\n+import com.synopsys.integration.alert.common.security.authorization.AuthorizationManager;\n+\n+public abstract class AbstractJobResourceActions implements JobResourceActions, ValidateAction<JobFieldModel>, TestAction<JobFieldModel> {\n+    private static final EnumSet<DescriptorType> ALLOWED_JOB_DESCRIPTOR_TYPES = EnumSet.of(DescriptorType.PROVIDER, DescriptorType.CHANNEL);\n+    private AuthorizationManager authorizationManager;\n+    private DescriptorAccessor descriptorAccessor;\n+\n+    public AbstractJobResourceActions(AuthorizationManager authorizationManager, DescriptorAccessor descriptorAccessor) {\n+        this.authorizationManager = authorizationManager;\n+        this.descriptorAccessor = descriptorAccessor;\n+    }\n+\n+    protected abstract Optional<JobFieldModel> findJobFieldModel(UUID id);\n+\n+    protected abstract ActionResponse<JobFieldModel> createAfterChecks(JobFieldModel resource);\n+\n+    protected abstract ActionResponse<JobFieldModel> deleteAfterChecks(UUID id);\n+\n+    protected abstract ActionResponse<List<JobFieldModel>> readAllAfterChecks();\n+\n+    protected abstract ValidationActionResponse testAfterChecks(JobFieldModel resource);\n+\n+    protected abstract ActionResponse<JobFieldModel> updateAfterChecks(UUID id, JobFieldModel resource);\n+\n+    protected abstract ValidationActionResponse validateAfterChecks(JobFieldModel resource);\n+\n+    private Set<String> getDescriptorNames() {\n+        Set<String> descriptorNames = Set.of();\n+        try {\n+            descriptorNames = descriptorAccessor.getRegisteredDescriptors()\n+                                  .stream()\n+                                  .filter(descriptor -> ALLOWED_JOB_DESCRIPTOR_TYPES.contains(descriptor.getType()))\n+                                  .map(RegisteredDescriptorModel::getName)\n+                                  .collect(Collectors.toSet());\n+        } catch (AlertDatabaseConstraintException ex) {\n+            // ignore or add a logger.\n+        }\n+\n+        return descriptorNames;\n+    }\n+\n+    @Override\n+    public ActionResponse<JobFieldModel> create(JobFieldModel resource) {\n+        boolean hasPermissions = hasRequiredPermissions(resource.getFieldModels(), authorizationManager::hasCreatePermission);\n+        if (!hasPermissions) {\n+            return new ActionResponse<>(HttpStatus.FORBIDDEN, AbstractResourceActions.FORBIDDEN_MESSAGE);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "21256a169e148361ee2907b34c3c351b652ff130"}, "originalPosition": 92}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg3MDYzMjcy", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1162#pullrequestreview-487063272", "createdAt": "2020-09-11T19:17:39Z", "commit": {"oid": "21256a169e148361ee2907b34c3c351b652ff130"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMVQxOToxNzozOVrOHQq3BA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMVQxOToxNzozOVrOHQq3BA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzI0MTQ3Ng==", "bodyText": "This class also has references to the forbidden action response", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1162#discussion_r487241476", "createdAt": "2020-09-11T19:17:39Z", "author": {"login": "bamandel"}, "path": "alert-common/src/main/java/com/synopsys/integration/alert/common/action/api/AbstractResourceActions.java", "diffHunk": "@@ -0,0 +1,158 @@\n+/**\n+ * alert-common\n+ *\n+ * Copyright (c) 2020 Synopsys, Inc.\n+ *\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements. See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership. The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied. See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+package com.synopsys.integration.alert.common.action.api;\n+\n+import java.util.List;\n+import java.util.Optional;\n+\n+import org.springframework.http.HttpStatus;\n+\n+import com.synopsys.integration.alert.common.action.ActionResponse;\n+import com.synopsys.integration.alert.common.action.ValidationActionResponse;\n+import com.synopsys.integration.alert.common.descriptor.DescriptorKey;\n+import com.synopsys.integration.alert.common.enumeration.ConfigContextEnum;\n+import com.synopsys.integration.alert.common.rest.model.ValidationResponseModel;\n+import com.synopsys.integration.alert.common.security.authorization.AuthorizationManager;\n+\n+public abstract class AbstractResourceActions<T> implements LongResourceActions<T>, ValidateAction<T>, TestAction<T> {\n+    public static final String FORBIDDEN_MESSAGE = \"User not authorized to perform the request\";\n+    public static final String RESOURCE_IDENTIFIER_MISSING = \"Resource identifier missing.\";\n+    private DescriptorKey descriptorKey;\n+    private AuthorizationManager authorizationManager;\n+    private ConfigContextEnum context;\n+\n+    public AbstractResourceActions(DescriptorKey descriptorKey, ConfigContextEnum context, AuthorizationManager authorizationManager) {\n+        this.descriptorKey = descriptorKey;\n+        this.context = context;\n+        // to do change the authorization manager to use the context enum and the descriptor key\n+        this.authorizationManager = authorizationManager;\n+\n+    }\n+\n+    protected abstract ActionResponse<T> createAfterChecks(T resource);\n+\n+    protected abstract ActionResponse<T> deleteAfterChecks(Long id);\n+\n+    protected abstract ActionResponse<List<T>> readAllAfterChecks();\n+\n+    protected abstract ActionResponse<T> readAfterChecks(Long id);\n+\n+    protected abstract ValidationActionResponse testAfterChecks(T resource);\n+\n+    protected abstract ActionResponse<T> updateAfterChecks(Long id, T resource);\n+\n+    protected abstract ValidationActionResponse validateAfterChecks(T resource);\n+\n+    protected abstract Optional<T> findExisting(Long id);\n+\n+    @Override\n+    public ActionResponse<T> create(T resource) {\n+        if (!authorizationManager.hasCreatePermission(context.name(), descriptorKey.getUniversalKey())) {\n+            return new ActionResponse<>(HttpStatus.FORBIDDEN, AbstractResourceActions.FORBIDDEN_MESSAGE);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "21256a169e148361ee2907b34c3c351b652ff130"}, "originalPosition": 71}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg3MDYzNjY2", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1162#pullrequestreview-487063666", "createdAt": "2020-09-11T19:18:19Z", "commit": {"oid": "21256a169e148361ee2907b34c3c351b652ff130"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMVQxOToxODoxOVrOHQq41w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMVQxOToxODoxOVrOHQq41w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzI0MTk0Mw==", "bodyText": "Do we still want this null check or will this be removed?", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1162#discussion_r487241943", "createdAt": "2020-09-11T19:18:19Z", "author": {"login": "bamandel"}, "path": "alert-common/src/main/java/com/synopsys/integration/alert/common/action/api/AbstractResourceActions.java", "diffHunk": "@@ -0,0 +1,158 @@\n+/**\n+ * alert-common\n+ *\n+ * Copyright (c) 2020 Synopsys, Inc.\n+ *\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements. See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership. The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied. See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+package com.synopsys.integration.alert.common.action.api;\n+\n+import java.util.List;\n+import java.util.Optional;\n+\n+import org.springframework.http.HttpStatus;\n+\n+import com.synopsys.integration.alert.common.action.ActionResponse;\n+import com.synopsys.integration.alert.common.action.ValidationActionResponse;\n+import com.synopsys.integration.alert.common.descriptor.DescriptorKey;\n+import com.synopsys.integration.alert.common.enumeration.ConfigContextEnum;\n+import com.synopsys.integration.alert.common.rest.model.ValidationResponseModel;\n+import com.synopsys.integration.alert.common.security.authorization.AuthorizationManager;\n+\n+public abstract class AbstractResourceActions<T> implements LongResourceActions<T>, ValidateAction<T>, TestAction<T> {\n+    public static final String FORBIDDEN_MESSAGE = \"User not authorized to perform the request\";\n+    public static final String RESOURCE_IDENTIFIER_MISSING = \"Resource identifier missing.\";\n+    private DescriptorKey descriptorKey;\n+    private AuthorizationManager authorizationManager;\n+    private ConfigContextEnum context;\n+\n+    public AbstractResourceActions(DescriptorKey descriptorKey, ConfigContextEnum context, AuthorizationManager authorizationManager) {\n+        this.descriptorKey = descriptorKey;\n+        this.context = context;\n+        // to do change the authorization manager to use the context enum and the descriptor key\n+        this.authorizationManager = authorizationManager;\n+\n+    }\n+\n+    protected abstract ActionResponse<T> createAfterChecks(T resource);\n+\n+    protected abstract ActionResponse<T> deleteAfterChecks(Long id);\n+\n+    protected abstract ActionResponse<List<T>> readAllAfterChecks();\n+\n+    protected abstract ActionResponse<T> readAfterChecks(Long id);\n+\n+    protected abstract ValidationActionResponse testAfterChecks(T resource);\n+\n+    protected abstract ActionResponse<T> updateAfterChecks(Long id, T resource);\n+\n+    protected abstract ValidationActionResponse validateAfterChecks(T resource);\n+\n+    protected abstract Optional<T> findExisting(Long id);\n+\n+    @Override\n+    public ActionResponse<T> create(T resource) {\n+        if (!authorizationManager.hasCreatePermission(context.name(), descriptorKey.getUniversalKey())) {\n+            return new ActionResponse<>(HttpStatus.FORBIDDEN, AbstractResourceActions.FORBIDDEN_MESSAGE);\n+        }\n+        ValidationActionResponse validationResponse = validateAfterChecks(resource);\n+        if (validationResponse.isError()) {\n+            return new ActionResponse<>(validationResponse.getHttpStatus(), validationResponse.getMessage().orElse(null));\n+        }\n+        return createAfterChecks(resource);\n+    }\n+\n+    @Override\n+    public ActionResponse<List<T>> getAll() {\n+        if (!authorizationManager.hasReadPermission(context.name(), descriptorKey.getUniversalKey())) {\n+            return new ActionResponse<>(HttpStatus.FORBIDDEN, AbstractResourceActions.FORBIDDEN_MESSAGE);\n+        }\n+        return readAllAfterChecks();\n+    }\n+\n+    @Override\n+    public ActionResponse<T> getOne(Long id) {\n+        if (null == id) {\n+            return new ActionResponse<>(HttpStatus.BAD_REQUEST, RESOURCE_IDENTIFIER_MISSING);\n+        }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "21256a169e148361ee2907b34c3c351b652ff130"}, "originalPosition": 92}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg3MDczMjQx", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1162#pullrequestreview-487073241", "createdAt": "2020-09-11T19:35:11Z", "commit": {"oid": "21256a169e148361ee2907b34c3c351b652ff130"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMVQxOTozNToxMVrOHQrZjw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMVQxOTozNToxMVrOHQrZjw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzI1MDMxOQ==", "bodyText": "This may look better if we fo an if check with a return then return Bad request by default if the if statement is skipped.", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1162#discussion_r487250319", "createdAt": "2020-09-11T19:35:11Z", "author": {"login": "bamandel"}, "path": "src/main/java/com/synopsys/integration/alert/web/api/config/ConfigActions.java", "diffHunk": "@@ -118,54 +160,103 @@ public void deleteConfig(Long id) throws AlertException {\n                 configurationAccessor.deleteConfiguration(Long.parseLong(fieldModel.getId()));\n                 fieldModelProcessor.performAfterDeleteAction(fieldModel);\n             }\n+        } catch (AlertException ex) {\n+            logger.error(String.format(\"Error deleting config id: %d\", id), ex);\n+            return new ActionResponse<>(HttpStatus.INTERNAL_SERVER_ERROR, ex.getMessage());\n         }\n+\n+        return new ActionResponse<>(HttpStatus.NO_CONTENT);\n     }\n \n-    public FieldModel saveConfig(FieldModel fieldModel, DescriptorKey descriptorKey) throws AlertException {\n-        validateConfig(fieldModel, new ArrayList<>());\n-        FieldModel modifiedFieldModel = fieldModelProcessor.performBeforeSaveAction(fieldModel);\n-        String context = modifiedFieldModel.getContext();\n-        Map<String, ConfigurationFieldModel> configurationFieldModelMap = modelConverter.convertToConfigurationFieldModelMap(modifiedFieldModel);\n-        ConfigurationModel configuration = configurationAccessor.createConfiguration(descriptorKey, EnumUtils.getEnum(ConfigContextEnum.class, context), configurationFieldModelMap.values());\n-        FieldModel dbSavedModel = modelConverter.convertToFieldModel(configuration);\n-        FieldModel afterSaveAction = fieldModelProcessor.performAfterSaveAction(dbSavedModel);\n-        return dbSavedModel.fill(afterSaveAction);\n+    @Override\n+    protected ActionResponse<FieldModel> createAfterChecks(FieldModel resource) {\n+        Optional<DescriptorKey> descriptorKey = descriptorMap.getDescriptorKey(resource.getDescriptorName());\n+        if (descriptorKey.isPresent()) {\n+            try {\n+                FieldModel modifiedFieldModel = fieldModelProcessor.performBeforeSaveAction(resource);\n+                String context = modifiedFieldModel.getContext();\n+                Map<String, ConfigurationFieldModel> configurationFieldModelMap = modelConverter.convertToConfigurationFieldModelMap(modifiedFieldModel);\n+                ConfigurationModel configuration = configurationAccessor.createConfiguration(descriptorKey.get(), EnumUtils.getEnum(ConfigContextEnum.class, context), configurationFieldModelMap.values());\n+                FieldModel dbSavedModel = modelConverter.convertToFieldModel(configuration);\n+                FieldModel afterSaveAction = fieldModelProcessor.performAfterSaveAction(dbSavedModel);\n+                FieldModel responseModel = dbSavedModel.fill(afterSaveAction);\n+                return new ActionResponse<>(HttpStatus.OK, responseModel);\n+            } catch (AlertException ex) {\n+                logger.error(\"Error creating configuration\", ex);\n+                return new ActionResponse<>(HttpStatus.INTERNAL_SERVER_ERROR, String.format(\"Error creating config: %s\", ex.getMessage()));\n+            }\n+        }\n+        return new ActionResponse<>(HttpStatus.BAD_REQUEST, \"descriptorName is missing or invalid\");\n     }\n \n-    public FieldModel updateConfig(Long id, FieldModel fieldModel) throws AlertException {\n-        validateConfig(fieldModel, new ArrayList<>());\n-        Optional<ConfigurationModel> optionalPreviousConfig = configurationAccessor.getConfigurationById(id);\n-        FieldModel previousFieldModel = optionalPreviousConfig.isPresent() ? modelConverter.convertToFieldModel(optionalPreviousConfig.get()) : null;\n-\n-        FieldModel updatedFieldModel = fieldModelProcessor.performBeforeUpdateAction(fieldModel);\n-        Collection<ConfigurationFieldModel> updatedFields = fieldModelProcessor.fillFieldModelWithExistingData(id, updatedFieldModel);\n-        ConfigurationModel configurationModel = configurationAccessor.updateConfiguration(id, updatedFields);\n-        FieldModel dbSavedModel = modelConverter.convertToFieldModel(configurationModel);\n-        FieldModel afterUpdateAction = fieldModelProcessor.performAfterUpdateAction(previousFieldModel, dbSavedModel);\n-        return dbSavedModel.fill(afterUpdateAction);\n+    @Override\n+    protected ActionResponse<FieldModel> updateAfterChecks(Long id, FieldModel resource) {\n+        try {\n+            Optional<ConfigurationModel> optionalPreviousConfig = configurationAccessor.getConfigurationById(id);\n+            FieldModel previousFieldModel = optionalPreviousConfig.isPresent() ? modelConverter.convertToFieldModel(optionalPreviousConfig.get()) : null;\n+\n+            FieldModel updatedFieldModel = fieldModelProcessor.performBeforeUpdateAction(resource);\n+            Collection<ConfigurationFieldModel> updatedFields = fieldModelProcessor.fillFieldModelWithExistingData(id, updatedFieldModel);\n+            ConfigurationModel configurationModel = configurationAccessor.updateConfiguration(id, updatedFields);\n+            FieldModel dbSavedModel = modelConverter.convertToFieldModel(configurationModel);\n+            FieldModel afterUpdateAction = fieldModelProcessor.performAfterUpdateAction(previousFieldModel, dbSavedModel);\n+            FieldModel responseModel = dbSavedModel.fill(afterUpdateAction);\n+            return new ActionResponse<>(HttpStatus.OK, responseModel);\n+        } catch (AlertException ex) {\n+            logger.error(\"Error creating configuration\", ex);\n+            return new ActionResponse<>(HttpStatus.INTERNAL_SERVER_ERROR, String.format(\"Error creating config: %s\", ex.getMessage()));\n+        }\n     }\n \n-    public String validateConfig(FieldModel fieldModel, List<AlertFieldStatus> fieldErrors) throws AlertFieldException {\n-        fieldErrors.addAll(fieldModelProcessor.validateFieldModel(fieldModel));\n-        if (!fieldErrors.isEmpty()) {\n-            throw new AlertFieldException(fieldErrors);\n+    @Override\n+    protected ValidationActionResponse validateAfterChecks(FieldModel resource) {\n+        List<AlertFieldStatus> fieldStatuses = fieldModelProcessor.validateFieldModel(resource);\n+        ValidationResponseModel responseModel;\n+        HttpStatus status = HttpStatus.OK;\n+        if (fieldStatuses.isEmpty()) {\n+            responseModel = ValidationResponseModel.withoutFieldStatuses(\"The configuration is valid\");\n+        } else {\n+            status = HttpStatus.BAD_REQUEST;\n+            responseModel = ValidationResponseModel.fromStatusCollection(\"There were problems with the configuration\", fieldStatuses);\n         }\n-        return \"Valid\";\n+        return new ValidationActionResponse(status, responseModel);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "21256a169e148361ee2907b34c3c351b652ff130"}, "originalPosition": 255}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg3MDc0NDk0", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1162#pullrequestreview-487074494", "createdAt": "2020-09-11T19:37:17Z", "commit": {"oid": "21256a169e148361ee2907b34c3c351b652ff130"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMVQxOTozNzoxN1rOHQrdJA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMVQxOTozNzoxN1rOHQrdJA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzI1MTIzNg==", "bodyText": "Might be cleaner to remove this declaration and just create the object before returning.", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1162#discussion_r487251236", "createdAt": "2020-09-11T19:37:17Z", "author": {"login": "bamandel"}, "path": "src/main/java/com/synopsys/integration/alert/web/api/config/ConfigActions.java", "diffHunk": "@@ -118,54 +160,103 @@ public void deleteConfig(Long id) throws AlertException {\n                 configurationAccessor.deleteConfiguration(Long.parseLong(fieldModel.getId()));\n                 fieldModelProcessor.performAfterDeleteAction(fieldModel);\n             }\n+        } catch (AlertException ex) {\n+            logger.error(String.format(\"Error deleting config id: %d\", id), ex);\n+            return new ActionResponse<>(HttpStatus.INTERNAL_SERVER_ERROR, ex.getMessage());\n         }\n+\n+        return new ActionResponse<>(HttpStatus.NO_CONTENT);\n     }\n \n-    public FieldModel saveConfig(FieldModel fieldModel, DescriptorKey descriptorKey) throws AlertException {\n-        validateConfig(fieldModel, new ArrayList<>());\n-        FieldModel modifiedFieldModel = fieldModelProcessor.performBeforeSaveAction(fieldModel);\n-        String context = modifiedFieldModel.getContext();\n-        Map<String, ConfigurationFieldModel> configurationFieldModelMap = modelConverter.convertToConfigurationFieldModelMap(modifiedFieldModel);\n-        ConfigurationModel configuration = configurationAccessor.createConfiguration(descriptorKey, EnumUtils.getEnum(ConfigContextEnum.class, context), configurationFieldModelMap.values());\n-        FieldModel dbSavedModel = modelConverter.convertToFieldModel(configuration);\n-        FieldModel afterSaveAction = fieldModelProcessor.performAfterSaveAction(dbSavedModel);\n-        return dbSavedModel.fill(afterSaveAction);\n+    @Override\n+    protected ActionResponse<FieldModel> createAfterChecks(FieldModel resource) {\n+        Optional<DescriptorKey> descriptorKey = descriptorMap.getDescriptorKey(resource.getDescriptorName());\n+        if (descriptorKey.isPresent()) {\n+            try {\n+                FieldModel modifiedFieldModel = fieldModelProcessor.performBeforeSaveAction(resource);\n+                String context = modifiedFieldModel.getContext();\n+                Map<String, ConfigurationFieldModel> configurationFieldModelMap = modelConverter.convertToConfigurationFieldModelMap(modifiedFieldModel);\n+                ConfigurationModel configuration = configurationAccessor.createConfiguration(descriptorKey.get(), EnumUtils.getEnum(ConfigContextEnum.class, context), configurationFieldModelMap.values());\n+                FieldModel dbSavedModel = modelConverter.convertToFieldModel(configuration);\n+                FieldModel afterSaveAction = fieldModelProcessor.performAfterSaveAction(dbSavedModel);\n+                FieldModel responseModel = dbSavedModel.fill(afterSaveAction);\n+                return new ActionResponse<>(HttpStatus.OK, responseModel);\n+            } catch (AlertException ex) {\n+                logger.error(\"Error creating configuration\", ex);\n+                return new ActionResponse<>(HttpStatus.INTERNAL_SERVER_ERROR, String.format(\"Error creating config: %s\", ex.getMessage()));\n+            }\n+        }\n+        return new ActionResponse<>(HttpStatus.BAD_REQUEST, \"descriptorName is missing or invalid\");\n     }\n \n-    public FieldModel updateConfig(Long id, FieldModel fieldModel) throws AlertException {\n-        validateConfig(fieldModel, new ArrayList<>());\n-        Optional<ConfigurationModel> optionalPreviousConfig = configurationAccessor.getConfigurationById(id);\n-        FieldModel previousFieldModel = optionalPreviousConfig.isPresent() ? modelConverter.convertToFieldModel(optionalPreviousConfig.get()) : null;\n-\n-        FieldModel updatedFieldModel = fieldModelProcessor.performBeforeUpdateAction(fieldModel);\n-        Collection<ConfigurationFieldModel> updatedFields = fieldModelProcessor.fillFieldModelWithExistingData(id, updatedFieldModel);\n-        ConfigurationModel configurationModel = configurationAccessor.updateConfiguration(id, updatedFields);\n-        FieldModel dbSavedModel = modelConverter.convertToFieldModel(configurationModel);\n-        FieldModel afterUpdateAction = fieldModelProcessor.performAfterUpdateAction(previousFieldModel, dbSavedModel);\n-        return dbSavedModel.fill(afterUpdateAction);\n+    @Override\n+    protected ActionResponse<FieldModel> updateAfterChecks(Long id, FieldModel resource) {\n+        try {\n+            Optional<ConfigurationModel> optionalPreviousConfig = configurationAccessor.getConfigurationById(id);\n+            FieldModel previousFieldModel = optionalPreviousConfig.isPresent() ? modelConverter.convertToFieldModel(optionalPreviousConfig.get()) : null;\n+\n+            FieldModel updatedFieldModel = fieldModelProcessor.performBeforeUpdateAction(resource);\n+            Collection<ConfigurationFieldModel> updatedFields = fieldModelProcessor.fillFieldModelWithExistingData(id, updatedFieldModel);\n+            ConfigurationModel configurationModel = configurationAccessor.updateConfiguration(id, updatedFields);\n+            FieldModel dbSavedModel = modelConverter.convertToFieldModel(configurationModel);\n+            FieldModel afterUpdateAction = fieldModelProcessor.performAfterUpdateAction(previousFieldModel, dbSavedModel);\n+            FieldModel responseModel = dbSavedModel.fill(afterUpdateAction);\n+            return new ActionResponse<>(HttpStatus.OK, responseModel);\n+        } catch (AlertException ex) {\n+            logger.error(\"Error creating configuration\", ex);\n+            return new ActionResponse<>(HttpStatus.INTERNAL_SERVER_ERROR, String.format(\"Error creating config: %s\", ex.getMessage()));\n+        }\n     }\n \n-    public String validateConfig(FieldModel fieldModel, List<AlertFieldStatus> fieldErrors) throws AlertFieldException {\n-        fieldErrors.addAll(fieldModelProcessor.validateFieldModel(fieldModel));\n-        if (!fieldErrors.isEmpty()) {\n-            throw new AlertFieldException(fieldErrors);\n+    @Override\n+    protected ValidationActionResponse validateAfterChecks(FieldModel resource) {\n+        List<AlertFieldStatus> fieldStatuses = fieldModelProcessor.validateFieldModel(resource);\n+        ValidationResponseModel responseModel;\n+        HttpStatus status = HttpStatus.OK;\n+        if (fieldStatuses.isEmpty()) {\n+            responseModel = ValidationResponseModel.withoutFieldStatuses(\"The configuration is valid\");\n+        } else {\n+            status = HttpStatus.BAD_REQUEST;\n+            responseModel = ValidationResponseModel.fromStatusCollection(\"There were problems with the configuration\", fieldStatuses);\n         }\n-        return \"Valid\";\n+        return new ValidationActionResponse(status, responseModel);\n     }\n \n-    public String testConfig(FieldModel restModel) throws IntegrationException {\n-        validateConfig(restModel, new ArrayList<>());\n-        Optional<TestAction> testActionOptional = descriptorProcessor.retrieveTestAction(restModel);\n+    @Override\n+    protected ValidationActionResponse testAfterChecks(FieldModel resource) {\n+        Optional<TestAction> testActionOptional = descriptorProcessor.retrieveTestAction(resource);\n+        ValidationResponseModel responseModel;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "21256a169e148361ee2907b34c3c351b652ff130"}, "originalPosition": 264}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg3MDc1Nzc1", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1162#pullrequestreview-487075775", "createdAt": "2020-09-11T19:39:34Z", "commit": {"oid": "21256a169e148361ee2907b34c3c351b652ff130"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMVQxOTozOTozNFrOHQrg8g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMVQxOTozOTozNFrOHQrg8g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzI1MjIxMA==", "bodyText": "A lot of constructor params getting passed. Something to look into, maybe add a TODO to revisit this?", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1162#discussion_r487252210", "createdAt": "2020-09-11T19:39:34Z", "author": {"login": "bamandel"}, "path": "src/main/java/com/synopsys/integration/alert/web/api/job/JobConfigActions.java", "diffHunk": "@@ -56,150 +63,183 @@\n import com.synopsys.integration.alert.common.exception.AlertMethodNotAllowedException;\n import com.synopsys.integration.alert.common.message.model.MessageResult;\n import com.synopsys.integration.alert.common.persistence.accessor.ConfigurationAccessor;\n+import com.synopsys.integration.alert.common.persistence.accessor.DescriptorAccessor;\n import com.synopsys.integration.alert.common.persistence.accessor.FieldAccessor;\n import com.synopsys.integration.alert.common.persistence.model.ConfigurationFieldModel;\n import com.synopsys.integration.alert.common.persistence.model.ConfigurationJobModel;\n import com.synopsys.integration.alert.common.persistence.model.ConfigurationModel;\n+import com.synopsys.integration.alert.common.persistence.model.PermissionKey;\n import com.synopsys.integration.alert.common.persistence.util.ConfigurationFieldModelConverter;\n import com.synopsys.integration.alert.common.rest.model.FieldModel;\n import com.synopsys.integration.alert.common.rest.model.FieldValueModel;\n import com.synopsys.integration.alert.common.rest.model.JobFieldModel;\n import com.synopsys.integration.alert.common.rest.model.JobFieldStatuses;\n+import com.synopsys.integration.alert.common.rest.model.ValidationResponseModel;\n+import com.synopsys.integration.alert.common.security.authorization.AuthorizationManager;\n+import com.synopsys.integration.alert.web.common.PKIXErrorResponseFactory;\n import com.synopsys.integration.alert.web.common.descriptor.DescriptorProcessor;\n import com.synopsys.integration.alert.web.common.field.FieldModelProcessor;\n import com.synopsys.integration.exception.IntegrationException;\n+import com.synopsys.integration.rest.exception.IntegrationRestException;\n \n @Component\n-public class JobConfigActions {\n+public class JobConfigActions extends AbstractJobResourceActions {\n     private final Logger logger = LoggerFactory.getLogger(JobConfigActions.class);\n     private final ConfigurationAccessor configurationAccessor;\n     private final FieldModelProcessor fieldModelProcessor;\n     private final DescriptorProcessor descriptorProcessor;\n     private final ConfigurationFieldModelConverter modelConverter;\n     private final GlobalConfigExistsValidator globalConfigExistsValidator;\n+    private final PKIXErrorResponseFactory pkixErrorResponseFactory;\n+    private final DescriptorMap descriptorMap;\n \n     @Autowired\n-    public JobConfigActions(ConfigurationAccessor configurationAccessor, FieldModelProcessor fieldModelProcessor, DescriptorProcessor descriptorProcessor, ConfigurationFieldModelConverter modelConverter,\n-        GlobalConfigExistsValidator globalConfigExistsValidator) {\n+    public JobConfigActions(AuthorizationManager authorizationManager, DescriptorAccessor descriptorAccessor, ConfigurationAccessor configurationAccessor, FieldModelProcessor fieldModelProcessor, DescriptorProcessor descriptorProcessor,\n+        ConfigurationFieldModelConverter modelConverter, GlobalConfigExistsValidator globalConfigExistsValidator, PKIXErrorResponseFactory pkixErrorResponseFactory, DescriptorMap descriptorMap) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "21256a169e148361ee2907b34c3c351b652ff130"}, "originalPosition": 57}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg3MDc4NTMx", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1162#pullrequestreview-487078531", "createdAt": "2020-09-11T19:44:19Z", "commit": {"oid": "21256a169e148361ee2907b34c3c351b652ff130"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "78f99f7ec4c1a733ce88c250aaa8aaae76906aea", "author": {"user": {"login": "psantos1113", "name": null}}, "url": "https://github.com/blackducksoftware/blackduck-alert/commit/78f99f7ec4c1a733ce88c250aaa8aaae76906aea", "committedDate": "2020-09-14T11:50:14Z", "message": "refactor: Implement latest PR feedback."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg3ODg2OTcx", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1162#pullrequestreview-487886971", "createdAt": "2020-09-14T15:24:47Z", "commit": {"oid": "78f99f7ec4c1a733ce88c250aaa8aaae76906aea"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3461, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}