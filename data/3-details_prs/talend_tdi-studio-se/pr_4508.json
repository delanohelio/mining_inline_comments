{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg0NTc0MDAz", "number": 4508, "title": "feat(TUP-16546)Prompt users for new password in Studio Connection when", "bodyText": "AD/LDAP credentials change in TAC\nhttps://jira.talendforge.org/browse/TUP-16546\nWhat is the current behavior? (You can also link to an open issue here)\nWhat is the new behavior?\nPlease check if the PR fulfills these requirements\n\n The commit message follows Talend standard\n Tests for the changes have been added (for bug fixes / features)\n Docs have been added / updated (for bug fixes / features) ?\n The code coverage on new code >75%\n The new code does not introduce new technical issues (sonar / eslint)\n\nWhat kind of change does this PR introduce?\n\n Bugfix\n Feature\n Code style update (formatting, local variables)\n Refactoring (no functional changes, no api changes)\n Build / CI related changes\n Other... Please describe:\n\nDoes this PR introduce a breaking change?\n\n Yes\n No\n\nIf this PR contains a breaking change, please describe the impact and migration path for existing applications: ...\nOther information:", "createdAt": "2020-03-06T00:44:25Z", "url": "https://github.com/Talend/tdi-studio-se/pull/4508", "merged": true, "mergeCommit": {"oid": "671ea38f4e9a78f7ccebacfa0551edc3891995ac"}, "closed": true, "closedAt": "2020-03-27T12:22:26Z", "author": {"login": "jding-tlnd"}, "timelineItems": {"totalCount": 15, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcK1D8WAH2gAyMzg0NTc0MDAzOjI5YTQxYmViMWFjMzVlODc2Zjc1YmIxN2FhZWVlMWE0YzM2ZmI4OWY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcRvwxIAFqTM4MjgwODM0Mw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "29a41beb1ac35e876f75bb17aaeee1a4c36fb89f", "author": {"user": {"login": "jding-tlnd", "name": "Jane Ding"}}, "url": "https://github.com/Talend/tdi-studio-se/commit/29a41beb1ac35e876f75bb17aaeee1a4c36fb89f", "committedDate": "2020-03-06T00:34:36Z", "message": "feat(TUP-16546)Prompt users for new password in Studio Connection when\nAD/LDAP credentials change in TAC\nhttps://jira.talendforge.org/browse/TUP-16546"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7abeb6c443ef3810e4e1fa763f752f11907d6986", "author": {"user": {"login": "jding-tlnd", "name": "Jane Ding"}}, "url": "https://github.com/Talend/tdi-studio-se/commit/7abeb6c443ef3810e4e1fa763f752f11907d6986", "committedDate": "2020-03-08T18:44:40Z", "message": "feat(TUP-16546)Prompt users for new password in Studio Connection when\nAD/LDAP credentials change in TAC\nhttps://jira.talendforge.org/browse/TUP-16546"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a2e5409ef03b1506f69896cbe85af409344c16c4", "author": {"user": {"login": "jding-tlnd", "name": "Jane Ding"}}, "url": "https://github.com/Talend/tdi-studio-se/commit/a2e5409ef03b1506f69896cbe85af409344c16c4", "committedDate": "2020-03-10T00:54:19Z", "message": "feat(TUP-16546)Prompt users for new password in Studio Connection when\nAD/LDAP credentials change in TAC\nhttps://jira.talendforge.org/browse/TUP-16546"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcxNjM5NTkw", "url": "https://github.com/Talend/tdi-studio-se/pull/4508#pullrequestreview-371639590", "createdAt": "2020-03-10T02:11:46Z", "commit": {"oid": "a2e5409ef03b1506f69896cbe85af409344c16c4"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMFQwMjoxMTo0NlrOFz_P8g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMFQwMjoxMTo0NlrOFz_P8g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDA1Nzk3MA==", "bodyText": "The ConnectionBean.equals can't work ?", "url": "https://github.com/Talend/tdi-studio-se/pull/4508#discussion_r390057970", "createdAt": "2020-03-10T02:11:46Z", "author": {"login": "wchen-talend"}, "path": "main/plugins/org.talend.repository/src/main/java/org/talend/repository/ui/login/connections/ConnectionsListComposite.java", "diffHunk": "@@ -236,13 +240,39 @@ public void handle(LineSelectionEvent e) {\n         });\n \n         if (!list.isEmpty()) {\n+            ConnectionBean selectConnection = null;\n+            ConnectionBean defaultConnectionSelected = dialog.getDefaultConnectionSelected();\n             for (int i = 0; i < list.size(); i++) {\n-                setSelectedConnection(list.get(i));\n+                ConnectionBean connectionBean = list.get(i);\n+                setSelectedConnection(connectionBean);\n+                if (isTheSameConnection(connectionBean, defaultConnectionSelected)) {\n+                    selectConnection = connectionBean;\n+                }\n+            }\n+            if (selectConnection != null) {\n+                table.getTableViewerCreator().getTableViewer()\n+                        .setSelection(new StructuredSelection(new Object[] { selectConnection }));\n+            } else {\n+                table.getTableViewerCreator().getTableViewer()\n+                        .setSelection(new StructuredSelection(new Object[] { list.get(0) }));\n             }\n-            setSelectedConnection(list.get(0));\n         }\n     }\n \n+    private boolean isTheSameConnection(ConnectionBean baseConnection, ConnectionBean refConnection) {\n+        boolean flag = false;\n+        if (baseConnection == null || refConnection == null) {\n+            return flag;\n+        }\n+        if (baseConnection.getName().equals(refConnection.getName())\n+                && baseConnection.getUrl().equals(refConnection.getUrl())\n+                && baseConnection.getRepositoryId().equals(refConnection.getRepositoryId())\n+                && baseConnection.getUser().equals(refConnection.getUser())) {\n+            flag = true;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a2e5409ef03b1506f69896cbe85af409344c16c4"}, "originalPosition": 63}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcxODExNjk2", "url": "https://github.com/Talend/tdi-studio-se/pull/4508#pullrequestreview-371811696", "createdAt": "2020-03-10T09:57:13Z", "commit": {"oid": "a2e5409ef03b1506f69896cbe85af409344c16c4"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMFQxMDowMzoxMlrOF0IShg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMFQxMDoyNjo1MVrOF0JE4g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDIwNjA4Ng==", "bodyText": "It's not good to check the exception type through the error message, please try to use some generic method, such as creating some exceptions like business exception or rest exception, so that we can check the error code dirrectly", "url": "https://github.com/Talend/tdi-studio-se/pull/4508#discussion_r390206086", "createdAt": "2020-03-10T10:03:12Z", "author": {"login": "cmeng-talend"}, "path": "main/plugins/org.talend.repository/src/main/java/org/talend/repository/ui/login/LoginHelper.java", "diffHunk": "@@ -626,6 +639,10 @@ public void run() {\n         return true;\r\n     }\r\n \r\n+    public static boolean isAuthorizationException(Throwable exception) {\r\n+        return exception.getMessage() != null && exception.getMessage().startsWith(\"401\");\r", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a2e5409ef03b1506f69896cbe85af409344c16c4"}, "originalPosition": 42}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDIxODk3OA==", "bodyText": "not sure whether we should consider the case that the auth message in the auth exception is empty", "url": "https://github.com/Talend/tdi-studio-se/pull/4508#discussion_r390218978", "createdAt": "2020-03-10T10:26:51Z", "author": {"login": "cmeng-talend"}, "path": "main/plugins/org.talend.repository/src/main/java/org/talend/repository/ui/login/AbstractLoginActionPage.java", "diffHunk": "@@ -351,5 +355,17 @@ public boolean hasError() {\n             return hasError;\r\n         }\r\n \r\n+        public String getAuthExceptionMessage() {\r\n+            return authExceptionMessage;\r\n+        }\r\n+\r\n+        public void setAuthExceptionMessage(String authExceptionMessage) {\r\n+            this.authExceptionMessage = authExceptionMessage;\r\n+        }\r\n+\r\n+        public boolean hasAuthException() {\r\n+            return StringUtils.isNotBlank(authExceptionMessage);\r", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a2e5409ef03b1506f69896cbe85af409344c16c4"}, "originalPosition": 38}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "24887474cec67716316dfea5321d1a05425f1448", "author": {"user": {"login": "jding-tlnd", "name": "Jane Ding"}}, "url": "https://github.com/Talend/tdi-studio-se/commit/24887474cec67716316dfea5321d1a05425f1448", "committedDate": "2020-03-11T17:15:29Z", "message": "feat(TUP-16546)Prompt users for new password in Studio Connection when\nAD/LDAP credentials change in TAC\nhttps://jira.talendforge.org/browse/TUP-16546"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzczMjY4Mjkx", "url": "https://github.com/Talend/tdi-studio-se/pull/4508#pullrequestreview-373268291", "createdAt": "2020-03-12T04:13:28Z", "commit": {"oid": "24887474cec67716316dfea5321d1a05425f1448"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2ee2c84714ffc3870a174903f2ad0a68139e1751", "author": {"user": {"login": "jding-tlnd", "name": "Jane Ding"}}, "url": "https://github.com/Talend/tdi-studio-se/commit/2ee2c84714ffc3870a174903f2ad0a68139e1751", "committedDate": "2020-03-17T00:29:06Z", "message": "feat(TUP-16546)Prompt users for new password in Studio Connection when\nAD or LDAP credentials change in TAC\nhttps://jira.talendforge.org/browse/TUP-16546"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1f58f9df50549023abcdc6b615185d0b26cc71ba", "author": {"user": {"login": "jding-tlnd", "name": "Jane Ding"}}, "url": "https://github.com/Talend/tdi-studio-se/commit/1f58f9df50549023abcdc6b615185d0b26cc71ba", "committedDate": "2020-03-17T15:09:11Z", "message": "feat(TUP-16546)Prompt users for new password in Studio Connection when\nAD/LDAP credentials change in TAC\nhttps://jira.talendforge.org/browse/TUP-16546"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "55e28d2b9f9b148272dcc9777e980e073e9e5724", "author": {"user": {"login": "jding-tlnd", "name": "Jane Ding"}}, "url": "https://github.com/Talend/tdi-studio-se/commit/55e28d2b9f9b148272dcc9777e980e073e9e5724", "committedDate": "2020-03-18T09:57:47Z", "message": "feat(TUP-16546)Prompt users for new password in Studio Connection when\nAD/LDAP credentials change in TAC\nhttps://jira.talendforge.org/browse/TUP-16546"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4ea47d490ea2ec4ece8f1e7ec08c3f14dcd25a20", "author": {"user": {"login": "jding-tlnd", "name": "Jane Ding"}}, "url": "https://github.com/Talend/tdi-studio-se/commit/4ea47d490ea2ec4ece8f1e7ec08c3f14dcd25a20", "committedDate": "2020-03-27T01:03:53Z", "message": "feat(TUP-16546):Prompt users for new password in Studio Connection when\nAD or LDAP credentials change in TAC\nhttps://jira.talendforge.org/browse/TUP-16546"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "179d26cbc528836c535faf8a2386e8c81f8feb8c", "author": {"user": {"login": "jding-tlnd", "name": "Jane Ding"}}, "url": "https://github.com/Talend/tdi-studio-se/commit/179d26cbc528836c535faf8a2386e8c81f8feb8c", "committedDate": "2020-03-27T07:08:00Z", "message": "Merge remote-tracking branch 'origin/master' into jding/TUP-16546_prompt_user_for_connection_credentials_change"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgyNjQwODA3", "url": "https://github.com/Talend/tdi-studio-se/pull/4508#pullrequestreview-382640807", "createdAt": "2020-03-27T07:56:09Z", "commit": {"oid": "179d26cbc528836c535faf8a2386e8c81f8feb8c"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f10a964a73a5090b3d9aa7de9d686abdf81d6cfe", "author": {"user": {"login": "jding-tlnd", "name": "Jane Ding"}}, "url": "https://github.com/Talend/tdi-studio-se/commit/f10a964a73a5090b3d9aa7de9d686abdf81d6cfe", "committedDate": "2020-03-27T11:56:32Z", "message": "feat(TUP-16546):Prompt users for new password in Studio Connection when\nAD/LDAP credentials change in TAC\nhttps://jira.talendforge.org/browse/TUP-16546"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgyODA4MzQz", "url": "https://github.com/Talend/tdi-studio-se/pull/4508#pullrequestreview-382808343", "createdAt": "2020-03-27T12:21:36Z", "commit": {"oid": "f10a964a73a5090b3d9aa7de9d686abdf81d6cfe"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4636, "cost": 1, "resetAt": "2021-11-02T12:20:56Z"}}}