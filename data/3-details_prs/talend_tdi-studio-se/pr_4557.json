{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzkzNDQzNTA4", "number": 4557, "title": "fix(TDI-43785) - big query repeated value managed", "bodyText": "What is the current behavior? (You can also link to an open issue here)\ncan't manage multi value field\nWhat is the new behavior?\ncan do this\n(this a report of TDI-43785 on maintenance 1.3)\nPlease check if the PR fulfills these requirements\n\n The commit message follows Talend standard\n Tests for the changes have been added (for bug fixes / features)\n Docs have been added / updated (for bug fixes / features) ?\n The code coverage on new code >75%\n The new code does not introduce new technical issues (sonar / eslint)\n\nWhat kind of change does this PR introduce?\n\n Bugfix\n Feature\n Code style update (formatting, local variables)\n Refactoring (no functional changes, no api changes)\n Build / CI related changes\n Other... Please describe:\n\nDoes this PR introduce a breaking change?\n\n Yes\n No\n\nIf this PR contains a breaking change, please describe the impact and migration path for existing applications: ...\nOther information:", "createdAt": "2020-03-25T08:10:30Z", "url": "https://github.com/Talend/tdi-studio-se/pull/4557", "merged": true, "mergeCommit": {"oid": "7ab0f2015adccbd5ecf8f0eaa94680fe444306da"}, "closed": true, "closedAt": "2020-03-25T08:29:58Z", "author": {"login": "clesaec"}, "timelineItems": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcRCm1EgH2gAyMzkzNDQzNTA4OjNkNzc0NDJlZTY3NGQxOTRkODlkNjU1MzZlNTgwNWZmZDU4YTE3OTI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcRDOLoAFqTM4MDkzNjIxNA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "3d77442ee674d194d89d65536e5805ffd58a1792", "author": {"user": {"login": "clesaec", "name": null}}, "url": "https://github.com/Talend/tdi-studio-se/commit/3d77442ee674d194d89d65536e5805ffd58a1792", "committedDate": "2020-03-25T07:45:01Z", "message": "fix(TDI-43785) - big query repeated value managed"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgwOTM2MjE0", "url": "https://github.com/Talend/tdi-studio-se/pull/4557#pullrequestreview-380936214", "createdAt": "2020-03-25T08:26:27Z", "commit": {"oid": "3d77442ee674d194d89d65536e5805ffd58a1792"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQwODoyNjoyN1rOF7QTSw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQwODoyNzoxNFrOF7QU6A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzY3NzM4Nw==", "bodyText": "indentation", "url": "https://github.com/Talend/tdi-studio-se/pull/4557#discussion_r397677387", "createdAt": "2020-03-25T08:26:27Z", "author": {"login": "undx"}, "path": "main/plugins/org.talend.designer.components.localprovider/components/tBigQueryInput/tBigQueryInput_begin.javajet", "diffHunk": "@@ -395,13 +395,18 @@\n \t\t\t    int colsLen_<%=cid %> = schema_<%=cid%>.getFields().size();\n \t\t\t    for (int i = <%=dynamic_index-1%>; i < colsLen_<%=cid %>-<%=columnList.size()-dynamic_index%>; i++) {\n \t\t\t    \troutines.system.DynamicMetadata dynamicMetadata_<%=cid%> = new routines.system.DynamicMetadata();\n-\t\t\t    \tdynamicMetadata_<%=cid%>.setName(schema_<%=cid%>.getFields().get(i).getName());\n+\t\t\t    \tcom.google.cloud.bigquery.Field field_<%=cid%> = schema_<%=cid%>.getFields().get(i);\n+\t\t\t    \tdynamicMetadata_<%=cid%>.setName(field_<%=cid%>.getName());\n \t\t\t    \tdynamicMetadata_<%=cid%>.setDbName(dynamicMetadata_<%=cid%>.getName());\n-\t\t\t    \tcom.google.cloud.bigquery.StandardSQLTypeName typeName_<%=cid%> = schema_<%=cid%>.getFields().get(i).getType().getStandardType();\n-\t\t\t    \tString typeNameString_<%=cid%> = (typeName_<%=cid%> != null) ? typeName_<%=cid%>.name() : schema_<%=cid%>.getFields().get(i).getType().name();\n+\t\t\t    \tcom.google.cloud.bigquery.StandardSQLTypeName typeName_<%=cid%> = field_<%=cid%>.getType().getStandardType();\n+\t\t\t    \tString typeNameString_<%=cid%> = (typeName_<%=cid%> != null) ? typeName_<%=cid%>.name() : field_<%=cid%>.getType().name();\n+\t\t\t    \tif (field_<%=cid%>.getMode() == com.google.cloud.bigquery.Field.Mode.REPEATED) { // list of values.\n+                \t\ttypeNameString_<%=cid%> = \"ARRAY\";\n+\t\t\t\t\t}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3d77442ee674d194d89d65536e5805ffd58a1792"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzY3NzgwMA==", "bodyText": "same", "url": "https://github.com/Talend/tdi-studio-se/pull/4557#discussion_r397677800", "createdAt": "2020-03-25T08:27:14Z", "author": {"login": "undx"}, "path": "main/plugins/org.talend.designer.components.localprovider/components/templates/DB/Input/BigQuery/BigQueryHelper_ServiceAccount.javajet", "diffHunk": "@@ -17,7 +17,14 @@ class BigQueryHelper_<%=cid%> {\n \t\t\t\tcolumn.addColumnValue(null);\n \t\t\t\tcontinue;\n \t\t\t}\n-\t\t\tif (\"id_String\".equals(dcm.getType())) {\n+\t\t\tif (\"id_List\".equals(dcm.getType())) {\n+\t\t\t\tjava.util.List<com.google.cloud.bigquery.FieldValue> bigQueryValues = rs.get(colNum).getRepeatedValue();\n+\t\t\t\tjava.util.List<Object> values = bigQueryValues.stream()\n+\t\t\t\t                                              .map(com.google.cloud.bigquery.FieldValue::getValue)\n+\t\t\t\t                                              .collect(java.util.stream.Collectors.toList());\n+\t\t\t\tcolumn.addColumnValue(values);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3d77442ee674d194d89d65536e5805ffd58a1792"}, "originalPosition": 10}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4617, "cost": 1, "resetAt": "2021-11-02T12:20:56Z"}}}