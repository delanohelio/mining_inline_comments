{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDczMTUyMTY0", "number": 5132, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNVQxNzoyNzo1NFrOEcLCDg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNVQxNzoyNzo1NFrOEcLCDg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk3OTc2MzM0OnYy", "diffSide": "RIGHT", "path": "main/plugins/org.talend.designer.components.libs/libs_src/talendExcel/src/main/java/org/talend/ExcelTool.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNVQxNzoyNzo1NFrOHGig5w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNVQxNzo0OTo0OVrOHGjScg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjYxODk4Mw==", "bodyText": "IMO plain old Incorrect password would be better", "url": "https://github.com/Talend/tdi-studio-se/pull/5132#discussion_r476618983", "createdAt": "2020-08-25T17:27:54Z", "author": {"login": "dmytro-sylaiev"}, "path": "main/plugins/org.talend.designer.components.libs/libs_src/talendExcel/src/main/java/org/talend/ExcelTool.java", "diffHunk": "@@ -185,10 +191,27 @@ public int getStartRow() {\n     }\r\n \r\n     private void initPreXlsx(String fileName) throws Exception {\r\n-        InputStream preIns = new FileInputStream(fileName);\r\n-        preWb = WorkbookFactory.create(preIns);\r\n+        if(password == null) {\r\n+            InputStream preIns = new FileInputStream(fileName);\r\n+            preWb = WorkbookFactory.create(preIns);\r\n+        } else {\r\n+            preWb = readEncryptedFile(fileName);\r\n+        }\r\n         preSheet = preWb.getSheet(sheetName);\r\n     }\r\n+    \r\n+    private Workbook readEncryptedFile(String fileName)\r\n+            throws IOException, GeneralSecurityException {\r\n+        InputStream inp = new FileInputStream(fileName);\r\n+        POIFSFileSystem fs = new POIFSFileSystem(inp);\r\n+        EncryptionInfo info = new EncryptionInfo(fs);\r\n+        Decryptor decryptor = Decryptor.getInstance(info);\r\n+        if (!decryptor.verifyPassword(password)) {\r\n+            throw new GeneralSecurityException(\"Error: Wrong password provided!\");\r", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ca1394890dc637f0ebcec7c4d9979569b9a78a64"}, "originalPosition": 53}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjYzMTY2Ng==", "bodyText": "Done.", "url": "https://github.com/Talend/tdi-studio-se/pull/5132#discussion_r476631666", "createdAt": "2020-08-25T17:49:49Z", "author": {"login": "dmytrogrygorenko"}, "path": "main/plugins/org.talend.designer.components.libs/libs_src/talendExcel/src/main/java/org/talend/ExcelTool.java", "diffHunk": "@@ -185,10 +191,27 @@ public int getStartRow() {\n     }\r\n \r\n     private void initPreXlsx(String fileName) throws Exception {\r\n-        InputStream preIns = new FileInputStream(fileName);\r\n-        preWb = WorkbookFactory.create(preIns);\r\n+        if(password == null) {\r\n+            InputStream preIns = new FileInputStream(fileName);\r\n+            preWb = WorkbookFactory.create(preIns);\r\n+        } else {\r\n+            preWb = readEncryptedFile(fileName);\r\n+        }\r\n         preSheet = preWb.getSheet(sheetName);\r\n     }\r\n+    \r\n+    private Workbook readEncryptedFile(String fileName)\r\n+            throws IOException, GeneralSecurityException {\r\n+        InputStream inp = new FileInputStream(fileName);\r\n+        POIFSFileSystem fs = new POIFSFileSystem(inp);\r\n+        EncryptionInfo info = new EncryptionInfo(fs);\r\n+        Decryptor decryptor = Decryptor.getInstance(info);\r\n+        if (!decryptor.verifyPassword(password)) {\r\n+            throw new GeneralSecurityException(\"Error: Wrong password provided!\");\r", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjYxODk4Mw=="}, "originalCommit": {"oid": "ca1394890dc637f0ebcec7c4d9979569b9a78a64"}, "originalPosition": 53}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4673, "cost": 1, "resetAt": "2021-11-13T14:23:39Z"}}}