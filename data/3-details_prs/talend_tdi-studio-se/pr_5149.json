{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDc1NDcwMDI4", "number": 5149, "title": "fix(TBD-10885): refacto date and timestamp handling with dataset", "bodyText": "What is the current behavior? (You can also link to an open issue here)\nWhat is the new behavior?\nPlease check if the PR fulfills these requirements\n\n The commit message follows Talend standard\n Tests for the changes have been added (for bug fixes / features)\n Docs have been added / updated (for bug fixes / features) ?\n The code coverage on new code >75%\n The new code does not introduce new technical issues (sonar / eslint)\n\nWhat kind of change does this PR introduce?\n\n Bugfix\n Feature\n Code style update (formatting, local variables)\n Refactoring (no functional changes, no api changes)\n Build / CI related changes\n Other... Please describe:\n\nDoes this PR introduce a breaking change?\n\n Yes\n No\n\nIf this PR contains a breaking change, please describe the impact and migration path for existing applications: ...\nOther information:", "createdAt": "2020-08-28T15:23:30Z", "url": "https://github.com/Talend/tdi-studio-se/pull/5149", "merged": true, "mergeCommit": {"oid": "176e3489ce84dbae13f61b9abd6afb300fe60f14"}, "closed": true, "closedAt": "2020-09-10T12:48:46Z", "author": {"login": "AlixMetivier"}, "timelineItems": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdDWpypAH2gAyNDc1NDcwMDI4OmJhMTY0NWZiZTZhYTU2OTFjNTllZjhlMzE2ZjA5ZjBmNjhlOTAwYjU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdHLoItAFqTQ4NDk2NzkxOQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "ba1645fbe6aa5691c59ef8e316f09f0f68e900b5", "author": {"user": {"login": "AlixMetivier", "name": null}}, "url": "https://github.com/Talend/tdi-studio-se/commit/ba1645fbe6aa5691c59ef8e316f09f0f68e900b5", "committedDate": "2020-08-28T15:22:34Z", "message": "fix(TBD-10885): refacto date and timestamp handling with dataset"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7973b65cb39c0c0868b87d4633a13c62ffc57f39", "author": {"user": {"login": "AlixMetivier", "name": null}}, "url": "https://github.com/Talend/tdi-studio-se/commit/7973b65cb39c0c0868b87d4633a13c62ffc57f39", "committedDate": "2020-09-07T11:24:46Z", "message": "Merge branch 'maintenance/7.3' of https://github.com/Talend/tdi-studio-se into fix/TBD-10885b"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg0OTY3OTE5", "url": "https://github.com/Talend/tdi-studio-se/pull/5149#pullrequestreview-484967919", "createdAt": "2020-09-09T12:44:25Z", "commit": {"oid": "7973b65cb39c0c0868b87d4633a13c62ffc57f39"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOVQxMjo0NDoyNVrOHPFgJg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOVQxMjo0NDoyNVrOHPFgJg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTU4MDgzOA==", "bodyText": "Is there a special reason to be on the 2020-01-19 for this new migration task", "url": "https://github.com/Talend/tdi-studio-se/pull/5149#discussion_r485580838", "createdAt": "2020-09-09T12:44:25Z", "author": {"login": "lbourgeois"}, "path": "main/plugins/org.talend.repository/src/main/java/org/talend/repository/model/migration/spark/SetGlobalTimestampOptionForPreviousVersions.java", "diffHunk": "@@ -0,0 +1,140 @@\n+// ============================================================================\n+//\n+// Copyright (C) 2006-2019 Talend Inc. - www.talend.com\n+//\n+// This source code is available under agreement available at\n+// %InstallDIR%\\features\\org.talend.rcp.branding.%PRODUCTNAME%\\%PRODUCTNAME%license.txt\n+//\n+// You should have received a copy of the agreement\n+// along with this program; if not, write to Talend SA\n+// 9 rue Pages 92150 Suresnes, France\n+//\n+// ============================================================================\n+package org.talend.repository.model.migration.spark;\n+\n+import java.util.Arrays;\n+import java.util.Date;\n+import java.util.GregorianCalendar;\n+import java.util.List;\n+\n+import org.talend.commons.exception.ExceptionHandler;\n+import org.talend.commons.exception.PersistenceException;\n+import org.talend.core.model.components.ComponentUtilities;\n+import org.talend.core.model.components.ModifyComponentsAction;\n+import org.talend.core.model.components.conversions.IComponentConversion;\n+import org.talend.core.model.components.filters.NameComponentFilter;\n+import org.talend.core.model.migration.AbstractJobMigrationTask;\n+import org.talend.core.model.properties.Item;\n+import org.talend.core.model.repository.ERepositoryObjectType;\n+import org.talend.core.repository.model.ProxyRepositoryFactory;\n+import org.talend.designer.core.model.utils.emf.talendfile.ColumnType;\n+import org.talend.designer.core.model.utils.emf.talendfile.ElementParameterType;\n+import org.talend.designer.core.model.utils.emf.talendfile.MetadataType;\n+import org.talend.designer.core.model.utils.emf.talendfile.NodeType;\n+import org.talend.designer.core.model.utils.emf.talendfile.ProcessType;\n+import org.talend.designer.core.model.utils.emf.talendfile.TalendFileFactory;\n+import org.talend.designer.core.model.utils.emf.talendfile.impl.ElementParameterTypeImpl;\n+import org.talend.designer.core.model.utils.emf.talendfile.impl.NodeTypeImpl;\n+\n+/**\n+ *\n+ * @author ametivier\n+ *\n+ * to keep retrocompatibility in dataset component that used timestamp by default (studio 7.0) or if \n+ * they specified to use timestamp or date via an option (7.1 & 7.2), we need to add a global boolean value if all components\n+ * used timestamp, else we need to update the schema's pattern according to the value of the checkbox if it exists, \n+ * or timestamp since it was the previous default value\n+ * \n+ * note that in case the pattern is updated and the schema was repo, then the schema must be changed to built in when\n+ * opening the job to keep updated value (this case only happens if theres a conflict in Date / Timestamp in different nodes\n+ * of a job, which should be rare because it lead to a GUI error)\n+ *\n+ */\n+public class SetGlobalTimestampOptionForPreviousVersions extends AbstractJobMigrationTask {\n+\n+\tprivate static final List<String> IMPACTED_COMPONENTS =\n+            Arrays.asList(\"tFileOutputParquet\", \"tHiveOutput\", \"tRedshiftOutput\", \"tSqlRow\", \"tMatchPairing\",\n+                    \"tMatchPredict\", \"tMatchModel\", \"tDataShuffling\", \"tFileInputParquet\", \"tHiveInput\",\n+                    \"tDeltaLakeInput\", \"tDeltaLakeOutput\");\n+    \n+    private String TIMESTAMP_OPTION = \"USE_TIMESTAMP_FOR_DATASET\"; //$NON-NLS-1$\n+    \n+    private String CHECKBOX_TIMESTAMP_NODE = \"DATE_TO_TIMESTAMP_DF_TYPE_SUBSTITUTION\"; //$NON-NLS-1$\n+    \n+    @Override\n+    public Date getOrder() {\n+        GregorianCalendar gc = new GregorianCalendar(2020, 01, 19, 10, 0, 0);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7973b65cb39c0c0868b87d4633a13c62ffc57f39"}, "originalPosition": 66}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4668, "cost": 1, "resetAt": "2021-11-02T12:20:56Z"}}}