{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTA2NjgyNjI0", "number": 5399, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMFQxMjozNjozNlrOEvwPrA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMFQxMjozNjozNlrOEvwPrA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE4NTA4OTcyOnYy", "diffSide": "RIGHT", "path": "main/plugins/org.talend.designer.components.localprovider/components/tFileInputMail/tFileInputMail_MIME.javajet", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMFQxMjozNjozNlrOHk6JGA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMFQxMzowNzoyNlrOHk7cvQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODQ2MzM4NA==", "bodyText": "I see it's an extra operation to flush each write operation, since BufferedOutputStream does its own flushBuffer() + it is flushing on close().", "url": "https://github.com/Talend/tdi-studio-se/pull/5399#discussion_r508463384", "createdAt": "2020-10-20T12:36:36Z", "author": {"login": "mbasiuk-talend"}, "path": "main/plugins/org.talend.designer.components.localprovider/components/tFileInputMail/tFileInputMail_MIME.javajet", "diffHunk": "@@ -222,19 +222,18 @@\n                         }\n                         path = path + attachFileName;\n                         <% if(isLog4jEnabled){ %>\n-                                log.info(\"<%= cid %> - Extracted attachment: '\" + attachFileName + \"'.\");\n+                                log.info(\"<%= cid %> - Extracting attachment: '\" + attachFileName + \"'.\");\n                         <% } %>\n-\n                         java.io.File attachFile = new java.io.File(path);\n-                        java.io.BufferedOutputStream out = new java.io.BufferedOutputStream(new java.io.FileOutputStream(attachFile));\n-                        java.io.BufferedInputStream in = new java.io.BufferedInputStream(mpart.getInputStream());\n-                        int buffer = 0;\n-                        while ((buffer = in.read()) != -1) {\n-                            out.write(buffer);\n-                            out.flush();\n+                        try (java.io.BufferedOutputStream out = new java.io.BufferedOutputStream(new java.io.FileOutputStream(attachFile));\n+                            java.io.BufferedInputStream in = new java.io.BufferedInputStream(mpart.getInputStream())){\n+                            byte[] buffer = new byte[8192];\n+                            int bytesRead = 0;\n+                            while ((bytesRead = in.read(buffer)) > 0) {\n+                                out.write(buffer, 0, bytesRead);\n+                                out.flush();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4ec87a8dbb106a509244e51054798e10bac982aa"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODQ2MzU5Mw==", "bodyText": "You may get it out from while loop.", "url": "https://github.com/Talend/tdi-studio-se/pull/5399#discussion_r508463593", "createdAt": "2020-10-20T12:36:56Z", "author": {"login": "mbasiuk-talend"}, "path": "main/plugins/org.talend.designer.components.localprovider/components/tFileInputMail/tFileInputMail_MIME.javajet", "diffHunk": "@@ -222,19 +222,18 @@\n                         }\n                         path = path + attachFileName;\n                         <% if(isLog4jEnabled){ %>\n-                                log.info(\"<%= cid %> - Extracted attachment: '\" + attachFileName + \"'.\");\n+                                log.info(\"<%= cid %> - Extracting attachment: '\" + attachFileName + \"'.\");\n                         <% } %>\n-\n                         java.io.File attachFile = new java.io.File(path);\n-                        java.io.BufferedOutputStream out = new java.io.BufferedOutputStream(new java.io.FileOutputStream(attachFile));\n-                        java.io.BufferedInputStream in = new java.io.BufferedInputStream(mpart.getInputStream());\n-                        int buffer = 0;\n-                        while ((buffer = in.read()) != -1) {\n-                            out.write(buffer);\n-                            out.flush();\n+                        try (java.io.BufferedOutputStream out = new java.io.BufferedOutputStream(new java.io.FileOutputStream(attachFile));\n+                            java.io.BufferedInputStream in = new java.io.BufferedInputStream(mpart.getInputStream())){\n+                            byte[] buffer = new byte[8192];\n+                            int bytesRead = 0;\n+                            while ((bytesRead = in.read(buffer)) > 0) {\n+                                out.write(buffer, 0, bytesRead);\n+                                out.flush();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODQ2MzM4NA=="}, "originalCommit": {"oid": "4ec87a8dbb106a509244e51054798e10bac982aa"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODQ4NDc5Nw==", "bodyText": "Fixed - moved flush() out of cycle.", "url": "https://github.com/Talend/tdi-studio-se/pull/5399#discussion_r508484797", "createdAt": "2020-10-20T13:07:26Z", "author": {"login": "dmytrogrygorenko"}, "path": "main/plugins/org.talend.designer.components.localprovider/components/tFileInputMail/tFileInputMail_MIME.javajet", "diffHunk": "@@ -222,19 +222,18 @@\n                         }\n                         path = path + attachFileName;\n                         <% if(isLog4jEnabled){ %>\n-                                log.info(\"<%= cid %> - Extracted attachment: '\" + attachFileName + \"'.\");\n+                                log.info(\"<%= cid %> - Extracting attachment: '\" + attachFileName + \"'.\");\n                         <% } %>\n-\n                         java.io.File attachFile = new java.io.File(path);\n-                        java.io.BufferedOutputStream out = new java.io.BufferedOutputStream(new java.io.FileOutputStream(attachFile));\n-                        java.io.BufferedInputStream in = new java.io.BufferedInputStream(mpart.getInputStream());\n-                        int buffer = 0;\n-                        while ((buffer = in.read()) != -1) {\n-                            out.write(buffer);\n-                            out.flush();\n+                        try (java.io.BufferedOutputStream out = new java.io.BufferedOutputStream(new java.io.FileOutputStream(attachFile));\n+                            java.io.BufferedInputStream in = new java.io.BufferedInputStream(mpart.getInputStream())){\n+                            byte[] buffer = new byte[8192];\n+                            int bytesRead = 0;\n+                            while ((bytesRead = in.read(buffer)) > 0) {\n+                                out.write(buffer, 0, bytesRead);\n+                                out.flush();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODQ2MzM4NA=="}, "originalCommit": {"oid": "4ec87a8dbb106a509244e51054798e10bac982aa"}, "originalPosition": 21}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4641, "cost": 1, "resetAt": "2021-11-13T14:23:39Z"}}}