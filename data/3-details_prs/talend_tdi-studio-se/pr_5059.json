{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY1ODIzMDY0", "number": 5059, "title": "feat(TDI-44630):support amazon EMR HA.", "bodyText": "What is the current behavior? (You can also link to an open issue here)\nhttps://jira.talendforge.org/browse/TDI-44630\nWhat is the new behavior?\nPlease check if the PR fulfills these requirements\n\n The commit message follows Talend standard\n Tests for the changes have been added (for bug fixes / features)\n Docs have been added / updated (for bug fixes / features) ?\n The code coverage on new code >75%\n The new code does not introduce new technical issues (sonar / eslint)\n\nWhat kind of change does this PR introduce?\n\n Bugfix\n Feature\n Code style update (formatting, local variables)\n Refactoring (no functional changes, no api changes)\n Build / CI related changes\n Other... Please describe:\n\nDoes this PR introduce a breaking change?\n\n Yes\n No\n\nIf this PR contains a breaking change, please describe the impact and migration path for existing applications: ...\nOther information:", "createdAt": "2020-08-11T02:19:12Z", "url": "https://github.com/Talend/tdi-studio-se/pull/5059", "merged": true, "mergeCommit": {"oid": "fb83719828230a5e64d66dea92f915b17d3e17f3"}, "closed": true, "closedAt": "2020-08-14T07:55:58Z", "author": {"login": "vyu-talend"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc9tI1_gH2gAyNDY1ODIzMDY0OjgxMjBmNTAzZDAxZGFlNTJmNzhkMjdhNTNlMTBhNTI0NGE1M2E0ZjM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc9uPHEAFqTQ2NDcyMzc2Ng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "8120f503d01dae52f78d27a53e10a5244a53a4f3", "author": {"user": {"login": "vyu-talend", "name": null}}, "url": "https://github.com/Talend/tdi-studio-se/commit/8120f503d01dae52f78d27a53e10a5244a53a4f3", "committedDate": "2020-08-11T02:10:51Z", "message": "feat(TDI-44630):support amazon EMR HA."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY0NzEzNjc3", "url": "https://github.com/Talend/tdi-studio-se/pull/5059#pullrequestreview-464713677", "createdAt": "2020-08-11T02:51:12Z", "commit": {"oid": "8120f503d01dae52f78d27a53e10a5244a53a4f3"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMVQwMjo1MToxMlrOG-miBg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMVQwMjo1MToxMlrOG-miBg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODI5NjE5OA==", "bodyText": "This error message is too aggressive :(\n\"You\" \"must\" that kind of words are not polite enough.\nA subnet ID should be specified while using multiple master nodes.", "url": "https://github.com/Talend/tdi-studio-se/pull/5059#discussion_r468296198", "createdAt": "2020-08-11T02:51:12Z", "author": {"login": "pyzhou-talend"}, "path": "main/plugins/org.talend.designer.components.localprovider/components/tAmazonEMRManage/tAmazonEMRManage_begin.javajet", "diffHunk": "@@ -246,59 +249,81 @@\n \tif(setApps) {\n \t%>\n \t<%@ include file=\"./app_mapping.javajet\"%>\n-\t<%\n-\t}\n+\t<%}%>\n \t\n+\tjava.util.List<com.amazonaws.services.elasticmapreduce.model.Configuration> configs_<%=cid%> = new java.util.ArrayList<com.amazonaws.services.elasticmapreduce.model.Configuration>();\n+\t<%\n \tMap<String, List<Map<String,String>>> classification2Properties = new HashMap<String, List<Map<String,String>>>();\n-\tif(newApi) {\n-\t\tList<Map<String, String>> property_table = (List<Map<String, String>>)ElementParameterParser.getObjectValue(node, \"__PROPERTY_TABLE__\");\n-\t\tif(property_table!=null) {\n-\t\t\tfor (int i=0; i<property_table.size(); i++) {\n-\t\t\t\tMap<String, String> property = property_table.get(i);\n-\t\t\t\tString classification = property.get(\"CLASSIFICATION\");\n-\t\t\t\t\n-\t\t\t\tList<Map<String,String>> properties = classification2Properties.get(classification);\n-\t\t\t\tif(properties == null) {\n-\t\t\t\t\tproperties = new ArrayList<Map<String,String>>();\n-\t\t\t\t\tclassification2Properties.put(classification, properties);\n+\tString property_json = ElementParameterParser.getValue(node, \"__PROPERTY_JSON__\");\n+\tboolean property_json_validated = property_json != null && !property_json.equals(\"\\\"\\\"\") && property_json.length() > 0;\n+\t%>\n+\tboolean property_json_validated_<%=cid%> = <%=property_json_validated %>;\n+\t<%\n+\tif(!use_multiple_master) {\n+\t\tif(newApi) {\n+\t\t\tList<Map<String, String>> property_table = (List<Map<String, String>>)ElementParameterParser.getObjectValue(node, \"__PROPERTY_TABLE__\");\n+\t\t\tif(property_table!=null) {\n+\t\t\t\tfor (int i=0; i<property_table.size(); i++) {\n+\t\t\t\t\tMap<String, String> property = property_table.get(i);\n+\t\t\t\t\tString classification = property.get(\"CLASSIFICATION\");\n+\t\t\t\t\t\n+\t\t\t\t\tList<Map<String,String>> properties = classification2Properties.get(classification);\n+\t\t\t\t\tif(properties == null) {\n+\t\t\t\t\t\tproperties = new ArrayList<Map<String,String>>();\n+\t\t\t\t\t\tclassification2Properties.put(classification, properties);\n+\t\t\t\t\t}\n+\t\t\t\t\t\n+\t\t\t\t\tproperties.add(property);\n \t\t\t\t}\n \t\t\t\t\n-\t\t\t\tproperties.add(property);\n-\t\t\t}\n-\t\t\t\n-\t\t\tif(!classification2Properties.isEmpty()) {\n-\t\t\t%>\n-\t\t\t\tjava.util.List<com.amazonaws.services.elasticmapreduce.model.Configuration> configs_<%=cid%> = new java.util.ArrayList<com.amazonaws.services.elasticmapreduce.model.Configuration>();\n-\t\t\t\tjava.util.Map<String,String> properties_<%=cid%> = null;\n-\t\t\t\tcom.amazonaws.services.elasticmapreduce.model.Configuration config_<%=cid%> = null;\n-\t\t\t<%\n-\t\t\t}\n-\t\t\t\n-\t\t\tfor(java.util.Map.Entry<String, List<Map<String,String>>> entry : classification2Properties.entrySet()) {\n-\t\t\t\tString classification = entry.getKey();\n-\t\t\t\tList<Map<String,String>> properties = entry.getValue();\n+\t\t\t\tif(!classification2Properties.isEmpty()) {\n \t\t\t\t%>\n-    \t\t\tproperties_<%=cid%> = new java.util.HashMap<String,String>();\n-    \t\t\t\n-    \t\t\t<%\n-    \t\t\tfor(Map<String,String> property : properties) {\n-    \t\t\t%>\n-    \t\t\t\tproperties_<%=cid%>.put(<%=property.get(\"KEY\")%>, <%=property.get(\"VALUE\")%>);\n-    \t\t\t<%\n-    \t\t\t}\n-    \t\t\t%>\n-    \t\t\t\n-            \tconfig_<%=cid%> = new com.amazonaws.services.elasticmapreduce.model.Configuration()\n-                    .withClassification(<%=classification%>)\n-                    .withProperties(properties_<%=cid%>);\n-                    \n-                configs_<%=cid%>.add(config_<%=cid%>);\n-\t\t\t<%\n+\t\t\t\t\tjava.util.Map<String,String> properties_<%=cid%> = null;\n+\t\t\t\t\tcom.amazonaws.services.elasticmapreduce.model.Configuration config_<%=cid%> = null;\n+\t\t\t\t<%\n+\t\t\t\t}\n+\t\t\t\t\n+\t\t\t\tfor(java.util.Map.Entry<String, List<Map<String,String>>> entry : classification2Properties.entrySet()) {\n+\t\t\t\t\tString classification = entry.getKey();\n+\t\t\t\t\tList<Map<String,String>> properties = entry.getValue();\n+\t\t\t\t\t%>\n+\t    \t\t\tproperties_<%=cid%> = new java.util.HashMap<String,String>();\n+\t    \t\t\t\n+\t    \t\t\t<%\n+\t    \t\t\tfor(Map<String,String> property : properties) {\n+\t    \t\t\t%>\n+\t    \t\t\t\tproperties_<%=cid%>.put(<%=property.get(\"KEY\")%>, <%=property.get(\"VALUE\")%>);\n+\t    \t\t\t<%\n+\t    \t\t\t}\n+\t    \t\t\t%>\n+\t    \t\t\t\n+\t            \tconfig_<%=cid%> = new com.amazonaws.services.elasticmapreduce.model.Configuration()\n+\t                    .withClassification(<%=classification%>)\n+\t                    .withProperties(properties_<%=cid%>);\n+\t                    \n+\t                configs_<%=cid%>.add(config_<%=cid%>);\n+\t\t\t\t<%\n+\t\t\t\t}\n \t\t\t}\n \t\t}\n-\t}\n+\t}else{\n+\t\tboolean isHasSubnetId = subnet_id != null && !subnet_id.equals(\"\\\"\\\"\") && subnet_id.length() > 0;\n \t%>\n-\t\n+\t\tboolean isHasSubnetId_<%=cid%> = <%=isHasSubnetId %>;\n+\t\tif(!isHasSubnetId_<%=cid%>) {\n+\t\t\tthrow new RuntimeException(\"You must specify the subnet ID when you launch an EMR cluster with multiple master nodes.\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8120f503d01dae52f78d27a53e10a5244a53a4f3"}, "originalPosition": 128}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f67984147dd5a00add9a5b4d834fecffec546ce9", "author": {"user": {"login": "vyu-talend", "name": null}}, "url": "https://github.com/Talend/tdi-studio-se/commit/f67984147dd5a00add9a5b4d834fecffec546ce9", "committedDate": "2020-08-11T03:18:26Z", "message": "feat(TDI-44630):improve the error message."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY0NzIzNzY2", "url": "https://github.com/Talend/tdi-studio-se/pull/5059#pullrequestreview-464723766", "createdAt": "2020-08-11T03:27:37Z", "commit": {"oid": "f67984147dd5a00add9a5b4d834fecffec546ce9"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4677, "cost": 1, "resetAt": "2021-11-02T12:20:56Z"}}}