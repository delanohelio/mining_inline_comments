{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTA2NjgyNjI0", "number": 5399, "title": "fix(TDI-45015): tFileInputMail - slow attachments retrieval.", "bodyText": "What is the current behavior? (You can also link to an open issue here)\nhttps://jira.talendforge.org/browse/TDI-45015\nWhat is the new behavior?\nPlease check if the PR fulfills these requirements\n\n The commit message follows Talend standard\n Tests for the changes have been added (for bug fixes / features)\n Docs have been added / updated (for bug fixes / features) ?\n The code coverage on new code >75%\n The new code does not introduce new technical issues (sonar / eslint)\n\nWhat kind of change does this PR introduce?\n\n Bugfix\n Feature\n Code style update (formatting, local variables)\n Refactoring (no functional changes, no api changes)\n Build / CI related changes\n Other... Please describe:\n\nDoes this PR introduce a breaking change?\n\n Yes\n No\n\nIf this PR contains a breaking change, please describe the impact and migration path for existing applications: ...\nOther information:", "createdAt": "2020-10-20T10:41:20Z", "url": "https://github.com/Talend/tdi-studio-se/pull/5399", "merged": true, "mergeCommit": {"oid": "8752a75abd412e3a9bf4ee797bb174a6f950be00"}, "closed": true, "closedAt": "2020-10-23T08:24:34Z", "author": {"login": "dmytrogrygorenko"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdUWWLBgH2gAyNTA2NjgyNjI0OmRmZDhjNWMzZmM4ZmExMmE2OGUxN2I3MmZiZmMxMjk1NGY2ZTVlNjY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdUZJ93AFqTUxMjczOTkwNg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "dfd8c5c3fc8fa12a68e17b72fbfc12954f6e5e66", "author": {"user": {"login": "dmytrogrygorenko", "name": "Dmytro Grygorenko"}}, "url": "https://github.com/Talend/tdi-studio-se/commit/dfd8c5c3fc8fa12a68e17b72fbfc12954f6e5e66", "committedDate": "2020-10-20T10:37:51Z", "message": "fix(TDI-45015): fix for low Input/OutputStreams performance."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTEyNjEwODA2", "url": "https://github.com/Talend/tdi-studio-se/pull/5399#pullrequestreview-512610806", "createdAt": "2020-10-20T11:36:23Z", "commit": {"oid": "dfd8c5c3fc8fa12a68e17b72fbfc12954f6e5e66"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4ec87a8dbb106a509244e51054798e10bac982aa", "author": {"user": {"login": "dmytrogrygorenko", "name": "Dmytro Grygorenko"}}, "url": "https://github.com/Talend/tdi-studio-se/commit/4ec87a8dbb106a509244e51054798e10bac982aa", "committedDate": "2020-10-20T12:03:55Z", "message": "fix(TDI-45015): increase buffer size to align sizes of internal and external buffers."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTEyNjU3NjE2", "url": "https://github.com/Talend/tdi-studio-se/pull/5399#pullrequestreview-512657616", "createdAt": "2020-10-20T12:36:36Z", "commit": {"oid": "4ec87a8dbb106a509244e51054798e10bac982aa"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMFQxMjozNjozNlrOHk6JGA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMFQxMjozNjozNlrOHk6JGA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODQ2MzM4NA==", "bodyText": "I see it's an extra operation to flush each write operation, since BufferedOutputStream does its own flushBuffer() + it is flushing on close().", "url": "https://github.com/Talend/tdi-studio-se/pull/5399#discussion_r508463384", "createdAt": "2020-10-20T12:36:36Z", "author": {"login": "mbasiuk-talend"}, "path": "main/plugins/org.talend.designer.components.localprovider/components/tFileInputMail/tFileInputMail_MIME.javajet", "diffHunk": "@@ -222,19 +222,18 @@\n                         }\n                         path = path + attachFileName;\n                         <% if(isLog4jEnabled){ %>\n-                                log.info(\"<%= cid %> - Extracted attachment: '\" + attachFileName + \"'.\");\n+                                log.info(\"<%= cid %> - Extracting attachment: '\" + attachFileName + \"'.\");\n                         <% } %>\n-\n                         java.io.File attachFile = new java.io.File(path);\n-                        java.io.BufferedOutputStream out = new java.io.BufferedOutputStream(new java.io.FileOutputStream(attachFile));\n-                        java.io.BufferedInputStream in = new java.io.BufferedInputStream(mpart.getInputStream());\n-                        int buffer = 0;\n-                        while ((buffer = in.read()) != -1) {\n-                            out.write(buffer);\n-                            out.flush();\n+                        try (java.io.BufferedOutputStream out = new java.io.BufferedOutputStream(new java.io.FileOutputStream(attachFile));\n+                            java.io.BufferedInputStream in = new java.io.BufferedInputStream(mpart.getInputStream())){\n+                            byte[] buffer = new byte[8192];\n+                            int bytesRead = 0;\n+                            while ((bytesRead = in.read(buffer)) > 0) {\n+                                out.write(buffer, 0, bytesRead);\n+                                out.flush();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4ec87a8dbb106a509244e51054798e10bac982aa"}, "originalPosition": 21}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "54278f6319f8b6687aa2cd9b17a4475a9801c6f0", "author": {"user": {"login": "dmytrogrygorenko", "name": "Dmytro Grygorenko"}}, "url": "https://github.com/Talend/tdi-studio-se/commit/54278f6319f8b6687aa2cd9b17a4475a9801c6f0", "committedDate": "2020-10-20T13:00:26Z", "message": "fix(TDI-45015): moved flush() out of cycle."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTEyNzM5OTA2", "url": "https://github.com/Talend/tdi-studio-se/pull/5399#pullrequestreview-512739906", "createdAt": "2020-10-20T13:54:14Z", "commit": {"oid": "54278f6319f8b6687aa2cd9b17a4475a9801c6f0"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4651, "cost": 1, "resetAt": "2021-11-02T12:20:56Z"}}}