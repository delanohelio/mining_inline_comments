{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDczMTUyMTY0", "number": 5132, "title": "TalendExcel: read password protected files.", "bodyText": "What is the current behavior? (You can also link to an open issue here)\nhttps://jira.talendforge.org/browse/TDI-44743\nWhat is the new behavior?\nPlease check if the PR fulfills these requirements\n\n The commit message follows Talend standard\n Tests for the changes have been added (for bug fixes / features)\n Docs have been added / updated (for bug fixes / features) ?\n The code coverage on new code >75%\n The new code does not introduce new technical issues (sonar / eslint)\n\nWhat kind of change does this PR introduce?\n\n Bugfix\n Feature\n Code style update (formatting, local variables)\n Refactoring (no functional changes, no api changes)\n Build / CI related changes\n Other... Please describe:\n\nDoes this PR introduce a breaking change?\n\n Yes\n No\n\nIf this PR contains a breaking change, please describe the impact and migration path for existing applications: ...\nOther information:", "createdAt": "2020-08-25T11:56:06Z", "url": "https://github.com/Talend/tdi-studio-se/pull/5132", "merged": true, "mergeCommit": {"oid": "b8bae804594677ccdbb0dac6286647179e3d693c"}, "closed": true, "closedAt": "2020-09-01T13:11:08Z", "author": {"login": "dmytrogrygorenko"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdCV0xiAH2gAyNDczMTUyMTY0OjA5NWU3YjBhOTRlNjUzMDkzMWEzN2FjZmRkZGRkMzU3NWNiN2U1Njk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdCa8eMAH2gAyNDczMTUyMTY0OmM2NjcwNjljMDdkYTNkNDViODBlODhlNjg5NmZjYzQ4MWFlOWJlMzg=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "095e7b0a94e6530931a37acfddddd3575cb7e569", "author": {"user": {"login": "dmytrogrygorenko", "name": "Dmytro Grygorenko"}}, "url": "https://github.com/Talend/tdi-studio-se/commit/095e7b0a94e6530931a37acfddddd3575cb7e569", "committedDate": "2020-08-25T11:50:44Z", "message": "fix(TDI-44743): read password protected files."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ca1394890dc637f0ebcec7c4d9979569b9a78a64", "author": {"user": {"login": "dmytrogrygorenko", "name": "Dmytro Grygorenko"}}, "url": "https://github.com/Talend/tdi-studio-se/commit/ca1394890dc637f0ebcec7c4d9979569b9a78a64", "committedDate": "2020-08-25T12:27:55Z", "message": "fix(TDI-44743): use new library."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc0NzAxNzc1", "url": "https://github.com/Talend/tdi-studio-se/pull/5132#pullrequestreview-474701775", "createdAt": "2020-08-25T17:27:53Z", "commit": {"oid": "ca1394890dc637f0ebcec7c4d9979569b9a78a64"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNVQxNzoyNzo1NFrOHGig5w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNVQxNzoyNzo1NFrOHGig5w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjYxODk4Mw==", "bodyText": "IMO plain old Incorrect password would be better", "url": "https://github.com/Talend/tdi-studio-se/pull/5132#discussion_r476618983", "createdAt": "2020-08-25T17:27:54Z", "author": {"login": "dmytro-sylaiev"}, "path": "main/plugins/org.talend.designer.components.libs/libs_src/talendExcel/src/main/java/org/talend/ExcelTool.java", "diffHunk": "@@ -185,10 +191,27 @@ public int getStartRow() {\n     }\r\n \r\n     private void initPreXlsx(String fileName) throws Exception {\r\n-        InputStream preIns = new FileInputStream(fileName);\r\n-        preWb = WorkbookFactory.create(preIns);\r\n+        if(password == null) {\r\n+            InputStream preIns = new FileInputStream(fileName);\r\n+            preWb = WorkbookFactory.create(preIns);\r\n+        } else {\r\n+            preWb = readEncryptedFile(fileName);\r\n+        }\r\n         preSheet = preWb.getSheet(sheetName);\r\n     }\r\n+    \r\n+    private Workbook readEncryptedFile(String fileName)\r\n+            throws IOException, GeneralSecurityException {\r\n+        InputStream inp = new FileInputStream(fileName);\r\n+        POIFSFileSystem fs = new POIFSFileSystem(inp);\r\n+        EncryptionInfo info = new EncryptionInfo(fs);\r\n+        Decryptor decryptor = Decryptor.getInstance(info);\r\n+        if (!decryptor.verifyPassword(password)) {\r\n+            throw new GeneralSecurityException(\"Error: Wrong password provided!\");\r", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ca1394890dc637f0ebcec7c4d9979569b9a78a64"}, "originalPosition": 53}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc0NzAxODY3", "url": "https://github.com/Talend/tdi-studio-se/pull/5132#pullrequestreview-474701867", "createdAt": "2020-08-25T17:28:01Z", "commit": {"oid": "ca1394890dc637f0ebcec7c4d9979569b9a78a64"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c667069c07da3d45b80e88e6896fcc481ae9be38", "author": {"user": {"login": "dmytrogrygorenko", "name": "Dmytro Grygorenko"}}, "url": "https://github.com/Talend/tdi-studio-se/commit/c667069c07da3d45b80e88e6896fcc481ae9be38", "committedDate": "2020-08-25T17:48:40Z", "message": "fix(TDI-44743): Error message changed."}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4666, "cost": 1, "resetAt": "2021-11-02T12:20:56Z"}}}