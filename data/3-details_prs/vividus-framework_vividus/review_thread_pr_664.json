{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDMyMzgwNzc3", "number": 664, "reviewThreads": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQxMToxMjozMlrOEEP7ww==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMlQxNDo0NzoxMFrOEFFegA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcyODkwODE5OnYy", "diffSide": "RIGHT", "path": "vividus-plugin-rest-api/src/main/java/org/vividus/bdd/steps/api/HttpCookieSteps.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQxMToxMjozMlrOGhwGXg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMVQwODoyNDo0NlrOGiTcWQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODA0NDI1NA==", "bodyText": "I propose to use a dynamic variable in favor of step;\nJust like for the body", "url": "https://github.com/vividus-framework/vividus/pull/664#discussion_r438044254", "createdAt": "2020-06-10T11:12:32Z", "author": {"login": "ikalinin1"}, "path": "vividus-plugin-rest-api/src/main/java/org/vividus/bdd/steps/api/HttpCookieSteps.java", "diffHunk": "@@ -0,0 +1,66 @@\n+/*\n+ * Copyright 2019-2020 the original author or authors.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.vividus.bdd.steps.api;\n+\n+import java.util.Optional;\n+import java.util.Set;\n+import javax.inject.Inject;\n+import org.apache.http.cookie.Cookie;\n+import org.jbehave.core.annotations.When;\n+import org.vividus.bdd.context.IBddVariableContext;\n+import org.vividus.bdd.variable.VariableScope;\n+import org.vividus.http.CookieStoreProvider;\n+import org.vividus.softassert.ISoftAssert;\n+\n+public class HttpCookieSteps\n+{\n+    private final IBddVariableContext bddVariableContext;\n+    private final CookieStoreProvider cookieStoreProvider;\n+    private final ISoftAssert softAssert;\n+\n+    public HttpCookieSteps(IBddVariableContext bddVariableContext, CookieStoreProvider cookieStoreProvider,\n+            ISoftAssert softAssert)\n+    {\n+        this.bddVariableContext = bddVariableContext;\n+        this.cookieStoreProvider = cookieStoreProvider;\n+        this.softAssert = softAssert;\n+    }\n+\n+    /**\n+     * Saves cookie to scope variable\n+     * @param cookieName name of cookie to save\n+     * @param scopes The set (comma separated list of scopes e.g.: STORY, NEXT_BATCHES) of variable's scope<br>\n+     * <i>Available scopes:</i>\n+     * <ul>\n+     * <li><b>STEP</b> - the variable will be available only within the step,\n+     * <li><b>SCENARIO</b> - the variable will be available only within the scenario,\n+     * <li><b>STORY</b> - the variable will be available within the whole story,\n+     * <li><b>NEXT_BATCHES</b> - the variable will be available starting from next batch\n+     * </ul>\n+     * @param variableName name of variable\n+     */\n+    @When(\"I save value of HTTP cookie with name `$cookieName` to $scopes variable `$variableName`\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a595a7377b0916dcdbd0f8befdd207c13f5a37e8"}, "originalPosition": 56}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODYyMzMyMQ==", "bodyText": "Discussed with the team, the step is the simpler API due to cookies' complexity. Please ignore the comment above", "url": "https://github.com/vividus-framework/vividus/pull/664#discussion_r438623321", "createdAt": "2020-06-11T08:24:46Z", "author": {"login": "ikalinin1"}, "path": "vividus-plugin-rest-api/src/main/java/org/vividus/bdd/steps/api/HttpCookieSteps.java", "diffHunk": "@@ -0,0 +1,66 @@\n+/*\n+ * Copyright 2019-2020 the original author or authors.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.vividus.bdd.steps.api;\n+\n+import java.util.Optional;\n+import java.util.Set;\n+import javax.inject.Inject;\n+import org.apache.http.cookie.Cookie;\n+import org.jbehave.core.annotations.When;\n+import org.vividus.bdd.context.IBddVariableContext;\n+import org.vividus.bdd.variable.VariableScope;\n+import org.vividus.http.CookieStoreProvider;\n+import org.vividus.softassert.ISoftAssert;\n+\n+public class HttpCookieSteps\n+{\n+    private final IBddVariableContext bddVariableContext;\n+    private final CookieStoreProvider cookieStoreProvider;\n+    private final ISoftAssert softAssert;\n+\n+    public HttpCookieSteps(IBddVariableContext bddVariableContext, CookieStoreProvider cookieStoreProvider,\n+            ISoftAssert softAssert)\n+    {\n+        this.bddVariableContext = bddVariableContext;\n+        this.cookieStoreProvider = cookieStoreProvider;\n+        this.softAssert = softAssert;\n+    }\n+\n+    /**\n+     * Saves cookie to scope variable\n+     * @param cookieName name of cookie to save\n+     * @param scopes The set (comma separated list of scopes e.g.: STORY, NEXT_BATCHES) of variable's scope<br>\n+     * <i>Available scopes:</i>\n+     * <ul>\n+     * <li><b>STEP</b> - the variable will be available only within the step,\n+     * <li><b>SCENARIO</b> - the variable will be available only within the scenario,\n+     * <li><b>STORY</b> - the variable will be available within the whole story,\n+     * <li><b>NEXT_BATCHES</b> - the variable will be available starting from next batch\n+     * </ul>\n+     * @param variableName name of variable\n+     */\n+    @When(\"I save value of HTTP cookie with name `$cookieName` to $scopes variable `$variableName`\")", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODA0NDI1NA=="}, "originalCommit": {"oid": "a595a7377b0916dcdbd0f8befdd207c13f5a37e8"}, "originalPosition": 56}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcyODkzNjE1OnYy", "diffSide": "RIGHT", "path": "vividus-plugin-rest-api/src/test/java/org/vividus/bdd/steps/api/HttpCookieStepsTests.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQxMToyMjowNFrOGhwYSg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQxMToyMjowNFrOGhwYSg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODA0ODg0Mg==", "bodyText": "maybe make sense to move\nCookieStore cookieStore = Mockito.mock(CookieStore.class);\nwhen(cookieStoreProvider.getCookieStore()).thenReturn(cookieStore);\n\nin @before ?", "url": "https://github.com/vividus-framework/vividus/pull/664#discussion_r438048842", "createdAt": "2020-06-10T11:22:04Z", "author": {"login": "abudevich"}, "path": "vividus-plugin-rest-api/src/test/java/org/vividus/bdd/steps/api/HttpCookieStepsTests.java", "diffHunk": "@@ -0,0 +1,92 @@\n+/*\n+ * Copyright 2019-2020 the original author or authors.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.vividus.bdd.steps.api;\n+\n+import static org.mockito.ArgumentMatchers.eq;\n+import static org.mockito.Mockito.verify;\n+import static org.mockito.Mockito.verifyNoInteractions;\n+import static org.mockito.Mockito.when;\n+\n+import java.util.Collections;\n+import java.util.List;\n+import java.util.Set;\n+\n+import org.apache.http.client.CookieStore;\n+import org.apache.http.cookie.Cookie;\n+import org.junit.jupiter.api.Test;\n+import org.junit.jupiter.api.extension.ExtendWith;\n+import org.mockito.InjectMocks;\n+import org.mockito.Mock;\n+import org.mockito.Mockito;\n+import org.mockito.junit.jupiter.MockitoExtension;\n+import org.vividus.bdd.context.IBddVariableContext;\n+import org.vividus.bdd.variable.VariableScope;\n+import org.vividus.http.CookieStoreProvider;\n+import org.vividus.softassert.ISoftAssert;\n+\n+@ExtendWith(MockitoExtension.class)\n+public class HttpCookieStepsTests\n+{\n+    private static final String NAME = \"name\";\n+\n+    @Mock\n+    private Cookie cookie;\n+\n+    @Mock\n+    private CookieStoreProvider cookieStoreProvider;\n+\n+    @Mock\n+    private IBddVariableContext bddVariableContext;\n+\n+    @Mock\n+    private ISoftAssert softAssert;\n+\n+    @InjectMocks\n+    private HttpCookieSteps httpCookieSteps;\n+\n+    @Test\n+    void shouldSaveCookieValueIntoVariableContext()\n+    {\n+        CookieStore cookieStore = Mockito.mock(CookieStore.class);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "88a9520c2c3bced6d83a751698adb8f2a387fa46"}, "originalPosition": 64}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjczMDg1OTM1OnYy", "diffSide": "RIGHT", "path": "vividus-plugin-rest-api/src/main/java/org/vividus/bdd/steps/api/HttpCookieSteps.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQxOTozOTozNFrOGiDoxg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQxOTozOTozNFrOGiDoxg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODM2NDM1OA==", "bodyText": "instead of getting first, collect the list and then assert that number of cookies in the collection is 1", "url": "https://github.com/vividus-framework/vividus/pull/664#discussion_r438364358", "createdAt": "2020-06-10T19:39:34Z", "author": {"login": "valfirst"}, "path": "vividus-plugin-rest-api/src/main/java/org/vividus/bdd/steps/api/HttpCookieSteps.java", "diffHunk": "@@ -0,0 +1,66 @@\n+/*\n+ * Copyright 2019-2020 the original author or authors.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.vividus.bdd.steps.api;\n+\n+import java.util.Optional;\n+import java.util.Set;\n+\n+import org.apache.http.cookie.Cookie;\n+import org.jbehave.core.annotations.When;\n+import org.vividus.bdd.context.IBddVariableContext;\n+import org.vividus.bdd.variable.VariableScope;\n+import org.vividus.http.CookieStoreProvider;\n+import org.vividus.softassert.ISoftAssert;\n+\n+public class HttpCookieSteps\n+{\n+    private final IBddVariableContext bddVariableContext;\n+    private final CookieStoreProvider cookieStoreProvider;\n+    private final ISoftAssert softAssert;\n+\n+    public HttpCookieSteps(IBddVariableContext bddVariableContext, CookieStoreProvider cookieStoreProvider,\n+            ISoftAssert softAssert)\n+    {\n+        this.bddVariableContext = bddVariableContext;\n+        this.cookieStoreProvider = cookieStoreProvider;\n+        this.softAssert = softAssert;\n+    }\n+\n+    /**\n+     * Saves cookie to scope variable\n+     * @param cookieName name of cookie to save\n+     * @param scopes The set (comma separated list of scopes e.g.: STORY, NEXT_BATCHES) of variable's scope<br>\n+     * <i>Available scopes:</i>\n+     * <ul>\n+     * <li><b>STEP</b> - the variable will be available only within the step,\n+     * <li><b>SCENARIO</b> - the variable will be available only within the scenario,\n+     * <li><b>STORY</b> - the variable will be available within the whole story,\n+     * <li><b>NEXT_BATCHES</b> - the variable will be available starting from next batch\n+     * </ul>\n+     * @param variableName name of variable\n+     */\n+    @When(\"I save value of HTTP cookie with name `$cookieName` to $scopes variable `$variableName`\")\n+    public void saveHttpCookieIntoVariable(String cookieName, Set<VariableScope> scopes, String variableName)\n+    {\n+        Optional<Cookie> targetCookie = cookieStoreProvider.getCookieStore().getCookies()\n+                .stream()\n+                .filter(cookie -> cookie.getName().equals(cookieName))\n+                .findFirst();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1c00be9a8a9cbc91f05d06e201c84539d790458b"}, "originalPosition": 62}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjczMDg2MTQwOnYy", "diffSide": "RIGHT", "path": "vividus-plugin-rest-api/src/test/java/org/vividus/bdd/steps/api/HttpCookieStepsTests.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQxOTo0MDowOFrOGiDp9w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQxOTo0MDowOFrOGiDp9w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODM2NDY2Mw==", "bodyText": "no need to make it public", "url": "https://github.com/vividus-framework/vividus/pull/664#discussion_r438364663", "createdAt": "2020-06-10T19:40:08Z", "author": {"login": "valfirst"}, "path": "vividus-plugin-rest-api/src/test/java/org/vividus/bdd/steps/api/HttpCookieStepsTests.java", "diffHunk": "@@ -0,0 +1,98 @@\n+/*\n+ * Copyright 2019-2020 the original author or authors.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.vividus.bdd.steps.api;\n+\n+import static org.mockito.ArgumentMatchers.eq;\n+import static org.mockito.Mockito.verify;\n+import static org.mockito.Mockito.verifyNoInteractions;\n+import static org.mockito.Mockito.when;\n+\n+import java.util.Collections;\n+import java.util.List;\n+import java.util.Set;\n+\n+import org.apache.http.client.CookieStore;\n+import org.apache.http.cookie.Cookie;\n+import org.junit.jupiter.api.BeforeEach;\n+import org.junit.jupiter.api.Test;\n+import org.junit.jupiter.api.extension.ExtendWith;\n+import org.mockito.InjectMocks;\n+import org.mockito.Mock;\n+import org.mockito.Mockito;\n+import org.mockito.junit.jupiter.MockitoExtension;\n+import org.vividus.bdd.context.IBddVariableContext;\n+import org.vividus.bdd.variable.VariableScope;\n+import org.vividus.http.CookieStoreProvider;\n+import org.vividus.softassert.ISoftAssert;\n+\n+@ExtendWith(MockitoExtension.class)\n+public class HttpCookieStepsTests", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1c00be9a8a9cbc91f05d06e201c84539d790458b"}, "originalPosition": 43}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjczMDg2NDkzOnYy", "diffSide": "RIGHT", "path": "vividus-tests/src/main/resources/story/integration/RestApiStepsTests.story", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQxOTo0MToxNFrOGiDsOA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMVQwODoyNjoyOVrOGiTf-w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODM2NTI0MA==", "bodyText": "-deleted-", "url": "https://github.com/vividus-framework/vividus/pull/664#discussion_r438365240", "createdAt": "2020-06-10T19:41:14Z", "author": {"login": "valfirst"}, "path": "vividus-tests/src/main/resources/story/integration/RestApiStepsTests.story", "diffHunk": "@@ -36,3 +36,8 @@ Scenario: Verify step \"Then the connection is secured using $securityProtocol pr\n Given request body: ${request-body}\n When I send HTTP DELETE to the relative URL '/delete'\n Then the connection is secured using TLSv1.2 protocol\n+\n+Scenario: Verify HTTP cookie is saved to local storage", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1c00be9a8a9cbc91f05d06e201c84539d790458b"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODYyNDI1MQ==", "bodyText": "Do we follow a template Verify step: 'When I save value of HTTP cookie with name $cookieName to $scopes variable $variableName' ?", "url": "https://github.com/vividus-framework/vividus/pull/664#discussion_r438624251", "createdAt": "2020-06-11T08:26:29Z", "author": {"login": "ikalinin1"}, "path": "vividus-tests/src/main/resources/story/integration/RestApiStepsTests.story", "diffHunk": "@@ -36,3 +36,8 @@ Scenario: Verify step \"Then the connection is secured using $securityProtocol pr\n Given request body: ${request-body}\n When I send HTTP DELETE to the relative URL '/delete'\n Then the connection is secured using TLSv1.2 protocol\n+\n+Scenario: Verify HTTP cookie is saved to local storage", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODM2NTI0MA=="}, "originalCommit": {"oid": "1c00be9a8a9cbc91f05d06e201c84539d790458b"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjczMjU2OTAzOnYy", "diffSide": "RIGHT", "path": "vividus-plugin-rest-api/src/main/java/org/vividus/bdd/steps/api/HttpCookieSteps.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMVQwODo1MTo1MVrOGiUXmQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMVQwODo1NjoyN1rOGiUiXw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODYzODQ4OQ==", "bodyText": "If we have more than 1 cookies with the same name, will this step successfully pass?\nWhat is the suggested solution to handle such situation?", "url": "https://github.com/vividus-framework/vividus/pull/664#discussion_r438638489", "createdAt": "2020-06-11T08:51:51Z", "author": {"login": "dKatechev"}, "path": "vividus-plugin-rest-api/src/main/java/org/vividus/bdd/steps/api/HttpCookieSteps.java", "diffHunk": "@@ -0,0 +1,68 @@\n+/*\n+ * Copyright 2019-2020 the original author or authors.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.vividus.bdd.steps.api;\n+\n+import java.util.List;\n+import java.util.Optional;\n+import java.util.Set;\n+\n+import java.util.stream.Collectors;\n+import org.apache.http.cookie.Cookie;\n+import org.jbehave.core.annotations.When;\n+import org.vividus.bdd.context.IBddVariableContext;\n+import org.vividus.bdd.variable.VariableScope;\n+import org.vividus.http.CookieStoreProvider;\n+import org.vividus.softassert.ISoftAssert;\n+\n+public class HttpCookieSteps\n+{\n+    private final IBddVariableContext bddVariableContext;\n+    private final CookieStoreProvider cookieStoreProvider;\n+    private final ISoftAssert softAssert;\n+\n+    public HttpCookieSteps(IBddVariableContext bddVariableContext, CookieStoreProvider cookieStoreProvider,\n+            ISoftAssert softAssert)\n+    {\n+        this.bddVariableContext = bddVariableContext;\n+        this.cookieStoreProvider = cookieStoreProvider;\n+        this.softAssert = softAssert;\n+    }\n+\n+    /**\n+     * Saves cookie to scope variable\n+     * @param cookieName name of cookie to save\n+     * @param scopes The set (comma separated list of scopes e.g.: STORY, NEXT_BATCHES) of variable's scope<br>\n+     * <i>Available scopes:</i>\n+     * <ul>\n+     * <li><b>STEP</b> - the variable will be available only within the step,\n+     * <li><b>SCENARIO</b> - the variable will be available only within the scenario,\n+     * <li><b>STORY</b> - the variable will be available within the whole story,\n+     * <li><b>NEXT_BATCHES</b> - the variable will be available starting from next batch\n+     * </ul>\n+     * @param variableName name of variable\n+     */\n+    @When(\"I save value of HTTP cookie with name `$cookieName` to $scopes variable `$variableName`\")\n+    public void saveHttpCookieIntoVariable(String cookieName, Set<VariableScope> scopes, String variableName)\n+    {\n+        List<Cookie> cookies = cookieStoreProvider.getCookieStore().getCookies()\n+                .stream()\n+                .filter(cookie -> cookie.getName().equals(cookieName))\n+                .collect(Collectors.toList());\n+        softAssert.assertTrue(String.format(\"Cookie with the name '%s' is set\", cookieName), cookies.size() == 1);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "decf4c201fe08107d7b66bd58e2d336321ed08d3"}, "originalPosition": 65}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODY0MTI0Nw==", "bodyText": "it will fail, since we can't decide which cookie should be used", "url": "https://github.com/vividus-framework/vividus/pull/664#discussion_r438641247", "createdAt": "2020-06-11T08:56:27Z", "author": {"login": "valfirst"}, "path": "vividus-plugin-rest-api/src/main/java/org/vividus/bdd/steps/api/HttpCookieSteps.java", "diffHunk": "@@ -0,0 +1,68 @@\n+/*\n+ * Copyright 2019-2020 the original author or authors.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.vividus.bdd.steps.api;\n+\n+import java.util.List;\n+import java.util.Optional;\n+import java.util.Set;\n+\n+import java.util.stream.Collectors;\n+import org.apache.http.cookie.Cookie;\n+import org.jbehave.core.annotations.When;\n+import org.vividus.bdd.context.IBddVariableContext;\n+import org.vividus.bdd.variable.VariableScope;\n+import org.vividus.http.CookieStoreProvider;\n+import org.vividus.softassert.ISoftAssert;\n+\n+public class HttpCookieSteps\n+{\n+    private final IBddVariableContext bddVariableContext;\n+    private final CookieStoreProvider cookieStoreProvider;\n+    private final ISoftAssert softAssert;\n+\n+    public HttpCookieSteps(IBddVariableContext bddVariableContext, CookieStoreProvider cookieStoreProvider,\n+            ISoftAssert softAssert)\n+    {\n+        this.bddVariableContext = bddVariableContext;\n+        this.cookieStoreProvider = cookieStoreProvider;\n+        this.softAssert = softAssert;\n+    }\n+\n+    /**\n+     * Saves cookie to scope variable\n+     * @param cookieName name of cookie to save\n+     * @param scopes The set (comma separated list of scopes e.g.: STORY, NEXT_BATCHES) of variable's scope<br>\n+     * <i>Available scopes:</i>\n+     * <ul>\n+     * <li><b>STEP</b> - the variable will be available only within the step,\n+     * <li><b>SCENARIO</b> - the variable will be available only within the scenario,\n+     * <li><b>STORY</b> - the variable will be available within the whole story,\n+     * <li><b>NEXT_BATCHES</b> - the variable will be available starting from next batch\n+     * </ul>\n+     * @param variableName name of variable\n+     */\n+    @When(\"I save value of HTTP cookie with name `$cookieName` to $scopes variable `$variableName`\")\n+    public void saveHttpCookieIntoVariable(String cookieName, Set<VariableScope> scopes, String variableName)\n+    {\n+        List<Cookie> cookies = cookieStoreProvider.getCookieStore().getCookies()\n+                .stream()\n+                .filter(cookie -> cookie.getName().equals(cookieName))\n+                .collect(Collectors.toList());\n+        softAssert.assertTrue(String.format(\"Cookie with the name '%s' is set\", cookieName), cookies.size() == 1);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODYzODQ4OQ=="}, "originalCommit": {"oid": "decf4c201fe08107d7b66bd58e2d336321ed08d3"}, "originalPosition": 65}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjczMjU3OTgyOnYy", "diffSide": "RIGHT", "path": "vividus-plugin-rest-api/src/main/java/org/vividus/bdd/steps/api/HttpCookieSteps.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMVQwODo1NDo0N1rOGiUeVQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMVQwODo1NDo0N1rOGiUeVQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODY0MDIxMw==", "bodyText": "use assertEquals as it gives better description in case of failure", "url": "https://github.com/vividus-framework/vividus/pull/664#discussion_r438640213", "createdAt": "2020-06-11T08:54:47Z", "author": {"login": "valfirst"}, "path": "vividus-plugin-rest-api/src/main/java/org/vividus/bdd/steps/api/HttpCookieSteps.java", "diffHunk": "@@ -0,0 +1,68 @@\n+/*\n+ * Copyright 2019-2020 the original author or authors.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.vividus.bdd.steps.api;\n+\n+import java.util.List;\n+import java.util.Optional;\n+import java.util.Set;\n+\n+import java.util.stream.Collectors;\n+import org.apache.http.cookie.Cookie;\n+import org.jbehave.core.annotations.When;\n+import org.vividus.bdd.context.IBddVariableContext;\n+import org.vividus.bdd.variable.VariableScope;\n+import org.vividus.http.CookieStoreProvider;\n+import org.vividus.softassert.ISoftAssert;\n+\n+public class HttpCookieSteps\n+{\n+    private final IBddVariableContext bddVariableContext;\n+    private final CookieStoreProvider cookieStoreProvider;\n+    private final ISoftAssert softAssert;\n+\n+    public HttpCookieSteps(IBddVariableContext bddVariableContext, CookieStoreProvider cookieStoreProvider,\n+            ISoftAssert softAssert)\n+    {\n+        this.bddVariableContext = bddVariableContext;\n+        this.cookieStoreProvider = cookieStoreProvider;\n+        this.softAssert = softAssert;\n+    }\n+\n+    /**\n+     * Saves cookie to scope variable\n+     * @param cookieName name of cookie to save\n+     * @param scopes The set (comma separated list of scopes e.g.: STORY, NEXT_BATCHES) of variable's scope<br>\n+     * <i>Available scopes:</i>\n+     * <ul>\n+     * <li><b>STEP</b> - the variable will be available only within the step,\n+     * <li><b>SCENARIO</b> - the variable will be available only within the scenario,\n+     * <li><b>STORY</b> - the variable will be available within the whole story,\n+     * <li><b>NEXT_BATCHES</b> - the variable will be available starting from next batch\n+     * </ul>\n+     * @param variableName name of variable\n+     */\n+    @When(\"I save value of HTTP cookie with name `$cookieName` to $scopes variable `$variableName`\")\n+    public void saveHttpCookieIntoVariable(String cookieName, Set<VariableScope> scopes, String variableName)\n+    {\n+        List<Cookie> cookies = cookieStoreProvider.getCookieStore().getCookies()\n+                .stream()\n+                .filter(cookie -> cookie.getName().equals(cookieName))\n+                .collect(Collectors.toList());\n+        softAssert.assertTrue(String.format(\"Cookie with the name '%s' is set\", cookieName), cookies.size() == 1);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "decf4c201fe08107d7b66bd58e2d336321ed08d3"}, "originalPosition": 65}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjczMjU4Mzg2OnYy", "diffSide": "RIGHT", "path": "vividus-plugin-rest-api/src/main/java/org/vividus/bdd/steps/api/HttpCookieSteps.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMVQwODo1NTo1MVrOGiUg6w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMVQwODo1NTo1MVrOGiUg6w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODY0MDg3NQ==", "bodyText": "variable should be saved, only if we have 1 cookie:\nif (softAssert.assertEquals(...))\n{\n   bddVariableContext.putVariable(...);\n}", "url": "https://github.com/vividus-framework/vividus/pull/664#discussion_r438640875", "createdAt": "2020-06-11T08:55:51Z", "author": {"login": "valfirst"}, "path": "vividus-plugin-rest-api/src/main/java/org/vividus/bdd/steps/api/HttpCookieSteps.java", "diffHunk": "@@ -0,0 +1,68 @@\n+/*\n+ * Copyright 2019-2020 the original author or authors.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.vividus.bdd.steps.api;\n+\n+import java.util.List;\n+import java.util.Optional;\n+import java.util.Set;\n+\n+import java.util.stream.Collectors;\n+import org.apache.http.cookie.Cookie;\n+import org.jbehave.core.annotations.When;\n+import org.vividus.bdd.context.IBddVariableContext;\n+import org.vividus.bdd.variable.VariableScope;\n+import org.vividus.http.CookieStoreProvider;\n+import org.vividus.softassert.ISoftAssert;\n+\n+public class HttpCookieSteps\n+{\n+    private final IBddVariableContext bddVariableContext;\n+    private final CookieStoreProvider cookieStoreProvider;\n+    private final ISoftAssert softAssert;\n+\n+    public HttpCookieSteps(IBddVariableContext bddVariableContext, CookieStoreProvider cookieStoreProvider,\n+            ISoftAssert softAssert)\n+    {\n+        this.bddVariableContext = bddVariableContext;\n+        this.cookieStoreProvider = cookieStoreProvider;\n+        this.softAssert = softAssert;\n+    }\n+\n+    /**\n+     * Saves cookie to scope variable\n+     * @param cookieName name of cookie to save\n+     * @param scopes The set (comma separated list of scopes e.g.: STORY, NEXT_BATCHES) of variable's scope<br>\n+     * <i>Available scopes:</i>\n+     * <ul>\n+     * <li><b>STEP</b> - the variable will be available only within the step,\n+     * <li><b>SCENARIO</b> - the variable will be available only within the scenario,\n+     * <li><b>STORY</b> - the variable will be available within the whole story,\n+     * <li><b>NEXT_BATCHES</b> - the variable will be available starting from next batch\n+     * </ul>\n+     * @param variableName name of variable\n+     */\n+    @When(\"I save value of HTTP cookie with name `$cookieName` to $scopes variable `$variableName`\")\n+    public void saveHttpCookieIntoVariable(String cookieName, Set<VariableScope> scopes, String variableName)\n+    {\n+        List<Cookie> cookies = cookieStoreProvider.getCookieStore().getCookies()\n+                .stream()\n+                .filter(cookie -> cookie.getName().equals(cookieName))\n+                .collect(Collectors.toList());\n+        softAssert.assertTrue(String.format(\"Cookie with the name '%s' is set\", cookieName), cookies.size() == 1);\n+        bddVariableContext.putVariable(scopes, variableName, cookies.get(0));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "decf4c201fe08107d7b66bd58e2d336321ed08d3"}, "originalPosition": 66}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjczNzY3NzkyOnYy", "diffSide": "RIGHT", "path": "vividus-plugin-rest-api/src/main/java/org/vividus/bdd/steps/api/HttpCookieSteps.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMlQxNDo0NjoyMVrOGjGvcg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMlQxNDo0NjoyMVrOGjGvcg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTQ2Mzc5NA==", "bodyText": "List<Cookie> cookies = cookieStoreProvider.getCookieStore().getCookies().stream()\n                .filter(cookie -> cookie.getName().equals(cookieName))\n                .collect(Collectors.toList());\nint cookiesNumber = cookies.size();\nif (softAssert.assertThat(String.format(\"Number of cookies with name '%s'\", cookieName), cookiesNumber, greaterThan(0)))\n{\n    if (cookiesNumber == 1)\n    {\n        bddVariableContext.putVariable(scopes, variableName, cookies.get(0).getValue());\n    }\n    else\n    {\n        String rootPath = \"/\";\n        LOGGER.info(\"Filtering cookies by path attribute '{}'\", rootPath);\n        cookies = cookies.stream()\n                .filter(cookie -> rootPath.equals(cookie.getPath()))\n                .collect(Collectors.toList());\n        if (softAssert.assertEquals(String.format(\"Number of cookies with name '%s' and path attribute '%s'\", cookieName, rootPath), 1, cookies.size())\n        {\n            bddVariableContext.putVariable(scopes, variableName, cookies.get(0).getValue());\n        }\n    }\n}", "url": "https://github.com/vividus-framework/vividus/pull/664#discussion_r439463794", "createdAt": "2020-06-12T14:46:21Z", "author": {"login": "valfirst"}, "path": "vividus-plugin-rest-api/src/main/java/org/vividus/bdd/steps/api/HttpCookieSteps.java", "diffHunk": "@@ -0,0 +1,97 @@\n+/*\n+ * Copyright 2019-2020 the original author or authors.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.vividus.bdd.steps.api;\n+\n+import java.util.List;\n+import java.util.Set;\n+import java.util.stream.Collectors;\n+\n+import org.apache.http.cookie.Cookie;\n+import org.jbehave.core.annotations.When;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.vividus.bdd.context.IBddVariableContext;\n+import org.vividus.bdd.variable.VariableScope;\n+import org.vividus.http.CookieStoreProvider;\n+import org.vividus.softassert.ISoftAssert;\n+\n+public class HttpCookieSteps\n+{\n+    private static final Logger LOGGER = LoggerFactory.getLogger(HttpCookieSteps.class);\n+    private final IBddVariableContext bddVariableContext;\n+    private final CookieStoreProvider cookieStoreProvider;\n+    private final ISoftAssert softAssert;\n+\n+    public HttpCookieSteps(IBddVariableContext bddVariableContext, CookieStoreProvider cookieStoreProvider,\n+            ISoftAssert softAssert)\n+    {\n+        this.bddVariableContext = bddVariableContext;\n+        this.cookieStoreProvider = cookieStoreProvider;\n+        this.softAssert = softAssert;\n+    }\n+\n+    /**\n+     * Saves cookie to scope variable.\n+     * If present several cookies with the same name will be stored cookie with the root path value (path is '/'),\n+     * @param cookieName   name of cookie to save\n+     * @param scopes       The set (comma separated list of scopes e.g.: STORY, NEXT_BATCHES) of variable's scope<br>\n+     *                     <i>Available scopes:</i>\n+     *                     <ul>\n+     *                     <li><b>STEP</b> - the variable will be available only within the step,\n+     *                     <li><b>SCENARIO</b> - the variable will be available only within the scenario,\n+     *                     <li><b>STORY</b> - the variable will be available within the whole story,\n+     *                     <li><b>NEXT_BATCHES</b> - the variable will be available starting from next batch\n+     *                     </ul>\n+     * @param variableName name of variable\n+     */\n+    @When(\"I save value of HTTP cookie with name `$cookieName` to $scopes variable `$variableName`\")\n+    public void saveHttpCookieIntoVariable(String cookieName, Set<VariableScope> scopes, String variableName)\n+    {\n+        List<Cookie> cookies = cookieStoreProvider.getCookieStore().getCookies()\n+                .stream()\n+                .filter(cookie -> cookie.getName().equals(cookieName))\n+                .collect(Collectors.toList());\n+        int cookiesAmount = cookies.size();\n+        if (softAssert\n+                .assertTrue(String.format(\"Present '%d' cookie(-s) with the name '%s'\", cookiesAmount, cookieName),\n+                        !cookies.isEmpty()))\n+        {\n+            if (cookiesAmount == 1)\n+            {\n+                bddVariableContext.putVariable(scopes, variableName, cookies.get(0).getValue());\n+            }\n+            else\n+            {\n+                LOGGER.info(\"Will be performed cookies filtering by path value equal to '/'\");\n+                List<Cookie> filteredCookies = cookies\n+                        .stream()\n+                        .filter(cookie -> cookie.getPath().equals(\"/\"))\n+                        .collect(Collectors.toList());\n+                if (filteredCookies.size() == 1)\n+                {\n+                    bddVariableContext.putVariable(scopes, variableName, filteredCookies.get(0).getValue());\n+                }\n+                else\n+                {\n+                    softAssert.recordFailedAssertion(\n+                            String.format(\"Not found cookie with name '%s' and path '/' or was several candidates\",\n+                                    cookieName));\n+                }\n+            }\n+        }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "369dcbd00049b37ce01efcc445dea8f04d657cd9"}, "originalPosition": 95}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjczNzY4MDY0OnYy", "diffSide": "RIGHT", "path": "vividus-plugin-rest-api/src/test/java/org/vividus/bdd/steps/api/HttpCookieStepsTests.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMlQxNDo0NzoxMFrOGjGxKQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMlQxNDo0NzoxMFrOGjGxKQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTQ2NDIzMw==", "bodyText": "formatting a bit awkward", "url": "https://github.com/vividus-framework/vividus/pull/664#discussion_r439464233", "createdAt": "2020-06-12T14:47:10Z", "author": {"login": "valfirst"}, "path": "vividus-plugin-rest-api/src/test/java/org/vividus/bdd/steps/api/HttpCookieStepsTests.java", "diffHunk": "@@ -0,0 +1,149 @@\n+/*\n+ * Copyright 2019-2020 the original author or authors.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.vividus.bdd.steps.api;\n+\n+import static org.mockito.ArgumentMatchers.eq;\n+import static org.mockito.Mockito.mock;\n+import static org.mockito.Mockito.verify;\n+import static org.mockito.Mockito.verifyNoInteractions;\n+import static org.mockito.Mockito.verifyNoMoreInteractions;\n+import static org.mockito.Mockito.when;\n+\n+import java.util.Collections;\n+import java.util.List;\n+import java.util.Set;\n+\n+import org.apache.http.client.CookieStore;\n+import org.apache.http.cookie.Cookie;\n+import org.junit.jupiter.api.BeforeEach;\n+import org.junit.jupiter.api.Test;\n+import org.junit.jupiter.api.extension.ExtendWith;\n+import org.mockito.InjectMocks;\n+import org.mockito.Mock;\n+import org.mockito.Mockito;\n+import org.mockito.junit.jupiter.MockitoExtension;\n+import org.vividus.bdd.context.IBddVariableContext;\n+import org.vividus.bdd.variable.VariableScope;\n+import org.vividus.http.CookieStoreProvider;\n+import org.vividus.softassert.ISoftAssert;\n+\n+@ExtendWith(MockitoExtension.class)\n+class HttpCookieStepsTests\n+{\n+    private static final String NAME = \"name\";\n+    private static final String VALUE = \"value\";\n+    private static final String ANOTHER_PATH = \"/anotherPath\";\n+    private static final String PRESENT_COOKIES_WITH_THE_NAME = \"Present '%d' cookie(-s) with the name '%s'\";\n+\n+    @Mock\n+    private Cookie cookie;\n+\n+    @Mock\n+    private CookieStoreProvider cookieStoreProvider;\n+\n+    @Mock\n+    private IBddVariableContext bddVariableContext;\n+\n+    @Mock\n+    private ISoftAssert softAssert;\n+\n+    @InjectMocks\n+    private HttpCookieSteps httpCookieSteps;\n+\n+    private CookieStore cookieStore;\n+\n+    @BeforeEach\n+    void beforeEach()\n+    {\n+        cookieStore = Mockito.mock(CookieStore.class);\n+        when(cookieStoreProvider.getCookieStore()).thenReturn(cookieStore);\n+    }\n+\n+    @Test\n+    void shouldSaveCookieValueIntoVariableContext()\n+    {\n+        List<Cookie> cookies = List.of(cookie);\n+        when(cookieStore.getCookies()).thenReturn(cookies);\n+        when(cookie.getName()).thenReturn(NAME);\n+        when(cookie.getValue()).thenReturn(VALUE);\n+        Set<VariableScope> scopes = Set.of(VariableScope.SCENARIO);\n+        when(softAssert.assertTrue(String.format(PRESENT_COOKIES_WITH_THE_NAME, cookies.size(), NAME), true))\n+                .thenReturn(true);\n+        httpCookieSteps.saveHttpCookieIntoVariable(NAME, scopes, NAME);\n+        verifyCookieAssertion(cookies);\n+        verify(bddVariableContext).putVariable(scopes, NAME, VALUE);\n+        verifyNoMoreInteractions(softAssert);\n+    }\n+\n+    @Test\n+    void shouldSaveCookieWithRootPathValueIntoVariableContext()\n+    {\n+        Cookie cookieWithAnotherPath = mock(Cookie.class);\n+        List<Cookie> cookies = List.of(cookie, cookieWithAnotherPath);\n+        when(cookieStore.getCookies()).thenReturn(cookies);\n+        when(cookie.getName()).thenReturn(NAME);\n+        when(cookieWithAnotherPath.getName()).thenReturn(NAME);\n+        when(cookie.getPath()).thenReturn(\"/\");\n+        when(cookieWithAnotherPath.getPath()).thenReturn(ANOTHER_PATH);\n+        when(cookie.getValue()).thenReturn(VALUE);\n+        Set<VariableScope> scopes = Set.of(VariableScope.SCENARIO);\n+        when(softAssert.assertTrue(String.format(PRESENT_COOKIES_WITH_THE_NAME, cookies.size(), NAME), true))\n+                .thenReturn(true);\n+        httpCookieSteps.saveHttpCookieIntoVariable(NAME, scopes, NAME);\n+        verifyCookieAssertion(cookies);\n+        verify(bddVariableContext).putVariable(scopes, NAME, VALUE);\n+        verifyNoMoreInteractions(softAssert);\n+    }\n+\n+    @Test\n+    void shouldNotSaveCookiesWithTheSameNameAndNotRootPathVariableContext()\n+    {\n+        Cookie cookieWithAnotherPath = mock(Cookie.class);\n+        List<Cookie> cookies = List.of(cookie, cookieWithAnotherPath);\n+        when(cookieStore.getCookies()).thenReturn(cookies);\n+        when(cookie.getName()).thenReturn(NAME);\n+        when(cookieWithAnotherPath.getName()).thenReturn(NAME);\n+        when(cookie.getPath()).thenReturn(ANOTHER_PATH);\n+        when(cookieWithAnotherPath.getPath()).thenReturn(ANOTHER_PATH + \"/1\");\n+        Set<VariableScope> scopes = Set.of(VariableScope.SCENARIO);\n+        when(softAssert.assertTrue(String.format(PRESENT_COOKIES_WITH_THE_NAME, cookies.size(), NAME), true))\n+                .thenReturn(true);\n+        httpCookieSteps.saveHttpCookieIntoVariable(NAME, scopes, NAME);\n+        verifyCookieAssertion(cookies);\n+        verifyNoInteractions(bddVariableContext);\n+        verify(softAssert).recordFailedAssertion(\n+                String.format(\"Not found cookie with name '%s' and path '/' or was several candidates\", NAME));\n+    }\n+\n+    @Test\n+    void shouldNotSaveNotExistingCookieAndRecordAssertion()\n+    {\n+        List<Cookie> cookies = Collections.emptyList();\n+        when(cookieStore.getCookies()).thenReturn(cookies);\n+        httpCookieSteps.saveHttpCookieIntoVariable(NAME, Set.of(VariableScope.SCENARIO), NAME);\n+        verifyCookieAssertion(cookies);\n+        verifyNoInteractions(bddVariableContext);\n+        verifyNoMoreInteractions(softAssert);\n+    }\n+\n+    private void verifyCookieAssertion(List<Cookie> cookies)\n+    {\n+        verify(softAssert)\n+                .assertTrue(eq(String.format(PRESENT_COOKIES_WITH_THE_NAME, cookies.size(), NAME)),\n+                        eq(!cookies.isEmpty()));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "369dcbd00049b37ce01efcc445dea8f04d657cd9"}, "originalPosition": 147}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 359, "cost": 1, "resetAt": "2021-11-13T12:26:42Z"}}}