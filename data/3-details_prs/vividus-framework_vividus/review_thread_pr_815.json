{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY3ODM1MDU4", "number": 815, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xNFQwODoxODo0N1rOEYYVJQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xNFQwODozMzoxOFrOEYYnJw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkzOTk5OTA5OnYy", "diffSide": "RIGHT", "path": "vividus-bdd-engine/src/test/java/org/vividus/bdd/expression/EncodeUrlExpressionProcessorTests.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xNFQwODoxODo0N1rOHAry0A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xNFQxMTowODo1MFrOHAwvnA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDQ3OTU2OA==", "bodyText": "Users will try to use it as is #{encideUriXyz()} :)", "url": "https://github.com/vividus-framework/vividus/pull/815#discussion_r470479568", "createdAt": "2020-08-14T08:18:47Z", "author": {"login": "ikalinin1"}, "path": "vividus-bdd-engine/src/test/java/org/vividus/bdd/expression/EncodeUrlExpressionProcessorTests.java", "diffHunk": "@@ -0,0 +1,60 @@\n+/*\n+ * Copyright 2019-2020 the original author or authors.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.vividus.bdd.expression;\n+\n+import static com.github.valfirst.slf4jtest.LoggingEvent.warn;\n+import static org.hamcrest.MatcherAssert.assertThat;\n+import static org.hamcrest.Matchers.equalTo;\n+import static org.junit.jupiter.api.Assertions.assertEquals;\n+\n+import java.util.List;\n+import java.util.Optional;\n+\n+import com.github.valfirst.slf4jtest.TestLogger;\n+import com.github.valfirst.slf4jtest.TestLoggerFactory;\n+import com.github.valfirst.slf4jtest.TestLoggerFactoryExtension;\n+\n+import org.junit.jupiter.api.Test;\n+import org.junit.jupiter.api.extension.ExtendWith;\n+import org.junit.jupiter.params.ParameterizedTest;\n+import org.junit.jupiter.params.provider.CsvSource;\n+\n+@ExtendWith(TestLoggerFactoryExtension.class)\n+class EncodeUrlExpressionProcessorTests\n+{\n+    private final IExpressionProcessor processor = new EncodeUrlExpressionProcessor();\n+\n+    private final TestLogger logger = TestLoggerFactory.getTestLogger(EncodeUrlExpressionProcessor.class);\n+\n+    @Test\n+    void testExecuteWithUnsupportedException()\n+    {\n+        assertEquals(Optional.empty(), processor.execute(\"encodeUri(value)\"));\n+    }\n+\n+    @ParameterizedTest(name = \"{index}: for expression \\\"{0}\\\", result is \\\"{1}\\\"\")\n+    @CsvSource({\n+        \"encodeUrl(/wiki/w3schools), %2Fwiki%2Fw3schools\",\n+        \"encodeUrl(/wls/recipes#!/), %2Fwls%2Frecipes%23%21%2F\"\n+    })\n+    void testExecute(String expression, String expected)\n+    {\n+        assertEquals(Optional.of(expected), processor.execute(expression));\n+        assertThat(logger.getLoggingEvents(), equalTo(List.of(warn(\n+                \"#{encodeUrl(..)} expression is deprecated, use set of #{encodeUriXyz(..)} expressions instead\"))));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ecd1d921d70a9f05cacae035183ac75eb5f17fcb"}, "originalPosition": 58}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDQ5NDU4OQ==", "bodyText": "any suggestions how to make it better?\n\nencodeUriXyz\nencodeUriXXX\nencodeUri***\njust message\n...", "url": "https://github.com/vividus-framework/vividus/pull/815#discussion_r470494589", "createdAt": "2020-08-14T08:46:30Z", "author": {"login": "valfirst"}, "path": "vividus-bdd-engine/src/test/java/org/vividus/bdd/expression/EncodeUrlExpressionProcessorTests.java", "diffHunk": "@@ -0,0 +1,60 @@\n+/*\n+ * Copyright 2019-2020 the original author or authors.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.vividus.bdd.expression;\n+\n+import static com.github.valfirst.slf4jtest.LoggingEvent.warn;\n+import static org.hamcrest.MatcherAssert.assertThat;\n+import static org.hamcrest.Matchers.equalTo;\n+import static org.junit.jupiter.api.Assertions.assertEquals;\n+\n+import java.util.List;\n+import java.util.Optional;\n+\n+import com.github.valfirst.slf4jtest.TestLogger;\n+import com.github.valfirst.slf4jtest.TestLoggerFactory;\n+import com.github.valfirst.slf4jtest.TestLoggerFactoryExtension;\n+\n+import org.junit.jupiter.api.Test;\n+import org.junit.jupiter.api.extension.ExtendWith;\n+import org.junit.jupiter.params.ParameterizedTest;\n+import org.junit.jupiter.params.provider.CsvSource;\n+\n+@ExtendWith(TestLoggerFactoryExtension.class)\n+class EncodeUrlExpressionProcessorTests\n+{\n+    private final IExpressionProcessor processor = new EncodeUrlExpressionProcessor();\n+\n+    private final TestLogger logger = TestLoggerFactory.getTestLogger(EncodeUrlExpressionProcessor.class);\n+\n+    @Test\n+    void testExecuteWithUnsupportedException()\n+    {\n+        assertEquals(Optional.empty(), processor.execute(\"encodeUri(value)\"));\n+    }\n+\n+    @ParameterizedTest(name = \"{index}: for expression \\\"{0}\\\", result is \\\"{1}\\\"\")\n+    @CsvSource({\n+        \"encodeUrl(/wiki/w3schools), %2Fwiki%2Fw3schools\",\n+        \"encodeUrl(/wls/recipes#!/), %2Fwls%2Frecipes%23%21%2F\"\n+    })\n+    void testExecute(String expression, String expected)\n+    {\n+        assertEquals(Optional.of(expected), processor.execute(expression));\n+        assertThat(logger.getLoggingEvents(), equalTo(List.of(warn(\n+                \"#{encodeUrl(..)} expression is deprecated, use set of #{encodeUriXyz(..)} expressions instead\"))));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDQ3OTU2OA=="}, "originalCommit": {"oid": "ecd1d921d70a9f05cacae035183ac75eb5f17fcb"}, "originalPosition": 58}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDU2MDY2OA==", "bodyText": "encodeUri<part> ?", "url": "https://github.com/vividus-framework/vividus/pull/815#discussion_r470560668", "createdAt": "2020-08-14T11:08:50Z", "author": {"login": "ikalinin1"}, "path": "vividus-bdd-engine/src/test/java/org/vividus/bdd/expression/EncodeUrlExpressionProcessorTests.java", "diffHunk": "@@ -0,0 +1,60 @@\n+/*\n+ * Copyright 2019-2020 the original author or authors.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.vividus.bdd.expression;\n+\n+import static com.github.valfirst.slf4jtest.LoggingEvent.warn;\n+import static org.hamcrest.MatcherAssert.assertThat;\n+import static org.hamcrest.Matchers.equalTo;\n+import static org.junit.jupiter.api.Assertions.assertEquals;\n+\n+import java.util.List;\n+import java.util.Optional;\n+\n+import com.github.valfirst.slf4jtest.TestLogger;\n+import com.github.valfirst.slf4jtest.TestLoggerFactory;\n+import com.github.valfirst.slf4jtest.TestLoggerFactoryExtension;\n+\n+import org.junit.jupiter.api.Test;\n+import org.junit.jupiter.api.extension.ExtendWith;\n+import org.junit.jupiter.params.ParameterizedTest;\n+import org.junit.jupiter.params.provider.CsvSource;\n+\n+@ExtendWith(TestLoggerFactoryExtension.class)\n+class EncodeUrlExpressionProcessorTests\n+{\n+    private final IExpressionProcessor processor = new EncodeUrlExpressionProcessor();\n+\n+    private final TestLogger logger = TestLoggerFactory.getTestLogger(EncodeUrlExpressionProcessor.class);\n+\n+    @Test\n+    void testExecuteWithUnsupportedException()\n+    {\n+        assertEquals(Optional.empty(), processor.execute(\"encodeUri(value)\"));\n+    }\n+\n+    @ParameterizedTest(name = \"{index}: for expression \\\"{0}\\\", result is \\\"{1}\\\"\")\n+    @CsvSource({\n+        \"encodeUrl(/wiki/w3schools), %2Fwiki%2Fw3schools\",\n+        \"encodeUrl(/wls/recipes#!/), %2Fwls%2Frecipes%23%21%2F\"\n+    })\n+    void testExecute(String expression, String expected)\n+    {\n+        assertEquals(Optional.of(expected), processor.execute(expression));\n+        assertThat(logger.getLoggingEvents(), equalTo(List.of(warn(\n+                \"#{encodeUrl(..)} expression is deprecated, use set of #{encodeUriXyz(..)} expressions instead\"))));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDQ3OTU2OA=="}, "originalCommit": {"oid": "ecd1d921d70a9f05cacae035183ac75eb5f17fcb"}, "originalPosition": 58}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk0MDAxMTAyOnYy", "diffSide": "RIGHT", "path": "vividus-bdd-engine/src/main/java/org/vividus/bdd/expression/EncodeUrlExpressionProcessor.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xNFQwODoyMjo1OFrOHAr6hg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xNFQwODo0MzowNlrOHAsmAA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDQ4MTU0Mg==", "bodyText": "Can we just refactor this expression to delegate proper part encoding to a valid method?", "url": "https://github.com/vividus-framework/vividus/pull/815#discussion_r470481542", "createdAt": "2020-08-14T08:22:58Z", "author": {"login": "ikalinin1"}, "path": "vividus-bdd-engine/src/main/java/org/vividus/bdd/expression/EncodeUrlExpressionProcessor.java", "diffHunk": "@@ -0,0 +1,49 @@\n+/*\n+ * Copyright 2019-2020 the original author or authors.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.vividus.bdd.expression;\n+\n+import static java.nio.charset.StandardCharsets.UTF_8;\n+\n+import java.net.URLEncoder;\n+import java.util.Optional;\n+\n+import javax.inject.Named;\n+\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * @deprecated use set of #{encodeUriXyz(..)} expressions instead\n+ */\n+@Named\n+@Deprecated(forRemoval = true, since = \"0.2.7\")\n+public class EncodeUrlExpressionProcessor extends UnaryExpressionProcessor\n+{\n+    private static final Logger LOGGER = LoggerFactory.getLogger(EncodeUrlExpressionProcessor.class);\n+\n+    public EncodeUrlExpressionProcessor()\n+    {\n+        super(\"encodeUrl\", input -> URLEncoder.encode(input, UTF_8));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ecd1d921d70a9f05cacae035183ac75eb5f17fcb"}, "originalPosition": 40}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDQ5MjY3Mg==", "bodyText": "there is no such valid method :)", "url": "https://github.com/vividus-framework/vividus/pull/815#discussion_r470492672", "createdAt": "2020-08-14T08:43:06Z", "author": {"login": "valfirst"}, "path": "vividus-bdd-engine/src/main/java/org/vividus/bdd/expression/EncodeUrlExpressionProcessor.java", "diffHunk": "@@ -0,0 +1,49 @@\n+/*\n+ * Copyright 2019-2020 the original author or authors.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.vividus.bdd.expression;\n+\n+import static java.nio.charset.StandardCharsets.UTF_8;\n+\n+import java.net.URLEncoder;\n+import java.util.Optional;\n+\n+import javax.inject.Named;\n+\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * @deprecated use set of #{encodeUriXyz(..)} expressions instead\n+ */\n+@Named\n+@Deprecated(forRemoval = true, since = \"0.2.7\")\n+public class EncodeUrlExpressionProcessor extends UnaryExpressionProcessor\n+{\n+    private static final Logger LOGGER = LoggerFactory.getLogger(EncodeUrlExpressionProcessor.class);\n+\n+    public EncodeUrlExpressionProcessor()\n+    {\n+        super(\"encodeUrl\", input -> URLEncoder.encode(input, UTF_8));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDQ4MTU0Mg=="}, "originalCommit": {"oid": "ecd1d921d70a9f05cacae035183ac75eb5f17fcb"}, "originalPosition": 40}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk0MDAyMjQzOnYy", "diffSide": "RIGHT", "path": "docs/modules/plugins/pages/plugin-rest-api.adoc", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xNFQwODoyNjo0NVrOHAsBqQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xNFQwODo0MjoxNVrOHAskQw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDQ4MzM2OQ==", "bodyText": "|Expression\n|Result", "url": "https://github.com/vividus-framework/vividus/pull/815#discussion_r470483369", "createdAt": "2020-08-14T08:26:45Z", "author": {"login": "ikalinin1"}, "path": "docs/modules/plugins/pages/plugin-rest-api.adoc", "diffHunk": "@@ -48,3 +48,69 @@ Then server `$hostname` supports secure protocols that $rule `$protocols`\n Scenario: Verify that the server supports TLSv1.3 and TLSv1.2 protocols\n Then server `vividus-test-site.herokuapp.com` supports secure protocols that contain `TLSv1.3,TLSv1.2`\n ----\n+\n+\n+== Expressions\n+\n+\n+=== URI Encoding\n+\n+`${encodeUriXyz(..)}` is a family of expressions that encode specific URI components (e.g. path, query)\n+by percent encoding illegal characters, which includes non-US-ASCII characters, and also characters that\n+are otherwise illegal within the given URI component type, as defined in\n+https://www.ietf.org/rfc/rfc3986.txt[RFC 3986].\n+\n+[cols=\"3,2\", options=\"header\"]\n+|===\n+|Syntax\n+|Description\n+\n+|`#{encodeUriUserInfo($userInfo)}`\n+|Encode the given URI user info\n+\n+|`#{encodeUriHost($host)}`\n+|Encode the given URI host\n+\n+|`#{encodeUriPath($path)}`\n+|Encode the given URI path\n+\n+|`#{encodeUriPathSegment($segment)}`\n+|Encode the given URI path segment\n+\n+|`#{encodeUriQuery($query)}`\n+|Encode the given URI query\n+\n+|`#{encodeUriQueryParameter($queryParameter)}`\n+|Encode the given URI query parameter\n+\n+|`#{encodeUriFragment($fragment)}`\n+|Encode the given URI fragment\n+|===\n+\n+==== Examples\n+\n+|===\n+|Expression |Result", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ecd1d921d70a9f05cacae035183ac75eb5f17fcb"}, "originalPosition": 46}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDQ5MjIyNw==", "bodyText": "it won't work without options=\"header\", so the current approach looks more concise", "url": "https://github.com/vividus-framework/vividus/pull/815#discussion_r470492227", "createdAt": "2020-08-14T08:42:15Z", "author": {"login": "valfirst"}, "path": "docs/modules/plugins/pages/plugin-rest-api.adoc", "diffHunk": "@@ -48,3 +48,69 @@ Then server `$hostname` supports secure protocols that $rule `$protocols`\n Scenario: Verify that the server supports TLSv1.3 and TLSv1.2 protocols\n Then server `vividus-test-site.herokuapp.com` supports secure protocols that contain `TLSv1.3,TLSv1.2`\n ----\n+\n+\n+== Expressions\n+\n+\n+=== URI Encoding\n+\n+`${encodeUriXyz(..)}` is a family of expressions that encode specific URI components (e.g. path, query)\n+by percent encoding illegal characters, which includes non-US-ASCII characters, and also characters that\n+are otherwise illegal within the given URI component type, as defined in\n+https://www.ietf.org/rfc/rfc3986.txt[RFC 3986].\n+\n+[cols=\"3,2\", options=\"header\"]\n+|===\n+|Syntax\n+|Description\n+\n+|`#{encodeUriUserInfo($userInfo)}`\n+|Encode the given URI user info\n+\n+|`#{encodeUriHost($host)}`\n+|Encode the given URI host\n+\n+|`#{encodeUriPath($path)}`\n+|Encode the given URI path\n+\n+|`#{encodeUriPathSegment($segment)}`\n+|Encode the given URI path segment\n+\n+|`#{encodeUriQuery($query)}`\n+|Encode the given URI query\n+\n+|`#{encodeUriQueryParameter($queryParameter)}`\n+|Encode the given URI query parameter\n+\n+|`#{encodeUriFragment($fragment)}`\n+|Encode the given URI fragment\n+|===\n+\n+==== Examples\n+\n+|===\n+|Expression |Result", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDQ4MzM2OQ=="}, "originalCommit": {"oid": "ecd1d921d70a9f05cacae035183ac75eb5f17fcb"}, "originalPosition": 46}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk0MDA0NTE5OnYy", "diffSide": "RIGHT", "path": "vividus-tests/src/main/resources/story/integration/HTTP.story", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xNFQwODozMzoxOFrOHAsPaQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xNFQwODozMzoxOFrOHAsPaQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDQ4Njg4OQ==", "bodyText": "I propose to use URI the same as for expression.", "url": "https://github.com/vividus-framework/vividus/pull/815#discussion_r470486889", "createdAt": "2020-08-14T08:33:18Z", "author": {"login": "ikalinin1"}, "path": "vividus-tests/src/main/resources/story/integration/HTTP.story", "diffHunk": "@@ -22,12 +22,12 @@ When I send HTTP GET to the relative URL '/anything/path-with-&-ampersand'\n Then the response code is equal to '200'\n Then a JSON element by the JSON path '$.url' is equal to '${http-endpoint}anything/path-with-&-ampersand'\n \n-Scenario: Verify handling of ampersand character in URL query\n-When I send HTTP GET to the relative URL '/get?key=#{encodeUrl(a&b)}'\n+Scenario: Verify handling of ampersand and space characters in URL query parameter", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ecd1d921d70a9f05cacae035183ac75eb5f17fcb"}, "originalPosition": 6}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 194, "cost": 1, "resetAt": "2021-11-13T12:26:42Z"}}}