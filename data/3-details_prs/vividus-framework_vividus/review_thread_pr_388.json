{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg3ODA5MDk1", "number": 388, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xM1QxNDo1ODoyOFrODn3RnA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNFQwNjo0MzozN1rODoCR4g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQzMTI2Njg0OnYy", "diffSide": "RIGHT", "path": "vividus-plugin-web-app/src/main/java/org/vividus/selenium/WebDriverFactory.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xM1QxNDo1ODoyOFrOF2G5ug==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xM1QxNDo1ODoyOFrOF2G5ug==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjI4MDUwNg==", "bodyText": "WebDriverType webDriverType = Optional.ofNullable(desiredCapabilities.getCapability(CapabilityType.BROWSER_NAME))\n                .map(String.class::cast)\n                .map(WebDriverType::valueOf)\n                .orElse(this.webDriverType);\nreturn getWebDriver(webDriverType, desiredCapabilities);", "url": "https://github.com/vividus-framework/vividus/pull/388#discussion_r392280506", "createdAt": "2020-03-13T14:58:28Z", "author": {"login": "valfirst"}, "path": "vividus-plugin-web-app/src/main/java/org/vividus/selenium/WebDriverFactory.java", "diffHunk": "@@ -71,35 +79,57 @@\n     private IJsonUtils jsonUtils;\n \n     private final Supplier<DesiredCapabilities> seleniumGridDesiredCapabilities = Suppliers.memoize(\n-        () -> new DesiredCapabilities(propertyParser.getPropertyValuesByPrefix(SELENIUM_GRID_PROPERTY_PREFIX)));\n+        () -> getCapabilitiesByFamily(SELENIUM_GRID_PROPERTY_PREFIX));\n \n-    private final ConcurrentHashMap<WebDriverType, WebDriverConfiguration> configurations = new ConcurrentHashMap<>();\n+    private final Supplier<DesiredCapabilities> localDriverDesiredCapabilities = Suppliers.memoize(\n+        () -> getCapabilitiesByFamily(LOCAL_DRIVER_PROPERTY_PREFIX));\n \n-    @Override\n-    public WebDriver getWebDriver(DesiredCapabilities desiredCapabilities)\n+    private final LoadingCache<Boolean, DesiredCapabilities> webDriverCapabilities = CacheBuilder.newBuilder()\n+            .build(new CacheLoader<Boolean, DesiredCapabilities>()\n+            {\n+                public DesiredCapabilities load(Boolean local)\n+                {\n+                    DesiredCapabilities localCapabilities = localDriverDesiredCapabilities.get();\n+                    if (local == true)\n+                    {\n+                        return localCapabilities;\n+                    }\n+                    return localCapabilities.merge(seleniumGridDesiredCapabilities.get());\n+                }\n+            });\n+\n+    private final Map<WebDriverType, WebDriverConfiguration> configurations = new ConcurrentHashMap<>();\n+\n+    private DesiredCapabilities getCapabilitiesByFamily(String prefix)\n     {\n-        return getWebDriver(webDriverType, desiredCapabilities);\n+        return propertyParser.getPropertyValuesByPrefix(prefix)\n+            .entrySet()\n+            .stream()\n+            .map(e -> equalsAnyIgnoreCase(e.getValue(), \"true\", \"false\")\n+                ? Map.entry(e.getKey(), Boolean.parseBoolean(e.getValue()))\n+                : e)\n+            .collect(Collectors.collectingAndThen(toMap(Entry::getKey, Entry::getValue), DesiredCapabilities::new));\n     }\n \n     @Override\n-    public WebDriver getWebDriver(WebDriverType webDriverType, DesiredCapabilities desiredCapabilities)\n+    public WebDriver getWebDriver(DesiredCapabilities desiredCapabilities)\n     {\n-        WebDriverConfiguration configuration = getWebDriverConfiguration(webDriverType, true);\n-        return createWebDriver(webDriverType.getWebDriver(desiredCapabilities, configuration));\n+        return Optional.ofNullable(desiredCapabilities.getCapability(CapabilityType.BROWSER_NAME))\n+                       .map(String.class::cast)\n+                       .map(browserName -> getWebDriver(WebDriverType.valueOf(browserName), desiredCapabilities))\n+                       .orElseGet(() -> getWebDriver(this.webDriverType, desiredCapabilities));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e64fadd7135387497e48d4a72dd17e05f2748b2b"}, "originalPosition": 81}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQzMTI2OTIwOnYy", "diffSide": "RIGHT", "path": "vividus-plugin-web-app/src/main/java/org/vividus/selenium/WebDriverFactory.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xM1QxNDo1OTowNVrOF2G7VA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xM1QxNDo1OTowNVrOF2G7VA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjI4MDkxNg==", "bodyText": "to be fully on a safe side: if (local == Boolean.TRUE)", "url": "https://github.com/vividus-framework/vividus/pull/388#discussion_r392280916", "createdAt": "2020-03-13T14:59:05Z", "author": {"login": "valfirst"}, "path": "vividus-plugin-web-app/src/main/java/org/vividus/selenium/WebDriverFactory.java", "diffHunk": "@@ -71,35 +79,57 @@\n     private IJsonUtils jsonUtils;\n \n     private final Supplier<DesiredCapabilities> seleniumGridDesiredCapabilities = Suppliers.memoize(\n-        () -> new DesiredCapabilities(propertyParser.getPropertyValuesByPrefix(SELENIUM_GRID_PROPERTY_PREFIX)));\n+        () -> getCapabilitiesByFamily(SELENIUM_GRID_PROPERTY_PREFIX));\n \n-    private final ConcurrentHashMap<WebDriverType, WebDriverConfiguration> configurations = new ConcurrentHashMap<>();\n+    private final Supplier<DesiredCapabilities> localDriverDesiredCapabilities = Suppliers.memoize(\n+        () -> getCapabilitiesByFamily(LOCAL_DRIVER_PROPERTY_PREFIX));\n \n-    @Override\n-    public WebDriver getWebDriver(DesiredCapabilities desiredCapabilities)\n+    private final LoadingCache<Boolean, DesiredCapabilities> webDriverCapabilities = CacheBuilder.newBuilder()\n+            .build(new CacheLoader<Boolean, DesiredCapabilities>()\n+            {\n+                public DesiredCapabilities load(Boolean local)\n+                {\n+                    DesiredCapabilities localCapabilities = localDriverDesiredCapabilities.get();\n+                    if (local == true)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e64fadd7135387497e48d4a72dd17e05f2748b2b"}, "originalPosition": 50}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQzMzA2Nzc5OnYy", "diffSide": "RIGHT", "path": "vividus-plugin-web-app/src/main/java/org/vividus/selenium/WebDriverFactory.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNFQwNjozODo1MlrOF2YGvA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNFQwNjozODo1MlrOF2YGvA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjU2MjM2NA==", "bodyText": "getCapabilitiesByFamily(String prefix) -> getCapabilitiesByPrefix(String prefix) ?", "url": "https://github.com/vividus-framework/vividus/pull/388#discussion_r392562364", "createdAt": "2020-03-14T06:38:52Z", "author": {"login": "uarlouski"}, "path": "vividus-plugin-web-app/src/main/java/org/vividus/selenium/WebDriverFactory.java", "diffHunk": "@@ -71,35 +79,57 @@\n     private IJsonUtils jsonUtils;\n \n     private final Supplier<DesiredCapabilities> seleniumGridDesiredCapabilities = Suppliers.memoize(\n-        () -> new DesiredCapabilities(propertyParser.getPropertyValuesByPrefix(SELENIUM_GRID_PROPERTY_PREFIX)));\n+        () -> getCapabilitiesByFamily(SELENIUM_GRID_PROPERTY_PREFIX));\n \n-    private final ConcurrentHashMap<WebDriverType, WebDriverConfiguration> configurations = new ConcurrentHashMap<>();\n+    private final Supplier<DesiredCapabilities> localDriverDesiredCapabilities = Suppliers.memoize(\n+        () -> getCapabilitiesByFamily(LOCAL_DRIVER_PROPERTY_PREFIX));\n \n-    @Override\n-    public WebDriver getWebDriver(DesiredCapabilities desiredCapabilities)\n+    private final LoadingCache<Boolean, DesiredCapabilities> webDriverCapabilities = CacheBuilder.newBuilder()\n+            .build(new CacheLoader<Boolean, DesiredCapabilities>()\n+            {\n+                public DesiredCapabilities load(Boolean local)\n+                {\n+                    DesiredCapabilities localCapabilities = localDriverDesiredCapabilities.get();\n+                    if (local == true)\n+                    {\n+                        return localCapabilities;\n+                    }\n+                    return localCapabilities.merge(seleniumGridDesiredCapabilities.get());\n+                }\n+            });\n+\n+    private final Map<WebDriverType, WebDriverConfiguration> configurations = new ConcurrentHashMap<>();\n+\n+    private DesiredCapabilities getCapabilitiesByFamily(String prefix)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e64fadd7135387497e48d4a72dd17e05f2748b2b"}, "originalPosition": 60}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQzMzA2OTc4OnYy", "diffSide": "RIGHT", "path": "vividus-plugin-web-app/src/main/java/org/vividus/selenium/WebDriverFactory.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNFQwNjo0MzozN1rOF2YHrg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNlQwNjozOTo0MlrOF2m9hw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjU2MjYwNg==", "bodyText": "can we reuse https://commons.apache.org/proper/commons-lang/apidocs/org/apache/commons/lang3/BooleanUtils.html#toBooleanObject-java.lang.String- here?", "url": "https://github.com/vividus-framework/vividus/pull/388#discussion_r392562606", "createdAt": "2020-03-14T06:43:37Z", "author": {"login": "uarlouski"}, "path": "vividus-plugin-web-app/src/main/java/org/vividus/selenium/WebDriverFactory.java", "diffHunk": "@@ -71,35 +79,57 @@\n     private IJsonUtils jsonUtils;\n \n     private final Supplier<DesiredCapabilities> seleniumGridDesiredCapabilities = Suppliers.memoize(\n-        () -> new DesiredCapabilities(propertyParser.getPropertyValuesByPrefix(SELENIUM_GRID_PROPERTY_PREFIX)));\n+        () -> getCapabilitiesByFamily(SELENIUM_GRID_PROPERTY_PREFIX));\n \n-    private final ConcurrentHashMap<WebDriverType, WebDriverConfiguration> configurations = new ConcurrentHashMap<>();\n+    private final Supplier<DesiredCapabilities> localDriverDesiredCapabilities = Suppliers.memoize(\n+        () -> getCapabilitiesByFamily(LOCAL_DRIVER_PROPERTY_PREFIX));\n \n-    @Override\n-    public WebDriver getWebDriver(DesiredCapabilities desiredCapabilities)\n+    private final LoadingCache<Boolean, DesiredCapabilities> webDriverCapabilities = CacheBuilder.newBuilder()\n+            .build(new CacheLoader<Boolean, DesiredCapabilities>()\n+            {\n+                public DesiredCapabilities load(Boolean local)\n+                {\n+                    DesiredCapabilities localCapabilities = localDriverDesiredCapabilities.get();\n+                    if (local == true)\n+                    {\n+                        return localCapabilities;\n+                    }\n+                    return localCapabilities.merge(seleniumGridDesiredCapabilities.get());\n+                }\n+            });\n+\n+    private final Map<WebDriverType, WebDriverConfiguration> configurations = new ConcurrentHashMap<>();\n+\n+    private DesiredCapabilities getCapabilitiesByFamily(String prefix)\n     {\n-        return getWebDriver(webDriverType, desiredCapabilities);\n+        return propertyParser.getPropertyValuesByPrefix(prefix)\n+            .entrySet()\n+            .stream()\n+            .map(e -> equalsAnyIgnoreCase(e.getValue(), \"true\", \"false\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e64fadd7135387497e48d4a72dd17e05f2748b2b"}, "originalPosition": 66}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjgwNTc2Nw==", "bodyText": "It will cause unpredictable side effects", "url": "https://github.com/vividus-framework/vividus/pull/388#discussion_r392805767", "createdAt": "2020-03-16T06:39:42Z", "author": {"login": "ikalinin1"}, "path": "vividus-plugin-web-app/src/main/java/org/vividus/selenium/WebDriverFactory.java", "diffHunk": "@@ -71,35 +79,57 @@\n     private IJsonUtils jsonUtils;\n \n     private final Supplier<DesiredCapabilities> seleniumGridDesiredCapabilities = Suppliers.memoize(\n-        () -> new DesiredCapabilities(propertyParser.getPropertyValuesByPrefix(SELENIUM_GRID_PROPERTY_PREFIX)));\n+        () -> getCapabilitiesByFamily(SELENIUM_GRID_PROPERTY_PREFIX));\n \n-    private final ConcurrentHashMap<WebDriverType, WebDriverConfiguration> configurations = new ConcurrentHashMap<>();\n+    private final Supplier<DesiredCapabilities> localDriverDesiredCapabilities = Suppliers.memoize(\n+        () -> getCapabilitiesByFamily(LOCAL_DRIVER_PROPERTY_PREFIX));\n \n-    @Override\n-    public WebDriver getWebDriver(DesiredCapabilities desiredCapabilities)\n+    private final LoadingCache<Boolean, DesiredCapabilities> webDriverCapabilities = CacheBuilder.newBuilder()\n+            .build(new CacheLoader<Boolean, DesiredCapabilities>()\n+            {\n+                public DesiredCapabilities load(Boolean local)\n+                {\n+                    DesiredCapabilities localCapabilities = localDriverDesiredCapabilities.get();\n+                    if (local == true)\n+                    {\n+                        return localCapabilities;\n+                    }\n+                    return localCapabilities.merge(seleniumGridDesiredCapabilities.get());\n+                }\n+            });\n+\n+    private final Map<WebDriverType, WebDriverConfiguration> configurations = new ConcurrentHashMap<>();\n+\n+    private DesiredCapabilities getCapabilitiesByFamily(String prefix)\n     {\n-        return getWebDriver(webDriverType, desiredCapabilities);\n+        return propertyParser.getPropertyValuesByPrefix(prefix)\n+            .entrySet()\n+            .stream()\n+            .map(e -> equalsAnyIgnoreCase(e.getValue(), \"true\", \"false\")", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjU2MjYwNg=="}, "originalCommit": {"oid": "e64fadd7135387497e48d4a72dd17e05f2748b2b"}, "originalPosition": 66}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 466, "cost": 1, "resetAt": "2021-11-13T12:26:42Z"}}}