{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTM2MDc0MjIy", "number": 1216, "title": "[plugin-browserstack] Add link to public browserstack report", "bodyText": "", "createdAt": "2020-12-10T16:47:22Z", "url": "https://github.com/vividus-framework/vividus/pull/1216", "merged": true, "mergeCommit": {"oid": "0c0e76a3ed4b195fff848094760318903065d560"}, "closed": true, "closedAt": "2020-12-17T06:43:21Z", "author": {"login": "uarlouski"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdk2rcVAFqTU0OTQyNDU4Nw==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdm84sPgFqTU1NDI5NDE3OA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ5NDI0NTg3", "url": "https://github.com/vividus-framework/vividus/pull/1216#pullrequestreview-549424587", "createdAt": "2020-12-10T17:16:11Z", "commit": {"oid": "3ad87e9eb71060c80a84f75d3fdf99d6ef8f5dcb"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMFQxNzoxNjoxMVrOIDUVHQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMFQxNzoxOTo0MlrOIDUfDA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDM0OTcyNQ==", "bodyText": "why is it needed?", "url": "https://github.com/vividus-framework/vividus/pull/1216#discussion_r540349725", "createdAt": "2020-12-10T17:16:11Z", "author": {"login": "valfirst"}, "path": "vividus-allure-adaptor/src/main/java/org/vividus/bdd/report/allure/AllureStoryReporter.java", "diffHunk": "@@ -441,6 +442,23 @@ public void onAttachmentPublish(AttachmentPublishEvent event)\n         lifecycle.addAttachment(attachment.getTitle(), attachment.getContentType(), null, attachment.getContent());\n     }\n \n+    @Subscribe\n+    public void onLinkPublish(LinkPublishEvent event)\n+    {\n+        lifecycle.updateTestCase(getRootStepId(), result ->\n+        {\n+            boolean exists = result.getLinks().stream()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3ad87e9eb71060c80a84f75d3fdf99d6ef8f5dcb"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDM0OTg0Ng==", "bodyText": "why tms?", "url": "https://github.com/vividus-framework/vividus/pull/1216#discussion_r540349846", "createdAt": "2020-12-10T17:16:21Z", "author": {"login": "valfirst"}, "path": "vividus-allure-adaptor/src/main/java/org/vividus/bdd/report/allure/AllureStoryReporter.java", "diffHunk": "@@ -441,6 +442,23 @@ public void onAttachmentPublish(AttachmentPublishEvent event)\n         lifecycle.addAttachment(attachment.getTitle(), attachment.getContentType(), null, attachment.getContent());\n     }\n \n+    @Subscribe\n+    public void onLinkPublish(LinkPublishEvent event)\n+    {\n+        lifecycle.updateTestCase(getRootStepId(), result ->\n+        {\n+            boolean exists = result.getLinks().stream()\n+                                              .anyMatch(l -> l.getUrl().equals(event.getUrl())\n+                                                      && l.getName().equals(event.getName()));\n+\n+            if (!exists)\n+            {\n+                Link link = ResultsUtils.createLink(null, event.getName(), event.getUrl(), \"tms\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3ad87e9eb71060c80a84f75d3fdf99d6ef8f5dcb"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDM1MTk2OQ==", "bodyText": "I believe you can have a sinlge class for all BS steps (only 2)", "url": "https://github.com/vividus-framework/vividus/pull/1216#discussion_r540351969", "createdAt": "2020-12-10T17:19:18Z", "author": {"login": "valfirst"}, "path": "vividus-plugin-browserstack/src/main/java/org/vividus/bdd/browserstack/steps/BrowserStackSteps.java", "diffHunk": "@@ -0,0 +1,50 @@\n+/*\n+ * Copyright 2019-2020 the original author or authors.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.vividus.bdd.browserstack.steps;\n+\n+import com.browserstack.automate.model.Session;\n+import com.browserstack.client.exception.BrowserStackException;\n+import com.google.common.eventbus.EventBus;\n+\n+import org.jbehave.core.annotations.AfterScenario;\n+import org.openqa.selenium.remote.RemoteWebDriver;\n+import org.vividus.browserstack.BrowserStackAutomateClient;\n+import org.vividus.reporter.event.LinkPublishEvent;\n+import org.vividus.selenium.IWebDriverProvider;\n+\n+public class BrowserStackSteps\n+{\n+    private final IWebDriverProvider webDriverProvider;\n+    private final EventBus eventBus;\n+    private final BrowserStackAutomateClient appAutomateClient;\n+\n+    public BrowserStackSteps(IWebDriverProvider webDriverProvider, EventBus eventBus,\n+            BrowserStackAutomateClient appAutomateClient)\n+    {\n+        this.webDriverProvider = webDriverProvider;\n+        this.eventBus = eventBus;\n+        this.appAutomateClient = appAutomateClient;\n+    }\n+\n+    @AfterScenario\n+    public void publishReport() throws BrowserStackException", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3ad87e9eb71060c80a84f75d3fdf99d6ef8f5dcb"}, "originalPosition": 44}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDM1MjI2OA==", "bodyText": "publishSessionLink", "url": "https://github.com/vividus-framework/vividus/pull/1216#discussion_r540352268", "createdAt": "2020-12-10T17:19:42Z", "author": {"login": "valfirst"}, "path": "vividus-plugin-browserstack/src/main/java/org/vividus/bdd/browserstack/steps/BrowserStackSteps.java", "diffHunk": "@@ -0,0 +1,50 @@\n+/*\n+ * Copyright 2019-2020 the original author or authors.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.vividus.bdd.browserstack.steps;\n+\n+import com.browserstack.automate.model.Session;\n+import com.browserstack.client.exception.BrowserStackException;\n+import com.google.common.eventbus.EventBus;\n+\n+import org.jbehave.core.annotations.AfterScenario;\n+import org.openqa.selenium.remote.RemoteWebDriver;\n+import org.vividus.browserstack.BrowserStackAutomateClient;\n+import org.vividus.reporter.event.LinkPublishEvent;\n+import org.vividus.selenium.IWebDriverProvider;\n+\n+public class BrowserStackSteps\n+{\n+    private final IWebDriverProvider webDriverProvider;\n+    private final EventBus eventBus;\n+    private final BrowserStackAutomateClient appAutomateClient;\n+\n+    public BrowserStackSteps(IWebDriverProvider webDriverProvider, EventBus eventBus,\n+            BrowserStackAutomateClient appAutomateClient)\n+    {\n+        this.webDriverProvider = webDriverProvider;\n+        this.eventBus = eventBus;\n+        this.appAutomateClient = appAutomateClient;\n+    }\n+\n+    @AfterScenario\n+    public void publishReport() throws BrowserStackException", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3ad87e9eb71060c80a84f75d3fdf99d6ef8f5dcb"}, "originalPosition": 44}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ5NDM0ODkw", "url": "https://github.com/vividus-framework/vividus/pull/1216#pullrequestreview-549434890", "createdAt": "2020-12-10T17:27:43Z", "commit": {"oid": "3ad87e9eb71060c80a84f75d3fdf99d6ef8f5dcb"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMFQxNzoyNzo0NFrOIDU1kw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMFQxNzoyNzo0NFrOIDU1kw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDM1ODAzNQ==", "bodyText": "what about caching event.getUrl/getName?", "url": "https://github.com/vividus-framework/vividus/pull/1216#discussion_r540358035", "createdAt": "2020-12-10T17:27:44Z", "author": {"login": "ikalinin1"}, "path": "vividus-allure-adaptor/src/main/java/org/vividus/bdd/report/allure/AllureStoryReporter.java", "diffHunk": "@@ -441,6 +442,23 @@ public void onAttachmentPublish(AttachmentPublishEvent event)\n         lifecycle.addAttachment(attachment.getTitle(), attachment.getContentType(), null, attachment.getContent());\n     }\n \n+    @Subscribe\n+    public void onLinkPublish(LinkPublishEvent event)\n+    {\n+        lifecycle.updateTestCase(getRootStepId(), result ->\n+        {\n+            boolean exists = result.getLinks().stream()\n+                                              .anyMatch(l -> l.getUrl().equals(event.getUrl())", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3ad87e9eb71060c80a84f75d3fdf99d6ef8f5dcb"}, "originalPosition": 18}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3ad87e9eb71060c80a84f75d3fdf99d6ef8f5dcb", "author": {"user": {"login": "uarlouski", "name": "Uladzislau Arlouski"}}, "url": "https://github.com/vividus-framework/vividus/commit/3ad87e9eb71060c80a84f75d3fdf99d6ef8f5dcb", "committedDate": "2020-12-10T16:44:35Z", "message": "[plugin-browserstack] Add link to public browserstack report"}, "afterCommit": {"oid": "7a839e5bdc2b39bb011c4f742980fe132de1ab0f", "author": {"user": {"login": "uarlouski", "name": "Uladzislau Arlouski"}}, "url": "https://github.com/vividus-framework/vividus/commit/7a839e5bdc2b39bb011c4f742980fe132de1ab0f", "committedDate": "2020-12-15T14:51:05Z", "message": "[plugin-browserstack] Add link to public browserstack report"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7a839e5bdc2b39bb011c4f742980fe132de1ab0f", "author": {"user": {"login": "uarlouski", "name": "Uladzislau Arlouski"}}, "url": "https://github.com/vividus-framework/vividus/commit/7a839e5bdc2b39bb011c4f742980fe132de1ab0f", "committedDate": "2020-12-15T14:51:05Z", "message": "[plugin-browserstack] Add link to public browserstack report"}, "afterCommit": {"oid": "872936978e15ad93ee6b5243aaa746139c72e7bd", "author": {"user": {"login": "uarlouski", "name": "Uladzislau Arlouski"}}, "url": "https://github.com/vividus-framework/vividus/commit/872936978e15ad93ee6b5243aaa746139c72e7bd", "committedDate": "2020-12-15T16:00:08Z", "message": "[plugin-browserstack] Add link to public browserstack report"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "872936978e15ad93ee6b5243aaa746139c72e7bd", "author": {"user": {"login": "uarlouski", "name": "Uladzislau Arlouski"}}, "url": "https://github.com/vividus-framework/vividus/commit/872936978e15ad93ee6b5243aaa746139c72e7bd", "committedDate": "2020-12-15T16:00:08Z", "message": "[plugin-browserstack] Add link to public browserstack report"}, "afterCommit": {"oid": "d7af4e7bf7ce226c5f3a4a8ebe262d6dadfba9b5", "author": {"user": {"login": "uarlouski", "name": "Uladzislau Arlouski"}}, "url": "https://github.com/vividus-framework/vividus/commit/d7af4e7bf7ce226c5f3a4a8ebe262d6dadfba9b5", "committedDate": "2020-12-15T19:12:27Z", "message": "[plugin-browserstack] Add link to public browserstack report"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d7af4e7bf7ce226c5f3a4a8ebe262d6dadfba9b5", "author": {"user": {"login": "uarlouski", "name": "Uladzislau Arlouski"}}, "url": "https://github.com/vividus-framework/vividus/commit/d7af4e7bf7ce226c5f3a4a8ebe262d6dadfba9b5", "committedDate": "2020-12-15T19:12:27Z", "message": "[plugin-browserstack] Add link to public browserstack report"}, "afterCommit": {"oid": "bd082dcfce12e987f040674266b2314532420288", "author": {"user": {"login": "uarlouski", "name": "Uladzislau Arlouski"}}, "url": "https://github.com/vividus-framework/vividus/commit/bd082dcfce12e987f040674266b2314532420288", "committedDate": "2020-12-15T19:50:43Z", "message": "[plugin-browserstack] Add link to public browserstack report"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUzNDE4MDAx", "url": "https://github.com/vividus-framework/vividus/pull/1216#pullrequestreview-553418001", "createdAt": "2020-12-16T07:29:51Z", "commit": {"oid": "bd082dcfce12e987f040674266b2314532420288"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNlQwNzoyOTo1MVrOIG3gnQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNlQwNzoyOTo1MVrOIG3gnQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDA3MTgzNw==", "bodyText": "just new Link()... ?", "url": "https://github.com/vividus-framework/vividus/pull/1216#discussion_r544071837", "createdAt": "2020-12-16T07:29:51Z", "author": {"login": "valfirst"}, "path": "vividus-allure-adaptor/src/main/java/org/vividus/bdd/report/allure/AllureStoryReporter.java", "diffHunk": "@@ -441,6 +442,26 @@ public void onAttachmentPublish(AttachmentPublishEvent event)\n         lifecycle.addAttachment(attachment.getTitle(), attachment.getContentType(), null, attachment.getContent());\n     }\n \n+    @Subscribe\n+    public void onLinkPublish(LinkPublishEvent event)\n+    {\n+        lifecycle.updateTestCase(getRootStepId(), result ->\n+        {\n+            String name = event.getName();\n+            String url = event.getUrl();\n+\n+            boolean notExists = result.getLinks().stream()\n+                                              .noneMatch(l -> l.getUrl().equals(url) && l.getName().equals(name));\n+\n+            if (notExists)\n+            {\n+                Link link = ResultsUtils.createLink(null, event.getName(), event.getUrl(),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bd082dcfce12e987f040674266b2314532420288"}, "originalPosition": 25}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4a2c1932eff35c9bebe6a351ea95325f939fa829", "author": {"user": {"login": "uarlouski", "name": "Uladzislau Arlouski"}}, "url": "https://github.com/vividus-framework/vividus/commit/4a2c1932eff35c9bebe6a351ea95325f939fa829", "committedDate": "2020-12-16T07:58:05Z", "message": "[plugin-browserstack] Add link to public browserstack report"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "bd082dcfce12e987f040674266b2314532420288", "author": {"user": {"login": "uarlouski", "name": "Uladzislau Arlouski"}}, "url": "https://github.com/vividus-framework/vividus/commit/bd082dcfce12e987f040674266b2314532420288", "committedDate": "2020-12-15T19:50:43Z", "message": "[plugin-browserstack] Add link to public browserstack report"}, "afterCommit": {"oid": "4a2c1932eff35c9bebe6a351ea95325f939fa829", "author": {"user": {"login": "uarlouski", "name": "Uladzislau Arlouski"}}, "url": "https://github.com/vividus-framework/vividus/commit/4a2c1932eff35c9bebe6a351ea95325f939fa829", "committedDate": "2020-12-16T07:58:05Z", "message": "[plugin-browserstack] Add link to public browserstack report"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUzNDcyNTkz", "url": "https://github.com/vividus-framework/vividus/pull/1216#pullrequestreview-553472593", "createdAt": "2020-12-16T08:54:32Z", "commit": {"oid": "4a2c1932eff35c9bebe6a351ea95325f939fa829"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU0Mjk0MTc4", "url": "https://github.com/vividus-framework/vividus/pull/1216#pullrequestreview-554294178", "createdAt": "2020-12-17T05:42:35Z", "commit": {"oid": "4a2c1932eff35c9bebe6a351ea95325f939fa829"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4781, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}