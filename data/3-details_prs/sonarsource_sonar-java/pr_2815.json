{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc0OTQ3ODMw", "number": 2815, "title": "SONARJAVA-3290 S3457 should allow to use 'toString()' on exceptions to force usage of sl4j Logger(String, Object...)", "bodyText": "", "createdAt": "2020-02-13T15:55:24Z", "url": "https://github.com/SonarSource/sonar-java/pull/2815", "merged": true, "mergeCommit": {"oid": "e7d2542eb967fda886a71cdce7c6321d02089b27"}, "closed": true, "closedAt": "2020-02-21T14:43:54Z", "author": {"login": "alban-auzeill"}, "timelineItems": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcD94pKABqjMwMzU2OTc2OTk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcGf1ITgBqjMwNjA1MDEzMzQ=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4429023af7611d217a48a849ee3482398ca692ad", "author": {"user": {"login": "alban-auzeill", "name": "Alban Auzeill"}}, "url": "https://github.com/SonarSource/sonar-java/commit/4429023af7611d217a48a849ee3482398ca692ad", "committedDate": "2020-02-13T15:54:51Z", "message": "SONARJAVA-3290 S3457 should allow to use 'toString()' on exceptions to force usage of sl4j Logger(String, Object...)"}, "afterCommit": {"oid": "857d32c7f4e50493001b9ced3c13a5a7623f3076", "author": {"user": {"login": "alban-auzeill", "name": "Alban Auzeill"}}, "url": "https://github.com/SonarSource/sonar-java/commit/857d32c7f4e50493001b9ced3c13a5a7623f3076", "committedDate": "2020-02-13T16:53:46Z", "message": "SONARJAVA-3290 S3457 should allow to use 'toString()' on exceptions to force usage of sl4j Logger(String, Object...)"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "857d32c7f4e50493001b9ced3c13a5a7623f3076", "author": {"user": {"login": "alban-auzeill", "name": "Alban Auzeill"}}, "url": "https://github.com/SonarSource/sonar-java/commit/857d32c7f4e50493001b9ced3c13a5a7623f3076", "committedDate": "2020-02-13T16:53:46Z", "message": "SONARJAVA-3290 S3457 should allow to use 'toString()' on exceptions to force usage of sl4j Logger(String, Object...)"}, "afterCommit": {"oid": "7a5a1b88dffec6966b069a80ce0f899037f84b74", "author": {"user": {"login": "alban-auzeill", "name": "Alban Auzeill"}}, "url": "https://github.com/SonarSource/sonar-java/commit/7a5a1b88dffec6966b069a80ce0f899037f84b74", "committedDate": "2020-02-13T17:23:03Z", "message": "SONARJAVA-3290 S3457 should allow to use 'toString()' on exceptions to force usage of sl4j Logger(String, Object...)"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7a5a1b88dffec6966b069a80ce0f899037f84b74", "author": {"user": {"login": "alban-auzeill", "name": "Alban Auzeill"}}, "url": "https://github.com/SonarSource/sonar-java/commit/7a5a1b88dffec6966b069a80ce0f899037f84b74", "committedDate": "2020-02-13T17:23:03Z", "message": "SONARJAVA-3290 S3457 should allow to use 'toString()' on exceptions to force usage of sl4j Logger(String, Object...)"}, "afterCommit": {"oid": "0b4e9d9730653337b57236a5c2424c4b538d7eb4", "author": {"user": {"login": "alban-auzeill", "name": "Alban Auzeill"}}, "url": "https://github.com/SonarSource/sonar-java/commit/0b4e9d9730653337b57236a5c2424c4b538d7eb4", "committedDate": "2020-02-14T08:25:54Z", "message": "SONARJAVA-3290 S3457 should allow to use 'toString()' on exceptions to force usage of sl4j Logger(String, Object...)"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU5NTkxNzg5", "url": "https://github.com/SonarSource/sonar-java/pull/2815#pullrequestreview-359591789", "createdAt": "2020-02-17T09:29:34Z", "commit": {"oid": "0b4e9d9730653337b57236a5c2424c4b538d7eb4"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xN1QwOTozMToyM1rOFqdlEw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xN1QwOTozNzowMFrOFqdwBw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDA2OTEzOQ==", "bodyText": "All these 9 issues are FPs. The issue message says: Format specifiers should be used instead of string concatenation., but the method which is called is: java.util.logging.Logger.log(Level, String, Throwable).\nConsequently, you HAVE to use string concatenation", "url": "https://github.com/SonarSource/sonar-java/pull/2815#discussion_r380069139", "createdAt": "2020-02-17T09:31:23Z", "author": {"login": "m-g-sonar"}, "path": "its/ruling/src/test/resources/guava/java-S3457.json", "diffHunk": "@@ -0,0 +1,25 @@\n+{\n+'com.google.guava:guava:src/com/google/common/io/Closer.java':[", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0b4e9d9730653337b57236a5c2424c4b538d7eb4"}, "originalPosition": 2}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDA3MTQyOQ==", "bodyText": "to me the error message is wrong here. It should be something like Remove this argument formatter because it won't be consumed.", "url": "https://github.com/SonarSource/sonar-java/pull/2815#discussion_r380071429", "createdAt": "2020-02-17T09:36:00Z", "author": {"login": "m-g-sonar"}, "path": "java-checks/src/test/files/checks/PrintfMisuseCheck.java", "diffHunk": "@@ -182,13 +185,18 @@ void foo(Calendar c){\n     slf4jLog.debug(\"message {} {}\", new Object[]{1, 2, 3}); // Noncompliant\n     slf4jLog.debug(\"message {} {} {}\", new Object[]{1, 2, 3}); // compliant\n     slf4jLog.debug(\"message \", new Exception());\n-    slf4jLog.debug(\"message {}\", new Exception());\n+    slf4jLog.debug(\"message {}\", new Exception()); // Noncompliant {{Missing argument for the first parameter.}}\n \n-    slf4jLog.error(\"message {}\");\n+    slf4jLog.error(\"message {}\"); // Noncompliant {{Missing argument for the first parameter.}}\n+    slf4jLog.error(\"message {}\", new Exception()); // Noncompliant {{Missing argument for the first parameter.}}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0b4e9d9730653337b57236a5c2424c4b538d7eb4"}, "originalPosition": 74}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDA3MTk0Mw==", "bodyText": "this is a FP to me. You don't have the choice to use concatenation if you want to use the \"Throwable\" method.", "url": "https://github.com/SonarSource/sonar-java/pull/2815#discussion_r380071943", "createdAt": "2020-02-17T09:37:00Z", "author": {"login": "m-g-sonar"}, "path": "java-checks/src/test/files/checks/PrintfMisuseCheck.java", "diffHunk": "@@ -224,6 +232,9 @@ void foo(Calendar c){\n     java.util.logging.Logger logger4 = getLog();\n     logger4.log(java.util.logging.Level.WARNING, \"som.foo.errorcode\", 404); // Noncompliant\n     this.loggerField.log(java.util.logging.Level.WARNING, \"som.foo.errorcode\", 404);\n+    String additionalMessage = \"...\";\n+    logger4.log(java.util.logging.Level.WARNING, \"message \" + additionalMessage, new Exception());  // Noncompliant {{Format specifiers should be used instead of string concatenation.}}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0b4e9d9730653337b57236a5c2424c4b538d7eb4"}, "originalPosition": 117}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0b4e9d9730653337b57236a5c2424c4b538d7eb4", "author": {"user": {"login": "alban-auzeill", "name": "Alban Auzeill"}}, "url": "https://github.com/SonarSource/sonar-java/commit/0b4e9d9730653337b57236a5c2424c4b538d7eb4", "committedDate": "2020-02-14T08:25:54Z", "message": "SONARJAVA-3290 S3457 should allow to use 'toString()' on exceptions to force usage of sl4j Logger(String, Object...)"}, "afterCommit": {"oid": "7d1db1b9f3bb2d044734208967e4a16f5dae4098", "author": {"user": {"login": "alban-auzeill", "name": "Alban Auzeill"}}, "url": "https://github.com/SonarSource/sonar-java/commit/7d1db1b9f3bb2d044734208967e4a16f5dae4098", "committedDate": "2020-02-20T15:07:05Z", "message": "Fix from review"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7d1db1b9f3bb2d044734208967e4a16f5dae4098", "author": {"user": {"login": "alban-auzeill", "name": "Alban Auzeill"}}, "url": "https://github.com/SonarSource/sonar-java/commit/7d1db1b9f3bb2d044734208967e4a16f5dae4098", "committedDate": "2020-02-20T15:07:05Z", "message": "Fix from review"}, "afterCommit": {"oid": "bf17a39e70ed86a2e2faeb94edb31f2a6973ec8b", "author": {"user": {"login": "alban-auzeill", "name": "Alban Auzeill"}}, "url": "https://github.com/SonarSource/sonar-java/commit/bf17a39e70ed86a2e2faeb94edb31f2a6973ec8b", "committedDate": "2020-02-20T16:26:43Z", "message": "Move unit test in java-checks-test-sources"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYyNTMwMDc1", "url": "https://github.com/SonarSource/sonar-java/pull/2815#pullrequestreview-362530075", "createdAt": "2020-02-21T10:22:11Z", "commit": {"oid": "bf17a39e70ed86a2e2faeb94edb31f2a6973ec8b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMVQxMDoyMjoxMVrOFsyM7w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMVQxMDoyMjoxMVrOFsyM7w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjUwNDE3NQ==", "bodyText": "useless parenthesis", "url": "https://github.com/SonarSource/sonar-java/pull/2815#discussion_r382504175", "createdAt": "2020-02-21T10:22:11Z", "author": {"login": "m-g-sonar"}, "path": "java-checks/src/main/java/org/sonar/java/checks/AbstractPrintfChecker.java", "diffHunk": "@@ -120,25 +133,29 @@ protected final void checkFormatting(MethodInvocationTree mit, boolean isMessage\n     }\n     if (formatTree.is(Tree.Kind.STRING_LITERAL)) {\n       String formatString = LiteralUtils.trimQuotes(((LiteralTree) formatTree).value());\n-      if (mit.symbol().owner().type().is(ORG_APACHE_LOGGING_LOG4J_LOGGER)) {\n-        // Log4J supports both approaches\n-        isMessageFormat = formatString.contains(\"{}\");\n+      if (isMessageFormat && isProbablyLog4jFormatterLogger(mit, formatString)) {\n+        isMessageFormat = false;\n       }\n       if (isMessageFormat) {\n         handleMessageFormat(mit, formatString, args);\n       } else {\n         handlePrintfFormat(mit, formatString, args);\n       }\n     } else {\n-      handleOtherFormatTree(mit, formatTree);\n+      handleOtherFormatTree(mit, formatTree, args);\n     }\n   }\n \n+  private static boolean isProbablyLog4jFormatterLogger(MethodInvocationTree mit, String formatString) {\n+    return mit.symbol().owner().type().is(ORG_APACHE_LOGGING_LOG4J_LOGGER) &&\n+          (!formatString.contains(\"{}\") && formatString.contains(\"%\"));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bf17a39e70ed86a2e2faeb94edb31f2a6973ec8b"}, "originalPosition": 87}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bac6cf3cf0a3d5aabae948d5ea56876d52b172b4", "author": {"user": {"login": "alban-auzeill", "name": "Alban Auzeill"}}, "url": "https://github.com/SonarSource/sonar-java/commit/bac6cf3cf0a3d5aabae948d5ea56876d52b172b4", "committedDate": "2020-02-21T13:34:24Z", "message": "SONARJAVA-3290 S3457 should allow to use 'toString()' on exceptions to force usage of sl4j Logger(String, Object...)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2c0bd7c65eed277879fcd293c57c0a9a663ebc8e", "author": {"user": {"login": "alban-auzeill", "name": "Alban Auzeill"}}, "url": "https://github.com/SonarSource/sonar-java/commit/2c0bd7c65eed277879fcd293c57c0a9a663ebc8e", "committedDate": "2020-02-21T13:34:24Z", "message": "Fix from review"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1cbf80a48805a1798f1f870b0381bfd16e441cbd", "author": {"user": {"login": "alban-auzeill", "name": "Alban Auzeill"}}, "url": "https://github.com/SonarSource/sonar-java/commit/1cbf80a48805a1798f1f870b0381bfd16e441cbd", "committedDate": "2020-02-21T13:34:24Z", "message": "Move unit test in java-checks-test-sources"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "841c3243fce9f4b76f6c90b180338938a3a7ead0", "author": {"user": {"login": "alban-auzeill", "name": "Alban Auzeill"}}, "url": "https://github.com/SonarSource/sonar-java/commit/841c3243fce9f4b76f6c90b180338938a3a7ead0", "committedDate": "2020-02-21T13:34:24Z", "message": "Fix from review 2"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "bf17a39e70ed86a2e2faeb94edb31f2a6973ec8b", "author": {"user": {"login": "alban-auzeill", "name": "Alban Auzeill"}}, "url": "https://github.com/SonarSource/sonar-java/commit/bf17a39e70ed86a2e2faeb94edb31f2a6973ec8b", "committedDate": "2020-02-20T16:26:43Z", "message": "Move unit test in java-checks-test-sources"}, "afterCommit": {"oid": "841c3243fce9f4b76f6c90b180338938a3a7ead0", "author": {"user": {"login": "alban-auzeill", "name": "Alban Auzeill"}}, "url": "https://github.com/SonarSource/sonar-java/commit/841c3243fce9f4b76f6c90b180338938a3a7ead0", "committedDate": "2020-02-21T13:34:24Z", "message": "Fix from review 2"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1840, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}