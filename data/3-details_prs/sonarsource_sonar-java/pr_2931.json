{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDEyMTAwMDc0", "number": 2931, "title": "SONARJAVA-2549 Improve S2293 to handle cases where constructor is used in argument", "bodyText": "It does not handle all the cases, as it's not triggered when the diamond could be removed thanks to type inferences on provided parameters, but to me it's not really the same ticket. I anyway added a case, flagged as FN.\nPlease do not squash the commits", "createdAt": "2020-05-01T11:42:14Z", "url": "https://github.com/SonarSource/sonar-java/pull/2931", "merged": true, "mergeCommit": {"oid": "126040a5c6799a505bab91b72983440471e2fba8"}, "closed": true, "closedAt": "2020-05-04T08:53:18Z", "author": {"login": "m-g-sonar"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcdChlpgFqTQwNDEzOTI2MA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcd6qEmABqjMyOTg2NzkyNDc=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA0MTM5MjYw", "url": "https://github.com/SonarSource/sonar-java/pull/2931#pullrequestreview-404139260", "createdAt": "2020-05-01T12:38:39Z", "commit": {"oid": "72e814ba7533bb5e318a51dd3fe7537ac08ed8ba"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wMVQxMjo1Mjo0N1rOGPI85g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wMVQxMjo1Mjo0N1rOGPI85g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODUyODQ4Ng==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              private static boolean usedAsArgumentShouldUseDiamon(NewClassTree newClassTree) {\n          \n          \n            \n              private static boolean usedAsArgumentShouldUseDiamond(NewClassTree newClassTree) {", "url": "https://github.com/SonarSource/sonar-java/pull/2931#discussion_r418528486", "createdAt": "2020-05-01T12:52:47Z", "author": {"login": "quentin-jaquier-sonarsource"}, "path": "java-checks/src/main/java/org/sonar/java/checks/DiamondOperatorCheck.java", "diffHunk": "@@ -79,15 +82,63 @@ public boolean isCompatibleWithJavaVersion(JavaVersion version) {\n   public void visitNode(Tree tree) {\n     NewClassTree newClassTree = (NewClassTree) tree;\n     TypeTree newTypeTree = newClassTree.identifier();\n-    if (newClassTree.classBody() == null && isParameterizedType(newTypeTree)) {\n-      TypeTree type = getTypeFromExpression(tree.parent(), expressionKindsToCheck);\n-      if (type != null && isParameterizedType(type)) {\n-        reportIssue(\n-          ((ParameterizedTypeTree) newTypeTree).typeArguments(),\n-          \"Replace the type specification in this constructor call with the diamond operator (\\\"<>\\\").\" +\n-            context.getJavaVersion().java7CompatibilityMessage());\n-      }\n+    if (!isParameterizedType(newTypeTree) || newClassTree.classBody() != null) {\n+      return;\n+    }\n+    TypeTree type = getTypeFromExpression(tree.parent(), expressionKindsToCheck);\n+    if ((type != null && isParameterizedType(type))\n+      || usedAsArgumentShouldUseDiamon(newClassTree)) {\n+      reportIssue(\n+        ((ParameterizedTypeTree) newTypeTree).typeArguments(),\n+        \"Replace the type specification in this constructor call with the diamond operator (\\\"<>\\\").\" +\n+          context.getJavaVersion().java7CompatibilityMessage());\n+    }\n+  }\n+\n+  private static boolean usedAsArgumentShouldUseDiamon(NewClassTree newClassTree) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "72e814ba7533bb5e318a51dd3fe7537ac08ed8ba"}, "originalPosition": 47}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b206c71b83a858701afaab637e9e47eddbb40267", "author": {"user": {"login": "m-g-sonar", "name": "Michael Gumowski"}}, "url": "https://github.com/SonarSource/sonar-java/commit/b206c71b83a858701afaab637e9e47eddbb40267", "committedDate": "2020-05-04T07:47:13Z", "message": "SONARJAVA-2549 Move S2293 test files"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "30f8f8b1ad9e67b893f63e314267c5a5f2c84bd0", "author": {"user": {"login": "m-g-sonar", "name": "Michael Gumowski"}}, "url": "https://github.com/SonarSource/sonar-java/commit/30f8f8b1ad9e67b893f63e314267c5a5f2c84bd0", "committedDate": "2020-05-04T07:49:58Z", "message": "SONARJAVA-2549 Improve S2293 to handle cases where constructor is used in argument"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "72e814ba7533bb5e318a51dd3fe7537ac08ed8ba", "author": {"user": {"login": "m-g-sonar", "name": "Michael Gumowski"}}, "url": "https://github.com/SonarSource/sonar-java/commit/72e814ba7533bb5e318a51dd3fe7537ac08ed8ba", "committedDate": "2020-05-01T10:10:52Z", "message": "SONARJAVA-2549 Improve S2293 to handle cases where constructor is used in argument"}, "afterCommit": {"oid": "30f8f8b1ad9e67b893f63e314267c5a5f2c84bd0", "author": {"user": {"login": "m-g-sonar", "name": "Michael Gumowski"}}, "url": "https://github.com/SonarSource/sonar-java/commit/30f8f8b1ad9e67b893f63e314267c5a5f2c84bd0", "committedDate": "2020-05-04T07:49:58Z", "message": "SONARJAVA-2549 Improve S2293 to handle cases where constructor is used in argument"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1798, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}