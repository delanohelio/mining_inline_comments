{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTIxNTI2ODY1", "number": 3270, "title": " SONARJAVA-3580 FP in S2390: do not report an issue on static class nested in the parent", "bodyText": "", "createdAt": "2020-11-16T09:18:45Z", "url": "https://github.com/SonarSource/sonar-java/pull/3270", "merged": true, "mergeCommit": {"oid": "b09bcd6320c32758c973e678e22065764db482be"}, "closed": true, "closedAt": "2020-11-19T17:50:57Z", "author": {"login": "quentin-jaquier-sonarsource"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABddB0AegBqjM5OTkzNTQ2NjE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdeGA78gH2gAyNTIxNTI2ODY1OjlkNTMxY2VkMTgwZmNmM2Q4OTJhOGQwOWQzZDhlZTgwNzY0NTZhMWM=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "00eb928a065643f81eef67e70c2b6656e8393ff2", "author": {"user": {"login": "quentin-jaquier-sonarsource", "name": null}}, "url": "https://github.com/SonarSource/sonar-java/commit/00eb928a065643f81eef67e70c2b6656e8393ff2", "committedDate": "2020-11-16T09:18:07Z", "message": "SONARJAVA-3580 FP in S2390: do not report an issue on static class nested in the parent."}, "afterCommit": {"oid": "4ba820bad048b7acda15ae299d135ff1d9a24ddb", "author": {"user": {"login": "quentin-jaquier-sonarsource", "name": null}}, "url": "https://github.com/SonarSource/sonar-java/commit/4ba820bad048b7acda15ae299d135ff1d9a24ddb", "committedDate": "2020-11-16T09:47:28Z", "message": "SONARJAVA-3580 FP in S2390: do not report an issue on static class nested in the parent."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4ba820bad048b7acda15ae299d135ff1d9a24ddb", "author": {"user": {"login": "quentin-jaquier-sonarsource", "name": null}}, "url": "https://github.com/SonarSource/sonar-java/commit/4ba820bad048b7acda15ae299d135ff1d9a24ddb", "committedDate": "2020-11-16T09:47:28Z", "message": "SONARJAVA-3580 FP in S2390: do not report an issue on static class nested in the parent."}, "afterCommit": {"oid": "064d38f4819563515d5befd27c03768630514e15", "author": {"user": {"login": "quentin-jaquier-sonarsource", "name": null}}, "url": "https://github.com/SonarSource/sonar-java/commit/064d38f4819563515d5befd27c03768630514e15", "committedDate": "2020-11-16T11:23:56Z", "message": "SONARJAVA-3580 FP in S2390: do not report an issue on static class nested in the parent."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM0NjMzNjIx", "url": "https://github.com/SonarSource/sonar-java/pull/3270#pullrequestreview-534633621", "createdAt": "2020-11-19T16:36:41Z", "commit": {"oid": "064d38f4819563515d5befd27c03768630514e15"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQxNjozNjo0MVrOH2nV0Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQxNjo0MzowMFrOH2nopA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzAyOTcxMw==", "bodyText": "we should take the erasure of ownerType or we gonna face inconcistencies.", "url": "https://github.com/SonarSource/sonar-java/pull/3270#discussion_r527029713", "createdAt": "2020-11-19T16:36:41Z", "author": {"login": "m-g-sonar"}, "path": "java-checks/src/main/java/org/sonar/java/checks/SubClassStaticReferenceCheck.java", "diffHunk": "@@ -116,14 +116,24 @@ public void visitMemberSelectExpression(MemberSelectExpressionTree tree) {\n     @Override\n     public void visitIdentifier(IdentifierTree tree) {\n       Type type = tree.symbolType();\n-      if (!sameErasure(type) && type.isSubtypeOf(classType.erasure())) {\n+      if (!sameErasure(type) && type.isSubtypeOf(classTypeErasure) && !isNestedIntoParent(type)) {\n         reportIssue(tree, String.format(\"Remove this reference to \\\"%s\\\".\", type.symbol().name()));\n       }\n     }\n \n     private boolean sameErasure(Type type) {\n-      return classType.erasure().equals(type.erasure());\n+      return classTypeErasure.equals(type.erasure());\n     }\n+\n+    private boolean isNestedIntoParent(Type type) {\n+      Symbol ownerSymbol = type.symbol().owner();\n+      if (ownerSymbol != null) {\n+        Type ownerType = ownerSymbol.type();\n+        return ownerType != null && ownerType.isSubtypeOf(classTypeErasure);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "064d38f4819563515d5befd27c03768630514e15"}, "originalPosition": 57}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzAzMTQ0NQ==", "bodyText": "isNestedSubtype()", "url": "https://github.com/SonarSource/sonar-java/pull/3270#discussion_r527031445", "createdAt": "2020-11-19T16:38:59Z", "author": {"login": "m-g-sonar"}, "path": "java-checks/src/main/java/org/sonar/java/checks/SubClassStaticReferenceCheck.java", "diffHunk": "@@ -116,14 +116,24 @@ public void visitMemberSelectExpression(MemberSelectExpressionTree tree) {\n     @Override\n     public void visitIdentifier(IdentifierTree tree) {\n       Type type = tree.symbolType();\n-      if (!sameErasure(type) && type.isSubtypeOf(classType.erasure())) {\n+      if (!sameErasure(type) && type.isSubtypeOf(classTypeErasure) && !isNestedIntoParent(type)) {\n         reportIssue(tree, String.format(\"Remove this reference to \\\"%s\\\".\", type.symbol().name()));\n       }\n     }\n \n     private boolean sameErasure(Type type) {\n-      return classType.erasure().equals(type.erasure());\n+      return classTypeErasure.equals(type.erasure());\n     }\n+\n+    private boolean isNestedIntoParent(Type type) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "064d38f4819563515d5befd27c03768630514e15"}, "originalPosition": 53}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzAzNDUzMg==", "bodyText": "Type ownerType = Objects.requiresNonNull(type.symbol().owner()).type();", "url": "https://github.com/SonarSource/sonar-java/pull/3270#discussion_r527034532", "createdAt": "2020-11-19T16:43:00Z", "author": {"login": "m-g-sonar"}, "path": "java-checks/src/main/java/org/sonar/java/checks/SubClassStaticReferenceCheck.java", "diffHunk": "@@ -116,14 +116,24 @@ public void visitMemberSelectExpression(MemberSelectExpressionTree tree) {\n     @Override\n     public void visitIdentifier(IdentifierTree tree) {\n       Type type = tree.symbolType();\n-      if (!sameErasure(type) && type.isSubtypeOf(classType.erasure())) {\n+      if (!sameErasure(type) && type.isSubtypeOf(classTypeErasure) && !isNestedIntoParent(type)) {\n         reportIssue(tree, String.format(\"Remove this reference to \\\"%s\\\".\", type.symbol().name()));\n       }\n     }\n \n     private boolean sameErasure(Type type) {\n-      return classType.erasure().equals(type.erasure());\n+      return classTypeErasure.equals(type.erasure());\n     }\n+\n+    private boolean isNestedIntoParent(Type type) {\n+      Symbol ownerSymbol = type.symbol().owner();\n+      if (ownerSymbol != null) {\n+        Type ownerType = ownerSymbol.type();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "064d38f4819563515d5befd27c03768630514e15"}, "originalPosition": 56}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "65f632412288830cfbe883525483a9a1ed2cb6e4", "author": {"user": {"login": "quentin-jaquier-sonarsource", "name": null}}, "url": "https://github.com/SonarSource/sonar-java/commit/65f632412288830cfbe883525483a9a1ed2cb6e4", "committedDate": "2020-11-19T16:50:34Z", "message": "Move test file to new module for S2390"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "245de07928bb904afc1c5103e694514981798b5f", "author": {"user": {"login": "quentin-jaquier-sonarsource", "name": null}}, "url": "https://github.com/SonarSource/sonar-java/commit/245de07928bb904afc1c5103e694514981798b5f", "committedDate": "2020-11-19T16:50:34Z", "message": "SONARJAVA-3580 FP in S2390: do not report an issue on static class nested in the parent."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4957b4d0afc79ff322471993c6a33a7df4222e74", "author": {"user": {"login": "quentin-jaquier-sonarsource", "name": null}}, "url": "https://github.com/SonarSource/sonar-java/commit/4957b4d0afc79ff322471993c6a33a7df4222e74", "committedDate": "2020-11-19T16:54:45Z", "message": "Fix from review"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "064d38f4819563515d5befd27c03768630514e15", "author": {"user": {"login": "quentin-jaquier-sonarsource", "name": null}}, "url": "https://github.com/SonarSource/sonar-java/commit/064d38f4819563515d5befd27c03768630514e15", "committedDate": "2020-11-16T11:23:56Z", "message": "SONARJAVA-3580 FP in S2390: do not report an issue on static class nested in the parent."}, "afterCommit": {"oid": "4957b4d0afc79ff322471993c6a33a7df4222e74", "author": {"user": {"login": "quentin-jaquier-sonarsource", "name": null}}, "url": "https://github.com/SonarSource/sonar-java/commit/4957b4d0afc79ff322471993c6a33a7df4222e74", "committedDate": "2020-11-19T16:54:45Z", "message": "Fix from review"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9d531ced180fcf3d892a8d09d3d8ee8076456a1c", "author": {"user": {"login": "quentin-jaquier-sonarsource", "name": null}}, "url": "https://github.com/SonarSource/sonar-java/commit/9d531ced180fcf3d892a8d09d3d8ee8076456a1c", "committedDate": "2020-11-19T17:15:25Z", "message": "Add test case when nesting class is unrelated"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1925, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}