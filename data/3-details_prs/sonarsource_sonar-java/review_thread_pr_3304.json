{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTI4NjIyMzIx", "number": 3304, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0zMFQxNTo0MDowNVrOE-tijA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0zMFQxNTo0OTo1OVrOE-t1pA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM0MTkzMjkyOnYy", "diffSide": "RIGHT", "path": "java-frontend/src/main/java/org/sonar/java/se/constraint/ConstraintManager.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0zMFQxNTo0MDowNVrOH8A3ig==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0zMFQxNTo0MDowNVrOH8A3ig==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjY5MDgyNg==", "bodyText": "I'm really not sure about this null test here, I think it's impossible. At worst, an unknown symbol should return an unknown type., and so your test can probably simply be if (type.is(\"java.lang.Boolean\")) { ...", "url": "https://github.com/SonarSource/sonar-java/pull/3304#discussion_r532690826", "createdAt": "2020-11-30T15:40:05Z", "author": {"login": "m-g-sonar"}, "path": "java-frontend/src/main/java/org/sonar/java/se/constraint/ConstraintManager.java", "diffHunk": "@@ -153,6 +157,14 @@ private SymbolicValue createIdentifierSymbolicValue(IdentifierTree identifier) {\n     }\n     return createDefaultSymbolicValue();\n   }\n+  \n+  private SymbolicValue createVariableSymbolicValue(VariableTree identifier) {\n+    final Type type = identifier.symbol().type();\n+    if (type != null && type.is(\"java.lang.Boolean\")) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4d024622c418241c3b33d3f91c501ffa389f5223"}, "originalPosition": 25}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM0MTkzNDk2OnYy", "diffSide": "RIGHT", "path": "java-frontend/src/main/java/org/sonar/java/se/constraint/ConstraintManager.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0zMFQxNTo0MDoyN1rOH8A4xw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0zMFQxNjoxNzowNlrOH8Cmfw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjY5MTE0Mw==", "bodyText": "I would rename identifier into variable", "url": "https://github.com/SonarSource/sonar-java/pull/3304#discussion_r532691143", "createdAt": "2020-11-30T15:40:27Z", "author": {"login": "m-g-sonar"}, "path": "java-frontend/src/main/java/org/sonar/java/se/constraint/ConstraintManager.java", "diffHunk": "@@ -153,6 +157,14 @@ private SymbolicValue createIdentifierSymbolicValue(IdentifierTree identifier) {\n     }\n     return createDefaultSymbolicValue();\n   }\n+  \n+  private SymbolicValue createVariableSymbolicValue(VariableTree identifier) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4d024622c418241c3b33d3f91c501ffa389f5223"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjcxOTIzMQ==", "bodyText": "Good old copy/paste)", "url": "https://github.com/SonarSource/sonar-java/pull/3304#discussion_r532719231", "createdAt": "2020-11-30T16:17:06Z", "author": {"login": "margarita-nedzelska-sonarsource"}, "path": "java-frontend/src/main/java/org/sonar/java/se/constraint/ConstraintManager.java", "diffHunk": "@@ -153,6 +157,14 @@ private SymbolicValue createIdentifierSymbolicValue(IdentifierTree identifier) {\n     }\n     return createDefaultSymbolicValue();\n   }\n+  \n+  private SymbolicValue createVariableSymbolicValue(VariableTree identifier) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjY5MTE0Mw=="}, "originalCommit": {"oid": "4d024622c418241c3b33d3f91c501ffa389f5223"}, "originalPosition": 23}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM0MTk2MTMzOnYy", "diffSide": "RIGHT", "path": "java-frontend/src/main/java/org/sonar/java/se/symbolicvalues/RelationalSymbolicValue.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0zMFQxNTo0NTo1N1rOH8BI4A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0zMFQxNTo0NTo1N1rOH8BI4A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjY5NTI2NA==", "bodyText": "Question of style, but I would really prefer to have the parenthesis on the previous line and this one starting with .collect( to align dots", "url": "https://github.com/SonarSource/sonar-java/pull/3304#discussion_r532695264", "createdAt": "2020-11-30T15:45:57Z", "author": {"login": "m-g-sonar"}, "path": "java-frontend/src/main/java/org/sonar/java/se/symbolicvalues/RelationalSymbolicValue.java", "diffHunk": "@@ -172,35 +172,64 @@ RelationalSymbolicValue inverse() {\n     return results;\n   }\n \n+  private boolean hasBooleanSymbolicValueAsOperand() {\n+    return (leftOp instanceof BooleanSymbolicValue) || (rightOp instanceof BooleanSymbolicValue);\n+  }\n+\n+  private boolean isEqualityCheck() {\n+    return Kind.METHOD_EQUALS == kind || Kind.NOT_METHOD_EQUALS == kind || Kind.EQUAL == kind || Kind.NOT_EQUAL == kind;\n+  }\n+\n   private List<ProgramState> addNullConstraintsForBooleanWrapper(ProgramState initialProgramState, List<ProgramState> copiedConstraints) {\n     BooleanConstraint leftConstraint = initialProgramState.getConstraint(leftOp, BooleanConstraint.class);\n     BooleanConstraint rightConstraint = initialProgramState.getConstraint(rightOp, BooleanConstraint.class);\n-    if (leftConstraint != null && rightConstraint == null && !isEquality()) {\n-      List<ProgramState> nullConstraints = copiedConstraints.stream()\n-        .flatMap(ps -> rightOp.setConstraint(ps, ObjectConstraint.NULL).stream())\n-        .map(ps -> ps.removeConstraintsOnDomain(rightOp, BooleanConstraint.class)\n-      ).collect(Collectors.toList());\n-      return ImmutableList.<ProgramState>builder().addAll(copiedConstraints).addAll(nullConstraints).build();\n+    \n+    if (shouldAddNullConstraint(leftConstraint, rightConstraint)) {\n+      return getProgramStatesWithNullConstraints(copiedConstraints, leftOp);\n+    }\n+    \n+    if (shouldAddNullConstraint(rightConstraint, leftConstraint)) {\n+      return getProgramStatesWithNullConstraints(copiedConstraints, rightOp);\n     }\n     return copiedConstraints;\n   }\n \n+  private boolean shouldAddNullConstraint(@Nullable BooleanConstraint constraint1, @Nullable BooleanConstraint constraint2) {\n+    return !isEquality() && constraint1 == null && constraint2 != null;\n+  }\n+\n+  private static List<ProgramState> getProgramStatesWithNullConstraints(List<ProgramState> copiedConstraints, SymbolicValue operand) {\n+    List<ProgramState> nullConstraints = copiedConstraints.stream()\n+      .flatMap(ps -> operand.setConstraint(ps, ObjectConstraint.NULL).stream())\n+      .map(ps -> ps.removeConstraintsOnDomain(operand, BooleanConstraint.class)\n+      ).collect(Collectors.toList());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4d024622c418241c3b33d3f91c501ffa389f5223"}, "originalPosition": 55}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM0MTk4MTgwOnYy", "diffSide": "RIGHT", "path": "java-frontend/src/main/java/org/sonar/java/se/symbolicvalues/RelationalSymbolicValue.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0zMFQxNTo0OTo1OVrOH8BVHQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0zMFQxNjoxNjoxNFrOH8CkLw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjY5ODM5Nw==", "bodyText": "What about:\nreturn isEquality() || Kind.NOT_METHOD_EQUALS == kind || Kind.NOT_EQUAL == kind;\n\nIn order to mark the difference with isEquality ?", "url": "https://github.com/SonarSource/sonar-java/pull/3304#discussion_r532698397", "createdAt": "2020-11-30T15:49:59Z", "author": {"login": "m-g-sonar"}, "path": "java-frontend/src/main/java/org/sonar/java/se/symbolicvalues/RelationalSymbolicValue.java", "diffHunk": "@@ -172,35 +172,64 @@ RelationalSymbolicValue inverse() {\n     return results;\n   }\n \n+  private boolean hasBooleanSymbolicValueAsOperand() {\n+    return (leftOp instanceof BooleanSymbolicValue) || (rightOp instanceof BooleanSymbolicValue);\n+  }\n+\n+  private boolean isEqualityCheck() {\n+    return Kind.METHOD_EQUALS == kind || Kind.NOT_METHOD_EQUALS == kind || Kind.EQUAL == kind || Kind.NOT_EQUAL == kind;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4d024622c418241c3b33d3f91c501ffa389f5223"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjcxODYzOQ==", "bodyText": "Nice idea!", "url": "https://github.com/SonarSource/sonar-java/pull/3304#discussion_r532718639", "createdAt": "2020-11-30T16:16:14Z", "author": {"login": "margarita-nedzelska-sonarsource"}, "path": "java-frontend/src/main/java/org/sonar/java/se/symbolicvalues/RelationalSymbolicValue.java", "diffHunk": "@@ -172,35 +172,64 @@ RelationalSymbolicValue inverse() {\n     return results;\n   }\n \n+  private boolean hasBooleanSymbolicValueAsOperand() {\n+    return (leftOp instanceof BooleanSymbolicValue) || (rightOp instanceof BooleanSymbolicValue);\n+  }\n+\n+  private boolean isEqualityCheck() {\n+    return Kind.METHOD_EQUALS == kind || Kind.NOT_METHOD_EQUALS == kind || Kind.EQUAL == kind || Kind.NOT_EQUAL == kind;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjY5ODM5Nw=="}, "originalCommit": {"oid": "4d024622c418241c3b33d3f91c501ffa389f5223"}, "originalPosition": 24}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3863, "cost": 1, "resetAt": "2021-11-13T12:26:42Z"}}}