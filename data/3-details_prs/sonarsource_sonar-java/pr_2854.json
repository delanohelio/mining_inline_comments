{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzgyOTEyMTc5", "number": 2854, "title": "SONARJAVA-3312 FN for S2755: improve detection of XXE attacks", "bodyText": "S2755 implementation failed to detect two cases:\n\nWhen \"transferring\" method call are used with any number of argument.\nWhen the property is set from a variable.", "createdAt": "2020-03-03T12:04:06Z", "url": "https://github.com/SonarSource/sonar-java/pull/2854", "merged": true, "mergeCommit": {"oid": "fa13781654fc78c44b6d9323f9a679cec03be7c5"}, "closed": true, "closedAt": "2020-03-04T10:29:39Z", "author": {"login": "quentin-jaquier-sonarsource"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcKBLfjgBqjMwOTE4ODQ0NjY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcKTweSABqjMwOTU3MTIwNzY=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "12cd4f8bb1c182d92b05126d21d18e3e194b3082", "author": {"user": {"login": "quentin-jaquier-sonarsource", "name": null}}, "url": "https://github.com/SonarSource/sonar-java/commit/12cd4f8bb1c182d92b05126d21d18e3e194b3082", "committedDate": "2020-03-03T11:11:15Z", "message": "Support setting property with variable"}, "afterCommit": {"oid": "f916ffe71b43440c6e400698ca46be50d42d8574", "author": {"user": {"login": "quentin-jaquier-sonarsource", "name": null}}, "url": "https://github.com/SonarSource/sonar-java/commit/f916ffe71b43440c6e400698ca46be50d42d8574", "committedDate": "2020-03-03T12:07:34Z", "message": "Support setting property with variable"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f916ffe71b43440c6e400698ca46be50d42d8574", "author": {"user": {"login": "quentin-jaquier-sonarsource", "name": null}}, "url": "https://github.com/SonarSource/sonar-java/commit/f916ffe71b43440c6e400698ca46be50d42d8574", "committedDate": "2020-03-03T12:07:34Z", "message": "Support setting property with variable"}, "afterCommit": {"oid": "0bf2634a67d29f9271d13701a4c66e59bd6148f5", "author": {"user": {"login": "quentin-jaquier-sonarsource", "name": null}}, "url": "https://github.com/SonarSource/sonar-java/commit/0bf2634a67d29f9271d13701a4c66e59bd6148f5", "committedDate": "2020-03-03T12:10:40Z", "message": "Support setting property with variable"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2f4bce980c7101196146fecced36fb5d4040f58d", "author": {"user": {"login": "quentin-jaquier-sonarsource", "name": null}}, "url": "https://github.com/SonarSource/sonar-java/commit/2f4bce980c7101196146fecced36fb5d4040f58d", "committedDate": "2020-03-03T15:16:46Z", "message": "SONARJAVA-3312 Correctly support transferring method call with argument(s)"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "9d4c2a801a429661037c29c677c626dd0a9ad19f", "author": {"user": {"login": "quentin-jaquier-sonarsource", "name": null}}, "url": "https://github.com/SonarSource/sonar-java/commit/9d4c2a801a429661037c29c677c626dd0a9ad19f", "committedDate": "2020-03-03T14:12:15Z", "message": "FP when empty stack when exiting function"}, "afterCommit": {"oid": "0226b92ba5b7bc6ecf3ca810e27d95e58923e431", "author": {"user": {"login": "quentin-jaquier-sonarsource", "name": null}}, "url": "https://github.com/SonarSource/sonar-java/commit/0226b92ba5b7bc6ecf3ca810e27d95e58923e431", "committedDate": "2020-03-03T15:17:35Z", "message": "SONARJAVA-3312 Support setting property from (non constant) identifier"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0226b92ba5b7bc6ecf3ca810e27d95e58923e431", "author": {"user": {"login": "quentin-jaquier-sonarsource", "name": null}}, "url": "https://github.com/SonarSource/sonar-java/commit/0226b92ba5b7bc6ecf3ca810e27d95e58923e431", "committedDate": "2020-03-03T15:17:35Z", "message": "SONARJAVA-3312 Support setting property from (non constant) identifier"}, "afterCommit": {"oid": "d6582a2408f6ecf520db8439bddb1377ff8b0d3d", "author": {"user": {"login": "quentin-jaquier-sonarsource", "name": null}}, "url": "https://github.com/SonarSource/sonar-java/commit/d6582a2408f6ecf520db8439bddb1377ff8b0d3d", "committedDate": "2020-03-03T15:20:49Z", "message": "SONARJAVA-3312 Support setting property from (non constant) identifier"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY4MTQzMTM5", "url": "https://github.com/SonarSource/sonar-java/pull/2854#pullrequestreview-368143139", "createdAt": "2020-03-03T16:42:56Z", "commit": {"oid": "d6582a2408f6ecf520db8439bddb1377ff8b0d3d"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wM1QxNjo0Mjo1N1rOFxNw7g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wM1QxNjo0ODoyNVrOFxN-1A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzE1MDA2Mg==", "bodyText": "two options here:\n\nyou can replace property.propertyName()::equals by property::isNamed\nor you can drop isNamed(String), as I have to feeling that it does the same at the end  (see line below)", "url": "https://github.com/SonarSource/sonar-java/pull/2854#discussion_r387150062", "createdAt": "2020-03-03T16:42:57Z", "author": {"login": "m-g-sonar"}, "path": "java-frontend/src/main/java/org/sonar/java/se/checks/XxeProcessingCheck.java", "diffHunk": "@@ -339,8 +346,13 @@ private ProgramState checkArguments(ProgramState state, Arguments arguments, Xxe\n       return state;\n     }\n \n-    boolean isSettingProperty(ExpressionTree arg0, String propertyName) {\n-      return arg0.asConstant(String.class).filter(propertyName::equals).isPresent();\n+    boolean isSettingProperty(ProgramState state, ExpressionTree arg0, XxeProperty property) {\n+      if (arg0.asConstant(String.class).filter(property.propertyName()::equals).isPresent()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d6582a2408f6ecf520db8439bddb1377ff8b0d3d"}, "originalPosition": 44}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzE1MjIzNA==", "bodyText": "what about property.propertyName().equals(value.get()) and drop isNamed? or maybe we don't need anymore propertyName()", "url": "https://github.com/SonarSource/sonar-java/pull/2854#discussion_r387152234", "createdAt": "2020-03-03T16:46:17Z", "author": {"login": "m-g-sonar"}, "path": "java-frontend/src/main/java/org/sonar/java/se/checks/XxeProcessingCheck.java", "diffHunk": "@@ -351,6 +363,23 @@ public ProgramState checkPostStatement(CheckerContext context, Tree syntaxNode)\n     return visitor.programState;\n   }\n \n+  private static ProgramState addNamedConstraint(@Nullable ExpressionTree expressionTree, ProgramState state) {\n+    if (expressionTree != null) {\n+      SymbolicValue sv = state.peekValue();\n+      if (sv != null) {\n+        Optional<String> value = expressionTree.asConstant(String.class);\n+        if (value.isPresent()) {\n+          for (XxeProperty property : PROPERTIES_TO_CHECK) {\n+            if (property.isNamed(value.get())) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d6582a2408f6ecf520db8439bddb1377ff8b0d3d"}, "originalPosition": 64}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzE1MzYyMA==", "bodyText": "I would put named on the first line, next to propertyName to group them semantically.", "url": "https://github.com/SonarSource/sonar-java/pull/2854#discussion_r387153620", "createdAt": "2020-03-03T16:48:25Z", "author": {"login": "m-g-sonar"}, "path": "java-frontend/src/main/java/org/sonar/java/se/checks/XxeProperty.java", "diffHunk": "@@ -81,24 +89,28 @@ static boolean isSetToTrue(@Nullable SymbolicValue sv1, ExpressionTree arg1) {\n     private final BiPredicate<SymbolicValue, ExpressionTree> unsecuring;\n     private final Constraint unsecured;\n \n+    private final Constraint named;\n+\n     public XxePropertyHolder(String propertyName,\n       BiPredicate<SymbolicValue, ExpressionTree> securing, Constraint secured,\n-      BiPredicate<SymbolicValue, ExpressionTree> unsecuring, Constraint unsecured) {\n+      BiPredicate<SymbolicValue, ExpressionTree> unsecuring, Constraint unsecured, Constraint named) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d6582a2408f6ecf520db8439bddb1377ff8b0d3d"}, "originalPosition": 31}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY4NjA5OTg5", "url": "https://github.com/SonarSource/sonar-java/pull/2854#pullrequestreview-368609989", "createdAt": "2020-03-04T09:14:40Z", "commit": {"oid": "c11bdddf1259be7b711ceb6569495babf63f0ad9"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d5f33ba3620821f0e15178ccc3f1e1a148ccf527", "author": {"user": {"login": "quentin-jaquier-sonarsource", "name": null}}, "url": "https://github.com/SonarSource/sonar-java/commit/d5f33ba3620821f0e15178ccc3f1e1a148ccf527", "committedDate": "2020-03-04T09:45:33Z", "message": "SONARJAVA-3312 Support setting property from (non constant) identifier"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c11bdddf1259be7b711ceb6569495babf63f0ad9", "author": {"user": {"login": "quentin-jaquier-sonarsource", "name": null}}, "url": "https://github.com/SonarSource/sonar-java/commit/c11bdddf1259be7b711ceb6569495babf63f0ad9", "committedDate": "2020-03-04T08:16:51Z", "message": "Fix from review"}, "afterCommit": {"oid": "d5f33ba3620821f0e15178ccc3f1e1a148ccf527", "author": {"user": {"login": "quentin-jaquier-sonarsource", "name": null}}, "url": "https://github.com/SonarSource/sonar-java/commit/d5f33ba3620821f0e15178ccc3f1e1a148ccf527", "committedDate": "2020-03-04T09:45:33Z", "message": "SONARJAVA-3312 Support setting property from (non constant) identifier"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1742, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}