{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTMwMzYxNTUw", "number": 3309, "title": "SONARJAVA-3130 S3824: raise issue when \"containsKey\" is used", "bodyText": "", "createdAt": "2020-12-01T14:54:45Z", "url": "https://github.com/SonarSource/sonar-java/pull/3309", "merged": true, "mergeCommit": {"oid": "10d9f5165fc7cb023c7d9cc1cee2f8dd809f9db1"}, "closed": true, "closedAt": "2020-12-03T11:12:16Z", "author": {"login": "margarita-nedzelska-sonarsource"}, "timelineItems": {"totalCount": 18, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdh8U8bgBqjQwNTgwMzIwOTE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdihMA5gFqTU0Mzg0NjE3NA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "589d924c39fa03ded6b75cc98a86d44d47b8fcb9", "author": {"user": {"login": "margarita-nedzelska-sonarsource", "name": null}}, "url": "https://github.com/SonarSource/sonar-java/commit/589d924c39fa03ded6b75cc98a86d44d47b8fcb9", "committedDate": "2020-12-01T14:54:01Z", "message": "WIP"}, "afterCommit": {"oid": "68eaa41b38aaa9e577c99a9dfaaa78ab569ade78", "author": {"user": {"login": "margarita-nedzelska-sonarsource", "name": null}}, "url": "https://github.com/SonarSource/sonar-java/commit/68eaa41b38aaa9e577c99a9dfaaa78ab569ade78", "committedDate": "2020-12-01T16:13:36Z", "message": "WIP"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "68eaa41b38aaa9e577c99a9dfaaa78ab569ade78", "author": {"user": {"login": "margarita-nedzelska-sonarsource", "name": null}}, "url": "https://github.com/SonarSource/sonar-java/commit/68eaa41b38aaa9e577c99a9dfaaa78ab569ade78", "committedDate": "2020-12-01T16:13:36Z", "message": "WIP"}, "afterCommit": {"oid": "963e04e43b7270bd39d6c06db1e1f49942e3bb82", "author": {"user": {"login": "margarita-nedzelska-sonarsource", "name": null}}, "url": "https://github.com/SonarSource/sonar-java/commit/963e04e43b7270bd39d6c06db1e1f49942e3bb82", "committedDate": "2020-12-01T16:31:26Z", "message": "WIP"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "963e04e43b7270bd39d6c06db1e1f49942e3bb82", "author": {"user": {"login": "margarita-nedzelska-sonarsource", "name": null}}, "url": "https://github.com/SonarSource/sonar-java/commit/963e04e43b7270bd39d6c06db1e1f49942e3bb82", "committedDate": "2020-12-01T16:31:26Z", "message": "WIP"}, "afterCommit": {"oid": "51cdeabb9c31f58bc92b830e729b32c71c2c49c3", "author": {"user": {"login": "margarita-nedzelska-sonarsource", "name": null}}, "url": "https://github.com/SonarSource/sonar-java/commit/51cdeabb9c31f58bc92b830e729b32c71c2c49c3", "committedDate": "2020-12-01T16:50:46Z", "message": "WIP"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "51cdeabb9c31f58bc92b830e729b32c71c2c49c3", "author": {"user": {"login": "margarita-nedzelska-sonarsource", "name": null}}, "url": "https://github.com/SonarSource/sonar-java/commit/51cdeabb9c31f58bc92b830e729b32c71c2c49c3", "committedDate": "2020-12-01T16:50:46Z", "message": "WIP"}, "afterCommit": {"oid": "dc6d90a36b335dd8913d32540bf2b30c50ff2d37", "author": {"user": {"login": "margarita-nedzelska-sonarsource", "name": null}}, "url": "https://github.com/SonarSource/sonar-java/commit/dc6d90a36b335dd8913d32540bf2b30c50ff2d37", "committedDate": "2020-12-02T09:47:56Z", "message": "SONARJAVA-3130 S3824: raise issue when \"containsKey\" is used"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "dc6d90a36b335dd8913d32540bf2b30c50ff2d37", "author": {"user": {"login": "margarita-nedzelska-sonarsource", "name": null}}, "url": "https://github.com/SonarSource/sonar-java/commit/dc6d90a36b335dd8913d32540bf2b30c50ff2d37", "committedDate": "2020-12-02T09:47:56Z", "message": "SONARJAVA-3130 S3824: raise issue when \"containsKey\" is used"}, "afterCommit": {"oid": "f424bb58e4ba4afbef5c1a16dfb1da24e55d17c1", "author": {"user": {"login": "margarita-nedzelska-sonarsource", "name": null}}, "url": "https://github.com/SonarSource/sonar-java/commit/f424bb58e4ba4afbef5c1a16dfb1da24e55d17c1", "committedDate": "2020-12-02T10:03:58Z", "message": "SONARJAVA-3130 S3824: raise issue when \"containsKey\" is used"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f424bb58e4ba4afbef5c1a16dfb1da24e55d17c1", "author": {"user": {"login": "margarita-nedzelska-sonarsource", "name": null}}, "url": "https://github.com/SonarSource/sonar-java/commit/f424bb58e4ba4afbef5c1a16dfb1da24e55d17c1", "committedDate": "2020-12-02T10:03:58Z", "message": "SONARJAVA-3130 S3824: raise issue when \"containsKey\" is used"}, "afterCommit": {"oid": "3c7a97eee56bec56c6cc7ab6f74a8ebb1ff9fc95", "author": {"user": {"login": "margarita-nedzelska-sonarsource", "name": null}}, "url": "https://github.com/SonarSource/sonar-java/commit/3c7a97eee56bec56c6cc7ab6f74a8ebb1ff9fc95", "committedDate": "2020-12-02T10:10:31Z", "message": "SONARJAVA-3130 S3824: raise issue when \"containsKey\" is used"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3c7a97eee56bec56c6cc7ab6f74a8ebb1ff9fc95", "author": {"user": {"login": "margarita-nedzelska-sonarsource", "name": null}}, "url": "https://github.com/SonarSource/sonar-java/commit/3c7a97eee56bec56c6cc7ab6f74a8ebb1ff9fc95", "committedDate": "2020-12-02T10:10:31Z", "message": "SONARJAVA-3130 S3824: raise issue when \"containsKey\" is used"}, "afterCommit": {"oid": "9ee54aa126b2776d35151caf443399636e4eccc8", "author": {"user": {"login": "margarita-nedzelska-sonarsource", "name": null}}, "url": "https://github.com/SonarSource/sonar-java/commit/9ee54aa126b2776d35151caf443399636e4eccc8", "committedDate": "2020-12-02T10:34:02Z", "message": "SONARJAVA-3130 S3824: raise issue when \"containsKey\" is used"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "9ee54aa126b2776d35151caf443399636e4eccc8", "author": {"user": {"login": "margarita-nedzelska-sonarsource", "name": null}}, "url": "https://github.com/SonarSource/sonar-java/commit/9ee54aa126b2776d35151caf443399636e4eccc8", "committedDate": "2020-12-02T10:34:02Z", "message": "SONARJAVA-3130 S3824: raise issue when \"containsKey\" is used"}, "afterCommit": {"oid": "7d8a01018ccf42eb584bc27923bae4017a7694b7", "author": {"user": {"login": "margarita-nedzelska-sonarsource", "name": null}}, "url": "https://github.com/SonarSource/sonar-java/commit/7d8a01018ccf42eb584bc27923bae4017a7694b7", "committedDate": "2020-12-02T10:49:55Z", "message": "SONARJAVA-3130 S3824: raise issue when \"containsKey\" is used"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7d8a01018ccf42eb584bc27923bae4017a7694b7", "author": {"user": {"login": "margarita-nedzelska-sonarsource", "name": null}}, "url": "https://github.com/SonarSource/sonar-java/commit/7d8a01018ccf42eb584bc27923bae4017a7694b7", "committedDate": "2020-12-02T10:49:55Z", "message": "SONARJAVA-3130 S3824: raise issue when \"containsKey\" is used"}, "afterCommit": {"oid": "e7e9f5d0fab20f390834d5454e9b7c742648e039", "author": {"user": {"login": "margarita-nedzelska-sonarsource", "name": null}}, "url": "https://github.com/SonarSource/sonar-java/commit/e7e9f5d0fab20f390834d5454e9b7c742648e039", "committedDate": "2020-12-02T10:59:30Z", "message": "SONARJAVA-3130 S3824: raise issue when \"containsKey\" is used"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e7e9f5d0fab20f390834d5454e9b7c742648e039", "author": {"user": {"login": "margarita-nedzelska-sonarsource", "name": null}}, "url": "https://github.com/SonarSource/sonar-java/commit/e7e9f5d0fab20f390834d5454e9b7c742648e039", "committedDate": "2020-12-02T10:59:30Z", "message": "SONARJAVA-3130 S3824: raise issue when \"containsKey\" is used"}, "afterCommit": {"oid": "db77f292c156b259f49f10c9b15aa62361490778", "author": {"user": {"login": "margarita-nedzelska-sonarsource", "name": null}}, "url": "https://github.com/SonarSource/sonar-java/commit/db77f292c156b259f49f10c9b15aa62361490778", "committedDate": "2020-12-02T12:16:31Z", "message": "SONARJAVA-3130 S3824: raise issue when \"containsKey\" is used"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ea2736b195440d0a090defd8d12d09f0b76f0734", "author": {"user": {"login": "margarita-nedzelska-sonarsource", "name": null}}, "url": "https://github.com/SonarSource/sonar-java/commit/ea2736b195440d0a090defd8d12d09f0b76f0734", "committedDate": "2020-12-02T12:26:23Z", "message": "SONARJAVA-3130 S3824: raise issue when \"containsKey\" is used"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "db77f292c156b259f49f10c9b15aa62361490778", "author": {"user": {"login": "margarita-nedzelska-sonarsource", "name": null}}, "url": "https://github.com/SonarSource/sonar-java/commit/db77f292c156b259f49f10c9b15aa62361490778", "committedDate": "2020-12-02T12:16:31Z", "message": "SONARJAVA-3130 S3824: raise issue when \"containsKey\" is used"}, "afterCommit": {"oid": "ea2736b195440d0a090defd8d12d09f0b76f0734", "author": {"user": {"login": "margarita-nedzelska-sonarsource", "name": null}}, "url": "https://github.com/SonarSource/sonar-java/commit/ea2736b195440d0a090defd8d12d09f0b76f0734", "committedDate": "2020-12-02T12:26:23Z", "message": "SONARJAVA-3130 S3824: raise issue when \"containsKey\" is used"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ef413b3ae3e6305c7d8703b89dfc89fbb06c3e72", "author": {"user": {"login": "margarita-nedzelska-sonarsource", "name": null}}, "url": "https://github.com/SonarSource/sonar-java/commit/ef413b3ae3e6305c7d8703b89dfc89fbb06c3e72", "committedDate": "2020-12-02T13:12:02Z", "message": "Refactoring"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQyOTMyMzg5", "url": "https://github.com/SonarSource/sonar-java/pull/3309#pullrequestreview-542932389", "createdAt": "2020-12-02T15:09:42Z", "commit": {"oid": "ea2736b195440d0a090defd8d12d09f0b76f0734"}, "state": "COMMENTED", "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wMlQxNTowOTo0MlrOH9fimg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wMlQxNToyMjozMlrOH9gJ6g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDI0MTk0Ng==", "bodyText": "I'm a bit surprised that we are not catching the exact same pattern a few lines above (lines 120 and 125). I feel it's due to the fact that we are using constants as MemberSelectExpressionTree, which should be exactly the same.\nCan you check that if the problem is on the SE engine side (the way we associate constants with SVs) or if it comes from the rule itself?\nIf it comes from the SE engine, then we need a ticket.", "url": "https://github.com/SonarSource/sonar-java/pull/3309#discussion_r534241946", "createdAt": "2020-12-02T15:09:42Z", "author": {"login": "m-g-sonar"}, "path": "its/ruling/src/test/resources/eclipse-jetty/java-S3824.json", "diffHunk": "@@ -1,4 +1,7 @@\n {\n+'org.eclipse.jetty:jetty-project:jetty-jmx/src/main/java/org/eclipse/jetty/jmx/ConnectorServer.java':[\n+127,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ea2736b195440d0a090defd8d12d09f0b76f0734"}, "originalPosition": 3}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDI0MzYwMA==", "bodyText": "very nice findings!", "url": "https://github.com/SonarSource/sonar-java/pull/3309#discussion_r534243600", "createdAt": "2020-12-02T15:11:49Z", "author": {"login": "m-g-sonar"}, "path": "its/ruling/src/test/resources/sonar-server/java-S3824.json", "diffHunk": "@@ -11,10 +15,20 @@\n 'org.sonarsource.sonarqube:sonar-server:src/main/java/org/sonar/server/issue/notification/NewIssuesStatistics.java':[\n 53,\n ],\n+'org.sonarsource.sonarqube:sonar-server:src/main/java/org/sonar/server/issue/ws/SearchAction.java':[\n+408,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ea2736b195440d0a090defd8d12d09f0b76f0734"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDI0NjA0Mg==", "bodyText": "unused import", "url": "https://github.com/SonarSource/sonar-java/pull/3309#discussion_r534246042", "createdAt": "2020-12-02T15:15:05Z", "author": {"login": "m-g-sonar"}, "path": "java-checks-test-sources/src/main/java/symbolicexecution/checks/MapComputeIfAbsentOrPresentCheck.java", "diffHunk": "@@ -1,11 +1,14 @@\n+package symbolicexecution.checks;\n+\n import com.google.common.base.Preconditions;\n \n import javax.annotation.CheckForNull;\n \n import java.util.Map;\n import java.util.Objects;\n+import org.elasticsearch.common.MacAddressProvider;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ea2736b195440d0a090defd8d12d09f0b76f0734"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDI1MDY2OA==", "bodyText": "Love this part! pretty nice job!", "url": "https://github.com/SonarSource/sonar-java/pull/3309#discussion_r534250668", "createdAt": "2020-12-02T15:20:53Z", "author": {"login": "m-g-sonar"}, "path": "java-frontend/src/main/java/org/sonar/java/se/checks/MapComputeIfAbsentOrPresentCheck.java", "diffHunk": "@@ -153,60 +184,99 @@ public void checkEndOfExecution(CheckerContext context) {\n     checkIssues.stream().filter(checkIssue -> checkIssue.isOnlyPossibleIssueForReportTree(checkIssues)).forEach(issue -> issue.report(context, check));\n   }\n \n-  private static class CheckIssue {\n+  private abstract static class CheckIssue {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ea2736b195440d0a090defd8d12d09f0b76f0734"}, "originalPosition": 139}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDI1MjAxMA==", "bodyText": "From how it is implemented, getIfStatementParent(mit) can be pretty costly (it potentially explore the whole AST), and we are going to make such calls for each map.containsKey() or map.get().\nWhat about precomputing them or coaching them to avoid having to reexplore the AST for all these invocations?", "url": "https://github.com/SonarSource/sonar-java/pull/3309#discussion_r534252010", "createdAt": "2020-12-02T15:22:32Z", "author": {"login": "m-g-sonar"}, "path": "java-frontend/src/main/java/org/sonar/java/se/checks/MapComputeIfAbsentOrPresentCheck.java", "diffHunk": "@@ -126,15 +151,21 @@ private static boolean isMethodInvocationThrowingCheckedException(ExpressionTree\n   }\n \n   private static boolean isInsideIfStatementWithNullCheckWithoutElse(MethodInvocationTree mit) {\n+    return getIfStatementParent(mit).map(ifStatementTree -> ifStatementTree.elseStatement() == null", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ea2736b195440d0a090defd8d12d09f0b76f0734"}, "originalPosition": 111}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "609590186d600e808acfe0b7cf02991f16e7f9ce", "author": {"user": {"login": "margarita-nedzelska-sonarsource", "name": null}}, "url": "https://github.com/SonarSource/sonar-java/commit/609590186d600e808acfe0b7cf02991f16e7f9ce", "committedDate": "2020-12-02T16:36:26Z", "message": "SONARJAVA-3130 Apply review comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c79f195e1fc71a02db50cce2b78714a9ff8eba6e", "author": {"user": {"login": "margarita-nedzelska-sonarsource", "name": null}}, "url": "https://github.com/SonarSource/sonar-java/commit/c79f195e1fc71a02db50cce2b78714a9ff8eba6e", "committedDate": "2020-12-02T17:01:30Z", "message": "SONARJAVA-3130 Get rid of recursion because there is no tailrec optimization in Java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7a3013e81f1c11808a4f4eab187e066dc7a3dc00", "author": {"user": {"login": "margarita-nedzelska-sonarsource", "name": null}}, "url": "https://github.com/SonarSource/sonar-java/commit/7a3013e81f1c11808a4f4eab187e066dc7a3dc00", "committedDate": "2020-12-02T17:23:26Z", "message": "SONARJAVA-3130 Add proper flows for Map.containsKey()"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQzODQ2MTc0", "url": "https://github.com/SonarSource/sonar-java/pull/3309#pullrequestreview-543846174", "createdAt": "2020-12-03T11:10:39Z", "commit": {"oid": "7a3013e81f1c11808a4f4eab187e066dc7a3dc00"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1845, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}