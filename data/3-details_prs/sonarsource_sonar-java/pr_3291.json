{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTI0NTgzNTYy", "number": 3291, "title": "SONARJAVA-3547 Fix cast recommendation with !Unknown! type", "bodyText": "", "createdAt": "2020-11-20T09:48:59Z", "url": "https://github.com/SonarSource/sonar-java/pull/3291", "merged": true, "mergeCommit": {"oid": "645c884ac88d29b5761ea45b7aa99b9301dae5dc"}, "closed": true, "closedAt": "2020-11-20T17:37:07Z", "author": {"login": "margarita-nedzelska-sonarsource"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdeVG7MABqjQwMjAzMTI0Nzg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdeY9N4gBqjQwMjEzODUxMTU=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c167b1cfb6ca6f257cb933e22ddc8e7a1281f6af", "author": {"user": {"login": "margarita-nedzelska-sonarsource", "name": null}}, "url": "https://github.com/SonarSource/sonar-java/commit/c167b1cfb6ca6f257cb933e22ddc8e7a1281f6af", "committedDate": "2020-11-20T09:48:15Z", "message": "SONARJAVA-3547 Fix cast recommendation with !Unknown! type"}, "afterCommit": {"oid": "1f2885adca0be947e261b5b2fbb544edc4cd302c", "author": {"user": {"login": "margarita-nedzelska-sonarsource", "name": null}}, "url": "https://github.com/SonarSource/sonar-java/commit/1f2885adca0be947e261b5b2fbb544edc4cd302c", "committedDate": "2020-11-20T10:50:12Z", "message": "SONARJAVA-3547 Fix cast recommendation with !Unknown! type"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "1f2885adca0be947e261b5b2fbb544edc4cd302c", "author": {"user": {"login": "margarita-nedzelska-sonarsource", "name": null}}, "url": "https://github.com/SonarSource/sonar-java/commit/1f2885adca0be947e261b5b2fbb544edc4cd302c", "committedDate": "2020-11-20T10:50:12Z", "message": "SONARJAVA-3547 Fix cast recommendation with !Unknown! type"}, "afterCommit": {"oid": "2080118475ada9f5a7e786eaf3964d5436acab47", "author": {"user": {"login": "margarita-nedzelska-sonarsource", "name": null}}, "url": "https://github.com/SonarSource/sonar-java/commit/2080118475ada9f5a7e786eaf3964d5436acab47", "committedDate": "2020-11-20T10:58:03Z", "message": "SONARJAVA-3547 Fix cast recommendation with !Unknown! type"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "2080118475ada9f5a7e786eaf3964d5436acab47", "author": {"user": {"login": "margarita-nedzelska-sonarsource", "name": null}}, "url": "https://github.com/SonarSource/sonar-java/commit/2080118475ada9f5a7e786eaf3964d5436acab47", "committedDate": "2020-11-20T10:58:03Z", "message": "SONARJAVA-3547 Fix cast recommendation with !Unknown! type"}, "afterCommit": {"oid": "83a7db4097cfdc752ce6c903533fd1d0f4eab57d", "author": {"user": {"login": "margarita-nedzelska-sonarsource", "name": null}}, "url": "https://github.com/SonarSource/sonar-java/commit/83a7db4097cfdc752ce6c903533fd1d0f4eab57d", "committedDate": "2020-11-20T12:25:48Z", "message": "SONARJAVA-3547 Fix cast recommendation with !Unknown! type"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "83a7db4097cfdc752ce6c903533fd1d0f4eab57d", "author": {"user": {"login": "margarita-nedzelska-sonarsource", "name": null}}, "url": "https://github.com/SonarSource/sonar-java/commit/83a7db4097cfdc752ce6c903533fd1d0f4eab57d", "committedDate": "2020-11-20T12:25:48Z", "message": "SONARJAVA-3547 Fix cast recommendation with !Unknown! type"}, "afterCommit": {"oid": "8d407f508fb86c8170c79718885ac2cf5da131a0", "author": {"user": {"login": "margarita-nedzelska-sonarsource", "name": null}}, "url": "https://github.com/SonarSource/sonar-java/commit/8d407f508fb86c8170c79718885ac2cf5da131a0", "committedDate": "2020-11-20T12:59:40Z", "message": "SONARJAVA-3547 Fix cast recommendation with !Unknown! type"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM1NDY2MjA3", "url": "https://github.com/SonarSource/sonar-java/pull/3291#pullrequestreview-535466207", "createdAt": "2020-11-20T14:19:25Z", "commit": {"oid": "8d407f508fb86c8170c79718885ac2cf5da131a0"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yMFQxNDoxOToyNVrOH3Rmpg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yMFQxNDoxOToyNVrOH3Rmpg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzcyMjE1MA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                return i -> (R) i; // Compliant, 'R.class::cast' wont compile.\n          \n          \n            \n                return i -> (R) i; // Compliant, 'R.class::cast' won't compile.", "url": "https://github.com/SonarSource/sonar-java/pull/3291#discussion_r527722150", "createdAt": "2020-11-20T14:19:25Z", "author": {"login": "margarita-nedzelska-sonarsource"}, "path": "java-checks-test-sources/src/main/java/checks/ReplaceLambdaByMethodRefCheck.java", "diffHunk": "@@ -143,6 +165,10 @@ void test2(Object param) {\n     });\n   }\n \n+  private static <I, R> Function<I, R> castingIdentity() {\n+    return i -> (R) i; // Compliant, 'R.class::cast' wont compile.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8d407f508fb86c8170c79718885ac2cf5da131a0"}, "originalPosition": 41}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM1NDk0Mzgx", "url": "https://github.com/SonarSource/sonar-java/pull/3291#pullrequestreview-535494381", "createdAt": "2020-11-20T14:51:45Z", "commit": {"oid": "395d42ce77e3243e8481cdd06702c9051121ebc2"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yMFQxNDo1MTo0NlrOH3S6ZQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yMFQxNDo1MTo0NlrOH3S6ZQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzc0MzU4OQ==", "bodyText": "There is no such thing as an IdentifierTree not being an IdentifierTreeImpl, so the first test is useless.\nNow, I'm afraid I don't understand what you try to achieve here.\nTesting if we are in the presence of a raw type of a generic type? For instance (List) obj ?\nWhatever it is, we have a way to express this through our own API rather than relying on the toString() of the eclipse binding.", "url": "https://github.com/SonarSource/sonar-java/pull/3291#discussion_r527743589", "createdAt": "2020-11-20T14:51:46Z", "author": {"login": "m-g-sonar"}, "path": "java-checks/src/main/java/org/sonar/java/checks/ReplaceLambdaByMethodRefCheck.java", "diffHunk": "@@ -130,12 +135,32 @@ private static boolean nullAgainstParam(ExpressionTree o1, ExpressionTree o2, Sy\n     if (expr.is(Tree.Kind.TYPE_CAST)) {\n       TypeCastTree typeCastTree = (TypeCastTree) expr;\n       if (isSingleParamCast(typeCastTree.expression(), symbol)) {\n-        return Optional.of(typeCastTree.type().symbolType().name());\n+        return getTypeName(typeCastTree.type());\n       }\n     }\n     return Optional.empty();\n   }\n+  \n+  private static Optional<String> getTypeName(TypeTree type) {\n+    if (type.is(Tree.Kind.PARAMETERIZED_TYPE)) {\n+      type = ((ParameterizedTypeTree) type).type();\n+    }\n+    if (type.is(Tree.Kind.IDENTIFIER) && !isGeneric((IdentifierTree) type)) {\n+      return Optional.of(((IdentifierTree) type).name());\n+    }\n+    if (type.is(Tree.Kind.ARRAY_TYPE)) {\n+      return getTypeName(((ArrayTypeTree) type).type()).map(x -> x + \"[]\");\n+    }\n+    if (type.is(Tree.Kind.PRIMITIVE_TYPE)) {\n+      return Optional.of(((PrimitiveTypeTree) type).keyword().text());\n+    }\n+    return Optional.empty();\n+  }\n \n+  private static boolean isGeneric(IdentifierTree identifierTree) {\n+    return (identifierTree instanceof IdentifierTreeImpl) && ((IdentifierTreeImpl) identifierTree).binding.toString().matches(\"<[A-Z]>\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "395d42ce77e3243e8481cdd06702c9051121ebc2"}, "originalPosition": 53}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7cd57dfb2a1e470b8472cb66ac6dbea253e4ffa8", "author": {"user": {"login": "margarita-nedzelska-sonarsource", "name": null}}, "url": "https://github.com/SonarSource/sonar-java/commit/7cd57dfb2a1e470b8472cb66ac6dbea253e4ffa8", "committedDate": "2020-11-20T15:19:11Z", "message": "SONARJAVA-3547 Fix cast recommendation with !Unknown! type"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1fa7d2560ca23d1f7116491f6450f78a27768796", "author": {"user": {"login": "margarita-nedzelska-sonarsource", "name": null}}, "url": "https://github.com/SonarSource/sonar-java/commit/1fa7d2560ca23d1f7116491f6450f78a27768796", "committedDate": "2020-11-20T15:19:11Z", "message": "Update java-checks-test-sources/src/main/java/checks/ReplaceLambdaByMethodRefCheck.java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cf226f67435570105b7822221e8dab329f98426e", "author": {"user": {"login": "margarita-nedzelska-sonarsource", "name": null}}, "url": "https://github.com/SonarSource/sonar-java/commit/cf226f67435570105b7822221e8dab329f98426e", "committedDate": "2020-11-20T15:19:11Z", "message": "SONARJAVA-3547 Fix cast recommendation with !Unknown! type"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "886c62e0d95996e39420157ab0cc27b5e9618e7a", "author": {"user": {"login": "margarita-nedzelska-sonarsource", "name": null}}, "url": "https://github.com/SonarSource/sonar-java/commit/886c62e0d95996e39420157ab0cc27b5e9618e7a", "committedDate": "2020-11-20T15:17:56Z", "message": "SONARJAVA-3547 Fix cast recommendation with !Unknown! type"}, "afterCommit": {"oid": "cf226f67435570105b7822221e8dab329f98426e", "author": {"user": {"login": "margarita-nedzelska-sonarsource", "name": null}}, "url": "https://github.com/SonarSource/sonar-java/commit/cf226f67435570105b7822221e8dab329f98426e", "committedDate": "2020-11-20T15:19:11Z", "message": "SONARJAVA-3547 Fix cast recommendation with !Unknown! type"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1949, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}