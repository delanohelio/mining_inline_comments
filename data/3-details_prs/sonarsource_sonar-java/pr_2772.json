{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY3NTI1ODQ0", "number": 2772, "title": "SONARJAVA-3240 Fixing handling of exceptions in rules", "bodyText": "", "createdAt": "2020-01-27T14:36:03Z", "url": "https://github.com/SonarSource/sonar-java/pull/2772", "merged": true, "mergeCommit": {"oid": "f7968322359da7c4b3587ea99a90a32b747269ab"}, "closed": true, "closedAt": "2020-01-29T12:57:50Z", "author": {"login": "m-g-sonar"}, "timelineItems": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb-fk28gBqjI5ODI1NTc1Mzc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABb_FBjngBqjI5ODkyOTYyODA=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0201eb15086f29201d8255964902005e649fb3c8", "author": {"user": {"login": "m-g-sonar", "name": "Michael Gumowski"}}, "url": "https://github.com/SonarSource/sonar-java/commit/0201eb15086f29201d8255964902005e649fb3c8", "committedDate": "2020-01-21T16:33:35Z", "message": "Handle exception during visit for subscription visitors"}, "afterCommit": {"oid": "d435855788359b7de92e8c24068ec969fab46768", "author": {"user": {"login": "m-g-sonar", "name": "Michael Gumowski"}}, "url": "https://github.com/SonarSource/sonar-java/commit/d435855788359b7de92e8c24068ec969fab46768", "committedDate": "2020-01-27T16:45:13Z", "message": "Handle exception during visit for subscription visitors"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d435855788359b7de92e8c24068ec969fab46768", "author": {"user": {"login": "m-g-sonar", "name": "Michael Gumowski"}}, "url": "https://github.com/SonarSource/sonar-java/commit/d435855788359b7de92e8c24068ec969fab46768", "committedDate": "2020-01-27T16:45:13Z", "message": "Handle exception during visit for subscription visitors"}, "afterCommit": {"oid": "4d79624cfc661f320d93d86e7600bf20a6ba4ede", "author": {"user": {"login": "m-g-sonar", "name": "Michael Gumowski"}}, "url": "https://github.com/SonarSource/sonar-java/commit/4d79624cfc661f320d93d86e7600bf20a6ba4ede", "committedDate": "2020-01-27T17:10:39Z", "message": "Handle exception during visit for subscription visitors"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4d79624cfc661f320d93d86e7600bf20a6ba4ede", "author": {"user": {"login": "m-g-sonar", "name": "Michael Gumowski"}}, "url": "https://github.com/SonarSource/sonar-java/commit/4d79624cfc661f320d93d86e7600bf20a6ba4ede", "committedDate": "2020-01-27T17:10:39Z", "message": "Handle exception during visit for subscription visitors"}, "afterCommit": {"oid": "bd03715de9554d2d25f206bdfcf59302e440778f", "author": {"user": {"login": "m-g-sonar", "name": "Michael Gumowski"}}, "url": "https://github.com/SonarSource/sonar-java/commit/bd03715de9554d2d25f206bdfcf59302e440778f", "committedDate": "2020-01-27T17:20:08Z", "message": "Handle exception during visit for subscription visitors"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "94e1fa1f732e9d6f050a3a00c4c9437c09e072ab", "author": {"user": {"login": "quentin-jaquier-sonarsource", "name": null}}, "url": "https://github.com/SonarSource/sonar-java/commit/94e1fa1f732e9d6f050a3a00c4c9437c09e072ab", "committedDate": "2020-01-28T12:23:38Z", "message": "Catch unexpected Exception at file level"}, "afterCommit": {"oid": "911f72e2245876cf23ec7c938780e95715671724", "author": {"user": {"login": "quentin-jaquier-sonarsource", "name": null}}, "url": "https://github.com/SonarSource/sonar-java/commit/911f72e2245876cf23ec7c938780e95715671724", "committedDate": "2020-01-28T13:24:05Z", "message": "Catch unexpected Exception at file level"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ5NDQzNTc1", "url": "https://github.com/SonarSource/sonar-java/pull/2772#pullrequestreview-349443575", "createdAt": "2020-01-28T15:01:35Z", "commit": {"oid": "b196dd6eb1009f4124d8c2871ae1ec08e1464d7b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQxNTowMTozNVrOFioQwQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQxNTowMTozNVrOFioQwQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTg1NTU1Mw==", "bodyText": "In the current situation, if you want to implement this behavior, you can remove the two try/catch in visitFile(), the CheckFailureException will be catched in JavaAstScanner::simpleScan and fail fast if needed.\nHowever:\n\nin the case of IssuableSubscriptionVisitors, it will not change anything as it is the last step of the visit.\ndo we really want to report no issue on a file who fails SymbolicExecution checks?", "url": "https://github.com/SonarSource/sonar-java/pull/2772#discussion_r371855553", "createdAt": "2020-01-28T15:01:35Z", "author": {"login": "quentin-jaquier-sonarsource"}, "path": "java-frontend/src/main/java/org/sonar/java/model/VisitorsBridge.java", "diffHunk": "@@ -175,22 +175,20 @@ private void runScanner(Runnable action, JavaFileScanner scanner, AnalysisError.\n       // bad configuration of a rule parameter, we want to fail analysis fast.\n       throw new AnalysisException(\"Bad configuration of rule parameter\", e);\n     } catch (Exception e) {\n-      if (sonarComponents != null && sonarComponents.shouldFailAnalysisOnException()) {\n-        throw e;\n-      }\n       Throwable rootCause = Throwables.getRootCause(e);\n       if (rootCause instanceof InterruptedIOException || rootCause instanceof InterruptedException) {\n         throw e;\n       }\n+\n       String ruleKey = ruleKey(scanner);\n-      LOG.error(\n-        String.format(\"Unable to run check %s - %s on file '%s', To help improve SonarJava, please report this problem to SonarSource : see https://www.sonarqube.org/community/\",\n-          scanner.getClass(), ruleKey, currentFile),\n-        e);\n+      String message = String.format(\n+        \"Unable to run check %s - %s on file '%s', To help improve SonarJava, please report this problem to SonarSource : see https://www.sonarqube.org/community/\",\n+        scanner.getClass(), ruleKey, currentFile);\n+\n+      LOG.error(message, e);\n       addAnalysisError(e, currentFile, kind);\n \n-      // for IssuableSubscriptionVisitors as well as for SymbolicExecution, this should lead to changing file", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b196dd6eb1009f4124d8c2871ae1ec08e1464d7b"}, "originalPosition": 24}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b196dd6eb1009f4124d8c2871ae1ec08e1464d7b", "author": {"user": {"login": "quentin-jaquier-sonarsource", "name": null}}, "url": "https://github.com/SonarSource/sonar-java/commit/b196dd6eb1009f4124d8c2871ae1ec08e1464d7b", "committedDate": "2020-01-28T14:53:12Z", "message": "Don't fail fast before logging"}, "afterCommit": {"oid": "dae4270470e8bb714ec8a6bcf0ea60a6a1fdb066", "author": {"user": {"login": "quentin-jaquier-sonarsource", "name": null}}, "url": "https://github.com/SonarSource/sonar-java/commit/dae4270470e8bb714ec8a6bcf0ea60a6a1fdb066", "committedDate": "2020-01-28T15:08:09Z", "message": "Don't fail fast before logging"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "23eb7c772e30a5047f017b3da0046e11918d51c1", "author": {"user": {"login": "quentin-jaquier-sonarsource", "name": null}}, "url": "https://github.com/SonarSource/sonar-java/commit/23eb7c772e30a5047f017b3da0046e11918d51c1", "committedDate": "2020-01-29T08:58:43Z", "message": "Add test for SECheck"}, "afterCommit": {"oid": "01f061b0d6fc199a65682f033090438d17386557", "author": {"user": {"login": "quentin-jaquier-sonarsource", "name": null}}, "url": "https://github.com/SonarSource/sonar-java/commit/01f061b0d6fc199a65682f033090438d17386557", "committedDate": "2020-01-29T09:07:14Z", "message": "Add test for SECheck"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUwMDQ4OTY2", "url": "https://github.com/SonarSource/sonar-java/pull/2772#pullrequestreview-350048966", "createdAt": "2020-01-29T11:51:37Z", "commit": {"oid": "4e8588dffc856f13710f702f09d728af88e7dca2"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ef52359fff05c698d83f48d6bbf160c8e614b7d2", "author": {"user": {"login": "m-g-sonar", "name": "Michael Gumowski"}}, "url": "https://github.com/SonarSource/sonar-java/commit/ef52359fff05c698d83f48d6bbf160c8e614b7d2", "committedDate": "2020-01-29T11:54:06Z", "message": "SONARJAVA-3240 Fix handling of exceptions happening in rules"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4e8588dffc856f13710f702f09d728af88e7dca2", "author": {"user": {"login": "m-g-sonar", "name": "Michael Gumowski"}}, "url": "https://github.com/SonarSource/sonar-java/commit/4e8588dffc856f13710f702f09d728af88e7dca2", "committedDate": "2020-01-29T10:47:08Z", "message": "fix"}, "afterCommit": {"oid": "ef52359fff05c698d83f48d6bbf160c8e614b7d2", "author": {"user": {"login": "m-g-sonar", "name": "Michael Gumowski"}}, "url": "https://github.com/SonarSource/sonar-java/commit/ef52359fff05c698d83f48d6bbf160c8e614b7d2", "committedDate": "2020-01-29T11:54:06Z", "message": "SONARJAVA-3240 Fix handling of exceptions happening in rules"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fb52f32e7a8dc64071d3e0eb735914299b2c454a", "author": {"user": {"login": "m-g-sonar", "name": "Michael Gumowski"}}, "url": "https://github.com/SonarSource/sonar-java/commit/fb52f32e7a8dc64071d3e0eb735914299b2c454a", "committedDate": "2020-01-29T12:21:01Z", "message": "SONARJAVA-3240 Rename fail-fast property\n\nFrom 'sonar.java.failOnException' to  'sonar.internal.analysis.failFast'"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f1fdd010550700e237304f23883afcf5081decb2", "author": {"user": {"login": "m-g-sonar", "name": "Michael Gumowski"}}, "url": "https://github.com/SonarSource/sonar-java/commit/f1fdd010550700e237304f23883afcf5081decb2", "committedDate": "2020-01-29T12:08:06Z", "message": "SONARJAVA-3240 Rename fail-fast property\n\nFrom 'sonar.java.failOnException' to  'sonar.internal.analysis.failFast'"}, "afterCommit": {"oid": "fb52f32e7a8dc64071d3e0eb735914299b2c454a", "author": {"user": {"login": "m-g-sonar", "name": "Michael Gumowski"}}, "url": "https://github.com/SonarSource/sonar-java/commit/fb52f32e7a8dc64071d3e0eb735914299b2c454a", "committedDate": "2020-01-29T12:21:01Z", "message": "SONARJAVA-3240 Rename fail-fast property\n\nFrom 'sonar.java.failOnException' to  'sonar.internal.analysis.failFast'"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1808, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}