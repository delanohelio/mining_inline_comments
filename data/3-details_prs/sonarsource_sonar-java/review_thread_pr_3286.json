{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTIzMjQ4MDYx", "number": 3286, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQwODo0OTo1NlrOE672yA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQwODo1MTo1M1rOE675sA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMwMjMzNTQ0OnYy", "diffSide": "RIGHT", "path": "java-frontend/src/main/java/org/sonar/java/ast/JavaAstScanner.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQwODo0OTo1NlrOH2Sffw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQwODo0OTo1NlrOH2Sffw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjY4ODEyNw==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                + \" Such file can only exists in Java9+ projects.\";\n          \n          \n            \n                + \" Such file can only exist in Java9+ projects.\";", "url": "https://github.com/SonarSource/sonar-java/pull/3286#discussion_r526688127", "createdAt": "2020-11-19T08:49:56Z", "author": {"login": "margarita-nedzelska-sonarsource"}, "path": "java-frontend/src/main/java/org/sonar/java/ast/JavaAstScanner.java", "diffHunk": "@@ -42,16 +43,23 @@\n public class JavaAstScanner {\n   private static final Logger LOG = Loggers.get(JavaAstScanner.class);\n \n+  private static final String LOG_ERROR_STACKOVERFLOW = \"A stack overflow error occurred while analyzing file: '%s'\";\n+  private static final String LOG_ERROR_UNABLE_TO_PARSE_FILE = \"Unable to parse source file : '%s'\";\n+  private static final String LOG_WARN_MISCONFIGURED_JAVA_VERSION = \"Analyzing '%s' file with misconfigured Java version.\"\n+    + \" Please check that property '%s' is correctly configured (currently set to: %d) or exclude 'module-info.java' files from analysis.\"\n+    + \" Such file can only exists in Java9+ projects.\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9834941fd655fc9d171513ae1660098cb2c4c4aa"}, "originalPosition": 25}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMwMjM0Mjg4OnYy", "diffSide": "RIGHT", "path": "java-frontend/src/test/java/org/sonar/java/ast/JavaAstScannerTest.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQwODo1MTo1M1rOH2SkGA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQwODo1MTo1M1rOH2SkGA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjY4OTMwNA==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    + \" Such file can only exists in Java9+ projects.\"));\n          \n          \n            \n                    + \" Such file can only exist in Java9+ projects.\"));", "url": "https://github.com/SonarSource/sonar-java/pull/3286#discussion_r526689304", "createdAt": "2020-11-19T08:51:53Z", "author": {"login": "margarita-nedzelska-sonarsource"}, "path": "java-frontend/src/test/java/org/sonar/java/ast/JavaAstScannerTest.java", "diffHunk": "@@ -227,13 +225,38 @@ void should_propagate_SOError() {\n     }\n   }\n \n+  @Test\n+  void should_report_misconfigured_java_version() {\n+    VisitorsBridge visitorsBridge = new VisitorsBridge(new JavaFileScanner() {\n+      @Override\n+      public void scanFile(JavaFileScannerContext context) { /* do nothing */ }\n+    });\n+    visitorsBridge.setJavaVersion(new JavaVersionImpl(8));\n+\n+    InputFile inputFile = TestUtils.inputFile(\"src/test/resources/module-info.java\");\n+    List<InputFile> files = Arrays.asList(inputFile, inputFile);\n+\n+    JavaAstScanner scanner = new JavaAstScanner(null);\n+    scanner.setVisitorBridge(visitorsBridge);\n+    scanner.scan(files);\n+\n+    assertThat(logTester.logs(LoggerLevel.ERROR)).isEmpty();\n+    assertThat(logTester.logs(LoggerLevel.WARN))\n+      // two files, only one log\n+      .hasSize(1)\n+      // skipping start of logs which contains path, and depends of OS\n+      .allMatch(log -> log.endsWith(\"module-info.java' file with misconfigured Java version.\"\n+        + \" Please check that property 'sonar.java.source' is correctly configured (currently set to: 8) or exclude 'module-info.java' files from analysis.\"\n+        + \" Such file can only exists in Java9+ projects.\"));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9834941fd655fc9d171513ae1660098cb2c4c4aa"}, "originalPosition": 45}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3835, "cost": 1, "resetAt": "2021-11-13T12:26:42Z"}}}