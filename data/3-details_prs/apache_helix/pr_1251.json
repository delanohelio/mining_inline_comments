{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY2MzkxNjY3", "number": 1251, "title": "Add totalMessageReceivedCounter and decrepcate old totalMessageReceived", "bodyText": "Issues\n\n My PR addresses the following Helix issues and references them in the PR description:\n\nfixes #1249\nDescription\n\n Here are some details about my PR, including screenshots of any UI changes:\n\nCurrently we should have counter type for totalMessageReceived but did not make it correct.\nTo fix this, we should have the a new counter metrics instead of directly changing the metrics for smooth migration.\nTests\n\n\n The following tests are written for this issue:\n\n\n The following is the result of the \"mvn test\" command on the appropriate module:\n[INFO] Results:\n[INFO]\n[ERROR] Failures:\n[ERROR]   TestWagedRebalance.testChangeIdealState:303->validate:646 expected: but was:\n[INFO]\n[ERROR] Tests run: 1163, Failures: 1, Errors: 0, Skipped: 0\n[INFO]\n[INFO] ------------------------------------------------------------------------\n[INFO] BUILD FAILURE\n[INFO] ------------------------------------------------------------------------\n[INFO] Total time: 01:22 h\n[INFO] Finished at: 2020-08-11T14:56:32-07:00\n[INFO] Final Memory: 32M/1106M\n[INFO] ------------------------------------------------------------------------\n\n\n[INFO] Tests run: 11, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 58.931 s - in org.apache.helix.integration.rebalancer.WagedRebalancer.TestWagedRebalance\n[INFO]\n[INFO] Results:\n[INFO]\n[INFO] Tests run: 11, Failures: 0, Errors: 0, Skipped: 0\n[INFO]\n[INFO] ------------------------------------------------------------------------\n[INFO] BUILD SUCCESS\n[INFO] ------------------------------------------------------------------------\n[INFO] Total time: 01:05 min\n[INFO] Finished at: 2020-08-11T15:35:08-07:00\n[INFO] Final Memory: 32M/1113M\n[INFO] ------------------------------------------------------------------------\nDocumentation (Optional)\n\nIn case of new functionality, my PR adds documentation in the following wiki page:\n\nCommits\n\nMy commits all reference appropriate Apache Helix GitHub issues in their subject lines. In addition, my commits follow the guidelines from \"How to write a good git commit message\":\n\nSubject is separated from body by a blank line\nSubject is limited to 50 characters (not including Jira issue reference)\nSubject does not end with a period\nSubject uses the imperative mood (\"add\", not \"adding\")\nBody wraps at 72 characters\nBody explains \"what\" and \"why\", not \"how\"\n\n\n\nCode Quality\n\nMy diff has been formatted using helix-style.xml\n(helix-style-intellij.xml if IntelliJ IDE is used)", "createdAt": "2020-08-11T22:35:32Z", "url": "https://github.com/apache/helix/pull/1251", "merged": true, "mergeCommit": {"oid": "f737b83245594e80c2d28b0c3da3b00bec50fd99"}, "closed": true, "closedAt": "2020-08-12T18:01:40Z", "author": {"login": "junkaixue"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc97448AH2gAyNDY2MzkxNjY3OmQ0NDY3NGJhMmEyMzExMGQ5MzRjMDA4ZGIwOTE5NjRhNGI1MTJjYjM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc-PUc1AH2gAyNDY2MzkxNjY3OjcwNjM3NzA4MjQyN2MwNGI2ZGY5NWE4ODRlZjM1OWEwNmJjNDUwNjc=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "d44674ba2a23110d934c008db091964a4b512cb3", "author": {"user": {"login": "junkaixue", "name": "Junkai Xue"}}, "url": "https://github.com/apache/helix/commit/d44674ba2a23110d934c008db091964a4b512cb3", "committedDate": "2020-08-11T19:22:00Z", "message": "Add totalMessageReceivedCounter and decrepcate old totalMessageReceived\n\nCurrently we should have counter type for totalMessageReceived but did not make it correct.\nTo fix this, we should have the a new counter metrics instead of directly changing the metrics for smooth migration."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY1NjQzNTc4", "url": "https://github.com/apache/helix/pull/1251#pullrequestreview-465643578", "createdAt": "2020-08-12T07:07:53Z", "commit": {"oid": "d44674ba2a23110d934c008db091964a4b512cb3"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMlQwNzowNzo1M1rOG_Ug8A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMlQwNzowNzo1M1rOG_Ug8A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTA0OTU4NA==", "bodyText": "Nit: I think it would be good to add here why this needs to be a counter. We could add something like:\nBecause this is a metric indicating a \"total\" count (a.k.a. ever-increasing) value, we want to make sure this metric is a counter. If a gauge is used, the metric might get reset upon a controller switch, which won't be ever-increasing.\nWhat do you think?", "url": "https://github.com/apache/helix/pull/1251#discussion_r469049584", "createdAt": "2020-08-12T07:07:53Z", "author": {"login": "narendly"}, "path": "helix-core/src/main/java/org/apache/helix/monitoring/mbeans/ResourceMonitor.java", "diffHunk": "@@ -71,8 +71,9 @@\n   private SimpleDynamicMetric<Long> _successTopStateHandoffCounter;\n   private SimpleDynamicMetric<Long> _failedTopStateHandoffCounter;\n   private SimpleDynamicMetric<Long> _maxSinglePartitionTopStateHandoffDuration;\n-  private SimpleDynamicMetric<Long> _totalMessageReceived;\n-\n+  @Deprecated\n+  private SimpleDynamicMetric<Long> _totalMessageReceived; // This should be counter but it is not now", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d44674ba2a23110d934c008db091964a4b512cb3"}, "originalPosition": 7}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY1NjQzNjIz", "url": "https://github.com/apache/helix/pull/1251#pullrequestreview-465643623", "createdAt": "2020-08-12T07:07:57Z", "commit": {"oid": "d44674ba2a23110d934c008db091964a4b512cb3"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "706377082427c04b6df95a884ef359a06bc45067", "author": {"user": {"login": "junkaixue", "name": "Junkai Xue"}}, "url": "https://github.com/apache/helix/commit/706377082427c04b6df95a884ef359a06bc45067", "committedDate": "2020-08-12T18:00:18Z", "message": "Add comments"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4215, "cost": 1, "resetAt": "2021-10-29T19:57:52Z"}}}