{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY3MTU0OTAw", "number": 1265, "title": "Change TestInstanceAutoJoin to adapt to cloud environment", "bodyText": "Issues\n\n My PR addresses the following Helix issues and references them in the PR description:\n\nFixed #1260\nDescription\n\n Here are some details about my PR, including screenshots of any UI changes:\n\nThe previous test testAutoRegistrationShouldFailWhenWaitingRespons in TestInstanceAutoJoin will fail in github test, although it always pass locally. The reason is that the test was written with the assumption that it is only run in on-prem environment and auto registration will fail with no cloud response returned. However, github tests are run in cloud environment, and the auto registration will succeed. This PR changed the test to make it adapt to both on-prem and cloud environment.\nTests\n\n The following is the result of the \"mvn test\" command on the appropriate module:\n\nDocumentation (Optional)\n\nIn case of new functionality, my PR adds documentation in the following wiki page:\n\n(Link the GitHub wiki you added)\nCommits\n\nMy commits all reference appropriate Apache Helix GitHub issues in their subject lines. In addition, my commits follow the guidelines from \"How to write a good git commit message\":\n\nSubject is separated from body by a blank line\nSubject is limited to 50 characters (not including Jira issue reference)\nSubject does not end with a period\nSubject uses the imperative mood (\"add\", not \"adding\")\nBody wraps at 72 characters\nBody explains \"what\" and \"why\", not \"how\"\n\n\n\nCode Quality\n\nMy diff has been formatted using helix-style.xml\n(helix-style-intellij.xml if IntelliJ IDE is used)", "createdAt": "2020-08-13T05:23:13Z", "url": "https://github.com/apache/helix/pull/1265", "merged": true, "mergeCommit": {"oid": "cb66bcc0889df1a8214f56fb2d2883a973b9b87c"}, "closed": true, "closedAt": "2020-08-13T23:10:55Z", "author": {"login": "zhangmeng916"}, "timelineItems": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc-ZDd4AH2gAyNDY3MTU0OTAwOjlkMDAxMDQyZmRhNDVlNzBlMzg4ZmE0ZGQ3ZTU0NWZiYTJmNGY0YmY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc-nFbmgFqTQ2NzE1MDk5Mw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "9d001042fda45e70e388fa4dd7e545fba2f4f4bf", "author": {"user": {"login": "zhangmeng916", "name": "Meng Zhang"}}, "url": "https://github.com/apache/helix/commit/9d001042fda45e70e388fa4dd7e545fba2f4f4bf", "committedDate": "2020-08-13T05:20:48Z", "message": "Change TestInstanceAutoJoin to adapt to cloud environment"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY3MTMwNzAx", "url": "https://github.com/apache/helix/pull/1265#pullrequestreview-467130701", "createdAt": "2020-08-13T21:07:37Z", "commit": {"oid": "9d001042fda45e70e388fa4dd7e545fba2f4f4bf"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QyMTowNzozN1rOHAduDA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QyMTowNzozN1rOHAduDA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDI0ODk3Mg==", "bodyText": "Why this line is needed?", "url": "https://github.com/apache/helix/pull/1265#discussion_r470248972", "createdAt": "2020-08-13T21:07:37Z", "author": {"login": "kaisun2000"}, "path": "helix-core/src/test/java/org/apache/helix/integration/paticipant/TestInstanceAutoJoin.java", "diffHunk": "@@ -110,14 +108,23 @@ public void testAutoRegistrationShouldFailWhenWaitingResponse() throws Exception\n         new MockParticipantManager(ZK_ADDR, CLUSTER_NAME, instance3);\n     autoParticipant.syncStart();\n \n-    Assert.assertTrue(null == manager.getHelixDataAccessor()\n-        .getProperty(accessor.keyBuilder().liveInstance(instance3)));\n+    // if the test is run in cloud environment, auto registration will succeed and live instance\n+    // will be added, otherwise, auto registration will fail and instance config will not be\n+    // populated. An exception will be thrown.\n     try {\n       manager.getConfigAccessor().getInstanceConfig(CLUSTER_NAME, instance3);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9d001042fda45e70e388fa4dd7e545fba2f4f4bf"}, "originalPosition": 41}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY3MTUwOTkz", "url": "https://github.com/apache/helix/pull/1265#pullrequestreview-467150993", "createdAt": "2020-08-13T21:41:37Z", "commit": {"oid": "9d001042fda45e70e388fa4dd7e545fba2f4f4bf"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4223, "cost": 1, "resetAt": "2021-10-29T19:57:52Z"}}}