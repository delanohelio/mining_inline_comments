{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk0NDU4MTk3", "number": 915, "title": "Make multiZkEnabled configurable in HelixRestNamespace", "bodyText": "Issues\n\n My PR addresses the following Helix issues and references them in the PR description:\n\nFixes #914\nDescription\n\n Here are some details about my PR, including screenshots of any UI changes:\n\nIt was observed that we need more fine-grained control over this multiZkEnabled config because there could exists namespaces with differing modes. Because multiple namespaces may be co-deployed, we cannot simply make it a system config.\nTests\n\n The following tests are written for this issue:\n\nCovered by existing tests.\n\n The following is the result of the \"mvn test\" command on the appropriate module:\n\n[ERROR] Failures:\n[ERROR]   TestResourceAccessor.testResourceHealth:289 expected: but was:\n[INFO]\n[ERROR] Tests run: 144, Failures: 1, Errors: 0, Skipped: 7\n[INFO]\n[INFO] ------------------------------------------------------------------------\n[INFO] BUILD FAILURE\n[INFO] ------------------------------------------------------------------------\n[INFO] Total time:  38.519 s\n[INFO] Finished at: 2020-03-26T15:37:48-07:00\n[INFO] ------------------------------------------------------------------------\n[ERROR] Failed to execute goal org.apache.maven.plugins:maven-surefire-plugin:3.0.0-M3:test (default-test) on project helix-rest: There are test failures.\nKnown failure. This will be dealt with in a different PR.\nCommits\n\n My commits all reference appropriate Apache Helix GitHub issues in their subject lines. In addition, my commits follow the guidelines from \"How to write a good git commit message\":\n\nSubject is separated from body by a blank line\nSubject is limited to 50 characters (not including Jira issue reference)\nSubject does not end with a period\nSubject uses the imperative mood (\"add\", not \"adding\")\nBody wraps at 72 characters\nBody explains \"what\" and \"why\", not \"how\"\n\n\n\nCode Quality\n\n My diff has been formatted using helix-style.xml\n(helix-style-intellij.xml if IntelliJ IDE is used)", "createdAt": "2020-03-26T22:38:15Z", "url": "https://github.com/apache/helix/pull/915", "merged": true, "mergeCommit": {"oid": "a1545937cac3857f1d0b8074c5b57142b349d403"}, "closed": true, "closedAt": "2020-03-27T00:54:59Z", "author": {"login": "narendly"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcRj6wbgH2gAyMzk0NDU4MTk3Ojc0MWZhNzFkNmMyYWZhMDMyZDBlNjk2N2IzMDlmODZkMGQxMjI0YjY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcRkkH5AFqTM4MjQ4NDk2OQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "741fa71d6c2afa032d0e6967b309f86d0d1224b6", "author": {"user": {"login": "narendly", "name": "Hunter Lee"}}, "url": "https://github.com/apache/helix/commit/741fa71d6c2afa032d0e6967b309f86d0d1224b6", "committedDate": "2020-03-26T22:33:39Z", "message": "Make multiZkEnabled configurable in HelixRestNamespace\n\nIt was observed that we need more fine-grained control over this multiZkEnabled config because there could exists namespaces with differing modes. Because multiple namespaces may be co-deployed, we cannot simply make it a system config."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgyNDcyMTky", "url": "https://github.com/apache/helix/pull/915#pullrequestreview-382472192", "createdAt": "2020-03-26T22:45:31Z", "commit": {"oid": "741fa71d6c2afa032d0e6967b309f86d0d1224b6"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNlQyMjo0NTozMVrOF8dLFQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNlQyMjo0NTozMVrOF8dLFQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODkzNjg1Mw==", "bodyText": "Why we dont just rely on the system property but a new field?", "url": "https://github.com/apache/helix/pull/915#discussion_r398936853", "createdAt": "2020-03-26T22:45:31Z", "author": {"login": "junkaixue"}, "path": "helix-rest/src/main/java/org/apache/helix/rest/common/HelixRestNamespace.java", "diffHunk": "@@ -35,6 +35,7 @@\n     METADATA_STORE_TYPE,\n     METADATA_STORE_ADDRESS,\n     IS_DEFAULT,\n+    MULTI_ZK_ENABLED,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "741fa71d6c2afa032d0e6967b309f86d0d1224b6"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgyNDc2NDM3", "url": "https://github.com/apache/helix/pull/915#pullrequestreview-382476437", "createdAt": "2020-03-26T22:56:01Z", "commit": {"oid": "741fa71d6c2afa032d0e6967b309f86d0d1224b6"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNlQyMjo1NjowMlrOF8dZiA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNlQyMjo1NjowMlrOF8dZiA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODk0MDU1Mg==", "bodyText": "Aren't we moving away from system properties?\nIf we allow both it could be confusing, unless we specifically document for it.", "url": "https://github.com/apache/helix/pull/915#discussion_r398940552", "createdAt": "2020-03-26T22:56:02Z", "author": {"login": "NealSun96"}, "path": "helix-rest/src/main/java/org/apache/helix/rest/server/ServerContext.java", "diffHunk": "@@ -111,20 +114,9 @@ public RealmAwareZkClient getRealmAwareZkClient() {\n       synchronized (this) {\n         if (_zkClient == null) {\n           // If the multi ZK config is enabled, use FederatedZkClient on multi-realm mode\n-          if (Boolean.parseBoolean(System.getProperty(SystemPropertyKeys.MULTI_ZK_ENABLED))) {\n-            LOG.info(\"ServerContext: initializing FederatedZkClient with routing ZK at {}!\",\n-                _zkAddr);\n+          if (_isMultiZkEnabled || Boolean\n+              .parseBoolean(System.getProperty(SystemPropertyKeys.MULTI_ZK_ENABLED))) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "741fa71d6c2afa032d0e6967b309f86d0d1224b6"}, "originalPosition": 37}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "61849b6d9417d446c258db88f89da0a7fd9917af", "author": {"user": {"login": "narendly", "name": "Hunter Lee"}}, "url": "https://github.com/apache/helix/commit/61849b6d9417d446c258db88f89da0a7fd9917af", "committedDate": "2020-03-26T22:57:03Z", "message": "Add error log"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "76e779a179e75b4504916086bf751ff129996b4e", "author": {"user": {"login": "narendly", "name": "Hunter Lee"}}, "url": "https://github.com/apache/helix/commit/76e779a179e75b4504916086bf751ff129996b4e", "committedDate": "2020-03-26T23:12:53Z", "message": "sadf"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgyNDg0MjA1", "url": "https://github.com/apache/helix/pull/915#pullrequestreview-382484205", "createdAt": "2020-03-26T23:16:53Z", "commit": {"oid": "76e779a179e75b4504916086bf751ff129996b4e"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgyNDg0OTY5", "url": "https://github.com/apache/helix/pull/915#pullrequestreview-382484969", "createdAt": "2020-03-26T23:18:50Z", "commit": {"oid": "76e779a179e75b4504916086bf751ff129996b4e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNlQyMzoxODo1MFrOF8d3dA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNlQyMzoxODo1MFrOF8d3dA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODk0ODIxMg==", "bodyText": "Why we change the place? Could _zkClientForListener be null? It should be constructed when the ServerContext built.", "url": "https://github.com/apache/helix/pull/915#discussion_r398948212", "createdAt": "2020-03-26T23:18:50Z", "author": {"login": "junkaixue"}, "path": "helix-rest/src/main/java/org/apache/helix/rest/server/ServerContext.java", "diffHunk": "@@ -136,7 +128,20 @@ public RealmAwareZkClient getRealmAwareZkClient() {\n               // Refresh data subscription\n               _zkClientForListener.unsubscribeAll();\n               _zkClientForListener.subscribeRoutingDataChanges(this, this);\n+              LOG.info(\"ServerContext: subscribed to routing data in routing ZK at {}!\", _zkAddr);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "76e779a179e75b4504916086bf751ff129996b4e"}, "originalPosition": 56}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4733, "cost": 1, "resetAt": "2021-10-29T19:57:52Z"}}}