{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ1NjQ2OTky", "number": 1142, "title": "Respect Maximum Number Of Attempts for the tasks", "bodyText": "Issues\n\n My PR addresses the following Helix issues and references them in the PR title:\nFixes #957\nFixes #1141\nFixes #1143\n\nDescription\n\n Here are some details about my PR, including screenshots of any UI changes:\n\nIn this PR, several scheduling parts have been changed which enforces the scheduler to respect maximum number of attempts for the tasks.\nAlso, it has been observed that when a task being dropped and scheduled again, max number of attempts is not being respected. In this PR, further checks is added to not schedule the tasks again once we reach its maximum number of attempts.\nMoreover, there is race condition for _existsLiveInstanceOrCurrentStateChange flag which has been fixed in this PR.\nNote: Several of the tests have been changed. Specially the tests with strict MaxNumberOfAttempts. These tests need to be changed because they are mostly related to the targeted jobs. Once we start the participants and targeted partition bounces between the participants, the tasks needs to be reassigned and number of attempts for the task will increase. We haven't noticed it before since we haven't been respecting MaxNumberOfAttempts for the DROPPED tasks. In other word, previously controller increases the task number of attempts without actually respecting the fact that the task has reached maximum number of attempts.\nTests\n\n\n The following tests are written for this issue:\nTestMaxNumberOfAttemptsMasterSwitch\n\n\n The following is the result of the \"mvn test\" command on the appropriate module:\n\n\nhelix-core:\n[ERROR] Failures: \n[ERROR]   TestWorkflowTermination.testWorkflowPausedTimeout:170->verifyWorkflowCleanup:257 expected:<true> but was:<false>\n[INFO] \n[ERROR] Tests run: 1150, Failures: 1, Errors: 0, Skipped: 0\n[INFO] \n[INFO] ------------------------------------------------------------------------\n[INFO] BUILD FAILURE\n[INFO] ------------------------------------------------------------------------\n[INFO] Total time:  01:21 h\n[INFO] Finished at: 2020-07-09T18:42:36-07:00\n[INFO] ------------------------------------------------------------------------\n\nThe failed test succeeded when run individually.\nmvn test -Dtest=\"TestWorkflowTermination\"\n[INFO] Tests run: 5, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 36.198 s - in org.apache.helix.integration.task.TestWorkflowTermination\n[INFO] \n[INFO] Results:\n[INFO] \n[INFO] Tests run: 5, Failures: 0, Errors: 0, Skipped: 0\n[INFO] \n[INFO] ------------------------------------------------------------------------\n[INFO] BUILD SUCCESS\n[INFO] ------------------------------------------------------------------------\n[INFO] Total time:  41.610 s\n[INFO] Finished at: 2020-07-09T19:06:56-07:00\n[INFO] ------------------------------------------------------------------------``\n\nhelix-rest:\n[INFO] Tests run: 159, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 42.166 s - in TestSuite\n[INFO] \n[INFO] Results:\n[INFO] \n[INFO] Tests run: 159, Failures: 0, Errors: 0, Skipped: 0\n[INFO] \n[INFO] ------------------------------------------------------------------------\n[INFO] BUILD SUCCESS\n[INFO] ------------------------------------------------------------------------\n[INFO] Total time:  47.540 s\n[INFO] Finished at: 2020-07-09T19:08:19-07:00\n[INFO] ------------------------------------------------------------------------\n\nCommits\n\n My commits all reference appropriate Apache Helix GitHub issues in their subject lines, and I have squashed multiple commits if they address the same issue. In addition, my commits follow the guidelines from \"How to write a good git commit message\":\n\nSubject is separated from body by a blank line\nSubject is limited to 50 characters (not including Jira issue reference)\nSubject does not end with a period\nSubject uses the imperative mood (\"add\", not \"adding\")\nBody wraps at 72 characters\nBody explains \"what\" and \"why\", not \"how\"\n\n\n\nCode Quality\n\n My diff has been formatted using helix-style.xml", "createdAt": "2020-07-07T20:15:21Z", "url": "https://github.com/apache/helix/pull/1142", "merged": true, "mergeCommit": {"oid": "3da9c74e530f2e4566ed2a7d07d872964718bace"}, "closed": true, "closedAt": "2020-07-21T20:01:48Z", "author": {"login": "alirezazamani"}, "timelineItems": {"totalCount": 15, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcy-VlRgBqjM1MjYzOTgxODM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc21xeWAH2gAyNDQ1NjQ2OTkyOjUwZGYwZTBiYzExMjFkMzRmNzBiN2I1ZGNlZjcxNDViNzA2YTRiZjk=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "da689046e7596dc70af978b62f5d26cc894c410a", "author": {"user": {"login": "alirezazamani", "name": "Ali Reza Zamani Zadeh Najari"}}, "url": "https://github.com/apache/helix/commit/da689046e7596dc70af978b62f5d26cc894c410a", "committedDate": "2020-07-07T20:03:58Z", "message": "Respect Maximum Number Of Attempts for the tasks\n\nIn this commit, several scheduling parts have been changed which\nenforces the scheduler to respect maximum number of attempts for\nthe tasks.\n\nAlso, it has been observed that when a task being dropped and\nscheduled again, max number of attempts is not being respected.\nin this commit, further checks is added to not schedule the\ntasks again once we reach its maximum number of attempts.\n\nSeveral of the tests have been changed. Scpecially the once with\nstrict MaxNumberOfAttempts. These tests need to be changed\nbecause they are mostly related to the targetted jobs. Once\nwe start the participants and targetted partition bounces between\nthe participants, the tasks needs to be reassigned and number\nof attempts for the task will increase."}, "afterCommit": {"oid": "4d6e98ec814f4e87536a8ff81fb98cf52cac57b8", "author": {"user": {"login": "alirezazamani", "name": "Ali Reza Zamani Zadeh Najari"}}, "url": "https://github.com/apache/helix/commit/4d6e98ec814f4e87536a8ff81fb98cf52cac57b8", "committedDate": "2020-07-08T17:58:55Z", "message": "Respect Maximum Number Of Attempts for the tasks\n\nIn this commit, several scheduling parts have been changed which\nenforces the scheduler to respect maximum number of attempts for\nthe tasks.\n\nAlso, it has been observed that when a task being dropped and\nscheduled again, max number of attempts is not being respected.\nin this commit, further checks is added to not schedule the\ntasks again once we reach its maximum number of attempts.\n\nSeveral of the tests have been changed. Scpecially the once with\nstrict MaxNumberOfAttempts. These tests need to be changed\nbecause they are mostly related to the targetted jobs. Once\nwe start the participants and targetted partition bounces between\nthe participants, the tasks needs to be reassigned and number\nof attempts for the task will increase."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "be5497b0d1da02fe8fcbab12444947c91442e047", "author": {"user": {"login": "alirezazamani", "name": "Ali Reza Zamani Zadeh Najari"}}, "url": "https://github.com/apache/helix/commit/be5497b0d1da02fe8fcbab12444947c91442e047", "committedDate": "2020-07-09T03:15:46Z", "message": "Respect Maximum Number Of Attempts for the tasks\n\nIn this commit, several scheduling parts have been changed which\nenforces the scheduler to respect maximum number of attempts for\nthe tasks.\n\nAlso, it has been observed that when a task being dropped and\nscheduled again, max number of attempts is not being respected.\nin this commit, further checks is added to not schedule the\ntasks again once we reach its maximum number of attempts.\n\nSeveral of the tests have been changed. Scpecially the once with\nstrict MaxNumberOfAttempts. These tests need to be changed\nbecause they are mostly related to the targetted jobs. Once\nwe start the participants and targetted partition bounces between\nthe participants, the tasks needs to be reassigned and number\nof attempts for the task will increase."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4d6e98ec814f4e87536a8ff81fb98cf52cac57b8", "author": {"user": {"login": "alirezazamani", "name": "Ali Reza Zamani Zadeh Najari"}}, "url": "https://github.com/apache/helix/commit/4d6e98ec814f4e87536a8ff81fb98cf52cac57b8", "committedDate": "2020-07-08T17:58:55Z", "message": "Respect Maximum Number Of Attempts for the tasks\n\nIn this commit, several scheduling parts have been changed which\nenforces the scheduler to respect maximum number of attempts for\nthe tasks.\n\nAlso, it has been observed that when a task being dropped and\nscheduled again, max number of attempts is not being respected.\nin this commit, further checks is added to not schedule the\ntasks again once we reach its maximum number of attempts.\n\nSeveral of the tests have been changed. Scpecially the once with\nstrict MaxNumberOfAttempts. These tests need to be changed\nbecause they are mostly related to the targetted jobs. Once\nwe start the participants and targetted partition bounces between\nthe participants, the tasks needs to be reassigned and number\nof attempts for the task will increase."}, "afterCommit": {"oid": "be5497b0d1da02fe8fcbab12444947c91442e047", "author": {"user": {"login": "alirezazamani", "name": "Ali Reza Zamani Zadeh Najari"}}, "url": "https://github.com/apache/helix/commit/be5497b0d1da02fe8fcbab12444947c91442e047", "committedDate": "2020-07-09T03:15:46Z", "message": "Respect Maximum Number Of Attempts for the tasks\n\nIn this commit, several scheduling parts have been changed which\nenforces the scheduler to respect maximum number of attempts for\nthe tasks.\n\nAlso, it has been observed that when a task being dropped and\nscheduled again, max number of attempts is not being respected.\nin this commit, further checks is added to not schedule the\ntasks again once we reach its maximum number of attempts.\n\nSeveral of the tests have been changed. Scpecially the once with\nstrict MaxNumberOfAttempts. These tests need to be changed\nbecause they are mostly related to the targetted jobs. Once\nwe start the participants and targetted partition bounces between\nthe participants, the tasks needs to be reassigned and number\nof attempts for the task will increase."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c607510303b86ef5060c160190dd08cede2f8dd1", "author": {"user": {"login": "alirezazamani", "name": "Ali Reza Zamani Zadeh Najari"}}, "url": "https://github.com/apache/helix/commit/c607510303b86ef5060c160190dd08cede2f8dd1", "committedDate": "2020-07-09T22:43:10Z", "message": "Add message to existsLiveInstanceOrCurrentStateChange"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9a5ffdb6e578cd767f98076037bb60495305e3e4", "author": {"user": {"login": "alirezazamani", "name": "Ali Reza Zamani Zadeh Najari"}}, "url": "https://github.com/apache/helix/commit/9a5ffdb6e578cd767f98076037bb60495305e3e4", "committedDate": "2020-07-09T22:50:54Z", "message": "change test to use customized rebalancer"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ2ODkzODY3", "url": "https://github.com/apache/helix/pull/1142#pullrequestreview-446893867", "createdAt": "2020-07-12T16:46:37Z", "commit": {"oid": "9a5ffdb6e578cd767f98076037bb60495305e3e4"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMlQxNjo0NjozOFrOGwVlrw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMlQxNjo0NjozOFrOGwVlrw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzMzODU0Mw==", "bodyText": "Would it be cleaner to define a set of enums (states) where we should mark the tasks aborted? Then we could do a simple exists() check.\nOr, it seems that if we check for != condition, we won't have to list out so many states here?", "url": "https://github.com/apache/helix/pull/1142#discussion_r453338543", "createdAt": "2020-07-12T16:46:38Z", "author": {"login": "narendly"}, "path": "helix-core/src/main/java/org/apache/helix/task/AbstractTaskDispatcher.java", "diffHunk": "@@ -185,17 +185,13 @@ public void updatePreviousAssignedTasksStatus(\n         switch (currState) {\n         case RUNNING: {\n           TaskPartitionState nextState = TaskPartitionState.RUNNING;\n-          if (jobState == TaskState.TIMING_OUT) {\n+          if (jobState == TaskState.TIMING_OUT || jobState == TaskState.TIMED_OUT\n+              || jobState == TaskState.FAILING || jobState == TaskState.FAILED\n+              || jobState == TaskState.ABORTED) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9a5ffdb6e578cd767f98076037bb60495305e3e4"}, "originalPosition": 7}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ2ODkzODg3", "url": "https://github.com/apache/helix/pull/1142#pullrequestreview-446893887", "createdAt": "2020-07-12T16:47:03Z", "commit": {"oid": "9a5ffdb6e578cd767f98076037bb60495305e3e4"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMlQxNjo0NzowNFrOGwVl0g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMlQxNjo0NzowNFrOGwVl0g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzMzODU3OA==", "bodyText": "Thanks for renaming!", "url": "https://github.com/apache/helix/pull/1142#discussion_r453338578", "createdAt": "2020-07-12T16:47:04Z", "author": {"login": "narendly"}, "path": "helix-core/src/main/java/org/apache/helix/task/AbstractTaskDispatcher.java", "diffHunk": "@@ -560,7 +556,7 @@ protected void handleAdditionalTaskAssignment(\n       excludeSet.addAll(assignedSet);\n     }\n     addCompletedTasks(excludeSet, jobCtx, allPartitions);\n-    addGiveupPartitions(excludeSet, jobCtx, allPartitions, jobCfg);\n+    addPartitionsReachedMaximumRetries(excludeSet, jobCtx, allPartitions, jobCfg);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9a5ffdb6e578cd767f98076037bb60495305e3e4"}, "originalPosition": 37}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ2ODkzOTQz", "url": "https://github.com/apache/helix/pull/1142#pullrequestreview-446893943", "createdAt": "2020-07-12T16:47:51Z", "commit": {"oid": "9a5ffdb6e578cd767f98076037bb60495305e3e4"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMlQxNjo0Nzo1MVrOGwVmGg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMlQxNjo0Nzo1MVrOGwVmGg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzMzODY1MA==", "bodyText": "What is the distinction between \"given up\" and partitions that exceeded the # of maximum attempts? Do you think we could clarify that here?\nI have a feeling that \"given up\" might be too broad or abstract.", "url": "https://github.com/apache/helix/pull/1142#discussion_r453338650", "createdAt": "2020-07-12T16:47:51Z", "author": {"login": "narendly"}, "path": "helix-core/src/main/java/org/apache/helix/task/AbstractTaskDispatcher.java", "diffHunk": "@@ -745,7 +743,7 @@ protected void scheduleForNextTask(String job, JobContext jobCtx, long now) {\n     }\n   }\n \n-  // add all partitions that have been tried maxNumberAttempts\n+  // add all partitions that are given up", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9a5ffdb6e578cd767f98076037bb60495305e3e4"}, "originalPosition": 66}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ2ODk0MzAz", "url": "https://github.com/apache/helix/pull/1142#pullrequestreview-446894303", "createdAt": "2020-07-12T16:53:50Z", "commit": {"oid": "9a5ffdb6e578cd767f98076037bb60495305e3e4"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMlQxNjo1Mzo1MFrOGwVoLA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMlQxNjo1Mzo1MFrOGwVoLA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzMzOTE4MA==", "bodyText": "Could you explain further why this change is needed? If we add more nodes, the db partitions will get shifted. Are we adding nodes while the workflow is in progress and before its tasks complete? In that case, the shuffling of tasks (getting dropped and rescheduled onto another instance) makes sense and we should increment # of attempts.\nSince the focus of this test doesn't seem to be # of attempts, do you think we should add a new test that tests for this? We want to make sure that for targeted tasks, if we add more nodes and if that causes db partitions to be moved, then we should observe the tasks get dropped and retried with an increase in the # of attempts. One thing to watch out for here is \"rebalanceRunningTask\" - what role should that parameter play?", "url": "https://github.com/apache/helix/pull/1142#discussion_r453339180", "createdAt": "2020-07-12T16:53:50Z", "author": {"login": "narendly"}, "path": "helix-core/src/test/java/org/apache/helix/integration/task/TestDeleteJobFromJobQueue.java", "diffHunk": "@@ -44,10 +44,10 @@ public void testForceDeleteJobFromJobQueue() throws InterruptedException {\n     // Create two jobs: job1 will complete fast, and job2 will be stuck in progress (taking a long\n     // time to finish). The idea is to force-delete a stuck job (job2).\n     JobConfig.Builder jobBuilder = JobConfig.Builder.fromMap(WorkflowGenerator.DEFAULT_JOB_CONFIG)\n-        .setMaxAttemptsPerTask(1).setWorkflow(jobQueueName)\n+        .setWorkflow(jobQueueName)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9a5ffdb6e578cd767f98076037bb60495305e3e4"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7e153c6722c52f472447c3db922050f25e79b237", "author": {"user": {"login": "alirezazamani", "name": "Ali Reza Zamani Zadeh Najari"}}, "url": "https://github.com/apache/helix/commit/7e153c6722c52f472447c3db922050f25e79b237", "committedDate": "2020-07-15T22:16:00Z", "message": "Addressing the comments"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUxMzY0MzM0", "url": "https://github.com/apache/helix/pull/1142#pullrequestreview-451364334", "createdAt": "2020-07-20T07:38:41Z", "commit": {"oid": "7e153c6722c52f472447c3db922050f25e79b237"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQwNzozODo0MVrOGz9ZOQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQwNzozODo0MVrOGz9ZOQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzEzNjQ0MQ==", "bodyText": "Nit:\nIf a job is in one of the following states and its tasks are in RUNNING states, the tasks will be aborted.", "url": "https://github.com/apache/helix/pull/1142#discussion_r457136441", "createdAt": "2020-07-20T07:38:41Z", "author": {"login": "narendly"}, "path": "helix-core/src/main/java/org/apache/helix/task/AbstractTaskDispatcher.java", "diffHunk": "@@ -74,6 +75,12 @@ public void updatePreviousAssignedTasksStatus(\n       Set<Integer> skippedPartitions, WorkflowControllerDataProvider cache,\n       Map<String, Set<Integer>> tasksToDrop) {\n \n+    // If a job is in the following states and contains running tasks, all of the running tasks\n+    // should go to the ABORTED states.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7e153c6722c52f472447c3db922050f25e79b237"}, "originalPosition": 13}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUxMzY0Njkz", "url": "https://github.com/apache/helix/pull/1142#pullrequestreview-451364693", "createdAt": "2020-07-20T07:39:16Z", "commit": {"oid": "7e153c6722c52f472447c3db922050f25e79b237"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQwNzozOToxNlrOGz9avQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQwNzozOToxNlrOGz9avQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzEzNjgyOQ==", "bodyText": "I think calling it jobStatesForAbortingTasks does the trick and is shorter. What do you think?", "url": "https://github.com/apache/helix/pull/1142#discussion_r457136829", "createdAt": "2020-07-20T07:39:16Z", "author": {"login": "narendly"}, "path": "helix-core/src/main/java/org/apache/helix/task/AbstractTaskDispatcher.java", "diffHunk": "@@ -74,6 +75,12 @@ public void updatePreviousAssignedTasksStatus(\n       Set<Integer> skippedPartitions, WorkflowControllerDataProvider cache,\n       Map<String, Set<Integer>> tasksToDrop) {\n \n+    // If a job is in the following states and contains running tasks, all of the running tasks\n+    // should go to the ABORTED states.\n+    Set<TaskState> jobStatesForRunningTaskToAbortedState =", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7e153c6722c52f472447c3db922050f25e79b237"}, "originalPosition": 14}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUxMzY2Mjg0", "url": "https://github.com/apache/helix/pull/1142#pullrequestreview-451366284", "createdAt": "2020-07-20T07:41:41Z", "commit": {"oid": "7e153c6722c52f472447c3db922050f25e79b237"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQwNzo0MTo0MVrOGz9hHQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQwNzo0MTo0MVrOGz9hHQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzEzODQ2MQ==", "bodyText": "Typo: addGivenUpPartitions", "url": "https://github.com/apache/helix/pull/1142#discussion_r457138461", "createdAt": "2020-07-20T07:41:41Z", "author": {"login": "narendly"}, "path": "helix-core/src/main/java/org/apache/helix/task/AbstractTaskDispatcher.java", "diffHunk": "@@ -745,8 +748,12 @@ protected void scheduleForNextTask(String job, JobContext jobCtx, long now) {\n     }\n   }\n \n-  // add all partitions that have been tried maxNumberAttempts\n-  protected static void addGiveupPartitions(Set<Integer> set, JobContext ctx,\n+  // Add all partitions/tasks that are cannot be retried. These tasks are:\n+  // 1- Task is in ABORTED or ERROR state.\n+  // 2- Task has just gone to TIMED_OUT, ERROR or DROPPED states and has reached to its\n+  // maxNumberAttempts\n+  // These tasks determine whether the job needs to FAILED or not.\n+  protected static void addGiveUpPartitions(Set<Integer> set, JobContext ctx,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7e153c6722c52f472447c3db922050f25e79b237"}, "originalPosition": 91}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUxMzY3Njg0", "url": "https://github.com/apache/helix/pull/1142#pullrequestreview-451367684", "createdAt": "2020-07-20T07:43:45Z", "commit": {"oid": "7e153c6722c52f472447c3db922050f25e79b237"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "50df0e0bc1121d34f70b7b5dcef7145b706a4bf9", "author": {"user": {"login": "alirezazamani", "name": "Ali Reza Zamani Zadeh Najari"}}, "url": "https://github.com/apache/helix/commit/50df0e0bc1121d34f70b7b5dcef7145b706a4bf9", "committedDate": "2020-07-20T18:17:00Z", "message": "Address new comments"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4551, "cost": 1, "resetAt": "2021-10-29T19:57:52Z"}}}