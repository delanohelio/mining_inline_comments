{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM2MTYzMDkw", "number": 1104, "title": "Enhance flaky test TestRemoveUserCbHandlerOnPathRemoval", "bodyText": "Issues\n\n My PR addresses the following Helix issues and references them in the PR description:\n\nFixes #1102\nTestRemoveUserCbHandlerOnPathRemoval has a flaky test\nDescription\n\n Here are some details about my PR, including screenshots of any UI changes:\n\nAssert .assertEquals(watchPaths.get(\"existWatches\").size(), 2, \"Should have 2 exist-watches: CURRENTSTATE/{oldSessionId} and CURRENTSTATE/{oldSessionId}/TestDB0\");\nis flaky.\nTests\n\n The following tests are written for this issue:\n\n(List the names of added unit/integration tests)\n\n The following is the result of the \"mvn test\" command on the appropriate module:\n\nThis test case pass. This pull only touch test case logic.\nCommits\n\n My commits all reference appropriate Apache Helix GitHub issues in their subject lines. In addition, my commits follow the guidelines from \"How to write a good git commit message\":\n\nSubject is separated from body by a blank line\nSubject is limited to 50 characters (not including Jira issue reference)\nSubject does not end with a period\nSubject uses the imperative mood (\"add\", not \"adding\")\nBody wraps at 72 characters\nBody explains \"what\" and \"why\", not \"how\"\n\n\n\nDocumentation (Optional)\n\n In case of new functionality, my PR adds documentation in the following wiki page:\n\n(Link the GitHub wiki you added)\nCode Quality\n\n My diff has been formatted using helix-style.xml\n(helix-style-intellij.xml if IntelliJ IDE is used)", "createdAt": "2020-06-18T00:35:04Z", "url": "https://github.com/apache/helix/pull/1104", "merged": true, "mergeCommit": {"oid": "511dd3db69465b6690dd464543b7ce1674432259"}, "closed": true, "closedAt": "2020-06-19T23:18:32Z", "author": {"login": "kaisun2000"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcsTRuBAH2gAyNDM2MTYzMDkwOjg0NzU0NTBjOThmMGJmMTVjZjgxZjlmYjY5Y2M2ZmVmODc2YTlhYzM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcs7ZDlgFqTQzNDM3NjE0OQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "8475450c98f0bf15cf81f9fb69cc6fef876a9ac3", "author": {"user": null}, "url": "https://github.com/apache/helix/commit/8475450c98f0bf15cf81f9fb69cc6fef876a9ac3", "committedDate": "2020-06-18T00:26:18Z", "message": "Fix flaky test testRemoveUserCbHandlerOnPathRemoval # #1102\n\nTestRemoveUserCbHandlerOnPathRemoval has a flaky assert. Addres\nthe assertion in this diff."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMzNjc2Nzc5", "url": "https://github.com/apache/helix/pull/1104#pullrequestreview-433676779", "createdAt": "2020-06-18T22:00:20Z", "commit": {"oid": "8475450c98f0bf15cf81f9fb69cc6fef876a9ac3"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOFQyMjowMDoyMFrOGmBobw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOFQyMjowMDoyMFrOGmBobw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjUyNTgwNw==", "bodyText": "Please correct me if I am wrong.\nWhen the participant handles the new session, this folder of the old session will be removed, right? With the new change, should the watcher be removed as well when the folder being deleted?", "url": "https://github.com/apache/helix/pull/1104#discussion_r442525807", "createdAt": "2020-06-18T22:00:20Z", "author": {"login": "jiajunwang"}, "path": "helix-core/src/test/java/org/apache/helix/integration/TestZkCallbackHandlerLeak.java", "diffHunk": "@@ -605,9 +605,12 @@ public void onStateChange(String instanceName, List<CurrentState> statesInfo,\n         \"Should have 1 data-watches: MESSAGES\");\n     Assert.assertEquals(watchPaths.get(\"childWatches\").size(), 1,\n         \"Should have 1 child-watches: MESSAGES\");\n-    Assert\n-        .assertEquals(watchPaths.get(\"existWatches\").size(), 2,\n-            \"Should have 2 exist-watches: CURRENTSTATE/{oldSessionId} and CURRENTSTATE/{oldSessionId}/TestDB0\");\n+    result = TestHelper.verify(()-> {\n+      Map<String, List<String>> wPaths = ZkTestHelper.getZkWatch(participantToExpire.getZkClient());\n+      return wPaths.get(\"existWatches\").size() == 1;\n+    }, 10000);\n+    Assert.assertTrue(result,\n+        \"Should have 1 exist-watches: CURRENTSTATE/{oldSessionId}\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8475450c98f0bf15cf81f9fb69cc6fef876a9ac3"}, "originalPosition": 12}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "499c504fa52bafd7f58c603e899f72312283d165", "author": {"user": null}, "url": "https://github.com/apache/helix/commit/499c504fa52bafd7f58c603e899f72312283d165", "committedDate": "2020-06-19T22:27:01Z", "message": "add comment about reasoning this test case."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM0Mzc2MTQ5", "url": "https://github.com/apache/helix/pull/1104#pullrequestreview-434376149", "createdAt": "2020-06-19T23:10:31Z", "commit": {"oid": "499c504fa52bafd7f58c603e899f72312283d165"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4498, "cost": 1, "resetAt": "2021-10-29T19:57:52Z"}}}