{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTExMjEyNjY0", "number": 1492, "title": "fix TestCleanupExternalView.test ", "bodyText": "Issues\n\n My PR addresses the following Helix issues and references them in the PR description:\n\nfix #1458\nDescription\n\n Here are some details about my PR, including screenshots of any UI changes:\nFlaky test with 10 * 100ms. This may not be enough when there is\nlogging or Zk is slow in github. Fix with TestHelper.verify();\n\nTests\n\n The following tests are written for this issue:\n\n(List the names of added unit/integration tests)\n\n The following is the result of the \"mvn test\" command on the appropriate module:\n\ngithub run\nDocumentation (Optional)\n\nIn case of new functionality, my PR adds documentation in the following wiki page:\n\n(Link the GitHub wiki you added)\nCommits\n\nMy commits all reference appropriate Apache Helix GitHub issues in their subject lines. In addition, my commits follow the guidelines from \"How to write a good git commit message\":\n\nSubject is separated from body by a blank line\nSubject is limited to 50 characters (not including Jira issue reference)\nSubject does not end with a period\nSubject uses the imperative mood (\"add\", not \"adding\")\nBody wraps at 72 characters\nBody explains \"what\" and \"why\", not \"how\"\n\n\n\nCode Quality\n\nMy diff has been formatted using helix-style.xml\n(helix-style-intellij.xml if IntelliJ IDE is used)", "createdAt": "2020-10-28T01:28:25Z", "url": "https://github.com/apache/helix/pull/1492", "merged": true, "mergeCommit": {"oid": "26ff60bc044ba9d6ea5a21384ca0c7d3ba26e2f6"}, "closed": true, "closedAt": "2020-11-04T22:27:26Z", "author": {"login": "kaisun2000"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdWzOMjAH2gAyNTExMjEyNjY0OmRlNWQyNjM5ZDFhNGFmMGY5MWIzMzg0NGJjMDI4ODhkYTJkY2M5MDE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdYp2CegFqTUyMTkzNjYwNw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "de5d2639d1a4af0f91b33844bc02888da2dcc901", "author": {"user": null}, "url": "https://github.com/apache/helix/commit/de5d2639d1a4af0f91b33844bc02888da2dcc901", "committedDate": "2020-10-28T01:24:14Z", "message": "fix TestCleanupExternalView.test #1458\n\nFlaky test with 10 * 100ms. This may not be enough when there is\nlogging or Zk is slow in github."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE5MzcxMzM1", "url": "https://github.com/apache/helix/pull/1492#pullrequestreview-519371335", "createdAt": "2020-10-29T06:42:48Z", "commit": {"oid": "de5d2639d1a4af0f91b33844bc02888da2dcc901"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOVQwNjo0Mjo0OFrOHqNsuw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOVQwNjo0Mjo0OFrOHqNsuw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDAyNjY4Mw==", "bodyText": "Why get it once more?", "url": "https://github.com/apache/helix/pull/1492#discussion_r514026683", "createdAt": "2020-10-29T06:42:48Z", "author": {"login": "jiajunwang"}, "path": "helix-core/src/test/java/org/apache/helix/integration/TestCleanupExternalView.java", "diffHunk": "@@ -109,18 +109,14 @@ public void test() throws Exception {\n     // System.out.println(\"re-enabling controller\");\n     admin.enableCluster(clusterName, true);\n \n-    ExternalView externalView = null;\n-    for (int i = 0; i < 10; i++) {\n-      Thread.sleep(100);\n-      externalView = accessor.getProperty(keyBuilder.externalView(\"TestDB0\"));\n-      // System.out.println(\"externalView: \" + externalView);\n-      if (externalView == null) {\n-        break;\n-      }\n-    }\n \n-    Assert.assertNull(externalView, \"external-view for TestDB0 should be removed, but was: \"\n-        + externalView);\n+    result = TestHelper.verify(() -> {\n+      ExternalView externalView = accessor.getProperty(keyBuilder.externalView(\"TestDB0\"));\n+      return externalView == null;\n+    }, TestHelper.WAIT_DURATION);\n+\n+    ExternalView ev = accessor.getProperty(keyBuilder.externalView(\"TestDB0\"));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "de5d2639d1a4af0f91b33844bc02888da2dcc901"}, "originalPosition": 21}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3bf007e492b2d42dc7a4fe4be23deddfe319d085", "author": {"user": null}, "url": "https://github.com/apache/helix/commit/3bf007e492b2d42dc7a4fe4be23deddfe319d085", "committedDate": "2020-11-02T19:12:30Z", "message": "revised."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIxOTM2NDkw", "url": "https://github.com/apache/helix/pull/1492#pullrequestreview-521936490", "createdAt": "2020-11-02T19:36:22Z", "commit": {"oid": "3bf007e492b2d42dc7a4fe4be23deddfe319d085"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQxOTozNjoyMlrOHsS6aQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQxOTozNjoyMlrOHsS6aQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjIwOTI1Nw==", "bodyText": "nit: = null is not needed.", "url": "https://github.com/apache/helix/pull/1492#discussion_r516209257", "createdAt": "2020-11-02T19:36:22Z", "author": {"login": "zhangmeng916"}, "path": "helix-core/src/test/java/org/apache/helix/integration/TestCleanupExternalView.java", "diffHunk": "@@ -42,6 +42,7 @@\n  * orphan external-view\n  */\n public class TestCleanupExternalView extends ZkUnitTestBase {\n+  private ExternalView _externalView = null;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3bf007e492b2d42dc7a4fe4be23deddfe319d085"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIxOTM2NjA3", "url": "https://github.com/apache/helix/pull/1492#pullrequestreview-521936607", "createdAt": "2020-11-02T19:36:33Z", "commit": {"oid": "3bf007e492b2d42dc7a4fe4be23deddfe319d085"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4382, "cost": 1, "resetAt": "2021-10-29T19:57:52Z"}}}