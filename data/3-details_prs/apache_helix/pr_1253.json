{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY2NDU1OTA4", "number": 1253, "title": "Test routing data cache", "bodyText": "Issues\n\n My PR addresses the following Helix issues and references them in the PR description:\n\nFixes #1252\nDescription\n\n Here are some details about my PR, including screenshots of any UI changes:\n\nDifferent mvn versions may have different test running order.\nIf testCurrentStatesSelectiveUpdate is run before the other tests in TestRoutingDataCache, the later tests may fail. This PR fixes the test by adding a new participant to cluster and dropping the participant, verifying cluster state after the test.\nTests\n\n The following tests are written for this issue:\n\n(List the names of added unit/integration tests)\n\n The following is the result of the \"mvn test\" command on the appropriate module:\n\n(Before CI test pass, please copy & paste the result of \"mvn test\")\nDocumentation (Optional)\n\nIn case of new functionality, my PR adds documentation in the following wiki page:\n\n(Link the GitHub wiki you added)\nCommits\n\nMy commits all reference appropriate Apache Helix GitHub issues in their subject lines. In addition, my commits follow the guidelines from \"How to write a good git commit message\":\n\nSubject is separated from body by a blank line\nSubject is limited to 50 characters (not including Jira issue reference)\nSubject does not end with a period\nSubject uses the imperative mood (\"add\", not \"adding\")\nBody wraps at 72 characters\nBody explains \"what\" and \"why\", not \"how\"\n\n\n\nCode Quality\n\nMy diff has been formatted using helix-style.xml\n(helix-style-intellij.xml if IntelliJ IDE is used)", "createdAt": "2020-08-12T02:03:23Z", "url": "https://github.com/apache/helix/pull/1253", "merged": true, "mergeCommit": {"oid": "ba291eef18ef24f02fa2c9b9e6526389f2cd2899"}, "closed": true, "closedAt": "2020-08-12T22:26:45Z", "author": {"login": "huizhilu"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc-B9qxgH2gAyNDY2NDU1OTA4OjJiZWEyNWViNzk2NjFmMzZhNjJiMWIwODJiOGRhY2M1ODVmNDkyYTI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc-OL-KAFqTQ2NjA5MDU1Ng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "2bea25eb79661f36a62b1b082b8dacc585f492a2", "author": {"user": {"login": "huizhilu", "name": "Huizhi Lu"}}, "url": "https://github.com/apache/helix/commit/2bea25eb79661f36a62b1b082b8dacc585f492a2", "committedDate": "2020-08-12T02:26:39Z", "message": "Fix flaky test TestRoutingDataCache"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "da8d59f937d45b0c641bda8b934b490ecb9583fc", "author": {"user": {"login": "huizhilu", "name": "Huizhi Lu"}}, "url": "https://github.com/apache/helix/commit/da8d59f937d45b0c641bda8b934b490ecb9583fc", "committedDate": "2020-08-12T01:57:00Z", "message": "Fix flaky test TestRoutingDataCache"}, "afterCommit": {"oid": "2bea25eb79661f36a62b1b082b8dacc585f492a2", "author": {"user": {"login": "huizhilu", "name": "Huizhi Lu"}}, "url": "https://github.com/apache/helix/commit/2bea25eb79661f36a62b1b082b8dacc585f492a2", "committedDate": "2020-08-12T02:26:39Z", "message": "Fix flaky test TestRoutingDataCache"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY1NjQxNTU2", "url": "https://github.com/apache/helix/pull/1253#pullrequestreview-465641556", "createdAt": "2020-08-12T07:04:21Z", "commit": {"oid": "2bea25eb79661f36a62b1b082b8dacc585f492a2"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMlQwNzowNDoyMlrOG_Uapg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMlQwNzowNDoyMlrOG_Uapg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTA0Nzk3NA==", "bodyText": "Good work!\nSince the original issue mentions that the instability is caused by a non-deterministic execution order of tests, should we add the dependsOnMethods annotation to enforce the order across different environments?", "url": "https://github.com/apache/helix/pull/1253#discussion_r469047974", "createdAt": "2020-08-12T07:04:22Z", "author": {"login": "narendly"}, "path": "helix-core/src/test/java/org/apache/helix/spectator/TestRoutingDataCache.java", "diffHunk": "@@ -24,20 +24,21 @@\n import org.apache.helix.HelixConstants;\n import org.apache.helix.PropertyType;\n import org.apache.helix.TestHelper;\n-import org.apache.helix.zookeeper.datamodel.ZNRecord;\n import org.apache.helix.integration.common.ZkStandAloneCMTestBase;\n+import org.apache.helix.integration.manager.MockParticipantManager;\n import org.apache.helix.manager.zk.ZkBaseDataAccessor;\n import org.apache.helix.mock.MockZkHelixDataAccessor;\n import org.apache.helix.model.CurrentState;\n import org.apache.helix.tools.ClusterVerifiers.BestPossibleExternalViewVerifier;\n import org.apache.helix.tools.ClusterVerifiers.ZkHelixClusterVerifier;\n+import org.apache.helix.zookeeper.datamodel.ZNRecord;\n import org.testng.Assert;\n import org.testng.annotations.Test;\n \n public class TestRoutingDataCache extends ZkStandAloneCMTestBase {\n \n-  @Test()\n-  public void testUpdateOnNotification() throws Exception {\n+  @Test\n+  public void testUpdateOnNotification() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2bea25eb79661f36a62b1b082b8dacc585f492a2"}, "originalPosition": 21}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY2MDkwNTU2", "url": "https://github.com/apache/helix/pull/1253#pullrequestreview-466090556", "createdAt": "2020-08-12T16:41:08Z", "commit": {"oid": "2bea25eb79661f36a62b1b082b8dacc585f492a2"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4218, "cost": 1, "resetAt": "2021-10-29T19:57:52Z"}}}