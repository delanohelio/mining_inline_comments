{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg1MDM2MjUy", "number": 876, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNlQyMjoxMTowMVrODl9Q9Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wOVQxOToxMToxN1rODmbZog==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQxMTI3NjY5OnYy", "diffSide": "RIGHT", "path": "helix-core/src/main/java/org/apache/helix/manager/zk/ParticipantManager.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNlQyMjoxMTowMVrOFzI-hg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wN1QwMjowMTozOVrOFzL7XA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTE2ODc3NA==", "bodyText": "Do we need this? If we know the environment is Azure, then we can directly get the topology from AzureConstants instead of reading from ClusterConfig.", "url": "https://github.com/apache/helix/pull/876#discussion_r389168774", "createdAt": "2020-03-06T22:11:01Z", "author": {"login": "junkaixue"}, "path": "helix-core/src/main/java/org/apache/helix/manager/zk/ParticipantManager.java", "diffHunk": "@@ -200,6 +201,22 @@ private void joinCluster() {\n     }\n   }\n \n+  private String ConstructDomainField(String faultDomain) {\n+    Boolean topologyEnabled = _configAccessor.getClusterConfig(_clusterName).isTopologyAwareEnabled();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c59bc5e6e26f79a9441fcb76438ce9b2ab380b21"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTE3OTA3NA==", "bodyText": "In this logic, we do not parse the cloud provider directly. That logic is in the processor. I was thinking that if we read from clusterConfig, it'll be generic, and independent of cloud provider. thoughts?", "url": "https://github.com/apache/helix/pull/876#discussion_r389179074", "createdAt": "2020-03-06T22:41:37Z", "author": {"login": "zhangmeng916"}, "path": "helix-core/src/main/java/org/apache/helix/manager/zk/ParticipantManager.java", "diffHunk": "@@ -200,6 +201,22 @@ private void joinCluster() {\n     }\n   }\n \n+  private String ConstructDomainField(String faultDomain) {\n+    Boolean topologyEnabled = _configAccessor.getClusterConfig(_clusterName).isTopologyAwareEnabled();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTE2ODc3NA=="}, "originalCommit": {"oid": "c59bc5e6e26f79a9441fcb76438ce9b2ab380b21"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTIxNzExNg==", "bodyText": "Discussed offline. We'll move the logic to cloud instance information processor and not to depend on cluster config.", "url": "https://github.com/apache/helix/pull/876#discussion_r389217116", "createdAt": "2020-03-07T02:01:39Z", "author": {"login": "zhangmeng916"}, "path": "helix-core/src/main/java/org/apache/helix/manager/zk/ParticipantManager.java", "diffHunk": "@@ -200,6 +201,22 @@ private void joinCluster() {\n     }\n   }\n \n+  private String ConstructDomainField(String faultDomain) {\n+    Boolean topologyEnabled = _configAccessor.getClusterConfig(_clusterName).isTopologyAwareEnabled();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTE2ODc3NA=="}, "originalCommit": {"oid": "c59bc5e6e26f79a9441fcb76438ce9b2ab380b21"}, "originalPosition": 24}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQxNjIwNzIzOnYy", "diffSide": "RIGHT", "path": "helix-core/src/main/java/org/apache/helix/cloud/azure/AzureCloudInstanceInformationProcessor.java", "isResolved": true, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wOVQxOTowOTowOVrOFz1wOQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wOVQyMTozNTo0OFrOFz6M9Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTkwMjM5Mw==", "bodyText": "This is not necessary, right? Unless we offer flexibility for user to customize it.", "url": "https://github.com/apache/helix/pull/876#discussion_r389902393", "createdAt": "2020-03-09T19:09:09Z", "author": {"login": "junkaixue"}, "path": "helix-core/src/main/java/org/apache/helix/cloud/azure/AzureCloudInstanceInformationProcessor.java", "diffHunk": "@@ -142,8 +142,16 @@ public AzureCloudInstanceInformation parseCloudInstanceInformation(List<String>\n         String vmName = computeNode.path(INSTANCE_NAME).getTextValue();\n         String platformFaultDomain = computeNode.path(DOMAIN).getTextValue();\n         String vmssName = computeNode.path(INSTANCE_SET_NAME).getValueAsText();\n+        String azureTopology = AzureConstants.AZURE_TOPOLOGY;\n+        String[] parts = azureTopology.trim().split(\"/\");\n+        if (parts.length != 2) {\n+          throw new HelixException(\"Invalid Azure topology definition: \" + azureTopology);\n+        }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d31b6e48fba009e8c7a52611952c753eae51a253"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTkyNTA1MA==", "bodyText": "I was thinking whether it's possible the file was accidentally changed.", "url": "https://github.com/apache/helix/pull/876#discussion_r389925050", "createdAt": "2020-03-09T19:53:38Z", "author": {"login": "zhangmeng916"}, "path": "helix-core/src/main/java/org/apache/helix/cloud/azure/AzureCloudInstanceInformationProcessor.java", "diffHunk": "@@ -142,8 +142,16 @@ public AzureCloudInstanceInformation parseCloudInstanceInformation(List<String>\n         String vmName = computeNode.path(INSTANCE_NAME).getTextValue();\n         String platformFaultDomain = computeNode.path(DOMAIN).getTextValue();\n         String vmssName = computeNode.path(INSTANCE_SET_NAME).getValueAsText();\n+        String azureTopology = AzureConstants.AZURE_TOPOLOGY;\n+        String[] parts = azureTopology.trim().split(\"/\");\n+        if (parts.length != 2) {\n+          throw new HelixException(\"Invalid Azure topology definition: \" + azureTopology);\n+        }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTkwMjM5Mw=="}, "originalCommit": {"oid": "d31b6e48fba009e8c7a52611952c753eae51a253"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTk3MzMwMg==", "bodyText": "But this is not from the file. This is from Java class AzureConstants.", "url": "https://github.com/apache/helix/pull/876#discussion_r389973302", "createdAt": "2020-03-09T21:31:25Z", "author": {"login": "junkaixue"}, "path": "helix-core/src/main/java/org/apache/helix/cloud/azure/AzureCloudInstanceInformationProcessor.java", "diffHunk": "@@ -142,8 +142,16 @@ public AzureCloudInstanceInformation parseCloudInstanceInformation(List<String>\n         String vmName = computeNode.path(INSTANCE_NAME).getTextValue();\n         String platformFaultDomain = computeNode.path(DOMAIN).getTextValue();\n         String vmssName = computeNode.path(INSTANCE_SET_NAME).getValueAsText();\n+        String azureTopology = AzureConstants.AZURE_TOPOLOGY;\n+        String[] parts = azureTopology.trim().split(\"/\");\n+        if (parts.length != 2) {\n+          throw new HelixException(\"Invalid Azure topology definition: \" + azureTopology);\n+        }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTkwMjM5Mw=="}, "originalCommit": {"oid": "d31b6e48fba009e8c7a52611952c753eae51a253"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTk3NTI4NQ==", "bodyText": "oh yes, I was thinking about my property file. Removed.", "url": "https://github.com/apache/helix/pull/876#discussion_r389975285", "createdAt": "2020-03-09T21:35:48Z", "author": {"login": "zhangmeng916"}, "path": "helix-core/src/main/java/org/apache/helix/cloud/azure/AzureCloudInstanceInformationProcessor.java", "diffHunk": "@@ -142,8 +142,16 @@ public AzureCloudInstanceInformation parseCloudInstanceInformation(List<String>\n         String vmName = computeNode.path(INSTANCE_NAME).getTextValue();\n         String platformFaultDomain = computeNode.path(DOMAIN).getTextValue();\n         String vmssName = computeNode.path(INSTANCE_SET_NAME).getValueAsText();\n+        String azureTopology = AzureConstants.AZURE_TOPOLOGY;\n+        String[] parts = azureTopology.trim().split(\"/\");\n+        if (parts.length != 2) {\n+          throw new HelixException(\"Invalid Azure topology definition: \" + azureTopology);\n+        }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTkwMjM5Mw=="}, "originalCommit": {"oid": "d31b6e48fba009e8c7a52611952c753eae51a253"}, "originalPosition": 8}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQxNjIxNDEwOnYy", "diffSide": "RIGHT", "path": "helix-core/src/main/java/org/apache/helix/manager/zk/ParticipantManager.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wOVQxOToxMToxN1rOFz10lg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wOVQxOTo1MzoxMlrOFz3HrQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTkwMzUxMA==", "bodyText": "This is domain string right? Then it should looked like \"FD=xxx, InstanceName=xxxx\". But the code is adding them together?", "url": "https://github.com/apache/helix/pull/876#discussion_r389903510", "createdAt": "2020-03-09T19:11:17Z", "author": {"login": "junkaixue"}, "path": "helix-core/src/main/java/org/apache/helix/manager/zk/ParticipantManager.java", "diffHunk": "@@ -178,7 +178,7 @@ private void joinCluster() {\n           LOG.info(_instanceName + \" is auto-registering cluster: \" + _clusterName);\n           CloudInstanceInformation cloudInstanceInformation = getCloudInstanceInformation();\n           String domain = cloudInstanceInformation\n-              .get(CloudInstanceInformation.CloudInstanceField.FAULT_DOMAIN.name());\n+              .get(CloudInstanceInformation.CloudInstanceField.FAULT_DOMAIN.name()) + _instanceName;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d31b6e48fba009e8c7a52611952c753eae51a253"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTkyNDc4MQ==", "bodyText": "The prefix is in the processor:\n//The hostname will be filled in by each participant\nString domain = parts[0] + \"=\" + platformFaultDomain + \",\" + parts[1] + \"=\";", "url": "https://github.com/apache/helix/pull/876#discussion_r389924781", "createdAt": "2020-03-09T19:53:12Z", "author": {"login": "zhangmeng916"}, "path": "helix-core/src/main/java/org/apache/helix/manager/zk/ParticipantManager.java", "diffHunk": "@@ -178,7 +178,7 @@ private void joinCluster() {\n           LOG.info(_instanceName + \" is auto-registering cluster: \" + _clusterName);\n           CloudInstanceInformation cloudInstanceInformation = getCloudInstanceInformation();\n           String domain = cloudInstanceInformation\n-              .get(CloudInstanceInformation.CloudInstanceField.FAULT_DOMAIN.name());\n+              .get(CloudInstanceInformation.CloudInstanceField.FAULT_DOMAIN.name()) + _instanceName;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTkwMzUxMA=="}, "originalCommit": {"oid": "d31b6e48fba009e8c7a52611952c753eae51a253"}, "originalPosition": 5}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1361, "cost": 1, "resetAt": "2021-11-11T21:28:48Z"}}}