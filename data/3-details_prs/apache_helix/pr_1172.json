{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDU2NTM1NzI0", "number": 1172, "title": "add tutorial for Helix cloud support", "bodyText": "Issues\n\n My PR addresses the following Helix issues and references them in the PR description:\n\nFixes #1145\nDescription\n\n Here are some details about my PR, including screenshots of any UI changes:\n\nThis PR adds tutorial on how to use Helix cloud support. Specifically, it guides user through the steps to realized participant auto registration to a cluster.\nTests\n\n The following is the result of the \"mvn test\" command on the appropriate module:\n\nmvn site:site\nmvn site:stage\npassed\nGenerated webpage is checked.\nCommits\n\n My commits all reference appropriate Apache Helix GitHub issues in their subject lines. In addition, my commits follow the guidelines from \"How to write a good git commit message\":\n\nSubject is separated from body by a blank line\nSubject is limited to 50 characters (not including Jira issue reference)\nSubject does not end with a period\nSubject uses the imperative mood (\"add\", not \"adding\")\nBody wraps at 72 characters\nBody explains \"what\" and \"why\", not \"how\"\n\n\n\nCode Quality\n\n My diff has been formatted using helix-style.xml\n(helix-style-intellij.xml if IntelliJ IDE is used)", "createdAt": "2020-07-25T00:06:00Z", "url": "https://github.com/apache/helix/pull/1172", "merged": true, "mergeCommit": {"oid": "f50f9c1d56a2a00ad15454cff4fdf71168a466db"}, "closed": true, "closedAt": "2020-07-30T20:44:29Z", "author": {"login": "zhangmeng916"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc4NIO8AH2gAyNDU2NTM1NzI0OmJjODdiNjNlODU3N2FmZDMyNDc4ZDFlOTliZDhkN2VjNjBkZWMzOTU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc5F4PLgFqTQ1NjAxOTI1Nw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "bc87b63e8577afd32478d1e99bd8d7ec60dec395", "author": {"user": {"login": "zhangmeng916", "name": "Meng Zhang"}}, "url": "https://github.com/apache/helix/commit/bc87b63e8577afd32478d1e99bd8d7ec60dec395", "committedDate": "2020-07-25T00:03:36Z", "message": "add tutorial for Helix cloud support"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU1MzQwNTM3", "url": "https://github.com/apache/helix/pull/1172#pullrequestreview-455340537", "createdAt": "2020-07-26T07:42:39Z", "commit": {"oid": "d7138d2968a2425e06e0345eb0151998e53001e8"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2a2eb347d1e77020892abc43432443d89800b043", "author": {"user": {"login": "zhangmeng916", "name": "Meng Zhang"}}, "url": "https://github.com/apache/helix/commit/2a2eb347d1e77020892abc43432443d89800b043", "committedDate": "2020-07-26T15:43:58Z", "message": "fix grammar issues"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d7138d2968a2425e06e0345eb0151998e53001e8", "author": {"user": {"login": "zhangmeng916", "name": "Meng Zhang"}}, "url": "https://github.com/apache/helix/commit/d7138d2968a2425e06e0345eb0151998e53001e8", "committedDate": "2020-07-26T07:01:13Z", "message": "fix grammar issues"}, "afterCommit": {"oid": "2a2eb347d1e77020892abc43432443d89800b043", "author": {"user": {"login": "zhangmeng916", "name": "Meng Zhang"}}, "url": "https://github.com/apache/helix/commit/2a2eb347d1e77020892abc43432443d89800b043", "committedDate": "2020-07-26T15:43:58Z", "message": "fix grammar issues"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU2MDE5MjU3", "url": "https://github.com/apache/helix/pull/1172#pullrequestreview-456019257", "createdAt": "2020-07-27T18:10:42Z", "commit": {"oid": "2a2eb347d1e77020892abc43432443d89800b043"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yN1QxODoxMDo0MlrOG3t2Rw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yN1QxODoxMDo0MlrOG3t2Rw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTA3NjAzOQ==", "bodyText": "what is CLOUND_INFO_PROCESSOR_NAME used for in Helix?", "url": "https://github.com/apache/helix/pull/1172#discussion_r461076039", "createdAt": "2020-07-27T18:10:42Z", "author": {"login": "kaisun2000"}, "path": "website/1.0.1/src/site/markdown/tutorial_cloud_support.md", "diffHunk": "@@ -0,0 +1,228 @@\n+<!---\n+Licensed to the Apache Software Foundation (ASF) under one\n+or more contributor license agreements.  See the NOTICE file\n+distributed with this work for additional information\n+regarding copyright ownership.  The ASF licenses this file\n+to you under the Apache License, Version 2.0 (the\n+\"License\"); you may not use this file except in compliance\n+with the License.  You may obtain a copy of the License at\n+\n+  http://www.apache.org/licenses/LICENSE-2.0\n+\n+Unless required by applicable law or agreed to in writing,\n+software distributed under the License is distributed on an\n+\"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+KIND, either express or implied.  See the License for the\n+specific language governing permissions and limitations\n+under the License.\n+-->\n+\n+<head>\n+  <title>Tutorial - Cloud Support</title>\n+</head>\n+\n+## [Helix Tutorial](./Tutorial.html): Cloud Support\n+\n+There are emerging cases to use Helix in a cloud environment, especially in those well-known public cloud, e.g. Azure, AWS, GCP, etc. Compared to previous on premise use cases, Helix has faced both challenges and opportunities in providing cloud related support. \n+\n+As a first step, Helix implemented the support for participant auto registration in a cloud environment, which leverages the common feature of public cloud and facilitates Helix users when they need to create a cluster and register the participants to the cluster.\n+\n+After a Helix cluster is created, there are two ways to add instances (or participants, we will use them interchangeably in this tutorial) to the cluster. One is manual add, where users call their own scripts to add instance config to the cluster for each participant; and the other is auto join, where users set the auto join config of the cluster to be true, and each participant populates its own hostname, port number, and other information in instance config during connection. However, in an on premise environment, the auto join only works perfectly when users use Helix in a non rack-aware environment, meaning there is no fault domain concept. For a rack-aware environment, users still need to manually input the domain information to the instance config as it is hard for each participant to get its own fault domain information. Considering most users would use Helix in a rack-aware environment, it means manual work is still required.\n+        \n+In a cloud environment, there is a good opportunity to achieve full automation as public cloud providers give domain information to each individual instance through a metadata endpoint. All of the above mentioned public cloud providers use a unique non-routable IP address (169.254.169.254) for this purpose. It can be accessed only from within the instance to retrieve the instance metadata information, which you can use to configure or manage the running instance. \n+\n+More specifically, in AWS, Azure, and GCP, the query to the fixed IP address  http://169.254.169.254/ inside each instance will return its metadata information that contains domain information. In AWS, the field is named as \"placement\"; in Azure, the field is named as \"PlatformUpdateDomain\"; and in GCP, the field is named as \"zone\". It is usually just an integer denoting which fault domain the instance belongs to. This particular feature of public cloud is leveraged by Helix in cluster creation and partition registration process. \n+\n+### What Helix Provides for Cloud Environment\n+* Provide definition of Helix cloud configs at cluster level and participant level\n+* Provide enhanced REST and Java APIs for cluster creation and cloud config update\n+* Provide generic interface for fetching and parsing cloud instance information\n+* Provide the implementation of Azure cloud instance information processor\n+* Provide the implementation of participant auto registration logic\n+\n+### How to Use Cloud Support\n+First of all, you need to make sure that your environment is indeed a cloud environment. Otherwise, all the assumptions in this support will not hold. Then depending on what kind of cloud environment you are in, you will need to perform some or all of the following steps.\n+  \n+#### Define Cloud config at Cluster Level\n+Helix provides cloud configs at two different levels, one is at cluster level, and the other is at participant level. We describe them separately.\n+\n+At cluster level, we have a new Znode called CloudConfig. It has a few fields that store the relatively static cloud information for the whole cluster. Similar to other existing configs, Helix provides cloud config builder, validation, get/set functions. As the following table shows, the first two fields are required, and the last three fields are optional. \n+\n+`CLOUD_ENABLED` must be set to true if the user would like to use Helix cloud support. `CLOUD_PROVIDER` is the type of the cloud environment. Besides the few well-known public cloud providers, the user can also define his/her cloud environment as \"CUSTOMIZED\". `CLOUD_ID` is an optional field. It can be used to record any specific metadata information the user would like to record, e.g. the ID for the particular cluster inside a cloud environment, etc. If the user chooses to use the provider that already has default implementations in Helix, e.g., Azure, he does not need to provide the last two fields, as Helix already provides the default value for these two fields in system property, which is considered as a bundle with Azure implementation that would be discussed later. If the user uses customized providers, or chooses some other cloud environment that has not been implemented in Helix yet, the user needs to provide the last two fields and/or `CLOUD_ID` depending on his/her usage.  \n+          \n+| Field | Meaning |\n+| ------------------------- | ------ |\n+| CLOUD_ENABLED | determine whether the cluster is inside cloud environment and use Helix cloud support |\n+| CLOUD_PROVIDER | denote what kind of cloud environment the cluster is in, e.g. Azure, AWS, GCP, or CUSTOMIZED |\n+| CLOUD_ID | the specific id in cloud environment that belongs to this cluster |\n+| CLOUD_INFO_SOURCE | the source for retrieving the cloud information. |\n+| CLOUD_INFO_PROCESSOR_NAME | the name of the function that processes the fetching and parsing of cloud information |\n+\n+Users could use either REST API or Java API to set these configs.\n+\n+##### REST API Examples\n+Helix enhanced current cluster creation REST API as well as Java API with extra fields that represent cloud related input. For example, in the following modified `createCluster` API, `addCloudConfig` is a Boolean value denotes whether to create with cloud config, and the `cloudConfigManifest` is the cloud config string, which will be converted to a Znode record.\n+\n+```\n+@PUT\n+  @Path(\"{clusterId}\")\n+  public Response createCluster(@PathParam(\"clusterId\") String clusterId, @DefaultValue(\"false\") @QueryParam(\"recreate\") String recreate,\n+      @DefaultValue(\"false\") @QueryParam(\"addCloudConfig\") String addCloudConfig, String cloudConfigManifest)\n+```\n+\n+Besides the enhanced cluster creation API, Helix also provides a set of cloud specific APIs in Java and REST that handles the get/add/update of cloud config. \n+   \n+* Create cluster and add meanwhile cloud config related information to ZK.\n+\n+```\n+$ curl -X PUT -H \"Content-Type: application/json\" http://localhost:1234/admin/v2/clusters/myCluster?addCloudConfig=true -d '\n+{\n+    \"simpleFields\" : \n+    {\n+        \"CLOUD_ENABLED\" : \"true\",\n+        \"CLOUD_PROVIDER\": \"AWS\",\n+        \"CLOUD_ID\" : \"12345\"\n+        \"CLOUD_INFO_SOURCE\": {\"http://169.254.169.254/\"}\n+        \"CLOUD_INFO_PROCESSOR_NAME\": \"AWSCloudInformationProcesser\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2a2eb347d1e77020892abc43432443d89800b043"}, "originalPosition": 86}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4581, "cost": 1, "resetAt": "2021-10-29T19:57:52Z"}}}