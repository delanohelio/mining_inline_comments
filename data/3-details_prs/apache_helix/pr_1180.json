{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDU3NDI3NTg1", "number": 1180, "title": "Remove race condition in TestTaskSchedulingTwoCurrentStates", "bodyText": "Issues\n\n My PR addresses the following Helix issues and references them in the PR title:\nFixes #1179\n\nDescription\n\n Here are some details about my PR, including screenshots of any UI changes:\n\nIn this PR, TestTaskSchedulingTwoCurrentStates has been stabilized by creating SEMI-AUTO resource and update the preferenceList to avoid race condition that happens when test and controller update the preferenceList at the same time.\nTests\n\n The following is the result of the \"mvn test\" command on the appropriate module:\n\nhelix-core:\n[INFO] Tests run: 1155, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 4,800.964 s - in TestSuite\n[INFO] \n[INFO] Results:\n[INFO] \n[INFO] Tests run: 1155, Failures: 0, Errors: 0, Skipped: 0\n[INFO] \n[INFO] ------------------------------------------------------------------------\n[INFO] BUILD SUCCESS\n[INFO] ------------------------------------------------------------------------\n[INFO] Total time:  01:20 h\n[INFO] Finished at: 2020-07-27T14:59:27-07:00\n[INFO] ------------------------------------------------------------------------\n\nhelix-rest:\n[INFO] Tests run: 163, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 43.032 s - in TestSuite\n[INFO] \n[INFO] Results:\n[INFO] \n[INFO] Tests run: 163, Failures: 0, Errors: 0, Skipped: 0\n[INFO] \n[INFO] ------------------------------------------------------------------------\n[INFO] BUILD SUCCESS\n[INFO] ------------------------------------------------------------------------\n[INFO] Total time:  48.283 s\n[INFO] Finished at: 2020-07-27T15:07:54-07:00\n[INFO] ------------------------------------------------------------------------\n\nCommits\n\n My commits all reference appropriate Apache Helix GitHub issues in their subject lines, and I have squashed multiple commits if they address the same issue. In addition, my commits follow the guidelines from \"How to write a good git commit message\":\n\nSubject is separated from body by a blank line\nSubject is limited to 50 characters (not including Jira issue reference)\nSubject does not end with a period\nSubject uses the imperative mood (\"add\", not \"adding\")\nBody wraps at 72 characters\nBody explains \"what\" and \"why\", not \"how\"\n\n\n\nCode Quality\n\n My diff has been formatted using helix-style.xml", "createdAt": "2020-07-27T22:08:55Z", "url": "https://github.com/apache/helix/pull/1180", "merged": true, "mergeCommit": {"oid": "69aaf43db4489445d6883d0111a0eb72a73e32ba"}, "closed": true, "closedAt": "2020-07-29T17:31:59Z", "author": {"login": "alirezazamani"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc5EYaXgH2gAyNDU3NDI3NTg1OmNlOTdhNGJmMTVjNGQ1MTg3MzliM2EzYTg2MzdlN2E3ZWM1ODhmNGQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc5d0pZgH2gAyNDU3NDI3NTg1Ojc3MTI1NTgyZmZiODQwNTNkN2ZkOGZmNzkyMTg3NjM3NzI5MmIyNjI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "ce97a4bf15c4d518739b3a3a8637e7a7ec588f4d", "author": {"user": {"login": "alirezazamani", "name": "Ali Reza Zamani Zadeh Najari"}}, "url": "https://github.com/apache/helix/commit/ce97a4bf15c4d518739b3a3a8637e7a7ec588f4d", "committedDate": "2020-07-27T16:26:03Z", "message": "Stabilize TestTaskSchedulingTwoCurrentStates\n\nIn this commit, TestTaskSchedulingTwoCurrentStates is stabulized by\ncreating SEMI-AUTO resource and update the preferenceList to avoid\nrace condition that happens when test and controller update the\npreferenceList at the same time."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU2ODY5OTM0", "url": "https://github.com/apache/helix/pull/1180#pullrequestreview-456869934", "createdAt": "2020-07-28T17:49:09Z", "commit": {"oid": "ce97a4bf15c4d518739b3a3a8637e7a7ec588f4d"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU2OTExNTM3", "url": "https://github.com/apache/helix/pull/1180#pullrequestreview-456911537", "createdAt": "2020-07-28T18:46:40Z", "commit": {"oid": "ce97a4bf15c4d518739b3a3a8637e7a7ec588f4d"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOFQxODo0Njo0MVrOG4Z0DA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOFQxODo0Njo0MVrOG4Z0DA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTc5NjM2NA==", "bodyText": "Is it possible the old way of using WorkflowGenerator.DEFAULT_TGT_DB would have conflict, if multiple test using the same \"WorkflowGenerator.DEFAULT_TGT_DB\"?", "url": "https://github.com/apache/helix/pull/1180#discussion_r461796364", "createdAt": "2020-07-28T18:46:41Z", "author": {"login": "kaisun2000"}, "path": "helix-core/src/test/java/org/apache/helix/integration/task/TestTaskSchedulingTwoCurrentStates.java", "diffHunk": "@@ -65,7 +60,7 @@\n  * sent when there are two CurrentStates.\n  */\n public class TestTaskSchedulingTwoCurrentStates extends TaskTestBase {\n-  private static final String DATABASE = WorkflowGenerator.DEFAULT_TGT_DB;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ce97a4bf15c4d518739b3a3a8637e7a7ec588f4d"}, "originalPosition": 27}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU2OTI3MjA4", "url": "https://github.com/apache/helix/pull/1180#pullrequestreview-456927208", "createdAt": "2020-07-28T19:08:46Z", "commit": {"oid": "ce97a4bf15c4d518739b3a3a8637e7a7ec588f4d"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOFQxOTowODo0NlrOG4aksA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOFQxOTowODo0NlrOG4aksA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTgwODgxNg==", "bodyText": "I think the better way to fix it is not call super.beforeClass() in line 72/77. This way, we won't create the cluster/full auto etc and participant that we need to stop immediately.\nInstead, just creates cluster, controller and participant in this before test. What is your take?", "url": "https://github.com/apache/helix/pull/1180#discussion_r461808816", "createdAt": "2020-07-28T19:08:46Z", "author": {"login": "kaisun2000"}, "path": "helix-core/src/test/java/org/apache/helix/integration/task/TestTaskSchedulingTwoCurrentStates.java", "diffHunk": "@@ -65,7 +60,7 @@\n  * sent when there are two CurrentStates.\n  */\n public class TestTaskSchedulingTwoCurrentStates extends TaskTestBase {\n-  private static final String DATABASE = WorkflowGenerator.DEFAULT_TGT_DB;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTc5NjM2NA=="}, "originalCommit": {"oid": "ce97a4bf15c4d518739b3a3a8637e7a7ec588f4d"}, "originalPosition": 27}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU2OTMxMDQ5", "url": "https://github.com/apache/helix/pull/1180#pullrequestreview-456931049", "createdAt": "2020-07-28T19:14:24Z", "commit": {"oid": "ce97a4bf15c4d518739b3a3a8637e7a7ec588f4d"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOFQxOToxNDoyNFrOG4awcw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOFQxOToxNDoyNFrOG4awcw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTgxMTgyNw==", "bodyText": "Another thing is that for all the resources created in\n@BeforeClass\n  public void beforeClass() throws Exception {\n\nWe should tear them down. The participant threads, the controller thread should be stopped with syncStop. Maybe we should also clean up the cluster path etc in Zookeeper.", "url": "https://github.com/apache/helix/pull/1180#discussion_r461811827", "createdAt": "2020-07-28T19:14:24Z", "author": {"login": "kaisun2000"}, "path": "helix-core/src/test/java/org/apache/helix/integration/task/TestTaskSchedulingTwoCurrentStates.java", "diffHunk": "@@ -65,7 +60,7 @@\n  * sent when there are two CurrentStates.\n  */\n public class TestTaskSchedulingTwoCurrentStates extends TaskTestBase {\n-  private static final String DATABASE = WorkflowGenerator.DEFAULT_TGT_DB;\n+  private static final String DATABASE = \"TestDB_\" + TestHelper.getTestClassName();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ce97a4bf15c4d518739b3a3a8637e7a7ec588f4d"}, "originalPosition": 28}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "77125582ffb84053d7fd8ff7921876377292b262", "author": {"user": {"login": "alirezazamani", "name": "Ali Reza Zamani Zadeh Najari"}}, "url": "https://github.com/apache/helix/commit/77125582ffb84053d7fd8ff7921876377292b262", "committedDate": "2020-07-28T22:04:31Z", "message": "Add afterClass"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4587, "cost": 1, "resetAt": "2021-10-29T19:57:52Z"}}}