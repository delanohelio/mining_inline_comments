{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDI5NTU4Mjg2", "number": 1070, "title": "Deprecate Raw ZkClient in helix-core", "bodyText": "Issues\n\n My PR addresses the following Helix issues and references them in the PR description:\n\nFixes #1069\nDescription\n\n Here are some details about my PR, including screenshots of any UI changes:\n\nWe have moved the raw ZkClient to zookeeper-api. As such, we need to deprecate and remove the old one in helix-core.\nTestRawZkClient also has been moved from helix-core to zookeeper-api. Other TestHelper classes were moved and trimmed of unnecessary Helix-related fat.\nTests\n\n The following tests are written for this issue:\n\nTestRawZkClient (moved and updated)\n\n The following is the result of the \"mvn test\" command on the appropriate module:\n\n[ERROR] Failures:\n[ERROR]   TestEnableCompression.testEnableCompressionResource:116 \u00c2\u00bb ThreadTimeout Method...\n[ERROR]   TestClusterInMaintenanceModeWhenReachingMaxPartition.testDisableCluster:119 expected:<true> but was:<false>\n[INFO]\n[ERROR] Tests run: 1137, Failures: 2, Errors: 0, Skipped: 0\n\n[INFO] Tests run: 2, Failures: 0, Errors: 0, Skipped: 0\n[INFO]\n[INFO] ------------------------------------------------------------------------\n[INFO] BUILD SUCCESS\nCommits\n\n My commits all reference appropriate Apache Helix GitHub issues in their subject lines. In addition, my commits follow the guidelines from \"How to write a good git commit message\":\n\nSubject is separated from body by a blank line\nSubject is limited to 50 characters (not including Jira issue reference)\nSubject does not end with a period\nSubject uses the imperative mood (\"add\", not \"adding\")\nBody wraps at 72 characters\nBody explains \"what\" and \"why\", not \"how\"\n\n\n\nCode Quality\n\n My diff has been formatted using helix-style.xml\n(helix-style-intellij.xml if IntelliJ IDE is used)", "createdAt": "2020-06-07T00:34:48Z", "url": "https://github.com/apache/helix/pull/1070", "merged": true, "mergeCommit": {"oid": "39bf0ad429660797d70a0a1b53a2105e4ec1cd50"}, "closed": true, "closedAt": "2020-06-09T19:30:36Z", "author": {"login": "narendly"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcowWbyAH2gAyNDI5NTU4Mjg2OjRmODgwYmNhMmQ1MTU2ZmQ3NzI0MzRhOTZmZThkOWY1NTM2ZmU3Y2I=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcpoVt3AH2gAyNDI5NTU4Mjg2Ojc1MTg0YmQyYWM4YWQ3YWE4MTA2ODA3ZjQ3YzhjZjQ5OTdkNDViZDk=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "4f880bca2d5156fd772434a96fe8d9f5536fe7cb", "author": {"user": {"login": "narendly", "name": "Hunter Lee"}}, "url": "https://github.com/apache/helix/commit/4f880bca2d5156fd772434a96fe8d9f5536fe7cb", "committedDate": "2020-06-07T00:03:00Z", "message": "Deprecate Raw ZkClient in helix-core\n\nWe have moved the raw ZkClient to zookeeper-api. As such, we need to deprecate the old one in helix-core. We are leaving the class for backward-compatibility purposes."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "01f114ea8585d04e76452006b83a0f15a7150bf1", "author": {"user": {"login": "narendly", "name": "Hunter Lee"}}, "url": "https://github.com/apache/helix/commit/01f114ea8585d04e76452006b83a0f15a7150bf1", "committedDate": "2020-06-07T00:36:24Z", "message": "asdf"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI1NzgyNDIz", "url": "https://github.com/apache/helix/pull/1070#pullrequestreview-425782423", "createdAt": "2020-06-07T02:38:31Z", "commit": {"oid": "01f114ea8585d04e76452006b83a0f15a7150bf1"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wN1QwMjozODozMVrOGgGxUA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wN1QwMjozODozMVrOGgGxUA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjMxODU0NA==", "bodyText": "Do we still need these constructors in old file? Or we can just leave the class purely extend what we have in zookeeper-api module?", "url": "https://github.com/apache/helix/pull/1070#discussion_r436318544", "createdAt": "2020-06-07T02:38:31Z", "author": {"login": "junkaixue"}, "path": "helix-core/src/main/java/org/apache/helix/manager/zk/ZkClient.java", "diffHunk": "@@ -55,33 +49,26 @@\n  * TODO Completely replace usage of the raw ZkClient within helix-core. Instead, using HelixZkClient. --JJ\n  */\n \n-public class ZkClient extends org.apache.helix.manager.zk.zookeeper.ZkClient implements HelixZkClient {\n-  private static Logger LOG = LoggerFactory.getLogger(ZkClient.class);\n-\n-  public static final int DEFAULT_OPERATION_TIMEOUT = Integer.MAX_VALUE;\n-  public static final int DEFAULT_CONNECTION_TIMEOUT = 60 * 1000;\n-  public static final int DEFAULT_SESSION_TIMEOUT = 30 * 1000;\n-\n+@Deprecated\n+public class ZkClient extends org.apache.helix.zookeeper.impl.client.ZkClient {\n   /**\n-   *\n-   * @param zkConnection\n+   *  @param zkConnection\n    *            The Zookeeper connection\n    * @param connectionTimeout\n    *            The connection timeout in milli seconds\n-   * @param zkSerializer\n-   *            The Zookeeper data serializer\n    * @param operationRetryTimeout\n    *            Most operations are retried in cases like connection loss with the Zookeeper servers. During such failures, this\n    *            <code>operationRetryTimeout</code> decides the maximum amount of time, in milli seconds, each\n    *            operation is retried. A value lesser than 0 is considered as\n    *            \"retry forever until a connection has been reestablished\".\n+   * @param zkSerializer\n+   *            The Zookeeper data serializer\n    * @param monitorType\n    * @param monitorKey\n    * @param monitorInstanceName\n-   *            These 3 inputs are used to name JMX monitor bean name for this ZkClient.\n+   *            These 3 inputs are used to name JMX monitor bean name for this RealmAwareZkClient.\n    *            The JMX bean name will be: HelixZkClient.monitorType.monitorKey.monitorInstanceName.\n    * @param monitorRootPathOnly\n-   *            Should only stat of access to root path be reported to JMX bean or path-specific stat be reported too.\n    */\n   public ZkClient(IZkConnection zkConnection, int connectionTimeout, long operationRetryTimeout,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "01f114ea8585d04e76452006b83a0f15a7150bf1"}, "originalPosition": 62}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI1Nzg2OTQ3", "url": "https://github.com/apache/helix/pull/1070#pullrequestreview-425786947", "createdAt": "2020-06-07T04:54:02Z", "commit": {"oid": "01f114ea8585d04e76452006b83a0f15a7150bf1"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wN1QwNDo1NDowM1rOGgHJXQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wN1QwNDo1ODozN1rOGgHKQQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjMyNDcwMQ==", "bodyText": "I think in the test we can just call Long.toHexString(sessionId).\nOtherwise, my concern is that this public API will be with the ZkClient forever... And it seems to an overkill to have such a public method in the ZkClient class.", "url": "https://github.com/apache/helix/pull/1070#discussion_r436324701", "createdAt": "2020-06-07T04:54:03Z", "author": {"login": "jiajunwang"}, "path": "zookeeper-api/src/main/java/org/apache/helix/zookeeper/zkclient/ZkClient.java", "diffHunk": "@@ -2223,7 +2223,7 @@ private void validateCurrentThread() {\n    *\n    * @return String representation of session id in hexadecimal notation.\n    */\n-  private static String toHexSessionId(long sessionId) {\n+  public static String toHexSessionId(long sessionId) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "01f114ea8585d04e76452006b83a0f15a7150bf1"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjMyNDkyOQ==", "bodyText": "Can we merge 2 helpers? Maybe not a good idea.\nBut when we have both TestHelper and ZkTestHelper in the Zookeeper module, they are kind of confusing. Maybe a pair of better names would help.", "url": "https://github.com/apache/helix/pull/1070#discussion_r436324929", "createdAt": "2020-06-07T04:58:37Z", "author": {"login": "jiajunwang"}, "path": "zookeeper-api/src/test/java/org/apache/helix/zookeeper/impl/ZkTestHelper.java", "diffHunk": "@@ -0,0 +1,447 @@\n+package org.apache.helix.zookeeper.impl;\n+\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+import java.io.BufferedReader;\n+import java.io.InputStreamReader;\n+import java.io.PrintWriter;\n+import java.net.Socket;\n+import java.util.ArrayList;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Set;\n+import java.util.TreeMap;\n+import java.util.TreeSet;\n+import java.util.concurrent.BlockingQueue;\n+import java.util.concurrent.CountDownLatch;\n+import java.util.concurrent.ExecutionException;\n+import java.util.concurrent.ExecutorService;\n+import java.util.concurrent.Executors;\n+import java.util.concurrent.Future;\n+import java.util.concurrent.TimeUnit;\n+\n+import org.apache.helix.zookeeper.api.client.HelixZkClient;\n+import org.apache.helix.zookeeper.api.client.RealmAwareZkClient;\n+import org.apache.helix.zookeeper.zkclient.IZkChildListener;\n+import org.apache.helix.zookeeper.zkclient.IZkDataListener;\n+import org.apache.helix.zookeeper.zkclient.IZkStateListener;\n+import org.apache.helix.zookeeper.zkclient.ZkClient;\n+import org.apache.helix.zookeeper.zkclient.ZkConnection;\n+import org.apache.zookeeper.WatchedEvent;\n+import org.apache.zookeeper.Watcher;\n+import org.apache.zookeeper.Watcher.Event.EventType;\n+import org.apache.zookeeper.Watcher.Event.KeeperState;\n+import org.apache.zookeeper.ZooKeeper;\n+import org.apache.zookeeper.ZooKeeper.States;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.testng.Assert;\n+\n+\n+public class ZkTestHelper {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "01f114ea8585d04e76452006b83a0f15a7150bf1"}, "originalPosition": 59}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI2NTQ5NTM0", "url": "https://github.com/apache/helix/pull/1070#pullrequestreview-426549534", "createdAt": "2020-06-08T19:20:29Z", "commit": {"oid": "01f114ea8585d04e76452006b83a0f15a7150bf1"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a2203871d9bb6fa18b4e9196c18cf72bff3c8959", "author": {"user": {"login": "narendly", "name": "Hunter Lee"}}, "url": "https://github.com/apache/helix/commit/a2203871d9bb6fa18b4e9196c18cf72bff3c8959", "committedDate": "2020-06-09T17:13:53Z", "message": "remove oldzkclient"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "75184bd2ac8ad7aa8106807f47c8cf4997d45bd9", "author": {"user": {"login": "narendly", "name": "Hunter Lee"}}, "url": "https://github.com/apache/helix/commit/75184bd2ac8ad7aa8106807f47c8cf4997d45bd9", "committedDate": "2020-06-09T17:16:54Z", "message": "add it back"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4462, "cost": 1, "resetAt": "2021-10-29T19:57:52Z"}}}