{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg0MTA4NDYy", "number": 867, "reviewThreads": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNlQwNTo1NToyNVrODlr-eA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMVQyMDoxNDoyM1rODnPIVA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQwODQ0NDA4OnYy", "diffSide": "RIGHT", "path": "helix-core/src/main/java/org/apache/helix/tools/ClusterVerifiers/BestPossibleExternalViewVerifier.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNlQwNTo1NToyNVrOFyt46A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wOVQxNzoyNDowOFrOFzyGOw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODcyNDk2OA==", "bodyText": "Shall we copy the list in case the builder would be used to create more objects?\nSame for the super class. But it is not shown here so I haven't reviewed it.", "url": "https://github.com/apache/helix/pull/867#discussion_r388724968", "createdAt": "2020-03-06T05:55:25Z", "author": {"login": "jiajunwang"}, "path": "helix-core/src/main/java/org/apache/helix/tools/ClusterVerifiers/BestPossibleExternalViewVerifier.java", "diffHunk": "@@ -94,29 +93,43 @@ public BestPossibleExternalViewVerifier(HelixZkClient zkClient, String clusterNa\n     _dataProvider = new ResourceControllerDataProvider();\n   }\n \n-  public static class Builder {\n-    private String _clusterName;\n+  private BestPossibleExternalViewVerifier(BestPossibleExternalViewVerifier.Builder builder) {\n+    super(builder);\n+    _errStates = builder._errStates;\n+    _resources = builder._resources;\n+    _expectLiveInstances = builder._expectLiveInstances;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c4d99561c16f4abaf1a7900888c577e0e51252cd"}, "originalPosition": 36}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTg0MjQ5MQ==", "bodyText": "Good point. I'll address this.", "url": "https://github.com/apache/helix/pull/867#discussion_r389842491", "createdAt": "2020-03-09T17:24:08Z", "author": {"login": "narendly"}, "path": "helix-core/src/main/java/org/apache/helix/tools/ClusterVerifiers/BestPossibleExternalViewVerifier.java", "diffHunk": "@@ -94,29 +93,43 @@ public BestPossibleExternalViewVerifier(HelixZkClient zkClient, String clusterNa\n     _dataProvider = new ResourceControllerDataProvider();\n   }\n \n-  public static class Builder {\n-    private String _clusterName;\n+  private BestPossibleExternalViewVerifier(BestPossibleExternalViewVerifier.Builder builder) {\n+    super(builder);\n+    _errStates = builder._errStates;\n+    _resources = builder._resources;\n+    _expectLiveInstances = builder._expectLiveInstances;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODcyNDk2OA=="}, "originalCommit": {"oid": "c4d99561c16f4abaf1a7900888c577e0e51252cd"}, "originalPosition": 36}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQwODQ0NjkzOnYy", "diffSide": "RIGHT", "path": "helix-core/src/main/java/org/apache/helix/tools/ClusterVerifiers/BestPossibleExternalViewVerifier.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNlQwNTo1NzozMFrOFyt6mQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wOVQxNzoyMzozNVrOFzyE0w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODcyNTQwMQ==", "bodyText": "Since we have the builder, shall we deprecated all the other constructors?", "url": "https://github.com/apache/helix/pull/867#discussion_r388725401", "createdAt": "2020-03-06T05:57:30Z", "author": {"login": "jiajunwang"}, "path": "helix-core/src/main/java/org/apache/helix/tools/ClusterVerifiers/BestPossibleExternalViewVerifier.java", "diffHunk": "@@ -84,7 +83,7 @@ public BestPossibleExternalViewVerifier(String zkAddr, String clusterName, Set<S\n     _dataProvider = new ResourceControllerDataProvider();\n   }\n \n-  public BestPossibleExternalViewVerifier(HelixZkClient zkClient, String clusterName,\n+  public BestPossibleExternalViewVerifier(RealmAwareZkClient zkClient, String clusterName,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c4d99561c16f4abaf1a7900888c577e0e51252cd"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTg0MjEzMQ==", "bodyText": "Yes. We should.", "url": "https://github.com/apache/helix/pull/867#discussion_r389842131", "createdAt": "2020-03-09T17:23:35Z", "author": {"login": "narendly"}, "path": "helix-core/src/main/java/org/apache/helix/tools/ClusterVerifiers/BestPossibleExternalViewVerifier.java", "diffHunk": "@@ -84,7 +83,7 @@ public BestPossibleExternalViewVerifier(String zkAddr, String clusterName, Set<S\n     _dataProvider = new ResourceControllerDataProvider();\n   }\n \n-  public BestPossibleExternalViewVerifier(HelixZkClient zkClient, String clusterName,\n+  public BestPossibleExternalViewVerifier(RealmAwareZkClient zkClient, String clusterName,", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODcyNTQwMQ=="}, "originalCommit": {"oid": "c4d99561c16f4abaf1a7900888c577e0e51252cd"}, "originalPosition": 22}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQwODQ0ODI4OnYy", "diffSide": "RIGHT", "path": "helix-core/src/main/java/org/apache/helix/tools/ClusterVerifiers/BestPossibleExternalViewVerifier.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNlQwNTo1ODoyOVrOFyt7Xw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMlQwMjo1OToxNFrOF1PxLg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODcyNTU5OQ==", "bodyText": "Is it possible that we merge this constructor logic into BestPossibleExternalViewVerifier(Builder); So we don't need to maintain both logics.", "url": "https://github.com/apache/helix/pull/867#discussion_r388725599", "createdAt": "2020-03-06T05:58:29Z", "author": {"login": "jiajunwang"}, "path": "helix-core/src/main/java/org/apache/helix/tools/ClusterVerifiers/BestPossibleExternalViewVerifier.java", "diffHunk": "@@ -94,29 +93,43 @@ public BestPossibleExternalViewVerifier(HelixZkClient zkClient, String clusterNa\n     _dataProvider = new ResourceControllerDataProvider();\n   }\n \n-  public static class Builder {\n-    private String _clusterName;\n+  private BestPossibleExternalViewVerifier(BestPossibleExternalViewVerifier.Builder builder) {\n+    super(builder);\n+    _errStates = builder._errStates;\n+    _resources = builder._resources;\n+    _expectLiveInstances = builder._expectLiveInstances;\n+    _dataProvider = new ResourceControllerDataProvider();\n+  }\n+\n+  public static class Builder extends ZkHelixClusterVerifier.Builder {\n+    private final String _clusterName;\n     private Map<String, Map<String, String>> _errStates;\n     private Set<String> _resources;\n     private Set<String> _expectLiveInstances;\n-    private String _zkAddr;\n-    private HelixZkClient _zkClient;\n+    private RealmAwareZkClient _zkClient;\n \n     public Builder(String clusterName) {\n       _clusterName = clusterName;\n     }\n \n     public BestPossibleExternalViewVerifier build() {\n-      if (_clusterName == null || (_zkAddr == null && _zkClient == null)) {\n+      if (_clusterName == null || (_zkAddress == null && _zkClient == null)) {\n         throw new IllegalArgumentException(\"Cluster name or zookeeper info is missing!\");\n       }\n \n       if (_zkClient != null) {\n         return new BestPossibleExternalViewVerifier(_zkClient, _clusterName, _resources, _errStates,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c4d99561c16f4abaf1a7900888c577e0e51252cd"}, "originalPosition": 60}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTg0MzQwNQ==", "bodyText": "This should actually all go in validate(). Let me see if I could move it.", "url": "https://github.com/apache/helix/pull/867#discussion_r389843405", "createdAt": "2020-03-09T17:25:33Z", "author": {"login": "narendly"}, "path": "helix-core/src/main/java/org/apache/helix/tools/ClusterVerifiers/BestPossibleExternalViewVerifier.java", "diffHunk": "@@ -94,29 +93,43 @@ public BestPossibleExternalViewVerifier(HelixZkClient zkClient, String clusterNa\n     _dataProvider = new ResourceControllerDataProvider();\n   }\n \n-  public static class Builder {\n-    private String _clusterName;\n+  private BestPossibleExternalViewVerifier(BestPossibleExternalViewVerifier.Builder builder) {\n+    super(builder);\n+    _errStates = builder._errStates;\n+    _resources = builder._resources;\n+    _expectLiveInstances = builder._expectLiveInstances;\n+    _dataProvider = new ResourceControllerDataProvider();\n+  }\n+\n+  public static class Builder extends ZkHelixClusterVerifier.Builder {\n+    private final String _clusterName;\n     private Map<String, Map<String, String>> _errStates;\n     private Set<String> _resources;\n     private Set<String> _expectLiveInstances;\n-    private String _zkAddr;\n-    private HelixZkClient _zkClient;\n+    private RealmAwareZkClient _zkClient;\n \n     public Builder(String clusterName) {\n       _clusterName = clusterName;\n     }\n \n     public BestPossibleExternalViewVerifier build() {\n-      if (_clusterName == null || (_zkAddr == null && _zkClient == null)) {\n+      if (_clusterName == null || (_zkAddress == null && _zkClient == null)) {\n         throw new IllegalArgumentException(\"Cluster name or zookeeper info is missing!\");\n       }\n \n       if (_zkClient != null) {\n         return new BestPossibleExternalViewVerifier(_zkClient, _clusterName, _resources, _errStates,", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODcyNTU5OQ=="}, "originalCommit": {"oid": "c4d99561c16f4abaf1a7900888c577e0e51252cd"}, "originalPosition": 60}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTM3NzE5OA==", "bodyText": "I tried to move it to validate(), but this is left here to keep this backward-compatible with the existing builder logic. So we need it here..", "url": "https://github.com/apache/helix/pull/867#discussion_r391377198", "createdAt": "2020-03-12T02:59:14Z", "author": {"login": "narendly"}, "path": "helix-core/src/main/java/org/apache/helix/tools/ClusterVerifiers/BestPossibleExternalViewVerifier.java", "diffHunk": "@@ -94,29 +93,43 @@ public BestPossibleExternalViewVerifier(HelixZkClient zkClient, String clusterNa\n     _dataProvider = new ResourceControllerDataProvider();\n   }\n \n-  public static class Builder {\n-    private String _clusterName;\n+  private BestPossibleExternalViewVerifier(BestPossibleExternalViewVerifier.Builder builder) {\n+    super(builder);\n+    _errStates = builder._errStates;\n+    _resources = builder._resources;\n+    _expectLiveInstances = builder._expectLiveInstances;\n+    _dataProvider = new ResourceControllerDataProvider();\n+  }\n+\n+  public static class Builder extends ZkHelixClusterVerifier.Builder {\n+    private final String _clusterName;\n     private Map<String, Map<String, String>> _errStates;\n     private Set<String> _resources;\n     private Set<String> _expectLiveInstances;\n-    private String _zkAddr;\n-    private HelixZkClient _zkClient;\n+    private RealmAwareZkClient _zkClient;\n \n     public Builder(String clusterName) {\n       _clusterName = clusterName;\n     }\n \n     public BestPossibleExternalViewVerifier build() {\n-      if (_clusterName == null || (_zkAddr == null && _zkClient == null)) {\n+      if (_clusterName == null || (_zkAddress == null && _zkClient == null)) {\n         throw new IllegalArgumentException(\"Cluster name or zookeeper info is missing!\");\n       }\n \n       if (_zkClient != null) {\n         return new BestPossibleExternalViewVerifier(_zkClient, _clusterName, _resources, _errStates,", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODcyNTU5OQ=="}, "originalCommit": {"oid": "c4d99561c16f4abaf1a7900888c577e0e51252cd"}, "originalPosition": 60}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQwODQ1MDc4OnYy", "diffSide": "RIGHT", "path": "helix-core/src/main/java/org/apache/helix/tools/ClusterVerifiers/ClusterLiveNodesVerifier.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNlQwNjowMDozOFrOFyt9Gg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wOVQxNzoyNTo1N1rOFzyK1w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODcyNjA0Mg==", "bodyText": "Same here, shall we replace the existing constructor with the builder constructor?", "url": "https://github.com/apache/helix/pull/867#discussion_r388726042", "createdAt": "2020-03-06T06:00:38Z", "author": {"login": "jiajunwang"}, "path": "helix-core/src/main/java/org/apache/helix/tools/ClusterVerifiers/ClusterLiveNodesVerifier.java", "diffHunk": "@@ -24,18 +24,24 @@\n import java.util.List;\n import java.util.Set;\n \n-import org.apache.helix.zookeeper.api.client.HelixZkClient;\n+import org.apache.helix.zookeeper.api.client.RealmAwareZkClient;\n+\n \n public class ClusterLiveNodesVerifier extends ZkHelixClusterVerifier {\n \n   final Set<String> _expectLiveNodes;\n \n-  public ClusterLiveNodesVerifier(HelixZkClient zkclient, String clusterName,\n+  public ClusterLiveNodesVerifier(RealmAwareZkClient zkclient, String clusterName,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c4d99561c16f4abaf1a7900888c577e0e51252cd"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTg0MzY3MQ==", "bodyText": "Will deprecate.", "url": "https://github.com/apache/helix/pull/867#discussion_r389843671", "createdAt": "2020-03-09T17:25:57Z", "author": {"login": "narendly"}, "path": "helix-core/src/main/java/org/apache/helix/tools/ClusterVerifiers/ClusterLiveNodesVerifier.java", "diffHunk": "@@ -24,18 +24,24 @@\n import java.util.List;\n import java.util.Set;\n \n-import org.apache.helix.zookeeper.api.client.HelixZkClient;\n+import org.apache.helix.zookeeper.api.client.RealmAwareZkClient;\n+\n \n public class ClusterLiveNodesVerifier extends ZkHelixClusterVerifier {\n \n   final Set<String> _expectLiveNodes;\n \n-  public ClusterLiveNodesVerifier(HelixZkClient zkclient, String clusterName,\n+  public ClusterLiveNodesVerifier(RealmAwareZkClient zkclient, String clusterName,", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODcyNjA0Mg=="}, "originalCommit": {"oid": "c4d99561c16f4abaf1a7900888c577e0e51252cd"}, "originalPosition": 13}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQwODQ1NTE2OnYy", "diffSide": "RIGHT", "path": "helix-core/src/main/java/org/apache/helix/tools/ClusterVerifiers/ZkHelixClusterVerifier.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNlQwNjowNDozN1rOFyuAAQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wOVQxNzoyNzo1M1rOFzyP5Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODcyNjc4NQ==", "bodyText": "Question, In which case we need to handle this fallback logic? It is expected in some condition or just for safe?", "url": "https://github.com/apache/helix/pull/867#discussion_r388726785", "createdAt": "2020-03-06T06:04:37Z", "author": {"login": "jiajunwang"}, "path": "helix-core/src/main/java/org/apache/helix/tools/ClusterVerifiers/ZkHelixClusterVerifier.java", "diffHunk": "@@ -104,15 +112,49 @@ public ZkHelixClusterVerifier(String zkAddr, String clusterName) {\n     if (zkAddr == null || clusterName == null) {\n       throw new IllegalArgumentException(\"requires zkAddr|clusterName\");\n     }\n-    _zkClient = DedicatedZkClientFactory.getInstance()\n-        .buildZkClient(new HelixZkClient.ZkConnectionConfig(zkAddr));\n+\n+    RealmAwareZkClient zkClient;\n+    try {\n+      // First, try to create a RealmAwareZkClient that's a DedicatedZkClient\n+      RealmAwareZkClient.RealmAwareZkConnectionConfig.Builder connectionConfigBuilder =\n+          new RealmAwareZkClient.RealmAwareZkConnectionConfig.Builder();\n+      connectionConfigBuilder.setZkRealmShardingKey(\"/\" + clusterName);\n+      connectionConfigBuilder.setRealmMode(RealmAwareZkClient.RealmMode.SINGLE_REALM);\n+      zkClient = DedicatedZkClientFactory.getInstance()\n+          .buildZkClient(connectionConfigBuilder.build(),\n+              new RealmAwareZkClient.RealmAwareZkClientConfig());\n+    } catch (IOException | InvalidRoutingDataException | IllegalStateException e) {\n+      // Fallback option is to create a HelixZkClient that's a DedicatedZkClient", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c4d99561c16f4abaf1a7900888c577e0e51252cd"}, "originalPosition": 65}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTg0NDk2NQ==", "bodyText": "Cases where there is no proper MSDS or routing data available. Then we fall back to the previously-existing behavior.", "url": "https://github.com/apache/helix/pull/867#discussion_r389844965", "createdAt": "2020-03-09T17:27:53Z", "author": {"login": "narendly"}, "path": "helix-core/src/main/java/org/apache/helix/tools/ClusterVerifiers/ZkHelixClusterVerifier.java", "diffHunk": "@@ -104,15 +112,49 @@ public ZkHelixClusterVerifier(String zkAddr, String clusterName) {\n     if (zkAddr == null || clusterName == null) {\n       throw new IllegalArgumentException(\"requires zkAddr|clusterName\");\n     }\n-    _zkClient = DedicatedZkClientFactory.getInstance()\n-        .buildZkClient(new HelixZkClient.ZkConnectionConfig(zkAddr));\n+\n+    RealmAwareZkClient zkClient;\n+    try {\n+      // First, try to create a RealmAwareZkClient that's a DedicatedZkClient\n+      RealmAwareZkClient.RealmAwareZkConnectionConfig.Builder connectionConfigBuilder =\n+          new RealmAwareZkClient.RealmAwareZkConnectionConfig.Builder();\n+      connectionConfigBuilder.setZkRealmShardingKey(\"/\" + clusterName);\n+      connectionConfigBuilder.setRealmMode(RealmAwareZkClient.RealmMode.SINGLE_REALM);\n+      zkClient = DedicatedZkClientFactory.getInstance()\n+          .buildZkClient(connectionConfigBuilder.build(),\n+              new RealmAwareZkClient.RealmAwareZkClientConfig());\n+    } catch (IOException | InvalidRoutingDataException | IllegalStateException e) {\n+      // Fallback option is to create a HelixZkClient that's a DedicatedZkClient", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODcyNjc4NQ=="}, "originalCommit": {"oid": "c4d99561c16f4abaf1a7900888c577e0e51252cd"}, "originalPosition": 65}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQxMDU0Nzk1OnYy", "diffSide": "RIGHT", "path": "helix-core/src/main/java/org/apache/helix/manager/zk/ZkBaseDataAccessor.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNlQxNzo1NDoyMVrOFzB7tg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wOVQxNzoyMjo1NlrOFzyDLw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTA1MzM2Ng==", "bodyText": "Is this necessary to change the deprecated method?", "url": "https://github.com/apache/helix/pull/867#discussion_r389053366", "createdAt": "2020-03-06T17:54:21Z", "author": {"login": "junkaixue"}, "path": "helix-core/src/main/java/org/apache/helix/manager/zk/ZkBaseDataAccessor.java", "diffHunk": "@@ -102,14 +103,14 @@ public AccessResult() {\n \n   private static Logger LOG = LoggerFactory.getLogger(ZkBaseDataAccessor.class);\n \n-  private final HelixZkClient _zkClient;\n-  // true if ZkBaseDataAccessor was instantiated with a HelixZkClient, false otherwise\n+  private final RealmAwareZkClient _zkClient;\n+  // true if ZkBaseDataAccessor was instantiated with a RealmAwareZkClient, false otherwise\n   // This is used for close() to determine how ZkBaseDataAccessor should close the underlying\n   // ZkClient\n   private final boolean _usesExternalZkClient;\n \n   @Deprecated", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c4d99561c16f4abaf1a7900888c577e0e51252cd"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTg0MTcxMQ==", "bodyText": "To minimize the code change in our code, yes.", "url": "https://github.com/apache/helix/pull/867#discussion_r389841711", "createdAt": "2020-03-09T17:22:56Z", "author": {"login": "narendly"}, "path": "helix-core/src/main/java/org/apache/helix/manager/zk/ZkBaseDataAccessor.java", "diffHunk": "@@ -102,14 +103,14 @@ public AccessResult() {\n \n   private static Logger LOG = LoggerFactory.getLogger(ZkBaseDataAccessor.class);\n \n-  private final HelixZkClient _zkClient;\n-  // true if ZkBaseDataAccessor was instantiated with a HelixZkClient, false otherwise\n+  private final RealmAwareZkClient _zkClient;\n+  // true if ZkBaseDataAccessor was instantiated with a RealmAwareZkClient, false otherwise\n   // This is used for close() to determine how ZkBaseDataAccessor should close the underlying\n   // ZkClient\n   private final boolean _usesExternalZkClient;\n \n   @Deprecated", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTA1MzM2Ng=="}, "originalCommit": {"oid": "c4d99561c16f4abaf1a7900888c577e0e51252cd"}, "originalPosition": 20}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQyNDY3ODg3OnYy", "diffSide": "RIGHT", "path": "helix-core/src/main/java/org/apache/helix/tools/ClusterVerifiers/BestPossibleExternalViewVerifier.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMVQyMDoxMjoyMlrOF1Hafw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMlQwMjo1NDo0MlrOF1Ps-Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTI0MDMxOQ==", "bodyText": "Nit: Maybe can we add javadoc for why it is deprecated and what is recommended to use?", "url": "https://github.com/apache/helix/pull/867#discussion_r391240319", "createdAt": "2020-03-11T20:12:22Z", "author": {"login": "huizhilu"}, "path": "helix-core/src/main/java/org/apache/helix/tools/ClusterVerifiers/BestPossibleExternalViewVerifier.java", "diffHunk": "@@ -84,7 +84,8 @@ public BestPossibleExternalViewVerifier(String zkAddr, String clusterName, Set<S\n     _dataProvider = new ResourceControllerDataProvider();\n   }\n \n-  public BestPossibleExternalViewVerifier(HelixZkClient zkClient, String clusterName,\n+  @Deprecated", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "93b474c1dfceff26ebc2c42f82b99ad28375781a"}, "originalPosition": 30}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTM3NjEyMQ==", "bodyText": "Added more javadoc.", "url": "https://github.com/apache/helix/pull/867#discussion_r391376121", "createdAt": "2020-03-12T02:54:42Z", "author": {"login": "narendly"}, "path": "helix-core/src/main/java/org/apache/helix/tools/ClusterVerifiers/BestPossibleExternalViewVerifier.java", "diffHunk": "@@ -84,7 +84,8 @@ public BestPossibleExternalViewVerifier(String zkAddr, String clusterName, Set<S\n     _dataProvider = new ResourceControllerDataProvider();\n   }\n \n-  public BestPossibleExternalViewVerifier(HelixZkClient zkClient, String clusterName,\n+  @Deprecated", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTI0MDMxOQ=="}, "originalCommit": {"oid": "93b474c1dfceff26ebc2c42f82b99ad28375781a"}, "originalPosition": 30}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQyNDY4OTQ4OnYy", "diffSide": "RIGHT", "path": "helix-core/src/main/java/org/apache/helix/tools/ClusterVerifiers/BestPossibleExternalViewVerifier.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMVQyMDoxNDoyM1rOF1Hgxw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMlQwMjo1NTowNVrOF1PtPA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTI0MTkyNw==", "bodyText": "It seems the original constructors don't do deep copy. Is there a reason we do deep copy here? Maybe to prevent it from any concurrent modification exception as seen in prod or tests?", "url": "https://github.com/apache/helix/pull/867#discussion_r391241927", "createdAt": "2020-03-11T20:14:23Z", "author": {"login": "huizhilu"}, "path": "helix-core/src/main/java/org/apache/helix/tools/ClusterVerifiers/BestPossibleExternalViewVerifier.java", "diffHunk": "@@ -94,29 +95,47 @@ public BestPossibleExternalViewVerifier(HelixZkClient zkClient, String clusterNa\n     _dataProvider = new ResourceControllerDataProvider();\n   }\n \n-  public static class Builder {\n-    private String _clusterName;\n+  private BestPossibleExternalViewVerifier(Builder builder) {\n+    super(builder);\n+    // Deep copy data from Builder", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "93b474c1dfceff26ebc2c42f82b99ad28375781a"}, "originalPosition": 43}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTM3NjE4OA==", "bodyText": "This is because users can re-use a builder object to create multiple instances.", "url": "https://github.com/apache/helix/pull/867#discussion_r391376188", "createdAt": "2020-03-12T02:55:05Z", "author": {"login": "narendly"}, "path": "helix-core/src/main/java/org/apache/helix/tools/ClusterVerifiers/BestPossibleExternalViewVerifier.java", "diffHunk": "@@ -94,29 +95,47 @@ public BestPossibleExternalViewVerifier(HelixZkClient zkClient, String clusterNa\n     _dataProvider = new ResourceControllerDataProvider();\n   }\n \n-  public static class Builder {\n-    private String _clusterName;\n+  private BestPossibleExternalViewVerifier(Builder builder) {\n+    super(builder);\n+    // Deep copy data from Builder", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTI0MTkyNw=="}, "originalCommit": {"oid": "93b474c1dfceff26ebc2c42f82b99ad28375781a"}, "originalPosition": 43}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1352, "cost": 1, "resetAt": "2021-11-11T21:28:48Z"}}}