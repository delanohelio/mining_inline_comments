{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY0MjQ0MTU3", "number": 1225, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQyMjo1MzoxNVrOEWBKNg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQyMjo1MzoxNVrOEWBKNg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkxNTIzMTI2OnYy", "diffSide": "RIGHT", "path": "helix-core/src/main/java/org/apache/helix/controller/stages/CustomizedViewAggregationStage.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQyMjo1MzoxNVrOG9Gy8w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wN1QwMDoxMTo1OVrOG9INyw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjcyNzY2Nw==", "bodyText": "I'm not sure what HelixException you expect from this method? I think you could move this try and catch to the end of this method, since I could imagine some exceptions being thrown when updating to zk? computeCustomizedStateView is local computation so should be fine.", "url": "https://github.com/apache/helix/pull/1225#discussion_r466727667", "createdAt": "2020-08-06T22:53:15Z", "author": {"login": "mgao0"}, "path": "helix-core/src/main/java/org/apache/helix/controller/stages/CustomizedViewAggregationStage.java", "diffHunk": "@@ -98,34 +98,34 @@ public void execute(final ClusterEvent event) throws Exception {\n         try {\n           computeCustomizedStateView(resource, stateType, customizedStateOutput, curCustomizedViews,\n               updatedCustomizedViews);\n-\n-          List<PropertyKey> keys = new ArrayList<>();\n-          for (Iterator<CustomizedView> it = updatedCustomizedViews.iterator(); it.hasNext(); ) {\n-            CustomizedView view = it.next();\n-            String resourceName = view.getResourceName();\n-            keys.add(keyBuilder.customizedView(stateType, resourceName));\n-          }\n-          // add/update customized-views from zk and cache\n-          if (updatedCustomizedViews.size() > 0) {\n-            dataAccessor.setChildren(keys, updatedCustomizedViews);\n-            cache.updateCustomizedViews(stateType, updatedCustomizedViews);\n-          }\n-\n-          // remove stale customized views from zk and cache\n-          List<String> customizedViewToRemove = new ArrayList<>();\n-          for (String resourceName : curCustomizedViews.keySet()) {\n-            if (!resourceMap.keySet().contains(resourceName)) {\n-              LogUtil.logInfo(LOG, _eventId, \"Remove customizedView for resource: \" + resourceName);\n-              dataAccessor.removeProperty(keyBuilder.customizedView(stateType, resourceName));\n-              customizedViewToRemove.add(resourceName);\n-            }\n-          }\n-          cache.removeCustomizedViews(stateType, customizedViewToRemove);\n         } catch (HelixException ex) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f94ecbfe2415071e072b088ecadee7964227ee66"}, "originalPosition": 27}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Njc1MDkyMw==", "bodyText": "The purpose is to keep the loop continue without stopping at a possible exception thrown by a resource. For the zk exceptions, we may not want to hide them. We will let them thrown out and stop the pipeline if necessary.", "url": "https://github.com/apache/helix/pull/1225#discussion_r466750923", "createdAt": "2020-08-07T00:11:59Z", "author": {"login": "zhangmeng916"}, "path": "helix-core/src/main/java/org/apache/helix/controller/stages/CustomizedViewAggregationStage.java", "diffHunk": "@@ -98,34 +98,34 @@ public void execute(final ClusterEvent event) throws Exception {\n         try {\n           computeCustomizedStateView(resource, stateType, customizedStateOutput, curCustomizedViews,\n               updatedCustomizedViews);\n-\n-          List<PropertyKey> keys = new ArrayList<>();\n-          for (Iterator<CustomizedView> it = updatedCustomizedViews.iterator(); it.hasNext(); ) {\n-            CustomizedView view = it.next();\n-            String resourceName = view.getResourceName();\n-            keys.add(keyBuilder.customizedView(stateType, resourceName));\n-          }\n-          // add/update customized-views from zk and cache\n-          if (updatedCustomizedViews.size() > 0) {\n-            dataAccessor.setChildren(keys, updatedCustomizedViews);\n-            cache.updateCustomizedViews(stateType, updatedCustomizedViews);\n-          }\n-\n-          // remove stale customized views from zk and cache\n-          List<String> customizedViewToRemove = new ArrayList<>();\n-          for (String resourceName : curCustomizedViews.keySet()) {\n-            if (!resourceMap.keySet().contains(resourceName)) {\n-              LogUtil.logInfo(LOG, _eventId, \"Remove customizedView for resource: \" + resourceName);\n-              dataAccessor.removeProperty(keyBuilder.customizedView(stateType, resourceName));\n-              customizedViewToRemove.add(resourceName);\n-            }\n-          }\n-          cache.removeCustomizedViews(stateType, customizedViewToRemove);\n         } catch (HelixException ex) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjcyNzY2Nw=="}, "originalCommit": {"oid": "f94ecbfe2415071e072b088ecadee7964227ee66"}, "originalPosition": 27}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 866, "cost": 1, "resetAt": "2021-11-11T21:28:48Z"}}}