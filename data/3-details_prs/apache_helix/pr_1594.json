{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTQwODUxMTYx", "number": 1594, "title": "Fix builds failing on some non-Oracle JDKs", "bodyText": "Issues\n\n My PR addresses the following Helix issues and references them in the PR description:\n\nFixes #1576\nDescription\n\n Here are some details about my PR, including screenshots of any UI changes:\n\nThe ThreadCountBasedTaskAssigner class accidentally included an exception from the sun.reflect.generics.reflectiveObjects package which is not available in some JDKs.  This PR replaces it with a standard unchecked exception java.lang.UnsupportedOperationException.\nSee https://www.oracle.com/java/technologies/faq-sun-packages.html\nTests\n\n The following tests are written for this issue:\n\nn/a\n\n The following is the result of the \"mvn test\" command on the appropriate module:\n\n[INFO]\n[INFO] Results:\n[INFO]\n[ERROR] Failures:\n[ERROR]   TestCleanupExternalView.test:118 external-view for TestDB0 should be removed, but was: ZnRecord=TestDB0, {BUCKET_SIZE=0, IDEAL_STATE_MODE=AUTO, NUM_PARTITIONS=2, REBALANCE_MODE=SEMI_AUTO, REBALANCE_STRATEGY=DEFAULT, REPLICAS=2, STATE_MODEL_DEF_REF=MasterSlave, STATE_MODEL_FACTORY_NAME=DEFAULT}{TestDB0_0={localhost_12918=SLAVE, localhost_12919=MASTER}, TestDB0_1={localhost_12918=MASTER, localhost_12919=SLAVE}}{}, Stat=Stat {_version=4, _creationTime=1608081283398, _modifiedTime=1608081283962, _ephemeralOwner=0} expected:<true> but was:<false>\n[ERROR]   TestEnableCompression.testEnableCompressionResource ? ThreadTimeout Method org...\n[ERROR]   TestDelayedWagedRebalanceWithDisabledInstance.testPartitionMovementAfterDelayTime:87->TestDelayedAutoRebalanceWithDisabledInstance.testPartitionMovementAfterDelayTime:204->ZkTestBase.validateMinActiveAndTopStateReplica:535 Test-DB-createTestDBs0_0 has less active replica 2 then required 3 expected:<true> but was:<false>\n[ERROR]   TestJobTimeoutTaskNotStarted.testTaskNotStarted:156 ? Helix Workflow timeoutWo...\n[ERROR]   TestTaskNumAttempts.testTaskNumAttemptsWithDelay:76 expected:<3> but was:<2>\n[ERROR]   TestWorkflowTermination.testWorkflowRunningTimeout:133->verifyWorkflowCleanup:268 expected:<true> but was:<false>\n[INFO]\n[ERROR] Tests run: 1253, Failures: 6, Errors: 0, Skipped: 0\n[INFO]\n[INFO] ------------------------------------------------------------------------\n[INFO] BUILD FAILURE\n[INFO] ------------------------------------------------------------------------\n[INFO] Total time:  01:48 h\n[INFO] Finished at: 2020-12-16T02:20:54Z\n[INFO] ------------------------------------------------------------------------\n\nI'm guessing these are some of the flaky tests alluded to on https://github.com/apache/helix/wiki/Pull-Request-Testing.  When run individually they seem ok:\n[INFO] Tests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 17.86 s - in org.apache.helix.integration.TestCleanupExternalView\n...\n[INFO] Tests run: 8, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 82.369 s - in org.apache.helix.integration.rebalancer.WagedRebalancer.TestDelayedWagedRebalanceWithDisabledInstance\n...\n[INFO] Tests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 14.091 s - in org.apache.helix.integration.task.TestJobTimeoutTaskNotStarted\n...\n[INFO] Tests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 28.194 s - in org.apache.helix.integration.task.TestTaskNumAttempts\n...\n[INFO] Tests run: 5, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 39.655 s - in org.apache.helix.integration.task.TestWorkflowTermination\n\nExcept this one which I ran about 5 times, but never got to work (seems unrelated to my change though):\n[ERROR] Tests run: 1, Failures: 1, Errors: 0, Skipped: 0, Time elapsed: 107.496 s <<< FAILURE! - in org.apache.helix.integration.TestEnableCompression\n[ERROR] testEnableCompressionResource(org.apache.helix.integration.TestEnableCompression)  Time elapsed: 99.92 s  <<< FAILURE!\norg.testng.internal.thread.ThreadTimeoutException: Method org.testng.internal.TestNGMethod.testEnableCompressionResource() didn't finish within the time-out 100000\n\tat org.apache.helix.integration.TestEnableCompression.testEnableCompressionResource(TestEnableCompression.java:122)\n\nDocumentation (Optional)\n\n In case of new functionality, my PR adds documentation in the following wiki page:\n\nn/a\nCommits\n\n My commits all reference appropriate Apache Helix GitHub issues in their subject lines. In addition, my commits follow the guidelines from \"How to write a good git commit message\":\n\nSubject is separated from body by a blank line\nSubject is limited to 50 characters (not including Jira issue reference)\nSubject does not end with a period\nSubject uses the imperative mood (\"add\", not \"adding\")\nBody wraps at 72 characters\nBody explains \"what\" and \"why\", not \"how\"\n\n\n\nCode Quality\n\n My diff has been formatted using helix-style.xml\n(helix-style-intellij.xml if IntelliJ IDE is used)", "createdAt": "2020-12-16T02:53:40Z", "url": "https://github.com/apache/helix/pull/1594", "merged": true, "mergeCommit": {"oid": "c6c61f1803d4bd377c2d8deb65464b232d753bb0"}, "closed": true, "closedAt": "2020-12-19T00:39:35Z", "author": {"login": "brentwritescode"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdmxrc7ABqjQxMjA2ODU2OTU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdm54O3AFqTU1NDIyOTUxNg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "5750cc28c598a2bba989a4e2ac06b6984145d119", "author": {"user": {"login": "brentwritescode", "name": "Brent"}}, "url": "https://github.com/apache/helix/commit/5750cc28c598a2bba989a4e2ac06b6984145d119", "committedDate": "2020-12-16T00:52:40Z", "message": "Fix builds failing on some non-Oracle JDKs\n\nThe ThreadCountBasedTaskAssigner class accidentally included an\nexception from the sun.reflect.generics.reflectiveObjects package which\nis not available in some JDKs. Replacing it with a standard unchecked\nexception java.lang.UnsupportedOperationException."}, "afterCommit": {"oid": "c88292b169d744b8aa352ae46bd4ac99f789e1f8", "author": {"user": {"login": "brentwritescode", "name": "Brent"}}, "url": "https://github.com/apache/helix/commit/c88292b169d744b8aa352ae46bd4ac99f789e1f8", "committedDate": "2020-12-16T16:36:59Z", "message": "Fix builds failing on some non-Oracle JDKs\n\nThe ThreadCountBasedTaskAssigner class accidentally included an\nexception from the sun.reflect.generics.reflectiveObjects package which\nis not available in some JDKs. Replacing it with a standard unchecked\nexception java.lang.UnsupportedOperationException."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU0MDcwMDgz", "url": "https://github.com/apache/helix/pull/1594#pullrequestreview-554070083", "createdAt": "2020-12-16T20:46:19Z", "commit": {"oid": "c88292b169d744b8aa352ae46bd4ac99f789e1f8"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNlQyMDo0NjoxOVrOIHYbtA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNlQyMDo0NjoxOVrOIHYbtA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDYxMTI1Mg==", "bodyText": "Could you please keep the error message here?", "url": "https://github.com/apache/helix/pull/1594#discussion_r544611252", "createdAt": "2020-12-16T20:46:19Z", "author": {"login": "jiajunwang"}, "path": "helix-rest/src/main/java/org/apache/helix/rest/server/resources/helix/InstancesAccessor.java", "diffHunk": "@@ -263,7 +262,7 @@ private Response batchGetStoppableInstances(String clusterId, JsonNode node, boo\n         break;\n       case instance_based:\n       default:\n-        throw new NotImplementedException(\"instance_based selection is not supported yet!\");\n+        throw new UnsupportedOperationException();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c88292b169d744b8aa352ae46bd4ac99f789e1f8"}, "originalPosition": 13}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1f80ec716c48fe46d8764d133d4fc6c2542a3f57", "author": {"user": {"login": "brentwritescode", "name": "Brent"}}, "url": "https://github.com/apache/helix/commit/1f80ec716c48fe46d8764d133d4fc6c2542a3f57", "committedDate": "2020-12-16T21:22:00Z", "message": "Fix builds failing on some non-Oracle JDKs\n\nThe ThreadCountBasedTaskAssigner class accidentally included an\nexception from the sun.reflect.generics.reflectiveObjects package which\nis not available in some JDKs. Replacing it with a standard unchecked\nexception java.lang.UnsupportedOperationException."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c88292b169d744b8aa352ae46bd4ac99f789e1f8", "author": {"user": {"login": "brentwritescode", "name": "Brent"}}, "url": "https://github.com/apache/helix/commit/c88292b169d744b8aa352ae46bd4ac99f789e1f8", "committedDate": "2020-12-16T16:36:59Z", "message": "Fix builds failing on some non-Oracle JDKs\n\nThe ThreadCountBasedTaskAssigner class accidentally included an\nexception from the sun.reflect.generics.reflectiveObjects package which\nis not available in some JDKs. Replacing it with a standard unchecked\nexception java.lang.UnsupportedOperationException."}, "afterCommit": {"oid": "1f80ec716c48fe46d8764d133d4fc6c2542a3f57", "author": {"user": {"login": "brentwritescode", "name": "Brent"}}, "url": "https://github.com/apache/helix/commit/1f80ec716c48fe46d8764d133d4fc6c2542a3f57", "committedDate": "2020-12-16T21:22:00Z", "message": "Fix builds failing on some non-Oracle JDKs\n\nThe ThreadCountBasedTaskAssigner class accidentally included an\nexception from the sun.reflect.generics.reflectiveObjects package which\nis not available in some JDKs. Replacing it with a standard unchecked\nexception java.lang.UnsupportedOperationException."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU0MjI5NTE2", "url": "https://github.com/apache/helix/pull/1594#pullrequestreview-554229516", "createdAt": "2020-12-17T02:12:22Z", "commit": {"oid": "1f80ec716c48fe46d8764d133d4fc6c2542a3f57"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4178, "cost": 1, "resetAt": "2021-10-29T19:57:52Z"}}}