{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY5ODY5MTUx", "number": 717, "title": "Upgrade AbstractTestClass with multi-ZK support in helix-rest", "bodyText": "Issues\n\n My PR addresses the following Helix issues and references them in the PR description:\n\nResolves #711\nDescription\n\n Here are some details about my PR, including screenshots of any UI changes:\n\nPrior to instrumenting Helix APIs and components so that they would be aware of multiple ZKs for horizontal scalability, we need to have a way to run all integration tests involving ZooKeeper in different environments: one with a single ZK and another with multiple ZKs.\nChangelist:\n\nImplement the logic in AbstractTestClass so that in conjunction with maven-surefire-plugin configs, there will be two executions of the test suite\nRemove system property variable from default-test since it's unnecessary\n\nTests\n\n The following is the result of the \"mvn test\" command on the appropriate module:\n\nhelix-rest:\n[INFO]\n[INFO] Results:\n[INFO]\n[INFO] Tests run: 102, Failures: 0, Errors: 0, Skipped: 0\n[INFO]\n[INFO] ------------------------------------------------------------------------\n[INFO] BUILD SUCCESS\nCommits\n\n My commits all reference appropriate Apache Helix GitHub issues in their subject lines, and I have squashed multiple commits if they address the same issue. In addition, my commits follow the guidelines from \"How to write a good git commit message\":\n\nSubject is separated from body by a blank line\nSubject is limited to 50 characters (not including Jira issue reference)\nSubject does not end with a period\nSubject uses the imperative mood (\"add\", not \"adding\")\nBody wraps at 72 characters\nBody explains \"what\" and \"why\", not \"how\"\n\n\n\nCode Quality\n\n My diff has been formatted using helix-style.xml", "createdAt": "2020-02-01T07:37:31Z", "url": "https://github.com/apache/helix/pull/717", "merged": true, "mergeCommit": {"oid": "2bd9a34c8db6dbcf2a5a62f78cfa25e9696730cf"}, "closed": true, "closedAt": "2020-02-04T02:05:50Z", "author": {"login": "narendly"}, "timelineItems": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb_-sCDAH2gAyMzY5ODY5MTUxOmY2NjRiZGMyZmNkNDU5NGFjZGY3YzMzOTJlOGJhZDBhYzJjNGVhNzI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcA3cYwAFqTM1MjY3ODM3Nw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "f664bdc2fcd4594acdf7c3392e8bad0ac2c4ea72", "author": {"user": {"login": "narendly", "name": "Hunter Lee"}}, "url": "https://github.com/apache/helix/commit/f664bdc2fcd4594acdf7c3392e8bad0ac2c4ea72", "committedDate": "2020-02-01T07:34:22Z", "message": "Upgrade ZkTestBase with multi-ZK support in helix-rest"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUyNjU1MzA5", "url": "https://github.com/apache/helix/pull/717#pullrequestreview-352655309", "createdAt": "2020-02-04T00:25:26Z", "commit": {"oid": "f664bdc2fcd4594acdf7c3392e8bad0ac2c4ea72"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNFQwMDoyNjo1OVrOFlEmgQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNFQwMDoyNjo1OVrOFlEmgQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDQxNzAyNQ==", "bodyText": "Question: In the test suit, where do we set MULTI_ZK_PROPERTY_KEY and NUM_ZK_PROPERTY_KEY?", "url": "https://github.com/apache/helix/pull/717#discussion_r374417025", "createdAt": "2020-02-04T00:26:59Z", "author": {"login": "alirezazamani"}, "path": "helix-rest/src/test/java/org/apache/helix/rest/server/AbstractTestClass.java", "diffHunk": "@@ -149,20 +155,43 @@ public void clearupLogs() {\n   @Override\n   protected Application configure() {\n     // start zk\n+    _zkServerMap = new HashMap<>();\n     try {\n       if (_zkServer == null) {\n         _zkServer = TestHelper.startZkServer(ZK_ADDR);\n-        Assert.assertTrue(_zkServer != null);\n+        Assert.assertNotNull(_zkServer);\n+        _zkServerMap.put(ZK_ADDR, _zkServer);\n         ZKClientPool.reset();\n       }\n \n       if (_zkServerTestNS == null) {\n         _zkServerTestNS = TestHelper.startZkServer(_zkAddrTestNS);\n-        Assert.assertTrue(_zkServerTestNS != null);\n+        Assert.assertNotNull(_zkServerTestNS);\n+        _zkServerMap.put(_zkAddrTestNS, _zkServerTestNS);\n         ZKClientPool.reset();\n       }\n     } catch (Exception e) {\n-      Assert.assertTrue(false, String.format(\"Failed to start ZK server: %s\", e.toString()));\n+      Assert.fail(String.format(\"Failed to start ZK server: %s\", e.toString()));\n+    }\n+\n+    // Start additional ZKs in a multi-ZK setup\n+    String multiZkConfig = System.getProperty(MULTI_ZK_PROPERTY_KEY);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f664bdc2fcd4594acdf7c3392e8bad0ac2c4ea72"}, "originalPosition": 40}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUyNjc4Mzc3", "url": "https://github.com/apache/helix/pull/717#pullrequestreview-352678377", "createdAt": "2020-02-04T01:41:52Z", "commit": {"oid": "f664bdc2fcd4594acdf7c3392e8bad0ac2c4ea72"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4909, "cost": 1, "resetAt": "2021-10-29T19:57:52Z"}}}