{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDcwNDQ4MjE3", "number": 1293, "title": "Replace org.codehaus.jackson with FasterXML.jackson", "bodyText": "Issues\n\n My PR addresses the following Helix issues and references them in the PR description:\nResolve  #401\nFix #1291 (Step-1)\n\nDescription\n\n Here are some details about my PR, including screenshots of any UI changes:\nThe controller switch time for large scale cluster is slow. It takes around ~60s for a standby controller to obtain leadership of a cluster with ~50 participants and ~700 resources. The service's availability is impacted under this period of time.\nIn our performance profile, it shows that org.apache.helix.zookeeper.datamodel.serializer.ZNRecordSerializer.deserialize took ~60% of the time for org.apache.helix.manager.zk.DistributedLeaderElection.onControllerChange. Replace org.codehaus.jackson with FasterXML.jackson will reduce 60% of the total time spend.\n\nTests\n\n The following tests are written for this issue:\n\nNA\n\n The following is the result of the \"mvn test\" command on the appropriate module:\n\n[ERROR] Failures:                                                                                                                                                                 \n[ERROR]   TestCustomizedViewAggregation.testCustomizedViewAggregation:413->validateAggregationSnapshot:257 expected:<true> but was:<false>                                        \n[INFO]                                                                                                                                                                            \n[ERROR] Tests run: 1173, Failures: 1, Errors: 0, Skipped: 1                                                                                                                       \n[INFO]  \n\n\n[INFO] Tests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 6.789 s - in org.apache.helix.integration.TestCustomizedViewAggregation\n\nDocumentation (Optional)\n\nIn case of new functionality, my PR adds documentation in the following wiki page:\n\n(Link the GitHub wiki you added)\nCommits\n\nMy commits all reference appropriate Apache Helix GitHub issues in their subject lines. In addition, my commits follow the guidelines from \"How to write a good git commit message\":\n\nSubject is separated from body by a blank line\nSubject is limited to 50 characters (not including Jira issue reference)\nSubject does not end with a period\nSubject uses the imperative mood (\"add\", not \"adding\")\nBody wraps at 72 characters\nBody explains \"what\" and \"why\", not \"how\"\n\n\n\nCode Quality\n\nMy diff has been formatted using helix-style.xml\n(helix-style-intellij.xml if IntelliJ IDE is used)", "createdAt": "2020-08-19T20:49:15Z", "url": "https://github.com/apache/helix/pull/1293", "merged": true, "mergeCommit": {"oid": "cd552d9f122dbe3fa4b3648d38b2fc615f663b84"}, "closed": true, "closedAt": "2020-08-21T02:06:10Z", "author": {"login": "xyuanlu"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdAjNARgFqTQ3MDk5NjY1Nw==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdA7DrTgFqTQ3MjA5NjYyMg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDcwOTk2NjU3", "url": "https://github.com/apache/helix/pull/1293#pullrequestreview-470996657", "createdAt": "2020-08-19T22:03:08Z", "commit": {"oid": "48312afff7dba0628276b1dcbc298952a9a0c996"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOVQyMjowMzowOFrOHDcGvA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOVQyMjoxNzo1NVrOHDc0gg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzM2ODI1Mg==", "bodyText": "Just curious, what's the \"master(*)\" here?", "url": "https://github.com/apache/helix/pull/1293#discussion_r473368252", "createdAt": "2020-08-19T22:03:08Z", "author": {"login": "jiajunwang"}, "path": "helix-core/helix-core-1.0.2-SNAPSHOT.ivy", "diffHunk": "@@ -53,8 +53,8 @@ under the License.\n         <artifact name=\"slf4j-log4j12\" ext=\"jar\"/>\n     </dependency>\n     <dependency org=\"org.apache.zookeeper\" name=\"zookeeper\" rev=\"3.4.13\" conf=\"compile->compile(default);runtime->runtime(default);default->default\"/>\n-    <dependency org=\"org.codehaus.jackson\" name=\"jackson-core-asl\" rev=\"1.8.5\" conf=\"compile->compile(default);runtime->runtime(default);default->default\"/>\n-    <dependency org=\"org.codehaus.jackson\" name=\"jackson-mapper-asl\" rev=\"1.8.5\" conf=\"compile->compile(default);runtime->runtime(default);default->default\"/>\n+\t\t<dependency org=\"com.fasterxml.jackson.core\" name=\"jackson-databind\" rev=\"2.11.0\" force=\"true\" conf=\"compile->compile(*),master(*);runtime->runtime(*)\"/>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "48312afff7dba0628276b1dcbc298952a9a0c996"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzM3OTI3Ng==", "bodyText": "nit, it seems to need re-ordering.", "url": "https://github.com/apache/helix/pull/1293#discussion_r473379276", "createdAt": "2020-08-19T22:17:00Z", "author": {"login": "jiajunwang"}, "path": "zookeeper-api/src/main/java/org/apache/helix/zookeeper/datamodel/serializer/JacksonPayloadSerializer.java", "diffHunk": "@@ -22,10 +22,13 @@\n import java.io.ByteArrayInputStream;\n import java.io.StringWriter;\n \n+import com.fasterxml.jackson.databind.DeserializationFeature;\n+import com.fasterxml.jackson.databind.MapperFeature;\n+import com.fasterxml.jackson.databind.SerializationFeature;\n import org.apache.helix.zookeeper.exception.ZkClientException;\n-import org.codehaus.jackson.map.DeserializationConfig;\n-import org.codehaus.jackson.map.ObjectMapper;\n-import org.codehaus.jackson.map.SerializationConfig;\n+import com.fasterxml.jackson.databind.DeserializationConfig;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "48312afff7dba0628276b1dcbc298952a9a0c996"}, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzM3OTk3MA==", "bodyText": "I guess you have done so. Just in case, please search all the ObjectMapper objects to ensure all of them are static.", "url": "https://github.com/apache/helix/pull/1293#discussion_r473379970", "createdAt": "2020-08-19T22:17:55Z", "author": {"login": "jiajunwang"}, "path": "zookeeper-api/src/main/java/org/apache/helix/zookeeper/datamodel/serializer/ZNRecordSerializer.java", "diffHunk": "@@ -24,20 +24,22 @@\n import java.util.List;\n import java.util.Map;\n \n+import com.fasterxml.jackson.databind.DeserializationFeature;\n+import com.fasterxml.jackson.databind.MapperFeature;\n+import com.fasterxml.jackson.databind.ObjectMapper;\n+import com.fasterxml.jackson.databind.SerializationFeature;\n import org.apache.helix.zookeeper.datamodel.ZNRecord;\n import org.apache.helix.zookeeper.util.GZipCompressionUtil;\n import org.apache.helix.zookeeper.util.ZNRecordUtil;\n import org.apache.helix.zookeeper.zkclient.exception.ZkMarshallingError;\n import org.apache.helix.zookeeper.zkclient.serialize.ZkSerializer;\n-import org.codehaus.jackson.map.DeserializationConfig;\n-import org.codehaus.jackson.map.ObjectMapper;\n-import org.codehaus.jackson.map.SerializationConfig;\n import org.slf4j.Logger;\n import org.slf4j.LoggerFactory;\n \n \n public class ZNRecordSerializer implements ZkSerializer {\n   private static Logger LOG = LoggerFactory.getLogger(ZNRecordSerializer.class);\n+  private static ObjectMapper mapper = new ObjectMapper();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "48312afff7dba0628276b1dcbc298952a9a0c996"}, "originalPosition": 22}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "eeed700bebcfb1d8f277da3b8e1669fdc9ac483b", "author": {"user": {"login": "xyuanlu", "name": null}}, "url": "https://github.com/apache/helix/commit/eeed700bebcfb1d8f277da3b8e1669fdc9ac483b", "committedDate": "2020-08-19T22:29:11Z", "message": "address comments"}, "afterCommit": {"oid": "12b89dd52170eed4e61bf9f9ce72c4d3bd06f421", "author": {"user": {"login": "xyuanlu", "name": null}}, "url": "https://github.com/apache/helix/commit/12b89dd52170eed4e61bf9f9ce72c4d3bd06f421", "committedDate": "2020-08-19T22:52:35Z", "message": "address comments"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDcyMDUxOTA4", "url": "https://github.com/apache/helix/pull/1293#pullrequestreview-472051908", "createdAt": "2020-08-20T23:33:37Z", "commit": {"oid": "12b89dd52170eed4e61bf9f9ce72c4d3bd06f421"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "aebfb827766685ece169463329d4843bc2943b04", "author": {"user": {"login": "xyuanlu", "name": null}}, "url": "https://github.com/apache/helix/commit/aebfb827766685ece169463329d4843bc2943b04", "committedDate": "2020-08-21T01:59:14Z", "message": "Replace org.codehaus.jackson with FasterXML/jackson"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "677897d04154b54ef3d163b8cb822c5179fc8f2b", "author": {"user": {"login": "xyuanlu", "name": null}}, "url": "https://github.com/apache/helix/commit/677897d04154b54ef3d163b8cb822c5179fc8f2b", "committedDate": "2020-08-21T01:59:14Z", "message": "Edit pom and ivy files"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ad80754634fe5ea9aee9d8a9a131246a7251a6ef", "author": {"user": {"login": "xyuanlu", "name": null}}, "url": "https://github.com/apache/helix/commit/ad80754634fe5ea9aee9d8a9a131246a7251a6ef", "committedDate": "2020-08-21T01:59:14Z", "message": "sort import"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d09d855d36740c7d360374ddf3be4fb72ea55ff1", "author": {"user": {"login": "xyuanlu", "name": null}}, "url": "https://github.com/apache/helix/commit/d09d855d36740c7d360374ddf3be4fb72ea55ff1", "committedDate": "2020-08-21T01:59:14Z", "message": "address comments"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "12b89dd52170eed4e61bf9f9ce72c4d3bd06f421", "author": {"user": {"login": "xyuanlu", "name": null}}, "url": "https://github.com/apache/helix/commit/12b89dd52170eed4e61bf9f9ce72c4d3bd06f421", "committedDate": "2020-08-19T22:52:35Z", "message": "address comments"}, "afterCommit": {"oid": "d09d855d36740c7d360374ddf3be4fb72ea55ff1", "author": {"user": {"login": "xyuanlu", "name": null}}, "url": "https://github.com/apache/helix/commit/d09d855d36740c7d360374ddf3be4fb72ea55ff1", "committedDate": "2020-08-21T01:59:14Z", "message": "address comments"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDcyMDk2NjIy", "url": "https://github.com/apache/helix/pull/1293#pullrequestreview-472096622", "createdAt": "2020-08-21T02:05:39Z", "commit": {"oid": "d09d855d36740c7d360374ddf3be4fb72ea55ff1"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4231, "cost": 1, "resetAt": "2021-10-29T19:57:52Z"}}}