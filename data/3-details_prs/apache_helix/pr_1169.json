{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDU2MDM0MjA1", "number": 1169, "title": "Dynamically Load Tasks in Task Framework", "bodyText": "Issues\n\n My PR addresses the following Helix issues and references them in the PR description:\n\nFixes #1168\nDescription\n\n Here are some details about my PR, including screenshots of any UI changes:\n\nIn this PR, loadNewTask() method is added to TaskStateModel to dynamically load tasks that are not already defined in task factory registry. This prevents the need to implement task-specific Participants and thus, enables numerous use cases with minimal extra coding effort beyond implementing the task logic itself.\nTests\n\n The following tests are written for this issue:\n\nTestDynamicTaskLoading\n\n The following is the result of the \"mvn test\" command on the appropriate module:\n\n[INFO] Results:\n[INFO] \n[ERROR] Failures: \n[ERROR]   TestEnableCompression.testEnableCompressionResource:117 expected:<true> but was:<false>\n[ERROR]   TestZkHelixPropertyStore.testSet:123 1000 Gets should be finished within 200ms, but was 486 ms expected:<true> but was:<false>\n[ERROR]   TestClusterStateVerifier.afterMethod:98 \u00bb IllegalState ZkClient already closed...\n[ERROR]   TestClusterStateVerifier.testResourceSubset:115 \u00bb Helix Failed to create pause...\n[ERROR]   TestHelixAdminCli.testDeactivateCluster:604 \u00bb Helix There are still LEADER in ...\n[INFO] \n[ERROR] Tests run: 1161, Failures: 5, Errors: 0, Skipped: 1\n[INFO] \n[INFO] ------------------------------------------------------------------------\n[INFO] BUILD FAILURE\n[INFO] ------------------------------------------------------------------------\n[INFO] Total time:  01:12 h\n[INFO] Finished at: 2020-08-12T16:49:21-07:00\n[INFO] ------------------------------------------------------------------------\n\nRerun:\n[INFO] Tests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 31.465 s - in org.apache.helix.integration.TestEnableCompression\n[INFO] \n[INFO] Results:\n[INFO] \n[INFO] Tests run: 1, Failures: 0, Errors: 0, Skipped: 0\n[INFO] \n[INFO] ------------------------------------------------------------------------\n[INFO] BUILD SUCCESS\n[INFO] ------------------------------------------------------------------------\n[INFO] Total time:  36.538 s\n[INFO] Finished at: 2020-08-12T16:56:54-07:00\n[INFO] ------------------------------------------------------------------------\n\n[INFO] Tests run: 6, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 14.818 s - in org.apache.helix.store.zk.TestZkHelixPropertyStore\n[INFO] \n[INFO] Results:\n[INFO] \n[INFO] Tests run: 6, Failures: 0, Errors: 0, Skipped: 0\n[INFO] \n[INFO] ------------------------------------------------------------------------\n[INFO] BUILD SUCCESS\n[INFO] ------------------------------------------------------------------------\n[INFO] Total time:  19.823 s\n[INFO] Finished at: 2020-08-12T16:58:57-07:00\n[INFO] ------------------------------------------------------------------------\n\n[INFO] Tests run: 2, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 9.768 s - in org.apache.helix.tools.TestClusterStateVerifier\n[INFO] \n[INFO] Results:\n[INFO] \n[INFO] Tests run: 2, Failures: 0, Errors: 0, Skipped: 0\n[INFO] \n[INFO] ------------------------------------------------------------------------\n[INFO] BUILD SUCCESS\n[INFO] ------------------------------------------------------------------------\n[INFO] Total time:  15.102 s\n[INFO] Finished at: 2020-08-12T17:00:27-07:00\n[INFO] ------------------------------------------------------------------------\n\n[INFO] Tests run: 10, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 30.482 s - in org.apache.helix.tools.TestHelixAdminCli\n[INFO] \n[INFO] Results:\n[INFO] \n[INFO] Tests run: 10, Failures: 0, Errors: 0, Skipped: 0\n[INFO] \n[INFO] ------------------------------------------------------------------------\n[INFO] BUILD SUCCESS\n[INFO] ------------------------------------------------------------------------\n[INFO] Total time:  35.727 s\n[INFO] Finished at: 2020-08-12T17:04:04-07:00\n[INFO] ------------------------------------------------------------------------\n\nCommits\n\n My commits all reference appropriate Apache Helix GitHub issues in their subject lines. In addition, my commits follow the guidelines from \"How to write a good git commit message\":\n\nSubject is separated from body by a blank line\nSubject is limited to 50 characters (not including Jira issue reference)\nSubject does not end with a period\nSubject uses the imperative mood (\"add\", not \"adding\")\nBody wraps at 72 characters\nBody explains \"what\" and \"why\", not \"how\"\n\n\n\nCode Quality\n\n My diff has been formatted using helix-style.xml\n(helix-style-intellij.xml if IntelliJ IDE is used)", "createdAt": "2020-07-24T01:52:48Z", "url": "https://github.com/apache/helix/pull/1169", "merged": true, "mergeCommit": {"oid": "e8b29387146a6ce6951b331735bd4ef53ca8a531"}, "closed": true, "closedAt": "2020-08-14T18:48:31Z", "author": {"login": "rabashizade"}, "timelineItems": {"totalCount": 63, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc4ImtpAFqTQ1NTExMDkwNg==", "endCursor": "Y3Vyc29yOnYyOpPPAAABc-5AgsAFqTQ2Nzc5NjQ3NA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU1MTEwOTA2", "url": "https://github.com/apache/helix/pull/1169#pullrequestreview-455110906", "createdAt": "2020-07-24T18:47:21Z", "commit": {"oid": "7d076de23fbff1cf93b7ebf44715b71f0f1fe94a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yNFQxODo0NzoyMVrOG26H6g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yNFQxODo0NzoyMVrOG26H6g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDIyODU4Ng==", "bodyText": "If this path doesn't exist, does it throw exception here or return null? If exception, do we need to handle the exception? If null, we need to do a check in the next line of code to prevent NPE.", "url": "https://github.com/apache/helix/pull/1169#discussion_r460228586", "createdAt": "2020-07-24T18:47:21Z", "author": {"login": "mgao0"}, "path": "helix-core/src/main/java/org/apache/helix/task/TaskStateModel.java", "diffHunk": "@@ -283,6 +289,36 @@ public void reset() {\n     }\n   }\n \n+  /**\n+   * Loads Task and TaskFactory classes for command input\n+   */\n+  private boolean loadNewTask(String command) {\n+    try {\n+      // Read ZNRecord containing task definition information.\n+      ZNRecord taskConfig = _manager.getHelixDataAccessor().getBaseDataAccessor()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7d076de23fbff1cf93b7ebf44715b71f0f1fe94a"}, "originalPosition": 33}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e6b7aeb7f813c43615fc996c15e44f9d9e57957f", "author": {"user": {"login": "rabashizade", "name": "Ramin Bashizade"}}, "url": "https://github.com/apache/helix/commit/e6b7aeb7f813c43615fc996c15e44f9d9e57957f", "committedDate": "2020-07-24T20:59:17Z", "message": "[HELIX-1168] Handle ZNRecord exception in loadNewTask()\n\nIn loadNewTask(), throw and handle ZkNoNodeException for non-existent\ntaskConfig ZNRecord. Additionally, handle HelixException for\n_manager.getHelixDataAccessor() and NullPointerException for file\naccess."}, "afterCommit": {"oid": "a50d49e575919008b023e2af54a908b43143cc72", "author": {"user": {"login": "rabashizade", "name": "Ramin Bashizade"}}, "url": "https://github.com/apache/helix/commit/a50d49e575919008b023e2af54a908b43143cc72", "committedDate": "2020-07-24T21:12:16Z", "message": "[HELIX-1168] Handle ZkNoNodeException in loadNewTask()\n\nIn loadNewTask(), throw and handle ZkNoNodeException for non-existent\ntaskConfig ZNRecord. Additionally, handle HelixException for\n_manager.getHelixDataAccessor() and NullPointerException for file\naccess."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU1OTc2MjI1", "url": "https://github.com/apache/helix/pull/1169#pullrequestreview-455976225", "createdAt": "2020-07-27T17:10:52Z", "commit": {"oid": "a50d49e575919008b023e2af54a908b43143cc72"}, "state": "COMMENTED", "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yN1QxNzoxMDo1MlrOG3rwBg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yN1QxNzoxNzozNVrOG3r_KA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTA0MTY3MA==", "bodyText": "Let's use proper scope identifiers like private or final", "url": "https://github.com/apache/helix/pull/1169#discussion_r461041670", "createdAt": "2020-07-27T17:10:52Z", "author": {"login": "narendly"}, "path": "helix-core/src/test/java/org/apache/helix/task/TestDynamicTaskLoading.java", "diffHunk": "@@ -0,0 +1,123 @@\n+package org.apache.helix.task;\n+\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+import java.util.ArrayList;\n+import java.util.Collections;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+import org.apache.helix.HelixManager;\n+import org.apache.helix.HelixManagerFactory;\n+import org.apache.helix.InstanceType;\n+import org.apache.helix.TestHelper;\n+import org.apache.helix.common.ZkTestBase;\n+import org.apache.helix.examples.MasterSlaveStateModelFactory;\n+import org.apache.helix.integration.manager.ClusterControllerManager;\n+import org.apache.helix.integration.manager.MockParticipantManager;\n+import org.apache.helix.integration.task.MockTask;\n+import org.apache.helix.participant.StateMachineEngine;\n+import org.apache.helix.participant.statemachine.StateModel;\n+import org.apache.helix.participant.statemachine.StateModelFactory;\n+import org.apache.helix.zookeeper.datamodel.ZNRecord;\n+import org.apache.zookeeper.CreateMode;\n+import org.testng.annotations.AfterClass;\n+import org.testng.annotations.BeforeClass;\n+import org.testng.annotations.Test;\n+\n+\n+public class TestDynamicTaskLoading extends ZkTestBase {\n+  HelixManager _manager;\n+  MockParticipantManager _participant;\n+  ClusterControllerManager _controller;\n+  String _clusterName;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a50d49e575919008b023e2af54a908b43143cc72"}, "originalPosition": 50}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTA0MzQ0Nw==", "bodyText": "It's a code smell and not good style to catch so many types of exceptions. Also, catching a runtime exception like NullPointerException is awkward. A way to work around this is to break up your loadTask function into smaller methods and deal with different failure scenarios there.", "url": "https://github.com/apache/helix/pull/1169#discussion_r461043447", "createdAt": "2020-07-27T17:14:07Z", "author": {"login": "narendly"}, "path": "helix-core/src/main/java/org/apache/helix/task/TaskStateModel.java", "diffHunk": "@@ -283,6 +292,38 @@ public void reset() {\n     }\n   }\n \n+  /**\n+   * Loads Task and TaskFactory classes for command input\n+   */\n+  private boolean loadNewTask(String command) {\n+    try {\n+      // Read ZNRecord containing task definition information.\n+      ZNRecord taskConfig = _manager.getHelixDataAccessor().getBaseDataAccessor()\n+          .get(\"/\" + _manager.getClusterName() + \"/TASK_DEFINITION\",\n+              null, AccessOption.THROW_EXCEPTION_IFNOTEXIST);\n+\n+      // Open the JAR file and import Task(s) and TaskFactory classes.\n+      File taskJar = new File(taskConfig.getSimpleField(\"JAR_FILE\"));\n+      URL taskJarUrl = taskJar.toURI().toURL();\n+\n+      // Import Task(s) and TaskFactory classes.\n+      URLClassLoader classLoader = URLClassLoader.newInstance(new URL[]{taskJarUrl});\n+      for(String taskClass : taskConfig.getListField(\"TASK_CLASSES\")) {\n+        classLoader.loadClass(taskClass);\n+      }\n+      Class cl = classLoader.loadClass(taskConfig.getSimpleField(\"TASKFACTORY\"));\n+\n+      // Register the TaskFactory.\n+      _taskFactoryRegistry.put(command, (TaskFactory) cl.newInstance());\n+    } catch (MalformedURLException | ClassNotFoundException | InstantiationException\n+        | IllegalAccessException | ZkNoNodeException | NullPointerException | HelixException e) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a50d49e575919008b023e2af54a908b43143cc72"}, "originalPosition": 59}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTA0NDQ4NA==", "bodyText": "Is there a better way to design this method signature - instead of returning a boolean?", "url": "https://github.com/apache/helix/pull/1169#discussion_r461044484", "createdAt": "2020-07-27T17:15:43Z", "author": {"login": "narendly"}, "path": "helix-core/src/main/java/org/apache/helix/task/TaskStateModel.java", "diffHunk": "@@ -283,6 +292,38 @@ public void reset() {\n     }\n   }\n \n+  /**\n+   * Loads Task and TaskFactory classes for command input\n+   */\n+  private boolean loadNewTask(String command) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a50d49e575919008b023e2af54a908b43143cc72"}, "originalPosition": 38}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTA0NDU4Mg==", "bodyText": "Let's use a proper JavaDoc block.", "url": "https://github.com/apache/helix/pull/1169#discussion_r461044582", "createdAt": "2020-07-27T17:15:54Z", "author": {"login": "narendly"}, "path": "helix-core/src/main/java/org/apache/helix/task/TaskStateModel.java", "diffHunk": "@@ -283,6 +292,38 @@ public void reset() {\n     }\n   }\n \n+  /**\n+   * Loads Task and TaskFactory classes for command input\n+   */", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a50d49e575919008b023e2af54a908b43143cc72"}, "originalPosition": 37}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTA0NTU0NA==", "bodyText": "My suggestion here for you is to read about \"magic strings\" or magic numbers and understand why they could be bad. https://help.semmle.com/wiki/display/JAVA/Magic+strings%3A+use+defined+constant", "url": "https://github.com/apache/helix/pull/1169#discussion_r461045544", "createdAt": "2020-07-27T17:17:35Z", "author": {"login": "narendly"}, "path": "helix-core/src/main/java/org/apache/helix/task/TaskStateModel.java", "diffHunk": "@@ -283,6 +292,38 @@ public void reset() {\n     }\n   }\n \n+  /**\n+   * Loads Task and TaskFactory classes for command input\n+   */\n+  private boolean loadNewTask(String command) {\n+    try {\n+      // Read ZNRecord containing task definition information.\n+      ZNRecord taskConfig = _manager.getHelixDataAccessor().getBaseDataAccessor()\n+          .get(\"/\" + _manager.getClusterName() + \"/TASK_DEFINITION\",\n+              null, AccessOption.THROW_EXCEPTION_IFNOTEXIST);\n+\n+      // Open the JAR file and import Task(s) and TaskFactory classes.\n+      File taskJar = new File(taskConfig.getSimpleField(\"JAR_FILE\"));\n+      URL taskJarUrl = taskJar.toURI().toURL();\n+\n+      // Import Task(s) and TaskFactory classes.\n+      URLClassLoader classLoader = URLClassLoader.newInstance(new URL[]{taskJarUrl});\n+      for(String taskClass : taskConfig.getListField(\"TASK_CLASSES\")) {\n+        classLoader.loadClass(taskClass);\n+      }\n+      Class cl = classLoader.loadClass(taskConfig.getSimpleField(\"TASKFACTORY\"));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a50d49e575919008b023e2af54a908b43143cc72"}, "originalPosition": 54}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU1OTgzMjky", "url": "https://github.com/apache/helix/pull/1169#pullrequestreview-455983292", "createdAt": "2020-07-27T17:20:43Z", "commit": {"oid": "a50d49e575919008b023e2af54a908b43143cc72"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yN1QxNzoyMDo0NFrOG3sGSA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yN1QxNzoyMDo0NFrOG3sGSA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTA0NzM2OA==", "bodyText": "Instead of doing this, you could check whether taskConfig is null.", "url": "https://github.com/apache/helix/pull/1169#discussion_r461047368", "createdAt": "2020-07-27T17:20:44Z", "author": {"login": "narendly"}, "path": "helix-core/src/main/java/org/apache/helix/task/TaskStateModel.java", "diffHunk": "@@ -283,6 +292,38 @@ public void reset() {\n     }\n   }\n \n+  /**\n+   * Loads Task and TaskFactory classes for command input\n+   */\n+  private boolean loadNewTask(String command) {\n+    try {\n+      // Read ZNRecord containing task definition information.\n+      ZNRecord taskConfig = _manager.getHelixDataAccessor().getBaseDataAccessor()\n+          .get(\"/\" + _manager.getClusterName() + \"/TASK_DEFINITION\",\n+              null, AccessOption.THROW_EXCEPTION_IFNOTEXIST);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a50d49e575919008b023e2af54a908b43143cc72"}, "originalPosition": 43}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU2MTMxOTM3", "url": "https://github.com/apache/helix/pull/1169#pullrequestreview-456131937", "createdAt": "2020-07-27T21:01:12Z", "commit": {"oid": "a50d49e575919008b023e2af54a908b43143cc72"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yN1QyMTowMToxMlrOG3zazw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yN1QyMTowMToxMlrOG3zazw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTE2NzMxMQ==", "bodyText": "Thanks for the PR. Good job ;-)\nIs there any way to make sure the functionality of this PR? Do we need to have some sort of assert/statement to make sure it works?", "url": "https://github.com/apache/helix/pull/1169#discussion_r461167311", "createdAt": "2020-07-27T21:01:12Z", "author": {"login": "alirezazamani"}, "path": "helix-core/src/test/java/org/apache/helix/task/TestDynamicTaskLoading.java", "diffHunk": "@@ -0,0 +1,123 @@\n+package org.apache.helix.task;\n+\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+import java.util.ArrayList;\n+import java.util.Collections;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+import org.apache.helix.HelixManager;\n+import org.apache.helix.HelixManagerFactory;\n+import org.apache.helix.InstanceType;\n+import org.apache.helix.TestHelper;\n+import org.apache.helix.common.ZkTestBase;\n+import org.apache.helix.examples.MasterSlaveStateModelFactory;\n+import org.apache.helix.integration.manager.ClusterControllerManager;\n+import org.apache.helix.integration.manager.MockParticipantManager;\n+import org.apache.helix.integration.task.MockTask;\n+import org.apache.helix.participant.StateMachineEngine;\n+import org.apache.helix.participant.statemachine.StateModel;\n+import org.apache.helix.participant.statemachine.StateModelFactory;\n+import org.apache.helix.zookeeper.datamodel.ZNRecord;\n+import org.apache.zookeeper.CreateMode;\n+import org.testng.annotations.AfterClass;\n+import org.testng.annotations.BeforeClass;\n+import org.testng.annotations.Test;\n+\n+\n+public class TestDynamicTaskLoading extends ZkTestBase {\n+  HelixManager _manager;\n+  MockParticipantManager _participant;\n+  ClusterControllerManager _controller;\n+  String _clusterName;\n+\n+  @BeforeClass\n+  public void beforeClass() throws Exception {\n+    super.beforeClass();\n+    _clusterName = CLUSTER_PREFIX + \"_\" + getShortClassName();\n+    _gSetupTool.addCluster(_clusterName, true);\n+\n+    _manager = HelixManagerFactory.getZKHelixManager(_clusterName, \"Admin\",\n+        InstanceType.ADMINISTRATOR, ZK_ADDR);\n+    _manager.connect();\n+\n+    String instanceName = \"localhost_12913\";\n+    _gSetupTool.addInstanceToCluster(_clusterName, instanceName);\n+    _participant = new MockParticipantManager(ZK_ADDR, _clusterName, instanceName);\n+    StateModelFactory<StateModel> stateModelFactory = new MasterSlaveStateModelFactory(instanceName, 0);\n+    StateMachineEngine stateMach = _participant.getStateMachineEngine();\n+    stateMach.registerStateModelFactory(\"MasterSlave\", stateModelFactory);\n+    Map<String, TaskFactory> taskFactoryReg = new HashMap<>();\n+    _participant.getStateMachineEngine().registerStateModelFactory(TaskConstants.STATE_MODEL_NAME,\n+        new TaskStateModelFactory(_participant, taskFactoryReg));\n+    _participant.syncStart();\n+\n+    _controller = new ClusterControllerManager(ZK_ADDR, _clusterName, null);\n+    _controller.syncStart();\n+\n+    // Add task definition information as a ZNRecord.\n+    ZNRecord configZnRecord = new ZNRecord(_participant.getInstanceName());\n+    configZnRecord.setSimpleField(\"JAR_FILE\", \"src/test/resources/Reindex.jar\");\n+    configZnRecord.setSimpleField(\"VERSION\", \"1.0.0\");\n+    List<String> taskClasses = new ArrayList<String>();\n+    taskClasses.add(\"com.mycompany.mocktask.MockTask\");\n+    configZnRecord.setListField(\"TASK_CLASSES\", taskClasses);\n+    configZnRecord.setSimpleField(\"TASKFACTORY\", \"com.mycompany.mocktask.MockTaskFactory\");\n+    String path = String.format(\"/%s/%s\", _clusterName, \"TASK_DEFINITION\");\n+    _participant.getZkClient().create(path, configZnRecord, CreateMode.PERSISTENT);\n+  }\n+\n+  @Test\n+  public void testDynamicTaskLoading() throws Exception {\n+    String workflowName = TestHelper.getTestMethodName();\n+    TaskDriver driver = new TaskDriver(_manager);\n+    JobConfig.Builder job = new JobConfig.Builder();\n+    job.setJobCommandConfigMap(Collections.singletonMap(MockTask.JOB_DELAY, \"100\"));\n+    Workflow.Builder workflow = new Workflow.Builder(workflowName);\n+    job.setWorkflow(workflowName);\n+    TaskConfig taskConfig =\n+        new TaskConfig(MockTask.TASK_COMMAND, new HashMap<String, String>(), null, null);\n+    job.addTaskConfigMap(Collections.singletonMap(taskConfig.getId(), taskConfig));\n+    job.setJobId(TaskUtil.getNamespacedJobName(workflowName, \"JOB\"));\n+    workflow.addJob(\"JOB\", job);\n+    driver.start(workflow.build());\n+\n+    Thread.sleep(2000);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a50d49e575919008b023e2af54a908b43143cc72"}, "originalPosition": 103}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU2ODEzNzAz", "url": "https://github.com/apache/helix/pull/1169#pullrequestreview-456813703", "createdAt": "2020-07-28T16:37:04Z", "commit": {"oid": "53fa31da58e4b2af093422c3344839ec300c81b3"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOFQxNjozNzowNFrOG4VGww==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOFQxNjozNzowNFrOG4VGww==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTcxOTIzNQ==", "bodyText": "This method is still doing too many things, and some parts of the inner logic could be refactored out for clarity, conciseness, and testability. I recommend you take a look at some publicly available good programming practices to get a sense of what good, maintainable code looks like as well.", "url": "https://github.com/apache/helix/pull/1169#discussion_r461719235", "createdAt": "2020-07-28T16:37:04Z", "author": {"login": "narendly"}, "path": "helix-core/src/main/java/org/apache/helix/task/TaskStateModel.java", "diffHunk": "@@ -283,6 +294,63 @@ public void reset() {\n     }\n   }\n \n+  /**\n+   * Loads Task and TaskFactory classes for command input from\n+   * a JAR file, and register the TaskFactory in _taskFactoryRegistry.\n+   * @param command The command indicating what task to be loaded\n+   */\n+  private void loadNewTask(String command) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "53fa31da58e4b2af093422c3344839ec300c81b3"}, "originalPosition": 44}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU2ODE5MjU3", "url": "https://github.com/apache/helix/pull/1169#pullrequestreview-456819257", "createdAt": "2020-07-28T16:44:03Z", "commit": {"oid": "53fa31da58e4b2af093422c3344839ec300c81b3"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOFQxNjo0NDowM1rOG4VXeA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOFQxNjo0NDowM1rOG4VXeA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTcyMzUxMg==", "bodyText": "Nit: Rename to something like TASK_JAR_FILE_KEY?", "url": "https://github.com/apache/helix/pull/1169#discussion_r461723512", "createdAt": "2020-07-28T16:44:03Z", "author": {"login": "narendly"}, "path": "helix-core/src/main/java/org/apache/helix/task/TaskStateModel.java", "diffHunk": "@@ -43,6 +49,11 @@\n   private ScheduledFuture timeout_task;\n   private TaskRunner _taskRunner;\n   private final ScheduledExecutorService _timeoutTaskExecutor;\n+  public static final String TASK_JAR_FILE = \"JAR_FILE\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "53fa31da58e4b2af093422c3344839ec300c81b3"}, "originalPosition": 27}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU2ODIwMTA1", "url": "https://github.com/apache/helix/pull/1169#pullrequestreview-456820105", "createdAt": "2020-07-28T16:45:10Z", "commit": {"oid": "53fa31da58e4b2af093422c3344839ec300c81b3"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOFQxNjo0NToxMFrOG4VaLg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOFQxNjo0NToxMFrOG4VaLg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTcyNDIwNg==", "bodyText": "This code doesn't seem like it's been formatted properly.", "url": "https://github.com/apache/helix/pull/1169#discussion_r461724206", "createdAt": "2020-07-28T16:45:10Z", "author": {"login": "narendly"}, "path": "helix-core/src/main/java/org/apache/helix/task/TaskStateModel.java", "diffHunk": "@@ -283,6 +294,63 @@ public void reset() {\n     }\n   }\n \n+  /**\n+   * Loads Task and TaskFactory classes for command input from\n+   * a JAR file, and register the TaskFactory in _taskFactoryRegistry.\n+   * @param command The command indicating what task to be loaded\n+   */\n+  private void loadNewTask(String command) {\n+    // Read ZNRecord containing task definition information.\n+    ZNRecord taskConfig = _manager.getHelixDataAccessor().getBaseDataAccessor()\n+        .get(\"/\" + _manager.getClusterName() + \"/\" + TASK_PATH + \"_\" + command,null, 0);\n+    if(taskConfig == null) {\n+      LOG.info(\"Failed to read ZNRecord for task \" + command + \" for instance \" + _manager.getInstanceName()\n+          + \" in cluster \" + _manager.getClusterName() + \".\");\n+      throw new IllegalStateException(\"No ZNRecord for task \" + command);\n+    }\n+\n+    // Open the JAR file containing Task(s) and TaskFactory classes.\n+    File taskJar;\n+    URL taskJarUrl;\n+    try {\n+      taskJar = new File(taskConfig.getSimpleField(TASK_JAR_FILE));\n+      if(taskJar.exists() && !taskJar.isDirectory()) {\n+        taskJarUrl = taskJar.toURI().toURL();\n+      } else {\n+        throw new IllegalStateException(\"No JAR for task \" + command);\n+      }\n+    } catch (MalformedURLException e) {\n+      LOG.info(\"Failed to find/open JAR for new task \" + command + \" for instance \" + _manager.getInstanceName()\n+          + \" in cluster \" + _manager.getClusterName() + \".\");\n+      throw new IllegalStateException(\"Malformed JAR URL for task \" + command);\n+    }\n+\n+    // Import Task(s) and TaskFactory classes.\n+    URLClassLoader classLoader = URLClassLoader.newInstance(new URL[]{taskJarUrl});\n+    for(String taskClass : taskConfig.getListField(TASK_CLASSES)) {\n+      try {\n+        classLoader.loadClass(taskClass);\n+      } catch(ClassNotFoundException e) {\n+        LOG.info(\"Failed to load class(es) for new task \" + command + \" for instance \" + _manager.getInstanceName()\n+            + \" in cluster \" + _manager.getClusterName() + \".\");\n+        throw new IllegalStateException(\"Null class(es) for task \" + command);\n+      }\n+    }\n+    Class cl;\n+    TaskFactory tf;\n+    try {\n+      cl = classLoader.loadClass(taskConfig.getSimpleField(TASK_FACTORY));\n+      tf = (TaskFactory)cl.newInstance();\n+    } catch(ClassNotFoundException | InstantiationException | IllegalAccessException e) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "53fa31da58e4b2af093422c3344839ec300c81b3"}, "originalPosition": 86}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU2ODIxMDUz", "url": "https://github.com/apache/helix/pull/1169#pullrequestreview-456821053", "createdAt": "2020-07-28T16:46:25Z", "commit": {"oid": "53fa31da58e4b2af093422c3344839ec300c81b3"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOFQxNjo0NjoyNVrOG4VdDQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOFQxNjo0NjoyNVrOG4VdDQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTcyNDk0MQ==", "bodyText": "LOG level should be error instead of info because you're treating this as an exception?", "url": "https://github.com/apache/helix/pull/1169#discussion_r461724941", "createdAt": "2020-07-28T16:46:25Z", "author": {"login": "narendly"}, "path": "helix-core/src/main/java/org/apache/helix/task/TaskStateModel.java", "diffHunk": "@@ -283,6 +294,63 @@ public void reset() {\n     }\n   }\n \n+  /**\n+   * Loads Task and TaskFactory classes for command input from\n+   * a JAR file, and register the TaskFactory in _taskFactoryRegistry.\n+   * @param command The command indicating what task to be loaded\n+   */\n+  private void loadNewTask(String command) {\n+    // Read ZNRecord containing task definition information.\n+    ZNRecord taskConfig = _manager.getHelixDataAccessor().getBaseDataAccessor()\n+        .get(\"/\" + _manager.getClusterName() + \"/\" + TASK_PATH + \"_\" + command,null, 0);\n+    if(taskConfig == null) {\n+      LOG.info(\"Failed to read ZNRecord for task \" + command + \" for instance \" + _manager.getInstanceName()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "53fa31da58e4b2af093422c3344839ec300c81b3"}, "originalPosition": 49}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU2ODIzOTg2", "url": "https://github.com/apache/helix/pull/1169#pullrequestreview-456823986", "createdAt": "2020-07-28T16:50:05Z", "commit": {"oid": "53fa31da58e4b2af093422c3344839ec300c81b3"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOFQxNjo1MDowNVrOG4VmlA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOFQxNjo1MDowNVrOG4VmlA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTcyNzM4MA==", "bodyText": "Since loading the JAR from the local directory is not a permanent solution and rather not very useful, consider using Java Interface to make this pluggable. That's a better design principle and will allow you to extend your code more easily. The way it's hard-coded right now, it will be difficult to change the underlying implementation for the jar loader.", "url": "https://github.com/apache/helix/pull/1169#discussion_r461727380", "createdAt": "2020-07-28T16:50:05Z", "author": {"login": "narendly"}, "path": "helix-core/src/main/java/org/apache/helix/task/TaskStateModel.java", "diffHunk": "@@ -283,6 +294,63 @@ public void reset() {\n     }\n   }\n \n+  /**\n+   * Loads Task and TaskFactory classes for command input from\n+   * a JAR file, and register the TaskFactory in _taskFactoryRegistry.\n+   * @param command The command indicating what task to be loaded\n+   */\n+  private void loadNewTask(String command) {\n+    // Read ZNRecord containing task definition information.\n+    ZNRecord taskConfig = _manager.getHelixDataAccessor().getBaseDataAccessor()\n+        .get(\"/\" + _manager.getClusterName() + \"/\" + TASK_PATH + \"_\" + command,null, 0);\n+    if(taskConfig == null) {\n+      LOG.info(\"Failed to read ZNRecord for task \" + command + \" for instance \" + _manager.getInstanceName()\n+          + \" in cluster \" + _manager.getClusterName() + \".\");\n+      throw new IllegalStateException(\"No ZNRecord for task \" + command);\n+    }\n+\n+    // Open the JAR file containing Task(s) and TaskFactory classes.\n+    File taskJar;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "53fa31da58e4b2af093422c3344839ec300c81b3"}, "originalPosition": 55}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU2ODI1MTcw", "url": "https://github.com/apache/helix/pull/1169#pullrequestreview-456825170", "createdAt": "2020-07-28T16:51:43Z", "commit": {"oid": "53fa31da58e4b2af093422c3344839ec300c81b3"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOFQxNjo1MTo0M1rOG4VqQg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOFQxNjo1MTo0M1rOG4VqQg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTcyODMyMg==", "bodyText": "Overall, the code still feels like a \"script\" - to make this more amenable for use in production, let's work on making it maintainable and extendable :)", "url": "https://github.com/apache/helix/pull/1169#discussion_r461728322", "createdAt": "2020-07-28T16:51:43Z", "author": {"login": "narendly"}, "path": "helix-core/src/main/java/org/apache/helix/task/TaskStateModel.java", "diffHunk": "@@ -43,6 +49,11 @@\n   private ScheduledFuture timeout_task;\n   private TaskRunner _taskRunner;\n   private final ScheduledExecutorService _timeoutTaskExecutor;\n+  public static final String TASK_JAR_FILE = \"JAR_FILE\";\n+  public static final String TASK_VERSION = \"VERSION\";\n+  public static final String TASK_CLASSES = \"TASK_CLASSES\";\n+  public static final String TASK_FACTORY = \"TASKFACTORY\";\n+  public static final String TASK_PATH = \"TASK_DEFINITION\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "53fa31da58e4b2af093422c3344839ec300c81b3"}, "originalPosition": 31}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU2ODI4NDYx", "url": "https://github.com/apache/helix/pull/1169#pullrequestreview-456828461", "createdAt": "2020-07-28T16:55:58Z", "commit": {"oid": "53fa31da58e4b2af093422c3344839ec300c81b3"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOFQxNjo1NTo1OFrOG4V0iA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOFQxNjo1NTo1OFrOG4V0iA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTczMDk1Mg==", "bodyText": "One suggestion here is to make the dynamic Task config a typed ZNRecord. Consider creating a record class that extends ZNRecord (and call it DynamicTaskConfig) that explicitly defines the fields you need to describe a dynamic task.\nHelixProperty is one such example.", "url": "https://github.com/apache/helix/pull/1169#discussion_r461730952", "createdAt": "2020-07-28T16:55:58Z", "author": {"login": "narendly"}, "path": "helix-core/src/test/java/org/apache/helix/task/TestDynamicTaskLoading.java", "diffHunk": "@@ -0,0 +1,125 @@\n+package org.apache.helix.task;\n+\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+import java.util.ArrayList;\n+import java.util.Collections;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+import org.apache.helix.HelixException;\n+import org.apache.helix.HelixManager;\n+import org.apache.helix.HelixManagerFactory;\n+import org.apache.helix.InstanceType;\n+import org.apache.helix.TestHelper;\n+import org.apache.helix.common.ZkTestBase;\n+import org.apache.helix.examples.MasterSlaveStateModelFactory;\n+import org.apache.helix.integration.manager.ClusterControllerManager;\n+import org.apache.helix.integration.manager.MockParticipantManager;\n+import org.apache.helix.integration.task.MockTask;\n+import org.apache.helix.participant.StateMachineEngine;\n+import org.apache.helix.participant.statemachine.StateModel;\n+import org.apache.helix.participant.statemachine.StateModelFactory;\n+import org.apache.helix.zookeeper.datamodel.ZNRecord;\n+import org.apache.zookeeper.CreateMode;\n+import org.testng.AssertJUnit;\n+import org.testng.annotations.AfterClass;\n+import org.testng.annotations.BeforeClass;\n+import org.testng.annotations.Test;\n+\n+\n+public class TestDynamicTaskLoading extends ZkTestBase {\n+  private final String _clusterName = CLUSTER_PREFIX + \"_\" + getShortClassName();\n+  private static final String _instanceName = \"localhost_12913\";\n+  private HelixManager _manager;\n+  private MockParticipantManager _participant;\n+  private ClusterControllerManager _controller;\n+\n+  @BeforeClass\n+  public void beforeClass() throws Exception {\n+    super.beforeClass();\n+    _gSetupTool.addCluster(_clusterName, true);\n+\n+    _manager = HelixManagerFactory.getZKHelixManager(_clusterName, \"Admin\",\n+        InstanceType.ADMINISTRATOR, ZK_ADDR);\n+    _manager.connect();\n+\n+    _gSetupTool.addInstanceToCluster(_clusterName, _instanceName);\n+    _participant = new MockParticipantManager(ZK_ADDR, _clusterName, _instanceName);\n+    StateModelFactory<StateModel> stateModelFactory = new MasterSlaveStateModelFactory(_instanceName, 0);\n+    StateMachineEngine stateMach = _participant.getStateMachineEngine();\n+    stateMach.registerStateModelFactory(\"MasterSlave\", stateModelFactory);\n+    Map<String, TaskFactory> taskFactoryReg = new HashMap<>();\n+    _participant.getStateMachineEngine().registerStateModelFactory(TaskConstants.STATE_MODEL_NAME,\n+        new TaskStateModelFactory(_participant, taskFactoryReg));\n+    _participant.syncStart();\n+\n+    _controller = new ClusterControllerManager(ZK_ADDR, _clusterName,null);\n+    _controller.syncStart();\n+\n+    // Add task definition information as a ZNRecord.\n+    ZNRecord configZnRecord = new ZNRecord(_participant.getInstanceName());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "53fa31da58e4b2af093422c3344839ec300c81b3"}, "originalPosition": 78}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU5NDQ1NDg0", "url": "https://github.com/apache/helix/pull/1169#pullrequestreview-459445484", "createdAt": "2020-07-31T20:18:14Z", "commit": {"oid": "522de9b1866f0d3d37f125003198ea268943ccf4"}, "state": "COMMENTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMVQyMDoxODoxNFrOG6VE7g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMVQyMDoyMzo1MlrOG6VOJw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzgxNTkxOA==", "bodyText": "Let's start with this PR. You can create an API folder under task. Move the interface to API module.", "url": "https://github.com/apache/helix/pull/1169#discussion_r463815918", "createdAt": "2020-07-31T20:18:14Z", "author": {"login": "junkaixue"}, "path": "helix-core/src/main/java/org/apache/helix/task/JarLoader.java", "diffHunk": "@@ -0,0 +1,34 @@\n+package org.apache.helix.task;\n+\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+import java.net.URL;\n+\n+/**\n+ * The interface that is to be implemented by a specific JAR loader.\n+ */\n+public interface JarLoader {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "522de9b1866f0d3d37f125003198ea268943ccf4"}, "originalPosition": 27}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzgxNjI5NA==", "bodyText": "else clause is not necessary. You can directly put\nLOG.error(\"Failed to find JAR \" + jar + \" for new task.\");\nthrow new IllegalStateException(\"No JAR for task\");\nBecause if the return is not happening, it will reaches the exception part.", "url": "https://github.com/apache/helix/pull/1169#discussion_r463816294", "createdAt": "2020-07-31T20:19:16Z", "author": {"login": "junkaixue"}, "path": "helix-core/src/main/java/org/apache/helix/task/LocalJarLoader.java", "diffHunk": "@@ -0,0 +1,48 @@\n+package org.apache.helix.task;\n+\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+import java.io.File;\n+import java.net.MalformedURLException;\n+import java.net.URL;\n+\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+public class LocalJarLoader implements JarLoader {\n+  private static final Logger LOG = LoggerFactory.getLogger(LocalJarLoader.class);\n+\n+  @Override\n+  public URL openJar(String jar) {\n+    File taskJar;\n+    try {\n+      taskJar = new File(jar);\n+      if (taskJar.exists() && !taskJar.isDirectory()) {\n+        return taskJar.toURI().toURL();\n+      } else {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "522de9b1866f0d3d37f125003198ea268943ccf4"}, "originalPosition": 39}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzgxNjQ2Mg==", "bodyText": "Let's move these two TaskConstants class.", "url": "https://github.com/apache/helix/pull/1169#discussion_r463816462", "createdAt": "2020-07-31T20:19:41Z", "author": {"login": "junkaixue"}, "path": "helix-core/src/main/java/org/apache/helix/task/TaskStateModel.java", "diffHunk": "@@ -43,6 +46,11 @@\n   private ScheduledFuture timeout_task;\n   private TaskRunner _taskRunner;\n   private final ScheduledExecutorService _timeoutTaskExecutor;\n+  public static final String TASK_JAR_FILE_KEY = \"JAR_FILE\";\n+  public static final String TASK_VERSION_KEY = \"VERSION\";\n+  public static final String TASK_CLASSES_KEY = \"TASK_CLASSES\";\n+  public static final String TASK_FACTORY_KEY = \"TASKFACTORY\";\n+  public static final String TASK_PATH = \"/TASK_DEFINITION\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "522de9b1866f0d3d37f125003198ea268943ccf4"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzgxODI3OQ==", "bodyText": "I would suggestion to make this feature optional. If there is no folder created for \"TASK_DEFINITON\", let's skip the steps. Otherwise, it could bring potential risks.", "url": "https://github.com/apache/helix/pull/1169#discussion_r463818279", "createdAt": "2020-07-31T20:23:52Z", "author": {"login": "junkaixue"}, "path": "helix-core/src/main/java/org/apache/helix/task/TaskStateModel.java", "diffHunk": "@@ -283,6 +297,63 @@ public void reset() {\n     }\n   }\n \n+  /**\n+   * Loads className using classLoader\n+   * @param classLoader\n+   * @param className\n+   * @return Class className loaded by classLoader\n+   */\n+  private Class loadClass(URLClassLoader classLoader, String className) {\n+    try {\n+      return classLoader.loadClass(className);\n+    } catch (ClassNotFoundException e) {\n+      LOG.error(\"Failed to load Task class \" + className + \" for new task in instance \" + _manager\n+          .getInstanceName() + \" in cluster \" + _manager.getClusterName() + \".\");\n+      throw new IllegalStateException(\"Null TaskFactory for task\");\n+    }\n+  }\n+\n+  /**\n+   * Loads Task and TaskFactory classes for command input from\n+   * a JAR file, and registers the TaskFactory in _taskFactoryRegistry.\n+   * @param command The command indicating what task to be loaded\n+   */\n+  private void loadNewTask(String command) {\n+    // Read ZNRecord containing task definition information.\n+    ZNRecord taskConfig = _manager.getHelixDataAccessor().getBaseDataAccessor()\n+        .get(TASK_PATH + \"/\" + command, null, 0);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "522de9b1866f0d3d37f125003198ea268943ccf4"}, "originalPosition": 144}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "159f2448119f868b3a077a048f699f79bbcc6a7e", "author": {"user": {"login": "rabashizade", "name": "Ramin Bashizade"}}, "url": "https://github.com/apache/helix/commit/159f2448119f868b3a077a048f699f79bbcc6a7e", "committedDate": "2020-08-04T17:45:16Z", "message": "[HELIX-1168] Dynamically load tasks in Task Framework\n\nAdd loadNewTask() method to TaskStateModel.java to dynamically load\ntasks that are not already defined in task factory registry.\n\nThis prevents the need to implement task-specific Participants and\nthus, enables numerous use cases with minimal extra coding effort\nbeyond implementing the task logic itself."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9ae58d301cc4e6db1db9a907463331da89908cc7", "author": {"user": {"login": "rabashizade", "name": "Ramin Bashizade"}}, "url": "https://github.com/apache/helix/commit/9ae58d301cc4e6db1db9a907463331da89908cc7", "committedDate": "2020-08-04T17:45:16Z", "message": "[HELIX-1168] Handle ZkNoNodeException in loadNewTask()\n\nIn loadNewTask(), throw and handle ZkNoNodeException for non-existent\ntaskConfig ZNRecord. Additionally, handle HelixException for\n_manager.getHelixDataAccessor() and NullPointerException for file\naccess."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8ed8da36d70d0734533e468f766da00994547429", "author": {"user": {"login": "rabashizade", "name": "Ramin Bashizade"}}, "url": "https://github.com/apache/helix/commit/8ed8da36d70d0734533e468f766da00994547429", "committedDate": "2020-08-04T17:45:16Z", "message": "Fix test assert, task ZK path, exception handling\n\nAdd assertion to test to check for task status which indicates success.\n\nFix the task ZNRecord path to be task-specific.\n\nClean the exception handling in loadNewTask()."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0a770a8d9c59e016ef873a0d12410cbf2c76493d", "author": {"user": {"login": "rabashizade", "name": "Ramin Bashizade"}}, "url": "https://github.com/apache/helix/commit/0a770a8d9c59e016ef873a0d12410cbf2c76493d", "committedDate": "2020-08-04T17:45:16Z", "message": "Throw exceptions when loadNewTask() fails\n\nInstead of simply returning from loadNewTask() when it fails, throw\nappropriate exceptions."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "efa48a2299299144c26921ebb7e8de324c298be7", "author": {"user": {"login": "rabashizade", "name": "Ramin Bashizade"}}, "url": "https://github.com/apache/helix/commit/efa48a2299299144c26921ebb7e8de324c298be7", "committedDate": "2020-08-04T17:45:16Z", "message": "Generalize JAR loader, add more tests, fix format\n\nAdds JarLoader interface which generalizes the JAR loading, and adds\nan implementation LocalJarLoader that loads a JAR file from local\ndirectory.\n\nAlso adds more tests for different types of failures. Additionally,\nfixes code formatting issues."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e47f33315a4bf90ec9b447aba9ef656a0ce6b88a", "author": {"user": {"login": "rabashizade", "name": "Ramin Bashizade"}}, "url": "https://github.com/apache/helix/commit/e47f33315a4bf90ec9b447aba9ef656a0ce6b88a", "committedDate": "2020-08-04T17:45:16Z", "message": "Make dynamic task loading optional, clean up code\n\nMakes dynamically loading tasks optional by skipping the process if the\nfolder for task definitions doesn't exist in ZooKeeper.\n\nAlso cleans up and organizes some code, and reverses some unnecessary\nformatting."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6019594750f4d82c7814974bcf6a3c7e61ab65bc", "author": {"user": {"login": "rabashizade", "name": "Ramin Bashizade"}}, "url": "https://github.com/apache/helix/commit/6019594750f4d82c7814974bcf6a3c7e61ab65bc", "committedDate": "2020-08-02T16:45:23Z", "message": "Make dynamic task loading optional, clean up code\n\nMakes dynamically loading tasks optional by skipping the process if the\nfolder for task definitions doesn't exist in ZooKeeper.\n\nAlso cleans up and organizes some code, and reverses some unnecessary\nformatting."}, "afterCommit": {"oid": "e47f33315a4bf90ec9b447aba9ef656a0ce6b88a", "author": {"user": {"login": "rabashizade", "name": "Ramin Bashizade"}}, "url": "https://github.com/apache/helix/commit/e47f33315a4bf90ec9b447aba9ef656a0ce6b88a", "committedDate": "2020-08-04T17:45:16Z", "message": "Make dynamic task loading optional, clean up code\n\nMakes dynamically loading tasks optional by skipping the process if the\nfolder for task definitions doesn't exist in ZooKeeper.\n\nAlso cleans up and organizes some code, and reverses some unnecessary\nformatting."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4eba6047d72e19ec5af25a87d6e7533aee10b4ac", "author": {"user": {"login": "rabashizade", "name": "Ramin Bashizade"}}, "url": "https://github.com/apache/helix/commit/4eba6047d72e19ec5af25a87d6e7533aee10b4ac", "committedDate": "2020-08-12T16:36:54Z", "message": "[HELIX-1168] Dynamically load tasks in Task Framework\n\nAdd loadNewTask() method to TaskStateModel.java to dynamically load\ntasks that are not already defined in task factory registry.\n\nThis prevents the need to implement task-specific Participants and\nthus, enables numerous use cases with minimal extra coding effort\nbeyond implementing the task logic itself."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a467d1fbab882d7bb092ebe61f4b55a8a77ce2a6", "author": {"user": {"login": "rabashizade", "name": "Ramin Bashizade"}}, "url": "https://github.com/apache/helix/commit/a467d1fbab882d7bb092ebe61f4b55a8a77ce2a6", "committedDate": "2020-08-12T16:36:54Z", "message": "[HELIX-1168] Handle ZkNoNodeException in loadNewTask()\n\nIn loadNewTask(), throw and handle ZkNoNodeException for non-existent\ntaskConfig ZNRecord. Additionally, handle HelixException for\n_manager.getHelixDataAccessor() and NullPointerException for file\naccess."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0800e1790be624623f32fda73fba06093f1150f0", "author": {"user": {"login": "rabashizade", "name": "Ramin Bashizade"}}, "url": "https://github.com/apache/helix/commit/0800e1790be624623f32fda73fba06093f1150f0", "committedDate": "2020-08-12T16:36:54Z", "message": "Fix test assert, task ZK path, exception handling\n\nAdd assertion to test to check for task status which indicates success.\n\nFix the task ZNRecord path to be task-specific.\n\nClean the exception handling in loadNewTask()."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cb6468f620c38361c03a6f7e2ee27cef5294aa2b", "author": {"user": {"login": "rabashizade", "name": "Ramin Bashizade"}}, "url": "https://github.com/apache/helix/commit/cb6468f620c38361c03a6f7e2ee27cef5294aa2b", "committedDate": "2020-08-12T16:36:54Z", "message": "Throw exceptions when loadNewTask() fails\n\nInstead of simply returning from loadNewTask() when it fails, throw\nappropriate exceptions."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4e7f68b1c2aa0ebb376ab7d810e3e618c9be6877", "author": {"user": {"login": "rabashizade", "name": "Ramin Bashizade"}}, "url": "https://github.com/apache/helix/commit/4e7f68b1c2aa0ebb376ab7d810e3e618c9be6877", "committedDate": "2020-08-12T16:36:54Z", "message": "Generalize JAR loader, add more tests, fix format\n\nAdds JarLoader interface which generalizes the JAR loading, and adds\nan implementation LocalJarLoader that loads a JAR file from local\ndirectory.\n\nAlso adds more tests for different types of failures. Additionally,\nfixes code formatting issues."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ef45712aca06032d564e74f673068b590d06ad1d", "author": {"user": {"login": "rabashizade", "name": "Ramin Bashizade"}}, "url": "https://github.com/apache/helix/commit/ef45712aca06032d564e74f673068b590d06ad1d", "committedDate": "2020-08-12T16:38:36Z", "message": "Make dynamic task loading optional, clean up code\n\nMakes dynamically loading tasks optional by skipping the process if the\nfolder for task definitions doesn't exist in ZooKeeper.\n\nAlso cleans up and organizes some code, and reverses some unnecessary\nformatting."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "254c1ce8b8668b274868262d137e3abd75f0c13b", "author": {"user": {"login": "rabashizade", "name": "Ramin Bashizade"}}, "url": "https://github.com/apache/helix/commit/254c1ce8b8668b274868262d137e3abd75f0c13b", "committedDate": "2020-08-12T16:51:18Z", "message": "Rebase to import JarLoader and DynamicTaskConfig"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4f62c9dbbab7ea8d9edc5806547f82fef0fd6a2b", "author": {"user": {"login": "rabashizade", "name": "Ramin Bashizade"}}, "url": "https://github.com/apache/helix/commit/4f62c9dbbab7ea8d9edc5806547f82fef0fd6a2b", "committedDate": "2020-08-12T16:59:28Z", "message": "Fix conflicts for merge"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "46f92070b1f8b7c7d7b70b4d4faf07dd9c541231", "author": {"user": {"login": "rabashizade", "name": "Ramin Bashizade"}}, "url": "https://github.com/apache/helix/commit/46f92070b1f8b7c7d7b70b4d4faf07dd9c541231", "committedDate": "2020-08-12T18:19:21Z", "message": "Delete duplicate LocalJarLoader.java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "603bd1c428cbcfd192e3486dfa95a50d89f8f171", "author": {"user": {"login": "rabashizade", "name": "Ramin Bashizade"}}, "url": "https://github.com/apache/helix/commit/603bd1c428cbcfd192e3486dfa95a50d89f8f171", "committedDate": "2020-08-12T18:40:21Z", "message": "Fix some formatting issues"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ea30ec02031394257455b3d2592abc7e46768636", "author": {"user": {"login": "rabashizade", "name": "Ramin Bashizade"}}, "url": "https://github.com/apache/helix/commit/ea30ec02031394257455b3d2592abc7e46768636", "committedDate": "2020-08-12T18:44:04Z", "message": "Merge branch 'master' of https://github.com/rabashizade/helix"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "42a0fded9b16b3ede80df8f28ec1673b7b8175b5", "author": {"user": {"login": "rabashizade", "name": "Ramin Bashizade"}}, "url": "https://github.com/apache/helix/commit/42a0fded9b16b3ede80df8f28ec1673b7b8175b5", "committedDate": "2020-08-12T18:47:42Z", "message": "Fix formatting"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ccedbc2154eba578d52315ced93f6d211ea95704", "author": {"user": {"login": "rabashizade", "name": "Ramin Bashizade"}}, "url": "https://github.com/apache/helix/commit/ccedbc2154eba578d52315ced93f6d211ea95704", "committedDate": "2020-08-12T18:55:40Z", "message": "Clarify comments"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY2OTI5NDk1", "url": "https://github.com/apache/helix/pull/1169#pullrequestreview-466929495", "createdAt": "2020-08-13T16:34:26Z", "commit": {"oid": "ccedbc2154eba578d52315ced93f6d211ea95704"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QxNjozNDoyNlrOHATZGQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QxNjozNDoyNlrOHATZGQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDA3OTc2OQ==", "bodyText": "Should you either log here or throw an exception? If you just return, you would be silently failing, which is bad.", "url": "https://github.com/apache/helix/pull/1169#discussion_r470079769", "createdAt": "2020-08-13T16:34:26Z", "author": {"login": "narendly"}, "path": "helix-core/src/main/java/org/apache/helix/task/TaskStateModel.java", "diffHunk": "@@ -283,6 +287,68 @@ public void reset() {\n     }\n   }\n \n+  /**\n+   * Loads className using classLoader\n+   * @param classLoader\n+   * @param className\n+   * @return Class className loaded by classLoader\n+   */\n+  private Class loadClass(URLClassLoader classLoader, String className) {\n+    try {\n+      return classLoader.loadClass(className);\n+    } catch (ClassNotFoundException e) {\n+      LOG.error(\"Failed to load Task class \" + className + \" for new task in instance \" + _manager\n+          .getInstanceName() + \" in cluster \" + _manager.getClusterName() + \".\");\n+      throw new IllegalStateException(\"Class not found for task\");\n+    }\n+  }\n+\n+  /**\n+   * Loads Task and TaskFactory classes for command input from\n+   * a JAR file, and registers the TaskFactory in _taskFactoryRegistry.\n+   * @param command The command indicating what task to be loaded\n+   */\n+  private void loadNewTask(String command) {\n+    // If the path for dynamic tasks doesn't exist, skip loading the task\n+    if (!_manager.getHelixDataAccessor().getBaseDataAccessor()\n+        .exists(TaskConstants.DYNAMICALLY_LOADED_TASK_PATH, 0)) {\n+      return;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ccedbc2154eba578d52315ced93f6d211ea95704"}, "originalPosition": 47}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY2OTI5OTgx", "url": "https://github.com/apache/helix/pull/1169#pullrequestreview-466929981", "createdAt": "2020-08-13T16:35:00Z", "commit": {"oid": "ccedbc2154eba578d52315ced93f6d211ea95704"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QxNjozNTowMVrOHATaeA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QxNjozNTowMVrOHATaeA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDA4MDEyMA==", "bodyText": "Instead of 0 (a magic number), please use a static constant that's already defined in the library.", "url": "https://github.com/apache/helix/pull/1169#discussion_r470080120", "createdAt": "2020-08-13T16:35:01Z", "author": {"login": "narendly"}, "path": "helix-core/src/main/java/org/apache/helix/task/TaskStateModel.java", "diffHunk": "@@ -283,6 +287,68 @@ public void reset() {\n     }\n   }\n \n+  /**\n+   * Loads className using classLoader\n+   * @param classLoader\n+   * @param className\n+   * @return Class className loaded by classLoader\n+   */\n+  private Class loadClass(URLClassLoader classLoader, String className) {\n+    try {\n+      return classLoader.loadClass(className);\n+    } catch (ClassNotFoundException e) {\n+      LOG.error(\"Failed to load Task class \" + className + \" for new task in instance \" + _manager\n+          .getInstanceName() + \" in cluster \" + _manager.getClusterName() + \".\");\n+      throw new IllegalStateException(\"Class not found for task\");\n+    }\n+  }\n+\n+  /**\n+   * Loads Task and TaskFactory classes for command input from\n+   * a JAR file, and registers the TaskFactory in _taskFactoryRegistry.\n+   * @param command The command indicating what task to be loaded\n+   */\n+  private void loadNewTask(String command) {\n+    // If the path for dynamic tasks doesn't exist, skip loading the task\n+    if (!_manager.getHelixDataAccessor().getBaseDataAccessor()\n+        .exists(TaskConstants.DYNAMICALLY_LOADED_TASK_PATH, 0)) {\n+      return;\n+    }\n+\n+    // Read DynamicTaskConfig containing task definition information.\n+    DynamicTaskConfig taskConfig = new DynamicTaskConfig(\n+        _manager.getHelixDataAccessor().getBaseDataAccessor()\n+            .get(TaskConstants.DYNAMICALLY_LOADED_TASK_PATH + \"/\" + command, null, 0));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ccedbc2154eba578d52315ced93f6d211ea95704"}, "originalPosition": 53}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY2OTMwMzQw", "url": "https://github.com/apache/helix/pull/1169#pullrequestreview-466930340", "createdAt": "2020-08-13T16:35:30Z", "commit": {"oid": "ccedbc2154eba578d52315ced93f6d211ea95704"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QxNjozNTozMFrOHATbnQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QxNjozNTozMFrOHATbnQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDA4MDQxMw==", "bodyText": "Make the error message the same for the log and the exception?", "url": "https://github.com/apache/helix/pull/1169#discussion_r470080413", "createdAt": "2020-08-13T16:35:30Z", "author": {"login": "narendly"}, "path": "helix-core/src/main/java/org/apache/helix/task/TaskStateModel.java", "diffHunk": "@@ -283,6 +287,68 @@ public void reset() {\n     }\n   }\n \n+  /**\n+   * Loads className using classLoader\n+   * @param classLoader\n+   * @param className\n+   * @return Class className loaded by classLoader\n+   */\n+  private Class loadClass(URLClassLoader classLoader, String className) {\n+    try {\n+      return classLoader.loadClass(className);\n+    } catch (ClassNotFoundException e) {\n+      LOG.error(\"Failed to load Task class \" + className + \" for new task in instance \" + _manager\n+          .getInstanceName() + \" in cluster \" + _manager.getClusterName() + \".\");\n+      throw new IllegalStateException(\"Class not found for task\");\n+    }\n+  }\n+\n+  /**\n+   * Loads Task and TaskFactory classes for command input from\n+   * a JAR file, and registers the TaskFactory in _taskFactoryRegistry.\n+   * @param command The command indicating what task to be loaded\n+   */\n+  private void loadNewTask(String command) {\n+    // If the path for dynamic tasks doesn't exist, skip loading the task\n+    if (!_manager.getHelixDataAccessor().getBaseDataAccessor()\n+        .exists(TaskConstants.DYNAMICALLY_LOADED_TASK_PATH, 0)) {\n+      return;\n+    }\n+\n+    // Read DynamicTaskConfig containing task definition information.\n+    DynamicTaskConfig taskConfig = new DynamicTaskConfig(\n+        _manager.getHelixDataAccessor().getBaseDataAccessor()\n+            .get(TaskConstants.DYNAMICALLY_LOADED_TASK_PATH + \"/\" + command, null, 0));\n+    if (taskConfig.getTaskConfigZNRecord() == null) {\n+      LOG.error(\"Failed to read ZNRecord for task \" + command + \" for instance \" + _manager\n+          .getInstanceName() + \" in cluster \" + _manager.getClusterName() + \".\");\n+      throw new IllegalArgumentException(\"No ZNRecord for task \" + command);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ccedbc2154eba578d52315ced93f6d211ea95704"}, "originalPosition": 57}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY2OTMwODk1", "url": "https://github.com/apache/helix/pull/1169#pullrequestreview-466930895", "createdAt": "2020-08-13T16:36:13Z", "commit": {"oid": "ccedbc2154eba578d52315ced93f6d211ea95704"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QxNjozNjoxNFrOHATdQQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QxNjozNjoxNFrOHATdQQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDA4MDgzMw==", "bodyText": "nit: this piece of code could sit outside the try-catch?", "url": "https://github.com/apache/helix/pull/1169#discussion_r470080833", "createdAt": "2020-08-13T16:36:14Z", "author": {"login": "narendly"}, "path": "helix-core/src/main/java/org/apache/helix/task/TaskStateModel.java", "diffHunk": "@@ -283,6 +287,68 @@ public void reset() {\n     }\n   }\n \n+  /**\n+   * Loads className using classLoader\n+   * @param classLoader\n+   * @param className\n+   * @return Class className loaded by classLoader\n+   */\n+  private Class loadClass(URLClassLoader classLoader, String className) {\n+    try {\n+      return classLoader.loadClass(className);\n+    } catch (ClassNotFoundException e) {\n+      LOG.error(\"Failed to load Task class \" + className + \" for new task in instance \" + _manager\n+          .getInstanceName() + \" in cluster \" + _manager.getClusterName() + \".\");\n+      throw new IllegalStateException(\"Class not found for task\");\n+    }\n+  }\n+\n+  /**\n+   * Loads Task and TaskFactory classes for command input from\n+   * a JAR file, and registers the TaskFactory in _taskFactoryRegistry.\n+   * @param command The command indicating what task to be loaded\n+   */\n+  private void loadNewTask(String command) {\n+    // If the path for dynamic tasks doesn't exist, skip loading the task\n+    if (!_manager.getHelixDataAccessor().getBaseDataAccessor()\n+        .exists(TaskConstants.DYNAMICALLY_LOADED_TASK_PATH, 0)) {\n+      return;\n+    }\n+\n+    // Read DynamicTaskConfig containing task definition information.\n+    DynamicTaskConfig taskConfig = new DynamicTaskConfig(\n+        _manager.getHelixDataAccessor().getBaseDataAccessor()\n+            .get(TaskConstants.DYNAMICALLY_LOADED_TASK_PATH + \"/\" + command, null, 0));\n+    if (taskConfig.getTaskConfigZNRecord() == null) {\n+      LOG.error(\"Failed to read ZNRecord for task \" + command + \" for instance \" + _manager\n+          .getInstanceName() + \" in cluster \" + _manager.getClusterName() + \".\");\n+      throw new IllegalArgumentException(\"No ZNRecord for task \" + command);\n+    }\n+\n+    // Open the JAR file containing Task(s) and TaskFactory classes.\n+    JarLoader jarLoader = new LocalJarLoader();\n+    URL taskJarUrl = jarLoader.loadJar(taskConfig.getJarFilePath());\n+\n+    // Import Task(s) class(es).\n+    URLClassLoader classLoader = URLClassLoader.newInstance(new URL[]{taskJarUrl});\n+    for (String taskClass : taskConfig.getTaskClassesFqns()) {\n+      loadClass(classLoader, taskClass);\n+    }\n+\n+    try {\n+      // Import and instantiate TaskFactory class.\n+      TaskFactory taskFactory =\n+          (TaskFactory) loadClass(classLoader, taskConfig.getTaskFactoryFqn()).newInstance();\n+\n+      // Register the TaskFactory.\n+      _taskFactoryRegistry.put(command, taskFactory);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ccedbc2154eba578d52315ced93f6d211ea95704"}, "originalPosition": 76}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY2OTMxMjY2", "url": "https://github.com/apache/helix/pull/1169#pullrequestreview-466931266", "createdAt": "2020-08-13T16:36:45Z", "commit": {"oid": "ccedbc2154eba578d52315ced93f6d211ea95704"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QxNjozNjo0NVrOHATeaQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QxNjozNjo0NVrOHATeaQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDA4MTEyOQ==", "bodyText": "Make the error message uniform for logging and the exception for consistency?", "url": "https://github.com/apache/helix/pull/1169#discussion_r470081129", "createdAt": "2020-08-13T16:36:45Z", "author": {"login": "narendly"}, "path": "helix-core/src/main/java/org/apache/helix/task/TaskStateModel.java", "diffHunk": "@@ -283,6 +287,68 @@ public void reset() {\n     }\n   }\n \n+  /**\n+   * Loads className using classLoader\n+   * @param classLoader\n+   * @param className\n+   * @return Class className loaded by classLoader\n+   */\n+  private Class loadClass(URLClassLoader classLoader, String className) {\n+    try {\n+      return classLoader.loadClass(className);\n+    } catch (ClassNotFoundException e) {\n+      LOG.error(\"Failed to load Task class \" + className + \" for new task in instance \" + _manager\n+          .getInstanceName() + \" in cluster \" + _manager.getClusterName() + \".\");\n+      throw new IllegalStateException(\"Class not found for task\");\n+    }\n+  }\n+\n+  /**\n+   * Loads Task and TaskFactory classes for command input from\n+   * a JAR file, and registers the TaskFactory in _taskFactoryRegistry.\n+   * @param command The command indicating what task to be loaded\n+   */\n+  private void loadNewTask(String command) {\n+    // If the path for dynamic tasks doesn't exist, skip loading the task\n+    if (!_manager.getHelixDataAccessor().getBaseDataAccessor()\n+        .exists(TaskConstants.DYNAMICALLY_LOADED_TASK_PATH, 0)) {\n+      return;\n+    }\n+\n+    // Read DynamicTaskConfig containing task definition information.\n+    DynamicTaskConfig taskConfig = new DynamicTaskConfig(\n+        _manager.getHelixDataAccessor().getBaseDataAccessor()\n+            .get(TaskConstants.DYNAMICALLY_LOADED_TASK_PATH + \"/\" + command, null, 0));\n+    if (taskConfig.getTaskConfigZNRecord() == null) {\n+      LOG.error(\"Failed to read ZNRecord for task \" + command + \" for instance \" + _manager\n+          .getInstanceName() + \" in cluster \" + _manager.getClusterName() + \".\");\n+      throw new IllegalArgumentException(\"No ZNRecord for task \" + command);\n+    }\n+\n+    // Open the JAR file containing Task(s) and TaskFactory classes.\n+    JarLoader jarLoader = new LocalJarLoader();\n+    URL taskJarUrl = jarLoader.loadJar(taskConfig.getJarFilePath());\n+\n+    // Import Task(s) class(es).\n+    URLClassLoader classLoader = URLClassLoader.newInstance(new URL[]{taskJarUrl});\n+    for (String taskClass : taskConfig.getTaskClassesFqns()) {\n+      loadClass(classLoader, taskClass);\n+    }\n+\n+    try {\n+      // Import and instantiate TaskFactory class.\n+      TaskFactory taskFactory =\n+          (TaskFactory) loadClass(classLoader, taskConfig.getTaskFactoryFqn()).newInstance();\n+\n+      // Register the TaskFactory.\n+      _taskFactoryRegistry.put(command, taskFactory);\n+    } catch (InstantiationException | IllegalAccessException e) {\n+      LOG.error(\"Failed to instantiate TaskFactory class for new task in instance \" + _manager\n+          .getInstanceName() + \" in cluster \" + _manager.getClusterName() + \".\");\n+      throw new IllegalStateException(\"Failed to instantiate TaskFactory for task\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ccedbc2154eba578d52315ced93f6d211ea95704"}, "originalPosition": 80}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY2OTMyMDM0", "url": "https://github.com/apache/helix/pull/1169#pullrequestreview-466932034", "createdAt": "2020-08-13T16:37:50Z", "commit": {"oid": "ccedbc2154eba578d52315ced93f6d211ea95704"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QxNjozNzo1MFrOHATgvQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QxNjozNzo1MFrOHATgvQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDA4MTcyNQ==", "bodyText": "Please add a JavaDoc - a short paragraph about why and what kind of testing will be performed in this test.", "url": "https://github.com/apache/helix/pull/1169#discussion_r470081725", "createdAt": "2020-08-13T16:37:50Z", "author": {"login": "narendly"}, "path": "helix-core/src/test/java/org/apache/helix/task/TestDynamicTaskLoading.java", "diffHunk": "@@ -0,0 +1,251 @@\n+package org.apache.helix.task;\n+\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+import java.util.ArrayList;\n+import java.util.Collections;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+\n+import org.apache.helix.AccessOption;\n+import org.apache.helix.HelixException;\n+import org.apache.helix.HelixManager;\n+import org.apache.helix.HelixManagerFactory;\n+import org.apache.helix.InstanceType;\n+import org.apache.helix.TestHelper;\n+import org.apache.helix.common.ZkTestBase;\n+import org.apache.helix.examples.MasterSlaveStateModelFactory;\n+import org.apache.helix.integration.manager.ClusterControllerManager;\n+import org.apache.helix.integration.manager.MockParticipantManager;\n+import org.apache.helix.integration.task.MockTask;\n+import org.apache.helix.participant.StateMachineEngine;\n+import org.apache.helix.participant.statemachine.StateModel;\n+import org.apache.helix.participant.statemachine.StateModelFactory;\n+import org.testng.AssertJUnit;\n+import org.testng.annotations.AfterMethod;\n+import org.testng.annotations.BeforeMethod;\n+import org.testng.annotations.Test;\n+\n+public class TestDynamicTaskLoading extends ZkTestBase {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ccedbc2154eba578d52315ced93f6d211ea95704"}, "originalPosition": 47}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY2OTMyNDIx", "url": "https://github.com/apache/helix/pull/1169#pullrequestreview-466932421", "createdAt": "2020-08-13T16:38:20Z", "commit": {"oid": "ccedbc2154eba578d52315ced93f6d211ea95704"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QxNjozODoyMFrOHATh2g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QxNjozODoyMFrOHATh2g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDA4MjAxMA==", "bodyText": "For constants, use private static final, and the variable name would be all in caps.", "url": "https://github.com/apache/helix/pull/1169#discussion_r470082010", "createdAt": "2020-08-13T16:38:20Z", "author": {"login": "narendly"}, "path": "helix-core/src/test/java/org/apache/helix/task/TestDynamicTaskLoading.java", "diffHunk": "@@ -0,0 +1,251 @@\n+package org.apache.helix.task;\n+\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+import java.util.ArrayList;\n+import java.util.Collections;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+\n+import org.apache.helix.AccessOption;\n+import org.apache.helix.HelixException;\n+import org.apache.helix.HelixManager;\n+import org.apache.helix.HelixManagerFactory;\n+import org.apache.helix.InstanceType;\n+import org.apache.helix.TestHelper;\n+import org.apache.helix.common.ZkTestBase;\n+import org.apache.helix.examples.MasterSlaveStateModelFactory;\n+import org.apache.helix.integration.manager.ClusterControllerManager;\n+import org.apache.helix.integration.manager.MockParticipantManager;\n+import org.apache.helix.integration.task.MockTask;\n+import org.apache.helix.participant.StateMachineEngine;\n+import org.apache.helix.participant.statemachine.StateModel;\n+import org.apache.helix.participant.statemachine.StateModelFactory;\n+import org.testng.AssertJUnit;\n+import org.testng.annotations.AfterMethod;\n+import org.testng.annotations.BeforeMethod;\n+import org.testng.annotations.Test;\n+\n+public class TestDynamicTaskLoading extends ZkTestBase {\n+  private final String _clusterName = CLUSTER_PREFIX + \"_\" + getShortClassName();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ccedbc2154eba578d52315ced93f6d211ea95704"}, "originalPosition": 48}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY2OTMyNzk5", "url": "https://github.com/apache/helix/pull/1169#pullrequestreview-466932799", "createdAt": "2020-08-13T16:38:49Z", "commit": {"oid": "ccedbc2154eba578d52315ced93f6d211ea95704"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QxNjozODo0OVrOHATjBQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QxNjozODo0OVrOHATjBQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDA4MjMwOQ==", "bodyText": "Please follow the code style guidelines (google how to define Java constants).", "url": "https://github.com/apache/helix/pull/1169#discussion_r470082309", "createdAt": "2020-08-13T16:38:49Z", "author": {"login": "narendly"}, "path": "helix-core/src/test/java/org/apache/helix/task/TestDynamicTaskLoading.java", "diffHunk": "@@ -0,0 +1,251 @@\n+package org.apache.helix.task;\n+\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+import java.util.ArrayList;\n+import java.util.Collections;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+\n+import org.apache.helix.AccessOption;\n+import org.apache.helix.HelixException;\n+import org.apache.helix.HelixManager;\n+import org.apache.helix.HelixManagerFactory;\n+import org.apache.helix.InstanceType;\n+import org.apache.helix.TestHelper;\n+import org.apache.helix.common.ZkTestBase;\n+import org.apache.helix.examples.MasterSlaveStateModelFactory;\n+import org.apache.helix.integration.manager.ClusterControllerManager;\n+import org.apache.helix.integration.manager.MockParticipantManager;\n+import org.apache.helix.integration.task.MockTask;\n+import org.apache.helix.participant.StateMachineEngine;\n+import org.apache.helix.participant.statemachine.StateModel;\n+import org.apache.helix.participant.statemachine.StateModelFactory;\n+import org.testng.AssertJUnit;\n+import org.testng.annotations.AfterMethod;\n+import org.testng.annotations.BeforeMethod;\n+import org.testng.annotations.Test;\n+\n+public class TestDynamicTaskLoading extends ZkTestBase {\n+  private final String _clusterName = CLUSTER_PREFIX + \"_\" + getShortClassName();\n+  private static final String _instanceName = \"localhost_12913\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ccedbc2154eba578d52315ced93f6d211ea95704"}, "originalPosition": 49}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY2OTMzMTY5", "url": "https://github.com/apache/helix/pull/1169#pullrequestreview-466933169", "createdAt": "2020-08-13T16:39:20Z", "commit": {"oid": "ccedbc2154eba578d52315ced93f6d211ea95704"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QxNjozOToyMFrOHATkRw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QxNjozOToyMFrOHATkRw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDA4MjYzMQ==", "bodyText": "Do you really want a beforeMethod or a beforeClass?", "url": "https://github.com/apache/helix/pull/1169#discussion_r470082631", "createdAt": "2020-08-13T16:39:20Z", "author": {"login": "narendly"}, "path": "helix-core/src/test/java/org/apache/helix/task/TestDynamicTaskLoading.java", "diffHunk": "@@ -0,0 +1,251 @@\n+package org.apache.helix.task;\n+\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+import java.util.ArrayList;\n+import java.util.Collections;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+\n+import org.apache.helix.AccessOption;\n+import org.apache.helix.HelixException;\n+import org.apache.helix.HelixManager;\n+import org.apache.helix.HelixManagerFactory;\n+import org.apache.helix.InstanceType;\n+import org.apache.helix.TestHelper;\n+import org.apache.helix.common.ZkTestBase;\n+import org.apache.helix.examples.MasterSlaveStateModelFactory;\n+import org.apache.helix.integration.manager.ClusterControllerManager;\n+import org.apache.helix.integration.manager.MockParticipantManager;\n+import org.apache.helix.integration.task.MockTask;\n+import org.apache.helix.participant.StateMachineEngine;\n+import org.apache.helix.participant.statemachine.StateModel;\n+import org.apache.helix.participant.statemachine.StateModelFactory;\n+import org.testng.AssertJUnit;\n+import org.testng.annotations.AfterMethod;\n+import org.testng.annotations.BeforeMethod;\n+import org.testng.annotations.Test;\n+\n+public class TestDynamicTaskLoading extends ZkTestBase {\n+  private final String _clusterName = CLUSTER_PREFIX + \"_\" + getShortClassName();\n+  private static final String _instanceName = \"localhost_12913\";\n+  private HelixManager _manager;\n+  private MockParticipantManager _participant;\n+  private ClusterControllerManager _controller;\n+\n+  @BeforeMethod\n+  public void beforeMethod() throws Exception {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ccedbc2154eba578d52315ced93f6d211ea95704"}, "originalPosition": 55}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY2OTMzNDE3", "url": "https://github.com/apache/helix/pull/1169#pullrequestreview-466933417", "createdAt": "2020-08-13T16:39:38Z", "commit": {"oid": "ccedbc2154eba578d52315ced93f6d211ea95704"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QxNjozOTozOFrOHATlGQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QxNjozOTozOFrOHATlGQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDA4Mjg0MQ==", "bodyText": "Is 0 a magic number?", "url": "https://github.com/apache/helix/pull/1169#discussion_r470082841", "createdAt": "2020-08-13T16:39:38Z", "author": {"login": "narendly"}, "path": "helix-core/src/test/java/org/apache/helix/task/TestDynamicTaskLoading.java", "diffHunk": "@@ -0,0 +1,251 @@\n+package org.apache.helix.task;\n+\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+import java.util.ArrayList;\n+import java.util.Collections;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+\n+import org.apache.helix.AccessOption;\n+import org.apache.helix.HelixException;\n+import org.apache.helix.HelixManager;\n+import org.apache.helix.HelixManagerFactory;\n+import org.apache.helix.InstanceType;\n+import org.apache.helix.TestHelper;\n+import org.apache.helix.common.ZkTestBase;\n+import org.apache.helix.examples.MasterSlaveStateModelFactory;\n+import org.apache.helix.integration.manager.ClusterControllerManager;\n+import org.apache.helix.integration.manager.MockParticipantManager;\n+import org.apache.helix.integration.task.MockTask;\n+import org.apache.helix.participant.StateMachineEngine;\n+import org.apache.helix.participant.statemachine.StateModel;\n+import org.apache.helix.participant.statemachine.StateModelFactory;\n+import org.testng.AssertJUnit;\n+import org.testng.annotations.AfterMethod;\n+import org.testng.annotations.BeforeMethod;\n+import org.testng.annotations.Test;\n+\n+public class TestDynamicTaskLoading extends ZkTestBase {\n+  private final String _clusterName = CLUSTER_PREFIX + \"_\" + getShortClassName();\n+  private static final String _instanceName = \"localhost_12913\";\n+  private HelixManager _manager;\n+  private MockParticipantManager _participant;\n+  private ClusterControllerManager _controller;\n+\n+  @BeforeMethod\n+  public void beforeMethod() throws Exception {\n+    _gSetupTool.addCluster(_clusterName, true);\n+\n+    _manager = HelixManagerFactory\n+        .getZKHelixManager(_clusterName, \"Admin\", InstanceType.ADMINISTRATOR, ZK_ADDR);\n+    _manager.connect();\n+\n+    _gSetupTool.addInstanceToCluster(_clusterName, _instanceName);\n+    _participant = new MockParticipantManager(ZK_ADDR, _clusterName, _instanceName);\n+    StateModelFactory<StateModel> stateModelFactory =\n+        new MasterSlaveStateModelFactory(_instanceName, 0);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ccedbc2154eba578d52315ced93f6d211ea95704"}, "originalPosition": 65}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY2OTMzNjcy", "url": "https://github.com/apache/helix/pull/1169#pullrequestreview-466933672", "createdAt": "2020-08-13T16:39:57Z", "commit": {"oid": "ccedbc2154eba578d52315ced93f6d211ea95704"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QxNjozOTo1N1rOHATlyQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QxNjozOTo1N1rOHATlyQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDA4MzAxNw==", "bodyText": "Don't we already have a static constant defined for \"MasterSlave\"?", "url": "https://github.com/apache/helix/pull/1169#discussion_r470083017", "createdAt": "2020-08-13T16:39:57Z", "author": {"login": "narendly"}, "path": "helix-core/src/test/java/org/apache/helix/task/TestDynamicTaskLoading.java", "diffHunk": "@@ -0,0 +1,251 @@\n+package org.apache.helix.task;\n+\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+import java.util.ArrayList;\n+import java.util.Collections;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+\n+import org.apache.helix.AccessOption;\n+import org.apache.helix.HelixException;\n+import org.apache.helix.HelixManager;\n+import org.apache.helix.HelixManagerFactory;\n+import org.apache.helix.InstanceType;\n+import org.apache.helix.TestHelper;\n+import org.apache.helix.common.ZkTestBase;\n+import org.apache.helix.examples.MasterSlaveStateModelFactory;\n+import org.apache.helix.integration.manager.ClusterControllerManager;\n+import org.apache.helix.integration.manager.MockParticipantManager;\n+import org.apache.helix.integration.task.MockTask;\n+import org.apache.helix.participant.StateMachineEngine;\n+import org.apache.helix.participant.statemachine.StateModel;\n+import org.apache.helix.participant.statemachine.StateModelFactory;\n+import org.testng.AssertJUnit;\n+import org.testng.annotations.AfterMethod;\n+import org.testng.annotations.BeforeMethod;\n+import org.testng.annotations.Test;\n+\n+public class TestDynamicTaskLoading extends ZkTestBase {\n+  private final String _clusterName = CLUSTER_PREFIX + \"_\" + getShortClassName();\n+  private static final String _instanceName = \"localhost_12913\";\n+  private HelixManager _manager;\n+  private MockParticipantManager _participant;\n+  private ClusterControllerManager _controller;\n+\n+  @BeforeMethod\n+  public void beforeMethod() throws Exception {\n+    _gSetupTool.addCluster(_clusterName, true);\n+\n+    _manager = HelixManagerFactory\n+        .getZKHelixManager(_clusterName, \"Admin\", InstanceType.ADMINISTRATOR, ZK_ADDR);\n+    _manager.connect();\n+\n+    _gSetupTool.addInstanceToCluster(_clusterName, _instanceName);\n+    _participant = new MockParticipantManager(ZK_ADDR, _clusterName, _instanceName);\n+    StateModelFactory<StateModel> stateModelFactory =\n+        new MasterSlaveStateModelFactory(_instanceName, 0);\n+    StateMachineEngine stateMach = _participant.getStateMachineEngine();\n+    stateMach.registerStateModelFactory(\"MasterSlave\", stateModelFactory);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ccedbc2154eba578d52315ced93f6d211ea95704"}, "originalPosition": 67}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY2OTM0OTUy", "url": "https://github.com/apache/helix/pull/1169#pullrequestreview-466934952", "createdAt": "2020-08-13T16:41:33Z", "commit": {"oid": "ccedbc2154eba578d52315ced93f6d211ea95704"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QxNjo0MTozM1rOHATpnw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QxNjo0MTozM1rOHATpnw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDA4Mzk5OQ==", "bodyText": "Pull out your strings and name them as a local variable - for example,\nString fullyQualifiedTaskClassName = \"com.mycompany.mocktask.MockTask\"; \nString taskVersion = \"1.0.0\";\n\n...\nfor readability.", "url": "https://github.com/apache/helix/pull/1169#discussion_r470083999", "createdAt": "2020-08-13T16:41:33Z", "author": {"login": "narendly"}, "path": "helix-core/src/test/java/org/apache/helix/task/TestDynamicTaskLoading.java", "diffHunk": "@@ -0,0 +1,251 @@\n+package org.apache.helix.task;\n+\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+import java.util.ArrayList;\n+import java.util.Collections;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+\n+import org.apache.helix.AccessOption;\n+import org.apache.helix.HelixException;\n+import org.apache.helix.HelixManager;\n+import org.apache.helix.HelixManagerFactory;\n+import org.apache.helix.InstanceType;\n+import org.apache.helix.TestHelper;\n+import org.apache.helix.common.ZkTestBase;\n+import org.apache.helix.examples.MasterSlaveStateModelFactory;\n+import org.apache.helix.integration.manager.ClusterControllerManager;\n+import org.apache.helix.integration.manager.MockParticipantManager;\n+import org.apache.helix.integration.task.MockTask;\n+import org.apache.helix.participant.StateMachineEngine;\n+import org.apache.helix.participant.statemachine.StateModel;\n+import org.apache.helix.participant.statemachine.StateModelFactory;\n+import org.testng.AssertJUnit;\n+import org.testng.annotations.AfterMethod;\n+import org.testng.annotations.BeforeMethod;\n+import org.testng.annotations.Test;\n+\n+public class TestDynamicTaskLoading extends ZkTestBase {\n+  private final String _clusterName = CLUSTER_PREFIX + \"_\" + getShortClassName();\n+  private static final String _instanceName = \"localhost_12913\";\n+  private HelixManager _manager;\n+  private MockParticipantManager _participant;\n+  private ClusterControllerManager _controller;\n+\n+  @BeforeMethod\n+  public void beforeMethod() throws Exception {\n+    _gSetupTool.addCluster(_clusterName, true);\n+\n+    _manager = HelixManagerFactory\n+        .getZKHelixManager(_clusterName, \"Admin\", InstanceType.ADMINISTRATOR, ZK_ADDR);\n+    _manager.connect();\n+\n+    _gSetupTool.addInstanceToCluster(_clusterName, _instanceName);\n+    _participant = new MockParticipantManager(ZK_ADDR, _clusterName, _instanceName);\n+    StateModelFactory<StateModel> stateModelFactory =\n+        new MasterSlaveStateModelFactory(_instanceName, 0);\n+    StateMachineEngine stateMach = _participant.getStateMachineEngine();\n+    stateMach.registerStateModelFactory(\"MasterSlave\", stateModelFactory);\n+    Map<String, TaskFactory> taskFactoryReg = new HashMap<>();\n+    _participant.getStateMachineEngine().registerStateModelFactory(TaskConstants.STATE_MODEL_NAME,\n+        new TaskStateModelFactory(_participant, taskFactoryReg));\n+    _participant.syncStart();\n+\n+    _controller = new ClusterControllerManager(ZK_ADDR, _clusterName, null);\n+    _controller.syncStart();\n+  }\n+\n+  private void removePathIfExists(String path) {\n+    if (_manager.getHelixDataAccessor().getBaseDataAccessor().exists(path, 0)) {\n+      _manager.getHelixDataAccessor().getBaseDataAccessor().remove(path, 0);\n+    }\n+  }\n+\n+  /**\n+   * Submit a workflow consisting of a job with a MockTask task.\n+   * @param workflowName name of the workflow\n+   * @param driver {@link TaskDriver} to submit workflowName to\n+   */\n+  private void submitWorkflow(String workflowName, TaskDriver driver) {\n+    JobConfig.Builder job = new JobConfig.Builder();\n+    job.setJobCommandConfigMap(Collections.singletonMap(MockTask.JOB_DELAY, \"100\"));\n+    Workflow.Builder workflow = new Workflow.Builder(workflowName);\n+    job.setWorkflow(workflowName);\n+    TaskConfig taskConfig =\n+        new TaskConfig(MockTask.TASK_COMMAND, new HashMap<String, String>(), null, null);\n+    job.addTaskConfigMap(Collections.singletonMap(taskConfig.getId(), taskConfig));\n+    job.setJobId(TaskUtil.getNamespacedJobName(workflowName, \"JOB\"));\n+    workflow.addJob(\"JOB\", job);\n+    driver.start(workflow.build());\n+  }\n+\n+  @Test\n+  public void testDynamicTaskLoading() throws Exception {\n+    // Add task definition information as a DynamicTaskConfig.\n+    List<String> taskClasses = new ArrayList<String>();\n+    taskClasses.add(\"com.mycompany.mocktask.MockTask\");\n+    DynamicTaskConfig taskConfig =\n+        new DynamicTaskConfig(\"Reindex\", \"src/test/resources/Reindex.jar\", \"1.0.0\", taskClasses,\n+            \"com.mycompany.mocktask.MockTaskFactory\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ccedbc2154eba578d52315ced93f6d211ea95704"}, "originalPosition": 108}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY2OTM1NTk0", "url": "https://github.com/apache/helix/pull/1169#pullrequestreview-466935594", "createdAt": "2020-08-13T16:42:24Z", "commit": {"oid": "ccedbc2154eba578d52315ced93f6d211ea95704"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QxNjo0MjoyNFrOHATrgQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QxNjo0MjoyNFrOHATrgQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDA4NDQ4MQ==", "bodyText": "Use Assert.assertEquals instead of AssertJUnit? Please remove all usages & import of AssertJUnit.", "url": "https://github.com/apache/helix/pull/1169#discussion_r470084481", "createdAt": "2020-08-13T16:42:24Z", "author": {"login": "narendly"}, "path": "helix-core/src/test/java/org/apache/helix/task/TestDynamicTaskLoading.java", "diffHunk": "@@ -0,0 +1,251 @@\n+package org.apache.helix.task;\n+\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+import java.util.ArrayList;\n+import java.util.Collections;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+\n+import org.apache.helix.AccessOption;\n+import org.apache.helix.HelixException;\n+import org.apache.helix.HelixManager;\n+import org.apache.helix.HelixManagerFactory;\n+import org.apache.helix.InstanceType;\n+import org.apache.helix.TestHelper;\n+import org.apache.helix.common.ZkTestBase;\n+import org.apache.helix.examples.MasterSlaveStateModelFactory;\n+import org.apache.helix.integration.manager.ClusterControllerManager;\n+import org.apache.helix.integration.manager.MockParticipantManager;\n+import org.apache.helix.integration.task.MockTask;\n+import org.apache.helix.participant.StateMachineEngine;\n+import org.apache.helix.participant.statemachine.StateModel;\n+import org.apache.helix.participant.statemachine.StateModelFactory;\n+import org.testng.AssertJUnit;\n+import org.testng.annotations.AfterMethod;\n+import org.testng.annotations.BeforeMethod;\n+import org.testng.annotations.Test;\n+\n+public class TestDynamicTaskLoading extends ZkTestBase {\n+  private final String _clusterName = CLUSTER_PREFIX + \"_\" + getShortClassName();\n+  private static final String _instanceName = \"localhost_12913\";\n+  private HelixManager _manager;\n+  private MockParticipantManager _participant;\n+  private ClusterControllerManager _controller;\n+\n+  @BeforeMethod\n+  public void beforeMethod() throws Exception {\n+    _gSetupTool.addCluster(_clusterName, true);\n+\n+    _manager = HelixManagerFactory\n+        .getZKHelixManager(_clusterName, \"Admin\", InstanceType.ADMINISTRATOR, ZK_ADDR);\n+    _manager.connect();\n+\n+    _gSetupTool.addInstanceToCluster(_clusterName, _instanceName);\n+    _participant = new MockParticipantManager(ZK_ADDR, _clusterName, _instanceName);\n+    StateModelFactory<StateModel> stateModelFactory =\n+        new MasterSlaveStateModelFactory(_instanceName, 0);\n+    StateMachineEngine stateMach = _participant.getStateMachineEngine();\n+    stateMach.registerStateModelFactory(\"MasterSlave\", stateModelFactory);\n+    Map<String, TaskFactory> taskFactoryReg = new HashMap<>();\n+    _participant.getStateMachineEngine().registerStateModelFactory(TaskConstants.STATE_MODEL_NAME,\n+        new TaskStateModelFactory(_participant, taskFactoryReg));\n+    _participant.syncStart();\n+\n+    _controller = new ClusterControllerManager(ZK_ADDR, _clusterName, null);\n+    _controller.syncStart();\n+  }\n+\n+  private void removePathIfExists(String path) {\n+    if (_manager.getHelixDataAccessor().getBaseDataAccessor().exists(path, 0)) {\n+      _manager.getHelixDataAccessor().getBaseDataAccessor().remove(path, 0);\n+    }\n+  }\n+\n+  /**\n+   * Submit a workflow consisting of a job with a MockTask task.\n+   * @param workflowName name of the workflow\n+   * @param driver {@link TaskDriver} to submit workflowName to\n+   */\n+  private void submitWorkflow(String workflowName, TaskDriver driver) {\n+    JobConfig.Builder job = new JobConfig.Builder();\n+    job.setJobCommandConfigMap(Collections.singletonMap(MockTask.JOB_DELAY, \"100\"));\n+    Workflow.Builder workflow = new Workflow.Builder(workflowName);\n+    job.setWorkflow(workflowName);\n+    TaskConfig taskConfig =\n+        new TaskConfig(MockTask.TASK_COMMAND, new HashMap<String, String>(), null, null);\n+    job.addTaskConfigMap(Collections.singletonMap(taskConfig.getId(), taskConfig));\n+    job.setJobId(TaskUtil.getNamespacedJobName(workflowName, \"JOB\"));\n+    workflow.addJob(\"JOB\", job);\n+    driver.start(workflow.build());\n+  }\n+\n+  @Test\n+  public void testDynamicTaskLoading() throws Exception {\n+    // Add task definition information as a DynamicTaskConfig.\n+    List<String> taskClasses = new ArrayList<String>();\n+    taskClasses.add(\"com.mycompany.mocktask.MockTask\");\n+    DynamicTaskConfig taskConfig =\n+        new DynamicTaskConfig(\"Reindex\", \"src/test/resources/Reindex.jar\", \"1.0.0\", taskClasses,\n+            \"com.mycompany.mocktask.MockTaskFactory\");\n+    String path = TaskConstants.DYNAMICALLY_LOADED_TASK_PATH + \"/Reindex\";\n+    removePathIfExists(path);\n+    _manager.getHelixDataAccessor().getBaseDataAccessor()\n+        .create(path, taskConfig.getTaskConfigZNRecord(), AccessOption.PERSISTENT);\n+\n+    // Submit workflow\n+    TaskDriver driver = new TaskDriver(_manager);\n+    String workflowName = TestHelper.getTestMethodName();\n+    submitWorkflow(workflowName, driver);\n+\n+    try {\n+      // Wait for the workflow to either complete or fail.\n+      TaskState finalState =\n+          driver.pollForWorkflowState(workflowName, TaskState.COMPLETED, TaskState.FAILED);\n+      AssertJUnit.assertEquals(finalState, TaskState.COMPLETED);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ccedbc2154eba578d52315ced93f6d211ea95704"}, "originalPosition": 123}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY2OTM1NzMz", "url": "https://github.com/apache/helix/pull/1169#pullrequestreview-466935733", "createdAt": "2020-08-13T16:42:35Z", "commit": {"oid": "ccedbc2154eba578d52315ced93f6d211ea95704"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QxNjo0MjozNVrOHATsBA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QxNjo0MjozNVrOHATsBA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDA4NDYxMg==", "bodyText": "Assert.fail? Also it's throwing an exception anyway, so why don't we just have it throw an exception instead of doing Assert.fail?", "url": "https://github.com/apache/helix/pull/1169#discussion_r470084612", "createdAt": "2020-08-13T16:42:35Z", "author": {"login": "narendly"}, "path": "helix-core/src/test/java/org/apache/helix/task/TestDynamicTaskLoading.java", "diffHunk": "@@ -0,0 +1,251 @@\n+package org.apache.helix.task;\n+\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+import java.util.ArrayList;\n+import java.util.Collections;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+\n+import org.apache.helix.AccessOption;\n+import org.apache.helix.HelixException;\n+import org.apache.helix.HelixManager;\n+import org.apache.helix.HelixManagerFactory;\n+import org.apache.helix.InstanceType;\n+import org.apache.helix.TestHelper;\n+import org.apache.helix.common.ZkTestBase;\n+import org.apache.helix.examples.MasterSlaveStateModelFactory;\n+import org.apache.helix.integration.manager.ClusterControllerManager;\n+import org.apache.helix.integration.manager.MockParticipantManager;\n+import org.apache.helix.integration.task.MockTask;\n+import org.apache.helix.participant.StateMachineEngine;\n+import org.apache.helix.participant.statemachine.StateModel;\n+import org.apache.helix.participant.statemachine.StateModelFactory;\n+import org.testng.AssertJUnit;\n+import org.testng.annotations.AfterMethod;\n+import org.testng.annotations.BeforeMethod;\n+import org.testng.annotations.Test;\n+\n+public class TestDynamicTaskLoading extends ZkTestBase {\n+  private final String _clusterName = CLUSTER_PREFIX + \"_\" + getShortClassName();\n+  private static final String _instanceName = \"localhost_12913\";\n+  private HelixManager _manager;\n+  private MockParticipantManager _participant;\n+  private ClusterControllerManager _controller;\n+\n+  @BeforeMethod\n+  public void beforeMethod() throws Exception {\n+    _gSetupTool.addCluster(_clusterName, true);\n+\n+    _manager = HelixManagerFactory\n+        .getZKHelixManager(_clusterName, \"Admin\", InstanceType.ADMINISTRATOR, ZK_ADDR);\n+    _manager.connect();\n+\n+    _gSetupTool.addInstanceToCluster(_clusterName, _instanceName);\n+    _participant = new MockParticipantManager(ZK_ADDR, _clusterName, _instanceName);\n+    StateModelFactory<StateModel> stateModelFactory =\n+        new MasterSlaveStateModelFactory(_instanceName, 0);\n+    StateMachineEngine stateMach = _participant.getStateMachineEngine();\n+    stateMach.registerStateModelFactory(\"MasterSlave\", stateModelFactory);\n+    Map<String, TaskFactory> taskFactoryReg = new HashMap<>();\n+    _participant.getStateMachineEngine().registerStateModelFactory(TaskConstants.STATE_MODEL_NAME,\n+        new TaskStateModelFactory(_participant, taskFactoryReg));\n+    _participant.syncStart();\n+\n+    _controller = new ClusterControllerManager(ZK_ADDR, _clusterName, null);\n+    _controller.syncStart();\n+  }\n+\n+  private void removePathIfExists(String path) {\n+    if (_manager.getHelixDataAccessor().getBaseDataAccessor().exists(path, 0)) {\n+      _manager.getHelixDataAccessor().getBaseDataAccessor().remove(path, 0);\n+    }\n+  }\n+\n+  /**\n+   * Submit a workflow consisting of a job with a MockTask task.\n+   * @param workflowName name of the workflow\n+   * @param driver {@link TaskDriver} to submit workflowName to\n+   */\n+  private void submitWorkflow(String workflowName, TaskDriver driver) {\n+    JobConfig.Builder job = new JobConfig.Builder();\n+    job.setJobCommandConfigMap(Collections.singletonMap(MockTask.JOB_DELAY, \"100\"));\n+    Workflow.Builder workflow = new Workflow.Builder(workflowName);\n+    job.setWorkflow(workflowName);\n+    TaskConfig taskConfig =\n+        new TaskConfig(MockTask.TASK_COMMAND, new HashMap<String, String>(), null, null);\n+    job.addTaskConfigMap(Collections.singletonMap(taskConfig.getId(), taskConfig));\n+    job.setJobId(TaskUtil.getNamespacedJobName(workflowName, \"JOB\"));\n+    workflow.addJob(\"JOB\", job);\n+    driver.start(workflow.build());\n+  }\n+\n+  @Test\n+  public void testDynamicTaskLoading() throws Exception {\n+    // Add task definition information as a DynamicTaskConfig.\n+    List<String> taskClasses = new ArrayList<String>();\n+    taskClasses.add(\"com.mycompany.mocktask.MockTask\");\n+    DynamicTaskConfig taskConfig =\n+        new DynamicTaskConfig(\"Reindex\", \"src/test/resources/Reindex.jar\", \"1.0.0\", taskClasses,\n+            \"com.mycompany.mocktask.MockTaskFactory\");\n+    String path = TaskConstants.DYNAMICALLY_LOADED_TASK_PATH + \"/Reindex\";\n+    removePathIfExists(path);\n+    _manager.getHelixDataAccessor().getBaseDataAccessor()\n+        .create(path, taskConfig.getTaskConfigZNRecord(), AccessOption.PERSISTENT);\n+\n+    // Submit workflow\n+    TaskDriver driver = new TaskDriver(_manager);\n+    String workflowName = TestHelper.getTestMethodName();\n+    submitWorkflow(workflowName, driver);\n+\n+    try {\n+      // Wait for the workflow to either complete or fail.\n+      TaskState finalState =\n+          driver.pollForWorkflowState(workflowName, TaskState.COMPLETED, TaskState.FAILED);\n+      AssertJUnit.assertEquals(finalState, TaskState.COMPLETED);\n+    } catch (HelixException e) {\n+      AssertJUnit.fail(e.getMessage());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ccedbc2154eba578d52315ced93f6d211ea95704"}, "originalPosition": 125}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY2OTM2OTM2", "url": "https://github.com/apache/helix/pull/1169#pullrequestreview-466936936", "createdAt": "2020-08-13T16:44:07Z", "commit": {"oid": "ccedbc2154eba578d52315ced93f6d211ea95704"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QxNjo0NDowN1rOHATvZQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QxNjo0NDowN1rOHATvZQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDA4NTQ3Nw==", "bodyText": "<String> is not necessary in new ArrayList<String>(); Are you sure you're coding in Java 8? Please fix up your environment.", "url": "https://github.com/apache/helix/pull/1169#discussion_r470085477", "createdAt": "2020-08-13T16:44:07Z", "author": {"login": "narendly"}, "path": "helix-core/src/test/java/org/apache/helix/task/TestDynamicTaskLoading.java", "diffHunk": "@@ -0,0 +1,251 @@\n+package org.apache.helix.task;\n+\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+import java.util.ArrayList;\n+import java.util.Collections;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+\n+import org.apache.helix.AccessOption;\n+import org.apache.helix.HelixException;\n+import org.apache.helix.HelixManager;\n+import org.apache.helix.HelixManagerFactory;\n+import org.apache.helix.InstanceType;\n+import org.apache.helix.TestHelper;\n+import org.apache.helix.common.ZkTestBase;\n+import org.apache.helix.examples.MasterSlaveStateModelFactory;\n+import org.apache.helix.integration.manager.ClusterControllerManager;\n+import org.apache.helix.integration.manager.MockParticipantManager;\n+import org.apache.helix.integration.task.MockTask;\n+import org.apache.helix.participant.StateMachineEngine;\n+import org.apache.helix.participant.statemachine.StateModel;\n+import org.apache.helix.participant.statemachine.StateModelFactory;\n+import org.testng.AssertJUnit;\n+import org.testng.annotations.AfterMethod;\n+import org.testng.annotations.BeforeMethod;\n+import org.testng.annotations.Test;\n+\n+public class TestDynamicTaskLoading extends ZkTestBase {\n+  private final String _clusterName = CLUSTER_PREFIX + \"_\" + getShortClassName();\n+  private static final String _instanceName = \"localhost_12913\";\n+  private HelixManager _manager;\n+  private MockParticipantManager _participant;\n+  private ClusterControllerManager _controller;\n+\n+  @BeforeMethod\n+  public void beforeMethod() throws Exception {\n+    _gSetupTool.addCluster(_clusterName, true);\n+\n+    _manager = HelixManagerFactory\n+        .getZKHelixManager(_clusterName, \"Admin\", InstanceType.ADMINISTRATOR, ZK_ADDR);\n+    _manager.connect();\n+\n+    _gSetupTool.addInstanceToCluster(_clusterName, _instanceName);\n+    _participant = new MockParticipantManager(ZK_ADDR, _clusterName, _instanceName);\n+    StateModelFactory<StateModel> stateModelFactory =\n+        new MasterSlaveStateModelFactory(_instanceName, 0);\n+    StateMachineEngine stateMach = _participant.getStateMachineEngine();\n+    stateMach.registerStateModelFactory(\"MasterSlave\", stateModelFactory);\n+    Map<String, TaskFactory> taskFactoryReg = new HashMap<>();\n+    _participant.getStateMachineEngine().registerStateModelFactory(TaskConstants.STATE_MODEL_NAME,\n+        new TaskStateModelFactory(_participant, taskFactoryReg));\n+    _participant.syncStart();\n+\n+    _controller = new ClusterControllerManager(ZK_ADDR, _clusterName, null);\n+    _controller.syncStart();\n+  }\n+\n+  private void removePathIfExists(String path) {\n+    if (_manager.getHelixDataAccessor().getBaseDataAccessor().exists(path, 0)) {\n+      _manager.getHelixDataAccessor().getBaseDataAccessor().remove(path, 0);\n+    }\n+  }\n+\n+  /**\n+   * Submit a workflow consisting of a job with a MockTask task.\n+   * @param workflowName name of the workflow\n+   * @param driver {@link TaskDriver} to submit workflowName to\n+   */\n+  private void submitWorkflow(String workflowName, TaskDriver driver) {\n+    JobConfig.Builder job = new JobConfig.Builder();\n+    job.setJobCommandConfigMap(Collections.singletonMap(MockTask.JOB_DELAY, \"100\"));\n+    Workflow.Builder workflow = new Workflow.Builder(workflowName);\n+    job.setWorkflow(workflowName);\n+    TaskConfig taskConfig =\n+        new TaskConfig(MockTask.TASK_COMMAND, new HashMap<String, String>(), null, null);\n+    job.addTaskConfigMap(Collections.singletonMap(taskConfig.getId(), taskConfig));\n+    job.setJobId(TaskUtil.getNamespacedJobName(workflowName, \"JOB\"));\n+    workflow.addJob(\"JOB\", job);\n+    driver.start(workflow.build());\n+  }\n+\n+  @Test\n+  public void testDynamicTaskLoading() throws Exception {\n+    // Add task definition information as a DynamicTaskConfig.\n+    List<String> taskClasses = new ArrayList<String>();\n+    taskClasses.add(\"com.mycompany.mocktask.MockTask\");\n+    DynamicTaskConfig taskConfig =\n+        new DynamicTaskConfig(\"Reindex\", \"src/test/resources/Reindex.jar\", \"1.0.0\", taskClasses,\n+            \"com.mycompany.mocktask.MockTaskFactory\");\n+    String path = TaskConstants.DYNAMICALLY_LOADED_TASK_PATH + \"/Reindex\";\n+    removePathIfExists(path);\n+    _manager.getHelixDataAccessor().getBaseDataAccessor()\n+        .create(path, taskConfig.getTaskConfigZNRecord(), AccessOption.PERSISTENT);\n+\n+    // Submit workflow\n+    TaskDriver driver = new TaskDriver(_manager);\n+    String workflowName = TestHelper.getTestMethodName();\n+    submitWorkflow(workflowName, driver);\n+\n+    try {\n+      // Wait for the workflow to either complete or fail.\n+      TaskState finalState =\n+          driver.pollForWorkflowState(workflowName, TaskState.COMPLETED, TaskState.FAILED);\n+      AssertJUnit.assertEquals(finalState, TaskState.COMPLETED);\n+    } catch (HelixException e) {\n+      AssertJUnit.fail(e.getMessage());\n+    }\n+  }\n+\n+  @Test\n+  public void testDynamicTaskLoadingNonexistingJar() throws Exception {\n+    // Add task definition information as a DynamicTaskConfig.\n+    List<String> taskClasses = new ArrayList<String>();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ccedbc2154eba578d52315ced93f6d211ea95704"}, "originalPosition": 132}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY2OTM3MjE1", "url": "https://github.com/apache/helix/pull/1169#pullrequestreview-466937215", "createdAt": "2020-08-13T16:44:31Z", "commit": {"oid": "ccedbc2154eba578d52315ced93f6d211ea95704"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QxNjo0NDozMVrOHATwPw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QxNjo0NDozMVrOHATwPw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDA4NTY5NQ==", "bodyText": "Pull out your strings into local variables with more descriptive names.", "url": "https://github.com/apache/helix/pull/1169#discussion_r470085695", "createdAt": "2020-08-13T16:44:31Z", "author": {"login": "narendly"}, "path": "helix-core/src/test/java/org/apache/helix/task/TestDynamicTaskLoading.java", "diffHunk": "@@ -0,0 +1,251 @@\n+package org.apache.helix.task;\n+\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+import java.util.ArrayList;\n+import java.util.Collections;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+\n+import org.apache.helix.AccessOption;\n+import org.apache.helix.HelixException;\n+import org.apache.helix.HelixManager;\n+import org.apache.helix.HelixManagerFactory;\n+import org.apache.helix.InstanceType;\n+import org.apache.helix.TestHelper;\n+import org.apache.helix.common.ZkTestBase;\n+import org.apache.helix.examples.MasterSlaveStateModelFactory;\n+import org.apache.helix.integration.manager.ClusterControllerManager;\n+import org.apache.helix.integration.manager.MockParticipantManager;\n+import org.apache.helix.integration.task.MockTask;\n+import org.apache.helix.participant.StateMachineEngine;\n+import org.apache.helix.participant.statemachine.StateModel;\n+import org.apache.helix.participant.statemachine.StateModelFactory;\n+import org.testng.AssertJUnit;\n+import org.testng.annotations.AfterMethod;\n+import org.testng.annotations.BeforeMethod;\n+import org.testng.annotations.Test;\n+\n+public class TestDynamicTaskLoading extends ZkTestBase {\n+  private final String _clusterName = CLUSTER_PREFIX + \"_\" + getShortClassName();\n+  private static final String _instanceName = \"localhost_12913\";\n+  private HelixManager _manager;\n+  private MockParticipantManager _participant;\n+  private ClusterControllerManager _controller;\n+\n+  @BeforeMethod\n+  public void beforeMethod() throws Exception {\n+    _gSetupTool.addCluster(_clusterName, true);\n+\n+    _manager = HelixManagerFactory\n+        .getZKHelixManager(_clusterName, \"Admin\", InstanceType.ADMINISTRATOR, ZK_ADDR);\n+    _manager.connect();\n+\n+    _gSetupTool.addInstanceToCluster(_clusterName, _instanceName);\n+    _participant = new MockParticipantManager(ZK_ADDR, _clusterName, _instanceName);\n+    StateModelFactory<StateModel> stateModelFactory =\n+        new MasterSlaveStateModelFactory(_instanceName, 0);\n+    StateMachineEngine stateMach = _participant.getStateMachineEngine();\n+    stateMach.registerStateModelFactory(\"MasterSlave\", stateModelFactory);\n+    Map<String, TaskFactory> taskFactoryReg = new HashMap<>();\n+    _participant.getStateMachineEngine().registerStateModelFactory(TaskConstants.STATE_MODEL_NAME,\n+        new TaskStateModelFactory(_participant, taskFactoryReg));\n+    _participant.syncStart();\n+\n+    _controller = new ClusterControllerManager(ZK_ADDR, _clusterName, null);\n+    _controller.syncStart();\n+  }\n+\n+  private void removePathIfExists(String path) {\n+    if (_manager.getHelixDataAccessor().getBaseDataAccessor().exists(path, 0)) {\n+      _manager.getHelixDataAccessor().getBaseDataAccessor().remove(path, 0);\n+    }\n+  }\n+\n+  /**\n+   * Submit a workflow consisting of a job with a MockTask task.\n+   * @param workflowName name of the workflow\n+   * @param driver {@link TaskDriver} to submit workflowName to\n+   */\n+  private void submitWorkflow(String workflowName, TaskDriver driver) {\n+    JobConfig.Builder job = new JobConfig.Builder();\n+    job.setJobCommandConfigMap(Collections.singletonMap(MockTask.JOB_DELAY, \"100\"));\n+    Workflow.Builder workflow = new Workflow.Builder(workflowName);\n+    job.setWorkflow(workflowName);\n+    TaskConfig taskConfig =\n+        new TaskConfig(MockTask.TASK_COMMAND, new HashMap<String, String>(), null, null);\n+    job.addTaskConfigMap(Collections.singletonMap(taskConfig.getId(), taskConfig));\n+    job.setJobId(TaskUtil.getNamespacedJobName(workflowName, \"JOB\"));\n+    workflow.addJob(\"JOB\", job);\n+    driver.start(workflow.build());\n+  }\n+\n+  @Test\n+  public void testDynamicTaskLoading() throws Exception {\n+    // Add task definition information as a DynamicTaskConfig.\n+    List<String> taskClasses = new ArrayList<String>();\n+    taskClasses.add(\"com.mycompany.mocktask.MockTask\");\n+    DynamicTaskConfig taskConfig =\n+        new DynamicTaskConfig(\"Reindex\", \"src/test/resources/Reindex.jar\", \"1.0.0\", taskClasses,\n+            \"com.mycompany.mocktask.MockTaskFactory\");\n+    String path = TaskConstants.DYNAMICALLY_LOADED_TASK_PATH + \"/Reindex\";\n+    removePathIfExists(path);\n+    _manager.getHelixDataAccessor().getBaseDataAccessor()\n+        .create(path, taskConfig.getTaskConfigZNRecord(), AccessOption.PERSISTENT);\n+\n+    // Submit workflow\n+    TaskDriver driver = new TaskDriver(_manager);\n+    String workflowName = TestHelper.getTestMethodName();\n+    submitWorkflow(workflowName, driver);\n+\n+    try {\n+      // Wait for the workflow to either complete or fail.\n+      TaskState finalState =\n+          driver.pollForWorkflowState(workflowName, TaskState.COMPLETED, TaskState.FAILED);\n+      AssertJUnit.assertEquals(finalState, TaskState.COMPLETED);\n+    } catch (HelixException e) {\n+      AssertJUnit.fail(e.getMessage());\n+    }\n+  }\n+\n+  @Test\n+  public void testDynamicTaskLoadingNonexistingJar() throws Exception {\n+    // Add task definition information as a DynamicTaskConfig.\n+    List<String> taskClasses = new ArrayList<String>();\n+    taskClasses.add(\"com.mycompany.mocktask.MockTask\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ccedbc2154eba578d52315ced93f6d211ea95704"}, "originalPosition": 133}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY2OTM3NDk1", "url": "https://github.com/apache/helix/pull/1169#pullrequestreview-466937495", "createdAt": "2020-08-13T16:44:53Z", "commit": {"oid": "ccedbc2154eba578d52315ced93f6d211ea95704"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QxNjo0NDo1M1rOHATxOQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QxNjo0NDo1M1rOHATxOQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDA4NTk0NQ==", "bodyText": "Revise the structure as commented above, and replace AssertJUnit with Assert?", "url": "https://github.com/apache/helix/pull/1169#discussion_r470085945", "createdAt": "2020-08-13T16:44:53Z", "author": {"login": "narendly"}, "path": "helix-core/src/test/java/org/apache/helix/task/TestDynamicTaskLoading.java", "diffHunk": "@@ -0,0 +1,251 @@\n+package org.apache.helix.task;\n+\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+import java.util.ArrayList;\n+import java.util.Collections;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+\n+import org.apache.helix.AccessOption;\n+import org.apache.helix.HelixException;\n+import org.apache.helix.HelixManager;\n+import org.apache.helix.HelixManagerFactory;\n+import org.apache.helix.InstanceType;\n+import org.apache.helix.TestHelper;\n+import org.apache.helix.common.ZkTestBase;\n+import org.apache.helix.examples.MasterSlaveStateModelFactory;\n+import org.apache.helix.integration.manager.ClusterControllerManager;\n+import org.apache.helix.integration.manager.MockParticipantManager;\n+import org.apache.helix.integration.task.MockTask;\n+import org.apache.helix.participant.StateMachineEngine;\n+import org.apache.helix.participant.statemachine.StateModel;\n+import org.apache.helix.participant.statemachine.StateModelFactory;\n+import org.testng.AssertJUnit;\n+import org.testng.annotations.AfterMethod;\n+import org.testng.annotations.BeforeMethod;\n+import org.testng.annotations.Test;\n+\n+public class TestDynamicTaskLoading extends ZkTestBase {\n+  private final String _clusterName = CLUSTER_PREFIX + \"_\" + getShortClassName();\n+  private static final String _instanceName = \"localhost_12913\";\n+  private HelixManager _manager;\n+  private MockParticipantManager _participant;\n+  private ClusterControllerManager _controller;\n+\n+  @BeforeMethod\n+  public void beforeMethod() throws Exception {\n+    _gSetupTool.addCluster(_clusterName, true);\n+\n+    _manager = HelixManagerFactory\n+        .getZKHelixManager(_clusterName, \"Admin\", InstanceType.ADMINISTRATOR, ZK_ADDR);\n+    _manager.connect();\n+\n+    _gSetupTool.addInstanceToCluster(_clusterName, _instanceName);\n+    _participant = new MockParticipantManager(ZK_ADDR, _clusterName, _instanceName);\n+    StateModelFactory<StateModel> stateModelFactory =\n+        new MasterSlaveStateModelFactory(_instanceName, 0);\n+    StateMachineEngine stateMach = _participant.getStateMachineEngine();\n+    stateMach.registerStateModelFactory(\"MasterSlave\", stateModelFactory);\n+    Map<String, TaskFactory> taskFactoryReg = new HashMap<>();\n+    _participant.getStateMachineEngine().registerStateModelFactory(TaskConstants.STATE_MODEL_NAME,\n+        new TaskStateModelFactory(_participant, taskFactoryReg));\n+    _participant.syncStart();\n+\n+    _controller = new ClusterControllerManager(ZK_ADDR, _clusterName, null);\n+    _controller.syncStart();\n+  }\n+\n+  private void removePathIfExists(String path) {\n+    if (_manager.getHelixDataAccessor().getBaseDataAccessor().exists(path, 0)) {\n+      _manager.getHelixDataAccessor().getBaseDataAccessor().remove(path, 0);\n+    }\n+  }\n+\n+  /**\n+   * Submit a workflow consisting of a job with a MockTask task.\n+   * @param workflowName name of the workflow\n+   * @param driver {@link TaskDriver} to submit workflowName to\n+   */\n+  private void submitWorkflow(String workflowName, TaskDriver driver) {\n+    JobConfig.Builder job = new JobConfig.Builder();\n+    job.setJobCommandConfigMap(Collections.singletonMap(MockTask.JOB_DELAY, \"100\"));\n+    Workflow.Builder workflow = new Workflow.Builder(workflowName);\n+    job.setWorkflow(workflowName);\n+    TaskConfig taskConfig =\n+        new TaskConfig(MockTask.TASK_COMMAND, new HashMap<String, String>(), null, null);\n+    job.addTaskConfigMap(Collections.singletonMap(taskConfig.getId(), taskConfig));\n+    job.setJobId(TaskUtil.getNamespacedJobName(workflowName, \"JOB\"));\n+    workflow.addJob(\"JOB\", job);\n+    driver.start(workflow.build());\n+  }\n+\n+  @Test\n+  public void testDynamicTaskLoading() throws Exception {\n+    // Add task definition information as a DynamicTaskConfig.\n+    List<String> taskClasses = new ArrayList<String>();\n+    taskClasses.add(\"com.mycompany.mocktask.MockTask\");\n+    DynamicTaskConfig taskConfig =\n+        new DynamicTaskConfig(\"Reindex\", \"src/test/resources/Reindex.jar\", \"1.0.0\", taskClasses,\n+            \"com.mycompany.mocktask.MockTaskFactory\");\n+    String path = TaskConstants.DYNAMICALLY_LOADED_TASK_PATH + \"/Reindex\";\n+    removePathIfExists(path);\n+    _manager.getHelixDataAccessor().getBaseDataAccessor()\n+        .create(path, taskConfig.getTaskConfigZNRecord(), AccessOption.PERSISTENT);\n+\n+    // Submit workflow\n+    TaskDriver driver = new TaskDriver(_manager);\n+    String workflowName = TestHelper.getTestMethodName();\n+    submitWorkflow(workflowName, driver);\n+\n+    try {\n+      // Wait for the workflow to either complete or fail.\n+      TaskState finalState =\n+          driver.pollForWorkflowState(workflowName, TaskState.COMPLETED, TaskState.FAILED);\n+      AssertJUnit.assertEquals(finalState, TaskState.COMPLETED);\n+    } catch (HelixException e) {\n+      AssertJUnit.fail(e.getMessage());\n+    }\n+  }\n+\n+  @Test\n+  public void testDynamicTaskLoadingNonexistingJar() throws Exception {\n+    // Add task definition information as a DynamicTaskConfig.\n+    List<String> taskClasses = new ArrayList<String>();\n+    taskClasses.add(\"com.mycompany.mocktask.MockTask\");\n+    DynamicTaskConfig taskConfig =\n+        new DynamicTaskConfig(\"Reindex\", \"src/test/resources/Random.jar\", \"1.0.0\", taskClasses,\n+            \"com.mycompany.mocktask.MockTaskFactory\");\n+    String path = TaskConstants.DYNAMICALLY_LOADED_TASK_PATH + \"/Reindex\";\n+    removePathIfExists(path);\n+    _manager.getHelixDataAccessor().getBaseDataAccessor()\n+        .create(path, taskConfig.getTaskConfigZNRecord(), AccessOption.PERSISTENT);\n+\n+    // Submit workflow\n+    TaskDriver driver = new TaskDriver(_manager);\n+    String workflowName = TestHelper.getTestMethodName();\n+    submitWorkflow(workflowName, driver);\n+\n+    try {\n+      // Wait for the workflow to either complete or fail.\n+      TaskState finalState =\n+          driver.pollForWorkflowState(workflowName, TaskState.COMPLETED, TaskState.FAILED);\n+      AssertJUnit.assertEquals(finalState, TaskState.FAILED);\n+    } catch (HelixException e) {\n+      AssertJUnit.fail(e.getMessage());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ccedbc2154eba578d52315ced93f6d211ea95704"}, "originalPosition": 153}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY2OTM3Njc1", "url": "https://github.com/apache/helix/pull/1169#pullrequestreview-466937675", "createdAt": "2020-08-13T16:45:09Z", "commit": {"oid": "ccedbc2154eba578d52315ced93f6d211ea95704"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QxNjo0NTowOVrOHATx6g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QxNjo0NTowOVrOHATx6g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDA4NjEyMg==", "bodyText": "Revise (see above)", "url": "https://github.com/apache/helix/pull/1169#discussion_r470086122", "createdAt": "2020-08-13T16:45:09Z", "author": {"login": "narendly"}, "path": "helix-core/src/test/java/org/apache/helix/task/TestDynamicTaskLoading.java", "diffHunk": "@@ -0,0 +1,251 @@\n+package org.apache.helix.task;\n+\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+import java.util.ArrayList;\n+import java.util.Collections;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+\n+import org.apache.helix.AccessOption;\n+import org.apache.helix.HelixException;\n+import org.apache.helix.HelixManager;\n+import org.apache.helix.HelixManagerFactory;\n+import org.apache.helix.InstanceType;\n+import org.apache.helix.TestHelper;\n+import org.apache.helix.common.ZkTestBase;\n+import org.apache.helix.examples.MasterSlaveStateModelFactory;\n+import org.apache.helix.integration.manager.ClusterControllerManager;\n+import org.apache.helix.integration.manager.MockParticipantManager;\n+import org.apache.helix.integration.task.MockTask;\n+import org.apache.helix.participant.StateMachineEngine;\n+import org.apache.helix.participant.statemachine.StateModel;\n+import org.apache.helix.participant.statemachine.StateModelFactory;\n+import org.testng.AssertJUnit;\n+import org.testng.annotations.AfterMethod;\n+import org.testng.annotations.BeforeMethod;\n+import org.testng.annotations.Test;\n+\n+public class TestDynamicTaskLoading extends ZkTestBase {\n+  private final String _clusterName = CLUSTER_PREFIX + \"_\" + getShortClassName();\n+  private static final String _instanceName = \"localhost_12913\";\n+  private HelixManager _manager;\n+  private MockParticipantManager _participant;\n+  private ClusterControllerManager _controller;\n+\n+  @BeforeMethod\n+  public void beforeMethod() throws Exception {\n+    _gSetupTool.addCluster(_clusterName, true);\n+\n+    _manager = HelixManagerFactory\n+        .getZKHelixManager(_clusterName, \"Admin\", InstanceType.ADMINISTRATOR, ZK_ADDR);\n+    _manager.connect();\n+\n+    _gSetupTool.addInstanceToCluster(_clusterName, _instanceName);\n+    _participant = new MockParticipantManager(ZK_ADDR, _clusterName, _instanceName);\n+    StateModelFactory<StateModel> stateModelFactory =\n+        new MasterSlaveStateModelFactory(_instanceName, 0);\n+    StateMachineEngine stateMach = _participant.getStateMachineEngine();\n+    stateMach.registerStateModelFactory(\"MasterSlave\", stateModelFactory);\n+    Map<String, TaskFactory> taskFactoryReg = new HashMap<>();\n+    _participant.getStateMachineEngine().registerStateModelFactory(TaskConstants.STATE_MODEL_NAME,\n+        new TaskStateModelFactory(_participant, taskFactoryReg));\n+    _participant.syncStart();\n+\n+    _controller = new ClusterControllerManager(ZK_ADDR, _clusterName, null);\n+    _controller.syncStart();\n+  }\n+\n+  private void removePathIfExists(String path) {\n+    if (_manager.getHelixDataAccessor().getBaseDataAccessor().exists(path, 0)) {\n+      _manager.getHelixDataAccessor().getBaseDataAccessor().remove(path, 0);\n+    }\n+  }\n+\n+  /**\n+   * Submit a workflow consisting of a job with a MockTask task.\n+   * @param workflowName name of the workflow\n+   * @param driver {@link TaskDriver} to submit workflowName to\n+   */\n+  private void submitWorkflow(String workflowName, TaskDriver driver) {\n+    JobConfig.Builder job = new JobConfig.Builder();\n+    job.setJobCommandConfigMap(Collections.singletonMap(MockTask.JOB_DELAY, \"100\"));\n+    Workflow.Builder workflow = new Workflow.Builder(workflowName);\n+    job.setWorkflow(workflowName);\n+    TaskConfig taskConfig =\n+        new TaskConfig(MockTask.TASK_COMMAND, new HashMap<String, String>(), null, null);\n+    job.addTaskConfigMap(Collections.singletonMap(taskConfig.getId(), taskConfig));\n+    job.setJobId(TaskUtil.getNamespacedJobName(workflowName, \"JOB\"));\n+    workflow.addJob(\"JOB\", job);\n+    driver.start(workflow.build());\n+  }\n+\n+  @Test\n+  public void testDynamicTaskLoading() throws Exception {\n+    // Add task definition information as a DynamicTaskConfig.\n+    List<String> taskClasses = new ArrayList<String>();\n+    taskClasses.add(\"com.mycompany.mocktask.MockTask\");\n+    DynamicTaskConfig taskConfig =\n+        new DynamicTaskConfig(\"Reindex\", \"src/test/resources/Reindex.jar\", \"1.0.0\", taskClasses,\n+            \"com.mycompany.mocktask.MockTaskFactory\");\n+    String path = TaskConstants.DYNAMICALLY_LOADED_TASK_PATH + \"/Reindex\";\n+    removePathIfExists(path);\n+    _manager.getHelixDataAccessor().getBaseDataAccessor()\n+        .create(path, taskConfig.getTaskConfigZNRecord(), AccessOption.PERSISTENT);\n+\n+    // Submit workflow\n+    TaskDriver driver = new TaskDriver(_manager);\n+    String workflowName = TestHelper.getTestMethodName();\n+    submitWorkflow(workflowName, driver);\n+\n+    try {\n+      // Wait for the workflow to either complete or fail.\n+      TaskState finalState =\n+          driver.pollForWorkflowState(workflowName, TaskState.COMPLETED, TaskState.FAILED);\n+      AssertJUnit.assertEquals(finalState, TaskState.COMPLETED);\n+    } catch (HelixException e) {\n+      AssertJUnit.fail(e.getMessage());\n+    }\n+  }\n+\n+  @Test\n+  public void testDynamicTaskLoadingNonexistingJar() throws Exception {\n+    // Add task definition information as a DynamicTaskConfig.\n+    List<String> taskClasses = new ArrayList<String>();\n+    taskClasses.add(\"com.mycompany.mocktask.MockTask\");\n+    DynamicTaskConfig taskConfig =\n+        new DynamicTaskConfig(\"Reindex\", \"src/test/resources/Random.jar\", \"1.0.0\", taskClasses,\n+            \"com.mycompany.mocktask.MockTaskFactory\");\n+    String path = TaskConstants.DYNAMICALLY_LOADED_TASK_PATH + \"/Reindex\";\n+    removePathIfExists(path);\n+    _manager.getHelixDataAccessor().getBaseDataAccessor()\n+        .create(path, taskConfig.getTaskConfigZNRecord(), AccessOption.PERSISTENT);\n+\n+    // Submit workflow\n+    TaskDriver driver = new TaskDriver(_manager);\n+    String workflowName = TestHelper.getTestMethodName();\n+    submitWorkflow(workflowName, driver);\n+\n+    try {\n+      // Wait for the workflow to either complete or fail.\n+      TaskState finalState =\n+          driver.pollForWorkflowState(workflowName, TaskState.COMPLETED, TaskState.FAILED);\n+      AssertJUnit.assertEquals(finalState, TaskState.FAILED);\n+    } catch (HelixException e) {\n+      AssertJUnit.fail(e.getMessage());\n+    }\n+  }\n+\n+  @Test\n+  public void testDynamicTaskLoadingNonexistingTaskConfig() throws Exception {\n+    // Remove task config ZNRecord if it exists.\n+    String path = TaskConstants.DYNAMICALLY_LOADED_TASK_PATH + \"/Reindex\";\n+    removePathIfExists(path);\n+\n+    // Submit workflow\n+    TaskDriver driver = new TaskDriver(_manager);\n+    String workflowName = TestHelper.getTestMethodName();\n+    submitWorkflow(workflowName, driver);\n+\n+    try {\n+      // Wait for the workflow to either complete or fail.\n+      TaskState finalState =\n+          driver.pollForWorkflowState(workflowName, TaskState.COMPLETED, TaskState.FAILED);\n+      AssertJUnit.assertEquals(finalState, TaskState.FAILED);\n+    } catch (HelixException e) {\n+      AssertJUnit.fail(e.getMessage());\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ccedbc2154eba578d52315ced93f6d211ea95704"}, "originalPosition": 175}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY2OTM3Nzc1", "url": "https://github.com/apache/helix/pull/1169#pullrequestreview-466937775", "createdAt": "2020-08-13T16:45:17Z", "commit": {"oid": "ccedbc2154eba578d52315ced93f6d211ea95704"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QxNjo0NToxOFrOHATyOQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QxNjo0NToxOFrOHATyOQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDA4NjIwMQ==", "bodyText": "Style?", "url": "https://github.com/apache/helix/pull/1169#discussion_r470086201", "createdAt": "2020-08-13T16:45:18Z", "author": {"login": "narendly"}, "path": "helix-core/src/test/java/org/apache/helix/task/TestDynamicTaskLoading.java", "diffHunk": "@@ -0,0 +1,251 @@\n+package org.apache.helix.task;\n+\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+import java.util.ArrayList;\n+import java.util.Collections;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+\n+import org.apache.helix.AccessOption;\n+import org.apache.helix.HelixException;\n+import org.apache.helix.HelixManager;\n+import org.apache.helix.HelixManagerFactory;\n+import org.apache.helix.InstanceType;\n+import org.apache.helix.TestHelper;\n+import org.apache.helix.common.ZkTestBase;\n+import org.apache.helix.examples.MasterSlaveStateModelFactory;\n+import org.apache.helix.integration.manager.ClusterControllerManager;\n+import org.apache.helix.integration.manager.MockParticipantManager;\n+import org.apache.helix.integration.task.MockTask;\n+import org.apache.helix.participant.StateMachineEngine;\n+import org.apache.helix.participant.statemachine.StateModel;\n+import org.apache.helix.participant.statemachine.StateModelFactory;\n+import org.testng.AssertJUnit;\n+import org.testng.annotations.AfterMethod;\n+import org.testng.annotations.BeforeMethod;\n+import org.testng.annotations.Test;\n+\n+public class TestDynamicTaskLoading extends ZkTestBase {\n+  private final String _clusterName = CLUSTER_PREFIX + \"_\" + getShortClassName();\n+  private static final String _instanceName = \"localhost_12913\";\n+  private HelixManager _manager;\n+  private MockParticipantManager _participant;\n+  private ClusterControllerManager _controller;\n+\n+  @BeforeMethod\n+  public void beforeMethod() throws Exception {\n+    _gSetupTool.addCluster(_clusterName, true);\n+\n+    _manager = HelixManagerFactory\n+        .getZKHelixManager(_clusterName, \"Admin\", InstanceType.ADMINISTRATOR, ZK_ADDR);\n+    _manager.connect();\n+\n+    _gSetupTool.addInstanceToCluster(_clusterName, _instanceName);\n+    _participant = new MockParticipantManager(ZK_ADDR, _clusterName, _instanceName);\n+    StateModelFactory<StateModel> stateModelFactory =\n+        new MasterSlaveStateModelFactory(_instanceName, 0);\n+    StateMachineEngine stateMach = _participant.getStateMachineEngine();\n+    stateMach.registerStateModelFactory(\"MasterSlave\", stateModelFactory);\n+    Map<String, TaskFactory> taskFactoryReg = new HashMap<>();\n+    _participant.getStateMachineEngine().registerStateModelFactory(TaskConstants.STATE_MODEL_NAME,\n+        new TaskStateModelFactory(_participant, taskFactoryReg));\n+    _participant.syncStart();\n+\n+    _controller = new ClusterControllerManager(ZK_ADDR, _clusterName, null);\n+    _controller.syncStart();\n+  }\n+\n+  private void removePathIfExists(String path) {\n+    if (_manager.getHelixDataAccessor().getBaseDataAccessor().exists(path, 0)) {\n+      _manager.getHelixDataAccessor().getBaseDataAccessor().remove(path, 0);\n+    }\n+  }\n+\n+  /**\n+   * Submit a workflow consisting of a job with a MockTask task.\n+   * @param workflowName name of the workflow\n+   * @param driver {@link TaskDriver} to submit workflowName to\n+   */\n+  private void submitWorkflow(String workflowName, TaskDriver driver) {\n+    JobConfig.Builder job = new JobConfig.Builder();\n+    job.setJobCommandConfigMap(Collections.singletonMap(MockTask.JOB_DELAY, \"100\"));\n+    Workflow.Builder workflow = new Workflow.Builder(workflowName);\n+    job.setWorkflow(workflowName);\n+    TaskConfig taskConfig =\n+        new TaskConfig(MockTask.TASK_COMMAND, new HashMap<String, String>(), null, null);\n+    job.addTaskConfigMap(Collections.singletonMap(taskConfig.getId(), taskConfig));\n+    job.setJobId(TaskUtil.getNamespacedJobName(workflowName, \"JOB\"));\n+    workflow.addJob(\"JOB\", job);\n+    driver.start(workflow.build());\n+  }\n+\n+  @Test\n+  public void testDynamicTaskLoading() throws Exception {\n+    // Add task definition information as a DynamicTaskConfig.\n+    List<String> taskClasses = new ArrayList<String>();\n+    taskClasses.add(\"com.mycompany.mocktask.MockTask\");\n+    DynamicTaskConfig taskConfig =\n+        new DynamicTaskConfig(\"Reindex\", \"src/test/resources/Reindex.jar\", \"1.0.0\", taskClasses,\n+            \"com.mycompany.mocktask.MockTaskFactory\");\n+    String path = TaskConstants.DYNAMICALLY_LOADED_TASK_PATH + \"/Reindex\";\n+    removePathIfExists(path);\n+    _manager.getHelixDataAccessor().getBaseDataAccessor()\n+        .create(path, taskConfig.getTaskConfigZNRecord(), AccessOption.PERSISTENT);\n+\n+    // Submit workflow\n+    TaskDriver driver = new TaskDriver(_manager);\n+    String workflowName = TestHelper.getTestMethodName();\n+    submitWorkflow(workflowName, driver);\n+\n+    try {\n+      // Wait for the workflow to either complete or fail.\n+      TaskState finalState =\n+          driver.pollForWorkflowState(workflowName, TaskState.COMPLETED, TaskState.FAILED);\n+      AssertJUnit.assertEquals(finalState, TaskState.COMPLETED);\n+    } catch (HelixException e) {\n+      AssertJUnit.fail(e.getMessage());\n+    }\n+  }\n+\n+  @Test\n+  public void testDynamicTaskLoadingNonexistingJar() throws Exception {\n+    // Add task definition information as a DynamicTaskConfig.\n+    List<String> taskClasses = new ArrayList<String>();\n+    taskClasses.add(\"com.mycompany.mocktask.MockTask\");\n+    DynamicTaskConfig taskConfig =\n+        new DynamicTaskConfig(\"Reindex\", \"src/test/resources/Random.jar\", \"1.0.0\", taskClasses,\n+            \"com.mycompany.mocktask.MockTaskFactory\");\n+    String path = TaskConstants.DYNAMICALLY_LOADED_TASK_PATH + \"/Reindex\";\n+    removePathIfExists(path);\n+    _manager.getHelixDataAccessor().getBaseDataAccessor()\n+        .create(path, taskConfig.getTaskConfigZNRecord(), AccessOption.PERSISTENT);\n+\n+    // Submit workflow\n+    TaskDriver driver = new TaskDriver(_manager);\n+    String workflowName = TestHelper.getTestMethodName();\n+    submitWorkflow(workflowName, driver);\n+\n+    try {\n+      // Wait for the workflow to either complete or fail.\n+      TaskState finalState =\n+          driver.pollForWorkflowState(workflowName, TaskState.COMPLETED, TaskState.FAILED);\n+      AssertJUnit.assertEquals(finalState, TaskState.FAILED);\n+    } catch (HelixException e) {\n+      AssertJUnit.fail(e.getMessage());\n+    }\n+  }\n+\n+  @Test\n+  public void testDynamicTaskLoadingNonexistingTaskConfig() throws Exception {\n+    // Remove task config ZNRecord if it exists.\n+    String path = TaskConstants.DYNAMICALLY_LOADED_TASK_PATH + \"/Reindex\";\n+    removePathIfExists(path);\n+\n+    // Submit workflow\n+    TaskDriver driver = new TaskDriver(_manager);\n+    String workflowName = TestHelper.getTestMethodName();\n+    submitWorkflow(workflowName, driver);\n+\n+    try {\n+      // Wait for the workflow to either complete or fail.\n+      TaskState finalState =\n+          driver.pollForWorkflowState(workflowName, TaskState.COMPLETED, TaskState.FAILED);\n+      AssertJUnit.assertEquals(finalState, TaskState.FAILED);\n+    } catch (HelixException e) {\n+      AssertJUnit.fail(e.getMessage());\n+    }\n+  }\n+\n+  @Test\n+  public void testDynamicTaskLoadingNonexistingTaskClass() throws Exception {\n+    // Add task definition information as a DynamicTaskConfig.\n+    List<String> taskClasses = new ArrayList<String>();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ccedbc2154eba578d52315ced93f6d211ea95704"}, "originalPosition": 181}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY2OTM3ODcx", "url": "https://github.com/apache/helix/pull/1169#pullrequestreview-466937871", "createdAt": "2020-08-13T16:45:26Z", "commit": {"oid": "ccedbc2154eba578d52315ced93f6d211ea95704"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QxNjo0NToyNlrOHATyog==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QxNjo0NToyNlrOHATyog==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDA4NjMwNg==", "bodyText": "Pull out strings.", "url": "https://github.com/apache/helix/pull/1169#discussion_r470086306", "createdAt": "2020-08-13T16:45:26Z", "author": {"login": "narendly"}, "path": "helix-core/src/test/java/org/apache/helix/task/TestDynamicTaskLoading.java", "diffHunk": "@@ -0,0 +1,251 @@\n+package org.apache.helix.task;\n+\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+import java.util.ArrayList;\n+import java.util.Collections;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+\n+import org.apache.helix.AccessOption;\n+import org.apache.helix.HelixException;\n+import org.apache.helix.HelixManager;\n+import org.apache.helix.HelixManagerFactory;\n+import org.apache.helix.InstanceType;\n+import org.apache.helix.TestHelper;\n+import org.apache.helix.common.ZkTestBase;\n+import org.apache.helix.examples.MasterSlaveStateModelFactory;\n+import org.apache.helix.integration.manager.ClusterControllerManager;\n+import org.apache.helix.integration.manager.MockParticipantManager;\n+import org.apache.helix.integration.task.MockTask;\n+import org.apache.helix.participant.StateMachineEngine;\n+import org.apache.helix.participant.statemachine.StateModel;\n+import org.apache.helix.participant.statemachine.StateModelFactory;\n+import org.testng.AssertJUnit;\n+import org.testng.annotations.AfterMethod;\n+import org.testng.annotations.BeforeMethod;\n+import org.testng.annotations.Test;\n+\n+public class TestDynamicTaskLoading extends ZkTestBase {\n+  private final String _clusterName = CLUSTER_PREFIX + \"_\" + getShortClassName();\n+  private static final String _instanceName = \"localhost_12913\";\n+  private HelixManager _manager;\n+  private MockParticipantManager _participant;\n+  private ClusterControllerManager _controller;\n+\n+  @BeforeMethod\n+  public void beforeMethod() throws Exception {\n+    _gSetupTool.addCluster(_clusterName, true);\n+\n+    _manager = HelixManagerFactory\n+        .getZKHelixManager(_clusterName, \"Admin\", InstanceType.ADMINISTRATOR, ZK_ADDR);\n+    _manager.connect();\n+\n+    _gSetupTool.addInstanceToCluster(_clusterName, _instanceName);\n+    _participant = new MockParticipantManager(ZK_ADDR, _clusterName, _instanceName);\n+    StateModelFactory<StateModel> stateModelFactory =\n+        new MasterSlaveStateModelFactory(_instanceName, 0);\n+    StateMachineEngine stateMach = _participant.getStateMachineEngine();\n+    stateMach.registerStateModelFactory(\"MasterSlave\", stateModelFactory);\n+    Map<String, TaskFactory> taskFactoryReg = new HashMap<>();\n+    _participant.getStateMachineEngine().registerStateModelFactory(TaskConstants.STATE_MODEL_NAME,\n+        new TaskStateModelFactory(_participant, taskFactoryReg));\n+    _participant.syncStart();\n+\n+    _controller = new ClusterControllerManager(ZK_ADDR, _clusterName, null);\n+    _controller.syncStart();\n+  }\n+\n+  private void removePathIfExists(String path) {\n+    if (_manager.getHelixDataAccessor().getBaseDataAccessor().exists(path, 0)) {\n+      _manager.getHelixDataAccessor().getBaseDataAccessor().remove(path, 0);\n+    }\n+  }\n+\n+  /**\n+   * Submit a workflow consisting of a job with a MockTask task.\n+   * @param workflowName name of the workflow\n+   * @param driver {@link TaskDriver} to submit workflowName to\n+   */\n+  private void submitWorkflow(String workflowName, TaskDriver driver) {\n+    JobConfig.Builder job = new JobConfig.Builder();\n+    job.setJobCommandConfigMap(Collections.singletonMap(MockTask.JOB_DELAY, \"100\"));\n+    Workflow.Builder workflow = new Workflow.Builder(workflowName);\n+    job.setWorkflow(workflowName);\n+    TaskConfig taskConfig =\n+        new TaskConfig(MockTask.TASK_COMMAND, new HashMap<String, String>(), null, null);\n+    job.addTaskConfigMap(Collections.singletonMap(taskConfig.getId(), taskConfig));\n+    job.setJobId(TaskUtil.getNamespacedJobName(workflowName, \"JOB\"));\n+    workflow.addJob(\"JOB\", job);\n+    driver.start(workflow.build());\n+  }\n+\n+  @Test\n+  public void testDynamicTaskLoading() throws Exception {\n+    // Add task definition information as a DynamicTaskConfig.\n+    List<String> taskClasses = new ArrayList<String>();\n+    taskClasses.add(\"com.mycompany.mocktask.MockTask\");\n+    DynamicTaskConfig taskConfig =\n+        new DynamicTaskConfig(\"Reindex\", \"src/test/resources/Reindex.jar\", \"1.0.0\", taskClasses,\n+            \"com.mycompany.mocktask.MockTaskFactory\");\n+    String path = TaskConstants.DYNAMICALLY_LOADED_TASK_PATH + \"/Reindex\";\n+    removePathIfExists(path);\n+    _manager.getHelixDataAccessor().getBaseDataAccessor()\n+        .create(path, taskConfig.getTaskConfigZNRecord(), AccessOption.PERSISTENT);\n+\n+    // Submit workflow\n+    TaskDriver driver = new TaskDriver(_manager);\n+    String workflowName = TestHelper.getTestMethodName();\n+    submitWorkflow(workflowName, driver);\n+\n+    try {\n+      // Wait for the workflow to either complete or fail.\n+      TaskState finalState =\n+          driver.pollForWorkflowState(workflowName, TaskState.COMPLETED, TaskState.FAILED);\n+      AssertJUnit.assertEquals(finalState, TaskState.COMPLETED);\n+    } catch (HelixException e) {\n+      AssertJUnit.fail(e.getMessage());\n+    }\n+  }\n+\n+  @Test\n+  public void testDynamicTaskLoadingNonexistingJar() throws Exception {\n+    // Add task definition information as a DynamicTaskConfig.\n+    List<String> taskClasses = new ArrayList<String>();\n+    taskClasses.add(\"com.mycompany.mocktask.MockTask\");\n+    DynamicTaskConfig taskConfig =\n+        new DynamicTaskConfig(\"Reindex\", \"src/test/resources/Random.jar\", \"1.0.0\", taskClasses,\n+            \"com.mycompany.mocktask.MockTaskFactory\");\n+    String path = TaskConstants.DYNAMICALLY_LOADED_TASK_PATH + \"/Reindex\";\n+    removePathIfExists(path);\n+    _manager.getHelixDataAccessor().getBaseDataAccessor()\n+        .create(path, taskConfig.getTaskConfigZNRecord(), AccessOption.PERSISTENT);\n+\n+    // Submit workflow\n+    TaskDriver driver = new TaskDriver(_manager);\n+    String workflowName = TestHelper.getTestMethodName();\n+    submitWorkflow(workflowName, driver);\n+\n+    try {\n+      // Wait for the workflow to either complete or fail.\n+      TaskState finalState =\n+          driver.pollForWorkflowState(workflowName, TaskState.COMPLETED, TaskState.FAILED);\n+      AssertJUnit.assertEquals(finalState, TaskState.FAILED);\n+    } catch (HelixException e) {\n+      AssertJUnit.fail(e.getMessage());\n+    }\n+  }\n+\n+  @Test\n+  public void testDynamicTaskLoadingNonexistingTaskConfig() throws Exception {\n+    // Remove task config ZNRecord if it exists.\n+    String path = TaskConstants.DYNAMICALLY_LOADED_TASK_PATH + \"/Reindex\";\n+    removePathIfExists(path);\n+\n+    // Submit workflow\n+    TaskDriver driver = new TaskDriver(_manager);\n+    String workflowName = TestHelper.getTestMethodName();\n+    submitWorkflow(workflowName, driver);\n+\n+    try {\n+      // Wait for the workflow to either complete or fail.\n+      TaskState finalState =\n+          driver.pollForWorkflowState(workflowName, TaskState.COMPLETED, TaskState.FAILED);\n+      AssertJUnit.assertEquals(finalState, TaskState.FAILED);\n+    } catch (HelixException e) {\n+      AssertJUnit.fail(e.getMessage());\n+    }\n+  }\n+\n+  @Test\n+  public void testDynamicTaskLoadingNonexistingTaskClass() throws Exception {\n+    // Add task definition information as a DynamicTaskConfig.\n+    List<String> taskClasses = new ArrayList<String>();\n+    taskClasses.add(\"com.mycompany.mocktask.RandomTask\");\n+    DynamicTaskConfig taskConfig =\n+        new DynamicTaskConfig(\"Reindex\", \"src/test/resources/Reindex.jar\", \"1.0.0\", taskClasses,\n+            \"com.mycompany.mocktask.MockTaskFactory\");\n+    String path = TaskConstants.DYNAMICALLY_LOADED_TASK_PATH + \"/Reindex\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ccedbc2154eba578d52315ced93f6d211ea95704"}, "originalPosition": 186}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY2OTM3OTU0", "url": "https://github.com/apache/helix/pull/1169#pullrequestreview-466937954", "createdAt": "2020-08-13T16:45:33Z", "commit": {"oid": "ccedbc2154eba578d52315ced93f6d211ea95704"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QxNjo0NTozM1rOHATy8A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QxNjo0NTozM1rOHATy8A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDA4NjM4NA==", "bodyText": "revise structure", "url": "https://github.com/apache/helix/pull/1169#discussion_r470086384", "createdAt": "2020-08-13T16:45:33Z", "author": {"login": "narendly"}, "path": "helix-core/src/test/java/org/apache/helix/task/TestDynamicTaskLoading.java", "diffHunk": "@@ -0,0 +1,251 @@\n+package org.apache.helix.task;\n+\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+import java.util.ArrayList;\n+import java.util.Collections;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+\n+import org.apache.helix.AccessOption;\n+import org.apache.helix.HelixException;\n+import org.apache.helix.HelixManager;\n+import org.apache.helix.HelixManagerFactory;\n+import org.apache.helix.InstanceType;\n+import org.apache.helix.TestHelper;\n+import org.apache.helix.common.ZkTestBase;\n+import org.apache.helix.examples.MasterSlaveStateModelFactory;\n+import org.apache.helix.integration.manager.ClusterControllerManager;\n+import org.apache.helix.integration.manager.MockParticipantManager;\n+import org.apache.helix.integration.task.MockTask;\n+import org.apache.helix.participant.StateMachineEngine;\n+import org.apache.helix.participant.statemachine.StateModel;\n+import org.apache.helix.participant.statemachine.StateModelFactory;\n+import org.testng.AssertJUnit;\n+import org.testng.annotations.AfterMethod;\n+import org.testng.annotations.BeforeMethod;\n+import org.testng.annotations.Test;\n+\n+public class TestDynamicTaskLoading extends ZkTestBase {\n+  private final String _clusterName = CLUSTER_PREFIX + \"_\" + getShortClassName();\n+  private static final String _instanceName = \"localhost_12913\";\n+  private HelixManager _manager;\n+  private MockParticipantManager _participant;\n+  private ClusterControllerManager _controller;\n+\n+  @BeforeMethod\n+  public void beforeMethod() throws Exception {\n+    _gSetupTool.addCluster(_clusterName, true);\n+\n+    _manager = HelixManagerFactory\n+        .getZKHelixManager(_clusterName, \"Admin\", InstanceType.ADMINISTRATOR, ZK_ADDR);\n+    _manager.connect();\n+\n+    _gSetupTool.addInstanceToCluster(_clusterName, _instanceName);\n+    _participant = new MockParticipantManager(ZK_ADDR, _clusterName, _instanceName);\n+    StateModelFactory<StateModel> stateModelFactory =\n+        new MasterSlaveStateModelFactory(_instanceName, 0);\n+    StateMachineEngine stateMach = _participant.getStateMachineEngine();\n+    stateMach.registerStateModelFactory(\"MasterSlave\", stateModelFactory);\n+    Map<String, TaskFactory> taskFactoryReg = new HashMap<>();\n+    _participant.getStateMachineEngine().registerStateModelFactory(TaskConstants.STATE_MODEL_NAME,\n+        new TaskStateModelFactory(_participant, taskFactoryReg));\n+    _participant.syncStart();\n+\n+    _controller = new ClusterControllerManager(ZK_ADDR, _clusterName, null);\n+    _controller.syncStart();\n+  }\n+\n+  private void removePathIfExists(String path) {\n+    if (_manager.getHelixDataAccessor().getBaseDataAccessor().exists(path, 0)) {\n+      _manager.getHelixDataAccessor().getBaseDataAccessor().remove(path, 0);\n+    }\n+  }\n+\n+  /**\n+   * Submit a workflow consisting of a job with a MockTask task.\n+   * @param workflowName name of the workflow\n+   * @param driver {@link TaskDriver} to submit workflowName to\n+   */\n+  private void submitWorkflow(String workflowName, TaskDriver driver) {\n+    JobConfig.Builder job = new JobConfig.Builder();\n+    job.setJobCommandConfigMap(Collections.singletonMap(MockTask.JOB_DELAY, \"100\"));\n+    Workflow.Builder workflow = new Workflow.Builder(workflowName);\n+    job.setWorkflow(workflowName);\n+    TaskConfig taskConfig =\n+        new TaskConfig(MockTask.TASK_COMMAND, new HashMap<String, String>(), null, null);\n+    job.addTaskConfigMap(Collections.singletonMap(taskConfig.getId(), taskConfig));\n+    job.setJobId(TaskUtil.getNamespacedJobName(workflowName, \"JOB\"));\n+    workflow.addJob(\"JOB\", job);\n+    driver.start(workflow.build());\n+  }\n+\n+  @Test\n+  public void testDynamicTaskLoading() throws Exception {\n+    // Add task definition information as a DynamicTaskConfig.\n+    List<String> taskClasses = new ArrayList<String>();\n+    taskClasses.add(\"com.mycompany.mocktask.MockTask\");\n+    DynamicTaskConfig taskConfig =\n+        new DynamicTaskConfig(\"Reindex\", \"src/test/resources/Reindex.jar\", \"1.0.0\", taskClasses,\n+            \"com.mycompany.mocktask.MockTaskFactory\");\n+    String path = TaskConstants.DYNAMICALLY_LOADED_TASK_PATH + \"/Reindex\";\n+    removePathIfExists(path);\n+    _manager.getHelixDataAccessor().getBaseDataAccessor()\n+        .create(path, taskConfig.getTaskConfigZNRecord(), AccessOption.PERSISTENT);\n+\n+    // Submit workflow\n+    TaskDriver driver = new TaskDriver(_manager);\n+    String workflowName = TestHelper.getTestMethodName();\n+    submitWorkflow(workflowName, driver);\n+\n+    try {\n+      // Wait for the workflow to either complete or fail.\n+      TaskState finalState =\n+          driver.pollForWorkflowState(workflowName, TaskState.COMPLETED, TaskState.FAILED);\n+      AssertJUnit.assertEquals(finalState, TaskState.COMPLETED);\n+    } catch (HelixException e) {\n+      AssertJUnit.fail(e.getMessage());\n+    }\n+  }\n+\n+  @Test\n+  public void testDynamicTaskLoadingNonexistingJar() throws Exception {\n+    // Add task definition information as a DynamicTaskConfig.\n+    List<String> taskClasses = new ArrayList<String>();\n+    taskClasses.add(\"com.mycompany.mocktask.MockTask\");\n+    DynamicTaskConfig taskConfig =\n+        new DynamicTaskConfig(\"Reindex\", \"src/test/resources/Random.jar\", \"1.0.0\", taskClasses,\n+            \"com.mycompany.mocktask.MockTaskFactory\");\n+    String path = TaskConstants.DYNAMICALLY_LOADED_TASK_PATH + \"/Reindex\";\n+    removePathIfExists(path);\n+    _manager.getHelixDataAccessor().getBaseDataAccessor()\n+        .create(path, taskConfig.getTaskConfigZNRecord(), AccessOption.PERSISTENT);\n+\n+    // Submit workflow\n+    TaskDriver driver = new TaskDriver(_manager);\n+    String workflowName = TestHelper.getTestMethodName();\n+    submitWorkflow(workflowName, driver);\n+\n+    try {\n+      // Wait for the workflow to either complete or fail.\n+      TaskState finalState =\n+          driver.pollForWorkflowState(workflowName, TaskState.COMPLETED, TaskState.FAILED);\n+      AssertJUnit.assertEquals(finalState, TaskState.FAILED);\n+    } catch (HelixException e) {\n+      AssertJUnit.fail(e.getMessage());\n+    }\n+  }\n+\n+  @Test\n+  public void testDynamicTaskLoadingNonexistingTaskConfig() throws Exception {\n+    // Remove task config ZNRecord if it exists.\n+    String path = TaskConstants.DYNAMICALLY_LOADED_TASK_PATH + \"/Reindex\";\n+    removePathIfExists(path);\n+\n+    // Submit workflow\n+    TaskDriver driver = new TaskDriver(_manager);\n+    String workflowName = TestHelper.getTestMethodName();\n+    submitWorkflow(workflowName, driver);\n+\n+    try {\n+      // Wait for the workflow to either complete or fail.\n+      TaskState finalState =\n+          driver.pollForWorkflowState(workflowName, TaskState.COMPLETED, TaskState.FAILED);\n+      AssertJUnit.assertEquals(finalState, TaskState.FAILED);\n+    } catch (HelixException e) {\n+      AssertJUnit.fail(e.getMessage());\n+    }\n+  }\n+\n+  @Test\n+  public void testDynamicTaskLoadingNonexistingTaskClass() throws Exception {\n+    // Add task definition information as a DynamicTaskConfig.\n+    List<String> taskClasses = new ArrayList<String>();\n+    taskClasses.add(\"com.mycompany.mocktask.RandomTask\");\n+    DynamicTaskConfig taskConfig =\n+        new DynamicTaskConfig(\"Reindex\", \"src/test/resources/Reindex.jar\", \"1.0.0\", taskClasses,\n+            \"com.mycompany.mocktask.MockTaskFactory\");\n+    String path = TaskConstants.DYNAMICALLY_LOADED_TASK_PATH + \"/Reindex\";\n+    removePathIfExists(path);\n+    _manager.getHelixDataAccessor().getBaseDataAccessor()\n+        .create(path, taskConfig.getTaskConfigZNRecord(), AccessOption.PERSISTENT);\n+\n+    // Submit workflow\n+    TaskDriver driver = new TaskDriver(_manager);\n+    String workflowName = TestHelper.getTestMethodName();\n+    submitWorkflow(workflowName, driver);\n+\n+    try {\n+      // Wait for the workflow to either complete or fail.\n+      TaskState finalState =\n+          driver.pollForWorkflowState(workflowName, TaskState.COMPLETED, TaskState.FAILED);\n+      AssertJUnit.assertEquals(finalState, TaskState.FAILED);\n+    } catch (HelixException e) {\n+      AssertJUnit.fail(e.getMessage());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ccedbc2154eba578d52315ced93f6d211ea95704"}, "originalPosition": 202}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY2OTM4MTQ1", "url": "https://github.com/apache/helix/pull/1169#pullrequestreview-466938145", "createdAt": "2020-08-13T16:45:50Z", "commit": {"oid": "ccedbc2154eba578d52315ced93f6d211ea95704"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QxNjo0NTo1MFrOHATzpQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QxNjo0NTo1MFrOHATzpQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDA4NjU2NQ==", "bodyText": "Style, structure, AssertJUnit.", "url": "https://github.com/apache/helix/pull/1169#discussion_r470086565", "createdAt": "2020-08-13T16:45:50Z", "author": {"login": "narendly"}, "path": "helix-core/src/test/java/org/apache/helix/task/TestDynamicTaskLoading.java", "diffHunk": "@@ -0,0 +1,251 @@\n+package org.apache.helix.task;\n+\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+import java.util.ArrayList;\n+import java.util.Collections;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+\n+import org.apache.helix.AccessOption;\n+import org.apache.helix.HelixException;\n+import org.apache.helix.HelixManager;\n+import org.apache.helix.HelixManagerFactory;\n+import org.apache.helix.InstanceType;\n+import org.apache.helix.TestHelper;\n+import org.apache.helix.common.ZkTestBase;\n+import org.apache.helix.examples.MasterSlaveStateModelFactory;\n+import org.apache.helix.integration.manager.ClusterControllerManager;\n+import org.apache.helix.integration.manager.MockParticipantManager;\n+import org.apache.helix.integration.task.MockTask;\n+import org.apache.helix.participant.StateMachineEngine;\n+import org.apache.helix.participant.statemachine.StateModel;\n+import org.apache.helix.participant.statemachine.StateModelFactory;\n+import org.testng.AssertJUnit;\n+import org.testng.annotations.AfterMethod;\n+import org.testng.annotations.BeforeMethod;\n+import org.testng.annotations.Test;\n+\n+public class TestDynamicTaskLoading extends ZkTestBase {\n+  private final String _clusterName = CLUSTER_PREFIX + \"_\" + getShortClassName();\n+  private static final String _instanceName = \"localhost_12913\";\n+  private HelixManager _manager;\n+  private MockParticipantManager _participant;\n+  private ClusterControllerManager _controller;\n+\n+  @BeforeMethod\n+  public void beforeMethod() throws Exception {\n+    _gSetupTool.addCluster(_clusterName, true);\n+\n+    _manager = HelixManagerFactory\n+        .getZKHelixManager(_clusterName, \"Admin\", InstanceType.ADMINISTRATOR, ZK_ADDR);\n+    _manager.connect();\n+\n+    _gSetupTool.addInstanceToCluster(_clusterName, _instanceName);\n+    _participant = new MockParticipantManager(ZK_ADDR, _clusterName, _instanceName);\n+    StateModelFactory<StateModel> stateModelFactory =\n+        new MasterSlaveStateModelFactory(_instanceName, 0);\n+    StateMachineEngine stateMach = _participant.getStateMachineEngine();\n+    stateMach.registerStateModelFactory(\"MasterSlave\", stateModelFactory);\n+    Map<String, TaskFactory> taskFactoryReg = new HashMap<>();\n+    _participant.getStateMachineEngine().registerStateModelFactory(TaskConstants.STATE_MODEL_NAME,\n+        new TaskStateModelFactory(_participant, taskFactoryReg));\n+    _participant.syncStart();\n+\n+    _controller = new ClusterControllerManager(ZK_ADDR, _clusterName, null);\n+    _controller.syncStart();\n+  }\n+\n+  private void removePathIfExists(String path) {\n+    if (_manager.getHelixDataAccessor().getBaseDataAccessor().exists(path, 0)) {\n+      _manager.getHelixDataAccessor().getBaseDataAccessor().remove(path, 0);\n+    }\n+  }\n+\n+  /**\n+   * Submit a workflow consisting of a job with a MockTask task.\n+   * @param workflowName name of the workflow\n+   * @param driver {@link TaskDriver} to submit workflowName to\n+   */\n+  private void submitWorkflow(String workflowName, TaskDriver driver) {\n+    JobConfig.Builder job = new JobConfig.Builder();\n+    job.setJobCommandConfigMap(Collections.singletonMap(MockTask.JOB_DELAY, \"100\"));\n+    Workflow.Builder workflow = new Workflow.Builder(workflowName);\n+    job.setWorkflow(workflowName);\n+    TaskConfig taskConfig =\n+        new TaskConfig(MockTask.TASK_COMMAND, new HashMap<String, String>(), null, null);\n+    job.addTaskConfigMap(Collections.singletonMap(taskConfig.getId(), taskConfig));\n+    job.setJobId(TaskUtil.getNamespacedJobName(workflowName, \"JOB\"));\n+    workflow.addJob(\"JOB\", job);\n+    driver.start(workflow.build());\n+  }\n+\n+  @Test\n+  public void testDynamicTaskLoading() throws Exception {\n+    // Add task definition information as a DynamicTaskConfig.\n+    List<String> taskClasses = new ArrayList<String>();\n+    taskClasses.add(\"com.mycompany.mocktask.MockTask\");\n+    DynamicTaskConfig taskConfig =\n+        new DynamicTaskConfig(\"Reindex\", \"src/test/resources/Reindex.jar\", \"1.0.0\", taskClasses,\n+            \"com.mycompany.mocktask.MockTaskFactory\");\n+    String path = TaskConstants.DYNAMICALLY_LOADED_TASK_PATH + \"/Reindex\";\n+    removePathIfExists(path);\n+    _manager.getHelixDataAccessor().getBaseDataAccessor()\n+        .create(path, taskConfig.getTaskConfigZNRecord(), AccessOption.PERSISTENT);\n+\n+    // Submit workflow\n+    TaskDriver driver = new TaskDriver(_manager);\n+    String workflowName = TestHelper.getTestMethodName();\n+    submitWorkflow(workflowName, driver);\n+\n+    try {\n+      // Wait for the workflow to either complete or fail.\n+      TaskState finalState =\n+          driver.pollForWorkflowState(workflowName, TaskState.COMPLETED, TaskState.FAILED);\n+      AssertJUnit.assertEquals(finalState, TaskState.COMPLETED);\n+    } catch (HelixException e) {\n+      AssertJUnit.fail(e.getMessage());\n+    }\n+  }\n+\n+  @Test\n+  public void testDynamicTaskLoadingNonexistingJar() throws Exception {\n+    // Add task definition information as a DynamicTaskConfig.\n+    List<String> taskClasses = new ArrayList<String>();\n+    taskClasses.add(\"com.mycompany.mocktask.MockTask\");\n+    DynamicTaskConfig taskConfig =\n+        new DynamicTaskConfig(\"Reindex\", \"src/test/resources/Random.jar\", \"1.0.0\", taskClasses,\n+            \"com.mycompany.mocktask.MockTaskFactory\");\n+    String path = TaskConstants.DYNAMICALLY_LOADED_TASK_PATH + \"/Reindex\";\n+    removePathIfExists(path);\n+    _manager.getHelixDataAccessor().getBaseDataAccessor()\n+        .create(path, taskConfig.getTaskConfigZNRecord(), AccessOption.PERSISTENT);\n+\n+    // Submit workflow\n+    TaskDriver driver = new TaskDriver(_manager);\n+    String workflowName = TestHelper.getTestMethodName();\n+    submitWorkflow(workflowName, driver);\n+\n+    try {\n+      // Wait for the workflow to either complete or fail.\n+      TaskState finalState =\n+          driver.pollForWorkflowState(workflowName, TaskState.COMPLETED, TaskState.FAILED);\n+      AssertJUnit.assertEquals(finalState, TaskState.FAILED);\n+    } catch (HelixException e) {\n+      AssertJUnit.fail(e.getMessage());\n+    }\n+  }\n+\n+  @Test\n+  public void testDynamicTaskLoadingNonexistingTaskConfig() throws Exception {\n+    // Remove task config ZNRecord if it exists.\n+    String path = TaskConstants.DYNAMICALLY_LOADED_TASK_PATH + \"/Reindex\";\n+    removePathIfExists(path);\n+\n+    // Submit workflow\n+    TaskDriver driver = new TaskDriver(_manager);\n+    String workflowName = TestHelper.getTestMethodName();\n+    submitWorkflow(workflowName, driver);\n+\n+    try {\n+      // Wait for the workflow to either complete or fail.\n+      TaskState finalState =\n+          driver.pollForWorkflowState(workflowName, TaskState.COMPLETED, TaskState.FAILED);\n+      AssertJUnit.assertEquals(finalState, TaskState.FAILED);\n+    } catch (HelixException e) {\n+      AssertJUnit.fail(e.getMessage());\n+    }\n+  }\n+\n+  @Test\n+  public void testDynamicTaskLoadingNonexistingTaskClass() throws Exception {\n+    // Add task definition information as a DynamicTaskConfig.\n+    List<String> taskClasses = new ArrayList<String>();\n+    taskClasses.add(\"com.mycompany.mocktask.RandomTask\");\n+    DynamicTaskConfig taskConfig =\n+        new DynamicTaskConfig(\"Reindex\", \"src/test/resources/Reindex.jar\", \"1.0.0\", taskClasses,\n+            \"com.mycompany.mocktask.MockTaskFactory\");\n+    String path = TaskConstants.DYNAMICALLY_LOADED_TASK_PATH + \"/Reindex\";\n+    removePathIfExists(path);\n+    _manager.getHelixDataAccessor().getBaseDataAccessor()\n+        .create(path, taskConfig.getTaskConfigZNRecord(), AccessOption.PERSISTENT);\n+\n+    // Submit workflow\n+    TaskDriver driver = new TaskDriver(_manager);\n+    String workflowName = TestHelper.getTestMethodName();\n+    submitWorkflow(workflowName, driver);\n+\n+    try {\n+      // Wait for the workflow to either complete or fail.\n+      TaskState finalState =\n+          driver.pollForWorkflowState(workflowName, TaskState.COMPLETED, TaskState.FAILED);\n+      AssertJUnit.assertEquals(finalState, TaskState.FAILED);\n+    } catch (HelixException e) {\n+      AssertJUnit.fail(e.getMessage());\n+    }\n+  }\n+\n+  @Test\n+  public void testDynamicTaskLoadingNonexistingTaskFactory() throws Exception {\n+    // Add task definition information as a DynamicTaskConfig.\n+    List<String> taskClasses = new ArrayList<String>();\n+    taskClasses.add(\"com.mycompany.mocktask.MockTask\");\n+    DynamicTaskConfig taskConfig =\n+        new DynamicTaskConfig(\"Reindex\", \"src/test/resources/Reindex.jar\", \"1.0.0\", taskClasses,\n+            \"com.mycompany.mocktask.RandomTaskFactory\");\n+    String path = TaskConstants.DYNAMICALLY_LOADED_TASK_PATH + \"/Reindex\";\n+    removePathIfExists(path);\n+    _manager.getHelixDataAccessor().getBaseDataAccessor()\n+        .create(path, taskConfig.getTaskConfigZNRecord(), AccessOption.PERSISTENT);\n+\n+    // Submit workflow\n+    TaskDriver driver = new TaskDriver(_manager);\n+    String workflowName = TestHelper.getTestMethodName();\n+    submitWorkflow(workflowName, driver);\n+\n+    try {\n+      // Wait for the workflow to either complete or fail.\n+      TaskState finalState =\n+          driver.pollForWorkflowState(workflowName, TaskState.COMPLETED, TaskState.FAILED);\n+      AssertJUnit.assertEquals(finalState, TaskState.FAILED);\n+    } catch (HelixException e) {\n+      AssertJUnit.fail(e.getMessage());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ccedbc2154eba578d52315ced93f6d211ea95704"}, "originalPosition": 230}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY2OTM4NTM1", "url": "https://github.com/apache/helix/pull/1169#pullrequestreview-466938535", "createdAt": "2020-08-13T16:46:22Z", "commit": {"oid": "ccedbc2154eba578d52315ced93f6d211ea95704"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QxNjo0NjoyM1rOHAT01w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QxNjo0NjoyM1rOHAT01w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDA4Njg3MQ==", "bodyText": "Is it possible to use AfterClass instead to avoid redundant work of starting and shutting down threads?", "url": "https://github.com/apache/helix/pull/1169#discussion_r470086871", "createdAt": "2020-08-13T16:46:23Z", "author": {"login": "narendly"}, "path": "helix-core/src/test/java/org/apache/helix/task/TestDynamicTaskLoading.java", "diffHunk": "@@ -0,0 +1,251 @@\n+package org.apache.helix.task;\n+\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+import java.util.ArrayList;\n+import java.util.Collections;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+\n+import org.apache.helix.AccessOption;\n+import org.apache.helix.HelixException;\n+import org.apache.helix.HelixManager;\n+import org.apache.helix.HelixManagerFactory;\n+import org.apache.helix.InstanceType;\n+import org.apache.helix.TestHelper;\n+import org.apache.helix.common.ZkTestBase;\n+import org.apache.helix.examples.MasterSlaveStateModelFactory;\n+import org.apache.helix.integration.manager.ClusterControllerManager;\n+import org.apache.helix.integration.manager.MockParticipantManager;\n+import org.apache.helix.integration.task.MockTask;\n+import org.apache.helix.participant.StateMachineEngine;\n+import org.apache.helix.participant.statemachine.StateModel;\n+import org.apache.helix.participant.statemachine.StateModelFactory;\n+import org.testng.AssertJUnit;\n+import org.testng.annotations.AfterMethod;\n+import org.testng.annotations.BeforeMethod;\n+import org.testng.annotations.Test;\n+\n+public class TestDynamicTaskLoading extends ZkTestBase {\n+  private final String _clusterName = CLUSTER_PREFIX + \"_\" + getShortClassName();\n+  private static final String _instanceName = \"localhost_12913\";\n+  private HelixManager _manager;\n+  private MockParticipantManager _participant;\n+  private ClusterControllerManager _controller;\n+\n+  @BeforeMethod\n+  public void beforeMethod() throws Exception {\n+    _gSetupTool.addCluster(_clusterName, true);\n+\n+    _manager = HelixManagerFactory\n+        .getZKHelixManager(_clusterName, \"Admin\", InstanceType.ADMINISTRATOR, ZK_ADDR);\n+    _manager.connect();\n+\n+    _gSetupTool.addInstanceToCluster(_clusterName, _instanceName);\n+    _participant = new MockParticipantManager(ZK_ADDR, _clusterName, _instanceName);\n+    StateModelFactory<StateModel> stateModelFactory =\n+        new MasterSlaveStateModelFactory(_instanceName, 0);\n+    StateMachineEngine stateMach = _participant.getStateMachineEngine();\n+    stateMach.registerStateModelFactory(\"MasterSlave\", stateModelFactory);\n+    Map<String, TaskFactory> taskFactoryReg = new HashMap<>();\n+    _participant.getStateMachineEngine().registerStateModelFactory(TaskConstants.STATE_MODEL_NAME,\n+        new TaskStateModelFactory(_participant, taskFactoryReg));\n+    _participant.syncStart();\n+\n+    _controller = new ClusterControllerManager(ZK_ADDR, _clusterName, null);\n+    _controller.syncStart();\n+  }\n+\n+  private void removePathIfExists(String path) {\n+    if (_manager.getHelixDataAccessor().getBaseDataAccessor().exists(path, 0)) {\n+      _manager.getHelixDataAccessor().getBaseDataAccessor().remove(path, 0);\n+    }\n+  }\n+\n+  /**\n+   * Submit a workflow consisting of a job with a MockTask task.\n+   * @param workflowName name of the workflow\n+   * @param driver {@link TaskDriver} to submit workflowName to\n+   */\n+  private void submitWorkflow(String workflowName, TaskDriver driver) {\n+    JobConfig.Builder job = new JobConfig.Builder();\n+    job.setJobCommandConfigMap(Collections.singletonMap(MockTask.JOB_DELAY, \"100\"));\n+    Workflow.Builder workflow = new Workflow.Builder(workflowName);\n+    job.setWorkflow(workflowName);\n+    TaskConfig taskConfig =\n+        new TaskConfig(MockTask.TASK_COMMAND, new HashMap<String, String>(), null, null);\n+    job.addTaskConfigMap(Collections.singletonMap(taskConfig.getId(), taskConfig));\n+    job.setJobId(TaskUtil.getNamespacedJobName(workflowName, \"JOB\"));\n+    workflow.addJob(\"JOB\", job);\n+    driver.start(workflow.build());\n+  }\n+\n+  @Test\n+  public void testDynamicTaskLoading() throws Exception {\n+    // Add task definition information as a DynamicTaskConfig.\n+    List<String> taskClasses = new ArrayList<String>();\n+    taskClasses.add(\"com.mycompany.mocktask.MockTask\");\n+    DynamicTaskConfig taskConfig =\n+        new DynamicTaskConfig(\"Reindex\", \"src/test/resources/Reindex.jar\", \"1.0.0\", taskClasses,\n+            \"com.mycompany.mocktask.MockTaskFactory\");\n+    String path = TaskConstants.DYNAMICALLY_LOADED_TASK_PATH + \"/Reindex\";\n+    removePathIfExists(path);\n+    _manager.getHelixDataAccessor().getBaseDataAccessor()\n+        .create(path, taskConfig.getTaskConfigZNRecord(), AccessOption.PERSISTENT);\n+\n+    // Submit workflow\n+    TaskDriver driver = new TaskDriver(_manager);\n+    String workflowName = TestHelper.getTestMethodName();\n+    submitWorkflow(workflowName, driver);\n+\n+    try {\n+      // Wait for the workflow to either complete or fail.\n+      TaskState finalState =\n+          driver.pollForWorkflowState(workflowName, TaskState.COMPLETED, TaskState.FAILED);\n+      AssertJUnit.assertEquals(finalState, TaskState.COMPLETED);\n+    } catch (HelixException e) {\n+      AssertJUnit.fail(e.getMessage());\n+    }\n+  }\n+\n+  @Test\n+  public void testDynamicTaskLoadingNonexistingJar() throws Exception {\n+    // Add task definition information as a DynamicTaskConfig.\n+    List<String> taskClasses = new ArrayList<String>();\n+    taskClasses.add(\"com.mycompany.mocktask.MockTask\");\n+    DynamicTaskConfig taskConfig =\n+        new DynamicTaskConfig(\"Reindex\", \"src/test/resources/Random.jar\", \"1.0.0\", taskClasses,\n+            \"com.mycompany.mocktask.MockTaskFactory\");\n+    String path = TaskConstants.DYNAMICALLY_LOADED_TASK_PATH + \"/Reindex\";\n+    removePathIfExists(path);\n+    _manager.getHelixDataAccessor().getBaseDataAccessor()\n+        .create(path, taskConfig.getTaskConfigZNRecord(), AccessOption.PERSISTENT);\n+\n+    // Submit workflow\n+    TaskDriver driver = new TaskDriver(_manager);\n+    String workflowName = TestHelper.getTestMethodName();\n+    submitWorkflow(workflowName, driver);\n+\n+    try {\n+      // Wait for the workflow to either complete or fail.\n+      TaskState finalState =\n+          driver.pollForWorkflowState(workflowName, TaskState.COMPLETED, TaskState.FAILED);\n+      AssertJUnit.assertEquals(finalState, TaskState.FAILED);\n+    } catch (HelixException e) {\n+      AssertJUnit.fail(e.getMessage());\n+    }\n+  }\n+\n+  @Test\n+  public void testDynamicTaskLoadingNonexistingTaskConfig() throws Exception {\n+    // Remove task config ZNRecord if it exists.\n+    String path = TaskConstants.DYNAMICALLY_LOADED_TASK_PATH + \"/Reindex\";\n+    removePathIfExists(path);\n+\n+    // Submit workflow\n+    TaskDriver driver = new TaskDriver(_manager);\n+    String workflowName = TestHelper.getTestMethodName();\n+    submitWorkflow(workflowName, driver);\n+\n+    try {\n+      // Wait for the workflow to either complete or fail.\n+      TaskState finalState =\n+          driver.pollForWorkflowState(workflowName, TaskState.COMPLETED, TaskState.FAILED);\n+      AssertJUnit.assertEquals(finalState, TaskState.FAILED);\n+    } catch (HelixException e) {\n+      AssertJUnit.fail(e.getMessage());\n+    }\n+  }\n+\n+  @Test\n+  public void testDynamicTaskLoadingNonexistingTaskClass() throws Exception {\n+    // Add task definition information as a DynamicTaskConfig.\n+    List<String> taskClasses = new ArrayList<String>();\n+    taskClasses.add(\"com.mycompany.mocktask.RandomTask\");\n+    DynamicTaskConfig taskConfig =\n+        new DynamicTaskConfig(\"Reindex\", \"src/test/resources/Reindex.jar\", \"1.0.0\", taskClasses,\n+            \"com.mycompany.mocktask.MockTaskFactory\");\n+    String path = TaskConstants.DYNAMICALLY_LOADED_TASK_PATH + \"/Reindex\";\n+    removePathIfExists(path);\n+    _manager.getHelixDataAccessor().getBaseDataAccessor()\n+        .create(path, taskConfig.getTaskConfigZNRecord(), AccessOption.PERSISTENT);\n+\n+    // Submit workflow\n+    TaskDriver driver = new TaskDriver(_manager);\n+    String workflowName = TestHelper.getTestMethodName();\n+    submitWorkflow(workflowName, driver);\n+\n+    try {\n+      // Wait for the workflow to either complete or fail.\n+      TaskState finalState =\n+          driver.pollForWorkflowState(workflowName, TaskState.COMPLETED, TaskState.FAILED);\n+      AssertJUnit.assertEquals(finalState, TaskState.FAILED);\n+    } catch (HelixException e) {\n+      AssertJUnit.fail(e.getMessage());\n+    }\n+  }\n+\n+  @Test\n+  public void testDynamicTaskLoadingNonexistingTaskFactory() throws Exception {\n+    // Add task definition information as a DynamicTaskConfig.\n+    List<String> taskClasses = new ArrayList<String>();\n+    taskClasses.add(\"com.mycompany.mocktask.MockTask\");\n+    DynamicTaskConfig taskConfig =\n+        new DynamicTaskConfig(\"Reindex\", \"src/test/resources/Reindex.jar\", \"1.0.0\", taskClasses,\n+            \"com.mycompany.mocktask.RandomTaskFactory\");\n+    String path = TaskConstants.DYNAMICALLY_LOADED_TASK_PATH + \"/Reindex\";\n+    removePathIfExists(path);\n+    _manager.getHelixDataAccessor().getBaseDataAccessor()\n+        .create(path, taskConfig.getTaskConfigZNRecord(), AccessOption.PERSISTENT);\n+\n+    // Submit workflow\n+    TaskDriver driver = new TaskDriver(_manager);\n+    String workflowName = TestHelper.getTestMethodName();\n+    submitWorkflow(workflowName, driver);\n+\n+    try {\n+      // Wait for the workflow to either complete or fail.\n+      TaskState finalState =\n+          driver.pollForWorkflowState(workflowName, TaskState.COMPLETED, TaskState.FAILED);\n+      AssertJUnit.assertEquals(finalState, TaskState.FAILED);\n+    } catch (HelixException e) {\n+      AssertJUnit.fail(e.getMessage());\n+    }\n+  }\n+\n+  @AfterMethod\n+  public void afterMethod() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ccedbc2154eba578d52315ced93f6d211ea95704"}, "originalPosition": 235}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "22e16ff09a0a1924afde59231f5b2d627b99de1a", "author": {"user": {"login": "rabashizade", "name": "Ramin Bashizade"}}, "url": "https://github.com/apache/helix/commit/22e16ff09a0a1924afde59231f5b2d627b99de1a", "committedDate": "2020-08-13T21:52:57Z", "message": "Fix style and formatting"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY3MTg2NjE3", "url": "https://github.com/apache/helix/pull/1169#pullrequestreview-467186617", "createdAt": "2020-08-13T23:02:39Z", "commit": {"oid": "22e16ff09a0a1924afde59231f5b2d627b99de1a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QyMzowMjozOVrOHAgiYQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QyMzowMjozOVrOHAgiYQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDI5NTEzNw==", "bodyText": "Duplicate strings. Please factor it out to a local String variable throughout the test.", "url": "https://github.com/apache/helix/pull/1169#discussion_r470295137", "createdAt": "2020-08-13T23:02:39Z", "author": {"login": "narendly"}, "path": "helix-core/src/main/java/org/apache/helix/task/TaskStateModel.java", "diffHunk": "@@ -283,6 +288,75 @@ public void reset() {\n     }\n   }\n \n+  /**\n+   * Loads className using classLoader\n+   * @param classLoader\n+   * @param className\n+   * @return Class className loaded by classLoader\n+   */\n+  private Class loadClass(URLClassLoader classLoader, String className) {\n+    try {\n+      return classLoader.loadClass(className);\n+    } catch (ClassNotFoundException e) {\n+      LOG.error(\"Failed to load Task class \" + className + \" for new task in instance \" + _manager\n+          .getInstanceName() + \" in cluster \" + _manager.getClusterName() + \".\");\n+      throw new IllegalStateException(\"Class not found for task\");\n+    }\n+  }\n+\n+  /**\n+   * Loads Task and TaskFactory classes for command input from\n+   * a JAR file, and registers the TaskFactory in _taskFactoryRegistry.\n+   * @param command The command indicating what task to be loaded\n+   */\n+  private void loadNewTask(String command) {\n+    // If the path for dynamic tasks doesn't exist, skip loading the task\n+    if (!_manager.getHelixDataAccessor().getBaseDataAccessor()\n+        .exists(TaskConstants.DYNAMICALLY_LOADED_TASK_PATH, 0)) {\n+      LOG.error(\"Path for dynamic tasks doesn't exist!\");\n+      throw new IllegalStateException(\"Path for dynamic tasks doesn't exist!\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "22e16ff09a0a1924afde59231f5b2d627b99de1a"}, "originalPosition": 54}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY3MTg2Nzcw", "url": "https://github.com/apache/helix/pull/1169#pullrequestreview-467186770", "createdAt": "2020-08-13T23:03:00Z", "commit": {"oid": "22e16ff09a0a1924afde59231f5b2d627b99de1a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QyMzowMzowMVrOHAgiyw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QyMzowMzowMVrOHAgiyw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDI5NTI0Mw==", "bodyText": "Let's make sure error messages are consistent.", "url": "https://github.com/apache/helix/pull/1169#discussion_r470295243", "createdAt": "2020-08-13T23:03:01Z", "author": {"login": "narendly"}, "path": "helix-core/src/main/java/org/apache/helix/task/TaskStateModel.java", "diffHunk": "@@ -283,6 +288,75 @@ public void reset() {\n     }\n   }\n \n+  /**\n+   * Loads className using classLoader\n+   * @param classLoader\n+   * @param className\n+   * @return Class className loaded by classLoader\n+   */\n+  private Class loadClass(URLClassLoader classLoader, String className) {\n+    try {\n+      return classLoader.loadClass(className);\n+    } catch (ClassNotFoundException e) {\n+      LOG.error(\"Failed to load Task class \" + className + \" for new task in instance \" + _manager\n+          .getInstanceName() + \" in cluster \" + _manager.getClusterName() + \".\");\n+      throw new IllegalStateException(\"Class not found for task\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "22e16ff09a0a1924afde59231f5b2d627b99de1a"}, "originalPosition": 40}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "eb7a9ad1bfbb5f0c848a70d406f59ba950719d1e", "author": {"user": {"login": "rabashizade", "name": "Ramin Bashizade"}}, "url": "https://github.com/apache/helix/commit/eb7a9ad1bfbb5f0c848a70d406f59ba950719d1e", "committedDate": "2020-08-14T00:01:55Z", "message": "Improve documentation and style"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "122ed49711d1d1bfb10507bd018786fdbeba9adc", "author": {"user": {"login": "rabashizade", "name": "Ramin Bashizade"}}, "url": "https://github.com/apache/helix/commit/122ed49711d1d1bfb10507bd018786fdbeba9adc", "committedDate": "2020-08-14T14:18:29Z", "message": "Remove unnecessary import"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bbb3bfdd5e0286ebfe3a177a4671c96f9d18b51c", "author": {"user": {"login": "rabashizade", "name": "Ramin Bashizade"}}, "url": "https://github.com/apache/helix/commit/bbb3bfdd5e0286ebfe3a177a4671c96f9d18b51c", "committedDate": "2020-08-14T14:33:47Z", "message": "Fix variable declaration"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY3Nzk2NDc0", "url": "https://github.com/apache/helix/pull/1169#pullrequestreview-467796474", "createdAt": "2020-08-14T18:34:32Z", "commit": {"oid": "bbb3bfdd5e0286ebfe3a177a4671c96f9d18b51c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4578, "cost": 1, "resetAt": "2021-10-29T19:57:52Z"}}}