{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTIyMDgyMDk3", "number": 1534, "reviewThreads": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xN1QxODozNDozMFrOE6KUVw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOFQwMDowNTo0N1rOE6SXfA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI5NDIxOTExOnYy", "diffSide": "RIGHT", "path": "helix-core/src/test/java/org/apache/helix/participant/TestDistControllerElection.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xN1QxODozNDozMFrOH1DirA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xN1QyMDoxODowNFrOH1JLew==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTM5NDYwNA==", "bodyText": "nit, shutdown the controller first would be safer.", "url": "https://github.com/apache/helix/pull/1534#discussion_r525394604", "createdAt": "2020-11-17T18:34:30Z", "author": {"login": "jiajunwang"}, "path": "helix-core/src/test/java/org/apache/helix/participant/TestDistControllerElection.java", "diffHunk": "@@ -72,36 +73,45 @@ public void testController() throws Exception {\n     DistributedLeaderElection election =\n         new DistributedLeaderElection(manager, controller0, timerTasks);\n     NotificationContext context = new NotificationContext(manager);\n-    context.setType(NotificationContext.Type.INIT);\n-    election.onControllerChange(context);\n-\n-    // path = PropertyPathConfig.getPath(PropertyType.LEADER, clusterName);\n-    // ZNRecord leaderRecord = _gZkClient.<ZNRecord> readData(path);\n-    LiveInstance liveInstance = accessor.getProperty(keyBuilder.controllerLeader());\n-    AssertJUnit.assertEquals(controllerName, liveInstance.getInstanceName());\n-    // AssertJUnit.assertNotNull(election.getController());\n-    // AssertJUnit.assertNull(election.getLeader());\n+    try {\n+      context.setType(NotificationContext.Type.INIT);\n+      election.onControllerChange(context);\n+\n+      // path = PropertyPathConfig.getPath(PropertyType.LEADER, clusterName);\n+      // ZNRecord leaderRecord = _gZkClient.<ZNRecord> readData(path);\n+      LiveInstance liveInstance = accessor.getProperty(keyBuilder.controllerLeader());\n+      AssertJUnit.assertEquals(controllerName, liveInstance.getInstanceName());\n+      // AssertJUnit.assertNotNull(election.getController());\n+      // AssertJUnit.assertNull(election.getLeader());\n+    } finally {\n+      manager.disconnect();\n+      controller0.shutdown();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fecc175a79d0a753bda63bd624572c6c420b06a5"}, "originalPosition": 33}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTQ4Njk3MQ==", "bodyText": "changed.", "url": "https://github.com/apache/helix/pull/1534#discussion_r525486971", "createdAt": "2020-11-17T20:18:04Z", "author": {"login": "kaisun2000"}, "path": "helix-core/src/test/java/org/apache/helix/participant/TestDistControllerElection.java", "diffHunk": "@@ -72,36 +73,45 @@ public void testController() throws Exception {\n     DistributedLeaderElection election =\n         new DistributedLeaderElection(manager, controller0, timerTasks);\n     NotificationContext context = new NotificationContext(manager);\n-    context.setType(NotificationContext.Type.INIT);\n-    election.onControllerChange(context);\n-\n-    // path = PropertyPathConfig.getPath(PropertyType.LEADER, clusterName);\n-    // ZNRecord leaderRecord = _gZkClient.<ZNRecord> readData(path);\n-    LiveInstance liveInstance = accessor.getProperty(keyBuilder.controllerLeader());\n-    AssertJUnit.assertEquals(controllerName, liveInstance.getInstanceName());\n-    // AssertJUnit.assertNotNull(election.getController());\n-    // AssertJUnit.assertNull(election.getLeader());\n+    try {\n+      context.setType(NotificationContext.Type.INIT);\n+      election.onControllerChange(context);\n+\n+      // path = PropertyPathConfig.getPath(PropertyType.LEADER, clusterName);\n+      // ZNRecord leaderRecord = _gZkClient.<ZNRecord> readData(path);\n+      LiveInstance liveInstance = accessor.getProperty(keyBuilder.controllerLeader());\n+      AssertJUnit.assertEquals(controllerName, liveInstance.getInstanceName());\n+      // AssertJUnit.assertNotNull(election.getController());\n+      // AssertJUnit.assertNull(election.getLeader());\n+    } finally {\n+      manager.disconnect();\n+      controller0.shutdown();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTM5NDYwNA=="}, "originalCommit": {"oid": "fecc175a79d0a753bda63bd624572c6c420b06a5"}, "originalPosition": 33}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI5NDIyMjU0OnYy", "diffSide": "RIGHT", "path": "helix-core/src/test/java/org/apache/helix/participant/TestDistControllerElection.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xN1QxODozNToxOVrOH1DkwA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xN1QyMDoxODoxM1rOH1JMGw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTM5NTEzNg==", "bodyText": "Same here.", "url": "https://github.com/apache/helix/pull/1534#discussion_r525395136", "createdAt": "2020-11-17T18:35:19Z", "author": {"login": "jiajunwang"}, "path": "helix-core/src/test/java/org/apache/helix/participant/TestDistControllerElection.java", "diffHunk": "@@ -72,36 +73,45 @@ public void testController() throws Exception {\n     DistributedLeaderElection election =\n         new DistributedLeaderElection(manager, controller0, timerTasks);\n     NotificationContext context = new NotificationContext(manager);\n-    context.setType(NotificationContext.Type.INIT);\n-    election.onControllerChange(context);\n-\n-    // path = PropertyPathConfig.getPath(PropertyType.LEADER, clusterName);\n-    // ZNRecord leaderRecord = _gZkClient.<ZNRecord> readData(path);\n-    LiveInstance liveInstance = accessor.getProperty(keyBuilder.controllerLeader());\n-    AssertJUnit.assertEquals(controllerName, liveInstance.getInstanceName());\n-    // AssertJUnit.assertNotNull(election.getController());\n-    // AssertJUnit.assertNull(election.getLeader());\n+    try {\n+      context.setType(NotificationContext.Type.INIT);\n+      election.onControllerChange(context);\n+\n+      // path = PropertyPathConfig.getPath(PropertyType.LEADER, clusterName);\n+      // ZNRecord leaderRecord = _gZkClient.<ZNRecord> readData(path);\n+      LiveInstance liveInstance = accessor.getProperty(keyBuilder.controllerLeader());\n+      AssertJUnit.assertEquals(controllerName, liveInstance.getInstanceName());\n+      // AssertJUnit.assertNotNull(election.getController());\n+      // AssertJUnit.assertNull(election.getLeader());\n+    } finally {\n+      manager.disconnect();\n+      controller0.shutdown();\n+    }\n \n     manager =\n         new MockZKHelixManager(clusterName, \"controller_1\", InstanceType.CONTROLLER, _gZkClient);\n     GenericHelixController controller1 = new GenericHelixController();\n     election = new DistributedLeaderElection(manager, controller1, timerTasks);\n     context = new NotificationContext(manager);\n     context.setType(NotificationContext.Type.INIT);\n-    election.onControllerChange(context);\n-    // leaderRecord = _gZkClient.<ZNRecord> readData(path);\n-    liveInstance = accessor.getProperty(keyBuilder.controllerLeader());\n-    AssertJUnit.assertEquals(controllerName, liveInstance.getInstanceName());\n-    // AssertJUnit.assertNull(election.getController());\n-    // AssertJUnit.assertNull(election.getLeader());\n-\n-    accessor.removeProperty(keyBuilder.controllerLeader());\n-    TestHelper.dropCluster(clusterName, _gZkClient);\n+    try {\n+      election.onControllerChange(context);\n+      // leaderRecord = _gZkClient.<ZNRecord> readData(path);\n+      LiveInstance liveInstance = accessor.getProperty(keyBuilder.controllerLeader());\n+      AssertJUnit.assertEquals(controllerName, liveInstance.getInstanceName());\n+      // AssertJUnit.assertNull(election.getController());\n+      // AssertJUnit.assertNull(election.getLeader());\n+    } finally {\n+      manager.disconnect();\n+      controller1.shutdown();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fecc175a79d0a753bda63bd624572c6c420b06a5"}, "originalPosition": 60}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTQ4NzEzMQ==", "bodyText": "changed.", "url": "https://github.com/apache/helix/pull/1534#discussion_r525487131", "createdAt": "2020-11-17T20:18:13Z", "author": {"login": "kaisun2000"}, "path": "helix-core/src/test/java/org/apache/helix/participant/TestDistControllerElection.java", "diffHunk": "@@ -72,36 +73,45 @@ public void testController() throws Exception {\n     DistributedLeaderElection election =\n         new DistributedLeaderElection(manager, controller0, timerTasks);\n     NotificationContext context = new NotificationContext(manager);\n-    context.setType(NotificationContext.Type.INIT);\n-    election.onControllerChange(context);\n-\n-    // path = PropertyPathConfig.getPath(PropertyType.LEADER, clusterName);\n-    // ZNRecord leaderRecord = _gZkClient.<ZNRecord> readData(path);\n-    LiveInstance liveInstance = accessor.getProperty(keyBuilder.controllerLeader());\n-    AssertJUnit.assertEquals(controllerName, liveInstance.getInstanceName());\n-    // AssertJUnit.assertNotNull(election.getController());\n-    // AssertJUnit.assertNull(election.getLeader());\n+    try {\n+      context.setType(NotificationContext.Type.INIT);\n+      election.onControllerChange(context);\n+\n+      // path = PropertyPathConfig.getPath(PropertyType.LEADER, clusterName);\n+      // ZNRecord leaderRecord = _gZkClient.<ZNRecord> readData(path);\n+      LiveInstance liveInstance = accessor.getProperty(keyBuilder.controllerLeader());\n+      AssertJUnit.assertEquals(controllerName, liveInstance.getInstanceName());\n+      // AssertJUnit.assertNotNull(election.getController());\n+      // AssertJUnit.assertNull(election.getLeader());\n+    } finally {\n+      manager.disconnect();\n+      controller0.shutdown();\n+    }\n \n     manager =\n         new MockZKHelixManager(clusterName, \"controller_1\", InstanceType.CONTROLLER, _gZkClient);\n     GenericHelixController controller1 = new GenericHelixController();\n     election = new DistributedLeaderElection(manager, controller1, timerTasks);\n     context = new NotificationContext(manager);\n     context.setType(NotificationContext.Type.INIT);\n-    election.onControllerChange(context);\n-    // leaderRecord = _gZkClient.<ZNRecord> readData(path);\n-    liveInstance = accessor.getProperty(keyBuilder.controllerLeader());\n-    AssertJUnit.assertEquals(controllerName, liveInstance.getInstanceName());\n-    // AssertJUnit.assertNull(election.getController());\n-    // AssertJUnit.assertNull(election.getLeader());\n-\n-    accessor.removeProperty(keyBuilder.controllerLeader());\n-    TestHelper.dropCluster(clusterName, _gZkClient);\n+    try {\n+      election.onControllerChange(context);\n+      // leaderRecord = _gZkClient.<ZNRecord> readData(path);\n+      LiveInstance liveInstance = accessor.getProperty(keyBuilder.controllerLeader());\n+      AssertJUnit.assertEquals(controllerName, liveInstance.getInstanceName());\n+      // AssertJUnit.assertNull(election.getController());\n+      // AssertJUnit.assertNull(election.getLeader());\n+    } finally {\n+      manager.disconnect();\n+      controller1.shutdown();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTM5NTEzNg=="}, "originalCommit": {"oid": "fecc175a79d0a753bda63bd624572c6c420b06a5"}, "originalPosition": 60}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI5NDIyNzE5OnYy", "diffSide": "RIGHT", "path": "helix-core/src/test/java/org/apache/helix/participant/TestDistControllerElection.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xN1QxODozNjozMVrOH1Dnwg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xN1QyMDoxNzo1NVrOH1JK3Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTM5NTkwNg==", "bodyText": "How about the managers? Please disconnect them too.", "url": "https://github.com/apache/helix/pull/1534#discussion_r525395906", "createdAt": "2020-11-17T18:36:31Z", "author": {"login": "jiajunwang"}, "path": "helix-core/src/test/java/org/apache/helix/participant/TestDistControllerElection.java", "diffHunk": "@@ -197,35 +218,42 @@ public void testCompeteLeadership() throws Exception {\n \n     // Create controller leaders\n     final Map<String, ZKHelixManager> managerList = new HashMap<>();\n+    final List<GenericHelixController> controllers = new ArrayList<>();\n     for (int i = 0; i < managerCount; i++) {\n       String controllerName = \"controller_\" + i;\n       ZKHelixManager manager =\n           new ZKHelixManager(clusterName, controllerName, InstanceType.CONTROLLER, ZK_ADDR);\n       GenericHelixController controller0 = new GenericHelixController();\n       DistributedLeaderElection election =\n           new DistributedLeaderElection(manager, controller0, Collections.EMPTY_LIST);\n+      controllers.add(controller0);\n       manager.connect();\n       managerList.put(manager.getInstanceName(), manager);\n     }\n \n-    // Remove leader manager one by one, and verify if the leader node exists\n-    while(!managerList.isEmpty()) {\n-      // Ensure a controller successfully acquired leadership.\n-      Assert.assertTrue(TestHelper.verify(new TestHelper.Verifier() {\n-        @Override\n-        public boolean verify() {\n-          LiveInstance liveInstance = accessor.getProperty(keyBuilder.controllerLeader());\n-          if (liveInstance != null) {\n-            // disconnect the current leader manager\n-            managerList.remove(liveInstance.getInstanceName()).disconnect();\n-            return true;\n-          } else {\n-            return false;\n+    try {\n+      // Remove leader manager one by one, and verify if the leader node exists\n+      while (!managerList.isEmpty()) {\n+        // Ensure a controller successfully acquired leadership.\n+        Assert.assertTrue(TestHelper.verify(new TestHelper.Verifier() {\n+          @Override\n+          public boolean verify() {\n+            LiveInstance liveInstance = accessor.getProperty(keyBuilder.controllerLeader());\n+            if (liveInstance != null) {\n+              // disconnect the current leader manager\n+              managerList.remove(liveInstance.getInstanceName()).disconnect();\n+              return true;\n+            } else {\n+              return false;\n+            }\n           }\n-        }\n-      }, 1000));\n+        }, 1000));\n+      }\n+    } finally {\n+      for (GenericHelixController controller : controllers) {\n+        controller.shutdown();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fecc175a79d0a753bda63bd624572c6c420b06a5"}, "originalPosition": 203}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTQ4NjgxMw==", "bodyText": "good point. added.", "url": "https://github.com/apache/helix/pull/1534#discussion_r525486813", "createdAt": "2020-11-17T20:17:55Z", "author": {"login": "kaisun2000"}, "path": "helix-core/src/test/java/org/apache/helix/participant/TestDistControllerElection.java", "diffHunk": "@@ -197,35 +218,42 @@ public void testCompeteLeadership() throws Exception {\n \n     // Create controller leaders\n     final Map<String, ZKHelixManager> managerList = new HashMap<>();\n+    final List<GenericHelixController> controllers = new ArrayList<>();\n     for (int i = 0; i < managerCount; i++) {\n       String controllerName = \"controller_\" + i;\n       ZKHelixManager manager =\n           new ZKHelixManager(clusterName, controllerName, InstanceType.CONTROLLER, ZK_ADDR);\n       GenericHelixController controller0 = new GenericHelixController();\n       DistributedLeaderElection election =\n           new DistributedLeaderElection(manager, controller0, Collections.EMPTY_LIST);\n+      controllers.add(controller0);\n       manager.connect();\n       managerList.put(manager.getInstanceName(), manager);\n     }\n \n-    // Remove leader manager one by one, and verify if the leader node exists\n-    while(!managerList.isEmpty()) {\n-      // Ensure a controller successfully acquired leadership.\n-      Assert.assertTrue(TestHelper.verify(new TestHelper.Verifier() {\n-        @Override\n-        public boolean verify() {\n-          LiveInstance liveInstance = accessor.getProperty(keyBuilder.controllerLeader());\n-          if (liveInstance != null) {\n-            // disconnect the current leader manager\n-            managerList.remove(liveInstance.getInstanceName()).disconnect();\n-            return true;\n-          } else {\n-            return false;\n+    try {\n+      // Remove leader manager one by one, and verify if the leader node exists\n+      while (!managerList.isEmpty()) {\n+        // Ensure a controller successfully acquired leadership.\n+        Assert.assertTrue(TestHelper.verify(new TestHelper.Verifier() {\n+          @Override\n+          public boolean verify() {\n+            LiveInstance liveInstance = accessor.getProperty(keyBuilder.controllerLeader());\n+            if (liveInstance != null) {\n+              // disconnect the current leader manager\n+              managerList.remove(liveInstance.getInstanceName()).disconnect();\n+              return true;\n+            } else {\n+              return false;\n+            }\n           }\n-        }\n-      }, 1000));\n+        }, 1000));\n+      }\n+    } finally {\n+      for (GenericHelixController controller : controllers) {\n+        controller.shutdown();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTM5NTkwNg=="}, "originalCommit": {"oid": "fecc175a79d0a753bda63bd624572c6c420b06a5"}, "originalPosition": 203}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI5NDIzMzAyOnYy", "diffSide": "RIGHT", "path": "helix-core/src/test/java/org/apache/helix/tools/TestClusterSetup.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xN1QxODozNzo0OVrOH1DrLA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xN1QyMDoyNzowNlrOH1J2jQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTM5Njc4MA==", "bodyText": "nit, you probably want to extract a private method for this section to reduce duplication.", "url": "https://github.com/apache/helix/pull/1534#discussion_r525396780", "createdAt": "2020-11-17T18:37:49Z", "author": {"login": "jiajunwang"}, "path": "helix-core/src/test/java/org/apache/helix/tools/TestClusterSetup.java", "diffHunk": "@@ -73,44 +73,63 @@\n   public void beforeClass() throws Exception {\n     System.out\n         .println(\"START TestClusterSetup.beforeClass() \" + new Date(System.currentTimeMillis()));\n+    _clusterSetup = new ClusterSetup(ZK_ADDR);\n   }\n \n   @AfterClass()\n   public void afterClass() {\n     deleteCluster(CLUSTER_NAME);\n+    _clusterSetup.close();\n     System.out.println(\"END TestClusterSetup.afterClass() \" + new Date(System.currentTimeMillis()));\n   }\n \n   @BeforeMethod()\n   public void setup() {\n-\n-    _gZkClient.deleteRecursively(\"/\" + CLUSTER_NAME);\n-    _clusterSetup = new ClusterSetup(ZK_ADDR);\n-    _clusterSetup.addCluster(CLUSTER_NAME, true);\n+    try {\n+      _gZkClient.deleteRecursively(\"/\" + CLUSTER_NAME);\n+      _clusterSetup.addCluster(CLUSTER_NAME, true);\n+    } catch (Exception e) {\n+      System.out.println(\"@BeforeMethod TestClusterSetup exception:\" + e);\n+    }\n   }\n \n-  @Test\n+  // Note, with mvn 3.6.1, we have a nasty bug that running \"mvn test\" under helix-core,\n+  // all the bellow test will be invoked after other test including @AfterClass cleanup of this\n+  // This bug does not happen of running command as \"mvn test -Dtest=TestClusterSetup\". Nor does it\n+  // happen in intellij. The workaround found is to add dependsOnMethods attribute to all the rest.\n+  @Test(dependsOnMethods = \"testAddClusterWithValidCloudConfig\")\n   public void testZkAdminTimeout() {\n     boolean exceptionThrown = false;\n+    ZKHelixAdmin admin = null;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fecc175a79d0a753bda63bd624572c6c420b06a5"}, "originalPosition": 36}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTQ5Nzk5Nw==", "bodyText": "added an test helper to reduce duplicated code.", "url": "https://github.com/apache/helix/pull/1534#discussion_r525497997", "createdAt": "2020-11-17T20:27:06Z", "author": {"login": "kaisun2000"}, "path": "helix-core/src/test/java/org/apache/helix/tools/TestClusterSetup.java", "diffHunk": "@@ -73,44 +73,63 @@\n   public void beforeClass() throws Exception {\n     System.out\n         .println(\"START TestClusterSetup.beforeClass() \" + new Date(System.currentTimeMillis()));\n+    _clusterSetup = new ClusterSetup(ZK_ADDR);\n   }\n \n   @AfterClass()\n   public void afterClass() {\n     deleteCluster(CLUSTER_NAME);\n+    _clusterSetup.close();\n     System.out.println(\"END TestClusterSetup.afterClass() \" + new Date(System.currentTimeMillis()));\n   }\n \n   @BeforeMethod()\n   public void setup() {\n-\n-    _gZkClient.deleteRecursively(\"/\" + CLUSTER_NAME);\n-    _clusterSetup = new ClusterSetup(ZK_ADDR);\n-    _clusterSetup.addCluster(CLUSTER_NAME, true);\n+    try {\n+      _gZkClient.deleteRecursively(\"/\" + CLUSTER_NAME);\n+      _clusterSetup.addCluster(CLUSTER_NAME, true);\n+    } catch (Exception e) {\n+      System.out.println(\"@BeforeMethod TestClusterSetup exception:\" + e);\n+    }\n   }\n \n-  @Test\n+  // Note, with mvn 3.6.1, we have a nasty bug that running \"mvn test\" under helix-core,\n+  // all the bellow test will be invoked after other test including @AfterClass cleanup of this\n+  // This bug does not happen of running command as \"mvn test -Dtest=TestClusterSetup\". Nor does it\n+  // happen in intellij. The workaround found is to add dependsOnMethods attribute to all the rest.\n+  @Test(dependsOnMethods = \"testAddClusterWithValidCloudConfig\")\n   public void testZkAdminTimeout() {\n     boolean exceptionThrown = false;\n+    ZKHelixAdmin admin = null;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTM5Njc4MA=="}, "originalCommit": {"oid": "fecc175a79d0a753bda63bd624572c6c420b06a5"}, "originalPosition": 36}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI5NTUzNzg4OnYy", "diffSide": "RIGHT", "path": "helix-core/src/test/java/org/apache/helix/controller/changedetector/TestResourceChangeDetector.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOFQwMDowNTo0N1rOH1QhIg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOFQwMDo0OToxN1rOH1RcBA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTYwNzIwMg==", "bodyText": "nit: Can we do\nAssert.assertTrue(_clusterVerifier.verify()); ?", "url": "https://github.com/apache/helix/pull/1534#discussion_r525607202", "createdAt": "2020-11-18T00:05:47Z", "author": {"login": "xyuanlu"}, "path": "helix-core/src/test/java/org/apache/helix/controller/changedetector/TestResourceChangeDetector.java", "diffHunk": "@@ -431,8 +431,12 @@ public void testResetSnapshots() {\n             .setResources(new HashSet<>(_dataAccessor.getChildNames(_keyBuilder.idealStates())))\n             .setWaitTillVerify(TestHelper.DEFAULT_REBALANCE_PROCESSING_WAIT_TIME)\n             .build();\n-    Assert.assertTrue(_clusterVerifier.verify());\n-\n+    try {\n+      boolean result = _clusterVerifier.verify();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "407ed4fe2966e317b123518fe58975d8f0c5fa87"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTYyMjI3Ng==", "bodyText": "Changed.", "url": "https://github.com/apache/helix/pull/1534#discussion_r525622276", "createdAt": "2020-11-18T00:49:17Z", "author": {"login": "kaisun2000"}, "path": "helix-core/src/test/java/org/apache/helix/controller/changedetector/TestResourceChangeDetector.java", "diffHunk": "@@ -431,8 +431,12 @@ public void testResetSnapshots() {\n             .setResources(new HashSet<>(_dataAccessor.getChildNames(_keyBuilder.idealStates())))\n             .setWaitTillVerify(TestHelper.DEFAULT_REBALANCE_PROCESSING_WAIT_TIME)\n             .build();\n-    Assert.assertTrue(_clusterVerifier.verify());\n-\n+    try {\n+      boolean result = _clusterVerifier.verify();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTYwNzIwMg=="}, "originalCommit": {"oid": "407ed4fe2966e317b123518fe58975d8f0c5fa87"}, "originalPosition": 7}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 804, "cost": 1, "resetAt": "2021-11-11T21:28:48Z"}}}