{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM4MTk5MTM2", "number": 1114, "title": "Fix the queue not going to IN_PROGRESS state", "bodyText": "Issues\n\n My PR addresses the following Helix issues and references them in the PR title:\nFixes #1113\n\nDescription\n\n Here are some details about my PR, including screenshots of any UI changes:\nThis PR fixes the scenario where the workflow context does not change\nto IN_PROGRESS when it does not contain any job that needs to be run.\nAlso, since I have been observed that TestDeleteWorkflow is becoming unstable. Hence, in this PR, the DELETE_DELAY has been increase to 5 seconds.\n\nTests\n\n\n The following tests are written for this issue:\nTestStopAndResumeQueue\n\n\n The following is the result of the \"mvn test\" command on the appropriate module:\n\n\nhelix-core:\n[INFO] Results:\n[INFO] \n[ERROR] Failures: \n[ERROR]   TestJobQueueCleanUp.testJobQueueAutoCleanUp \u00bb ThreadTimeout Method org.testng....\n[ERROR]   TestTaskRebalancer.timeouts:200 expected:<true> but was:<false>\n[INFO] \n[ERROR] Tests run: 1146, Failures: 2, Errors: 0, Skipped: 0\n[INFO] \n[INFO] ------------------------------------------------------------------------\n[INFO] BUILD FAILURE\n[INFO] ------------------------------------------------------------------------\n[INFO] Total time:  01:27 h\n[INFO] Finished at: 2020-06-22T12:15:29-07:00\n[INFO] ------------------------------------------------------------------------\n\nThe failed test succeeded when run individually.\nmvn test -Dtest=\"TestJobQueueCleanUp,TestTaskRebalancer\"\n[INFO] Tests run: 10, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 34.156 s - in TestSuite\n[INFO] \n[INFO] Results:\n[INFO] \n[INFO] Tests run: 10, Failures: 0, Errors: 0, Skipped: 0\n[INFO] \n[INFO] ------------------------------------------------------------------------\n[INFO] BUILD SUCCESS\n[INFO] ------------------------------------------------------------------------\n[INFO] Total time:  39.794 s\n[INFO] Finished at: 2020-06-22T14:55:23-07:00\n[INFO] ------------------------------------------------------------------------\n\nhelix-rest:\n[INFO] Tests run: 163, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 46.595 s - in TestSuite\n[INFO] \n[INFO] Results:\n[INFO] \n[INFO] Tests run: 163, Failures: 0, Errors: 0, Skipped: 0\n[INFO] \n[INFO] ------------------------------------------------------------------------\n[INFO] BUILD SUCCESS\n[INFO] ------------------------------------------------------------------------\n[INFO] Total time:  51.789 s\n[INFO] Finished at: 2020-06-22T14:58:27-07:00\n[INFO] ------------------------------------------------------------------------\n\nCommits\n\n My commits all reference appropriate Apache Helix GitHub issues in their subject lines, and I have squashed multiple commits if they address the same issue. In addition, my commits follow the guidelines from \"How to write a good git commit message\":\n\nSubject is separated from body by a blank line\nSubject is limited to 50 characters (not including Jira issue reference)\nSubject does not end with a period\nSubject uses the imperative mood (\"add\", not \"adding\")\nBody wraps at 72 characters\nBody explains \"what\" and \"why\", not \"how\"\n\n\n\nCode Quality\n\n My diff has been formatted using helix-style.xml", "createdAt": "2020-06-22T22:00:15Z", "url": "https://github.com/apache/helix/pull/1114", "merged": true, "mergeCommit": {"oid": "f0ffb8c0d7d9be610bd167aadbe42a7d80b5d562"}, "closed": true, "closedAt": "2020-06-30T18:15:19Z", "author": {"login": "alirezazamani"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABct4CklAH2gAyNDM4MTk5MTM2OmM4MzJkODEwMDVkOWE1MjhlYTA4MjYzYWQ4MzJlMWI0NTM3MjdhZTI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcu10BFgFqTQzNzg4Mjk4OA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "c832d81005d9a528ea08263ad832e1b453727ae2", "author": {"user": {"login": "alirezazamani", "name": "Ali Reza Zamani Zadeh Najari"}}, "url": "https://github.com/apache/helix/commit/c832d81005d9a528ea08263ad832e1b453727ae2", "committedDate": "2020-06-22T21:50:10Z", "message": "Fix the queue not going to IN_PROGRESS state\n\nThis commit fixed the scenario where the workflow context does not change\nto IN_PROGRESS when it does not contain any job that needs to be run."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM1OTM0NTU5", "url": "https://github.com/apache/helix/pull/1114#pullrequestreview-435934559", "createdAt": "2020-06-23T16:05:55Z", "commit": {"oid": "c832d81005d9a528ea08263ad832e1b453727ae2"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM1OTM2MTk3", "url": "https://github.com/apache/helix/pull/1114#pullrequestreview-435936197", "createdAt": "2020-06-23T16:07:25Z", "commit": {"oid": "c832d81005d9a528ea08263ad832e1b453727ae2"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yM1QxNjowNzoyNlrOGnwX8Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yM1QxNjowNzoyNlrOGnwX8Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDM0MDIwOQ==", "bodyText": "workflowCtx.getWorkflowState() is not going to be null right? If it could return null, we should do a reverse check.\nAlso, for enums, == would be the standard for comparison vs using equals().", "url": "https://github.com/apache/helix/pull/1114#discussion_r444340209", "createdAt": "2020-06-23T16:07:26Z", "author": {"login": "narendly"}, "path": "helix-core/src/main/java/org/apache/helix/task/WorkflowDispatcher.java", "diffHunk": "@@ -174,6 +174,16 @@ public void updateWorkflowStatus(String workflow, WorkflowConfig workflowCfg,\n       }\n       return;\n     }\n+\n+    // Step 6: handle workflow that should go IN_PROGRESS state after is has been resumed\n+    // This block is added to make sure if workflow/queue context state becomes IN_PROGRESS for the\n+    // case where A Queue which has been stopped before is just resumed and queue does not contain\n+    // any job that needs to be run.\n+    if (targetState.equals(TargetState.START)\n+        && workflowCtx.getWorkflowState().equals(TaskState.STOPPED)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c832d81005d9a528ea08263ad832e1b453727ae2"}, "originalPosition": 10}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "17e9431fd2432f424eac3b9af08bad6b0fabd659", "author": {"user": {"login": "alirezazamani", "name": "Ali Reza Zamani Zadeh Najari"}}, "url": "https://github.com/apache/helix/commit/17e9431fd2432f424eac3b9af08bad6b0fabd659", "committedDate": "2020-06-25T21:42:05Z", "message": "Address comments"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM3ODgyOTg4", "url": "https://github.com/apache/helix/pull/1114#pullrequestreview-437882988", "createdAt": "2020-06-25T21:48:23Z", "commit": {"oid": "17e9431fd2432f424eac3b9af08bad6b0fabd659"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4516, "cost": 1, "resetAt": "2021-10-29T19:57:52Z"}}}