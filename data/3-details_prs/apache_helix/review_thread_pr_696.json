{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY2MTI2NzE2", "number": 696, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yM1QwMTo0NTo0N1rODaCGuw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yM1QwMjoyNjo1MlrODaCenQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI4NjI0MDU5OnYy", "diffSide": "RIGHT", "path": "helix-core/src/main/java/org/apache/helix/controller/rebalancer/waged/WagedRebalancer.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yM1QwMTo0NTo0N1rOFgwvUA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yM1QxOToyMzo0MFrOFhJ38w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTg5NzI5Ng==", "bodyText": "Whether HelixManager is null or not is not and should not be a flag for DelayedRebalance. Why does the log specifically mention delayed rebalance here?", "url": "https://github.com/apache/helix/pull/696#discussion_r369897296", "createdAt": "2020-01-23T01:45:47Z", "author": {"login": "narendly"}, "path": "helix-core/src/main/java/org/apache/helix/controller/rebalancer/waged/WagedRebalancer.java", "diffHunk": "@@ -177,12 +172,13 @@ private WagedRebalancer(AssignmentMetadataStore assignmentMetadataStore,\n     _assignmentMetadataStore = assignmentMetadataStore;\n     _rebalanceAlgorithm = algorithm;\n     _mappingCalculator = mappingCalculator;\n+    if (manager == null) {\n+      LOG.warn(\"HelixManager is not provided. The rebalancer is not going to schedule for a future \"\n+          + \"rebalance even when delayed rebalance is enabled.\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b15bbd10381ad24fb8f6c89160210b723bd0415e"}, "originalPosition": 97}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDMwOTEwNw==", "bodyText": "DelayedRebalance != delayed rebalance.\nWAGED rebalancer also supports delayed rebalance feature. And this check will only impact this feature inside the WAGED rebalancer. We need to log it so when we debug we ensure if the delayed rebalance feature has been enabled or not.", "url": "https://github.com/apache/helix/pull/696#discussion_r370309107", "createdAt": "2020-01-23T19:23:40Z", "author": {"login": "jiajunwang"}, "path": "helix-core/src/main/java/org/apache/helix/controller/rebalancer/waged/WagedRebalancer.java", "diffHunk": "@@ -177,12 +172,13 @@ private WagedRebalancer(AssignmentMetadataStore assignmentMetadataStore,\n     _assignmentMetadataStore = assignmentMetadataStore;\n     _rebalanceAlgorithm = algorithm;\n     _mappingCalculator = mappingCalculator;\n+    if (manager == null) {\n+      LOG.warn(\"HelixManager is not provided. The rebalancer is not going to schedule for a future \"\n+          + \"rebalance even when delayed rebalance is enabled.\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTg5NzI5Ng=="}, "originalCommit": {"oid": "b15bbd10381ad24fb8f6c89160210b723bd0415e"}, "originalPosition": 97}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI4NjMwMTczOnYy", "diffSide": "RIGHT", "path": "helix-core/src/main/java/org/apache/helix/controller/rebalancer/waged/AssignmentMetadataStore.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yM1QwMjoyNjo1MlrOFgxTpA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yM1QxOToyNDo1NFrOFhJ6Fg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTkwNjU5Ng==", "bodyText": "Nit: I think clearMetadataStore() might be a better name for this method because caching isn't really an explicit feature? Or resetMetadataStore()?", "url": "https://github.com/apache/helix/pull/696#discussion_r369906596", "createdAt": "2020-01-23T02:26:52Z", "author": {"login": "narendly"}, "path": "helix-core/src/main/java/org/apache/helix/controller/rebalancer/waged/AssignmentMetadataStore.java", "diffHunk": "@@ -146,6 +146,17 @@ public boolean persistBestPossibleAssignment(\n     return true;\n   }\n \n+  protected synchronized void resetCache() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b15bbd10381ad24fb8f6c89160210b723bd0415e"}, "originalPosition": 40}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDMwOTY1NA==", "bodyText": "Let's just call it reset()\nAssignmentMetadataStore.resetMetadataStore() is redundent.", "url": "https://github.com/apache/helix/pull/696#discussion_r370309654", "createdAt": "2020-01-23T19:24:54Z", "author": {"login": "jiajunwang"}, "path": "helix-core/src/main/java/org/apache/helix/controller/rebalancer/waged/AssignmentMetadataStore.java", "diffHunk": "@@ -146,6 +146,17 @@ public boolean persistBestPossibleAssignment(\n     return true;\n   }\n \n+  protected synchronized void resetCache() {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTkwNjU5Ng=="}, "originalCommit": {"oid": "b15bbd10381ad24fb8f6c89160210b723bd0415e"}, "originalPosition": 40}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1550, "cost": 1, "resetAt": "2021-11-11T21:28:48Z"}}}