{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ0MjIyMDMx", "number": 84, "reviewThreads": {"totalCount": 17, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNlQwNTozNjo0NlrOELi5-w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wOC0yN1QxODo0MDo0M1rOGnx2kQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgwNTQxNjkxOnYy", "diffSide": "RIGHT", "path": "udfs/community/README.md", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNlQwNTozNjo0NlrOGtJYSg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNlQwNTozNjo0NlrOGtJYSg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTk5Mjc3OA==", "bodyText": "We could probably shorten this signature by making it named week_of_month", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/84#discussion_r449992778", "createdAt": "2020-07-06T05:36:46Z", "author": {"login": "ryanmcdowell"}, "path": "udfs/community/README.md", "diffHunk": "@@ -403,6 +415,16 @@ results:\n | facebook.com | NULL        | NULL             | NULL | rpc  |\n \n \n+### [week_number_of_month(date_expression ANY TYPE)](week_number_of_month.sql)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c8076abce410ff5029ebaf920c8346b8d6020d41"}, "originalPosition": 37}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgwNTQxNzgxOnYy", "diffSide": "RIGHT", "path": "udfs/community/day_occurrence_of_month.sql", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNlQwNTozNzoxNVrOGtJY0w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMVQyMzo0NTo0NFrOGwP-5Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTk5MjkxNQ==", "bodyText": "Add trailing new line", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/84#discussion_r449992915", "createdAt": "2020-07-06T05:37:15Z", "author": {"login": "ryanmcdowell"}, "path": "udfs/community/day_occurrence_of_month.sql", "diffHunk": "@@ -0,0 +1,29 @@\n+  \n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+-- day_occurrence_of_month: Returns the n th occurrence of the weekday in the month for the specified date.\n+-- Input: date_expression DATE or TIMESTAMP\n+-- Output: The result is an INTEGER value between 1 and 5, representing the n th occurrence of the weekday in the month.\n+CREATE OR REPLACE FUNCTION fn.day_occurrence_of_month(date_expression ANY TYPE) AS \n+(\n+  (\n+    SELECT \n+      IF(EXTRACT(DAYOFWEEK FROM DATE_TRUNC(CAST(date_expression AS DATE), MONTH)) > EXTRACT(DAYOFWEEK FROM date_expression),\n+        fn.week_number_of_month(date_expression),\n+        fn.week_number_of_month(date_expression) + 1)\n+  )\n+);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c8076abce410ff5029ebaf920c8346b8d6020d41"}, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzI0NjY5Mw==", "bodyText": "Where to add a trailing new line? I don't see any issues with formatting.", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/84#discussion_r453246693", "createdAt": "2020-07-11T23:45:44Z", "author": {"login": "epishova"}, "path": "udfs/community/day_occurrence_of_month.sql", "diffHunk": "@@ -0,0 +1,29 @@\n+  \n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+-- day_occurrence_of_month: Returns the n th occurrence of the weekday in the month for the specified date.\n+-- Input: date_expression DATE or TIMESTAMP\n+-- Output: The result is an INTEGER value between 1 and 5, representing the n th occurrence of the weekday in the month.\n+CREATE OR REPLACE FUNCTION fn.day_occurrence_of_month(date_expression ANY TYPE) AS \n+(\n+  (\n+    SELECT \n+      IF(EXTRACT(DAYOFWEEK FROM DATE_TRUNC(CAST(date_expression AS DATE), MONTH)) > EXTRACT(DAYOFWEEK FROM date_expression),\n+        fn.week_number_of_month(date_expression),\n+        fn.week_number_of_month(date_expression) + 1)\n+  )\n+);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTk5MjkxNQ=="}, "originalCommit": {"oid": "c8076abce410ff5029ebaf920c8346b8d6020d41"}, "originalPosition": 29}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgwNTQxODAwOnYy", "diffSide": "RIGHT", "path": "udfs/community/day_occurrence_of_month.sql", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNlQwNTozNzoyMVrOGtJY9A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNlQwNTozNzoyMVrOGtJY9A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTk5Mjk0OA==", "bodyText": "Delete blank line", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/84#discussion_r449992948", "createdAt": "2020-07-06T05:37:21Z", "author": {"login": "ryanmcdowell"}, "path": "udfs/community/day_occurrence_of_month.sql", "diffHunk": "@@ -0,0 +1,29 @@\n+  ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c8076abce410ff5029ebaf920c8346b8d6020d41"}, "originalPosition": 1}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgwNTQxOTIwOnYy", "diffSide": "RIGHT", "path": "udfs/community/day_occurrence_of_month.sql", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNlQwNTozNzo1OFrOGtJZlw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNlQwNTozNzo1OFrOGtJZlw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTk5MzExMQ==", "bodyText": "Place the EXTRACT call on the next line", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/84#discussion_r449993111", "createdAt": "2020-07-06T05:37:58Z", "author": {"login": "ryanmcdowell"}, "path": "udfs/community/day_occurrence_of_month.sql", "diffHunk": "@@ -0,0 +1,29 @@\n+  \n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+-- day_occurrence_of_month: Returns the n th occurrence of the weekday in the month for the specified date.\n+-- Input: date_expression DATE or TIMESTAMP\n+-- Output: The result is an INTEGER value between 1 and 5, representing the n th occurrence of the weekday in the month.\n+CREATE OR REPLACE FUNCTION fn.day_occurrence_of_month(date_expression ANY TYPE) AS \n+(\n+  (\n+    SELECT \n+      IF(EXTRACT(DAYOFWEEK FROM DATE_TRUNC(CAST(date_expression AS DATE), MONTH)) > EXTRACT(DAYOFWEEK FROM date_expression),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c8076abce410ff5029ebaf920c8346b8d6020d41"}, "originalPosition": 25}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgwNTQyMDQ0OnYy", "diffSide": "RIGHT", "path": "udfs/community/test_cases.yaml", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNlQwNTozODo1MlrOGtJaVA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMVQyMzozNjowMFrOGwP8VQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTk5MzMwMA==", "bodyText": "What is expected if the input value is NULL?", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/84#discussion_r449993300", "createdAt": "2020-07-06T05:38:52Z", "author": {"login": "ryanmcdowell"}, "path": "udfs/community/test_cases.yaml", "diffHunk": "@@ -293,4 +293,23 @@ percentage_difference:\n   - test:\n     input: CAST(1.0 AS FLOAT64), CAST(1000000000 AS INT64)\n     expected_output: CAST(2.0 AS FLOAT64)\n- \n+week_number_of_month:\n+  - test:\n+    input: CAST(\"2020-07-03\" AS DATE)\n+    expected_output: CAST(0 AS INT64)\n+  - test:\n+    input: CAST(\"2020-07-08\" AS DATE)\n+    expected_output: CAST(1 AS INT64)\n+  - test:\n+    input: CAST(\"2020-07-10\" AS DATE)\n+    expected_output: CAST(1 AS INT64)\n+day_occurrence_of_month:\n+  - test:\n+    input: CAST(\"2020-07-03\" AS DATE)\n+    expected_output: CAST(1 AS INT64)\n+  - test:\n+    input: CAST(\"2020-07-08\" AS DATE)\n+    expected_output: CAST(2 AS INT64)\n+  - test:\n+    input: CAST(\"2020-07-10\" AS DATE)\n+    expected_output: CAST(2 AS INT64)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c8076abce410ff5029ebaf920c8346b8d6020d41"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzI0NjAzNw==", "bodyText": "The function call will not compile if the input is NULL. It'll produce No matching signature for function EXTRACT for argument types...", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/84#discussion_r453246037", "createdAt": "2020-07-11T23:36:00Z", "author": {"login": "epishova"}, "path": "udfs/community/test_cases.yaml", "diffHunk": "@@ -293,4 +293,23 @@ percentage_difference:\n   - test:\n     input: CAST(1.0 AS FLOAT64), CAST(1000000000 AS INT64)\n     expected_output: CAST(2.0 AS FLOAT64)\n- \n+week_number_of_month:\n+  - test:\n+    input: CAST(\"2020-07-03\" AS DATE)\n+    expected_output: CAST(0 AS INT64)\n+  - test:\n+    input: CAST(\"2020-07-08\" AS DATE)\n+    expected_output: CAST(1 AS INT64)\n+  - test:\n+    input: CAST(\"2020-07-10\" AS DATE)\n+    expected_output: CAST(1 AS INT64)\n+day_occurrence_of_month:\n+  - test:\n+    input: CAST(\"2020-07-03\" AS DATE)\n+    expected_output: CAST(1 AS INT64)\n+  - test:\n+    input: CAST(\"2020-07-08\" AS DATE)\n+    expected_output: CAST(2 AS INT64)\n+  - test:\n+    input: CAST(\"2020-07-10\" AS DATE)\n+    expected_output: CAST(2 AS INT64)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTk5MzMwMA=="}, "originalCommit": {"oid": "c8076abce410ff5029ebaf920c8346b8d6020d41"}, "originalPosition": 24}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgwNTQyMDY0OnYy", "diffSide": "RIGHT", "path": "udfs/community/test_cases.yaml", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNlQwNTozOTowM1rOGtJacw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNlQwNTozOTowM1rOGtJacw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTk5MzMzMQ==", "bodyText": "Add trailing new line", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/84#discussion_r449993331", "createdAt": "2020-07-06T05:39:03Z", "author": {"login": "ryanmcdowell"}, "path": "udfs/community/test_cases.yaml", "diffHunk": "@@ -293,4 +293,23 @@ percentage_difference:\n   - test:\n     input: CAST(1.0 AS FLOAT64), CAST(1000000000 AS INT64)\n     expected_output: CAST(2.0 AS FLOAT64)\n- \n+week_number_of_month:\n+  - test:\n+    input: CAST(\"2020-07-03\" AS DATE)\n+    expected_output: CAST(0 AS INT64)\n+  - test:\n+    input: CAST(\"2020-07-08\" AS DATE)\n+    expected_output: CAST(1 AS INT64)\n+  - test:\n+    input: CAST(\"2020-07-10\" AS DATE)\n+    expected_output: CAST(1 AS INT64)\n+day_occurrence_of_month:\n+  - test:\n+    input: CAST(\"2020-07-03\" AS DATE)\n+    expected_output: CAST(1 AS INT64)\n+  - test:\n+    input: CAST(\"2020-07-08\" AS DATE)\n+    expected_output: CAST(2 AS INT64)\n+  - test:\n+    input: CAST(\"2020-07-10\" AS DATE)\n+    expected_output: CAST(2 AS INT64)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c8076abce410ff5029ebaf920c8346b8d6020d41"}, "originalPosition": 24}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgwNTQyMDg3OnYy", "diffSide": "RIGHT", "path": "udfs/community/week_number_of_month.sql", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNlQwNTozOToxMlrOGtJamw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNlQwNTozOToxMlrOGtJamw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTk5MzM3MQ==", "bodyText": "Add trailing new line", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/84#discussion_r449993371", "createdAt": "2020-07-06T05:39:12Z", "author": {"login": "ryanmcdowell"}, "path": "udfs/community/week_number_of_month.sql", "diffHunk": "@@ -0,0 +1,27 @@\n+  \n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+-- week_number_of_month: Returns the number of weeks from the beginning of the month to the specified date\n+-- Input: date_expression DATE or TIMESTAMP\n+-- Output: The result is an INTEGER value between 1 and 5, representing the nth occurrence of the week in the month. The value 0 means the partial week\n+CREATE OR REPLACE FUNCTION fn.week_number_of_month(date_expression ANY TYPE) AS \n+(\n+  (\n+    SELECT \n+      EXTRACT(WEEK FROM date_expression) - EXTRACT(WEEK FROM DATE_TRUNC(CAST(date_expression AS DATE), MONTH))\n+  )\n+);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c8076abce410ff5029ebaf920c8346b8d6020d41"}, "originalPosition": 27}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgwNTQyMTEwOnYy", "diffSide": "RIGHT", "path": "udfs/community/week_number_of_month.sql", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNlQwNTozOToxOFrOGtJauw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNlQwNTozOToxOFrOGtJauw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTk5MzQwMw==", "bodyText": "Delete blank line", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/84#discussion_r449993403", "createdAt": "2020-07-06T05:39:18Z", "author": {"login": "ryanmcdowell"}, "path": "udfs/community/week_number_of_month.sql", "diffHunk": "@@ -0,0 +1,27 @@\n+  ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c8076abce410ff5029ebaf920c8346b8d6020d41"}, "originalPosition": 1}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgwNTQyMjI2OnYy", "diffSide": "RIGHT", "path": "udfs/community/README.md", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNlQwNTozOTo1OFrOGtJbSw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNlQwNTozOTo1OFrOGtJbSw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTk5MzU0Nw==", "bodyText": "nth*", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/84#discussion_r449993547", "createdAt": "2020-07-06T05:39:58Z", "author": {"login": "ryanmcdowell"}, "path": "udfs/community/README.md", "diffHunk": "@@ -72,6 +75,15 @@ results:\n | a   | b     |\n \n \n+### [day_occurrence_of_month(date_expression ANY TYPE)](day_occurrence_of_month.sql)\n+Returns the n th occurrence of the weekday in the month for the specified date. The result is an INTEGER value between 1 and 5.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c8076abce410ff5029ebaf920c8346b8d6020d41"}, "originalPosition": 22}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkNDQ0MjU1OTYwOnYy", "diffSide": "RIGHT", "path": "udfs/community/day_occurrence_of_month.sql", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wOC0yN1QxNDoxODowMFrOKZKuZA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wOC0yN1QxNDoxODowMFrOKZKuZA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY5NzQ3ODc1Ng==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    fn.week_number_of_month(date_expression),\n          \n          \n            \n                    fn.week_number_of_month(date_expression) + 1)\n          \n          \n            \n                    bqutil.fn.week_number_of_month(date_expression),\n          \n          \n            \n                    bqutil.fn.week_number_of_month(date_expression) + 1)", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/84#discussion_r697478756", "createdAt": "2021-08-27T14:18:00Z", "author": {"login": "danieldeleo"}, "path": "udfs/community/day_occurrence_of_month.sql", "diffHunk": "@@ -0,0 +1,30 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+-- day_occurrence_of_month: Returns the n th occurrence of the weekday in the month for the specified date.\n+-- Input: date_expression DATE or TIMESTAMP\n+-- Output: The result is an INTEGER value between 1 and 5, representing the n th occurrence of the weekday in the month.\n+CREATE OR REPLACE FUNCTION fn.day_occurrence_of_month(date_expression ANY TYPE) AS \n+(\n+  (\n+    SELECT \n+      IF(\n+      \tEXTRACT(DAYOFWEEK FROM DATE_TRUNC(CAST(date_expression AS DATE), MONTH))\n+      \t  > EXTRACT(DAYOFWEEK FROM date_expression),\n+        fn.week_number_of_month(date_expression),\n+        fn.week_number_of_month(date_expression) + 1)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "20410cde94b6a923a91b36b86ec10fb68a9e01c7"}, "originalPosition": 28}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkNDQ0MzU5MTcwOnYy", "diffSide": "RIGHT", "path": "udfs/community/test_cases.yaml", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wOC0yN1QxODoyNjowM1rOKZUieQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wOC0yN1QxODoyNjowM1rOKZUieQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY5NzYzOTU0NQ==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/84#discussion_r697639545", "createdAt": "2021-08-27T18:26:03Z", "author": {"login": "danieldeleo"}, "path": "udfs/community/test_cases.yaml", "diffHunk": "@@ -451,4 +471,4 @@ linear_regression:\n   - test:\n     input: (SELECT [ (5.1,2.5), (5.0,2.0), (5.7,2.6), (6.0,2.2), (5.8,2.6), (5.5,2.3), (6.1,2.8), (5.5,2.5), (6.4,3.2), (5.6,3.0)])\n     expected_output: STRUCT(CAST(-0.4353361094588436 AS FLOAT64) AS a, CAST( 0.5300416418798544 AS FLOAT64) AS b, CAST(0.632366563565354 AS FLOAT64) AS r)\n-    \n+    ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5fd00274ce412a694a32aa6e6717b90bda27931b"}, "originalPosition": 32}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkNDQ0MzU5NTAwOnYy", "diffSide": "RIGHT", "path": "udfs/community/README.md", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wOC0yN1QxODoyNzowMVrOKZUkgg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wOC0yN1QxODoyNzowMVrOKZUkgg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY5NzY0MDA2Ng==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              bqutil.fn.week_number_of_month(DATE '2020-07-01'), \n          \n          \n            \n              bqutil.fn.week_number_of_month(DATE '2020-07-08');\n          \n          \n            \n              bqutil.fn.week_of_month(DATE '2020-07-01'), \n          \n          \n            \n              bqutil.fn.week_of_month(DATE '2020-07-08');", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/84#discussion_r697640066", "createdAt": "2021-08-27T18:27:01Z", "author": {"login": "danieldeleo"}, "path": "udfs/community/README.md", "diffHunk": "@@ -674,6 +686,16 @@ results:\n | facebook.com | NULL        | NULL             | NULL | rpc  |\n \n \n+### [week_number_of_month(date_expression ANY TYPE)](week_number_of_month.sql)\n+Returns the number of weeks from the beginning of the month to the specified date. The result is an INTEGER value between 1 and 5, representing the nth occurrence of the week in the month. The value 0 means the partial week.\n+\n+```sql\n+SELECT \n+  bqutil.fn.week_number_of_month(DATE '2020-07-01'), \n+  bqutil.fn.week_number_of_month(DATE '2020-07-08');", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5fd00274ce412a694a32aa6e6717b90bda27931b"}, "originalPosition": 43}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkNDQ0MzU5Njc0OnYy", "diffSide": "RIGHT", "path": "udfs/community/README.md", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wOC0yN1QxODoyNzoyOFrOKZUlgQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wOC0yN1QxODoyNzoyOFrOKZUlgQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY5NzY0MDMyMQ==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            * [week_number_of_month](#week_number_of_monthdate_expression-any-type)\n          \n          \n            \n            * [week_of_month](#week_of_monthdate_expression-any-type)", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/84#discussion_r697640321", "createdAt": "2021-08-27T18:27:28Z", "author": {"login": "danieldeleo"}, "path": "udfs/community/README.md", "diffHunk": "@@ -49,6 +50,8 @@ SELECT bqutil.fn.int(1.684)\n * [url_keys](#url_keysquery-string)\n * [url_param](#url_paramquery-string-p-string)\n * [url_parse](#url_parseurlstring-string-parttoextract-string)\n+* [week_number_of_month](#week_number_of_monthdate_expression-any-type)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5fd00274ce412a694a32aa6e6717b90bda27931b"}, "originalPosition": 12}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkNDQ0MzU5ODk3OnYy", "diffSide": "RIGHT", "path": "udfs/community/README.md", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wOC0yN1QxODoyNzo1N1rOKZUmwA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wOC0yN1QxODoyNzo1N1rOKZUmwA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY5NzY0MDY0MA==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            ### [week_number_of_month(date_expression ANY TYPE)](week_number_of_month.sql)\n          \n          \n            \n            ### [week_of_month(date_expression ANY TYPE)](week_of_month.sql)", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/84#discussion_r697640640", "createdAt": "2021-08-27T18:27:57Z", "author": {"login": "danieldeleo"}, "path": "udfs/community/README.md", "diffHunk": "@@ -674,6 +686,16 @@ results:\n | facebook.com | NULL        | NULL             | NULL | rpc  |\n \n \n+### [week_number_of_month(date_expression ANY TYPE)](week_number_of_month.sql)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5fd00274ce412a694a32aa6e6717b90bda27931b"}, "originalPosition": 37}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkNDQ0MzYwNTQyOnYy", "diffSide": "RIGHT", "path": "udfs/community/day_occurrence_of_month.sql", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wOC0yN1QxODoyOToyNVrOKZUqeA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wOC0yN1QxODoyOToyNVrOKZUqeA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY5NzY0MTU5Mg==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    bqutil.fn.week_number_of_month(date_expression),\n          \n          \n            \n                    bqutil.fn.week_number_of_month(date_expression) + 1)\n          \n          \n            \n                    bqutil.fn.week_of_month(date_expression),\n          \n          \n            \n                    bqutil.fn.week_of_month(date_expression) + 1)", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/84#discussion_r697641592", "createdAt": "2021-08-27T18:29:25Z", "author": {"login": "danieldeleo"}, "path": "udfs/community/day_occurrence_of_month.sql", "diffHunk": "@@ -0,0 +1,30 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+-- day_occurrence_of_month: Returns the n th occurrence of the weekday in the month for the specified date.\n+-- Input: date_expression DATE or TIMESTAMP\n+-- Output: The result is an INTEGER value between 1 and 5, representing the n th occurrence of the weekday in the month.\n+CREATE OR REPLACE FUNCTION fn.day_occurrence_of_month(date_expression ANY TYPE) AS \n+(\n+  (\n+    SELECT \n+      IF(\n+      \tEXTRACT(DAYOFWEEK FROM DATE_TRUNC(CAST(date_expression AS DATE), MONTH))\n+      \t  > EXTRACT(DAYOFWEEK FROM date_expression),\n+        bqutil.fn.week_number_of_month(date_expression),\n+        bqutil.fn.week_number_of_month(date_expression) + 1)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5fd00274ce412a694a32aa6e6717b90bda27931b"}, "originalPosition": 28}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkNDQ0MzYwNjQwOnYy", "diffSide": "RIGHT", "path": "udfs/community/test_cases.yaml", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wOC0yN1QxODoyOTo0M1rOKZUrGg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wOC0yN1QxODoyOTo0M1rOKZUrGg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY5NzY0MTc1NA==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            week_number_of_month:\n          \n          \n            \n            week_of_month:", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/84#discussion_r697641754", "createdAt": "2021-08-27T18:29:43Z", "author": {"login": "danieldeleo"}, "path": "udfs/community/test_cases.yaml", "diffHunk": "@@ -293,6 +293,26 @@ percentage_difference:\n   - test:\n     input: CAST(1.0 AS FLOAT64), CAST(1000000000 AS INT64)\n     expected_output: CAST(2.0 AS FLOAT64)\n+week_number_of_month:", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5fd00274ce412a694a32aa6e6717b90bda27931b"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkNDQ0MzY0NDMzOnYy", "diffSide": "RIGHT", "path": "udfs/community/test_cases.yaml", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wOC0yN1QxODo0MDo0M1rOKZVCiw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wOC0yN1QxODo0MDo0M1rOKZVCiw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY5NzY0Nzc1NQ==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                expected_output: STRUCT(CAST(-0.4353361094588436 AS FLOAT64) AS a, CAST( 0.5300416418798544 AS FLOAT64) AS b, CAST(0.632366563565354 AS FLOAT64) AS r)\n          \n          \n            \n                expected_output: STRUCT(CAST(-0.4353361094588436 AS FLOAT64) AS a, CAST( 0.5300416418798544 AS FLOAT64) AS b, CAST(0.632366563565354 AS FLOAT64) AS r)", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/84#discussion_r697647755", "createdAt": "2021-08-27T18:40:43Z", "author": {"login": "danieldeleo"}, "path": "udfs/community/test_cases.yaml", "diffHunk": "@@ -450,5 +470,4 @@ kruskal_wallis:\n linear_regression:\n   - test:\n     input: (SELECT [ (5.1,2.5), (5.0,2.0), (5.7,2.6), (6.0,2.2), (5.8,2.6), (5.5,2.3), (6.1,2.8), (5.5,2.5), (6.4,3.2), (5.6,3.0)])\n-    expected_output: STRUCT(CAST(-0.4353361094588436 AS FLOAT64) AS a, CAST( 0.5300416418798544 AS FLOAT64) AS b, CAST(0.632366563565354 AS FLOAT64) AS r)\n-    \n+    expected_output: STRUCT(CAST(-0.4353361094588436 AS FLOAT64) AS a, CAST( 0.5300416418798544 AS FLOAT64) AS b, CAST(0.632366563565354 AS FLOAT64) AS r)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8a22687142fd27da0e4da8f493fb5abea9e58768"}, "originalPosition": 33}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2988, "cost": 1, "resetAt": "2021-11-12T19:05:54Z"}}}