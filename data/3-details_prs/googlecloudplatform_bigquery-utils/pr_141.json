{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY0MzQ0NDcz", "number": 141, "title": "Auto Query Fixer: Implement the end-to-end data flow", "bodyText": "Implement the end-to-end data flow.\nProvide API for frontend.", "createdAt": "2020-08-07T01:49:56Z", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/141", "merged": true, "mergeCommit": {"oid": "ce6151efa684fe61fb15d42a15b0c46eb371c133"}, "closed": true, "closedAt": "2020-08-13T17:35:55Z", "author": {"login": "mingen-pan"}, "timelineItems": {"totalCount": 38, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcuk54QAH2gAyNDY0MzQ0NDczOmEyYTVhODRmZmRmNmNlZWJkNDNjZGRhMzlmMTc3ZjBiNGIxZGMxODc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc-jkKnAH2gAyNDY0MzQ0NDczOmFjNmYxOWNkOTc3NWMxMGJlYTNiMzE4N2ExYTEwZTIxOGIwMjRhOWE=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "a2a5a84ffdf6ceebd43cdda39f177f0b4b1dc187", "author": {"user": {"login": "mingen-pan", "name": "Mingen Pan"}}, "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/a2a5a84ffdf6ceebd43cdda39f177f0b4b1dc187", "committedDate": "2020-06-25T02:06:24Z", "message": "init a project\ncreate and test a QueryTokenService"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0f80bd6fc66697b00f278c0cc5ecee9063fb7639", "author": {"user": {"login": "mingen-pan", "name": "Mingen Pan"}}, "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/0f80bd6fc66697b00f278c0cc5ecee9063fb7639", "committedDate": "2020-06-30T21:11:52Z", "message": "reformat the code\nAdd comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0ebc50fab3773e85f8b30490392fce784f714f88", "author": {"user": {"login": "mingen-pan", "name": "Mingen Pan"}}, "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/0ebc50fab3773e85f8b30490392fce784f714f88", "committedDate": "2020-07-01T01:45:14Z", "message": "rename the package name to 'queryfixer'\n\nadd documents for classes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "eccb3d14310ca239e761705b5cab3c7c36768ff5", "author": {"user": {"login": "mingen-pan", "name": "Mingen Pan"}}, "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/eccb3d14310ca239e761705b5cab3c7c36768ff5", "committedDate": "2020-07-07T00:11:26Z", "message": "decompose the PR into multiple parts.\nThis is the first part: init the project and implement one feature of the QueryTokenProcessor"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5cd85f8bc0d7b871f86f875ca230bc9ad75121f3", "author": {"user": {"login": "mingen-pan", "name": "Mingen Pan"}}, "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/5cd85f8bc0d7b871f86f875ca230bc9ad75121f3", "committedDate": "2020-07-07T00:39:55Z", "message": "minor change in BigQueryParserFactory"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cd47ab9d336640ffccccd762a54e7fa3058fb4ba", "author": {"user": {"login": "mingen-pan", "name": "Mingen Pan"}}, "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/cd47ab9d336640ffccccd762a54e7fa3058fb4ba", "committedDate": "2020-07-08T20:08:21Z", "message": "add BigQueryService"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8b86a8e36bd784a29c6e7357ff786036a77b80bf", "author": {"user": {"login": "mingen-pan", "name": "Mingen Pan"}}, "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/8b86a8e36bd784a29c6e7357ff786036a77b80bf", "committedDate": "2020-07-09T18:43:35Z", "message": "revise the review"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7f907074ad2175483fa52068793fbafe3baf970e", "author": {"user": {"login": "mingen-pan", "name": "Mingen Pan"}}, "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/7f907074ad2175483fa52068793fbafe3baf970e", "committedDate": "2020-07-11T00:19:20Z", "message": "minor fix"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5fc21d436af780f16ed51e00bb3b00c2509b0f4e", "author": {"user": {"login": "mingen-pan", "name": "Mingen Pan"}}, "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/5fc21d436af780f16ed51e00bb3b00c2509b0f4e", "committedDate": "2020-07-11T00:26:03Z", "message": "Merge branch 'mepan_init' into master"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2c41e10f848ea306e0d10842bfa3e05592798b7e", "author": {"user": {"login": "mingen-pan", "name": "Mingen Pan"}}, "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/2c41e10f848ea306e0d10842bfa3e05592798b7e", "committedDate": "2020-07-11T00:49:36Z", "message": "Merge branch 'master' into mepan_add_bq_server"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cf3f6c4eafc7c91b8c0172ce82d1ff8566968d19", "author": {"user": {"login": "mingen-pan", "name": "Mingen Pan"}}, "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/cf3f6c4eafc7c91b8c0172ce82d1ff8566968d19", "committedDate": "2020-07-14T23:12:20Z", "message": "Minor change"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0ec995d5a5ea403f94c91ed058473628aa66bc27", "author": {"user": {"login": "mingen-pan", "name": "Mingen Pan"}}, "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/0ec995d5a5ea403f94c91ed058473628aa66bc27", "committedDate": "2020-07-14T23:45:31Z", "message": "Merge branch 'master' of https://github.com/GoogleCloudPlatform/bigquery-utils into master"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2e82a5bd02d0dff1500944a4afa2ffeff09fd7e0", "author": {"user": {"login": "mingen-pan", "name": "Mingen Pan"}}, "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/2e82a5bd02d0dff1500944a4afa2ffeff09fd7e0", "committedDate": "2020-07-14T23:48:38Z", "message": "remove .idea"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a4d35daedc6e5acf807a6246ab5589ead88be753", "author": {"user": {"login": "mingen-pan", "name": "Mingen Pan"}}, "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/a4d35daedc6e5acf807a6246ab5589ead88be753", "committedDate": "2020-07-16T00:01:50Z", "message": "Merge remote-tracking branch 'origin/master' into master"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d7926f0fd2ca80d6e2f43a40c5632ae2d2722052", "author": {"user": {"login": "mingen-pan", "name": "Mingen Pan"}}, "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/d7926f0fd2ca80d6e2f43a40c5632ae2d2722052", "committedDate": "2020-08-06T21:56:37Z", "message": "Merge branch 'master' of https://github.com/GoogleCloudPlatform/bigquery-utils"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f0b6c3b67b941470566dc93425bb6de0373538f3", "author": {"user": {"login": "mingen-pan", "name": "Mingen Pan"}}, "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/f0b6c3b67b941470566dc93425bb6de0373538f3", "committedDate": "2020-08-07T01:45:39Z", "message": "Implement the end-to-end dataflow. The query fixer can support the frontend API."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY0NTMyODM0", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/141#pullrequestreview-464532834", "createdAt": "2020-08-10T19:53:22Z", "commit": {"oid": "f0b6c3b67b941470566dc93425bb6de0373538f3"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMFQxOTo1MzoyMlrOG-dSoQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMFQxOTo1MzoyMlrOG-dSoQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODE0NDgwMQ==", "bodyText": "\u201cThe error cannot be fixed automatically. \u201d", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/141#discussion_r468144801", "createdAt": "2020-08-10T19:53:22Z", "author": {"login": "kikkyo"}, "path": "tools/automatic_query_fixer/src/main/java/com/google/cloud/bigquery/utils/queryfixer/AutomaticQueryFixer.java", "diffHunk": "@@ -0,0 +1,73 @@\n+package com.google.cloud.bigquery.utils.queryfixer;\n+\n+import com.google.cloud.bigquery.BigQueryException;\n+import com.google.cloud.bigquery.BigQueryOptions;\n+import com.google.cloud.bigquery.utils.queryfixer.entity.FixResult;\n+import com.google.cloud.bigquery.utils.queryfixer.errors.BigQuerySqlError;\n+import com.google.cloud.bigquery.utils.queryfixer.errors.SqlErrorFactory;\n+import com.google.cloud.bigquery.utils.queryfixer.fixer.FixerFactory;\n+import com.google.cloud.bigquery.utils.queryfixer.fixer.IFixer;\n+import com.google.cloud.bigquery.utils.queryfixer.service.BigQueryService;\n+import com.google.cloud.bigquery.utils.queryfixer.tokenizer.CalciteTokenizer;\n+import com.google.cloud.bigquery.utils.queryfixer.tokenizer.QueryTokenProcessor;\n+import com.google.cloud.bigquery.utils.queryfixer.tokenizer.Tokenizer;\n+\n+/**\n+ * The entity to perform fixing logic. It uses dry-run to identify an error, extracts a fixer based\n+ * on the error, fix the error, and return the fix result.\n+ */\n+public class AutomaticQueryFixer {\n+\n+  private final BigQueryService service;\n+  private final SqlErrorFactory errorFactory;\n+  private final FixerFactory fixerFactory;\n+\n+  public AutomaticQueryFixer(BigQueryOptions options) {\n+    service = new BigQueryService(options);\n+    errorFactory = new SqlErrorFactory();\n+    QueryTokenProcessor tokenProcessor = buildQueryTokenProcessor();\n+    fixerFactory = new FixerFactory(tokenProcessor, service);\n+  }\n+\n+  public FixResult fix(String query) {\n+    BigQueryException exception = service.catchExceptionFromDryRun(query);\n+    if (exception == null) {\n+      return FixResult.noError();\n+    }\n+\n+    BigQuerySqlError sqlError = errorFactory.getError(exception);\n+    if (sqlError == null) {\n+      return fixNotSupport(exception);\n+    }\n+\n+    IFixer fixer = fixerFactory.getFixer(query, sqlError);\n+    if (fixer == null) {\n+      return fixNotSupport(sqlError);\n+    }\n+\n+    return fixer.fix();\n+  }\n+\n+  private QueryTokenProcessor buildQueryTokenProcessor() {\n+    BigQueryParserFactory parserFactory = new BigQueryParserFactory();\n+    Tokenizer tokenizer = new CalciteTokenizer(parserFactory);\n+    return new QueryTokenProcessor(tokenizer);\n+  }\n+\n+  private FixResult fixNotSupport(BigQueryException exception) {\n+    return FixResult.builder()\n+        .status(FixResult.Status.FAILURE)\n+        .approach(\"The fix of this error is not supported\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f0b6c3b67b941470566dc93425bb6de0373538f3"}, "originalPosition": 60}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY0NTMyOTYx", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/141#pullrequestreview-464532961", "createdAt": "2020-08-10T19:53:33Z", "commit": {"oid": "f0b6c3b67b941470566dc93425bb6de0373538f3"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMFQxOTo1MzozM1rOG-dTEA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMFQxOTo1MzozM1rOG-dTEA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODE0NDkxMg==", "bodyText": "\u201cThe error cannot be fixed automatically. \u201d", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/141#discussion_r468144912", "createdAt": "2020-08-10T19:53:33Z", "author": {"login": "kikkyo"}, "path": "tools/automatic_query_fixer/src/main/java/com/google/cloud/bigquery/utils/queryfixer/AutomaticQueryFixer.java", "diffHunk": "@@ -0,0 +1,73 @@\n+package com.google.cloud.bigquery.utils.queryfixer;\n+\n+import com.google.cloud.bigquery.BigQueryException;\n+import com.google.cloud.bigquery.BigQueryOptions;\n+import com.google.cloud.bigquery.utils.queryfixer.entity.FixResult;\n+import com.google.cloud.bigquery.utils.queryfixer.errors.BigQuerySqlError;\n+import com.google.cloud.bigquery.utils.queryfixer.errors.SqlErrorFactory;\n+import com.google.cloud.bigquery.utils.queryfixer.fixer.FixerFactory;\n+import com.google.cloud.bigquery.utils.queryfixer.fixer.IFixer;\n+import com.google.cloud.bigquery.utils.queryfixer.service.BigQueryService;\n+import com.google.cloud.bigquery.utils.queryfixer.tokenizer.CalciteTokenizer;\n+import com.google.cloud.bigquery.utils.queryfixer.tokenizer.QueryTokenProcessor;\n+import com.google.cloud.bigquery.utils.queryfixer.tokenizer.Tokenizer;\n+\n+/**\n+ * The entity to perform fixing logic. It uses dry-run to identify an error, extracts a fixer based\n+ * on the error, fix the error, and return the fix result.\n+ */\n+public class AutomaticQueryFixer {\n+\n+  private final BigQueryService service;\n+  private final SqlErrorFactory errorFactory;\n+  private final FixerFactory fixerFactory;\n+\n+  public AutomaticQueryFixer(BigQueryOptions options) {\n+    service = new BigQueryService(options);\n+    errorFactory = new SqlErrorFactory();\n+    QueryTokenProcessor tokenProcessor = buildQueryTokenProcessor();\n+    fixerFactory = new FixerFactory(tokenProcessor, service);\n+  }\n+\n+  public FixResult fix(String query) {\n+    BigQueryException exception = service.catchExceptionFromDryRun(query);\n+    if (exception == null) {\n+      return FixResult.noError();\n+    }\n+\n+    BigQuerySqlError sqlError = errorFactory.getError(exception);\n+    if (sqlError == null) {\n+      return fixNotSupport(exception);\n+    }\n+\n+    IFixer fixer = fixerFactory.getFixer(query, sqlError);\n+    if (fixer == null) {\n+      return fixNotSupport(sqlError);\n+    }\n+\n+    return fixer.fix();\n+  }\n+\n+  private QueryTokenProcessor buildQueryTokenProcessor() {\n+    BigQueryParserFactory parserFactory = new BigQueryParserFactory();\n+    Tokenizer tokenizer = new CalciteTokenizer(parserFactory);\n+    return new QueryTokenProcessor(tokenizer);\n+  }\n+\n+  private FixResult fixNotSupport(BigQueryException exception) {\n+    return FixResult.builder()\n+        .status(FixResult.Status.FAILURE)\n+        .approach(\"The fix of this error is not supported\")\n+        .error(exception.getMessage())\n+        .build();\n+  }\n+\n+  private FixResult fixNotSupport(BigQuerySqlError error) {\n+    return FixResult.builder()\n+        .status(FixResult.Status.FAILURE)\n+        .approach(\"The fix of this error is not supported\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f0b6c3b67b941470566dc93425bb6de0373538f3"}, "originalPosition": 68}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY0NTM1ODc0", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/141#pullrequestreview-464535874", "createdAt": "2020-08-10T19:58:01Z", "commit": {"oid": "f0b6c3b67b941470566dc93425bb6de0373538f3"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMFQxOTo1ODowMlrOG-dcMw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMFQxOTo1ODowMlrOG-dcMw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODE0NzI1MQ==", "bodyText": "nit: of 'the' service account\nShould user provide the path to the json file here?", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/141#discussion_r468147251", "createdAt": "2020-08-10T19:58:02Z", "author": {"login": "kikkyo"}, "path": "tools/automatic_query_fixer/src/main/java/com/google/cloud/bigquery/utils/queryfixer/QueryFixerMain.java", "diffHunk": "@@ -1,19 +1,196 @@\n package com.google.cloud.bigquery.utils.queryfixer;\n \n-import com.google.common.flogger.FluentLogger;\n+import com.google.cloud.bigquery.*;\n+import com.google.cloud.bigquery.utils.queryfixer.entity.FixOption;\n+import com.google.cloud.bigquery.utils.queryfixer.entity.FixResult;\n+import com.google.gson.Gson;\n+import com.google.gson.GsonBuilder;\n+import org.apache.commons.cli.Option;\n+import org.apache.commons.cli.*;\n+\n+import java.util.List;\n \n public class QueryFixerMain {\n \n-  private static final FluentLogger logger = FluentLogger.forEnclosingClass();\n+  private static CommandLine readFlags(String[] args) {\n+    Options options = new Options();\n \n-  public static void main(String[] args) {\n+    Option option =\n+        new Option(\n+            /*opt=*/ \"c\",\n+            /*long-opt=*/ \"credential\",\n+            /*hasArg=*/ true,\n+            /*description=*/ \"The credential file (in JSON) of service account connecting to BigQuery. Otherwise, the default application-login credential will be used.\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f0b6c3b67b941470566dc93425bb6de0373538f3"}, "originalPosition": 26}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY0NTM4NDEw", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/141#pullrequestreview-464538410", "createdAt": "2020-08-10T20:01:51Z", "commit": {"oid": "f0b6c3b67b941470566dc93425bb6de0373538f3"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMFQyMDowMTo1MVrOG-djug==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMFQyMDowMTo1MVrOG-djug==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODE0OTE3OA==", "bodyText": "maybe declare option value as constants \"output\", similar with others.", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/141#discussion_r468149178", "createdAt": "2020-08-10T20:01:51Z", "author": {"login": "kikkyo"}, "path": "tools/automatic_query_fixer/src/main/java/com/google/cloud/bigquery/utils/queryfixer/QueryFixerMain.java", "diffHunk": "@@ -1,19 +1,196 @@\n package com.google.cloud.bigquery.utils.queryfixer;\n \n-import com.google.common.flogger.FluentLogger;\n+import com.google.cloud.bigquery.*;\n+import com.google.cloud.bigquery.utils.queryfixer.entity.FixOption;\n+import com.google.cloud.bigquery.utils.queryfixer.entity.FixResult;\n+import com.google.gson.Gson;\n+import com.google.gson.GsonBuilder;\n+import org.apache.commons.cli.Option;\n+import org.apache.commons.cli.*;\n+\n+import java.util.List;\n \n public class QueryFixerMain {\n \n-  private static final FluentLogger logger = FluentLogger.forEnclosingClass();\n+  private static CommandLine readFlags(String[] args) {\n+    Options options = new Options();\n \n-  public static void main(String[] args) {\n+    Option option =\n+        new Option(\n+            /*opt=*/ \"c\",\n+            /*long-opt=*/ \"credential\",\n+            /*hasArg=*/ true,\n+            /*description=*/ \"The credential file (in JSON) of service account connecting to BigQuery. Otherwise, the default application-login credential will be used.\");\n+    options.addOption(option);\n+    option =\n+        new Option(\n+            /*opt=*/ \"p\",\n+            /*long-opt=*/ \"project-id\",\n+            /*hasArg=*/ true,\n+            /*description=*/ \"The ID of project where queries will be performed. This field is required if the project is not specified in credential\");\n+    options.addOption(option);\n+    option =\n+        new Option(\n+            /*opt=*/ \"o\",\n+            /*long-opt=*/ \"output\",\n+            /*hasArg=*/ true,\n+            /*description=*/ \"The format to output fix results. The available formats are \\\"natural\\\" (default) and \\\"json\\\"\");\n+    options.addOption(option);\n+    option =\n+        new Option(\n+            /*opt=*/ \"i\",\n+            /*long-opt=*/ \"interact\",\n+            /*hasArg=*/ true,\n+            /*description=*/ \"Interactive Mode. The available mode are \\\"none\\\" (default), \\\"guide\\\" and \\\"all/full\\\"\");\n+    options.addOption(option);\n \n     if (args.length == 0) {\n-      // TODO: provide a more actionable info. This will be done once we finalize the input parameters.\n-      logger.atInfo().log(\"not enough arguments\");\n+      System.out.println(\"Please provide arguments.\");\n+      printHelpAndExit(options);\n+    }\n+\n+    CommandLineParser parser = new DefaultParser();\n+    try {\n+      return parser.parse(options, args);\n+    } catch (ParseException e) {\n+      System.out.println(e.getMessage());\n+      printHelpAndExit(options);\n+      return null;\n+    }\n+  }\n+\n+  public static void printHelpAndExit(Options options) {\n+    HelpFormatter formatter = new HelpFormatter();\n+    formatter.printHelp(\"-opt <value> --long-opt <value> \\\"query\\\"\", options);\n+    System.exit(1);\n+  }\n+\n+  public static void main(String[] args) {\n+    CommandLine cmd = readFlags(args);\n+\n+    String credentialPath = cmd.getOptionValue(\"credential\");\n+    String projectId = cmd.getOptionValue(\"project-id\");\n+    BigQueryOptions bigQueryOptions = buildBigQueryOptions(credentialPath, projectId);\n+\n+    if (cmd.getArgList().isEmpty()) {\n+      // In CLI mode, all the instructions are output by print functions, because logger outputs\n+      // extract info (time, code position) that distracts users.\n+      System.out.println(\n+          \"Please provide the query as an argument, enclosed by double quote. Use --help for instruction.\");\n+    }\n+\n+    String query = cmd.getArgList().get(0);\n+    System.out.println(\"Input query: \" + query);\n+\n+    AutomaticQueryFixer queryFixer = new AutomaticQueryFixer(bigQueryOptions);\n+\n+    String interactMode = cmd.getOptionValue(\"interact\");\n+    if (interactMode == null || interactMode.equalsIgnoreCase(\"none\")) {\n+      // todo: Implement Non-interactive mode\n+      FixResult fixResult = queryFixer.fix(query);\n+      if (fixResult.getOptions().isEmpty()) {\n+        return;\n+      }\n+      String newQuery = fixResult.getOptions().get(0).getFixedQuery();\n+      printQueryResult(newQuery, bigQueryOptions);\n+\n+    } else if (interactMode.equalsIgnoreCase(\"guide\")) {\n+      // todo: Implement guide mode\n+      return;\n+    } else if (interactMode.equalsIgnoreCase(\"all\") || interactMode.equalsIgnoreCase(\"full\")) {\n+      FixResult fixResult = fullInteractMode(queryFixer, query);\n+      printFixResult(fixResult, cmd.getOptionValue(\"output\"));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f0b6c3b67b941470566dc93425bb6de0373538f3"}, "originalPosition": 107}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY0NTM4Njkz", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/141#pullrequestreview-464538693", "createdAt": "2020-08-10T20:02:15Z", "commit": {"oid": "f0b6c3b67b941470566dc93425bb6de0373538f3"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMFQyMDowMjoxNVrOG-dkmQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMFQyMDowMjoxNVrOG-dkmQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODE0OTQwMQ==", "bodyText": "use static const", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/141#discussion_r468149401", "createdAt": "2020-08-10T20:02:15Z", "author": {"login": "kikkyo"}, "path": "tools/automatic_query_fixer/src/main/java/com/google/cloud/bigquery/utils/queryfixer/QueryFixerMain.java", "diffHunk": "@@ -1,19 +1,196 @@\n package com.google.cloud.bigquery.utils.queryfixer;\n \n-import com.google.common.flogger.FluentLogger;\n+import com.google.cloud.bigquery.*;\n+import com.google.cloud.bigquery.utils.queryfixer.entity.FixOption;\n+import com.google.cloud.bigquery.utils.queryfixer.entity.FixResult;\n+import com.google.gson.Gson;\n+import com.google.gson.GsonBuilder;\n+import org.apache.commons.cli.Option;\n+import org.apache.commons.cli.*;\n+\n+import java.util.List;\n \n public class QueryFixerMain {\n \n-  private static final FluentLogger logger = FluentLogger.forEnclosingClass();\n+  private static CommandLine readFlags(String[] args) {\n+    Options options = new Options();\n \n-  public static void main(String[] args) {\n+    Option option =\n+        new Option(\n+            /*opt=*/ \"c\",\n+            /*long-opt=*/ \"credential\",\n+            /*hasArg=*/ true,\n+            /*description=*/ \"The credential file (in JSON) of service account connecting to BigQuery. Otherwise, the default application-login credential will be used.\");\n+    options.addOption(option);\n+    option =\n+        new Option(\n+            /*opt=*/ \"p\",\n+            /*long-opt=*/ \"project-id\",\n+            /*hasArg=*/ true,\n+            /*description=*/ \"The ID of project where queries will be performed. This field is required if the project is not specified in credential\");\n+    options.addOption(option);\n+    option =\n+        new Option(\n+            /*opt=*/ \"o\",\n+            /*long-opt=*/ \"output\",\n+            /*hasArg=*/ true,\n+            /*description=*/ \"The format to output fix results. The available formats are \\\"natural\\\" (default) and \\\"json\\\"\");\n+    options.addOption(option);\n+    option =\n+        new Option(\n+            /*opt=*/ \"i\",\n+            /*long-opt=*/ \"interact\",\n+            /*hasArg=*/ true,\n+            /*description=*/ \"Interactive Mode. The available mode are \\\"none\\\" (default), \\\"guide\\\" and \\\"all/full\\\"\");\n+    options.addOption(option);\n \n     if (args.length == 0) {\n-      // TODO: provide a more actionable info. This will be done once we finalize the input parameters.\n-      logger.atInfo().log(\"not enough arguments\");\n+      System.out.println(\"Please provide arguments.\");\n+      printHelpAndExit(options);\n+    }\n+\n+    CommandLineParser parser = new DefaultParser();\n+    try {\n+      return parser.parse(options, args);\n+    } catch (ParseException e) {\n+      System.out.println(e.getMessage());\n+      printHelpAndExit(options);\n+      return null;\n+    }\n+  }\n+\n+  public static void printHelpAndExit(Options options) {\n+    HelpFormatter formatter = new HelpFormatter();\n+    formatter.printHelp(\"-opt <value> --long-opt <value> \\\"query\\\"\", options);\n+    System.exit(1);\n+  }\n+\n+  public static void main(String[] args) {\n+    CommandLine cmd = readFlags(args);\n+\n+    String credentialPath = cmd.getOptionValue(\"credential\");\n+    String projectId = cmd.getOptionValue(\"project-id\");\n+    BigQueryOptions bigQueryOptions = buildBigQueryOptions(credentialPath, projectId);\n+\n+    if (cmd.getArgList().isEmpty()) {\n+      // In CLI mode, all the instructions are output by print functions, because logger outputs\n+      // extract info (time, code position) that distracts users.\n+      System.out.println(\n+          \"Please provide the query as an argument, enclosed by double quote. Use --help for instruction.\");\n+    }\n+\n+    String query = cmd.getArgList().get(0);\n+    System.out.println(\"Input query: \" + query);\n+\n+    AutomaticQueryFixer queryFixer = new AutomaticQueryFixer(bigQueryOptions);\n+\n+    String interactMode = cmd.getOptionValue(\"interact\");\n+    if (interactMode == null || interactMode.equalsIgnoreCase(\"none\")) {\n+      // todo: Implement Non-interactive mode\n+      FixResult fixResult = queryFixer.fix(query);\n+      if (fixResult.getOptions().isEmpty()) {\n+        return;\n+      }\n+      String newQuery = fixResult.getOptions().get(0).getFixedQuery();\n+      printQueryResult(newQuery, bigQueryOptions);\n+\n+    } else if (interactMode.equalsIgnoreCase(\"guide\")) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f0b6c3b67b941470566dc93425bb6de0373538f3"}, "originalPosition": 102}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY0NTM4ODMy", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/141#pullrequestreview-464538832", "createdAt": "2020-08-10T20:02:29Z", "commit": {"oid": "f0b6c3b67b941470566dc93425bb6de0373538f3"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMFQyMDowMjoyOVrOG-dk9w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMFQyMDowMjoyOVrOG-dk9w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODE0OTQ5NQ==", "bodyText": "use static const", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/141#discussion_r468149495", "createdAt": "2020-08-10T20:02:29Z", "author": {"login": "kikkyo"}, "path": "tools/automatic_query_fixer/src/main/java/com/google/cloud/bigquery/utils/queryfixer/QueryFixerMain.java", "diffHunk": "@@ -1,19 +1,196 @@\n package com.google.cloud.bigquery.utils.queryfixer;\n \n-import com.google.common.flogger.FluentLogger;\n+import com.google.cloud.bigquery.*;\n+import com.google.cloud.bigquery.utils.queryfixer.entity.FixOption;\n+import com.google.cloud.bigquery.utils.queryfixer.entity.FixResult;\n+import com.google.gson.Gson;\n+import com.google.gson.GsonBuilder;\n+import org.apache.commons.cli.Option;\n+import org.apache.commons.cli.*;\n+\n+import java.util.List;\n \n public class QueryFixerMain {\n \n-  private static final FluentLogger logger = FluentLogger.forEnclosingClass();\n+  private static CommandLine readFlags(String[] args) {\n+    Options options = new Options();\n \n-  public static void main(String[] args) {\n+    Option option =\n+        new Option(\n+            /*opt=*/ \"c\",\n+            /*long-opt=*/ \"credential\",\n+            /*hasArg=*/ true,\n+            /*description=*/ \"The credential file (in JSON) of service account connecting to BigQuery. Otherwise, the default application-login credential will be used.\");\n+    options.addOption(option);\n+    option =\n+        new Option(\n+            /*opt=*/ \"p\",\n+            /*long-opt=*/ \"project-id\",\n+            /*hasArg=*/ true,\n+            /*description=*/ \"The ID of project where queries will be performed. This field is required if the project is not specified in credential\");\n+    options.addOption(option);\n+    option =\n+        new Option(\n+            /*opt=*/ \"o\",\n+            /*long-opt=*/ \"output\",\n+            /*hasArg=*/ true,\n+            /*description=*/ \"The format to output fix results. The available formats are \\\"natural\\\" (default) and \\\"json\\\"\");\n+    options.addOption(option);\n+    option =\n+        new Option(\n+            /*opt=*/ \"i\",\n+            /*long-opt=*/ \"interact\",\n+            /*hasArg=*/ true,\n+            /*description=*/ \"Interactive Mode. The available mode are \\\"none\\\" (default), \\\"guide\\\" and \\\"all/full\\\"\");\n+    options.addOption(option);\n \n     if (args.length == 0) {\n-      // TODO: provide a more actionable info. This will be done once we finalize the input parameters.\n-      logger.atInfo().log(\"not enough arguments\");\n+      System.out.println(\"Please provide arguments.\");\n+      printHelpAndExit(options);\n+    }\n+\n+    CommandLineParser parser = new DefaultParser();\n+    try {\n+      return parser.parse(options, args);\n+    } catch (ParseException e) {\n+      System.out.println(e.getMessage());\n+      printHelpAndExit(options);\n+      return null;\n+    }\n+  }\n+\n+  public static void printHelpAndExit(Options options) {\n+    HelpFormatter formatter = new HelpFormatter();\n+    formatter.printHelp(\"-opt <value> --long-opt <value> \\\"query\\\"\", options);\n+    System.exit(1);\n+  }\n+\n+  public static void main(String[] args) {\n+    CommandLine cmd = readFlags(args);\n+\n+    String credentialPath = cmd.getOptionValue(\"credential\");\n+    String projectId = cmd.getOptionValue(\"project-id\");\n+    BigQueryOptions bigQueryOptions = buildBigQueryOptions(credentialPath, projectId);\n+\n+    if (cmd.getArgList().isEmpty()) {\n+      // In CLI mode, all the instructions are output by print functions, because logger outputs\n+      // extract info (time, code position) that distracts users.\n+      System.out.println(\n+          \"Please provide the query as an argument, enclosed by double quote. Use --help for instruction.\");\n+    }\n+\n+    String query = cmd.getArgList().get(0);\n+    System.out.println(\"Input query: \" + query);\n+\n+    AutomaticQueryFixer queryFixer = new AutomaticQueryFixer(bigQueryOptions);\n+\n+    String interactMode = cmd.getOptionValue(\"interact\");\n+    if (interactMode == null || interactMode.equalsIgnoreCase(\"none\")) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f0b6c3b67b941470566dc93425bb6de0373538f3"}, "originalPosition": 93}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY0NTQwODI3", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/141#pullrequestreview-464540827", "createdAt": "2020-08-10T20:05:41Z", "commit": {"oid": "f0b6c3b67b941470566dc93425bb6de0373538f3"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMFQyMDowNTo0MVrOG-drPw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMFQyMDowNTo0MVrOG-drPw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODE1MTEwMw==", "bodyText": "What is customized credential here?", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/141#discussion_r468151103", "createdAt": "2020-08-10T20:05:41Z", "author": {"login": "kikkyo"}, "path": "tools/automatic_query_fixer/src/main/java/com/google/cloud/bigquery/utils/queryfixer/QueryFixerMain.java", "diffHunk": "@@ -1,19 +1,196 @@\n package com.google.cloud.bigquery.utils.queryfixer;\n \n-import com.google.common.flogger.FluentLogger;\n+import com.google.cloud.bigquery.*;\n+import com.google.cloud.bigquery.utils.queryfixer.entity.FixOption;\n+import com.google.cloud.bigquery.utils.queryfixer.entity.FixResult;\n+import com.google.gson.Gson;\n+import com.google.gson.GsonBuilder;\n+import org.apache.commons.cli.Option;\n+import org.apache.commons.cli.*;\n+\n+import java.util.List;\n \n public class QueryFixerMain {\n \n-  private static final FluentLogger logger = FluentLogger.forEnclosingClass();\n+  private static CommandLine readFlags(String[] args) {\n+    Options options = new Options();\n \n-  public static void main(String[] args) {\n+    Option option =\n+        new Option(\n+            /*opt=*/ \"c\",\n+            /*long-opt=*/ \"credential\",\n+            /*hasArg=*/ true,\n+            /*description=*/ \"The credential file (in JSON) of service account connecting to BigQuery. Otherwise, the default application-login credential will be used.\");\n+    options.addOption(option);\n+    option =\n+        new Option(\n+            /*opt=*/ \"p\",\n+            /*long-opt=*/ \"project-id\",\n+            /*hasArg=*/ true,\n+            /*description=*/ \"The ID of project where queries will be performed. This field is required if the project is not specified in credential\");\n+    options.addOption(option);\n+    option =\n+        new Option(\n+            /*opt=*/ \"o\",\n+            /*long-opt=*/ \"output\",\n+            /*hasArg=*/ true,\n+            /*description=*/ \"The format to output fix results. The available formats are \\\"natural\\\" (default) and \\\"json\\\"\");\n+    options.addOption(option);\n+    option =\n+        new Option(\n+            /*opt=*/ \"i\",\n+            /*long-opt=*/ \"interact\",\n+            /*hasArg=*/ true,\n+            /*description=*/ \"Interactive Mode. The available mode are \\\"none\\\" (default), \\\"guide\\\" and \\\"all/full\\\"\");\n+    options.addOption(option);\n \n     if (args.length == 0) {\n-      // TODO: provide a more actionable info. This will be done once we finalize the input parameters.\n-      logger.atInfo().log(\"not enough arguments\");\n+      System.out.println(\"Please provide arguments.\");\n+      printHelpAndExit(options);\n+    }\n+\n+    CommandLineParser parser = new DefaultParser();\n+    try {\n+      return parser.parse(options, args);\n+    } catch (ParseException e) {\n+      System.out.println(e.getMessage());\n+      printHelpAndExit(options);\n+      return null;\n+    }\n+  }\n+\n+  public static void printHelpAndExit(Options options) {\n+    HelpFormatter formatter = new HelpFormatter();\n+    formatter.printHelp(\"-opt <value> --long-opt <value> \\\"query\\\"\", options);\n+    System.exit(1);\n+  }\n+\n+  public static void main(String[] args) {\n+    CommandLine cmd = readFlags(args);\n+\n+    String credentialPath = cmd.getOptionValue(\"credential\");\n+    String projectId = cmd.getOptionValue(\"project-id\");\n+    BigQueryOptions bigQueryOptions = buildBigQueryOptions(credentialPath, projectId);\n+\n+    if (cmd.getArgList().isEmpty()) {\n+      // In CLI mode, all the instructions are output by print functions, because logger outputs\n+      // extract info (time, code position) that distracts users.\n+      System.out.println(\n+          \"Please provide the query as an argument, enclosed by double quote. Use --help for instruction.\");\n+    }\n+\n+    String query = cmd.getArgList().get(0);\n+    System.out.println(\"Input query: \" + query);\n+\n+    AutomaticQueryFixer queryFixer = new AutomaticQueryFixer(bigQueryOptions);\n+\n+    String interactMode = cmd.getOptionValue(\"interact\");\n+    if (interactMode == null || interactMode.equalsIgnoreCase(\"none\")) {\n+      // todo: Implement Non-interactive mode\n+      FixResult fixResult = queryFixer.fix(query);\n+      if (fixResult.getOptions().isEmpty()) {\n+        return;\n+      }\n+      String newQuery = fixResult.getOptions().get(0).getFixedQuery();\n+      printQueryResult(newQuery, bigQueryOptions);\n+\n+    } else if (interactMode.equalsIgnoreCase(\"guide\")) {\n+      // todo: Implement guide mode\n+      return;\n+    } else if (interactMode.equalsIgnoreCase(\"all\") || interactMode.equalsIgnoreCase(\"full\")) {\n+      FixResult fixResult = fullInteractMode(queryFixer, query);\n+      printFixResult(fixResult, cmd.getOptionValue(\"output\"));\n+    } else {\n+      System.out.println(\"Interact Mode (-i) is incorrect. Use --help for usage.\");\n+      System.exit(1);\n+    }\n+  }\n+\n+  private static BigQueryOptions buildBigQueryOptions(String credentialPath, String projectId) {\n+    if (credentialPath == null) {\n+      return BigQueryOptions.newBuilder().setProjectId(projectId).build();\n+    } else {\n+      // TODO: should support this in near future.\n+      System.out.println(\"customized credential is not supported\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f0b6c3b67b941470566dc93425bb6de0373538f3"}, "originalPosition": 119}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY0NTQxMTEz", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/141#pullrequestreview-464541113", "createdAt": "2020-08-10T20:06:10Z", "commit": {"oid": "f0b6c3b67b941470566dc93425bb6de0373538f3"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMFQyMDowNjoxMFrOG-dsHQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMFQyMDowNjoxMFrOG-dsHQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODE1MTMyNQ==", "bodyText": "static const", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/141#discussion_r468151325", "createdAt": "2020-08-10T20:06:10Z", "author": {"login": "kikkyo"}, "path": "tools/automatic_query_fixer/src/main/java/com/google/cloud/bigquery/utils/queryfixer/QueryFixerMain.java", "diffHunk": "@@ -1,19 +1,196 @@\n package com.google.cloud.bigquery.utils.queryfixer;\n \n-import com.google.common.flogger.FluentLogger;\n+import com.google.cloud.bigquery.*;\n+import com.google.cloud.bigquery.utils.queryfixer.entity.FixOption;\n+import com.google.cloud.bigquery.utils.queryfixer.entity.FixResult;\n+import com.google.gson.Gson;\n+import com.google.gson.GsonBuilder;\n+import org.apache.commons.cli.Option;\n+import org.apache.commons.cli.*;\n+\n+import java.util.List;\n \n public class QueryFixerMain {\n \n-  private static final FluentLogger logger = FluentLogger.forEnclosingClass();\n+  private static CommandLine readFlags(String[] args) {\n+    Options options = new Options();\n \n-  public static void main(String[] args) {\n+    Option option =\n+        new Option(\n+            /*opt=*/ \"c\",\n+            /*long-opt=*/ \"credential\",\n+            /*hasArg=*/ true,\n+            /*description=*/ \"The credential file (in JSON) of service account connecting to BigQuery. Otherwise, the default application-login credential will be used.\");\n+    options.addOption(option);\n+    option =\n+        new Option(\n+            /*opt=*/ \"p\",\n+            /*long-opt=*/ \"project-id\",\n+            /*hasArg=*/ true,\n+            /*description=*/ \"The ID of project where queries will be performed. This field is required if the project is not specified in credential\");\n+    options.addOption(option);\n+    option =\n+        new Option(\n+            /*opt=*/ \"o\",\n+            /*long-opt=*/ \"output\",\n+            /*hasArg=*/ true,\n+            /*description=*/ \"The format to output fix results. The available formats are \\\"natural\\\" (default) and \\\"json\\\"\");\n+    options.addOption(option);\n+    option =\n+        new Option(\n+            /*opt=*/ \"i\",\n+            /*long-opt=*/ \"interact\",\n+            /*hasArg=*/ true,\n+            /*description=*/ \"Interactive Mode. The available mode are \\\"none\\\" (default), \\\"guide\\\" and \\\"all/full\\\"\");\n+    options.addOption(option);\n \n     if (args.length == 0) {\n-      // TODO: provide a more actionable info. This will be done once we finalize the input parameters.\n-      logger.atInfo().log(\"not enough arguments\");\n+      System.out.println(\"Please provide arguments.\");\n+      printHelpAndExit(options);\n+    }\n+\n+    CommandLineParser parser = new DefaultParser();\n+    try {\n+      return parser.parse(options, args);\n+    } catch (ParseException e) {\n+      System.out.println(e.getMessage());\n+      printHelpAndExit(options);\n+      return null;\n+    }\n+  }\n+\n+  public static void printHelpAndExit(Options options) {\n+    HelpFormatter formatter = new HelpFormatter();\n+    formatter.printHelp(\"-opt <value> --long-opt <value> \\\"query\\\"\", options);\n+    System.exit(1);\n+  }\n+\n+  public static void main(String[] args) {\n+    CommandLine cmd = readFlags(args);\n+\n+    String credentialPath = cmd.getOptionValue(\"credential\");\n+    String projectId = cmd.getOptionValue(\"project-id\");\n+    BigQueryOptions bigQueryOptions = buildBigQueryOptions(credentialPath, projectId);\n+\n+    if (cmd.getArgList().isEmpty()) {\n+      // In CLI mode, all the instructions are output by print functions, because logger outputs\n+      // extract info (time, code position) that distracts users.\n+      System.out.println(\n+          \"Please provide the query as an argument, enclosed by double quote. Use --help for instruction.\");\n+    }\n+\n+    String query = cmd.getArgList().get(0);\n+    System.out.println(\"Input query: \" + query);\n+\n+    AutomaticQueryFixer queryFixer = new AutomaticQueryFixer(bigQueryOptions);\n+\n+    String interactMode = cmd.getOptionValue(\"interact\");\n+    if (interactMode == null || interactMode.equalsIgnoreCase(\"none\")) {\n+      // todo: Implement Non-interactive mode\n+      FixResult fixResult = queryFixer.fix(query);\n+      if (fixResult.getOptions().isEmpty()) {\n+        return;\n+      }\n+      String newQuery = fixResult.getOptions().get(0).getFixedQuery();\n+      printQueryResult(newQuery, bigQueryOptions);\n+\n+    } else if (interactMode.equalsIgnoreCase(\"guide\")) {\n+      // todo: Implement guide mode\n+      return;\n+    } else if (interactMode.equalsIgnoreCase(\"all\") || interactMode.equalsIgnoreCase(\"full\")) {\n+      FixResult fixResult = fullInteractMode(queryFixer, query);\n+      printFixResult(fixResult, cmd.getOptionValue(\"output\"));\n+    } else {\n+      System.out.println(\"Interact Mode (-i) is incorrect. Use --help for usage.\");\n+      System.exit(1);\n+    }\n+  }\n+\n+  private static BigQueryOptions buildBigQueryOptions(String credentialPath, String projectId) {\n+    if (credentialPath == null) {\n+      return BigQueryOptions.newBuilder().setProjectId(projectId).build();\n+    } else {\n+      // TODO: should support this in near future.\n+      System.out.println(\"customized credential is not supported\");\n+      System.exit(1);\n+      return null;\n+    }\n+  }\n+\n+  private static FixResult fullInteractMode(AutomaticQueryFixer queryFixer, String query) {\n+    return queryFixer.fix(query);\n+  }\n+\n+  private static void printFixResult(FixResult fixResult, String outputFormat) {\n+    if (outputFormat == null || outputFormat.equalsIgnoreCase(\"natural\")) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f0b6c3b67b941470566dc93425bb6de0373538f3"}, "originalPosition": 130}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY0NTQxMjQ3", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/141#pullrequestreview-464541247", "createdAt": "2020-08-10T20:06:21Z", "commit": {"oid": "f0b6c3b67b941470566dc93425bb6de0373538f3"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMFQyMDowNjoyMVrOG-dsfA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMFQyMDowNjoyMVrOG-dsfA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODE1MTQyMA==", "bodyText": "static const", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/141#discussion_r468151420", "createdAt": "2020-08-10T20:06:21Z", "author": {"login": "kikkyo"}, "path": "tools/automatic_query_fixer/src/main/java/com/google/cloud/bigquery/utils/queryfixer/QueryFixerMain.java", "diffHunk": "@@ -1,19 +1,196 @@\n package com.google.cloud.bigquery.utils.queryfixer;\n \n-import com.google.common.flogger.FluentLogger;\n+import com.google.cloud.bigquery.*;\n+import com.google.cloud.bigquery.utils.queryfixer.entity.FixOption;\n+import com.google.cloud.bigquery.utils.queryfixer.entity.FixResult;\n+import com.google.gson.Gson;\n+import com.google.gson.GsonBuilder;\n+import org.apache.commons.cli.Option;\n+import org.apache.commons.cli.*;\n+\n+import java.util.List;\n \n public class QueryFixerMain {\n \n-  private static final FluentLogger logger = FluentLogger.forEnclosingClass();\n+  private static CommandLine readFlags(String[] args) {\n+    Options options = new Options();\n \n-  public static void main(String[] args) {\n+    Option option =\n+        new Option(\n+            /*opt=*/ \"c\",\n+            /*long-opt=*/ \"credential\",\n+            /*hasArg=*/ true,\n+            /*description=*/ \"The credential file (in JSON) of service account connecting to BigQuery. Otherwise, the default application-login credential will be used.\");\n+    options.addOption(option);\n+    option =\n+        new Option(\n+            /*opt=*/ \"p\",\n+            /*long-opt=*/ \"project-id\",\n+            /*hasArg=*/ true,\n+            /*description=*/ \"The ID of project where queries will be performed. This field is required if the project is not specified in credential\");\n+    options.addOption(option);\n+    option =\n+        new Option(\n+            /*opt=*/ \"o\",\n+            /*long-opt=*/ \"output\",\n+            /*hasArg=*/ true,\n+            /*description=*/ \"The format to output fix results. The available formats are \\\"natural\\\" (default) and \\\"json\\\"\");\n+    options.addOption(option);\n+    option =\n+        new Option(\n+            /*opt=*/ \"i\",\n+            /*long-opt=*/ \"interact\",\n+            /*hasArg=*/ true,\n+            /*description=*/ \"Interactive Mode. The available mode are \\\"none\\\" (default), \\\"guide\\\" and \\\"all/full\\\"\");\n+    options.addOption(option);\n \n     if (args.length == 0) {\n-      // TODO: provide a more actionable info. This will be done once we finalize the input parameters.\n-      logger.atInfo().log(\"not enough arguments\");\n+      System.out.println(\"Please provide arguments.\");\n+      printHelpAndExit(options);\n+    }\n+\n+    CommandLineParser parser = new DefaultParser();\n+    try {\n+      return parser.parse(options, args);\n+    } catch (ParseException e) {\n+      System.out.println(e.getMessage());\n+      printHelpAndExit(options);\n+      return null;\n+    }\n+  }\n+\n+  public static void printHelpAndExit(Options options) {\n+    HelpFormatter formatter = new HelpFormatter();\n+    formatter.printHelp(\"-opt <value> --long-opt <value> \\\"query\\\"\", options);\n+    System.exit(1);\n+  }\n+\n+  public static void main(String[] args) {\n+    CommandLine cmd = readFlags(args);\n+\n+    String credentialPath = cmd.getOptionValue(\"credential\");\n+    String projectId = cmd.getOptionValue(\"project-id\");\n+    BigQueryOptions bigQueryOptions = buildBigQueryOptions(credentialPath, projectId);\n+\n+    if (cmd.getArgList().isEmpty()) {\n+      // In CLI mode, all the instructions are output by print functions, because logger outputs\n+      // extract info (time, code position) that distracts users.\n+      System.out.println(\n+          \"Please provide the query as an argument, enclosed by double quote. Use --help for instruction.\");\n+    }\n+\n+    String query = cmd.getArgList().get(0);\n+    System.out.println(\"Input query: \" + query);\n+\n+    AutomaticQueryFixer queryFixer = new AutomaticQueryFixer(bigQueryOptions);\n+\n+    String interactMode = cmd.getOptionValue(\"interact\");\n+    if (interactMode == null || interactMode.equalsIgnoreCase(\"none\")) {\n+      // todo: Implement Non-interactive mode\n+      FixResult fixResult = queryFixer.fix(query);\n+      if (fixResult.getOptions().isEmpty()) {\n+        return;\n+      }\n+      String newQuery = fixResult.getOptions().get(0).getFixedQuery();\n+      printQueryResult(newQuery, bigQueryOptions);\n+\n+    } else if (interactMode.equalsIgnoreCase(\"guide\")) {\n+      // todo: Implement guide mode\n+      return;\n+    } else if (interactMode.equalsIgnoreCase(\"all\") || interactMode.equalsIgnoreCase(\"full\")) {\n+      FixResult fixResult = fullInteractMode(queryFixer, query);\n+      printFixResult(fixResult, cmd.getOptionValue(\"output\"));\n+    } else {\n+      System.out.println(\"Interact Mode (-i) is incorrect. Use --help for usage.\");\n+      System.exit(1);\n+    }\n+  }\n+\n+  private static BigQueryOptions buildBigQueryOptions(String credentialPath, String projectId) {\n+    if (credentialPath == null) {\n+      return BigQueryOptions.newBuilder().setProjectId(projectId).build();\n+    } else {\n+      // TODO: should support this in near future.\n+      System.out.println(\"customized credential is not supported\");\n+      System.exit(1);\n+      return null;\n+    }\n+  }\n+\n+  private static FixResult fullInteractMode(AutomaticQueryFixer queryFixer, String query) {\n+    return queryFixer.fix(query);\n+  }\n+\n+  private static void printFixResult(FixResult fixResult, String outputFormat) {\n+    if (outputFormat == null || outputFormat.equalsIgnoreCase(\"natural\")) {\n+      printFixResultInCommandLine(fixResult);\n+    } else if (outputFormat.equalsIgnoreCase(\"json\")) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f0b6c3b67b941470566dc93425bb6de0373538f3"}, "originalPosition": 132}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY0NTQ3NTg1", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/141#pullrequestreview-464547585", "createdAt": "2020-08-10T20:09:32Z", "commit": {"oid": "f0b6c3b67b941470566dc93425bb6de0373538f3"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMFQyMDowOTozMlrOG-dyPQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMFQyMDowOTozMlrOG-dyPQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODE1Mjg5Mw==", "bodyText": "nit: \"fullInteractMode\" -> \"fixQueryInFullInteractMode\"? maybe \"fixQueryInInteractiveMode\"?", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/141#discussion_r468152893", "createdAt": "2020-08-10T20:09:32Z", "author": {"login": "kikkyo"}, "path": "tools/automatic_query_fixer/src/main/java/com/google/cloud/bigquery/utils/queryfixer/QueryFixerMain.java", "diffHunk": "@@ -1,19 +1,196 @@\n package com.google.cloud.bigquery.utils.queryfixer;\n \n-import com.google.common.flogger.FluentLogger;\n+import com.google.cloud.bigquery.*;\n+import com.google.cloud.bigquery.utils.queryfixer.entity.FixOption;\n+import com.google.cloud.bigquery.utils.queryfixer.entity.FixResult;\n+import com.google.gson.Gson;\n+import com.google.gson.GsonBuilder;\n+import org.apache.commons.cli.Option;\n+import org.apache.commons.cli.*;\n+\n+import java.util.List;\n \n public class QueryFixerMain {\n \n-  private static final FluentLogger logger = FluentLogger.forEnclosingClass();\n+  private static CommandLine readFlags(String[] args) {\n+    Options options = new Options();\n \n-  public static void main(String[] args) {\n+    Option option =\n+        new Option(\n+            /*opt=*/ \"c\",\n+            /*long-opt=*/ \"credential\",\n+            /*hasArg=*/ true,\n+            /*description=*/ \"The credential file (in JSON) of service account connecting to BigQuery. Otherwise, the default application-login credential will be used.\");\n+    options.addOption(option);\n+    option =\n+        new Option(\n+            /*opt=*/ \"p\",\n+            /*long-opt=*/ \"project-id\",\n+            /*hasArg=*/ true,\n+            /*description=*/ \"The ID of project where queries will be performed. This field is required if the project is not specified in credential\");\n+    options.addOption(option);\n+    option =\n+        new Option(\n+            /*opt=*/ \"o\",\n+            /*long-opt=*/ \"output\",\n+            /*hasArg=*/ true,\n+            /*description=*/ \"The format to output fix results. The available formats are \\\"natural\\\" (default) and \\\"json\\\"\");\n+    options.addOption(option);\n+    option =\n+        new Option(\n+            /*opt=*/ \"i\",\n+            /*long-opt=*/ \"interact\",\n+            /*hasArg=*/ true,\n+            /*description=*/ \"Interactive Mode. The available mode are \\\"none\\\" (default), \\\"guide\\\" and \\\"all/full\\\"\");\n+    options.addOption(option);\n \n     if (args.length == 0) {\n-      // TODO: provide a more actionable info. This will be done once we finalize the input parameters.\n-      logger.atInfo().log(\"not enough arguments\");\n+      System.out.println(\"Please provide arguments.\");\n+      printHelpAndExit(options);\n+    }\n+\n+    CommandLineParser parser = new DefaultParser();\n+    try {\n+      return parser.parse(options, args);\n+    } catch (ParseException e) {\n+      System.out.println(e.getMessage());\n+      printHelpAndExit(options);\n+      return null;\n+    }\n+  }\n+\n+  public static void printHelpAndExit(Options options) {\n+    HelpFormatter formatter = new HelpFormatter();\n+    formatter.printHelp(\"-opt <value> --long-opt <value> \\\"query\\\"\", options);\n+    System.exit(1);\n+  }\n+\n+  public static void main(String[] args) {\n+    CommandLine cmd = readFlags(args);\n+\n+    String credentialPath = cmd.getOptionValue(\"credential\");\n+    String projectId = cmd.getOptionValue(\"project-id\");\n+    BigQueryOptions bigQueryOptions = buildBigQueryOptions(credentialPath, projectId);\n+\n+    if (cmd.getArgList().isEmpty()) {\n+      // In CLI mode, all the instructions are output by print functions, because logger outputs\n+      // extract info (time, code position) that distracts users.\n+      System.out.println(\n+          \"Please provide the query as an argument, enclosed by double quote. Use --help for instruction.\");\n+    }\n+\n+    String query = cmd.getArgList().get(0);\n+    System.out.println(\"Input query: \" + query);\n+\n+    AutomaticQueryFixer queryFixer = new AutomaticQueryFixer(bigQueryOptions);\n+\n+    String interactMode = cmd.getOptionValue(\"interact\");\n+    if (interactMode == null || interactMode.equalsIgnoreCase(\"none\")) {\n+      // todo: Implement Non-interactive mode\n+      FixResult fixResult = queryFixer.fix(query);\n+      if (fixResult.getOptions().isEmpty()) {\n+        return;\n+      }\n+      String newQuery = fixResult.getOptions().get(0).getFixedQuery();\n+      printQueryResult(newQuery, bigQueryOptions);\n+\n+    } else if (interactMode.equalsIgnoreCase(\"guide\")) {\n+      // todo: Implement guide mode\n+      return;\n+    } else if (interactMode.equalsIgnoreCase(\"all\") || interactMode.equalsIgnoreCase(\"full\")) {\n+      FixResult fixResult = fullInteractMode(queryFixer, query);\n+      printFixResult(fixResult, cmd.getOptionValue(\"output\"));\n+    } else {\n+      System.out.println(\"Interact Mode (-i) is incorrect. Use --help for usage.\");\n+      System.exit(1);\n+    }\n+  }\n+\n+  private static BigQueryOptions buildBigQueryOptions(String credentialPath, String projectId) {\n+    if (credentialPath == null) {\n+      return BigQueryOptions.newBuilder().setProjectId(projectId).build();\n+    } else {\n+      // TODO: should support this in near future.\n+      System.out.println(\"customized credential is not supported\");\n+      System.exit(1);\n+      return null;\n+    }\n+  }\n+\n+  private static FixResult fullInteractMode(AutomaticQueryFixer queryFixer, String query) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f0b6c3b67b941470566dc93425bb6de0373538f3"}, "originalPosition": 125}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY0NTUyOTUx", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/141#pullrequestreview-464552951", "createdAt": "2020-08-10T20:12:00Z", "commit": {"oid": "f0b6c3b67b941470566dc93425bb6de0373538f3"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMFQyMDoxMjowMFrOG-d3AQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMFQyMDoxMjowMFrOG-d3AQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODE1NDExMw==", "bodyText": "nit: \"The input query is valid. No errors to fix.'", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/141#discussion_r468154113", "createdAt": "2020-08-10T20:12:00Z", "author": {"login": "kikkyo"}, "path": "tools/automatic_query_fixer/src/main/java/com/google/cloud/bigquery/utils/queryfixer/QueryFixerMain.java", "diffHunk": "@@ -1,19 +1,196 @@\n package com.google.cloud.bigquery.utils.queryfixer;\n \n-import com.google.common.flogger.FluentLogger;\n+import com.google.cloud.bigquery.*;\n+import com.google.cloud.bigquery.utils.queryfixer.entity.FixOption;\n+import com.google.cloud.bigquery.utils.queryfixer.entity.FixResult;\n+import com.google.gson.Gson;\n+import com.google.gson.GsonBuilder;\n+import org.apache.commons.cli.Option;\n+import org.apache.commons.cli.*;\n+\n+import java.util.List;\n \n public class QueryFixerMain {\n \n-  private static final FluentLogger logger = FluentLogger.forEnclosingClass();\n+  private static CommandLine readFlags(String[] args) {\n+    Options options = new Options();\n \n-  public static void main(String[] args) {\n+    Option option =\n+        new Option(\n+            /*opt=*/ \"c\",\n+            /*long-opt=*/ \"credential\",\n+            /*hasArg=*/ true,\n+            /*description=*/ \"The credential file (in JSON) of service account connecting to BigQuery. Otherwise, the default application-login credential will be used.\");\n+    options.addOption(option);\n+    option =\n+        new Option(\n+            /*opt=*/ \"p\",\n+            /*long-opt=*/ \"project-id\",\n+            /*hasArg=*/ true,\n+            /*description=*/ \"The ID of project where queries will be performed. This field is required if the project is not specified in credential\");\n+    options.addOption(option);\n+    option =\n+        new Option(\n+            /*opt=*/ \"o\",\n+            /*long-opt=*/ \"output\",\n+            /*hasArg=*/ true,\n+            /*description=*/ \"The format to output fix results. The available formats are \\\"natural\\\" (default) and \\\"json\\\"\");\n+    options.addOption(option);\n+    option =\n+        new Option(\n+            /*opt=*/ \"i\",\n+            /*long-opt=*/ \"interact\",\n+            /*hasArg=*/ true,\n+            /*description=*/ \"Interactive Mode. The available mode are \\\"none\\\" (default), \\\"guide\\\" and \\\"all/full\\\"\");\n+    options.addOption(option);\n \n     if (args.length == 0) {\n-      // TODO: provide a more actionable info. This will be done once we finalize the input parameters.\n-      logger.atInfo().log(\"not enough arguments\");\n+      System.out.println(\"Please provide arguments.\");\n+      printHelpAndExit(options);\n+    }\n+\n+    CommandLineParser parser = new DefaultParser();\n+    try {\n+      return parser.parse(options, args);\n+    } catch (ParseException e) {\n+      System.out.println(e.getMessage());\n+      printHelpAndExit(options);\n+      return null;\n+    }\n+  }\n+\n+  public static void printHelpAndExit(Options options) {\n+    HelpFormatter formatter = new HelpFormatter();\n+    formatter.printHelp(\"-opt <value> --long-opt <value> \\\"query\\\"\", options);\n+    System.exit(1);\n+  }\n+\n+  public static void main(String[] args) {\n+    CommandLine cmd = readFlags(args);\n+\n+    String credentialPath = cmd.getOptionValue(\"credential\");\n+    String projectId = cmd.getOptionValue(\"project-id\");\n+    BigQueryOptions bigQueryOptions = buildBigQueryOptions(credentialPath, projectId);\n+\n+    if (cmd.getArgList().isEmpty()) {\n+      // In CLI mode, all the instructions are output by print functions, because logger outputs\n+      // extract info (time, code position) that distracts users.\n+      System.out.println(\n+          \"Please provide the query as an argument, enclosed by double quote. Use --help for instruction.\");\n+    }\n+\n+    String query = cmd.getArgList().get(0);\n+    System.out.println(\"Input query: \" + query);\n+\n+    AutomaticQueryFixer queryFixer = new AutomaticQueryFixer(bigQueryOptions);\n+\n+    String interactMode = cmd.getOptionValue(\"interact\");\n+    if (interactMode == null || interactMode.equalsIgnoreCase(\"none\")) {\n+      // todo: Implement Non-interactive mode\n+      FixResult fixResult = queryFixer.fix(query);\n+      if (fixResult.getOptions().isEmpty()) {\n+        return;\n+      }\n+      String newQuery = fixResult.getOptions().get(0).getFixedQuery();\n+      printQueryResult(newQuery, bigQueryOptions);\n+\n+    } else if (interactMode.equalsIgnoreCase(\"guide\")) {\n+      // todo: Implement guide mode\n+      return;\n+    } else if (interactMode.equalsIgnoreCase(\"all\") || interactMode.equalsIgnoreCase(\"full\")) {\n+      FixResult fixResult = fullInteractMode(queryFixer, query);\n+      printFixResult(fixResult, cmd.getOptionValue(\"output\"));\n+    } else {\n+      System.out.println(\"Interact Mode (-i) is incorrect. Use --help for usage.\");\n+      System.exit(1);\n+    }\n+  }\n+\n+  private static BigQueryOptions buildBigQueryOptions(String credentialPath, String projectId) {\n+    if (credentialPath == null) {\n+      return BigQueryOptions.newBuilder().setProjectId(projectId).build();\n+    } else {\n+      // TODO: should support this in near future.\n+      System.out.println(\"customized credential is not supported\");\n+      System.exit(1);\n+      return null;\n+    }\n+  }\n+\n+  private static FixResult fullInteractMode(AutomaticQueryFixer queryFixer, String query) {\n+    return queryFixer.fix(query);\n+  }\n+\n+  private static void printFixResult(FixResult fixResult, String outputFormat) {\n+    if (outputFormat == null || outputFormat.equalsIgnoreCase(\"natural\")) {\n+      printFixResultInCommandLine(fixResult);\n+    } else if (outputFormat.equalsIgnoreCase(\"json\")) {\n+      printFixResultAsJson(fixResult);\n+    } else {\n+      System.out.println(\"Output Mode (-o) is incorrect. Use --help for usage.\");\n+      System.exit(1);\n+    }\n+  }\n+\n+  private static void printFixResultAsJson(FixResult fixResult) {\n+    Gson gson = new GsonBuilder().setPrettyPrinting().serializeNulls().create();\n+    System.out.println(gson.toJson(fixResult));\n+  }\n+\n+  private static void printFixResultInCommandLine(FixResult fixResult) {\n+    if (fixResult.getStatus() == FixResult.Status.NO_ERROR) {\n+      System.out.println(\"The input query is correct\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f0b6c3b67b941470566dc93425bb6de0373538f3"}, "originalPosition": 147}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY0NTU3Mzg1", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/141#pullrequestreview-464557385", "createdAt": "2020-08-10T20:17:27Z", "commit": {"oid": "f0b6c3b67b941470566dc93425bb6de0373538f3"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMFQyMDoxNzoyOFrOG-eSVA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMFQyMDoxNzoyOFrOG-eSVA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODE2MTEwOA==", "bodyText": "\"Failed to fix the input query.\"", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/141#discussion_r468161108", "createdAt": "2020-08-10T20:17:28Z", "author": {"login": "kikkyo"}, "path": "tools/automatic_query_fixer/src/main/java/com/google/cloud/bigquery/utils/queryfixer/QueryFixerMain.java", "diffHunk": "@@ -1,19 +1,196 @@\n package com.google.cloud.bigquery.utils.queryfixer;\n \n-import com.google.common.flogger.FluentLogger;\n+import com.google.cloud.bigquery.*;\n+import com.google.cloud.bigquery.utils.queryfixer.entity.FixOption;\n+import com.google.cloud.bigquery.utils.queryfixer.entity.FixResult;\n+import com.google.gson.Gson;\n+import com.google.gson.GsonBuilder;\n+import org.apache.commons.cli.Option;\n+import org.apache.commons.cli.*;\n+\n+import java.util.List;\n \n public class QueryFixerMain {\n \n-  private static final FluentLogger logger = FluentLogger.forEnclosingClass();\n+  private static CommandLine readFlags(String[] args) {\n+    Options options = new Options();\n \n-  public static void main(String[] args) {\n+    Option option =\n+        new Option(\n+            /*opt=*/ \"c\",\n+            /*long-opt=*/ \"credential\",\n+            /*hasArg=*/ true,\n+            /*description=*/ \"The credential file (in JSON) of service account connecting to BigQuery. Otherwise, the default application-login credential will be used.\");\n+    options.addOption(option);\n+    option =\n+        new Option(\n+            /*opt=*/ \"p\",\n+            /*long-opt=*/ \"project-id\",\n+            /*hasArg=*/ true,\n+            /*description=*/ \"The ID of project where queries will be performed. This field is required if the project is not specified in credential\");\n+    options.addOption(option);\n+    option =\n+        new Option(\n+            /*opt=*/ \"o\",\n+            /*long-opt=*/ \"output\",\n+            /*hasArg=*/ true,\n+            /*description=*/ \"The format to output fix results. The available formats are \\\"natural\\\" (default) and \\\"json\\\"\");\n+    options.addOption(option);\n+    option =\n+        new Option(\n+            /*opt=*/ \"i\",\n+            /*long-opt=*/ \"interact\",\n+            /*hasArg=*/ true,\n+            /*description=*/ \"Interactive Mode. The available mode are \\\"none\\\" (default), \\\"guide\\\" and \\\"all/full\\\"\");\n+    options.addOption(option);\n \n     if (args.length == 0) {\n-      // TODO: provide a more actionable info. This will be done once we finalize the input parameters.\n-      logger.atInfo().log(\"not enough arguments\");\n+      System.out.println(\"Please provide arguments.\");\n+      printHelpAndExit(options);\n+    }\n+\n+    CommandLineParser parser = new DefaultParser();\n+    try {\n+      return parser.parse(options, args);\n+    } catch (ParseException e) {\n+      System.out.println(e.getMessage());\n+      printHelpAndExit(options);\n+      return null;\n+    }\n+  }\n+\n+  public static void printHelpAndExit(Options options) {\n+    HelpFormatter formatter = new HelpFormatter();\n+    formatter.printHelp(\"-opt <value> --long-opt <value> \\\"query\\\"\", options);\n+    System.exit(1);\n+  }\n+\n+  public static void main(String[] args) {\n+    CommandLine cmd = readFlags(args);\n+\n+    String credentialPath = cmd.getOptionValue(\"credential\");\n+    String projectId = cmd.getOptionValue(\"project-id\");\n+    BigQueryOptions bigQueryOptions = buildBigQueryOptions(credentialPath, projectId);\n+\n+    if (cmd.getArgList().isEmpty()) {\n+      // In CLI mode, all the instructions are output by print functions, because logger outputs\n+      // extract info (time, code position) that distracts users.\n+      System.out.println(\n+          \"Please provide the query as an argument, enclosed by double quote. Use --help for instruction.\");\n+    }\n+\n+    String query = cmd.getArgList().get(0);\n+    System.out.println(\"Input query: \" + query);\n+\n+    AutomaticQueryFixer queryFixer = new AutomaticQueryFixer(bigQueryOptions);\n+\n+    String interactMode = cmd.getOptionValue(\"interact\");\n+    if (interactMode == null || interactMode.equalsIgnoreCase(\"none\")) {\n+      // todo: Implement Non-interactive mode\n+      FixResult fixResult = queryFixer.fix(query);\n+      if (fixResult.getOptions().isEmpty()) {\n+        return;\n+      }\n+      String newQuery = fixResult.getOptions().get(0).getFixedQuery();\n+      printQueryResult(newQuery, bigQueryOptions);\n+\n+    } else if (interactMode.equalsIgnoreCase(\"guide\")) {\n+      // todo: Implement guide mode\n+      return;\n+    } else if (interactMode.equalsIgnoreCase(\"all\") || interactMode.equalsIgnoreCase(\"full\")) {\n+      FixResult fixResult = fullInteractMode(queryFixer, query);\n+      printFixResult(fixResult, cmd.getOptionValue(\"output\"));\n+    } else {\n+      System.out.println(\"Interact Mode (-i) is incorrect. Use --help for usage.\");\n+      System.exit(1);\n+    }\n+  }\n+\n+  private static BigQueryOptions buildBigQueryOptions(String credentialPath, String projectId) {\n+    if (credentialPath == null) {\n+      return BigQueryOptions.newBuilder().setProjectId(projectId).build();\n+    } else {\n+      // TODO: should support this in near future.\n+      System.out.println(\"customized credential is not supported\");\n+      System.exit(1);\n+      return null;\n+    }\n+  }\n+\n+  private static FixResult fullInteractMode(AutomaticQueryFixer queryFixer, String query) {\n+    return queryFixer.fix(query);\n+  }\n+\n+  private static void printFixResult(FixResult fixResult, String outputFormat) {\n+    if (outputFormat == null || outputFormat.equalsIgnoreCase(\"natural\")) {\n+      printFixResultInCommandLine(fixResult);\n+    } else if (outputFormat.equalsIgnoreCase(\"json\")) {\n+      printFixResultAsJson(fixResult);\n+    } else {\n+      System.out.println(\"Output Mode (-o) is incorrect. Use --help for usage.\");\n+      System.exit(1);\n+    }\n+  }\n+\n+  private static void printFixResultAsJson(FixResult fixResult) {\n+    Gson gson = new GsonBuilder().setPrettyPrinting().serializeNulls().create();\n+    System.out.println(gson.toJson(fixResult));\n+  }\n+\n+  private static void printFixResultInCommandLine(FixResult fixResult) {\n+    if (fixResult.getStatus() == FixResult.Status.NO_ERROR) {\n+      System.out.println(\"The input query is correct\");\n+      return;\n+    }\n+\n+    System.out.println(\"The query has an error: \" + fixResult.getError());\n+\n+    if (fixResult.getStatus() == FixResult.Status.FAILURE) {\n+      System.out.println(\"The input query is unable to fix\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f0b6c3b67b941470566dc93425bb6de0373538f3"}, "originalPosition": 154}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY0NTU5NTQy", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/141#pullrequestreview-464559542", "createdAt": "2020-08-10T20:20:54Z", "commit": {"oid": "f0b6c3b67b941470566dc93425bb6de0373538f3"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b096853e36a902f0254cdbe9faf4d5c69384b7ba", "author": {"user": {"login": "mingen-pan", "name": "Mingen Pan"}}, "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/b096853e36a902f0254cdbe9faf4d5c69384b7ba", "committedDate": "2020-08-11T20:17:35Z", "message": "Modify the code based on PR review."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4449a298e84aef68a35a48b0acc5874a6e81e8da", "author": {"user": {"login": "mingen-pan", "name": "Mingen Pan"}}, "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/4449a298e84aef68a35a48b0acc5874a6e81e8da", "committedDate": "2020-08-12T20:42:42Z", "message": "Change the option config"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY2MzU4MDE2", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/141#pullrequestreview-466358016", "createdAt": "2020-08-13T00:13:40Z", "commit": {"oid": "b096853e36a902f0254cdbe9faf4d5c69384b7ba"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QwMDoxMzo0MVrOG_3HBw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QwMDoxMzo0MVrOG_3HBw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTYxNjM5MQ==", "bodyText": "nit: TODO:", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/141#discussion_r469616391", "createdAt": "2020-08-13T00:13:41Z", "author": {"login": "kikkyo"}, "path": "tools/automatic_query_fixer/src/main/java/com/google/cloud/bigquery/utils/queryfixer/QueryFixerMain.java", "diffHunk": "@@ -84,25 +102,34 @@ public static void main(String[] args) {\n \n     AutomaticQueryFixer queryFixer = new AutomaticQueryFixer(bigQueryOptions);\n \n-    String interactMode = cmd.getOptionValue(\"interact\");\n-    if (interactMode == null || interactMode.equalsIgnoreCase(\"none\")) {\n-      // todo: Implement Non-interactive mode\n-      FixResult fixResult = queryFixer.fix(query);\n-      if (fixResult.getOptions().isEmpty()) {\n+    String interactMode = cmd.getOptionValue(INTERACT);\n+    if (interactMode == null) {\n+      interactMode = INTERACT_MODE_NONE;\n+    }\n+    switch (interactMode) {\n+      case INTERACT_MODE_NONE:\n+        // todo: Implement Non-interactive mode", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b096853e36a902f0254cdbe9faf4d5c69384b7ba"}, "originalPosition": 88}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY2MzU4MDY0", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/141#pullrequestreview-466358064", "createdAt": "2020-08-13T00:13:49Z", "commit": {"oid": "b096853e36a902f0254cdbe9faf4d5c69384b7ba"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QwMDoxMzo0OVrOG_3HOQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QwMDoxMzo0OVrOG_3HOQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTYxNjQ0MQ==", "bodyText": "nit: TODO", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/141#discussion_r469616441", "createdAt": "2020-08-13T00:13:49Z", "author": {"login": "kikkyo"}, "path": "tools/automatic_query_fixer/src/main/java/com/google/cloud/bigquery/utils/queryfixer/QueryFixerMain.java", "diffHunk": "@@ -84,25 +102,34 @@ public static void main(String[] args) {\n \n     AutomaticQueryFixer queryFixer = new AutomaticQueryFixer(bigQueryOptions);\n \n-    String interactMode = cmd.getOptionValue(\"interact\");\n-    if (interactMode == null || interactMode.equalsIgnoreCase(\"none\")) {\n-      // todo: Implement Non-interactive mode\n-      FixResult fixResult = queryFixer.fix(query);\n-      if (fixResult.getOptions().isEmpty()) {\n+    String interactMode = cmd.getOptionValue(INTERACT);\n+    if (interactMode == null) {\n+      interactMode = INTERACT_MODE_NONE;\n+    }\n+    switch (interactMode) {\n+      case INTERACT_MODE_NONE:\n+        // todo: Implement Non-interactive mode\n+        FixResult fixResult = queryFixer.fix(query);\n+        if (fixResult.getOptions().isEmpty()) {\n+          return;\n+        }\n+        String newQuery = fixResult.getOptions().get(0).getFixedQuery();\n+        printQueryResult(newQuery, bigQueryOptions);\n+        break;\n+\n+      case INTERACT_MODE_GUIDE:\n+        // todo: Implement guide mode", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b096853e36a902f0254cdbe9faf4d5c69384b7ba"}, "originalPosition": 98}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY2MzU4NTU2", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/141#pullrequestreview-466358556", "createdAt": "2020-08-13T00:14:21Z", "commit": {"oid": "b096853e36a902f0254cdbe9faf4d5c69384b7ba"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QwMDoxNDoyMVrOG_3Hwg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QwMDoxNDoyMVrOG_3Hwg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTYxNjU3OA==", "bodyText": "nit: 'C'ustomized credential path...", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/141#discussion_r469616578", "createdAt": "2020-08-13T00:14:21Z", "author": {"login": "kikkyo"}, "path": "tools/automatic_query_fixer/src/main/java/com/google/cloud/bigquery/utils/queryfixer/QueryFixerMain.java", "diffHunk": "@@ -111,20 +138,21 @@ private static BigQueryOptions buildBigQueryOptions(String credentialPath, Strin\n       return BigQueryOptions.newBuilder().setProjectId(projectId).build();\n     } else {\n       // TODO: should support this in near future.\n-      System.out.println(\"customized credential is not supported\");\n+      System.out.println(\"customized credential path is not supported\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b096853e36a902f0254cdbe9faf4d5c69384b7ba"}, "originalPosition": 130}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY2MzYwMTk1", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/141#pullrequestreview-466360195", "createdAt": "2020-08-13T00:15:22Z", "commit": {"oid": "4449a298e84aef68a35a48b0acc5874a6e81e8da"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QwMDoxNToyMlrOG_3I-A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QwMDoxNToyMlrOG_3I-A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTYxNjg4OA==", "bodyText": "nit: \"modes\"", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/141#discussion_r469616888", "createdAt": "2020-08-13T00:15:22Z", "author": {"login": "kikkyo"}, "path": "tools/automatic_query_fixer/src/main/java/com/google/cloud/bigquery/utils/queryfixer/QueryFixerMain.java", "diffHunk": "@@ -56,10 +59,10 @@ private static CommandLine readFlags(String[] args) {\n     options.addOption(option);\n     option =\n         new Option(\n-            /*opt=*/ INTERACT_SHORTCUT,\n-            /*long-opt=*/ INTERACT,\n+            /*opt=*/ MODE_SHORTCUT,\n+            /*long-opt=*/ MODE,\n             /*hasArg=*/ true,\n-            /*description=*/ \"Interactive Mode. The available mode are \\\"none\\\" (default), \\\"guide\\\" and \\\"all/full\\\"\");\n+            /*description=*/ \"Interactive Mode. The available mode are \\\"auto\\\" (default), \\\"ua/user-assistance\\\" and \\\"fo/fix-once\\\". Please see the README file for their meanings\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4449a298e84aef68a35a48b0acc5874a6e81e8da"}, "originalPosition": 38}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY2MzYyNzAx", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/141#pullrequestreview-466362701", "createdAt": "2020-08-13T00:17:05Z", "commit": {"oid": "4449a298e84aef68a35a48b0acc5874a6e81e8da"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "af06b1b6dc68254c099d890206a16aa7c4c1230c", "author": {"user": {"login": "mingen-pan", "name": "Mingen Pan"}}, "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/af06b1b6dc68254c099d890206a16aa7c4c1230c", "committedDate": "2020-08-13T17:35:15Z", "message": "Minor fix"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ac6f19cd9775c10bea3b3187a1a10e218b024a9a", "author": {"user": {"login": "mingen-pan", "name": "Mingen Pan"}}, "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/ac6f19cd9775c10bea3b3187a1a10e218b024a9a", "committedDate": "2020-08-13T17:35:34Z", "message": "Merge branch 'master' into main_dataflow"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 730, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}