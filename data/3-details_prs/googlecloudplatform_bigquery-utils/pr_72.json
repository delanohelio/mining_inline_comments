{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM5NTM5MzU4", "number": 72, "title": "SQL Extraction: refactor to use sequences", "bodyText": "I did some refactoring on the SQL Extraction project\n\nfixed minor mistake in readme (run -> build)\nmade relevant classes input/output sequences (like Java streams but in Kotlin) instead of some other data structure\nmade DataFlowSolver retrieve the queries from the engine rather than the frontend\nrenamed FileListExpander to FilesExpander\nmade QueryFragment immutable\nimplemented Comparable for Location", "createdAt": "2020-06-24T21:54:18Z", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/72", "merged": true, "mergeCommit": {"oid": "4433cf2d4cf306a1f656077665865fb4459d8c47"}, "closed": true, "closedAt": "2020-06-29T23:46:38Z", "author": {"login": "creativitRy"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcu0GsBABqjM0ODM5MDI1NTE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcwJ5m9gFqTQzOTU3NTExNQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "97ef01567ad3771a8807c6e31dc3e8341c8e2afd", "author": {"user": {"login": "creativitRy", "name": "Gahwon Lee"}}, "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/97ef01567ad3771a8807c6e31dc3e8341c8e2afd", "committedDate": "2020-06-24T21:46:45Z", "message": "SQL Extraction: refactor to use sequences"}, "afterCommit": {"oid": "1e370fe26ae3295a67a5e0c4f16e4b7420453b98", "author": {"user": {"login": "creativitRy", "name": "Gahwon Lee"}}, "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/1e370fe26ae3295a67a5e0c4f16e4b7420453b98", "committedDate": "2020-06-25T19:48:33Z", "message": "SQL Extraction: refactor to use sequences"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4d76278e9bbc3fdfe06dfc053a89ff3c8d031ba7", "author": {"user": {"login": "creativitRy", "name": "Gahwon Lee"}}, "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/4d76278e9bbc3fdfe06dfc053a89ff3c8d031ba7", "committedDate": "2020-06-25T21:48:45Z", "message": "SQL Extraction: refactor to use sequences"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "1e370fe26ae3295a67a5e0c4f16e4b7420453b98", "author": {"user": {"login": "creativitRy", "name": "Gahwon Lee"}}, "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/1e370fe26ae3295a67a5e0c4f16e4b7420453b98", "committedDate": "2020-06-25T19:48:33Z", "message": "SQL Extraction: refactor to use sequences"}, "afterCommit": {"oid": "4d76278e9bbc3fdfe06dfc053a89ff3c8d031ba7", "author": {"user": {"login": "creativitRy", "name": "Gahwon Lee"}}, "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/4d76278e9bbc3fdfe06dfc053a89ff3c8d031ba7", "committedDate": "2020-06-25T21:48:45Z", "message": "SQL Extraction: refactor to use sequences"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM4ODA0MTUw", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/72#pullrequestreview-438804150", "createdAt": "2020-06-28T18:48:30Z", "commit": {"oid": "4d76278e9bbc3fdfe06dfc053a89ff3c8d031ba7"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yOFQxODo0ODozMFrOGp_dVA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yOFQxODo0ODozMFrOGp_dVA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjY4NDUwMA==", "bodyText": "Pls add comment.\nI prefer to use name \"addUsage\". Also, it feels more natural to me to put the parameter \"query\" before \"usage\".", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/72#discussion_r446684500", "createdAt": "2020-06-28T18:48:30Z", "author": {"login": "feiling"}, "path": "tools/sql_extraction/src/main/kotlin/DataFlowEngine.kt", "diffHunk": "@@ -1,7 +1,26 @@\n package com.google.cloud.sqlecosystem.sqlextraction\n \n+import com.google.cloud.sqlecosystem.sqlextraction.output.Location\n+import com.google.cloud.sqlecosystem.sqlextraction.output.QueryFragment\n+import com.google.cloud.sqlecosystem.sqlextraction.output.QueryUsages\n+\n /**\n  * Backend engine for running data-flow analysis\n  * @see FrontEnd\n  */\n-class DataFlowEngine\n\\ No newline at end of file\n+class DataFlowEngine {\n+    private val queryUsages: HashMap<QueryFragment, HashSet<Location>> = HashMap()\n+\n+    /**\n+     * Returns all query fragments and usages found by the engine thus far\n+     */\n+    fun getAllQueries(): Sequence<QueryUsages> {\n+        return queryUsages.asSequence()\n+            .filter { it.value.isNotEmpty() }\n+            .map { QueryUsages(it.key, it.value.sorted()) }\n+    }\n+\n+    private fun registerUsage(usage: Location, query: QueryFragment) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4d76278e9bbc3fdfe06dfc053a89ff3c8d031ba7"}, "originalPosition": 25}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cf194b33cffa32eb1c29023ae71070dc8e79ff85", "author": {"user": {"login": "creativitRy", "name": "Gahwon Lee"}}, "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/cf194b33cffa32eb1c29023ae71070dc8e79ff85", "committedDate": "2020-06-29T15:50:36Z", "message": "Added javadoc to addUsage"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM5NTc1MTE1", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/72#pullrequestreview-439575115", "createdAt": "2020-06-29T23:46:31Z", "commit": {"oid": "cf194b33cffa32eb1c29023ae71070dc8e79ff85"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 586, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}