{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDYzNjQ4Nzk2", "number": 136, "title": "SQL Extraction: analyze java annotations", "bodyText": "A lot of Java frameworks use method annotations as a way of running SQL queries, and this PR allows analysis within annotation arguments.\nExample from the framework JDBI (https://jdbi.org/#__sqlupdate):\npublic interface UserDao {\n  @SqlUpdate(\"insert into users (id, name) values (?, ?)\")\n  void insert(long id, String name);\n}\nIn this case, the annotation would be considered a usage.", "createdAt": "2020-08-05T21:20:20Z", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/136", "merged": true, "mergeCommit": {"oid": "b556637b83da9a965ba3816ce33487c3e8c65ee3"}, "closed": true, "closedAt": "2020-08-07T19:49:51Z", "author": {"login": "creativitRy"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc8B7uqgH2gAyNDYzNjQ4Nzk2OjdiZDVhMDIzMmFkODRmYTM1MjZkOGJlY2VhYmQ0MDhkZDI1ODAxMWE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc8p3oygH2gAyNDYzNjQ4Nzk2OmE1OTAwMzdkZmRlYTM0YTM0YmQ0NDM5NjBiMmExYWQzMGI4NjBkN2E=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "7bd5a0232ad84fa3526d8beceabd408dd258011a", "author": {"user": {"login": "creativitRy", "name": "Gahwon Lee"}}, "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/7bd5a0232ad84fa3526d8beceabd408dd258011a", "committedDate": "2020-08-05T21:16:41Z", "message": "SQL Extraction: analyze java annotations"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYzNTU0Mjc1", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/136#pullrequestreview-463554275", "createdAt": "2020-08-07T19:15:50Z", "commit": {"oid": "7bd5a0232ad84fa3526d8beceabd408dd258011a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wN1QxOToxNTo1MFrOG9lHPw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wN1QxOToxNTo1MFrOG9lHPw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzIyNDM4Mw==", "bodyText": "For the sample test\n   @SqlUpdate(\"insert into users (id, name) values (?, ?)\")\n    void insert(long id, String name);\n\nWhat is the value of currentQuery here?", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/136#discussion_r467224383", "createdAt": "2020-08-07T19:15:50Z", "author": {"login": "feiling"}, "path": "tools/sql_extraction/src/main/kotlin/DataFlowEngine.kt", "diffHunk": "@@ -30,6 +30,25 @@ class DataFlowEngine(private val environment: Environment = Environment()) {\n             .map { QueryUsages(it.key, it.value.sorted()) }\n     }\n \n+    /**\n+     * Visits an annotation located at [location].\n+     * Strings passed as arguments can be considered a usage.\n+     *\n+     * @param[visitArguments] Potential visit for all annotation arguments.\n+     */\n+    fun visitAnnotation(location: Location, visitArguments: () -> Unit) {\n+        val prevQuery = currentQuery\n+\n+        currentQuery = null\n+        visitArguments()\n+\n+        if (currentQuery != null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7bd5a0232ad84fa3526d8beceabd408dd258011a"}, "originalPosition": 16}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYzNTcxNzE3", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/136#pullrequestreview-463571717", "createdAt": "2020-08-07T19:48:19Z", "commit": {"oid": "7bd5a0232ad84fa3526d8beceabd408dd258011a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a590037dfdea34a34bd443960b2a1ad30b860d7a", "author": {"user": {"login": "feiling", "name": null}}, "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/a590037dfdea34a34bd443960b2a1ad30b860d7a", "committedDate": "2020-08-07T19:48:25Z", "message": "Merge branch 'master' into annotation"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 722, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}