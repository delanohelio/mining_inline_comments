{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTEwODUyNjQw", "number": 183, "reviewThreads": {"totalCount": 21, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMi0wM1QxNDo1Nzo0NFrOFWOENg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMi0yNFQxNDoxMjoyNFrOFeH12g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzU4ODQzNDQ2OnYy", "diffSide": "RIGHT", "path": "udfs/statslib/pvalue.sql", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMi0wM1QxNDo1Nzo0NFrOIfGcgA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMi0wOFQxODowMTozMVrOIhvsww==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2OTQ4MjM2OA==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                library=[\"gs://bqutil-lib/bq_js_libs/jstat-v1.9.4.min.js\"]\n          \n          \n            \n                library=[\"${JS_BUCKET}/jstat-v1.9.4.min.js\"]", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/183#discussion_r569482368", "createdAt": "2021-02-03T14:57:44Z", "author": {"login": "danieldeleo"}, "path": "udfs/statslib/pvalue.sql", "diffHunk": "@@ -0,0 +1,10 @@\n+#standardSQL\n+\n+CREATE OR REPLACE FUNCTION st.pvalue(H FLOAT64, dof INT64) \n+RETURNS FLOAT64 \n+LANGUAGE js AS \"\"\"\n+  return 1.0 - jStat['chisquare'].cdf(H, dof)\n+\"\"\"\n+OPTIONS ( \n+    library=[\"gs://bqutil-lib/bq_js_libs/jstat-v1.9.4.min.js\"]", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9a63ff29bb4aa9d88dd950a0eacc40c1ee570408"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3MjI1NTQyNw==", "bodyText": "changes still pending", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/183#discussion_r572255427", "createdAt": "2021-02-08T18:01:31Z", "author": {"login": "danieldeleo"}, "path": "udfs/statslib/pvalue.sql", "diffHunk": "@@ -0,0 +1,10 @@\n+#standardSQL\n+\n+CREATE OR REPLACE FUNCTION st.pvalue(H FLOAT64, dof INT64) \n+RETURNS FLOAT64 \n+LANGUAGE js AS \"\"\"\n+  return 1.0 - jStat['chisquare'].cdf(H, dof)\n+\"\"\"\n+OPTIONS ( \n+    library=[\"gs://bqutil-lib/bq_js_libs/jstat-v1.9.4.min.js\"]", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2OTQ4MjM2OA=="}, "originalCommit": {"oid": "9a63ff29bb4aa9d88dd950a0eacc40c1ee570408"}, "originalPosition": 9}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzU4ODQ1NzYzOnYy", "diffSide": "LEFT", "path": "udfs/tests/udf_test_utils.py", "isResolved": false, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMi0wM1QxNTowMjoxNVrOIfGrNw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMi0wOFQyMTo1Njo1MVrOIh4rLQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2OTQ4NjEzNQ==", "bodyText": "Please remove this change. Will keep PR focused on addition of UDF", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/183#discussion_r569486135", "createdAt": "2021-02-03T15:02:15Z", "author": {"login": "danieldeleo"}, "path": "udfs/tests/udf_test_utils.py", "diffHunk": "@@ -25,7 +25,6 @@\n \n from google.cloud import bigquery\n \n-", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9a63ff29bb4aa9d88dd950a0eacc40c1ee570408"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3MjI1NTUzOQ==", "bodyText": "changes still pending", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/183#discussion_r572255539", "createdAt": "2021-02-08T18:01:43Z", "author": {"login": "danieldeleo"}, "path": "udfs/tests/udf_test_utils.py", "diffHunk": "@@ -25,7 +25,6 @@\n \n from google.cloud import bigquery\n \n-", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2OTQ4NjEzNQ=="}, "originalCommit": {"oid": "9a63ff29bb4aa9d88dd950a0eacc40c1ee570408"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3MjM4ODM3NA==", "bodyText": "@danieldeleo can you help me out with how to make this fix? I don't see where I made a change? Or perhaps you can suggest the git command to remove this frome the commit?", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/183#discussion_r572388374", "createdAt": "2021-02-08T21:32:24Z", "author": {"login": "jrossthomson"}, "path": "udfs/tests/udf_test_utils.py", "diffHunk": "@@ -25,7 +25,6 @@\n \n from google.cloud import bigquery\n \n-", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2OTQ4NjEzNQ=="}, "originalCommit": {"oid": "9a63ff29bb4aa9d88dd950a0eacc40c1ee570408"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3MjQwMjQ3Nw==", "bodyText": "This is the log output.\njrossthomson@drjay:~/bigquery-utils/udfs/tests$ git log -- test_run_udfs.py\ncommit 1e0bd0d42779114d1f5e475cd91d43d2fc049a62\nAuthor: Daniel De Leo <danieldeleo@users.noreply.github.com>\nDate:   Wed Jan 20 10:41:54 2021 -0500\n\n    Adding CI/CD process for hosting minified javascript libraries (#187)\n\ncommit 1b6fc90eb0a434e36fdc7957fe030b7e622ddb6c\nAuthor: Daniel De Leo <danieldeleo@users.noreply.github.com>\nDate:   Tue Apr 7 10:27:43 2020 -0400\n\n    Adding UDF Testing Framework (#36)\n    \n    * Adding UDF Unit Testing Framework\n    \n    Co-authored-by: tslr <tslr@google.com>\n[hi on] jrossthomson@drjay:~/bigquery-utils/udfs/tests$", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/183#discussion_r572402477", "createdAt": "2021-02-08T21:56:51Z", "author": {"login": "jrossthomson"}, "path": "udfs/tests/udf_test_utils.py", "diffHunk": "@@ -25,7 +25,6 @@\n \n from google.cloud import bigquery\n \n-", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2OTQ4NjEzNQ=="}, "originalCommit": {"oid": "9a63ff29bb4aa9d88dd950a0eacc40c1ee570408"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzU4ODQ2MTM0OnYy", "diffSide": "RIGHT", "path": ".init", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMi0wM1QxNTowMzowM1rOIfGtsQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMi0wOFQxODowMToxNFrOIhvsEQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2OTQ4Njc2OQ==", "bodyText": "Remove this file from PR", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/183#discussion_r569486769", "createdAt": "2021-02-03T15:03:03Z", "author": {"login": "danieldeleo"}, "path": ".init", "diffHunk": "@@ -0,0 +1,15 @@\n+\n+# if lsst virutalenv exists, use it.\n+\n+if [ -f ~/.bigquery/bin/activate ]; then\n+   . ~/.bigquery/bin/activate\n+fi\n+\n+if [ -f key.json ]; then\n+   export GOOGLE_APPLICATION_CREDENTIALS=\"key.json\"\n+fi\n+\n+gcloud config set project nih-bq\n+gcloud config set compute/zone us-central1-f\n+gcloud config set compute/region us-central1\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9a63ff29bb4aa9d88dd950a0eacc40c1ee570408"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3MjI1NTI0OQ==", "bodyText": "changes still pending", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/183#discussion_r572255249", "createdAt": "2021-02-08T18:01:14Z", "author": {"login": "danieldeleo"}, "path": ".init", "diffHunk": "@@ -0,0 +1,15 @@\n+\n+# if lsst virutalenv exists, use it.\n+\n+if [ -f ~/.bigquery/bin/activate ]; then\n+   . ~/.bigquery/bin/activate\n+fi\n+\n+if [ -f key.json ]; then\n+   export GOOGLE_APPLICATION_CREDENTIALS=\"key.json\"\n+fi\n+\n+gcloud config set project nih-bq\n+gcloud config set compute/zone us-central1-f\n+gcloud config set compute/region us-central1\n+", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2OTQ4Njc2OQ=="}, "originalCommit": {"oid": "9a63ff29bb4aa9d88dd950a0eacc40c1ee570408"}, "originalPosition": 15}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzU4ODQ3MDg0OnYy", "diffSide": "RIGHT", "path": ".gitignore", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMi0wM1QxNTowNDo1N1rOIfGzqw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMi0wOFQxODowMTowMlrOIhvrkg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2OTQ4ODI5OQ==", "bodyText": "please remove all changes to this file from PR", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/183#discussion_r569488299", "createdAt": "2021-02-03T15:04:57Z", "author": {"login": "danieldeleo"}, "path": ".gitignore", "diffHunk": "@@ -1,5 +1,6 @@\n # Compiled class file\n *.class\n+*.pyc", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9a63ff29bb4aa9d88dd950a0eacc40c1ee570408"}, "originalPosition": 3}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3MjI1NTEyMg==", "bodyText": "changes still pending", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/183#discussion_r572255122", "createdAt": "2021-02-08T18:01:02Z", "author": {"login": "danieldeleo"}, "path": ".gitignore", "diffHunk": "@@ -1,5 +1,6 @@\n # Compiled class file\n *.class\n+*.pyc", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2OTQ4ODI5OQ=="}, "originalCommit": {"oid": "9a63ff29bb4aa9d88dd950a0eacc40c1ee570408"}, "originalPosition": 3}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzU4ODQ3ODk5OnYy", "diffSide": "RIGHT", "path": "udfs/statslib/kruskal_wallis.sql", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMi0wM1QxNTowNjozN1rOIfG44Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMi0wM1QxNTowNjozN1rOIfG44Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2OTQ4OTYzMw==", "bodyText": "Upper case all SQL key words (WITH, SELECT, FROM, etc)", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/183#discussion_r569489633", "createdAt": "2021-02-03T15:06:37Z", "author": {"login": "danieldeleo"}, "path": "udfs/statslib/kruskal_wallis.sql", "diffHunk": "@@ -0,0 +1,36 @@\n+/*\n+ * Copyright 2019 Google LLC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+CREATE OR REPLACE FUNCTION st.kruskal_wallis(data ARRAY<STRUCT<factor STRING, val FLOAT64>>) AS ((\n+    with H_raw AS(\n+        with sums AS \n+        (\n+            with rank_data AS \n+            (\n+                select d.factor AS f, d.val AS v, rank() over(order by d.val) AS r\n+                from unnest(data) AS d \n+            ) #rank_data\n+            select     \n+                SUM(r) * (SUM(r) / COUNT(*)) AS sumranks, COUNT(*) AS n\n+            from rank_data\n+            GROUP BY f\n+        ) # sums\n+        SELECT 12.00 /(SUM(n) *(SUM(n) + 1)) * SUM(sumranks) -(3.00 *(SUM(n) + 1)) AS H, \n+                      count(n) -1 AS DoF\n+        FROM sums\n+    ) # H_raw\n+    SELECT struct(H AS H, st.pvalue(H, DoF) AS p, DoF AS DoF) from H_raw\n+));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9a63ff29bb4aa9d88dd950a0eacc40c1ee570408"}, "originalPosition": 36}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzU4ODQ4MDg2OnYy", "diffSide": "RIGHT", "path": "udfs/statslib/linear_regression.sql", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMi0wM1QxNTowNjo1OFrOIfG5-Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMi0wM1QxNTowNjo1OFrOIfG5-Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2OTQ4OTkxMw==", "bodyText": "Upper case all SQL key words (WITH, SELECT, FROM, etc)", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/183#discussion_r569489913", "createdAt": "2021-02-03T15:06:58Z", "author": {"login": "danieldeleo"}, "path": "udfs/statslib/linear_regression.sql", "diffHunk": "@@ -0,0 +1,43 @@\n+/*\n+ * Copyright 2019 Google LLC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+\n+\n+CREATE OR REPLACE FUNCTION st.linear_regression(data ARRAY<STRUCT<X FLOAT64, Y FLOAT64>>) \n+AS ((\n+     WITH results AS (\n+       WITH sums AS (\n+         with d as (\n+              select * from unnest(data)\n+         )\n+         select \n+            SUM(d.X) as Sx,\n+            SUM(d.Y) as Sy,\n+            SUM(d.X * d.Y) as Sxy,\n+            SUM(d.X * d.X) as Sxx,\n+            SUM(d.Y * d.Y) as Syy,\n+            COUNT(*) as N\n+         from d\n+       )\n+       SELECT \n+        ((Sy * Sxx) - (Sx * Sxy)) / ((N * (Sxx)) - (Sx * Sx)) AS a,\n+        ((N * Sxy) - (Sx * Sy))  / ((N * Sxx) - (Sx * Sx)) AS b,\n+        ((N * Sxy) - (Sx * Sy))/ SQRT(\n+            (((N * Sxx) - (Sx * Sx))* ((N * Syy - (Sy * Sy))))) AS r \n+        from sums\n+      )\n+      select STRUCT(a, b, r) from results\n+));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9a63ff29bb4aa9d88dd950a0eacc40c1ee570408"}, "originalPosition": 43}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzYwNzk1NzQyOnYy", "diffSide": "RIGHT", "path": "udfs/statslib/kruskal_wallis.sql", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMi0wOFQyMjoxOTo0MlrOIh5mJg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMi0wOFQyMjoxOTo0MlrOIh5mJg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3MjQxNzU3NA==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            CREATE OR REPLACE FUNCTION st.kruskal_wallis(data ARRAY<STRUCT<factor STRING, val FLOAT64>>) AS ((\n          \n          \n            \n            CREATE OR REPLACE FUNCTION fn.kruskal_wallis(data ARRAY<STRUCT<factor STRING, val FLOAT64>>) AS ((", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/183#discussion_r572417574", "createdAt": "2021-02-08T22:19:42Z", "author": {"login": "danieldeleo"}, "path": "udfs/statslib/kruskal_wallis.sql", "diffHunk": "@@ -0,0 +1,36 @@\n+/*\n+ * Copyright 2019 Google LLC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+CREATE OR REPLACE FUNCTION st.kruskal_wallis(data ARRAY<STRUCT<factor STRING, val FLOAT64>>) AS ((", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "568cb96d84cf0e323e9dab18e9bbe6d8e013eaa6"}, "originalPosition": 17}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzYwNzk1ODExOnYy", "diffSide": "RIGHT", "path": "udfs/statslib/linear_regression.sql", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMi0wOFQyMjoxOTo1M1rOIh5mog==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMi0wOFQyMjoxOTo1M1rOIh5mog==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3MjQxNzY5OA==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            CREATE OR REPLACE FUNCTION st.linear_regression(data ARRAY<STRUCT<X FLOAT64, Y FLOAT64>>) \n          \n          \n            \n            CREATE OR REPLACE FUNCTION fn.linear_regression(data ARRAY<STRUCT<X FLOAT64, Y FLOAT64>>)", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/183#discussion_r572417698", "createdAt": "2021-02-08T22:19:53Z", "author": {"login": "danieldeleo"}, "path": "udfs/statslib/linear_regression.sql", "diffHunk": "@@ -0,0 +1,43 @@\n+/*\n+ * Copyright 2019 Google LLC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+\n+\n+CREATE OR REPLACE FUNCTION st.linear_regression(data ARRAY<STRUCT<X FLOAT64, Y FLOAT64>>) ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "568cb96d84cf0e323e9dab18e9bbe6d8e013eaa6"}, "originalPosition": 19}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzYwNzk1ODc5OnYy", "diffSide": "RIGHT", "path": "udfs/statslib/pvalue.sql", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMi0wOFQyMjoyMDowM1rOIh5nCw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMi0wOFQyMjoyMDowM1rOIh5nCw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3MjQxNzgwMw==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            CREATE OR REPLACE FUNCTION st.pvalue(H FLOAT64, dof INT64) \n          \n          \n            \n            CREATE OR REPLACE FUNCTION fn.pvalue(H FLOAT64, dof INT64)", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/183#discussion_r572417803", "createdAt": "2021-02-08T22:20:03Z", "author": {"login": "danieldeleo"}, "path": "udfs/statslib/pvalue.sql", "diffHunk": "@@ -0,0 +1,10 @@\n+#standardSQL\n+\n+CREATE OR REPLACE FUNCTION st.pvalue(H FLOAT64, dof INT64) ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "568cb96d84cf0e323e9dab18e9bbe6d8e013eaa6"}, "originalPosition": 3}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzYxMjA1NzY2OnYy", "diffSide": "RIGHT", "path": "udfs/statslib/kruskal_wallis.sql", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMi0wOVQxNjoyNjoyOVrOIifIIw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMi0wOVQxNjoyNjoyOVrOIifIIw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3MzAzMjQ4Mw==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                SELECT struct(H AS H, st.pvalue(H, DoF) AS p, DoF AS DoF) FROM H_raw\n          \n          \n            \n                SELECT struct(H AS H, fn.pvalue(H, DoF) AS p, DoF AS DoF) FROM H_raw", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/183#discussion_r573032483", "createdAt": "2021-02-09T16:26:29Z", "author": {"login": "danieldeleo"}, "path": "udfs/statslib/kruskal_wallis.sql", "diffHunk": "@@ -0,0 +1,36 @@\n+/*\n+ * Copyright 2019 Google LLC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+CREATE OR REPLACE FUNCTION fn.kruskal_wallis(data ARRAY<STRUCT<factor STRING, val FLOAT64>>) AS ((\n+    WITH H_raw AS(\n+        WITH sums AS \n+        (\n+            WITH rank_data AS \n+            (\n+                SELECT d.factor AS f, d.val AS v, RANK() OVER(ORDER BY d.val) AS r\n+                FROM UNNEST(data) AS d \n+            ) #rank_data\n+            SELECT     \n+                SUM(r) * (SUM(r) / COUNT(*)) AS sumranks, COUNT(*) AS n\n+            FROM rank_data\n+            GROUP BY f\n+        ) # sums\n+        SELECT 12.00 /(SUM(n) *(SUM(n) + 1)) * SUM(sumranks) -(3.00 *(SUM(n) + 1)) AS H, \n+                      COUNT(n) -1 AS DoF\n+        FROM sums\n+    ) # H_raw\n+    SELECT struct(H AS H, st.pvalue(H, DoF) AS p, DoF AS DoF) FROM H_raw", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2470574dca4ccd2d2d59e11818a6fde5330b652a"}, "originalPosition": 35}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzY2MDU5NTU3OnYy", "diffSide": "RIGHT", "path": "udfs/community/pvalue.sql", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMi0yMlQxNTowNDoyNVrOIpb-Rg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMi0yMlQxNTowNzoyMlrOIpcHvg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU4MDMyMDgzOA==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              return 1.0 - jStat['chisquare'].cdf(H, dof)\n          \n          \n            \n              return 1.0 - jstat.jStat['chisquare'].cdf(H, dof)", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/183#discussion_r580320838", "createdAt": "2021-02-22T15:04:25Z", "author": {"login": "danieldeleo"}, "path": "udfs/community/pvalue.sql", "diffHunk": "@@ -0,0 +1,10 @@\n+#standardSQL\n+\n+CREATE OR REPLACE FUNCTION fn.pvalue(H FLOAT64, dof INT64) \n+RETURNS FLOAT64 \n+LANGUAGE js AS \"\"\"\n+  return 1.0 - jStat['chisquare'].cdf(H, dof)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d4cc03912c5bf0607a6a26b15b408cb8f7d36efb"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU4MDMyMzI2Mg==", "bodyText": "This is the last change and then all tests should pass.", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/183#discussion_r580323262", "createdAt": "2021-02-22T15:07:22Z", "author": {"login": "danieldeleo"}, "path": "udfs/community/pvalue.sql", "diffHunk": "@@ -0,0 +1,10 @@\n+#standardSQL\n+\n+CREATE OR REPLACE FUNCTION fn.pvalue(H FLOAT64, dof INT64) \n+RETURNS FLOAT64 \n+LANGUAGE js AS \"\"\"\n+  return 1.0 - jStat['chisquare'].cdf(H, dof)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU4MDMyMDgzOA=="}, "originalCommit": {"oid": "d4cc03912c5bf0607a6a26b15b408cb8f7d36efb"}, "originalPosition": 6}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzY2MDYxNTc0OnYy", "diffSide": "RIGHT", "path": "BigQueryUtils.code-workspace", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMi0yMlQxNTowODoxNFrOIpcKrQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMi0yMlQxNTowODo0N1rOIpcMpg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU4MDMyNDAxMw==", "bodyText": "remove this file from PR", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/183#discussion_r580324013", "createdAt": "2021-02-22T15:08:14Z", "author": {"login": "danieldeleo"}, "path": "BigQueryUtils.code-workspace", "diffHunk": "@@ -0,0 +1,7 @@\n+{", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d4cc03912c5bf0607a6a26b15b408cb8f7d36efb"}, "originalPosition": 1}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU4MDMyNDUxOA==", "bodyText": "Yes, already done, or at least I tried.", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/183#discussion_r580324518", "createdAt": "2021-02-22T15:08:47Z", "author": {"login": "jrossthomson"}, "path": "BigQueryUtils.code-workspace", "diffHunk": "@@ -0,0 +1,7 @@\n+{", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU4MDMyNDAxMw=="}, "originalCommit": {"oid": "d4cc03912c5bf0607a6a26b15b408cb8f7d36efb"}, "originalPosition": 1}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzY2MDYyMTk0OnYy", "diffSide": "RIGHT", "path": "udfs/community/kruskal_wallis.sql", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMi0yMlQxNTowOTowNFrOIpcOoQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMi0yMlQxNTowOTowNFrOIpcOoQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU4MDMyNTAyNQ==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n             * Copyright 2019 Google LLC\n          \n          \n            \n             * Copyright 2021 Google LLC", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/183#discussion_r580325025", "createdAt": "2021-02-22T15:09:04Z", "author": {"login": "danieldeleo"}, "path": "udfs/community/kruskal_wallis.sql", "diffHunk": "@@ -0,0 +1,36 @@\n+/*\n+ * Copyright 2019 Google LLC", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d4cc03912c5bf0607a6a26b15b408cb8f7d36efb"}, "originalPosition": 2}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzY2MDYyMzAwOnYy", "diffSide": "RIGHT", "path": "udfs/community/linear_regression.sql", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMi0yMlQxNTowOToxNlrOIpcPPg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMi0yMlQxNTowOToxNlrOIpcPPg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU4MDMyNTE4Mg==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n             * Copyright 2019 Google LLC\n          \n          \n            \n             * Copyright 2021 Google LLC", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/183#discussion_r580325182", "createdAt": "2021-02-22T15:09:16Z", "author": {"login": "danieldeleo"}, "path": "udfs/community/linear_regression.sql", "diffHunk": "@@ -0,0 +1,43 @@\n+/*\n+ * Copyright 2019 Google LLC", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d4cc03912c5bf0607a6a26b15b408cb8f7d36efb"}, "originalPosition": 2}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzY2MDYyODg4OnYy", "diffSide": "RIGHT", "path": "udfs/community/linear_regression.sql", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMi0yMlQxNToxMDoxOVrOIpcSsw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMi0yMlQxNToxMDoxOVrOIpcSsw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU4MDMyNjA2Nw==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n             */\n          \n          \n            \n            \n          \n          \n            \n            \n          \n          \n            \n            \n          \n          \n            \n            CREATE OR REPLACE FUNCTION fn.linear_regression(data ARRAY<STRUCT<X FLOAT64, Y FLOAT64>>) \n          \n          \n            \n             */\n          \n          \n            \n            \n          \n          \n            \n            CREATE OR REPLACE FUNCTION fn.linear_regression(data ARRAY<STRUCT<X FLOAT64, Y FLOAT64>>)", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/183#discussion_r580326067", "createdAt": "2021-02-22T15:10:19Z", "author": {"login": "danieldeleo"}, "path": "udfs/community/linear_regression.sql", "diffHunk": "@@ -0,0 +1,43 @@\n+/*\n+ * Copyright 2019 Google LLC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+\n+\n+CREATE OR REPLACE FUNCTION fn.linear_regression(data ARRAY<STRUCT<X FLOAT64, Y FLOAT64>>) ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d4cc03912c5bf0607a6a26b15b408cb8f7d36efb"}, "originalPosition": 19}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzY2MDY5MzExOnYy", "diffSide": "RIGHT", "path": "udfs/community/README.md", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMi0yMlQxNToyMjozMlrOIpc6mA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMi0yMlQxNToyMjozMlrOIpc6mA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU4MDMzNjI4MA==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            This directory contains community contributed [user-defined functions](https://cloud.google.com/bigquery/docs/reference/standard-sql/user-defined-functions) for Statistical Analysis\n          \n          \n            \n            to extend BigQuery for more specialized usage patterns. Each UDF within this\n          \n          \n            \n            directory will be automatically synchronized to the `bqutil` project within the\n          \n          \n            \n            `fn` dataset for reference in queries.\n          \n          \n            \n            This section details the subset of community contributed [user-defined functions](https://cloud.google.com/bigquery/docs/reference/standard-sql/user-defined-functions) \n          \n          \n            \n            that extend BigQuery and enable more specialized Statistical Analysis usage patterns. \n          \n          \n            \n            Each UDF detailed below will be automatically synchronized to the `fn` dataset\n          \n          \n            \n            within the `bqutil` project for reference in your queries.", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/183#discussion_r580336280", "createdAt": "2021-02-22T15:22:32Z", "author": {"login": "danieldeleo"}, "path": "udfs/community/README.md", "diffHunk": "@@ -586,3 +586,61 @@ returns:\n | 4\t| 40 | 6.324555320336759 |\n | 5\t| 50 | 12.649110640673518 |\n \n+\n+<br/>\n+<br/>\n+<br/>\n+\n+# StatsLib: Statistical UDFs\n+\n+This directory contains community contributed [user-defined functions](https://cloud.google.com/bigquery/docs/reference/standard-sql/user-defined-functions) for Statistical Analysis\n+to extend BigQuery for more specialized usage patterns. Each UDF within this\n+directory will be automatically synchronized to the `bqutil` project within the\n+`fn` dataset for reference in queries.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "befd86432b982d363b6e3c9690c35fe412a50388"}, "originalPosition": 14}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzY2MDY5ODEwOnYy", "diffSide": "RIGHT", "path": "udfs/community/README.md", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMi0yMlQxNToyMzozM1rOIpc9zg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMi0yMlQxNToyMzozM1rOIpc9zg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU4MDMzNzEwMg==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            ### [kruskal_wallis(arr(struct(factor STRING, val FLOAT64))](kruskal_wallis.sql)\n          \n          \n            \n            ### [kruskal_wallis(ARRAY(STRUCT(factor STRING, val FLOAT64))](kruskal_wallis.sql)", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/183#discussion_r580337102", "createdAt": "2021-02-22T15:23:33Z", "author": {"login": "danieldeleo"}, "path": "udfs/community/README.md", "diffHunk": "@@ -586,3 +586,61 @@ returns:\n | 4\t| 40 | 6.324555320336759 |\n | 5\t| 50 | 12.649110640673518 |\n \n+\n+<br/>\n+<br/>\n+<br/>\n+\n+# StatsLib: Statistical UDFs\n+\n+This directory contains community contributed [user-defined functions](https://cloud.google.com/bigquery/docs/reference/standard-sql/user-defined-functions) for Statistical Analysis\n+to extend BigQuery for more specialized usage patterns. Each UDF within this\n+directory will be automatically synchronized to the `bqutil` project within the\n+`fn` dataset for reference in queries.\n+\n+For example, if you'd like to reference the `int` function within your query,\n+you can reference it like the following:\n+```sql\n+SELECT bqutil.fn.int(1.684)\n+```\n+\n+## UDFs\n+\n+* [kruskal_wallis](#kruskal_wallisarrstructfactor-string-val-float64)\n+\n+## Documentation\n+\n+### [kruskal_wallis(arr(struct(factor STRING, val FLOAT64))](kruskal_wallis.sql)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "befd86432b982d363b6e3c9690c35fe412a50388"}, "originalPosition": 28}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzY2MDY5OTk5OnYy", "diffSide": "RIGHT", "path": "udfs/community/README.md", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMi0yMlQxNToyMzo1NFrOIpc-9A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMi0yMlQxNToyMzo1NFrOIpc-9A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU4MDMzNzM5Ng==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            set data = [\n          \n          \n            \n            SET data = [", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/183#discussion_r580337396", "createdAt": "2021-02-22T15:23:54Z", "author": {"login": "danieldeleo"}, "path": "udfs/community/README.md", "diffHunk": "@@ -586,3 +586,61 @@ returns:\n | 4\t| 40 | 6.324555320336759 |\n | 5\t| 50 | 12.649110640673518 |\n \n+\n+<br/>\n+<br/>\n+<br/>\n+\n+# StatsLib: Statistical UDFs\n+\n+This directory contains community contributed [user-defined functions](https://cloud.google.com/bigquery/docs/reference/standard-sql/user-defined-functions) for Statistical Analysis\n+to extend BigQuery for more specialized usage patterns. Each UDF within this\n+directory will be automatically synchronized to the `bqutil` project within the\n+`fn` dataset for reference in queries.\n+\n+For example, if you'd like to reference the `int` function within your query,\n+you can reference it like the following:\n+```sql\n+SELECT bqutil.fn.int(1.684)\n+```\n+\n+## UDFs\n+\n+* [kruskal_wallis](#kruskal_wallisarrstructfactor-string-val-float64)\n+\n+## Documentation\n+\n+### [kruskal_wallis(arr(struct(factor STRING, val FLOAT64))](kruskal_wallis.sql)\n+Takes an array of struct where each struct (point) represents a measurement, with a group label and a measurement value\n+\n+The [Kruskal\u2013Wallis test by ranks](https://en.wikipedia.org/wiki/Kruskal%E2%80%93Wallis_one-way_analysis_of_variance), Kruskal\u2013Wallis H test (named after William Kruskal and W. Allen Wallis), or one-way ANOVA on ranks is a non-parametric method for testing whether samples originate from the same distribution. It is used for comparing two or more independent samples of equal or different sample sizes. It extends the Mann\u2013Whitney U test, which is used for comparing only two groups. The parametric equivalent of the Kruskal\u2013Wallis test is the one-way analysis of variance (ANOVA).\n+\n+* Input: array: struct <factor STRING, val FLOAT64>\n+* Output: struct<H FLOAT64, p-value FLOAT64, DOF FLOAT64>\n+```sql\n+DECLARE data ARRAY<STRUCT<factor STRING, val FLOAT64>>;\n+\n+set data = [", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "befd86432b982d363b6e3c9690c35fe412a50388"}, "originalPosition": 38}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzY2MDcwMTMyOnYy", "diffSide": "RIGHT", "path": "udfs/community/README.md", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMi0yMlQxNToyNDowOFrOIpc_uw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMi0yMlQxNToyNDowOFrOIpc_uw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU4MDMzNzU5NQ==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            SELECT `lib_stats.kruskal_wallis`(data) as results;\n          \n          \n            \n            SELECT `lib_stats.kruskal_wallis`(data) AS results;", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/183#discussion_r580337595", "createdAt": "2021-02-22T15:24:08Z", "author": {"login": "danieldeleo"}, "path": "udfs/community/README.md", "diffHunk": "@@ -586,3 +586,61 @@ returns:\n | 4\t| 40 | 6.324555320336759 |\n | 5\t| 50 | 12.649110640673518 |\n \n+\n+<br/>\n+<br/>\n+<br/>\n+\n+# StatsLib: Statistical UDFs\n+\n+This directory contains community contributed [user-defined functions](https://cloud.google.com/bigquery/docs/reference/standard-sql/user-defined-functions) for Statistical Analysis\n+to extend BigQuery for more specialized usage patterns. Each UDF within this\n+directory will be automatically synchronized to the `bqutil` project within the\n+`fn` dataset for reference in queries.\n+\n+For example, if you'd like to reference the `int` function within your query,\n+you can reference it like the following:\n+```sql\n+SELECT bqutil.fn.int(1.684)\n+```\n+\n+## UDFs\n+\n+* [kruskal_wallis](#kruskal_wallisarrstructfactor-string-val-float64)\n+\n+## Documentation\n+\n+### [kruskal_wallis(arr(struct(factor STRING, val FLOAT64))](kruskal_wallis.sql)\n+Takes an array of struct where each struct (point) represents a measurement, with a group label and a measurement value\n+\n+The [Kruskal\u2013Wallis test by ranks](https://en.wikipedia.org/wiki/Kruskal%E2%80%93Wallis_one-way_analysis_of_variance), Kruskal\u2013Wallis H test (named after William Kruskal and W. Allen Wallis), or one-way ANOVA on ranks is a non-parametric method for testing whether samples originate from the same distribution. It is used for comparing two or more independent samples of equal or different sample sizes. It extends the Mann\u2013Whitney U test, which is used for comparing only two groups. The parametric equivalent of the Kruskal\u2013Wallis test is the one-way analysis of variance (ANOVA).\n+\n+* Input: array: struct <factor STRING, val FLOAT64>\n+* Output: struct<H FLOAT64, p-value FLOAT64, DOF FLOAT64>\n+```sql\n+DECLARE data ARRAY<STRUCT<factor STRING, val FLOAT64>>;\n+\n+set data = [\n+('a',1.0),\n+('b',2.0),\n+('c',2.3),\n+('a',1.4),\n+('b',2.2),\n+('c',5.5),\n+('a',1.0),\n+('b',2.3),\n+('c',2.3),\n+('a',1.1),\n+('b',7.2),\n+('c',2.8)\n+];\n+\n+\n+SELECT `lib_stats.kruskal_wallis`(data) as results;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "befd86432b982d363b6e3c9690c35fe412a50388"}, "originalPosition": 54}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzY2MDczMDkxOnYy", "diffSide": "RIGHT", "path": "udfs/community/README.md", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMi0yMlQxNToyOToyM1rOIpdRlw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMi0yNVQxNjowODoxMlrOIr9K4A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU4MDM0MjE2Nw==", "bodyText": "linear_regression and pvalue UDFs must also be added to README.\nPlease add all new UDFs to the top UDFs list as well, but have them link down to their descriptions in the new statslib section you created.", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/183#discussion_r580342167", "createdAt": "2021-02-22T15:29:23Z", "author": {"login": "danieldeleo"}, "path": "udfs/community/README.md", "diffHunk": "@@ -586,3 +586,61 @@ returns:\n | 4\t| 40 | 6.324555320336759 |\n | 5\t| 50 | 12.649110640673518 |\n \n+\n+<br/>\n+<br/>\n+<br/>\n+\n+# StatsLib: Statistical UDFs\n+\n+This section details the subset of community contributed [user-defined functions](https://cloud.google.com/bigquery/docs/reference/standard-sql/user-defined-functions) \n+that extend BigQuery and enable more specialized Statistical Analysis usage patterns. \n+Each UDF detailed below will be automatically synchronized to the `fn` dataset\n+within the `bqutil` project for reference in your queries.\n+\n+For example, if you'd like to reference the `int` function within your query,\n+you can reference it like the following:\n+```sql\n+SELECT bqutil.fn.int(1.684)\n+```\n+\n+## UDFs\n+\n+* [kruskal_wallis](#kruskal_wallisarrstructfactor-string-val-float64)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bd0c6dd1d9442b1cd73b8fb3300ac2cd8b74a094"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU4Mjk2MTg4OA==", "bodyText": "Done.", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/183#discussion_r582961888", "createdAt": "2021-02-25T16:08:12Z", "author": {"login": "jrossthomson"}, "path": "udfs/community/README.md", "diffHunk": "@@ -586,3 +586,61 @@ returns:\n | 4\t| 40 | 6.324555320336759 |\n | 5\t| 50 | 12.649110640673518 |\n \n+\n+<br/>\n+<br/>\n+<br/>\n+\n+# StatsLib: Statistical UDFs\n+\n+This section details the subset of community contributed [user-defined functions](https://cloud.google.com/bigquery/docs/reference/standard-sql/user-defined-functions) \n+that extend BigQuery and enable more specialized Statistical Analysis usage patterns. \n+Each UDF detailed below will be automatically synchronized to the `fn` dataset\n+within the `bqutil` project for reference in your queries.\n+\n+For example, if you'd like to reference the `int` function within your query,\n+you can reference it like the following:\n+```sql\n+SELECT bqutil.fn.int(1.684)\n+```\n+\n+## UDFs\n+\n+* [kruskal_wallis](#kruskal_wallisarrstructfactor-string-val-float64)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU4MDM0MjE2Nw=="}, "originalCommit": {"oid": "bd0c6dd1d9442b1cd73b8fb3300ac2cd8b74a094"}, "originalPosition": 24}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzY3MTMwMDc0OnYy", "diffSide": "RIGHT", "path": "udfs/community/test_cases.yaml", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMi0yNFQxNDoxMjoyNFrOIrB5fg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMi0yNFQxNDoxMjoyNFrOIrB5fg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU4MTk5MDc4Mg==", "bodyText": "Add trailing newline", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/183#discussion_r581990782", "createdAt": "2021-02-24T14:12:24Z", "author": {"login": "danieldeleo"}, "path": "udfs/community/test_cases.yaml", "diffHunk": "@@ -389,3 +389,18 @@ nlp_compromise_people:\n   - test:\n     input: CAST(\"Randal Kieth Orton and Dwayne 'the rock' Johnson had a really funny fight.\" AS STRING)\n     expected_output: CAST(['randal kieth orton', 'dwayne the rock johnson'] AS ARRAY<STRING>)\n+#\n+# Below targets StatsLib work\n+#\n+pvalue:\n+  - test:\n+    input: CAST(0.3 AS FLOAT64), CAST(2 AS INT64)\n+    expected_output: CAST(0.8607079764250578 AS FLOAT64)\n+kruskal_wallis:\n+  - test:\n+    input: (SELECT [('a',1.0), ('b',2.0), ('c',2.3), ('a',1.4), ('b',2.2), ('c',5.5), ('a',1.0), ('b',2.3), ('c',2.3), ('a',1.1), ('b',7.2), ('c',2.8)])\n+    expected_output: STRUCT(CAST(3.423076923076927 AS FLOAT64) AS H, CAST( 0.1805877514841956 AS FLOAT64) AS p, CAST(2 AS INT64) AS DoF)\n+linear_regression:\n+  - test:\n+    input: (SELECT [ (5.1,2.5), (5.0,2.0), (5.7,2.6), (6.0,2.2), (5.8,2.6), (5.5,2.3), (6.1,2.8), (5.5,2.5), (6.4,3.2), (5.6,3.0)])\n+    expected_output: STRUCT(CAST(-0.4353361094588436 AS FLOAT64) AS a, CAST( 0.5300416418798544 AS FLOAT64) AS b, CAST(0.632366563565354 AS FLOAT64) AS r)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bd0c6dd1d9442b1cd73b8fb3300ac2cd8b74a094"}, "originalPosition": 18}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2908, "cost": 1, "resetAt": "2021-11-12T19:05:54Z"}}}