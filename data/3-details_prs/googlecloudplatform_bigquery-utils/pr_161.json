{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDcxOTIyNzE3", "number": 161, "title": "Query_Breakdown: New Query Breaking Down Logic Implemented, Multi-line deletion implemented, Replacement Logic randomized", "bodyText": "New Query-Breaking Down Logic\n\nTo optimize for runtime, I decided to modify the design and create a separate tree for each query rather than for the entire document. I do this by creating a new QueryBreakdown instance as well as a new LocationTracker instance for each query. The queries are broken down during input parsing.\nLocation tracking was very difficult, but it was fixed by implementing a pair design where it is a double arraylist of pairs that denote the original position. By doing so, we were able to maintain the original mappings despite breaking down the queries. (We could do this internally by keeping a localLine field)\nThe way we output has also changed: now, we return a list of nodes and aggregate them accordingly in the main function to output the final result.\nAll the tests have been modified to serve this new design\n\nMulti-line Deletion\n\nA major design flaw has been discovered, which is that errors do not always occur on the same line. This assumption changed up the deletion mechanism design as well as the location-tracking design.\nThere were numerous edge cases that had implications for location-tracking, such as the case where there were middle lines, the endline was all deleted, the first line was all deleted, etc. The hardest thing was that new line characters would be deleted as well, messing up the location tracking mechanism. This was dealt with and tested.\n\nReplacement logic randomized, misc. bugs fixed\n\nThe replacement logic was re-written to be randomized instead of choosing the first three.\nOther issues were dealt with for stabilization, such as having no replacement options, there being a  token at the end of the file, etc.", "createdAt": "2020-08-22T02:26:38Z", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/161", "merged": true, "mergeCommit": {"oid": "e06e7ca349f972c3e4a7561d2457938665c0fc40"}, "closed": true, "closedAt": "2020-08-25T21:31:28Z", "author": {"login": "subinbean"}, "timelineItems": {"totalCount": 36, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc8T6wrgH2gAyNDcxOTIyNzE3OjQ3ZmIyZGQ3MzFkOGM3MWU4YzRiMTNmNjgwMTMxNDRhNzY0OWNjYWU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdCM448gH2gAyNDcxOTIyNzE3OjI5NjVhNDZmYTUyYWEwOTZhMDgxMTI5Zjg5YzJhN2QzZTMzN2NhYTk=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "47fb2dd731d8c71e8c4b13f68013144a7649ccae", "author": {"user": {"login": "subinbean", "name": "Subin Lee"}}, "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/47fb2dd731d8c71e8c4b13f68013144a7649ccae", "committedDate": "2020-08-06T18:13:55Z", "message": "query_breakdown locationtracker now works with replacement"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2a6891f58d9a0a03b8b9eaecaa5327f9c7d4eec3", "author": {"user": {"login": "subinbean", "name": "Subin Lee"}}, "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/2a6891f58d9a0a03b8b9eaecaa5327f9c7d4eec3", "committedDate": "2020-08-06T18:38:48Z", "message": "stack now works to rearrange output order"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c0d19792754f5177368bacf2c55a75a5d4596678", "author": {"user": {"login": "subinbean", "name": "Subin Lee"}}, "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/c0d19792754f5177368bacf2c55a75a5d4596678", "committedDate": "2020-08-06T18:57:59Z", "message": "test case for deletion and replacement at the same time added"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9b61ddfd58872dfa15216cc9081d4b13625b407f", "author": {"user": {"login": "subinbean", "name": "Subin Lee"}}, "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/9b61ddfd58872dfa15216cc9081d4b13625b407f", "committedDate": "2020-08-07T19:57:40Z", "message": "json flag added as well as variable programmed"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "23d74ba6069588f7872edf9aaccf5554752120c6", "author": {"user": {"login": "subinbean", "name": "Subin Lee"}}, "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/23d74ba6069588f7872edf9aaccf5554752120c6", "committedDate": "2020-08-08T00:02:06Z", "message": "added json support"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e2b01b2974c41063a72be65ce740109e8e9081a6", "author": {"user": {"login": "subinbean", "name": "Subin Lee"}}, "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/e2b01b2974c41063a72be65ce740109e8e9081a6", "committedDate": "2020-08-08T00:21:26Z", "message": "works as a stand-alone jar file now"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "01553a8c80f0d1534bf127d41acda6be31637325", "author": {"user": {"login": "subinbean", "name": "Subin Lee"}}, "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/01553a8c80f0d1534bf127d41acda6be31637325", "committedDate": "2020-08-08T01:40:59Z", "message": "Merge branch 'master' into milestone3_1"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "feb8a2f20f36a6807706d4e5c4e6614547439ded", "author": {"user": {"login": "subinbean", "name": "Subin Lee"}}, "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/feb8a2f20f36a6807706d4e5c4e6614547439ded", "committedDate": "2020-08-10T20:43:20Z", "message": "created query_breakdown_runner.ts"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1b2f48263a2a9a2e4e19cc73847b4395f2c3ad2a", "author": {"user": {"login": "subinbean", "name": "Subin Lee"}}, "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/1b2f48263a2a9a2e4e19cc73847b4395f2c3ad2a", "committedDate": "2020-08-10T22:35:27Z", "message": "query breakdown runner sketched"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "acb043fc61f541bd846e645df84c4219a4f0c215", "author": {"user": {"login": "subinbean", "name": "Subin Lee"}}, "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/acb043fc61f541bd846e645df84c4219a4f0c215", "committedDate": "2020-08-11T19:18:38Z", "message": "methods sketched"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b1cde39f3c6d666cf44dc64f6a2f5187ed423db5", "author": {"user": {"login": "subinbean", "name": "Subin Lee"}}, "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/b1cde39f3c6d666cf44dc64f6a2f5187ed423db5", "committedDate": "2020-08-11T19:19:07Z", "message": "result json file sketched"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a6dbb8ea4a81643af8785045b849a843a226d61e", "author": {"user": {"login": "subinbean", "name": "Subin Lee"}}, "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/a6dbb8ea4a81643af8785045b849a843a226d61e", "committedDate": "2020-08-11T19:51:35Z", "message": "resultJson integrated"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "88a811d7eae4a15eea543fb24ddfadbc7b242d81", "author": {"user": {"login": "subinbean", "name": "Subin Lee"}}, "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/88a811d7eae4a15eea543fb24ddfadbc7b242d81", "committedDate": "2020-08-11T21:55:44Z", "message": "debugging-1"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "306b21633cbc6fac9e794ab763a66b63c3628114", "author": {"user": {"login": "subinbean", "name": "Subin Lee"}}, "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/306b21633cbc6fac9e794ab763a66b63c3628114", "committedDate": "2020-08-12T00:17:53Z", "message": "integration is now finished and working!"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "25c92eae4bed225450b0878bcb243d1a512a5bf2", "author": {"user": {"login": "subinbean", "name": "Subin Lee"}}, "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/25c92eae4bed225450b0878bcb243d1a512a5bf2", "committedDate": "2020-08-12T18:51:15Z", "message": "merge conflicts resolved"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "751716ca54416ef54ba970e83eb373ecb62b7dd0", "author": {"user": {"login": "subinbean", "name": "Subin Lee"}}, "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/751716ca54416ef54ba970e83eb373ecb62b7dd0", "committedDate": "2020-08-12T20:51:15Z", "message": "code cleaned up for pull request"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "39fc0a035d3b1089dedf006e1af3c68d5d907cf9", "author": {"user": {"login": "subinbean", "name": "Subin Lee"}}, "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/39fc0a035d3b1089dedf006e1af3c68d5d907cf9", "committedDate": "2020-08-13T20:52:27Z", "message": "new line EOF bug fixed"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f3c7985b8879cbf92434c4511fe1947d3b32c4ff", "author": {"user": {"login": "subinbean", "name": "Subin Lee"}}, "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/f3c7985b8879cbf92434c4511fe1947d3b32c4ff", "committedDate": "2020-08-14T21:50:49Z", "message": "empty and singleton files EOF are now supported"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "67dd0008879a5cb5945fd8d9ee219c08d79dc80d", "author": {"user": {"login": "subinbean", "name": "Subin Lee"}}, "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/67dd0008879a5cb5945fd8d9ee219c08d79dc80d", "committedDate": "2020-08-17T22:16:07Z", "message": "fixed bugs for EOF, no options, bracket options"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "94b44f3581380c0fa3084a6b07c5abc30bd80d31", "author": {"user": {"login": "subinbean", "name": "Subin Lee"}}, "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/94b44f3581380c0fa3084a6b07c5abc30bd80d31", "committedDate": "2020-08-18T19:43:24Z", "message": "multiple line deletion finished"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dd4478cda33204cff4d79450fd0d24f76eaa7aa1", "author": {"user": {"login": "subinbean", "name": "Subin Lee"}}, "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/dd4478cda33204cff4d79450fd0d24f76eaa7aa1", "committedDate": "2020-08-19T17:52:35Z", "message": "added pair class, began changing locationtracker to pair"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "aa52a7f2b3bddcdcd35eb498786040702d1f5f98", "author": {"user": {"login": "subinbean", "name": "Subin Lee"}}, "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/aa52a7f2b3bddcdcd35eb498786040702d1f5f98", "committedDate": "2020-08-19T19:07:49Z", "message": "location tracking now works with multi-line deletion"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0b4ec37b878e492b3bc4cdbc2ec3fe9776135249", "author": {"user": {"login": "subinbean", "name": "Subin Lee"}}, "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/0b4ec37b878e492b3bc4cdbc2ec3fe9776135249", "committedDate": "2020-08-20T03:04:16Z", "message": "input reader new design sketched"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "87b46ec71ca4e7f66a828657a6262aa499d291a6", "author": {"user": {"login": "subinbean", "name": "Subin Lee"}}, "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/87b46ec71ca4e7f66a828657a6262aa499d291a6", "committedDate": "2020-08-20T03:27:00Z", "message": "Revert \"input reader new design sketched\"\n\nThis reverts commit 0b4ec37b878e492b3bc4cdbc2ec3fe9776135249."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4f51d8dff2cf2e65ef955fb1e4ff68dcab571447", "author": {"user": {"login": "subinbean", "name": "Subin Lee"}}, "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/4f51d8dff2cf2e65ef955fb1e4ff68dcab571447", "committedDate": "2020-08-20T04:21:56Z", "message": "revert merge conflict resolved"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1810442a1c66be16f9be5340dac3ede4b171f492", "author": {"user": {"login": "subinbean", "name": "Subin Lee"}}, "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/1810442a1c66be16f9be5340dac3ede4b171f492", "committedDate": "2020-08-21T03:05:13Z", "message": "input reader location tracking design complete"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9ae7661086f959c942b21b5bf17de400a0a7afb1", "author": {"user": {"login": "subinbean", "name": "Subin Lee"}}, "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/9ae7661086f959c942b21b5bf17de400a0a7afb1", "committedDate": "2020-08-21T05:07:53Z", "message": "location tracker draft"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a5cdeff39dbf92b7466f83fce636314ff4e82ca3", "author": {"user": {"login": "subinbean", "name": "Subin Lee"}}, "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/a5cdeff39dbf92b7466f83fce636314ff4e82ca3", "committedDate": "2020-08-21T19:14:08Z", "message": "location tracking tests pass"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "308a238861d32e013b50dc7f0a21f2e75d705e0b", "author": {"user": {"login": "subinbean", "name": "Subin Lee"}}, "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/308a238861d32e013b50dc7f0a21f2e75d705e0b", "committedDate": "2020-08-21T20:53:03Z", "message": "output redesign sketched"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c91455cec54e2e12c0c99c510e65e7535668c442", "author": {"user": {"login": "subinbean", "name": "Subin Lee"}}, "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/c91455cec54e2e12c0c99c510e65e7535668c442", "committedDate": "2020-08-21T20:58:10Z", "message": "merge conflicts fixed"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "22ecca1684d4b15f4fd9f10850b788886977e603", "author": {"user": {"login": "subinbean", "name": "Subin Lee"}}, "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/22ecca1684d4b15f4fd9f10850b788886977e603", "committedDate": "2020-08-22T00:47:52Z", "message": "query breakdown tests now all pass"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6a96ab4e20c67af1adb791ba3c791e05505f725d", "author": {"user": {"login": "subinbean", "name": "Subin Lee"}}, "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/6a96ab4e20c67af1adb791ba3c791e05505f725d", "committedDate": "2020-08-22T02:08:45Z", "message": "code cleaned-up and documentation added for PR"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDczOTY4NTQ4", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/161#pullrequestreview-473968548", "createdAt": "2020-08-24T22:55:42Z", "commit": {"oid": "6a96ab4e20c67af1adb791ba3c791e05505f725d"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNFQyMjo1NTo0MlrOHF4_1g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNFQyMjo1NTo0MlrOHF4_1g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTkzODc3NA==", "bodyText": "Please add a comment to explain what's the purpose of n.", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/161#discussion_r475938774", "createdAt": "2020-08-24T22:55:42Z", "author": {"login": "feiling"}, "path": "tools/query_breakdown/src/main/java/com/google/bigquery/ReplacementLogic.java", "diffHunk": "@@ -9,23 +10,50 @@\n \n   /**\n    * Given a component, provides a recommendation as to which component the input should be\n-   * replaced with. Returns a list of components that it recommends.\n+   * replaced with. Returns a list of components that it recommends. The default method of\n+   * choosing recommendations is through randomization.\n    *\n    * We choose ArrayLists as the data structure because we want to impose a certain ordering\n    * with the recommendations: certain recommendations should be \"better\" than others\n+   *\n+   * n is an integer that controls the number of replacement options\n    */\n   public static ArrayList<String> replace (String component, ArrayList<String> options) {\n-    // simply returns the first n options", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6a96ab4e20c67af1adb791ba3c791e05505f725d"}, "originalPosition": 22}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDczOTc2NDEz", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/161#pullrequestreview-473976413", "createdAt": "2020-08-24T22:59:58Z", "commit": {"oid": "6a96ab4e20c67af1adb791ba3c791e05505f725d"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNFQyMjo1OTo1OFrOHF5Flw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNFQyMjo1OTo1OFrOHF5Flw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTk0MDI0Nw==", "bodyText": "You should use Random.nextInt() (https://docs.oracle.com/javase/8/docs/api/java/util/Random.html#nextInt--)", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/161#discussion_r475940247", "createdAt": "2020-08-24T22:59:58Z", "author": {"login": "feiling"}, "path": "tools/query_breakdown/src/main/java/com/google/bigquery/ReplacementLogic.java", "diffHunk": "@@ -9,23 +10,50 @@\n \n   /**\n    * Given a component, provides a recommendation as to which component the input should be\n-   * replaced with. Returns a list of components that it recommends.\n+   * replaced with. Returns a list of components that it recommends. The default method of\n+   * choosing recommendations is through randomization.\n    *\n    * We choose ArrayLists as the data structure because we want to impose a certain ordering\n    * with the recommendations: certain recommendations should be \"better\" than others\n+   *\n+   * n is an integer that controls the number of replacement options\n    */\n   public static ArrayList<String> replace (String component, ArrayList<String> options) {\n-    // simply returns the first n options\n     int n = 3;\n \n+    ArrayList<String> result = new ArrayList<>();\n+\n     if (options.size() <= n) {\n-      return new ArrayList<>(options);\n+      for (int i = 0; i < options.size(); i++) {\n+        // gets rid of cases such as <QUOTED_STRING>\n+        if (options.get(i).charAt(0) != '<' || options.get(i).length() <= 1) {\n+          result.add(options.get(i));\n+        }\n+      }\n+      return result;\n     }\n \n-    ArrayList<String> result = new ArrayList<>();\n-    for (int i = 0; i < n; i++) {\n-      result.add(options.get(i));\n+    HashSet<Integer> seen = new HashSet<>();\n+    // randomly populate result until full\n+    while (result.size() < n && seen.size() < options.size()) {\n+      int random = randomNumber(options.size() - 1);\n+      if (seen.contains(random)) {\n+        continue;\n+      }\n+      else if (options.get(random).charAt(0) == '<' && options.get(random).length() > 1) {\n+        seen.add(random);\n+        continue;\n+      }\n+      else {\n+        result.add(options.get(random));\n+        seen.add(random);\n+      }\n     }\n     return result;\n   }\n+\n+  // helper function that returns a random integer between 0 - n\n+  private static int randomNumber(int n) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6a96ab4e20c67af1adb791ba3c791e05505f725d"}, "originalPosition": 61}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDczOTgwODk0", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/161#pullrequestreview-473980894", "createdAt": "2020-08-24T23:02:31Z", "commit": {"oid": "6a96ab4e20c67af1adb791ba3c791e05505f725d"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2965a46fa52aa096a081129f89c2a7d3e337caa9", "author": {"user": {"login": "subinbean", "name": "Subin Lee"}}, "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/2965a46fa52aa096a081129f89c2a7d3e337caa9", "committedDate": "2020-08-25T01:26:05Z", "message": "random generator added"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 515, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}