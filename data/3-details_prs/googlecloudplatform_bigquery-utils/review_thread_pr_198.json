{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTI2NjQzODE3", "number": 198, "reviewThreads": {"totalCount": 18, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNFQxODowNTo0N1rOE83Bnw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNFQxODoyNDo0NlrOE83gZA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMyMjUxNTUxOnYy", "diffSide": "RIGHT", "path": "udfs/community/linear_interpolate.sql", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNFQxODowNTo0N1rOH5PBfA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNFQxODowNTo0N1rOH5PBfA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTc3NzAyMA==", "bodyText": "Newline to end file", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/198#discussion_r529777020", "createdAt": "2020-11-24T18:05:47Z", "author": {"login": "ryanmcdowell"}, "path": "udfs/community/linear_interpolate.sql", "diffHunk": "@@ -0,0 +1,26 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+CREATE OR REPLACE function fn.linear_interpolate(\n+    pos INT64, prev STRUCT<x INT64,y FLOAT64>, next STRUCT<x INT64,y FLOAT64>)\n+AS (\n+CASE\n+  WHEN pos IS NULL OR prev IS NULL OR next IS NULL THEN null\n+  ELSE\n+  --y = m * x + b\n+  (next.y - prev.y)/(next.x - prev.x) * (pos - prev.x) + prev.y\n+END\n+);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2ccad989b8953c1553f04b7d319c9dcacf392dd9"}, "originalPosition": 26}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMyMjUxNTc3OnYy", "diffSide": "RIGHT", "path": "udfs/community/ts_gen_keyed_timestamps.sql", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNFQxODowNTo1MlrOH5PBpg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNFQxODowNTo1MlrOH5PBpg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTc3NzA2Mg==", "bodyText": "Newline to end file", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/198#discussion_r529777062", "createdAt": "2020-11-24T18:05:52Z", "author": {"login": "ryanmcdowell"}, "path": "udfs/community/ts_gen_keyed_timestamps.sql", "diffHunk": "@@ -0,0 +1,39 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+/*\n+* Generate an array of key-timestamp structs with the specified min, max and interval timeseries\n+* Expected Usage:\n+* SELECT *\n+* FROM UNNEST(bqutil.fn.ts_gen_keyed_timestamp(['abc'], 900, '2020-01-01', '2020-01-02') a\n+* LEFT JOIN dataset.table ON a.series_key = a.key AND a.tumble_val = b.timestamp\n+*/\n+CREATE OR REPLACE FUNCTION fn.ts_gen_keyed_timestamps(\n+    keys ARRAY<STRING>, tumble_seconds INT64, min_ts TIMESTAMP, max_ts Timestamp)\n+AS ((\n+ SELECT ARRAY_AGG(x)\n+ FROM (\n+   SELECT series_key, tumble_val\n+   FROM UNNEST(\n+     GENERATE_TIMESTAMP_ARRAY(\n+       bqutil.fn.ts_tumble(min_ts, tumble_seconds),\n+       bqutil.fn.ts_tumble(max_ts, tumble_seconds),\n+       INTERVAL tumble_seconds SECOND\n+     )\n+   ) AS tumble_val\n+   CROSS JOIN UNNEST(keys) AS series_key\n+ ) x\n+));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2ccad989b8953c1553f04b7d319c9dcacf392dd9"}, "originalPosition": 39}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMyMjUxNjA4OnYy", "diffSide": "RIGHT", "path": "udfs/community/ts_interpolate_lin_interpolate.sql", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNFQxODowNTo1N1rOH5PB1Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNFQxODowNTo1N1rOH5PB1Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTc3NzEwOQ==", "bodyText": "Newline to end file", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/198#discussion_r529777109", "createdAt": "2020-11-24T18:05:57Z", "author": {"login": "ryanmcdowell"}, "path": "udfs/community/ts_interpolate_lin_interpolate.sql", "diffHunk": "@@ -0,0 +1,64 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+/*\n+* wrap fn.linear_interpolate to handle time series interpolation\n+* \n+* Example usage: use value if exists, otherwise attempt linear interpolation, else fill with zero\n+* \n+* WITH tbl AS (\n+*   SELECT 'abc' key, CAST('2021-01-01' AS TIMESTAMP) ts, 1 value, STRUCT(CAST('2021-01-01' AS TIMESTAMP) AS x, 1 AS y) coord\n+*   UNION ALL\n+*   SELECT 'abc', CAST('2021-01-02' AS TIMESTAMP), null, null\n+*   UNION ALL\n+*   SELECT 'abc', CAST('2021-01-03' AS TIMESTAMP), 3, STRUCT(CAST('2021-01-03' AS TIMESTAMP) AS x, 3 AS y)\n+*   UNION ALL\n+*   SELECT 'abc', CAST('2021-01-04' AS TIMESTAMP), null, null\n+* )\n+* SELECT \n+*   *,\n+*   COALESCE(coord.y,\n+*     fn.ts_lin_interpolate(\n+*       ts,\n+*       LAST_VALUE(coord IGNORE NULLS)\n+*         OVER (PARTITION BY key\n+*           ORDER BY unix_seconds(ts) ASC\n+*           RANGE BETWEEN UNBOUNDED PRECEDING AND 1 PRECEDING),\n+*       FIRST_VALUE(coord IGNORE NULLS)\n+*         OVER (PARTITION BY key\n+*           ORDER BY unix_seconds(ts) ASC\n+*           RANGE BETWEEN 1 FOLLOWING AND UNBOUNDED FOLLOWING)\n+*       ),\n+*       0\n+*   ) AS intrp\n+* FROM tbl\n+*/\n+\n+CREATE OR REPLACE FUNCTION fn.ts_lin_interpolate(\n+        pos TIMESTAMP,\n+        prev STRUCT<x TIMESTAMP, y FLOAT64>,\n+        next STRUCT<x TIMESTAMP, y FLOAT64>)\n+AS (\n+ CASE\n+    WHEN pos IS NULL OR prev IS NULL or next IS NULL THEN null\n+    ELSE\n+        bqutil.fn.linear_interpolate(\n+            unix_seconds(pos),\n+            STRUCT(unix_seconds(prev.x) AS x, prev.y AS y),\n+            STRUCT(unix_seconds(next.x) AS x, next.y AS y)\n+        )\n+ END\n+);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2ccad989b8953c1553f04b7d319c9dcacf392dd9"}, "originalPosition": 64}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMyMjUxNjUxOnYy", "diffSide": "RIGHT", "path": "udfs/community/ts_tumble.sql", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNFQxODowNjowMlrOH5PCDg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNFQxODowNjowMlrOH5PCDg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTc3NzE2Ng==", "bodyText": "Newline to end file", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/198#discussion_r529777166", "createdAt": "2020-11-24T18:06:02Z", "author": {"login": "ryanmcdowell"}, "path": "udfs/community/ts_tumble.sql", "diffHunk": "@@ -0,0 +1,22 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+--divides a timestamp into a [tumble window](https://cloud.google.com/dataflow/docs/reference/sql/streaming-extensions#tumble)\n+--specified in seconds \n+CREATE OR REPLACE FUNCTION fn.ts_tumble(val TIMESTAMP, tumble_seconds INT64)\n+AS (\n+ timestamp_seconds(div(unix_seconds(val), tumble_seconds) *  tumble_seconds))\n+);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2ccad989b8953c1553f04b7d319c9dcacf392dd9"}, "originalPosition": 22}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMyMjUzMjAzOnYy", "diffSide": "RIGHT", "path": "udfs/community/linear_interpolate.sql", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNFQxODowOTo1MlrOH5PLOw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNFQxODowOTo1MlrOH5PLOw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTc3OTUxNQ==", "bodyText": "Indent by 2 within AS block", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/198#discussion_r529779515", "createdAt": "2020-11-24T18:09:52Z", "author": {"login": "ryanmcdowell"}, "path": "udfs/community/linear_interpolate.sql", "diffHunk": "@@ -0,0 +1,26 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+CREATE OR REPLACE function fn.linear_interpolate(\n+    pos INT64, prev STRUCT<x INT64,y FLOAT64>, next STRUCT<x INT64,y FLOAT64>)\n+AS (\n+CASE\n+  WHEN pos IS NULL OR prev IS NULL OR next IS NULL THEN null\n+  ELSE\n+  --y = m * x + b\n+  (next.y - prev.y)/(next.x - prev.x) * (pos - prev.x) + prev.y\n+END", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2ccad989b8953c1553f04b7d319c9dcacf392dd9"}, "originalPosition": 25}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMyMjU0MDI4OnYy", "diffSide": "RIGHT", "path": "udfs/community/linear_interpolate.sql", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNFQxODoxMTo1MVrOH5PP_w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNFQxODoxMTo1MVrOH5PP_w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTc4MDczNQ==", "bodyText": "Add a space on each side of the division operator", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/198#discussion_r529780735", "createdAt": "2020-11-24T18:11:51Z", "author": {"login": "ryanmcdowell"}, "path": "udfs/community/linear_interpolate.sql", "diffHunk": "@@ -0,0 +1,26 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+CREATE OR REPLACE function fn.linear_interpolate(\n+    pos INT64, prev STRUCT<x INT64,y FLOAT64>, next STRUCT<x INT64,y FLOAT64>)\n+AS (\n+CASE\n+  WHEN pos IS NULL OR prev IS NULL OR next IS NULL THEN null\n+  ELSE\n+  --y = m * x + b\n+  (next.y - prev.y)/(next.x - prev.x) * (pos - prev.x) + prev.y", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2ccad989b8953c1553f04b7d319c9dcacf392dd9"}, "originalPosition": 24}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMyMjU0MTU0OnYy", "diffSide": "RIGHT", "path": "udfs/community/linear_interpolate.sql", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNFQxODoxMjoxMlrOH5PQyA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNFQxODoxMjoxMlrOH5PQyA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTc4MDkzNg==", "bodyText": "Capitalize the last null", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/198#discussion_r529780936", "createdAt": "2020-11-24T18:12:12Z", "author": {"login": "ryanmcdowell"}, "path": "udfs/community/linear_interpolate.sql", "diffHunk": "@@ -0,0 +1,26 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+CREATE OR REPLACE function fn.linear_interpolate(\n+    pos INT64, prev STRUCT<x INT64,y FLOAT64>, next STRUCT<x INT64,y FLOAT64>)\n+AS (\n+CASE\n+  WHEN pos IS NULL OR prev IS NULL OR next IS NULL THEN null", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2ccad989b8953c1553f04b7d319c9dcacf392dd9"}, "originalPosition": 21}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMyMjU1NDQ0OnYy", "diffSide": "RIGHT", "path": "udfs/community/linear_interpolate.sql", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNFQxODoxNToyMVrOH5PYbg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNFQxODoxNToyMVrOH5PYbg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTc4Mjg5NA==", "bodyText": "Add a comment above this describing the function, inputs, and outputs.\nSimilar to:\nhttps://github.com/GoogleCloudPlatform/bigquery-utils/blob/master/udfs/community/csv_to_struct.sql", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/198#discussion_r529782894", "createdAt": "2020-11-24T18:15:21Z", "author": {"login": "ryanmcdowell"}, "path": "udfs/community/linear_interpolate.sql", "diffHunk": "@@ -0,0 +1,26 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+CREATE OR REPLACE function fn.linear_interpolate(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2ccad989b8953c1553f04b7d319c9dcacf392dd9"}, "originalPosition": 17}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMyMjU1NzkzOnYy", "diffSide": "RIGHT", "path": "udfs/community/ts_gen_keyed_timestamps.sql", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNFQxODoxNjoxNlrOH5PanA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNFQxODoxNjoxNlrOH5PanA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTc4MzQ1Mg==", "bodyText": "Structure above comment.\nSimilar to:\nhttps://github.com/GoogleCloudPlatform/bigquery-utils/blob/master/udfs/community/csv_to_struct.sql", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/198#discussion_r529783452", "createdAt": "2020-11-24T18:16:16Z", "author": {"login": "ryanmcdowell"}, "path": "udfs/community/ts_gen_keyed_timestamps.sql", "diffHunk": "@@ -0,0 +1,39 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+/*\n+* Generate an array of key-timestamp structs with the specified min, max and interval timeseries\n+* Expected Usage:\n+* SELECT *\n+* FROM UNNEST(bqutil.fn.ts_gen_keyed_timestamp(['abc'], 900, '2020-01-01', '2020-01-02') a\n+* LEFT JOIN dataset.table ON a.series_key = a.key AND a.tumble_val = b.timestamp\n+*/\n+CREATE OR REPLACE FUNCTION fn.ts_gen_keyed_timestamps(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2ccad989b8953c1553f04b7d319c9dcacf392dd9"}, "originalPosition": 24}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMyMjU2MjQ0OnYy", "diffSide": "RIGHT", "path": "udfs/community/ts_interpolate_lin_interpolate.sql", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNFQxODoxNzoyNlrOH5PdRg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNFQxODoxNzoyNlrOH5PdRg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTc4NDEzNA==", "bodyText": "Structure above comment for consistency with the others.", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/198#discussion_r529784134", "createdAt": "2020-11-24T18:17:26Z", "author": {"login": "ryanmcdowell"}, "path": "udfs/community/ts_interpolate_lin_interpolate.sql", "diffHunk": "@@ -0,0 +1,64 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+/*\n+* wrap fn.linear_interpolate to handle time series interpolation\n+* \n+* Example usage: use value if exists, otherwise attempt linear interpolation, else fill with zero\n+* \n+* WITH tbl AS (\n+*   SELECT 'abc' key, CAST('2021-01-01' AS TIMESTAMP) ts, 1 value, STRUCT(CAST('2021-01-01' AS TIMESTAMP) AS x, 1 AS y) coord\n+*   UNION ALL\n+*   SELECT 'abc', CAST('2021-01-02' AS TIMESTAMP), null, null\n+*   UNION ALL\n+*   SELECT 'abc', CAST('2021-01-03' AS TIMESTAMP), 3, STRUCT(CAST('2021-01-03' AS TIMESTAMP) AS x, 3 AS y)\n+*   UNION ALL\n+*   SELECT 'abc', CAST('2021-01-04' AS TIMESTAMP), null, null\n+* )\n+* SELECT \n+*   *,\n+*   COALESCE(coord.y,\n+*     fn.ts_lin_interpolate(\n+*       ts,\n+*       LAST_VALUE(coord IGNORE NULLS)\n+*         OVER (PARTITION BY key\n+*           ORDER BY unix_seconds(ts) ASC\n+*           RANGE BETWEEN UNBOUNDED PRECEDING AND 1 PRECEDING),\n+*       FIRST_VALUE(coord IGNORE NULLS)\n+*         OVER (PARTITION BY key\n+*           ORDER BY unix_seconds(ts) ASC\n+*           RANGE BETWEEN 1 FOLLOWING AND UNBOUNDED FOLLOWING)\n+*       ),\n+*       0\n+*   ) AS intrp\n+* FROM tbl\n+*/\n+\n+CREATE OR REPLACE FUNCTION fn.ts_lin_interpolate(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2ccad989b8953c1553f04b7d319c9dcacf392dd9"}, "originalPosition": 50}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMyMjU2NTQ2OnYy", "diffSide": "RIGHT", "path": "udfs/community/ts_interpolate_lin_interpolate.sql", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNFQxODoxODowOVrOH5PfBQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNFQxODoxODowOVrOH5PfBQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTc4NDU4MQ==", "bodyText": "Perhaps this function should be named: fn.ts_linear_interpolate", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/198#discussion_r529784581", "createdAt": "2020-11-24T18:18:09Z", "author": {"login": "ryanmcdowell"}, "path": "udfs/community/ts_interpolate_lin_interpolate.sql", "diffHunk": "@@ -0,0 +1,64 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+/*\n+* wrap fn.linear_interpolate to handle time series interpolation\n+* \n+* Example usage: use value if exists, otherwise attempt linear interpolation, else fill with zero\n+* \n+* WITH tbl AS (\n+*   SELECT 'abc' key, CAST('2021-01-01' AS TIMESTAMP) ts, 1 value, STRUCT(CAST('2021-01-01' AS TIMESTAMP) AS x, 1 AS y) coord\n+*   UNION ALL\n+*   SELECT 'abc', CAST('2021-01-02' AS TIMESTAMP), null, null\n+*   UNION ALL\n+*   SELECT 'abc', CAST('2021-01-03' AS TIMESTAMP), 3, STRUCT(CAST('2021-01-03' AS TIMESTAMP) AS x, 3 AS y)\n+*   UNION ALL\n+*   SELECT 'abc', CAST('2021-01-04' AS TIMESTAMP), null, null\n+* )\n+* SELECT \n+*   *,\n+*   COALESCE(coord.y,\n+*     fn.ts_lin_interpolate(\n+*       ts,\n+*       LAST_VALUE(coord IGNORE NULLS)\n+*         OVER (PARTITION BY key\n+*           ORDER BY unix_seconds(ts) ASC\n+*           RANGE BETWEEN UNBOUNDED PRECEDING AND 1 PRECEDING),\n+*       FIRST_VALUE(coord IGNORE NULLS)\n+*         OVER (PARTITION BY key\n+*           ORDER BY unix_seconds(ts) ASC\n+*           RANGE BETWEEN 1 FOLLOWING AND UNBOUNDED FOLLOWING)\n+*       ),\n+*       0\n+*   ) AS intrp\n+* FROM tbl\n+*/\n+\n+CREATE OR REPLACE FUNCTION fn.ts_lin_interpolate(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2ccad989b8953c1553f04b7d319c9dcacf392dd9"}, "originalPosition": 50}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMyMjU2OTk0OnYy", "diffSide": "RIGHT", "path": "udfs/community/ts_interpolate_lin_interpolate.sql", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNFQxODoxOTowOFrOH5PhtA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNFQxODoxOTowOFrOH5PhtA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTc4NTI2OA==", "bodyText": "Indentation should be 2 spaces.", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/198#discussion_r529785268", "createdAt": "2020-11-24T18:19:08Z", "author": {"login": "ryanmcdowell"}, "path": "udfs/community/ts_interpolate_lin_interpolate.sql", "diffHunk": "@@ -0,0 +1,64 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+/*\n+* wrap fn.linear_interpolate to handle time series interpolation\n+* \n+* Example usage: use value if exists, otherwise attempt linear interpolation, else fill with zero\n+* \n+* WITH tbl AS (\n+*   SELECT 'abc' key, CAST('2021-01-01' AS TIMESTAMP) ts, 1 value, STRUCT(CAST('2021-01-01' AS TIMESTAMP) AS x, 1 AS y) coord\n+*   UNION ALL\n+*   SELECT 'abc', CAST('2021-01-02' AS TIMESTAMP), null, null\n+*   UNION ALL\n+*   SELECT 'abc', CAST('2021-01-03' AS TIMESTAMP), 3, STRUCT(CAST('2021-01-03' AS TIMESTAMP) AS x, 3 AS y)\n+*   UNION ALL\n+*   SELECT 'abc', CAST('2021-01-04' AS TIMESTAMP), null, null\n+* )\n+* SELECT \n+*   *,\n+*   COALESCE(coord.y,\n+*     fn.ts_lin_interpolate(\n+*       ts,\n+*       LAST_VALUE(coord IGNORE NULLS)\n+*         OVER (PARTITION BY key\n+*           ORDER BY unix_seconds(ts) ASC\n+*           RANGE BETWEEN UNBOUNDED PRECEDING AND 1 PRECEDING),\n+*       FIRST_VALUE(coord IGNORE NULLS)\n+*         OVER (PARTITION BY key\n+*           ORDER BY unix_seconds(ts) ASC\n+*           RANGE BETWEEN 1 FOLLOWING AND UNBOUNDED FOLLOWING)\n+*       ),\n+*       0\n+*   ) AS intrp\n+* FROM tbl\n+*/\n+\n+CREATE OR REPLACE FUNCTION fn.ts_lin_interpolate(\n+        pos TIMESTAMP,\n+        prev STRUCT<x TIMESTAMP, y FLOAT64>,\n+        next STRUCT<x TIMESTAMP, y FLOAT64>)\n+AS (\n+ CASE", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2ccad989b8953c1553f04b7d319c9dcacf392dd9"}, "originalPosition": 55}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMyMjU3MDkzOnYy", "diffSide": "RIGHT", "path": "udfs/community/ts_interpolate_lin_interpolate.sql", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNFQxODoxOToxOFrOH5PiOQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNFQxODoxOToxOFrOH5PiOQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTc4NTQwMQ==", "bodyText": "Indentation should be 2 spaces.", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/198#discussion_r529785401", "createdAt": "2020-11-24T18:19:18Z", "author": {"login": "ryanmcdowell"}, "path": "udfs/community/ts_interpolate_lin_interpolate.sql", "diffHunk": "@@ -0,0 +1,64 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+/*\n+* wrap fn.linear_interpolate to handle time series interpolation\n+* \n+* Example usage: use value if exists, otherwise attempt linear interpolation, else fill with zero\n+* \n+* WITH tbl AS (\n+*   SELECT 'abc' key, CAST('2021-01-01' AS TIMESTAMP) ts, 1 value, STRUCT(CAST('2021-01-01' AS TIMESTAMP) AS x, 1 AS y) coord\n+*   UNION ALL\n+*   SELECT 'abc', CAST('2021-01-02' AS TIMESTAMP), null, null\n+*   UNION ALL\n+*   SELECT 'abc', CAST('2021-01-03' AS TIMESTAMP), 3, STRUCT(CAST('2021-01-03' AS TIMESTAMP) AS x, 3 AS y)\n+*   UNION ALL\n+*   SELECT 'abc', CAST('2021-01-04' AS TIMESTAMP), null, null\n+* )\n+* SELECT \n+*   *,\n+*   COALESCE(coord.y,\n+*     fn.ts_lin_interpolate(\n+*       ts,\n+*       LAST_VALUE(coord IGNORE NULLS)\n+*         OVER (PARTITION BY key\n+*           ORDER BY unix_seconds(ts) ASC\n+*           RANGE BETWEEN UNBOUNDED PRECEDING AND 1 PRECEDING),\n+*       FIRST_VALUE(coord IGNORE NULLS)\n+*         OVER (PARTITION BY key\n+*           ORDER BY unix_seconds(ts) ASC\n+*           RANGE BETWEEN 1 FOLLOWING AND UNBOUNDED FOLLOWING)\n+*       ),\n+*       0\n+*   ) AS intrp\n+* FROM tbl\n+*/\n+\n+CREATE OR REPLACE FUNCTION fn.ts_lin_interpolate(\n+        pos TIMESTAMP,\n+        prev STRUCT<x TIMESTAMP, y FLOAT64>,\n+        next STRUCT<x TIMESTAMP, y FLOAT64>)\n+AS (\n+ CASE\n+    WHEN pos IS NULL OR prev IS NULL or next IS NULL THEN null\n+    ELSE\n+        bqutil.fn.linear_interpolate(\n+            unix_seconds(pos),\n+            STRUCT(unix_seconds(prev.x) AS x, prev.y AS y),\n+            STRUCT(unix_seconds(next.x) AS x, next.y AS y)\n+        )\n+ END", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2ccad989b8953c1553f04b7d319c9dcacf392dd9"}, "originalPosition": 63}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMyMjU3MjQ0OnYy", "diffSide": "RIGHT", "path": "udfs/community/ts_interpolate_lin_interpolate.sql", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNFQxODoxOTozOVrOH5PjCw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNFQxODoxOTozOVrOH5PjCw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTc4NTYxMQ==", "bodyText": "Capitalize last NULL", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/198#discussion_r529785611", "createdAt": "2020-11-24T18:19:39Z", "author": {"login": "ryanmcdowell"}, "path": "udfs/community/ts_interpolate_lin_interpolate.sql", "diffHunk": "@@ -0,0 +1,64 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+/*\n+* wrap fn.linear_interpolate to handle time series interpolation\n+* \n+* Example usage: use value if exists, otherwise attempt linear interpolation, else fill with zero\n+* \n+* WITH tbl AS (\n+*   SELECT 'abc' key, CAST('2021-01-01' AS TIMESTAMP) ts, 1 value, STRUCT(CAST('2021-01-01' AS TIMESTAMP) AS x, 1 AS y) coord\n+*   UNION ALL\n+*   SELECT 'abc', CAST('2021-01-02' AS TIMESTAMP), null, null\n+*   UNION ALL\n+*   SELECT 'abc', CAST('2021-01-03' AS TIMESTAMP), 3, STRUCT(CAST('2021-01-03' AS TIMESTAMP) AS x, 3 AS y)\n+*   UNION ALL\n+*   SELECT 'abc', CAST('2021-01-04' AS TIMESTAMP), null, null\n+* )\n+* SELECT \n+*   *,\n+*   COALESCE(coord.y,\n+*     fn.ts_lin_interpolate(\n+*       ts,\n+*       LAST_VALUE(coord IGNORE NULLS)\n+*         OVER (PARTITION BY key\n+*           ORDER BY unix_seconds(ts) ASC\n+*           RANGE BETWEEN UNBOUNDED PRECEDING AND 1 PRECEDING),\n+*       FIRST_VALUE(coord IGNORE NULLS)\n+*         OVER (PARTITION BY key\n+*           ORDER BY unix_seconds(ts) ASC\n+*           RANGE BETWEEN 1 FOLLOWING AND UNBOUNDED FOLLOWING)\n+*       ),\n+*       0\n+*   ) AS intrp\n+* FROM tbl\n+*/\n+\n+CREATE OR REPLACE FUNCTION fn.ts_lin_interpolate(\n+        pos TIMESTAMP,\n+        prev STRUCT<x TIMESTAMP, y FLOAT64>,\n+        next STRUCT<x TIMESTAMP, y FLOAT64>)\n+AS (\n+ CASE\n+    WHEN pos IS NULL OR prev IS NULL or next IS NULL THEN null", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2ccad989b8953c1553f04b7d319c9dcacf392dd9"}, "originalPosition": 56}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMyMjU3ODQ4OnYy", "diffSide": "RIGHT", "path": "udfs/community/ts_interpolate_lin_interpolate.sql", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNFQxODoyMDo1NlrOH5PmZg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNFQxODoyMDo1NlrOH5PmZg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTc4NjQ3MA==", "bodyText": "Capitalize UNIX_SECONDS for consistency with other system function calls.", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/198#discussion_r529786470", "createdAt": "2020-11-24T18:20:56Z", "author": {"login": "ryanmcdowell"}, "path": "udfs/community/ts_interpolate_lin_interpolate.sql", "diffHunk": "@@ -0,0 +1,64 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+/*\n+* wrap fn.linear_interpolate to handle time series interpolation\n+* \n+* Example usage: use value if exists, otherwise attempt linear interpolation, else fill with zero\n+* \n+* WITH tbl AS (\n+*   SELECT 'abc' key, CAST('2021-01-01' AS TIMESTAMP) ts, 1 value, STRUCT(CAST('2021-01-01' AS TIMESTAMP) AS x, 1 AS y) coord\n+*   UNION ALL\n+*   SELECT 'abc', CAST('2021-01-02' AS TIMESTAMP), null, null\n+*   UNION ALL\n+*   SELECT 'abc', CAST('2021-01-03' AS TIMESTAMP), 3, STRUCT(CAST('2021-01-03' AS TIMESTAMP) AS x, 3 AS y)\n+*   UNION ALL\n+*   SELECT 'abc', CAST('2021-01-04' AS TIMESTAMP), null, null\n+* )\n+* SELECT \n+*   *,\n+*   COALESCE(coord.y,\n+*     fn.ts_lin_interpolate(\n+*       ts,\n+*       LAST_VALUE(coord IGNORE NULLS)\n+*         OVER (PARTITION BY key\n+*           ORDER BY unix_seconds(ts) ASC\n+*           RANGE BETWEEN UNBOUNDED PRECEDING AND 1 PRECEDING),\n+*       FIRST_VALUE(coord IGNORE NULLS)\n+*         OVER (PARTITION BY key\n+*           ORDER BY unix_seconds(ts) ASC\n+*           RANGE BETWEEN 1 FOLLOWING AND UNBOUNDED FOLLOWING)\n+*       ),\n+*       0\n+*   ) AS intrp\n+* FROM tbl\n+*/\n+\n+CREATE OR REPLACE FUNCTION fn.ts_lin_interpolate(\n+        pos TIMESTAMP,\n+        prev STRUCT<x TIMESTAMP, y FLOAT64>,\n+        next STRUCT<x TIMESTAMP, y FLOAT64>)\n+AS (\n+ CASE\n+    WHEN pos IS NULL OR prev IS NULL or next IS NULL THEN null\n+    ELSE\n+        bqutil.fn.linear_interpolate(\n+            unix_seconds(pos),\n+            STRUCT(unix_seconds(prev.x) AS x, prev.y AS y),\n+            STRUCT(unix_seconds(next.x) AS x, next.y AS y)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2ccad989b8953c1553f04b7d319c9dcacf392dd9"}, "originalPosition": 61}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMyMjU4MTQwOnYy", "diffSide": "RIGHT", "path": "udfs/community/ts_tumble.sql", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNFQxODoyMTozNVrOH5PoFw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNFQxODoyMTozNVrOH5PoFw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTc4NjkwMw==", "bodyText": "Standardize the header with the others.", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/198#discussion_r529786903", "createdAt": "2020-11-24T18:21:35Z", "author": {"login": "ryanmcdowell"}, "path": "udfs/community/ts_tumble.sql", "diffHunk": "@@ -0,0 +1,22 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+--divides a timestamp into a [tumble window](https://cloud.google.com/dataflow/docs/reference/sql/streaming-extensions#tumble)\n+--specified in seconds \n+CREATE OR REPLACE FUNCTION fn.ts_tumble(val TIMESTAMP, tumble_seconds INT64)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2ccad989b8953c1553f04b7d319c9dcacf392dd9"}, "originalPosition": 19}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMyMjU4MjU0OnYy", "diffSide": "RIGHT", "path": "udfs/community/ts_tumble.sql", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNFQxODoyMTo1M1rOH5Poug==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNFQxODoyMTo1M1rOH5Poug==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTc4NzA2Ng==", "bodyText": "Capitalize function calls for consistency with the others.", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/198#discussion_r529787066", "createdAt": "2020-11-24T18:21:53Z", "author": {"login": "ryanmcdowell"}, "path": "udfs/community/ts_tumble.sql", "diffHunk": "@@ -0,0 +1,22 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+--divides a timestamp into a [tumble window](https://cloud.google.com/dataflow/docs/reference/sql/streaming-extensions#tumble)\n+--specified in seconds \n+CREATE OR REPLACE FUNCTION fn.ts_tumble(val TIMESTAMP, tumble_seconds INT64)\n+AS (\n+ timestamp_seconds(div(unix_seconds(val), tumble_seconds) *  tumble_seconds))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2ccad989b8953c1553f04b7d319c9dcacf392dd9"}, "originalPosition": 21}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMyMjU5NDI4OnYy", "diffSide": "RIGHT", "path": "udfs/community/ts_tumble.sql", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNFQxODoyNDo0NlrOH5PvlQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNFQxODoyNDo0NlrOH5PvlQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTc4ODgyMQ==", "bodyText": "You have an extra ) at the end of the timestamp_seconds function call which causes this UDF to be invalid.", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/198#discussion_r529788821", "createdAt": "2020-11-24T18:24:46Z", "author": {"login": "ryanmcdowell"}, "path": "udfs/community/ts_tumble.sql", "diffHunk": "@@ -0,0 +1,22 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+--divides a timestamp into a [tumble window](https://cloud.google.com/dataflow/docs/reference/sql/streaming-extensions#tumble)\n+--specified in seconds \n+CREATE OR REPLACE FUNCTION fn.ts_tumble(val TIMESTAMP, tumble_seconds INT64)\n+AS (\n+ timestamp_seconds(div(unix_seconds(val), tumble_seconds) *  tumble_seconds))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2ccad989b8953c1553f04b7d319c9dcacf392dd9"}, "originalPosition": 21}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2926, "cost": 1, "resetAt": "2021-11-12T19:05:54Z"}}}