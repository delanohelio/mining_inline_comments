{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDU4MTAyMjY3", "number": 122, "title": "SQL Extraction: vscode show progress", "bodyText": "A few days ago (#102), I added --progress to the CLI, which prints progress messages to STDERR. Now, I intercept those messages asynchronously in the VS Code extension, and I update the progress bar more naturally.\nOne complication was that STDERR data did not arrive in chunks of newlines but instead arrived in random lengths. To handle this, I batch all data into one string until a newline is found. Apparently, string concatenation is fast, and there's no StringBuilder class in the language libraries.", "createdAt": "2020-07-28T23:03:04Z", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/122", "merged": true, "mergeCommit": {"oid": "5d5d05baa3d6768e28234de0381e0319d5becd60"}, "closed": true, "closedAt": "2020-07-31T16:38:55Z", "author": {"login": "creativitRy"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc5eiXLgH2gAyNDU4MTAyMjY3OjdlYWU2NGNiNjg0ZmVhNDJlMGUwYTYzOTdjMDVlZTljOGQ1M2U3ZGI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc6W5LHgH2gAyNDU4MTAyMjY3OjE2NTYyMzFiMmYxMWNlMmM3ODBmNDdlZjM5NzFmMTc4YzlhYjRkOWQ=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "7eae64cb684fea42e0e0a6397c05ee9c8d53e7db", "author": {"user": {"login": "creativitRy", "name": "Gahwon Lee"}}, "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/7eae64cb684fea42e0e0a6397c05ee9c8d53e7db", "committedDate": "2020-07-28T22:54:27Z", "message": "SQL Extraction: vscode show progress"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU4NTczMTUx", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/122#pullrequestreview-458573151", "createdAt": "2020-07-30T16:38:36Z", "commit": {"oid": "7eae64cb684fea42e0e0a6397c05ee9c8d53e7db"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQxNjozODozNlrOG5rEAA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQxNjozODozNlrOG5rEAA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzEyNzU1Mg==", "bodyText": "Seems easier to handle multiple '\\n' by something like this:\nif (index >= 0) {\n  var lines = errMsg.split('\\n');\n\n  // assign last line to errMsg\n  errMsg = lines[lines.length - 1];\n\n  // display other lines\n  for (var i = 0; i < line.length - 1; ++i)  {\n    progress.report({\n              message: line[i],\n              increment: isNaN(percent) ? undefined : percent,\n     });\n  }\n}", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/122#discussion_r463127552", "createdAt": "2020-07-30T16:38:36Z", "author": {"login": "feiling"}, "path": "tools/vscode_sql_extraction/src/sql_extraction_runner.ts", "diffHunk": "@@ -54,7 +55,26 @@ export class SqlExtractionRunner {\n       process.stdout!.on('data', data => {\n         json += data;\n       });\n-      // todo: track progress\n+      process.stderr!.on('data', data => {\n+        errMsg += data;\n+        let index = errMsg.indexOf('\\n');\n+        while (index >= 0) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7eae64cb684fea42e0e0a6397c05ee9c8d53e7db"}, "originalPosition": 25}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU4NTc1MTQ3", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/122#pullrequestreview-458575147", "createdAt": "2020-07-30T16:41:09Z", "commit": {"oid": "7eae64cb684fea42e0e0a6397c05ee9c8d53e7db"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQxNjo0MToxMFrOG5rKBg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQxNjo0MToxMFrOG5rKBg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzEyOTA5NA==", "bodyText": "There might be a way to disable buffering of stderr when you start a process. If so, implement that in another pull request.", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/122#discussion_r463129094", "createdAt": "2020-07-30T16:41:10Z", "author": {"login": "feiling"}, "path": "tools/vscode_sql_extraction/src/sql_extraction_runner.ts", "diffHunk": "@@ -41,6 +41,7 @@ export class SqlExtractionRunner {\n \n     return new Promise<Query[]>((resolve, reject) => {\n       let json = '';\n+      let errMsg = '';\n       const process = execFile(this.execPath, args)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7eae64cb684fea42e0e0a6397c05ee9c8d53e7db"}, "originalPosition": 14}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9621fcc7b9ff328d52e5cb9e73621f7f3b3672ad", "author": {"user": {"login": "creativitRy", "name": "Gahwon Lee"}}, "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/9621fcc7b9ff328d52e5cb9e73621f7f3b3672ad", "committedDate": "2020-07-30T19:43:54Z", "message": "Simplify by using split instead of indexof"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7b352ad74daf26087cd7b66bd2ad9d994663df34", "author": {"user": {"login": "creativitRy", "name": "Gahwon Lee"}}, "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/7b352ad74daf26087cd7b66bd2ad9d994663df34", "committedDate": "2020-07-30T19:44:43Z", "message": "Merge branch 'master' into master"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "27f22bde57af8bef4ce2719a5a58da5499f4c5d6", "author": {"user": {"login": "creativitRy", "name": "Gahwon Lee"}}, "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/27f22bde57af8bef4ce2719a5a58da5499f4c5d6", "committedDate": "2020-07-30T19:57:49Z", "message": "Merge branch 'master' into master"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ac728d2efef3554628274f5d9fdfb44068096c45", "author": {"user": {"login": "creativitRy", "name": "Gahwon Lee"}}, "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/ac728d2efef3554628274f5d9fdfb44068096c45", "committedDate": "2020-07-30T22:18:48Z", "message": "Fixed progress needing to be a relative increment"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU5Mjg5MzQ0", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/122#pullrequestreview-459289344", "createdAt": "2020-07-31T16:04:24Z", "commit": {"oid": "ac728d2efef3554628274f5d9fdfb44068096c45"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1656231b2f11ce2c780f47ef3971f178c9ab4d9d", "author": {"user": {"login": "creativitRy", "name": "Gahwon Lee"}}, "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/1656231b2f11ce2c780f47ef3971f178c9ab4d9d", "committedDate": "2020-07-31T16:34:03Z", "message": "Merge branch 'master' into master"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 698, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}