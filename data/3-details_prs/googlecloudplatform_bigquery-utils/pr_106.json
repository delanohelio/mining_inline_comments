{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDUwNTUwMTUy", "number": 106, "title": "Query Verification: Support for multiple queries", "bodyText": "Added support for multiple query statements for data free verification.", "createdAt": "2020-07-16T22:01:28Z", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/106", "merged": true, "mergeCommit": {"oid": "44cc1c354e32da2724ab76ec55da654c848c74ea"}, "closed": true, "closedAt": "2020-07-21T13:06:16Z", "author": {"login": "krishsuchdev"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc1lk4BAH2gAyNDUwNTUwMTUyOmEzODFhMzU0YTg4Yzc0YThhYmRkZjY1Yjc5Mzg3MDE5OWE5NjAzZGM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc3F59cgH2gAyNDUwNTUwMTUyOmU3NWE2YTFiMzE2ZWQyOTFlMjIzNmE1ZTdhNTVmNjhhMTg1ZmE3MDY=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "a381a354a88c74a8abddf65b793870199a9603dc", "author": {"user": {"login": "krishsuchdev", "name": "Krish Suchdev"}}, "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/a381a354a88c74a8abddf65b793870199a9603dc", "committedDate": "2020-07-16T20:50:50Z", "message": "Support for multiple queries"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUxNzIzNzYy", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/106#pullrequestreview-451723762", "createdAt": "2020-07-20T15:35:21Z", "commit": {"oid": "a381a354a88c74a8abddf65b793870199a9603dc"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQxNTozNToyMlrOG0TpGg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQxNTozNToyMlrOG0TpGg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzUwMDk1NA==", "bodyText": "I think we should prefer a loop like for (int i = 0; i < jobInfos.size(); i++) { JobInfo jobInfo = jobInfos.get(i); ...  over using listIterator, I believe it should be more clear as opposed to using the iterator methods", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/106#discussion_r457500954", "createdAt": "2020-07-20T15:35:22Z", "author": {"login": "Luminarys"}, "path": "tools/query_verification/src/main/java/com/google/bigquery/QueryVerifier.java", "diffHunk": "@@ -70,37 +66,49 @@ public void verifyDataFree() {\n                 }\n \n                 List<TableId> tableIds = QueryVerifier.getTableIdsFromDdlSchema(migratedSchema);\n-                for (TableId tableId : tableIds) {\n-                    Table table = bigQuery.getTable(tableId);\n-                    tables.add(table);\n-                }\n+                tableIds.forEach(tableId -> tables.add(bigQuery.getTable(tableId)));\n             }\n \n             if (tables.isEmpty()) {\n                 System.out.println(migratedSchema.path() + \" is not correctly formatted.\");\n             }\n         }\n \n-        // Create dry-run job\n-        JobInfo jobInfo = configureJob(migratedQuery.query(), true);\n+        // Create dry-run jobs\n+        List<JobInfo> jobInfos = getJobInfosFromQuery(migratedQuery, true);\n+        ListIterator<JobInfo> jobInfoListIterator = jobInfos.listIterator();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a381a354a88c74a8abddf65b793870199a9603dc"}, "originalPosition": 49}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "19db58846d28d73a26bf41bf78f4d87170496d75", "author": {"user": {"login": "krishsuchdev", "name": "Krish Suchdev"}}, "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/19db58846d28d73a26bf41bf78f4d87170496d75", "committedDate": "2020-07-20T16:25:53Z", "message": "Fix job info loop"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ba362087e071059d69674d354b8661ebdfb4d29b", "author": {"user": {"login": "krishsuchdev", "name": "Krish Suchdev"}}, "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/ba362087e071059d69674d354b8661ebdfb4d29b", "committedDate": "2020-07-20T16:26:31Z", "message": "Add unit tests"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUxODA2ODc1", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/106#pullrequestreview-451806875", "createdAt": "2020-07-20T17:19:37Z", "commit": {"oid": "ba362087e071059d69674d354b8661ebdfb4d29b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQxNzoxOTozN1rOG0X1fg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQxNzoxOTozN1rOG0X1fg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzU2OTY2Mg==", "bodyText": "I would inline this into the return and then remove the {} from the lambda so it looks like jobInfo -> jobInfo.getConfiguration().getQuery() (I think this is valid syntax)", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/106#discussion_r457569662", "createdAt": "2020-07-20T17:19:37Z", "author": {"login": "Luminarys"}, "path": "tools/query_verification/src/test/java/com/google/bigquery/QueryVerifierTest.java", "diffHunk": "@@ -102,4 +103,34 @@ public void testGetMultipleTableIdFromDdlSchema() {\n         assertEquals(tableId.getTable(), \"secondTable\");\n     }\n \n+    @Test\n+    public void testGetJobInfoFromQuery() {\n+        String queryContents = \"SELECT * FROM table\";\n+        QueryVerificationQuery query = QueryVerificationQuery.create(queryContents, \"\");\n+        List<JobInfo> jobInfos = QueryVerifier.getJobInfosFromQuery(query, true);\n+\n+        assertEquals(jobInfos.size(), 1);\n+\n+        QueryJobConfiguration queryJobConfiguration = jobInfos.get(0).getConfiguration();\n+        assertEquals(queryJobConfiguration.getQuery(), \"SELECT * FROM table\");\n+    }\n+\n+    @Test\n+    public void testGetMultipleJobInfosFromQuery() {\n+        String queryContents = \"SELECT * FROM table1;\\nSELECT column1 FROM table2; SELECT column2 FROM table2;\";\n+        QueryVerificationQuery query = QueryVerificationQuery.create(queryContents, \"\");\n+        List<JobInfo> jobInfos = QueryVerifier.getJobInfosFromQuery(query, true);\n+\n+        assertEquals(jobInfos.size(), 3);\n+\n+        List<String> queries = jobInfos.stream().map(jobInfo -> {\n+            QueryJobConfiguration queryJobConfiguration = jobInfo.getConfiguration();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ba362087e071059d69674d354b8661ebdfb4d29b"}, "originalPosition": 33}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUxODA2OTcw", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/106#pullrequestreview-451806970", "createdAt": "2020-07-20T17:19:45Z", "commit": {"oid": "ba362087e071059d69674d354b8661ebdfb4d29b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUxOTQ1OTE3", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/106#pullrequestreview-451945917", "createdAt": "2020-07-20T20:45:01Z", "commit": {"oid": "ba362087e071059d69674d354b8661ebdfb4d29b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e75a6a1b316ed291e2236a5e7a55f68a185fa706", "author": {"user": {"login": "krishsuchdev", "name": "Krish Suchdev"}}, "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/e75a6a1b316ed291e2236a5e7a55f68a185fa706", "committedDate": "2020-07-21T13:04:45Z", "message": "Merge branch 'master' into multipleQueries"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 672, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}