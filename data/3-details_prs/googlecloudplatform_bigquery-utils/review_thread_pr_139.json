{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY0MTIzOTU2", "number": 139, "reviewThreads": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQxNzo0MToyN1rOEV7bzw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQyMzozMjo1OVrOEWBqDQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkxNDI5MzI3OnYy", "diffSide": "RIGHT", "path": "tools/query_verification/src/main/java/com/google/bigquery/QueryVerifier.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQxNzo0MToyN1rOG89xrQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQyMjo0MDoxMFrOG9Gh-A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjU3OTg4NQ==", "bodyText": "return null may cause unexpected issue if other parts didn't handle carefully. Consider using Optional as return type", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/139#discussion_r466579885", "createdAt": "2020-08-06T17:41:27Z", "author": {"login": "yzhvictor"}, "path": "tools/query_verification/src/main/java/com/google/bigquery/QueryVerifier.java", "diffHunk": "@@ -112,5 +117,43 @@ public void verifyDataAware() throws InterruptedException {\n         System.out.println(\"Data-Aware Verification Completed\");\n     }\n \n+    /**\n+     * Finds extra and missing results by locating the differences between the results.\n+     * @param migratedResults Parsed results returned from BQ\n+     * @param originalResults Parsed results returned from original data warehouse service\n+     * @return Differences classified as either extra or missing from migrated results.\n+     */\n+    public ResultDifferences compareResults(List<QueryJobResults> migratedResults, List<QueryJobResults> originalResults) {\n+        // Check if same amount of queries were run\n+        if (migratedResults.size() == originalResults.size()) {\n+            // Rows present in migrated query results, but not original query results\n+            List<List<Object>> extraResults = new ArrayList<List<Object>>();\n+\n+            // Rows present in original query results, but not migrated query results\n+            List<List<Object>> missingResults = new ArrayList<List<Object>>();\n+\n+            for (int i = 0; i < migratedResults.size(); i++) {\n+                QueryJobResults migratedJobResults = migratedResults.get(i);\n+\n+                QueryJobResults originalJobResults = originalResults.get(i);\n+                Set<List<Object>> missingResultsSet = originalJobResults.results();\n+\n+                for (List<Object> migratedQueryResults : migratedJobResults.results()) {\n+                    // Rows that exist in both results are removed from missing results set\n+                    if (!missingResultsSet.remove(migratedQueryResults)) {\n+                        // Rows in the migrated results that don't exist in original results are classified as extra in migrated results\n+                        extraResults.add(migratedQueryResults);\n+                    }\n+                }\n+\n+                // Any leftover rows in the original results without a match are classified as missing in migrated results\n+                missingResults.addAll(missingResultsSet);\n+            }\n+\n+            return ResultDifferences.create(extraResults, missingResults);\n+        } else {\n+            return null;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "62580d98c6616be21af5770c7c2c5c6843f09868"}, "originalPosition": 71}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjYzNzY4NA==", "bodyText": "Seconding this. I also wonder why we even need this else branch since I think we should be able to produce a result difference no matter what the size of each result set is.", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/139#discussion_r466637684", "createdAt": "2020-08-06T19:28:54Z", "author": {"login": "Luminarys"}, "path": "tools/query_verification/src/main/java/com/google/bigquery/QueryVerifier.java", "diffHunk": "@@ -112,5 +117,43 @@ public void verifyDataAware() throws InterruptedException {\n         System.out.println(\"Data-Aware Verification Completed\");\n     }\n \n+    /**\n+     * Finds extra and missing results by locating the differences between the results.\n+     * @param migratedResults Parsed results returned from BQ\n+     * @param originalResults Parsed results returned from original data warehouse service\n+     * @return Differences classified as either extra or missing from migrated results.\n+     */\n+    public ResultDifferences compareResults(List<QueryJobResults> migratedResults, List<QueryJobResults> originalResults) {\n+        // Check if same amount of queries were run\n+        if (migratedResults.size() == originalResults.size()) {\n+            // Rows present in migrated query results, but not original query results\n+            List<List<Object>> extraResults = new ArrayList<List<Object>>();\n+\n+            // Rows present in original query results, but not migrated query results\n+            List<List<Object>> missingResults = new ArrayList<List<Object>>();\n+\n+            for (int i = 0; i < migratedResults.size(); i++) {\n+                QueryJobResults migratedJobResults = migratedResults.get(i);\n+\n+                QueryJobResults originalJobResults = originalResults.get(i);\n+                Set<List<Object>> missingResultsSet = originalJobResults.results();\n+\n+                for (List<Object> migratedQueryResults : migratedJobResults.results()) {\n+                    // Rows that exist in both results are removed from missing results set\n+                    if (!missingResultsSet.remove(migratedQueryResults)) {\n+                        // Rows in the migrated results that don't exist in original results are classified as extra in migrated results\n+                        extraResults.add(migratedQueryResults);\n+                    }\n+                }\n+\n+                // Any leftover rows in the original results without a match are classified as missing in migrated results\n+                missingResults.addAll(missingResultsSet);\n+            }\n+\n+            return ResultDifferences.create(extraResults, missingResults);\n+        } else {\n+            return null;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjU3OTg4NQ=="}, "originalCommit": {"oid": "62580d98c6616be21af5770c7c2c5c6843f09868"}, "originalPosition": 71}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjcyMzMyMA==", "bodyText": "Updated. The condition was just checking if the same number of query statements were run. If they weren't, it meant one of the parameters had results from a query that wasn't ran in the other", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/139#discussion_r466723320", "createdAt": "2020-08-06T22:40:10Z", "author": {"login": "krishsuchdev"}, "path": "tools/query_verification/src/main/java/com/google/bigquery/QueryVerifier.java", "diffHunk": "@@ -112,5 +117,43 @@ public void verifyDataAware() throws InterruptedException {\n         System.out.println(\"Data-Aware Verification Completed\");\n     }\n \n+    /**\n+     * Finds extra and missing results by locating the differences between the results.\n+     * @param migratedResults Parsed results returned from BQ\n+     * @param originalResults Parsed results returned from original data warehouse service\n+     * @return Differences classified as either extra or missing from migrated results.\n+     */\n+    public ResultDifferences compareResults(List<QueryJobResults> migratedResults, List<QueryJobResults> originalResults) {\n+        // Check if same amount of queries were run\n+        if (migratedResults.size() == originalResults.size()) {\n+            // Rows present in migrated query results, but not original query results\n+            List<List<Object>> extraResults = new ArrayList<List<Object>>();\n+\n+            // Rows present in original query results, but not migrated query results\n+            List<List<Object>> missingResults = new ArrayList<List<Object>>();\n+\n+            for (int i = 0; i < migratedResults.size(); i++) {\n+                QueryJobResults migratedJobResults = migratedResults.get(i);\n+\n+                QueryJobResults originalJobResults = originalResults.get(i);\n+                Set<List<Object>> missingResultsSet = originalJobResults.results();\n+\n+                for (List<Object> migratedQueryResults : migratedJobResults.results()) {\n+                    // Rows that exist in both results are removed from missing results set\n+                    if (!missingResultsSet.remove(migratedQueryResults)) {\n+                        // Rows in the migrated results that don't exist in original results are classified as extra in migrated results\n+                        extraResults.add(migratedQueryResults);\n+                    }\n+                }\n+\n+                // Any leftover rows in the original results without a match are classified as missing in migrated results\n+                missingResults.addAll(missingResultsSet);\n+            }\n+\n+            return ResultDifferences.create(extraResults, missingResults);\n+        } else {\n+            return null;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjU3OTg4NQ=="}, "originalCommit": {"oid": "62580d98c6616be21af5770c7c2c5c6843f09868"}, "originalPosition": 71}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkxNDI5NTk1OnYy", "diffSide": "RIGHT", "path": "tools/query_verification/src/main/java/com/google/bigquery/BigQueryManager.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQxNzo0MjoyMVrOG89zhA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMFQyMjoxNjo0OVrOG-hrMw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjU4MDM1Ng==", "bodyText": "Do we need to have a default to at least put some warnings for unsupported types.", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/139#discussion_r466580356", "createdAt": "2020-08-06T17:42:21Z", "author": {"login": "yzhvictor"}, "path": "tools/query_verification/src/main/java/com/google/bigquery/BigQueryManager.java", "diffHunk": "@@ -279,8 +281,55 @@ public String getName() {\n             StandardSQLTypeName type = fields.get(i).getType().getStandardType();\n \n             Object result;\n-            // TODO Convert value to appropriate Java type\n-            result = value.getStringValue();\n+            try {\n+                switch (type) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "62580d98c6616be21af5770c7c2c5c6843f09868"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjYwMDc0Ng==", "bodyText": "I have a default case that converts the value to a string to use for the other types not listed. Should I still add a warning?", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/139#discussion_r466600746", "createdAt": "2020-08-06T18:18:52Z", "author": {"login": "krishsuchdev"}, "path": "tools/query_verification/src/main/java/com/google/bigquery/BigQueryManager.java", "diffHunk": "@@ -279,8 +281,55 @@ public String getName() {\n             StandardSQLTypeName type = fields.get(i).getType().getStandardType();\n \n             Object result;\n-            // TODO Convert value to appropriate Java type\n-            result = value.getStringValue();\n+            try {\n+                switch (type) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjU4MDM1Ng=="}, "originalCommit": {"oid": "62580d98c6616be21af5770c7c2c5c6843f09868"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODIxNjYyNw==", "bodyText": "Adding a warning sounds good, since it can help us identify the unsupported types.", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/139#discussion_r468216627", "createdAt": "2020-08-10T22:16:49Z", "author": {"login": "yzhvictor"}, "path": "tools/query_verification/src/main/java/com/google/bigquery/BigQueryManager.java", "diffHunk": "@@ -279,8 +281,55 @@ public String getName() {\n             StandardSQLTypeName type = fields.get(i).getType().getStandardType();\n \n             Object result;\n-            // TODO Convert value to appropriate Java type\n-            result = value.getStringValue();\n+            try {\n+                switch (type) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjU4MDM1Ng=="}, "originalCommit": {"oid": "62580d98c6616be21af5770c7c2c5c6843f09868"}, "originalPosition": 16}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkxNDI5NzY3OnYy", "diffSide": "RIGHT", "path": "tools/query_verification/src/main/java/com/google/bigquery/BigQueryManager.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQxNzo0Mjo1MlrOG890nA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQxNzo0Mjo1MlrOG890nA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjU4MDYzNg==", "bodyText": "use Optional.empty()", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/139#discussion_r466580636", "createdAt": "2020-08-06T17:42:52Z", "author": {"login": "yzhvictor"}, "path": "tools/query_verification/src/main/java/com/google/bigquery/BigQueryManager.java", "diffHunk": "@@ -279,8 +281,55 @@ public String getName() {\n             StandardSQLTypeName type = fields.get(i).getType().getStandardType();\n \n             Object result;\n-            // TODO Convert value to appropriate Java type\n-            result = value.getStringValue();\n+            try {\n+                switch (type) {\n+                    case BOOL:\n+                        // returns boolean\n+                        result = value.getBooleanValue();\n+                        break;\n+                    case FLOAT64:\n+                        // returns double\n+                        result = value.getDoubleValue();\n+                        break;\n+                    case INT64:\n+                        // returns long\n+                        result = value.getLongValue();\n+                        break;\n+                    case NUMERIC:\n+                        // returns BigDecimal\n+                        result = value.getNumericValue();\n+                        break;\n+                    case STRUCT:\n+                        FieldList subFields = fields.get(i).getSubFields();\n+                        FieldValueList subValues = value.getRecordValue();\n+                        List<Object> subResults = parseResults(subValues, subFields);\n+\n+                        // returns List<Object>\n+                        result = subResults;\n+                        break;\n+                    case DATE:\n+                        // returns Date\n+                        result = new SimpleDateFormat(\"yyyy-MM-dd\").parse(value.getStringValue());\n+                        break;\n+                    case DATETIME:\n+                        // returns Date\n+                        result = new SimpleDateFormat(\"yyyy-MM-dd'T'hh:mm:ss.SSSSSS\").parse(value.getStringValue());\n+                        break;\n+                    case TIME:\n+                        // returns Date\n+                        result = new SimpleDateFormat(\"hh:mm:ss.SSSSSS\").parse(value.getStringValue());\n+                        break;\n+                    case TIMESTAMP:\n+                        // returns Date\n+                        result = new SimpleDateFormat(\"yyyy-MM-dd hh:mm:ss.SSSSSS zzz\").parse(value.getStringValue());\n+                        break;\n+                    case STRING: default:\n+                        // returns String\n+                        result = value.getStringValue();\n+                }\n+            } catch (ParseException e) {\n+                result = null;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "62580d98c6616be21af5770c7c2c5c6843f09868"}, "originalPosition": 62}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkxNDMwMjQyOnYy", "diffSide": "RIGHT", "path": "tools/query_verification/src/main/java/com/google/bigquery/QueryVerifier.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQxNzo0NDoxMVrOG893eg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQxODoxOTozMFrOG8_Eig==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjU4MTM3MA==", "bodyText": "will run queries keep the same order in 2 databases?", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/139#discussion_r466581370", "createdAt": "2020-08-06T17:44:11Z", "author": {"login": "yzhvictor"}, "path": "tools/query_verification/src/main/java/com/google/bigquery/QueryVerifier.java", "diffHunk": "@@ -72,8 +74,11 @@ public void verifyDataFree() throws InterruptedException {\n     /**\n      * Verifies migrated query by sending query jobs to BQ and TD to check for differences in the query results.\n      */\n-    public void verifyDataAware() throws InterruptedException {\n+    public void verifyDataAware() throws Exception {\n         List<QueryJobResults> migratedResults = migratedInstance.runQueries();\n+        List<QueryJobResults> originalResults = originalInstance.runQueries();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "62580d98c6616be21af5770c7c2c5c6843f09868"}, "originalPosition": 26}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjYwMTA5OA==", "bodyText": "Assuming that the 2 query files have the queries in the same order, migratedResults and originalResults should retain that order for the query results", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/139#discussion_r466601098", "createdAt": "2020-08-06T18:19:30Z", "author": {"login": "krishsuchdev"}, "path": "tools/query_verification/src/main/java/com/google/bigquery/QueryVerifier.java", "diffHunk": "@@ -72,8 +74,11 @@ public void verifyDataFree() throws InterruptedException {\n     /**\n      * Verifies migrated query by sending query jobs to BQ and TD to check for differences in the query results.\n      */\n-    public void verifyDataAware() throws InterruptedException {\n+    public void verifyDataAware() throws Exception {\n         List<QueryJobResults> migratedResults = migratedInstance.runQueries();\n+        List<QueryJobResults> originalResults = originalInstance.runQueries();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjU4MTM3MA=="}, "originalCommit": {"oid": "62580d98c6616be21af5770c7c2c5c6843f09868"}, "originalPosition": 26}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkxNDU5ODkyOnYy", "diffSide": "RIGHT", "path": "tools/query_verification/src/main/java/com/google/bigquery/BigQueryManager.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQxOToxMTozNlrOG9Awog==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQxOToxMTozNlrOG9Awog==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjYyODc3MA==", "bodyText": "I think you can combine this line like result = parseResult(subValues, subFields).", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/139#discussion_r466628770", "createdAt": "2020-08-06T19:11:36Z", "author": {"login": "Luminarys"}, "path": "tools/query_verification/src/main/java/com/google/bigquery/BigQueryManager.java", "diffHunk": "@@ -279,8 +281,55 @@ public String getName() {\n             StandardSQLTypeName type = fields.get(i).getType().getStandardType();\n \n             Object result;\n-            // TODO Convert value to appropriate Java type\n-            result = value.getStringValue();\n+            try {\n+                switch (type) {\n+                    case BOOL:\n+                        // returns boolean\n+                        result = value.getBooleanValue();\n+                        break;\n+                    case FLOAT64:\n+                        // returns double\n+                        result = value.getDoubleValue();\n+                        break;\n+                    case INT64:\n+                        // returns long\n+                        result = value.getLongValue();\n+                        break;\n+                    case NUMERIC:\n+                        // returns BigDecimal\n+                        result = value.getNumericValue();\n+                        break;\n+                    case STRUCT:\n+                        FieldList subFields = fields.get(i).getSubFields();\n+                        FieldValueList subValues = value.getRecordValue();\n+                        List<Object> subResults = parseResults(subValues, subFields);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "62580d98c6616be21af5770c7c2c5c6843f09868"}, "originalPosition": 36}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkxNDYwNTg5OnYy", "diffSide": "RIGHT", "path": "tools/query_verification/src/main/java/com/google/bigquery/BigQueryManager.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQxOToxMzozN1rOG9A03g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQxOToxMzozN1rOG9A03g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjYyOTg1NA==", "bodyText": "I would recommend making these separate cases and leaving a comment that we choose to use the String representation if the type is not known otherwise.", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/139#discussion_r466629854", "createdAt": "2020-08-06T19:13:37Z", "author": {"login": "Luminarys"}, "path": "tools/query_verification/src/main/java/com/google/bigquery/BigQueryManager.java", "diffHunk": "@@ -279,8 +281,55 @@ public String getName() {\n             StandardSQLTypeName type = fields.get(i).getType().getStandardType();\n \n             Object result;\n-            // TODO Convert value to appropriate Java type\n-            result = value.getStringValue();\n+            try {\n+                switch (type) {\n+                    case BOOL:\n+                        // returns boolean\n+                        result = value.getBooleanValue();\n+                        break;\n+                    case FLOAT64:\n+                        // returns double\n+                        result = value.getDoubleValue();\n+                        break;\n+                    case INT64:\n+                        // returns long\n+                        result = value.getLongValue();\n+                        break;\n+                    case NUMERIC:\n+                        // returns BigDecimal\n+                        result = value.getNumericValue();\n+                        break;\n+                    case STRUCT:\n+                        FieldList subFields = fields.get(i).getSubFields();\n+                        FieldValueList subValues = value.getRecordValue();\n+                        List<Object> subResults = parseResults(subValues, subFields);\n+\n+                        // returns List<Object>\n+                        result = subResults;\n+                        break;\n+                    case DATE:\n+                        // returns Date\n+                        result = new SimpleDateFormat(\"yyyy-MM-dd\").parse(value.getStringValue());\n+                        break;\n+                    case DATETIME:\n+                        // returns Date\n+                        result = new SimpleDateFormat(\"yyyy-MM-dd'T'hh:mm:ss.SSSSSS\").parse(value.getStringValue());\n+                        break;\n+                    case TIME:\n+                        // returns Date\n+                        result = new SimpleDateFormat(\"hh:mm:ss.SSSSSS\").parse(value.getStringValue());\n+                        break;\n+                    case TIMESTAMP:\n+                        // returns Date\n+                        result = new SimpleDateFormat(\"yyyy-MM-dd hh:mm:ss.SSSSSS zzz\").parse(value.getStringValue());\n+                        break;\n+                    case STRING: default:", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "62580d98c6616be21af5770c7c2c5c6843f09868"}, "originalPosition": 57}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkxNDYzNjQ5OnYy", "diffSide": "RIGHT", "path": "tools/query_verification/src/main/java/com/google/bigquery/BigQueryManager.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQxOToyMzoyMFrOG9BH-Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQxOToyMzoyMFrOG9BH-Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjYzNDc0NQ==", "bodyText": "I think we can remove all these // returns comments, the type information is already present", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/139#discussion_r466634745", "createdAt": "2020-08-06T19:23:20Z", "author": {"login": "Luminarys"}, "path": "tools/query_verification/src/main/java/com/google/bigquery/BigQueryManager.java", "diffHunk": "@@ -279,8 +281,55 @@ public String getName() {\n             StandardSQLTypeName type = fields.get(i).getType().getStandardType();\n \n             Object result;\n-            // TODO Convert value to appropriate Java type\n-            result = value.getStringValue();\n+            try {\n+                switch (type) {\n+                    case BOOL:\n+                        // returns boolean", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "62580d98c6616be21af5770c7c2c5c6843f09868"}, "originalPosition": 18}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkxNDY1Mjk1OnYy", "diffSide": "RIGHT", "path": "tools/query_verification/src/main/java/com/google/bigquery/QueryVerifier.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQxOToyODoyMlrOG9BSZw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQyMzoyNzoxNlrOG9Hc9A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjYzNzQxNQ==", "bodyText": "Why does this have to be an if condition? I would assume we'd want to return information around differences in row counts etc.", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/139#discussion_r466637415", "createdAt": "2020-08-06T19:28:22Z", "author": {"login": "Luminarys"}, "path": "tools/query_verification/src/main/java/com/google/bigquery/QueryVerifier.java", "diffHunk": "@@ -112,5 +117,43 @@ public void verifyDataAware() throws InterruptedException {\n         System.out.println(\"Data-Aware Verification Completed\");\n     }\n \n+    /**\n+     * Finds extra and missing results by locating the differences between the results.\n+     * @param migratedResults Parsed results returned from BQ\n+     * @param originalResults Parsed results returned from original data warehouse service\n+     * @return Differences classified as either extra or missing from migrated results.\n+     */\n+    public ResultDifferences compareResults(List<QueryJobResults> migratedResults, List<QueryJobResults> originalResults) {\n+        // Check if same amount of queries were run\n+        if (migratedResults.size() == originalResults.size()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "62580d98c6616be21af5770c7c2c5c6843f09868"}, "originalPosition": 44}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjY1MzU5OA==", "bodyText": "This is actually just checking if the same number of query statements were run. If they are not equal, that means either migratedResults or originalResults has the results of queries that aren't in the other and it'd be difficult to determine which ones those are", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/139#discussion_r466653598", "createdAt": "2020-08-06T19:59:32Z", "author": {"login": "krishsuchdev"}, "path": "tools/query_verification/src/main/java/com/google/bigquery/QueryVerifier.java", "diffHunk": "@@ -112,5 +117,43 @@ public void verifyDataAware() throws InterruptedException {\n         System.out.println(\"Data-Aware Verification Completed\");\n     }\n \n+    /**\n+     * Finds extra and missing results by locating the differences between the results.\n+     * @param migratedResults Parsed results returned from BQ\n+     * @param originalResults Parsed results returned from original data warehouse service\n+     * @return Differences classified as either extra or missing from migrated results.\n+     */\n+    public ResultDifferences compareResults(List<QueryJobResults> migratedResults, List<QueryJobResults> originalResults) {\n+        // Check if same amount of queries were run\n+        if (migratedResults.size() == originalResults.size()) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjYzNzQxNQ=="}, "originalCommit": {"oid": "62580d98c6616be21af5770c7c2c5c6843f09868"}, "originalPosition": 44}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjczODQyMA==", "bodyText": "I see, makes sense then. Thanks!", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/139#discussion_r466738420", "createdAt": "2020-08-06T23:27:16Z", "author": {"login": "Luminarys"}, "path": "tools/query_verification/src/main/java/com/google/bigquery/QueryVerifier.java", "diffHunk": "@@ -112,5 +117,43 @@ public void verifyDataAware() throws InterruptedException {\n         System.out.println(\"Data-Aware Verification Completed\");\n     }\n \n+    /**\n+     * Finds extra and missing results by locating the differences between the results.\n+     * @param migratedResults Parsed results returned from BQ\n+     * @param originalResults Parsed results returned from original data warehouse service\n+     * @return Differences classified as either extra or missing from migrated results.\n+     */\n+    public ResultDifferences compareResults(List<QueryJobResults> migratedResults, List<QueryJobResults> originalResults) {\n+        // Check if same amount of queries were run\n+        if (migratedResults.size() == originalResults.size()) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjYzNzQxNQ=="}, "originalCommit": {"oid": "62580d98c6616be21af5770c7c2c5c6843f09868"}, "originalPosition": 44}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkxNTI5ODMzOnYy", "diffSide": "RIGHT", "path": "tools/query_verification/src/main/java/com/google/bigquery/BigQueryManager.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQyMzoyNToxNVrOG9Ha1A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wN1QwMDozMjozNlrOG9IjLQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjczNzg3Ng==", "bodyText": "Don't forget the break", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/139#discussion_r466737876", "createdAt": "2020-08-06T23:25:15Z", "author": {"login": "Luminarys"}, "path": "tools/query_verification/src/main/java/com/google/bigquery/BigQueryManager.java", "diffHunk": "@@ -279,8 +281,46 @@ public String getName() {\n             StandardSQLTypeName type = fields.get(i).getType().getStandardType();\n \n             Object result;\n-            // TODO Convert value to appropriate Java type\n-            result = value.getStringValue();\n+            try {\n+                switch (type) {\n+                    case BOOL:\n+                        result = value.getBooleanValue();\n+                        break;\n+                    case FLOAT64:\n+                        result = value.getDoubleValue();\n+                        break;\n+                    case INT64:\n+                        result = value.getLongValue();\n+                        break;\n+                    case NUMERIC:\n+                        result = value.getNumericValue();\n+                        break;\n+                    case STRUCT:\n+                        FieldList subFields = fields.get(i).getSubFields();\n+                        FieldValueList subValues = value.getRecordValue();\n+                        result = parseResults(subValues, subFields);\n+                        break;\n+                    case DATE:\n+                        result = new SimpleDateFormat(\"yyyy-MM-dd\").parse(value.getStringValue());\n+                        break;\n+                    case DATETIME:\n+                        result = new SimpleDateFormat(\"yyyy-MM-dd'T'hh:mm:ss.SSSSSS\").parse(value.getStringValue());\n+                        break;\n+                    case TIME:\n+                        result = new SimpleDateFormat(\"hh:mm:ss.SSSSSS\").parse(value.getStringValue());\n+                        break;\n+                    case TIMESTAMP:\n+                        result = new SimpleDateFormat(\"yyyy-MM-dd hh:mm:ss.SSSSSS zzz\").parse(value.getStringValue());\n+                        break;\n+                    case STRING:\n+                        result = value.getStringValue();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "343196288dbabd69bc1005dab7b7453b86e206b0"}, "originalPosition": 47}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Njc1NjM5Nw==", "bodyText": "Ah, good catch!", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/139#discussion_r466756397", "createdAt": "2020-08-07T00:32:36Z", "author": {"login": "krishsuchdev"}, "path": "tools/query_verification/src/main/java/com/google/bigquery/BigQueryManager.java", "diffHunk": "@@ -279,8 +281,46 @@ public String getName() {\n             StandardSQLTypeName type = fields.get(i).getType().getStandardType();\n \n             Object result;\n-            // TODO Convert value to appropriate Java type\n-            result = value.getStringValue();\n+            try {\n+                switch (type) {\n+                    case BOOL:\n+                        result = value.getBooleanValue();\n+                        break;\n+                    case FLOAT64:\n+                        result = value.getDoubleValue();\n+                        break;\n+                    case INT64:\n+                        result = value.getLongValue();\n+                        break;\n+                    case NUMERIC:\n+                        result = value.getNumericValue();\n+                        break;\n+                    case STRUCT:\n+                        FieldList subFields = fields.get(i).getSubFields();\n+                        FieldValueList subValues = value.getRecordValue();\n+                        result = parseResults(subValues, subFields);\n+                        break;\n+                    case DATE:\n+                        result = new SimpleDateFormat(\"yyyy-MM-dd\").parse(value.getStringValue());\n+                        break;\n+                    case DATETIME:\n+                        result = new SimpleDateFormat(\"yyyy-MM-dd'T'hh:mm:ss.SSSSSS\").parse(value.getStringValue());\n+                        break;\n+                    case TIME:\n+                        result = new SimpleDateFormat(\"hh:mm:ss.SSSSSS\").parse(value.getStringValue());\n+                        break;\n+                    case TIMESTAMP:\n+                        result = new SimpleDateFormat(\"yyyy-MM-dd hh:mm:ss.SSSSSS zzz\").parse(value.getStringValue());\n+                        break;\n+                    case STRING:\n+                        result = value.getStringValue();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjczNzg3Ng=="}, "originalCommit": {"oid": "343196288dbabd69bc1005dab7b7453b86e206b0"}, "originalPosition": 47}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkxNTMxMjc3OnYy", "diffSide": "RIGHT", "path": "tools/query_verification/src/main/java/com/google/bigquery/BigQueryManager.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQyMzozMjo1OVrOG9HjfQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMFQyMjoxNjowOFrOG-hqJg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Njc0MDA5Mw==", "bodyText": "Zihao did you want each object to be Optional or did you want an empty Optional added like this? I actually think null is ok in this situation.", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/139#discussion_r466740093", "createdAt": "2020-08-06T23:32:59Z", "author": {"login": "Luminarys"}, "path": "tools/query_verification/src/main/java/com/google/bigquery/BigQueryManager.java", "diffHunk": "@@ -279,8 +281,46 @@ public String getName() {\n             StandardSQLTypeName type = fields.get(i).getType().getStandardType();\n \n             Object result;\n-            // TODO Convert value to appropriate Java type\n-            result = value.getStringValue();\n+            try {\n+                switch (type) {\n+                    case BOOL:\n+                        result = value.getBooleanValue();\n+                        break;\n+                    case FLOAT64:\n+                        result = value.getDoubleValue();\n+                        break;\n+                    case INT64:\n+                        result = value.getLongValue();\n+                        break;\n+                    case NUMERIC:\n+                        result = value.getNumericValue();\n+                        break;\n+                    case STRUCT:\n+                        FieldList subFields = fields.get(i).getSubFields();\n+                        FieldValueList subValues = value.getRecordValue();\n+                        result = parseResults(subValues, subFields);\n+                        break;\n+                    case DATE:\n+                        result = new SimpleDateFormat(\"yyyy-MM-dd\").parse(value.getStringValue());\n+                        break;\n+                    case DATETIME:\n+                        result = new SimpleDateFormat(\"yyyy-MM-dd'T'hh:mm:ss.SSSSSS\").parse(value.getStringValue());\n+                        break;\n+                    case TIME:\n+                        result = new SimpleDateFormat(\"hh:mm:ss.SSSSSS\").parse(value.getStringValue());\n+                        break;\n+                    case TIMESTAMP:\n+                        result = new SimpleDateFormat(\"yyyy-MM-dd hh:mm:ss.SSSSSS zzz\").parse(value.getStringValue());\n+                        break;\n+                    case STRING:\n+                        result = value.getStringValue();\n+                    default:\n+                        // Handle unknown/unsupported types as String\n+                        result = value.getStringValue();\n+                }\n+            } catch (ParseException e) {\n+                result = Optional.empty();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "343196288dbabd69bc1005dab7b7453b86e206b0"}, "originalPosition": 53}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODIxNjM1OA==", "bodyText": "I think Optional.empty() looks good. My impression is java guide suggests to use optional whenever applicable.", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/139#discussion_r468216358", "createdAt": "2020-08-10T22:16:08Z", "author": {"login": "yzhvictor"}, "path": "tools/query_verification/src/main/java/com/google/bigquery/BigQueryManager.java", "diffHunk": "@@ -279,8 +281,46 @@ public String getName() {\n             StandardSQLTypeName type = fields.get(i).getType().getStandardType();\n \n             Object result;\n-            // TODO Convert value to appropriate Java type\n-            result = value.getStringValue();\n+            try {\n+                switch (type) {\n+                    case BOOL:\n+                        result = value.getBooleanValue();\n+                        break;\n+                    case FLOAT64:\n+                        result = value.getDoubleValue();\n+                        break;\n+                    case INT64:\n+                        result = value.getLongValue();\n+                        break;\n+                    case NUMERIC:\n+                        result = value.getNumericValue();\n+                        break;\n+                    case STRUCT:\n+                        FieldList subFields = fields.get(i).getSubFields();\n+                        FieldValueList subValues = value.getRecordValue();\n+                        result = parseResults(subValues, subFields);\n+                        break;\n+                    case DATE:\n+                        result = new SimpleDateFormat(\"yyyy-MM-dd\").parse(value.getStringValue());\n+                        break;\n+                    case DATETIME:\n+                        result = new SimpleDateFormat(\"yyyy-MM-dd'T'hh:mm:ss.SSSSSS\").parse(value.getStringValue());\n+                        break;\n+                    case TIME:\n+                        result = new SimpleDateFormat(\"hh:mm:ss.SSSSSS\").parse(value.getStringValue());\n+                        break;\n+                    case TIMESTAMP:\n+                        result = new SimpleDateFormat(\"yyyy-MM-dd hh:mm:ss.SSSSSS zzz\").parse(value.getStringValue());\n+                        break;\n+                    case STRING:\n+                        result = value.getStringValue();\n+                    default:\n+                        // Handle unknown/unsupported types as String\n+                        result = value.getStringValue();\n+                }\n+            } catch (ParseException e) {\n+                result = Optional.empty();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Njc0MDA5Mw=="}, "originalCommit": {"oid": "343196288dbabd69bc1005dab7b7453b86e206b0"}, "originalPosition": 53}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3095, "cost": 1, "resetAt": "2021-11-12T19:05:54Z"}}}