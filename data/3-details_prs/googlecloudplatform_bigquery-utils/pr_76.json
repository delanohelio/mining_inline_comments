{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQxNjcxMjcy", "number": 76, "title": "SQL Crawler: Implemented generic extraction", "bodyText": "Allows user to extract queries from a page, even without knowing HTML formatting", "createdAt": "2020-06-29T21:59:55Z", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/76", "merged": true, "mergeCommit": {"oid": "db16bffc6755b014f580435635390d81b0b1c747"}, "closed": true, "closedAt": "2020-07-06T23:25:57Z", "author": {"login": "noah-kuo"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcwIWMqAH2gAyNDQxNjcxMjcyOmRiYTM1NGVjMmZkOGJhMmRmOGNhYTFjYWUzYmQ2ZDkwMDljYzJkZmQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcyYKEggH2gAyNDQxNjcxMjcyOjg3ODM4NGFmYTNmZjI1N2Y3YmI2MGExYzE3NjU1OTExNjU1NWFkMmQ=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "dba354ec2fd8ba2df8caa1cae3bd6d9009cc2dfd", "author": {"user": {"login": "noah-kuo", "name": "Noah Kuo"}}, "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/dba354ec2fd8ba2df8caa1cae3bd6d9009cc2dfd", "committedDate": "2020-06-29T21:57:56Z", "message": "Implemented generic extraction"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQwMTgwODEw", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/76#pullrequestreview-440180810", "createdAt": "2020-06-30T16:19:01Z", "commit": {"oid": "dba354ec2fd8ba2df8caa1cae3bd6d9009cc2dfd"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0zMFQxNjoxOTowMVrOGrEM4g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0zMFQxNjoxOTo0NVrOGrEOsA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzgxMDc4Ng==", "bodyText": "Maybe define this as a separate const string. I think this can be longer in the future when you cover insert, update, merge, etc.", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/76#discussion_r447810786", "createdAt": "2020-06-30T16:19:01Z", "author": {"login": "yzhvictor"}, "path": "tools/unsupervised_dataset/sql_crawler/extraction_modules/generic_extraction_module.py", "diffHunk": "@@ -1,8 +1,32 @@\n-class GenericExtractionModule(object):\n+\"\"\" Collects SQL queries from any website \"\"\"\n+import html\n+import re\n+\n+class GenericExtractionModule():\n     \"\"\" A module to extract SQL queries from any website without knowing the HTML\n         format of a site.\n     \"\"\"\n \n-    def find_queries(html):\n-        #TODO(Noah): Implement generic module\n-        return []\n+    def find_queries(html_response):\n+        \"\"\" Finds queries and extracts them from any website, without using HTML\n+        tags to locate them.\n+\n+        Args:\n+            html: HTML response which contains HTML text\n+\n+        Returns\n+            A list of queries in the form of strings.\n+        \"\"\"\n+        # Remove HTML tags and special characters\n+        content = html_response.text\n+        converted = html.unescape(content)\n+        tags_removed = re.sub('<[^<]+?>', '', converted)\n+\n+        # Look for text that matches common SQL queries\n+        matches = re.findall(r\"(?:SELECT|WITH|CREATE)[^;]*;\", tags_removed)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dba354ec2fd8ba2df8caa1cae3bd6d9009cc2dfd"}, "originalPosition": 30}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzgxMTI0OA==", "bodyText": "Let's always have some test coverage for new code added, thanks.", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/76#discussion_r447811248", "createdAt": "2020-06-30T16:19:45Z", "author": {"login": "yzhvictor"}, "path": "tools/unsupervised_dataset/sql_crawler/extraction_modules/generic_extraction_module.py", "diffHunk": "@@ -1,8 +1,32 @@\n-class GenericExtractionModule(object):\n+\"\"\" Collects SQL queries from any website \"\"\"\n+import html\n+import re\n+\n+class GenericExtractionModule():\n     \"\"\" A module to extract SQL queries from any website without knowing the HTML\n         format of a site.\n     \"\"\"\n \n-    def find_queries(html):\n-        #TODO(Noah): Implement generic module\n-        return []\n+    def find_queries(html_response):", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dba354ec2fd8ba2df8caa1cae3bd6d9009cc2dfd"}, "originalPosition": 14}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "390e391a0dc8646651b107eb7f18029d6b3e6edb", "author": {"user": {"login": "noah-kuo", "name": "Noah Kuo"}}, "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/390e391a0dc8646651b107eb7f18029d6b3e6edb", "committedDate": "2020-06-30T19:07:19Z", "message": "Added tests"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQwMzI5NTg0", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/76#pullrequestreview-440329584", "createdAt": "2020-06-30T19:41:07Z", "commit": {"oid": "dba354ec2fd8ba2df8caa1cae3bd6d9009cc2dfd"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0zMFQxOTo0MTowN1rOGrLwiw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0zMFQxOTo0MTowN1rOGrLwiw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzkzNDYwMw==", "bodyText": "Use const string too?", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/76#discussion_r447934603", "createdAt": "2020-06-30T19:41:07Z", "author": {"login": "kikkyo"}, "path": "tools/unsupervised_dataset/sql_crawler/extractor.py", "diffHunk": "@@ -64,5 +64,4 @@ def retrieve_module(url):\n     if \"cloud.google.com\" in url:", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dba354ec2fd8ba2df8caa1cae3bd6d9009cc2dfd"}, "originalPosition": 1}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e211c41cdb1b6d88925d6fbfe69f95ebd543fcdc", "author": {"user": {"login": "noah-kuo", "name": "Noah Kuo"}}, "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/e211c41cdb1b6d88925d6fbfe69f95ebd543fcdc", "committedDate": "2020-06-30T20:00:37Z", "message": "Changed urls to constants"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "17d8d259fde115fddce1c1183add69c8477fd04a", "author": {"user": {"login": "noah-kuo", "name": "Noah Kuo"}}, "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/17d8d259fde115fddce1c1183add69c8477fd04a", "committedDate": "2020-06-30T20:01:21Z", "message": "Merge branch 'master' into generic_extraction"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQxMDUxMzQz", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/76#pullrequestreview-441051343", "createdAt": "2020-07-01T17:06:41Z", "commit": {"oid": "17d8d259fde115fddce1c1183add69c8477fd04a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQzNDE3MTM4", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/76#pullrequestreview-443417138", "createdAt": "2020-07-06T21:24:36Z", "commit": {"oid": "17d8d259fde115fddce1c1183add69c8477fd04a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "878384afa3ff257f7bb60a1c176559116555ad2d", "author": {"user": {"login": "noah-kuo", "name": "Noah Kuo"}}, "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/878384afa3ff257f7bb60a1c176559116555ad2d", "committedDate": "2020-07-06T21:31:01Z", "message": "Merge branch 'master' into generic_extraction"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 594, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}