{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTAwMjE1NTQx", "number": 1775, "title": "changed B3Propagator to default to inject/extra single header", "bodyText": "resolves #1684\nWasn't sure what you had in mind for making the B3Propagator configurable so I added a builder that can configure creation of it.\nDefault (inject single header)\nB3Propagator.getInstance();\n\nUsing builder\n    B3Propagator.builder()\n      .injectFromMultipleHeaders()\n      .build();", "createdAt": "2020-10-08T22:05:03Z", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1775", "merged": true, "mergeCommit": {"oid": "05646477a88ae7d273cdc132d278c284f6c5c920"}, "closed": true, "closedAt": "2020-10-12T22:23:29Z", "author": {"login": "jarebudev"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdQo0RJgH2gAyNTAwMjE1NTQxOjBiYjRkZjBkNjBmMjkxZTRlNWU0MTZhYjVkOTkyNTNlOTcwMjllNDE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdR7FgvAH2gAyNTAwMjE1NTQxOmEwM2RkMzdmNjNiZDFmNDc2MmMyNjZkMjdlMzZmYWEwMzQ2ZmRiZDU=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "0bb4df0d60f291e4e5e416ab5d99253e97029e41", "author": {"user": {"login": "jarebudev", "name": null}}, "url": "https://github.com/open-telemetry/opentelemetry-java/commit/0bb4df0d60f291e4e5e416ab5d99253e97029e41", "committedDate": "2020-10-08T21:53:19Z", "message": "changed B3Propagator to default to inject/extra single header, and allow multiple headers to be injected by creating propagator via a builder"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA1MjQzOTgz", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1775#pullrequestreview-505243983", "createdAt": "2020-10-08T23:28:21Z", "commit": {"oid": "0bb4df0d60f291e4e5e416ab5d99253e97029e41"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOFQyMzoyODoyMlrOHe0WCA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOFQyMzoyODoyMlrOHe0WCA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjA3NjkzNg==", "bodyText": "Any thoughts about using Optional<Context> as the return type, now that we have java 8?", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1775#discussion_r502076936", "createdAt": "2020-10-08T23:28:22Z", "author": {"login": "jkwatson"}, "path": "extensions/trace_propagators/src/main/java/io/opentelemetry/extensions/trace/propagation/B3PropagatorExtractor.java", "diffHunk": "@@ -7,10 +7,12 @@\n \n import io.grpc.Context;\n import io.opentelemetry.context.propagation.TextMapPropagator;\n+import javax.annotation.Nullable;\n import javax.annotation.concurrent.Immutable;\n \n @Immutable\n interface B3PropagatorExtractor {\n \n+  @Nullable", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0bb4df0d60f291e4e5e416ab5d99253e97029e41"}, "originalPosition": 10}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "45d2d190961f0da7af9e62464f37130d52e29378", "author": {"user": {"login": "jarebudev", "name": null}}, "url": "https://github.com/open-telemetry/opentelemetry-java/commit/45d2d190961f0da7af9e62464f37130d52e29378", "committedDate": "2020-10-10T10:13:14Z", "message": "changed to return Optional instead of null from B3PropagatorExtractor"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA2MTEyMjIx", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1775#pullrequestreview-506112221", "createdAt": "2020-10-10T17:07:49Z", "commit": {"oid": "45d2d190961f0da7af9e62464f37130d52e29378"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA2Mzg0Mjgz", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1775#pullrequestreview-506384283", "createdAt": "2020-10-12T08:06:15Z", "commit": {"oid": "45d2d190961f0da7af9e62464f37130d52e29378"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA2NDY3MDEy", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1775#pullrequestreview-506467012", "createdAt": "2020-10-12T09:49:57Z", "commit": {"oid": "45d2d190961f0da7af9e62464f37130d52e29378"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xMlQwOTo0OTo1OFrOHf3bgg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xMlQwOTo0OTo1OFrOHf3bgg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzE3NjA2Ng==", "bodyText": "Inject happens to headers, not from. But how about just injectMultipleHeaders?", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1775#discussion_r503176066", "createdAt": "2020-10-12T09:49:58Z", "author": {"login": "anuraaga"}, "path": "extensions/trace_propagators/src/main/java/io/opentelemetry/extensions/trace/propagation/B3Propagator.java", "diffHunk": "@@ -31,44 +58,54 @@\n   private static final List<String> FIELDS =\n       Collections.unmodifiableList(Arrays.asList(TRACE_ID_HEADER, SPAN_ID_HEADER, SAMPLED_HEADER));\n \n+  private static final B3Propagator INSTANCE = B3Propagator.builder().build();\n+\n+  private final B3PropagatorExtractor singleHeaderExtractor =\n+      new B3PropagatorExtractorSingleHeader();\n+  private final B3PropagatorExtractor multipleHeadersExtractor =\n+      new B3PropagatorExtractorMultipleHeaders();\n   private final B3PropagatorInjector b3PropagatorInjector;\n-  private final B3PropagatorExtractor b3PropagatorExtractor;\n \n-  private static final B3Propagator SINGLE_HEADER =\n-      new B3Propagator(\n-          new B3PropagatorInjectorSingleHeader(), new B3PropagatorExtractorSingleHeader());\n-  private static final B3Propagator MULTI_HEADER =\n-      new B3Propagator(\n-          new B3PropagatorInjectorMultipleHeaders(), new B3PropagatorExtractorMultipleHeaders());\n+  private B3Propagator(B3PropagatorInjector b3PropagatorInjector) {\n+    this.b3PropagatorInjector = b3PropagatorInjector;\n+  }\n \n   /**\n-   * Returns an instance of {@link B3Propagator} with Single Header Implementation of B3 propagation\n-   * protocol. See <a\n-   * href=https://github.com/openzipkin/b3-propagation#single-header>openzipkin/b3-propagation#single-header</a>.\n-   *\n-   * @return Returns an instance of {@link B3Propagator} with Single Header implementation of B3\n-   *     propagation protocol.\n+   * Returns a new {@link B3Propagator.Builder} instance for configuring injection option for {@link\n+   * B3Propagator}.\n    */\n-  public static B3Propagator getSingleHeaderPropagator() {\n-    return SINGLE_HEADER;\n+  public static B3Propagator.Builder builder() {\n+    return new Builder();\n   }\n \n   /**\n-   * Returns an instance of {@link B3Propagator} with Multiple Header Implementation of B3\n-   * propagation protocol. See <a\n-   * href=https://github.com/openzipkin/b3-propagation#multiple-headers>openzipkin/b3-propagation#multiple-headers</a>.\n-   *\n-   * @return Returns an instance of {@link B3Propagator} with Multiple Header implementation of B3\n-   *     propagation protocol.\n+   * Enables the creation of an {@link B3Propagator} instance with the ability to switch injector\n+   * from single header (default) to multiple headers.\n    */\n-  public static B3Propagator getMultipleHeaderPropagator() {\n-    return MULTI_HEADER;\n+  public static class Builder {\n+    private boolean injectSingleHeader;\n+\n+    private Builder() {\n+      injectSingleHeader = true;\n+    }\n+\n+    public Builder injectFromMultipleHeaders() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "45d2d190961f0da7af9e62464f37130d52e29378"}, "originalPosition": 97}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a03dd37f63bd1f4762c266d27e36faa0346fdbd5", "author": {"user": {"login": "jarebudev", "name": null}}, "url": "https://github.com/open-telemetry/opentelemetry-java/commit/a03dd37f63bd1f4762c266d27e36faa0346fdbd5", "committedDate": "2020-10-12T21:44:22Z", "message": "tidy up method name in B3Propagator builder"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2245, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}