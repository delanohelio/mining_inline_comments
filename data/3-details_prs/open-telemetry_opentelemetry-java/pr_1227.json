{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE4NjkwODI0", "number": 1227, "title": "Move the span operations inside the scope in the http server example", "bodyText": "This shows better idiomatic usage of the API.", "createdAt": "2020-05-15T16:36:03Z", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1227", "merged": true, "mergeCommit": {"oid": "d3768b24be6226d3cdcda486e768b558ad724fc9"}, "closed": true, "closedAt": "2020-05-15T18:29:21Z", "author": {"login": "jkwatson"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABchkwAWAH2gAyNDE4NjkwODI0OmQ5ZTQzMmE0ZjM1NTAwODJlMmM3YTUxMjZiYjhhNjE1ZTIxYTQ4YWE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABchmKx6gFqTQxMjg2NTQ3Mw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "d9e432a4f3550082e2c7a5126bb8a615e21a48aa", "author": {"user": null}, "url": "https://github.com/open-telemetry/opentelemetry-java/commit/d9e432a4f3550082e2c7a5126bb8a615e21a48aa", "committedDate": "2020-05-15T16:34:36Z", "message": "Move the span operations inside the scope, to show better idiomatic usage of the API."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEyODAyNjI2", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1227#pullrequestreview-412802626", "createdAt": "2020-05-15T16:38:26Z", "commit": {"oid": "d9e432a4f3550082e2c7a5126bb8a615e21a48aa"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNVQxNjozODoyNlrOGWMHNQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNVQxNjozODoyNlrOGWMHNQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTkyMDMwOQ==", "bodyText": "(This heh golang style param name distracts me, hah)", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1227#discussion_r425920309", "createdAt": "2020-05-15T16:38:26Z", "author": {"login": "carlosalberto"}, "path": "examples/http/src/main/java/io/opentelemetry/example/http/HttpServer.java", "diffHunk": "@@ -55,25 +55,26 @@ public void handle(HttpExchange he) throws IOException {\n       try (Scope scope = ContextUtils.withScopedContext(ctx)) {\n         // Build a span automatically using the received context\n         span = spanBuilder.startSpan();\n-      }\n \n-      // Set the Semantic Convention\n-      span.setAttribute(\"component\", \"http\");\n-      span.setAttribute(\"http.method\", \"GET\");\n-      /*\n-      One of the following is required:\n-      - http.scheme, http.host, http.target\n-      - http.scheme, http.server_name, net.host.port, http.target\n-      - http.scheme, net.host.name, net.host.port, http.target\n-      - http.url\n-      */\n-      span.setAttribute(\"http.scheme\", \"http\");\n-      span.setAttribute(\"http.host\", \"localhost:\" + HttpServer.port);\n-      span.setAttribute(\"http.target\", \"/\");\n-      // Process the request\n-      answer(he, span);\n-      // Close the span\n-      span.end();\n+        // Set the Semantic Convention\n+        span.setAttribute(\"component\", \"http\");\n+        span.setAttribute(\"http.method\", \"GET\");\n+        /*\n+         One of the following is required:\n+         - http.scheme, http.host, http.target\n+         - http.scheme, http.server_name, net.host.port, http.target\n+         - http.scheme, net.host.name, net.host.port, http.target\n+         - http.url\n+        */\n+        span.setAttribute(\"http.scheme\", \"http\");\n+        span.setAttribute(\"http.host\", \"localhost:\" + HttpServer.port);\n+        span.setAttribute(\"http.target\", \"/\");\n+        // Process the request\n+        answer(he, span);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d9e432a4f3550082e2c7a5126bb8a615e21a48aa"}, "originalPosition": 46}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEyODAyNjk2", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1227#pullrequestreview-412802696", "createdAt": "2020-05-15T16:38:31Z", "commit": {"oid": "d9e432a4f3550082e2c7a5126bb8a615e21a48aa"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "694ae4c1e09c93cd6bebe01870170800a4ad5864", "author": {"user": null}, "url": "https://github.com/open-telemetry/opentelemetry-java/commit/694ae4c1e09c93cd6bebe01870170800a4ad5864", "committedDate": "2020-05-15T16:50:58Z", "message": "rename parameter"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEyODE0Njkx", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1227#pullrequestreview-412814691", "createdAt": "2020-05-15T16:56:24Z", "commit": {"oid": "694ae4c1e09c93cd6bebe01870170800a4ad5864"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNVQxNjo1NjoyNVrOGWMsZw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNVQxNjo1NjoyNVrOGWMsZw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTkyOTgzMQ==", "bodyText": "Confused a bit and I would rewrite:\n      // Extract the context from the HTTP request\n      Context context =\n          OpenTelemetry.getPropagators().getHttpTextFormat().extract(Context.current(), he, getter);\n          OpenTelemetry.getPropagators().getHttpTextFormat().extract(Context.current(), exchange, getter);\n\n      Span.Builder spanBuilder = tracer.spanBuilder(\"/\").setSpanKind(Span.Kind.SERVER).setParent(TraceContextUtils.getSpan(context));\n      Span span = spanBuilder.startSpan();\n\ntry (Scope scope = TraceContextUtils.withSpan(span)) {\n        // Set the Semantic Convention\n        span.setAttribute(\"component\", \"http\");\n        span.setAttribute(\"http.method\", \"GET\");\n        /*\n         One of the following is required:\n         - http.scheme, http.host, http.target\n         - http.scheme, http.server_name, net.host.port, http.target\n         - http.scheme, net.host.name, net.host.port, http.target\n         - http.url\n        */\n        span.setAttribute(\"http.scheme\", \"http\");\n        span.setAttribute(\"http.host\", \"localhost:\" + HttpServer.port);\n        span.setAttribute(\"http.target\", \"/\");\n        // Process the request\n        answer(exchange, span);\n      } finally {\n        // Close the span\n        span.end();\n      }", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1227#discussion_r425929831", "createdAt": "2020-05-15T16:56:25Z", "author": {"login": "bogdandrutu"}, "path": "examples/http/src/main/java/io/opentelemetry/example/http/HttpServer.java", "diffHunk": "@@ -40,40 +40,41 @@\n \n public class HttpServer {\n \n-  private class HelloHandler implements HttpHandler {\n+  private static class HelloHandler implements HttpHandler {\n \n     @Override\n-    public void handle(HttpExchange he) throws IOException {\n+    public void handle(HttpExchange exchange) throws IOException {\n       // Name convention for the Span is not yet defined.\n       // See: https://github.com/open-telemetry/opentelemetry-specification/issues/270\n       Span.Builder spanBuilder = tracer.spanBuilder(\"/\").setSpanKind(Span.Kind.SERVER);\n       Span span = null;\n \n       // Extract the context from the HTTP request\n       Context ctx =\n-          OpenTelemetry.getPropagators().getHttpTextFormat().extract(Context.current(), he, getter);\n+          OpenTelemetry.getPropagators().getHttpTextFormat().extract(Context.current(), exchange, getter);\n       try (Scope scope = ContextUtils.withScopedContext(ctx)) {\n         // Build a span automatically using the received context\n         span = spanBuilder.startSpan();\n-      }\n \n-      // Set the Semantic Convention\n-      span.setAttribute(\"component\", \"http\");\n-      span.setAttribute(\"http.method\", \"GET\");\n-      /*\n-      One of the following is required:\n-      - http.scheme, http.host, http.target\n-      - http.scheme, http.server_name, net.host.port, http.target\n-      - http.scheme, net.host.name, net.host.port, http.target\n-      - http.url\n-      */\n-      span.setAttribute(\"http.scheme\", \"http\");\n-      span.setAttribute(\"http.host\", \"localhost:\" + HttpServer.port);\n-      span.setAttribute(\"http.target\", \"/\");\n-      // Process the request\n-      answer(he, span);\n-      // Close the span\n-      span.end();\n+        // Set the Semantic Convention\n+        span.setAttribute(\"component\", \"http\");\n+        span.setAttribute(\"http.method\", \"GET\");\n+        /*\n+         One of the following is required:\n+         - http.scheme, http.host, http.target\n+         - http.scheme, http.server_name, net.host.port, http.target\n+         - http.scheme, net.host.name, net.host.port, http.target\n+         - http.url\n+        */\n+        span.setAttribute(\"http.scheme\", \"http\");\n+        span.setAttribute(\"http.host\", \"localhost:\" + HttpServer.port);\n+        span.setAttribute(\"http.target\", \"/\");\n+        // Process the request\n+        answer(exchange, span);\n+      } finally {\n+        // Close the span\n+        span.end();\n+      }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "694ae4c1e09c93cd6bebe01870170800a4ad5864"}, "originalPosition": 59}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "70dd8193ae65d6d87d8c3cb833691f6e62ccdaf3", "author": {"user": null}, "url": "https://github.com/open-telemetry/opentelemetry-java/commit/70dd8193ae65d6d87d8c3cb833691f6e62ccdaf3", "committedDate": "2020-05-15T17:19:28Z", "message": "update to start the span before it is added to the scope"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEyODQ2MDAx", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1227#pullrequestreview-412846001", "createdAt": "2020-05-15T17:43:35Z", "commit": {"oid": "70dd8193ae65d6d87d8c3cb833691f6e62ccdaf3"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNVQxNzo0MzozNVrOGWOKEg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNVQxNzo0Mzo1NVrOGWOKvQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTk1MzgxMA==", "bodyText": "This should be with the new Span.", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1227#discussion_r425953810", "createdAt": "2020-05-15T17:43:35Z", "author": {"login": "bogdandrutu"}, "path": "examples/http/src/main/java/io/opentelemetry/example/http/HttpServer.java", "diffHunk": "@@ -40,40 +40,41 @@\n \n public class HttpServer {\n \n-  private class HelloHandler implements HttpHandler {\n+  private static class HelloHandler implements HttpHandler {\n \n     @Override\n-    public void handle(HttpExchange he) throws IOException {\n+    public void handle(HttpExchange exchange) throws IOException {\n       // Name convention for the Span is not yet defined.\n       // See: https://github.com/open-telemetry/opentelemetry-specification/issues/270\n       Span.Builder spanBuilder = tracer.spanBuilder(\"/\").setSpanKind(Span.Kind.SERVER);\n-      Span span = null;\n \n       // Extract the context from the HTTP request\n       Context ctx =\n-          OpenTelemetry.getPropagators().getHttpTextFormat().extract(Context.current(), he, getter);\n+          OpenTelemetry.getPropagators().getHttpTextFormat().extract(Context.current(), exchange, getter);\n+\n+      Span span = spanBuilder.startSpan();\n       try (Scope scope = ContextUtils.withScopedContext(ctx)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "70dd8193ae65d6d87d8c3cb833691f6e62ccdaf3"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTk1Mzk4MQ==", "bodyText": "Need to set as parent the Span from the returned context in the Builder.", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1227#discussion_r425953981", "createdAt": "2020-05-15T17:43:55Z", "author": {"login": "bogdandrutu"}, "path": "examples/http/src/main/java/io/opentelemetry/example/http/HttpServer.java", "diffHunk": "@@ -40,40 +40,41 @@\n \n public class HttpServer {\n \n-  private class HelloHandler implements HttpHandler {\n+  private static class HelloHandler implements HttpHandler {\n \n     @Override\n-    public void handle(HttpExchange he) throws IOException {\n+    public void handle(HttpExchange exchange) throws IOException {\n       // Name convention for the Span is not yet defined.\n       // See: https://github.com/open-telemetry/opentelemetry-specification/issues/270\n       Span.Builder spanBuilder = tracer.spanBuilder(\"/\").setSpanKind(Span.Kind.SERVER);\n-      Span span = null;\n \n       // Extract the context from the HTTP request\n       Context ctx =\n-          OpenTelemetry.getPropagators().getHttpTextFormat().extract(Context.current(), he, getter);\n+          OpenTelemetry.getPropagators().getHttpTextFormat().extract(Context.current(), exchange, getter);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "70dd8193ae65d6d87d8c3cb833691f6e62ccdaf3"}, "originalPosition": 18}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d12a7643efb93aadd5a06c3bcd0817162aba0446", "author": {"user": null}, "url": "https://github.com/open-telemetry/opentelemetry-java/commit/d12a7643efb93aadd5a06c3bcd0817162aba0446", "committedDate": "2020-05-15T18:08:01Z", "message": "properly parent the newly created span."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEyODYyNDM0", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1227#pullrequestreview-412862434", "createdAt": "2020-05-15T18:08:53Z", "commit": {"oid": "d12a7643efb93aadd5a06c3bcd0817162aba0446"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNVQxODowODo1M1rOGWO8AA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNVQxODowODo1M1rOGWO8AA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTk2NjU5Mg==", "bodyText": "is this the best way to get the parent?", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1227#discussion_r425966592", "createdAt": "2020-05-15T18:08:53Z", "author": {"login": "jkwatson"}, "path": "examples/http/src/main/java/io/opentelemetry/example/http/HttpServer.java", "diffHunk": "@@ -40,40 +40,46 @@\n \n public class HttpServer {\n \n-  private class HelloHandler implements HttpHandler {\n+  private static class HelloHandler implements HttpHandler {\n \n     @Override\n-    public void handle(HttpExchange he) throws IOException {\n+    public void handle(HttpExchange exchange) throws IOException {\n       // Name convention for the Span is not yet defined.\n       // See: https://github.com/open-telemetry/opentelemetry-specification/issues/270\n-      Span.Builder spanBuilder = tracer.spanBuilder(\"/\").setSpanKind(Span.Kind.SERVER);\n-      Span span = null;\n \n       // Extract the context from the HTTP request\n-      Context ctx =\n-          OpenTelemetry.getPropagators().getHttpTextFormat().extract(Context.current(), he, getter);\n-      try (Scope scope = ContextUtils.withScopedContext(ctx)) {\n-        // Build a span automatically using the received context\n-        span = spanBuilder.startSpan();\n+      Context context =\n+          OpenTelemetry.getPropagators()\n+              .getHttpTextFormat()\n+              .extract(Context.current(), exchange, getter);\n+\n+      Span span =\n+          tracer\n+              .spanBuilder(\"/\")\n+              .setParent(TracingContextUtils.getSpan(context))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d12a7643efb93aadd5a06c3bcd0817162aba0446"}, "originalPosition": 45}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEyODY1NDcz", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1227#pullrequestreview-412865473", "createdAt": "2020-05-15T18:13:45Z", "commit": {"oid": "d12a7643efb93aadd5a06c3bcd0817162aba0446"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2723, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}