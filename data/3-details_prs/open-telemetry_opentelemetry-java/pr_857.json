{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc1MDcxMjgy", "number": 857, "title": "Move Aggregation and connect it with Aggregator.", "bodyText": "Signed-off-by: Bogdan Cristian Drutu bogdandrutu@gmail.com", "createdAt": "2020-02-13T20:25:23Z", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/857", "merged": true, "mergeCommit": {"oid": "ea8f1d3dda4886f74ff95d16018c243bf0620b7d"}, "closed": true, "closedAt": "2020-02-13T21:03:39Z", "author": {"login": "bogdandrutu"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcEA5mxAH2gAyMzc1MDcxMjgyOmM3ZmI2NTNhNWYyZTdkZjY5NmZmOTMyYzhmMWUyMDY1NGNmMTYwYmY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcEBb4IAFqTM1ODU0ODIzNw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "c7fb653a5f2e7df696ff932c8f1e20654cf160bf", "author": {"user": {"login": "bogdandrutu", "name": "Bogdan Drutu"}}, "url": "https://github.com/open-telemetry/opentelemetry-java/commit/c7fb653a5f2e7df696ff932c8f1e20654cf160bf", "committedDate": "2020-02-13T20:24:42Z", "message": "Move Aggregation and connect it with Aggregator.\n\nSigned-off-by: Bogdan Cristian Drutu <bogdandrutu@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU4NTM4MjIw", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/857#pullrequestreview-358538220", "createdAt": "2020-02-13T20:45:25Z", "commit": {"oid": "c7fb653a5f2e7df696ff932c8f1e20654cf160bf"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xM1QyMDo0NToyNlrOFpi-RA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xM1QyMDo0NToyNlrOFpi-RA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTEwODkzMg==", "bodyText": "I think this is a no-op check, since the array that is created will always be non-null.", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/857#discussion_r379108932", "createdAt": "2020-02-13T20:45:26Z", "author": {"login": "jkwatson"}, "path": "sdk/src/main/java/io/opentelemetry/sdk/metrics/view/Aggregations.java", "diffHunk": "@@ -0,0 +1,185 @@\n+/*\n+ * Copyright 2020, OpenTelemetry Authors\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package io.opentelemetry.sdk.metrics.view;\n+\n+import io.opentelemetry.internal.Utils;\n+import io.opentelemetry.sdk.metrics.aggregator.AggregatorFactory;\n+import io.opentelemetry.sdk.metrics.aggregator.DoubleSumAggregator;\n+import io.opentelemetry.sdk.metrics.aggregator.LongSumAggregator;\n+import io.opentelemetry.sdk.metrics.aggregator.NoopAggregator;\n+import io.opentelemetry.sdk.metrics.common.InstrumentType;\n+import io.opentelemetry.sdk.metrics.common.InstrumentValueType;\n+import io.opentelemetry.sdk.metrics.data.MetricData.Descriptor.Type;\n+import javax.annotation.concurrent.Immutable;\n+\n+public class Aggregations {\n+\n+  /**\n+   * Aggregation that calculates sum of recorded measurements.\n+   *\n+   * @since 0.1.0\n+   */\n+  public static Aggregation sum() {\n+    return Sum.INSTANCE;\n+  }\n+\n+  /**\n+   * Aggregation that calculates count of recorded measurements (the number of recorded\n+   * measurements).\n+   *\n+   * @since 0.1.0\n+   */\n+  public static Aggregation count() {\n+    return Count.INSTANCE;\n+  }\n+\n+  /**\n+   * Aggregation that calculates distribution stats on recorded measurements. Distribution includes\n+   * sum, count, histogram, and sum of squared deviations.\n+   *\n+   * <p>The boundaries for the buckets in the underlying histogram needs to be sorted.\n+   *\n+   * @param bucketBoundaries bucket boundaries to use for distribution.\n+   * @return a new {@code Distribution}.\n+   * @since 0.1.0\n+   */\n+  public static Aggregation distributionWithExplicitBounds(Double... bucketBoundaries) {\n+    return new Distribution(bucketBoundaries);\n+  }\n+\n+  /**\n+   * Aggregation that calculates the last value of all recorded measurements.\n+   *\n+   * @since 0.1.0\n+   */\n+  public static Aggregation lastValue() {\n+    return LastValue.INSTANCE;\n+  }\n+\n+  @Immutable\n+  private enum Sum implements Aggregation {\n+    INSTANCE;\n+\n+    @Override\n+    public AggregatorFactory getAggregatorFactory(InstrumentValueType instrumentValueType) {\n+      return instrumentValueType == InstrumentValueType.LONG\n+          ? LongSumAggregator.getFactory()\n+          : DoubleSumAggregator.getFactory();\n+    }\n+\n+    @Override\n+    public Type getDescriptorType(\n+        InstrumentType instrumentType, InstrumentValueType instrumentValueType) {\n+      switch (instrumentType) {\n+        case COUNTER_MONOTONIC:\n+        case MEASURE_ABSOLUTE:\n+        case OBSERVER_MONOTONIC:\n+          return instrumentValueType == InstrumentValueType.LONG\n+              ? Type.MONOTONIC_LONG\n+              : Type.MONOTONIC_DOUBLE;\n+        case COUNTER_NON_MONOTONIC:\n+        case MEASURE_NON_ABSOLUTE:\n+        case OBSERVER_NON_MONOTONIC:\n+          return instrumentValueType == InstrumentValueType.LONG\n+              ? Type.NON_MONOTONIC_LONG\n+              : Type.NON_MONOTONIC_DOUBLE;\n+      }\n+      throw new IllegalArgumentException(\"This should not happen\");\n+    }\n+\n+    @Override\n+    public boolean availableForInstrument(InstrumentType instrumentType) {\n+      // Available for all instruments.\n+      return true;\n+    }\n+  }\n+\n+  @Immutable\n+  private enum Count implements Aggregation {\n+    INSTANCE;\n+\n+    @Override\n+    public AggregatorFactory getAggregatorFactory(InstrumentValueType instrumentValueType) {\n+      // TODO: Implement count aggregator and use it here.\n+      return NoopAggregator.getFactory();\n+    }\n+\n+    @Override\n+    public Type getDescriptorType(\n+        InstrumentType instrumentType, InstrumentValueType instrumentValueType) {\n+      return Type.MONOTONIC_LONG;\n+    }\n+\n+    @Override\n+    public boolean availableForInstrument(InstrumentType instrumentType) {\n+      // It is not available for Observer instruments.\n+      return instrumentType != InstrumentType.OBSERVER_MONOTONIC\n+          && instrumentType != InstrumentType.OBSERVER_NON_MONOTONIC;\n+    }\n+  }\n+\n+  @Immutable\n+  private static final class Distribution implements Aggregation {\n+    private final AggregatorFactory factory;\n+\n+    Distribution(Double... bucketBoundaries) {\n+      Utils.checkNotNull(bucketBoundaries, \"bucketBoundaries\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c7fb653a5f2e7df696ff932c8f1e20654cf160bf"}, "originalPosition": 140}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU4NTM4ODkx", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/857#pullrequestreview-358538891", "createdAt": "2020-02-13T20:46:34Z", "commit": {"oid": "c7fb653a5f2e7df696ff932c8f1e20654cf160bf"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xM1QyMDo0NjozNFrOFpjALw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xM1QyMDo0NjozNFrOFpjALw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTEwOTQyMw==", "bodyText": "change message to \"Unsupported instrument/value types\"", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/857#discussion_r379109423", "createdAt": "2020-02-13T20:46:34Z", "author": {"login": "jkwatson"}, "path": "sdk/src/main/java/io/opentelemetry/sdk/metrics/view/Aggregations.java", "diffHunk": "@@ -0,0 +1,185 @@\n+/*\n+ * Copyright 2020, OpenTelemetry Authors\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package io.opentelemetry.sdk.metrics.view;\n+\n+import io.opentelemetry.internal.Utils;\n+import io.opentelemetry.sdk.metrics.aggregator.AggregatorFactory;\n+import io.opentelemetry.sdk.metrics.aggregator.DoubleSumAggregator;\n+import io.opentelemetry.sdk.metrics.aggregator.LongSumAggregator;\n+import io.opentelemetry.sdk.metrics.aggregator.NoopAggregator;\n+import io.opentelemetry.sdk.metrics.common.InstrumentType;\n+import io.opentelemetry.sdk.metrics.common.InstrumentValueType;\n+import io.opentelemetry.sdk.metrics.data.MetricData.Descriptor.Type;\n+import javax.annotation.concurrent.Immutable;\n+\n+public class Aggregations {\n+\n+  /**\n+   * Aggregation that calculates sum of recorded measurements.\n+   *\n+   * @since 0.1.0\n+   */\n+  public static Aggregation sum() {\n+    return Sum.INSTANCE;\n+  }\n+\n+  /**\n+   * Aggregation that calculates count of recorded measurements (the number of recorded\n+   * measurements).\n+   *\n+   * @since 0.1.0\n+   */\n+  public static Aggregation count() {\n+    return Count.INSTANCE;\n+  }\n+\n+  /**\n+   * Aggregation that calculates distribution stats on recorded measurements. Distribution includes\n+   * sum, count, histogram, and sum of squared deviations.\n+   *\n+   * <p>The boundaries for the buckets in the underlying histogram needs to be sorted.\n+   *\n+   * @param bucketBoundaries bucket boundaries to use for distribution.\n+   * @return a new {@code Distribution}.\n+   * @since 0.1.0\n+   */\n+  public static Aggregation distributionWithExplicitBounds(Double... bucketBoundaries) {\n+    return new Distribution(bucketBoundaries);\n+  }\n+\n+  /**\n+   * Aggregation that calculates the last value of all recorded measurements.\n+   *\n+   * @since 0.1.0\n+   */\n+  public static Aggregation lastValue() {\n+    return LastValue.INSTANCE;\n+  }\n+\n+  @Immutable\n+  private enum Sum implements Aggregation {\n+    INSTANCE;\n+\n+    @Override\n+    public AggregatorFactory getAggregatorFactory(InstrumentValueType instrumentValueType) {\n+      return instrumentValueType == InstrumentValueType.LONG\n+          ? LongSumAggregator.getFactory()\n+          : DoubleSumAggregator.getFactory();\n+    }\n+\n+    @Override\n+    public Type getDescriptorType(\n+        InstrumentType instrumentType, InstrumentValueType instrumentValueType) {\n+      switch (instrumentType) {\n+        case COUNTER_MONOTONIC:\n+        case MEASURE_ABSOLUTE:\n+        case OBSERVER_MONOTONIC:\n+          return instrumentValueType == InstrumentValueType.LONG\n+              ? Type.MONOTONIC_LONG\n+              : Type.MONOTONIC_DOUBLE;\n+        case COUNTER_NON_MONOTONIC:\n+        case MEASURE_NON_ABSOLUTE:\n+        case OBSERVER_NON_MONOTONIC:\n+          return instrumentValueType == InstrumentValueType.LONG\n+              ? Type.NON_MONOTONIC_LONG\n+              : Type.NON_MONOTONIC_DOUBLE;\n+      }\n+      throw new IllegalArgumentException(\"This should not happen\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c7fb653a5f2e7df696ff932c8f1e20654cf160bf"}, "originalPosition": 101}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "72c17683b674c355de503e1a092c60629df22456", "author": {"user": {"login": "bogdandrutu", "name": "Bogdan Drutu"}}, "url": "https://github.com/open-telemetry/opentelemetry-java/commit/72c17683b674c355de503e1a092c60629df22456", "committedDate": "2020-02-13T20:47:42Z", "message": "Add tests for Sum aggregation\n\nSigned-off-by: Bogdan Cristian Drutu <bogdandrutu@gmail.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "8ca5d627c462e9288d18013d49f9e9b716c31f22", "author": {"user": {"login": "bogdandrutu", "name": "Bogdan Drutu"}}, "url": "https://github.com/open-telemetry/opentelemetry-java/commit/8ca5d627c462e9288d18013d49f9e9b716c31f22", "committedDate": "2020-02-13T20:54:22Z", "message": "Add more tests and fix comments\n\nSigned-off-by: Bogdan Cristian Drutu <bogdandrutu@gmail.com>"}, "afterCommit": {"oid": "7b14b88c2f36c8a2d8c1c2df141031b52ab9ad4d", "author": {"user": {"login": "bogdandrutu", "name": "Bogdan Drutu"}}, "url": "https://github.com/open-telemetry/opentelemetry-java/commit/7b14b88c2f36c8a2d8c1c2df141031b52ab9ad4d", "committedDate": "2020-02-13T20:55:06Z", "message": "Add more tests and fix comments\n\nSigned-off-by: Bogdan Cristian Drutu <bogdandrutu@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b7b0b982d101b08719fa7bae8cd878b84d5ab1e1", "author": {"user": {"login": "bogdandrutu", "name": "Bogdan Drutu"}}, "url": "https://github.com/open-telemetry/opentelemetry-java/commit/b7b0b982d101b08719fa7bae8cd878b84d5ab1e1", "committedDate": "2020-02-13T20:58:36Z", "message": "Add more tests and fix comments\n\nSigned-off-by: Bogdan Cristian Drutu <bogdandrutu@gmail.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7b14b88c2f36c8a2d8c1c2df141031b52ab9ad4d", "author": {"user": {"login": "bogdandrutu", "name": "Bogdan Drutu"}}, "url": "https://github.com/open-telemetry/opentelemetry-java/commit/7b14b88c2f36c8a2d8c1c2df141031b52ab9ad4d", "committedDate": "2020-02-13T20:55:06Z", "message": "Add more tests and fix comments\n\nSigned-off-by: Bogdan Cristian Drutu <bogdandrutu@gmail.com>"}, "afterCommit": {"oid": "b7b0b982d101b08719fa7bae8cd878b84d5ab1e1", "author": {"user": {"login": "bogdandrutu", "name": "Bogdan Drutu"}}, "url": "https://github.com/open-telemetry/opentelemetry-java/commit/b7b0b982d101b08719fa7bae8cd878b84d5ab1e1", "committedDate": "2020-02-13T20:58:36Z", "message": "Add more tests and fix comments\n\nSigned-off-by: Bogdan Cristian Drutu <bogdandrutu@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU4NTQ4MjM3", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/857#pullrequestreview-358548237", "createdAt": "2020-02-13T21:02:08Z", "commit": {"oid": "b7b0b982d101b08719fa7bae8cd878b84d5ab1e1"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3352, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}