{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDc1Mjc0MTY1", "number": 1600, "title": "Update opentelemetry-proto to latest version.", "bodyText": "Currently, java instrumentation smoke tests fail because we use JSON. collector file exporter writes as JSON and the tests read the JSON. But currently the JSON is not compatible between collector and Java because of renamed enums. Updating the proto will allow us to continue to develop against new versions of the collector.\nI'm guessing the intent of the metrics protocol change is for the SDK to also adopt similar data structures. I'm not doing that in this PR since I only want to make the SDK JSON-compatible with the latest collectors - at the same time I've probably made them somewhat compatible for metrics too. The conversion of summary to histogram is clearly not ideal, converting double values into long counts, but I think semantically it may capture something reasonable. Anyways given before the change, the SDK isn't compatible at all for metrics with the latest collector, this is probably an improvement until rewriting the SDK.", "createdAt": "2020-08-28T08:48:51Z", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1600", "merged": true, "mergeCommit": {"oid": "69478c2d8b43f05408685c30981c3a3befab7a80"}, "closed": true, "closedAt": "2020-09-01T15:35:07Z", "author": {"login": "anuraaga"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdDQCzWgH2gAyNDc1Mjc0MTY1OjE4ZmFmZjY0YTBhOWJiODAxZmM4NGQ0NWVlN2MxYzkzYzA3ODJmOTI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdEpOQsgFqTQ3OTg2ODUyNQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "18faff64a0a9bb801fc84d45ee7c1c93c0782f92", "author": {"user": {"login": "anuraaga", "name": "Anuraag Agrawal"}}, "url": "https://github.com/open-telemetry/opentelemetry-java/commit/18faff64a0a9bb801fc84d45ee7c1c93c0782f92", "committedDate": "2020-08-28T07:40:33Z", "message": "Update opentelemetry-proto"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c6bf0dd9f506a6c1080fa51fa8cb1f91d519100c", "author": {"user": {"login": "anuraaga", "name": "Anuraag Agrawal"}}, "url": "https://github.com/open-telemetry/opentelemetry-java/commit/c6bf0dd9f506a6c1080fa51fa8cb1f91d519100c", "committedDate": "2020-08-28T08:45:07Z", "message": "Fix SDK"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc3NTUyMDMx", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1600#pullrequestreview-477552031", "createdAt": "2020-08-28T08:52:58Z", "commit": {"oid": "c6bf0dd9f506a6c1080fa51fa8cb1f91d519100c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOFQwODo1Mjo1OVrOHIxlsg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOFQwODo1Mjo1OVrOHIxlsg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODk2MzEyMg==", "bodyText": "@jkwatson :)", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1600#discussion_r478963122", "createdAt": "2020-08-28T08:52:59Z", "author": {"login": "anuraaga"}, "path": "exporters/otlp/src/main/java/io/opentelemetry/exporters/otlp/MetricAdapter.java", "diffHunk": "@@ -228,40 +239,22 @@ private static Temporality mapToTemporality(Descriptor descriptor) {\n \n   // TODO: Consider to pass the Builder and directly add values.\n   @SuppressWarnings(\"MixedMutabilityReturnType\")\n-  static List<ValueAtPercentile> toProtoValueAtPercentiles(\n-      Collection<MetricData.ValueAtPercentile> valueAtPercentiles) {\n-    if (valueAtPercentiles.isEmpty()) {\n-      return Collections.emptyList();\n-    }\n-    List<ValueAtPercentile> result = new ArrayList<>(valueAtPercentiles.size());\n+  static void addBucketValues(\n+      List<MetricData.ValueAtPercentile> valueAtPercentiles,\n+      DoubleHistogramDataPoint.Builder builder) {\n+\n     for (MetricData.ValueAtPercentile valueAtPercentile : valueAtPercentiles) {\n-      result.add(\n-          ValueAtPercentile.newBuilder()\n-              .setPercentile(valueAtPercentile.getPercentile())\n-              .setValue(valueAtPercentile.getValue())\n-              .build());\n+      // TODO(jkwatson): Value of histogram should be long?", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c6bf0dd9f506a6c1080fa51fa8cb1f91d519100c"}, "originalPosition": 220}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc4MTY3Njgy", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1600#pullrequestreview-478167682", "createdAt": "2020-08-30T03:01:16Z", "commit": {"oid": "c6bf0dd9f506a6c1080fa51fa8cb1f91d519100c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "43cf88b9a1ee640f2b7d17db30886d7992623ab6", "author": {"user": {"login": "anuraaga", "name": "Anuraag Agrawal"}}, "url": "https://github.com/open-telemetry/opentelemetry-java/commit/43cf88b9a1ee640f2b7d17db30886d7992623ab6", "committedDate": "2020-08-31T23:03:55Z", "message": "Update proto"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc5ODY4NTI1", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1600#pullrequestreview-479868525", "createdAt": "2020-09-01T15:34:37Z", "commit": {"oid": "43cf88b9a1ee640f2b7d17db30886d7992623ab6"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2418, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}