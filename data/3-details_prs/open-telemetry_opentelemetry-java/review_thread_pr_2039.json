{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE3MDcwMDE2", "number": 2039, "reviewThreads": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wN1QwNzo1MzowNFrOE2VL2w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQxODowMjo1N1rOE3WMSg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI1NDA1NjU5OnYy", "diffSide": "RIGHT", "path": "context/src/main/java/io/opentelemetry/context/LazyStorage.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wN1QwNzo1MzowNFrOHvGYVA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wN1QwODoxNDoyNFrOHvGfOA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTE0OTY1Mg==", "bodyText": "Why a second system property? As discussed on the issue, a single one would be simpler.", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/2039#discussion_r519149652", "createdAt": "2020-11-07T07:53:04Z", "author": {"login": "Oberon00"}, "path": "context/src/main/java/io/opentelemetry/context/LazyStorage.java", "diffHunk": "@@ -83,6 +85,10 @@ static ContextStorage get() {\n \n   static ContextStorage createStorage(AtomicReference<Throwable> deferredStorageFailure) {\n     String providerClassName = System.getProperty(CONTEXT_STORAGE_PROVIDER_PROPERTY, \"\");\n+    boolean enforceDefault = Boolean.getBoolean(CONTEXT_STORAGE_PROVIDER_ENFORCE_DEFAULT_PROPERTY);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e5e12228a1fe39f9412ae5fbbbe9fbe6ae765f87"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTE1MTQxNg==", "bodyText": "My bad. It's my misunderstand your point. Can you review again? thanks.", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/2039#discussion_r519151416", "createdAt": "2020-11-07T08:14:24Z", "author": {"login": "dengliming"}, "path": "context/src/main/java/io/opentelemetry/context/LazyStorage.java", "diffHunk": "@@ -83,6 +85,10 @@ static ContextStorage get() {\n \n   static ContextStorage createStorage(AtomicReference<Throwable> deferredStorageFailure) {\n     String providerClassName = System.getProperty(CONTEXT_STORAGE_PROVIDER_PROPERTY, \"\");\n+    boolean enforceDefault = Boolean.getBoolean(CONTEXT_STORAGE_PROVIDER_ENFORCE_DEFAULT_PROPERTY);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTE0OTY1Mg=="}, "originalCommit": {"oid": "e5e12228a1fe39f9412ae5fbbbe9fbe6ae765f87"}, "originalPosition": 13}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI1NDkxODcyOnYy", "diffSide": "RIGHT", "path": "context/src/test/java/io/opentelemetry/context/LazyStorageTest.java", "isResolved": true, "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wOFQwMzo1NzowN1rOHvMrNw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wOFQwNzoxNToyNlrOHvNiYQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTI1Mjc5MQ==", "bodyText": "I don't think we can test this sort of behavior with other ones since the system property is only loaded once. Can you extract another testset for this case? I think context will be full of many test sets because of his global initialization logic :)", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/2039#discussion_r519252791", "createdAt": "2020-11-08T03:57:07Z", "author": {"login": "anuraaga"}, "path": "context/src/test/java/io/opentelemetry/context/LazyStorageTest.java", "diffHunk": "@@ -76,6 +76,13 @@ public void set_storage_provider_property_matches_one_provides() throws Exceptio\n     }\n   }\n \n+  @Test\n+  public void enforce_default_thread_local_storage() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b655b89821c9d85a2ea52232fcb40b9cc5ee4e5e"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTI2MTg3Mg==", "bodyText": "Actually since we're not testing the public method it looks ok. But we should still make sure the system properties are cleaned up. I realize this already affects the existing tests, but can you use junit pioneer?\n\n  \n    \n      opentelemetry-java/sdk/common/src/test/java/io/opentelemetry/sdk/common/export/ConfigBuilderTest.java\n    \n    \n         Line 238\n      in\n      71ba8e1\n    \n    \n    \n    \n\n        \n          \n           @SetSystemProperty(key = \"int\", value = \"1\")", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/2039#discussion_r519261872", "createdAt": "2020-11-08T06:11:34Z", "author": {"login": "anuraaga"}, "path": "context/src/test/java/io/opentelemetry/context/LazyStorageTest.java", "diffHunk": "@@ -76,6 +76,13 @@ public void set_storage_provider_property_matches_one_provides() throws Exceptio\n     }\n   }\n \n+  @Test\n+  public void enforce_default_thread_local_storage() {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTI1Mjc5MQ=="}, "originalCommit": {"oid": "b655b89821c9d85a2ea52232fcb40b9cc5ee4e5e"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTI2MjIyOQ==", "bodyText": "I already clearup the properties in aftereach. It is not enough?\n@AfterEach\n  public void after() {\n    System.clearProperty(CONTEXT_STORAGE_PROVIDER_PROPERTY);\n  }", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/2039#discussion_r519262229", "createdAt": "2020-11-08T06:16:37Z", "author": {"login": "dengliming"}, "path": "context/src/test/java/io/opentelemetry/context/LazyStorageTest.java", "diffHunk": "@@ -76,6 +76,13 @@ public void set_storage_provider_property_matches_one_provides() throws Exceptio\n     }\n   }\n \n+  @Test\n+  public void enforce_default_thread_local_storage() {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTI1Mjc5MQ=="}, "originalCommit": {"oid": "b655b89821c9d85a2ea52232fcb40b9cc5ee4e5e"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTI2NDIxNw==", "bodyText": "Using the annotation is more self-documenting and I guess less error-prone. It's not so clear which tests depend on that AfterEach existing, so the annotation is nice to make it very self-documenting / clear so someone doesn't accidentally delete the cleanup function. It's not a blocking change but I think it's a good idea.", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/2039#discussion_r519264217", "createdAt": "2020-11-08T06:43:16Z", "author": {"login": "anuraaga"}, "path": "context/src/test/java/io/opentelemetry/context/LazyStorageTest.java", "diffHunk": "@@ -76,6 +76,13 @@ public void set_storage_provider_property_matches_one_provides() throws Exceptio\n     }\n   }\n \n+  @Test\n+  public void enforce_default_thread_local_storage() {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTI1Mjc5MQ=="}, "originalCommit": {"oid": "b655b89821c9d85a2ea52232fcb40b9cc5ee4e5e"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTI2NjkxMw==", "bodyText": "You are right. Thanks for help. That makes it more simpler and clearer. : )", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/2039#discussion_r519266913", "createdAt": "2020-11-08T07:15:26Z", "author": {"login": "dengliming"}, "path": "context/src/test/java/io/opentelemetry/context/LazyStorageTest.java", "diffHunk": "@@ -76,6 +76,13 @@ public void set_storage_provider_property_matches_one_provides() throws Exceptio\n     }\n   }\n \n+  @Test\n+  public void enforce_default_thread_local_storage() {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTI1Mjc5MQ=="}, "originalCommit": {"oid": "b655b89821c9d85a2ea52232fcb40b9cc5ee4e5e"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI1NTE1NTMyOnYy", "diffSide": "RIGHT", "path": "context/src/test/java/io/opentelemetry/context/LazyStorageTest.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wOFQwODoxMzoyNlrOHvOsbg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wOFQwODoyODoyMFrOHvPDCw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTI4NTg3MA==", "bodyText": "Just one last nit, if you can change the methods to be package-private, since junit5, that would be swell, not a required change though.", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/2039#discussion_r519285870", "createdAt": "2020-11-08T08:13:26Z", "author": {"login": "anuraaga"}, "path": "context/src/test/java/io/opentelemetry/context/LazyStorageTest.java", "diffHunk": "@@ -13,37 +13,36 @@\n import java.io.Writer;\n import java.net.URL;\n import java.util.concurrent.atomic.AtomicReference;\n-import org.junit.jupiter.api.AfterEach;\n import org.junit.jupiter.api.Test;\n+import org.junitpioneer.jupiter.ClearSystemProperty;\n+import org.junitpioneer.jupiter.SetSystemProperty;\n \n class LazyStorageTest {\n \n   private static final String CONTEXT_STORAGE_PROVIDER_PROPERTY =\n       \"io.opentelemetry.context.contextStorageProvider\";\n+  private static final String MOCK_CONTEXT_STORAGE_PROVIDER =\n+      \"io.opentelemetry.context.LazyStorageTest$MockContextStorageProvider\";\n   private static final AtomicReference<Throwable> DEFERRED_STORAGE_FAILURE =\n       new AtomicReference<>();\n \n-  @AfterEach\n-  public void after() {\n-    System.clearProperty(CONTEXT_STORAGE_PROVIDER_PROPERTY);\n-  }\n-\n   @Test\n-  public void empty_provides() {\n+  @ClearSystemProperty(key = CONTEXT_STORAGE_PROVIDER_PROPERTY)\n+  public void empty_providers() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3724e44c4f33d0070881e9b6a7e4bc8aabcd0f31"}, "originalPosition": 26}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTI5MTY1OQ==", "bodyText": "Thanks. That was done.", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/2039#discussion_r519291659", "createdAt": "2020-11-08T08:28:20Z", "author": {"login": "dengliming"}, "path": "context/src/test/java/io/opentelemetry/context/LazyStorageTest.java", "diffHunk": "@@ -13,37 +13,36 @@\n import java.io.Writer;\n import java.net.URL;\n import java.util.concurrent.atomic.AtomicReference;\n-import org.junit.jupiter.api.AfterEach;\n import org.junit.jupiter.api.Test;\n+import org.junitpioneer.jupiter.ClearSystemProperty;\n+import org.junitpioneer.jupiter.SetSystemProperty;\n \n class LazyStorageTest {\n \n   private static final String CONTEXT_STORAGE_PROVIDER_PROPERTY =\n       \"io.opentelemetry.context.contextStorageProvider\";\n+  private static final String MOCK_CONTEXT_STORAGE_PROVIDER =\n+      \"io.opentelemetry.context.LazyStorageTest$MockContextStorageProvider\";\n   private static final AtomicReference<Throwable> DEFERRED_STORAGE_FAILURE =\n       new AtomicReference<>();\n \n-  @AfterEach\n-  public void after() {\n-    System.clearProperty(CONTEXT_STORAGE_PROVIDER_PROPERTY);\n-  }\n-\n   @Test\n-  public void empty_provides() {\n+  @ClearSystemProperty(key = CONTEXT_STORAGE_PROVIDER_PROPERTY)\n+  public void empty_providers() {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTI4NTg3MA=="}, "originalCommit": {"oid": "3724e44c4f33d0070881e9b6a7e4bc8aabcd0f31"}, "originalPosition": 26}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI1OTUwOTUyOnYy", "diffSide": "RIGHT", "path": "context/src/main/java/io/opentelemetry/context/LazyStorage.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wOVQxNjo0MDowMFrOHv3YFA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wOVQxNjo0NTowMVrOHv3nyg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTk1MjQwNA==", "bodyText": "shouldn't we change the default value here to ENFORCE_DEFAULT_VALUE, rather than an empty String?", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/2039#discussion_r519952404", "createdAt": "2020-11-09T16:40:00Z", "author": {"login": "jkwatson"}, "path": "context/src/main/java/io/opentelemetry/context/LazyStorage.java", "diffHunk": "@@ -83,6 +84,10 @@ static ContextStorage get() {\n \n   static ContextStorage createStorage(AtomicReference<Throwable> deferredStorageFailure) {\n     String providerClassName = System.getProperty(CONTEXT_STORAGE_PROVIDER_PROPERTY, \"\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1ba446e4b33a709323abf05d13f92d96ad9bf811"}, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTk1NjQyNg==", "bodyText": "oh, probably not, since we want the SPI to load before we fall back to this value. hmm. This code has ended up pretty confusing. Maybe some additional comments about the priorities here would be helpful.", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/2039#discussion_r519956426", "createdAt": "2020-11-09T16:45:01Z", "author": {"login": "jkwatson"}, "path": "context/src/main/java/io/opentelemetry/context/LazyStorage.java", "diffHunk": "@@ -83,6 +84,10 @@ static ContextStorage get() {\n \n   static ContextStorage createStorage(AtomicReference<Throwable> deferredStorageFailure) {\n     String providerClassName = System.getProperty(CONTEXT_STORAGE_PROVIDER_PROPERTY, \"\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTk1MjQwNA=="}, "originalCommit": {"oid": "1ba446e4b33a709323abf05d13f92d96ad9bf811"}, "originalPosition": 11}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI1OTU2MDMyOnYy", "diffSide": "RIGHT", "path": "context/src/main/java/io/opentelemetry/context/LazyStorage.java", "isResolved": true, "comments": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wOVQxNjo0ODo1N1rOHv34XA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQxNjozNToxNlrOHwlMEw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTk2MDY2OA==", "bodyText": "How are we choosing between calling this method, vs. ContextStorage.defaultStorage() which return the same thing?", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/2039#discussion_r519960668", "createdAt": "2020-11-09T16:48:57Z", "author": {"login": "jkwatson"}, "path": "context/src/main/java/io/opentelemetry/context/LazyStorage.java", "diffHunk": "@@ -83,6 +84,10 @@ static ContextStorage get() {\n \n   static ContextStorage createStorage(AtomicReference<Throwable> deferredStorageFailure) {\n     String providerClassName = System.getProperty(CONTEXT_STORAGE_PROVIDER_PROPERTY, \"\");\n+    // enforceDefault\n+    if (ENFORCE_DEFAULT_VALUE.equals(providerClassName)) {\n+      return DefaultContext.threadLocalStorage();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1ba446e4b33a709323abf05d13f92d96ad9bf811"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDIzNDQ2MQ==", "bodyText": "yes. they return the same thing. what about calling ContextStorage.defaultStorage() consistently?", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/2039#discussion_r520234461", "createdAt": "2020-11-10T01:50:04Z", "author": {"login": "dengliming"}, "path": "context/src/main/java/io/opentelemetry/context/LazyStorage.java", "diffHunk": "@@ -83,6 +84,10 @@ static ContextStorage get() {\n \n   static ContextStorage createStorage(AtomicReference<Throwable> deferredStorageFailure) {\n     String providerClassName = System.getProperty(CONTEXT_STORAGE_PROVIDER_PROPERTY, \"\");\n+    // enforceDefault\n+    if (ENFORCE_DEFAULT_VALUE.equals(providerClassName)) {\n+      return DefaultContext.threadLocalStorage();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTk2MDY2OA=="}, "originalCommit": {"oid": "1ba446e4b33a709323abf05d13f92d96ad9bf811"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDIzODAzMA==", "bodyText": "@anuraaga I would really appreciate it If you can also share your opinion here.  : )", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/2039#discussion_r520238030", "createdAt": "2020-11-10T02:02:39Z", "author": {"login": "dengliming"}, "path": "context/src/main/java/io/opentelemetry/context/LazyStorage.java", "diffHunk": "@@ -83,6 +84,10 @@ static ContextStorage get() {\n \n   static ContextStorage createStorage(AtomicReference<Throwable> deferredStorageFailure) {\n     String providerClassName = System.getProperty(CONTEXT_STORAGE_PROVIDER_PROPERTY, \"\");\n+    // enforceDefault\n+    if (ENFORCE_DEFAULT_VALUE.equals(providerClassName)) {\n+      return DefaultContext.threadLocalStorage();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTk2MDY2OA=="}, "originalCommit": {"oid": "1ba446e4b33a709323abf05d13f92d96ad9bf811"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDI0MTg1Mw==", "bodyText": "Yeah let's remove DefaultContext.threadLocalStorage, that is a leftover from refactoring during the initial implementation. I was thinking of doing it after this PR if you weren't to do so :P", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/2039#discussion_r520241853", "createdAt": "2020-11-10T02:15:40Z", "author": {"login": "anuraaga"}, "path": "context/src/main/java/io/opentelemetry/context/LazyStorage.java", "diffHunk": "@@ -83,6 +84,10 @@ static ContextStorage get() {\n \n   static ContextStorage createStorage(AtomicReference<Throwable> deferredStorageFailure) {\n     String providerClassName = System.getProperty(CONTEXT_STORAGE_PROVIDER_PROPERTY, \"\");\n+    // enforceDefault\n+    if (ENFORCE_DEFAULT_VALUE.equals(providerClassName)) {\n+      return DefaultContext.threadLocalStorage();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTk2MDY2OA=="}, "originalCommit": {"oid": "1ba446e4b33a709323abf05d13f92d96ad9bf811"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDI4MTM0NA==", "bodyText": "@jkwatson Should we remove DefaultContext.threadLocalStorage  in this PR?", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/2039#discussion_r520281344", "createdAt": "2020-11-10T04:38:03Z", "author": {"login": "dengliming"}, "path": "context/src/main/java/io/opentelemetry/context/LazyStorage.java", "diffHunk": "@@ -83,6 +84,10 @@ static ContextStorage get() {\n \n   static ContextStorage createStorage(AtomicReference<Throwable> deferredStorageFailure) {\n     String providerClassName = System.getProperty(CONTEXT_STORAGE_PROVIDER_PROPERTY, \"\");\n+    // enforceDefault\n+    if (ENFORCE_DEFAULT_VALUE.equals(providerClassName)) {\n+      return DefaultContext.threadLocalStorage();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTk2MDY2OA=="}, "originalCommit": {"oid": "1ba446e4b33a709323abf05d13f92d96ad9bf811"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDY5OTQ0MA==", "bodyText": "If we don't, please create an issue for it, so we don't lose track.", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/2039#discussion_r520699440", "createdAt": "2020-11-10T16:30:18Z", "author": {"login": "jkwatson"}, "path": "context/src/main/java/io/opentelemetry/context/LazyStorage.java", "diffHunk": "@@ -83,6 +84,10 @@ static ContextStorage get() {\n \n   static ContextStorage createStorage(AtomicReference<Throwable> deferredStorageFailure) {\n     String providerClassName = System.getProperty(CONTEXT_STORAGE_PROVIDER_PROPERTY, \"\");\n+    // enforceDefault\n+    if (ENFORCE_DEFAULT_VALUE.equals(providerClassName)) {\n+      return DefaultContext.threadLocalStorage();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTk2MDY2OA=="}, "originalCommit": {"oid": "1ba446e4b33a709323abf05d13f92d96ad9bf811"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDcwMjk5NQ==", "bodyText": "Let's remove it now. : )", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/2039#discussion_r520702995", "createdAt": "2020-11-10T16:35:16Z", "author": {"login": "dengliming"}, "path": "context/src/main/java/io/opentelemetry/context/LazyStorage.java", "diffHunk": "@@ -83,6 +84,10 @@ static ContextStorage get() {\n \n   static ContextStorage createStorage(AtomicReference<Throwable> deferredStorageFailure) {\n     String providerClassName = System.getProperty(CONTEXT_STORAGE_PROVIDER_PROPERTY, \"\");\n+    // enforceDefault\n+    if (ENFORCE_DEFAULT_VALUE.equals(providerClassName)) {\n+      return DefaultContext.threadLocalStorage();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTk2MDY2OA=="}, "originalCommit": {"oid": "1ba446e4b33a709323abf05d13f92d96ad9bf811"}, "originalPosition": 14}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI2NDcwNTc1OnYy", "diffSide": "RIGHT", "path": "context/src/main/java/io/opentelemetry/context/LazyStorage.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQxODowMjoyN1rOHwo37g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQxODowMjoyN1rOHwo37g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDc2MzM3NA==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              private static final String ENFORCE_DEFAULT_VALUE = \"default\";\n          \n          \n            \n              private static final String ENFORCE_DEFAULT_STORAGE_VALUE = \"default\";", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/2039#discussion_r520763374", "createdAt": "2020-11-10T18:02:27Z", "author": {"login": "Oberon00"}, "path": "context/src/main/java/io/opentelemetry/context/LazyStorage.java", "diffHunk": "@@ -65,6 +65,7 @@ static ContextStorage get() {\n \n   private static final String CONTEXT_STORAGE_PROVIDER_PROPERTY =\n       \"io.opentelemetry.context.contextStorageProvider\";\n+  private static final String ENFORCE_DEFAULT_VALUE = \"default\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0e3cde5f9f2d473b8a1facb1dc63387eab6ff79e"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI2NDcwNzMwOnYy", "diffSide": "RIGHT", "path": "context/src/main/java/io/opentelemetry/context/LazyStorage.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQxODowMjo1N1rOHwo48Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQxODowMjo1N1rOHwo48Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDc2MzYzMw==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                String providerClassName = System.getProperty(CONTEXT_STORAGE_PROVIDER_PROPERTY, \"\");\n          \n          \n            \n                final String providerClassName = System.getProperty(CONTEXT_STORAGE_PROVIDER_PROPERTY, \"\");", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/2039#discussion_r520763633", "createdAt": "2020-11-10T18:02:57Z", "author": {"login": "Oberon00"}, "path": "context/src/main/java/io/opentelemetry/context/LazyStorage.java", "diffHunk": "@@ -82,7 +83,12 @@ static ContextStorage get() {\n   }\n \n   static ContextStorage createStorage(AtomicReference<Throwable> deferredStorageFailure) {\n+    // Get the specified SPI implementation first here\n     String providerClassName = System.getProperty(CONTEXT_STORAGE_PROVIDER_PROPERTY, \"\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0e3cde5f9f2d473b8a1facb1dc63387eab6ff79e"}, "originalPosition": 13}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1919, "cost": 1, "resetAt": "2021-11-12T20:28:25Z"}}}