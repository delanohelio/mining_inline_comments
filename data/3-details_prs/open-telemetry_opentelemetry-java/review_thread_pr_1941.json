{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTEzMDQzMDk1", "number": 1941, "reviewThreads": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMFQxNzoxOTozOVrOEz4wUg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xM1QwMzozNDozOFrOE4dK3g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIyODQyNzA2OnYy", "diffSide": "RIGHT", "path": "api/src/main/java/io/opentelemetry/api/OpenTelemetry.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMFQxNzoxOTo0MFrOHrYsoA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMFQxNzoyMjoyMFrOHrYy6g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTI1NTQ1Ng==", "bodyText": "I don't think this is a good idea. If the compiler can catch someone explicitly passing in a null version, then that person can change to use the method that doesn't take one at all.", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1941#discussion_r515255456", "createdAt": "2020-10-30T17:19:40Z", "author": {"login": "jkwatson"}, "path": "api/src/main/java/io/opentelemetry/api/OpenTelemetry.java", "diffHunk": "@@ -169,7 +170,7 @@ default Tracer getTracer(String instrumentationName) {\n    *     \"semver:1.0.0\").\n    * @return a tracer instance.\n    */\n-  default Tracer getTracer(String instrumentationName, String instrumentationVersion) {\n+  default Tracer getTracer(String instrumentationName, @Nullable String instrumentationVersion) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9bc71afab3d788f7d5bb994afd14a01b60caee1b"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTI1NzA2Ng==", "bodyText": "Agreed, null is not allowed here, we just make do somehow with it.", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1941#discussion_r515257066", "createdAt": "2020-10-30T17:22:20Z", "author": {"login": "Oberon00"}, "path": "api/src/main/java/io/opentelemetry/api/OpenTelemetry.java", "diffHunk": "@@ -169,7 +170,7 @@ default Tracer getTracer(String instrumentationName) {\n    *     \"semver:1.0.0\").\n    * @return a tracer instance.\n    */\n-  default Tracer getTracer(String instrumentationName, String instrumentationVersion) {\n+  default Tracer getTracer(String instrumentationName, @Nullable String instrumentationVersion) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTI1NTQ1Ng=="}, "originalCommit": {"oid": "9bc71afab3d788f7d5bb994afd14a01b60caee1b"}, "originalPosition": 13}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIyODQzMjI2OnYy", "diffSide": "LEFT", "path": "sdk/common/src/main/java/io/opentelemetry/sdk/internal/ComponentRegistry.java", "isResolved": true, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMFQxNzoyMTowMVrOHrYv0g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQxOTozNzoxMFrOHsS8BQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTI1NjI3NA==", "bodyText": "why get rid of this convenience method?", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1941#discussion_r515256274", "createdAt": "2020-10-30T17:21:01Z", "author": {"login": "jkwatson"}, "path": "sdk/common/src/main/java/io/opentelemetry/sdk/internal/ComponentRegistry.java", "diffHunk": "@@ -22,18 +22,6 @@\n \n   private final ConcurrentMap<InstrumentationLibraryInfo, V> registry = new ConcurrentHashMap<>();\n \n-  /**\n-   * Returns the registered value associated with this name and {@code null} version if any,\n-   * otherwise creates a new instance and associates it with the given name and {@code null}\n-   * version.\n-   *\n-   * @param instrumentationName the name of the instrumentation library.\n-   * @return the registered value associated with this name and {@code null} version.\n-   */\n-  public final V get(String instrumentationName) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9bc71afab3d788f7d5bb994afd14a01b60caee1b"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTYxMzc0MQ==", "bodyText": "The method was no longer used by code within this repository after I changed how MeterSdkProvider and TracerSdkProvider worked. Since it is in the internal package, I figured it wasn't intended for public consumption, and rather than having the unused method in the repo, I removed it.\nIf I should leave it, please let me know and I'll happily undo the change to remove it :)", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1941#discussion_r515613741", "createdAt": "2020-11-01T12:06:37Z", "author": {"login": "MariusVolkhart"}, "path": "sdk/common/src/main/java/io/opentelemetry/sdk/internal/ComponentRegistry.java", "diffHunk": "@@ -22,18 +22,6 @@\n \n   private final ConcurrentMap<InstrumentationLibraryInfo, V> registry = new ConcurrentHashMap<>();\n \n-  /**\n-   * Returns the registered value associated with this name and {@code null} version if any,\n-   * otherwise creates a new instance and associates it with the given name and {@code null}\n-   * version.\n-   *\n-   * @param instrumentationName the name of the instrumentation library.\n-   * @return the registered value associated with this name and {@code null} version.\n-   */\n-  public final V get(String instrumentationName) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTI1NjI3NA=="}, "originalCommit": {"oid": "9bc71afab3d788f7d5bb994afd14a01b60caee1b"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjEwNzMwMw==", "bodyText": "@MariusVolkhart I suggest undoing this change and removing it in a follow-up PR ;)", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1941#discussion_r516107303", "createdAt": "2020-11-02T16:46:16Z", "author": {"login": "carlosalberto"}, "path": "sdk/common/src/main/java/io/opentelemetry/sdk/internal/ComponentRegistry.java", "diffHunk": "@@ -22,18 +22,6 @@\n \n   private final ConcurrentMap<InstrumentationLibraryInfo, V> registry = new ConcurrentHashMap<>();\n \n-  /**\n-   * Returns the registered value associated with this name and {@code null} version if any,\n-   * otherwise creates a new instance and associates it with the given name and {@code null}\n-   * version.\n-   *\n-   * @param instrumentationName the name of the instrumentation library.\n-   * @return the registered value associated with this name and {@code null} version.\n-   */\n-  public final V get(String instrumentationName) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTI1NjI3NA=="}, "originalCommit": {"oid": "9bc71afab3d788f7d5bb994afd14a01b60caee1b"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjIwOTY2OQ==", "bodyText": "I've reverted my changes, so the ComponentRegistry is untouched. Thanks @carlosalberto", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1941#discussion_r516209669", "createdAt": "2020-11-02T19:37:10Z", "author": {"login": "MariusVolkhart"}, "path": "sdk/common/src/main/java/io/opentelemetry/sdk/internal/ComponentRegistry.java", "diffHunk": "@@ -22,18 +22,6 @@\n \n   private final ConcurrentMap<InstrumentationLibraryInfo, V> registry = new ConcurrentHashMap<>();\n \n-  /**\n-   * Returns the registered value associated with this name and {@code null} version if any,\n-   * otherwise creates a new instance and associates it with the given name and {@code null}\n-   * version.\n-   *\n-   * @param instrumentationName the name of the instrumentation library.\n-   * @return the registered value associated with this name and {@code null} version.\n-   */\n-  public final V get(String instrumentationName) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTI1NjI3NA=="}, "originalCommit": {"oid": "9bc71afab3d788f7d5bb994afd14a01b60caee1b"}, "originalPosition": 12}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIyODQzOTg3OnYy", "diffSide": "RIGHT", "path": "sdk/metrics/src/main/java/io/opentelemetry/sdk/metrics/MeterSdkProvider.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMFQxNzoyMjo1N1rOHrY0UQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMVQxNToyMToxOVrOHroE2A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTI1NzQyNQ==", "bodyText": "we prefer capitalizing constant names, so change to DEFAULT_METER_NAME", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1941#discussion_r515257425", "createdAt": "2020-10-30T17:22:57Z", "author": {"login": "jkwatson"}, "path": "sdk/metrics/src/main/java/io/opentelemetry/sdk/metrics/MeterSdkProvider.java", "diffHunk": "@@ -29,6 +31,8 @@\n  */\n public final class MeterSdkProvider implements MeterProvider {\n \n+  private static final Logger logger = Logger.getLogger(MeterSdkProvider.class.getName());\n+  private static final String defaultMeterName = \"unknown\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9bc71afab3d788f7d5bb994afd14a01b60caee1b"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTUwNzQxNg==", "bodyText": "We follow the Google's style guide, so we should enforce not prefer :)", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1941#discussion_r515507416", "createdAt": "2020-10-31T15:21:19Z", "author": {"login": "bogdandrutu"}, "path": "sdk/metrics/src/main/java/io/opentelemetry/sdk/metrics/MeterSdkProvider.java", "diffHunk": "@@ -29,6 +31,8 @@\n  */\n public final class MeterSdkProvider implements MeterProvider {\n \n+  private static final Logger logger = Logger.getLogger(MeterSdkProvider.class.getName());\n+  private static final String defaultMeterName = \"unknown\";", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTI1NzQyNQ=="}, "originalCommit": {"oid": "9bc71afab3d788f7d5bb994afd14a01b60caee1b"}, "originalPosition": 15}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIyODQ0NDUyOnYy", "diffSide": "RIGHT", "path": "sdk/metrics/src/main/java/io/opentelemetry/sdk/metrics/MeterSdkProvider.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMFQxNzoyNDowNFrOHrY3CA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMFQxNzoyNDowNFrOHrY3CA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTI1ODEyMA==", "bodyText": "I'd lower this log level, maybe to FINE. We don't want to spam user logs if an instrumentation library has not passed in a name.", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1941#discussion_r515258120", "createdAt": "2020-10-30T17:24:04Z", "author": {"login": "jkwatson"}, "path": "sdk/metrics/src/main/java/io/opentelemetry/sdk/metrics/MeterSdkProvider.java", "diffHunk": "@@ -41,11 +45,17 @@ private MeterSdkProvider(Clock clock, Resource resource) {\n \n   @Override\n   public MeterSdk get(String instrumentationName) {\n-    return registry.get(instrumentationName);\n+    return get(instrumentationName, null);\n   }\n \n   @Override\n-  public MeterSdk get(String instrumentationName, String instrumentationVersion) {\n+  public MeterSdk get(String instrumentationName, @Nullable String instrumentationVersion) {\n+    // Per the spec, both null and empty are \"invalid\" and a \"default\" should be used. See commit\n+    //   message for further details.\n+    if (instrumentationName == null || instrumentationName.isEmpty()) {\n+      logger.warning(\"Meter requested without instrumentation name.\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9bc71afab3d788f7d5bb994afd14a01b60caee1b"}, "originalPosition": 33}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIyODQ0NjMzOnYy", "diffSide": "RIGHT", "path": "sdk/tracing/src/main/java/io/opentelemetry/sdk/trace/TracerSdkProvider.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMFQxNzoyNDoyNVrOHrY4Eg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMFQxNzoyNDoyNVrOHrY4Eg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTI1ODM4Ng==", "bodyText": "same comment on constant naming.", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1941#discussion_r515258386", "createdAt": "2020-10-30T17:24:25Z", "author": {"login": "jkwatson"}, "path": "sdk/tracing/src/main/java/io/opentelemetry/sdk/trace/TracerSdkProvider.java", "diffHunk": "@@ -28,6 +29,7 @@\n  */\n public class TracerSdkProvider implements TracerProvider, TracerSdkManagement {\n   private static final Logger logger = Logger.getLogger(TracerSdkProvider.class.getName());\n+  private static final String defaultTracerName = \"unknown\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9bc71afab3d788f7d5bb994afd14a01b60caee1b"}, "originalPosition": 12}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIyODQ0NzcxOnYy", "diffSide": "RIGHT", "path": "sdk/metrics/src/test/java/io/opentelemetry/sdk/metrics/MeterSdkRegistryTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMFQxNzoyNDo0OVrOHrY49g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMFQxNzoyNDo0OVrOHrY49g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTI1ODYxNA==", "bodyText": "maybe make the constant package access so we don't have to fix up tests if the default value is decided to change?", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1941#discussion_r515258614", "createdAt": "2020-10-30T17:24:49Z", "author": {"login": "jkwatson"}, "path": "sdk/metrics/src/test/java/io/opentelemetry/sdk/metrics/MeterSdkRegistryTest.java", "diffHunk": "@@ -101,4 +101,22 @@ void metricProducer_GetAllMetrics() {\n                 Collections.singletonList(\n                     LongPoint.create(testClock.now(), testClock.now(), Labels.empty(), 10))));\n   }\n+\n+  @Test\n+  void suppliesDefaultMeterForNullName() {\n+    MeterSdk meter = meterProvider.get(null);\n+    assertThat(meter.getInstrumentationLibraryInfo().getName()).isEqualTo(\"unknown\");\n+\n+    meter = meterProvider.get(null, null);\n+    assertThat(meter.getInstrumentationLibraryInfo().getName()).isEqualTo(\"unknown\");\n+  }\n+\n+  @Test\n+  void suppliesDefaultMeterForEmptyName() {\n+    MeterSdk meter = meterProvider.get(\"\");\n+    assertThat(meter.getInstrumentationLibraryInfo().getName()).isEqualTo(\"unknown\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9bc71afab3d788f7d5bb994afd14a01b60caee1b"}, "originalPosition": 17}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIyODQ1MzcyOnYy", "diffSide": "RIGHT", "path": "sdk/tracing/src/main/java/io/opentelemetry/sdk/trace/TracerSdkProvider.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMFQxNzoyNjoxNlrOHrY8fQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMFQxNzoyNjoxNlrOHrY8fQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTI1OTUxNw==", "bodyText": "I'm not a fan of referring to commit messages in explanatory comments. Over time, finding the correct commit could be a pretty large chore for someone reading this. I think first sentence should suffice here (and in the meter case as well).", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1941#discussion_r515259517", "createdAt": "2020-10-30T17:26:16Z", "author": {"login": "jkwatson"}, "path": "sdk/tracing/src/main/java/io/opentelemetry/sdk/trace/TracerSdkProvider.java", "diffHunk": "@@ -47,11 +49,17 @@ private TracerSdkProvider(Clock clock, IdsGenerator idsGenerator, Resource resou\n \n   @Override\n   public Tracer get(String instrumentationName) {\n-    return tracerSdkComponentRegistry.get(instrumentationName);\n+    return get(instrumentationName, null);\n   }\n \n   @Override\n-  public Tracer get(String instrumentationName, String instrumentationVersion) {\n+  public Tracer get(String instrumentationName, @Nullable String instrumentationVersion) {\n+    // Per the spec, both null and empty are \"invalid\" and a \"default\" should be used. See commit\n+    //   message for further details.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9bc71afab3d788f7d5bb994afd14a01b60caee1b"}, "originalPosition": 28}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIzNTUwNDA0OnYy", "diffSide": "RIGHT", "path": "sdk/metrics/src/main/java/io/opentelemetry/sdk/metrics/MeterSdkProvider.java", "isResolved": false, "comments": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQyMTo0NToyNlrOHsWxwg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wN1QxNzozMTowMVrOHvJamA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjI3MjU3OA==", "bodyText": "I think this will be a common case, I would suggest to actually resolve this as a static variable and return the instance.", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1941#discussion_r516272578", "createdAt": "2020-11-02T21:45:26Z", "author": {"login": "bogdandrutu"}, "path": "sdk/metrics/src/main/java/io/opentelemetry/sdk/metrics/MeterSdkProvider.java", "diffHunk": "@@ -41,11 +45,16 @@ private MeterSdkProvider(Clock clock, Resource resource) {\n \n   @Override\n   public MeterSdk get(String instrumentationName) {\n-    return registry.get(instrumentationName);\n+    return get(instrumentationName, null);\n   }\n \n   @Override\n-  public MeterSdk get(String instrumentationName, String instrumentationVersion) {\n+  public MeterSdk get(String instrumentationName, @Nullable String instrumentationVersion) {\n+    // Per the spec, both null and empty are \"invalid\" and a \"default\" should be used.\n+    if (instrumentationName == null || instrumentationName.isEmpty()) {\n+      LOGGER.fine(\"Meter requested without instrumentation name.\");\n+      instrumentationName = DEFAULT_METER_NAME;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d2b0ca709b921baf1cd39f3f782051dbdb3f6ffe"}, "originalPosition": 33}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzM5NDg2NQ==", "bodyText": "I'm not sure I understand. Are you suggesting a static MeterSdk to represent the default, rather than loading the cached instance from the registry? Are we OK with ignoring the potentially valid version number provided when returning the static instance?\nI don't think we should use a static here. Firstly, we have the cache, and secondly, optimizing the code for what is supposed to be a \"don't do this\" use case seems wrong. If this will be a common case, then it feels like there should be a stronger push on the spec to make null a valid value.", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1941#discussion_r517394865", "createdAt": "2020-11-04T14:44:20Z", "author": {"login": "MariusVolkhart"}, "path": "sdk/metrics/src/main/java/io/opentelemetry/sdk/metrics/MeterSdkProvider.java", "diffHunk": "@@ -41,11 +45,16 @@ private MeterSdkProvider(Clock clock, Resource resource) {\n \n   @Override\n   public MeterSdk get(String instrumentationName) {\n-    return registry.get(instrumentationName);\n+    return get(instrumentationName, null);\n   }\n \n   @Override\n-  public MeterSdk get(String instrumentationName, String instrumentationVersion) {\n+  public MeterSdk get(String instrumentationName, @Nullable String instrumentationVersion) {\n+    // Per the spec, both null and empty are \"invalid\" and a \"default\" should be used.\n+    if (instrumentationName == null || instrumentationName.isEmpty()) {\n+      LOGGER.fine(\"Meter requested without instrumentation name.\");\n+      instrumentationName = DEFAULT_METER_NAME;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjI3MjU3OA=="}, "originalCommit": {"oid": "d2b0ca709b921baf1cd39f3f782051dbdb3f6ffe"}, "originalPosition": 33}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODEzMDcwMQ==", "bodyText": "Just have a \"private static Meter DEFAULT_METER = registry.get(DEFAULT_NAME, null)\" and return that if no name instead of always asking the registry to return the value.", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1941#discussion_r518130701", "createdAt": "2020-11-05T15:18:58Z", "author": {"login": "bogdandrutu"}, "path": "sdk/metrics/src/main/java/io/opentelemetry/sdk/metrics/MeterSdkProvider.java", "diffHunk": "@@ -41,11 +45,16 @@ private MeterSdkProvider(Clock clock, Resource resource) {\n \n   @Override\n   public MeterSdk get(String instrumentationName) {\n-    return registry.get(instrumentationName);\n+    return get(instrumentationName, null);\n   }\n \n   @Override\n-  public MeterSdk get(String instrumentationName, String instrumentationVersion) {\n+  public MeterSdk get(String instrumentationName, @Nullable String instrumentationVersion) {\n+    // Per the spec, both null and empty are \"invalid\" and a \"default\" should be used.\n+    if (instrumentationName == null || instrumentationName.isEmpty()) {\n+      LOGGER.fine(\"Meter requested without instrumentation name.\");\n+      instrumentationName = DEFAULT_METER_NAME;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjI3MjU3OA=="}, "originalCommit": {"oid": "d2b0ca709b921baf1cd39f3f782051dbdb3f6ffe"}, "originalPosition": 33}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODEzMTk5NA==", "bodyText": "I understand that this is a no in the specs, but I do believe users will do this a lot :)). We can do that later", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1941#discussion_r518131994", "createdAt": "2020-11-05T15:20:32Z", "author": {"login": "bogdandrutu"}, "path": "sdk/metrics/src/main/java/io/opentelemetry/sdk/metrics/MeterSdkProvider.java", "diffHunk": "@@ -41,11 +45,16 @@ private MeterSdkProvider(Clock clock, Resource resource) {\n \n   @Override\n   public MeterSdk get(String instrumentationName) {\n-    return registry.get(instrumentationName);\n+    return get(instrumentationName, null);\n   }\n \n   @Override\n-  public MeterSdk get(String instrumentationName, String instrumentationVersion) {\n+  public MeterSdk get(String instrumentationName, @Nullable String instrumentationVersion) {\n+    // Per the spec, both null and empty are \"invalid\" and a \"default\" should be used.\n+    if (instrumentationName == null || instrumentationName.isEmpty()) {\n+      LOGGER.fine(\"Meter requested without instrumentation name.\");\n+      instrumentationName = DEFAULT_METER_NAME;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjI3MjU3OA=="}, "originalCommit": {"oid": "d2b0ca709b921baf1cd39f3f782051dbdb3f6ffe"}, "originalPosition": 33}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODEzMjk3OQ==", "bodyText": "If we don't throw exception, user will use this most of the time, that is my theory", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1941#discussion_r518132979", "createdAt": "2020-11-05T15:21:56Z", "author": {"login": "bogdandrutu"}, "path": "sdk/metrics/src/main/java/io/opentelemetry/sdk/metrics/MeterSdkProvider.java", "diffHunk": "@@ -41,11 +45,16 @@ private MeterSdkProvider(Clock clock, Resource resource) {\n \n   @Override\n   public MeterSdk get(String instrumentationName) {\n-    return registry.get(instrumentationName);\n+    return get(instrumentationName, null);\n   }\n \n   @Override\n-  public MeterSdk get(String instrumentationName, String instrumentationVersion) {\n+  public MeterSdk get(String instrumentationName, @Nullable String instrumentationVersion) {\n+    // Per the spec, both null and empty are \"invalid\" and a \"default\" should be used.\n+    if (instrumentationName == null || instrumentationName.isEmpty()) {\n+      LOGGER.fine(\"Meter requested without instrumentation name.\");\n+      instrumentationName = DEFAULT_METER_NAME;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjI3MjU3OA=="}, "originalCommit": {"oid": "d2b0ca709b921baf1cd39f3f782051dbdb3f6ffe"}, "originalPosition": 33}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODEzODk1MA==", "bodyText": "Should we keep throwing an exception then? The instrumentation name should not be a dynamically generated string that can accidentally be null at runtime anyway.", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1941#discussion_r518138950", "createdAt": "2020-11-05T15:29:52Z", "author": {"login": "Oberon00"}, "path": "sdk/metrics/src/main/java/io/opentelemetry/sdk/metrics/MeterSdkProvider.java", "diffHunk": "@@ -41,11 +45,16 @@ private MeterSdkProvider(Clock clock, Resource resource) {\n \n   @Override\n   public MeterSdk get(String instrumentationName) {\n-    return registry.get(instrumentationName);\n+    return get(instrumentationName, null);\n   }\n \n   @Override\n-  public MeterSdk get(String instrumentationName, String instrumentationVersion) {\n+  public MeterSdk get(String instrumentationName, @Nullable String instrumentationVersion) {\n+    // Per the spec, both null and empty are \"invalid\" and a \"default\" should be used.\n+    if (instrumentationName == null || instrumentationName.isEmpty()) {\n+      LOGGER.fine(\"Meter requested without instrumentation name.\");\n+      instrumentationName = DEFAULT_METER_NAME;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjI3MjU3OA=="}, "originalCommit": {"oid": "d2b0ca709b921baf1cd39f3f782051dbdb3f6ffe"}, "originalPosition": 33}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODY3MjgwMw==", "bodyText": "I drafted #2036 which goes the route of not only throwing the exception in the SDK, but also in the API. By doing so, 3rd-party library authors who consume just the API are less likely to create a library that works until the application developer drops in the SDK.", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1941#discussion_r518672803", "createdAt": "2020-11-06T10:52:44Z", "author": {"login": "MariusVolkhart"}, "path": "sdk/metrics/src/main/java/io/opentelemetry/sdk/metrics/MeterSdkProvider.java", "diffHunk": "@@ -41,11 +45,16 @@ private MeterSdkProvider(Clock clock, Resource resource) {\n \n   @Override\n   public MeterSdk get(String instrumentationName) {\n-    return registry.get(instrumentationName);\n+    return get(instrumentationName, null);\n   }\n \n   @Override\n-  public MeterSdk get(String instrumentationName, String instrumentationVersion) {\n+  public MeterSdk get(String instrumentationName, @Nullable String instrumentationVersion) {\n+    // Per the spec, both null and empty are \"invalid\" and a \"default\" should be used.\n+    if (instrumentationName == null || instrumentationName.isEmpty()) {\n+      LOGGER.fine(\"Meter requested without instrumentation name.\");\n+      instrumentationName = DEFAULT_METER_NAME;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjI3MjU3OA=="}, "originalCommit": {"oid": "d2b0ca709b921baf1cd39f3f782051dbdb3f6ffe"}, "originalPosition": 33}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODg1ODA4Ng==", "bodyText": "Unfortunately, we explicitly can't do what you put into #2036. We cannot break applications that have poorly written instrumentation in them.", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1941#discussion_r518858086", "createdAt": "2020-11-06T16:20:48Z", "author": {"login": "jkwatson"}, "path": "sdk/metrics/src/main/java/io/opentelemetry/sdk/metrics/MeterSdkProvider.java", "diffHunk": "@@ -41,11 +45,16 @@ private MeterSdkProvider(Clock clock, Resource resource) {\n \n   @Override\n   public MeterSdk get(String instrumentationName) {\n-    return registry.get(instrumentationName);\n+    return get(instrumentationName, null);\n   }\n \n   @Override\n-  public MeterSdk get(String instrumentationName, String instrumentationVersion) {\n+  public MeterSdk get(String instrumentationName, @Nullable String instrumentationVersion) {\n+    // Per the spec, both null and empty are \"invalid\" and a \"default\" should be used.\n+    if (instrumentationName == null || instrumentationName.isEmpty()) {\n+      LOGGER.fine(\"Meter requested without instrumentation name.\");\n+      instrumentationName = DEFAULT_METER_NAME;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjI3MjU3OA=="}, "originalCommit": {"oid": "d2b0ca709b921baf1cd39f3f782051dbdb3f6ffe"}, "originalPosition": 33}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODg4MTU0MQ==", "bodyText": "OK. But can we log a SEVERE at least? The logspam should be enough pressure to fix an empty instrumentation name hopefully.", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1941#discussion_r518881541", "createdAt": "2020-11-06T16:59:07Z", "author": {"login": "Oberon00"}, "path": "sdk/metrics/src/main/java/io/opentelemetry/sdk/metrics/MeterSdkProvider.java", "diffHunk": "@@ -41,11 +45,16 @@ private MeterSdkProvider(Clock clock, Resource resource) {\n \n   @Override\n   public MeterSdk get(String instrumentationName) {\n-    return registry.get(instrumentationName);\n+    return get(instrumentationName, null);\n   }\n \n   @Override\n-  public MeterSdk get(String instrumentationName, String instrumentationVersion) {\n+  public MeterSdk get(String instrumentationName, @Nullable String instrumentationVersion) {\n+    // Per the spec, both null and empty are \"invalid\" and a \"default\" should be used.\n+    if (instrumentationName == null || instrumentationName.isEmpty()) {\n+      LOGGER.fine(\"Meter requested without instrumentation name.\");\n+      instrumentationName = DEFAULT_METER_NAME;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjI3MjU3OA=="}, "originalCommit": {"oid": "d2b0ca709b921baf1cd39f3f782051dbdb3f6ffe"}, "originalPosition": 33}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODg4ODI5MQ==", "bodyText": "We definitely should not spam an end-application's logs, as this can crash the app (run out of disk space, etc). And, if the end-user's application is using a library with bad instrumentation built in to it, they may not even have the option of fixing it (and they may not even be using OpenTelemetry at all!)", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1941#discussion_r518888291", "createdAt": "2020-11-06T17:11:16Z", "author": {"login": "jkwatson"}, "path": "sdk/metrics/src/main/java/io/opentelemetry/sdk/metrics/MeterSdkProvider.java", "diffHunk": "@@ -41,11 +45,16 @@ private MeterSdkProvider(Clock clock, Resource resource) {\n \n   @Override\n   public MeterSdk get(String instrumentationName) {\n-    return registry.get(instrumentationName);\n+    return get(instrumentationName, null);\n   }\n \n   @Override\n-  public MeterSdk get(String instrumentationName, String instrumentationVersion) {\n+  public MeterSdk get(String instrumentationName, @Nullable String instrumentationVersion) {\n+    // Per the spec, both null and empty are \"invalid\" and a \"default\" should be used.\n+    if (instrumentationName == null || instrumentationName.isEmpty()) {\n+      LOGGER.fine(\"Meter requested without instrumentation name.\");\n+      instrumentationName = DEFAULT_METER_NAME;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjI3MjU3OA=="}, "originalCommit": {"oid": "d2b0ca709b921baf1cd39f3f782051dbdb3f6ffe"}, "originalPosition": 33}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTE5NjM1NA==", "bodyText": "My original motivation for opening this issue and submitting a PR was that I was instrumenting an internal library that another team consumes. It was unclear to me as a library author what value I was supposed to provide as the instrumentationName, so I tried null. The API accepted it without crashing! It wasn't until later, when I did some testing and added the SDK, that it crashed. That would have been the consuming team who publish the app.\nAs the author of a library, I wish my code had failed when just the API artifact was on the classpath, or at least complained loudly about it to me. But, since the spec declares that null should be treated as \"use a default\", I made this PR to modify the SDK to be lenient (thereby matching the API).\n\nI think this PR meets the requirements of the current spec. More importantly, it makes the SDK and API artifacts behave consistently on invalid inputs, so there are no surprises when the SDK is used with instrumented code. It does not optimize for the case that the spec says is invalid, and it doesn't help developers adding instrumentation to \"do it right\".\nI'll happily try to improve documentation or samples to give both library developers and application developers a better idea of what a meaningful instrumentationName is for their use case, and why it is important. My \"using Otel for the first time\" experience is still relatively fresh in my memory.", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1941#discussion_r519196354", "createdAt": "2020-11-07T16:57:59Z", "author": {"login": "MariusVolkhart"}, "path": "sdk/metrics/src/main/java/io/opentelemetry/sdk/metrics/MeterSdkProvider.java", "diffHunk": "@@ -41,11 +45,16 @@ private MeterSdkProvider(Clock clock, Resource resource) {\n \n   @Override\n   public MeterSdk get(String instrumentationName) {\n-    return registry.get(instrumentationName);\n+    return get(instrumentationName, null);\n   }\n \n   @Override\n-  public MeterSdk get(String instrumentationName, String instrumentationVersion) {\n+  public MeterSdk get(String instrumentationName, @Nullable String instrumentationVersion) {\n+    // Per the spec, both null and empty are \"invalid\" and a \"default\" should be used.\n+    if (instrumentationName == null || instrumentationName.isEmpty()) {\n+      LOGGER.fine(\"Meter requested without instrumentation name.\");\n+      instrumentationName = DEFAULT_METER_NAME;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjI3MjU3OA=="}, "originalCommit": {"oid": "d2b0ca709b921baf1cd39f3f782051dbdb3f6ffe"}, "originalPosition": 33}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTE5OTM4NA==", "bodyText": "I'm 100% ok with the SDK not blowing up when a null instrumentation name is used. But, we should not change the API parameter annotations to make it something that is \"approved\", nor should we make the API throw exceptions if a null name is passed in.", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1941#discussion_r519199384", "createdAt": "2020-11-07T17:31:01Z", "author": {"login": "jkwatson"}, "path": "sdk/metrics/src/main/java/io/opentelemetry/sdk/metrics/MeterSdkProvider.java", "diffHunk": "@@ -41,11 +45,16 @@ private MeterSdkProvider(Clock clock, Resource resource) {\n \n   @Override\n   public MeterSdk get(String instrumentationName) {\n-    return registry.get(instrumentationName);\n+    return get(instrumentationName, null);\n   }\n \n   @Override\n-  public MeterSdk get(String instrumentationName, String instrumentationVersion) {\n+  public MeterSdk get(String instrumentationName, @Nullable String instrumentationVersion) {\n+    // Per the spec, both null and empty are \"invalid\" and a \"default\" should be used.\n+    if (instrumentationName == null || instrumentationName.isEmpty()) {\n+      LOGGER.fine(\"Meter requested without instrumentation name.\");\n+      instrumentationName = DEFAULT_METER_NAME;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjI3MjU3OA=="}, "originalCommit": {"oid": "d2b0ca709b921baf1cd39f3f782051dbdb3f6ffe"}, "originalPosition": 33}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI3NjMzNjMwOnYy", "diffSide": "RIGHT", "path": "api/src/main/java/io/opentelemetry/api/metrics/MeterProvider.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xM1QwMzozNDozOFrOHyYgjw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xM1QxMTozMjoyN1rOHyq79A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjU5MjM5OQ==", "bodyText": "@MariusVolkhart Thanks for this change - the implementation looks good, but I agree that we don't need to add the @Nullable annotation to parameters that, we defensively check, but still expect to not be null. Do you think you can remove the annotations?", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1941#discussion_r522592399", "createdAt": "2020-11-13T03:34:38Z", "author": {"login": "anuraaga"}, "path": "api/src/main/java/io/opentelemetry/api/metrics/MeterProvider.java", "diffHunk": "@@ -43,5 +44,5 @@ static MeterProvider getDefault() {\n    * @param instrumentationVersion The version of the instrumentation library.\n    * @return a tracer instance.\n    */\n-  Meter get(String instrumentationName, String instrumentationVersion);\n+  Meter get(String instrumentationName, @Nullable String instrumentationVersion);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "72e0c0454c8b2ef8754755913c689cea88db17f7"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjg5NDMyNA==", "bodyText": "Done! :)", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1941#discussion_r522894324", "createdAt": "2020-11-13T11:32:27Z", "author": {"login": "MariusVolkhart"}, "path": "api/src/main/java/io/opentelemetry/api/metrics/MeterProvider.java", "diffHunk": "@@ -43,5 +44,5 @@ static MeterProvider getDefault() {\n    * @param instrumentationVersion The version of the instrumentation library.\n    * @return a tracer instance.\n    */\n-  Meter get(String instrumentationName, String instrumentationVersion);\n+  Meter get(String instrumentationName, @Nullable String instrumentationVersion);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjU5MjM5OQ=="}, "originalCommit": {"oid": "72e0c0454c8b2ef8754755913c689cea88db17f7"}, "originalPosition": 13}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2065, "cost": 1, "resetAt": "2021-11-12T20:28:25Z"}}}