{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTI2MDE5MzA4", "number": 2120, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNFQwNjo1MDozMlrOE8inUg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNFQwNjo1MDo1NFrOE8innQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMxOTE3MTM4OnYy", "diffSide": "RIGHT", "path": "api/src/main/java/io/opentelemetry/api/metrics/AsynchronousInstrument.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNFQwNjo1MDozMlrOH4uHwA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNFQxNjo1NDowN1rOH5MGpA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTIzNzk1Mg==", "bodyText": "Moving to Builder's seems like a great change. Just confirming, though not for this PR since it's the existing behavior, is setCallback good enough and not addCallback (more common in callback-oriented APIs I think)?", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/2120#discussion_r529237952", "createdAt": "2020-11-24T06:50:32Z", "author": {"login": "anuraaga"}, "path": "api/src/main/java/io/opentelemetry/api/metrics/AsynchronousInstrument.java", "diffHunk": "@@ -34,13 +34,26 @@\n    * exported then it will never be called.\n    *\n    * @param callback the callback to be executed before export.\n+   * @deprecated Please register the callback while building the instrument. This method will be\n+   *     deprecated in 0.13.0.\n    */\n+  @Deprecated\n   void setCallback(Callback<R> callback);\n \n   /** Builder class for {@link AsynchronousInstrument}. */\n-  interface Builder extends Instrument.Builder {\n+  interface Builder<R extends Result> extends Instrument.Builder {\n+    /**\n+     * Sets a callback that gets executed every collection interval.\n+     *\n+     * <p>Evaluation is deferred until needed, if this {@code AsynchronousInstrument} metric is not\n+     * exported then it will never be called.\n+     *\n+     * @param callback the callback to be executed before export.\n+     */\n+    Builder<R> setCallback(Callback<R> callback);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "10e61212d88884d979e2b41fe5e41245038ab314"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTcyOTE4OA==", "bodyText": "In this API, you can only associate a single callback, so I think it makes sense to call it set.", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/2120#discussion_r529729188", "createdAt": "2020-11-24T16:54:07Z", "author": {"login": "jkwatson"}, "path": "api/src/main/java/io/opentelemetry/api/metrics/AsynchronousInstrument.java", "diffHunk": "@@ -34,13 +34,26 @@\n    * exported then it will never be called.\n    *\n    * @param callback the callback to be executed before export.\n+   * @deprecated Please register the callback while building the instrument. This method will be\n+   *     deprecated in 0.13.0.\n    */\n+  @Deprecated\n   void setCallback(Callback<R> callback);\n \n   /** Builder class for {@link AsynchronousInstrument}. */\n-  interface Builder extends Instrument.Builder {\n+  interface Builder<R extends Result> extends Instrument.Builder {\n+    /**\n+     * Sets a callback that gets executed every collection interval.\n+     *\n+     * <p>Evaluation is deferred until needed, if this {@code AsynchronousInstrument} metric is not\n+     * exported then it will never be called.\n+     *\n+     * @param callback the callback to be executed before export.\n+     */\n+    Builder<R> setCallback(Callback<R> callback);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTIzNzk1Mg=="}, "originalCommit": {"oid": "10e61212d88884d979e2b41fe5e41245038ab314"}, "originalPosition": 21}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMxOTE3MjEzOnYy", "diffSide": "LEFT", "path": "extensions/runtime-metrics/src/main/java/io/opentelemetry/extension/metrics/runtime/MemoryPools.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNFQwNjo1MDo1NFrOH4uIPQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNFQxNjo1NTo0OFrOH5MLjg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTIzODA3Nw==", "bodyText": "Awesome!", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/2120#discussion_r529238077", "createdAt": "2020-11-24T06:50:54Z", "author": {"login": "anuraaga"}, "path": "extensions/runtime-metrics/src/main/java/io/opentelemetry/extension/metrics/runtime/MemoryPools.java", "diffHunk": "@@ -70,30 +68,20 @@ public MemoryPools() {\n \n   /** Export only the \"area\" metric. */\n   public void exportMemoryAreaMetric() {\n-    final LongUpDownSumObserver areaMetric =\n-        this.meter\n-            .longUpDownSumObserverBuilder(\"runtime.jvm.memory.area\")\n-            .setDescription(\"Bytes of a given JVM memory area.\")\n-            .setUnit(\"By\")\n-            .build();\n-    areaMetric.setCallback(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "10e61212d88884d979e2b41fe5e41245038ab314"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTczMDQ0Ng==", "bodyText": "obviously, we'll want to port this change over to the instrumentation repo, since we're deprecating this code. Mostly did this to verify that it was a viable usage pattern. :)", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/2120#discussion_r529730446", "createdAt": "2020-11-24T16:55:48Z", "author": {"login": "jkwatson"}, "path": "extensions/runtime-metrics/src/main/java/io/opentelemetry/extension/metrics/runtime/MemoryPools.java", "diffHunk": "@@ -70,30 +68,20 @@ public MemoryPools() {\n \n   /** Export only the \"area\" metric. */\n   public void exportMemoryAreaMetric() {\n-    final LongUpDownSumObserver areaMetric =\n-        this.meter\n-            .longUpDownSumObserverBuilder(\"runtime.jvm.memory.area\")\n-            .setDescription(\"Bytes of a given JVM memory area.\")\n-            .setUnit(\"By\")\n-            .build();\n-    areaMetric.setCallback(", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTIzODA3Nw=="}, "originalCommit": {"oid": "10e61212d88884d979e2b41fe5e41245038ab314"}, "originalPosition": 20}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1767, "cost": 1, "resetAt": "2021-11-12T20:28:25Z"}}}