{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDIyMjIzNDMx", "number": 1268, "title": "Expose RandomIdsGenerator so it can be delegated to.", "bodyText": "When creating a custom IdsGenerator, I think it is common to want to delegate to the default random one, e.g., only customize trace ID and use the same code for span ID. I noticed this when writing https://github.com/aws-samples/aws-xray-sdk-with-opentelemetry-sample/blob/both-otel-and-xray/awsagentprovider/src/main/java/com/softwareaws/xray/opentelemetry/exporters/AwsXrayIdsGenerator.java#L29\nThe AwsXrayIdsGenerator in this repo has a huge dependency on the xray SDK which I want to remove (then I don't need to fork there :) ), and this would help when doing that.\nAlso made RandomIdsGenerator a singleton while here.\nRealized it's more useful to be able to customize Random than make singleton.", "createdAt": "2020-05-23T05:08:38Z", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1268", "merged": true, "mergeCommit": {"oid": "adc02dad4f59489644acdcd42abaabd0671acd3c"}, "closed": true, "closedAt": "2020-05-26T03:25:25Z", "author": {"login": "anuraaga"}, "timelineItems": {"totalCount": 13, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABckAQy3AH2gAyNDIyMjIzNDMxOjQ5YTIyZDBjMTkwZjUyYzU0NTBkNzQwZmQ1Y2YzMTFlNWVmNGY1MDc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABck8DXQAFqTQxNzk0Nzk0NA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "49a22d0c190f52c5450d740fd5cf311e5ef4f507", "author": {"user": {"login": "anuraaga", "name": "Anuraag Agrawal"}}, "url": "https://github.com/open-telemetry/opentelemetry-java/commit/49a22d0c190f52c5450d740fd5cf311e5ef4f507", "committedDate": "2020-05-23T05:45:42Z", "message": "Expose RandomIdsGenerator for delegation and allow customizing Random."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ce6f15f0b4fc51766f495c02b3e98974ed384166", "author": {"user": {"login": "anuraaga", "name": "Anuraag Agrawal"}}, "url": "https://github.com/open-telemetry/opentelemetry-java/commit/ce6f15f0b4fc51766f495c02b3e98974ed384166", "committedDate": "2020-05-23T05:05:31Z", "message": "Expose RandomIdsGenerator so it can be delegated to."}, "afterCommit": {"oid": "49a22d0c190f52c5450d740fd5cf311e5ef4f507", "author": {"user": {"login": "anuraaga", "name": "Anuraag Agrawal"}}, "url": "https://github.com/open-telemetry/opentelemetry-java/commit/49a22d0c190f52c5450d740fd5cf311e5ef4f507", "committedDate": "2020-05-23T05:45:42Z", "message": "Expose RandomIdsGenerator for delegation and allow customizing Random."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "59b1d29d8a41661ae933256320b0dc6d05f1cd6e", "author": {"user": {"login": "anuraaga", "name": "Anuraag Agrawal"}}, "url": "https://github.com/open-telemetry/opentelemetry-java/commit/59b1d29d8a41661ae933256320b0dc6d05f1cd6e", "committedDate": "2020-05-23T10:35:54Z", "message": "Unit tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bb08931423d7a320eb8af7a4f675f6ce4c542c5c", "author": {"user": {"login": "anuraaga", "name": "Anuraag Agrawal"}}, "url": "https://github.com/open-telemetry/opentelemetry-java/commit/bb08931423d7a320eb8af7a4f675f6ce4c542c5c", "committedDate": "2020-05-23T10:38:34Z", "message": "checkNotNull"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0a38453d2580a678c1803dcfc822944448bcd4c7", "author": {"user": {"login": "anuraaga", "name": "Anuraag Agrawal"}}, "url": "https://github.com/open-telemetry/opentelemetry-java/commit/0a38453d2580a678c1803dcfc822944448bcd4c7", "committedDate": "2020-05-23T10:41:18Z", "message": "More interesting test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7f4eb411593912ddd6e3e26421ffda8e28029e8e", "author": {"user": {"login": "anuraaga", "name": "Anuraag Agrawal"}}, "url": "https://github.com/open-telemetry/opentelemetry-java/commit/7f4eb411593912ddd6e3e26421ffda8e28029e8e", "committedDate": "2020-05-23T10:44:21Z", "message": "format"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e5bcdd8c3a1218c470edc30088467bb28b143f85", "author": {"user": {"login": "anuraaga", "name": "Anuraag Agrawal"}}, "url": "https://github.com/open-telemetry/opentelemetry-java/commit/e5bcdd8c3a1218c470edc30088467bb28b143f85", "committedDate": "2020-05-23T12:00:25Z", "message": "Checkstyle"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE3Mjg0Mzkw", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1268#pullrequestreview-417284390", "createdAt": "2020-05-23T14:48:16Z", "commit": {"oid": "e5bcdd8c3a1218c470edc30088467bb28b143f85"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yM1QxNDo0ODoxNlrOGZpy1w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yM1QxNDo0ODoxNlrOGZpy1w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTU1MjM0Mw==", "bodyText": "Use Java Objects.requireNotNull", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1268#discussion_r429552343", "createdAt": "2020-05-23T14:48:16Z", "author": {"login": "bogdandrutu"}, "path": "sdk/src/main/java/io/opentelemetry/sdk/trace/RandomIdsGenerator.java", "diffHunk": "@@ -16,17 +16,56 @@\n \n package io.opentelemetry.sdk.trace;\n \n+import io.opentelemetry.internal.Utils;\n import io.opentelemetry.trace.SpanId;\n import io.opentelemetry.trace.TraceId;\n+import java.util.Random;\n import java.util.concurrent.ThreadLocalRandom;\n \n-final class RandomIdsGenerator implements IdsGenerator {\n+/** The default {@link IdsGenerator} which generates IDs as random numbers. */\n+public final class RandomIdsGenerator implements IdsGenerator {\n+\n   private static final long INVALID_ID = 0;\n \n+  /**\n+   * A supplier of the {@link Random} that will be used to generate random IDs. This is a functional\n+   * interface and can be safely initialized as a lambda.\n+   */\n+  public interface RandomSupplier {\n+    /** Returns the {@link Random} to use for generating IDs. */\n+    Random get();\n+  }\n+\n+  /** Creates a {@link RandomIdsGenerator} which uses {@link ThreadLocalRandom} to generate IDs. */\n+  public RandomIdsGenerator() {\n+    this(\n+        new RandomSupplier() {\n+          @Override\n+          public Random get() {\n+            return ThreadLocalRandom.current();\n+          }\n+\n+          @Override\n+          public String toString() {\n+            return \"ThreadLocalRandom\";\n+          }\n+        });\n+  }\n+\n+  /**\n+   * Creates a {@link RandomIdsGenerator} which uses the provided {@link RandomSupplier} to generate\n+   * IDs.\n+   */\n+  public RandomIdsGenerator(RandomSupplier randomSupplier) {\n+    this.randomSupplier = Utils.checkNotNull(randomSupplier, \"randomSupplier\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e5bcdd8c3a1218c470edc30088467bb28b143f85"}, "originalPosition": 46}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "97a21427d8ed23ea8176df8b516390c5ae9aee65", "author": {"user": {"login": "anuraaga", "name": "Anuraag Agrawal"}}, "url": "https://github.com/open-telemetry/opentelemetry-java/commit/97a21427d8ed23ea8176df8b516390c5ae9aee65", "committedDate": "2020-05-25T23:37:39Z", "message": "requireNonNull"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "11f32d31bca1c6dba120b634046edacf879200a1", "author": {"user": {"login": "anuraaga", "name": "Anuraag Agrawal"}}, "url": "https://github.com/open-telemetry/opentelemetry-java/commit/11f32d31bca1c6dba120b634046edacf879200a1", "committedDate": "2020-05-26T02:05:59Z", "message": "Revert RandomSupplier"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE3OTI5NTMx", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1268#pullrequestreview-417929531", "createdAt": "2020-05-26T02:09:11Z", "commit": {"oid": "11f32d31bca1c6dba120b634046edacf879200a1"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNlQwMjowOToxMVrOGaMlZQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNlQwMjowOToxMVrOGaMlZQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDEyMjM0MQ==", "bodyText": "Maybe worth generating 1K ids to check?", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1268#discussion_r430122341", "createdAt": "2020-05-26T02:09:11Z", "author": {"login": "bogdandrutu"}, "path": "sdk/src/test/java/io/opentelemetry/sdk/trace/RandomIdsGeneratorTest.java", "diffHunk": "@@ -0,0 +1,41 @@\n+/*\n+ * Copyright 2020, OpenTelemetry Authors\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package io.opentelemetry.sdk.trace;\n+\n+import static com.google.common.truth.Truth.assertThat;\n+\n+import io.opentelemetry.trace.SpanId;\n+import io.opentelemetry.trace.TraceId;\n+import org.junit.Test;\n+import org.junit.runner.RunWith;\n+import org.junit.runners.JUnit4;\n+\n+@RunWith(JUnit4.class)\n+public class RandomIdsGeneratorTest {\n+\n+  @Test\n+  public void defaults() {\n+    RandomIdsGenerator generator = new RandomIdsGenerator();\n+\n+    // Can't assert values but can assert they're valid.\n+    TraceId traceId = generator.generateTraceId();\n+    assertThat(traceId).isNotEqualTo(TraceId.getInvalid());\n+\n+    SpanId spanId = generator.generateSpanId();\n+    assertThat(spanId).isNotEqualTo(SpanId.getInvalid());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "11f32d31bca1c6dba120b634046edacf879200a1"}, "originalPosition": 39}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5e3dcf6361f02112d4a474b3ae6c7d9a37abaf7b", "author": {"user": {"login": "anuraaga", "name": "Anuraag Agrawal"}}, "url": "https://github.com/open-telemetry/opentelemetry-java/commit/5e3dcf6361f02112d4a474b3ae6c7d9a37abaf7b", "committedDate": "2020-05-26T02:12:59Z", "message": "Format and fuzz"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE3OTQ3OTQ0", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1268#pullrequestreview-417947944", "createdAt": "2020-05-26T03:25:20Z", "commit": {"oid": "5e3dcf6361f02112d4a474b3ae6c7d9a37abaf7b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2783, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}