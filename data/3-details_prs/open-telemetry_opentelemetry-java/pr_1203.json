{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE2NTE2NTIx", "number": 1203, "title": "Fix remove attributes from span after termination", "bodyText": "Resolves #1195", "createdAt": "2020-05-12T06:32:40Z", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1203", "merged": true, "mergeCommit": {"oid": "b7510761db68e4a83773944d776411d0a9c1ccbb"}, "closed": true, "closedAt": "2020-05-12T16:42:46Z", "author": {"login": "thisthat"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcgeU9LAH2gAyNDE2NTE2NTIxOjRmYTc3MjNmNTM4N2M0OGY0YTc3YTM0YmFjNDUxYzZlOGUyNzA2ZTg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcgnEJQgFqTQxMDIyODY1Ng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "4fa7723f5387c48f4a77a34bac451c6e8e2706e8", "author": {"user": {"login": "thisthat", "name": "Giovanni Liva"}}, "url": "https://github.com/open-telemetry/opentelemetry-java/commit/4fa7723f5387c48f4a77a34bac451c6e8e2706e8", "committedDate": "2020-05-12T06:31:42Z", "message": "Fix remove attributes from span after termination"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEwMTA0NjAz", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1203#pullrequestreview-410104603", "createdAt": "2020-05-12T14:32:02Z", "commit": {"oid": "4fa7723f5387c48f4a77a34bac451c6e8e2706e8"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQxNDozMjowMlrOGUJnew==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQxNDozMjowMlrOGUJnew==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzc4MjI2Nw==", "bodyText": "Do you really need to add 5 attributes for this test? You could have a single item and assert that only that item remains afterwards, and make the test simpler/smaller.", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1203#discussion_r423782267", "createdAt": "2020-05-12T14:32:02Z", "author": {"login": "carlosalberto"}, "path": "sdk/src/test/java/io/opentelemetry/sdk/trace/SpanBuilderSdkTest.java", "diffHunk": "@@ -172,6 +172,44 @@ public void setAttribute() {\n     }\n   }\n \n+  @Test\n+  public void setAttribute_afterEnd() {\n+    Span.Builder spanBuilder = tracerSdk.spanBuilder(SPAN_NAME);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4fa7723f5387c48f4a77a34bac451c6e8e2706e8"}, "originalPosition": 6}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEwMTEzNTQ4", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1203#pullrequestreview-410113548", "createdAt": "2020-05-12T14:41:05Z", "commit": {"oid": "4fa7723f5387c48f4a77a34bac451c6e8e2706e8"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQxNDo0MTowNlrOGUKCrA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQxNDo0MTowNlrOGUKCrA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzc4OTIyOA==", "bodyText": "This will not be added anyway. Maybe we can keep only the values that will be really added? This makes the test more concise.", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1203#discussion_r423789228", "createdAt": "2020-05-12T14:41:06Z", "author": {"login": "carlosalberto"}, "path": "sdk/src/test/java/io/opentelemetry/sdk/trace/SpanBuilderSdkTest.java", "diffHunk": "@@ -230,6 +268,37 @@ public void setAttribute_nullAttributeValue() throws Exception {\n     assertThat(span.toSpanData().getAttributes()).isEmpty();\n   }\n \n+  @Test\n+  public void setAttribute_nullAttributeValue_afterEnd() throws Exception {\n+    Span.Builder spanBuilder = tracerSdk.spanBuilder(SPAN_NAME);\n+    spanBuilder.setAttribute(\"emptyString\", \"\");\n+    spanBuilder.setAttribute(\"nullString\", (AttributeValue) null);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4fa7723f5387c48f4a77a34bac451c6e8e2706e8"}, "originalPosition": 53}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEwMTEzNjM0", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1203#pullrequestreview-410113634", "createdAt": "2020-05-12T14:41:11Z", "commit": {"oid": "4fa7723f5387c48f4a77a34bac451c6e8e2706e8"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEwMTI4MDQz", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1203#pullrequestreview-410128043", "createdAt": "2020-05-12T14:55:21Z", "commit": {"oid": "4fa7723f5387c48f4a77a34bac451c6e8e2706e8"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQxNDo1NToyMVrOGUKvFQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQxNDo1NToyMVrOGUKvFQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzgwMDU5Nw==", "bodyText": "why don't we just do this check once up front, rather than repeating the code here and below?", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1203#discussion_r423800597", "createdAt": "2020-05-12T14:55:21Z", "author": {"login": "jkwatson"}, "path": "sdk/src/main/java/io/opentelemetry/sdk/trace/RecordEventsReadableSpan.java", "diffHunk": "@@ -334,6 +334,10 @@ public void setAttribute(String key, AttributeValue value) {\n     Preconditions.checkNotNull(key, \"key\");\n     if (value == null || (value.getType().equals(STRING) && value.getStringValue() == null)) {\n       synchronized (lock) {\n+        if (hasEnded) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4fa7723f5387c48f4a77a34bac451c6e8e2706e8"}, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7cab1ee8c07c27cfb13be112936839462323cfec", "author": {"user": {"login": "thisthat", "name": "Giovanni Liva"}}, "url": "https://github.com/open-telemetry/opentelemetry-java/commit/7cab1ee8c07c27cfb13be112936839462323cfec", "committedDate": "2020-05-12T16:29:20Z", "message": "Remove attribute in the same synchronized block"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEwMjE4Mzkx", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1203#pullrequestreview-410218391", "createdAt": "2020-05-12T16:30:28Z", "commit": {"oid": "4fa7723f5387c48f4a77a34bac451c6e8e2706e8"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQxNjozMDoyOVrOGUPFDw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQxNjozMDoyOVrOGUPFDw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzg3MTc1OQ==", "bodyText": "Personally I am happy with the current code, but not opposed to change it based on @jkwatson suggestion. Up to you @thisthat :)", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1203#discussion_r423871759", "createdAt": "2020-05-12T16:30:29Z", "author": {"login": "bogdandrutu"}, "path": "sdk/src/main/java/io/opentelemetry/sdk/trace/RecordEventsReadableSpan.java", "diffHunk": "@@ -334,6 +334,10 @@ public void setAttribute(String key, AttributeValue value) {\n     Preconditions.checkNotNull(key, \"key\");\n     if (value == null || (value.getType().equals(STRING) && value.getStringValue() == null)) {\n       synchronized (lock) {\n+        if (hasEnded) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzgwMDU5Nw=="}, "originalCommit": {"oid": "4fa7723f5387c48f4a77a34bac451c6e8e2706e8"}, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "74f93ed98626e4ac10aa809bfc6c86029700ee4d", "author": {"user": {"login": "thisthat", "name": "Giovanni Liva"}}, "url": "https://github.com/open-telemetry/opentelemetry-java/commit/74f93ed98626e4ac10aa809bfc6c86029700ee4d", "committedDate": "2020-05-12T16:34:00Z", "message": "Simplify tests"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "2bf40c34ac5ffa2e35608c594033d4fe0247b310", "author": {"user": {"login": "thisthat", "name": "Giovanni Liva"}}, "url": "https://github.com/open-telemetry/opentelemetry-java/commit/2bf40c34ac5ffa2e35608c594033d4fe0247b310", "committedDate": "2020-05-12T16:32:47Z", "message": "Semplify tests"}, "afterCommit": {"oid": "74f93ed98626e4ac10aa809bfc6c86029700ee4d", "author": {"user": {"login": "thisthat", "name": "Giovanni Liva"}}, "url": "https://github.com/open-telemetry/opentelemetry-java/commit/74f93ed98626e4ac10aa809bfc6c86029700ee4d", "committedDate": "2020-05-12T16:34:00Z", "message": "Simplify tests"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEwMjI4NjU2", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1203#pullrequestreview-410228656", "createdAt": "2020-05-12T16:42:29Z", "commit": {"oid": "74f93ed98626e4ac10aa809bfc6c86029700ee4d"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2684, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}