{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDI0Nzg3ODM5", "number": 1285, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOVQwNzowNzo0N1rOEAx3OQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOVQwNzowNzo0N1rOEAx3OQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY5MjUyNDA5OnYy", "diffSide": "RIGHT", "path": "contrib/trace_propagators/src/main/java/io/opentelemetry/contrib/trace/propagation/B3PropagatorInjectorMultipleHeaders.java", "isResolved": false, "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOVQwNzowNzo0N1rOGcRKtw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOVQxNToxMDowMFrOGcg3DQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjI5NDU4Mw==", "bodyText": "Wouldn't the code be easier if you replace TracingContextUtils.getSpanWithoutDefault with TracingContextUtils.getSpan and then drop null check and use only isValid?", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1285#discussion_r432294583", "createdAt": "2020-05-29T07:07:47Z", "author": {"login": "iNikem"}, "path": "contrib/trace_propagators/src/main/java/io/opentelemetry/contrib/trace/propagation/B3PropagatorInjectorMultipleHeaders.java", "diffHunk": "@@ -32,7 +32,7 @@\n     Objects.requireNonNull(setter, \"setter\");\n \n     Span span = TracingContextUtils.getSpanWithoutDefault(context);\n-    if (span == null) {\n+    if (span == null || !span.getContext().isValid()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3fa76fbb873204b2c068a6900c7fda05073c6e16"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjQzNzQwOA==", "bodyText": "Yeah, I was thinking about it too. I guess I prefer to do a simple null check before doing a full check, i.e. getContext() + isValid() ;)\nFWIW though, I'm thinking, after cases like these, to remove the getSpanWithoutDefault() overload (which I might end up doing after doing some context-prop updates).", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1285#discussion_r432437408", "createdAt": "2020-05-29T12:03:22Z", "author": {"login": "carlosalberto"}, "path": "contrib/trace_propagators/src/main/java/io/opentelemetry/contrib/trace/propagation/B3PropagatorInjectorMultipleHeaders.java", "diffHunk": "@@ -32,7 +32,7 @@\n     Objects.requireNonNull(setter, \"setter\");\n \n     Span span = TracingContextUtils.getSpanWithoutDefault(context);\n-    if (span == null) {\n+    if (span == null || !span.getContext().isValid()) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjI5NDU4Mw=="}, "originalCommit": {"oid": "3fa76fbb873204b2c068a6900c7fda05073c6e16"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjQzODk4MA==", "bodyText": "There might be propagators that will be able to meaningfully inject something only based on TraceState, even for invalid trace and span IDs. So while an utility function would be good, I think the final decision should be left to the propagator.", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1285#discussion_r432438980", "createdAt": "2020-05-29T12:07:08Z", "author": {"login": "Oberon00"}, "path": "contrib/trace_propagators/src/main/java/io/opentelemetry/contrib/trace/propagation/B3PropagatorInjectorMultipleHeaders.java", "diffHunk": "@@ -32,7 +32,7 @@\n     Objects.requireNonNull(setter, \"setter\");\n \n     Span span = TracingContextUtils.getSpanWithoutDefault(context);\n-    if (span == null) {\n+    if (span == null || !span.getContext().isValid()) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjI5NDU4Mw=="}, "originalCommit": {"oid": "3fa76fbb873204b2c068a6900c7fda05073c6e16"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjQ0MDExNg==", "bodyText": "There might be propagators that will be able to meaningfully inject something only based on TraceState\n\nRight, exactly, I had totally forgotten about this case :)", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1285#discussion_r432440116", "createdAt": "2020-05-29T12:09:39Z", "author": {"login": "carlosalberto"}, "path": "contrib/trace_propagators/src/main/java/io/opentelemetry/contrib/trace/propagation/B3PropagatorInjectorMultipleHeaders.java", "diffHunk": "@@ -32,7 +32,7 @@\n     Objects.requireNonNull(setter, \"setter\");\n \n     Span span = TracingContextUtils.getSpanWithoutDefault(context);\n-    if (span == null) {\n+    if (span == null || !span.getContext().isValid()) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjI5NDU4Mw=="}, "originalCommit": {"oid": "3fa76fbb873204b2c068a6900c7fda05073c6e16"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjU0MjE3Ng==", "bodyText": "The w3c standard says that traceparent must be present so I am worried that if that can be the case to only propagate tracestate", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1285#discussion_r432542176", "createdAt": "2020-05-29T14:54:44Z", "author": {"login": "bogdandrutu"}, "path": "contrib/trace_propagators/src/main/java/io/opentelemetry/contrib/trace/propagation/B3PropagatorInjectorMultipleHeaders.java", "diffHunk": "@@ -32,7 +32,7 @@\n     Objects.requireNonNull(setter, \"setter\");\n \n     Span span = TracingContextUtils.getSpanWithoutDefault(context);\n-    if (span == null) {\n+    if (span == null || !span.getContext().isValid()) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjI5NDU4Mw=="}, "originalCommit": {"oid": "3fa76fbb873204b2c068a6900c7fda05073c6e16"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjU1MTY5Mw==", "bodyText": "Sure, this does not apply to W3C but maybe other propagators (vendor ones for example).", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1285#discussion_r432551693", "createdAt": "2020-05-29T15:10:00Z", "author": {"login": "Oberon00"}, "path": "contrib/trace_propagators/src/main/java/io/opentelemetry/contrib/trace/propagation/B3PropagatorInjectorMultipleHeaders.java", "diffHunk": "@@ -32,7 +32,7 @@\n     Objects.requireNonNull(setter, \"setter\");\n \n     Span span = TracingContextUtils.getSpanWithoutDefault(context);\n-    if (span == null) {\n+    if (span == null || !span.getContext().isValid()) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjI5NDU4Mw=="}, "originalCommit": {"oid": "3fa76fbb873204b2c068a6900c7fda05073c6e16"}, "originalPosition": 5}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 743, "cost": 1, "resetAt": "2021-11-12T20:28:25Z"}}}