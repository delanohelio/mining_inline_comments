{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDI3NDcyMjA2", "number": 1304, "title": "Immutable Attributes and Labels", "bodyText": "This introduces two new immutable classes, Attributes and Labels. They both implement a common parameterized abstract class, and share a bit of logic for the creation of an underlying array-based implementation.", "createdAt": "2020-06-03T21:44:26Z", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1304", "merged": true, "mergeCommit": {"oid": "ee435201b51f15ca11ab24390e736834332b450c"}, "closed": true, "closedAt": "2020-06-09T00:16:41Z", "author": {"login": "jkwatson"}, "timelineItems": {"totalCount": 32, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcnG8iegH2gAyNDI3NDcyMjA2OjA1ZTZlYzhiN2NlZDQ5NzJiNDVkNDIzY2M4OTJmMDU3ZDdkNDA3MzQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcpZvgzAFqTQyNjcwNTk0OA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "05e6ec8b7ced4972b45d423cc892f057d7d40734", "author": {"user": null}, "url": "https://github.com/open-telemetry/opentelemetry-java/commit/05e6ec8b7ced4972b45d423cc892f057d7d40734", "committedDate": "2020-06-01T21:14:41Z", "message": "prototype for class to replace Map<String, AttributeValue)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "36c6a6777739302504d5882321a937cc85085ff3", "author": {"user": null}, "url": "https://github.com/open-telemetry/opentelemetry-java/commit/36c6a6777739302504d5882321a937cc85085ff3", "committedDate": "2020-06-01T21:14:42Z", "message": "safely copy the builder's data"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "03e197333ceffe54daf8615aeab502eaf953cfb1", "author": {"user": null}, "url": "https://github.com/open-telemetry/opentelemetry-java/commit/03e197333ceffe54daf8615aeab502eaf953cfb1", "committedDate": "2020-06-01T21:14:42Z", "message": "add the empty constant"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "24bd6f711b86c2b2e75a5604bc02e98f34851c2d", "author": {"user": null}, "url": "https://github.com/open-telemetry/opentelemetry-java/commit/24bd6f711b86c2b2e75a5604bc02e98f34851c2d", "committedDate": "2020-06-01T21:14:42Z", "message": "optimization for attributes with a single key/value"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "785b571756fb81dbf6216ef8b11443b47d167761", "author": {"user": null}, "url": "https://github.com/open-telemetry/opentelemetry-java/commit/785b571756fb81dbf6216ef8b11443b47d167761", "committedDate": "2020-06-01T21:14:42Z", "message": "Add an iterator/iterable and some simple tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9878dd353185d640253056b9775aef9e2f03a1cf", "author": {"user": null}, "url": "https://github.com/open-telemetry/opentelemetry-java/commit/9878dd353185d640253056b9775aef9e2f03a1cf", "committedDate": "2020-06-01T21:14:42Z", "message": "fix animalsniffer complaint"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f4c1d5bf3884257ab41d042afe9dea21ed20b4e1", "author": {"user": null}, "url": "https://github.com/open-telemetry/opentelemetry-java/commit/f4c1d5bf3884257ab41d042afe9dea21ed20b4e1", "committedDate": "2020-06-01T21:14:42Z", "message": "tests for de-duping and order-independent equality, plus removal of possibly unneeded access methods."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9c0e4d9087c909f36643efdc4fd0fa85b9aaa0ef", "author": {"user": null}, "url": "https://github.com/open-telemetry/opentelemetry-java/commit/9c0e4d9087c909f36643efdc4fd0fa85b9aaa0ef", "committedDate": "2020-06-01T21:14:42Z", "message": "clean up the sort&filter method a tad"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e3bb6472fd7f0da4abb44ca3a4199092f5c90cdf", "author": {"user": {"login": "jkwatson", "name": "John Watson"}}, "url": "https://github.com/open-telemetry/opentelemetry-java/commit/e3bb6472fd7f0da4abb44ca3a4199092f5c90cdf", "committedDate": "2020-06-01T21:14:42Z", "message": "replace the iterator with a foreach method"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "931e45c15320f2507239025d6be2fc2082a3a65a", "author": {"user": null}, "url": "https://github.com/open-telemetry/opentelemetry-java/commit/931e45c15320f2507239025d6be2fc2082a3a65a", "committedDate": "2020-06-01T21:14:42Z", "message": "Make the Attributes parameterized by the value type."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b0621b70aeb9fb4b7898ef2841ea19af9e9ad5e0", "author": {"user": null}, "url": "https://github.com/open-telemetry/opentelemetry-java/commit/b0621b70aeb9fb4b7898ef2841ea19af9e9ad5e0", "committedDate": "2020-06-01T22:23:46Z", "message": "Add basic javadoc"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e53287a3d5a71ec3575a747daec4110ec6159b09", "author": {"user": null}, "url": "https://github.com/open-telemetry/opentelemetry-java/commit/e53287a3d5a71ec3575a747daec4110ec6159b09", "committedDate": "2020-06-02T20:03:43Z", "message": "remove helper class; add a simple test for the builder; make the tests more robust"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1e98afea7388eaa5d6e09d0f67b09c0501b6ac77", "author": {"user": null}, "url": "https://github.com/open-telemetry/opentelemetry-java/commit/1e98afea7388eaa5d6e09d0f67b09c0501b6ac77", "committedDate": "2020-06-02T21:41:01Z", "message": "Add a varargs method for creating an arbitrary number of key/value pairs."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6d1b6a978824b856c57e816d96a2aaa7adf46393", "author": {"user": null}, "url": "https://github.com/open-telemetry/opentelemetry-java/commit/6d1b6a978824b856c57e816d96a2aaa7adf46393", "committedDate": "2020-06-02T22:18:01Z", "message": "static import the check method, for consistency"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c4a9a8442383ab29c562952d729d651c55129ab2", "author": {"user": null}, "url": "https://github.com/open-telemetry/opentelemetry-java/commit/c4a9a8442383ab29c562952d729d651c55129ab2", "committedDate": "2020-06-03T21:42:57Z", "message": "Refactor to have an interface and two implementations, with some shared logic."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7b0f140e27cd2ed444bbbf7cbd25b06df21d1554", "author": {"user": null}, "url": "https://github.com/open-telemetry/opentelemetry-java/commit/7b0f140e27cd2ed444bbbf7cbd25b06df21d1554", "committedDate": "2020-06-03T21:47:37Z", "message": "fix an accidental rename"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8ab0b74ccf1fd801788a8ac5862f54ab3b955ce4", "author": {"user": null}, "url": "https://github.com/open-telemetry/opentelemetry-java/commit/8ab0b74ccf1fd801788a8ac5862f54ab3b955ce4", "committedDate": "2020-06-03T21:48:24Z", "message": "really fix it for real"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9ec6c74b383b272a3bd6d6ed8240ed6dc433bc56", "author": {"user": null}, "url": "https://github.com/open-telemetry/opentelemetry-java/commit/9ec6c74b383b272a3bd6d6ed8240ed6dc433bc56", "committedDate": "2020-06-03T22:32:20Z", "message": "add a few more tests"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI0MjU0NTcx", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1304#pullrequestreview-424254571", "createdAt": "2020-06-04T09:16:10Z", "commit": {"oid": "9ec6c74b383b272a3bd6d6ed8240ed6dc433bc56"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNFQwOToxNjoxMFrOGe9BlQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNFQwOToxNjoxMFrOGe9BlQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTExMDI5Mw==", "bodyText": "Thanks! The API in this PR LGTM. Only comment is may stick with putAttribute instead of add, more familiar since it's inspired by Java's Map and conveys that duplicates are deduped.", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1304#discussion_r435110293", "createdAt": "2020-06-04T09:16:10Z", "author": {"login": "anuraaga"}, "path": "api/src/main/java/io/opentelemetry/common/Attributes.java", "diffHunk": "@@ -0,0 +1,251 @@\n+/*\n+ * Copyright 2020, OpenTelemetry Authors\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package io.opentelemetry.common;\n+\n+import static io.opentelemetry.common.AttributeValue.arrayAttributeValue;\n+import static io.opentelemetry.common.AttributeValue.booleanAttributeValue;\n+import static io.opentelemetry.common.AttributeValue.doubleAttributeValue;\n+import static io.opentelemetry.common.AttributeValue.longAttributeValue;\n+import static io.opentelemetry.common.AttributeValue.stringAttributeValue;\n+\n+import com.google.auto.value.AutoValue;\n+import java.util.ArrayList;\n+import java.util.List;\n+import javax.annotation.concurrent.Immutable;\n+\n+/**\n+ * An immutable container for attributes. The type parameter denotes the type of the values of the\n+ * attributes.\n+ */\n+@Immutable\n+public abstract class Attributes implements ImmutableKeyValuePairs<AttributeValue> {\n+  private static final Attributes EMPTY =\n+      new Attributes() {\n+        @Override\n+        public void forEach(KeyValueConsumer<AttributeValue> consumer) {\n+          // no-op\n+        }\n+      };\n+\n+  private static Attributes sortAndFilter(Object... data) {\n+    return new AutoValue_Attributes_ArrayBackedAttributes(Helper.sortAndFilter(data));\n+  }\n+\n+  /** An {@link Attributes} instance with no attributes. */\n+  public static Attributes empty() {\n+    return EMPTY;\n+  }\n+\n+  /** An {@link Attributes} instance with a single key-value pair. */\n+  public static Attributes of(String key, AttributeValue value) {\n+    return sortAndFilter(key, value);\n+  }\n+\n+  /**\n+   * An {@link Attributes} instance with two key-value pairs. Order of the keys is not preserved.\n+   * Duplicate keys will be removed.\n+   */\n+  public static Attributes of(\n+      String key1, AttributeValue value1, String key2, AttributeValue value2) {\n+    return sortAndFilter(key1, value1, key2, value2);\n+  }\n+\n+  /**\n+   * An {@link Attributes} instance with three key-value pairs. Order of the keys is not preserved.\n+   * Duplicate keys will be removed.\n+   */\n+  public static Attributes of(\n+      String key1,\n+      AttributeValue value1,\n+      String key2,\n+      AttributeValue value2,\n+      String key3,\n+      AttributeValue value3) {\n+    return sortAndFilter(key1, value1, key2, value2, key3, value3);\n+  }\n+\n+  /**\n+   * An {@link Attributes} instance with four key-value pairs. Order of the keys is not preserved.\n+   * Duplicate keys will be removed.\n+   */\n+  public static Attributes of(\n+      String key1,\n+      AttributeValue value1,\n+      String key2,\n+      AttributeValue value2,\n+      String key3,\n+      AttributeValue value3,\n+      String key4,\n+      AttributeValue value4) {\n+    return sortAndFilter(key1, value1, key2, value2, key3, value3, key4, value4);\n+  }\n+\n+  /**\n+   * An {@link Attributes} instance with five key-value pairs. Order of the keys is not preserved.\n+   * Duplicate keys will be removed.\n+   */\n+  public static Attributes of(\n+      String key1,\n+      AttributeValue value1,\n+      String key2,\n+      AttributeValue value2,\n+      String key3,\n+      AttributeValue value3,\n+      String key4,\n+      AttributeValue value4,\n+      String key5,\n+      AttributeValue value5) {\n+    return sortAndFilter(\n+        key1, value1,\n+        key2, value2,\n+        key3, value3,\n+        key4, value4,\n+        key5, value5);\n+  }\n+\n+  /** Creates a new {@link Builder} instance for creating arbitrary {@link Attributes}. */\n+  public static Builder newBuilder() {\n+    return new Builder();\n+  }\n+\n+  @AutoValue\n+  @Immutable\n+  abstract static class ArrayBackedAttributes extends Attributes {\n+    abstract List<Object> data();\n+\n+    ArrayBackedAttributes() {}\n+\n+    @Override\n+    public void forEach(KeyValueConsumer<AttributeValue> consumer) {\n+      for (int i = 0; i < data().size(); i++) {\n+        consumer.consume((String) data().get(i), (AttributeValue) data().get(++i));\n+      }\n+    }\n+  }\n+\n+  /**\n+   * Enables the creation of an {@link Attributes} instance with an arbitrary number of key-value\n+   * pairs.\n+   */\n+  public static class Builder {\n+    private final List<Object> data = new ArrayList<>();\n+\n+    /** Create the {@link Attributes} from this. */\n+    public Attributes build() {\n+      return sortAndFilter(data.toArray());\n+    }\n+\n+    /**\n+     * Add a bare {@link AttributeValue} to this.\n+     *\n+     * @return this Builder\n+     */\n+    public Builder addAttribute(String key, AttributeValue value) {\n+      data.add(key);\n+      data.add(value);\n+      return this;\n+    }\n+\n+    /**\n+     * Add a String {@link AttributeValue} to this.\n+     *\n+     * @return this Builder\n+     */\n+    public Builder addAttribute(String key, String value) {\n+      data.add(key);\n+      data.add(stringAttributeValue(value));\n+      return this;\n+    }\n+\n+    /**\n+     * Add a long {@link AttributeValue} to this.\n+     *\n+     * @return this Builder\n+     */\n+    public Builder addAttribute(String key, long value) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9ec6c74b383b272a3bd6d6ed8240ed6dc433bc56"}, "originalPosition": 179}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "423116f2c97d18c2756eebc487c43b5b65388ca8", "author": {"user": null}, "url": "https://github.com/open-telemetry/opentelemetry-java/commit/423116f2c97d18c2756eebc487c43b5b65388ca8", "committedDate": "2020-06-04T17:35:12Z", "message": "preserve the `setAttribute` names from existing Span API"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4fbfef2add43fc6622dea36be2005e89a11dee46", "author": {"user": null}, "url": "https://github.com/open-telemetry/opentelemetry-java/commit/4fbfef2add43fc6622dea36be2005e89a11dee46", "committedDate": "2020-06-04T21:30:56Z", "message": "Replace the treemap sorting and filtering with a quicksort and post-filter."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "029d3e24250237bd8d24a1c15aaab278f8040889", "author": {"user": null}, "url": "https://github.com/open-telemetry/opentelemetry-java/commit/029d3e24250237bd8d24a1c15aaab278f8040889", "committedDate": "2020-06-04T21:38:03Z", "message": "remove an unneeded list."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI1Mjg3OTIx", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1304#pullrequestreview-425287921", "createdAt": "2020-06-05T13:15:53Z", "commit": {"oid": "029d3e24250237bd8d24a1c15aaab278f8040889"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNVQxMzoxNTo1M1rOGfuBWw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNVQxMzoxNTo1M1rOGfuBWw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTkxMzA1MQ==", "bodyText": "Guessing you wrote this you don't want to use Arrays.sort(), which uses merge sort (and more memory)? If that's the case, adding a note for further reference would be nice.", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1304#discussion_r435913051", "createdAt": "2020-06-05T13:15:53Z", "author": {"login": "carlosalberto"}, "path": "api/src/main/java/io/opentelemetry/common/ImmutableKeyValuePairs.java", "diffHunk": "@@ -0,0 +1,105 @@\n+/*\n+ * Copyright 2020, OpenTelemetry Authors\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package io.opentelemetry.common;\n+\n+import static io.opentelemetry.internal.Utils.checkArgument;\n+import static io.opentelemetry.internal.Utils.checkNotNull;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+import javax.annotation.concurrent.Immutable;\n+\n+/**\n+ * An immutable set of key-value pairs. Keys are only {@link String} typed. Can be iterated over\n+ * using the {@link #forEach(KeyValueConsumer)} method.\n+ *\n+ * @param <V> The type of the values contained in this.\n+ * @see Labels\n+ * @see Attributes\n+ */\n+@Immutable\n+public interface ImmutableKeyValuePairs<V> {\n+  /** Iterates over all the key-value pairs of attributes contained by this instance. */\n+  void forEach(KeyValueConsumer<V> consumer);\n+\n+  /**\n+   * Used for iterating over the key-value pairs contained by an {@link ImmutableKeyValuePairs}\n+   * instance.\n+   */\n+  interface KeyValueConsumer<T> {\n+    void consume(String key, T value);\n+  }\n+\n+  class Helper {\n+    private Helper() {}\n+\n+    static <T> List<Object> sortAndFilter(Object[] data) {\n+      checkArgument(\n+          data.length % 2 == 0, \"You must provide an even number of key/value pair arguments.\");\n+\n+      quickSort(data, 0, data.length - 2);\n+      return dedupe(data);\n+    }\n+\n+    private static void quickSort(Object[] data, int leftIndex, int rightIndex) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "029d3e24250237bd8d24a1c15aaab278f8040889"}, "originalPosition": 58}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI1MzY3Mzg2", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1304#pullrequestreview-425367386", "createdAt": "2020-06-05T14:45:58Z", "commit": {"oid": "029d3e24250237bd8d24a1c15aaab278f8040889"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNVQxNDo0NTo1OFrOGfxjOQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNVQxNDo0NTo1OFrOGfxjOQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTk3MDg3Mw==", "bodyText": "This can be package protected, no need to expose it public. Also why do you not make this an abstract class with all the utils inside it. It will remove some duplicate code between Labels and Attributes.", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1304#discussion_r435970873", "createdAt": "2020-06-05T14:45:58Z", "author": {"login": "bogdandrutu"}, "path": "api/src/main/java/io/opentelemetry/common/ImmutableKeyValuePairs.java", "diffHunk": "@@ -0,0 +1,105 @@\n+/*\n+ * Copyright 2020, OpenTelemetry Authors\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package io.opentelemetry.common;\n+\n+import static io.opentelemetry.internal.Utils.checkArgument;\n+import static io.opentelemetry.internal.Utils.checkNotNull;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+import javax.annotation.concurrent.Immutable;\n+\n+/**\n+ * An immutable set of key-value pairs. Keys are only {@link String} typed. Can be iterated over\n+ * using the {@link #forEach(KeyValueConsumer)} method.\n+ *\n+ * @param <V> The type of the values contained in this.\n+ * @see Labels\n+ * @see Attributes\n+ */\n+@Immutable\n+public interface ImmutableKeyValuePairs<V> {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "029d3e24250237bd8d24a1c15aaab278f8040889"}, "originalPosition": 35}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "136fbe5a16c02f2de6fdd19a3ba339af165495a2", "author": {"user": null}, "url": "https://github.com/open-telemetry/opentelemetry-java/commit/136fbe5a16c02f2de6fdd19a3ba339af165495a2", "committedDate": "2020-06-05T21:38:44Z", "message": "switch to an abstract base class to remove some code duplication"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI1NjUzMzQx", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1304#pullrequestreview-425653341", "createdAt": "2020-06-05T22:01:26Z", "commit": {"oid": "136fbe5a16c02f2de6fdd19a3ba339af165495a2"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI1NzAxOTcy", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1304#pullrequestreview-425701972", "createdAt": "2020-06-06T01:30:47Z", "commit": {"oid": "136fbe5a16c02f2de6fdd19a3ba339af165495a2"}, "state": "COMMENTED", "comments": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNlQwMTozMDo0N1rOGgBEow==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNlQwMjowOTo1NlrOGgBQXg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjIyNTE4Nw==", "bodyText": "Recommend leaving this abstract and having EMPTY use the value implementation passing in empty list. Don't need to have yet more implementations of the abstract type for the empty types.", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1304#discussion_r436225187", "createdAt": "2020-06-06T01:30:47Z", "author": {"login": "anuraaga"}, "path": "api/src/main/java/io/opentelemetry/common/ImmutableKeyValuePairs.java", "diffHunk": "@@ -0,0 +1,104 @@\n+/*\n+ * Copyright 2020, OpenTelemetry Authors\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package io.opentelemetry.common;\n+\n+import static io.opentelemetry.internal.Utils.checkArgument;\n+import static io.opentelemetry.internal.Utils.checkNotNull;\n+\n+import java.util.ArrayList;\n+import java.util.Collections;\n+import java.util.List;\n+import javax.annotation.concurrent.Immutable;\n+\n+/**\n+ * An immutable set of key-value pairs. Keys are only {@link String} typed. Can be iterated over\n+ * using the {@link #forEach(KeyValueConsumer)} method.\n+ *\n+ * @param <V> The type of the values contained in this.\n+ * @see Labels\n+ * @see Attributes\n+ */\n+@Immutable\n+abstract class ImmutableKeyValuePairs<V> {\n+\n+  List<Object> data() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "136fbe5a16c02f2de6fdd19a3ba339af165495a2"}, "originalPosition": 38}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjIyNTcxNA==", "bodyText": "Just wondering, do we need to sort attributes? I guess labels are sorted because of Prometheus. It's ok if it's to keep generic but curious. I think attributes can commonly be created per span instead of being singletons so this sorting would add up.", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1304#discussion_r436225714", "createdAt": "2020-06-06T01:37:02Z", "author": {"login": "anuraaga"}, "path": "api/src/main/java/io/opentelemetry/common/Attributes.java", "diffHunk": "@@ -0,0 +1,239 @@\n+/*\n+ * Copyright 2020, OpenTelemetry Authors\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package io.opentelemetry.common;\n+\n+import static io.opentelemetry.common.AttributeValue.arrayAttributeValue;\n+import static io.opentelemetry.common.AttributeValue.booleanAttributeValue;\n+import static io.opentelemetry.common.AttributeValue.doubleAttributeValue;\n+import static io.opentelemetry.common.AttributeValue.longAttributeValue;\n+import static io.opentelemetry.common.AttributeValue.stringAttributeValue;\n+\n+import com.google.auto.value.AutoValue;\n+import java.util.ArrayList;\n+import java.util.List;\n+import javax.annotation.concurrent.Immutable;\n+\n+/**\n+ * An immutable container for attributes. The type parameter denotes the type of the values of the\n+ * attributes.\n+ */\n+@Immutable\n+public abstract class Attributes extends ImmutableKeyValuePairs<AttributeValue> {\n+  private static final Attributes EMPTY = new Attributes() {};\n+\n+  @AutoValue\n+  @Immutable\n+  abstract static class ArrayBackedAttributes extends Attributes {\n+    ArrayBackedAttributes() {}\n+\n+    @Override\n+    abstract List<Object> data();\n+  }\n+\n+  /** An {@link Attributes} instance with no attributes. */\n+  public static Attributes empty() {\n+    return EMPTY;\n+  }\n+\n+  /** An {@link Attributes} instance with a single key-value pair. */\n+  public static Attributes of(String key, AttributeValue value) {\n+    return sortAndFilterToAttributes(key, value);\n+  }\n+\n+  /**\n+   * An {@link Attributes} instance with two key-value pairs. Order of the keys is not preserved.\n+   * Duplicate keys will be removed.\n+   */\n+  public static Attributes of(\n+      String key1, AttributeValue value1, String key2, AttributeValue value2) {\n+    return sortAndFilterToAttributes(key1, value1, key2, value2);\n+  }\n+\n+  /**\n+   * An {@link Attributes} instance with three key-value pairs. Order of the keys is not preserved.\n+   * Duplicate keys will be removed.\n+   */\n+  public static Attributes of(\n+      String key1,\n+      AttributeValue value1,\n+      String key2,\n+      AttributeValue value2,\n+      String key3,\n+      AttributeValue value3) {\n+    return sortAndFilterToAttributes(key1, value1, key2, value2, key3, value3);\n+  }\n+\n+  /**\n+   * An {@link Attributes} instance with four key-value pairs. Order of the keys is not preserved.\n+   * Duplicate keys will be removed.\n+   */\n+  public static Attributes of(\n+      String key1,\n+      AttributeValue value1,\n+      String key2,\n+      AttributeValue value2,\n+      String key3,\n+      AttributeValue value3,\n+      String key4,\n+      AttributeValue value4) {\n+    return sortAndFilterToAttributes(key1, value1, key2, value2, key3, value3, key4, value4);\n+  }\n+\n+  /**\n+   * An {@link Attributes} instance with five key-value pairs. Order of the keys is not preserved.\n+   * Duplicate keys will be removed.\n+   */\n+  public static Attributes of(\n+      String key1,\n+      AttributeValue value1,\n+      String key2,\n+      AttributeValue value2,\n+      String key3,\n+      AttributeValue value3,\n+      String key4,\n+      AttributeValue value4,\n+      String key5,\n+      AttributeValue value5) {\n+    return sortAndFilterToAttributes(\n+        key1, value1,\n+        key2, value2,\n+        key3, value3,\n+        key4, value4,\n+        key5, value5);\n+  }\n+\n+  private static Attributes sortAndFilterToAttributes(Object... data) {\n+    return new AutoValue_Attributes_ArrayBackedAttributes(sortAndFilter(data));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "136fbe5a16c02f2de6fdd19a3ba339af165495a2"}, "originalPosition": 120}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjIyNTg2Mg==", "bodyText": "I think this is a user API so can't throw per 1)\nhttps://github.com/open-telemetry/opentelemetry-specification/blob/master/specification/error-handling.md#basic-error-handling-principles", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1304#discussion_r436225862", "createdAt": "2020-06-06T01:38:54Z", "author": {"login": "anuraaga"}, "path": "api/src/main/java/io/opentelemetry/common/ImmutableKeyValuePairs.java", "diffHunk": "@@ -0,0 +1,104 @@\n+/*\n+ * Copyright 2020, OpenTelemetry Authors\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package io.opentelemetry.common;\n+\n+import static io.opentelemetry.internal.Utils.checkArgument;\n+import static io.opentelemetry.internal.Utils.checkNotNull;\n+\n+import java.util.ArrayList;\n+import java.util.Collections;\n+import java.util.List;\n+import javax.annotation.concurrent.Immutable;\n+\n+/**\n+ * An immutable set of key-value pairs. Keys are only {@link String} typed. Can be iterated over\n+ * using the {@link #forEach(KeyValueConsumer)} method.\n+ *\n+ * @param <V> The type of the values contained in this.\n+ * @see Labels\n+ * @see Attributes\n+ */\n+@Immutable\n+abstract class ImmutableKeyValuePairs<V> {\n+\n+  List<Object> data() {\n+    return Collections.emptyList();\n+  }\n+\n+  /** Iterates over all the key-value pairs of attributes contained by this instance. */\n+  @SuppressWarnings(\"unchecked\")\n+  public void forEach(KeyValueConsumer<V> consumer) {\n+    for (int i = 0; i < data().size(); i += 2) {\n+      consumer.consume((String) data().get(i), (V) data().get(i + 1));\n+    }\n+  }\n+\n+  static List<Object> sortAndFilter(Object[] data) {\n+    checkArgument(\n+        data.length % 2 == 0, \"You must provide an even number of key/value pair arguments.\");\n+\n+    quickSort(data, 0, data.length - 2);\n+    return dedupe(data);\n+  }\n+\n+  private static void quickSort(Object[] data, int leftIndex, int rightIndex) {\n+    if (leftIndex >= rightIndex) {\n+      return;\n+    }\n+\n+    String pivotKey = (String) data[rightIndex];\n+    int counter = leftIndex;\n+\n+    for (int i = leftIndex; i <= rightIndex; i += 2) {\n+      if (((String) data[i]).compareTo(pivotKey) <= 0) {\n+        swap(data, counter, i);\n+        counter += 2;\n+      }\n+    }\n+\n+    quickSort(data, leftIndex, counter - 4);\n+    quickSort(data, counter, rightIndex);\n+  }\n+\n+  private static List<Object> dedupe(Object[] data) {\n+    List<Object> result = new ArrayList<>(data.length);\n+    Object previousKey = null;\n+\n+    for (int i = 0; i < data.length; i += 2) {\n+      Object key = data[i];\n+      Object value = data[i + 1];\n+      checkNotNull(key, \"You cannot provide null keys for creation of attributes.\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "136fbe5a16c02f2de6fdd19a3ba339af165495a2"}, "originalPosition": 84}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjIyNjc5NQ==", "bodyText": "Since we're allocating anyways and the number of items should be quite low, consider doing an out-of-place insertion sort where it's easy to dedupe while sorting and is faster than quicksort for small collections", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1304#discussion_r436226795", "createdAt": "2020-06-06T01:50:04Z", "author": {"login": "anuraaga"}, "path": "api/src/main/java/io/opentelemetry/common/ImmutableKeyValuePairs.java", "diffHunk": "@@ -0,0 +1,104 @@\n+/*\n+ * Copyright 2020, OpenTelemetry Authors\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package io.opentelemetry.common;\n+\n+import static io.opentelemetry.internal.Utils.checkArgument;\n+import static io.opentelemetry.internal.Utils.checkNotNull;\n+\n+import java.util.ArrayList;\n+import java.util.Collections;\n+import java.util.List;\n+import javax.annotation.concurrent.Immutable;\n+\n+/**\n+ * An immutable set of key-value pairs. Keys are only {@link String} typed. Can be iterated over\n+ * using the {@link #forEach(KeyValueConsumer)} method.\n+ *\n+ * @param <V> The type of the values contained in this.\n+ * @see Labels\n+ * @see Attributes\n+ */\n+@Immutable\n+abstract class ImmutableKeyValuePairs<V> {\n+\n+  List<Object> data() {\n+    return Collections.emptyList();\n+  }\n+\n+  /** Iterates over all the key-value pairs of attributes contained by this instance. */\n+  @SuppressWarnings(\"unchecked\")\n+  public void forEach(KeyValueConsumer<V> consumer) {\n+    for (int i = 0; i < data().size(); i += 2) {\n+      consumer.consume((String) data().get(i), (V) data().get(i + 1));\n+    }\n+  }\n+\n+  static List<Object> sortAndFilter(Object[] data) {\n+    checkArgument(\n+        data.length % 2 == 0, \"You must provide an even number of key/value pair arguments.\");\n+\n+    quickSort(data, 0, data.length - 2);\n+    return dedupe(data);\n+  }\n+\n+  private static void quickSort(Object[] data, int leftIndex, int rightIndex) {\n+    if (leftIndex >= rightIndex) {\n+      return;\n+    }\n+\n+    String pivotKey = (String) data[rightIndex];\n+    int counter = leftIndex;\n+\n+    for (int i = leftIndex; i <= rightIndex; i += 2) {\n+      if (((String) data[i]).compareTo(pivotKey) <= 0) {\n+        swap(data, counter, i);\n+        counter += 2;\n+      }\n+    }\n+\n+    quickSort(data, leftIndex, counter - 4);\n+    quickSort(data, counter, rightIndex);\n+  }\n+\n+  private static List<Object> dedupe(Object[] data) {\n+    List<Object> result = new ArrayList<>(data.length);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "136fbe5a16c02f2de6fdd19a3ba339af165495a2"}, "originalPosition": 78}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjIyNjk5MQ==", "bodyText": "Otherwise we could add a quick check that the data is already sorted and deduped and bypass the logic. If users notice the sorting showing up in profiles they can reorder their code to speed it up.\nFor reference I have had users report this exact sort of issue line/armeria#2150", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1304#discussion_r436226991", "createdAt": "2020-06-06T01:52:26Z", "author": {"login": "anuraaga"}, "path": "api/src/main/java/io/opentelemetry/common/Attributes.java", "diffHunk": "@@ -0,0 +1,239 @@\n+/*\n+ * Copyright 2020, OpenTelemetry Authors\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package io.opentelemetry.common;\n+\n+import static io.opentelemetry.common.AttributeValue.arrayAttributeValue;\n+import static io.opentelemetry.common.AttributeValue.booleanAttributeValue;\n+import static io.opentelemetry.common.AttributeValue.doubleAttributeValue;\n+import static io.opentelemetry.common.AttributeValue.longAttributeValue;\n+import static io.opentelemetry.common.AttributeValue.stringAttributeValue;\n+\n+import com.google.auto.value.AutoValue;\n+import java.util.ArrayList;\n+import java.util.List;\n+import javax.annotation.concurrent.Immutable;\n+\n+/**\n+ * An immutable container for attributes. The type parameter denotes the type of the values of the\n+ * attributes.\n+ */\n+@Immutable\n+public abstract class Attributes extends ImmutableKeyValuePairs<AttributeValue> {\n+  private static final Attributes EMPTY = new Attributes() {};\n+\n+  @AutoValue\n+  @Immutable\n+  abstract static class ArrayBackedAttributes extends Attributes {\n+    ArrayBackedAttributes() {}\n+\n+    @Override\n+    abstract List<Object> data();\n+  }\n+\n+  /** An {@link Attributes} instance with no attributes. */\n+  public static Attributes empty() {\n+    return EMPTY;\n+  }\n+\n+  /** An {@link Attributes} instance with a single key-value pair. */\n+  public static Attributes of(String key, AttributeValue value) {\n+    return sortAndFilterToAttributes(key, value);\n+  }\n+\n+  /**\n+   * An {@link Attributes} instance with two key-value pairs. Order of the keys is not preserved.\n+   * Duplicate keys will be removed.\n+   */\n+  public static Attributes of(\n+      String key1, AttributeValue value1, String key2, AttributeValue value2) {\n+    return sortAndFilterToAttributes(key1, value1, key2, value2);\n+  }\n+\n+  /**\n+   * An {@link Attributes} instance with three key-value pairs. Order of the keys is not preserved.\n+   * Duplicate keys will be removed.\n+   */\n+  public static Attributes of(\n+      String key1,\n+      AttributeValue value1,\n+      String key2,\n+      AttributeValue value2,\n+      String key3,\n+      AttributeValue value3) {\n+    return sortAndFilterToAttributes(key1, value1, key2, value2, key3, value3);\n+  }\n+\n+  /**\n+   * An {@link Attributes} instance with four key-value pairs. Order of the keys is not preserved.\n+   * Duplicate keys will be removed.\n+   */\n+  public static Attributes of(\n+      String key1,\n+      AttributeValue value1,\n+      String key2,\n+      AttributeValue value2,\n+      String key3,\n+      AttributeValue value3,\n+      String key4,\n+      AttributeValue value4) {\n+    return sortAndFilterToAttributes(key1, value1, key2, value2, key3, value3, key4, value4);\n+  }\n+\n+  /**\n+   * An {@link Attributes} instance with five key-value pairs. Order of the keys is not preserved.\n+   * Duplicate keys will be removed.\n+   */\n+  public static Attributes of(\n+      String key1,\n+      AttributeValue value1,\n+      String key2,\n+      AttributeValue value2,\n+      String key3,\n+      AttributeValue value3,\n+      String key4,\n+      AttributeValue value4,\n+      String key5,\n+      AttributeValue value5) {\n+    return sortAndFilterToAttributes(\n+        key1, value1,\n+        key2, value2,\n+        key3, value3,\n+        key4, value4,\n+        key5, value5);\n+  }\n+\n+  private static Attributes sortAndFilterToAttributes(Object... data) {\n+    return new AutoValue_Attributes_ArrayBackedAttributes(sortAndFilter(data));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjIyNTcxNA=="}, "originalCommit": {"oid": "136fbe5a16c02f2de6fdd19a3ba339af165495a2"}, "originalPosition": 120}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjIyNzQ3MA==", "bodyText": "Also, since this is internal consider Object[] for a bit less overhead.", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1304#discussion_r436227470", "createdAt": "2020-06-06T01:59:22Z", "author": {"login": "anuraaga"}, "path": "api/src/main/java/io/opentelemetry/common/ImmutableKeyValuePairs.java", "diffHunk": "@@ -0,0 +1,104 @@\n+/*\n+ * Copyright 2020, OpenTelemetry Authors\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package io.opentelemetry.common;\n+\n+import static io.opentelemetry.internal.Utils.checkArgument;\n+import static io.opentelemetry.internal.Utils.checkNotNull;\n+\n+import java.util.ArrayList;\n+import java.util.Collections;\n+import java.util.List;\n+import javax.annotation.concurrent.Immutable;\n+\n+/**\n+ * An immutable set of key-value pairs. Keys are only {@link String} typed. Can be iterated over\n+ * using the {@link #forEach(KeyValueConsumer)} method.\n+ *\n+ * @param <V> The type of the values contained in this.\n+ * @see Labels\n+ * @see Attributes\n+ */\n+@Immutable\n+abstract class ImmutableKeyValuePairs<V> {\n+\n+  List<Object> data() {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjIyNTE4Nw=="}, "originalCommit": {"oid": "136fbe5a16c02f2de6fdd19a3ba339af165495a2"}, "originalPosition": 38}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjIyNzU2Mg==", "bodyText": "Realized that if sort and dedupe were combined into one insertion sort could do it in-place too. Dupes should be rare I think so copying only for the dupe case would be nice.", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1304#discussion_r436227562", "createdAt": "2020-06-06T02:00:27Z", "author": {"login": "anuraaga"}, "path": "api/src/main/java/io/opentelemetry/common/ImmutableKeyValuePairs.java", "diffHunk": "@@ -0,0 +1,104 @@\n+/*\n+ * Copyright 2020, OpenTelemetry Authors\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package io.opentelemetry.common;\n+\n+import static io.opentelemetry.internal.Utils.checkArgument;\n+import static io.opentelemetry.internal.Utils.checkNotNull;\n+\n+import java.util.ArrayList;\n+import java.util.Collections;\n+import java.util.List;\n+import javax.annotation.concurrent.Immutable;\n+\n+/**\n+ * An immutable set of key-value pairs. Keys are only {@link String} typed. Can be iterated over\n+ * using the {@link #forEach(KeyValueConsumer)} method.\n+ *\n+ * @param <V> The type of the values contained in this.\n+ * @see Labels\n+ * @see Attributes\n+ */\n+@Immutable\n+abstract class ImmutableKeyValuePairs<V> {\n+\n+  List<Object> data() {\n+    return Collections.emptyList();\n+  }\n+\n+  /** Iterates over all the key-value pairs of attributes contained by this instance. */\n+  @SuppressWarnings(\"unchecked\")\n+  public void forEach(KeyValueConsumer<V> consumer) {\n+    for (int i = 0; i < data().size(); i += 2) {\n+      consumer.consume((String) data().get(i), (V) data().get(i + 1));\n+    }\n+  }\n+\n+  static List<Object> sortAndFilter(Object[] data) {\n+    checkArgument(\n+        data.length % 2 == 0, \"You must provide an even number of key/value pair arguments.\");\n+\n+    quickSort(data, 0, data.length - 2);\n+    return dedupe(data);\n+  }\n+\n+  private static void quickSort(Object[] data, int leftIndex, int rightIndex) {\n+    if (leftIndex >= rightIndex) {\n+      return;\n+    }\n+\n+    String pivotKey = (String) data[rightIndex];\n+    int counter = leftIndex;\n+\n+    for (int i = leftIndex; i <= rightIndex; i += 2) {\n+      if (((String) data[i]).compareTo(pivotKey) <= 0) {\n+        swap(data, counter, i);\n+        counter += 2;\n+      }\n+    }\n+\n+    quickSort(data, leftIndex, counter - 4);\n+    quickSort(data, counter, rightIndex);\n+  }\n+\n+  private static List<Object> dedupe(Object[] data) {\n+    List<Object> result = new ArrayList<>(data.length);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjIyNjc5NQ=="}, "originalCommit": {"oid": "136fbe5a16c02f2de6fdd19a3ba339af165495a2"}, "originalPosition": 78}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjIyNzgzMQ==", "bodyText": "ImmutableKeyValuePairs isn't in public API so can't link it. Just some generic word like container should be fine.", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1304#discussion_r436227831", "createdAt": "2020-06-06T02:05:02Z", "author": {"login": "anuraaga"}, "path": "api/src/main/java/io/opentelemetry/common/KeyValueConsumer.java", "diffHunk": "@@ -0,0 +1,25 @@\n+/*\n+ * Copyright 2020, OpenTelemetry Authors\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package io.opentelemetry.common;\n+\n+/**\n+ * Used for iterating over the key-value pairs contained by an {@link ImmutableKeyValuePairs}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "136fbe5a16c02f2de6fdd19a3ba339af165495a2"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjIyODEyOA==", "bodyText": "Sets instead of Add throughout (matches the method name and javadoc should generally be present tense, not command tense)", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1304#discussion_r436228128", "createdAt": "2020-06-06T02:09:00Z", "author": {"login": "anuraaga"}, "path": "api/src/main/java/io/opentelemetry/common/Attributes.java", "diffHunk": "@@ -0,0 +1,239 @@\n+/*\n+ * Copyright 2020, OpenTelemetry Authors\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package io.opentelemetry.common;\n+\n+import static io.opentelemetry.common.AttributeValue.arrayAttributeValue;\n+import static io.opentelemetry.common.AttributeValue.booleanAttributeValue;\n+import static io.opentelemetry.common.AttributeValue.doubleAttributeValue;\n+import static io.opentelemetry.common.AttributeValue.longAttributeValue;\n+import static io.opentelemetry.common.AttributeValue.stringAttributeValue;\n+\n+import com.google.auto.value.AutoValue;\n+import java.util.ArrayList;\n+import java.util.List;\n+import javax.annotation.concurrent.Immutable;\n+\n+/**\n+ * An immutable container for attributes. The type parameter denotes the type of the values of the\n+ * attributes.\n+ */\n+@Immutable\n+public abstract class Attributes extends ImmutableKeyValuePairs<AttributeValue> {\n+  private static final Attributes EMPTY = new Attributes() {};\n+\n+  @AutoValue\n+  @Immutable\n+  abstract static class ArrayBackedAttributes extends Attributes {\n+    ArrayBackedAttributes() {}\n+\n+    @Override\n+    abstract List<Object> data();\n+  }\n+\n+  /** An {@link Attributes} instance with no attributes. */\n+  public static Attributes empty() {\n+    return EMPTY;\n+  }\n+\n+  /** An {@link Attributes} instance with a single key-value pair. */\n+  public static Attributes of(String key, AttributeValue value) {\n+    return sortAndFilterToAttributes(key, value);\n+  }\n+\n+  /**\n+   * An {@link Attributes} instance with two key-value pairs. Order of the keys is not preserved.\n+   * Duplicate keys will be removed.\n+   */\n+  public static Attributes of(\n+      String key1, AttributeValue value1, String key2, AttributeValue value2) {\n+    return sortAndFilterToAttributes(key1, value1, key2, value2);\n+  }\n+\n+  /**\n+   * An {@link Attributes} instance with three key-value pairs. Order of the keys is not preserved.\n+   * Duplicate keys will be removed.\n+   */\n+  public static Attributes of(\n+      String key1,\n+      AttributeValue value1,\n+      String key2,\n+      AttributeValue value2,\n+      String key3,\n+      AttributeValue value3) {\n+    return sortAndFilterToAttributes(key1, value1, key2, value2, key3, value3);\n+  }\n+\n+  /**\n+   * An {@link Attributes} instance with four key-value pairs. Order of the keys is not preserved.\n+   * Duplicate keys will be removed.\n+   */\n+  public static Attributes of(\n+      String key1,\n+      AttributeValue value1,\n+      String key2,\n+      AttributeValue value2,\n+      String key3,\n+      AttributeValue value3,\n+      String key4,\n+      AttributeValue value4) {\n+    return sortAndFilterToAttributes(key1, value1, key2, value2, key3, value3, key4, value4);\n+  }\n+\n+  /**\n+   * An {@link Attributes} instance with five key-value pairs. Order of the keys is not preserved.\n+   * Duplicate keys will be removed.\n+   */\n+  public static Attributes of(\n+      String key1,\n+      AttributeValue value1,\n+      String key2,\n+      AttributeValue value2,\n+      String key3,\n+      AttributeValue value3,\n+      String key4,\n+      AttributeValue value4,\n+      String key5,\n+      AttributeValue value5) {\n+    return sortAndFilterToAttributes(\n+        key1, value1,\n+        key2, value2,\n+        key3, value3,\n+        key4, value4,\n+        key5, value5);\n+  }\n+\n+  private static Attributes sortAndFilterToAttributes(Object... data) {\n+    return new AutoValue_Attributes_ArrayBackedAttributes(sortAndFilter(data));\n+  }\n+\n+  /** Creates a new {@link Builder} instance for creating arbitrary {@link Attributes}. */\n+  public static Builder newBuilder() {\n+    return new Builder();\n+  }\n+\n+  /**\n+   * Enables the creation of an {@link Attributes} instance with an arbitrary number of key-value\n+   * pairs.\n+   */\n+  public static class Builder {\n+    private final List<Object> data = new ArrayList<>();\n+\n+    /** Create the {@link Attributes} from this. */\n+    public Attributes build() {\n+      return sortAndFilterToAttributes(data.toArray());\n+    }\n+\n+    /**\n+     * Add a bare {@link AttributeValue} to this.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "136fbe5a16c02f2de6fdd19a3ba339af165495a2"}, "originalPosition": 141}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjIyODE1MQ==", "bodyText": "Returns a for all the factories", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1304#discussion_r436228151", "createdAt": "2020-06-06T02:09:27Z", "author": {"login": "anuraaga"}, "path": "api/src/main/java/io/opentelemetry/common/Attributes.java", "diffHunk": "@@ -0,0 +1,239 @@\n+/*\n+ * Copyright 2020, OpenTelemetry Authors\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package io.opentelemetry.common;\n+\n+import static io.opentelemetry.common.AttributeValue.arrayAttributeValue;\n+import static io.opentelemetry.common.AttributeValue.booleanAttributeValue;\n+import static io.opentelemetry.common.AttributeValue.doubleAttributeValue;\n+import static io.opentelemetry.common.AttributeValue.longAttributeValue;\n+import static io.opentelemetry.common.AttributeValue.stringAttributeValue;\n+\n+import com.google.auto.value.AutoValue;\n+import java.util.ArrayList;\n+import java.util.List;\n+import javax.annotation.concurrent.Immutable;\n+\n+/**\n+ * An immutable container for attributes. The type parameter denotes the type of the values of the\n+ * attributes.\n+ */\n+@Immutable\n+public abstract class Attributes extends ImmutableKeyValuePairs<AttributeValue> {\n+  private static final Attributes EMPTY = new Attributes() {};\n+\n+  @AutoValue\n+  @Immutable\n+  abstract static class ArrayBackedAttributes extends Attributes {\n+    ArrayBackedAttributes() {}\n+\n+    @Override\n+    abstract List<Object> data();\n+  }\n+\n+  /** An {@link Attributes} instance with no attributes. */", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "136fbe5a16c02f2de6fdd19a3ba339af165495a2"}, "originalPosition": 47}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjIyODE5MA==", "bodyText": "No type parameter anymore remove from javadoc", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1304#discussion_r436228190", "createdAt": "2020-06-06T02:09:56Z", "author": {"login": "anuraaga"}, "path": "api/src/main/java/io/opentelemetry/common/Attributes.java", "diffHunk": "@@ -0,0 +1,239 @@\n+/*\n+ * Copyright 2020, OpenTelemetry Authors\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package io.opentelemetry.common;\n+\n+import static io.opentelemetry.common.AttributeValue.arrayAttributeValue;\n+import static io.opentelemetry.common.AttributeValue.booleanAttributeValue;\n+import static io.opentelemetry.common.AttributeValue.doubleAttributeValue;\n+import static io.opentelemetry.common.AttributeValue.longAttributeValue;\n+import static io.opentelemetry.common.AttributeValue.stringAttributeValue;\n+\n+import com.google.auto.value.AutoValue;\n+import java.util.ArrayList;\n+import java.util.List;\n+import javax.annotation.concurrent.Immutable;\n+\n+/**\n+ * An immutable container for attributes. The type parameter denotes the type of the values of the", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "136fbe5a16c02f2de6fdd19a3ba339af165495a2"}, "originalPosition": 31}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI1ODMzMDg1", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1304#pullrequestreview-425833085", "createdAt": "2020-06-07T16:11:41Z", "commit": {"oid": "136fbe5a16c02f2de6fdd19a3ba339af165495a2"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "74ab7d1fa2b760e6bcd9dab9138d0fc9d7e277c7", "author": {"user": null}, "url": "https://github.com/open-telemetry/opentelemetry-java/commit/74ab7d1fa2b760e6bcd9dab9138d0fc9d7e277c7", "committedDate": "2020-06-07T16:44:38Z", "message": "Updated docs based on feedback."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI1ODcxMDI3", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1304#pullrequestreview-425871027", "createdAt": "2020-06-08T01:06:55Z", "commit": {"oid": "74ab7d1fa2b760e6bcd9dab9138d0fc9d7e277c7"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOFQwMTowNjo1NlrOGgM-3w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOFQwMTowNzozN1rOGgM_NQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjQyMDMxOQ==", "bodyText": "Still recommend this to be Attributes.newBuilder().build() instead of adding a new implementation of Attributes", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1304#discussion_r436420319", "createdAt": "2020-06-08T01:06:56Z", "author": {"login": "anuraaga"}, "path": "api/src/main/java/io/opentelemetry/common/Attributes.java", "diffHunk": "@@ -0,0 +1,240 @@\n+/*\n+ * Copyright 2020, OpenTelemetry Authors\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package io.opentelemetry.common;\n+\n+import static io.opentelemetry.common.AttributeValue.arrayAttributeValue;\n+import static io.opentelemetry.common.AttributeValue.booleanAttributeValue;\n+import static io.opentelemetry.common.AttributeValue.doubleAttributeValue;\n+import static io.opentelemetry.common.AttributeValue.longAttributeValue;\n+import static io.opentelemetry.common.AttributeValue.stringAttributeValue;\n+\n+import com.google.auto.value.AutoValue;\n+import java.util.ArrayList;\n+import java.util.List;\n+import javax.annotation.concurrent.Immutable;\n+\n+/**\n+ * An immutable container for attributes.\n+ *\n+ * <p>The keys are {@link String}s and the values are {@link AttributeValue} instances.\n+ */\n+@Immutable\n+public abstract class Attributes extends ImmutableKeyValuePairs<AttributeValue> {\n+  private static final Attributes EMPTY = new Attributes() {};", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "74ab7d1fa2b760e6bcd9dab9138d0fc9d7e277c7"}, "originalPosition": 37}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjQyMDQwNQ==", "bodyText": "Think we can use of here, it's the \"base case\" of the varargs. Similar to what guava does", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1304#discussion_r436420405", "createdAt": "2020-06-08T01:07:37Z", "author": {"login": "anuraaga"}, "path": "api/src/main/java/io/opentelemetry/common/Attributes.java", "diffHunk": "@@ -0,0 +1,240 @@\n+/*\n+ * Copyright 2020, OpenTelemetry Authors\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package io.opentelemetry.common;\n+\n+import static io.opentelemetry.common.AttributeValue.arrayAttributeValue;\n+import static io.opentelemetry.common.AttributeValue.booleanAttributeValue;\n+import static io.opentelemetry.common.AttributeValue.doubleAttributeValue;\n+import static io.opentelemetry.common.AttributeValue.longAttributeValue;\n+import static io.opentelemetry.common.AttributeValue.stringAttributeValue;\n+\n+import com.google.auto.value.AutoValue;\n+import java.util.ArrayList;\n+import java.util.List;\n+import javax.annotation.concurrent.Immutable;\n+\n+/**\n+ * An immutable container for attributes.\n+ *\n+ * <p>The keys are {@link String}s and the values are {@link AttributeValue} instances.\n+ */\n+@Immutable\n+public abstract class Attributes extends ImmutableKeyValuePairs<AttributeValue> {\n+  private static final Attributes EMPTY = new Attributes() {};\n+\n+  @AutoValue\n+  @Immutable\n+  abstract static class ArrayBackedAttributes extends Attributes {\n+    ArrayBackedAttributes() {}\n+\n+    @Override\n+    abstract List<Object> data();\n+  }\n+\n+  /** Returns a {@link Attributes} instance with no attributes. */\n+  public static Attributes empty() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "74ab7d1fa2b760e6bcd9dab9138d0fc9d7e277c7"}, "originalPosition": 49}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4acad24b1ca085b2c9a01dba8d88b6651c462162", "author": {"user": null}, "url": "https://github.com/open-telemetry/opentelemetry-java/commit/4acad24b1ca085b2c9a01dba8d88b6651c462162", "committedDate": "2020-06-08T15:10:57Z", "message": "Small change to use the builder for the empty implementations."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI2NzA1OTQ4", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1304#pullrequestreview-426705948", "createdAt": "2020-06-09T00:16:30Z", "commit": {"oid": "4acad24b1ca085b2c9a01dba8d88b6651c462162"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2846, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}