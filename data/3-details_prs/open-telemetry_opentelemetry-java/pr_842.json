{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzczMjk3NzI1", "number": 842, "title": "AbstractBoundInstrument refcounts and keeps the state of mapped.", "bodyText": "Split from #831", "createdAt": "2020-02-10T18:57:23Z", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/842", "merged": true, "mergeCommit": {"oid": "11e0fb0b64acc9e1efa172f0b241f861b1b5f444"}, "closed": true, "closedAt": "2020-02-12T23:19:20Z", "author": {"login": "bogdandrutu"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcDXsQugFqTM1Njk2Nzg4MQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcDrfG2gFqTM1NzcyNTg1Mw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU2OTY3ODgx", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/842#pullrequestreview-356967881", "createdAt": "2020-02-11T20:24:00Z", "commit": {"oid": "c2bb46c586dd8767f5cb329f9777c730a591a24f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMVQyMDoyNDowMVrOFoX0cw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMVQyMDoyNDowMVrOFoX0cw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Nzg3NzYxOQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n             * Abstract class that extends the functionality of the BoundInstrument.\n          \n          \n            \n             * Abstract class that implements the basic functionality of the BoundInstrument.", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/842#discussion_r377877619", "createdAt": "2020-02-11T20:24:01Z", "author": {"login": "jkwatson"}, "path": "sdk/src/main/java/io/opentelemetry/sdk/metrics/AbstractBoundInstrument.java", "diffHunk": "@@ -17,35 +17,64 @@\n package io.opentelemetry.sdk.metrics;\n \n import io.opentelemetry.metrics.InstrumentWithBinding.BoundInstrument;\n-import io.opentelemetry.metrics.LabelSet;\n+import java.util.concurrent.atomic.AtomicLong;\n \n+/**\n+ * Abstract class that extends the functionality of the BoundInstrument.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c2bb46c586dd8767f5cb329f9777c730a591a24f"}, "originalPosition": 8}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU2OTc1MTgz", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/842#pullrequestreview-356975183", "createdAt": "2020-02-11T20:35:55Z", "commit": {"oid": "c2bb46c586dd8767f5cb329f9777c730a591a24f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMVQyMDozNTo1NVrOFoYKwg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMVQyMDozNTo1NVrOFoYKwg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Nzg4MzMzMA==", "bodyText": "why did you stop passing in the labelset?", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/842#discussion_r377883330", "createdAt": "2020-02-11T20:35:55Z", "author": {"login": "jkwatson"}, "path": "sdk/src/main/java/io/opentelemetry/sdk/metrics/DoubleCounterSdk.java", "diffHunk": "@@ -38,14 +38,14 @@ private DoubleCounterSdk(\n \n   @Override\n   public void add(double delta, LabelSet labelSet) {\n-    BoundDoubleCounter boundDoubleCounter = bind(labelSet);\n-    boundDoubleCounter.add(delta);\n-    boundDoubleCounter.unbind();\n+    BoundInstrument boundInstrument = bind(labelSet);\n+    boundInstrument.add(delta);\n+    boundInstrument.unbind();\n   }\n \n   @Override\n-  public BoundDoubleCounter bind(LabelSet labelSet) {\n-    return new BoundInstrument(labelSet, monotonic);\n+  public BoundInstrument bind(LabelSet labelSet) {\n+    return new BoundInstrument(monotonic);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c2bb46c586dd8767f5cb329f9777c730a591a24f"}, "originalPosition": 16}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c2bb46c586dd8767f5cb329f9777c730a591a24f", "author": {"user": {"login": "bogdandrutu", "name": "Bogdan Drutu"}}, "url": "https://github.com/open-telemetry/opentelemetry-java/commit/c2bb46c586dd8767f5cb329f9777c730a591a24f", "committedDate": "2020-02-10T18:54:18Z", "message": "AbstractBoundInstrument refcounts and keeps the state of mapped.\n\nSigned-off-by: Bogdan Cristian Drutu <bogdandrutu@gmail.com>"}, "afterCommit": {"oid": "12af5520ad04ee1ef2dd67825c130516401c251e", "author": {"user": {"login": "bogdandrutu", "name": "Bogdan Drutu"}}, "url": "https://github.com/open-telemetry/opentelemetry-java/commit/12af5520ad04ee1ef2dd67825c130516401c251e", "committedDate": "2020-02-12T18:03:30Z", "message": "AbstractBoundInstrument refcounts and keeps the state of mapped.\n\nSigned-off-by: Bogdan Cristian Drutu <bogdandrutu@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "219d1febce2c7310ee1db5a4eae7e1a748e1444c", "author": {"user": {"login": "bogdandrutu", "name": "Bogdan Drutu"}}, "url": "https://github.com/open-telemetry/opentelemetry-java/commit/219d1febce2c7310ee1db5a4eae7e1a748e1444c", "committedDate": "2020-02-12T18:04:49Z", "message": "AbstractBoundInstrument refcounts and keeps the state of mapped.\n\nSigned-off-by: Bogdan Cristian Drutu <bogdandrutu@gmail.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "12af5520ad04ee1ef2dd67825c130516401c251e", "author": {"user": {"login": "bogdandrutu", "name": "Bogdan Drutu"}}, "url": "https://github.com/open-telemetry/opentelemetry-java/commit/12af5520ad04ee1ef2dd67825c130516401c251e", "committedDate": "2020-02-12T18:03:30Z", "message": "AbstractBoundInstrument refcounts and keeps the state of mapped.\n\nSigned-off-by: Bogdan Cristian Drutu <bogdandrutu@gmail.com>"}, "afterCommit": {"oid": "219d1febce2c7310ee1db5a4eae7e1a748e1444c", "author": {"user": {"login": "bogdandrutu", "name": "Bogdan Drutu"}}, "url": "https://github.com/open-telemetry/opentelemetry-java/commit/219d1febce2c7310ee1db5a4eae7e1a748e1444c", "committedDate": "2020-02-12T18:04:49Z", "message": "AbstractBoundInstrument refcounts and keeps the state of mapped.\n\nSigned-off-by: Bogdan Cristian Drutu <bogdandrutu@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU3NzE5NjUw", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/842#pullrequestreview-357719650", "createdAt": "2020-02-12T19:18:35Z", "commit": {"oid": "219d1febce2c7310ee1db5a4eae7e1a748e1444c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMlQxOToxODozNlrOFo7WUA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMlQxOToxODozNlrOFo7WUA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODQ1OTcyOA==", "bodyText": "don't we need to be passing the labelset in to the ABI here?", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/842#discussion_r378459728", "createdAt": "2020-02-12T19:18:36Z", "author": {"login": "jkwatson"}, "path": "sdk/src/main/java/io/opentelemetry/sdk/metrics/DoubleCounterSdk.java", "diffHunk": "@@ -73,13 +73,12 @@ public int hashCode() {\n     return result;\n   }\n \n-  private static final class BoundInstrument extends AbstractBoundInstrument\n-      implements BoundDoubleCounter {\n+  static final class BoundInstrument extends AbstractBoundInstrument implements BoundDoubleCounter {\n \n     private final boolean monotonic;\n \n-    BoundInstrument(LabelSet labelSet, boolean monotonic) {\n-      super(labelSet);\n+    BoundInstrument(boolean monotonic) {\n+      super(null);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "219d1febce2c7310ee1db5a4eae7e1a748e1444c"}, "originalPosition": 22}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU3NzI1ODUz", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/842#pullrequestreview-357725853", "createdAt": "2020-02-12T19:27:45Z", "commit": {"oid": "219d1febce2c7310ee1db5a4eae7e1a748e1444c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3328, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}