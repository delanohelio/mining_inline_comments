{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc1MDM5MDE0", "number": 856, "title": "Add MetricProducer interface and explain how to use", "bodyText": "Signed-off-by: Bogdan Cristian Drutu bogdandrutu@gmail.com", "createdAt": "2020-02-13T19:07:42Z", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/856", "merged": true, "mergeCommit": {"oid": "3f2ad43f785ecc12a8c13226942ab25b42de6f6e"}, "closed": true, "closedAt": "2020-02-13T22:30:25Z", "author": {"login": "bogdandrutu"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcD_y4ZgH2gAyMzc1MDM5MDE0OmY2MGUyNzA2NTVlN2Q3ZjhkY2Q0Yzc4ZDdkZDY1ZmYwZWUzMThmYTk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcEA2ATAFqTM1ODUyMzU1NQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "f60e270655e7d7f8dcd4c78d7dd65ff0ee318fa9", "author": {"user": {"login": "bogdandrutu", "name": "Bogdan Drutu"}}, "url": "https://github.com/open-telemetry/opentelemetry-java/commit/f60e270655e7d7f8dcd4c78d7dd65ff0ee318fa9", "committedDate": "2020-02-13T19:07:27Z", "message": "Add MetriProducer interface and explain how to use\n\nSigned-off-by: Bogdan Cristian Drutu <bogdandrutu@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a2321ed31a4861f5ca2fa970c70105559ed74405", "author": {"user": {"login": "bogdandrutu", "name": "Bogdan Drutu"}}, "url": "https://github.com/open-telemetry/opentelemetry-java/commit/a2321ed31a4861f5ca2fa970c70105559ed74405", "committedDate": "2020-02-13T19:17:40Z", "message": "Clarify comment fro MetriExport.\n\nSigned-off-by: Bogdan Cristian Drutu <bogdandrutu@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU4NDg0MTc1", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/856#pullrequestreview-358484175", "createdAt": "2020-02-13T19:18:42Z", "commit": {"oid": "f60e270655e7d7f8dcd4c78d7dd65ff0ee318fa9"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xM1QxOToxODo0MlrOFpgX4w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xM1QxOToxODo0MlrOFpgX4w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTA2NjMzOQ==", "bodyText": "add a comment before this like //fill up the buffer with metrics", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/856#discussion_r379066339", "createdAt": "2020-02-13T19:18:42Z", "author": {"login": "jkwatson"}, "path": "sdk/src/main/java/io/opentelemetry/sdk/metrics/export/README.md", "diffHunk": "@@ -0,0 +1,98 @@\n+# OpenTelemetry metrics export framework\n+\n+The metrics world split between \"pushed based\" and \"pull based\" libraries and backends, and because\n+of this, the OpenTelemetry export framework needs to address all the possible combinations.\n+\n+To achieve the support for \"pushed based\" and \"pull based\" libraries the OpenTelemetry defines two\n+interfaces that helps with this:\n+* MetricProducer - is the interface that a \"pull based\" library should implement in order to make\n+data available to OpenTelemetry exporters.\n+* MetricExporter - is an interface that every OpenTelemetry exporter should implement in order to\n+allow \"push based\" libraries to push metrics to the backend.\n+\n+Here are some examples on how different libraries will interact with pull/push backends.\n+\n+**Push backend:**\n+\n+```java\n+import io.opentelemetry.sdk.metrics.export.MetricExporter;\n+import io.opentelemetry.sdk.metrics.export.MetricProducer;\n+\n+/**\n+ * Simple implementation of the MetricExporter that pushes data to the backend.\n+ */\n+public final class PushMetricExporter implements MetricExporter {  \n+  @Override\n+  ResultCode export(Collection<MetricData> metrics) {\n+    // A \"push based\" library calls to export metrics\n+    return pushToBackend(metrics);\n+  }\n+}\n+\n+/**\n+ * Class that periodically reads from all MetricProducers and pushes metrics using the\n+ * PushMetricExporter.\n+ */\n+public final class PushExporter {\n+  private final PushMetricExporter metricExporter;\n+  // IntervalMetricReader reads metrics from all producers periodically.\n+  private final IntervalMetricReader intervalMetricReader;\n+\n+  public PushExporter(Collection<MetricProducer> producers) {\n+    metricExporter = new PushMetricExporter();\n+    intervalMetricReader =\n+        new IntervalMetricReader(producers, metricExporter, 60 /* export interval sec*/);\n+  }\n+  \n+  // Can be accessed by any \"push based\" library to export metrics.\n+  public MetricExporter getMetricExporter() {\n+    return metricExporter;\n+  }\n+}\n+```\n+\n+**Pull backend:**\n+\n+```java\n+import io.opentelemetry.sdk.metrics.export.MetricExporter;\n+import io.opentelemetry.sdk.metrics.export.MetricProducer;import java.util.ArrayList;import java.util.Collections;\n+\n+/**\n+ * Simple implementation of the MetricExporter that stores data in memory and makes them available\n+ * via MetricProducer interface.\n+ */\n+public final class PullMetricExporter implements MetricExporter, MetricProducer {\n+  private final List<MetricData> metricsBuffer = new ArrayList<>();\n+\n+  @Override\n+  synchronized ResultCode export(Collection<MetricData> metrics) {\n+    metricsBuffer.addAll(metrics);\n+    return ResultCode.SUCCESS;\n+  }\n+  \n+  synchronized Collection<MetricData> getAllMetrics() {\n+    List<MetricData> ret = metricsBuffer;\n+    metricsBuffer = new ArrayList<>();\n+    return ret;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f60e270655e7d7f8dcd4c78d7dd65ff0ee318fa9"}, "originalPosition": 76}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU4NDg0NDEy", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/856#pullrequestreview-358484412", "createdAt": "2020-02-13T19:19:03Z", "commit": {"oid": "f60e270655e7d7f8dcd4c78d7dd65ff0ee318fa9"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9b17ead33b211c4f63715abab5600b8b2875ff65", "author": {"user": {"login": "bogdandrutu", "name": "Bogdan Drutu"}}, "url": "https://github.com/open-telemetry/opentelemetry-java/commit/9b17ead33b211c4f63715abab5600b8b2875ff65", "committedDate": "2020-02-13T20:12:26Z", "message": "Fix imports in pull example\n\nSigned-off-by: Bogdan Cristian Drutu <bogdandrutu@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU4NTIzNTU1", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/856#pullrequestreview-358523555", "createdAt": "2020-02-13T20:20:46Z", "commit": {"oid": "9b17ead33b211c4f63715abab5600b8b2875ff65"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3349, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}