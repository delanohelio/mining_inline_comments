{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTQyODAxNTg4", "number": 2366, "title": "Create a MANDATORY Resource instance containing mandatory attributes. Merge that into the default resource.", "bodyText": "resolves #2298 in a less drastic way, which seems to be what the spec is being updated to require.\ncompare to #2310\nspec PR reference: open-telemetry/opentelemetry-specification#1294", "createdAt": "2020-12-18T22:22:13Z", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/2366", "merged": true, "mergeCommit": {"oid": "1f84ec099b9ec58b3c949b69863663eb7ae27e9a"}, "closed": true, "closedAt": "2021-01-21T17:01:18Z", "author": {"login": "jkwatson"}, "timelineItems": {"totalCount": 13, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdnkhtYgFqTU1NTkxMzQ5Mg==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdyDLggAH2gAyNTQyODAxNTg4OjVhODZkM2NiNjAyMzI5YjRjZDIzOTE0MWU2OTg0YTA5M2E1YTYzNmM=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU1OTEzNDky", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/2366#pullrequestreview-555913492", "createdAt": "2020-12-19T03:52:47Z", "commit": {"oid": "18d6c9dbae073d9f1b114a5c7468663b102a8f10"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xOVQwMzo1Mjo0N1rOII4jpA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xOVQwMzo1MzozMlrOII4j4g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjE4NjE0OA==", "bodyText": "Think it's good if at least one of the tests has another attribute in it.", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/2366#discussion_r546186148", "createdAt": "2020-12-19T03:52:47Z", "author": {"login": "anuraaga"}, "path": "sdk/metrics/src/test/java/io/opentelemetry/sdk/metrics/spi/SdkMeterProviderFactoryTest.java", "diffHunk": "@@ -17,4 +20,26 @@\n   void testDefault() {\n     assertThat(GlobalMetricsProvider.get()).isInstanceOf(SdkMeterProvider.class);\n   }\n+\n+  @Test\n+  void builder_fallbackServiceName() {\n+    Resource resourceWithFallbacks =\n+        Resource.create(Attributes.of(ResourceAttributes.SERVICE_NAME, \"unknown_service:java\"));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "18d6c9dbae073d9f1b114a5c7468663b102a8f10"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjE4NjIxMA==", "bodyText": "Do we need this mock?", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/2366#discussion_r546186210", "createdAt": "2020-12-19T03:53:32Z", "author": {"login": "anuraaga"}, "path": "sdk/trace/src/test/java/io/opentelemetry/sdk/trace/SdkTracerProviderTest.java", "diffHunk": "@@ -42,15 +44,44 @@ void setUp() {\n   }\n \n   @Test\n-  void builder_HappyPath() {\n-    assertThat(\n-            SdkTracerProvider.builder()\n-                .setClock(mock(Clock.class))\n-                .setResource(mock(Resource.class))\n-                .setIdGenerator(mock(IdGenerator.class))\n-                .setTraceConfig(mock(TraceConfig.class))\n-                .build())\n-        .isNotNull();\n+  void builder_fallbackServiceName() {\n+    Resource resource = mock(Resource.class);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "18d6c9dbae073d9f1b114a5c7468663b102a8f10"}, "originalPosition": 29}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU1OTM0Nzc0", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/2366#pullrequestreview-555934774", "createdAt": "2020-12-19T11:14:37Z", "commit": {"oid": "18d6c9dbae073d9f1b114a5c7468663b102a8f10"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xOVQxMToxNDozN1rOII7ABQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xOVQxMToxNDozN1rOII7ABQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjIyNjE4MQ==", "bodyText": "This is how I initially proposed the spec PR, but not how I reworked it shortly after and how it got approved \ud83d\ude03\nNow the spec basically says that we should treat the service.name exactly the same as we already treat the telemetry.sdk.name: It's there by default, but if the user set's their own resource explicitly, they need to merge it in manually.\nSee open-telemetry/opentelemetry-specification#1294 (comment) and https://github.com/open-telemetry/opentelemetry-specification/blob/39fa82f0a7e58975782520c304768d63da0c7612/specification/resource/sdk.md (not yet merged).\nIf you think the first version of the PR was better, you should say so on the spec.\n@anuraaga @jkwatson You approved the spec PR after I made this change, but maybe you want to check again?", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/2366#discussion_r546226181", "createdAt": "2020-12-19T11:14:37Z", "author": {"login": "Oberon00"}, "path": "sdk/metrics/src/main/java/io/opentelemetry/sdk/metrics/SdkMeterProviderBuilder.java", "diffHunk": "@@ -52,6 +54,9 @@ public SdkMeterProviderBuilder setResource(@Nonnull Resource resource) {\n    * @return An initialized TracerSdkFactory.\n    */\n   public SdkMeterProvider build() {\n-    return new SdkMeterProvider(clock, resource);\n+    Resource resourceWithFallbacks =\n+        Resource.create(\n+            FALLBACK_MANDATORY_ATTRIBUTES.toBuilder().putAll(resource.getAttributes()).build());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "18d6c9dbae073d9f1b114a5c7468663b102a8f10"}, "originalPosition": 16}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "18d6c9dbae073d9f1b114a5c7468663b102a8f10", "author": {"user": {"login": "jkwatson", "name": "John Watson"}}, "url": "https://github.com/open-telemetry/opentelemetry-java/commit/18d6c9dbae073d9f1b114a5c7468663b102a8f10", "committedDate": "2020-12-18T22:19:42Z", "message": "Assign a fallback service name to resources when building the signal Provider instances."}, "afterCommit": {"oid": "4e9eb103033ad22cf6c5a86df032c8293df33aee", "author": {"user": {"login": "jkwatson", "name": "John Watson"}}, "url": "https://github.com/open-telemetry/opentelemetry-java/commit/4e9eb103033ad22cf6c5a86df032c8293df33aee", "committedDate": "2021-01-15T21:58:51Z", "message": "Add a MANDATORY resource that will contain all mandatory attributes."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTcwMzAxNjkx", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/2366#pullrequestreview-570301691", "createdAt": "2021-01-18T09:21:55Z", "commit": {"oid": "e60588b6313266ac8c39aaf925bd6efc7c0b775b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xOFQwOToyMTo1NlrOIVgSWw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xOFQwOToyMTo1NlrOIVgSWw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1OTQxOTk5NQ==", "bodyText": "I don't think this needs to be separated from DEFAULT. Also, this would be the only public field in this class, the others are private and have getters.", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/2366#discussion_r559419995", "createdAt": "2021-01-18T09:21:56Z", "author": {"login": "Oberon00"}, "path": "sdk/common/src/main/java/io/opentelemetry/sdk/resources/Resource.java", "diffHunk": "@@ -52,9 +53,15 @@\n   private static final String ERROR_MESSAGE_INVALID_VALUE =\n       \" should be a ASCII string with a length not exceed \" + MAX_LENGTH + \" characters.\";\n   private static final Resource EMPTY = create(Attributes.empty());\n-\n   private static final Resource TELEMETRY_SDK;\n \n+  /**\n+   * The MANDATORY Resource instance contains the mandatory attributes that must be used if they are\n+   * not provided by the Resource that is given to an SDK signal provider.\n+   */\n+  public static final Resource MANDATORY =", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e60588b6313266ac8c39aaf925bd6efc7c0b775b"}, "originalPosition": 19}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTcwMzAxOTc1", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/2366#pullrequestreview-570301975", "createdAt": "2021-01-18T09:22:16Z", "commit": {"oid": "e60588b6313266ac8c39aaf925bd6efc7c0b775b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "bb3ec8584e53b5c634c9272238be3d6544c265fa", "author": {"user": {"login": "jkwatson", "name": "John Watson"}}, "url": "https://github.com/open-telemetry/opentelemetry-java/commit/bb3ec8584e53b5c634c9272238be3d6544c265fa", "committedDate": "2021-01-19T17:01:16Z", "message": "make the MANDATORY resource instance private"}, "afterCommit": {"oid": "eca7a6f8822e7e892736f9baa9a8e2cf617f0563", "author": {"user": {"login": "jkwatson", "name": "John Watson"}}, "url": "https://github.com/open-telemetry/opentelemetry-java/commit/eca7a6f8822e7e892736f9baa9a8e2cf617f0563", "committedDate": "2021-01-20T16:42:59Z", "message": "updates from ResourceAttributes changes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "25f4d058de14a912332cca126db37d2bf1efd549", "author": {"user": {"login": "jkwatson", "name": "John Watson"}}, "url": "https://github.com/open-telemetry/opentelemetry-java/commit/25f4d058de14a912332cca126db37d2bf1efd549", "committedDate": "2021-01-20T16:57:24Z", "message": "Assign a fallback service name to resources when building the signal Provider instances."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a7cac8c2e06a0fd5ea0229718ece6957c0b577e5", "author": {"user": {"login": "jkwatson", "name": "John Watson"}}, "url": "https://github.com/open-telemetry/opentelemetry-java/commit/a7cac8c2e06a0fd5ea0229718ece6957c0b577e5", "committedDate": "2021-01-20T16:57:24Z", "message": "Add a MANDATORY resource that will contain all mandatory attributes."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4bee2614b1285a7d053e1d326893386d1c9bbe56", "author": {"user": {"login": "jkwatson", "name": "John Watson"}}, "url": "https://github.com/open-telemetry/opentelemetry-java/commit/4bee2614b1285a7d053e1d326893386d1c9bbe56", "committedDate": "2021-01-20T16:57:24Z", "message": "some cleanups of leftover stuff"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5b15f659459e07b6259e7b2c0273ef543c23d1a9", "author": {"user": {"login": "jkwatson", "name": "John Watson"}}, "url": "https://github.com/open-telemetry/opentelemetry-java/commit/5b15f659459e07b6259e7b2c0273ef543c23d1a9", "committedDate": "2021-01-20T16:57:24Z", "message": "make the MANDATORY resource instance private"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5314c14695488d7622db25f1ee49f8748b61eaaf", "author": {"user": {"login": "jkwatson", "name": "John Watson"}}, "url": "https://github.com/open-telemetry/opentelemetry-java/commit/5314c14695488d7622db25f1ee49f8748b61eaaf", "committedDate": "2021-01-20T16:57:24Z", "message": "updates from ResourceAttributes changes"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "eca7a6f8822e7e892736f9baa9a8e2cf617f0563", "author": {"user": {"login": "jkwatson", "name": "John Watson"}}, "url": "https://github.com/open-telemetry/opentelemetry-java/commit/eca7a6f8822e7e892736f9baa9a8e2cf617f0563", "committedDate": "2021-01-20T16:42:59Z", "message": "updates from ResourceAttributes changes"}, "afterCommit": {"oid": "5314c14695488d7622db25f1ee49f8748b61eaaf", "author": {"user": {"login": "jkwatson", "name": "John Watson"}}, "url": "https://github.com/open-telemetry/opentelemetry-java/commit/5314c14695488d7622db25f1ee49f8748b61eaaf", "committedDate": "2021-01-20T16:57:24Z", "message": "updates from ResourceAttributes changes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5a86d3cb602329b4cd239141e6984a093a5a636c", "author": {"user": {"login": "jkwatson", "name": "John Watson"}}, "url": "https://github.com/open-telemetry/opentelemetry-java/commit/5a86d3cb602329b4cd239141e6984a093a5a636c", "committedDate": "2021-01-20T17:15:44Z", "message": "be sure to set the service name in the jaeger tests"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3481, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}