{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDcxOTU1OTg3", "number": 1577, "reviewThreads": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNlQxNTo0Njo0N1rOEcozZA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QwNjoyNToyM1rOEdEx8w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk4NDY0MTAwOnYy", "diffSide": "RIGHT", "path": "sdk/tracing/src/main/java/io/opentelemetry/sdk/trace/Samplers.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNlQxNTo0Njo0N1rOHHSa5Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNlQxNTo0ODoyMVrOHHSfAg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzQwMzg3Nw==", "bodyText": "I'd prefer if these were final and assigned in the constructor. Then, the single-arg constructor can just pass these values in to the other constructor.", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1577#discussion_r477403877", "createdAt": "2020-08-26T15:46:47Z", "author": {"login": "jkwatson"}, "path": "sdk/tracing/src/main/java/io/opentelemetry/sdk/trace/Samplers.java", "diffHunk": "@@ -215,10 +248,35 @@ public String getDescription() {\n \n   @Immutable\n   static class ParentBased implements Sampler {\n-    private final Sampler delegateSampler;\n+    private final Sampler root;\n+    private Sampler remoteParentSampled = alwaysOn();\n+    private Sampler remoteParentNotSampled = alwaysOff();\n+    private Sampler localParentSampled = alwaysOn();\n+    private Sampler localParentNotSampled = alwaysOff();\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "70bbe23b94c243da064bcc8885cde80448e84aad"}, "originalPosition": 63}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzQwNDkzMA==", "bodyText": "agree \ud83d\udc4d . thanks.", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1577#discussion_r477404930", "createdAt": "2020-08-26T15:48:21Z", "author": {"login": "dengliming"}, "path": "sdk/tracing/src/main/java/io/opentelemetry/sdk/trace/Samplers.java", "diffHunk": "@@ -215,10 +248,35 @@ public String getDescription() {\n \n   @Immutable\n   static class ParentBased implements Sampler {\n-    private final Sampler delegateSampler;\n+    private final Sampler root;\n+    private Sampler remoteParentSampled = alwaysOn();\n+    private Sampler remoteParentNotSampled = alwaysOff();\n+    private Sampler localParentSampled = alwaysOn();\n+    private Sampler localParentNotSampled = alwaysOff();\n+", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzQwMzg3Nw=="}, "originalCommit": {"oid": "70bbe23b94c243da064bcc8885cde80448e84aad"}, "originalPosition": 63}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk4NDc1OTUxOnYy", "diffSide": "RIGHT", "path": "sdk/tracing/src/test/java/io/opentelemetry/sdk/trace/SamplersTest.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNlQxNjoxNTozOFrOHHTmYg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNlQxNjoxNzo1MVrOHHTr3w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzQyMzIwMg==", "bodyText": "What do you think about breaking this up into smaller tests, so they will fail/pass individually, rather than having one giant test?", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1577#discussion_r477423202", "createdAt": "2020-08-26T16:15:38Z", "author": {"login": "jkwatson"}, "path": "sdk/tracing/src/test/java/io/opentelemetry/sdk/trace/SamplersTest.java", "diffHunk": "@@ -231,13 +261,75 @@ void parentOrElseSampler_AlwaysOn() {\n                     Collections.emptyList())\n                 .getDecision())\n         .isEqualTo(Decision.RECORD_AND_SAMPLED);\n+\n+    assertThat(\n+            Samplers.parentBased(Samplers.alwaysOn(), null, null, null, Samplers.alwaysOn())\n+                .shouldSample(\n+                    invalidSpanContext,\n+                    traceId,\n+                    SPAN_NAME,\n+                    SPAN_KIND,\n+                    Attributes.empty(),\n+                    Collections.emptyList())\n+                .getDecision())\n+        .isEqualTo(Decision.RECORD_AND_SAMPLED);\n+\n+    // Sampled remote parent", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0af5b011f4b81212823101bae20ed3100285a9e7"}, "originalPosition": 91}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzQyNDYwNw==", "bodyText": "sure :)", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1577#discussion_r477424607", "createdAt": "2020-08-26T16:17:51Z", "author": {"login": "dengliming"}, "path": "sdk/tracing/src/test/java/io/opentelemetry/sdk/trace/SamplersTest.java", "diffHunk": "@@ -231,13 +261,75 @@ void parentOrElseSampler_AlwaysOn() {\n                     Collections.emptyList())\n                 .getDecision())\n         .isEqualTo(Decision.RECORD_AND_SAMPLED);\n+\n+    assertThat(\n+            Samplers.parentBased(Samplers.alwaysOn(), null, null, null, Samplers.alwaysOn())\n+                .shouldSample(\n+                    invalidSpanContext,\n+                    traceId,\n+                    SPAN_NAME,\n+                    SPAN_KIND,\n+                    Attributes.empty(),\n+                    Collections.emptyList())\n+                .getDecision())\n+        .isEqualTo(Decision.RECORD_AND_SAMPLED);\n+\n+    // Sampled remote parent", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzQyMzIwMg=="}, "originalCommit": {"oid": "0af5b011f4b81212823101bae20ed3100285a9e7"}, "originalPosition": 91}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk4NTI0NzcyOnYy", "diffSide": "RIGHT", "path": "sdk/tracing/src/main/java/io/opentelemetry/sdk/trace/Samplers.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNlQxODoyNjozOFrOHHYYKA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QwMjowNToxNlrOHHx8Fw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzUwMTQ4MA==", "bodyText": "I would use a Builder pattern:\npublic static Builder newBuilder(Sampler root)\n\nWhere Builder allows to set any other Sampler. this way user don't have to configure all the others default samplers.", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1577#discussion_r477501480", "createdAt": "2020-08-26T18:26:38Z", "author": {"login": "bogdandrutu"}, "path": "sdk/tracing/src/main/java/io/opentelemetry/sdk/trace/Samplers.java", "diffHunk": "@@ -147,14 +147,47 @@ public static Sampler alwaysOff() {\n    * whether or not to sample. If there is no parent, the Sampler uses the provided Sampler delegate\n    * to determine the sampling decision.\n    *\n-   * @param delegateSampler the {@code Sampler} which is used to make the sampling decisions if the\n-   *     parent does not exist.\n+   * @param root the {@code Sampler} which is used to make the sampling decisions if the parent does\n+   *     not exist.\n    * @return a {@code Sampler} that follows the parent's sampling decision if one exists, otherwise\n-   *     following the delegate sampler's decision.\n+   *     following the root sampler's decision.\n    * @since 0.7.0\n    */\n-  public static Sampler parentOrElse(Sampler delegateSampler) {\n-    return new ParentOrElse(delegateSampler);\n+  public static Sampler parentBased(Sampler root) {\n+    return new ParentBased(root);\n+  }\n+\n+  /**\n+   * Returns a {@link Sampler} that always makes the same decision as the parent {@link Span} to\n+   * whether or not to sample. If there is no parent, the Sampler uses the provided Sampler delegate\n+   * to determine the sampling decision.\n+   *\n+   * @param root the required {@code Sampler} which is used to make the sampling decisions if the\n+   *     parent does not exist.\n+   * @param remoteParentSampled the optional {@code Sampler} which is used to make the sampling\n+   *     decisions if the remote parent exist and is sampled.\n+   * @param remoteParentNotSampled the optional {@code Sampler} which is used to make the sampling\n+   *     decisions if the remote parent exist and is not sampled.\n+   * @param localParentSampled the optional {@code Sampler} which is used to make the sampling\n+   *     decisions if the local parent exist and is sampled.\n+   * @param localParentNotSampled the optional {@code Sampler} which is used to make the sampling\n+   *     decisions if the local parent exist and is not sampled.\n+   * @return a {@code Sampler} that follows the parent's sampling decision if one exists, otherwise\n+   *     following the root sampler and other optional sampler's decision.\n+   * @since 0.8.0\n+   */\n+  public static Sampler parentBased(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e5b3a89c66f10d6cf910d67e11200f72b8496a63"}, "originalPosition": 38}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3Nzg4NTk5Mg==", "bodyText": "\ud83d\udc4d what about newParentBasedBuilder ?", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1577#discussion_r477885992", "createdAt": "2020-08-27T01:40:24Z", "author": {"login": "dengliming"}, "path": "sdk/tracing/src/main/java/io/opentelemetry/sdk/trace/Samplers.java", "diffHunk": "@@ -147,14 +147,47 @@ public static Sampler alwaysOff() {\n    * whether or not to sample. If there is no parent, the Sampler uses the provided Sampler delegate\n    * to determine the sampling decision.\n    *\n-   * @param delegateSampler the {@code Sampler} which is used to make the sampling decisions if the\n-   *     parent does not exist.\n+   * @param root the {@code Sampler} which is used to make the sampling decisions if the parent does\n+   *     not exist.\n    * @return a {@code Sampler} that follows the parent's sampling decision if one exists, otherwise\n-   *     following the delegate sampler's decision.\n+   *     following the root sampler's decision.\n    * @since 0.7.0\n    */\n-  public static Sampler parentOrElse(Sampler delegateSampler) {\n-    return new ParentOrElse(delegateSampler);\n+  public static Sampler parentBased(Sampler root) {\n+    return new ParentBased(root);\n+  }\n+\n+  /**\n+   * Returns a {@link Sampler} that always makes the same decision as the parent {@link Span} to\n+   * whether or not to sample. If there is no parent, the Sampler uses the provided Sampler delegate\n+   * to determine the sampling decision.\n+   *\n+   * @param root the required {@code Sampler} which is used to make the sampling decisions if the\n+   *     parent does not exist.\n+   * @param remoteParentSampled the optional {@code Sampler} which is used to make the sampling\n+   *     decisions if the remote parent exist and is sampled.\n+   * @param remoteParentNotSampled the optional {@code Sampler} which is used to make the sampling\n+   *     decisions if the remote parent exist and is not sampled.\n+   * @param localParentSampled the optional {@code Sampler} which is used to make the sampling\n+   *     decisions if the local parent exist and is sampled.\n+   * @param localParentNotSampled the optional {@code Sampler} which is used to make the sampling\n+   *     decisions if the local parent exist and is not sampled.\n+   * @return a {@code Sampler} that follows the parent's sampling decision if one exists, otherwise\n+   *     following the root sampler and other optional sampler's decision.\n+   * @since 0.8.0\n+   */\n+  public static Sampler parentBased(", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzUwMTQ4MA=="}, "originalCommit": {"oid": "e5b3a89c66f10d6cf910d67e11200f72b8496a63"}, "originalPosition": 38}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzkyMDI3OQ==", "bodyText": "seems ok for a start, yes", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1577#discussion_r477920279", "createdAt": "2020-08-27T02:05:16Z", "author": {"login": "jkwatson"}, "path": "sdk/tracing/src/main/java/io/opentelemetry/sdk/trace/Samplers.java", "diffHunk": "@@ -147,14 +147,47 @@ public static Sampler alwaysOff() {\n    * whether or not to sample. If there is no parent, the Sampler uses the provided Sampler delegate\n    * to determine the sampling decision.\n    *\n-   * @param delegateSampler the {@code Sampler} which is used to make the sampling decisions if the\n-   *     parent does not exist.\n+   * @param root the {@code Sampler} which is used to make the sampling decisions if the parent does\n+   *     not exist.\n    * @return a {@code Sampler} that follows the parent's sampling decision if one exists, otherwise\n-   *     following the delegate sampler's decision.\n+   *     following the root sampler's decision.\n    * @since 0.7.0\n    */\n-  public static Sampler parentOrElse(Sampler delegateSampler) {\n-    return new ParentOrElse(delegateSampler);\n+  public static Sampler parentBased(Sampler root) {\n+    return new ParentBased(root);\n+  }\n+\n+  /**\n+   * Returns a {@link Sampler} that always makes the same decision as the parent {@link Span} to\n+   * whether or not to sample. If there is no parent, the Sampler uses the provided Sampler delegate\n+   * to determine the sampling decision.\n+   *\n+   * @param root the required {@code Sampler} which is used to make the sampling decisions if the\n+   *     parent does not exist.\n+   * @param remoteParentSampled the optional {@code Sampler} which is used to make the sampling\n+   *     decisions if the remote parent exist and is sampled.\n+   * @param remoteParentNotSampled the optional {@code Sampler} which is used to make the sampling\n+   *     decisions if the remote parent exist and is not sampled.\n+   * @param localParentSampled the optional {@code Sampler} which is used to make the sampling\n+   *     decisions if the local parent exist and is sampled.\n+   * @param localParentNotSampled the optional {@code Sampler} which is used to make the sampling\n+   *     decisions if the local parent exist and is not sampled.\n+   * @return a {@code Sampler} that follows the parent's sampling decision if one exists, otherwise\n+   *     following the root sampler and other optional sampler's decision.\n+   * @since 0.8.0\n+   */\n+  public static Sampler parentBased(", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzUwMTQ4MA=="}, "originalCommit": {"oid": "e5b3a89c66f10d6cf910d67e11200f72b8496a63"}, "originalPosition": 38}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk4OTA3NDMyOnYy", "diffSide": "RIGHT", "path": "sdk/tracing/src/main/java/io/opentelemetry/sdk/trace/Samplers.java", "isResolved": true, "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QwNTo0OTowNlrOHIABew==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOFQwOTozMDoxMlrOHI1LGg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODE1MTAzNQ==", "bodyText": "Also to @jkwatson I think we should either have new on both or new on neither the non-builder and builder factories, they seem equally new. wdyt?", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1577#discussion_r478151035", "createdAt": "2020-08-27T05:49:06Z", "author": {"login": "anuraaga"}, "path": "sdk/tracing/src/main/java/io/opentelemetry/sdk/trace/Samplers.java", "diffHunk": "@@ -147,14 +147,27 @@ public static Sampler alwaysOff() {\n    * whether or not to sample. If there is no parent, the Sampler uses the provided Sampler delegate\n    * to determine the sampling decision.\n    *\n-   * @param delegateSampler the {@code Sampler} which is used to make the sampling decisions if the\n-   *     parent does not exist.\n+   * @param root the {@code Sampler} which is used to make the sampling decisions if the parent does\n+   *     not exist.\n    * @return a {@code Sampler} that follows the parent's sampling decision if one exists, otherwise\n-   *     following the delegate sampler's decision.\n+   *     following the root sampler's decision.\n    * @since 0.7.0\n    */\n-  public static Sampler parentOrElse(Sampler delegateSampler) {\n-    return new ParentOrElse(delegateSampler);\n+  public static Sampler parentBased(Sampler root) {\n+    return newParentBasedBuilder(root).build();\n+  }\n+\n+  /**\n+   * Returns a {@link ParentBased.Builder} that follows the parent's sampling decision if one\n+   * exists, otherwise following the root sampler and other optional sampler's decision.\n+   *\n+   * @param root the required {@code Sampler} which is used to make the sampling decisions if the\n+   *     parent does not exist.\n+   * @return a {@code ParentBased.Builder}\n+   * @since 0.8.0\n+   */\n+  public static ParentBased.Builder newParentBasedBuilder(Sampler root) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "78333571cf1dcb22b298d7cc8184b18821ae73a8"}, "originalPosition": 28}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODE3NzE5OA==", "bodyText": "Usually, If we provide builder  factories, we should keep the constructor  private. right?", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1577#discussion_r478177198", "createdAt": "2020-08-27T06:26:44Z", "author": {"login": "dengliming"}, "path": "sdk/tracing/src/main/java/io/opentelemetry/sdk/trace/Samplers.java", "diffHunk": "@@ -147,14 +147,27 @@ public static Sampler alwaysOff() {\n    * whether or not to sample. If there is no parent, the Sampler uses the provided Sampler delegate\n    * to determine the sampling decision.\n    *\n-   * @param delegateSampler the {@code Sampler} which is used to make the sampling decisions if the\n-   *     parent does not exist.\n+   * @param root the {@code Sampler} which is used to make the sampling decisions if the parent does\n+   *     not exist.\n    * @return a {@code Sampler} that follows the parent's sampling decision if one exists, otherwise\n-   *     following the delegate sampler's decision.\n+   *     following the root sampler's decision.\n    * @since 0.7.0\n    */\n-  public static Sampler parentOrElse(Sampler delegateSampler) {\n-    return new ParentOrElse(delegateSampler);\n+  public static Sampler parentBased(Sampler root) {\n+    return newParentBasedBuilder(root).build();\n+  }\n+\n+  /**\n+   * Returns a {@link ParentBased.Builder} that follows the parent's sampling decision if one\n+   * exists, otherwise following the root sampler and other optional sampler's decision.\n+   *\n+   * @param root the required {@code Sampler} which is used to make the sampling decisions if the\n+   *     parent does not exist.\n+   * @return a {@code ParentBased.Builder}\n+   * @since 0.8.0\n+   */\n+  public static ParentBased.Builder newParentBasedBuilder(Sampler root) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODE1MTAzNQ=="}, "originalCommit": {"oid": "78333571cf1dcb22b298d7cc8184b18821ae73a8"}, "originalPosition": 28}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODU2NTUyNQ==", "bodyText": "@anuraaga you were suggesting that the parentBased(Sampler) method should be newParentBased(Sampler), if we want them to match, correct?", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1577#discussion_r478565525", "createdAt": "2020-08-27T17:01:03Z", "author": {"login": "jkwatson"}, "path": "sdk/tracing/src/main/java/io/opentelemetry/sdk/trace/Samplers.java", "diffHunk": "@@ -147,14 +147,27 @@ public static Sampler alwaysOff() {\n    * whether or not to sample. If there is no parent, the Sampler uses the provided Sampler delegate\n    * to determine the sampling decision.\n    *\n-   * @param delegateSampler the {@code Sampler} which is used to make the sampling decisions if the\n-   *     parent does not exist.\n+   * @param root the {@code Sampler} which is used to make the sampling decisions if the parent does\n+   *     not exist.\n    * @return a {@code Sampler} that follows the parent's sampling decision if one exists, otherwise\n-   *     following the delegate sampler's decision.\n+   *     following the root sampler's decision.\n    * @since 0.7.0\n    */\n-  public static Sampler parentOrElse(Sampler delegateSampler) {\n-    return new ParentOrElse(delegateSampler);\n+  public static Sampler parentBased(Sampler root) {\n+    return newParentBasedBuilder(root).build();\n+  }\n+\n+  /**\n+   * Returns a {@link ParentBased.Builder} that follows the parent's sampling decision if one\n+   * exists, otherwise following the root sampler and other optional sampler's decision.\n+   *\n+   * @param root the required {@code Sampler} which is used to make the sampling decisions if the\n+   *     parent does not exist.\n+   * @return a {@code ParentBased.Builder}\n+   * @since 0.8.0\n+   */\n+  public static ParentBased.Builder newParentBasedBuilder(Sampler root) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODE1MTAzNQ=="}, "originalCommit": {"oid": "78333571cf1dcb22b298d7cc8184b18821ae73a8"}, "originalPosition": 28}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODk3NTU4Mw==", "bodyText": "Ah yeah I was just talking about the factory names, not about changing constructor visibility. Indeed newParentBased(Sampler). Alternatively, rename the builder returning one to parentBasedBuilder", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1577#discussion_r478975583", "createdAt": "2020-08-28T08:59:30Z", "author": {"login": "anuraaga"}, "path": "sdk/tracing/src/main/java/io/opentelemetry/sdk/trace/Samplers.java", "diffHunk": "@@ -147,14 +147,27 @@ public static Sampler alwaysOff() {\n    * whether or not to sample. If there is no parent, the Sampler uses the provided Sampler delegate\n    * to determine the sampling decision.\n    *\n-   * @param delegateSampler the {@code Sampler} which is used to make the sampling decisions if the\n-   *     parent does not exist.\n+   * @param root the {@code Sampler} which is used to make the sampling decisions if the parent does\n+   *     not exist.\n    * @return a {@code Sampler} that follows the parent's sampling decision if one exists, otherwise\n-   *     following the delegate sampler's decision.\n+   *     following the root sampler's decision.\n    * @since 0.7.0\n    */\n-  public static Sampler parentOrElse(Sampler delegateSampler) {\n-    return new ParentOrElse(delegateSampler);\n+  public static Sampler parentBased(Sampler root) {\n+    return newParentBasedBuilder(root).build();\n+  }\n+\n+  /**\n+   * Returns a {@link ParentBased.Builder} that follows the parent's sampling decision if one\n+   * exists, otherwise following the root sampler and other optional sampler's decision.\n+   *\n+   * @param root the required {@code Sampler} which is used to make the sampling decisions if the\n+   *     parent does not exist.\n+   * @return a {@code ParentBased.Builder}\n+   * @since 0.8.0\n+   */\n+  public static ParentBased.Builder newParentBasedBuilder(Sampler root) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODE1MTAzNQ=="}, "originalCommit": {"oid": "78333571cf1dcb22b298d7cc8184b18821ae73a8"}, "originalPosition": 28}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTAwMDg5Mg==", "bodyText": "@anuraaga Gotcha \ud83d\udc4d thanks. what about this?\nparentBased(Sampler root)\nparentBasedBuilder(Sampler root)", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1577#discussion_r479000892", "createdAt": "2020-08-28T09:15:40Z", "author": {"login": "dengliming"}, "path": "sdk/tracing/src/main/java/io/opentelemetry/sdk/trace/Samplers.java", "diffHunk": "@@ -147,14 +147,27 @@ public static Sampler alwaysOff() {\n    * whether or not to sample. If there is no parent, the Sampler uses the provided Sampler delegate\n    * to determine the sampling decision.\n    *\n-   * @param delegateSampler the {@code Sampler} which is used to make the sampling decisions if the\n-   *     parent does not exist.\n+   * @param root the {@code Sampler} which is used to make the sampling decisions if the parent does\n+   *     not exist.\n    * @return a {@code Sampler} that follows the parent's sampling decision if one exists, otherwise\n-   *     following the delegate sampler's decision.\n+   *     following the root sampler's decision.\n    * @since 0.7.0\n    */\n-  public static Sampler parentOrElse(Sampler delegateSampler) {\n-    return new ParentOrElse(delegateSampler);\n+  public static Sampler parentBased(Sampler root) {\n+    return newParentBasedBuilder(root).build();\n+  }\n+\n+  /**\n+   * Returns a {@link ParentBased.Builder} that follows the parent's sampling decision if one\n+   * exists, otherwise following the root sampler and other optional sampler's decision.\n+   *\n+   * @param root the required {@code Sampler} which is used to make the sampling decisions if the\n+   *     parent does not exist.\n+   * @return a {@code ParentBased.Builder}\n+   * @since 0.8.0\n+   */\n+  public static ParentBased.Builder newParentBasedBuilder(Sampler root) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODE1MTAzNQ=="}, "originalCommit": {"oid": "78333571cf1dcb22b298d7cc8184b18821ae73a8"}, "originalPosition": 28}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTAyMTg1MA==", "bodyText": "I'm good with that :)", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1577#discussion_r479021850", "createdAt": "2020-08-28T09:30:12Z", "author": {"login": "anuraaga"}, "path": "sdk/tracing/src/main/java/io/opentelemetry/sdk/trace/Samplers.java", "diffHunk": "@@ -147,14 +147,27 @@ public static Sampler alwaysOff() {\n    * whether or not to sample. If there is no parent, the Sampler uses the provided Sampler delegate\n    * to determine the sampling decision.\n    *\n-   * @param delegateSampler the {@code Sampler} which is used to make the sampling decisions if the\n-   *     parent does not exist.\n+   * @param root the {@code Sampler} which is used to make the sampling decisions if the parent does\n+   *     not exist.\n    * @return a {@code Sampler} that follows the parent's sampling decision if one exists, otherwise\n-   *     following the delegate sampler's decision.\n+   *     following the root sampler's decision.\n    * @since 0.7.0\n    */\n-  public static Sampler parentOrElse(Sampler delegateSampler) {\n-    return new ParentOrElse(delegateSampler);\n+  public static Sampler parentBased(Sampler root) {\n+    return newParentBasedBuilder(root).build();\n+  }\n+\n+  /**\n+   * Returns a {@link ParentBased.Builder} that follows the parent's sampling decision if one\n+   * exists, otherwise following the root sampler and other optional sampler's decision.\n+   *\n+   * @param root the required {@code Sampler} which is used to make the sampling decisions if the\n+   *     parent does not exist.\n+   * @return a {@code ParentBased.Builder}\n+   * @since 0.8.0\n+   */\n+  public static ParentBased.Builder newParentBasedBuilder(Sampler root) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODE1MTAzNQ=="}, "originalCommit": {"oid": "78333571cf1dcb22b298d7cc8184b18821ae73a8"}, "originalPosition": 28}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk4OTA4MTMzOnYy", "diffSide": "RIGHT", "path": "sdk/tracing/src/main/java/io/opentelemetry/sdk/trace/Samplers.java", "isResolved": true, "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QwNTo1MDo0N1rOHIAGFg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QxNzowODo1NFrOHIZl-Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODE1MjIxNA==", "bodyText": "Our other builders like SpanBuilder and Attributes.Builder use set instead of with, can you use set here too?", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1577#discussion_r478152214", "createdAt": "2020-08-27T05:50:47Z", "author": {"login": "anuraaga"}, "path": "sdk/tracing/src/main/java/io/opentelemetry/sdk/trace/Samplers.java", "diffHunk": "@@ -231,19 +259,109 @@ public SamplingResult shouldSample(\n         Kind spanKind,\n         ReadableAttributes attributes,\n         List<Link> parentLinks) {\n-      if (parentContext.isValid()) {\n-        if (parentContext.getTraceFlags().isSampled()) {\n-          return EMPTY_RECORDED_AND_SAMPLED_SAMPLING_RESULT;\n-        }\n-        return EMPTY_NOT_SAMPLED_OR_RECORDED_SAMPLING_RESULT;\n+      if (!parentContext.isValid()) {\n+        return this.root.shouldSample(\n+            parentContext, traceId, name, spanKind, attributes, parentLinks);\n       }\n-      return this.delegateSampler.shouldSample(\n-          parentContext, traceId, name, spanKind, attributes, parentLinks);\n+\n+      if (parentContext.isRemote()) {\n+        return parentContext.getTraceFlags().isSampled()\n+            ? this.remoteParentSampled.shouldSample(\n+                parentContext, traceId, name, spanKind, attributes, parentLinks)\n+            : this.remoteParentNotSampled.shouldSample(\n+                parentContext, traceId, name, spanKind, attributes, parentLinks);\n+      }\n+      return parentContext.getTraceFlags().isSampled()\n+          ? this.localParentSampled.shouldSample(\n+              parentContext, traceId, name, spanKind, attributes, parentLinks)\n+          : this.localParentNotSampled.shouldSample(\n+              parentContext, traceId, name, spanKind, attributes, parentLinks);\n     }\n \n     @Override\n     public String getDescription() {\n-      return String.format(\"ParentOrElse{%s}\", this.delegateSampler.getDescription());\n+      return String.format(\n+          \"ParentBased{root:%s,remoteParentSampled:%s,remoteParentNotSampled:%s,\"\n+              + \"localParentSampled:%s,localParentNotSampled:%s}\",\n+          this.root.getDescription(),\n+          this.remoteParentSampled.getDescription(),\n+          this.remoteParentNotSampled.getDescription(),\n+          this.localParentSampled.getDescription(),\n+          this.localParentNotSampled.getDescription());\n+    }\n+\n+    static class Builder {\n+      private final Sampler root;\n+      private Sampler remoteParentSampled;\n+      private Sampler remoteParentNotSampled;\n+      private Sampler localParentSampled;\n+      private Sampler localParentNotSampled;\n+\n+      /**\n+       * Sets the remoteParentSampled. Optional.\n+       *\n+       * @param remoteParentSampled used to make the sampling decisions if the remote parent exist\n+       *     and is sampled.\n+       * @return this.\n+       */\n+      public Builder withRemoteParentSampled(Sampler remoteParentSampled) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "583078ab28a14ab78a009d8207685e7f20aac138"}, "originalPosition": 122}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODE1Mjg3Mw==", "bodyText": "Alternatively, when seems like it could fit as a special semantics for this class, in particular I think if the variable was named Sampler whenRemoteParentSampled it's really easy to read.", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1577#discussion_r478152873", "createdAt": "2020-08-27T05:51:49Z", "author": {"login": "anuraaga"}, "path": "sdk/tracing/src/main/java/io/opentelemetry/sdk/trace/Samplers.java", "diffHunk": "@@ -231,19 +259,109 @@ public SamplingResult shouldSample(\n         Kind spanKind,\n         ReadableAttributes attributes,\n         List<Link> parentLinks) {\n-      if (parentContext.isValid()) {\n-        if (parentContext.getTraceFlags().isSampled()) {\n-          return EMPTY_RECORDED_AND_SAMPLED_SAMPLING_RESULT;\n-        }\n-        return EMPTY_NOT_SAMPLED_OR_RECORDED_SAMPLING_RESULT;\n+      if (!parentContext.isValid()) {\n+        return this.root.shouldSample(\n+            parentContext, traceId, name, spanKind, attributes, parentLinks);\n       }\n-      return this.delegateSampler.shouldSample(\n-          parentContext, traceId, name, spanKind, attributes, parentLinks);\n+\n+      if (parentContext.isRemote()) {\n+        return parentContext.getTraceFlags().isSampled()\n+            ? this.remoteParentSampled.shouldSample(\n+                parentContext, traceId, name, spanKind, attributes, parentLinks)\n+            : this.remoteParentNotSampled.shouldSample(\n+                parentContext, traceId, name, spanKind, attributes, parentLinks);\n+      }\n+      return parentContext.getTraceFlags().isSampled()\n+          ? this.localParentSampled.shouldSample(\n+              parentContext, traceId, name, spanKind, attributes, parentLinks)\n+          : this.localParentNotSampled.shouldSample(\n+              parentContext, traceId, name, spanKind, attributes, parentLinks);\n     }\n \n     @Override\n     public String getDescription() {\n-      return String.format(\"ParentOrElse{%s}\", this.delegateSampler.getDescription());\n+      return String.format(\n+          \"ParentBased{root:%s,remoteParentSampled:%s,remoteParentNotSampled:%s,\"\n+              + \"localParentSampled:%s,localParentNotSampled:%s}\",\n+          this.root.getDescription(),\n+          this.remoteParentSampled.getDescription(),\n+          this.remoteParentNotSampled.getDescription(),\n+          this.localParentSampled.getDescription(),\n+          this.localParentNotSampled.getDescription());\n+    }\n+\n+    static class Builder {\n+      private final Sampler root;\n+      private Sampler remoteParentSampled;\n+      private Sampler remoteParentNotSampled;\n+      private Sampler localParentSampled;\n+      private Sampler localParentNotSampled;\n+\n+      /**\n+       * Sets the remoteParentSampled. Optional.\n+       *\n+       * @param remoteParentSampled used to make the sampling decisions if the remote parent exist\n+       *     and is sampled.\n+       * @return this.\n+       */\n+      public Builder withRemoteParentSampled(Sampler remoteParentSampled) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODE1MjIxNA=="}, "originalCommit": {"oid": "583078ab28a14ab78a009d8207685e7f20aac138"}, "originalPosition": 122}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODE3MTQ2MA==", "bodyText": "named Sampler whenRemoteParentSampled it's really easy to read.\n\n+1 @jkwatson wdyt?", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1577#discussion_r478171460", "createdAt": "2020-08-27T06:18:56Z", "author": {"login": "dengliming"}, "path": "sdk/tracing/src/main/java/io/opentelemetry/sdk/trace/Samplers.java", "diffHunk": "@@ -231,19 +259,109 @@ public SamplingResult shouldSample(\n         Kind spanKind,\n         ReadableAttributes attributes,\n         List<Link> parentLinks) {\n-      if (parentContext.isValid()) {\n-        if (parentContext.getTraceFlags().isSampled()) {\n-          return EMPTY_RECORDED_AND_SAMPLED_SAMPLING_RESULT;\n-        }\n-        return EMPTY_NOT_SAMPLED_OR_RECORDED_SAMPLING_RESULT;\n+      if (!parentContext.isValid()) {\n+        return this.root.shouldSample(\n+            parentContext, traceId, name, spanKind, attributes, parentLinks);\n       }\n-      return this.delegateSampler.shouldSample(\n-          parentContext, traceId, name, spanKind, attributes, parentLinks);\n+\n+      if (parentContext.isRemote()) {\n+        return parentContext.getTraceFlags().isSampled()\n+            ? this.remoteParentSampled.shouldSample(\n+                parentContext, traceId, name, spanKind, attributes, parentLinks)\n+            : this.remoteParentNotSampled.shouldSample(\n+                parentContext, traceId, name, spanKind, attributes, parentLinks);\n+      }\n+      return parentContext.getTraceFlags().isSampled()\n+          ? this.localParentSampled.shouldSample(\n+              parentContext, traceId, name, spanKind, attributes, parentLinks)\n+          : this.localParentNotSampled.shouldSample(\n+              parentContext, traceId, name, spanKind, attributes, parentLinks);\n     }\n \n     @Override\n     public String getDescription() {\n-      return String.format(\"ParentOrElse{%s}\", this.delegateSampler.getDescription());\n+      return String.format(\n+          \"ParentBased{root:%s,remoteParentSampled:%s,remoteParentNotSampled:%s,\"\n+              + \"localParentSampled:%s,localParentNotSampled:%s}\",\n+          this.root.getDescription(),\n+          this.remoteParentSampled.getDescription(),\n+          this.remoteParentNotSampled.getDescription(),\n+          this.localParentSampled.getDescription(),\n+          this.localParentNotSampled.getDescription());\n+    }\n+\n+    static class Builder {\n+      private final Sampler root;\n+      private Sampler remoteParentSampled;\n+      private Sampler remoteParentNotSampled;\n+      private Sampler localParentSampled;\n+      private Sampler localParentNotSampled;\n+\n+      /**\n+       * Sets the remoteParentSampled. Optional.\n+       *\n+       * @param remoteParentSampled used to make the sampling decisions if the remote parent exist\n+       *     and is sampled.\n+       * @return this.\n+       */\n+      public Builder withRemoteParentSampled(Sampler remoteParentSampled) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODE1MjIxNA=="}, "originalCommit": {"oid": "583078ab28a14ab78a009d8207685e7f20aac138"}, "originalPosition": 122}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODU2NzE4MA==", "bodyText": "I think I'd go with set for consistency with the other APIs.", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1577#discussion_r478567180", "createdAt": "2020-08-27T17:03:52Z", "author": {"login": "jkwatson"}, "path": "sdk/tracing/src/main/java/io/opentelemetry/sdk/trace/Samplers.java", "diffHunk": "@@ -231,19 +259,109 @@ public SamplingResult shouldSample(\n         Kind spanKind,\n         ReadableAttributes attributes,\n         List<Link> parentLinks) {\n-      if (parentContext.isValid()) {\n-        if (parentContext.getTraceFlags().isSampled()) {\n-          return EMPTY_RECORDED_AND_SAMPLED_SAMPLING_RESULT;\n-        }\n-        return EMPTY_NOT_SAMPLED_OR_RECORDED_SAMPLING_RESULT;\n+      if (!parentContext.isValid()) {\n+        return this.root.shouldSample(\n+            parentContext, traceId, name, spanKind, attributes, parentLinks);\n       }\n-      return this.delegateSampler.shouldSample(\n-          parentContext, traceId, name, spanKind, attributes, parentLinks);\n+\n+      if (parentContext.isRemote()) {\n+        return parentContext.getTraceFlags().isSampled()\n+            ? this.remoteParentSampled.shouldSample(\n+                parentContext, traceId, name, spanKind, attributes, parentLinks)\n+            : this.remoteParentNotSampled.shouldSample(\n+                parentContext, traceId, name, spanKind, attributes, parentLinks);\n+      }\n+      return parentContext.getTraceFlags().isSampled()\n+          ? this.localParentSampled.shouldSample(\n+              parentContext, traceId, name, spanKind, attributes, parentLinks)\n+          : this.localParentNotSampled.shouldSample(\n+              parentContext, traceId, name, spanKind, attributes, parentLinks);\n     }\n \n     @Override\n     public String getDescription() {\n-      return String.format(\"ParentOrElse{%s}\", this.delegateSampler.getDescription());\n+      return String.format(\n+          \"ParentBased{root:%s,remoteParentSampled:%s,remoteParentNotSampled:%s,\"\n+              + \"localParentSampled:%s,localParentNotSampled:%s}\",\n+          this.root.getDescription(),\n+          this.remoteParentSampled.getDescription(),\n+          this.remoteParentNotSampled.getDescription(),\n+          this.localParentSampled.getDescription(),\n+          this.localParentNotSampled.getDescription());\n+    }\n+\n+    static class Builder {\n+      private final Sampler root;\n+      private Sampler remoteParentSampled;\n+      private Sampler remoteParentNotSampled;\n+      private Sampler localParentSampled;\n+      private Sampler localParentNotSampled;\n+\n+      /**\n+       * Sets the remoteParentSampled. Optional.\n+       *\n+       * @param remoteParentSampled used to make the sampling decisions if the remote parent exist\n+       *     and is sampled.\n+       * @return this.\n+       */\n+      public Builder withRemoteParentSampled(Sampler remoteParentSampled) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODE1MjIxNA=="}, "originalCommit": {"oid": "583078ab28a14ab78a009d8207685e7f20aac138"}, "originalPosition": 122}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODU2OTk3Nw==", "bodyText": "thanks. Let's use set  instead of with.", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1577#discussion_r478569977", "createdAt": "2020-08-27T17:08:54Z", "author": {"login": "dengliming"}, "path": "sdk/tracing/src/main/java/io/opentelemetry/sdk/trace/Samplers.java", "diffHunk": "@@ -231,19 +259,109 @@ public SamplingResult shouldSample(\n         Kind spanKind,\n         ReadableAttributes attributes,\n         List<Link> parentLinks) {\n-      if (parentContext.isValid()) {\n-        if (parentContext.getTraceFlags().isSampled()) {\n-          return EMPTY_RECORDED_AND_SAMPLED_SAMPLING_RESULT;\n-        }\n-        return EMPTY_NOT_SAMPLED_OR_RECORDED_SAMPLING_RESULT;\n+      if (!parentContext.isValid()) {\n+        return this.root.shouldSample(\n+            parentContext, traceId, name, spanKind, attributes, parentLinks);\n       }\n-      return this.delegateSampler.shouldSample(\n-          parentContext, traceId, name, spanKind, attributes, parentLinks);\n+\n+      if (parentContext.isRemote()) {\n+        return parentContext.getTraceFlags().isSampled()\n+            ? this.remoteParentSampled.shouldSample(\n+                parentContext, traceId, name, spanKind, attributes, parentLinks)\n+            : this.remoteParentNotSampled.shouldSample(\n+                parentContext, traceId, name, spanKind, attributes, parentLinks);\n+      }\n+      return parentContext.getTraceFlags().isSampled()\n+          ? this.localParentSampled.shouldSample(\n+              parentContext, traceId, name, spanKind, attributes, parentLinks)\n+          : this.localParentNotSampled.shouldSample(\n+              parentContext, traceId, name, spanKind, attributes, parentLinks);\n     }\n \n     @Override\n     public String getDescription() {\n-      return String.format(\"ParentOrElse{%s}\", this.delegateSampler.getDescription());\n+      return String.format(\n+          \"ParentBased{root:%s,remoteParentSampled:%s,remoteParentNotSampled:%s,\"\n+              + \"localParentSampled:%s,localParentNotSampled:%s}\",\n+          this.root.getDescription(),\n+          this.remoteParentSampled.getDescription(),\n+          this.remoteParentNotSampled.getDescription(),\n+          this.localParentSampled.getDescription(),\n+          this.localParentNotSampled.getDescription());\n+    }\n+\n+    static class Builder {\n+      private final Sampler root;\n+      private Sampler remoteParentSampled;\n+      private Sampler remoteParentNotSampled;\n+      private Sampler localParentSampled;\n+      private Sampler localParentNotSampled;\n+\n+      /**\n+       * Sets the remoteParentSampled. Optional.\n+       *\n+       * @param remoteParentSampled used to make the sampling decisions if the remote parent exist\n+       *     and is sampled.\n+       * @return this.\n+       */\n+      public Builder withRemoteParentSampled(Sampler remoteParentSampled) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODE1MjIxNA=="}, "originalCommit": {"oid": "583078ab28a14ab78a009d8207685e7f20aac138"}, "originalPosition": 122}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk4OTA5MDI2OnYy", "diffSide": "RIGHT", "path": "sdk/tracing/src/main/java/io/opentelemetry/sdk/trace/Samplers.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QwNTo1MzowNlrOHIAL3Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QwNjoyMjo1MVrOHIBcYA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODE1MzY5Mw==", "bodyText": "Sets the {@link Sampler} to use when there is a remote parent that was sampled.", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1577#discussion_r478153693", "createdAt": "2020-08-27T05:53:06Z", "author": {"login": "anuraaga"}, "path": "sdk/tracing/src/main/java/io/opentelemetry/sdk/trace/Samplers.java", "diffHunk": "@@ -231,19 +259,109 @@ public SamplingResult shouldSample(\n         Kind spanKind,\n         ReadableAttributes attributes,\n         List<Link> parentLinks) {\n-      if (parentContext.isValid()) {\n-        if (parentContext.getTraceFlags().isSampled()) {\n-          return EMPTY_RECORDED_AND_SAMPLED_SAMPLING_RESULT;\n-        }\n-        return EMPTY_NOT_SAMPLED_OR_RECORDED_SAMPLING_RESULT;\n+      if (!parentContext.isValid()) {\n+        return this.root.shouldSample(\n+            parentContext, traceId, name, spanKind, attributes, parentLinks);\n       }\n-      return this.delegateSampler.shouldSample(\n-          parentContext, traceId, name, spanKind, attributes, parentLinks);\n+\n+      if (parentContext.isRemote()) {\n+        return parentContext.getTraceFlags().isSampled()\n+            ? this.remoteParentSampled.shouldSample(\n+                parentContext, traceId, name, spanKind, attributes, parentLinks)\n+            : this.remoteParentNotSampled.shouldSample(\n+                parentContext, traceId, name, spanKind, attributes, parentLinks);\n+      }\n+      return parentContext.getTraceFlags().isSampled()\n+          ? this.localParentSampled.shouldSample(\n+              parentContext, traceId, name, spanKind, attributes, parentLinks)\n+          : this.localParentNotSampled.shouldSample(\n+              parentContext, traceId, name, spanKind, attributes, parentLinks);\n     }\n \n     @Override\n     public String getDescription() {\n-      return String.format(\"ParentOrElse{%s}\", this.delegateSampler.getDescription());\n+      return String.format(\n+          \"ParentBased{root:%s,remoteParentSampled:%s,remoteParentNotSampled:%s,\"\n+              + \"localParentSampled:%s,localParentNotSampled:%s}\",\n+          this.root.getDescription(),\n+          this.remoteParentSampled.getDescription(),\n+          this.remoteParentNotSampled.getDescription(),\n+          this.localParentSampled.getDescription(),\n+          this.localParentNotSampled.getDescription());\n+    }\n+\n+    static class Builder {\n+      private final Sampler root;\n+      private Sampler remoteParentSampled;\n+      private Sampler remoteParentNotSampled;\n+      private Sampler localParentSampled;\n+      private Sampler localParentNotSampled;\n+\n+      /**\n+       * Sets the remoteParentSampled. Optional.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "583078ab28a14ab78a009d8207685e7f20aac138"}, "originalPosition": 116}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODE3NDMwNA==", "bodyText": "thanks. fixed at lastest commit.", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1577#discussion_r478174304", "createdAt": "2020-08-27T06:22:51Z", "author": {"login": "dengliming"}, "path": "sdk/tracing/src/main/java/io/opentelemetry/sdk/trace/Samplers.java", "diffHunk": "@@ -231,19 +259,109 @@ public SamplingResult shouldSample(\n         Kind spanKind,\n         ReadableAttributes attributes,\n         List<Link> parentLinks) {\n-      if (parentContext.isValid()) {\n-        if (parentContext.getTraceFlags().isSampled()) {\n-          return EMPTY_RECORDED_AND_SAMPLED_SAMPLING_RESULT;\n-        }\n-        return EMPTY_NOT_SAMPLED_OR_RECORDED_SAMPLING_RESULT;\n+      if (!parentContext.isValid()) {\n+        return this.root.shouldSample(\n+            parentContext, traceId, name, spanKind, attributes, parentLinks);\n       }\n-      return this.delegateSampler.shouldSample(\n-          parentContext, traceId, name, spanKind, attributes, parentLinks);\n+\n+      if (parentContext.isRemote()) {\n+        return parentContext.getTraceFlags().isSampled()\n+            ? this.remoteParentSampled.shouldSample(\n+                parentContext, traceId, name, spanKind, attributes, parentLinks)\n+            : this.remoteParentNotSampled.shouldSample(\n+                parentContext, traceId, name, spanKind, attributes, parentLinks);\n+      }\n+      return parentContext.getTraceFlags().isSampled()\n+          ? this.localParentSampled.shouldSample(\n+              parentContext, traceId, name, spanKind, attributes, parentLinks)\n+          : this.localParentNotSampled.shouldSample(\n+              parentContext, traceId, name, spanKind, attributes, parentLinks);\n     }\n \n     @Override\n     public String getDescription() {\n-      return String.format(\"ParentOrElse{%s}\", this.delegateSampler.getDescription());\n+      return String.format(\n+          \"ParentBased{root:%s,remoteParentSampled:%s,remoteParentNotSampled:%s,\"\n+              + \"localParentSampled:%s,localParentNotSampled:%s}\",\n+          this.root.getDescription(),\n+          this.remoteParentSampled.getDescription(),\n+          this.remoteParentNotSampled.getDescription(),\n+          this.localParentSampled.getDescription(),\n+          this.localParentNotSampled.getDescription());\n+    }\n+\n+    static class Builder {\n+      private final Sampler root;\n+      private Sampler remoteParentSampled;\n+      private Sampler remoteParentNotSampled;\n+      private Sampler localParentSampled;\n+      private Sampler localParentNotSampled;\n+\n+      /**\n+       * Sets the remoteParentSampled. Optional.", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODE1MzY5Mw=="}, "originalCommit": {"oid": "583078ab28a14ab78a009d8207685e7f20aac138"}, "originalPosition": 116}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk4OTA5MjA1OnYy", "diffSide": "RIGHT", "path": "sdk/tracing/src/main/java/io/opentelemetry/sdk/trace/Samplers.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QwNTo1MzozNFrOHIANGQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QwNjoyMzowMlrOHIBc4w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODE1NDAwOQ==", "bodyText": "I think we leave @param out when it basically matches the javadoc, e.g. https://github.com/open-telemetry/opentelemetry-java/blob/master/api/src/main/java/io/opentelemetry/common/Attributes.java#L204", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1577#discussion_r478154009", "createdAt": "2020-08-27T05:53:34Z", "author": {"login": "anuraaga"}, "path": "sdk/tracing/src/main/java/io/opentelemetry/sdk/trace/Samplers.java", "diffHunk": "@@ -231,19 +259,109 @@ public SamplingResult shouldSample(\n         Kind spanKind,\n         ReadableAttributes attributes,\n         List<Link> parentLinks) {\n-      if (parentContext.isValid()) {\n-        if (parentContext.getTraceFlags().isSampled()) {\n-          return EMPTY_RECORDED_AND_SAMPLED_SAMPLING_RESULT;\n-        }\n-        return EMPTY_NOT_SAMPLED_OR_RECORDED_SAMPLING_RESULT;\n+      if (!parentContext.isValid()) {\n+        return this.root.shouldSample(\n+            parentContext, traceId, name, spanKind, attributes, parentLinks);\n       }\n-      return this.delegateSampler.shouldSample(\n-          parentContext, traceId, name, spanKind, attributes, parentLinks);\n+\n+      if (parentContext.isRemote()) {\n+        return parentContext.getTraceFlags().isSampled()\n+            ? this.remoteParentSampled.shouldSample(\n+                parentContext, traceId, name, spanKind, attributes, parentLinks)\n+            : this.remoteParentNotSampled.shouldSample(\n+                parentContext, traceId, name, spanKind, attributes, parentLinks);\n+      }\n+      return parentContext.getTraceFlags().isSampled()\n+          ? this.localParentSampled.shouldSample(\n+              parentContext, traceId, name, spanKind, attributes, parentLinks)\n+          : this.localParentNotSampled.shouldSample(\n+              parentContext, traceId, name, spanKind, attributes, parentLinks);\n     }\n \n     @Override\n     public String getDescription() {\n-      return String.format(\"ParentOrElse{%s}\", this.delegateSampler.getDescription());\n+      return String.format(\n+          \"ParentBased{root:%s,remoteParentSampled:%s,remoteParentNotSampled:%s,\"\n+              + \"localParentSampled:%s,localParentNotSampled:%s}\",\n+          this.root.getDescription(),\n+          this.remoteParentSampled.getDescription(),\n+          this.remoteParentNotSampled.getDescription(),\n+          this.localParentSampled.getDescription(),\n+          this.localParentNotSampled.getDescription());\n+    }\n+\n+    static class Builder {\n+      private final Sampler root;\n+      private Sampler remoteParentSampled;\n+      private Sampler remoteParentNotSampled;\n+      private Sampler localParentSampled;\n+      private Sampler localParentNotSampled;\n+\n+      /**\n+       * Sets the remoteParentSampled. Optional.\n+       *\n+       * @param remoteParentSampled used to make the sampling decisions if the remote parent exist", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "583078ab28a14ab78a009d8207685e7f20aac138"}, "originalPosition": 118}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODE3NDQzNQ==", "bodyText": "thanks. fixed at lastest commit.", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1577#discussion_r478174435", "createdAt": "2020-08-27T06:23:02Z", "author": {"login": "dengliming"}, "path": "sdk/tracing/src/main/java/io/opentelemetry/sdk/trace/Samplers.java", "diffHunk": "@@ -231,19 +259,109 @@ public SamplingResult shouldSample(\n         Kind spanKind,\n         ReadableAttributes attributes,\n         List<Link> parentLinks) {\n-      if (parentContext.isValid()) {\n-        if (parentContext.getTraceFlags().isSampled()) {\n-          return EMPTY_RECORDED_AND_SAMPLED_SAMPLING_RESULT;\n-        }\n-        return EMPTY_NOT_SAMPLED_OR_RECORDED_SAMPLING_RESULT;\n+      if (!parentContext.isValid()) {\n+        return this.root.shouldSample(\n+            parentContext, traceId, name, spanKind, attributes, parentLinks);\n       }\n-      return this.delegateSampler.shouldSample(\n-          parentContext, traceId, name, spanKind, attributes, parentLinks);\n+\n+      if (parentContext.isRemote()) {\n+        return parentContext.getTraceFlags().isSampled()\n+            ? this.remoteParentSampled.shouldSample(\n+                parentContext, traceId, name, spanKind, attributes, parentLinks)\n+            : this.remoteParentNotSampled.shouldSample(\n+                parentContext, traceId, name, spanKind, attributes, parentLinks);\n+      }\n+      return parentContext.getTraceFlags().isSampled()\n+          ? this.localParentSampled.shouldSample(\n+              parentContext, traceId, name, spanKind, attributes, parentLinks)\n+          : this.localParentNotSampled.shouldSample(\n+              parentContext, traceId, name, spanKind, attributes, parentLinks);\n     }\n \n     @Override\n     public String getDescription() {\n-      return String.format(\"ParentOrElse{%s}\", this.delegateSampler.getDescription());\n+      return String.format(\n+          \"ParentBased{root:%s,remoteParentSampled:%s,remoteParentNotSampled:%s,\"\n+              + \"localParentSampled:%s,localParentNotSampled:%s}\",\n+          this.root.getDescription(),\n+          this.remoteParentSampled.getDescription(),\n+          this.remoteParentNotSampled.getDescription(),\n+          this.localParentSampled.getDescription(),\n+          this.localParentNotSampled.getDescription());\n+    }\n+\n+    static class Builder {\n+      private final Sampler root;\n+      private Sampler remoteParentSampled;\n+      private Sampler remoteParentNotSampled;\n+      private Sampler localParentSampled;\n+      private Sampler localParentNotSampled;\n+\n+      /**\n+       * Sets the remoteParentSampled. Optional.\n+       *\n+       * @param remoteParentSampled used to make the sampling decisions if the remote parent exist", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODE1NDAwOQ=="}, "originalCommit": {"oid": "583078ab28a14ab78a009d8207685e7f20aac138"}, "originalPosition": 118}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk4OTIyMzg3OnYy", "diffSide": "RIGHT", "path": "sdk/tracing/src/main/java/io/opentelemetry/sdk/trace/Samplers.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QwNjoyNToxMVrOHIBjIQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QwNjoyNToxMVrOHIBjIQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODE3NjAzMw==", "bodyText": "If not set, defaults to always sampling if the remote parent was sampled.", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1577#discussion_r478176033", "createdAt": "2020-08-27T06:25:11Z", "author": {"login": "anuraaga"}, "path": "sdk/tracing/src/main/java/io/opentelemetry/sdk/trace/Samplers.java", "diffHunk": "@@ -231,19 +259,101 @@ public SamplingResult shouldSample(\n         Kind spanKind,\n         ReadableAttributes attributes,\n         List<Link> parentLinks) {\n-      if (parentContext.isValid()) {\n-        if (parentContext.getTraceFlags().isSampled()) {\n-          return EMPTY_RECORDED_AND_SAMPLED_SAMPLING_RESULT;\n-        }\n-        return EMPTY_NOT_SAMPLED_OR_RECORDED_SAMPLING_RESULT;\n+      if (!parentContext.isValid()) {\n+        return this.root.shouldSample(\n+            parentContext, traceId, name, spanKind, attributes, parentLinks);\n       }\n-      return this.delegateSampler.shouldSample(\n-          parentContext, traceId, name, spanKind, attributes, parentLinks);\n+\n+      if (parentContext.isRemote()) {\n+        return parentContext.getTraceFlags().isSampled()\n+            ? this.remoteParentSampled.shouldSample(\n+                parentContext, traceId, name, spanKind, attributes, parentLinks)\n+            : this.remoteParentNotSampled.shouldSample(\n+                parentContext, traceId, name, spanKind, attributes, parentLinks);\n+      }\n+      return parentContext.getTraceFlags().isSampled()\n+          ? this.localParentSampled.shouldSample(\n+              parentContext, traceId, name, spanKind, attributes, parentLinks)\n+          : this.localParentNotSampled.shouldSample(\n+              parentContext, traceId, name, spanKind, attributes, parentLinks);\n     }\n \n     @Override\n     public String getDescription() {\n-      return String.format(\"ParentOrElse{%s}\", this.delegateSampler.getDescription());\n+      return String.format(\n+          \"ParentBased{root:%s,remoteParentSampled:%s,remoteParentNotSampled:%s,\"\n+              + \"localParentSampled:%s,localParentNotSampled:%s}\",\n+          this.root.getDescription(),\n+          this.remoteParentSampled.getDescription(),\n+          this.remoteParentNotSampled.getDescription(),\n+          this.localParentSampled.getDescription(),\n+          this.localParentNotSampled.getDescription());\n+    }\n+\n+    static class Builder {\n+      private final Sampler root;\n+      private Sampler remoteParentSampled;\n+      private Sampler remoteParentNotSampled;\n+      private Sampler localParentSampled;\n+      private Sampler localParentNotSampled;\n+\n+      /**\n+       * Sets the {@link Sampler} to use when there is a remote parent that was sampled.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "33f0b1c2335869509a9823c39c0bbab2755a110f"}, "originalPosition": 116}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk4OTIyNDgzOnYy", "diffSide": "RIGHT", "path": "sdk/tracing/src/main/java/io/opentelemetry/sdk/trace/Samplers.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QwNjoyNToyM1rOHIBjxQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QwNjoyNToyM1rOHIBjxQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODE3NjE5Nw==", "bodyText": "If not set, defaults to never sampling when the remote parent isn't sampled.\nSimilar for local", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1577#discussion_r478176197", "createdAt": "2020-08-27T06:25:23Z", "author": {"login": "anuraaga"}, "path": "sdk/tracing/src/main/java/io/opentelemetry/sdk/trace/Samplers.java", "diffHunk": "@@ -231,19 +259,101 @@ public SamplingResult shouldSample(\n         Kind spanKind,\n         ReadableAttributes attributes,\n         List<Link> parentLinks) {\n-      if (parentContext.isValid()) {\n-        if (parentContext.getTraceFlags().isSampled()) {\n-          return EMPTY_RECORDED_AND_SAMPLED_SAMPLING_RESULT;\n-        }\n-        return EMPTY_NOT_SAMPLED_OR_RECORDED_SAMPLING_RESULT;\n+      if (!parentContext.isValid()) {\n+        return this.root.shouldSample(\n+            parentContext, traceId, name, spanKind, attributes, parentLinks);\n       }\n-      return this.delegateSampler.shouldSample(\n-          parentContext, traceId, name, spanKind, attributes, parentLinks);\n+\n+      if (parentContext.isRemote()) {\n+        return parentContext.getTraceFlags().isSampled()\n+            ? this.remoteParentSampled.shouldSample(\n+                parentContext, traceId, name, spanKind, attributes, parentLinks)\n+            : this.remoteParentNotSampled.shouldSample(\n+                parentContext, traceId, name, spanKind, attributes, parentLinks);\n+      }\n+      return parentContext.getTraceFlags().isSampled()\n+          ? this.localParentSampled.shouldSample(\n+              parentContext, traceId, name, spanKind, attributes, parentLinks)\n+          : this.localParentNotSampled.shouldSample(\n+              parentContext, traceId, name, spanKind, attributes, parentLinks);\n     }\n \n     @Override\n     public String getDescription() {\n-      return String.format(\"ParentOrElse{%s}\", this.delegateSampler.getDescription());\n+      return String.format(\n+          \"ParentBased{root:%s,remoteParentSampled:%s,remoteParentNotSampled:%s,\"\n+              + \"localParentSampled:%s,localParentNotSampled:%s}\",\n+          this.root.getDescription(),\n+          this.remoteParentSampled.getDescription(),\n+          this.remoteParentNotSampled.getDescription(),\n+          this.localParentSampled.getDescription(),\n+          this.localParentNotSampled.getDescription());\n+    }\n+\n+    static class Builder {\n+      private final Sampler root;\n+      private Sampler remoteParentSampled;\n+      private Sampler remoteParentNotSampled;\n+      private Sampler localParentSampled;\n+      private Sampler localParentNotSampled;\n+\n+      /**\n+       * Sets the {@link Sampler} to use when there is a remote parent that was sampled.\n+       *\n+       * @return this Builder\n+       */\n+      public Builder withRemoteParentSampled(Sampler remoteParentSampled) {\n+        this.remoteParentSampled = remoteParentSampled;\n+        return this;\n+      }\n+\n+      /**\n+       * Sets the {@link Sampler} to use when there is a remote parent that was not sampled.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "33f0b1c2335869509a9823c39c0bbab2755a110f"}, "originalPosition": 126}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1370, "cost": 1, "resetAt": "2021-11-12T20:28:25Z"}}}