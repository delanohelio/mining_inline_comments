{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDU2NTgxMDg1", "number": 1466, "title": "Support system property otel.resource.attributes corresponding to OTEL_RESOURCE_ATTRIBUTES", "bodyText": "for #1462", "createdAt": "2020-07-25T07:27:55Z", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1466", "merged": true, "mergeCommit": {"oid": "177b1dcd3b943c68ba94a48344aa4f0778e8ab27"}, "closed": true, "closedAt": "2020-07-27T16:52:34Z", "author": {"login": "dengliming"}, "timelineItems": {"totalCount": 18, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc4TcuogH2gAyNDU2NTgxMDg1OjgxY2MzYzFkYjU3ZDE5NDlkMGJmMjk2OGQ1ZDM1ZDU5MDdlZGU4ODk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc5CxTvAFqTQ1NTg0MTE4Nw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "81cc3c1db57d1949d0bf2968d5d35d5907ede889", "author": {"user": {"login": "dengliming", "name": null}}, "url": "https://github.com/open-telemetry/opentelemetry-java/commit/81cc3c1db57d1949d0bf2968d5d35d5907ede889", "committedDate": "2020-07-25T07:25:25Z", "message": "Support system property otel.resource.attributes corresponding to OTEL_RESOURCE_ATTRIBUTES"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ce8c2c5e5242b34a73905cc801bda62e1a71a6ab", "author": {"user": {"login": "dengliming", "name": null}}, "url": "https://github.com/open-telemetry/opentelemetry-java/commit/ce8c2c5e5242b34a73905cc801bda62e1a71a6ab", "committedDate": "2020-07-25T07:46:27Z", "message": "Fix code format"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "af5c3c8ab939a0b00522fffebf95396f78684edf", "author": {"user": {"login": "dengliming", "name": null}}, "url": "https://github.com/open-telemetry/opentelemetry-java/commit/af5c3c8ab939a0b00522fffebf95396f78684edf", "committedDate": "2020-07-25T09:31:11Z", "message": "Add testcase"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "41d78cd1b4c2a27f0d864287e06581590802441e", "author": {"user": {"login": "dengliming", "name": null}}, "url": "https://github.com/open-telemetry/opentelemetry-java/commit/41d78cd1b4c2a27f0d864287e06581590802441e", "committedDate": "2020-07-25T16:23:52Z", "message": "Fix testcase"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU1Mjk3OTU4", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1466#pullrequestreview-455297958", "createdAt": "2020-07-25T17:19:22Z", "commit": {"oid": "41d78cd1b4c2a27f0d864287e06581590802441e"}, "state": "COMMENTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yNVQxNzoxOToyMlrOG3GI0w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yNVQxNzoyNjoyNVrOG3GLTA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDQyNTQyNw==", "bodyText": "the nice thing about using ConfigBuilder is that you only need to handle system property style names, and it will automatically translate those to env var style names when reading env vars (via NamingConvention)\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                private static final String OTEL_RESOURCE_ATTRIBUTES_ENV = \"OTEL_RESOURCE_ATTRIBUTES\";", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1466#discussion_r460425427", "createdAt": "2020-07-25T17:19:22Z", "author": {"login": "trask"}, "path": "sdk/src/main/java/io/opentelemetry/sdk/resources/EnvVarResource.java", "diffHunk": "@@ -75,4 +78,35 @@ static Attributes parseResourceAttributes(@Nullable String rawEnvAttributes) {\n       return attrBuilders.build();\n     }\n   }\n+\n+  /** Builder utility for this EnvVarResource. */\n+  public static class Builder extends ConfigBuilder<Builder> {\n+    private static final String OTEL_RESOURCE_ATTRIBUTES_ENV = \"OTEL_RESOURCE_ATTRIBUTES\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "41d78cd1b4c2a27f0d864287e06581590802441e"}, "originalPosition": 32}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDQyNTUxNQ==", "bodyText": "see comment above about automatic env var name handling by ConfigBuilder\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                  String envAttributesValue = getStringProperty(OTEL_RESOURCE_ATTRIBUTES_ENV, configMap);\n          \n          \n            \n                  if (envAttributesValue != null) {\n          \n          \n            \n                    this.setEnvAttributes(envAttributesValue);\n          \n          \n            \n                  }", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1466#discussion_r460425515", "createdAt": "2020-07-25T17:20:19Z", "author": {"login": "trask"}, "path": "sdk/src/main/java/io/opentelemetry/sdk/resources/EnvVarResource.java", "diffHunk": "@@ -75,4 +78,35 @@ static Attributes parseResourceAttributes(@Nullable String rawEnvAttributes) {\n       return attrBuilders.build();\n     }\n   }\n+\n+  /** Builder utility for this EnvVarResource. */\n+  public static class Builder extends ConfigBuilder<Builder> {\n+    private static final String OTEL_RESOURCE_ATTRIBUTES_ENV = \"OTEL_RESOURCE_ATTRIBUTES\";\n+    private static final String OTEL_RESOURCE_ATTRIBUTES_KEY = \"otel.resource.attributes\";\n+    private String envAttributes;\n+\n+    @Override\n+    protected Builder fromConfigMap(\n+        Map<String, String> configMap, NamingConvention namingConvention) {\n+      String envAttributesValue = getStringProperty(OTEL_RESOURCE_ATTRIBUTES_ENV, configMap);\n+      if (envAttributesValue != null) {\n+        this.setEnvAttributes(envAttributesValue);\n+      }\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "41d78cd1b4c2a27f0d864287e06581590802441e"}, "originalPosition": 43}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDQyNTY0NQ==", "bodyText": "I'd suggest renaming this to build and doing the parsing and returning Resource here\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                public String getEnvAttributes() {\n          \n          \n            \n                public Resource build() {", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1466#discussion_r460425645", "createdAt": "2020-07-25T17:21:50Z", "author": {"login": "trask"}, "path": "sdk/src/main/java/io/opentelemetry/sdk/resources/EnvVarResource.java", "diffHunk": "@@ -75,4 +78,35 @@ static Attributes parseResourceAttributes(@Nullable String rawEnvAttributes) {\n       return attrBuilders.build();\n     }\n   }\n+\n+  /** Builder utility for this EnvVarResource. */\n+  public static class Builder extends ConfigBuilder<Builder> {\n+    private static final String OTEL_RESOURCE_ATTRIBUTES_ENV = \"OTEL_RESOURCE_ATTRIBUTES\";\n+    private static final String OTEL_RESOURCE_ATTRIBUTES_KEY = \"otel.resource.attributes\";\n+    private String envAttributes;\n+\n+    @Override\n+    protected Builder fromConfigMap(\n+        Map<String, String> configMap, NamingConvention namingConvention) {\n+      String envAttributesValue = getStringProperty(OTEL_RESOURCE_ATTRIBUTES_ENV, configMap);\n+      if (envAttributesValue != null) {\n+        this.setEnvAttributes(envAttributesValue);\n+      }\n+\n+      envAttributesValue = getStringProperty(OTEL_RESOURCE_ATTRIBUTES_KEY, configMap);\n+      if (envAttributesValue != null) {\n+        this.setEnvAttributes(envAttributesValue);\n+      }\n+      return this;\n+    }\n+\n+    public String getEnvAttributes() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "41d78cd1b4c2a27f0d864287e06581590802441e"}, "originalPosition": 51}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDQyNjA2MA==", "bodyText": "I'd suggest making this private (or package-protected if you need @VisibleForTesting). it doesn't seem like public builder is needed at this time at lease\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              public static class Builder extends ConfigBuilder<Builder> {\n          \n          \n            \n              private static class Builder extends ConfigBuilder<Builder> {", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1466#discussion_r460426060", "createdAt": "2020-07-25T17:26:25Z", "author": {"login": "trask"}, "path": "sdk/src/main/java/io/opentelemetry/sdk/resources/EnvVarResource.java", "diffHunk": "@@ -75,4 +78,35 @@ static Attributes parseResourceAttributes(@Nullable String rawEnvAttributes) {\n       return attrBuilders.build();\n     }\n   }\n+\n+  /** Builder utility for this EnvVarResource. */\n+  public static class Builder extends ConfigBuilder<Builder> {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "41d78cd1b4c2a27f0d864287e06581590802441e"}, "originalPosition": 31}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "42d2441bf933a29ae662974f022ae64a75e0442d", "author": {"user": {"login": "dengliming", "name": null}}, "url": "https://github.com/open-telemetry/opentelemetry-java/commit/42d2441bf933a29ae662974f022ae64a75e0442d", "committedDate": "2020-07-25T18:41:17Z", "message": "Fix review"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU1MzM2MTQ0", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1466#pullrequestreview-455336144", "createdAt": "2020-07-26T06:32:26Z", "commit": {"oid": "42d2441bf933a29ae662974f022ae64a75e0442d"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU1MzgzMTMy", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1466#pullrequestreview-455383132", "createdAt": "2020-07-26T17:48:13Z", "commit": {"oid": "42d2441bf933a29ae662974f022ae64a75e0442d"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yNlQxNzo0ODoxM1rOG3OCHw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yNlQxNzo0ODoxM1rOG3OCHw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDU1NDc4Mw==", "bodyText": "We most likely need to later update the code for ConfigBuilder to live right under common, instead of common.export, as this configuration pattern is useful in other scenarios (cc @thisthat )", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1466#discussion_r460554783", "createdAt": "2020-07-26T17:48:13Z", "author": {"login": "carlosalberto"}, "path": "sdk/src/main/java/io/opentelemetry/sdk/resources/EnvVarResource.java", "diffHunk": "@@ -18,6 +18,8 @@\n \n import com.google.common.annotations.VisibleForTesting;\n import io.opentelemetry.common.Attributes;\n+import io.opentelemetry.sdk.common.export.ConfigBuilder;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "42d2441bf933a29ae662974f022ae64a75e0442d"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU1MzgzMzQ2", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1466#pullrequestreview-455383346", "createdAt": "2020-07-26T17:51:43Z", "commit": {"oid": "42d2441bf933a29ae662974f022ae64a75e0442d"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yNlQxNzo1MTo0M1rOG3ODgg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yNlQxNzo1MTo0M1rOG3ODgg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDU1NTEzOA==", "bodyText": "We should have this set right in the test itself (the rest of the tests don't need this part).", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1466#discussion_r460555138", "createdAt": "2020-07-26T17:51:43Z", "author": {"login": "carlosalberto"}, "path": "sdk/src/test/java/io/opentelemetry/sdk/resources/EnvVarResourceTest.java", "diffHunk": "@@ -67,4 +68,15 @@ public void parseResourceAttributes_quotes() {\n     Attributes result = EnvVarResource.parseResourceAttributes(\"value=\\\"foo\\\"\");\n     assertThat(result).isEqualTo(Attributes.of(\"value\", stringAttributeValue(\"foo\")));\n   }\n+\n+  @BeforeClass\n+  public static void init() {\n+    System.setProperty(\"otel.resource.attributes\", \"value = foo\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "42d2441bf933a29ae662974f022ae64a75e0442d"}, "originalPosition": 15}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU1MzgzNDY4", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1466#pullrequestreview-455383468", "createdAt": "2020-07-26T17:54:03Z", "commit": {"oid": "42d2441bf933a29ae662974f022ae64a75e0442d"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU1NDY1NDk0", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1466#pullrequestreview-455465494", "createdAt": "2020-07-27T04:33:49Z", "commit": {"oid": "42d2441bf933a29ae662974f022ae64a75e0442d"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yN1QwNDozMzo1MFrOG3TU-g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yN1QwNDozMzo1MFrOG3TU-g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDY0MTUzMA==", "bodyText": "The name of the class seems to be incorrect now. At least Var part.", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1466#discussion_r460641530", "createdAt": "2020-07-27T04:33:50Z", "author": {"login": "iNikem"}, "path": "sdk/src/main/java/io/opentelemetry/sdk/resources/EnvVarResource.java", "diffHunk": "@@ -29,12 +31,11 @@\n  */\n @ThreadSafe\n public final class EnvVarResource {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "42d2441bf933a29ae662974f022ae64a75e0442d"}, "originalPosition": 12}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ab75e5270564068c862f90a537578b3381eb3281", "author": {"user": {"login": "dengliming", "name": null}}, "url": "https://github.com/open-telemetry/opentelemetry-java/commit/ab75e5270564068c862f90a537578b3381eb3281", "committedDate": "2020-07-27T12:58:45Z", "message": "Fix review"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU1NzcyODYw", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1466#pullrequestreview-455772860", "createdAt": "2020-07-27T13:20:25Z", "commit": {"oid": "ab75e5270564068c862f90a537578b3381eb3281"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yN1QxMzoyMDoyNlrOG3iH0A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yN1QxMzoyMDoyNlrOG3iH0A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDg4MzkyMA==", "bodyText": "Please, add also a test for environment variables. An example is available here: \n  \n    \n      opentelemetry-java/sdk/src/test/java/io/opentelemetry/sdk/common/export/ConfigBuilderTest.java\n    \n    \n         Line 270\n      in\n      46f0c5f\n    \n    \n    \n    \n\n        \n          \n           public static class ConfigurationEnvVarsTest {", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1466#discussion_r460883920", "createdAt": "2020-07-27T13:20:26Z", "author": {"login": "thisthat"}, "path": "sdk/src/test/java/io/opentelemetry/sdk/resources/EnvVarResourceTest.java", "diffHunk": "@@ -67,4 +67,15 @@ public void parseResourceAttributes_quotes() {\n     Attributes result = EnvVarResource.parseResourceAttributes(\"value=\\\"foo\\\"\");\n     assertThat(result).isEqualTo(Attributes.of(\"value\", stringAttributeValue(\"foo\")));\n   }\n+\n+  @Test\n+  public void getResourceAttributes_properties() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ab75e5270564068c862f90a537578b3381eb3281"}, "originalPosition": 6}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cabe8e0712133aab543fa41426b0da4c793cb957", "author": {"user": {"login": "dengliming", "name": null}}, "url": "https://github.com/open-telemetry/opentelemetry-java/commit/cabe8e0712133aab543fa41426b0da4c793cb957", "committedDate": "2020-07-27T13:42:42Z", "message": "Add test for environment variables."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU1Nzk3OTQ5", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1466#pullrequestreview-455797949", "createdAt": "2020-07-27T13:48:36Z", "commit": {"oid": "cabe8e0712133aab543fa41426b0da4c793cb957"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b45fcb8287d9042a7415b4b87524451a876808ae", "author": {"user": {"login": "dengliming", "name": null}}, "url": "https://github.com/open-telemetry/opentelemetry-java/commit/b45fcb8287d9042a7415b4b87524451a876808ae", "committedDate": "2020-07-27T14:05:55Z", "message": "Rename EnvVarResource to EnvAutodetectResource and update doc."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c3d251fdcb0571cf9ba0416b3bff9981e2153dc9", "author": {"user": {"login": "dengliming", "name": null}}, "url": "https://github.com/open-telemetry/opentelemetry-java/commit/c3d251fdcb0571cf9ba0416b3bff9981e2153dc9", "committedDate": "2020-07-27T14:16:01Z", "message": "Fix main style"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU1ODQxMTg3", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1466#pullrequestreview-455841187", "createdAt": "2020-07-27T14:33:26Z", "commit": {"oid": "c3d251fdcb0571cf9ba0416b3bff9981e2153dc9"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2644, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}