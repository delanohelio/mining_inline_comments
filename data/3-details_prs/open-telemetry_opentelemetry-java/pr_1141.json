{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA4ODc1Mjcw", "number": 1141, "title": "Add error tag to spans for Jaeger exporter", "bodyText": "The auto-instrumentation libraries add errors to the spans when they occur. The error tag is not added to the spans by the Jaeger exporter if the span status code is not OK.\nWhen sending these spans to the OpenTelemetry Collector it will automatically add the error tag when it translates them, based on the status code, and sends them to the Jaeger collector.\nThis process does not take place when sending spans directly to a Jaeger collector (not using the OTel collector) and so the Jaeger UI does not display visual indicators for spans with errors.\nBy adding the error tag in the Adapter class if the span.status.code is not OK, if this tag hasn't already been added, means that it will be present when using either the OTel collector\nor the Jaeger collector directly. The Otel collector will remove this tag automatically when it receives the span and sets the status code so this will not be sent as a duplicate.\nFixes #1139", "createdAt": "2020-04-25T09:01:27Z", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1141", "merged": true, "mergeCommit": {"oid": "8dd62828932ad86b10ebeeaf4bc496548cf9202b"}, "closed": true, "closedAt": "2020-04-26T16:23:23Z", "author": {"login": "sleighzy"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABca_UuPAH2gAyNDA4ODc1MjcwOmRmZDQ3ZjhkYjgwMGNiMDVhODhiNGU5ZDlkMGE3MDY5YWZjZmZkYTc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcbT981AH2gAyNDA4ODc1MjcwOmQ0MmMyNjI5YjZmYjNkNGNlMWU1MTE0NTRjOGU4NTM0MDNjZWNlYzc=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "dfd47f8db800cb05a88b4e9d9d0a7069afcffda7", "author": {"user": null}, "url": "https://github.com/open-telemetry/opentelemetry-java/commit/dfd47f8db800cb05a88b4e9d9d0a7069afcffda7", "committedDate": "2020-04-25T05:34:46Z", "message": "Add error tag to spans for Jaeger exporter\n\nThe auto-instrumentation libraries add errors to the spans when they occur. The error tag is not added to the spans by the Jaeger exporter if the span status is not OK.\nWhen sending these spans to the OpenTelemetry Collector it will add the error tag when it translates them and sends them to the Jaeger collector. This process does not\ntake place when sending spans directly to a Jaeger collector (not using the OTel collector) and so the Jaeger UI does not display visual indicators for spans with errors.\nAdding the error tag in the adapter if the span.status.code is not OK, and this tag hasn't already been set, means that it will be present when using either the OTel collector\nor the Jaeger collector directly. The Otel collector will remove this tag automatically when it receives the span and sets the status code so this will not be sent as a duplicate."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAwNDE1MTk2", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1141#pullrequestreview-400415196", "createdAt": "2020-04-25T17:39:46Z", "commit": {"oid": "dfd47f8db800cb05a88b4e9d9d0a7069afcffda7"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAwNDI3MTIy", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1141#pullrequestreview-400427122", "createdAt": "2020-04-25T20:07:07Z", "commit": {"oid": "dfd47f8db800cb05a88b4e9d9d0a7069afcffda7"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yNVQyMDowNzowN1rOGL5x5g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yNVQyMDowNzowN1rOGL5x5g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTEzNDE4Mg==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                if (!span.getStatus().isOk() && !span.getAttributes().containsKey(KEY_ERROR)) {\n          \n          \n            \n                if (!span.getStatus().isOk()) {\n          \n      \n    \n    \n  \n\nI think it may be more important that the jaeger error tag always maps to span status, than preserve an attribute named error that the user may set on the span.\nUnfortunately, we don't have a spec to resolve this kind of thing yet (see open-telemetry/opentelemetry-specification#414), but that issue does reference the python implementation, and I think this is how they've implemented it (+/- my python reading skill).", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1141#discussion_r415134182", "createdAt": "2020-04-25T20:07:07Z", "author": {"login": "trask"}, "path": "exporters/jaeger/src/main/java/io/opentelemetry/exporters/jaeger/Adapter.java", "diffHunk": "@@ -111,6 +112,10 @@ private Adapter() {}\n             .setVType(Model.ValueType.INT64)\n             .build());\n \n+    if (!span.getStatus().isOk() && !span.getAttributes().containsKey(KEY_ERROR)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dfd47f8db800cb05a88b4e9d9d0a7069afcffda7"}, "originalPosition": 12}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d42c2629b6fb3d4ce1e511454c8e853403cecec7", "author": {"user": {"login": "sleighzy", "name": "Simon Leigh"}}, "url": "https://github.com/open-telemetry/opentelemetry-java/commit/d42c2629b6fb3d4ce1e511454c8e853403cecec7", "committedDate": "2020-04-26T05:37:54Z", "message": "Remove additional attribute check in span status condition\n\nCo-Authored-By: Trask Stalnaker <trask.stalnaker@gmail.com>"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3006, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}