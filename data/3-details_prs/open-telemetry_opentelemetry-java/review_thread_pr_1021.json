{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg5MjkzNDIz", "number": 1021, "reviewThreads": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNlQxNjowNjo1MlrODoZmDg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QyMDozNjo0OFrODo4NVA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQzNjg4OTc0OnYy", "diffSide": "RIGHT", "path": "sdk/src/main/java/io/opentelemetry/sdk/trace/data/SpanData.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNlQxNjowNjo1MlrOF27Log==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNlQxNjowNjo1MlrOF27Log==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzEzNzA1OA==", "bodyText": "Same needs to be implemented for dropped attributes in events and in links.", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1021#discussion_r393137058", "createdAt": "2020-03-16T16:06:52Z", "author": {"login": "bogdandrutu"}, "path": "sdk/src/main/java/io/opentelemetry/sdk/trace/data/SpanData.java", "diffHunk": "@@ -570,11 +572,11 @@ public abstract Builder setInstrumentationLibraryInfo(\n     public abstract Builder setTotalRecordedLinks(int totalRecordedLinks);\n \n     /**\n-     * Set the number of dropped attributes on this span.\n+     * Set the total number of attributes recorded on this span.\n      *\n-     * @param droppedAttributeCount The number of dropped attributes.\n+     * @param totalAttributeCount The total number of attributes recorded.\n      * @return this\n      */\n-    public abstract Builder setDroppedAttributeCount(int droppedAttributeCount);\n+    public abstract Builder setTotalAttributeCount(int totalAttributeCount);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "37059ee4a278944ebaea469a124c397669f40ca9"}, "originalPosition": 37}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQzNzAwOTQ1OnYy", "diffSide": "RIGHT", "path": "sdk/src/main/java/io/opentelemetry/sdk/trace/data/SpanData.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNlQxNjozNjozNlrOF28ZdQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNlQxNjo0MzoxNlrOF28rOQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzE1Njk4MQ==", "bodyText": "This should be attributes.size() correct? Same everywhere, otherwise we have negative dropped :)", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1021#discussion_r393156981", "createdAt": "2020-03-16T16:36:36Z", "author": {"login": "bogdandrutu"}, "path": "sdk/src/main/java/io/opentelemetry/sdk/trace/data/SpanData.java", "diffHunk": "@@ -245,34 +245,35 @@ public static Link create(SpanContext spanContext, Map<String, AttributeValue> a\n       return new AutoValue_SpanData_Link(\n           spanContext,\n           Collections.unmodifiableMap(new LinkedHashMap<>(attributes)),\n-          ZERO_DROPPED_ATTRIBUTE_COUNT);\n+          DEFAULT_ATTRIBUTE_COUNT);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5939b4814ae48e70550a5d3be6e656ade381d4ce"}, "originalPosition": 42}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzE2MTUyOQ==", "bodyText": "Doh! Yes - you're right \ud83d\ude04 I'll fix that.", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1021#discussion_r393161529", "createdAt": "2020-03-16T16:43:16Z", "author": {"login": "MikeGoldsmith"}, "path": "sdk/src/main/java/io/opentelemetry/sdk/trace/data/SpanData.java", "diffHunk": "@@ -245,34 +245,35 @@ public static Link create(SpanContext spanContext, Map<String, AttributeValue> a\n       return new AutoValue_SpanData_Link(\n           spanContext,\n           Collections.unmodifiableMap(new LinkedHashMap<>(attributes)),\n-          ZERO_DROPPED_ATTRIBUTE_COUNT);\n+          DEFAULT_ATTRIBUTE_COUNT);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzE1Njk4MQ=="}, "originalCommit": {"oid": "5939b4814ae48e70550a5d3be6e656ade381d4ce"}, "originalPosition": 42}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQzODIyNTUxOnYy", "diffSide": "RIGHT", "path": "sdk/src/main/java/io/opentelemetry/sdk/trace/RecordEventsReadableSpan.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNlQyMjo1NDo1M1rOF3Ia7A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNlQyMjo1NDo1M1rOF3Ia7A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzM1Mzk2NA==", "bodyText": "You could also add the span's name and the key of the dropped attribute to ease debugging here.", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1021#discussion_r393353964", "createdAt": "2020-03-16T22:54:53Z", "author": {"login": "arminru"}, "path": "sdk/src/main/java/io/opentelemetry/sdk/trace/RecordEventsReadableSpan.java", "diffHunk": "@@ -325,6 +330,15 @@ public void setAttribute(String key, AttributeValue value) {\n         logger.log(Level.FINE, \"Calling setAttribute() on an ended Span.\");\n         return;\n       }\n+      totalAttributeCount++;\n+      if (attributes.get(key) == null && attributes.size() >= maxNumberOfAttributes) {\n+        logger.log(\n+            Level.FINE,\n+            \"Span has maximum number of attributes (\"\n+                + maxNumberOfAttributes\n+                + \"). Dropping new entries.\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9777d13c163ea33205b33c56ecc9e1e83549b737"}, "originalPosition": 31}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQzODIyNjc5OnYy", "diffSide": "RIGHT", "path": "sdk/src/main/java/io/opentelemetry/sdk/trace/RecordEventsReadableSpan.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNlQyMjo1NToyN1rOF3IbuQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNlQyMjo1NToyN1rOF3IbuQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzM1NDE2OQ==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              private int maxNumberOfAttributes = 0;\n          \n          \n            \n              private final int maxNumberOfAttributes = 0;", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1021#discussion_r393354169", "createdAt": "2020-03-16T22:55:27Z", "author": {"login": "arminru"}, "path": "sdk/src/main/java/io/opentelemetry/sdk/trace/RecordEventsReadableSpan.java", "diffHunk": "@@ -63,6 +63,10 @@\n   private final List<Link> links;\n   // Number of links recorded.\n   private final int totalRecordedLinks;\n+  // Max number of attibutes per span.\n+  private int maxNumberOfAttributes = 0;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9777d13c163ea33205b33c56ecc9e1e83549b737"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ0MTAxNTc2OnYy", "diffSide": "RIGHT", "path": "sdk/src/main/java/io/opentelemetry/sdk/trace/RecordEventsReadableSpan.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QxNjoyMzowMVrOF3j9OQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QxOTo1ODo0MVrOF3r2gw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzgwNTExMw==", "bodyText": "this should be moved down into the mutable section below and marked as @GuardedBy(\"lock\")", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1021#discussion_r393805113", "createdAt": "2020-03-17T16:23:01Z", "author": {"login": "jkwatson"}, "path": "sdk/src/main/java/io/opentelemetry/sdk/trace/RecordEventsReadableSpan.java", "diffHunk": "@@ -63,6 +64,12 @@\n   private final List<Link> links;\n   // Number of links recorded.\n   private final int totalRecordedLinks;\n+  // Max number of attibutes per span.\n+  private final int maxNumberOfAttributes;\n+  // Number of attributes recorded.\n+  private int totalAttributeCount = 0;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "38d4db5eb9437f244fc444f80067531318d3b7d3"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzkzNDQ2Nw==", "bodyText": "Done \ud83d\udc4d", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1021#discussion_r393934467", "createdAt": "2020-03-17T19:58:41Z", "author": {"login": "MikeGoldsmith"}, "path": "sdk/src/main/java/io/opentelemetry/sdk/trace/RecordEventsReadableSpan.java", "diffHunk": "@@ -63,6 +64,12 @@\n   private final List<Link> links;\n   // Number of links recorded.\n   private final int totalRecordedLinks;\n+  // Max number of attibutes per span.\n+  private final int maxNumberOfAttributes;\n+  // Number of attributes recorded.\n+  private int totalAttributeCount = 0;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzgwNTExMw=="}, "originalCommit": {"oid": "38d4db5eb9437f244fc444f80067531318d3b7d3"}, "originalPosition": 15}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ0MTAxOTMzOnYy", "diffSide": "RIGHT", "path": "sdk/src/main/java/io/opentelemetry/sdk/trace/RecordEventsReadableSpan.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QxNjoyMzo1MFrOF3j_hA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QxOTo1ODo1MFrOF3r2xw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzgwNTcwMA==", "bodyText": "I'd prefer to see the logging done with string interpolation, rather than a giant concatenated string like this.", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1021#discussion_r393805700", "createdAt": "2020-03-17T16:23:50Z", "author": {"login": "jkwatson"}, "path": "sdk/src/main/java/io/opentelemetry/sdk/trace/RecordEventsReadableSpan.java", "diffHunk": "@@ -325,6 +333,19 @@ public void setAttribute(String key, AttributeValue value) {\n         logger.log(Level.FINE, \"Calling setAttribute() on an ended Span.\");\n         return;\n       }\n+      totalAttributeCount++;\n+      if (attributes.get(key) == null && attributes.size() >= maxNumberOfAttributes) {\n+        logger.log(\n+            Level.FINE,\n+            \"Span with name '\"\n+                + this.name\n+                + \"' has reached the maximum number of attributes (\"\n+                + maxNumberOfAttributes\n+                + \"). Dropping attribute with key '\"\n+                + key\n+                + \"'\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "38d4db5eb9437f244fc444f80067531318d3b7d3"}, "originalPosition": 45}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzkzNDUzNQ==", "bodyText": "Done \ud83d\udc4d", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1021#discussion_r393934535", "createdAt": "2020-03-17T19:58:50Z", "author": {"login": "MikeGoldsmith"}, "path": "sdk/src/main/java/io/opentelemetry/sdk/trace/RecordEventsReadableSpan.java", "diffHunk": "@@ -325,6 +333,19 @@ public void setAttribute(String key, AttributeValue value) {\n         logger.log(Level.FINE, \"Calling setAttribute() on an ended Span.\");\n         return;\n       }\n+      totalAttributeCount++;\n+      if (attributes.get(key) == null && attributes.size() >= maxNumberOfAttributes) {\n+        logger.log(\n+            Level.FINE,\n+            \"Span with name '\"\n+                + this.name\n+                + \"' has reached the maximum number of attributes (\"\n+                + maxNumberOfAttributes\n+                + \"). Dropping attribute with key '\"\n+                + key\n+                + \"'\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzgwNTcwMA=="}, "originalCommit": {"oid": "38d4db5eb9437f244fc444f80067531318d3b7d3"}, "originalPosition": 45}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ0MTkwNTQ4OnYy", "diffSide": "RIGHT", "path": "sdk/src/main/java/io/opentelemetry/sdk/trace/RecordEventsReadableSpan.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QyMDozNjo0OFrOF3tC_A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QyMDozNjo0OFrOF3tC_A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mzk1NDA0NA==", "bodyText": "splitting the string across 2 lines is also totally fine.", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1021#discussion_r393954044", "createdAt": "2020-03-17T20:36:48Z", "author": {"login": "jkwatson"}, "path": "sdk/src/main/java/io/opentelemetry/sdk/trace/RecordEventsReadableSpan.java", "diffHunk": "@@ -50,6 +51,13 @@\n \n   private static final Logger logger = Logger.getLogger(Tracer.class.getName());\n \n+  @SuppressWarnings(\"checkstyle:LineLength\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7d3cacbdae78745d14221a53f891245842b9ebae"}, "originalPosition": 12}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 989, "cost": 1, "resetAt": "2021-11-12T20:28:25Z"}}}