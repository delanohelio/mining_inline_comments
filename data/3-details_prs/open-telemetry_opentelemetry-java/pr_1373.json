{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQwMDU4MTc1", "number": 1373, "title": "enhance OTLP Exporter configuration", "bodyText": "OTLP Exporter in opentelemetry-java-instrumentation is not configurable to:\n\nuseTransportSecurity instead of usePlaintext\ninsert values into Metadata headers (in ClientInterceptor)\n\nFrom PR open-telemetry/opentelemetry-java-instrumentation#567 (comment)\nDecided to try add configuration directly to OTLP Exporter.", "createdAt": "2020-06-25T14:27:52Z", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1373", "merged": true, "mergeCommit": {"oid": "3c144c74f2d9769bf59878f89fe0b6f4eaa28ff2"}, "closed": true, "closedAt": "2020-06-28T02:00:13Z", "author": {"login": "malafeev"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcuvZDVAH2gAyNDQwMDU4MTc1OmYzNTY5OThkNmM2YzQxYmNlZDNlZDIxNzNjNWIzNzc3YmVlMDliYjE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcvSMaHAH2gAyNDQwMDU4MTc1OjU5ZTdjOWU1OTQ1YzNkNDU3MjI5MWZjYWQyOWYyMzQwNGFlZThkOTk=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "f356998d6c6c41bced3ed2173c5b3777bee09bb1", "author": {"user": {"login": "malafeev", "name": "Sergei Malafeev"}}, "url": "https://github.com/open-telemetry/opentelemetry-java/commit/f356998d6c6c41bced3ed2173c5b3777bee09bb1", "committedDate": "2020-06-25T14:19:30Z", "message": "enhance OTLP Exporter configuration\n\nSigned-off-by: Sergei Malafeev <sergei@malafeev.org>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM3NTg0OTI4", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1373#pullrequestreview-437584928", "createdAt": "2020-06-25T15:02:07Z", "commit": {"oid": "f356998d6c6c41bced3ed2173c5b3777bee09bb1"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNVQxNTowMjowN1rOGo-5DQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNVQxNTowMjowN1rOGo-5DQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTYyNjYzNw==", "bodyText": "There is a proposal in the specs to standardize environment variables for this sort of thing. Can you please add a comment to https://github.com/open-telemetry/opentelemetry-specification/pull/666/files with the needs here?", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1373#discussion_r445626637", "createdAt": "2020-06-25T15:02:07Z", "author": {"login": "jkwatson"}, "path": "exporters/otlp/src/main/java/io/opentelemetry/exporters/otlp/OtlpGrpcSpanExporter.java", "diffHunk": "@@ -41,13 +49,21 @@\n  * <ul>\n  *   <li>{@code otel.otlp.span.timeout}: to set the max waiting time allowed to send each span\n  *       batch.\n+ *   <li>{@code otel.otlp.endpoint}: to set the endpoint to connect to.\n+ *   <li>{@code otel.otlp.use.tls}: to set use or not TLS.\n+ *   <li>{@code otel.otlp.metadata} to set key-value pairs separated by semicolon to pass as request\n+ *       metadata.\n  * </ul>\n  *\n  * <p>For environment variables, {@link OtlpGrpcSpanExporter} will look for the following names:\n  *\n  * <ul>\n  *   <li>{@code OTEL_OTLP_SPAN_TIMEOUT}: to set the max waiting time allowed to send each span\n  *       batch.\n+ *   <li>{@code OTEL_OTLP_ENDPOINT}: to set the endpoint to connect to.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f356998d6c6c41bced3ed2173c5b3777bee09bb1"}, "originalPosition": 37}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM3ODc3NjQy", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1373#pullrequestreview-437877642", "createdAt": "2020-06-25T21:38:36Z", "commit": {"oid": "f356998d6c6c41bced3ed2173c5b3777bee09bb1"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM3OTY4OTY5", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1373#pullrequestreview-437968969", "createdAt": "2020-06-26T02:00:58Z", "commit": {"oid": "f356998d6c6c41bced3ed2173c5b3777bee09bb1"}, "state": "COMMENTED", "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQwMjowMDo1OFrOGpRYqA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQwMjowNDowMFrOGpRbLw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTkyOTY0MA==", "bodyText": "@Nullable", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1373#discussion_r445929640", "createdAt": "2020-06-26T02:00:58Z", "author": {"login": "anuraaga"}, "path": "exporters/otlp/src/main/java/io/opentelemetry/exporters/otlp/OtlpGrpcSpanExporter.java", "diffHunk": "@@ -146,11 +162,18 @@ public void shutdown() {\n   /** Builder utility for this exporter. */\n   public static class Builder extends ConfigBuilder<Builder> {\n     private static final String KEY_SPAN_TIMEOUT = \"otel.otlp.span.timeout\";\n+    private static final String KEY_ENDPOINT = \"otel.otlp.endpoint\";\n+    private static final String KEY_USE_TLS = \"otel.otlp.use.tls\";\n+    private static final String KEY_METADATA = \"otel.otlp.metadata\";\n     private ManagedChannel channel;\n     private long deadlineMs = 1_000; // 1 second\n+    private String endpoint;\n+    private boolean useTls;\n+    private Metadata metadata;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f356998d6c6c41bced3ed2173c5b3777bee09bb1"}, "originalPosition": 55}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTkyOTY3MQ==", "bodyText": "@Nullable", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1373#discussion_r445929671", "createdAt": "2020-06-26T02:01:07Z", "author": {"login": "anuraaga"}, "path": "exporters/otlp/src/main/java/io/opentelemetry/exporters/otlp/OtlpGrpcSpanExporter.java", "diffHunk": "@@ -146,11 +162,18 @@ public void shutdown() {\n   /** Builder utility for this exporter. */\n   public static class Builder extends ConfigBuilder<Builder> {\n     private static final String KEY_SPAN_TIMEOUT = \"otel.otlp.span.timeout\";\n+    private static final String KEY_ENDPOINT = \"otel.otlp.endpoint\";\n+    private static final String KEY_USE_TLS = \"otel.otlp.use.tls\";\n+    private static final String KEY_METADATA = \"otel.otlp.metadata\";\n     private ManagedChannel channel;\n     private long deadlineMs = 1_000; // 1 second\n+    private String endpoint;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f356998d6c6c41bced3ed2173c5b3777bee09bb1"}, "originalPosition": 53}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTkyOTkxNw==", "bodyText": "Extra semicolon", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1373#discussion_r445929917", "createdAt": "2020-06-26T02:02:18Z", "author": {"login": "anuraaga"}, "path": "exporters/otlp/src/main/java/io/opentelemetry/exporters/otlp/OtlpGrpcSpanExporter.java", "diffHunk": "@@ -196,6 +274,27 @@ protected Builder fromConfigMap(\n       if (value != null) {\n         this.setDeadlineMs(value);\n       }\n+      String endpointValue = getStringProperty(KEY_ENDPOINT, configMap);\n+      if (endpointValue != null) {\n+        this.setEndpoint(endpointValue);\n+      }\n+\n+      Boolean useTlsValue = getBooleanProperty(KEY_USE_TLS, configMap);\n+      if (useTlsValue != null) {\n+        this.setUseTls(useTlsValue);\n+      }\n+\n+      String metadataValue = getStringProperty(KEY_METADATA, configMap);\n+      if (metadataValue != null) {\n+        for (String keyValueString : Splitter.on(';').split(metadataValue)) {\n+          final List<String> keyValue = Splitter.on('=').splitToList(keyValueString);\n+          ;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f356998d6c6c41bced3ed2173c5b3777bee09bb1"}, "originalPosition": 150}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTkzMDAyOQ==", "bodyText": "Believe you can use Splitter.withKeyValueSeparator", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1373#discussion_r445930029", "createdAt": "2020-06-26T02:02:48Z", "author": {"login": "anuraaga"}, "path": "exporters/otlp/src/main/java/io/opentelemetry/exporters/otlp/OtlpGrpcSpanExporter.java", "diffHunk": "@@ -196,6 +274,27 @@ protected Builder fromConfigMap(\n       if (value != null) {\n         this.setDeadlineMs(value);\n       }\n+      String endpointValue = getStringProperty(KEY_ENDPOINT, configMap);\n+      if (endpointValue != null) {\n+        this.setEndpoint(endpointValue);\n+      }\n+\n+      Boolean useTlsValue = getBooleanProperty(KEY_USE_TLS, configMap);\n+      if (useTlsValue != null) {\n+        this.setUseTls(useTlsValue);\n+      }\n+\n+      String metadataValue = getStringProperty(KEY_METADATA, configMap);\n+      if (metadataValue != null) {\n+        for (String keyValueString : Splitter.on(';').split(metadataValue)) {\n+          final List<String> keyValue = Splitter.on('=').splitToList(keyValueString);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f356998d6c6c41bced3ed2173c5b3777bee09bb1"}, "originalPosition": 149}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTkzMDI4Nw==", "bodyText": "Would be good to create a static final with the splitter\n`private static final Splitter.MapSplitter METADATA_PROPERTY_SPLITTER = Splitter.on(';').trimResults().omitEmptyStrings().withKeyValueSplitter('=');", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1373#discussion_r445930287", "createdAt": "2020-06-26T02:04:00Z", "author": {"login": "anuraaga"}, "path": "exporters/otlp/src/main/java/io/opentelemetry/exporters/otlp/OtlpGrpcSpanExporter.java", "diffHunk": "@@ -196,6 +274,27 @@ protected Builder fromConfigMap(\n       if (value != null) {\n         this.setDeadlineMs(value);\n       }\n+      String endpointValue = getStringProperty(KEY_ENDPOINT, configMap);\n+      if (endpointValue != null) {\n+        this.setEndpoint(endpointValue);\n+      }\n+\n+      Boolean useTlsValue = getBooleanProperty(KEY_USE_TLS, configMap);\n+      if (useTlsValue != null) {\n+        this.setUseTls(useTlsValue);\n+      }\n+\n+      String metadataValue = getStringProperty(KEY_METADATA, configMap);\n+      if (metadataValue != null) {\n+        for (String keyValueString : Splitter.on(';').split(metadataValue)) {\n+          final List<String> keyValue = Splitter.on('=').splitToList(keyValueString);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTkzMDAyOQ=="}, "originalCommit": {"oid": "f356998d6c6c41bced3ed2173c5b3777bee09bb1"}, "originalPosition": 149}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4d8f9b3f245233f8b18af4fa3df776f62074fd17", "author": {"user": {"login": "malafeev", "name": "Sergei Malafeev"}}, "url": "https://github.com/open-telemetry/opentelemetry-java/commit/4d8f9b3f245233f8b18af4fa3df776f62074fd17", "committedDate": "2020-06-26T06:57:45Z", "message": "add @Nullable to nullable fields\n\nSigned-off-by: Sergei Malafeev <sergei@malafeev.org>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6b6a7da3e2655f48fe31e26535d1ae5637f97d75", "author": {"user": {"login": "malafeev", "name": "Sergei Malafeev"}}, "url": "https://github.com/open-telemetry/opentelemetry-java/commit/6b6a7da3e2655f48fe31e26535d1ae5637f97d75", "committedDate": "2020-06-26T07:16:20Z", "message": "add @Nonnull to arguments of addHeader\n\nSigned-off-by: Sergei Malafeev <sergei@malafeev.org>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM4MjMzMzQx", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1373#pullrequestreview-438233341", "createdAt": "2020-06-26T11:53:52Z", "commit": {"oid": "6b6a7da3e2655f48fe31e26535d1ae5637f97d75"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM4MzUwNzY3", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1373#pullrequestreview-438350767", "createdAt": "2020-06-26T14:38:21Z", "commit": {"oid": "6b6a7da3e2655f48fe31e26535d1ae5637f97d75"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "42421f95b5f32164361b78738aaf968d3ad49ab9", "author": {"user": {"login": "malafeev", "name": "Sergei Malafeev"}}, "url": "https://github.com/open-telemetry/opentelemetry-java/commit/42421f95b5f32164361b78738aaf968d3ad49ab9", "committedDate": "2020-06-27T06:49:47Z", "message": "remove semicolon\n\nSigned-off-by: Sergei Malafeev <sergei@malafeev.org>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "59e7c9e5945c3d4572291fcad29f23404aee8d99", "author": {"user": {"login": "malafeev", "name": "Sergei Malafeev"}}, "url": "https://github.com/open-telemetry/opentelemetry-java/commit/59e7c9e5945c3d4572291fcad29f23404aee8d99", "committedDate": "2020-06-27T06:52:22Z", "message": "remove @Nonnull\n\nSigned-off-by: Sergei Malafeev <sergei@malafeev.org>"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2495, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}