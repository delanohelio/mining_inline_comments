{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTA1MzExNDE1", "number": 1823, "title": "Fix using default context storage implemenation in LazyStorage", "bodyText": "fixes #1819", "createdAt": "2020-10-17T16:42:54Z", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1823", "merged": true, "mergeCommit": {"oid": "c7a46022d4d2c23c5bd9bc052af5e7a4ec37c68a"}, "closed": true, "closedAt": "2020-10-19T20:08:32Z", "author": {"login": "dengliming"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdTdwMYgH2gAyNTA1MzExNDE1OmE5M2I3OTFjNjMzZjVjM2VkZDdjNjljN2U0YTIxZDBiZTM1ODdiZDU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdUGBCWgH2gAyNTA1MzExNDE1OjdiMjg3MDc0MzQ4NzBkMjBkMjA1MjY3ZGIwMzg2NDM4OTZjNzMzMGU=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "a93b791c633f5c3edd7c69c7e4a21d0be3587bd5", "author": {"user": {"login": "dengliming", "name": null}}, "url": "https://github.com/open-telemetry/opentelemetry-java/commit/a93b791c633f5c3edd7c69c7e4a21d0be3587bd5", "committedDate": "2020-10-17T16:41:41Z", "message": "Fix using default context storage implemenation in LazyStorage"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTExMDI4MTQ1", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1823#pullrequestreview-511028145", "createdAt": "2020-10-18T02:25:42Z", "commit": {"oid": "a93b791c633f5c3edd7c69c7e4a21d0be3587bd5"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "71a80d94f56b77845994d8217c19aa7742d70d5d", "author": {"user": {"login": "dengliming", "name": null}}, "url": "https://github.com/open-telemetry/opentelemetry-java/commit/71a80d94f56b77845994d8217c19aa7742d70d5d", "committedDate": "2020-10-18T04:12:26Z", "message": "Use the single implementation if providerClassName property is unset"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTExMTU4MTYw", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1823#pullrequestreview-511158160", "createdAt": "2020-10-18T16:06:44Z", "commit": {"oid": "71a80d94f56b77845994d8217c19aa7742d70d5d"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTExMzk5NDE2", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1823#pullrequestreview-511399416", "createdAt": "2020-10-19T04:09:03Z", "commit": {"oid": "71a80d94f56b77845994d8217c19aa7742d70d5d"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xOVQwNDowOTowM1rOHj7MZw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xOVQwNDowOTowM1rOHj7MZw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzQzMjAzOQ==", "bodyText": "@dengliming Sorry if my suggestions weren't clear, thanks for bearing with me. We have these success cases\n\n1 provider, providerClassName empty - returns the 1 provider\n1 provider, providerClassName matches the provider - returns the 1 provider <- currently missing\nmultiple providers, providerClassName matches one of them - returns the provider that matches\n\nOtherwise log an error message and return default storage\nHope this makes it clear", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1823#discussion_r507432039", "createdAt": "2020-10-19T04:09:03Z", "author": {"login": "anuraaga"}, "path": "context/src/main/java/io/opentelemetry/context/LazyStorage.java", "diffHunk": "@@ -48,17 +48,11 @@ private static ContextStorage createStorage(AtomicReference<Throwable> deferredS\n       return DefaultContext.threadLocalStorage();\n     }\n \n-    if (providers.size() == 1) {\n-      ContextStorageProvider provider = providers.get(0);\n-      try {\n-        return provider.get();\n-      } catch (Throwable t) {\n-        deferredStorageFailure.set(t);\n-        return DefaultContext.threadLocalStorage();\n+    if (providerClassName.isEmpty()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "71a80d94f56b77845994d8217c19aa7742d70d5d"}, "originalPosition": 11}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTExNTY4MjEw", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1823#pullrequestreview-511568210", "createdAt": "2020-10-19T09:21:01Z", "commit": {"oid": "71a80d94f56b77845994d8217c19aa7742d70d5d"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xOVQwOToyMTowMVrOHkFVNg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xOVQwOToyMTowMVrOHkFVNg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzU5ODEzNA==", "bodyText": "Sorry got it! Yeah seems good, really needed to expand the diff", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1823#discussion_r507598134", "createdAt": "2020-10-19T09:21:01Z", "author": {"login": "anuraaga"}, "path": "context/src/main/java/io/opentelemetry/context/LazyStorage.java", "diffHunk": "@@ -48,17 +48,11 @@ private static ContextStorage createStorage(AtomicReference<Throwable> deferredS\n       return DefaultContext.threadLocalStorage();\n     }\n \n-    if (providers.size() == 1) {\n-      ContextStorageProvider provider = providers.get(0);\n-      try {\n-        return provider.get();\n-      } catch (Throwable t) {\n-        deferredStorageFailure.set(t);\n-        return DefaultContext.threadLocalStorage();\n+    if (providerClassName.isEmpty()) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzQzMjAzOQ=="}, "originalCommit": {"oid": "71a80d94f56b77845994d8217c19aa7742d70d5d"}, "originalPosition": 11}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTExNTc0MTAx", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1823#pullrequestreview-511574101", "createdAt": "2020-10-19T09:28:08Z", "commit": {"oid": "71a80d94f56b77845994d8217c19aa7742d70d5d"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7b28707434870d20d205267db038643896c7330e", "author": {"user": {"login": "dengliming", "name": null}}, "url": "https://github.com/open-telemetry/opentelemetry-java/commit/7b28707434870d20d205267db038643896c7330e", "committedDate": "2020-10-19T15:36:17Z", "message": "Add unit tests for LazyStorage"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4069, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}