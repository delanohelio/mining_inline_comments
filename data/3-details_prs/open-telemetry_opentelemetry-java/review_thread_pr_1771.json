{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDk5NTcxNTc4", "number": 1771, "reviewThreads": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOVQwMDoyMDo0N1rOEr1wDw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xM1QwNjoyOToyNlrOEs4jaQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE0NDA0ODc5OnYy", "diffSide": "RIGHT", "path": "api/src/main/java/io/opentelemetry/baggage/propagation/W3CBaggagePropagator.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOVQwMDoyMDo0N1rOHe1OUg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xM1QwNjoyODoxM1rOHgXI9w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjA5MTM0Ng==", "bodyText": "Hmm - do we need to expose the constructor publicly too to allow a different BaggageManager than the global?", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1771#discussion_r502091346", "createdAt": "2020-10-09T00:20:47Z", "author": {"login": "anuraaga"}, "path": "api/src/main/java/io/opentelemetry/baggage/propagation/W3CBaggagePropagator.java", "diffHunk": "@@ -0,0 +1,111 @@\n+/*\n+ * Copyright The OpenTelemetry Authors\n+ * SPDX-License-Identifier: Apache-2.0\n+ */\n+\n+package io.opentelemetry.baggage.propagation;\n+\n+import static java.util.Collections.singletonList;\n+\n+import io.opentelemetry.OpenTelemetry;\n+import io.opentelemetry.baggage.Baggage;\n+import io.opentelemetry.baggage.BaggageManager;\n+import io.opentelemetry.baggage.BaggageUtils;\n+import io.opentelemetry.baggage.EmptyBaggage;\n+import io.opentelemetry.baggage.Entry;\n+import io.opentelemetry.baggage.EntryMetadata;\n+import io.opentelemetry.context.Context;\n+import io.opentelemetry.context.propagation.TextMapPropagator;\n+import java.util.List;\n+\n+/**\n+ * {@link TextMapPropagator} that implements the W3C specification for baggage header propagation.\n+ */\n+public class W3CBaggagePropagator implements TextMapPropagator {\n+\n+  private static final String FIELD = \"baggage\";\n+  private static final List<String> FIELDS = singletonList(FIELD);\n+  private static final W3CBaggagePropagator INSTANCE =\n+      new W3CBaggagePropagator(OpenTelemetry.getBaggageManager());\n+\n+  private final BaggageManager baggageManager;\n+\n+  // visible for testing\n+  W3CBaggagePropagator(BaggageManager baggageManager) {\n+    this.baggageManager = baggageManager;\n+  }\n+\n+  /**\n+   * Singleton instance of the W3C Baggage Propagator. Uses the {@link BaggageManager} from the", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cce213b150f80315b68ce76a0d196f09ab98697c"}, "originalPosition": 39}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzY2OTYwMg==", "bodyText": "I'm really hoping we can completely get rid of the BaggageManager once open-telemetry/opentelemetry-specification#1070 is resolved. If the Baggage in the API isn't a no-op, then we don't have to worry about this thing.", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1771#discussion_r503669602", "createdAt": "2020-10-13T05:07:39Z", "author": {"login": "jkwatson"}, "path": "api/src/main/java/io/opentelemetry/baggage/propagation/W3CBaggagePropagator.java", "diffHunk": "@@ -0,0 +1,111 @@\n+/*\n+ * Copyright The OpenTelemetry Authors\n+ * SPDX-License-Identifier: Apache-2.0\n+ */\n+\n+package io.opentelemetry.baggage.propagation;\n+\n+import static java.util.Collections.singletonList;\n+\n+import io.opentelemetry.OpenTelemetry;\n+import io.opentelemetry.baggage.Baggage;\n+import io.opentelemetry.baggage.BaggageManager;\n+import io.opentelemetry.baggage.BaggageUtils;\n+import io.opentelemetry.baggage.EmptyBaggage;\n+import io.opentelemetry.baggage.Entry;\n+import io.opentelemetry.baggage.EntryMetadata;\n+import io.opentelemetry.context.Context;\n+import io.opentelemetry.context.propagation.TextMapPropagator;\n+import java.util.List;\n+\n+/**\n+ * {@link TextMapPropagator} that implements the W3C specification for baggage header propagation.\n+ */\n+public class W3CBaggagePropagator implements TextMapPropagator {\n+\n+  private static final String FIELD = \"baggage\";\n+  private static final List<String> FIELDS = singletonList(FIELD);\n+  private static final W3CBaggagePropagator INSTANCE =\n+      new W3CBaggagePropagator(OpenTelemetry.getBaggageManager());\n+\n+  private final BaggageManager baggageManager;\n+\n+  // visible for testing\n+  W3CBaggagePropagator(BaggageManager baggageManager) {\n+    this.baggageManager = baggageManager;\n+  }\n+\n+  /**\n+   * Singleton instance of the W3C Baggage Propagator. Uses the {@link BaggageManager} from the", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjA5MTM0Ng=="}, "originalCommit": {"oid": "cce213b150f80315b68ce76a0d196f09ab98697c"}, "originalPosition": 39}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzY5NTYwNw==", "bodyText": "Me too :)", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1771#discussion_r503695607", "createdAt": "2020-10-13T06:28:13Z", "author": {"login": "anuraaga"}, "path": "api/src/main/java/io/opentelemetry/baggage/propagation/W3CBaggagePropagator.java", "diffHunk": "@@ -0,0 +1,111 @@\n+/*\n+ * Copyright The OpenTelemetry Authors\n+ * SPDX-License-Identifier: Apache-2.0\n+ */\n+\n+package io.opentelemetry.baggage.propagation;\n+\n+import static java.util.Collections.singletonList;\n+\n+import io.opentelemetry.OpenTelemetry;\n+import io.opentelemetry.baggage.Baggage;\n+import io.opentelemetry.baggage.BaggageManager;\n+import io.opentelemetry.baggage.BaggageUtils;\n+import io.opentelemetry.baggage.EmptyBaggage;\n+import io.opentelemetry.baggage.Entry;\n+import io.opentelemetry.baggage.EntryMetadata;\n+import io.opentelemetry.context.Context;\n+import io.opentelemetry.context.propagation.TextMapPropagator;\n+import java.util.List;\n+\n+/**\n+ * {@link TextMapPropagator} that implements the W3C specification for baggage header propagation.\n+ */\n+public class W3CBaggagePropagator implements TextMapPropagator {\n+\n+  private static final String FIELD = \"baggage\";\n+  private static final List<String> FIELDS = singletonList(FIELD);\n+  private static final W3CBaggagePropagator INSTANCE =\n+      new W3CBaggagePropagator(OpenTelemetry.getBaggageManager());\n+\n+  private final BaggageManager baggageManager;\n+\n+  // visible for testing\n+  W3CBaggagePropagator(BaggageManager baggageManager) {\n+    this.baggageManager = baggageManager;\n+  }\n+\n+  /**\n+   * Singleton instance of the W3C Baggage Propagator. Uses the {@link BaggageManager} from the", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjA5MTM0Ng=="}, "originalCommit": {"oid": "cce213b150f80315b68ce76a0d196f09ab98697c"}, "originalPosition": 39}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE0NDA1MzY4OnYy", "diffSide": "RIGHT", "path": "api/src/main/java/io/opentelemetry/baggage/propagation/W3CBaggagePropagator.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOVQwMDoyMzo0N1rOHe1RIQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xM1QwNTo1MDowOVrOHgWTZw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjA5MjA2NQ==", "bodyText": "Not really for this PR but I guess it'd be nice to always return an empty baggage instead of null", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1771#discussion_r502092065", "createdAt": "2020-10-09T00:23:47Z", "author": {"login": "anuraaga"}, "path": "api/src/main/java/io/opentelemetry/baggage/propagation/W3CBaggagePropagator.java", "diffHunk": "@@ -0,0 +1,111 @@\n+/*\n+ * Copyright The OpenTelemetry Authors\n+ * SPDX-License-Identifier: Apache-2.0\n+ */\n+\n+package io.opentelemetry.baggage.propagation;\n+\n+import static java.util.Collections.singletonList;\n+\n+import io.opentelemetry.OpenTelemetry;\n+import io.opentelemetry.baggage.Baggage;\n+import io.opentelemetry.baggage.BaggageManager;\n+import io.opentelemetry.baggage.BaggageUtils;\n+import io.opentelemetry.baggage.EmptyBaggage;\n+import io.opentelemetry.baggage.Entry;\n+import io.opentelemetry.baggage.EntryMetadata;\n+import io.opentelemetry.context.Context;\n+import io.opentelemetry.context.propagation.TextMapPropagator;\n+import java.util.List;\n+\n+/**\n+ * {@link TextMapPropagator} that implements the W3C specification for baggage header propagation.\n+ */\n+public class W3CBaggagePropagator implements TextMapPropagator {\n+\n+  private static final String FIELD = \"baggage\";\n+  private static final List<String> FIELDS = singletonList(FIELD);\n+  private static final W3CBaggagePropagator INSTANCE =\n+      new W3CBaggagePropagator(OpenTelemetry.getBaggageManager());\n+\n+  private final BaggageManager baggageManager;\n+\n+  // visible for testing\n+  W3CBaggagePropagator(BaggageManager baggageManager) {\n+    this.baggageManager = baggageManager;\n+  }\n+\n+  /**\n+   * Singleton instance of the W3C Baggage Propagator. Uses the {@link BaggageManager} from the\n+   * {@link OpenTelemetry} global.\n+   */\n+  public static W3CBaggagePropagator getInstance() {\n+    return INSTANCE;\n+  }\n+\n+  @Override\n+  public List<String> fields() {\n+    return FIELDS;\n+  }\n+\n+  @Override\n+  public <C> void inject(Context context, C carrier, Setter<C> setter) {\n+    Baggage baggage = BaggageUtils.getBaggage(context);\n+    if (baggage == null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cce213b150f80315b68ce76a0d196f09ab98697c"}, "originalPosition": 54}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzY4MTg5NQ==", "bodyText": "agreed. Assuming no baggage and empty baggage are semantic identical.", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1771#discussion_r503681895", "createdAt": "2020-10-13T05:50:09Z", "author": {"login": "jkwatson"}, "path": "api/src/main/java/io/opentelemetry/baggage/propagation/W3CBaggagePropagator.java", "diffHunk": "@@ -0,0 +1,111 @@\n+/*\n+ * Copyright The OpenTelemetry Authors\n+ * SPDX-License-Identifier: Apache-2.0\n+ */\n+\n+package io.opentelemetry.baggage.propagation;\n+\n+import static java.util.Collections.singletonList;\n+\n+import io.opentelemetry.OpenTelemetry;\n+import io.opentelemetry.baggage.Baggage;\n+import io.opentelemetry.baggage.BaggageManager;\n+import io.opentelemetry.baggage.BaggageUtils;\n+import io.opentelemetry.baggage.EmptyBaggage;\n+import io.opentelemetry.baggage.Entry;\n+import io.opentelemetry.baggage.EntryMetadata;\n+import io.opentelemetry.context.Context;\n+import io.opentelemetry.context.propagation.TextMapPropagator;\n+import java.util.List;\n+\n+/**\n+ * {@link TextMapPropagator} that implements the W3C specification for baggage header propagation.\n+ */\n+public class W3CBaggagePropagator implements TextMapPropagator {\n+\n+  private static final String FIELD = \"baggage\";\n+  private static final List<String> FIELDS = singletonList(FIELD);\n+  private static final W3CBaggagePropagator INSTANCE =\n+      new W3CBaggagePropagator(OpenTelemetry.getBaggageManager());\n+\n+  private final BaggageManager baggageManager;\n+\n+  // visible for testing\n+  W3CBaggagePropagator(BaggageManager baggageManager) {\n+    this.baggageManager = baggageManager;\n+  }\n+\n+  /**\n+   * Singleton instance of the W3C Baggage Propagator. Uses the {@link BaggageManager} from the\n+   * {@link OpenTelemetry} global.\n+   */\n+  public static W3CBaggagePropagator getInstance() {\n+    return INSTANCE;\n+  }\n+\n+  @Override\n+  public List<String> fields() {\n+    return FIELDS;\n+  }\n+\n+  @Override\n+  public <C> void inject(Context context, C carrier, Setter<C> setter) {\n+    Baggage baggage = BaggageUtils.getBaggage(context);\n+    if (baggage == null) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjA5MjA2NQ=="}, "originalCommit": {"oid": "cce213b150f80315b68ce76a0d196f09ab98697c"}, "originalPosition": 54}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE0NDA1NDIwOnYy", "diffSide": "RIGHT", "path": "api/src/main/java/io/opentelemetry/baggage/propagation/W3CBaggagePropagator.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOVQwMDoyNDowM1rOHe1Rag==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOVQwMDoyNDowM1rOHe1Rag==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjA5MjEzOA==", "bodyText": "If there were an empty baggage check above, we wouldn't need this one guaranteed to inject something", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1771#discussion_r502092138", "createdAt": "2020-10-09T00:24:03Z", "author": {"login": "anuraaga"}, "path": "api/src/main/java/io/opentelemetry/baggage/propagation/W3CBaggagePropagator.java", "diffHunk": "@@ -0,0 +1,111 @@\n+/*\n+ * Copyright The OpenTelemetry Authors\n+ * SPDX-License-Identifier: Apache-2.0\n+ */\n+\n+package io.opentelemetry.baggage.propagation;\n+\n+import static java.util.Collections.singletonList;\n+\n+import io.opentelemetry.OpenTelemetry;\n+import io.opentelemetry.baggage.Baggage;\n+import io.opentelemetry.baggage.BaggageManager;\n+import io.opentelemetry.baggage.BaggageUtils;\n+import io.opentelemetry.baggage.EmptyBaggage;\n+import io.opentelemetry.baggage.Entry;\n+import io.opentelemetry.baggage.EntryMetadata;\n+import io.opentelemetry.context.Context;\n+import io.opentelemetry.context.propagation.TextMapPropagator;\n+import java.util.List;\n+\n+/**\n+ * {@link TextMapPropagator} that implements the W3C specification for baggage header propagation.\n+ */\n+public class W3CBaggagePropagator implements TextMapPropagator {\n+\n+  private static final String FIELD = \"baggage\";\n+  private static final List<String> FIELDS = singletonList(FIELD);\n+  private static final W3CBaggagePropagator INSTANCE =\n+      new W3CBaggagePropagator(OpenTelemetry.getBaggageManager());\n+\n+  private final BaggageManager baggageManager;\n+\n+  // visible for testing\n+  W3CBaggagePropagator(BaggageManager baggageManager) {\n+    this.baggageManager = baggageManager;\n+  }\n+\n+  /**\n+   * Singleton instance of the W3C Baggage Propagator. Uses the {@link BaggageManager} from the\n+   * {@link OpenTelemetry} global.\n+   */\n+  public static W3CBaggagePropagator getInstance() {\n+    return INSTANCE;\n+  }\n+\n+  @Override\n+  public List<String> fields() {\n+    return FIELDS;\n+  }\n+\n+  @Override\n+  public <C> void inject(Context context, C carrier, Setter<C> setter) {\n+    Baggage baggage = BaggageUtils.getBaggage(context);\n+    if (baggage == null) {\n+      return;\n+    }\n+    StringBuilder headerContent = new StringBuilder();\n+    for (Entry entry : baggage.getEntries()) {\n+      headerContent.append(entry.getKey()).append(\"=\").append(entry.getValue());\n+      String metadataValue = entry.getEntryMetadata().getValue();\n+      if (metadataValue != null && !metadataValue.isEmpty()) {\n+        headerContent.append(\";\").append(metadataValue);\n+      }\n+      headerContent.append(\",\");\n+    }\n+    if (headerContent.length() > 0) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cce213b150f80315b68ce76a0d196f09ab98697c"}, "originalPosition": 66}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE0NDA1NTA2OnYy", "diffSide": "RIGHT", "path": "api/src/main/java/io/opentelemetry/baggage/propagation/W3CBaggagePropagator.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOVQwMDoyNDozMFrOHe1R4g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xM1QwNTo0ODozMlrOHgWRKQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjA5MjI1OA==", "bodyText": "Though disregard my above comments if no baggage is different from empty baggage semantically.", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1771#discussion_r502092258", "createdAt": "2020-10-09T00:24:30Z", "author": {"login": "anuraaga"}, "path": "api/src/main/java/io/opentelemetry/baggage/propagation/W3CBaggagePropagator.java", "diffHunk": "@@ -0,0 +1,111 @@\n+/*\n+ * Copyright The OpenTelemetry Authors\n+ * SPDX-License-Identifier: Apache-2.0\n+ */\n+\n+package io.opentelemetry.baggage.propagation;\n+\n+import static java.util.Collections.singletonList;\n+\n+import io.opentelemetry.OpenTelemetry;\n+import io.opentelemetry.baggage.Baggage;\n+import io.opentelemetry.baggage.BaggageManager;\n+import io.opentelemetry.baggage.BaggageUtils;\n+import io.opentelemetry.baggage.EmptyBaggage;\n+import io.opentelemetry.baggage.Entry;\n+import io.opentelemetry.baggage.EntryMetadata;\n+import io.opentelemetry.context.Context;\n+import io.opentelemetry.context.propagation.TextMapPropagator;\n+import java.util.List;\n+\n+/**\n+ * {@link TextMapPropagator} that implements the W3C specification for baggage header propagation.\n+ */\n+public class W3CBaggagePropagator implements TextMapPropagator {\n+\n+  private static final String FIELD = \"baggage\";\n+  private static final List<String> FIELDS = singletonList(FIELD);\n+  private static final W3CBaggagePropagator INSTANCE =\n+      new W3CBaggagePropagator(OpenTelemetry.getBaggageManager());\n+\n+  private final BaggageManager baggageManager;\n+\n+  // visible for testing\n+  W3CBaggagePropagator(BaggageManager baggageManager) {\n+    this.baggageManager = baggageManager;\n+  }\n+\n+  /**\n+   * Singleton instance of the W3C Baggage Propagator. Uses the {@link BaggageManager} from the\n+   * {@link OpenTelemetry} global.\n+   */\n+  public static W3CBaggagePropagator getInstance() {\n+    return INSTANCE;\n+  }\n+\n+  @Override\n+  public List<String> fields() {\n+    return FIELDS;\n+  }\n+\n+  @Override\n+  public <C> void inject(Context context, C carrier, Setter<C> setter) {\n+    Baggage baggage = BaggageUtils.getBaggage(context);\n+    if (baggage == null) {\n+      return;\n+    }\n+    StringBuilder headerContent = new StringBuilder();\n+    for (Entry entry : baggage.getEntries()) {\n+      headerContent.append(entry.getKey()).append(\"=\").append(entry.getValue());\n+      String metadataValue = entry.getEntryMetadata().getValue();\n+      if (metadataValue != null && !metadataValue.isEmpty()) {\n+        headerContent.append(\";\").append(metadataValue);\n+      }\n+      headerContent.append(\",\");\n+    }\n+    if (headerContent.length() > 0) {\n+      headerContent.setLength(headerContent.length() - 1);\n+      setter.set(carrier, FIELD, headerContent.toString());\n+    }\n+  }\n+\n+  @Override\n+  public <C> Context extract(Context context, C carrier, Getter<C> getter) {\n+    String baggageHeader = getter.get(carrier, FIELD);\n+    if (baggageHeader == null) {\n+      return context;\n+    }\n+    if (baggageHeader.isEmpty()) {\n+      return BaggageUtils.withBaggage(EmptyBaggage.getInstance(), context);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cce213b150f80315b68ce76a0d196f09ab98697c"}, "originalPosition": 79}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzY4MTMyMQ==", "bodyText": "It's not clear to me, either, if no baggage and empty baggage are semantically different.", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1771#discussion_r503681321", "createdAt": "2020-10-13T05:48:32Z", "author": {"login": "jkwatson"}, "path": "api/src/main/java/io/opentelemetry/baggage/propagation/W3CBaggagePropagator.java", "diffHunk": "@@ -0,0 +1,111 @@\n+/*\n+ * Copyright The OpenTelemetry Authors\n+ * SPDX-License-Identifier: Apache-2.0\n+ */\n+\n+package io.opentelemetry.baggage.propagation;\n+\n+import static java.util.Collections.singletonList;\n+\n+import io.opentelemetry.OpenTelemetry;\n+import io.opentelemetry.baggage.Baggage;\n+import io.opentelemetry.baggage.BaggageManager;\n+import io.opentelemetry.baggage.BaggageUtils;\n+import io.opentelemetry.baggage.EmptyBaggage;\n+import io.opentelemetry.baggage.Entry;\n+import io.opentelemetry.baggage.EntryMetadata;\n+import io.opentelemetry.context.Context;\n+import io.opentelemetry.context.propagation.TextMapPropagator;\n+import java.util.List;\n+\n+/**\n+ * {@link TextMapPropagator} that implements the W3C specification for baggage header propagation.\n+ */\n+public class W3CBaggagePropagator implements TextMapPropagator {\n+\n+  private static final String FIELD = \"baggage\";\n+  private static final List<String> FIELDS = singletonList(FIELD);\n+  private static final W3CBaggagePropagator INSTANCE =\n+      new W3CBaggagePropagator(OpenTelemetry.getBaggageManager());\n+\n+  private final BaggageManager baggageManager;\n+\n+  // visible for testing\n+  W3CBaggagePropagator(BaggageManager baggageManager) {\n+    this.baggageManager = baggageManager;\n+  }\n+\n+  /**\n+   * Singleton instance of the W3C Baggage Propagator. Uses the {@link BaggageManager} from the\n+   * {@link OpenTelemetry} global.\n+   */\n+  public static W3CBaggagePropagator getInstance() {\n+    return INSTANCE;\n+  }\n+\n+  @Override\n+  public List<String> fields() {\n+    return FIELDS;\n+  }\n+\n+  @Override\n+  public <C> void inject(Context context, C carrier, Setter<C> setter) {\n+    Baggage baggage = BaggageUtils.getBaggage(context);\n+    if (baggage == null) {\n+      return;\n+    }\n+    StringBuilder headerContent = new StringBuilder();\n+    for (Entry entry : baggage.getEntries()) {\n+      headerContent.append(entry.getKey()).append(\"=\").append(entry.getValue());\n+      String metadataValue = entry.getEntryMetadata().getValue();\n+      if (metadataValue != null && !metadataValue.isEmpty()) {\n+        headerContent.append(\";\").append(metadataValue);\n+      }\n+      headerContent.append(\",\");\n+    }\n+    if (headerContent.length() > 0) {\n+      headerContent.setLength(headerContent.length() - 1);\n+      setter.set(carrier, FIELD, headerContent.toString());\n+    }\n+  }\n+\n+  @Override\n+  public <C> Context extract(Context context, C carrier, Getter<C> getter) {\n+    String baggageHeader = getter.get(carrier, FIELD);\n+    if (baggageHeader == null) {\n+      return context;\n+    }\n+    if (baggageHeader.isEmpty()) {\n+      return BaggageUtils.withBaggage(EmptyBaggage.getInstance(), context);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjA5MjI1OA=="}, "originalCommit": {"oid": "cce213b150f80315b68ce76a0d196f09ab98697c"}, "originalPosition": 79}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE1NDk5MzY5OnYy", "diffSide": "RIGHT", "path": "api/src/main/java/io/opentelemetry/baggage/propagation/W3CBaggagePropagator.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xM1QwNjoyOToyNlrOHgXK_A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xM1QxNTowNDo0NlrOHgrbXg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzY5NjEyNA==", "bodyText": "Random noise from me - not sure what the difference between baggage and tracestate is, they're both propagated K-V pairs it seems. Anyways ;)", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1771#discussion_r503696124", "createdAt": "2020-10-13T06:29:26Z", "author": {"login": "anuraaga"}, "path": "api/src/main/java/io/opentelemetry/baggage/propagation/W3CBaggagePropagator.java", "diffHunk": "@@ -0,0 +1,111 @@\n+/*\n+ * Copyright The OpenTelemetry Authors\n+ * SPDX-License-Identifier: Apache-2.0\n+ */\n+\n+package io.opentelemetry.baggage.propagation;\n+\n+import static java.util.Collections.singletonList;\n+\n+import io.opentelemetry.OpenTelemetry;\n+import io.opentelemetry.baggage.Baggage;\n+import io.opentelemetry.baggage.BaggageManager;\n+import io.opentelemetry.baggage.BaggageUtils;\n+import io.opentelemetry.baggage.EmptyBaggage;\n+import io.opentelemetry.baggage.Entry;\n+import io.opentelemetry.baggage.EntryMetadata;\n+import io.opentelemetry.context.Context;\n+import io.opentelemetry.context.propagation.TextMapPropagator;\n+import java.util.List;\n+\n+/**\n+ * {@link TextMapPropagator} that implements the W3C specification for baggage header propagation.\n+ */\n+public class W3CBaggagePropagator implements TextMapPropagator {\n+\n+  private static final String FIELD = \"baggage\";\n+  private static final List<String> FIELDS = singletonList(FIELD);\n+  private static final W3CBaggagePropagator INSTANCE =\n+      new W3CBaggagePropagator(OpenTelemetry.getBaggageManager());\n+\n+  private final BaggageManager baggageManager;\n+\n+  // visible for testing\n+  W3CBaggagePropagator(BaggageManager baggageManager) {\n+    this.baggageManager = baggageManager;\n+  }\n+\n+  /**\n+   * Singleton instance of the W3C Baggage Propagator. Uses the {@link BaggageManager} from the\n+   * {@link OpenTelemetry} global.\n+   */\n+  public static W3CBaggagePropagator getInstance() {\n+    return INSTANCE;\n+  }\n+\n+  @Override\n+  public List<String> fields() {\n+    return FIELDS;\n+  }\n+\n+  @Override\n+  public <C> void inject(Context context, C carrier, Setter<C> setter) {\n+    Baggage baggage = BaggageUtils.getBaggage(context);\n+    if (baggage == null) {\n+      return;\n+    }\n+    StringBuilder headerContent = new StringBuilder();\n+    for (Entry entry : baggage.getEntries()) {\n+      headerContent.append(entry.getKey()).append(\"=\").append(entry.getValue());\n+      String metadataValue = entry.getEntryMetadata().getValue();\n+      if (metadataValue != null && !metadataValue.isEmpty()) {\n+        headerContent.append(\";\").append(metadataValue);\n+      }\n+      headerContent.append(\",\");\n+    }\n+    if (headerContent.length() > 0) {\n+      headerContent.setLength(headerContent.length() - 1);\n+      setter.set(carrier, FIELD, headerContent.toString());\n+    }\n+  }\n+\n+  @Override\n+  public <C> Context extract(Context context, C carrier, Getter<C> getter) {\n+    String baggageHeader = getter.get(carrier, FIELD);\n+    if (baggageHeader == null) {\n+      return context;\n+    }\n+    if (baggageHeader.isEmpty()) {\n+      return BaggageUtils.withBaggage(EmptyBaggage.getInstance(), context);\n+    }\n+\n+    Baggage.Builder baggageBuilder = baggageManager.baggageBuilder();\n+    try {\n+      extractEntries(baggageHeader, baggageBuilder);\n+    } catch (Exception e) {\n+      return BaggageUtils.withBaggage(EmptyBaggage.getInstance(), context);\n+    }\n+    return BaggageUtils.withBaggage(baggageBuilder.build(), context);\n+  }\n+\n+  @SuppressWarnings(\"StringSplitter\")\n+  private static void extractEntries(String baggageHeader, Baggage.Builder baggageBuilder) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0841e68bbd2e8fd1d64f26df5076eea7fd4ff883"}, "originalPosition": 92}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDAyNzk5OA==", "bodyText": "My feeling is: TraceState is a fixed format, semantically well-defined spec. Baggage is the wild west free-for-all for whatever users want to do.", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1771#discussion_r504027998", "createdAt": "2020-10-13T15:04:46Z", "author": {"login": "jkwatson"}, "path": "api/src/main/java/io/opentelemetry/baggage/propagation/W3CBaggagePropagator.java", "diffHunk": "@@ -0,0 +1,111 @@\n+/*\n+ * Copyright The OpenTelemetry Authors\n+ * SPDX-License-Identifier: Apache-2.0\n+ */\n+\n+package io.opentelemetry.baggage.propagation;\n+\n+import static java.util.Collections.singletonList;\n+\n+import io.opentelemetry.OpenTelemetry;\n+import io.opentelemetry.baggage.Baggage;\n+import io.opentelemetry.baggage.BaggageManager;\n+import io.opentelemetry.baggage.BaggageUtils;\n+import io.opentelemetry.baggage.EmptyBaggage;\n+import io.opentelemetry.baggage.Entry;\n+import io.opentelemetry.baggage.EntryMetadata;\n+import io.opentelemetry.context.Context;\n+import io.opentelemetry.context.propagation.TextMapPropagator;\n+import java.util.List;\n+\n+/**\n+ * {@link TextMapPropagator} that implements the W3C specification for baggage header propagation.\n+ */\n+public class W3CBaggagePropagator implements TextMapPropagator {\n+\n+  private static final String FIELD = \"baggage\";\n+  private static final List<String> FIELDS = singletonList(FIELD);\n+  private static final W3CBaggagePropagator INSTANCE =\n+      new W3CBaggagePropagator(OpenTelemetry.getBaggageManager());\n+\n+  private final BaggageManager baggageManager;\n+\n+  // visible for testing\n+  W3CBaggagePropagator(BaggageManager baggageManager) {\n+    this.baggageManager = baggageManager;\n+  }\n+\n+  /**\n+   * Singleton instance of the W3C Baggage Propagator. Uses the {@link BaggageManager} from the\n+   * {@link OpenTelemetry} global.\n+   */\n+  public static W3CBaggagePropagator getInstance() {\n+    return INSTANCE;\n+  }\n+\n+  @Override\n+  public List<String> fields() {\n+    return FIELDS;\n+  }\n+\n+  @Override\n+  public <C> void inject(Context context, C carrier, Setter<C> setter) {\n+    Baggage baggage = BaggageUtils.getBaggage(context);\n+    if (baggage == null) {\n+      return;\n+    }\n+    StringBuilder headerContent = new StringBuilder();\n+    for (Entry entry : baggage.getEntries()) {\n+      headerContent.append(entry.getKey()).append(\"=\").append(entry.getValue());\n+      String metadataValue = entry.getEntryMetadata().getValue();\n+      if (metadataValue != null && !metadataValue.isEmpty()) {\n+        headerContent.append(\";\").append(metadataValue);\n+      }\n+      headerContent.append(\",\");\n+    }\n+    if (headerContent.length() > 0) {\n+      headerContent.setLength(headerContent.length() - 1);\n+      setter.set(carrier, FIELD, headerContent.toString());\n+    }\n+  }\n+\n+  @Override\n+  public <C> Context extract(Context context, C carrier, Getter<C> getter) {\n+    String baggageHeader = getter.get(carrier, FIELD);\n+    if (baggageHeader == null) {\n+      return context;\n+    }\n+    if (baggageHeader.isEmpty()) {\n+      return BaggageUtils.withBaggage(EmptyBaggage.getInstance(), context);\n+    }\n+\n+    Baggage.Builder baggageBuilder = baggageManager.baggageBuilder();\n+    try {\n+      extractEntries(baggageHeader, baggageBuilder);\n+    } catch (Exception e) {\n+      return BaggageUtils.withBaggage(EmptyBaggage.getInstance(), context);\n+    }\n+    return BaggageUtils.withBaggage(baggageBuilder.build(), context);\n+  }\n+\n+  @SuppressWarnings(\"StringSplitter\")\n+  private static void extractEntries(String baggageHeader, Baggage.Builder baggageBuilder) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzY5NjEyNA=="}, "originalCommit": {"oid": "0841e68bbd2e8fd1d64f26df5076eea7fd4ff883"}, "originalPosition": 92}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1280, "cost": 1, "resetAt": "2021-11-12T20:28:25Z"}}}