{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTAwMjE1NTQx", "number": 1775, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOFQyMzoyODoyMlrOEr1KyA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xMlQwOTo0OTo1OFrOEsjxGw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE0Mzk1MzM2OnYy", "diffSide": "RIGHT", "path": "extensions/trace_propagators/src/main/java/io/opentelemetry/extensions/trace/propagation/B3PropagatorExtractor.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOFQyMzoyODoyMlrOHe0WCA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xMFQwOTowMDozNVrOHfeddw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjA3NjkzNg==", "bodyText": "Any thoughts about using Optional<Context> as the return type, now that we have java 8?", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1775#discussion_r502076936", "createdAt": "2020-10-08T23:28:22Z", "author": {"login": "jkwatson"}, "path": "extensions/trace_propagators/src/main/java/io/opentelemetry/extensions/trace/propagation/B3PropagatorExtractor.java", "diffHunk": "@@ -7,10 +7,12 @@\n \n import io.grpc.Context;\n import io.opentelemetry.context.propagation.TextMapPropagator;\n+import javax.annotation.Nullable;\n import javax.annotation.concurrent.Immutable;\n \n @Immutable\n interface B3PropagatorExtractor {\n \n+  @Nullable", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0bb4df0d60f291e4e5e416ab5d99253e97029e41"}, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjc2Njk2Nw==", "bodyText": "Nice! I'm glad Java 8 is supported now :)\nYeh returning an Optional would be better than null.  I'll update it.", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1775#discussion_r502766967", "createdAt": "2020-10-10T09:00:35Z", "author": {"login": "jarebudev"}, "path": "extensions/trace_propagators/src/main/java/io/opentelemetry/extensions/trace/propagation/B3PropagatorExtractor.java", "diffHunk": "@@ -7,10 +7,12 @@\n \n import io.grpc.Context;\n import io.opentelemetry.context.propagation.TextMapPropagator;\n+import javax.annotation.Nullable;\n import javax.annotation.concurrent.Immutable;\n \n @Immutable\n interface B3PropagatorExtractor {\n \n+  @Nullable", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjA3NjkzNg=="}, "originalCommit": {"oid": "0bb4df0d60f291e4e5e416ab5d99253e97029e41"}, "originalPosition": 10}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE1MTU4ODExOnYy", "diffSide": "RIGHT", "path": "extensions/trace_propagators/src/main/java/io/opentelemetry/extensions/trace/propagation/B3Propagator.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xMlQwOTo0OTo1OFrOHf3bgg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xMlQyMTozODoxNFrOHgOIBw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzE3NjA2Ng==", "bodyText": "Inject happens to headers, not from. But how about just injectMultipleHeaders?", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1775#discussion_r503176066", "createdAt": "2020-10-12T09:49:58Z", "author": {"login": "anuraaga"}, "path": "extensions/trace_propagators/src/main/java/io/opentelemetry/extensions/trace/propagation/B3Propagator.java", "diffHunk": "@@ -31,44 +58,54 @@\n   private static final List<String> FIELDS =\n       Collections.unmodifiableList(Arrays.asList(TRACE_ID_HEADER, SPAN_ID_HEADER, SAMPLED_HEADER));\n \n+  private static final B3Propagator INSTANCE = B3Propagator.builder().build();\n+\n+  private final B3PropagatorExtractor singleHeaderExtractor =\n+      new B3PropagatorExtractorSingleHeader();\n+  private final B3PropagatorExtractor multipleHeadersExtractor =\n+      new B3PropagatorExtractorMultipleHeaders();\n   private final B3PropagatorInjector b3PropagatorInjector;\n-  private final B3PropagatorExtractor b3PropagatorExtractor;\n \n-  private static final B3Propagator SINGLE_HEADER =\n-      new B3Propagator(\n-          new B3PropagatorInjectorSingleHeader(), new B3PropagatorExtractorSingleHeader());\n-  private static final B3Propagator MULTI_HEADER =\n-      new B3Propagator(\n-          new B3PropagatorInjectorMultipleHeaders(), new B3PropagatorExtractorMultipleHeaders());\n+  private B3Propagator(B3PropagatorInjector b3PropagatorInjector) {\n+    this.b3PropagatorInjector = b3PropagatorInjector;\n+  }\n \n   /**\n-   * Returns an instance of {@link B3Propagator} with Single Header Implementation of B3 propagation\n-   * protocol. See <a\n-   * href=https://github.com/openzipkin/b3-propagation#single-header>openzipkin/b3-propagation#single-header</a>.\n-   *\n-   * @return Returns an instance of {@link B3Propagator} with Single Header implementation of B3\n-   *     propagation protocol.\n+   * Returns a new {@link B3Propagator.Builder} instance for configuring injection option for {@link\n+   * B3Propagator}.\n    */\n-  public static B3Propagator getSingleHeaderPropagator() {\n-    return SINGLE_HEADER;\n+  public static B3Propagator.Builder builder() {\n+    return new Builder();\n   }\n \n   /**\n-   * Returns an instance of {@link B3Propagator} with Multiple Header Implementation of B3\n-   * propagation protocol. See <a\n-   * href=https://github.com/openzipkin/b3-propagation#multiple-headers>openzipkin/b3-propagation#multiple-headers</a>.\n-   *\n-   * @return Returns an instance of {@link B3Propagator} with Multiple Header implementation of B3\n-   *     propagation protocol.\n+   * Enables the creation of an {@link B3Propagator} instance with the ability to switch injector\n+   * from single header (default) to multiple headers.\n    */\n-  public static B3Propagator getMultipleHeaderPropagator() {\n-    return MULTI_HEADER;\n+  public static class Builder {\n+    private boolean injectSingleHeader;\n+\n+    private Builder() {\n+      injectSingleHeader = true;\n+    }\n+\n+    public Builder injectFromMultipleHeaders() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "45d2d190961f0da7af9e62464f37130d52e29378"}, "originalPosition": 97}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzU0NzkxMQ==", "bodyText": "sounds good, i'll tidy it up", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1775#discussion_r503547911", "createdAt": "2020-10-12T21:38:14Z", "author": {"login": "jarebudev"}, "path": "extensions/trace_propagators/src/main/java/io/opentelemetry/extensions/trace/propagation/B3Propagator.java", "diffHunk": "@@ -31,44 +58,54 @@\n   private static final List<String> FIELDS =\n       Collections.unmodifiableList(Arrays.asList(TRACE_ID_HEADER, SPAN_ID_HEADER, SAMPLED_HEADER));\n \n+  private static final B3Propagator INSTANCE = B3Propagator.builder().build();\n+\n+  private final B3PropagatorExtractor singleHeaderExtractor =\n+      new B3PropagatorExtractorSingleHeader();\n+  private final B3PropagatorExtractor multipleHeadersExtractor =\n+      new B3PropagatorExtractorMultipleHeaders();\n   private final B3PropagatorInjector b3PropagatorInjector;\n-  private final B3PropagatorExtractor b3PropagatorExtractor;\n \n-  private static final B3Propagator SINGLE_HEADER =\n-      new B3Propagator(\n-          new B3PropagatorInjectorSingleHeader(), new B3PropagatorExtractorSingleHeader());\n-  private static final B3Propagator MULTI_HEADER =\n-      new B3Propagator(\n-          new B3PropagatorInjectorMultipleHeaders(), new B3PropagatorExtractorMultipleHeaders());\n+  private B3Propagator(B3PropagatorInjector b3PropagatorInjector) {\n+    this.b3PropagatorInjector = b3PropagatorInjector;\n+  }\n \n   /**\n-   * Returns an instance of {@link B3Propagator} with Single Header Implementation of B3 propagation\n-   * protocol. See <a\n-   * href=https://github.com/openzipkin/b3-propagation#single-header>openzipkin/b3-propagation#single-header</a>.\n-   *\n-   * @return Returns an instance of {@link B3Propagator} with Single Header implementation of B3\n-   *     propagation protocol.\n+   * Returns a new {@link B3Propagator.Builder} instance for configuring injection option for {@link\n+   * B3Propagator}.\n    */\n-  public static B3Propagator getSingleHeaderPropagator() {\n-    return SINGLE_HEADER;\n+  public static B3Propagator.Builder builder() {\n+    return new Builder();\n   }\n \n   /**\n-   * Returns an instance of {@link B3Propagator} with Multiple Header Implementation of B3\n-   * propagation protocol. See <a\n-   * href=https://github.com/openzipkin/b3-propagation#multiple-headers>openzipkin/b3-propagation#multiple-headers</a>.\n-   *\n-   * @return Returns an instance of {@link B3Propagator} with Multiple Header implementation of B3\n-   *     propagation protocol.\n+   * Enables the creation of an {@link B3Propagator} instance with the ability to switch injector\n+   * from single header (default) to multiple headers.\n    */\n-  public static B3Propagator getMultipleHeaderPropagator() {\n-    return MULTI_HEADER;\n+  public static class Builder {\n+    private boolean injectSingleHeader;\n+\n+    private Builder() {\n+      injectSingleHeader = true;\n+    }\n+\n+    public Builder injectFromMultipleHeaders() {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzE3NjA2Ng=="}, "originalCommit": {"oid": "45d2d190961f0da7af9e62464f37130d52e29378"}, "originalPosition": 97}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1287, "cost": 1, "resetAt": "2021-11-12T20:28:25Z"}}}