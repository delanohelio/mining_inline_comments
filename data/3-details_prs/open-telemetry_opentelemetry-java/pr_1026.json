{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzkwMzMwNTA0", "number": 1026, "title": "Revise null values for AttributeValue", "bodyText": "This partially resolves #948 addressing:\n\nempty strings are now a valid AttributeValue\nnull values remove existing AttributeValues and their relative key is dropped.\n\nNote, Array will be handled in a follow up PR or as part of #807, depending on the merge order.", "createdAt": "2020-03-18T09:48:55Z", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1026", "merged": true, "mergeCommit": {"oid": "73e671d8f18ce7b3f77fd38f17012a86a563ae68"}, "closed": true, "closedAt": "2020-03-20T17:08:32Z", "author": {"login": "thisthat"}, "timelineItems": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcOydt2AH2gAyMzkwMzMwNTA0Ojg3NmEyMzhlZGVmNzExOWIxMzEyMWVkZGJhYjNjODU3ZWU1YmM0MzM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcPjqy3AFqTM3ODY2NDMyMw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "876a238edef7119b13121eddbab3c857ee5bc433", "author": {"user": {"login": "thisthat", "name": "Giovanni Liva"}}, "url": "https://github.com/open-telemetry/opentelemetry-java/commit/876a238edef7119b13121eddbab3c857ee5bc433", "committedDate": "2020-03-18T07:48:44Z", "message": "Align null/empty AttributeValue to spec"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "38932b1158fc1a1f5f5899d40f6e965e0b3b8966", "author": {"user": {"login": "thisthat", "name": "Giovanni Liva"}}, "url": "https://github.com/open-telemetry/opentelemetry-java/commit/38932b1158fc1a1f5f5899d40f6e965e0b3b8966", "committedDate": "2020-03-18T09:41:29Z", "message": "Refactoring"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc3MDgwNzQ4", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1026#pullrequestreview-377080748", "createdAt": "2020-03-18T17:23:32Z", "commit": {"oid": "38932b1158fc1a1f5f5899d40f6e965e0b3b8966"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOFQxNzoyMzozMlrOF4PYhA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOFQxNzoyMzozMlrOF4PYhA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDUxNjYxMg==", "bodyText": "can you add parens around the boolean expression?", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1026#discussion_r394516612", "createdAt": "2020-03-18T17:23:32Z", "author": {"login": "jkwatson"}, "path": "sdk/src/main/java/io/opentelemetry/sdk/trace/SpanBuilderSdk.java", "diffHunk": "@@ -169,11 +167,24 @@\n   @Override\n   public Span.Builder setAttribute(String key, AttributeValue value) {\n     Utils.checkNotNull(key, \"key\");\n-    Utils.checkNotNull(value, \"value\");\n-    if (value.getType() == Type.STRING && StringUtils.isNullOrEmpty(value.getStringValue())) {\n-      return this;\n+    boolean remove = true;\n+    if (value != null) {\n+      switch (value.getType()) {\n+        case STRING:\n+          remove = value.getStringValue() == null;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "38932b1158fc1a1f5f5899d40f6e965e0b3b8966"}, "originalPosition": 20}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc3MDgyNzU2", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1026#pullrequestreview-377082756", "createdAt": "2020-03-18T17:25:53Z", "commit": {"oid": "38932b1158fc1a1f5f5899d40f6e965e0b3b8966"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOFQxNzoyNTo1NFrOF4PeuA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOFQxNzoyNTo1NFrOF4PeuA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDUxODIwMA==", "bodyText": "let's extract this logic to determine remove into its own method.", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1026#discussion_r394518200", "createdAt": "2020-03-18T17:25:54Z", "author": {"login": "jkwatson"}, "path": "sdk/src/main/java/io/opentelemetry/sdk/trace/SpanBuilderSdk.java", "diffHunk": "@@ -169,11 +167,24 @@\n   @Override\n   public Span.Builder setAttribute(String key, AttributeValue value) {\n     Utils.checkNotNull(key, \"key\");\n-    Utils.checkNotNull(value, \"value\");\n-    if (value.getType() == Type.STRING && StringUtils.isNullOrEmpty(value.getStringValue())) {\n-      return this;\n+    boolean remove = true;\n+    if (value != null) {\n+      switch (value.getType()) {\n+        case STRING:\n+          remove = value.getStringValue() == null;\n+          break;\n+        case BOOLEAN:\n+        case LONG:\n+        case DOUBLE:\n+          remove = false;\n+          break;\n+      }\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "38932b1158fc1a1f5f5899d40f6e965e0b3b8966"}, "originalPosition": 28}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c50af9c5873ca8383859cf38f5e0c57ccb557fba", "author": {"user": {"login": "thisthat", "name": "Giovanni Liva"}}, "url": "https://github.com/open-telemetry/opentelemetry-java/commit/c50af9c5873ca8383859cf38f5e0c57ccb557fba", "committedDate": "2020-03-19T07:01:12Z", "message": "Address feedback"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc3NTc1MDM0", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1026#pullrequestreview-377575034", "createdAt": "2020-03-19T10:03:45Z", "commit": {"oid": "c50af9c5873ca8383859cf38f5e0c57ccb557fba"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOVQxMDowMzo0NVrOF4njtA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOVQxMDowMzo0NVrOF4njtA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDkxMjY5Mg==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              private static boolean isToRemove(AttributeValue value) {\n          \n          \n            \n              private static boolean isRemovedValue(AttributeValue value) {", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1026#discussion_r394912692", "createdAt": "2020-03-19T10:03:45Z", "author": {"login": "Oberon00"}, "path": "sdk/src/main/java/io/opentelemetry/sdk/trace/SpanBuilderSdk.java", "diffHunk": "@@ -169,14 +167,31 @@\n   @Override\n   public Span.Builder setAttribute(String key, AttributeValue value) {\n     Utils.checkNotNull(key, \"key\");\n-    Utils.checkNotNull(value, \"value\");\n-    if (value.getType() == Type.STRING && StringUtils.isNullOrEmpty(value.getStringValue())) {\n-      return this;\n+    if (isToRemove(value)) {\n+      attributes.remove(key);\n+    } else {\n+      attributes.putAttribute(key, value);\n     }\n-    attributes.putAttribute(key, value);\n     return this;\n   }\n \n+  private static boolean isToRemove(AttributeValue value) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c50af9c5873ca8383859cf38f5e0c57ccb557fba"}, "originalPosition": 25}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "efb9ea78a8e9aae308e0e221595ce251a05d3fd1", "author": {"user": {"login": "thisthat", "name": "Giovanni Liva"}}, "url": "https://github.com/open-telemetry/opentelemetry-java/commit/efb9ea78a8e9aae308e0e221595ce251a05d3fd1", "committedDate": "2020-03-20T06:52:17Z", "message": "Rename method"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc4MzQzNzgx", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1026#pullrequestreview-378343781", "createdAt": "2020-03-20T09:47:41Z", "commit": {"oid": "efb9ea78a8e9aae308e0e221595ce251a05d3fd1"}, "state": "APPROVED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yMFQwOTo0Nzo0MVrOF5NMPw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yMFQwOTo0ODo0MVrOF5NOTQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTUyOTI3OQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                boolean remove = true;\n          \n          \n            \n                if (value != null) {\n          \n          \n            \n                if (value == null) {\n          \n          \n            \n                  return true;\n          \n          \n            \n                }", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1026#discussion_r395529279", "createdAt": "2020-03-20T09:47:41Z", "author": {"login": "Oberon00"}, "path": "sdk/src/main/java/io/opentelemetry/sdk/trace/SpanBuilderSdk.java", "diffHunk": "@@ -169,14 +167,31 @@\n   @Override\n   public Span.Builder setAttribute(String key, AttributeValue value) {\n     Utils.checkNotNull(key, \"key\");\n-    Utils.checkNotNull(value, \"value\");\n-    if (value.getType() == Type.STRING && StringUtils.isNullOrEmpty(value.getStringValue())) {\n-      return this;\n+    if (isRemovedValue(value)) {\n+      attributes.remove(key);\n+    } else {\n+      attributes.putAttribute(key, value);\n     }\n-    attributes.putAttribute(key, value);\n     return this;\n   }\n \n+  private static boolean isRemovedValue(AttributeValue value) {\n+    boolean remove = true;\n+    if (value != null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "efb9ea78a8e9aae308e0e221595ce251a05d3fd1"}, "originalPosition": 27}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTUyOTU4OA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                      remove = value.getStringValue() == null;\n          \n          \n            \n                      break;\n          \n          \n            \n                      return value.getStringValue() == null;", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1026#discussion_r395529588", "createdAt": "2020-03-20T09:48:17Z", "author": {"login": "Oberon00"}, "path": "sdk/src/main/java/io/opentelemetry/sdk/trace/SpanBuilderSdk.java", "diffHunk": "@@ -169,14 +167,31 @@\n   @Override\n   public Span.Builder setAttribute(String key, AttributeValue value) {\n     Utils.checkNotNull(key, \"key\");\n-    Utils.checkNotNull(value, \"value\");\n-    if (value.getType() == Type.STRING && StringUtils.isNullOrEmpty(value.getStringValue())) {\n-      return this;\n+    if (isRemovedValue(value)) {\n+      attributes.remove(key);\n+    } else {\n+      attributes.putAttribute(key, value);\n     }\n-    attributes.putAttribute(key, value);\n     return this;\n   }\n \n+  private static boolean isRemovedValue(AttributeValue value) {\n+    boolean remove = true;\n+    if (value != null) {\n+      switch (value.getType()) {\n+        case STRING:\n+          remove = value.getStringValue() == null;\n+          break;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "efb9ea78a8e9aae308e0e221595ce251a05d3fd1"}, "originalPosition": 31}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTUyOTcwMw==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                      remove = false;\n          \n          \n            \n                      break;\n          \n          \n            \n                      return false;", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1026#discussion_r395529703", "createdAt": "2020-03-20T09:48:32Z", "author": {"login": "Oberon00"}, "path": "sdk/src/main/java/io/opentelemetry/sdk/trace/SpanBuilderSdk.java", "diffHunk": "@@ -169,14 +167,31 @@\n   @Override\n   public Span.Builder setAttribute(String key, AttributeValue value) {\n     Utils.checkNotNull(key, \"key\");\n-    Utils.checkNotNull(value, \"value\");\n-    if (value.getType() == Type.STRING && StringUtils.isNullOrEmpty(value.getStringValue())) {\n-      return this;\n+    if (isRemovedValue(value)) {\n+      attributes.remove(key);\n+    } else {\n+      attributes.putAttribute(key, value);\n     }\n-    attributes.putAttribute(key, value);\n     return this;\n   }\n \n+  private static boolean isRemovedValue(AttributeValue value) {\n+    boolean remove = true;\n+    if (value != null) {\n+      switch (value.getType()) {\n+        case STRING:\n+          remove = value.getStringValue() == null;\n+          break;\n+        case BOOLEAN:\n+        case LONG:\n+        case DOUBLE:\n+          remove = false;\n+          break;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "efb9ea78a8e9aae308e0e221595ce251a05d3fd1"}, "originalPosition": 36}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTUyOTgwNQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                return remove;", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1026#discussion_r395529805", "createdAt": "2020-03-20T09:48:41Z", "author": {"login": "Oberon00"}, "path": "sdk/src/main/java/io/opentelemetry/sdk/trace/SpanBuilderSdk.java", "diffHunk": "@@ -169,14 +167,31 @@\n   @Override\n   public Span.Builder setAttribute(String key, AttributeValue value) {\n     Utils.checkNotNull(key, \"key\");\n-    Utils.checkNotNull(value, \"value\");\n-    if (value.getType() == Type.STRING && StringUtils.isNullOrEmpty(value.getStringValue())) {\n-      return this;\n+    if (isRemovedValue(value)) {\n+      attributes.remove(key);\n+    } else {\n+      attributes.putAttribute(key, value);\n     }\n-    attributes.putAttribute(key, value);\n     return this;\n   }\n \n+  private static boolean isRemovedValue(AttributeValue value) {\n+    boolean remove = true;\n+    if (value != null) {\n+      switch (value.getType()) {\n+        case STRING:\n+          remove = value.getStringValue() == null;\n+          break;\n+        case BOOLEAN:\n+        case LONG:\n+        case DOUBLE:\n+          remove = false;\n+          break;\n+      }\n+    }\n+    return remove;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "efb9ea78a8e9aae308e0e221595ce251a05d3fd1"}, "originalPosition": 39}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5ed0b0adbdb78cd9690c51f5590f35f4a0b82c83", "author": {"user": {"login": "thisthat", "name": "Giovanni Liva"}}, "url": "https://github.com/open-telemetry/opentelemetry-java/commit/5ed0b0adbdb78cd9690c51f5590f35f4a0b82c83", "committedDate": "2020-03-20T15:08:48Z", "message": "Use return"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc4NjQ2ODcz", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1026#pullrequestreview-378646873", "createdAt": "2020-03-20T16:44:54Z", "commit": {"oid": "5ed0b0adbdb78cd9690c51f5590f35f4a0b82c83"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc4NjQ4NDg5", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1026#pullrequestreview-378648489", "createdAt": "2020-03-20T16:47:01Z", "commit": {"oid": "5ed0b0adbdb78cd9690c51f5590f35f4a0b82c83"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc4NjY0MzIz", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1026#pullrequestreview-378664323", "createdAt": "2020-03-20T17:08:22Z", "commit": {"oid": "5ed0b0adbdb78cd9690c51f5590f35f4a0b82c83"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3231, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}