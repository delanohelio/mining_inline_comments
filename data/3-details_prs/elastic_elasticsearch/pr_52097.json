{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzcyNzI0MzY2", "number": 52097, "title": "SQL: Enhance timestamp escaped literal parsing", "bodyText": "Allow also whitespace   (together with T) as a separator between\ndate and time parts of the timestamp string. E.g.:\n{ts '2020-02-08 12.10.45'}\n\nor\n{ts '2020-02-08T12.10.45'}\n\nFixes: #46069", "createdAt": "2020-02-08T15:11:11Z", "url": "https://github.com/elastic/elasticsearch/pull/52097", "merged": true, "mergeCommit": {"oid": "07c977023fb8ceab5991c359a6cbfe07beaad9bb"}, "closed": true, "closedAt": "2020-02-10T09:39:46Z", "author": {"login": "matriv"}, "timelineItems": {"totalCount": 13, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcCVTa8gH2gAyMzcyNzI0MzY2OjMxNjZiOGVmMzIyMmM3MDZjYmFlNDUzMTJlNjI2YzU5MmE3NGM0NzA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcC4WlcgFqTM1NTczODY3OQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "3166b8ef3222c706cbae45312e626c592a74c470", "author": {"user": {"login": "matriv", "name": "Marios Trivyzas"}}, "url": "https://github.com/elastic/elasticsearch/commit/3166b8ef3222c706cbae45312e626c592a74c470", "committedDate": "2020-02-08T15:03:09Z", "message": "SQL: Enhance timestamp escaped literal parsing\n\nAllow also whitespace ` ` (together with `T`) as a separator between\ndate and time parts of the timestamp string. E.g.:\n```\n2020-02-08 12.10.45\n```\nor\n```\n2020-02-08T12.10.45\n```\n\nFixes: #46049"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU1NTYwMTI5", "url": "https://github.com/elastic/elasticsearch/pull/52097#pullrequestreview-355560129", "createdAt": "2020-02-08T17:57:42Z", "commit": {"oid": "3166b8ef3222c706cbae45312e626c592a74c470"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wOFQxNzo1Nzo0MlrOFnRaDQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wOFQxNzo1Nzo0MlrOFnRaDQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjcyMzk4MQ==", "bodyText": "This could be improved by checking whether there's a T separator at its dedicated position (10) in order to select the right parser. This should avoid the fallback in case of an exception.", "url": "https://github.com/elastic/elasticsearch/pull/52097#discussion_r376723981", "createdAt": "2020-02-08T17:57:42Z", "author": {"login": "costin"}, "path": "x-pack/plugin/sql/src/main/java/org/elasticsearch/xpack/sql/util/DateUtils.java", "diffHunk": "@@ -105,7 +111,11 @@ public static ZonedDateTime asDateTime(String dateFormat) {\n     }\n \n     public static ZonedDateTime ofEscapedLiteral(String dateFormat) {\n-        return ZonedDateTime.parse(dateFormat, DATE_TIME_ESCAPED_LITERAL_FORMATTER.withZone(UTC));\n+        try {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3166b8ef3222c706cbae45312e626c592a74c470"}, "originalPosition": 35}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU1NTYwMTcw", "url": "https://github.com/elastic/elasticsearch/pull/52097#pullrequestreview-355560170", "createdAt": "2020-02-08T17:58:28Z", "commit": {"oid": "3166b8ef3222c706cbae45312e626c592a74c470"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3e294010106af2c2eaab1f01bf7cf9af91b5e53e", "author": {"user": {"login": "matriv", "name": "Marios Trivyzas"}}, "url": "https://github.com/elastic/elasticsearch/commit/3e294010106af2c2eaab1f01bf7cf9af91b5e53e", "committedDate": "2020-02-08T18:09:36Z", "message": "enhance escaped time literal tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "439c3504dc522c91345584545ad1362f8342a16e", "author": {"user": {"login": "matriv", "name": "Marios Trivyzas"}}, "url": "https://github.com/elastic/elasticsearch/commit/439c3504dc522c91345584545ad1362f8342a16e", "committedDate": "2020-02-08T18:46:32Z", "message": "Address comments - enhance tests"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f64e2dd2ce8e6d44c30b2a97fcb8c6638b682d9d", "author": {"user": {"login": "matriv", "name": "Marios Trivyzas"}}, "url": "https://github.com/elastic/elasticsearch/commit/f64e2dd2ce8e6d44c30b2a97fcb8c6638b682d9d", "committedDate": "2020-02-08T18:08:31Z", "message": "enhance escaped time literal tests"}, "afterCommit": {"oid": "439c3504dc522c91345584545ad1362f8342a16e", "author": {"user": {"login": "matriv", "name": "Marios Trivyzas"}}, "url": "https://github.com/elastic/elasticsearch/commit/439c3504dc522c91345584545ad1362f8342a16e", "committedDate": "2020-02-08T18:46:32Z", "message": "Address comments - enhance tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cb520d7126b0a878ccc5f67c2f9e3e112f1df0fb", "author": {"user": {"login": "matriv", "name": "Marios Trivyzas"}}, "url": "https://github.com/elastic/elasticsearch/commit/cb520d7126b0a878ccc5f67c2f9e3e112f1df0fb", "committedDate": "2020-02-08T19:06:50Z", "message": "fix index out of bounds"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0e6829991e3ab202e7d875f5eb95926aeb75333c", "author": {"user": {"login": "matriv", "name": "Marios Trivyzas"}}, "url": "https://github.com/elastic/elasticsearch/commit/0e6829991e3ab202e7d875f5eb95926aeb75333c", "committedDate": "2020-02-08T19:05:58Z", "message": "fix index out of bounds"}, "afterCommit": {"oid": "cb520d7126b0a878ccc5f67c2f9e3e112f1df0fb", "author": {"user": {"login": "matriv", "name": "Marios Trivyzas"}}, "url": "https://github.com/elastic/elasticsearch/commit/cb520d7126b0a878ccc5f67c2f9e3e112f1df0fb", "committedDate": "2020-02-08T19:06:50Z", "message": "fix index out of bounds"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU1NjIyMjE5", "url": "https://github.com/elastic/elasticsearch/pull/52097#pullrequestreview-355622219", "createdAt": "2020-02-09T17:50:27Z", "commit": {"oid": "cb520d7126b0a878ccc5f67c2f9e3e112f1df0fb"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU1NjI0MTU5", "url": "https://github.com/elastic/elasticsearch/pull/52097#pullrequestreview-355624159", "createdAt": "2020-02-09T18:25:33Z", "commit": {"oid": "cb520d7126b0a878ccc5f67c2f9e3e112f1df0fb"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wOVQxODoyNTozM1rOFnWTiA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wOVQxODoyNzoyMlrOFnWUGQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjgwNDIzMg==", "bodyText": "I think this whole code could be simplified (and still readable and not cluttered) as:\n        if (randomBoolean()) {\n           return \":55\" + randomFrom(\"\", \".1\", \".12\", \".123\", \".1234\", \".12345\", \".123456\",\n                    \".1234567\", \".12345678\", \".123456789\");\n        }\n        return \"\";", "url": "https://github.com/elastic/elasticsearch/pull/52097#discussion_r376804232", "createdAt": "2020-02-09T18:25:33Z", "author": {"login": "astefan"}, "path": "x-pack/plugin/sql/src/test/java/org/elasticsearch/xpack/sql/parser/EscapedFunctionsTests.java", "diffHunk": "@@ -62,6 +62,40 @@ private Literal timestampLiteral(String date) {\n         return (Literal) exp;\n     }\n \n+    private String buildDate() {\n+        StringBuilder sb = new StringBuilder();\n+        int length = randomIntBetween(4, 9);\n+\n+        if (randomBoolean()) {\n+            sb.append('-');\n+        } else {\n+            if (length > 4) {\n+                sb.append('-');\n+            }\n+        }\n+\n+        for (int i = 1; i <= length; i++) {\n+            sb.append(i);\n+        }\n+        sb.append(\"-05-10\");\n+        return sb.toString();\n+    }\n+\n+    private String buildSecsAndFractional() {\n+        boolean hasSecs = randomBoolean();\n+        String secs = \"\";\n+        if (hasSecs) {\n+            secs = \":55\";\n+        }\n+\n+        String fractionalSecs = \"\";\n+        if (hasSecs) {\n+            fractionalSecs = randomFrom(\"\", \".1\", \".12\", \".123\", \".1234\", \".12345\", \".123456\",\n+                    \".1234567\", \".12345678\", \".123456789\");\n+        }\n+        return secs + fractionalSecs;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cb520d7126b0a878ccc5f67c2f9e3e112f1df0fb"}, "originalPosition": 35}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjgwNDM3Nw==", "bodyText": "I don't understand this. Why is the date starting with -?", "url": "https://github.com/elastic/elasticsearch/pull/52097#discussion_r376804377", "createdAt": "2020-02-09T18:27:22Z", "author": {"login": "astefan"}, "path": "x-pack/plugin/sql/src/test/java/org/elasticsearch/xpack/sql/parser/EscapedFunctionsTests.java", "diffHunk": "@@ -62,6 +62,40 @@ private Literal timestampLiteral(String date) {\n         return (Literal) exp;\n     }\n \n+    private String buildDate() {\n+        StringBuilder sb = new StringBuilder();\n+        int length = randomIntBetween(4, 9);\n+\n+        if (randomBoolean()) {\n+            sb.append('-');", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cb520d7126b0a878ccc5f67c2f9e3e112f1df0fb"}, "originalPosition": 9}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "406433f045a13db7a21bcc22bf33ead67d7be0c9", "author": {"user": {"login": "matriv", "name": "Marios Trivyzas"}}, "url": "https://github.com/elastic/elasticsearch/commit/406433f045a13db7a21bcc22bf33ead67d7be0c9", "committedDate": "2020-02-09T18:37:44Z", "message": "address comments"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU1NjczMjQ2", "url": "https://github.com/elastic/elasticsearch/pull/52097#pullrequestreview-355673246", "createdAt": "2020-02-10T03:13:05Z", "commit": {"oid": "406433f045a13db7a21bcc22bf33ead67d7be0c9"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU1NzM4Njc5", "url": "https://github.com/elastic/elasticsearch/pull/52097#pullrequestreview-355738679", "createdAt": "2020-02-10T07:53:17Z", "commit": {"oid": "406433f045a13db7a21bcc22bf33ead67d7be0c9"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2719, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}