{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzU4NjgyMjQ4", "number": 50553, "reviewThreads": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wMlQxNTowMjozNlrODVd6pA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wM1QwODo1NDoxOVrODVnO2w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjIzODM2ODM2OnYy", "diffSide": "RIGHT", "path": "x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/ml/action/DeleteDataFrameAnalyticsAction.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wMlQxNTowMjozNlrOFZtcDA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wMlQxNToxMDoxM1rOFZtnTg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MjUwMzE4MA==", "bodyText": "#nit,\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        if (in.getVersion().onOrAfter(Version.CURRENT)) {\n          \n          \n            \n                        if (in.getVersion().onOrAfter(Version.V_8_0_0)) {", "url": "https://github.com/elastic/elasticsearch/pull/50553#discussion_r362503180", "createdAt": "2020-01-02T15:02:36Z", "author": {"login": "benwtrent"}, "path": "x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/ml/action/DeleteDataFrameAnalyticsAction.java", "diffHunk": "@@ -30,13 +30,21 @@ private DeleteDataFrameAnalyticsAction() {\n         super(NAME, AcknowledgedResponse::new);\n     }\n \n-    public static class Request extends AcknowledgedRequest<Request> implements ToXContentFragment {\n+    public static class Request extends AcknowledgedRequest<Request> {\n+\n+        public static final ParseField FORCE = new ParseField(\"force\");\n \n         private String id;\n+        private boolean force;\n \n         public Request(StreamInput in) throws IOException {\n             super(in);\n             id = in.readString();\n+            if (in.getVersion().onOrAfter(Version.CURRENT)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "196b04df6f09ac5f1fdd3ec1895cab55f5860d95"}, "originalPosition": 34}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MjUwNTIwMA==", "bodyText": "I will have to turn off BWC tests for this. I have the habit of leaving those as CURRENT and change them when I unmute the BWC tests after backporting.", "url": "https://github.com/elastic/elasticsearch/pull/50553#discussion_r362505200", "createdAt": "2020-01-02T15:08:03Z", "author": {"login": "dimitris-athanasiou"}, "path": "x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/ml/action/DeleteDataFrameAnalyticsAction.java", "diffHunk": "@@ -30,13 +30,21 @@ private DeleteDataFrameAnalyticsAction() {\n         super(NAME, AcknowledgedResponse::new);\n     }\n \n-    public static class Request extends AcknowledgedRequest<Request> implements ToXContentFragment {\n+    public static class Request extends AcknowledgedRequest<Request> {\n+\n+        public static final ParseField FORCE = new ParseField(\"force\");\n \n         private String id;\n+        private boolean force;\n \n         public Request(StreamInput in) throws IOException {\n             super(in);\n             id = in.readString();\n+            if (in.getVersion().onOrAfter(Version.CURRENT)) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MjUwMzE4MA=="}, "originalCommit": {"oid": "196b04df6f09ac5f1fdd3ec1895cab55f5860d95"}, "originalPosition": 34}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MjUwNjA2Mg==", "bodyText": "@dimitris-athanasiou I can understand that, I have just noticed that using CURRENT allows you to backport without actually changing the version (since it still compiles). V_8_0_0 forces me to do things in the correct order.\nI just find this helpful, I am not gonna prevent a \ud83d\udc4d over it :D", "url": "https://github.com/elastic/elasticsearch/pull/50553#discussion_r362506062", "createdAt": "2020-01-02T15:10:13Z", "author": {"login": "benwtrent"}, "path": "x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/ml/action/DeleteDataFrameAnalyticsAction.java", "diffHunk": "@@ -30,13 +30,21 @@ private DeleteDataFrameAnalyticsAction() {\n         super(NAME, AcknowledgedResponse::new);\n     }\n \n-    public static class Request extends AcknowledgedRequest<Request> implements ToXContentFragment {\n+    public static class Request extends AcknowledgedRequest<Request> {\n+\n+        public static final ParseField FORCE = new ParseField(\"force\");\n \n         private String id;\n+        private boolean force;\n \n         public Request(StreamInput in) throws IOException {\n             super(in);\n             id = in.readString();\n+            if (in.getVersion().onOrAfter(Version.CURRENT)) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MjUwMzE4MA=="}, "originalCommit": {"oid": "196b04df6f09ac5f1fdd3ec1895cab55f5860d95"}, "originalPosition": 34}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjIzODM2ODc0OnYy", "diffSide": "RIGHT", "path": "x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/ml/action/DeleteDataFrameAnalyticsAction.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wMlQxNTowMjo0N1rOFZtcTw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wMlQxNTowMjo0N1rOFZtcTw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MjUwMzI0Nw==", "bodyText": "#nit,\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        if (out.getVersion().onOrAfter(Version.CURRENT)) {\n          \n          \n            \n                        if (in.getVersion().onOrAfter(Version.V_8_0_0)) {", "url": "https://github.com/elastic/elasticsearch/pull/50553#discussion_r362503247", "createdAt": "2020-01-02T15:02:47Z", "author": {"login": "benwtrent"}, "path": "x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/ml/action/DeleteDataFrameAnalyticsAction.java", "diffHunk": "@@ -49,34 +57,39 @@ public String getId() {\n             return id;\n         }\n \n-        @Override\n-        public ActionRequestValidationException validate() {\n-            return null;\n+        public boolean isForce() {\n+            return force;\n+        }\n+\n+        public void setForce(boolean force) {\n+            this.force = force;\n         }\n \n         @Override\n-        public XContentBuilder toXContent(XContentBuilder builder, Params params) throws IOException {\n-            builder.field(DataFrameAnalyticsConfig.ID.getPreferredName(), id);\n-            return builder;\n+        public ActionRequestValidationException validate() {\n+            return null;\n         }\n \n         @Override\n         public boolean equals(Object o) {\n             if (this == o) return true;\n             if (o == null || getClass() != o.getClass()) return false;\n             DeleteDataFrameAnalyticsAction.Request request = (DeleteDataFrameAnalyticsAction.Request) o;\n-            return Objects.equals(id, request.id);\n+            return Objects.equals(id, request.id) && force == request.force;\n         }\n \n         @Override\n         public void writeTo(StreamOutput out) throws IOException {\n             super.writeTo(out);\n             out.writeString(id);\n+            if (out.getVersion().onOrAfter(Version.CURRENT)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "196b04df6f09ac5f1fdd3ec1895cab55f5860d95"}, "originalPosition": 78}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjIzODM3MDEwOnYy", "diffSide": "RIGHT", "path": "x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/action/TransportDeleteDataFrameAnalyticsAction.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wMlQxNTowMzoyNFrOFZtdIw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wMlQxNTowMzoyNFrOFZtdIw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MjUwMzQ1OQ==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    logger.debug(\"[] Force deleting data frame analytics job\", id);\n          \n          \n            \n                    logger.debug(\"[{}] Force deleting data frame analytics job\", id);", "url": "https://github.com/elastic/elasticsearch/pull/50553#discussion_r362503459", "createdAt": "2020-01-02T15:03:24Z", "author": {"login": "benwtrent"}, "path": "x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/action/TransportDeleteDataFrameAnalyticsAction.java", "diffHunk": "@@ -100,6 +101,32 @@ protected AcknowledgedResponse read(StreamInput in) throws IOException {\n     protected void masterOperation(Task task, DeleteDataFrameAnalyticsAction.Request request, ClusterState state,\n                                    ActionListener<AcknowledgedResponse> listener) {\n         String id = request.getId();\n+        TaskId taskId = new TaskId(clusterService.localNode().getId(), task.getId());\n+        ParentTaskAssigningClient parentTaskClient = new ParentTaskAssigningClient(client, taskId);\n+\n+        if (request.isForce()) {\n+            forceDelete(parentTaskClient, id, listener);\n+        } else {\n+            normalDelete(parentTaskClient, state, id, listener);\n+        }\n+    }\n+\n+    private void forceDelete(ParentTaskAssigningClient parentTaskClient, String id,\n+                             ActionListener<AcknowledgedResponse> listener) {\n+        logger.debug(\"[] Force deleting data frame analytics job\", id);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "196b04df6f09ac5f1fdd3ec1895cab55f5860d95"}, "originalPosition": 24}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjIzODk1MTIwOnYy", "diffSide": "RIGHT", "path": "docs/reference/ml/df-analytics/apis/delete-dfanalytics.asciidoc", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wMlQxOToxNjo0MVrOFZy-RQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wMlQxOToxNjo0MVrOFZy-RQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MjU5Mzg2MQ==", "bodyText": "The attribute fails unless you use what's shown in https://raw.githubusercontent.com/elastic/docs/master/shared/api-ref-ex.asciidoc\nIf this is something that comes up often, we can define both as alternatives.\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            ==== {api-query-params-title}\n          \n          \n            \n            ==== {api-query-parms-title}", "url": "https://github.com/elastic/elasticsearch/pull/50553#discussion_r362593861", "createdAt": "2020-01-02T19:16:41Z", "author": {"login": "lcawl"}, "path": "docs/reference/ml/df-analytics/apis/delete-dfanalytics.asciidoc", "diffHunk": "@@ -32,6 +32,13 @@ information, see <<security-privileges>> and <<built-in-roles>>.\n (Required, string)\n include::{docdir}/ml/ml-shared.asciidoc[tag=job-id-data-frame-analytics]\n \n+[[ml-delete-dfanalytics-query-params]]\n+==== {api-query-params-title}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "05a6d75c09e9a5ac6407bc6b776719ddd2cfe3b4"}, "originalPosition": 14}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjIzOTg5NDY3OnYy", "diffSide": "RIGHT", "path": "docs/reference/ml/df-analytics/apis/delete-dfanalytics.asciidoc", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wM1QwODo1NDoxOVrOFZ7v8Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wM1QwODo1NDoxOVrOFZ7v8Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MjczNzY0OQ==", "bodyText": "#nitpicking\nIf I understand correctly then in this case \"forcefully\" means \"deleting the job without stopping it beforehand\". If my understanding is correct, then I think \"forcefully\" is redundant.\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              (Optional, boolean) Use to forcefully delete a job that is not stopped; this method is\n          \n          \n            \n              (Optional, boolean) If `true`, it deletes a job that is not stopped; this method is", "url": "https://github.com/elastic/elasticsearch/pull/50553#discussion_r362737649", "createdAt": "2020-01-03T08:54:19Z", "author": {"login": "szabosteve"}, "path": "docs/reference/ml/df-analytics/apis/delete-dfanalytics.asciidoc", "diffHunk": "@@ -32,6 +32,13 @@ information, see <<security-privileges>> and <<built-in-roles>>.\n (Required, string)\n include::{docdir}/ml/ml-shared.asciidoc[tag=job-id-data-frame-analytics]\n \n+[[ml-delete-dfanalytics-query-params]]\n+==== {api-query-params-title}\n+\n+`force`::\n+  (Optional, boolean) Use to forcefully delete a job that is not stopped; this method is", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "05a6d75c09e9a5ac6407bc6b776719ddd2cfe3b4"}, "originalPosition": 17}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4946, "cost": 1, "resetAt": "2021-11-12T19:05:54Z"}}}