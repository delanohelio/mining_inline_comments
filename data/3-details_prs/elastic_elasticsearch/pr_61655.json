{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDc0OTIyOTU1", "number": 61655, "title": "Dedicated threadpool for system index writes", "bodyText": "This commit adds a dedicated threadpool for system index write\noperations. The dedicated resources for system index writes serves as\na means to ensure that user activity does not block important system\noperations from occurring such as the management of users and roles.", "createdAt": "2020-08-27T20:08:56Z", "url": "https://github.com/elastic/elasticsearch/pull/61655", "merged": true, "mergeCommit": {"oid": "242083a36e02496aae9214dc41b89372022e7076"}, "closed": true, "closedAt": "2020-09-22T18:14:46Z", "author": {"login": "jaymode"}, "timelineItems": {"totalCount": 13, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdDF3gvAH2gAyNDc0OTIyOTU1OmFkNjNmNWExNjU0OGRkMWRiYjRkNDRkNzEyMWQ4ODZmOGVjZGJkZTI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdLbMSyAH2gAyNDc0OTIyOTU1OmRhODU3NjliMTk2MjJkYTNmYTZmNjk4MTdmMTQyOTdiOGRlN2Y5NmQ=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "ad63f5a16548dd1dbb4d44d7121d886f8ecdbde2", "author": {"user": {"login": "jaymode", "name": "Jay Modi"}}, "url": "https://github.com/elastic/elasticsearch/commit/ad63f5a16548dd1dbb4d44d7121d886f8ecdbde2", "committedDate": "2020-08-27T19:49:10Z", "message": "Dedicated threadpool for system index writes\n\nThis commit adds a dedicated threadpool for system index write\noperations. The dedicated resources for system index writes serves as\na means to ensure that user activity does not block important system\noperations from occurring such as the management of users and roles."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "55ca5574751c2a668f79e1f92d7d27b6dbecd01b", "author": {"user": {"login": "jaymode", "name": "Jay Modi"}}, "url": "https://github.com/elastic/elasticsearch/commit/55ca5574751c2a668f79e1f92d7d27b6dbecd01b", "committedDate": "2020-08-31T15:55:07Z", "message": "indexing pressure"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b7460e0b570e407cbcf447b2552fa5569b35c4c8", "author": {"user": {"login": "jaymode", "name": "Jay Modi"}}, "url": "https://github.com/elastic/elasticsearch/commit/b7460e0b570e407cbcf447b2552fa5569b35c4c8", "committedDate": "2020-08-31T16:42:39Z", "message": "Merge branch 'master' into system_index_write_threadpool"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgwMTcwMzc1", "url": "https://github.com/elastic/elasticsearch/pull/61655#pullrequestreview-480170375", "createdAt": "2020-09-01T22:52:54Z", "commit": {"oid": "b7460e0b570e407cbcf447b2552fa5569b35c4c8"}, "state": "APPROVED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMVQyMjo1Mjo1NFrOHLK8Eg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMVQyMzozNDozOFrOHLLwuw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTQ3NTYwMg==", "bodyText": "Why can't this be simplified to just abstraction.isSystem()?", "url": "https://github.com/elastic/elasticsearch/pull/61655#discussion_r481475602", "createdAt": "2020-09-01T22:52:54Z", "author": {"login": "gwbrown"}, "path": "server/src/main/java/org/elasticsearch/action/bulk/TransportBulkAction.java", "diffHunk": "@@ -336,6 +345,18 @@ static void prohibitCustomRoutingOnDataStream(DocWriteRequest<?> writeRequest, M\n         }\n     }\n \n+    boolean isOnlySystem(BulkRequest request, SortedMap<String, IndexAbstraction> indicesLookup, SystemIndices systemIndices) {\n+        final boolean onlySystem = request.getIndices().stream().allMatch(indexName -> {\n+            final IndexAbstraction abstraction = indicesLookup.get(indexName);\n+            if (abstraction != null) {\n+                return abstraction.isSystem();\n+            } else {\n+                return systemIndices.isSystemIndex(indexName);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b7460e0b570e407cbcf447b2552fa5569b35c4c8"}, "originalPosition": 127}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTQ3ODEyNg==", "bodyText": "Nitpick: the name executor isn't really right now that it's actually a function to get an executor.", "url": "https://github.com/elastic/elasticsearch/pull/61655#discussion_r481478126", "createdAt": "2020-09-01T23:00:30Z", "author": {"login": "gwbrown"}, "path": "server/src/main/java/org/elasticsearch/action/support/replication/TransportWriteAction.java", "diffHunk": "@@ -61,21 +62,25 @@\n         > extends TransportReplicationAction<Request, ReplicaRequest, Response> {\n \n     private final IndexingPressure indexingPressure;\n-    private final String executor;\n+    private final Function<IndexShard, String> executor;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b7460e0b570e407cbcf447b2552fa5569b35c4c8"}, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTQ4OTA4Mw==", "bodyText": "There are a number of instances where we now verify that we're using the WRITE threadpool here. Could we add a test here to check the logic that determines when to use SYSTEM_WRITE?", "url": "https://github.com/elastic/elasticsearch/pull/61655#discussion_r481489083", "createdAt": "2020-09-01T23:34:38Z", "author": {"login": "gwbrown"}, "path": "server/src/test/java/org/elasticsearch/action/bulk/TransportBulkActionIngestTests.java", "diffHunk": "@@ -274,7 +276,7 @@ public void testIngestLocal() throws Exception {\n         assertFalse(responseCalled.get());\n         assertFalse(failureCalled.get());\n         verify(ingestService).executeBulkRequest(eq(bulkRequest.numberOfActions()), bulkDocsItr.capture(),\n-            failureHandler.capture(), completionHandler.capture(), any());\n+            failureHandler.capture(), completionHandler.capture(), any(), eq(Names.WRITE));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b7460e0b570e407cbcf447b2552fa5569b35c4c8"}, "originalPosition": 28}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2ac0245a08b7e631c3fec9631f18e6f78551ff33", "author": {"user": {"login": "jaymode", "name": "Jay Modi"}}, "url": "https://github.com/elastic/elasticsearch/commit/2ac0245a08b7e631c3fec9631f18e6f78551ff33", "committedDate": "2020-09-02T14:32:04Z", "message": "more places to force"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d132f1e0d6bcb96b674a40928e261c492d36c178", "author": {"user": {"login": "jaymode", "name": "Jay Modi"}}, "url": "https://github.com/elastic/elasticsearch/commit/d132f1e0d6bcb96b674a40928e261c492d36c178", "committedDate": "2020-09-18T15:09:49Z", "message": "Merge branch 'master' into system_index_write_threadpool"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1f4a42e3b811361c79cc14c5da53b658cc67182a", "author": {"user": {"login": "jaymode", "name": "Jay Modi"}}, "url": "https://github.com/elastic/elasticsearch/commit/1f4a42e3b811361c79cc14c5da53b658cc67182a", "committedDate": "2020-09-18T15:35:59Z", "message": "rename"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "094a7bc54a8609f05d471deba5a0c446ed445a0d", "author": {"user": {"login": "jaymode", "name": "Jay Modi"}}, "url": "https://github.com/elastic/elasticsearch/commit/094a7bc54a8609f05d471deba5a0c446ed445a0d", "committedDate": "2020-09-18T16:27:00Z", "message": "test only system"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7bd5b2f64146b70d5b2d5e23dc6261d23b5fcfb7", "author": {"user": {"login": "jaymode", "name": "Jay Modi"}}, "url": "https://github.com/elastic/elasticsearch/commit/7bd5b2f64146b70d5b2d5e23dc6261d23b5fcfb7", "committedDate": "2020-09-18T16:34:26Z", "message": "verify name"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "86dee58f7845d9532f9b5c3e05c5ae94871ca8b4", "author": {"user": {"login": "jaymode", "name": "Jay Modi"}}, "url": "https://github.com/elastic/elasticsearch/commit/86dee58f7845d9532f9b5c3e05c5ae94871ca8b4", "committedDate": "2020-09-18T16:38:49Z", "message": "doc"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkzMDMyODgy", "url": "https://github.com/elastic/elasticsearch/pull/61655#pullrequestreview-493032882", "createdAt": "2020-09-21T22:48:35Z", "commit": {"oid": "86dee58f7845d9532f9b5c3e05c5ae94871ca8b4"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1ccf5eec86e8f80d8d8d1e77a02f9b9c21f64693", "author": {"user": {"login": "jaymode", "name": "Jay Modi"}}, "url": "https://github.com/elastic/elasticsearch/commit/1ccf5eec86e8f80d8d8d1e77a02f9b9c21f64693", "committedDate": "2020-09-22T14:03:33Z", "message": "Merge branch 'master' into system_index_write_threadpool"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "da85769b19622da3fa6f69817f14297b8de7f96d", "author": {"user": {"login": "jaymode", "name": "Jay Modi"}}, "url": "https://github.com/elastic/elasticsearch/commit/da85769b19622da3fa6f69817f14297b8de7f96d", "committedDate": "2020-09-22T17:11:16Z", "message": "Merge branch 'master' into system_index_write_threadpool"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4615, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}