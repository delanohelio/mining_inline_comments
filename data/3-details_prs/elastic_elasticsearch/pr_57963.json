{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDMyNzY1MDMz", "number": 57963, "title": "Add ILM policy PUT and GET for remote_monitoring_agent built-in role", "bodyText": "What does this PR do?\nThis PR adds the cluster:admin/ilm/get and cluster:admin/ilm/put privilege to the remote_monitoring_agent built-in role.\nWhy is this change necessary?\nThe remote_monitoring_agent built-in role is intended for users who wish to monitor their Elastic Stack with Metricbeat. One of the checks that Metricbeat does upon start up is for the existence of an ILM policy. As such, this role should allow this check to happen.\nWithout this fix, users who try to use Metricbeat for Stack Monitoring today see the following error repeatedly in their Metricbeat log. Due to this error Metricbeat is unwilling to proceed further and, thus, no Stack Monitoring data is indexed into the Elasticsearch cluster.\n2020-06-10T17:10:37.707-0700    ERROR   [publisher_pipeline_output]     pipeline/output.go:154  Failed to connect to backoff(elasticsearch(http://localhost:9200)): Connection marked as failed because the onConnect callback failed: failed to check for policy name 'metricbeat': (status=403) {\"error\":{\"root_cause\":[{\"type\":\"security_exception\",\"reason\":\"action [cluster:admin/ilm/get] is unauthorized for user [remote_monitoring_user]\"}],\"type\":\"security_exception\",\"reason\":\"action [cluster:admin/ilm/get] is unauthorized for user [remote_monitoring_user]\"},\"status\":403}: 403 Forbidden: {\"error\":{\"root_cause\":[{\"type\":\"security_exception\",\"reason\":\"action [cluster:admin/ilm/get] is unauthorized for user [remote_monitoring_user]\"}],\"type\":\"security_exception\",\"reason\":\"action [cluster:admin/ilm/get] is unauthorized for user [remote_monitoring_user]\"},\"status\":403}", "createdAt": "2020-06-11T00:11:58Z", "url": "https://github.com/elastic/elasticsearch/pull/57963", "merged": true, "mergeCommit": {"oid": "4e4b8315e8e50bb6770456109a503e321950dc9a"}, "closed": true, "closedAt": "2020-06-15T11:29:17Z", "author": {"login": "ycombinator"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcqCxD9AH2gAyNDMyNzY1MDMzOmNmZTlhODU2MGUyMWU2MjNiMzgwOWY3ZTgyZjhiNWNmYmNmZjg0NWY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcrd2ptAH2gAyNDMyNzY1MDMzOmUxZTE3NTc2OWYxMjM3NGMwYWY5MDJjMTI2ZTA0NjMzZGRmZTUyMzU=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "cfe9a8560e21e623b3809f7e82f8b5cfbcff845f", "author": {"user": {"login": "ycombinator", "name": "Shaunak Kashyap"}}, "url": "https://github.com/elastic/elasticsearch/commit/cfe9a8560e21e623b3809f7e82f8b5cfbcff845f", "committedDate": "2020-06-11T00:04:18Z", "message": "Add cluster:admin/ilm/get privilege for remote_monitoring_agent built-in role"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI4ODEyMzkz", "url": "https://github.com/elastic/elasticsearch/pull/57963#pullrequestreview-428812393", "createdAt": "2020-06-11T11:12:49Z", "commit": {"oid": "cfe9a8560e21e623b3809f7e82f8b5cfbcff845f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMVQxMToxMjo0OVrOGiYyTA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMVQxMToxMjo0OVrOGiYyTA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODcxMDg2MA==", "bodyText": "It's preferable, if possible, to use privilege names, such as read_ilm in this case, instead of explicit action names. This offers us the maximum of flexibility, as we don't have to worry about BWC when changing action names.", "url": "https://github.com/elastic/elasticsearch/pull/57963#discussion_r438710860", "createdAt": "2020-06-11T11:12:49Z", "author": {"login": "albertzaharovits"}, "path": "x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/security/authz/store/ReservedRolesStore.java", "diffHunk": "@@ -73,6 +73,7 @@\n                                 \"cluster:monitor/xpack/watcher/watch/get\",\n                                 \"cluster:admin/xpack/watcher/watch/put\",\n                                 \"cluster:admin/xpack/watcher/watch/delete\",\n+                                GetLifecycleAction.NAME,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cfe9a8560e21e623b3809f7e82f8b5cfbcff845f"}, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "552d190106a01de2f3f024b397ba97936276244a", "author": {"user": {"login": "ycombinator", "name": "Shaunak Kashyap"}}, "url": "https://github.com/elastic/elasticsearch/commit/552d190106a01de2f3f024b397ba97936276244a", "committedDate": "2020-06-11T12:09:06Z", "message": "Use privilege name, not action name"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI4ODg5Njcw", "url": "https://github.com/elastic/elasticsearch/pull/57963#pullrequestreview-428889670", "createdAt": "2020-06-11T13:09:45Z", "commit": {"oid": "552d190106a01de2f3f024b397ba97936276244a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "70077014385f2ade700390658a461cfb58423af7", "author": {"user": {"login": "albertzaharovits", "name": "Albert Zaharovits"}}, "url": "https://github.com/elastic/elasticsearch/commit/70077014385f2ade700390658a461cfb58423af7", "committedDate": "2020-06-15T09:55:00Z", "message": "ILM Put and Get for remote_monitoring_agent"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e1e175769f12374c0af902c126e04633ddfe5235", "author": {"user": {"login": "elasticmachine", "name": "Elastic Machine"}}, "url": "https://github.com/elastic/elasticsearch/commit/e1e175769f12374c0af902c126e04633ddfe5235", "committedDate": "2020-06-15T10:11:46Z", "message": "Merge branch 'master' into remote-monitoring-agent-privs-add-ilm-read"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 778, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}