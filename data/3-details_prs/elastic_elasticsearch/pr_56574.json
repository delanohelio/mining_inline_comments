{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE2NTcxNDI3", "number": 56574, "title": "Ensure watcher email action message ids are always unique", "bodyText": "If an email action is used in a foreach loop, message ids could have\nbeen duplicated, which then get rejected by the mail server.\nThis commit introduces an additional static counter in the email action\nin order to ensure that every message id is unique.", "createdAt": "2020-05-12T08:31:54Z", "url": "https://github.com/elastic/elasticsearch/pull/56574", "merged": true, "mergeCommit": {"oid": "9c9075cb8eb62a23f245ea8da7cbfc00049bffe9"}, "closed": true, "closedAt": "2020-05-14T08:19:31Z", "author": {"login": "spinscale"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcggA1eAH2gAyNDE2NTcxNDI3OjkxYjZhOWZhMzM1NjhlMjhiMjAzMTZlYzk3OWFhNDkwMWJhMzliYjU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABchH4p4AH2gAyNDE2NTcxNDI3OjA4M2JhMTI2ZGE3YmQ0OGY3N2ZlOWJhNGY1OGI5ZTJlYjRkMjEyYTg=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "91b6a9fa33568e28b20316ec979aa4901ba39bb5", "author": {"user": {"login": "spinscale", "name": "Alexander Reelsen"}}, "url": "https://github.com/elastic/elasticsearch/commit/91b6a9fa33568e28b20316ec979aa4901ba39bb5", "committedDate": "2020-05-12T08:29:32Z", "message": "Ensure watcher email action message ids are always unique\n\nIf an email action is used in a foreach loop, message ids could have\nbeen duplicated, which then get rejected by the mail server.\n\nThis commit introduces an additional static counter in the email action\nin order to ensure that every message id is unique."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEwMzkyMTA0", "url": "https://github.com/elastic/elasticsearch/pull/56574#pullrequestreview-410392104", "createdAt": "2020-05-12T20:21:08Z", "commit": {"oid": "91b6a9fa33568e28b20316ec979aa4901ba39bb5"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQyMDoyMTowOFrOGUXfaQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQyMDoyMTowOFrOGUXfaQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDAwOTU3Nw==", "bodyText": "I know integer max is pretty large w/r/t sending emails ... but wonder if appending a random UUID would be better suited to ensure uniqueness to avoid exceeding the max ?\nWould org.elasticsearch.common.RandomBasedUUIDGenerator#getBase64UUID() be a candidate instead ?\n(I tested it looks like if you exceed max it just rolls over to negative numbers, but that is likely an implementation detail since it is not the doc)", "url": "https://github.com/elastic/elasticsearch/pull/56574#discussion_r424009577", "createdAt": "2020-05-12T20:21:08Z", "author": {"login": "jakelandis"}, "path": "x-pack/plugin/watcher/src/main/java/org/elasticsearch/xpack/watcher/actions/email/ExecutableEmailAction.java", "diffHunk": "@@ -25,9 +25,12 @@\n import java.io.IOException;\n import java.util.HashMap;\n import java.util.Map;\n+import java.util.concurrent.atomic.AtomicInteger;\n \n public class ExecutableEmailAction extends ExecutableAction<EmailAction> {\n \n+    private static final AtomicInteger counter = new AtomicInteger(0);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "91b6a9fa33568e28b20316ec979aa4901ba39bb5"}, "originalPosition": 8}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEwNDc2MTY1", "url": "https://github.com/elastic/elasticsearch/pull/56574#pullrequestreview-410476165", "createdAt": "2020-05-12T22:48:44Z", "commit": {"oid": "91b6a9fa33568e28b20316ec979aa4901ba39bb5"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "552f906b28b88c10d74994c5c641021b5e827669", "author": {"user": {"login": "spinscale", "name": "Alexander Reelsen"}}, "url": "https://github.com/elastic/elasticsearch/commit/552f906b28b88c10d74994c5c641021b5e827669", "committedDate": "2020-05-13T07:07:52Z", "message": "Ensure no negative value is produced"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "083ba126da7bd48f77fe9ba4f58b9e2eb4d212a8", "author": {"user": {"login": "elasticmachine", "name": "Elastic Machine"}}, "url": "https://github.com/elastic/elasticsearch/commit/083ba126da7bd48f77fe9ba4f58b9e2eb4d212a8", "committedDate": "2020-05-14T06:56:48Z", "message": "Merge branch 'master' into 2005-watcher-ensure-unique-message-ids"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 20, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}