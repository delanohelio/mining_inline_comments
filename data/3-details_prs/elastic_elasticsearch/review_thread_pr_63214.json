{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDk3MjQxMDM0", "number": 63214, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNlQwOTowNTo0MVrOEqorgw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNlQwOTowNTo0MVrOEqorgw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEzMTQyMTQ3OnYy", "diffSide": "RIGHT", "path": "server/src/main/java/org/elasticsearch/index/mapper/MapperService.java", "isResolved": false, "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNlQwOTowNTo0MVrOHc88qw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNlQwOToyNzoxNVrOHc9wZg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDEyMDc0Nw==", "bodyText": "for my understanding: does this mean that the field type does not come back with the below field type lookup? Did it before?", "url": "https://github.com/elastic/elasticsearch/pull/63214#discussion_r500120747", "createdAt": "2020-10-06T09:05:41Z", "author": {"login": "javanna"}, "path": "server/src/main/java/org/elasticsearch/index/mapper/MapperService.java", "diffHunk": "@@ -593,6 +593,11 @@ public DocumentMapperForType documentMapperWithAutoCreate(String type) {\n      * Given the full name of a field, returns its {@link MappedFieldType}.\n      */\n     public MappedFieldType fieldType(String fullName) {\n+        if (fullName.equals(TypeFieldMapper.NAME)) {\n+            String type = mapper == null ? null : mapper.type();\n+            return new TypeFieldMapper.TypeFieldType(type);\n+        }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fb2f02aa033fc2ea8e7e992f1697ce9113aab724"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDEyMjA5OQ==", "bodyText": "It does come back with the lookup, but it may not have the correct type set on it (for example, if the index in question did not have any mappings set when the MapperService was originally built).  This way we know we always have the correct type.", "url": "https://github.com/elastic/elasticsearch/pull/63214#discussion_r500122099", "createdAt": "2020-10-06T09:07:59Z", "author": {"login": "romseygeek"}, "path": "server/src/main/java/org/elasticsearch/index/mapper/MapperService.java", "diffHunk": "@@ -593,6 +593,11 @@ public DocumentMapperForType documentMapperWithAutoCreate(String type) {\n      * Given the full name of a field, returns its {@link MappedFieldType}.\n      */\n     public MappedFieldType fieldType(String fullName) {\n+        if (fullName.equals(TypeFieldMapper.NAME)) {\n+            String type = mapper == null ? null : mapper.type();\n+            return new TypeFieldMapper.TypeFieldType(type);\n+        }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDEyMDc0Nw=="}, "originalCommit": {"oid": "fb2f02aa033fc2ea8e7e992f1697ce9113aab724"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDEyNTAyNQ==", "bodyText": "ok, so could there be places where the type field mapper is retrieved in some way that could expose the wrong type then?", "url": "https://github.com/elastic/elasticsearch/pull/63214#discussion_r500125025", "createdAt": "2020-10-06T09:12:52Z", "author": {"login": "javanna"}, "path": "server/src/main/java/org/elasticsearch/index/mapper/MapperService.java", "diffHunk": "@@ -593,6 +593,11 @@ public DocumentMapperForType documentMapperWithAutoCreate(String type) {\n      * Given the full name of a field, returns its {@link MappedFieldType}.\n      */\n     public MappedFieldType fieldType(String fullName) {\n+        if (fullName.equals(TypeFieldMapper.NAME)) {\n+            String type = mapper == null ? null : mapper.type();\n+            return new TypeFieldMapper.TypeFieldType(type);\n+        }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDEyMDc0Nw=="}, "originalCommit": {"oid": "fb2f02aa033fc2ea8e7e992f1697ce9113aab724"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDEyODY4Mg==", "bodyText": "From a quick review:\n\nthe only other way to access field types is via MapperService#documentMapper#fieldTypes() directly\nthis is exposed via MapperService#fieldTypes()\nMapperService#fieldTypes() is only called by the index warming code, and the type field does not use global ordinals so is unaffected\n\nSo I think we're safe.  We should probably remove MapperService#fieldTypes() at some point though, as it is indeed asking for trouble to expose this to the outside world.", "url": "https://github.com/elastic/elasticsearch/pull/63214#discussion_r500128682", "createdAt": "2020-10-06T09:18:45Z", "author": {"login": "romseygeek"}, "path": "server/src/main/java/org/elasticsearch/index/mapper/MapperService.java", "diffHunk": "@@ -593,6 +593,11 @@ public DocumentMapperForType documentMapperWithAutoCreate(String type) {\n      * Given the full name of a field, returns its {@link MappedFieldType}.\n      */\n     public MappedFieldType fieldType(String fullName) {\n+        if (fullName.equals(TypeFieldMapper.NAME)) {\n+            String type = mapper == null ? null : mapper.type();\n+            return new TypeFieldMapper.TypeFieldType(type);\n+        }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDEyMDc0Nw=="}, "originalCommit": {"oid": "fb2f02aa033fc2ea8e7e992f1697ce9113aab724"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDEzMTk2OQ==", "bodyText": "ok thanks for double checking", "url": "https://github.com/elastic/elasticsearch/pull/63214#discussion_r500131969", "createdAt": "2020-10-06T09:24:03Z", "author": {"login": "javanna"}, "path": "server/src/main/java/org/elasticsearch/index/mapper/MapperService.java", "diffHunk": "@@ -593,6 +593,11 @@ public DocumentMapperForType documentMapperWithAutoCreate(String type) {\n      * Given the full name of a field, returns its {@link MappedFieldType}.\n      */\n     public MappedFieldType fieldType(String fullName) {\n+        if (fullName.equals(TypeFieldMapper.NAME)) {\n+            String type = mapper == null ? null : mapper.type();\n+            return new TypeFieldMapper.TypeFieldType(type);\n+        }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDEyMDc0Nw=="}, "originalCommit": {"oid": "fb2f02aa033fc2ea8e7e992f1697ce9113aab724"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDEzMzk5MA==", "bodyText": "Thanks for keeping me honest :)", "url": "https://github.com/elastic/elasticsearch/pull/63214#discussion_r500133990", "createdAt": "2020-10-06T09:27:15Z", "author": {"login": "romseygeek"}, "path": "server/src/main/java/org/elasticsearch/index/mapper/MapperService.java", "diffHunk": "@@ -593,6 +593,11 @@ public DocumentMapperForType documentMapperWithAutoCreate(String type) {\n      * Given the full name of a field, returns its {@link MappedFieldType}.\n      */\n     public MappedFieldType fieldType(String fullName) {\n+        if (fullName.equals(TypeFieldMapper.NAME)) {\n+            String type = mapper == null ? null : mapper.type();\n+            return new TypeFieldMapper.TypeFieldType(type);\n+        }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDEyMDc0Nw=="}, "originalCommit": {"oid": "fb2f02aa033fc2ea8e7e992f1697ce9113aab724"}, "originalPosition": 7}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3161, "cost": 1, "resetAt": "2021-11-12T11:57:46Z"}}}