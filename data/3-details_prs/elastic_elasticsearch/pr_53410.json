{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg2NzAzODEw", "number": 53410, "title": "Create set-based interface for NodesInfoRequest", "bodyText": "This is another refactoring PR to move the Nodes Information endpoint in the direction of pluggability (see #52975). In #53140, we changed the NodesInfoRequest class so that it serializes as a set of strings rather than a fixed list of booleans. In this PR, we update the interface of NodesInfoRequest so that it uses getters and setters that are more appropriate to this internal structure. For example, the old way of adding \"os\" metrics to a request would be to call request.os(true). The new way of doing this is to call request.addMetric(\"os\"). For the time being, the NodesInfoRequest has a Metric enum that serves as the source of truth for allowed metrics. I plan to replace this eventually with a pluggable solution.\nThe follow-up step for this PR is to update the NodesInfoRequestBuilder to have a matching set-based interface, but I am putting that off to another PR in order to keep the diff small and to avoid confusion between the two classes.", "createdAt": "2020-03-11T13:54:46Z", "url": "https://github.com/elastic/elasticsearch/pull/53410", "merged": true, "mergeCommit": {"oid": "6d6227a239f248e1beb760a3f29f60ce3fcb02cb"}, "closed": true, "closedAt": "2020-03-25T18:12:37Z", "author": {"login": "williamrandolph"}, "timelineItems": {"totalCount": 27, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcMYYtWgH2gAyMzg2NzAzODEwOjU2OGU3OWRiMWIzZTY1NjdiNzdjZWZlOGU3ZTZlNTBmYjNhNDk0OGQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcRHFc0gH2gAyMzg2NzAzODEwOjczZmY3NzY0NGJiZjI3NzNkODNiZGZlODUxZWNhM2UxZjI2MjRiNzI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "568e79db1b3e6567b77cefe8e7e6e50fb3a4948d", "author": {"user": {"login": "williamrandolph", "name": "William Brafford"}}, "url": "https://github.com/elastic/elasticsearch/commit/568e79db1b3e6567b77cefe8e7e6e50fb3a4948d", "committedDate": "2020-03-10T20:17:53Z", "message": "Add set-based API to NodesInfoRequest\n\nThis commit begins the work of removing the \"hard-coded\" metric getters\nand setters from the NodesInfoRequest classes. We start by providing new\nflexible getters and setters. We then update the test classes to remove\nthe old getters, and then remove those getters."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6fe9d71c21542eb279c8c994134fa325b44b0d09", "author": {"user": {"login": "williamrandolph", "name": "William Brafford"}}, "url": "https://github.com/elastic/elasticsearch/commit/6fe9d71c21542eb279c8c994134fa325b44b0d09", "committedDate": "2020-03-10T20:17:53Z", "message": "Protect against unknown metric names\n\nThrow an IllegalStateException if an unknown metric is added or removed.\n\nReplace some of the infrequently used setters."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a3035ff77ccb069a7d61e5f5efbce315160c6b74", "author": {"user": {"login": "williamrandolph", "name": "William Brafford"}}, "url": "https://github.com/elastic/elasticsearch/commit/a3035ff77ccb069a7d61e5f5efbce315160c6b74", "committedDate": "2020-03-10T20:17:53Z", "message": "Remove old getters and some magic strings"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4e5083dc625a56cc8d880a84b8d1d74e280c6f95", "author": {"user": {"login": "williamrandolph", "name": "William Brafford"}}, "url": "https://github.com/elastic/elasticsearch/commit/4e5083dc625a56cc8d880a84b8d1d74e280c6f95", "committedDate": "2020-03-10T20:17:53Z", "message": "Cleanup"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "aba731fc2e729b682f4405df2a59338506d6dddd", "author": {"user": {"login": "williamrandolph", "name": "William Brafford"}}, "url": "https://github.com/elastic/elasticsearch/commit/aba731fc2e729b682f4405df2a59338506d6dddd", "committedDate": "2020-03-10T20:17:53Z", "message": "Add test coverage"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "112679a5431e9bd1e3a8e3095568c591845d9790", "author": {"user": {"login": "williamrandolph", "name": "William Brafford"}}, "url": "https://github.com/elastic/elasticsearch/commit/112679a5431e9bd1e3a8e3095568c591845d9790", "committedDate": "2020-03-10T20:20:27Z", "message": "Singularize enum name"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9d001d1a3bcf3cdd0a6716e5b041301ac29a42a0", "author": {"user": {"login": "williamrandolph", "name": "William Brafford"}}, "url": "https://github.com/elastic/elasticsearch/commit/9d001d1a3bcf3cdd0a6716e5b041301ac29a42a0", "committedDate": "2020-03-10T20:32:27Z", "message": "Remove TODO comment"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f3baadaa2f5600e087f8966949e6041731894b63", "author": {"user": {"login": "williamrandolph", "name": "William Brafford"}}, "url": "https://github.com/elastic/elasticsearch/commit/f3baadaa2f5600e087f8966949e6041731894b63", "committedDate": "2020-03-10T20:49:53Z", "message": "Add an addMetrics(String...) method\n\nBased on some of the refactoring I'm doing, it seems like it's\nconvenient to be have an addMetrics(String ...) method.\n\nAlso add some more test coverage."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4c6c40d29d8b09fab0accc5375d8cc08b0a453a6", "author": {"user": {"login": "williamrandolph", "name": "William Brafford"}}, "url": "https://github.com/elastic/elasticsearch/commit/4c6c40d29d8b09fab0accc5375d8cc08b0a453a6", "committedDate": "2020-03-11T13:43:04Z", "message": "Add TODO for further work"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcyNzc5ODA3", "url": "https://github.com/elastic/elasticsearch/pull/53410#pullrequestreview-372779807", "createdAt": "2020-03-11T13:56:31Z", "commit": {"oid": "4c6c40d29d8b09fab0accc5375d8cc08b0a453a6"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMVQxMzo1NjozMVrOF03_BA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMVQxMzo1NjozMVrOF03_BA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDk4NzUyNA==", "bodyText": "This method is now only used for backwards-compatible deserialization, and doesn't need to be able to remove metrics anymore.", "url": "https://github.com/elastic/elasticsearch/pull/53410#discussion_r390987524", "createdAt": "2020-03-11T13:56:31Z", "author": {"login": "williamrandolph"}, "path": "server/src/main/java/org/elasticsearch/action/admin/cluster/node/info/NodesInfoRequest.java", "diffHunk": "@@ -84,174 +85,68 @@ public NodesInfoRequest clear() {\n      * Sets to return all the data.\n      */\n     public NodesInfoRequest all() {\n-        requestedMetrics.addAll(Metrics.allMetrics());\n+        requestedMetrics.addAll(Metric.allMetrics());\n         return this;\n     }\n \n     /**\n-     * Should the node settings be returned.\n+     * Get the names of requested metrics\n      */\n-    public boolean settings() {\n-        return Metrics.SETTINGS.containedIn(requestedMetrics);\n+    public Set<String> requestedMetrics() {\n+        return Set.copyOf(requestedMetrics);\n     }\n \n     /**\n-     * Should the node settings be returned.\n+     * Add metric\n      */\n-    public NodesInfoRequest settings(boolean settings) {\n-        addOrRemoveMetric(settings, Metrics.SETTINGS.metricName());\n-        return this;\n-    }\n-\n-    /**\n-     * Should the node OS be returned.\n-     */\n-    public boolean os() {\n-        return Metrics.OS.containedIn(requestedMetrics);\n-    }\n-\n-    /**\n-     * Should the node OS be returned.\n-     */\n-    public NodesInfoRequest os(boolean os) {\n-        addOrRemoveMetric(os, Metrics.OS.metricName());\n-        return this;\n-    }\n-\n-    /**\n-     * Should the node Process be returned.\n-     */\n-    public boolean process() {\n-        return Metrics.PROCESS.containedIn(requestedMetrics);\n-    }\n-\n-    /**\n-     * Should the node Process be returned.\n-     */\n-    public NodesInfoRequest process(boolean process) {\n-        addOrRemoveMetric(process, Metrics.PROCESS.metricName());\n-        return this;\n-    }\n-\n-    /**\n-     * Should the node JVM be returned.\n-     */\n-    public boolean jvm() {\n-        return Metrics.JVM.containedIn(requestedMetrics);\n-    }\n-\n-    /**\n-     * Should the node JVM be returned.\n-     */\n-    public NodesInfoRequest jvm(boolean jvm) {\n-        addOrRemoveMetric(jvm, Metrics.JVM.metricName());\n-        return this;\n-    }\n-\n-    /**\n-     * Should the node Thread Pool info be returned.\n-     */\n-    public boolean threadPool() {\n-        return Metrics.THREAD_POOL.containedIn(requestedMetrics);\n-    }\n-\n-    /**\n-     * Should the node Thread Pool info be returned.\n-     */\n-    public NodesInfoRequest threadPool(boolean threadPool) {\n-        addOrRemoveMetric(threadPool, Metrics.THREAD_POOL.metricName());\n-        return this;\n-    }\n-\n-    /**\n-     * Should the node Transport be returned.\n-     */\n-    public boolean transport() {\n-        return Metrics.TRANSPORT.containedIn(requestedMetrics);\n-    }\n-\n-    /**\n-     * Should the node Transport be returned.\n-     */\n-    public NodesInfoRequest transport(boolean transport) {\n-        addOrRemoveMetric(transport, Metrics.TRANSPORT.metricName());\n-        return this;\n-    }\n-\n-    /**\n-     * Should the node HTTP be returned.\n-     */\n-    public boolean http() {\n-        return Metrics.HTTP.containedIn(requestedMetrics);\n-    }\n-\n-    /**\n-     * Should the node HTTP be returned.\n-     */\n-    public NodesInfoRequest http(boolean http) {\n-        addOrRemoveMetric(http, Metrics.HTTP.metricName());\n+    public NodesInfoRequest addMetric(String metric) {\n+        if (Metric.allMetrics().contains(metric) == false) {\n+            throw new IllegalStateException(\"Used an illegal metric: \" + metric);\n+        }\n+        requestedMetrics.add(metric);\n         return this;\n     }\n \n     /**\n-     * Should information about plugins be returned\n-     * @param plugins true if you want info\n-     * @return The request\n+     * Add collection of metrics\n      */\n-    public NodesInfoRequest plugins(boolean plugins) {\n-        addOrRemoveMetric(plugins, Metrics.PLUGINS.metricName());\n+    public NodesInfoRequest addMetrics(Collection<String> metrics) {\n+        if (Metric.allMetrics().containsAll(metrics) == false) {\n+            throw new IllegalStateException(\"Used an illegal metric: \" + metrics);\n+        }\n+        requestedMetrics.addAll(metrics);\n         return this;\n     }\n \n     /**\n-     * @return true if information about plugins is requested\n+     * Add String array of metrics\n      */\n-    public boolean plugins() {\n-        return Metrics.PLUGINS.containedIn(requestedMetrics);\n-    }\n-\n-    /**\n-     * Should information about ingest be returned\n-     * @param ingest true if you want info\n-     */\n-    public NodesInfoRequest ingest(boolean ingest) {\n-        addOrRemoveMetric(ingest, Metrics.INGEST.metricName());\n+    public NodesInfoRequest addMetrics(String... metrics) {\n+        addMetrics(Arrays.stream(metrics).collect(Collectors.toSet()));\n         return this;\n     }\n \n     /**\n-     * @return true if information about ingest is requested\n+     * Remove metric\n      */\n-    public boolean ingest() {\n-        return Metrics.INGEST.containedIn(requestedMetrics);\n-    }\n-\n-    /**\n-     * Should information about indices (currently just indexing buffers) be returned\n-     * @param indices true if you want info\n-     */\n-    public NodesInfoRequest indices(boolean indices) {\n-        addOrRemoveMetric(indices, Metrics.INDICES.metricName());\n+    public NodesInfoRequest removeMetric(String metric) {\n+        if (Metric.allMetrics().contains(metric) == false) {\n+            throw new IllegalStateException(\"Used an illegal metric: \" + metric);\n+        }\n+        requestedMetrics.remove(metric);\n         return this;\n     }\n \n     /**\n-     * @return true if information about indices (currently just indexing buffers)\n-     */\n-    public boolean indices() {\n-        return Metrics.INDICES.containedIn(requestedMetrics);\n-    }\n-\n-    /**\n-     * Helper method for adding and removing metrics.\n-     * @param includeMetric Whether or not to include a metric.\n+     * Helper method for adding and removing metrics. Used when deserializing\n+     * a NodesInfoRequest from an ordered list of booleans.\n+     *\n+     * @param addMetric Whether or not to include a metric.\n      * @param metricName Name of the metric to include or remove.\n      */\n-    private void addOrRemoveMetric(boolean includeMetric, String metricName) {\n-        if (includeMetric) {\n+    private void optionallyAddMetric(boolean addMetric, String metricName) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4c6c40d29d8b09fab0accc5375d8cc08b0a453a6"}, "originalPosition": 242}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzczMjI4MTI3", "url": "https://github.com/elastic/elasticsearch/pull/53410#pullrequestreview-373228127", "createdAt": "2020-03-12T01:34:27Z", "commit": {"oid": "4c6c40d29d8b09fab0accc5375d8cc08b0a453a6"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMlQwMTozNDoyN1rOF1OoOA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMlQwMTozNDoyN1rOF1OoOA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTM1ODUyMA==", "bodyText": "Ah, this change leads to a bwc problem. I'm going to make a separate PR to handle the bwc aspects of this, for simplicity.", "url": "https://github.com/elastic/elasticsearch/pull/53410#discussion_r391358520", "createdAt": "2020-03-12T01:34:27Z", "author": {"login": "williamrandolph"}, "path": "server/src/main/java/org/elasticsearch/action/admin/cluster/node/info/NodesInfoRequest.java", "diffHunk": "@@ -281,12 +176,12 @@ public void writeTo(StreamOutput out) throws IOException {\n      * from the nodes information endpoint. Eventually this list list will be\n      * pluggable.\n      */\n-    enum Metrics {\n+    public enum Metric {\n         SETTINGS(\"settings\"),\n         OS(\"os\"),\n         PROCESS(\"process\"),\n         JVM(\"jvm\"),\n-        THREAD_POOL(\"threadPool\"),\n+        THREAD_POOL(\"thread_pool\"),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4c6c40d29d8b09fab0accc5375d8cc08b0a453a6"}, "originalPosition": 288}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzczODUwMDc2", "url": "https://github.com/elastic/elasticsearch/pull/53410#pullrequestreview-373850076", "createdAt": "2020-03-12T19:43:06Z", "commit": {"oid": "4c6c40d29d8b09fab0accc5375d8cc08b0a453a6"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMlQxOTo0MzowNlrOF1srFQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMlQxOTo0NDo1N1rOF1sufA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTg1MDc3Mw==", "bodyText": "Why do we need 2 variants of this method?", "url": "https://github.com/elastic/elasticsearch/pull/53410#discussion_r391850773", "createdAt": "2020-03-12T19:43:06Z", "author": {"login": "rjernst"}, "path": "server/src/main/java/org/elasticsearch/action/admin/cluster/node/info/NodesInfoRequest.java", "diffHunk": "@@ -84,174 +85,68 @@ public NodesInfoRequest clear() {\n      * Sets to return all the data.\n      */\n     public NodesInfoRequest all() {\n-        requestedMetrics.addAll(Metrics.allMetrics());\n+        requestedMetrics.addAll(Metric.allMetrics());\n         return this;\n     }\n \n     /**\n-     * Should the node settings be returned.\n+     * Get the names of requested metrics\n      */\n-    public boolean settings() {\n-        return Metrics.SETTINGS.containedIn(requestedMetrics);\n+    public Set<String> requestedMetrics() {\n+        return Set.copyOf(requestedMetrics);\n     }\n \n     /**\n-     * Should the node settings be returned.\n+     * Add metric\n      */\n-    public NodesInfoRequest settings(boolean settings) {\n-        addOrRemoveMetric(settings, Metrics.SETTINGS.metricName());\n-        return this;\n-    }\n-\n-    /**\n-     * Should the node OS be returned.\n-     */\n-    public boolean os() {\n-        return Metrics.OS.containedIn(requestedMetrics);\n-    }\n-\n-    /**\n-     * Should the node OS be returned.\n-     */\n-    public NodesInfoRequest os(boolean os) {\n-        addOrRemoveMetric(os, Metrics.OS.metricName());\n-        return this;\n-    }\n-\n-    /**\n-     * Should the node Process be returned.\n-     */\n-    public boolean process() {\n-        return Metrics.PROCESS.containedIn(requestedMetrics);\n-    }\n-\n-    /**\n-     * Should the node Process be returned.\n-     */\n-    public NodesInfoRequest process(boolean process) {\n-        addOrRemoveMetric(process, Metrics.PROCESS.metricName());\n-        return this;\n-    }\n-\n-    /**\n-     * Should the node JVM be returned.\n-     */\n-    public boolean jvm() {\n-        return Metrics.JVM.containedIn(requestedMetrics);\n-    }\n-\n-    /**\n-     * Should the node JVM be returned.\n-     */\n-    public NodesInfoRequest jvm(boolean jvm) {\n-        addOrRemoveMetric(jvm, Metrics.JVM.metricName());\n-        return this;\n-    }\n-\n-    /**\n-     * Should the node Thread Pool info be returned.\n-     */\n-    public boolean threadPool() {\n-        return Metrics.THREAD_POOL.containedIn(requestedMetrics);\n-    }\n-\n-    /**\n-     * Should the node Thread Pool info be returned.\n-     */\n-    public NodesInfoRequest threadPool(boolean threadPool) {\n-        addOrRemoveMetric(threadPool, Metrics.THREAD_POOL.metricName());\n-        return this;\n-    }\n-\n-    /**\n-     * Should the node Transport be returned.\n-     */\n-    public boolean transport() {\n-        return Metrics.TRANSPORT.containedIn(requestedMetrics);\n-    }\n-\n-    /**\n-     * Should the node Transport be returned.\n-     */\n-    public NodesInfoRequest transport(boolean transport) {\n-        addOrRemoveMetric(transport, Metrics.TRANSPORT.metricName());\n-        return this;\n-    }\n-\n-    /**\n-     * Should the node HTTP be returned.\n-     */\n-    public boolean http() {\n-        return Metrics.HTTP.containedIn(requestedMetrics);\n-    }\n-\n-    /**\n-     * Should the node HTTP be returned.\n-     */\n-    public NodesInfoRequest http(boolean http) {\n-        addOrRemoveMetric(http, Metrics.HTTP.metricName());\n+    public NodesInfoRequest addMetric(String metric) {\n+        if (Metric.allMetrics().contains(metric) == false) {\n+            throw new IllegalStateException(\"Used an illegal metric: \" + metric);\n+        }\n+        requestedMetrics.add(metric);\n         return this;\n     }\n \n     /**\n-     * Should information about plugins be returned\n-     * @param plugins true if you want info\n-     * @return The request\n+     * Add collection of metrics\n      */\n-    public NodesInfoRequest plugins(boolean plugins) {\n-        addOrRemoveMetric(plugins, Metrics.PLUGINS.metricName());\n+    public NodesInfoRequest addMetrics(Collection<String> metrics) {\n+        if (Metric.allMetrics().containsAll(metrics) == false) {\n+            throw new IllegalStateException(\"Used an illegal metric: \" + metrics);\n+        }\n+        requestedMetrics.addAll(metrics);\n         return this;\n     }\n \n     /**\n-     * @return true if information about plugins is requested\n+     * Add String array of metrics\n      */\n-    public boolean plugins() {\n-        return Metrics.PLUGINS.containedIn(requestedMetrics);\n-    }\n-\n-    /**\n-     * Should information about ingest be returned\n-     * @param ingest true if you want info\n-     */\n-    public NodesInfoRequest ingest(boolean ingest) {\n-        addOrRemoveMetric(ingest, Metrics.INGEST.metricName());\n+    public NodesInfoRequest addMetrics(String... metrics) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4c6c40d29d8b09fab0accc5375d8cc08b0a453a6"}, "originalPosition": 197}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTg1MTY0NA==", "bodyText": "Aren't unknown metrics an error case?", "url": "https://github.com/elastic/elasticsearch/pull/53410#discussion_r391851644", "createdAt": "2020-03-12T19:44:57Z", "author": {"login": "rjernst"}, "path": "server/src/main/java/org/elasticsearch/rest/action/admin/cluster/RestNodesInfoAction.java", "diffHunk": "@@ -108,16 +98,9 @@ static NodesInfoRequest prepareRequest(final RestRequest request) {\n             nodesInfoRequest.all();\n         } else {\n             nodesInfoRequest.clear();\n-            nodesInfoRequest.settings(metrics.contains(\"settings\"));\n-            nodesInfoRequest.os(metrics.contains(\"os\"));\n-            nodesInfoRequest.process(metrics.contains(\"process\"));\n-            nodesInfoRequest.jvm(metrics.contains(\"jvm\"));\n-            nodesInfoRequest.threadPool(metrics.contains(\"thread_pool\"));\n-            nodesInfoRequest.transport(metrics.contains(\"transport\"));\n-            nodesInfoRequest.http(metrics.contains(\"http\"));\n-            nodesInfoRequest.plugins(metrics.contains(\"plugins\"));\n-            nodesInfoRequest.ingest(metrics.contains(\"ingest\"));\n-            nodesInfoRequest.indices(metrics.contains(\"indices\"));\n+            // disregard unknown metrics", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4c6c40d29d8b09fab0accc5375d8cc08b0a453a6"}, "originalPosition": 33}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bffdfe667dbd17feb59f22402398bdb10f3a59d5", "author": {"user": {"login": "williamrandolph", "name": "William Brafford"}}, "url": "https://github.com/elastic/elasticsearch/commit/bffdfe667dbd17feb59f22402398bdb10f3a59d5", "committedDate": "2020-03-13T13:35:08Z", "message": "Merge branch 'master' into nodes-info-request-refactor-2"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "24f252b8f292331b0eecbea49b7584650a13a00e", "author": {"user": {"login": "williamrandolph", "name": "William Brafford"}}, "url": "https://github.com/elastic/elasticsearch/commit/24f252b8f292331b0eecbea49b7584650a13a00e", "committedDate": "2020-03-13T13:45:04Z", "message": "Remove redundant convenience method"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc0NTI1Nzgx", "url": "https://github.com/elastic/elasticsearch/pull/53410#pullrequestreview-374525781", "createdAt": "2020-03-13T18:31:01Z", "commit": {"oid": "24f252b8f292331b0eecbea49b7584650a13a00e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xM1QxODozMTowMVrOF2OUkQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xM1QxODozMTowMVrOF2OUkQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjQwMjA2NQ==", "bodyText": "I liked having the variatic version. Is there a reason we need a collection version? It would make it easier to read in the rest of the code if the Set building part was isolated to the internals of this method.", "url": "https://github.com/elastic/elasticsearch/pull/53410#discussion_r392402065", "createdAt": "2020-03-13T18:31:01Z", "author": {"login": "rjernst"}, "path": "server/src/main/java/org/elasticsearch/action/admin/cluster/node/info/NodesInfoRequest.java", "diffHunk": "@@ -84,174 +85,60 @@ public NodesInfoRequest clear() {\n      * Sets to return all the data.\n      */\n     public NodesInfoRequest all() {\n-        requestedMetrics.addAll(Metrics.allMetrics());\n+        requestedMetrics.addAll(Metric.allMetrics());\n         return this;\n     }\n \n     /**\n-     * Should the node settings be returned.\n+     * Get the names of requested metrics\n      */\n-    public boolean settings() {\n-        return Metrics.SETTINGS.containedIn(requestedMetrics);\n+    public Set<String> requestedMetrics() {\n+        return Set.copyOf(requestedMetrics);\n     }\n \n     /**\n-     * Should the node settings be returned.\n+     * Add metric\n      */\n-    public NodesInfoRequest settings(boolean settings) {\n-        addOrRemoveMetric(settings, Metrics.SETTINGS.metricName());\n-        return this;\n-    }\n-\n-    /**\n-     * Should the node OS be returned.\n-     */\n-    public boolean os() {\n-        return Metrics.OS.containedIn(requestedMetrics);\n-    }\n-\n-    /**\n-     * Should the node OS be returned.\n-     */\n-    public NodesInfoRequest os(boolean os) {\n-        addOrRemoveMetric(os, Metrics.OS.metricName());\n-        return this;\n-    }\n-\n-    /**\n-     * Should the node Process be returned.\n-     */\n-    public boolean process() {\n-        return Metrics.PROCESS.containedIn(requestedMetrics);\n-    }\n-\n-    /**\n-     * Should the node Process be returned.\n-     */\n-    public NodesInfoRequest process(boolean process) {\n-        addOrRemoveMetric(process, Metrics.PROCESS.metricName());\n-        return this;\n-    }\n-\n-    /**\n-     * Should the node JVM be returned.\n-     */\n-    public boolean jvm() {\n-        return Metrics.JVM.containedIn(requestedMetrics);\n-    }\n-\n-    /**\n-     * Should the node JVM be returned.\n-     */\n-    public NodesInfoRequest jvm(boolean jvm) {\n-        addOrRemoveMetric(jvm, Metrics.JVM.metricName());\n-        return this;\n-    }\n-\n-    /**\n-     * Should the node Thread Pool info be returned.\n-     */\n-    public boolean threadPool() {\n-        return Metrics.THREAD_POOL.containedIn(requestedMetrics);\n-    }\n-\n-    /**\n-     * Should the node Thread Pool info be returned.\n-     */\n-    public NodesInfoRequest threadPool(boolean threadPool) {\n-        addOrRemoveMetric(threadPool, Metrics.THREAD_POOL.metricName());\n-        return this;\n-    }\n-\n-    /**\n-     * Should the node Transport be returned.\n-     */\n-    public boolean transport() {\n-        return Metrics.TRANSPORT.containedIn(requestedMetrics);\n-    }\n-\n-    /**\n-     * Should the node Transport be returned.\n-     */\n-    public NodesInfoRequest transport(boolean transport) {\n-        addOrRemoveMetric(transport, Metrics.TRANSPORT.metricName());\n-        return this;\n-    }\n-\n-    /**\n-     * Should the node HTTP be returned.\n-     */\n-    public boolean http() {\n-        return Metrics.HTTP.containedIn(requestedMetrics);\n-    }\n-\n-    /**\n-     * Should the node HTTP be returned.\n-     */\n-    public NodesInfoRequest http(boolean http) {\n-        addOrRemoveMetric(http, Metrics.HTTP.metricName());\n-        return this;\n-    }\n-\n-    /**\n-     * Should information about plugins be returned\n-     * @param plugins true if you want info\n-     * @return The request\n-     */\n-    public NodesInfoRequest plugins(boolean plugins) {\n-        addOrRemoveMetric(plugins, Metrics.PLUGINS.metricName());\n+    public NodesInfoRequest addMetric(String metric) {\n+        if (Metric.allMetrics().contains(metric) == false) {\n+            throw new IllegalStateException(\"Used an illegal metric: \" + metric);\n+        }\n+        requestedMetrics.add(metric);\n         return this;\n     }\n \n     /**\n-     * @return true if information about plugins is requested\n-     */\n-    public boolean plugins() {\n-        return Metrics.PLUGINS.containedIn(requestedMetrics);\n-    }\n-\n-    /**\n-     * Should information about ingest be returned\n-     * @param ingest true if you want info\n+     * Add collection of metrics\n      */\n-    public NodesInfoRequest ingest(boolean ingest) {\n-        addOrRemoveMetric(ingest, Metrics.INGEST.metricName());\n+    public NodesInfoRequest addMetrics(Collection<String> metrics) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "24f252b8f292331b0eecbea49b7584650a13a00e"}, "originalPosition": 191}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c8780fdc001683746b6544edff42f921f5f325cb", "author": {"user": {"login": "williamrandolph", "name": "William Brafford"}}, "url": "https://github.com/elastic/elasticsearch/commit/c8780fdc001683746b6544edff42f921f5f325cb", "committedDate": "2020-03-16T16:58:04Z", "message": "Make setter variatic instead of set-based"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc1NDE2MTAw", "url": "https://github.com/elastic/elasticsearch/pull/53410#pullrequestreview-375416100", "createdAt": "2020-03-16T17:05:05Z", "commit": {"oid": "c8780fdc001683746b6544edff42f921f5f325cb"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNlQxNzowNTowNVrOF29u_w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNlQxNzowNTowNVrOF29u_w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzE3ODg3OQ==", "bodyText": "TODO: Fix javadoc for accuracy", "url": "https://github.com/elastic/elasticsearch/pull/53410#discussion_r393178879", "createdAt": "2020-03-16T17:05:05Z", "author": {"login": "williamrandolph"}, "path": "server/src/main/java/org/elasticsearch/action/admin/cluster/node/info/NodesInfoRequest.java", "diffHunk": "@@ -84,174 +88,70 @@ public NodesInfoRequest clear() {\n      * Sets to return all the data.\n      */\n     public NodesInfoRequest all() {\n-        requestedMetrics.addAll(Metrics.allMetrics());\n+        requestedMetrics.addAll(Metric.allMetrics());\n         return this;\n     }\n \n     /**\n-     * Should the node settings be returned.\n+     * Get the names of requested metrics\n      */\n-    public boolean settings() {\n-        return Metrics.SETTINGS.containedIn(requestedMetrics);\n+    public Set<String> requestedMetrics() {\n+        return Set.copyOf(requestedMetrics);\n     }\n \n     /**\n-     * Should the node settings be returned.\n+     * Add metric\n      */\n-    public NodesInfoRequest settings(boolean settings) {\n-        addOrRemoveMetric(settings, Metrics.SETTINGS.metricName());\n-        return this;\n-    }\n-\n-    /**\n-     * Should the node OS be returned.\n-     */\n-    public boolean os() {\n-        return Metrics.OS.containedIn(requestedMetrics);\n-    }\n-\n-    /**\n-     * Should the node OS be returned.\n-     */\n-    public NodesInfoRequest os(boolean os) {\n-        addOrRemoveMetric(os, Metrics.OS.metricName());\n-        return this;\n-    }\n-\n-    /**\n-     * Should the node Process be returned.\n-     */\n-    public boolean process() {\n-        return Metrics.PROCESS.containedIn(requestedMetrics);\n-    }\n-\n-    /**\n-     * Should the node Process be returned.\n-     */\n-    public NodesInfoRequest process(boolean process) {\n-        addOrRemoveMetric(process, Metrics.PROCESS.metricName());\n-        return this;\n-    }\n-\n-    /**\n-     * Should the node JVM be returned.\n-     */\n-    public boolean jvm() {\n-        return Metrics.JVM.containedIn(requestedMetrics);\n-    }\n-\n-    /**\n-     * Should the node JVM be returned.\n-     */\n-    public NodesInfoRequest jvm(boolean jvm) {\n-        addOrRemoveMetric(jvm, Metrics.JVM.metricName());\n-        return this;\n-    }\n-\n-    /**\n-     * Should the node Thread Pool info be returned.\n-     */\n-    public boolean threadPool() {\n-        return Metrics.THREAD_POOL.containedIn(requestedMetrics);\n-    }\n-\n-    /**\n-     * Should the node Thread Pool info be returned.\n-     */\n-    public NodesInfoRequest threadPool(boolean threadPool) {\n-        addOrRemoveMetric(threadPool, Metrics.THREAD_POOL.metricName());\n-        return this;\n-    }\n-\n-    /**\n-     * Should the node Transport be returned.\n-     */\n-    public boolean transport() {\n-        return Metrics.TRANSPORT.containedIn(requestedMetrics);\n-    }\n-\n-    /**\n-     * Should the node Transport be returned.\n-     */\n-    public NodesInfoRequest transport(boolean transport) {\n-        addOrRemoveMetric(transport, Metrics.TRANSPORT.metricName());\n-        return this;\n-    }\n-\n-    /**\n-     * Should the node HTTP be returned.\n-     */\n-    public boolean http() {\n-        return Metrics.HTTP.containedIn(requestedMetrics);\n-    }\n-\n-    /**\n-     * Should the node HTTP be returned.\n-     */\n-    public NodesInfoRequest http(boolean http) {\n-        addOrRemoveMetric(http, Metrics.HTTP.metricName());\n-        return this;\n-    }\n-\n-    /**\n-     * Should information about plugins be returned\n-     * @param plugins true if you want info\n-     * @return The request\n-     */\n-    public NodesInfoRequest plugins(boolean plugins) {\n-        addOrRemoveMetric(plugins, Metrics.PLUGINS.metricName());\n+    public NodesInfoRequest addMetric(String metric) {\n+        if (Metric.allMetrics().contains(metric) == false) {\n+            throw new IllegalStateException(\"Used an illegal metric: \" + metric);\n+        }\n+        requestedMetrics.add(metric);\n         return this;\n     }\n \n     /**\n-     * @return true if information about plugins is requested\n-     */\n-    public boolean plugins() {\n-        return Metrics.PLUGINS.containedIn(requestedMetrics);\n-    }\n-\n-    /**\n-     * Should information about ingest be returned\n-     * @param ingest true if you want info\n+     * Add collection of metrics", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c8780fdc001683746b6544edff42f921f5f325cb"}, "originalPosition": 191}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d3665f95c6d7a37e3d0246b6c9d577264a56ddd3", "author": {"user": {"login": "williamrandolph", "name": "William Brafford"}}, "url": "https://github.com/elastic/elasticsearch/commit/d3665f95c6d7a37e3d0246b6c9d577264a56ddd3", "committedDate": "2020-03-16T18:16:27Z", "message": "Fixup comments and imports"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2f7d1c14769689c188b796caeee3f5a90c1365bc", "author": {"user": {"login": "williamrandolph", "name": "William Brafford"}}, "url": "https://github.com/elastic/elasticsearch/commit/2f7d1c14769689c188b796caeee3f5a90c1365bc", "committedDate": "2020-03-16T19:43:40Z", "message": "Merge branch 'master' into nodes-info-request-refactor-2"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "43e8bbe4200273ff8290ba717edee618983b3d01", "author": {"user": {"login": "williamrandolph", "name": "William Brafford"}}, "url": "https://github.com/elastic/elasticsearch/commit/43e8bbe4200273ff8290ba717edee618983b3d01", "committedDate": "2020-03-16T22:24:53Z", "message": "Merge branch 'master' into nodes-info-request-refactor-2"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e3b13906cfcd46a945d451bd7c19005249e89e23", "author": {"user": {"login": "williamrandolph", "name": "William Brafford"}}, "url": "https://github.com/elastic/elasticsearch/commit/e3b13906cfcd46a945d451bd7c19005249e89e23", "committedDate": "2020-03-23T22:03:50Z", "message": "Merge branch 'master' into nodes-info-request-refactor-2"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgwNjg3OTI5", "url": "https://github.com/elastic/elasticsearch/pull/53410#pullrequestreview-380687929", "createdAt": "2020-03-24T20:53:27Z", "commit": {"oid": "e3b13906cfcd46a945d451bd7c19005249e89e23"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQyMDo1MzoyN1rOF7Cp9Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQyMDo1MzoyN1rOF7Cp9Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzQ1MzgxMw==", "bodyText": "This can be simplified in the same way I suggested in the response PR?", "url": "https://github.com/elastic/elasticsearch/pull/53410#discussion_r397453813", "createdAt": "2020-03-24T20:53:27Z", "author": {"login": "rjernst"}, "path": "server/src/main/java/org/elasticsearch/action/admin/cluster/node/info/NodesInfoRequest.java", "diffHunk": "@@ -84,174 +87,70 @@ public NodesInfoRequest clear() {\n      * Sets to return all the data.\n      */\n     public NodesInfoRequest all() {\n-        requestedMetrics.addAll(Metrics.allMetrics());\n+        requestedMetrics.addAll(Metric.allMetrics());\n         return this;\n     }\n \n     /**\n-     * Should the node settings be returned.\n+     * Get the names of requested metrics\n      */\n-    public boolean settings() {\n-        return Metrics.SETTINGS.containedIn(requestedMetrics);\n+    public Set<String> requestedMetrics() {\n+        return Set.copyOf(requestedMetrics);\n     }\n \n     /**\n-     * Should the node settings be returned.\n+     * Add metric\n      */\n-    public NodesInfoRequest settings(boolean settings) {\n-        addOrRemoveMetric(settings, Metrics.SETTINGS.metricName());\n-        return this;\n-    }\n-\n-    /**\n-     * Should the node OS be returned.\n-     */\n-    public boolean os() {\n-        return Metrics.OS.containedIn(requestedMetrics);\n-    }\n-\n-    /**\n-     * Should the node OS be returned.\n-     */\n-    public NodesInfoRequest os(boolean os) {\n-        addOrRemoveMetric(os, Metrics.OS.metricName());\n-        return this;\n-    }\n-\n-    /**\n-     * Should the node Process be returned.\n-     */\n-    public boolean process() {\n-        return Metrics.PROCESS.containedIn(requestedMetrics);\n-    }\n-\n-    /**\n-     * Should the node Process be returned.\n-     */\n-    public NodesInfoRequest process(boolean process) {\n-        addOrRemoveMetric(process, Metrics.PROCESS.metricName());\n-        return this;\n-    }\n-\n-    /**\n-     * Should the node JVM be returned.\n-     */\n-    public boolean jvm() {\n-        return Metrics.JVM.containedIn(requestedMetrics);\n-    }\n-\n-    /**\n-     * Should the node JVM be returned.\n-     */\n-    public NodesInfoRequest jvm(boolean jvm) {\n-        addOrRemoveMetric(jvm, Metrics.JVM.metricName());\n-        return this;\n-    }\n-\n-    /**\n-     * Should the node Thread Pool info be returned.\n-     */\n-    public boolean threadPool() {\n-        return Metrics.THREAD_POOL.containedIn(requestedMetrics);\n-    }\n-\n-    /**\n-     * Should the node Thread Pool info be returned.\n-     */\n-    public NodesInfoRequest threadPool(boolean threadPool) {\n-        addOrRemoveMetric(threadPool, Metrics.THREAD_POOL.metricName());\n-        return this;\n-    }\n-\n-    /**\n-     * Should the node Transport be returned.\n-     */\n-    public boolean transport() {\n-        return Metrics.TRANSPORT.containedIn(requestedMetrics);\n-    }\n-\n-    /**\n-     * Should the node Transport be returned.\n-     */\n-    public NodesInfoRequest transport(boolean transport) {\n-        addOrRemoveMetric(transport, Metrics.TRANSPORT.metricName());\n-        return this;\n-    }\n-\n-    /**\n-     * Should the node HTTP be returned.\n-     */\n-    public boolean http() {\n-        return Metrics.HTTP.containedIn(requestedMetrics);\n-    }\n-\n-    /**\n-     * Should the node HTTP be returned.\n-     */\n-    public NodesInfoRequest http(boolean http) {\n-        addOrRemoveMetric(http, Metrics.HTTP.metricName());\n-        return this;\n-    }\n-\n-    /**\n-     * Should information about plugins be returned\n-     * @param plugins true if you want info\n-     * @return The request\n-     */\n-    public NodesInfoRequest plugins(boolean plugins) {\n-        addOrRemoveMetric(plugins, Metrics.PLUGINS.metricName());\n+    public NodesInfoRequest addMetric(String metric) {\n+        if (Metric.allMetrics().contains(metric) == false) {\n+            throw new IllegalStateException(\"Used an illegal metric: \" + metric);\n+        }\n+        requestedMetrics.add(metric);\n         return this;\n     }\n \n     /**\n-     * @return true if information about plugins is requested\n-     */\n-    public boolean plugins() {\n-        return Metrics.PLUGINS.containedIn(requestedMetrics);\n-    }\n-\n-    /**\n-     * Should information about ingest be returned\n-     * @param ingest true if you want info\n+     * Add multiple metrics\n      */\n-    public NodesInfoRequest ingest(boolean ingest) {\n-        addOrRemoveMetric(ingest, Metrics.INGEST.metricName());\n+    public NodesInfoRequest addMetrics(String... metrics) {\n+        SortedSet<String> illegalMetrics = new TreeSet<>();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e3b13906cfcd46a945d451bd7c19005249e89e23"}, "originalPosition": 195}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "984d9857b293643c366fe781563fac17d4b7367a", "author": {"user": {"login": "williamrandolph", "name": "William Brafford"}}, "url": "https://github.com/elastic/elasticsearch/commit/984d9857b293643c366fe781563fac17d4b7367a", "committedDate": "2020-03-25T00:59:13Z", "message": "Merge branch 'master' into nodes-info-request-refactor-2"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "824e5715eea170f3a5e3e67c2f11a076a2044dec", "author": {"user": {"login": "williamrandolph", "name": "William Brafford"}}, "url": "https://github.com/elastic/elasticsearch/commit/824e5715eea170f3a5e3e67c2f11a076a2044dec", "committedDate": "2020-03-25T01:06:23Z", "message": "Streamline set-checking logic"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "014385cb49ed787884b7d756459c9b00385c7174", "author": {"user": {"login": "williamrandolph", "name": "William Brafford"}}, "url": "https://github.com/elastic/elasticsearch/commit/014385cb49ed787884b7d756459c9b00385c7174", "committedDate": "2020-03-25T02:09:40Z", "message": "Remove unused import"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "20cccb9e2db6a9cae0913669366c63c48169b641", "author": {"user": {"login": "williamrandolph", "name": "William Brafford"}}, "url": "https://github.com/elastic/elasticsearch/commit/20cccb9e2db6a9cae0913669366c63c48169b641", "committedDate": "2020-03-25T03:04:22Z", "message": "Merge branch 'master' into nodes-info-request-refactor-2"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "73ff77644bbf2773d83bdfe851eca3e1f2624b72", "author": {"user": {"login": "williamrandolph", "name": "William Brafford"}}, "url": "https://github.com/elastic/elasticsearch/commit/73ff77644bbf2773d83bdfe851eca3e1f2624b72", "committedDate": "2020-03-25T12:58:05Z", "message": "Merge branch 'master' into nodes-info-request-refactor-2"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1471, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}