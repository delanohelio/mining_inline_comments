{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY1NDg5MzMw", "number": 51269, "title": "Add host address to BindTransportException message", "bodyText": "When bind fails, show the host address in addition to the port. This\nhelps debugging cases with wrong \"network.host\" values.\nCloses #48001", "createdAt": "2020-01-21T20:12:36Z", "url": "https://github.com/elastic/elasticsearch/pull/51269", "merged": true, "mergeCommit": {"oid": "84dd9dc9c03d85dd08fdaa67ce78c71511e7a01d"}, "closed": true, "closedAt": "2020-02-04T08:48:14Z", "author": {"login": "mariaral"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb8mmkHAH2gAyMzY1NDg5MzMwOjA3YTBiNWJlZjhmNDcwYzNhOTcwODVkNGRiYTg4YzRmMTk2MjZiMDc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcAwYiyAFqTM1MjQyOTQwNA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "07a0b5bef8f470c3a97085d4dba88c4f19626b07", "author": {"user": {"login": "mariaral", "name": "Maria Ralli"}}, "url": "https://github.com/elastic/elasticsearch/commit/07a0b5bef8f470c3a97085d4dba88c4f19626b07", "committedDate": "2020-01-21T19:48:54Z", "message": "Add host address to BindTransportException message\n\nWhen bind fails, show the host address in addition to the port. This\nhelps debugging cases with wrong \"network.host\" values.\n\nCloses #48001"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ2NDI0OTI2", "url": "https://github.com/elastic/elasticsearch/pull/51269#pullrequestreview-346424926", "createdAt": "2020-01-22T08:55:25Z", "commit": {"oid": "07a0b5bef8f470c3a97085d4dba88c4f19626b07"}, "state": "DISMISSED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMlQwODo1NToyNVrOFgUddA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMlQwODo1NToyNVrOFgUddA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTQzMzk3Mg==", "bodyText": "This is failing forbidden APIs checks, see the logs:\nForbidden method invocation: java.net.InetAddress#getHostAddress() [use NetworkAddress format/formatAddress to print IP or IP+ports]\n  in org.elasticsearch.transport.TcpTransport (TcpTransport.java:381)\nForbidden method invocation: java.net.InetAddress#getHostAddress() [use NetworkAddress format/formatAddress to print IP or IP+ports]\n  in org.elasticsearch.http.AbstractHttpServerTransport (AbstractHttpServerTransport.java:178)\nScanned 5715 class file(s) for forbidden API invocations (in 5.20s), 2 error(s).", "url": "https://github.com/elastic/elasticsearch/pull/51269#discussion_r369433972", "createdAt": "2020-01-22T08:55:25Z", "author": {"login": "original-brownbear"}, "path": "server/src/main/java/org/elasticsearch/http/AbstractHttpServerTransport.java", "diffHunk": "@@ -174,7 +174,10 @@ private TransportAddress bindAddress(final InetAddress hostAddress) {\n             return true;\n         });\n         if (!success) {\n-            throw new BindHttpException(\"Failed to bind to [\" + port.getPortRangeString() + \"]\", lastException.get());\n+            throw new BindHttpException(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "07a0b5bef8f470c3a97085d4dba88c4f19626b07"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "52705b587c220f6643932ccedcc1f1ab7b3eee3b", "author": {"user": {"login": "mariaral", "name": "Maria Ralli"}}, "url": "https://github.com/elastic/elasticsearch/commit/52705b587c220f6643932ccedcc1f1ab7b3eee3b", "committedDate": "2020-01-23T19:29:15Z", "message": "Extend NetworkAddress.format() to handle port ranges\n\nExtend NetworkAddress.format() to handle port ranges and use this\nutility method instead of forbidden InetAddress.getHostAddress()."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ5Mzc2ODU0", "url": "https://github.com/elastic/elasticsearch/pull/51269#pullrequestreview-349376854", "createdAt": "2020-01-28T13:36:42Z", "commit": {"oid": "52705b587c220f6643932ccedcc1f1ab7b3eee3b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQxMzozNjo0MlrOFilLDw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQxMzozNjo0MlrOFilLDw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTgwNDk0Mw==", "bodyText": "Please would you add a test case to NetworkAddressTests for this new behaviour?", "url": "https://github.com/elastic/elasticsearch/pull/51269#discussion_r371804943", "createdAt": "2020-01-28T13:36:42Z", "author": {"login": "DaveCTurner"}, "path": "server/src/main/java/org/elasticsearch/common/network/NetworkAddress.java", "diffHunk": "@@ -88,21 +90,64 @@ public static String format(InetSocketAddress address) {\n         return format(address.getAddress(), address.getPort());\n     }\n \n-    // note, we don't validate port, because we only allow InetSocketAddress\n-    static String format(InetAddress address, int port) {\n+    /**\n+     * Formats a network address and port for display purposes.\n+     * <p>\n+     * This formats the address with {@link #format(InetAddress)}\n+     * and appends the port number. IPv6 addresses will be bracketed.\n+     * Any host information, if present is ignored.\n+     * <p>\n+     * Example output:\n+     * <ul>\n+     *   <li>IPv4: {@code 127.0.0.1:9300}</li>\n+     *   <li>IPv6: {@code [::1]:9300}</li>\n+     * </ul>\n+     * @param address IPv4 or IPv6 address\n+     * @param port port\n+     * @return formatted string\n+     */\n+    public static String format(InetAddress address, int port) {\n+        return format(address, new PortsRange(String.valueOf(port)));\n+    }\n+\n+    /**\n+     * Formats a network address and port range for display purposes.\n+     * <p>\n+     * This formats the address with {@link #format(InetAddress)}\n+     * and appends the port range in brackets. In case there is only one\n+     * port, the result is the same with {@link #format(InetAddress, int)}.\n+     * <p>\n+     * Example output:\n+     * <ul>\n+     *   <li>IPv4 no port: {@code 127.0.0.1}</li>\n+     *   <li>IPv4 single port: {@code 127.0.0.1:9300}</li>\n+     *   <li>IPv4 multiple ports: {@code 127.0.0.1:[9300-9400]}</li>\n+     *   <li>IPv6 multiple ports: {@code [::1]:[9300-9400]}</li>\n+     * </ul>\n+     * @param address IPv4 or IPv6 address\n+     * @param portsRange range of ports\n+     * @return formatted string\n+     */\n+    public static String format(InetAddress address, PortsRange portsRange) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "52705b587c220f6643932ccedcc1f1ab7b3eee3b"}, "originalPosition": 62}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "57fe01934c582d778c1d5dd43a10fead438f9fa2", "author": {"user": {"login": "elasticmachine", "name": "Elastic Machine"}}, "url": "https://github.com/elastic/elasticsearch/commit/57fe01934c582d778c1d5dd43a10fead438f9fa2", "committedDate": "2020-01-28T13:57:16Z", "message": "Merge branch 'master' into feature-bind-host"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c01ad2b15054dea44fe6c44f0f12bb25e2e8d362", "author": {"user": {"login": "mariaral", "name": "Maria Ralli"}}, "url": "https://github.com/elastic/elasticsearch/commit/c01ad2b15054dea44fe6c44f0f12bb25e2e8d362", "committedDate": "2020-01-28T22:53:10Z", "message": "Test NetworkAddress.format() with PortsRange"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4405e4ecddac4fce2221e4eeb9ab575b267d0442", "author": {"user": {"login": "elasticmachine", "name": "Elastic Machine"}}, "url": "https://github.com/elastic/elasticsearch/commit/4405e4ecddac4fce2221e4eeb9ab575b267d0442", "committedDate": "2020-02-03T15:14:25Z", "message": "Merge branch 'master' into feature-bind-host"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUyNDI5NDA0", "url": "https://github.com/elastic/elasticsearch/pull/51269#pullrequestreview-352429404", "createdAt": "2020-02-03T17:28:20Z", "commit": {"oid": "4405e4ecddac4fce2221e4eeb9ab575b267d0442"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2805, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}