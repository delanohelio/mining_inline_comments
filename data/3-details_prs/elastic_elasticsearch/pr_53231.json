{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg0ODk0ODE2", "number": 53231, "title": "Fix potential NPE in FuzzyTermsEnum", "bodyText": "Under certain circumstances SpanMultiTermQueryWrapper uses\nSpanBooleanQueryRewriteWithMaxClause as its rewrite method, which in turn tries\nto get a TermsEnum from the wrapped MultiTermQuery currently using a null\nAttributeSource. While queries TermsQuery or subclasses of AutomatonQuery ignore\nthis argument, FuzzyQuery uses it to create a FuzzyTermsEnum which triggers an\nNPE when the AttributeSource is not provided. This PR fixes this by supplying an\nempty AttributeSource instead of a null value.\nCloses #52894", "createdAt": "2020-03-06T15:56:46Z", "url": "https://github.com/elastic/elasticsearch/pull/53231", "merged": true, "mergeCommit": {"oid": "649a22803d5e6cd73f6016824c71c48093ffb021"}, "closed": true, "closedAt": "2020-03-09T11:16:10Z", "author": {"login": "cbuescher"}, "timelineItems": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcLCO5kAH2gAyMzg0ODk0ODE2OmZkNTY4N2JhMTU0Y2M4NGRiMTZiOWJhYWMwNzMxZDZjNmZjNzhjYzY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcL7E3pAH2gAyMzg0ODk0ODE2OjQwOGFlNjA3MjI0MDI1ZjcyYjBmMGZhNWM2NjZiZjJkZWIzN2ZmYzY=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "fd5687ba154cc84db16b9baac0731d6c6fc78cc6", "author": {"user": {"login": "cbuescher", "name": "Christoph B\u00fcscher"}}, "url": "https://github.com/elastic/elasticsearch/commit/fd5687ba154cc84db16b9baac0731d6c6fc78cc6", "committedDate": "2020-03-06T15:55:20Z", "message": "Fix potential NPE in FuzzyTermsEnum\n\nUnder certain circumstances SpanMultiTermQueryWrapper uses\nSpanBooleanQueryRewriteWithMaxClause as its rewrite method, which in turn tries\nto get a TermsEnum from the wrapped MultiTermQuery currently using a `null`\nAttributeSource. While queries TermsQuery or subclasses of AutomatonQuery ignore\nthis argument, FuzzyQuery uses it to create a FuzzyTermsEnum which triggers an\nNPE when the AttributeSource is not provided. This PR fixes this by supplying an\nempty AttributeSource instead of a `null` value.\n\nCloses #52894"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcwNjQ5MDYy", "url": "https://github.com/elastic/elasticsearch/pull/53231#pullrequestreview-370649062", "createdAt": "2020-03-06T21:51:59Z", "commit": {"oid": "fd5687ba154cc84db16b9baac0731d6c6fc78cc6"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNlQyMTo1MTo1OVrOFzIkCA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNlQyMTo1MTo1OVrOFzIkCA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTE2MTk5Mg==", "bodyText": "Can you change to a more descriptive name ? I don't think we should add a link to an issue in the comment either. This test checks that span_fuzzy query are correctly handled and #52894 revealed that it was missing.", "url": "https://github.com/elastic/elasticsearch/pull/53231#discussion_r389161992", "createdAt": "2020-03-06T21:51:59Z", "author": {"login": "jimczi"}, "path": "server/src/test/java/org/elasticsearch/search/query/SearchQueryIT.java", "diffHunk": "@@ -1758,4 +1761,19 @@ public void testFieldAliasesForMetaFields() throws Exception {\n        }\n \n    }\n+\n+    /**\n+     * Test fix for NPE from {@link SpanBooleanQueryRewriteWithMaxClause#rewrite(IndexReader, MultiTermQuery)}.\n+     * See https://github.com/elastic/elasticsearch/issues/52894 for details\n+     */\n+    public void testIssue52894() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fd5687ba154cc84db16b9baac0731d6c6fc78cc6"}, "originalPosition": 26}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "408ae607224025f72b0f0fa5c666bf2deb37ffc6", "author": {"user": {"login": "cbuescher", "name": "Christoph B\u00fcscher"}}, "url": "https://github.com/elastic/elasticsearch/commit/408ae607224025f72b0f0fa5c666bf2deb37ffc6", "committedDate": "2020-03-09T10:08:58Z", "message": "change test name and description"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1846, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}