{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTExNDc3NDE5", "number": 64274, "title": "Make ES files inside Docker container world readable", "bodyText": "Running the Elasticsearch Docker image with a different GID is possible but trappy, since at present all the ES files are only readable by the user and group. This PR documents a Docker CLI flag that fixes this situation, by ensuring the container user is added to the default group (which is root, GID 0).\nI also added a test for this case, and refactored the Docker tests to use a builder pattern for constructing the docker run command. The existing code was becoming unwieldy and hard to change.", "createdAt": "2020-10-28T11:31:15Z", "url": "https://github.com/elastic/elasticsearch/pull/64274", "merged": true, "mergeCommit": {"oid": "a32a0986c35ba7e971ff376abb6539892b2b1470"}, "closed": true, "closedAt": "2020-10-30T13:26:45Z", "author": {"login": "pugnascotia"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdWrGgyAH2gAyNTExNDc3NDE5OjA5YWEwN2FhZmQ4ZDRiZjlhZGY3Yjc4MGM0MDU4ZjA2NWIyMTIyYTA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdXZBTygFqTUyMDEwMDg3Ng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "09aa07aafd8d4bf9adf7b780c4058f065b2122a0", "author": {"user": {"login": "pugnascotia", "name": "Rory Hunter"}}, "url": "https://github.com/elastic/elasticsearch/commit/09aa07aafd8d4bf9adf7b780c4058f065b2122a0", "committedDate": "2020-10-27T15:56:36Z", "message": "Allow regular files in Docker images to be world-readable"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a779e90f437f21b89380d0883b163dac2b794371", "author": {"user": {"login": "pugnascotia", "name": "Rory Hunter"}}, "url": "https://github.com/elastic/elasticsearch/commit/a779e90f437f21b89380d0883b163dac2b794371", "committedDate": "2020-10-27T16:12:37Z", "message": "Document how to run ES in Docker with a custom UID + GID"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "901f13c53bf8e5c3d11fe387bb09349a10573fb9", "author": {"user": {"login": "pugnascotia", "name": "Rory Hunter"}}, "url": "https://github.com/elastic/elasticsearch/commit/901f13c53bf8e5c3d11fe387bb09349a10573fb9", "committedDate": "2020-10-28T11:11:53Z", "message": "Simplify docs, add test for --group-add\n\nAlso refactor how we construct the `docker run` command into a builder\nobject, since the code was better unwieldly and I couldn't easy add\narbitrary docker CLI arguments."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e65421f1c2d50521918429b4ca72fb8e658aebde", "author": {"user": {"login": "pugnascotia", "name": "Rory Hunter"}}, "url": "https://github.com/elastic/elasticsearch/commit/e65421f1c2d50521918429b4ca72fb8e658aebde", "committedDate": "2020-10-28T13:40:33Z", "message": "Checkstyle"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bbe20f1c7cd3a1f41196ce62fbe5187b221c7bf2", "author": {"user": {"login": "pugnascotia", "name": "Rory Hunter"}}, "url": "https://github.com/elastic/elasticsearch/commit/bbe20f1c7cd3a1f41196ce62fbe5187b221c7bf2", "committedDate": "2020-10-28T15:36:39Z", "message": "Merge remote-tracking branch 'upstream/master' into docker-files-world-readable"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE5MTQ3MjIw", "url": "https://github.com/elastic/elasticsearch/pull/64274#pullrequestreview-519147220", "createdAt": "2020-10-28T23:03:29Z", "commit": {"oid": "bbe20f1c7cd3a1f41196ce62fbe5187b221c7bf2"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE5NzQ3Njk0", "url": "https://github.com/elastic/elasticsearch/pull/64274#pullrequestreview-519747694", "createdAt": "2020-10-29T14:49:37Z", "commit": {"oid": "bbe20f1c7cd3a1f41196ce62fbe5187b221c7bf2"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIwMDk5MDUx", "url": "https://github.com/elastic/elasticsearch/pull/64274#pullrequestreview-520099051", "createdAt": "2020-10-29T21:24:45Z", "commit": {"oid": "bbe20f1c7cd3a1f41196ce62fbe5187b221c7bf2"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOVQyMToyNDo0NVrOHqvRMg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOVQyMToyNDo0NVrOHqvRMg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDU3NjY5MA==", "bodyText": "I guess my only question is what is the point of this? I only assume running as a different user is something done by security conscious orgs that don't like the idea of running containers as root. Wouldn't then subsequently adding the user to the root group defeat the purpose?", "url": "https://github.com/elastic/elasticsearch/pull/64274#discussion_r514576690", "createdAt": "2020-10-29T21:24:45Z", "author": {"login": "mark-vieira"}, "path": "docs/reference/setup/install/docker.asciidoc", "diffHunk": "@@ -234,6 +235,12 @@ chmod g+rwx esdatadir\n chgrp 0 esdatadir\n --------------------------------------------\n \n+You can also run an {es} container using both a custom UID and GID. Unless you\n+bind-mount each of the `config`, data` and `logs` directories, you must pass\n+the command line option `--group-add 0` to `docker run`. This ensures that the user", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bbe20f1c7cd3a1f41196ce62fbe5187b221c7bf2"}, "originalPosition": 16}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIwMTAwODc2", "url": "https://github.com/elastic/elasticsearch/pull/64274#pullrequestreview-520100876", "createdAt": "2020-10-29T21:26:34Z", "commit": {"oid": "bbe20f1c7cd3a1f41196ce62fbe5187b221c7bf2"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 926, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}