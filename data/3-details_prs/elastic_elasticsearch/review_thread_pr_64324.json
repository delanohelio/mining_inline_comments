{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTExOTY0Mjk2", "number": 64324, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOVQxNzozNTowN1rOEzaILg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOVQxNzozNTowN1rOEzaILg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIyMzQwOTEwOnYy", "diffSide": "RIGHT", "path": "server/src/main/java/org/elasticsearch/cluster/node/DiscoveryNode.java", "isResolved": false, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOVQxNzozNTowN1rOHqnJIA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOVQxNzo1OToxMFrOHqoGrA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDQ0MzU1Mg==", "bodyText": "Once this is backported, do you plan to change this to not use getCompatibilityRole and remove that straightaway? (in 7.10.0 I mean)", "url": "https://github.com/elastic/elasticsearch/pull/64324#discussion_r514443552", "createdAt": "2020-10-29T17:35:07Z", "author": {"login": "dakrone"}, "path": "server/src/main/java/org/elasticsearch/cluster/node/DiscoveryNode.java", "diffHunk": "@@ -288,6 +294,9 @@ public void writeTo(StreamOutput out) throws IOException {\n             final DiscoveryNodeRole compatibleRole = role.getCompatibilityRole(out.getVersion());\n             out.writeString(compatibleRole.roleName());\n             out.writeString(compatibleRole.roleNameAbbreviation());\n+            if (out.getVersion().onOrAfter(Version.V_8_0_0)) {\n+                out.writeBoolean(compatibleRole.canContainData());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "52cec92ebb3c5b59ad38595008d364c96b6079a1"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDQ0NTY2OA==", "bodyText": "I might be missing something, but I don't think we can remove it straightaway because masters on older versions still need to be told these nodes with the data_* roles can hold data, and I think sending the compatible role is the only way? I think we have to wait to remove compatible role until we are no longer communicating with master nodes that do not understand the \"can contain data\" field.", "url": "https://github.com/elastic/elasticsearch/pull/64324#discussion_r514445668", "createdAt": "2020-10-29T17:38:26Z", "author": {"login": "jasontedor"}, "path": "server/src/main/java/org/elasticsearch/cluster/node/DiscoveryNode.java", "diffHunk": "@@ -288,6 +294,9 @@ public void writeTo(StreamOutput out) throws IOException {\n             final DiscoveryNodeRole compatibleRole = role.getCompatibilityRole(out.getVersion());\n             out.writeString(compatibleRole.roleName());\n             out.writeString(compatibleRole.roleNameAbbreviation());\n+            if (out.getVersion().onOrAfter(Version.V_8_0_0)) {\n+                out.writeBoolean(compatibleRole.canContainData());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDQ0MzU1Mg=="}, "originalCommit": {"oid": "52cec92ebb3c5b59ad38595008d364c96b6079a1"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDQ1ODMzOA==", "bodyText": "You're not missing something, you're correct. We'll still need it for pre-7.10 versions. I suppose we could remove it for master only since we do specify that only the latest 7.x release can do a rolling upgrade to 8.0, but otherwise we couldn't remove it from 7.x.", "url": "https://github.com/elastic/elasticsearch/pull/64324#discussion_r514458338", "createdAt": "2020-10-29T17:57:35Z", "author": {"login": "dakrone"}, "path": "server/src/main/java/org/elasticsearch/cluster/node/DiscoveryNode.java", "diffHunk": "@@ -288,6 +294,9 @@ public void writeTo(StreamOutput out) throws IOException {\n             final DiscoveryNodeRole compatibleRole = role.getCompatibilityRole(out.getVersion());\n             out.writeString(compatibleRole.roleName());\n             out.writeString(compatibleRole.roleNameAbbreviation());\n+            if (out.getVersion().onOrAfter(Version.V_8_0_0)) {\n+                out.writeBoolean(compatibleRole.canContainData());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDQ0MzU1Mg=="}, "originalCommit": {"oid": "52cec92ebb3c5b59ad38595008d364c96b6079a1"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDQ1OTMwOA==", "bodyText": "Okay, I like the idea of removing it from master right away. I'll pick that up in a follow-up.", "url": "https://github.com/elastic/elasticsearch/pull/64324#discussion_r514459308", "createdAt": "2020-10-29T17:59:10Z", "author": {"login": "jasontedor"}, "path": "server/src/main/java/org/elasticsearch/cluster/node/DiscoveryNode.java", "diffHunk": "@@ -288,6 +294,9 @@ public void writeTo(StreamOutput out) throws IOException {\n             final DiscoveryNodeRole compatibleRole = role.getCompatibilityRole(out.getVersion());\n             out.writeString(compatibleRole.roleName());\n             out.writeString(compatibleRole.roleNameAbbreviation());\n+            if (out.getVersion().onOrAfter(Version.V_8_0_0)) {\n+                out.writeBoolean(compatibleRole.canContainData());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDQ0MzU1Mg=="}, "originalCommit": {"oid": "52cec92ebb3c5b59ad38595008d364c96b6079a1"}, "originalPosition": 22}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4172, "cost": 1, "resetAt": "2021-11-12T19:05:54Z"}}}