{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTMzNDU5Nzc0", "number": 65925, "title": "Expose timestamp field type on coordinator node", "bodyText": "Today a coordinating node does not have (easy) access to the mappings\nfor the indices for the searches it wishes to coordinate. This means it\ncan't properly interpret a timestamp range filter in a query and must\ninvolve a copy of every shard in at least the can_match phase. It\ntherefore cannot cope with cases when shards are temporarily not started\neven if those shards are irrelevant to the search.\nThis commit captures the mapping of the @timestamp field for indices\nwhich expose a timestamp range in their index metadata.\nBackport of #65873 to 7.x", "createdAt": "2020-12-07T07:46:48Z", "url": "https://github.com/elastic/elasticsearch/pull/65925", "merged": true, "mergeCommit": {"oid": "50efafd9d062609293aec2dbb923cc4a5a656a7e"}, "closed": true, "closedAt": "2020-12-07T10:12:30Z", "author": {"login": "DaveCTurner"}, "timelineItems": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdjwo1nAH2gAyNTMzNDU5Nzc0OjhiMjVlY2I3MmEzNzhlYzYyZTM5MDBlNzBjYjBhODIxYmE4M2U3MTc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdjyijpgFqTU0NTk4OTU4Nw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "8b25ecb72a378ec62e3900e70cb0a821ba83e717", "author": {"user": {"login": "DaveCTurner", "name": "David Turner"}}, "url": "https://github.com/elastic/elasticsearch/commit/8b25ecb72a378ec62e3900e70cb0a821ba83e717", "committedDate": "2020-12-07T07:44:38Z", "message": "Expose timestamp field type on coordinator node (#65873)\n\nToday a coordinating node does not have (easy) access to the mappings\nfor the indices for the searches it wishes to coordinate. This means it\ncan't properly interpret a timestamp range filter in a query and must\ninvolve a copy of every shard in at least the `can_match` phase. It\ntherefore cannot cope with cases when shards are temporarily not started\neven if those shards are irrelevant to the search.\n\nThis commit captures the mapping of the `@timestamp` field for indices\nwhich expose a timestamp range in their index metadata."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ1ODk1OTc2", "url": "https://github.com/elastic/elasticsearch/pull/65925#pullrequestreview-545895976", "createdAt": "2020-12-07T07:49:37Z", "commit": {"oid": "8b25ecb72a378ec62e3900e70cb0a821ba83e717"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wN1QwNzo0OTozN1rOIAZ0YA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wN1QwNzo0OTozN1rOIAZ0YA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzI5MzkyMA==", "bodyText": "@pgomulka I've asked for you to take a look at this backport because this test is having trouble with locales and older JDK versions and I think you have expertise in this area. As far as I can tell, the behaviour difference is in JDK8, hence this line, but it'd be good if you could give it a quick look and see if there are any other gotchas here. I'm ok with skipping the check that we parse the non-English string in JDK8, it's not really the point of this PR it's just a good way to test it.\nThe rest of the PR is already reviewed, it's just this one test that needs attention.", "url": "https://github.com/elastic/elasticsearch/pull/65925#discussion_r537293920", "createdAt": "2020-12-07T07:49:37Z", "author": {"login": "DaveCTurner"}, "path": "x-pack/plugin/frozen-indices/src/internalClusterTest/java/org/elasticsearch/index/engine/FrozenIndexIT.java", "diffHunk": "@@ -97,4 +103,73 @@ public void testTimestampRangeRecalculatedOnStalePrimaryAllocation() throws IOEx\n         assertThat(timestampFieldRange.getMax(), equalTo(Instant.parse(\"2010-01-06T02:03:04.567Z\").getMillis()));\n     }\n \n+    public void testTimestampFieldTypeExposedByAllIndicesServices() throws Exception {\n+        internalCluster().startNodes(between(2, 4));\n+\n+        final String locale;\n+        final String date;\n+\n+        final boolean isJdk8 = JavaVersion.current().getVersion().get(0) == 8; // JDK8 doesn't reliably know French", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8b25ecb72a378ec62e3900e70cb0a821ba83e717"}, "originalPosition": 36}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ1OTg5NTg3", "url": "https://github.com/elastic/elasticsearch/pull/65925#pullrequestreview-545989587", "createdAt": "2020-12-07T09:57:35Z", "commit": {"oid": "8b25ecb72a378ec62e3900e70cb0a821ba83e717"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4041, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}