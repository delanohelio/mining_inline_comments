{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzcyNzI0MzY2", "number": 52097, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wOFQxNzo1Nzo0MlrODeOrmw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wOVQxODoyNzoyMlrODeSgAQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMzMDI0NDExOnYy", "diffSide": "RIGHT", "path": "x-pack/plugin/sql/src/main/java/org/elasticsearch/xpack/sql/util/DateUtils.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wOFQxNzo1Nzo0MlrOFnRaDQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wOFQxODozMTo1M1rOFnRhdg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjcyMzk4MQ==", "bodyText": "This could be improved by checking whether there's a T separator at its dedicated position (10) in order to select the right parser. This should avoid the fallback in case of an exception.", "url": "https://github.com/elastic/elasticsearch/pull/52097#discussion_r376723981", "createdAt": "2020-02-08T17:57:42Z", "author": {"login": "costin"}, "path": "x-pack/plugin/sql/src/main/java/org/elasticsearch/xpack/sql/util/DateUtils.java", "diffHunk": "@@ -105,7 +111,11 @@ public static ZonedDateTime asDateTime(String dateFormat) {\n     }\n \n     public static ZonedDateTime ofEscapedLiteral(String dateFormat) {\n-        return ZonedDateTime.parse(dateFormat, DATE_TIME_ESCAPED_LITERAL_FORMATTER.withZone(UTC));\n+        try {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3166b8ef3222c706cbae45312e626c592a74c470"}, "originalPosition": 35}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjcyNTg3OA==", "bodyText": "The position is not dedicated though as the year can be more than 4 digits.\nBut I can use lastIndexOf('-')", "url": "https://github.com/elastic/elasticsearch/pull/52097#discussion_r376725878", "createdAt": "2020-02-08T18:31:53Z", "author": {"login": "matriv"}, "path": "x-pack/plugin/sql/src/main/java/org/elasticsearch/xpack/sql/util/DateUtils.java", "diffHunk": "@@ -105,7 +111,11 @@ public static ZonedDateTime asDateTime(String dateFormat) {\n     }\n \n     public static ZonedDateTime ofEscapedLiteral(String dateFormat) {\n-        return ZonedDateTime.parse(dateFormat, DATE_TIME_ESCAPED_LITERAL_FORMATTER.withZone(UTC));\n+        try {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjcyMzk4MQ=="}, "originalCommit": {"oid": "3166b8ef3222c706cbae45312e626c592a74c470"}, "originalPosition": 35}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMzMDg2ODYzOnYy", "diffSide": "RIGHT", "path": "x-pack/plugin/sql/src/test/java/org/elasticsearch/xpack/sql/parser/EscapedFunctionsTests.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wOVQxODoyNTozM1rOFnWTiA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wOVQxODoyNTozM1rOFnWTiA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjgwNDIzMg==", "bodyText": "I think this whole code could be simplified (and still readable and not cluttered) as:\n        if (randomBoolean()) {\n           return \":55\" + randomFrom(\"\", \".1\", \".12\", \".123\", \".1234\", \".12345\", \".123456\",\n                    \".1234567\", \".12345678\", \".123456789\");\n        }\n        return \"\";", "url": "https://github.com/elastic/elasticsearch/pull/52097#discussion_r376804232", "createdAt": "2020-02-09T18:25:33Z", "author": {"login": "astefan"}, "path": "x-pack/plugin/sql/src/test/java/org/elasticsearch/xpack/sql/parser/EscapedFunctionsTests.java", "diffHunk": "@@ -62,6 +62,40 @@ private Literal timestampLiteral(String date) {\n         return (Literal) exp;\n     }\n \n+    private String buildDate() {\n+        StringBuilder sb = new StringBuilder();\n+        int length = randomIntBetween(4, 9);\n+\n+        if (randomBoolean()) {\n+            sb.append('-');\n+        } else {\n+            if (length > 4) {\n+                sb.append('-');\n+            }\n+        }\n+\n+        for (int i = 1; i <= length; i++) {\n+            sb.append(i);\n+        }\n+        sb.append(\"-05-10\");\n+        return sb.toString();\n+    }\n+\n+    private String buildSecsAndFractional() {\n+        boolean hasSecs = randomBoolean();\n+        String secs = \"\";\n+        if (hasSecs) {\n+            secs = \":55\";\n+        }\n+\n+        String fractionalSecs = \"\";\n+        if (hasSecs) {\n+            fractionalSecs = randomFrom(\"\", \".1\", \".12\", \".123\", \".1234\", \".12345\", \".123456\",\n+                    \".1234567\", \".12345678\", \".123456789\");\n+        }\n+        return secs + fractionalSecs;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cb520d7126b0a878ccc5f67c2f9e3e112f1df0fb"}, "originalPosition": 35}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMzMDg2OTc3OnYy", "diffSide": "RIGHT", "path": "x-pack/plugin/sql/src/test/java/org/elasticsearch/xpack/sql/parser/EscapedFunctionsTests.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wOVQxODoyNzoyMlrOFnWUGQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wOVQxODozMTo0NVrOFnWVaA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjgwNDM3Nw==", "bodyText": "I don't understand this. Why is the date starting with -?", "url": "https://github.com/elastic/elasticsearch/pull/52097#discussion_r376804377", "createdAt": "2020-02-09T18:27:22Z", "author": {"login": "astefan"}, "path": "x-pack/plugin/sql/src/test/java/org/elasticsearch/xpack/sql/parser/EscapedFunctionsTests.java", "diffHunk": "@@ -62,6 +62,40 @@ private Literal timestampLiteral(String date) {\n         return (Literal) exp;\n     }\n \n+    private String buildDate() {\n+        StringBuilder sb = new StringBuilder();\n+        int length = randomIntBetween(4, 9);\n+\n+        if (randomBoolean()) {\n+            sb.append('-');", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cb520d7126b0a878ccc5f67c2f9e3e112f1df0fb"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjgwNDcxMg==", "bodyText": "To test negative Year.", "url": "https://github.com/elastic/elasticsearch/pull/52097#discussion_r376804712", "createdAt": "2020-02-09T18:31:45Z", "author": {"login": "matriv"}, "path": "x-pack/plugin/sql/src/test/java/org/elasticsearch/xpack/sql/parser/EscapedFunctionsTests.java", "diffHunk": "@@ -62,6 +62,40 @@ private Literal timestampLiteral(String date) {\n         return (Literal) exp;\n     }\n \n+    private String buildDate() {\n+        StringBuilder sb = new StringBuilder();\n+        int length = randomIntBetween(4, 9);\n+\n+        if (randomBoolean()) {\n+            sb.append('-');", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjgwNDM3Nw=="}, "originalCommit": {"oid": "cb520d7126b0a878ccc5f67c2f9e3e112f1df0fb"}, "originalPosition": 9}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4855, "cost": 1, "resetAt": "2021-11-12T13:16:51Z"}}}