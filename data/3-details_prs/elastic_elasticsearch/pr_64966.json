{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE5NDI2MDY4", "number": 64966, "title": "Adds realm name OIDC `_security/oidc/prepare` and `_security/oidc/authenticate` APIs responses", "bodyText": "This change adds realm name of the realm used to perform authentication to the responses of _security/oidc/authenticate and _security/oidc/authenticate APIs\nResolves #53161", "createdAt": "2020-11-11T20:13:24Z", "url": "https://github.com/elastic/elasticsearch/pull/64966", "merged": true, "mergeCommit": {"oid": "a3063889a28c3fa92b6621a2ec84c58a895307d5"}, "closed": true, "closedAt": "2020-11-16T18:10:02Z", "author": {"login": "BigPandaToo"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdbjuZqgH2gAyNTE5NDI2MDY4OjM1NTg2OWVhZWM5YTZlZDQyY2FhYzQ5M2NkNjVmZjE3ZmM4ZjgwMjQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABddIAoRAH2gAyNTE5NDI2MDY4OmY0YTJkNzY0Mjc2ZjE3MmU0ZmEzNGQwYmZjY2Q0NTk1ZmIxN2VjYzU=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "355869eaec9a6ed42caac493cd65ff17fc8f8024", "author": {"user": {"login": "BigPandaToo", "name": "Lyudmila Fokina"}}, "url": "https://github.com/elastic/elasticsearch/commit/355869eaec9a6ed42caac493cd65ff17fc8f8024", "committedDate": "2020-11-11T20:10:33Z", "message": "This change adds realm name of the realm used to perform authentication to the responses of _security/oidc/authenticate and _security/oidc/authenticate APIs\n\nResolves #53161"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "819d4f1ea4624aaf87ce2c46fe54dd0f94d60286", "author": {"user": {"login": "elasticmachine", "name": "Elastic Machine"}}, "url": "https://github.com/elastic/elasticsearch/commit/819d4f1ea4624aaf87ce2c46fe54dd0f94d60286", "committedDate": "2020-11-11T20:14:50Z", "message": "Merge branch 'master' into OIDC_realm"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI4Njg2OTY4", "url": "https://github.com/elastic/elasticsearch/pull/64966#pullrequestreview-528686968", "createdAt": "2020-11-12T02:18:33Z", "commit": {"oid": "819d4f1ea4624aaf87ce2c46fe54dd0f94d60286"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMlQwMjoxODozNFrOHxmoAQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMlQwMjoyNDoxM1rOHxmuDQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTc3NTEwNQ==", "bodyText": "A similar assertion for realm_name of the prepare response can also be added in method OpenIdConnectAuthIT#getRedirectedFromFacilitator.", "url": "https://github.com/elastic/elasticsearch/pull/64966#discussion_r521775105", "createdAt": "2020-11-12T02:18:34Z", "author": {"login": "ywangd"}, "path": "x-pack/qa/oidc-op-tests/src/test/java/org/elasticsearch/xpack/security/authc/oidc/OpenIdConnectAuthIT.java", "diffHunk": "@@ -420,6 +420,7 @@ private PrepareAuthResponse getRedirectedFromFacilitator(String realmName) throw\n             logger.info(\" OpenIDConnect authentication response {}\", responseBody);\n             assertNotNull(responseBody.get(\"access_token\"));\n             assertNotNull(responseBody.get(\"refresh_token\"));\n+            assertNotNull(responseBody.get(\"realm_name\"));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "819d4f1ea4624aaf87ce2c46fe54dd0f94d60286"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTc3NjY1Mw==", "bodyText": "I think we can save this new parameter because the realm information is already available via authentication.getSourceRealm().", "url": "https://github.com/elastic/elasticsearch/pull/64966#discussion_r521776653", "createdAt": "2020-11-12T02:24:13Z", "author": {"login": "ywangd"}, "path": "x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/security/action/oidc/OpenIdConnectAuthenticateResponse.java", "diffHunk": "@@ -19,14 +19,16 @@\n     private String accessTokenString;\n     private String refreshTokenString;\n     private TimeValue expiresIn;\n+    private String realmName;\n     private Authentication authentication;\n \n     public OpenIdConnectAuthenticateResponse(Authentication authentication, String accessTokenString, String refreshTokenString,\n-                                             TimeValue expiresIn) {\n+                                             TimeValue expiresIn, String realmName) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "819d4f1ea4624aaf87ce2c46fe54dd0f94d60286"}, "originalPosition": 9}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e87b60e143b229c6333b4a2b9f0bb9f00c73c4ad", "author": {"user": {"login": "BigPandaToo", "name": "Lyudmila Fokina"}}, "url": "https://github.com/elastic/elasticsearch/commit/e87b60e143b229c6333b4a2b9f0bb9f00c73c4ad", "committedDate": "2020-11-12T20:49:09Z", "message": "This change adds realm name of the realm used to perform authentication to the responses of _security/oidc/authenticate and _security/oidc/authenticate APIs\n\nResolves #53161"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8bacf63d735945446e854e9effb9de8817ac293b", "author": {"user": {"login": "BigPandaToo", "name": "Lyudmila Fokina"}}, "url": "https://github.com/elastic/elasticsearch/commit/8bacf63d735945446e854e9effb9de8817ac293b", "committedDate": "2020-11-15T17:53:02Z", "message": "This change adds realm name of the realm used to perform authentication to the responses of _security/oidc/authenticate and _security/oidc/authenticate APIs\n\nResolves #53161"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMwODY5Njk3", "url": "https://github.com/elastic/elasticsearch/pull/64966#pullrequestreview-530869697", "createdAt": "2020-11-16T01:45:10Z", "commit": {"oid": "8bacf63d735945446e854e9effb9de8817ac293b"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNlQwMTo0NToxMFrOHzlkRg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNlQwMTo0NTozNFrOHzlksw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzg1NDkxOA==", "bodyText": "This is no longer necessary since the realm field is removed from the response (due to presence of the authentication field).", "url": "https://github.com/elastic/elasticsearch/pull/64966#discussion_r523854918", "createdAt": "2020-11-16T01:45:10Z", "author": {"login": "ywangd"}, "path": "x-pack/qa/oidc-op-tests/src/test/java/org/elasticsearch/xpack/security/authc/oidc/OpenIdConnectAuthIT.java", "diffHunk": "@@ -420,6 +420,7 @@ private PrepareAuthResponse getRedirectedFromFacilitator(String realmName) throw\n             logger.info(\" OpenIDConnect authentication response {}\", responseBody);\n             assertNotNull(responseBody.get(\"access_token\"));\n             assertNotNull(responseBody.get(\"refresh_token\"));\n+            assertNotNull(responseBody.get(\"realm\"));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8bacf63d735945446e854e9effb9de8817ac293b"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzg1NTAyNw==", "bodyText": "Similarly, this change can be reverted.", "url": "https://github.com/elastic/elasticsearch/pull/64966#discussion_r523855027", "createdAt": "2020-11-16T01:45:34Z", "author": {"login": "ywangd"}, "path": "x-pack/qa/oidc-op-tests/src/test/java/org/elasticsearch/xpack/security/authc/oidc/OpenIdConnectAuthIT.java", "diffHunk": "@@ -517,11 +518,13 @@ private RestClient getClient() throws Exception {\n         private URI authUri;\n         private String state;\n         private String nonce;\n+        private String realm;\n \n-        PrepareAuthResponse(URI authUri, String state, String nonce, @Nullable String realm) {\n+        PrepareAuthResponse(URI authUri, String state, String nonce, String realm) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8bacf63d735945446e854e9effb9de8817ac293b"}, "originalPosition": 15}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f4a2d764276f172e4fa34d0bfccd4595fb17ecc5", "author": {"user": {"login": "BigPandaToo", "name": "Lyudmila Fokina"}}, "url": "https://github.com/elastic/elasticsearch/commit/f4a2d764276f172e4fa34d0bfccd4595fb17ecc5", "committedDate": "2020-11-16T17:00:58Z", "message": "This change adds realm name of the realm used to perform authentication to the responses of _security/oidc/authenticate and _security/oidc/authenticate APIs\n\nResolves #53161"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1034, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}