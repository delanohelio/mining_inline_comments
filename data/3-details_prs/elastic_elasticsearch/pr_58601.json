{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQwNTc5NjQw", "number": 58601, "title": "Detangle JdkJarHellCheck from build tool building", "bodyText": "allows building the tool with same runtime as es\nallows building build tools with newer runtime version and keep ThirdPartyAuditTask\nrunning with minimum runtime to ensure we check against correct jre\n\nThis work is related to back porting #58417 and the discussion with @mark-vieira (see https://elastic.slack.com/archives/C8UUBNASY/p1593017789294200 for details)", "createdAt": "2020-06-26T13:14:59Z", "url": "https://github.com/elastic/elasticsearch/pull/58601", "merged": true, "mergeCommit": {"oid": "a1e1b33a475b19a0ce33947c673b23fc8c9b842d"}, "closed": true, "closedAt": "2020-06-30T14:20:03Z", "author": {"login": "breskeby"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcv8tmXABqjM0OTE4Mzk4Nzc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcwTtzEABqjM0OTcyMzI1NDc=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "abd7568993927311379f46d4270305e70baaeb7f", "author": {"user": {"login": "breskeby", "name": "Rene Groeschke"}}, "url": "https://github.com/elastic/elasticsearch/commit/abd7568993927311379f46d4270305e70baaeb7f", "committedDate": "2020-06-26T13:14:10Z", "message": "Detangle JdkJarHellCheck from build tool building\n\n- allows building the tool with same runtime as es\n- allows building build tools with newer runtime version and keep ThirdPartyAuditTask\nrunning with minimum runtime to ensure we check against correct jre"}, "afterCommit": {"oid": "972a2bcf680a0d3aa94838b8f6329abdf43f29aa", "author": {"user": {"login": "breskeby", "name": "Rene Groeschke"}}, "url": "https://github.com/elastic/elasticsearch/commit/972a2bcf680a0d3aa94838b8f6329abdf43f29aa", "committedDate": "2020-06-29T08:24:04Z", "message": "Detangle JdkJarHellCheck from build tool building\n\n- allows building the tool with same runtime as es\n- allows building build tools with newer runtime version and keep ThirdPartyAuditTask\nrunning with minimum runtime to ensure we check against correct jre"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM5NTE5Nzcx", "url": "https://github.com/elastic/elasticsearch/pull/58601#pullrequestreview-439519771", "createdAt": "2020-06-29T21:39:24Z", "commit": {"oid": "85f559598bd2c394a6d909350482189ab19d9203"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yOVQyMTozOToyNFrOGqjLKg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yOVQyMTozOToyNFrOGqjLKg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzI2OTY3NA==", "bodyText": "nit: We try to use == false instead of ! as the former is easier to visually see when skimming through code.", "url": "https://github.com/elastic/elasticsearch/pull/58601#discussion_r447269674", "createdAt": "2020-06-29T21:39:24Z", "author": {"login": "rjernst"}, "path": "buildSrc/src/main/java/org/elasticsearch/gradle/precommit/ThirdPartyAuditPrecommitPlugin.java", "diffHunk": "@@ -24,17 +24,30 @@\n import org.elasticsearch.gradle.info.BuildParams;\n import org.gradle.api.Project;\n import org.gradle.api.Task;\n+import org.gradle.api.artifacts.Configuration;\n import org.gradle.api.tasks.TaskProvider;\n \n import java.nio.file.Path;\n \n public class ThirdPartyAuditPrecommitPlugin extends PrecommitPlugin {\n+\n+    public static final String JDK_JAR_HELL_CONFIG_NAME = \"jdkJarHell\";\n+    public static final String LIBS_ELASTICSEARCH_CORE_PROJECT_PATH = \":libs:elasticsearch-core\";\n+\n     @Override\n     public TaskProvider<? extends Task> createTask(Project project) {\n         project.getPlugins().apply(CompileOnlyResolvePlugin.class);\n         project.getConfigurations().create(\"forbiddenApisCliJar\");\n         project.getDependencies().add(\"forbiddenApisCliJar\", \"de.thetaphi:forbiddenapis:2.7\");\n \n+        Configuration jdkJarHellConfig = project.getConfigurations().create(JDK_JAR_HELL_CONFIG_NAME);\n+        if (BuildParams.isInternal() && !project.getPath().equals(\":libs:elasticsearch-core\")) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "85f559598bd2c394a6d909350482189ab19d9203"}, "originalPosition": 21}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "8a1083a1f679991e86ffe381dd467ce3d5160f50", "author": {"user": {"login": "breskeby", "name": "Rene Groeschke"}}, "url": "https://github.com/elastic/elasticsearch/commit/8a1083a1f679991e86ffe381dd467ce3d5160f50", "committedDate": "2020-06-30T08:28:54Z", "message": "Merge branch 'master' into detangle-jdkjarhell-from-buildtool"}, "afterCommit": {"oid": "e003843b607b9d5a472bbe6a6ef81b52d97148b5", "author": {"user": {"login": "breskeby", "name": "Rene Groeschke"}}, "url": "https://github.com/elastic/elasticsearch/commit/e003843b607b9d5a472bbe6a6ef81b52d97148b5", "committedDate": "2020-06-30T08:32:15Z", "message": "Apply review feedback on code style"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b06b0fa23a59102560829b0f1659a6a5b08b4d49", "author": {"user": {"login": "breskeby", "name": "Rene Groeschke"}}, "url": "https://github.com/elastic/elasticsearch/commit/b06b0fa23a59102560829b0f1659a6a5b08b4d49", "committedDate": "2020-06-30T11:10:50Z", "message": "Detangle JdkJarHellCheck from build tool building\n\n- allows building the tool with same runtime as es\n- allows building build tools with newer runtime version and keep ThirdPartyAuditTask\nrunning with minimum runtime to ensure we check against correct jre"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2abe19291f0fae41bced7da292b8a0cf14a219e0", "author": {"user": {"login": "breskeby", "name": "Rene Groeschke"}}, "url": "https://github.com/elastic/elasticsearch/commit/2abe19291f0fae41bced7da292b8a0cf14a219e0", "committedDate": "2020-06-30T11:10:50Z", "message": "Move jdkjarhell test jar setup into fixture\n\n- allows reuse in other tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2ed56dcca2bfe34c341f21d259837921b4b820c3", "author": {"user": {"login": "breskeby", "name": "Rene Groeschke"}}, "url": "https://github.com/elastic/elasticsearch/commit/2ed56dcca2bfe34c341f21d259837921b4b820c3", "committedDate": "2020-06-30T11:10:51Z", "message": "Apply review feedback on code style"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e003843b607b9d5a472bbe6a6ef81b52d97148b5", "author": {"user": {"login": "breskeby", "name": "Rene Groeschke"}}, "url": "https://github.com/elastic/elasticsearch/commit/e003843b607b9d5a472bbe6a6ef81b52d97148b5", "committedDate": "2020-06-30T08:32:15Z", "message": "Apply review feedback on code style"}, "afterCommit": {"oid": "2ed56dcca2bfe34c341f21d259837921b4b820c3", "author": {"user": {"login": "breskeby", "name": "Rene Groeschke"}}, "url": "https://github.com/elastic/elasticsearch/commit/2ed56dcca2bfe34c341f21d259837921b4b820c3", "committedDate": "2020-06-30T11:10:51Z", "message": "Apply review feedback on code style"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2661, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}