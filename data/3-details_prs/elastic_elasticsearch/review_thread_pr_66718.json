{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTQzNzQxMjEx", "number": 66718, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMlQwOTo1NToxNFrOFIGIbQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0yMFQwODozMzowN1rOFQwl4Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQ0MDMzMzg5OnYy", "diffSide": "RIGHT", "path": "x-pack/plugin/transform/src/main/java/org/elasticsearch/xpack/transform/transforms/TransformIndexer.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMlQwOTo1NToxNFrOIJ1NJA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMlQxMDowMjowMlrOIJ1aWA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzE3OTgxMg==", "bodyText": "This changes behaviour for changed_last_detected_at. The change seems correct but is it fixing another issue with that not getting updated properly?", "url": "https://github.com/elastic/elasticsearch/pull/66718#discussion_r547179812", "createdAt": "2020-12-22T09:55:14Z", "author": {"login": "dimitris-athanasiou"}, "path": "x-pack/plugin/transform/src/main/java/org/elasticsearch/xpack/transform/transforms/TransformIndexer.java", "diffHunk": "@@ -355,6 +357,8 @@ protected void onStart(long now, ActionListener<Boolean> listener) {\n             }));\n         } else {\n             hasSourceChanged = true;\n+            context.setChangesLastSearchedAt(instantOfTrigger);\n+            context.setChangesLastDetectedAt(instantOfTrigger);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bd596295acaec91ab4d66e0ab484b2a9cddbad0a"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzE4MzE5Mg==", "bodyText": "yes, the if is \"continuous\" mode, the else is \"batch\". I see no reason why we report  changed_last_detected_at (and changed_last_searched_at) only for continuous but not for batch. This makes it more consistent.", "url": "https://github.com/elastic/elasticsearch/pull/66718#discussion_r547183192", "createdAt": "2020-12-22T10:02:02Z", "author": {"login": "hendrikmuhs"}, "path": "x-pack/plugin/transform/src/main/java/org/elasticsearch/xpack/transform/transforms/TransformIndexer.java", "diffHunk": "@@ -355,6 +357,8 @@ protected void onStart(long now, ActionListener<Boolean> listener) {\n             }));\n         } else {\n             hasSourceChanged = true;\n+            context.setChangesLastSearchedAt(instantOfTrigger);\n+            context.setChangesLastDetectedAt(instantOfTrigger);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzE3OTgxMg=="}, "originalCommit": {"oid": "bd596295acaec91ab4d66e0ab484b2a9cddbad0a"}, "originalPosition": 22}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzUyNzExODUyOnYy", "diffSide": "RIGHT", "path": "client/rest-high-level/src/main/java/org/elasticsearch/client/transform/transforms/TransformCheckpointingInfo.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xOVQxMjoyMzowNVrOIWMIvA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xOVQxMjoyMzowNVrOIWMIvA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MDEzODQyOA==", "bodyText": "lastSearchTime or lastSearchedTime?\nPlease use the same variable name in both TransformCheckpointingInfo classes.", "url": "https://github.com/elastic/elasticsearch/pull/66718#discussion_r560138428", "createdAt": "2021-01-19T12:23:05Z", "author": {"login": "przemekwitek"}, "path": "client/rest-high-level/src/main/java/org/elasticsearch/client/transform/transforms/TransformCheckpointingInfo.java", "diffHunk": "@@ -49,13 +49,13 @@\n         a -> {\n             long behind = a[2] == null ? 0L : (Long) a[2];\n             Instant changesLastDetectedAt = (Instant) a[3];\n-            Instant changesLastSearchedAt = (Instant) a[4];\n+            Instant lastSearchTime = (Instant) a[4];", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fe8ee20a5474071b3fc6efa8792413f8759bb19d"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzUzMTE3NjY1OnYy", "diffSide": "RIGHT", "path": "x-pack/plugin/transform/qa/multi-node-tests/src/javaRestTest/java/org/elasticsearch/xpack/transform/integration/continuous/TransformContinuousIT.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0yMFQwODozMzowN1rOIWyWpA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0yMFQxMDo0MTo0MlrOIW4MOw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MDc2NDU4MA==", "bodyText": "Just double-checking: Is \"+1\" no longer needed here?", "url": "https://github.com/elastic/elasticsearch/pull/66718#discussion_r560764580", "createdAt": "2021-01-20T08:33:07Z", "author": {"login": "przemekwitek"}, "path": "x-pack/plugin/transform/qa/multi-node-tests/src/javaRestTest/java/org/elasticsearch/xpack/transform/integration/continuous/TransformContinuousIT.java", "diffHunk": "@@ -276,7 +275,7 @@ public void testContinousEvents() throws Exception {\n \n             // at random we added between 0 and 999_999ns == (1ms - 1ns) to every data point, so we add 1ms, so every data point is before\n             // the checkpoint\n-            waitUntilTransformsReachedUpperBound(runDate.toEpochMilli() + 1, run);\n+            waitUntilTransformsProcessedNewData(ContinuousTestCase.SYNC_DELAY, run);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8015bcc9ef9da676471a184736dfc9d36085d1f4"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MDg2MDIxOQ==", "bodyText": "I removed the outdated comment. The test waits according to delay with greaterThan, so it should be fine.", "url": "https://github.com/elastic/elasticsearch/pull/66718#discussion_r560860219", "createdAt": "2021-01-20T10:41:42Z", "author": {"login": "hendrikmuhs"}, "path": "x-pack/plugin/transform/qa/multi-node-tests/src/javaRestTest/java/org/elasticsearch/xpack/transform/integration/continuous/TransformContinuousIT.java", "diffHunk": "@@ -276,7 +275,7 @@ public void testContinousEvents() throws Exception {\n \n             // at random we added between 0 and 999_999ns == (1ms - 1ns) to every data point, so we add 1ms, so every data point is before\n             // the checkpoint\n-            waitUntilTransformsReachedUpperBound(runDate.toEpochMilli() + 1, run);\n+            waitUntilTransformsProcessedNewData(ContinuousTestCase.SYNC_DELAY, run);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MDc2NDU4MA=="}, "originalCommit": {"oid": "8015bcc9ef9da676471a184736dfc9d36085d1f4"}, "originalPosition": 13}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4409, "cost": 1, "resetAt": "2021-11-12T19:05:54Z"}}}