{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDczMjQ1NjU2", "number": 61530, "title": "Do not create two loggers for DeprecationLogger backport(#58435) ", "bodyText": "DeprecationLogger's constructor should not create two loggers. It was\ntaking parent logger instance, changing its name with a .deprecation\nprefix and creating a new logger.\nMost of the time parent logger was not needed. It was causing Log4j to\nunnecessarily cache the unused parent logger instance.\ndepends on #61515\nbackports #58435", "createdAt": "2020-08-25T14:30:41Z", "url": "https://github.com/elastic/elasticsearch/pull/61530", "merged": true, "mergeCommit": {"oid": "9f566644af2682f7a356699ba6733c73069f77e4"}, "closed": true, "closedAt": "2020-08-26T14:04:03Z", "author": {"login": "pgomulka"}, "timelineItems": {"totalCount": 18, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdCUFFGAH2gAyNDczMjQ1NjU2OjA4ZDZmNjNlNzU0MmEwMzRhY2Q0MDI1ZWIzYTg0MDM4MzI1ZmE3ZTU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdCqSFbgFqTQ3NTQwNDQwNg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "08d6f63e7542a034acd4025eb3a84038325fa7e5", "author": {"user": {"login": "pgomulka", "name": "Przemyslaw Gomulka"}}, "url": "https://github.com/elastic/elasticsearch/commit/08d6f63e7542a034acd4025eb3a84038325fa7e5", "committedDate": "2020-08-25T09:48:44Z", "message": "Header warning logging refactoring backport(#55941)\n\nSplitting DeprecationLogger into two. HeaderWarningLogger - responsible for adding a response warning headers and ThrottlingLogger - responsible for limiting the duplicated log entries for the same key (previously deprecateAndMaybeLog).\nIntroducing A ThrottlingAndHeaderWarningLogger which is a base for other common logging usages where both response warning header and logging throttling was needed.\n\nrelates #55699\nrelates #52369"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b899785b8a2c2bdbcbbe9d8f87dc8d94203b3383", "author": {"user": {"login": "pgomulka", "name": "Przemyslaw Gomulka"}}, "url": "https://github.com/elastic/elasticsearch/commit/b899785b8a2c2bdbcbbe9d8f87dc8d94203b3383", "committedDate": "2020-08-25T12:12:37Z", "message": "comile and precommit"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2ad8b8d5aa592f5b82c37bb246de81523f4060af", "author": {"user": {"login": "pgomulka", "name": "Przemyslaw Gomulka"}}, "url": "https://github.com/elastic/elasticsearch/commit/2ad8b8d5aa592f5b82c37bb246de81523f4060af", "committedDate": "2020-08-25T13:13:39Z", "message": "logger checks"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5223462ecf23267d56b6668abc68bd751d97fcca", "author": {"user": {"login": "pgomulka", "name": "Przemyslaw Gomulka"}}, "url": "https://github.com/elastic/elasticsearch/commit/5223462ecf23267d56b6668abc68bd751d97fcca", "committedDate": "2020-08-25T13:20:46Z", "message": "rename suppression"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "20eaf7a8890ee3bb2c4ef66d0daea55ed89163a1", "author": {"user": {"login": "pgomulka", "name": "Przemyslaw Gomulka"}}, "url": "https://github.com/elastic/elasticsearch/commit/20eaf7a8890ee3bb2c4ef66d0daea55ed89163a1", "committedDate": "2020-08-25T14:28:26Z", "message": "Do not create two loggers for DeprecationLogger backport(#58435)\n\nDeprecationLogger's constructor should not create two loggers. It was\ntaking parent logger instance, changing its name with a .deprecation\nprefix and creating a new logger.\nMost of the time parent logger was not needed. It was causing Log4j to\nunnecessarily cache the unused parent logger instance."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ec4301a5b4a24770c6dbab0388217bbf33c6fea4", "author": {"user": {"login": "pgomulka", "name": "Przemyslaw Gomulka"}}, "url": "https://github.com/elastic/elasticsearch/commit/ec4301a5b4a24770c6dbab0388217bbf33c6fea4", "committedDate": "2020-08-25T14:42:47Z", "message": "Merge branch '7.x' into bp/7x/deprecation_log_construction"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "66ce5257cc5086b89eb5bddf547b636d28fad0bc", "author": {"user": {"login": "pgomulka", "name": "Przemyslaw Gomulka"}}, "url": "https://github.com/elastic/elasticsearch/commit/66ce5257cc5086b89eb5bddf547b636d28fad0bc", "committedDate": "2020-08-25T15:23:27Z", "message": "precommit"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc1MjI1MDIw", "url": "https://github.com/elastic/elasticsearch/pull/61530#pullrequestreview-475225020", "createdAt": "2020-08-26T07:34:17Z", "commit": {"oid": "66ce5257cc5086b89eb5bddf547b636d28fad0bc"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNlQwNzozNDoxOFrOHG_gSw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNlQwNzozNDoxOFrOHG_gSw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzA5Mzk2Mw==", "bodyText": "there is a series of classes that possibly incorrectly use DynamicMap logger\nThis PR grew so large and was mostly automatic (find/replace, backport, automated refactoring) that I am reluctant to fix it here too. Maybe I miss something and DynamicMap was actually intended here?\n@pugnascotia WDYT?", "url": "https://github.com/elastic/elasticsearch/pull/61530#discussion_r477093963", "createdAt": "2020-08-26T07:34:18Z", "author": {"login": "pgomulka"}, "path": "modules/ingest-common/src/main/java/org/elasticsearch/ingest/common/ScriptProcessor.java", "diffHunk": "@@ -53,7 +52,7 @@\n public final class ScriptProcessor extends AbstractProcessor {\n \n     private static final DeprecationLogger deprecationLogger =\n-            new DeprecationLogger(LogManager.getLogger(DynamicMap.class));\n+            DeprecationLogger.getLogger(DynamicMap.class);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "66ce5257cc5086b89eb5bddf547b636d28fad0bc"}, "originalPosition": 13}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f4a22e182cda9aa2d9772da3ae92ea8829b50e7c", "author": {"user": {"login": "pgomulka", "name": "Przemyslaw Gomulka"}}, "url": "https://github.com/elastic/elasticsearch/commit/f4a22e182cda9aa2d9772da3ae92ea8829b50e7c", "committedDate": "2020-08-26T07:52:53Z", "message": "remove unnecessary line splits"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc1Mzg2MjA1", "url": "https://github.com/elastic/elasticsearch/pull/61530#pullrequestreview-475386205", "createdAt": "2020-08-26T11:12:57Z", "commit": {"oid": "f4a22e182cda9aa2d9772da3ae92ea8829b50e7c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNlQxMToxMjo1N1rOHHHQag==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNlQxMToxMjo1N1rOHHHQag==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzIyMDk3MA==", "bodyText": "Looks like another mistake.", "url": "https://github.com/elastic/elasticsearch/pull/61530#discussion_r477220970", "createdAt": "2020-08-26T11:12:57Z", "author": {"login": "pugnascotia"}, "path": "modules/percolator/src/main/java/org/elasticsearch/percolator/PercolateQueryBuilder.java", "diffHunk": "@@ -100,7 +99,7 @@\n public class PercolateQueryBuilder extends AbstractQueryBuilder<PercolateQueryBuilder> {\n     public static final String NAME = \"percolate\";\n \n-    private static final DeprecationLogger deprecationLogger = new DeprecationLogger(LogManager.getLogger(ParseField.class));\n+    private static final DeprecationLogger deprecationLogger = DeprecationLogger.getLogger(ParseField.class);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f4a22e182cda9aa2d9772da3ae92ea8829b50e7c"}, "originalPosition": 13}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc1Mzk2OTk2", "url": "https://github.com/elastic/elasticsearch/pull/61530#pullrequestreview-475396996", "createdAt": "2020-08-26T11:29:15Z", "commit": {"oid": "f4a22e182cda9aa2d9772da3ae92ea8829b50e7c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNlQxMToyOToxNVrOHHHxlg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNlQxMToyOToxNVrOHHHxlg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzIyOTQ2Mg==", "bodyText": "This one looks just plain wrong.", "url": "https://github.com/elastic/elasticsearch/pull/61530#discussion_r477229462", "createdAt": "2020-08-26T11:29:15Z", "author": {"login": "pugnascotia"}, "path": "server/src/main/java/org/elasticsearch/ingest/ConditionalProcessor.java", "diffHunk": "@@ -47,8 +46,7 @@\n \n public class ConditionalProcessor extends AbstractProcessor implements WrappingProcessor {\n \n-    private static final DeprecationLogger deprecationLogger =\n-            new DeprecationLogger(LogManager.getLogger(DynamicMap.class));\n+    private static final DeprecationLogger deprecationLogger = DeprecationLogger.getLogger(DynamicMap.class);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f4a22e182cda9aa2d9772da3ae92ea8829b50e7c"}, "originalPosition": 14}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc1Mzk5MjE1", "url": "https://github.com/elastic/elasticsearch/pull/61530#pullrequestreview-475399215", "createdAt": "2020-08-26T11:32:41Z", "commit": {"oid": "f4a22e182cda9aa2d9772da3ae92ea8829b50e7c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNlQxMTozMjo0MVrOHHH4ZQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNlQxMTozMjo0MVrOHHH4ZQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzIzMTIwNQ==", "bodyText": "This one is incorrect too.", "url": "https://github.com/elastic/elasticsearch/pull/61530#discussion_r477231205", "createdAt": "2020-08-26T11:32:41Z", "author": {"login": "pugnascotia"}, "path": "server/src/main/java/org/elasticsearch/rest/action/document/RestMultiTermVectorsAction.java", "diffHunk": "@@ -39,8 +38,7 @@\n import static org.elasticsearch.rest.RestRequest.Method.POST;\n \n public class RestMultiTermVectorsAction extends BaseRestHandler {\n-    private static final DeprecationLogger deprecationLogger = new DeprecationLogger(\n-        LogManager.getLogger(RestTermVectorsAction.class));\n+    private static final DeprecationLogger deprecationLogger = DeprecationLogger.getLogger(RestTermVectorsAction.class);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f4a22e182cda9aa2d9772da3ae92ea8829b50e7c"}, "originalPosition": 14}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc1Mzk5NzY4", "url": "https://github.com/elastic/elasticsearch/pull/61530#pullrequestreview-475399768", "createdAt": "2020-08-26T11:33:33Z", "commit": {"oid": "f4a22e182cda9aa2d9772da3ae92ea8829b50e7c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNlQxMTozMzozM1rOHHH5_Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNlQxMTozMzozM1rOHHH5_Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzIzMTYxMw==", "bodyText": "This one too.", "url": "https://github.com/elastic/elasticsearch/pull/61530#discussion_r477231613", "createdAt": "2020-08-26T11:33:33Z", "author": {"login": "pugnascotia"}, "path": "server/src/main/java/org/elasticsearch/script/AbstractSortScript.java", "diffHunk": "@@ -36,8 +35,7 @@\n \n abstract class AbstractSortScript implements ScorerAware {\n \n-    private static final DeprecationLogger deprecationLogger =\n-            new DeprecationLogger(LogManager.getLogger(DynamicMap.class));\n+    private static final DeprecationLogger deprecationLogger = DeprecationLogger.getLogger(DynamicMap.class);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f4a22e182cda9aa2d9772da3ae92ea8829b50e7c"}, "originalPosition": 14}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc1NDAwODQ2", "url": "https://github.com/elastic/elasticsearch/pull/61530#pullrequestreview-475400846", "createdAt": "2020-08-26T11:35:18Z", "commit": {"oid": "f4a22e182cda9aa2d9772da3ae92ea8829b50e7c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNlQxMTozNToxOFrOHHH9UA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNlQxMTozNToxOFrOHHH9UA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzIzMjQ2NA==", "bodyText": "And this one.", "url": "https://github.com/elastic/elasticsearch/pull/61530#discussion_r477232464", "createdAt": "2020-08-26T11:35:18Z", "author": {"login": "pugnascotia"}, "path": "server/src/main/java/org/elasticsearch/script/AggregationScript.java", "diffHunk": "@@ -40,8 +39,7 @@\n \n     public static final ScriptContext<Factory> CONTEXT = new ScriptContext<>(\"aggs\", Factory.class);\n \n-    private static final DeprecationLogger deprecationLogger =\n-            new DeprecationLogger(LogManager.getLogger(DynamicMap.class));\n+    private static final DeprecationLogger deprecationLogger = DeprecationLogger.getLogger(DynamicMap.class);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f4a22e182cda9aa2d9772da3ae92ea8829b50e7c"}, "originalPosition": 14}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc1NDAwODk2", "url": "https://github.com/elastic/elasticsearch/pull/61530#pullrequestreview-475400896", "createdAt": "2020-08-26T11:35:23Z", "commit": {"oid": "f4a22e182cda9aa2d9772da3ae92ea8829b50e7c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNlQxMTozNToyM1rOHHH9jw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNlQxMTozNToyM1rOHHH9jw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzIzMjUyNw==", "bodyText": "And this one.", "url": "https://github.com/elastic/elasticsearch/pull/61530#discussion_r477232527", "createdAt": "2020-08-26T11:35:23Z", "author": {"login": "pugnascotia"}, "path": "server/src/main/java/org/elasticsearch/script/FieldScript.java", "diffHunk": "@@ -39,8 +38,7 @@\n \n     public static final String[] PARAMETERS = {};\n \n-    private static final DeprecationLogger deprecationLogger =\n-            new DeprecationLogger(LogManager.getLogger(DynamicMap.class));\n+    private static final DeprecationLogger deprecationLogger = DeprecationLogger.getLogger(DynamicMap.class);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f4a22e182cda9aa2d9772da3ae92ea8829b50e7c"}, "originalPosition": 14}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc1NDAwOTg2", "url": "https://github.com/elastic/elasticsearch/pull/61530#pullrequestreview-475400986", "createdAt": "2020-08-26T11:35:31Z", "commit": {"oid": "f4a22e182cda9aa2d9772da3ae92ea8829b50e7c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNlQxMTozNTozMVrOHHH9yw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNlQxMTozNTozMVrOHHH9yw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzIzMjU4Nw==", "bodyText": "And this one.", "url": "https://github.com/elastic/elasticsearch/pull/61530#discussion_r477232587", "createdAt": "2020-08-26T11:35:31Z", "author": {"login": "pugnascotia"}, "path": "server/src/main/java/org/elasticsearch/script/ScoreScript.java", "diffHunk": "@@ -65,8 +64,7 @@ public Explanation get(double score, Explanation subQueryExplanation) {\n         }\n     }\n \n-    private static final DeprecationLogger deprecationLogger =\n-            new DeprecationLogger(LogManager.getLogger(DynamicMap.class));\n+    private static final DeprecationLogger deprecationLogger = DeprecationLogger.getLogger(DynamicMap.class);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f4a22e182cda9aa2d9772da3ae92ea8829b50e7c"}, "originalPosition": 14}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc1NDAxMTQ3", "url": "https://github.com/elastic/elasticsearch/pull/61530#pullrequestreview-475401147", "createdAt": "2020-08-26T11:35:44Z", "commit": {"oid": "f4a22e182cda9aa2d9772da3ae92ea8829b50e7c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNlQxMTozNTo0NFrOHHH-Rw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNlQxMTozNTo0NFrOHHH-Rw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzIzMjcxMQ==", "bodyText": "And this one.", "url": "https://github.com/elastic/elasticsearch/pull/61530#discussion_r477232711", "createdAt": "2020-08-26T11:35:44Z", "author": {"login": "pugnascotia"}, "path": "server/src/main/java/org/elasticsearch/script/ScriptedMetricAggContexts.java", "diffHunk": "@@ -66,8 +65,7 @@ public Object getState() {\n \n     public abstract static class MapScript {\n \n-        private static final DeprecationLogger deprecationLogger =\n-                new DeprecationLogger(LogManager.getLogger(DynamicMap.class));\n+        private static final DeprecationLogger deprecationLogger = DeprecationLogger.getLogger(DynamicMap.class);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f4a22e182cda9aa2d9772da3ae92ea8829b50e7c"}, "originalPosition": 14}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc1NDA0NDA2", "url": "https://github.com/elastic/elasticsearch/pull/61530#pullrequestreview-475404406", "createdAt": "2020-08-26T11:40:51Z", "commit": {"oid": "f4a22e182cda9aa2d9772da3ae92ea8829b50e7c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4729, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}