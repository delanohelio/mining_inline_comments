{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTQxOTQwMTI0", "number": 66533, "title": "A node with roles [ml, remote_cluster_client] is still dedicated ML", "bodyText": "Where CCS is being used it makes sense for ML nodes to have the\nremote_cluster_client role.  This single extra role is not\nsignificant enough to stop an ML node being considered a\n\"dedicated ML node\".", "createdAt": "2020-12-17T15:26:42Z", "url": "https://github.com/elastic/elasticsearch/pull/66533", "merged": true, "mergeCommit": {"oid": "bf78062ac593bb7f8bbb4a9ba38efb42e285f151"}, "closed": true, "closedAt": "2020-12-18T13:00:24Z", "author": {"login": "droberts195"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdnFLSQAH2gAyNTQxOTQwMTI0OjBlMGQ5NzA4NjZhNzVhM2I5ZGMyMTUzMWEzYzc5MTcyYzI3NGE5NWM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdnKKe9gFqTU1NDk5MDU0Ng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "0e0d970866a75a3b9dc21531a3c79172c274a95c", "author": {"user": {"login": "droberts195", "name": "David Roberts"}}, "url": "https://github.com/elastic/elasticsearch/commit/0e0d970866a75a3b9dc21531a3c79172c274a95c", "committedDate": "2020-12-17T15:22:08Z", "message": "A node with roles [ml, remote_cluster_client] is still dedicated ML\n\nWhere CCS is being used it makes sense for ML nodes to have the\nremote_cluster_client role.  This single extra role is not\nsignificant enough to stop an ML node being considered a\n\"dedicated ML node\"."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU0NzUxMDU5", "url": "https://github.com/elastic/elasticsearch/pull/66533#pullrequestreview-554751059", "createdAt": "2020-12-17T16:05:31Z", "commit": {"oid": "0e0d970866a75a3b9dc21531a3c79172c274a95c"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xN1QxNjowNTozMVrOIH815g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xN1QxNjowNzozMlrOIH88Jw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTIwNzc4Mg==", "bodyText": "This can be simplified to else if (containsOnly(roles, \"ml\", \"remote_cluster_client\"). That simply asserts that only the listed roles area llowd to be in the given collection, but a subset is fine as well.", "url": "https://github.com/elastic/elasticsearch/pull/66533#discussion_r545207782", "createdAt": "2020-12-17T16:05:31Z", "author": {"login": "mark-vieira"}, "path": "distribution/tools/launchers/src/main/java/org/elasticsearch/tools/launchers/MachineDependentHeap.java", "diffHunk": "@@ -142,7 +142,7 @@ public static MachineNodeRole parse(InputStream config) {\n                         return MachineNodeRole.DATA;\n                     } else if (containsOnly(roles, \"master\")) {\n                         return MachineNodeRole.MASTER_ONLY;\n-                    } else if (containsOnly(roles, \"ml\")) {\n+                    } else if (containsOnly(roles, \"ml\") || containsOnly(roles, \"ml\", \"remote_cluster_client\")) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0e0d970866a75a3b9dc21531a3c79172c274a95c"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTIwOTM4Mw==", "bodyText": "Thinking now, this would also be true in a case where a node had only the remote_cluster_client role, so maybe we might want to assert roles.contains(\"ml\") && containsOnly(roles, \"ml\", \"remote_cluster_client\")", "url": "https://github.com/elastic/elasticsearch/pull/66533#discussion_r545209383", "createdAt": "2020-12-17T16:07:32Z", "author": {"login": "mark-vieira"}, "path": "distribution/tools/launchers/src/main/java/org/elasticsearch/tools/launchers/MachineDependentHeap.java", "diffHunk": "@@ -142,7 +142,7 @@ public static MachineNodeRole parse(InputStream config) {\n                         return MachineNodeRole.DATA;\n                     } else if (containsOnly(roles, \"master\")) {\n                         return MachineNodeRole.MASTER_ONLY;\n-                    } else if (containsOnly(roles, \"ml\")) {\n+                    } else if (containsOnly(roles, \"ml\") || containsOnly(roles, \"ml\", \"remote_cluster_client\")) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTIwNzc4Mg=="}, "originalCommit": {"oid": "0e0d970866a75a3b9dc21531a3c79172c274a95c"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0db908c3be52d32c2ae41a8213b85bba5e51b47e", "author": {"user": {"login": "droberts195", "name": "David Roberts"}}, "url": "https://github.com/elastic/elasticsearch/commit/0db908c3be52d32c2ae41a8213b85bba5e51b47e", "committedDate": "2020-12-17T16:22:30Z", "message": "Fix logic to exclude remote_cluster_client on its own"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU0OTkwNTQ2", "url": "https://github.com/elastic/elasticsearch/pull/66533#pullrequestreview-554990546", "createdAt": "2020-12-17T21:10:47Z", "commit": {"oid": "0db908c3be52d32c2ae41a8213b85bba5e51b47e"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4487, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}