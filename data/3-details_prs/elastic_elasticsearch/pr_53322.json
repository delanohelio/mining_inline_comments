{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg1ODkzMjU0", "number": 53322, "title": "Add endpoint to delete a service provider by ID", "bodyText": "This API is a sibling to the existing Put SAML Service Provider API\nthat registers a new SP.\nThe implementation is a hard delete.", "createdAt": "2020-03-10T01:36:18Z", "url": "https://github.com/elastic/elasticsearch/pull/53322", "merged": true, "mergeCommit": {"oid": "2ab89953785258e85628f0c0da5c7b37eea1f1b7"}, "closed": true, "closedAt": "2020-03-13T03:27:57Z", "author": {"login": "tvernum"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcMIUKNAH2gAyMzg1ODkzMjU0OmJlNmQxZjMxNDEzYWM5OGY1YmM0MDZkOGIxZDdjNmY4NjRhYmQ3NWI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcNGj7JAH2gAyMzg1ODkzMjU0OmJkNGFmZTQ3OTM4NTcwNjM5ZjQwN2RhNDNkNGEwMDA2OGFkNWU4ODA=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "be6d1f31413ac98f5bc406d8b1d7c6f864abd75b", "author": {"user": {"login": "tvernum", "name": "Tim Vernum"}}, "url": "https://github.com/elastic/elasticsearch/commit/be6d1f31413ac98f5bc406d8b1d7c6f864abd75b", "committedDate": "2020-03-10T01:34:26Z", "message": "Add endpoint to delete a service provider by ID\n\nThis API is a sibling to the existing Put SAML Service Provider API\nthat registers a new SP.\n\nThe implementation is a hard delete."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcyODAyMzA0", "url": "https://github.com/elastic/elasticsearch/pull/53322#pullrequestreview-372802304", "createdAt": "2020-03-11T14:20:39Z", "commit": {"oid": "be6d1f31413ac98f5bc406d8b1d7c6f864abd75b"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMVQxNDoyMDozOVrOF05C6A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMVQxNDoyMzoyN1rOF05LDA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTAwNDkwNA==", "bodyText": "Should we also handle refresh policy here ( pass the one from the request ) ?", "url": "https://github.com/elastic/elasticsearch/pull/53322#discussion_r391004904", "createdAt": "2020-03-11T14:20:39Z", "author": {"login": "jkakavas"}, "path": "x-pack/plugin/identity-provider/src/main/java/org/elasticsearch/xpack/idp/saml/sp/SamlServiceProviderIndex.java", "diffHunk": "@@ -214,6 +216,17 @@ private boolean isTemplateUpToDate(ClusterState state) {\n         return TemplateUtils.checkTemplateExistsAndIsUpToDate(TEMPLATE_NAME, TEMPLATE_META_VERSION_KEY, state, logger);\n     }\n \n+    public void deleteDocument(DocumentVersion version, ActionListener<DeleteResponse> listener) {\n+        final DeleteRequest request = new DeleteRequest(aliasExists ? ALIAS_NAME : INDEX_NAME)\n+            .id(version.id)\n+            .setIfSeqNo(version.seqNo)\n+            .setIfPrimaryTerm(version.primaryTerm);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "be6d1f31413ac98f5bc406d8b1d7c6f864abd75b"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTAwNjk4OA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        logger.debug(\"Deleteed service provider document [{}] ({})\", version.id, response.getResult());\n          \n          \n            \n                        logger.debug(\"Deleted service provider document [{}] ({})\", version.id, response.getResult());", "url": "https://github.com/elastic/elasticsearch/pull/53322#discussion_r391006988", "createdAt": "2020-03-11T14:23:27Z", "author": {"login": "jkakavas"}, "path": "x-pack/plugin/identity-provider/src/main/java/org/elasticsearch/xpack/idp/saml/sp/SamlServiceProviderIndex.java", "diffHunk": "@@ -214,6 +216,17 @@ private boolean isTemplateUpToDate(ClusterState state) {\n         return TemplateUtils.checkTemplateExistsAndIsUpToDate(TEMPLATE_NAME, TEMPLATE_META_VERSION_KEY, state, logger);\n     }\n \n+    public void deleteDocument(DocumentVersion version, ActionListener<DeleteResponse> listener) {\n+        final DeleteRequest request = new DeleteRequest(aliasExists ? ALIAS_NAME : INDEX_NAME)\n+            .id(version.id)\n+            .setIfSeqNo(version.seqNo)\n+            .setIfPrimaryTerm(version.primaryTerm);\n+        client.delete(request, ActionListener.wrap(response -> {\n+            logger.debug(\"Deleteed service provider document [{}] ({})\", version.id, response.getResult());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "be6d1f31413ac98f5bc406d8b1d7c6f864abd75b"}, "originalPosition": 19}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f43fbfeb946e8b7b3cdd0e5c264298546c539219", "author": {"user": {"login": "tvernum", "name": "Tim Vernum"}}, "url": "https://github.com/elastic/elasticsearch/commit/f43fbfeb946e8b7b3cdd0e5c264298546c539219", "committedDate": "2020-03-12T05:06:52Z", "message": "Merge branch 'feature-internal-idp' into idp/sp-delete"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f175d7710ac3cb5229c3eda026dacd94f380b61f", "author": {"user": {"login": "tvernum", "name": "Tim Vernum"}}, "url": "https://github.com/elastic/elasticsearch/commit/f175d7710ac3cb5229c3eda026dacd94f380b61f", "committedDate": "2020-03-12T05:18:26Z", "message": "Add refresh policy"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c9be7fd229ed2431e8b4a97a4052ba04236cdcbf", "author": {"user": {"login": "tvernum", "name": "Tim Vernum"}}, "url": "https://github.com/elastic/elasticsearch/commit/c9be7fd229ed2431e8b4a97a4052ba04236cdcbf", "committedDate": "2020-03-12T10:26:16Z", "message": "Switch to refresh policy NONE"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bd4afe47938570639f407da43d4a00068ad5e880", "author": {"user": {"login": "elasticmachine", "name": "Elastic Machine"}}, "url": "https://github.com/elastic/elasticsearch/commit/bd4afe47938570639f407da43d4a00068ad5e880", "committedDate": "2020-03-13T02:05:46Z", "message": "Merge branch 'feature-internal-idp' into idp/sp-delete"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1679, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}