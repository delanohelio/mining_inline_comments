{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTQyNjk2MjEy", "number": 66622, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xOFQxOToyMzoxN1rOFHUUwQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xOFQxOToyMzoxN1rOFHUUwQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQzMjE3MzQ1OnYy", "diffSide": "RIGHT", "path": "x-pack/plugin/ql/src/main/java/org/elasticsearch/xpack/ql/execution/search/extractor/AbstractFieldHitExtractor.java", "isResolved": false, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xOFQxOToyMzoxN1rOIIv7zw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMVQxMDozMTo0OVrOIJTl2w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjA0NDg3OQ==", "bodyText": "Are there any cases where the type is relevant for ignore malformed is set and the return value should not be null?\nIt is currently available for numeric, date , geo-points and IP (https://www.elastic.co/guide/en/elasticsearch/reference/current/ignore-malformed.html).\nI would argue that if it is set, null should be returned regardless of the data type.", "url": "https://github.com/elastic/elasticsearch/pull/66622#discussion_r546044879", "createdAt": "2020-12-18T19:23:17Z", "author": {"login": "costin"}, "path": "x-pack/plugin/ql/src/main/java/org/elasticsearch/xpack/ql/execution/search/extractor/AbstractFieldHitExtractor.java", "diffHunk": "@@ -129,10 +129,10 @@ public Object extract(SearchHit hit) {\n             if (fullFieldName != null\n                     && hit.getFields().containsKey(IgnoredFieldMapper.NAME)\n                     && isFromDocValuesOnly(dataType) == false\n-                    && dataType.isNumeric()) {\n+                    && (dataType.isNumeric() || dataType == DataTypes.IP)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "aeb3dbce49b5a50b755206393ec71333f16d2015"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjEyNTg2NQ==", "bodyText": "@costin Not 100% sure if null is always the answer. A null_value parameter, for example, doesn't apply in this case. If the parsing fails and ignore_malformed is true setting the null_value parameter will not return that value in this case. That field will still not be indexed.", "url": "https://github.com/elastic/elasticsearch/pull/66622#discussion_r546125865", "createdAt": "2020-12-18T22:45:39Z", "author": {"login": "astefan"}, "path": "x-pack/plugin/ql/src/main/java/org/elasticsearch/xpack/ql/execution/search/extractor/AbstractFieldHitExtractor.java", "diffHunk": "@@ -129,10 +129,10 @@ public Object extract(SearchHit hit) {\n             if (fullFieldName != null\n                     && hit.getFields().containsKey(IgnoredFieldMapper.NAME)\n                     && isFromDocValuesOnly(dataType) == false\n-                    && dataType.isNumeric()) {\n+                    && (dataType.isNumeric() || dataType == DataTypes.IP)) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjA0NDg3OQ=="}, "originalCommit": {"oid": "aeb3dbce49b5a50b755206393ec71333f16d2015"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjEzMzY0OA==", "bodyText": "Right, we don't know if the null value was set and thus return null. However my comment is regarding the data type, why does it matter?\nIf ignore malformed is set and the type is geo for example (which is not part of the if) the source data which is malformed is returned.\nThat is just like now for IP which this ticket addresses.\nI think returning null is a safer choice the returning potentially invalid data", "url": "https://github.com/elastic/elasticsearch/pull/66622#discussion_r546133648", "createdAt": "2020-12-18T23:01:00Z", "author": {"login": "costin"}, "path": "x-pack/plugin/ql/src/main/java/org/elasticsearch/xpack/ql/execution/search/extractor/AbstractFieldHitExtractor.java", "diffHunk": "@@ -129,10 +129,10 @@ public Object extract(SearchHit hit) {\n             if (fullFieldName != null\n                     && hit.getFields().containsKey(IgnoredFieldMapper.NAME)\n                     && isFromDocValuesOnly(dataType) == false\n-                    && dataType.isNumeric()) {\n+                    && (dataType.isNumeric() || dataType == DataTypes.IP)) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjA0NDg3OQ=="}, "originalCommit": {"oid": "aeb3dbce49b5a50b755206393ec71333f16d2015"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjYyOTA4Mw==", "bodyText": "geo_point is taken from docvalues, not from _source. shape doesn't seem to support docvalues and thus can only be extracted from _source. The same goes for keyword, date, datetime, scaled_float.\nAnd in this case we already have the null value from docvalues and we don't need the _source to extract data.\nBut, I see your point about checking the type itself. I think there is no need for this check, the presence of the ignored section in the response is enough", "url": "https://github.com/elastic/elasticsearch/pull/66622#discussion_r546629083", "createdAt": "2020-12-21T10:31:49Z", "author": {"login": "astefan"}, "path": "x-pack/plugin/ql/src/main/java/org/elasticsearch/xpack/ql/execution/search/extractor/AbstractFieldHitExtractor.java", "diffHunk": "@@ -129,10 +129,10 @@ public Object extract(SearchHit hit) {\n             if (fullFieldName != null\n                     && hit.getFields().containsKey(IgnoredFieldMapper.NAME)\n                     && isFromDocValuesOnly(dataType) == false\n-                    && dataType.isNumeric()) {\n+                    && (dataType.isNumeric() || dataType == DataTypes.IP)) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjA0NDg3OQ=="}, "originalCommit": {"oid": "aeb3dbce49b5a50b755206393ec71333f16d2015"}, "originalPosition": 5}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4488, "cost": 1, "resetAt": "2021-11-12T19:05:54Z"}}}