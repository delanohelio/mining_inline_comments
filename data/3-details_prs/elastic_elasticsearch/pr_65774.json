{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTMxMjU3Mjgw", "number": 65774, "title": "[ML] make InferenceIngestIT more lenient when checking cache miss counts", "bodyText": "Looking over the failure history, it is always the cache miss count that is off. This is mostly ok as all the failures had indicated that there were indeed cache failures and every one of them were fence-post errors.\nOpting to make the cache miss count check lenient as other stats checked verify consistency.\ncloses #61564", "createdAt": "2020-12-02T20:00:36Z", "url": "https://github.com/elastic/elasticsearch/pull/65774", "merged": true, "mergeCommit": {"oid": "ccad78e8f57ac8f1adc5877c5a011a0ec219da86"}, "closed": true, "closedAt": "2020-12-03T13:40:32Z", "author": {"login": "benwtrent"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdiUJLNgH2gAyNTMxMjU3MjgwOjUyZDY5ZDY5NDc5ZDEwYWI0ODlkMjM4MTA2YjhkYmVjYjdlNGNhMGE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdij0m8AFqTU0Mzk5MzY0Nw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "52d69d69479d10ab489d238106b8dbecb7e4ca0a", "author": {"user": {"login": "benwtrent", "name": "Benjamin Trent"}}, "url": "https://github.com/elastic/elasticsearch/commit/52d69d69479d10ab489d238106b8dbecb7e4ca0a", "committedDate": "2020-12-02T19:58:47Z", "message": "[ML] make InferenceIngestIT more lenient when checking cache miss counts"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9500f9abaa08f56f4070daa201b236a3285f5a75", "author": {"user": {"login": "benwtrent", "name": "Benjamin Trent"}}, "url": "https://github.com/elastic/elasticsearch/commit/9500f9abaa08f56f4070daa201b236a3285f5a75", "committedDate": "2020-12-02T21:30:17Z", "message": "test fix"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQzNjYzNzk3", "url": "https://github.com/elastic/elasticsearch/pull/65774#pullrequestreview-543663797", "createdAt": "2020-12-03T07:19:07Z", "commit": {"oid": "9500f9abaa08f56f4070daa201b236a3285f5a75"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wM1QwNzoxOTowN1rOH-BEVQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wM1QwNzoxOTowN1rOH-BEVQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDc5MTI1Mw==", "bodyText": "If I see correctly, the pattern of parsing the response and verifying getInferenceCount is repeated 4 times.\nPlease consider extracting the snippet to a separate method parameterized by the expected inference count.", "url": "https://github.com/elastic/elasticsearch/pull/65774#discussion_r534791253", "createdAt": "2020-12-03T07:19:07Z", "author": {"login": "przemekwitek"}, "path": "x-pack/plugin/ml/qa/native-multi-node-tests/src/javaRestTest/java/org/elasticsearch/xpack/ml/integration/InferenceIngestIT.java", "diffHunk": "@@ -135,13 +144,23 @@ public void testPathologicalPipelineCreationAndDeletion() throws Exception {\n             try {\n                 Response statsResponse = client().performRequest(new Request(\"GET\",\n                     \"_ml/trained_models/\" + classificationModelId + \"/_stats\"));\n-                String response = EntityUtils.toString(statsResponse.getEntity());\n-                assertThat(response, containsString(\"\\\"inference_count\\\":10\"));\n-                assertThat(response, containsString(\"\\\"cache_miss_count\\\":30\"));\n+                try (XContentParser parser = createParser(JsonXContent.jsonXContent, statsResponse.getEntity().getContent())) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9500f9abaa08f56f4070daa201b236a3285f5a75"}, "originalPosition": 38}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQzNzUzMjE0", "url": "https://github.com/elastic/elasticsearch/pull/65774#pullrequestreview-543753214", "createdAt": "2020-12-03T09:23:42Z", "commit": {"oid": "9500f9abaa08f56f4070daa201b236a3285f5a75"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b30be89598a7a4e14ec058791e38c28a6b9d20cc", "author": {"user": {"login": "benwtrent", "name": "Benjamin Trent"}}, "url": "https://github.com/elastic/elasticsearch/commit/b30be89598a7a4e14ec058791e38c28a6b9d20cc", "committedDate": "2020-12-03T12:17:45Z", "message": "addressing pr comment"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cd7ba3c6402ffb91f5538e473c8385b024c7dc2d", "author": {"user": {"login": "benwtrent", "name": "Benjamin Trent"}}, "url": "https://github.com/elastic/elasticsearch/commit/cd7ba3c6402ffb91f5538e473c8385b024c7dc2d", "committedDate": "2020-12-03T13:00:06Z", "message": "Update InferenceIngestIT.java"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQzOTkzNjQ3", "url": "https://github.com/elastic/elasticsearch/pull/65774#pullrequestreview-543993647", "createdAt": "2020-12-03T14:14:48Z", "commit": {"oid": "cd7ba3c6402ffb91f5538e473c8385b024c7dc2d"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4112, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}