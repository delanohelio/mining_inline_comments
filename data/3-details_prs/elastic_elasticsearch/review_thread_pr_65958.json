{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTMzNzc3Njkx", "number": 65958, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wN1QxNjowMzoxNVrOFB2sDg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wN1QxODowMzo0NVrOFB6XGA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM3NDg4OTEwOnYy", "diffSide": "RIGHT", "path": "x-pack/plugin/rollup/src/main/java/org/elasticsearch/xpack/rollup/v2/FieldValueFetcher.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wN1QxNjowMzoxNVrOIAt-OA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wN1QxNjowMzoxNVrOIAt-OA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzYyNDEyMA==", "bodyText": "is this class meant to be included in this PR?", "url": "https://github.com/elastic/elasticsearch/pull/65958#discussion_r537624120", "createdAt": "2020-12-07T16:03:15Z", "author": {"login": "talevy"}, "path": "x-pack/plugin/rollup/src/main/java/org/elasticsearch/xpack/rollup/v2/FieldValueFetcher.java", "diffHunk": "@@ -0,0 +1,66 @@\n+/*", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e36f0aebc9d4e16bc9621e90f343185bf5d319ee"}, "originalPosition": 1}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM3NDkwMzU5OnYy", "diffSide": "RIGHT", "path": "x-pack/plugin/transform/src/test/java/org/elasticsearch/xpack/transform/transforms/TransformIndexerStateTests.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wN1QxNjowNjowN1rOIAuHPQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wN1QxNjowNjowN1rOIAuHPQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzYyNjQyOQ==", "bodyText": "not really important since this is just a test, but do we need to keep this executorName instance variable if it is static?", "url": "https://github.com/elastic/elasticsearch/pull/65958#discussion_r537626429", "createdAt": "2020-12-07T16:06:07Z", "author": {"login": "talevy"}, "path": "x-pack/plugin/transform/src/test/java/org/elasticsearch/xpack/transform/transforms/TransformIndexerStateTests.java", "diffHunk": "@@ -134,7 +132,7 @@\n                 context\n             );\n             this.threadPool = threadPool;\n-            this.executorName = executorName;\n+            this.executorName = ThreadPool.Names.GENERIC;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e36f0aebc9d4e16bc9621e90f343185bf5d319ee"}, "originalPosition": 21}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM3NTQ5MDgwOnYy", "diffSide": "RIGHT", "path": "x-pack/plugin/transform/src/test/java/org/elasticsearch/xpack/transform/transforms/TransformIndexerStateTests.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wN1QxODowMzo0NVrOIAzg3g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNlQxMjoxNjoyMlrOIHCe7g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzcxNDkxMA==", "bodyText": "I am not sure about this change. This got recently introduced:\n#65721\nto fix:\n#65542\nThe change reverts #65721 and we might get test failures again. However, I am not sure the test problem justifies keeping the executor name. \ud83e\udd14", "url": "https://github.com/elastic/elasticsearch/pull/65958#discussion_r537714910", "createdAt": "2020-12-07T18:03:45Z", "author": {"login": "hendrikmuhs"}, "path": "x-pack/plugin/transform/src/test/java/org/elasticsearch/xpack/transform/transforms/TransformIndexerStateTests.java", "diffHunk": "@@ -236,9 +231,8 @@ public void setUpMocks() {\n         auditor = MockTransformAuditor.createMockAuditor();\n         transformConfigManager = new InMemoryTransformConfigManager();\n         client = new NoOpClient(getTestName());\n-        // we need \"generic\" as part of the name, because it is asserted\n-        executorName = ThreadPool.Names.GENERIC + \"-\" + getTestName();\n-        threadPool = new TestThreadPool(executorName, new ScalingExecutorBuilder(executorName, 4, 10, TimeValue.timeValueSeconds(30)));\n+        threadPool = new TestThreadPool(ThreadPool.Names.GENERIC,\n+            new ScalingExecutorBuilder(ThreadPool.Names.GENERIC, 4, 10, TimeValue.timeValueSeconds(30)));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b7dc2270c0d44a988319856c1f2c0ae1e89ce4e0"}, "originalPosition": 65}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTY2Mjg1Ng==", "bodyText": "I don't think that #65542 is caused by the thread pool. If an assertion fails in the test, the indexer is not stopped and continues to fire request asynchronously. So #65721 fixes the error message caused by the test failure but not the failure itself. I guess there is a race condition that can make this assertTrue to fail in some exceptional case.\nI can add a try/finally block to ensure that we stop the indexer when an assertion fails, that will clarify things the next time a failure happens. Does that make sense ?", "url": "https://github.com/elastic/elasticsearch/pull/65958#discussion_r539662856", "createdAt": "2020-12-09T21:31:21Z", "author": {"login": "jimczi"}, "path": "x-pack/plugin/transform/src/test/java/org/elasticsearch/xpack/transform/transforms/TransformIndexerStateTests.java", "diffHunk": "@@ -236,9 +231,8 @@ public void setUpMocks() {\n         auditor = MockTransformAuditor.createMockAuditor();\n         transformConfigManager = new InMemoryTransformConfigManager();\n         client = new NoOpClient(getTestName());\n-        // we need \"generic\" as part of the name, because it is asserted\n-        executorName = ThreadPool.Names.GENERIC + \"-\" + getTestName();\n-        threadPool = new TestThreadPool(executorName, new ScalingExecutorBuilder(executorName, 4, 10, TimeValue.timeValueSeconds(30)));\n+        threadPool = new TestThreadPool(ThreadPool.Names.GENERIC,\n+            new ScalingExecutorBuilder(ThreadPool.Names.GENERIC, 4, 10, TimeValue.timeValueSeconds(30)));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzcxNDkxMA=="}, "originalCommit": {"oid": "b7dc2270c0d44a988319856c1f2c0ae1e89ce4e0"}, "originalPosition": 65}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDI1MTYzMA==", "bodyText": "#65542 failed when a new search request got scheduled but the thread pool was closed. The order of timestamps show that it 1st tried to queue the request than the failure happened, not vice versa. So the threadpool got closed.\nHowever, I am fine with an alternative implementation and enhanced error handling and logging in case of the error. This should help to find the root cause the next time it happens (which seems to be rare).", "url": "https://github.com/elastic/elasticsearch/pull/65958#discussion_r544251630", "createdAt": "2020-12-16T12:16:22Z", "author": {"login": "hendrikmuhs"}, "path": "x-pack/plugin/transform/src/test/java/org/elasticsearch/xpack/transform/transforms/TransformIndexerStateTests.java", "diffHunk": "@@ -236,9 +231,8 @@ public void setUpMocks() {\n         auditor = MockTransformAuditor.createMockAuditor();\n         transformConfigManager = new InMemoryTransformConfigManager();\n         client = new NoOpClient(getTestName());\n-        // we need \"generic\" as part of the name, because it is asserted\n-        executorName = ThreadPool.Names.GENERIC + \"-\" + getTestName();\n-        threadPool = new TestThreadPool(executorName, new ScalingExecutorBuilder(executorName, 4, 10, TimeValue.timeValueSeconds(30)));\n+        threadPool = new TestThreadPool(ThreadPool.Names.GENERIC,\n+            new ScalingExecutorBuilder(ThreadPool.Names.GENERIC, 4, 10, TimeValue.timeValueSeconds(30)));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzcxNDkxMA=="}, "originalCommit": {"oid": "b7dc2270c0d44a988319856c1f2c0ae1e89ce4e0"}, "originalPosition": 65}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1784, "cost": 1, "resetAt": "2021-11-12T11:57:46Z"}}}