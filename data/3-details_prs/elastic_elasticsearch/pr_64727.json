{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE2ODE5OTIy", "number": 64727, "title": "[ML] Fix bug with data frame analytics classification test data sampling when using custom feature processors", "bodyText": "When using custom processors, the field names extracted from the documents are not the\nsame as the feature names used for training.\nConsequently, it is possible for the stratified sampler to have an incorrect view of the feature rows.\nThis can lead to the wrong column being read for the class label, and thus throw errors on training\nrow extraction.\nThis commit changes the training row feature names used by the stratified sampler so that it matches\nthe names (and their order) that are sent to the analytics process.", "createdAt": "2020-11-06T15:31:12Z", "url": "https://github.com/elastic/elasticsearch/pull/64727", "merged": true, "mergeCommit": {"oid": "806541b9c4cde525e233316d76e346527761b7fa"}, "closed": true, "closedAt": "2020-11-10T12:26:03Z", "author": {"login": "benwtrent"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdZ4oOrAH2gAyNTE2ODE5OTIyOjI0N2NlMDNmMzgyNDg1N2NmOWVhNDY0Zjg4MjE0MDQ1MjZjOGU4MmE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdbFJP2gFqTUyNjk2MjQ4NQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "247ce03f3824857cf9ea464f8821404526c8e82a", "author": {"user": {"login": "benwtrent", "name": "Benjamin Trent"}}, "url": "https://github.com/elastic/elasticsearch/commit/247ce03f3824857cf9ea464f8821404526c8e82a", "committedDate": "2020-11-06T15:23:58Z", "message": "[ML] Fix bug with data frame analytics classification test data sampling when using custom feature processors"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI1Mjc1MDY1", "url": "https://github.com/elastic/elasticsearch/pull/64727#pullrequestreview-525275065", "createdAt": "2020-11-06T15:49:11Z", "commit": {"oid": "247ce03f3824857cf9ea464f8821404526c8e82a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNlQxNTo0OToxMlrOHuzZqQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNlQxNTo0OToxMlrOHuzZqQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODgzODY5Nw==", "bodyText": "I wonder if it would make sense for this and extractProcessedFeatureNames to become member methods of ExtractedFields and get them unit tested too.", "url": "https://github.com/elastic/elasticsearch/pull/64727#discussion_r518838697", "createdAt": "2020-11-06T15:49:12Z", "author": {"login": "dimitris-athanasiou"}, "path": "x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/dataframe/extractor/DataFrameDataExtractorFactory.java", "diffHunk": "@@ -94,8 +97,30 @@ public static DataFrameDataExtractorFactory createForSourceIndices(Client client\n \n     private static TrainTestSplitterFactory createTrainTestSplitterFactory(Client client, DataFrameAnalyticsConfig config,\n                                                                            ExtractedFields extractedFields) {\n-        return new TrainTestSplitterFactory(client, config,\n-            extractedFields.getAllFields().stream().map(ExtractedField::getName).collect(Collectors.toList()));\n+        return new TrainTestSplitterFactory(\n+            client,\n+            config,\n+            Stream.concat(Arrays.stream(\n+                extractOrganicFeatureNames(extractedFields)),\n+                Arrays.stream(extractProcessedFeatureNames(extractedFields))\n+            ).collect(Collectors.toList()));\n+    }\n+\n+    static String[] extractOrganicFeatureNames(ExtractedFields extractedFields) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "247ce03f3824857cf9ea464f8821404526c8e82a"}, "originalPosition": 32}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f4e5d52a47b71e35fa952775e7f162ba0b40fce5", "author": {"user": {"login": "elasticmachine", "name": "Elastic Machine"}}, "url": "https://github.com/elastic/elasticsearch/commit/f4e5d52a47b71e35fa952775e7f162ba0b40fce5", "committedDate": "2020-11-06T15:51:08Z", "message": "Merge branch 'master' into bugfix/ml-dfa-custom-proc-sampling"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a0f3f4f982ef50bbbc68e03a238a04d128c2b917", "author": {"user": {"login": "benwtrent", "name": "Benjamin Trent"}}, "url": "https://github.com/elastic/elasticsearch/commit/a0f3f4f982ef50bbbc68e03a238a04d128c2b917", "committedDate": "2020-11-06T16:26:37Z", "message": "Merge remote-tracking branch 'upstream/master' into bugfix/ml-dfa-custom-proc-sampling"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "badccc2bcfd2b4b1414bd9175a3d546fe70be9de", "author": {"user": {"login": "benwtrent", "name": "Benjamin Trent"}}, "url": "https://github.com/elastic/elasticsearch/commit/badccc2bcfd2b4b1414bd9175a3d546fe70be9de", "committedDate": "2020-11-09T18:13:18Z", "message": "addressing PR comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b6e7f2a0ce928086e5ba83b08d28f56fc1df5645", "author": {"user": {"login": "benwtrent", "name": "Benjamin Trent"}}, "url": "https://github.com/elastic/elasticsearch/commit/b6e7f2a0ce928086e5ba83b08d28f56fc1df5645", "committedDate": "2020-11-09T18:13:35Z", "message": "Merge remote-tracking branch 'upstream/master' into bugfix/ml-dfa-custom-proc-sampling"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "962ba254457feb03fd765a2e43de8954a942be4e", "author": {"user": {"login": "benwtrent", "name": "Benjamin Trent"}}, "url": "https://github.com/elastic/elasticsearch/commit/962ba254457feb03fd765a2e43de8954a942be4e", "committedDate": "2020-11-09T18:13:48Z", "message": "Merge branch 'bugfix/ml-dfa-custom-proc-sampling' of github.com:benwtrent/elasticsearch into bugfix/ml-dfa-custom-proc-sampling"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI2OTYyNDg1", "url": "https://github.com/elastic/elasticsearch/pull/64727#pullrequestreview-526962485", "createdAt": "2020-11-10T08:32:50Z", "commit": {"oid": "962ba254457feb03fd765a2e43de8954a942be4e"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1237, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}