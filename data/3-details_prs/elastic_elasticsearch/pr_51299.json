{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY1NzU5NTk2", "number": 51299, "title": "Fix tests requiring timezone alignment", "bodyText": "This PR will have the test comparing H2 against ES results have the\nH2 timezone sent to ES. This ensures that some timezone sensitive tests\nwhose results otherwise differ, will always work, no matter the\nrandomised timezone chosen for the test.\nCloses #37045", "createdAt": "2020-01-22T09:52:27Z", "url": "https://github.com/elastic/elasticsearch/pull/51299", "merged": true, "mergeCommit": {"oid": "e2af33846d6384a5c8149704d53a75fbe99e90e6"}, "closed": true, "closedAt": "2020-01-27T16:47:24Z", "author": {"login": "bpintea"}, "timelineItems": {"totalCount": 13, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb8ylSbAH2gAyMzY1NzU5NTk2Ojg1NWQyZTA3M2I5ZTY5ZmUzYWYxOTUzODkzYWIxYWE3OGI1MTdlY2Y=", "endCursor": "Y3Vyc29yOnYyOpPPAAABb-e0hMgH2gAyMzY1NzU5NTk2OjEyOTVkNmU5NjdkMDlkNjkzNGQ2ZGVkYjY4M2UwNmYxYWFhZWVjMTU=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "855d2e073b9e69fe3af1953893ab1aa78b517ecf", "author": {"user": {"login": "bpintea", "name": "Bogdan Pintea"}}, "url": "https://github.com/elastic/elasticsearch/commit/855d2e073b9e69fe3af1953893ab1aa78b517ecf", "committedDate": "2020-01-22T09:46:22Z", "message": "Fix tests requiring timezone alignment\n\nThis commit will have the test comparing H2 against ES results have the\nH2 timezone sent to ES. This ensures that some timezone sensitive tests\nwhose results otherwise differ, will always work, no matter the\nrandomized timezone chosen for the test."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5b5b577be41e9d342e8a4002f5742597578c1386", "author": {"user": {"login": "bpintea", "name": "Bogdan Pintea"}}, "url": "https://github.com/elastic/elasticsearch/commit/5b5b577be41e9d342e8a4002f5742597578c1386", "committedDate": "2020-01-22T10:02:03Z", "message": "remove disallowed API\n\n- removing use of String.toUpperCase()."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ2NTA0ODk4", "url": "https://github.com/elastic/elasticsearch/pull/51299#pullrequestreview-346504898", "createdAt": "2020-01-22T11:03:54Z", "commit": {"oid": "5b5b577be41e9d342e8a4002f5742597578c1386"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ2NzE3NDUy", "url": "https://github.com/elastic/elasticsearch/pull/51299#pullrequestreview-346717452", "createdAt": "2020-01-22T16:18:20Z", "commit": {"oid": "5b5b577be41e9d342e8a4002f5742597578c1386"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMlQxNjoxODoyMVrOFgiN6w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMlQxNjoxODoyMVrOFgiN6w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTY1OTM3MQ==", "bodyText": "Also move/remove this comment?", "url": "https://github.com/elastic/elasticsearch/pull/51299#discussion_r369659371", "createdAt": "2020-01-22T16:18:21Z", "author": {"login": "matriv"}, "path": "x-pack/plugin/sql/qa/src/main/resources/datetime.sql-spec", "diffHunk": "@@ -119,8 +119,6 @@ dayOfWeekGroupBy\n SELECT DAY_OF_WEEK(birth_date) day, COUNT(*) c FROM test_emp WHERE DAY_OF_WEEK(birth_date) < 6 GROUP BY day ORDER BY DAY_OF_WEEK(birth_date);\n \n // current", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5b5b577be41e9d342e8a4002f5742597578c1386"}, "originalPosition": 3}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8c236b9de2166ecd1fc1e751ac1cb75107f060db", "author": {"user": {"login": "bpintea", "name": "Bogdan Pintea"}}, "url": "https://github.com/elastic/elasticsearch/commit/8c236b9de2166ecd1fc1e751ac1cb75107f060db", "committedDate": "2020-01-22T21:44:00Z", "message": "Prevent TZ-tests from running before hour change\n\nPrevent tests requring TZ sync'ing from running before the hour changes\n(which could trigger a day/month/year change).\n\nAlso comment better why TZ-sync'ing is required."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "12784ee92f3a223e620e050bfc381fd9e85d0ce3", "author": {"user": {"login": "bpintea", "name": "Bogdan Pintea"}}, "url": "https://github.com/elastic/elasticsearch/commit/12784ee92f3a223e620e050bfc381fd9e85d0ce3", "committedDate": "2020-01-22T21:46:42Z", "message": "Add more CURRENT_DATE/_TIME tests\n\nAlso change the MINUTE() tests to work with static values; the dynamic\n\"current\" ones can change between runs against H2 and ES."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "45a2b9bc1adb7fe5e9b7b1ab70653d3212531a7b", "author": {"user": {"login": "bpintea", "name": "Bogdan Pintea"}}, "url": "https://github.com/elastic/elasticsearch/commit/45a2b9bc1adb7fe5e9b7b1ab70653d3212531a7b", "committedDate": "2020-01-22T21:59:45Z", "message": "fix code style not cought by prechecks\n\ns/final private/private final/"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e0c485d1ef3d5b0aece683a5a52ba65f316a3a1d", "author": {"user": {"login": "bpintea", "name": "Bogdan Pintea"}}, "url": "https://github.com/elastic/elasticsearch/commit/e0c485d1ef3d5b0aece683a5a52ba65f316a3a1d", "committedDate": "2020-01-22T22:15:45Z", "message": "fix API usage with defaults\n\nLocalDateTime.now() needs to be given a ZoneId"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6db05ec9b5c11d5a1c72ff9d57571432fa1629b1", "author": {"user": {"login": "bpintea", "name": "Bogdan Pintea"}}, "url": "https://github.com/elastic/elasticsearch/commit/6db05ec9b5c11d5a1c72ff9d57571432fa1629b1", "committedDate": "2020-01-23T08:45:07Z", "message": "Further fixes for tests\n\n- MINUTE requires TZ sync when extracting from a timestamp, but needs\nmuting when comes from a time (H2 not having timezones attached to\nthose)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "929ecc0f9cef09fe8f8159ce63091bbb0f3f1198", "author": {"user": {"login": "elasticmachine", "name": "Elastic Machine"}}, "url": "https://github.com/elastic/elasticsearch/commit/929ecc0f9cef09fe8f8159ce63091bbb0f3f1198", "committedDate": "2020-01-23T11:21:04Z", "message": "Merge branch 'master' into fix/timezone_sensitive_tests"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ4Njg5OTA0", "url": "https://github.com/elastic/elasticsearch/pull/51299#pullrequestreview-348689904", "createdAt": "2020-01-27T14:12:55Z", "commit": {"oid": "929ecc0f9cef09fe8f8159ce63091bbb0f3f1198"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yN1QxNDoxMjo1NVrOFiD-qQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yN1QxNDoxMjo1NVrOFiD-qQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTI2MTA5Nw==", "bodyText": "The name of the constant, I believe, has a typo in it: THREASHOLD vs THRESHOLD.", "url": "https://github.com/elastic/elasticsearch/pull/51299#discussion_r371261097", "createdAt": "2020-01-27T14:12:55Z", "author": {"login": "astefan"}, "path": "x-pack/plugin/sql/qa/src/main/java/org/elasticsearch/xpack/sql/qa/jdbc/SqlSpecTestCase.java", "diffHunk": "@@ -13,15 +13,19 @@\n import java.net.URL;\n import java.sql.Connection;\n import java.sql.ResultSet;\n+import java.time.LocalDateTime;\n+import java.time.ZoneId;\n import java.util.Arrays;\n import java.util.List;\n import java.util.Locale;\n+import java.util.TimeZone;\n \n /**\n  * Tests comparing sql queries executed against our jdbc client\n  * with those executed against H2's jdbc client.\n  */\n public abstract class SqlSpecTestCase extends SpecBaseIntegrationTestCase {\n+    private final int TZSYNC_MINUTE_THREASHOLD = 55;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "929ecc0f9cef09fe8f8159ce63091bbb0f3f1198"}, "originalPosition": 16}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ4NzM3NDUy", "url": "https://github.com/elastic/elasticsearch/pull/51299#pullrequestreview-348737452", "createdAt": "2020-01-27T15:13:18Z", "commit": {"oid": "929ecc0f9cef09fe8f8159ce63091bbb0f3f1198"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1295d6e967d09d6934d6dedb683e06f1aaaeec15", "author": {"user": {"login": "bpintea", "name": "Bogdan Pintea"}}, "url": "https://github.com/elastic/elasticsearch/commit/1295d6e967d09d6934d6dedb683e06f1aaaeec15", "committedDate": "2020-01-27T15:52:45Z", "message": "Address review comments\n\ns/THREASHOLD/THRESHOLD/"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2842, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}