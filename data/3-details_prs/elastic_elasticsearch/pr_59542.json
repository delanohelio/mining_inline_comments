{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ4OTMxOTY0", "number": 59542, "title": "[ML] add new `custom` field to trained model processors", "bodyText": "This commit adds the new configurable field custom.\ncustom indicates if the preprocessor was submitted by a user or automatically created by the analytics job.\nEventually, this field will be used in calculating feature importance. When custom is true, the feature importance for\nthe processed fields is calculated. When false the current behavior is the same (we calculate the importance for the originating field/feature).\nThis also adds new required methods to the preprocessor interface. If users are to supply their own preprocessors\nin the analytics job configuration, we need to know the input and output field names.\ncloses  #59328", "createdAt": "2020-07-14T14:52:56Z", "url": "https://github.com/elastic/elasticsearch/pull/59542", "merged": true, "mergeCommit": {"oid": "b551f75ec3640e05415223387b1454ee45ddc6e9"}, "closed": true, "closedAt": "2020-07-16T13:35:57Z", "author": {"login": "benwtrent"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc03J4dgH2gAyNDQ4OTMxOTY0Ojc4MWJhODgwNjBjYmU1Y2E1YTkwZjZiYzIwYmY2NGQ5NDQ1ODhhMDQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc1eDgZgH2gAyNDQ4OTMxOTY0OjE4ZjEyZGJiMDdlODA1ZTZmM2Y5YjdkZmU4ZDQ5NGRjN2I3MTA3NDI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "781ba88060cbe5ca5a90f6bc20bf64d944588a04", "author": {"user": {"login": "benwtrent", "name": "Benjamin Trent"}}, "url": "https://github.com/elastic/elasticsearch/commit/781ba88060cbe5ca5a90f6bc20bf64d944588a04", "committedDate": "2020-07-14T14:45:43Z", "message": "[ML] add new fields to trained model processors"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ5MTc4ODQy", "url": "https://github.com/elastic/elasticsearch/pull/59542#pullrequestreview-449178842", "createdAt": "2020-07-15T17:28:47Z", "commit": {"oid": "781ba88060cbe5ca5a90f6bc20bf64d944588a04"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNVQxNzoyODo0N1rOGyIKTA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNVQxNzoyODo0N1rOGyIKTA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTIxNTY5Mg==", "bodyText": "@elastic/ml-docs what do y'all think?", "url": "https://github.com/elastic/elasticsearch/pull/59542#discussion_r455215692", "createdAt": "2020-07-15T17:28:47Z", "author": {"login": "benwtrent"}, "path": "docs/reference/ml/df-analytics/apis/put-inference.asciidoc", "diffHunk": "@@ -94,6 +94,14 @@ The field name to encode.\n `frequency_map`::\n (Required, object map of string:double)\n Object that maps the field value to the frequency encoded value.\n+\n+`custom`::\n+(Optional, boolean)\n+Boolean value indicating if the analytics job created the preprocessor\n+or if a user provided it. This adjusts the feature importance calculation.\n+When `true`, the feature importance calculation returns importance for the\n+processed feature. When `false`, the total importance of the original field\n+is returned. Default is `false`.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "781ba88060cbe5ca5a90f6bc20bf64d944588a04"}, "originalPosition": 11}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ5NjgzODcw", "url": "https://github.com/elastic/elasticsearch/pull/59542#pullrequestreview-449683870", "createdAt": "2020-07-16T09:37:22Z", "commit": {"oid": "781ba88060cbe5ca5a90f6bc20bf64d944588a04"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNlQwOTozNzoyMlrOGyjHPw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNlQwOTozNzoyMlrOGyjHPw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTY1NzI3OQ==", "bodyText": "Why not add setCustom(Boolean isCustom) to the builder?\nThe builder is public whereas the ctor is package private, if the intention is to allow HLRC users to define custom preprocessors then why hide it. Or is there more work required to enable this?", "url": "https://github.com/elastic/elasticsearch/pull/59542#discussion_r455657279", "createdAt": "2020-07-16T09:37:22Z", "author": {"login": "davidkyle"}, "path": "client/rest-high-level/src/main/java/org/elasticsearch/client/ml/inference/preprocessing/FrequencyEncoding.java", "diffHunk": "@@ -154,7 +166,7 @@ public Builder addFrequency(String valueName, double frequency) {\n         }\n \n         public FrequencyEncoding build() {\n-            return new FrequencyEncoding(field, featureName, frequencyMap);\n+            return new FrequencyEncoding(field, featureName, frequencyMap, null);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "781ba88060cbe5ca5a90f6bc20bf64d944588a04"}, "originalPosition": 77}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ5Njk5Mzc4", "url": "https://github.com/elastic/elasticsearch/pull/59542#pullrequestreview-449699378", "createdAt": "2020-07-16T09:58:20Z", "commit": {"oid": "781ba88060cbe5ca5a90f6bc20bf64d944588a04"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNlQwOTo1ODoyMVrOGyj4NQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNlQwOTo1ODoyMVrOGyj4NQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTY2OTgxMw==", "bodyText": "Put this in ml-shared", "url": "https://github.com/elastic/elasticsearch/pull/59542#discussion_r455669813", "createdAt": "2020-07-16T09:58:21Z", "author": {"login": "davidkyle"}, "path": "docs/reference/ml/df-analytics/apis/put-inference.asciidoc", "diffHunk": "@@ -138,6 +154,14 @@ The field name to encode.\n `target_map`:::\n (Required, object map of string:double)\n Object that maps the field value to the target mean value.\n+\n+`custom`::\n+(Optional, boolean)\n+Boolean value indicating if the analytics job created the preprocessor", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "781ba88060cbe5ca5a90f6bc20bf64d944588a04"}, "originalPosition": 37}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ5NzUyNjAz", "url": "https://github.com/elastic/elasticsearch/pull/59542#pullrequestreview-449752603", "createdAt": "2020-07-16T11:18:51Z", "commit": {"oid": "781ba88060cbe5ca5a90f6bc20bf64d944588a04"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNlQxMToxODo1MVrOGymd2Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNlQxMToxODo1MVrOGymd2Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTcxMjIxNw==", "bodyText": "@benwtrent The text looks good to me. As you use it in multiple places, maybe it would be good to define custom in the ml-shared.asciidoc and reference it from there. Please let me know if I can help.", "url": "https://github.com/elastic/elasticsearch/pull/59542#discussion_r455712217", "createdAt": "2020-07-16T11:18:51Z", "author": {"login": "szabosteve"}, "path": "docs/reference/ml/df-analytics/apis/put-inference.asciidoc", "diffHunk": "@@ -94,6 +94,14 @@ The field name to encode.\n `frequency_map`::\n (Required, object map of string:double)\n Object that maps the field value to the frequency encoded value.\n+\n+`custom`::\n+(Optional, boolean)\n+Boolean value indicating if the analytics job created the preprocessor\n+or if a user provided it. This adjusts the feature importance calculation.\n+When `true`, the feature importance calculation returns importance for the\n+processed feature. When `false`, the total importance of the original field\n+is returned. Default is `false`.", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTIxNTY5Mg=="}, "originalCommit": {"oid": "781ba88060cbe5ca5a90f6bc20bf64d944588a04"}, "originalPosition": 11}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ5Nzc4NTU3", "url": "https://github.com/elastic/elasticsearch/pull/59542#pullrequestreview-449778557", "createdAt": "2020-07-16T11:59:48Z", "commit": {"oid": "781ba88060cbe5ca5a90f6bc20bf64d944588a04"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0aa05235b646f254f42aa43f3cff1e026602ea0d", "author": {"user": {"login": "benwtrent", "name": "Benjamin Trent"}}, "url": "https://github.com/elastic/elasticsearch/commit/0aa05235b646f254f42aa43f3cff1e026602ea0d", "committedDate": "2020-07-16T12:04:38Z", "message": "addressing PR comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "18f12dbb07e805e6f3f9b7dfe8d494dc7b710742", "author": {"user": {"login": "benwtrent", "name": "Benjamin Trent"}}, "url": "https://github.com/elastic/elasticsearch/commit/18f12dbb07e805e6f3f9b7dfe8d494dc7b710742", "committedDate": "2020-07-16T12:05:03Z", "message": "Merge remote-tracking branch 'upstream/master' into feature/ml-add-processor-fields"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4493, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}