{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzczMTA5Mzc3", "number": 52141, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMVQxMDoyNzoxNFrODewDiw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMVQxMDoyNzozMFrODewD9A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMzNTcxMjExOnYy", "diffSide": "RIGHT", "path": "x-pack/plugin/security/src/test/java/org/elasticsearch/xpack/security/authz/AuthorizationUtilsTests.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMVQxMDoyNzoxNFrOFoDyTw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMVQxMDoyNzoxNFrOFoDyTw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzU0OTM5MQ==", "bodyText": "\ud83d\udc4d", "url": "https://github.com/elastic/elasticsearch/pull/52141#discussion_r377549391", "createdAt": "2020-02-11T10:27:14Z", "author": {"login": "tvernum"}, "path": "x-pack/plugin/security/src/test/java/org/elasticsearch/xpack/security/authz/AuthorizationUtilsTests.java", "diffHunk": "@@ -95,9 +97,15 @@ public void testSwitchAndExecuteXpackSecurityUser() throws Exception {\n     }\n \n     public void testSwitchAndExecuteXpackUser() throws Exception {\n-        String origin = randomFrom(ClientHelper.ML_ORIGIN, ClientHelper.WATCHER_ORIGIN, ClientHelper.DEPRECATION_ORIGIN,\n-                ClientHelper.MONITORING_ORIGIN, ClientHelper.PERSISTENT_TASK_ORIGIN, ClientHelper.INDEX_LIFECYCLE_ORIGIN);\n-        assertSwitchBasedOnOriginAndExecute(origin, XPackUser.INSTANCE);\n+        for (String origin : Arrays.asList(ClientHelper.ML_ORIGIN, ClientHelper.WATCHER_ORIGIN, ClientHelper.DEPRECATION_ORIGIN,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "aba72789fee0fb53c14df5fa5126c2f35acc17bb"}, "originalPosition": 22}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMzNTcxMzE2OnYy", "diffSide": "RIGHT", "path": "x-pack/plugin/security/src/test/java/org/elasticsearch/xpack/security/authz/store/CompositeRolesStoreTests.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMVQxMDoyNzozMFrOFoDy9g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMVQxMDoyNzozMFrOFoDy9g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzU0OTU1OA==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    // test AyncSearch user short circuits to its onw reserved role\n          \n          \n            \n                    // test AyncSearch user short circuits to its own reserved role", "url": "https://github.com/elastic/elasticsearch/pull/52141#discussion_r377549558", "createdAt": "2020-02-11T10:27:30Z", "author": {"login": "tvernum"}, "path": "x-pack/plugin/security/src/test/java/org/elasticsearch/xpack/security/authz/store/CompositeRolesStoreTests.java", "diffHunk": "@@ -959,13 +960,23 @@ public void testDoesNotUseRolesStoreForXPackUser() {\n                 rds -> effectiveRoleDescriptors.set(rds));\n         verify(fileRolesStore).addListener(any(Consumer.class)); // adds a listener in ctor\n \n+        // test Xpack user short circuits to its own reserved role\n         PlainActionFuture<Role> rolesFuture = new PlainActionFuture<>();\n         Authentication auth = new Authentication(XPackUser.INSTANCE, new RealmRef(\"name\", \"type\", \"node\"), null);\n         compositeRolesStore.getRoles(XPackUser.INSTANCE, auth, rolesFuture);\n-        final Role roles = rolesFuture.actionGet();\n+        Role roles = rolesFuture.actionGet();\n         assertThat(roles, equalTo(XPackUser.ROLE));\n         assertThat(effectiveRoleDescriptors.get(), is(nullValue()));\n         verifyNoMoreInteractions(fileRolesStore, nativeRolesStore, reservedRolesStore);\n+\n+        // test AyncSearch user short circuits to its onw reserved role", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "aba72789fee0fb53c14df5fa5126c2f35acc17bb"}, "originalPosition": 31}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4878, "cost": 1, "resetAt": "2021-11-12T13:16:51Z"}}}