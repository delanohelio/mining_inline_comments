{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg3MjU0NjMz", "number": 53481, "title": "Ignore isJoda flag from 7x nodes", "bodyText": "when upgrading from 7.7+ ES will send out a flag indicating if a pattern is of joda style. This is only used to support joda style indices in 7.x, in 8 we no longer support this.  All indices in 8 should use java style pattern. Hence we can ignore this flag. Similarly when writing from v8 to v7.7+ we should always send false flag.\nrelates #52555", "createdAt": "2020-03-12T13:49:26Z", "url": "https://github.com/elastic/elasticsearch/pull/53481", "merged": true, "mergeCommit": {"oid": "5ccb3b675ed28d45f1140b0ae04d583f4831a976"}, "closed": true, "closedAt": "2020-03-12T17:09:15Z", "author": {"login": "pgomulka"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcM7-tWAH2gAyMzg3MjU0NjMzOjJiOTg1ZjEwNTUzZmUyYWY0NDgyNjM1MGRhMmM1MzdkYmU1NTA3YmU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcM-uCDAFqTM3MzczNTE3Ng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "2b985f10553fe2af44826350da2c537dbe5507be", "author": {"user": {"login": "pgomulka", "name": "Przemyslaw Gomulka"}}, "url": "https://github.com/elastic/elasticsearch/commit/2b985f10553fe2af44826350da2c537dbe5507be", "committedDate": "2020-03-12T13:46:04Z", "message": "Ignore isJoda flag from 7x nodes\n\nwhen upgrading from 7.7+ ES will send out a flag indicating if a pattern\nis of joda style. This is only used to support joda style indices in\n7.x, in 8 we no longer support this.  All indices in 8 should use java style pattern.\nHence we can ignore this flag."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9b3978f40f64203028c4f563ed60e6c1c3bc50cd", "author": {"user": {"login": "pgomulka", "name": "Przemyslaw Gomulka"}}, "url": "https://github.com/elastic/elasticsearch/commit/9b3978f40f64203028c4f563ed60e6c1c3bc50cd", "committedDate": "2020-03-12T13:48:14Z", "message": "Merge branch 'master' into joda/swallow_flag"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1a2109971d89e681120fadcd65f29252cfcd372c", "author": {"user": {"login": "pgomulka", "name": "Przemyslaw Gomulka"}}, "url": "https://github.com/elastic/elasticsearch/commit/1a2109971d89e681120fadcd65f29252cfcd372c", "committedDate": "2020-03-12T13:48:50Z", "message": "unmute"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "88c0d1ebfe7941842e99ec128a0ddbfcb546678e", "author": {"user": {"login": "pgomulka", "name": "Przemyslaw Gomulka"}}, "url": "https://github.com/elastic/elasticsearch/commit/88c0d1ebfe7941842e99ec128a0ddbfcb546678e", "committedDate": "2020-03-12T14:20:42Z", "message": "fix version condition"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7bd055c4db5456d92f28c74f3b64dff14a543db0", "author": {"user": {"login": "pgomulka", "name": "Przemyslaw Gomulka"}}, "url": "https://github.com/elastic/elasticsearch/commit/7bd055c4db5456d92f28c74f3b64dff14a543db0", "committedDate": "2020-03-12T15:26:56Z", "message": "serialize write  method"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzczNjg2MDI5", "url": "https://github.com/elastic/elasticsearch/pull/53481#pullrequestreview-373686029", "createdAt": "2020-03-12T15:57:55Z", "commit": {"oid": "7bd055c4db5456d92f28c74f3b64dff14a543db0"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMlQxNTo1Nzo1NVrOF1kwMA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMlQxNTo1Nzo1NVrOF1kwMA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTcyMTAwOA==", "bodyText": "I think this should be false", "url": "https://github.com/elastic/elasticsearch/pull/53481#discussion_r391721008", "createdAt": "2020-03-12T15:57:55Z", "author": {"login": "jaymode"}, "path": "server/src/main/java/org/elasticsearch/search/DocValueFormat.java", "diffHunk": "@@ -213,6 +221,13 @@ public void writeTo(StreamOutput out) throws IOException {\n             out.writeString(formatter.pattern());\n             out.writeString(timeZone.getId());\n             out.writeVInt(resolution.ordinal());\n+            if (out.getVersion().onOrAfter(Version.V_7_7_0) && out.getVersion().before(Version.V_8_0_0)) {\n+                /* when serializing to 7.7+  send out a flag indicating if a pattern is of joda style\n+                   This is only used to support joda style indices in 7.x, in 8 we no longer support this.\n+                   All indices in 8 should use java style pattern. Hence this flag is always true.\n+                */\n+                out.writeBoolean(true);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7bd055c4db5456d92f28c74f3b64dff14a543db0"}, "originalPosition": 31}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "26ad3792fa22afaddbe414c012daa0a830128362", "author": {"user": {"login": "pgomulka", "name": "Przemyslaw Gomulka"}}, "url": "https://github.com/elastic/elasticsearch/commit/26ad3792fa22afaddbe414c012daa0a830128362", "committedDate": "2020-03-12T15:59:30Z", "message": "flag should always be false as it is isJoda flag"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzczNjg4NTQx", "url": "https://github.com/elastic/elasticsearch/pull/53481#pullrequestreview-373688541", "createdAt": "2020-03-12T16:00:43Z", "commit": {"oid": "26ad3792fa22afaddbe414c012daa0a830128362"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzczNzM1MTc2", "url": "https://github.com/elastic/elasticsearch/pull/53481#pullrequestreview-373735176", "createdAt": "2020-03-12T16:56:49Z", "commit": {"oid": "26ad3792fa22afaddbe414c012daa0a830128362"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMlQxNjo1Njo1MFrOF1nGpw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMlQxNjo1NzoyNlrOF1nINA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTc1OTUyNw==", "bodyText": "I think the in.getVersion().onOrAfter(Version.V_7_7_0) can be removed, but I can understand keeping it for clarity and safety.", "url": "https://github.com/elastic/elasticsearch/pull/53481#discussion_r391759527", "createdAt": "2020-03-12T16:56:50Z", "author": {"login": "benwtrent"}, "path": "server/src/main/java/org/elasticsearch/search/DocValueFormat.java", "diffHunk": "@@ -201,6 +202,13 @@ public DateTime(StreamInput in) throws IOException {\n             String zoneId = in.readString();\n             this.timeZone = ZoneId.of(zoneId);\n             this.resolution = DateFieldMapper.Resolution.ofOrdinal(in.readVInt());\n+            if (in.getVersion().onOrAfter(Version.V_7_7_0) && in.getVersion().before(Version.V_8_0_0)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "26ad3792fa22afaddbe414c012daa0a830128362"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTc1OTkyNA==", "bodyText": "similar comment as before out.getVersion().onOrAfter(Version.V_7_7_0) I don't think is strictly necessary. But nothing wrong with keeping it.", "url": "https://github.com/elastic/elasticsearch/pull/53481#discussion_r391759924", "createdAt": "2020-03-12T16:57:26Z", "author": {"login": "benwtrent"}, "path": "server/src/main/java/org/elasticsearch/search/DocValueFormat.java", "diffHunk": "@@ -213,6 +221,13 @@ public void writeTo(StreamOutput out) throws IOException {\n             out.writeString(formatter.pattern());\n             out.writeString(timeZone.getId());\n             out.writeVInt(resolution.ordinal());\n+            if (out.getVersion().onOrAfter(Version.V_7_7_0) && out.getVersion().before(Version.V_8_0_0)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "26ad3792fa22afaddbe414c012daa0a830128362"}, "originalPosition": 26}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1563, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}