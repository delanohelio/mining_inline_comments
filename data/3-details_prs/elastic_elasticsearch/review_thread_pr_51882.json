{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzcwOTk4MTUy", "number": 51882, "reviewThreads": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNFQxOTowNjowM1rODdF_EA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wN1QwOTo0Mzo0NlrODd9xHw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMxODMzMzYwOnYy", "diffSide": "RIGHT", "path": "distribution/archives/build.gradle", "isResolved": true, "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNFQxOTowNjowM1rOFlf7nA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNlQyMDo0MzoyMVrOFmpkZA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDg2NDc5Ng==", "bodyText": "Should we include an example/readme/etc in here to make this a little more self-documenting and so folks don't think this is some kind of mistake? I guess the way I see it is either a) we expect folks to read our documentation, at which point they'll just go ahead and create this folder or b) we don't, and we want to lead them towards this capability, at which point we should probably provide a bit more context. Thoughts?", "url": "https://github.com/elastic/elasticsearch/pull/51882#discussion_r374864796", "createdAt": "2020-02-04T19:06:03Z", "author": {"login": "mark-vieira"}, "path": "distribution/archives/build.gradle", "diffHunk": "@@ -44,6 +44,11 @@ task createPluginsDir(type: EmptyDirTask) {\n   dir = \"${pluginsDir}\"\n   dirMode = 0755\n }\n+ext.jvmOptionsDir = new File(buildDir, 'jvm-options-hack/jvm.options.d')", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "98a315c97ee01a765d0880b1b9d7ea207d0bac91"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDg4NjY5NQ==", "bodyText": "Here's what I wanted to do: move the default heap options out of the root jvm.options into jvm.options.d/heap.options. We can't do this: it will break users that have provisioning in place to customize the heap size in the jvm.options file because jvm.options.d/heap.options would override this. It would break users badly, including Cloud.\nOne option here is to add a jvm.options.d/heap.options file with the heap size commented out and still remaining in jvm.options with a comment pointing to jvm.optioins.d/heap.options.\nThe primary reason that users customize JVM options is to customize the heap size. We have documentation on how to customize the heap size, which now points to jvm.options.d. My preference is that users consult this and the JVM options documentation as the single source for how to customize jvm.options.\n\na) we expect folks to read our documentation, at which point they'll just go ahead and create this folder\n\nThis isn't necessary since the purpose of the hack that you're commenting on is to include this empty directory in the archive.\nThoughts?", "url": "https://github.com/elastic/elasticsearch/pull/51882#discussion_r374886695", "createdAt": "2020-02-04T19:49:41Z", "author": {"login": "jasontedor"}, "path": "distribution/archives/build.gradle", "diffHunk": "@@ -44,6 +44,11 @@ task createPluginsDir(type: EmptyDirTask) {\n   dir = \"${pluginsDir}\"\n   dirMode = 0755\n }\n+ext.jvmOptionsDir = new File(buildDir, 'jvm-options-hack/jvm.options.d')", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDg2NDc5Ng=="}, "originalCommit": {"oid": "98a315c97ee01a765d0880b1b9d7ea207d0bac91"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDg4OTA0NA==", "bodyText": "One downside of providing a heap.options file with the distribution is that it will mistakenly lead users to think that that file is special when in fact the heap options can be present in any file in jvm.options.d, and the last one wins. We might want to instead call this custom.options, if we go this route.", "url": "https://github.com/elastic/elasticsearch/pull/51882#discussion_r374889044", "createdAt": "2020-02-04T19:54:24Z", "author": {"login": "jasontedor"}, "path": "distribution/archives/build.gradle", "diffHunk": "@@ -44,6 +44,11 @@ task createPluginsDir(type: EmptyDirTask) {\n   dir = \"${pluginsDir}\"\n   dirMode = 0755\n }\n+ext.jvmOptionsDir = new File(buildDir, 'jvm-options-hack/jvm.options.d')", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDg2NDc5Ng=="}, "originalCommit": {"oid": "98a315c97ee01a765d0880b1b9d7ea207d0bac91"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDkyMDc1Mw==", "bodyText": "This isn't necessary since the purpose of the hack that you're commenting on is to include this empty directory in the archive.\n\nRight, I get we want to create the empty directory, but without any content, it's purpose is a bit unclear. One option is just to put a readme.txt or similar in there to describe what the folder is for. Perhaps we could provide a simple snippet about setting heap options in there as an example. That way we can also make it clear that filenames are irrelevant.", "url": "https://github.com/elastic/elasticsearch/pull/51882#discussion_r374920753", "createdAt": "2020-02-04T21:02:29Z", "author": {"login": "mark-vieira"}, "path": "distribution/archives/build.gradle", "diffHunk": "@@ -44,6 +44,11 @@ task createPluginsDir(type: EmptyDirTask) {\n   dir = \"${pluginsDir}\"\n   dirMode = 0755\n }\n+ext.jvmOptionsDir = new File(buildDir, 'jvm-options-hack/jvm.options.d')", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDg2NDc5Ng=="}, "originalCommit": {"oid": "98a315c97ee01a765d0880b1b9d7ea207d0bac91"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjA3MTI2OA==", "bodyText": "I'd rather not duplicate the documentation, our syntax is our own and users need to consult the documentation to understand it.", "url": "https://github.com/elastic/elasticsearch/pull/51882#discussion_r376071268", "createdAt": "2020-02-06T20:43:21Z", "author": {"login": "jasontedor"}, "path": "distribution/archives/build.gradle", "diffHunk": "@@ -44,6 +44,11 @@ task createPluginsDir(type: EmptyDirTask) {\n   dir = \"${pluginsDir}\"\n   dirMode = 0755\n }\n+ext.jvmOptionsDir = new File(buildDir, 'jvm-options-hack/jvm.options.d')", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDg2NDc5Ng=="}, "originalCommit": {"oid": "98a315c97ee01a765d0880b1b9d7ea207d0bac91"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMxODM0NzEwOnYy", "diffSide": "RIGHT", "path": "docs/reference/setup/jvm-options.asciidoc", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNFQxOToxMDo0MlrOFlgEIg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNFQyMTowMDozM1rOFljSnA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDg2Njk3OA==", "bodyText": "This last sentence seems to be contradicting itself. Do we use lexicographic order, or is this non-deterministic? Lexicographic order is pretty strictly defined. If we are just iterating over a directory list (which it seems we are) then we shouldn't imply any kind of ordering guarantees. FWIW, it would be trivial for us to actually perform a sort here, which would allow folks to do stuff like 10_options and 00_options for layering overrides in a reliable way.", "url": "https://github.com/elastic/elasticsearch/pull/51882#discussion_r374866978", "createdAt": "2020-02-04T19:10:42Z", "author": {"login": "mark-vieira"}, "path": "docs/reference/setup/jvm-options.asciidoc", "diffHunk": "@@ -5,14 +5,21 @@ You should rarely need to change Java Virtual Machine (JVM) options. If you do,\n the most likely change is setting the <<heap-size,heap size>>. The remainder of\n this document explains in detail how to set JVM options.\n \n-The preferred method of setting JVM options (including system properties and JVM\n-flags) is via the `jvm.options` configuration file. The default location of this\n-file is `config/jvm.options` (when installing from the tar or zip distributions)\n-and `/etc/elasticsearch/jvm.options` (when installing from the Debian or RPM\n-packages).\n+The preferred method of setting or overriding JVM options (including system\n+properties and JVM flags) is via custom JVM options files. The root\n+`jvm.options` configuration file is `config/jvm.options` and custom JVM options\n+files can be added to `config/jvm.options.d/` (when installing from the tar or\n+zip distributions), and `/etc/elasticsearch/jvm.options` and custom JVM options\n+files can be added to `/etc/elasticsearch/jvm.options.d/` (when installing from\n+the Debian or RPM packages). When using the\n+<<docker, Docker distribution of {es}>> you can bind mount these files into\n+`/usr/share/elasticsearch/config/jvm.options.d/`. You should never need to\n+modify the root `jvm.options` file instead preferring to use custom JVM options\n+files. Custom JVM options files are processed in lexicographic order (although", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "98a315c97ee01a765d0880b1b9d7ea207d0bac91"}, "originalPosition": 19}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDg4MDEyMw==", "bodyText": "We do sort them, see https://github.com/elastic/elasticsearch/pull/51882/files#diff-38516abb6f177c355f29699955e7e60eR68 in the implementation. However, this relies on the Path#compareTo implementation which explicitly says:\n     * Compares two abstract paths lexicographically. The ordering defined by\n     * this method is provider specific, and in the case of the default\n     * provider, platform specific. This method does not access the file system\n     * and neither file is required to exist.\n\n\"Provider\" here refers to the filesystem provider. I am assuming (but did not investigate) this enables to account for odd sorting behavior such as on Windows via StrCmpLogicalW which sorts filenames by like f-1, f-2, f-10 in the order f-1, f-2, f-10 instead of f-1, f-10, f-2.", "url": "https://github.com/elastic/elasticsearch/pull/51882#discussion_r374880123", "createdAt": "2020-02-04T19:36:22Z", "author": {"login": "jasontedor"}, "path": "docs/reference/setup/jvm-options.asciidoc", "diffHunk": "@@ -5,14 +5,21 @@ You should rarely need to change Java Virtual Machine (JVM) options. If you do,\n the most likely change is setting the <<heap-size,heap size>>. The remainder of\n this document explains in detail how to set JVM options.\n \n-The preferred method of setting JVM options (including system properties and JVM\n-flags) is via the `jvm.options` configuration file. The default location of this\n-file is `config/jvm.options` (when installing from the tar or zip distributions)\n-and `/etc/elasticsearch/jvm.options` (when installing from the Debian or RPM\n-packages).\n+The preferred method of setting or overriding JVM options (including system\n+properties and JVM flags) is via custom JVM options files. The root\n+`jvm.options` configuration file is `config/jvm.options` and custom JVM options\n+files can be added to `config/jvm.options.d/` (when installing from the tar or\n+zip distributions), and `/etc/elasticsearch/jvm.options` and custom JVM options\n+files can be added to `/etc/elasticsearch/jvm.options.d/` (when installing from\n+the Debian or RPM packages). When using the\n+<<docker, Docker distribution of {es}>> you can bind mount these files into\n+`/usr/share/elasticsearch/config/jvm.options.d/`. You should never need to\n+modify the root `jvm.options` file instead preferring to use custom JVM options\n+files. Custom JVM options files are processed in lexicographic order (although", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDg2Njk3OA=="}, "originalCommit": {"oid": "98a315c97ee01a765d0880b1b9d7ea207d0bac91"}, "originalPosition": 19}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDkxOTgzNg==", "bodyText": "I'm inclined to say that if this differs across providers we should even mention that it's lexicographic or not, or even perform the sort for that matter. If we do want to order, we should use a JDK implementation that isn't filesystem dependent, such as simply doing a String ordering using the filename. Which I think is effectively going to be what you described in your example.", "url": "https://github.com/elastic/elasticsearch/pull/51882#discussion_r374919836", "createdAt": "2020-02-04T21:00:33Z", "author": {"login": "mark-vieira"}, "path": "docs/reference/setup/jvm-options.asciidoc", "diffHunk": "@@ -5,14 +5,21 @@ You should rarely need to change Java Virtual Machine (JVM) options. If you do,\n the most likely change is setting the <<heap-size,heap size>>. The remainder of\n this document explains in detail how to set JVM options.\n \n-The preferred method of setting JVM options (including system properties and JVM\n-flags) is via the `jvm.options` configuration file. The default location of this\n-file is `config/jvm.options` (when installing from the tar or zip distributions)\n-and `/etc/elasticsearch/jvm.options` (when installing from the Debian or RPM\n-packages).\n+The preferred method of setting or overriding JVM options (including system\n+properties and JVM flags) is via custom JVM options files. The root\n+`jvm.options` configuration file is `config/jvm.options` and custom JVM options\n+files can be added to `config/jvm.options.d/` (when installing from the tar or\n+zip distributions), and `/etc/elasticsearch/jvm.options` and custom JVM options\n+files can be added to `/etc/elasticsearch/jvm.options.d/` (when installing from\n+the Debian or RPM packages). When using the\n+<<docker, Docker distribution of {es}>> you can bind mount these files into\n+`/usr/share/elasticsearch/config/jvm.options.d/`. You should never need to\n+modify the root `jvm.options` file instead preferring to use custom JVM options\n+files. Custom JVM options files are processed in lexicographic order (although", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDg2Njk3OA=="}, "originalCommit": {"oid": "98a315c97ee01a765d0880b1b9d7ea207d0bac91"}, "originalPosition": 19}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMxODM1Mjc1OnYy", "diffSide": "RIGHT", "path": "docs/reference/setup/jvm-options.asciidoc", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNFQxOToxMjoyNlrOFlgHsQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNFQxOToxMjoyNlrOFlgHsQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDg2Nzg4OQ==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            JVM options files contains line-delimited list of JVM arguments following a\n          \n          \n            \n            JVM options files contain a line-delimited list of JVM arguments following a", "url": "https://github.com/elastic/elasticsearch/pull/51882#discussion_r374867889", "createdAt": "2020-02-04T19:12:26Z", "author": {"login": "mark-vieira"}, "path": "docs/reference/setup/jvm-options.asciidoc", "diffHunk": "@@ -5,14 +5,21 @@ You should rarely need to change Java Virtual Machine (JVM) options. If you do,\n the most likely change is setting the <<heap-size,heap size>>. The remainder of\n this document explains in detail how to set JVM options.\n \n-The preferred method of setting JVM options (including system properties and JVM\n-flags) is via the `jvm.options` configuration file. The default location of this\n-file is `config/jvm.options` (when installing from the tar or zip distributions)\n-and `/etc/elasticsearch/jvm.options` (when installing from the Debian or RPM\n-packages).\n+The preferred method of setting or overriding JVM options (including system\n+properties and JVM flags) is via custom JVM options files. The root\n+`jvm.options` configuration file is `config/jvm.options` and custom JVM options\n+files can be added to `config/jvm.options.d/` (when installing from the tar or\n+zip distributions), and `/etc/elasticsearch/jvm.options` and custom JVM options\n+files can be added to `/etc/elasticsearch/jvm.options.d/` (when installing from\n+the Debian or RPM packages). When using the\n+<<docker, Docker distribution of {es}>> you can bind mount these files into\n+`/usr/share/elasticsearch/config/jvm.options.d/`. You should never need to\n+modify the root `jvm.options` file instead preferring to use custom JVM options\n+files. Custom JVM options files are processed in lexicographic order (although\n+the ordering is filesystem and platform specific).\n \n-This file contains a line-delimited list of JVM arguments following\n-a special syntax:\n+JVM options files contains line-delimited list of JVM arguments following a", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "98a315c97ee01a765d0880b1b9d7ea207d0bac91"}, "originalPosition": 24}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMyMzk4MjU1OnYy", "diffSide": "RIGHT", "path": "distribution/tools/launchers/src/main/java/org/elasticsearch/tools/launchers/JvmOptionsParser.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNlQxMDoyNToyN1rOFmWG7w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNlQyMDo0MDozMVrOFmpfaw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTc1MjQzMQ==", "bodyText": "I found this a little hard to grok, so I whipped up a non-stream version, just FYI.\nfinal List<Path> jvmOptionsFiles = new ArrayList<>();\njvmOptionsFiles.add(Paths.get(args[0], \"jvm.options\"));\n\nfinal File jvmOptionsDirectory = Paths.get(args[0], \"jvm.options.d\").toFile();\nif (jvmOptionsDirectory.isDirectory()) {\n    final File[] files = jvmOptionsDirectory.listFiles();\n    Arrays.sort(files, Comparator.comparing(File::getName));\n\n    for (File file : files) {\n        jvmOptionsFiles.add(file.toPath());\n    }\n}", "url": "https://github.com/elastic/elasticsearch/pull/51882#discussion_r375752431", "createdAt": "2020-02-06T10:25:27Z", "author": {"login": "pugnascotia"}, "path": "distribution/tools/launchers/src/main/java/org/elasticsearch/tools/launchers/JvmOptionsParser.java", "diffHunk": "@@ -53,82 +55,88 @@\n      * The main entry point. The exit code is 0 if the JVM options were successfully parsed, otherwise the exit code is 1. If an improperly\n      * formatted line is discovered, the line is output to standard error.\n      *\n-     * @param args the args to the program which should consist of a single option, the path to the JVM options\n+     * @param args the args to the program which should consist of a single option, the path to ES_PATH_CONF\n      */\n     public static void main(final String[] args) throws InterruptedException, IOException {\n         if (args.length != 1) {\n-            throw new IllegalArgumentException(\"expected one argument specifying path to jvm.options but was \" + Arrays.toString(args));\n+            throw new IllegalArgumentException(\"expected one argument specifying path to ES_PATH_CONF but was \" + Arrays.toString(args));\n         }\n+\n+        final Stream<Path> jvmOptionsFiles;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d388d85283d13c01108a749b035dd088f98b4f63"}, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjA2OTk5NQ==", "bodyText": "Okay I pushed something else, what do you think now?", "url": "https://github.com/elastic/elasticsearch/pull/51882#discussion_r376069995", "createdAt": "2020-02-06T20:40:31Z", "author": {"login": "jasontedor"}, "path": "distribution/tools/launchers/src/main/java/org/elasticsearch/tools/launchers/JvmOptionsParser.java", "diffHunk": "@@ -53,82 +55,88 @@\n      * The main entry point. The exit code is 0 if the JVM options were successfully parsed, otherwise the exit code is 1. If an improperly\n      * formatted line is discovered, the line is output to standard error.\n      *\n-     * @param args the args to the program which should consist of a single option, the path to the JVM options\n+     * @param args the args to the program which should consist of a single option, the path to ES_PATH_CONF\n      */\n     public static void main(final String[] args) throws InterruptedException, IOException {\n         if (args.length != 1) {\n-            throw new IllegalArgumentException(\"expected one argument specifying path to jvm.options but was \" + Arrays.toString(args));\n+            throw new IllegalArgumentException(\"expected one argument specifying path to ES_PATH_CONF but was \" + Arrays.toString(args));\n         }\n+\n+        final Stream<Path> jvmOptionsFiles;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTc1MjQzMQ=="}, "originalCommit": {"oid": "d388d85283d13c01108a749b035dd088f98b4f63"}, "originalPosition": 29}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMyMzk4NTEwOnYy", "diffSide": "RIGHT", "path": "distribution/tools/launchers/src/main/java/org/elasticsearch/tools/launchers/JvmOptionsParser.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNlQxMDoyNjowNVrOFmWIgg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNlQyMDo0MDo0M1rOFmpfvQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTc1MjgzNA==", "bodyText": "Should we files the files e.g. only include those ending with .options? Then we'd filter out any backup files, text files etc.", "url": "https://github.com/elastic/elasticsearch/pull/51882#discussion_r375752834", "createdAt": "2020-02-06T10:26:05Z", "author": {"login": "pugnascotia"}, "path": "distribution/tools/launchers/src/main/java/org/elasticsearch/tools/launchers/JvmOptionsParser.java", "diffHunk": "@@ -53,82 +55,88 @@\n      * The main entry point. The exit code is 0 if the JVM options were successfully parsed, otherwise the exit code is 1. If an improperly\n      * formatted line is discovered, the line is output to standard error.\n      *\n-     * @param args the args to the program which should consist of a single option, the path to the JVM options\n+     * @param args the args to the program which should consist of a single option, the path to ES_PATH_CONF\n      */\n     public static void main(final String[] args) throws InterruptedException, IOException {\n         if (args.length != 1) {\n-            throw new IllegalArgumentException(\"expected one argument specifying path to jvm.options but was \" + Arrays.toString(args));\n+            throw new IllegalArgumentException(\"expected one argument specifying path to ES_PATH_CONF but was \" + Arrays.toString(args));\n         }\n+\n+        final Stream<Path> jvmOptionsFiles;\n+        final Path rootJvmOptions = Paths.get(args[0], \"jvm.options\");\n+        final Path jvmOptionsDirectory = Paths.get(args[0], \"jvm.options.d\");\n+        if (Files.isDirectory(jvmOptionsDirectory)) {\n+            final Stream<Path> jvmOptionsDirectoryFiles = Files.list(Paths.get(args[0], \"jvm.options.d\"));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d388d85283d13c01108a749b035dd088f98b4f63"}, "originalPosition": 33}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjA3MDA3Nw==", "bodyText": "I incorporated this idea.", "url": "https://github.com/elastic/elasticsearch/pull/51882#discussion_r376070077", "createdAt": "2020-02-06T20:40:43Z", "author": {"login": "jasontedor"}, "path": "distribution/tools/launchers/src/main/java/org/elasticsearch/tools/launchers/JvmOptionsParser.java", "diffHunk": "@@ -53,82 +55,88 @@\n      * The main entry point. The exit code is 0 if the JVM options were successfully parsed, otherwise the exit code is 1. If an improperly\n      * formatted line is discovered, the line is output to standard error.\n      *\n-     * @param args the args to the program which should consist of a single option, the path to the JVM options\n+     * @param args the args to the program which should consist of a single option, the path to ES_PATH_CONF\n      */\n     public static void main(final String[] args) throws InterruptedException, IOException {\n         if (args.length != 1) {\n-            throw new IllegalArgumentException(\"expected one argument specifying path to jvm.options but was \" + Arrays.toString(args));\n+            throw new IllegalArgumentException(\"expected one argument specifying path to ES_PATH_CONF but was \" + Arrays.toString(args));\n         }\n+\n+        final Stream<Path> jvmOptionsFiles;\n+        final Path rootJvmOptions = Paths.get(args[0], \"jvm.options\");\n+        final Path jvmOptionsDirectory = Paths.get(args[0], \"jvm.options.d\");\n+        if (Files.isDirectory(jvmOptionsDirectory)) {\n+            final Stream<Path> jvmOptionsDirectoryFiles = Files.list(Paths.get(args[0], \"jvm.options.d\"));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTc1MjgzNA=="}, "originalCommit": {"oid": "d388d85283d13c01108a749b035dd088f98b4f63"}, "originalPosition": 33}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMyMzk5MTM0OnYy", "diffSide": "RIGHT", "path": "docs/reference/setup/important-settings/heap-size.asciidoc", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNlQxMDoyODowOVrOFmWMdg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNlQxOTo1Nzo0NlrOFmoTDQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTc1Mzg0Ng==", "bodyText": "Similar to the other discussion in this PR, maybe we should use a different name here so that users don't think that heap.options is a special name?", "url": "https://github.com/elastic/elasticsearch/pull/51882#discussion_r375753846", "createdAt": "2020-02-06T10:28:09Z", "author": {"login": "pugnascotia"}, "path": "docs/reference/setup/important-settings/heap-size.asciidoc", "diffHunk": "@@ -49,7 +49,8 @@ caches, but the less memory it leaves available for the operating system to use\n for the filesystem cache. Also, larger heaps can cause longer garbage\n collection pauses.\n \n-Here are examples of how to set the heap size via the jvm.options file:\n+Here are examples of how to set the heap size via a `jvm.options.d/heap.options`", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d388d85283d13c01108a749b035dd088f98b4f63"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjA1MDQ0NQ==", "bodyText": "I removed the explicit filename.", "url": "https://github.com/elastic/elasticsearch/pull/51882#discussion_r376050445", "createdAt": "2020-02-06T19:57:46Z", "author": {"login": "jasontedor"}, "path": "docs/reference/setup/important-settings/heap-size.asciidoc", "diffHunk": "@@ -49,7 +49,8 @@ caches, but the less memory it leaves available for the operating system to use\n for the filesystem cache. Also, larger heaps can cause longer garbage\n collection pauses.\n \n-Here are examples of how to set the heap size via the jvm.options file:\n+Here are examples of how to set the heap size via a `jvm.options.d/heap.options`", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTc1Mzg0Ng=="}, "originalCommit": {"oid": "d388d85283d13c01108a749b035dd088f98b4f63"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMyMzk5OTc1OnYy", "diffSide": "RIGHT", "path": "docs/reference/setup/jvm-options.asciidoc", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNlQxMDozMDo0OFrOFmWRjQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNlQxOTo1NTo1NlrOFmoPvg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTc1NTE0OQ==", "bodyText": "The repetition of custom bothers me here...but I'm struggling to think of something better. Maybe the writers can help.", "url": "https://github.com/elastic/elasticsearch/pull/51882#discussion_r375755149", "createdAt": "2020-02-06T10:30:48Z", "author": {"login": "pugnascotia"}, "path": "docs/reference/setup/jvm-options.asciidoc", "diffHunk": "@@ -58,8 +65,8 @@ a special syntax:\n \n * all other lines are rejected\n \n-You can add custom JVM flags to this file and check this configuration into your\n-version control system.\n+You can add custom JVM flags to custom JVM options files and check these", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d388d85283d13c01108a749b035dd088f98b4f63"}, "originalPosition": 35}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjA0OTU5OA==", "bodyText": "I removed the line, I don't think it adds anything useful to the docs.", "url": "https://github.com/elastic/elasticsearch/pull/51882#discussion_r376049598", "createdAt": "2020-02-06T19:55:56Z", "author": {"login": "jasontedor"}, "path": "docs/reference/setup/jvm-options.asciidoc", "diffHunk": "@@ -58,8 +65,8 @@ a special syntax:\n \n * all other lines are rejected\n \n-You can add custom JVM flags to this file and check this configuration into your\n-version control system.\n+You can add custom JVM flags to custom JVM options files and check these", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTc1NTE0OQ=="}, "originalCommit": {"oid": "d388d85283d13c01108a749b035dd088f98b4f63"}, "originalPosition": 35}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMyNDAwOTg0OnYy", "diffSide": "RIGHT", "path": "qa/os/src/test/java/org/elasticsearch/packaging/test/PackageTests.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNlQxMDozMzo0MFrOFmWXVA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNlQxOTo1MDoyOVrOFmoFvA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTc1NjYyOA==", "bodyText": "Nit - I'd use a static import of Matchers, personally.", "url": "https://github.com/elastic/elasticsearch/pull/51882#discussion_r375756628", "createdAt": "2020-02-06T10:33:40Z", "author": {"login": "pugnascotia"}, "path": "qa/os/src/test/java/org/elasticsearch/packaging/test/PackageTests.java", "diffHunk": "@@ -298,7 +299,23 @@ public void test81CustomPathConfAndJvmOptions() throws Exception {\n         });\n     }\n \n-    public void test82SystemdMask() throws Exception {\n+    public void test82CustomJvmOptionsDirectoryFile() throws Exception {\n+        final Path heapOptions = installation.config(Paths.get(\"jvm.options.d\", \"heap.options\"));\n+        try {\n+            append(heapOptions, \"-Xms512m\\n-Xmx512m\\n\");\n+\n+            startElasticsearch();\n+\n+            final String nodesResponse = makeRequest(Request.Get(\"http://localhost:9200/_nodes\"));\n+            assertThat(nodesResponse, CoreMatchers.containsString(\"\\\"heap_init_in_bytes\\\":536870912\"));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d388d85283d13c01108a749b035dd088f98b4f63"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjA0NzAzNg==", "bodyText": "I pushed 3a2bf7b.", "url": "https://github.com/elastic/elasticsearch/pull/51882#discussion_r376047036", "createdAt": "2020-02-06T19:50:29Z", "author": {"login": "jasontedor"}, "path": "qa/os/src/test/java/org/elasticsearch/packaging/test/PackageTests.java", "diffHunk": "@@ -298,7 +299,23 @@ public void test81CustomPathConfAndJvmOptions() throws Exception {\n         });\n     }\n \n-    public void test82SystemdMask() throws Exception {\n+    public void test82CustomJvmOptionsDirectoryFile() throws Exception {\n+        final Path heapOptions = installation.config(Paths.get(\"jvm.options.d\", \"heap.options\"));\n+        try {\n+            append(heapOptions, \"-Xms512m\\n-Xmx512m\\n\");\n+\n+            startElasticsearch();\n+\n+            final String nodesResponse = makeRequest(Request.Get(\"http://localhost:9200/_nodes\"));\n+            assertThat(nodesResponse, CoreMatchers.containsString(\"\\\"heap_init_in_bytes\\\":536870912\"));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTc1NjYyOA=="}, "originalCommit": {"oid": "d388d85283d13c01108a749b035dd088f98b4f63"}, "originalPosition": 21}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMyNzQ3Mjk1OnYy", "diffSide": "RIGHT", "path": "qa/os/src/test/java/org/elasticsearch/packaging/test/ArchiveTests.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wN1QwOTo0Mzo0NlrOFm3d9Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wN1QxMzo0MzoyOFrOFm9X7w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjI5ODk5Nw==", "bodyText": "What do you think about adding a third file, e.g. third.options.disabled, to prove that files have to end with .options? Up to you.", "url": "https://github.com/elastic/elasticsearch/pull/51882#discussion_r376298997", "createdAt": "2020-02-07T09:43:46Z", "author": {"login": "pugnascotia"}, "path": "qa/os/src/test/java/org/elasticsearch/packaging/test/ArchiveTests.java", "diffHunk": "@@ -251,6 +251,46 @@ public void test70CustomPathConfAndJvmOptions() throws Exception {\n         }\n     }\n \n+    public void test71CustomJvmOptionsDirectoryFile() throws Exception {\n+        final Path heapOptions = installation.config(Paths.get(\"jvm.options.d\", \"heap.options\"));\n+        try {\n+            append(heapOptions, \"-Xms512m\\n-Xmx512m\\n\");\n+\n+            startElasticsearch();\n+\n+            final String nodesResponse = makeRequest(Request.Get(\"http://localhost:9200/_nodes\"));\n+            assertThat(nodesResponse, containsString(\"\\\"heap_init_in_bytes\\\":536870912\"));\n+\n+            stopElasticsearch();\n+        } finally {\n+            rm(heapOptions);\n+        }\n+    }\n+\n+    public void test72CustomJvmOptionsDirectoryFilesAreProcessedInSortedOrder() throws Exception {\n+        final Path firstOptions = installation.config(Paths.get(\"jvm.options.d\", \"first.options\"));\n+        final Path secondOptions = installation.config(Paths.get(\"jvm.options.d\", \"second.options\"));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "886b1a2fb3d1111c2e2e211e2b3c6c8cd6eaee9c"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjM5NTc1OQ==", "bodyText": "I pushed a test for this.", "url": "https://github.com/elastic/elasticsearch/pull/51882#discussion_r376395759", "createdAt": "2020-02-07T13:43:28Z", "author": {"login": "jasontedor"}, "path": "qa/os/src/test/java/org/elasticsearch/packaging/test/ArchiveTests.java", "diffHunk": "@@ -251,6 +251,46 @@ public void test70CustomPathConfAndJvmOptions() throws Exception {\n         }\n     }\n \n+    public void test71CustomJvmOptionsDirectoryFile() throws Exception {\n+        final Path heapOptions = installation.config(Paths.get(\"jvm.options.d\", \"heap.options\"));\n+        try {\n+            append(heapOptions, \"-Xms512m\\n-Xmx512m\\n\");\n+\n+            startElasticsearch();\n+\n+            final String nodesResponse = makeRequest(Request.Get(\"http://localhost:9200/_nodes\"));\n+            assertThat(nodesResponse, containsString(\"\\\"heap_init_in_bytes\\\":536870912\"));\n+\n+            stopElasticsearch();\n+        } finally {\n+            rm(heapOptions);\n+        }\n+    }\n+\n+    public void test72CustomJvmOptionsDirectoryFilesAreProcessedInSortedOrder() throws Exception {\n+        final Path firstOptions = installation.config(Paths.get(\"jvm.options.d\", \"first.options\"));\n+        final Path secondOptions = installation.config(Paths.get(\"jvm.options.d\", \"second.options\"));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjI5ODk5Nw=="}, "originalCommit": {"oid": "886b1a2fb3d1111c2e2e211e2b3c6c8cd6eaee9c"}, "originalPosition": 22}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4890, "cost": 1, "resetAt": "2021-11-12T13:16:51Z"}}}