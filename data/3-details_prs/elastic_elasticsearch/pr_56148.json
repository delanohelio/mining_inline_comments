{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDEzMTI3MTEx", "number": 56148, "title": "SQL: relax version lock between server and clients", "bodyText": "This PR is to allow older-than-server clients to connect, if these are past or on a\ncertain min release, 7.7.0.\nNote: the check is currently lower bounded only and subject to later adjustment to major minus one limitation.", "createdAt": "2020-05-04T19:00:13Z", "url": "https://github.com/elastic/elasticsearch/pull/56148", "merged": true, "mergeCommit": {"oid": "108f907297542ce649aa7304060aaf0a504eb699"}, "closed": true, "closedAt": "2020-05-05T15:15:39Z", "author": {"login": "bpintea"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABceEJhjAH2gAyNDEzMTI3MTExOjZlNjkzMzdiMTkzYzE4NWExNDIyYzYxY2VhNWJlNjNjYmUyYjhhMDM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABceR--fgH2gAyNDEzMTI3MTExOjQ2NmJlODMzOGFhNmQ3YzA5OWE2ZjcxNzM3NWU1MjA0OWZlYmM2MmY=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "6e69337b193c185a1422c61cea5be63cbe2b8a03", "author": {"user": {"login": "bpintea", "name": "Bogdan Pintea"}}, "url": "https://github.com/elastic/elasticsearch/commit/6e69337b193c185a1422c61cea5be63cbe2b8a03", "committedDate": "2020-05-04T18:53:50Z", "message": "Relax version lock between ES/SQL and clients\n\nAllow older-than-server clients to connect, if these are past or on a\ncertain min release."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA1Mjk5OTUx", "url": "https://github.com/elastic/elasticsearch/pull/56148#pullrequestreview-405299951", "createdAt": "2020-05-04T19:54:52Z", "commit": {"oid": "6e69337b193c185a1422c61cea5be63cbe2b8a03"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA1MzExNDY1", "url": "https://github.com/elastic/elasticsearch/pull/56148#pullrequestreview-405311465", "createdAt": "2020-05-04T20:12:26Z", "commit": {"oid": "6e69337b193c185a1422c61cea5be63cbe2b8a03"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNFQyMDoxMjoyNlrOGQQZTA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNFQyMDoxMjoyNlrOGQQZTA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTY5OTAyMA==", "bodyText": "Those can be outside of the loop no?\nand probably the whole try - catch can \"wrap\" the loop?", "url": "https://github.com/elastic/elasticsearch/pull/56148#discussion_r419699020", "createdAt": "2020-05-04T20:12:26Z", "author": {"login": "matriv"}, "path": "x-pack/plugin/sql/jdbc/src/test/java/org/elasticsearch/xpack/sql/jdbc/VersionParityTests.java", "diffHunk": "@@ -38,14 +38,19 @@ public void testExceptionThrownOnIncompatibleVersions() throws IOException, SQLE\n     }\n     \n     public void testNoExceptionThrownForCompatibleVersions() throws IOException {\n-        prepareResponse(null);\n-        \n-        String url = JdbcConfiguration.URL_PREFIX + webServerAddress();\n-        try {\n-            new JdbcHttpClient(JdbcConfiguration.create(url, null, 0));\n-        } catch (SQLException sqle) {\n-            fail(\"JDBC driver version and Elasticsearch server version should be compatible. Error: \" + sqle);\n-        }\n+        Version version = Version.CURRENT;\n+        do {\n+            prepareResponse(version);\n+\n+            String url = JdbcConfiguration.URL_PREFIX + webServerAddress();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6e69337b193c185a1422c61cea5be63cbe2b8a03"}, "originalPosition": 25}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA1NTM5Njgw", "url": "https://github.com/elastic/elasticsearch/pull/56148#pullrequestreview-405539680", "createdAt": "2020-05-05T07:10:32Z", "commit": {"oid": "6e69337b193c185a1422c61cea5be63cbe2b8a03"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNVQwNzoxMDozM1rOGQc--Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNVQwNzoxMDozM1rOGQc--Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTkwNTI3Mw==", "bodyText": "Do you think this method better belongs to SqlVersion class where hasVersionCompatibility() is also defined?", "url": "https://github.com/elastic/elasticsearch/pull/56148#discussion_r419905273", "createdAt": "2020-05-05T07:10:33Z", "author": {"login": "astefan"}, "path": "x-pack/plugin/sql/sql-action/src/main/java/org/elasticsearch/xpack/sql/action/AbstractSqlQueryRequest.java", "diffHunk": "@@ -233,6 +234,11 @@ public ActionRequestValidationException validate() {\n         return validationException;\n     }\n \n+    protected boolean isClientCompatible() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6e69337b193c185a1422c61cea5be63cbe2b8a03"}, "originalPosition": 28}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c3e21a36a87d43906d47fdcaf33bb47eca6c25e8", "author": {"user": {"login": "bpintea", "name": "Bogdan Pintea"}}, "url": "https://github.com/elastic/elasticsearch/commit/c3e21a36a87d43906d47fdcaf33bb47eca6c25e8", "committedDate": "2020-05-05T08:11:25Z", "message": "Adress review comments\n\n- refactor VersionParityTests#testNoExceptionThrownForCompatibleVersions\nto take idempotent assignments and try-catch blocks out a loop.\n- move method that establishes version compatibiltiy into SqlVersion."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA1NTc4NDIw", "url": "https://github.com/elastic/elasticsearch/pull/56148#pullrequestreview-405578420", "createdAt": "2020-05-05T08:16:49Z", "commit": {"oid": "c3e21a36a87d43906d47fdcaf33bb47eca6c25e8"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "466be8338aa6d7c099a6f717375e52049febc62f", "author": {"user": {"login": "bpintea", "name": "Bogdan Pintea"}}, "url": "https://github.com/elastic/elasticsearch/commit/466be8338aa6d7c099a6f717375e52049febc62f", "committedDate": "2020-05-05T11:00:59Z", "message": "Merge remote-tracking branch 'upstream/master' into enh/lift_version_lock_step"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 76, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}