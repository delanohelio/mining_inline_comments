{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzkwNDcxNDE5", "number": 53731, "title": "Emit deprecation warning when TermsLookup contains a type", "bodyText": "TermsLookup in master no longer accepts a type parameter.  We should emit\na deprecate warning in 7.x when a terms lookup requests includes type to prepare\nusers for its removal.\nRelates to #41059", "createdAt": "2020-03-18T14:31:58Z", "url": "https://github.com/elastic/elasticsearch/pull/53731", "merged": true, "mergeCommit": {"oid": "a3f21f24eafd17cb8fe057f3374d4f2ee710511d"}, "closed": true, "closedAt": "2020-03-20T15:11:32Z", "author": {"login": "romseygeek"}, "timelineItems": {"totalCount": 18, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcO4LbHgH2gAyMzkwNDcxNDE5OjMyZDQ2NTI1YzQxMzE5NmIyMjdhMTU5NjY1OTQwZTk2Nzc2YjBmNDU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcQi_LZgFqTM3OTcyMzU5Mw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "32d46525c413196b227a159665940e96776b0f45", "author": {"user": {"login": "romseygeek", "name": "Alan Woodward"}}, "url": "https://github.com/elastic/elasticsearch/commit/32d46525c413196b227a159665940e96776b0f45", "committedDate": "2020-03-18T14:28:11Z", "message": "Emit deprecation warning when TermsLookup contains a type"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9ffe71311554c6de764b9c465ea7029987138ba5", "author": {"user": {"login": "romseygeek", "name": "Alan Woodward"}}, "url": "https://github.com/elastic/elasticsearch/commit/9ffe71311554c6de764b9c465ea7029987138ba5", "committedDate": "2020-03-18T15:02:03Z", "message": "Check warnings in YAML tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b83ec59e29c870e04fd38d87e1a1e6eabd418148", "author": {"user": {"login": "romseygeek", "name": "Alan Woodward"}}, "url": "https://github.com/elastic/elasticsearch/commit/b83ec59e29c870e04fd38d87e1a1e6eabd418148", "committedDate": "2020-03-18T15:14:38Z", "message": "precommit"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0e4908306b8c94fbe08d55ea1f2144f357bd5694", "author": {"user": {"login": "romseygeek", "name": "Alan Woodward"}}, "url": "https://github.com/elastic/elasticsearch/commit/0e4908306b8c94fbe08d55ea1f2144f357bd5694", "committedDate": "2020-03-18T15:39:33Z", "message": "tests; termsquery doesn't need extra warnings"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "aa7fa91bc96a5d18a92427416fd2b56d7712b9ee", "author": {"user": {"login": "romseygeek", "name": "Alan Woodward"}}, "url": "https://github.com/elastic/elasticsearch/commit/aa7fa91bc96a5d18a92427416fd2b56d7712b9ee", "committedDate": "2020-03-18T15:56:22Z", "message": "precommit"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "41b7247edd0ec15290521d9dfbfd4ae868320cbb", "author": {"user": {"login": "romseygeek", "name": "Alan Woodward"}}, "url": "https://github.com/elastic/elasticsearch/commit/41b7247edd0ec15290521d9dfbfd4ae868320cbb", "committedDate": "2020-03-18T16:17:42Z", "message": "BWC filtering"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "500fc61fa6db19937ccebcf15930bb8eab07ec5d", "author": {"user": {"login": "romseygeek", "name": "Alan Woodward"}}, "url": "https://github.com/elastic/elasticsearch/commit/500fc61fa6db19937ccebcf15930bb8eab07ec5d", "committedDate": "2020-03-18T17:21:45Z", "message": "Allow for BWC tests against 6x"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "87c1cfe6a4ef0f5dae1567325f50e35569e675e9", "author": {"user": {"login": "romseygeek", "name": "Alan Woodward"}}, "url": "https://github.com/elastic/elasticsearch/commit/87c1cfe6a4ef0f5dae1567325f50e35569e675e9", "committedDate": "2020-03-18T17:56:30Z", "message": "yml"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc3NTk5Njk5", "url": "https://github.com/elastic/elasticsearch/pull/53731#pullrequestreview-377599699", "createdAt": "2020-03-19T10:38:03Z", "commit": {"oid": "87c1cfe6a4ef0f5dae1567325f50e35569e675e9"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ce72cb31dfed8afac6f8bd66c5855c01c850cfd0", "author": {"user": {"login": "romseygeek", "name": "Alan Woodward"}}, "url": "https://github.com/elastic/elasticsearch/commit/ce72cb31dfed8afac6f8bd66c5855c01c850cfd0", "committedDate": "2020-03-19T15:12:06Z", "message": "Merge remote-tracking branch 'origin/7.x' into deprecation/termslookup-7x"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "64602aad1378668ae6bd7f1a31c1388e5212c834", "author": {"user": {"login": "romseygeek", "name": "Alan Woodward"}}, "url": "https://github.com/elastic/elasticsearch/commit/64602aad1378668ae6bd7f1a31c1388e5212c834", "committedDate": "2020-03-19T15:16:05Z", "message": "Used allowed_warnings instead of skipping"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "84b6890252fd1ad0dfc6bc45049c98bf6355378e", "author": {"user": {"login": "romseygeek", "name": "Alan Woodward"}}, "url": "https://github.com/elastic/elasticsearch/commit/84b6890252fd1ad0dfc6bc45049c98bf6355378e", "committedDate": "2020-03-19T15:29:11Z", "message": "skip allowed_warnings"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fddd0021095ad921341f58335b772285e0a8a800", "author": {"user": {"login": "romseygeek", "name": "Alan Woodward"}}, "url": "https://github.com/elastic/elasticsearch/commit/fddd0021095ad921341f58335b772285e0a8a800", "committedDate": "2020-03-20T11:53:39Z", "message": "Merge branch '7.x' into deprecation/termslookup-7x"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c7a5f4ed309eeeff86bab1ea4b76dfea0fac043b", "author": {"user": {"login": "romseygeek", "name": "Alan Woodward"}}, "url": "https://github.com/elastic/elasticsearch/commit/c7a5f4ed309eeeff86bab1ea4b76dfea0fac043b", "committedDate": "2020-03-20T12:22:55Z", "message": "Merge branch '7.x' into deprecation/termslookup-7x"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8cbbc2d7cd846185c20b646fcfe35b48fe888fd5", "author": {"user": {"login": "romseygeek", "name": "Alan Woodward"}}, "url": "https://github.com/elastic/elasticsearch/commit/8cbbc2d7cd846185c20b646fcfe35b48fe888fd5", "committedDate": "2020-03-20T12:47:50Z", "message": "tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ff32c3f96fb2b32092a6a42835812f8f366fc891", "author": {"user": {"login": "romseygeek", "name": "Alan Woodward"}}, "url": "https://github.com/elastic/elasticsearch/commit/ff32c3f96fb2b32092a6a42835812f8f366fc891", "committedDate": "2020-03-20T13:23:45Z", "message": "precommit"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4a2bb3c28a7a684ca091cbe7bb77ba029f821f48", "author": {"user": {"login": "romseygeek", "name": "Alan Woodward"}}, "url": "https://github.com/elastic/elasticsearch/commit/4a2bb3c28a7a684ca091cbe7bb77ba029f821f48", "committedDate": "2020-03-20T14:15:19Z", "message": "re-add skip parameters"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc5NzIzNTkz", "url": "https://github.com/elastic/elasticsearch/pull/53731#pullrequestreview-379723593", "createdAt": "2020-03-23T18:49:28Z", "commit": {"oid": "4a2bb3c28a7a684ca091cbe7bb77ba029f821f48"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QxODo0OToyOVrOF6Tdyw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QxODo0OToyOVrOF6Tdyw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjY4MDY1MQ==", "bodyText": "@romseygeek sorry for the late review, I'm wondering why this check wasn't sufficient for emitting a deprecation warning? Was it not triggered on all the relevant code paths?\nIt would be nice to keep this strategy if possible, since it's consistent with all our other types deprecation warnings (deprecatedAndMaybeLog(\"api_name_with_types\", TYPES_DEPRECATION_MESSAGE);). It also lets us avoid adding an allowed_warnings section to the yml tests, since in 7.x we already ignore all warnings in yml tests that start with [types removal] ... .", "url": "https://github.com/elastic/elasticsearch/pull/53731#discussion_r396680651", "createdAt": "2020-03-23T18:49:29Z", "author": {"login": "jtibshirani"}, "path": "server/src/main/java/org/elasticsearch/index/query/TermsQueryBuilder.java", "diffHunk": "@@ -402,15 +395,9 @@ public static TermsQueryBuilder fromXContent(XContentParser parser) throws IOExc\n                     \"followed by array of terms or a document lookup specification\");\n         }\n \n-        TermsQueryBuilder builder = new TermsQueryBuilder(fieldName, values, termsLookup)\n+        return new TermsQueryBuilder(fieldName, values, termsLookup)\n             .boost(boost)\n             .queryName(queryName);\n-\n-        if (builder.isTypeless() == false) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4a2bb3c28a7a684ca091cbe7bb77ba029f821f48"}, "originalPosition": 44}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2014, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}