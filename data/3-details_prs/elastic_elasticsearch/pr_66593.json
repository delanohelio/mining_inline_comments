{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTQyNTQ4ODEw", "number": 66593, "title": "Annotated text plugin highlighter causes \"array_index_out_of_bounds_exception\"", "bodyText": "Closes #66535", "createdAt": "2020-12-18T13:38:33Z", "url": "https://github.com/elastic/elasticsearch/pull/66593", "merged": true, "mergeCommit": {"oid": "aa01af882eee0b50f59874d1412325704ed42417"}, "closed": true, "closedAt": "2021-01-04T15:41:50Z", "author": {"login": "markharwood"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdsy-vQgH2gAyNTQyNTQ4ODEwOjA5NmU2NWIzNDEyMzczODE5MDJmNDc1Yjg2NzNmZDRlOWJiODcyZDA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABds3QloAH2gAyNTQyNTQ4ODEwOjFjNWQwZGE3YWJjOTZhOTM4NTlmMTI5NzNhZWQ5YjEwYzJlYjMzZDE=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "096e65b341237381902f475b8673fd4e9bb872d0", "author": {"user": {"login": "markharwood", "name": null}}, "url": "https://github.com/elastic/elasticsearch/commit/096e65b341237381902f475b8673fd4e9bb872d0", "committedDate": "2021-01-04T09:33:41Z", "message": "Added test for array index out of bounds issue\n\nRelates to #66535"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "72ad0df826c38d24d806e420aed74edafbc50bb1", "author": {"user": {"login": "markharwood", "name": null}}, "url": "https://github.com/elastic/elasticsearch/commit/72ad0df826c38d24d806e420aed74edafbc50bb1", "committedDate": "2021-01-04T09:33:42Z", "message": "Reset counter on new document"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "77d3f64e3e571827663115a3b09dc38618caeded", "author": {"user": {"login": "markharwood", "name": null}}, "url": "https://github.com/elastic/elasticsearch/commit/77d3f64e3e571827663115a3b09dc38618caeded", "committedDate": "2021-01-04T09:33:42Z", "message": "Removed needless thread safety on readerNum variable - the Analyzer is created per highlight operation on a field per search request and the use of AtomicInteger only gives a false impression of threading."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "87ef7aef17a6a9e1be279d10c16150656ae608dc", "author": {"user": {"login": "markharwood", "name": null}}, "url": "https://github.com/elastic/elasticsearch/commit/87ef7aef17a6a9e1be279d10c16150656ae608dc", "committedDate": "2021-01-04T09:33:42Z", "message": "Remove unused import"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a13245ea310c547c22ba5ac1350907d621be2104", "author": {"user": {"login": "markharwood", "name": null}}, "url": "https://github.com/elastic/elasticsearch/commit/a13245ea310c547c22ba5ac1350907d621be2104", "committedDate": "2020-12-21T11:37:25Z", "message": "Remove unused import"}, "afterCommit": {"oid": "87ef7aef17a6a9e1be279d10c16150656ae608dc", "author": {"user": {"login": "markharwood", "name": null}}, "url": "https://github.com/elastic/elasticsearch/commit/87ef7aef17a6a9e1be279d10c16150656ae608dc", "committedDate": "2021-01-04T09:33:42Z", "message": "Remove unused import"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTYxMDAzMTI3", "url": "https://github.com/elastic/elasticsearch/pull/66593#pullrequestreview-561003127", "createdAt": "2021-01-04T12:46:49Z", "commit": {"oid": "87ef7aef17a6a9e1be279d10c16150656ae608dc"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wNFQxMjo0Njo0OVrOINwf0Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wNFQxMjo0Njo0OVrOINwf0Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTI5Njk3Nw==", "bodyText": "Might be worth changing this to javadoc, and stressing that you must create new instances per search because it's not thread-safe.", "url": "https://github.com/elastic/elasticsearch/pull/66593#discussion_r551296977", "createdAt": "2021-01-04T12:46:49Z", "author": {"login": "romseygeek"}, "path": "plugins/mapper-annotated-text/src/main/java/org/elasticsearch/index/mapper/annotatedtext/AnnotatedTextFieldMapper.java", "diffHunk": "@@ -272,9 +271,16 @@ public AnnotationToken getAnnotation(int index) {\n     // The class takes markedup format field values and returns plain text versions.\n     // When asked to tokenize plain-text versions by the highlighter it tokenizes the\n     // original markup form in order to inject annotations.\n+    // Unlike other Analyzers, which tend to be single-instance, this class has\n+    // instances created per search request and field being highlighted. This allows us to keep\n+    // state about the annotations being processed and pass them into token streams\n+    // being highlighted.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "87ef7aef17a6a9e1be279d10c16150656ae608dc"}, "originalPosition": 15}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1c5d0da7abc96a93859f12973aed9b10c2eb33d1", "author": {"user": {"login": "markharwood", "name": null}}, "url": "https://github.com/elastic/elasticsearch/commit/1c5d0da7abc96a93859f12973aed9b10c2eb33d1", "committedDate": "2021-01-04T14:32:48Z", "message": "Change comment to java doc and add thread safety note."}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4373, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}