{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDk3MjQxMDM0", "number": 63214, "title": "Convert TypeFieldType to a constant field type", "bodyText": "In 6x and 7x, indexes can have only one type, which means that we can rework\nall queries against the type field to use a ConstantFieldType.  This has already\nbeen done in master with the removal of the TypeFieldMapper, but we still need\nthat class in 7x to deal with nested documents.  This commit leaves\nTypeFieldMapper in place, but refactors TypeFieldType to extend\nConstantFieldType and consolidates deprecation warnings within that class.\nIt also incidentally removes the requirement to pass a MapperService to\nIndexFieldData.Builder#build, which should allow #63197 to be backported.", "createdAt": "2020-10-03T08:41:10Z", "url": "https://github.com/elastic/elasticsearch/pull/63214", "merged": true, "mergeCommit": {"oid": "7405af8060bd32bf2ae7917a13c441e4214339b8"}, "closed": true, "closedAt": "2020-10-06T09:27:38Z", "author": {"login": "romseygeek"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdO2V9XAH2gAyNDk3MjQxMDM0OjVlYWU0ZDE0OWYyM2VmZDdjZTVjNWNhYTIxOWYzODA3MTM5YzdlOGI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdP06VogFqTUwMjc0ODUyMA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "5eae4d149f23efd7ce5c5caa219f3807139c7e8b", "author": {"user": {"login": "romseygeek", "name": "Alan Woodward"}}, "url": "https://github.com/elastic/elasticsearch/commit/5eae4d149f23efd7ce5c5caa219f3807139c7e8b", "committedDate": "2020-10-03T08:31:02Z", "message": "Convert TypeFieldType to a constant field type"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9b2cd6ccf9675cd90d6a9a9671d9c83851084f21", "author": {"user": {"login": "romseygeek", "name": "Alan Woodward"}}, "url": "https://github.com/elastic/elasticsearch/commit/9b2cd6ccf9675cd90d6a9a9671d9c83851084f21", "committedDate": "2020-10-03T15:46:24Z", "message": "imports"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8f83d602c1a2ead80a99b214b2ba721576bd9be4", "author": {"user": {"login": "romseygeek", "name": "Alan Woodward"}}, "url": "https://github.com/elastic/elasticsearch/commit/8f83d602c1a2ead80a99b214b2ba721576bd9be4", "committedDate": "2020-10-05T08:50:39Z", "message": "checkstyle"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "afdb478820a7f7840d5d35017cd0fd22a674c233", "author": {"user": {"login": "romseygeek", "name": "Alan Woodward"}}, "url": "https://github.com/elastic/elasticsearch/commit/afdb478820a7f7840d5d35017cd0fd22a674c233", "committedDate": "2020-10-05T17:41:25Z", "message": "nested docs corner cases"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8fc59d7c4e2b258ae773d5592e3cbaf7cac67292", "author": {"user": {"login": "romseygeek", "name": "Alan Woodward"}}, "url": "https://github.com/elastic/elasticsearch/commit/8fc59d7c4e2b258ae773d5592e3cbaf7cac67292", "committedDate": "2020-10-06T07:53:28Z", "message": "tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fb2f02aa033fc2ea8e7e992f1697ce9113aab724", "author": {"user": {"login": "romseygeek", "name": "Alan Woodward"}}, "url": "https://github.com/elastic/elasticsearch/commit/fb2f02aa033fc2ea8e7e992f1697ce9113aab724", "committedDate": "2020-10-06T07:54:54Z", "message": "Merge remote-tracking branch 'origin/7.x' into typefieldtype-7x"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAyNzMyNzM2", "url": "https://github.com/elastic/elasticsearch/pull/63214#pullrequestreview-502732736", "createdAt": "2020-10-06T09:05:40Z", "commit": {"oid": "fb2f02aa033fc2ea8e7e992f1697ce9113aab724"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNlQwOTowNTo0MVrOHc88qw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNlQwOTowNTo0MVrOHc88qw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDEyMDc0Nw==", "bodyText": "for my understanding: does this mean that the field type does not come back with the below field type lookup? Did it before?", "url": "https://github.com/elastic/elasticsearch/pull/63214#discussion_r500120747", "createdAt": "2020-10-06T09:05:41Z", "author": {"login": "javanna"}, "path": "server/src/main/java/org/elasticsearch/index/mapper/MapperService.java", "diffHunk": "@@ -593,6 +593,11 @@ public DocumentMapperForType documentMapperWithAutoCreate(String type) {\n      * Given the full name of a field, returns its {@link MappedFieldType}.\n      */\n     public MappedFieldType fieldType(String fullName) {\n+        if (fullName.equals(TypeFieldMapper.NAME)) {\n+            String type = mapper == null ? null : mapper.type();\n+            return new TypeFieldMapper.TypeFieldType(type);\n+        }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fb2f02aa033fc2ea8e7e992f1697ce9113aab724"}, "originalPosition": 7}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAyNzQ4NTIw", "url": "https://github.com/elastic/elasticsearch/pull/63214#pullrequestreview-502748520", "createdAt": "2020-10-06T09:24:53Z", "commit": {"oid": "fb2f02aa033fc2ea8e7e992f1697ce9113aab724"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4374, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}