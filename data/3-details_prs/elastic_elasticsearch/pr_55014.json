{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDAxNDY1MDU5", "number": 55014, "title": "Deprecate local parameter for get field mapping request", "bodyText": "The usage of local parameter for GetFieldMappingRequest has been removed from the underlying transport action since v2.0.\nThis PR deprecate the parameter from rest layer. It will be removed in next major version.", "createdAt": "2020-04-09T14:42:08Z", "url": "https://github.com/elastic/elasticsearch/pull/55014", "merged": true, "mergeCommit": {"oid": "6ce88038f239078491c614c4e303c74bbbb77d6c"}, "closed": true, "closedAt": "2020-04-12T02:34:45Z", "author": {"login": "ywangd"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcV9CNjgH2gAyNDAxNDY1MDU5OmZiMzZhNTE2ZDQwMzE4NmMzNjJiYTUwNmU5ZmIwNjBkMzBhMzRlYmE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcWwASBAH2gAyNDAxNDY1MDU5OjY0ZDcxOGQ3ZTQxZTQxNzAwMTNjM2FlM2ViMDY0ZDJmNTBkYjAxYzM=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "fb36a516d403186c362ba506e9fb060d30a34eba", "author": {"user": {"login": "ywangd", "name": "Yang Wang"}}, "url": "https://github.com/elastic/elasticsearch/commit/fb36a516d403186c362ba506e9fb060d30a34eba", "committedDate": "2020-04-09T14:05:07Z", "message": "Add deprecation message for local parameter"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1a8bd104581e07e77285b4960ad1f4bee632092c", "author": {"user": {"login": "ywangd", "name": "Yang Wang"}}, "url": "https://github.com/elastic/elasticsearch/commit/1a8bd104581e07e77285b4960ad1f4bee632092c", "committedDate": "2020-04-09T14:32:29Z", "message": "Add test for deprecation message"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f6b598e71a3ef7a44741ceef227214c603f6dd89", "author": {"user": {"login": "ywangd", "name": "Yang Wang"}}, "url": "https://github.com/elastic/elasticsearch/commit/f6b598e71a3ef7a44741ceef227214c603f6dd89", "committedDate": "2020-04-09T14:42:49Z", "message": "Remove extra blank line"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkwOTA1MjY3", "url": "https://github.com/elastic/elasticsearch/pull/55014#pullrequestreview-390905267", "createdAt": "2020-04-09T15:35:36Z", "commit": {"oid": "f6b598e71a3ef7a44741ceef227214c603f6dd89"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOVQxNTozNTozNlrOGDeLWA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOVQxNTozNTozNlrOGDeLWA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjI5MzMzNg==", "bodyText": "Maybe add a space between the two sentences?", "url": "https://github.com/elastic/elasticsearch/pull/55014#discussion_r406293336", "createdAt": "2020-04-09T15:35:36Z", "author": {"login": "martijnvg"}, "path": "server/src/main/java/org/elasticsearch/rest/action/admin/indices/RestGetFieldMappingAction.java", "diffHunk": "@@ -63,6 +70,12 @@ public RestChannelConsumer prepareRequest(final RestRequest request, final NodeC\n         GetFieldMappingsRequest getMappingsRequest = new GetFieldMappingsRequest();\n         getMappingsRequest.indices(indices).fields(fields).includeDefaults(request.paramAsBoolean(\"include_defaults\", false));\n         getMappingsRequest.indicesOptions(IndicesOptions.fromRequest(request, getMappingsRequest.indicesOptions()));\n+\n+        if (request.hasParam(\"local\")) {\n+            deprecationLogger.deprecatedAndMaybeLog(\"get_field_mapping_local\",\n+                \"Use [local] in get field mapping requests is deprecated.\"\n+                    + \"The parameter will be removed in the next major version\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f6b598e71a3ef7a44741ceef227214c603f6dd89"}, "originalPosition": 35}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f560f342cec8f9dfea9d689834616f69d88efc5a", "author": {"user": {"login": "ywangd", "name": "Yang Wang"}}, "url": "https://github.com/elastic/elasticsearch/commit/f560f342cec8f9dfea9d689834616f69d88efc5a", "committedDate": "2020-04-09T15:44:37Z", "message": "Fix test failures"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d9f69069063e08bb6d9f1de0b90b067109b79cc1", "author": {"user": {"login": "ywangd", "name": "Yang Wang"}}, "url": "https://github.com/elastic/elasticsearch/commit/d9f69069063e08bb6d9f1de0b90b067109b79cc1", "committedDate": "2020-04-09T15:47:12Z", "message": "Address feedback"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkwOTM4Njgz", "url": "https://github.com/elastic/elasticsearch/pull/55014#pullrequestreview-390938683", "createdAt": "2020-04-09T16:16:24Z", "commit": {"oid": "d9f69069063e08bb6d9f1de0b90b067109b79cc1"}, "state": "APPROVED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOVQxNjoxNjoyNVrOGDfxpg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOVQxNjoxNzoyN1rOGDf0Jg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjMxOTUyNg==", "bodyText": "I would add that the parameter currently is just a noop.\nCan you also update the migrate_7_8.asciidoc file when backporting this change to the 7.x branch?", "url": "https://github.com/elastic/elasticsearch/pull/55014#discussion_r406319526", "createdAt": "2020-04-09T16:16:25Z", "author": {"login": "martijnvg"}, "path": "docs/reference/indices/get-field-mapping.asciidoc", "diffHunk": "@@ -48,7 +48,11 @@ include::{docdir}/rest-api/common-parms.asciidoc[tag=index-ignore-unavailable]\n (Optional, boolean) If `true`, the response includes default mapping values.\n Defaults to `false`.\n \n-include::{docdir}/rest-api/common-parms.asciidoc[tag=local]\n+`local`::\n+deprecated:[7.8.0, Field mappings are always retrieved locally]\n+(Optional, boolean) If `true`, the request retrieves information from the local\n+node only. Defaults to `false`, which means information is retrieved from\n+the master node.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d9f69069063e08bb6d9f1de0b90b067109b79cc1"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjMxOTk1OQ==", "bodyText": "\ud83d\udc4d", "url": "https://github.com/elastic/elasticsearch/pull/55014#discussion_r406319959", "createdAt": "2020-04-09T16:17:04Z", "author": {"login": "martijnvg"}, "path": "client/rest-high-level/src/test/java/org/elasticsearch/client/documentation/IndicesClientDocumentationIT.java", "diffHunk": "@@ -705,11 +707,12 @@ public void testGetFieldMapping() throws IOException, InterruptedException {\n         request.local(true); // <1>\n         // end::get-field-mappings-request-local\n \n-        {\n+        final RequestOptions requestOptions = RequestOptions.DEFAULT.toBuilder().setWarningsHandler(WarningsHandler.PERMISSIVE).build();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d9f69069063e08bb6d9f1de0b90b067109b79cc1"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjMyMDE2Ng==", "bodyText": "I think a space would need to be added here, otherwise this test will fail.", "url": "https://github.com/elastic/elasticsearch/pull/55014#discussion_r406320166", "createdAt": "2020-04-09T16:17:27Z", "author": {"login": "martijnvg"}, "path": "rest-api-spec/src/main/resources/rest-api-spec/test/indices.get_field_mapping/10_basic.yml", "diffHunk": "@@ -50,3 +50,20 @@ setup:\n \n   - match: {test_index.mappings.text.mapping.text.type:     text}\n   - match: {test_index.mappings.text.mapping.text.analyzer: default}\n+\n+---\n+\"Get field mapping with local is deprecated\":\n+\n+  - skip:\n+      features: [\"warnings\", \"node_selector\"]\n+\n+  - do:\n+      node_selector:\n+        version: \"7.8.0 - \"\n+      warnings:\n+        - \"Use [local] in get field mapping requests is deprecated.The parameter will be removed in the next major version\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d9f69069063e08bb6d9f1de0b90b067109b79cc1"}, "originalPosition": 15}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cd8b08f426c71ce1484f3d4c4c2b83f4960b9e47", "author": {"user": {"login": "ywangd", "name": "Yang Wang"}}, "url": "https://github.com/elastic/elasticsearch/commit/cd8b08f426c71ce1484f3d4c4c2b83f4960b9e47", "committedDate": "2020-04-10T04:21:16Z", "message": "Fix tests and address feedback"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "acb214020fdb1ec303a957f28b6fbc6c73710255", "author": {"user": {"login": "ywangd", "name": "Yang Wang"}}, "url": "https://github.com/elastic/elasticsearch/commit/acb214020fdb1ec303a957f28b6fbc6c73710255", "committedDate": "2020-04-10T04:42:08Z", "message": "Fix test failure"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bf911a6207e7297dc4ba9750e0a3c68466ecacc0", "author": {"user": {"login": "ywangd", "name": "Yang Wang"}}, "url": "https://github.com/elastic/elasticsearch/commit/bf911a6207e7297dc4ba9750e0a3c68466ecacc0", "committedDate": "2020-04-10T05:07:26Z", "message": "Test deprecation message only for v8.0.0 before backport"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "64d718d7e41e4170013c3ae3eb064d2f50db01c3", "author": {"user": {"login": "ywangd", "name": "Yang Wang"}}, "url": "https://github.com/elastic/elasticsearch/commit/64d718d7e41e4170013c3ae3eb064d2f50db01c3", "committedDate": "2020-04-12T01:28:10Z", "message": "Merge remote-tracking branch 'origin/master' into deprecate-get-field-mapping-local"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3656, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}