{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTAxNDIwODQw", "number": 63537, "title": "Recycle buffers used for cluster state publication", "bodyText": "Uses a ReleasableBytesStreamOutput to serialize the cluster state (or\ndiff) and releases it on completion of the publication.", "createdAt": "2020-10-12T08:42:01Z", "url": "https://github.com/elastic/elasticsearch/pull/63537", "merged": true, "mergeCommit": {"oid": "faaf2e72bdaaa65775c2c7cf765430286d2d4f12"}, "closed": true, "closedAt": "2020-10-13T08:24:20Z", "author": {"login": "DaveCTurner"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdRv31GAH2gAyNTAxNDIwODQwOjhkYWU1ZjU4NTExMjBlYWFhYzY3YzFhMWZhMjQyNGVlZGQ1ODY2Y2E=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdR5oJJgFqTUwNjg4MjcyMw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "8dae5f5851120eaaac67c1a1fa2424eedd5866ca", "author": {"user": {"login": "DaveCTurner", "name": "David Turner"}}, "url": "https://github.com/elastic/elasticsearch/commit/8dae5f5851120eaaac67c1a1fa2424eedd5866ca", "committedDate": "2020-10-12T08:40:28Z", "message": "Recycle buffers used for cluster state publication\n\nUses a `ReleasableBytesStreamOutput` to serialize the cluster state (or\ndiff) and releases it on completion of the publication."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "10e44ce2585077ace98fdb1724b5a942f0ce1e2e", "author": {"user": {"login": "DaveCTurner", "name": "David Turner"}}, "url": "https://github.com/elastic/elasticsearch/commit/10e44ce2585077ace98fdb1724b5a942f0ce1e2e", "committedDate": "2020-10-12T09:34:04Z", "message": "flushOnCloseStream"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "35e4bbfcb7cd0c4c4102e65f16a4105ec533dd33", "author": {"user": {"login": "DaveCTurner", "name": "David Turner"}}, "url": "https://github.com/elastic/elasticsearch/commit/35e4bbfcb7cd0c4c4102e65f16a4105ec533dd33", "committedDate": "2020-10-12T09:57:25Z", "message": "Permit local exception"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "284092d403b69a51997032ffb8b2e6acb5970206", "author": {"user": {"login": "DaveCTurner", "name": "David Turner"}}, "url": "https://github.com/elastic/elasticsearch/commit/284092d403b69a51997032ffb8b2e6acb5970206", "committedDate": "2020-10-12T12:49:18Z", "message": "Release serialized states on exception in buildDiffAndSerializeStates"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA2NjQ1MjQ5", "url": "https://github.com/elastic/elasticsearch/pull/63537#pullrequestreview-506645249", "createdAt": "2020-10-12T13:59:24Z", "commit": {"oid": "284092d403b69a51997032ffb8b2e6acb5970206"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xMlQxMzo1OToyNFrOHf_9tg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xMlQxMzo1OToyNFrOHf_9tg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzMxNTg5NA==", "bodyText": "Shouldn't we resolve the listener outside the mutex?", "url": "https://github.com/elastic/elasticsearch/pull/63537#discussion_r503315894", "createdAt": "2020-10-12T13:59:24Z", "author": {"login": "original-brownbear"}, "path": "server/src/main/java/org/elasticsearch/cluster/coordination/PublicationTransportHandler.java", "diffHunk": "@@ -350,30 +393,73 @@ public String executor() {\n                 });\n         }\n \n+        private boolean failIfAlreadyReleased(ActionListener<PublishWithJoinResponse> listener) {\n+            assert Thread.holdsLock(mutex);\n+            if (serializedStatesReleased) {\n+                listener.onFailure(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "284092d403b69a51997032ffb8b2e6acb5970206"}, "originalPosition": 195}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f1b9a9efc81f2e50399747d03ca2ec7599d08bb1", "author": {"user": {"login": "DaveCTurner", "name": "David Turner"}}, "url": "https://github.com/elastic/elasticsearch/commit/f1b9a9efc81f2e50399747d03ca2ec7599d08bb1", "committedDate": "2020-10-12T14:37:42Z", "message": "Notify listener outside mutex"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA2ODgyNzIz", "url": "https://github.com/elastic/elasticsearch/pull/63537#pullrequestreview-506882723", "createdAt": "2020-10-12T20:02:23Z", "commit": {"oid": "f1b9a9efc81f2e50399747d03ca2ec7599d08bb1"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4034, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}