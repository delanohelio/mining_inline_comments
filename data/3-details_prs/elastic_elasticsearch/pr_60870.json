{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY1MzQ1ODk3", "number": 60870, "title": "Improve error message in case of invalid dynamic templates", "bodyText": "Include the attempted 'match_mapping_type' into the message,\nso that it is clearer that multiple validation attempts have occurred.\nDynamic template validation was recently added via #51233 and\nthere was some confusion over the deprecation message itself.\n(in 7.x only deprecation warning will be omitted and from 8.0\nan error will be returned)", "createdAt": "2020-08-10T08:08:56Z", "url": "https://github.com/elastic/elasticsearch/pull/60870", "merged": true, "mergeCommit": {"oid": "6f9f3e505445499e5eed50c15096cc9ad75d487a"}, "closed": true, "closedAt": "2020-11-12T14:03:09Z", "author": {"login": "martijnvg"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc9dpCaAH2gAyNDY1MzQ1ODk3OmIzZWIzYzdlZmRkMGZlNTEzZjNjZGZlODE1NWJjMmFlNmJlMzFkMTI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdbx6MTAH2gAyNDY1MzQ1ODk3OjlhMzliOTk2NWUzNjQ1NTA2YmVkMWFjMzhhZmRlNGVjNjdjNTczNzA=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "b3eb3c7efdd0fe513f3cdfe8155bc2ae6be31d12", "author": {"user": {"login": "martijnvg", "name": "Martijn van Groningen"}}, "url": "https://github.com/elastic/elasticsearch/commit/b3eb3c7efdd0fe513f3cdfe8155bc2ae6be31d12", "committedDate": "2020-08-10T08:07:32Z", "message": "Improve error message in case of invalid dynamic templates\n\nInclude the attempted 'match_mapping_type' into the message,\nso that it is clearer that multiple validation attempts have occurred.\n\nDynamic template validation was recently added via #51233 and\nthere was some confusion over the deprecation message itself.\n(in 7.x only deprecation warning will be omitted and from 8.0\n an error will be returned)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "97fa14f359e400fcdce3f70c8ac3f7bfdfd56608", "author": {"user": {"login": "martijnvg", "name": "Martijn van Groningen"}}, "url": "https://github.com/elastic/elasticsearch/commit/97fa14f359e400fcdce3f70c8ac3f7bfdfd56608", "committedDate": "2020-08-10T08:23:44Z", "message": "checkstyle"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgyMTcxMTI1", "url": "https://github.com/elastic/elasticsearch/pull/60870#pullrequestreview-482171125", "createdAt": "2020-09-03T20:16:55Z", "commit": {"oid": "97fa14f359e400fcdce3f70c8ac3f7bfdfd56608"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wM1QyMDoxNjo1NVrOHM1_nA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wM1QyMDoyMDoxOFrOHM2Ihw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzIyOTU5Ng==", "bodyText": "I think we generally capitalize JSON in the docs.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              error is returned at index time. It is recommended to configure the `match_mapping_type` to the expected json type or\n          \n          \n            \n              error is returned at index time. It is recommended to configure the `match_mapping_type` to the expected JSON type or", "url": "https://github.com/elastic/elasticsearch/pull/60870#discussion_r483229596", "createdAt": "2020-09-03T20:16:55Z", "author": {"login": "danhermann"}, "path": "docs/reference/mapping/dynamic/templates.asciidoc", "diffHunk": "@@ -38,15 +38,16 @@ Dynamic templates are specified as an array of named objects:\n <3> The mapping that the matched field should use.\n \n If a provided mapping contains an invalid mapping snippet, a validation error\n-is returned. Validation occurs when applying the dynamic template at index time, \n-and, in most cases, when the dynamic template is updated. Providing an invalid mapping \n+is returned. Validation occurs when applying the dynamic template at index time,\n+and, in most cases, when the dynamic template is updated. Providing an invalid mapping\n snippet may cause the update or validation of a dynamic template to fail under certain conditions:\n \n-* If no `match_mapping_type` has been specified but the template is valid for at least one predefined mapping type, \n-  the mapping snippet is considered valid. However, a validation error is returned at index time if a field matching \n-  the template is indexed as a different type. For example, configuring a dynamic template with no `match_mapping_type` \n-  is considered valid as string type, but if a field matching the dynamic template is indexed as a long, a validation \n-  error is returned at index time.\n+* If no `match_mapping_type` has been specified but the template is valid for at least one predefined mapping type,\n+  the mapping snippet is considered valid. However, a validation error is returned at index time if a field matching\n+  the template is indexed as a different type. For example, configuring a dynamic template with no `match_mapping_type`\n+  is considered valid as string type, but if a field matching the dynamic template is indexed as a long, a validation\n+  error is returned at index time. It is recommended to configure the `match_mapping_type` to the expected json type or", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "97fa14f359e400fcdce3f70c8ac3f7bfdfd56608"}, "originalPosition": 19}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzIzMTg3OQ==", "bodyText": "Don't error messages usually use square brackets around values rather than names? In other words, should there be square brackets around match_mapping_type?", "url": "https://github.com/elastic/elasticsearch/pull/60870#discussion_r483231879", "createdAt": "2020-09-03T20:20:18Z", "author": {"login": "danhermann"}, "path": "server/src/main/java/org/elasticsearch/index/mapper/RootObjectMapper.java", "diffHunk": "@@ -408,14 +409,16 @@ private static void validateDynamicTemplate(Mapper.TypeParser.ParserContext pars\n \n         final boolean failInvalidDynamicTemplates = parserContext.indexVersionCreated().onOrAfter(Version.V_8_0_0);\n         if (dynamicTemplateInvalid) {\n-            String message = String.format(Locale.ROOT, \"dynamic template [%s] has invalid content [%s]\",\n-                dynamicTemplate.getName(), Strings.toString(dynamicTemplate));\n+            String format = \"dynamic template [%s] has invalid content [%s], \" +\n+                \"attempted to validate it with the following [match_mapping_type]: [%s]\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "97fa14f359e400fcdce3f70c8ac3f7bfdfd56608"}, "originalPosition": 15}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a44c854d2703685664bd1a8af2bf7923fcc81b2c", "author": {"user": {"login": "martijnvg", "name": "Martijn van Groningen"}}, "url": "https://github.com/elastic/elasticsearch/commit/a44c854d2703685664bd1a8af2bf7923fcc81b2c", "committedDate": "2020-11-12T12:40:05Z", "message": "Update RootObjectMapper.java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1543b3ba40aa9f480a8a8d4ec51e9c61bf1278d0", "author": {"user": {"login": "martijnvg", "name": "Martijn van Groningen"}}, "url": "https://github.com/elastic/elasticsearch/commit/1543b3ba40aa9f480a8a8d4ec51e9c61bf1278d0", "committedDate": "2020-11-12T12:40:43Z", "message": "Update RootObjectMapperTests.java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c4ece4047e034a4540fb38976f5b85cbe3d591ca", "author": {"user": {"login": "martijnvg", "name": "Martijn van Groningen"}}, "url": "https://github.com/elastic/elasticsearch/commit/c4ece4047e034a4540fb38976f5b85cbe3d591ca", "committedDate": "2020-11-12T12:40:59Z", "message": "Update docs/reference/mapping/dynamic/templates.asciidoc\n\nCo-authored-by: Dan Hermann <danhermann@users.noreply.github.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9a39b9965e3645506bed1ac38afde4ec67c57370", "author": {"user": {"login": "elasticmachine", "name": "Elastic Machine"}}, "url": "https://github.com/elastic/elasticsearch/commit/9a39b9965e3645506bed1ac38afde4ec67c57370", "committedDate": "2020-11-12T12:42:06Z", "message": "Merge branch 'master' into improve_invalid_dynamic_template_error_message"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3327, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}