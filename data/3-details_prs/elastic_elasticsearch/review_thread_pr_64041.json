{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTA4MTIxMTEw", "number": 64041, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMlQwODo0NDozNFrOEwqUIA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMlQwODo0NDozNFrOEwqUIA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE5NDYwMzg0OnYy", "diffSide": "LEFT", "path": "server/src/main/java/org/elasticsearch/search/lookup/LeafFieldsLookup.java", "isResolved": false, "comments": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMlQwODo0NDozNFrOHmXDyQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMlQxOToxMjo1OFrOHmwI5w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTk4NTczNw==", "bodyText": "Is this what you meant @romseygeek ? Are we sure that we can drop this? Looks like a breaking change to me, wondering if it's worth leaving it around although it is constant, not sure.", "url": "https://github.com/elastic/elasticsearch/pull/64041#discussion_r509985737", "createdAt": "2020-10-22T08:44:34Z", "author": {"login": "javanna"}, "path": "server/src/main/java/org/elasticsearch/search/lookup/LeafFieldsLookup.java", "diffHunk": "@@ -137,21 +135,12 @@ private FieldLookup loadFieldData(String name) {\n             cachedFieldData.put(name, data);\n         }\n         if (data.fields() == null) {\n-            List<Object> values;\n-            if (TypeFieldType.NAME.equals(data.fieldType().name())) {\n-                values = new ArrayList<>(1);\n-                final DocumentMapper mapper = mapperService.documentMapper();\n-                if (mapper != null) {\n-                    values.add(mapper.type());\n-                }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "426e2c4c492461ed567ef8054bf13be12f1ac347"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTk4Nzc1MQ==", "bodyText": "It is a breaking change, but I think it comes under the general umbrella of types removal so probably doesn't need a specific call-out.  If you try and use _type in a script in 7x you get a deprecation warning so I think it's fine to remove it.", "url": "https://github.com/elastic/elasticsearch/pull/64041#discussion_r509987751", "createdAt": "2020-10-22T08:47:22Z", "author": {"login": "romseygeek"}, "path": "server/src/main/java/org/elasticsearch/search/lookup/LeafFieldsLookup.java", "diffHunk": "@@ -137,21 +135,12 @@ private FieldLookup loadFieldData(String name) {\n             cachedFieldData.put(name, data);\n         }\n         if (data.fields() == null) {\n-            List<Object> values;\n-            if (TypeFieldType.NAME.equals(data.fieldType().name())) {\n-                values = new ArrayList<>(1);\n-                final DocumentMapper mapper = mapperService.documentMapper();\n-                if (mapper != null) {\n-                    values.add(mapper.type());\n-                }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTk4NTczNw=="}, "originalCommit": {"oid": "426e2c4c492461ed567ef8054bf13be12f1ac347"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTk4OTc1OQ==", "bodyText": "the problem here may be that the field type does come up by name, but then it fails to retrieve values from lucene, or is that ok?", "url": "https://github.com/elastic/elasticsearch/pull/64041#discussion_r509989759", "createdAt": "2020-10-22T08:50:14Z", "author": {"login": "javanna"}, "path": "server/src/main/java/org/elasticsearch/search/lookup/LeafFieldsLookup.java", "diffHunk": "@@ -137,21 +135,12 @@ private FieldLookup loadFieldData(String name) {\n             cachedFieldData.put(name, data);\n         }\n         if (data.fields() == null) {\n-            List<Object> values;\n-            if (TypeFieldType.NAME.equals(data.fieldType().name())) {\n-                values = new ArrayList<>(1);\n-                final DocumentMapper mapper = mapperService.documentMapper();\n-                if (mapper != null) {\n-                    values.add(mapper.type());\n-                }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTk4NTczNw=="}, "originalCommit": {"oid": "426e2c4c492461ed567ef8054bf13be12f1ac347"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTk5Mjg0NA==", "bodyText": "I see what you mean.  Maybe we should be removing the special-casing in MapperService.fieldType() in master as well, given that it's deprecated generally in 7.x. @jtibshirani what do you think?", "url": "https://github.com/elastic/elasticsearch/pull/64041#discussion_r509992844", "createdAt": "2020-10-22T08:54:50Z", "author": {"login": "romseygeek"}, "path": "server/src/main/java/org/elasticsearch/search/lookup/LeafFieldsLookup.java", "diffHunk": "@@ -137,21 +135,12 @@ private FieldLookup loadFieldData(String name) {\n             cachedFieldData.put(name, data);\n         }\n         if (data.fields() == null) {\n-            List<Object> values;\n-            if (TypeFieldType.NAME.equals(data.fieldType().name())) {\n-                values = new ArrayList<>(1);\n-                final DocumentMapper mapper = mapperService.documentMapper();\n-                if (mapper != null) {\n-                    values.add(mapper.type());\n-                }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTk4NTczNw=="}, "originalCommit": {"oid": "426e2c4c492461ed567ef8054bf13be12f1ac347"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDMxMTA1OQ==", "bodyText": "I just caught up on the code and was surprised to see we still have TypeFieldType in master. Is there a reason we added this special logic instead of removing TypeFieldType entirely, which would disallow all search operations on _type?", "url": "https://github.com/elastic/elasticsearch/pull/64041#discussion_r510311059", "createdAt": "2020-10-22T16:47:50Z", "author": {"login": "jtibshirani"}, "path": "server/src/main/java/org/elasticsearch/search/lookup/LeafFieldsLookup.java", "diffHunk": "@@ -137,21 +135,12 @@ private FieldLookup loadFieldData(String name) {\n             cachedFieldData.put(name, data);\n         }\n         if (data.fields() == null) {\n-            List<Object> values;\n-            if (TypeFieldType.NAME.equals(data.fieldType().name())) {\n-                values = new ArrayList<>(1);\n-                final DocumentMapper mapper = mapperService.documentMapper();\n-                if (mapper != null) {\n-                    values.add(mapper.type());\n-                }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTk4NTczNw=="}, "originalCommit": {"oid": "426e2c4c492461ed567ef8054bf13be12f1ac347"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDMxMzE4NQ==", "bodyText": "I think I added this as a stop-gap while backporting the various type field deprecations.  I'll open a PR to remove it entirely in master.", "url": "https://github.com/elastic/elasticsearch/pull/64041#discussion_r510313185", "createdAt": "2020-10-22T16:51:15Z", "author": {"login": "romseygeek"}, "path": "server/src/main/java/org/elasticsearch/search/lookup/LeafFieldsLookup.java", "diffHunk": "@@ -137,21 +135,12 @@ private FieldLookup loadFieldData(String name) {\n             cachedFieldData.put(name, data);\n         }\n         if (data.fields() == null) {\n-            List<Object> values;\n-            if (TypeFieldType.NAME.equals(data.fieldType().name())) {\n-                values = new ArrayList<>(1);\n-                final DocumentMapper mapper = mapperService.documentMapper();\n-                if (mapper != null) {\n-                    values.add(mapper.type());\n-                }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTk4NTczNw=="}, "originalCommit": {"oid": "426e2c4c492461ed567ef8054bf13be12f1ac347"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDMxNDc0Mg==", "bodyText": "One question I had -- does removing this have an implication for our API version compatibility efforts? I'm not up-to-date on our collaborations there.", "url": "https://github.com/elastic/elasticsearch/pull/64041#discussion_r510314742", "createdAt": "2020-10-22T16:53:44Z", "author": {"login": "jtibshirani"}, "path": "server/src/main/java/org/elasticsearch/search/lookup/LeafFieldsLookup.java", "diffHunk": "@@ -137,21 +135,12 @@ private FieldLookup loadFieldData(String name) {\n             cachedFieldData.put(name, data);\n         }\n         if (data.fields() == null) {\n-            List<Object> values;\n-            if (TypeFieldType.NAME.equals(data.fieldType().name())) {\n-                values = new ArrayList<>(1);\n-                final DocumentMapper mapper = mapperService.documentMapper();\n-                if (mapper != null) {\n-                    values.add(mapper.type());\n-                }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTk4NTczNw=="}, "originalCommit": {"oid": "426e2c4c492461ed567ef8054bf13be12f1ac347"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDMxODI4NA==", "bodyText": "Version compatibility only applies to the 'shape' of the request, as I understand it.  So we need to support type queries, but we don't need to support queries against the field _type (otherwise we'd never be able to deprecate types at all...)", "url": "https://github.com/elastic/elasticsearch/pull/64041#discussion_r510318284", "createdAt": "2020-10-22T16:59:20Z", "author": {"login": "romseygeek"}, "path": "server/src/main/java/org/elasticsearch/search/lookup/LeafFieldsLookup.java", "diffHunk": "@@ -137,21 +135,12 @@ private FieldLookup loadFieldData(String name) {\n             cachedFieldData.put(name, data);\n         }\n         if (data.fields() == null) {\n-            List<Object> values;\n-            if (TypeFieldType.NAME.equals(data.fieldType().name())) {\n-                values = new ArrayList<>(1);\n-                final DocumentMapper mapper = mapperService.documentMapper();\n-                if (mapper != null) {\n-                    values.add(mapper.type());\n-                }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTk4NTczNw=="}, "originalCommit": {"oid": "426e2c4c492461ed567ef8054bf13be12f1ac347"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDM5NjY0Nw==", "bodyText": "thanks for the input. It looks like this can go in then, and as a follow-up we will also remove TypeFieldType completely, which sounds like a good plan to me.", "url": "https://github.com/elastic/elasticsearch/pull/64041#discussion_r510396647", "createdAt": "2020-10-22T19:12:58Z", "author": {"login": "javanna"}, "path": "server/src/main/java/org/elasticsearch/search/lookup/LeafFieldsLookup.java", "diffHunk": "@@ -137,21 +135,12 @@ private FieldLookup loadFieldData(String name) {\n             cachedFieldData.put(name, data);\n         }\n         if (data.fields() == null) {\n-            List<Object> values;\n-            if (TypeFieldType.NAME.equals(data.fieldType().name())) {\n-                values = new ArrayList<>(1);\n-                final DocumentMapper mapper = mapperService.documentMapper();\n-                if (mapper != null) {\n-                    values.add(mapper.type());\n-                }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTk4NTczNw=="}, "originalCommit": {"oid": "426e2c4c492461ed567ef8054bf13be12f1ac347"}, "originalPosition": 21}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4279, "cost": 1, "resetAt": "2021-11-12T19:05:54Z"}}}