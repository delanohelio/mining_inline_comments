{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTI0NzI2Nzcz", "number": 65314, "title": "Configurable MIME type for mustache template encoding on set processor", "bodyText": "The set processor permits the value that it sets to be specified with a Mustache template snippet. Our Mustache script engine allows three different MIME encodings to be used when writing the value that the snippet evaluates to but the Set processor was hard-coded to always use the application/json MIME type. This adds an optional mime_type property to the Set processor that may be set to any of the three MIME types (application/json, text/plain, application/x-www-form-urlencoded) that the Mustache script engine supports. The default type remains application/json.\nCloses #65115", "createdAt": "2020-11-20T14:03:53Z", "url": "https://github.com/elastic/elasticsearch/pull/65314", "merged": true, "mergeCommit": {"oid": "eddab39e2ff684b12bdb8e7900eaabc1350426aa"}, "closed": true, "closedAt": "2021-01-07T13:40:57Z", "author": {"login": "danhermann"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdeLvRQgH2gAyNTI0NzI2NzczOmVhNjRjYzhjMjk3ODM5ZDNjNWQxMmMzYmU1MzY1ZTdmYmI0YTI1MWE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdt1p29gFqTU2MzU2NDMzNQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "ea64cc8c297839d3c5d12c3be5365e7fbb4a251a", "author": {"user": {"login": "danhermann", "name": "Dan Hermann"}}, "url": "https://github.com/elastic/elasticsearch/commit/ea64cc8c297839d3c5d12c3be5365e7fbb4a251a", "committedDate": "2020-11-19T23:55:33Z", "message": "configurable MIME type for mustache template encoding"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "133bef8d70dc16b0df85b88760087637fb4ce2e6", "author": {"user": {"login": "danhermann", "name": "Dan Hermann"}}, "url": "https://github.com/elastic/elasticsearch/commit/133bef8d70dc16b0df85b88760087637fb4ce2e6", "committedDate": "2020-11-24T15:46:32Z", "message": "add unit test and DRY up constants"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fa616b65a4b951079fb7aafccdda8fbcbc2091fa", "author": {"user": {"login": "elasticmachine", "name": "Elastic Machine"}}, "url": "https://github.com/elastic/elasticsearch/commit/fa616b65a4b951079fb7aafccdda8fbcbc2091fa", "committedDate": "2020-11-24T18:41:59Z", "message": "Merge branch 'master' into 65115_set_processor_escape_chars"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "aefd9dce21e124c88016bc6bd884495df0803d2c", "author": {"user": {"login": "danhermann", "name": "Dan Hermann"}}, "url": "https://github.com/elastic/elasticsearch/commit/aefd9dce21e124c88016bc6bd884495df0803d2c", "committedDate": "2020-11-24T19:28:07Z", "message": "checkstyle"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTYzMDEzMzM0", "url": "https://github.com/elastic/elasticsearch/pull/65314#pullrequestreview-563013334", "createdAt": "2021-01-06T20:20:41Z", "commit": {"oid": "aefd9dce21e124c88016bc6bd884495df0803d2c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTYzNTY0MzM1", "url": "https://github.com/elastic/elasticsearch/pull/65314#pullrequestreview-563564335", "createdAt": "2021-01-07T15:10:39Z", "commit": {"oid": "aefd9dce21e124c88016bc6bd884495df0803d2c"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wN1QxNToxMDozOVrOIPwF-Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wN1QxNToxMzowNlrOIPwLcg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MzM4NzUxMw==", "bodyText": "are we sure we want mime_type as a name here? I thought mime was replace with media_type\nbut wouldn't content_type  be more consistent with what we have in mustache templating engine?", "url": "https://github.com/elastic/elasticsearch/pull/65314#discussion_r553387513", "createdAt": "2021-01-07T15:10:39Z", "author": {"login": "pgomulka"}, "path": "modules/ingest-common/src/main/java/org/elasticsearch/ingest/common/SetProcessor.java", "diffHunk": "@@ -110,10 +111,11 @@ public SetProcessor create(Map<String, Processor.Factory> registry, String proce\n                                    String description, Map<String, Object> config) throws Exception {\n             String field = ConfigurationUtils.readStringProperty(TYPE, processorTag, config, \"field\");\n             String copyFrom = ConfigurationUtils.readOptionalStringProperty(TYPE, processorTag, config, \"copy_from\");\n+            String mimeType = ConfigurationUtils.readMimeTypeProperty(TYPE, processorTag, config, \"mime_type\", \"application/json\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "aefd9dce21e124c88016bc6bd884495df0803d2c"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MzM4ODkxNA==", "bodyText": "do we want the se hardcoded? What if someone specifies application/json; charset=utf-8 ?\nWould it be of any help if this bit was unified with what CustomMustacheFactory defines? I made an attempt here https://github.com/elastic/elasticsearch/pull/66857/files#diff-207cacc1e4a5b24109a693c0b63dd762156452bb5984b5ce04499b28e6c191e8R28", "url": "https://github.com/elastic/elasticsearch/pull/65314#discussion_r553388914", "createdAt": "2021-01-07T15:13:06Z", "author": {"login": "pgomulka"}, "path": "server/src/main/java/org/elasticsearch/ingest/ConfigurationUtils.java", "diffHunk": "@@ -49,6 +49,7 @@\n \n     public static final String TAG_KEY = \"tag\";\n     public static final String DESCRIPTION_KEY = \"description\";\n+    public static final String[] VALID_MIME_TYPES = {\"application/json\", \"text/plain\", \"application/x-www-form-urlencoded\"};", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "aefd9dce21e124c88016bc6bd884495df0803d2c"}, "originalPosition": 4}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 909, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}