{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE0NTkyMjI1", "number": 56329, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wN1QxMDoyMjowN1rOD6L5Jw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wN1QxMDoyMjowN1rOD6L5Jw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYyMzM4ODU1OnYy", "diffSide": "RIGHT", "path": "server/src/main/java/org/elasticsearch/repositories/blobstore/BlobStoreRepository.java", "isResolved": false, "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wN1QxMDoyMjowN1rOGR4KUw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wN1QxNDoyMDoxOFrOGSA4nQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTM5OTEyMw==", "bodyText": "I think it would be helpful to continue to log all the blobs at TRACE level; I'd do both if there are unexpected ones as it's interesting to know that they were unexpected.", "url": "https://github.com/elastic/elasticsearch/pull/56329#discussion_r421399123", "createdAt": "2020-05-07T10:22:07Z", "author": {"login": "DaveCTurner"}, "path": "server/src/main/java/org/elasticsearch/repositories/blobstore/BlobStoreRepository.java", "diffHunk": "@@ -912,12 +916,24 @@ public void cleanup(long repositoryStateId, Version repositoryMetaVersion, Actio\n         ).collect(Collectors.toList());\n     }\n \n-    private List<String> cleanupStaleRootFiles(List<String> blobsToDelete) {\n+    private List<String> cleanupStaleRootFiles(Collection<SnapshotId> deletedSnapshots, List<String> blobsToDelete) {\n         if (blobsToDelete.isEmpty()) {\n             return blobsToDelete;\n         }\n         try {\n-            logger.info(\"[{}] Found stale root level blobs {}. Cleaning them up\", metadata.name(), blobsToDelete);\n+            if (logger.isInfoEnabled()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ce1803f50cd951ba8a3d9501cb9be6f38c0d9ccf"}, "originalPosition": 88}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTQwMjMzNA==", "bodyText": "D'oh just spotted this was a backport and already approved in master, sorry \ud83d\ude15", "url": "https://github.com/elastic/elasticsearch/pull/56329#discussion_r421402334", "createdAt": "2020-05-07T10:28:07Z", "author": {"login": "DaveCTurner"}, "path": "server/src/main/java/org/elasticsearch/repositories/blobstore/BlobStoreRepository.java", "diffHunk": "@@ -912,12 +916,24 @@ public void cleanup(long repositoryStateId, Version repositoryMetaVersion, Actio\n         ).collect(Collectors.toList());\n     }\n \n-    private List<String> cleanupStaleRootFiles(List<String> blobsToDelete) {\n+    private List<String> cleanupStaleRootFiles(Collection<SnapshotId> deletedSnapshots, List<String> blobsToDelete) {\n         if (blobsToDelete.isEmpty()) {\n             return blobsToDelete;\n         }\n         try {\n-            logger.info(\"[{}] Found stale root level blobs {}. Cleaning them up\", metadata.name(), blobsToDelete);\n+            if (logger.isInfoEnabled()) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTM5OTEyMw=="}, "originalCommit": {"oid": "ce1803f50cd951ba8a3d9501cb9be6f38c0d9ccf"}, "originalPosition": 88}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTQwNzkwOA==", "bodyText": "No worries, I'll do a follow-up for this shortly, I wanted to add some other trace logging as well anyway :)", "url": "https://github.com/elastic/elasticsearch/pull/56329#discussion_r421407908", "createdAt": "2020-05-07T10:38:29Z", "author": {"login": "original-brownbear"}, "path": "server/src/main/java/org/elasticsearch/repositories/blobstore/BlobStoreRepository.java", "diffHunk": "@@ -912,12 +916,24 @@ public void cleanup(long repositoryStateId, Version repositoryMetaVersion, Actio\n         ).collect(Collectors.toList());\n     }\n \n-    private List<String> cleanupStaleRootFiles(List<String> blobsToDelete) {\n+    private List<String> cleanupStaleRootFiles(Collection<SnapshotId> deletedSnapshots, List<String> blobsToDelete) {\n         if (blobsToDelete.isEmpty()) {\n             return blobsToDelete;\n         }\n         try {\n-            logger.info(\"[{}] Found stale root level blobs {}. Cleaning them up\", metadata.name(), blobsToDelete);\n+            if (logger.isInfoEnabled()) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTM5OTEyMw=="}, "originalCommit": {"oid": "ce1803f50cd951ba8a3d9501cb9be6f38c0d9ccf"}, "originalPosition": 88}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTQwOTk4MA==", "bodyText": "the more \ud83d\udc40 the better", "url": "https://github.com/elastic/elasticsearch/pull/56329#discussion_r421409980", "createdAt": "2020-05-07T10:42:49Z", "author": {"login": "tlrx"}, "path": "server/src/main/java/org/elasticsearch/repositories/blobstore/BlobStoreRepository.java", "diffHunk": "@@ -912,12 +916,24 @@ public void cleanup(long repositoryStateId, Version repositoryMetaVersion, Actio\n         ).collect(Collectors.toList());\n     }\n \n-    private List<String> cleanupStaleRootFiles(List<String> blobsToDelete) {\n+    private List<String> cleanupStaleRootFiles(Collection<SnapshotId> deletedSnapshots, List<String> blobsToDelete) {\n         if (blobsToDelete.isEmpty()) {\n             return blobsToDelete;\n         }\n         try {\n-            logger.info(\"[{}] Found stale root level blobs {}. Cleaning them up\", metadata.name(), blobsToDelete);\n+            if (logger.isInfoEnabled()) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTM5OTEyMw=="}, "originalCommit": {"oid": "ce1803f50cd951ba8a3d9501cb9be6f38c0d9ccf"}, "originalPosition": 88}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTU0MjA0NQ==", "bodyText": "#56336 :)", "url": "https://github.com/elastic/elasticsearch/pull/56329#discussion_r421542045", "createdAt": "2020-05-07T14:20:18Z", "author": {"login": "original-brownbear"}, "path": "server/src/main/java/org/elasticsearch/repositories/blobstore/BlobStoreRepository.java", "diffHunk": "@@ -912,12 +916,24 @@ public void cleanup(long repositoryStateId, Version repositoryMetaVersion, Actio\n         ).collect(Collectors.toList());\n     }\n \n-    private List<String> cleanupStaleRootFiles(List<String> blobsToDelete) {\n+    private List<String> cleanupStaleRootFiles(Collection<SnapshotId> deletedSnapshots, List<String> blobsToDelete) {\n         if (blobsToDelete.isEmpty()) {\n             return blobsToDelete;\n         }\n         try {\n-            logger.info(\"[{}] Found stale root level blobs {}. Cleaning them up\", metadata.name(), blobsToDelete);\n+            if (logger.isInfoEnabled()) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTM5OTEyMw=="}, "originalCommit": {"oid": "ce1803f50cd951ba8a3d9501cb9be6f38c0d9ccf"}, "originalPosition": 88}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 588, "cost": 1, "resetAt": "2021-11-12T11:57:46Z"}}}