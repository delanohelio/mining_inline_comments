{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk1ODY0NTc4", "number": 54463, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMFQxOTo1ODowOVrODs1NtQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMVQyMjoyMjoyNlrODtujgQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ4MzM1Nzk3OnYy", "diffSide": "RIGHT", "path": "server/src/test/java/org/elasticsearch/index/mapper/ObjectMapperMergeTests.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMFQxOTo1ODowOVrOF9577w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMFQxOTo1ODowOVrOF9577w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDQ1NjY4Nw==", "bodyText": "It's pretty confusing that this error message will contain the singleton type name: \"The [enabled] parameter can't be updated for the object mapping [_doc].\" I think we should address this in a separate, more general change to not pass in the type as the root object mapper's name.", "url": "https://github.com/elastic/elasticsearch/pull/54463#discussion_r400456687", "createdAt": "2020-03-30T19:58:09Z", "author": {"login": "jtibshirani"}, "path": "server/src/test/java/org/elasticsearch/index/mapper/ObjectMapperMergeTests.java", "diffHunk": "@@ -93,7 +93,16 @@ public void testMergeWhenEnablingField() {\n         // WHEN merging mappings\n         // THEN a MapperException is thrown with an excepted message\n         MapperException e = expectThrows(MapperException.class, () -> rootObjectMapper.merge(mergeWith));\n-        assertEquals(\"Can't update attribute for type [type1.disabled.enabled] in index mapping\", e.getMessage());\n+        assertEquals(\"The [enabled] parameter can't be updated for the object mapping [disabled].\", e.getMessage());\n+    }\n+\n+    public void testDisableRootMapper() {\n+        String type = MapperService.SINGLE_MAPPING_NAME;\n+        ObjectMapper firstMapper = createRootObjectMapper(type, true, Collections.emptyMap());\n+        ObjectMapper secondMapper = createRootObjectMapper(type, false, Collections.emptyMap());\n+\n+        MapperException e = expectThrows(MapperException.class, () -> firstMapper.merge(secondMapper));\n+        assertEquals(\"The [enabled] parameter can't be updated for the object mapping [\" + type + \"].\", e.getMessage());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ea9433aa7bf54e425a0ef6fe4d05e22c6d48562c"}, "originalPosition": 23}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ5Mjc1MjY1OnYy", "diffSide": "LEFT", "path": "x-pack/plugin/core/src/test/java/org/elasticsearch/snapshots/SourceOnlySnapshotShardTests.java", "isResolved": false, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMVQyMjoyMjoyNlrOF_UwbQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMlQxOTo0OToyNlrOF_69IQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTk0NDY4NQ==", "bodyText": "I'll double check with someone from the distributed team that this change is okay.", "url": "https://github.com/elastic/elasticsearch/pull/54463#discussion_r401944685", "createdAt": "2020-04-01T22:22:26Z", "author": {"login": "jtibshirani"}, "path": "x-pack/plugin/core/src/test/java/org/elasticsearch/snapshots/SourceOnlySnapshotShardTests.java", "diffHunk": "@@ -236,7 +235,6 @@ public void testRestoreMinmal() throws IOException {\n         IndexMetadata metadata = runAsSnapshot(threadPool, () -> repository.getSnapshotIndexMetadata(snapshotId, indexId));\n         IndexShard restoredShard = newShard(\n             shardRouting, metadata, null, SourceOnlySnapshotRepository.getEngineFactory(), () -> {}, RetentionLeaseSyncer.EMPTY);\n-        restoredShard.mapperService().merge(shard.indexSettings().getIndexMetadata(), MapperService.MergeReason.MAPPING_RECOVERY);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "df69ea75287591ed7279eb2c677afdf0a25c6935"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjQ2MzQ0Nw==", "bodyText": "@original-brownbear would you be up for taking a look? I saw that you made several changes in this area recently.", "url": "https://github.com/elastic/elasticsearch/pull/54463#discussion_r402463447", "createdAt": "2020-04-02T16:53:44Z", "author": {"login": "jtibshirani"}, "path": "x-pack/plugin/core/src/test/java/org/elasticsearch/snapshots/SourceOnlySnapshotShardTests.java", "diffHunk": "@@ -236,7 +235,6 @@ public void testRestoreMinmal() throws IOException {\n         IndexMetadata metadata = runAsSnapshot(threadPool, () -> repository.getSnapshotIndexMetadata(snapshotId, indexId));\n         IndexShard restoredShard = newShard(\n             shardRouting, metadata, null, SourceOnlySnapshotRepository.getEngineFactory(), () -> {}, RetentionLeaseSyncer.EMPTY);\n-        restoredShard.mapperService().merge(shard.indexSettings().getIndexMetadata(), MapperService.MergeReason.MAPPING_RECOVERY);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTk0NDY4NQ=="}, "originalCommit": {"oid": "df69ea75287591ed7279eb2c677afdf0a25c6935"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjU1ODE2Mw==", "bodyText": "I think this is fine. This line seems unnecessary and makes the test behave less like a real restore as far as I can see anyway (just restoring the meta from the repo in a real restore).\n=> LGTM :)", "url": "https://github.com/elastic/elasticsearch/pull/54463#discussion_r402558163", "createdAt": "2020-04-02T19:26:27Z", "author": {"login": "original-brownbear"}, "path": "x-pack/plugin/core/src/test/java/org/elasticsearch/snapshots/SourceOnlySnapshotShardTests.java", "diffHunk": "@@ -236,7 +235,6 @@ public void testRestoreMinmal() throws IOException {\n         IndexMetadata metadata = runAsSnapshot(threadPool, () -> repository.getSnapshotIndexMetadata(snapshotId, indexId));\n         IndexShard restoredShard = newShard(\n             shardRouting, metadata, null, SourceOnlySnapshotRepository.getEngineFactory(), () -> {}, RetentionLeaseSyncer.EMPTY);\n-        restoredShard.mapperService().merge(shard.indexSettings().getIndexMetadata(), MapperService.MergeReason.MAPPING_RECOVERY);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTk0NDY4NQ=="}, "originalCommit": {"oid": "df69ea75287591ed7279eb2c677afdf0a25c6935"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjU3MDUyOQ==", "bodyText": "Thanks @original-brownbear ! It also seemed strange to me, that we would add the original mappings as part of restoring a source-only snapshot.", "url": "https://github.com/elastic/elasticsearch/pull/54463#discussion_r402570529", "createdAt": "2020-04-02T19:49:26Z", "author": {"login": "jtibshirani"}, "path": "x-pack/plugin/core/src/test/java/org/elasticsearch/snapshots/SourceOnlySnapshotShardTests.java", "diffHunk": "@@ -236,7 +235,6 @@ public void testRestoreMinmal() throws IOException {\n         IndexMetadata metadata = runAsSnapshot(threadPool, () -> repository.getSnapshotIndexMetadata(snapshotId, indexId));\n         IndexShard restoredShard = newShard(\n             shardRouting, metadata, null, SourceOnlySnapshotRepository.getEngineFactory(), () -> {}, RetentionLeaseSyncer.EMPTY);\n-        restoredShard.mapperService().merge(shard.indexSettings().getIndexMetadata(), MapperService.MergeReason.MAPPING_RECOVERY);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTk0NDY4NQ=="}, "originalCommit": {"oid": "df69ea75287591ed7279eb2c677afdf0a25c6935"}, "originalPosition": 12}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3993, "cost": 1, "resetAt": "2021-11-12T13:16:51Z"}}}