{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE3ODQ3MDQ5", "number": 56745, "title": "Implement aggregations on aggregate metric fields", "bodyText": "This PR will merge all work done for aggregate-metric aggregations in the feature branch back into master.\n\nIn the process of developing a new implementation for the Elasticsearch Rollups functionality we came up with the concept of the aggregate metric field type.\nThe aggregate_metric_double field type can store the results of aggregations (currently min, max, sum, value_count and avg are supported - more to come).\nFor example, let's assume we have the following documents in an index and metric field is of aggregate_metric type:\n{\"metric\": {\"min\": 0, \"max\": 100, \"sum\": 405, \"value_count\": 50} }\n{\"metric\": {\"min\": 60, \"max\": 100, \"sum\": 10000.45, \"value_count\": 100} }\n{\"metric\": {\"min\": -400.50, \"max\": 1000, \"sum\": -400.50, \"value_count\": 1000} }\n{\"metric\": {\"min\": 1, \"max\": 99.3, \"sum\": 1, \"value_count\": 20} }\n{\"metric\": {\"min\": -100, \"max\": -40, \"sum\": -100, \"value_count\": 40} }\n\nThis field allows us to run (min, max, sum, value_count, avg) aggregations as in the following example:\nPOST /index_agg/_search?size=0\n{\n  \"aggs\" : {\n    \"max_metric\" : { \"max\" : { \"field\" : \"metric\" } }\n  }\n}\n\nNote that the max aggregation is run on the metric field and not the metric.max sub-field. However, the field mapper will compute the results of the max aggregation based on the metric.max sub-field.\nIn fact the aggregate_metric_double field type will return the max sub-field to the max aggregation, the min sub-field to the min aggregation and so on.\nReading all this, one would think why is this different to having an index that stores one numeric field for each aggregation.\n{\"metric_min\": 0, \"metric_max\": 100, \"metric_sum\": 405, \"metric_value_count\": 50}\n\nand then run aggregations on those fields (eg \"max_metric\" : { \"max\" : { \"field\" : \"max_metric\" } } )\nThe power of the aggregate_metric _double field type comes from its ability to mix indices with raw (numeric) fields and aggregate_metric_double fields in the same query.\nFor example, let's assume we have one aggregate index and one index with raw data:\nindex_agg:\n{\"metric\": {\"min\": 0, \"max\": 100, \"sum\": 405, \"value_count\": 50} }\n{\"metric\": {\"min\": 60, \"max\": 100, \"sum\": 10000.45, \"value_count\": 100} }\n{\"metric\": {\"min\": -400.50, \"max\": 1000, \"sum\": -400.50, \"value_count\": 1000} }\n\nindex_raw:\n{\"metric\": 100 }\n{\"metric\": 34 }\n{\"metric\": -100.45}\n\nWe can run the max aggregation on both indices\nPOST /index_agg,index_raw/_search?size=0\n\n{\n  \"aggs\" : {\n    \"max_metric\" : { \"max\" : { \"field\" : \"metric\" } }\n  }\n}\n\nand the aggregation will merge the partial aggregations over the two indices.\nThis feature can be particularly useful for specific use cases that benefit from summary fields.", "createdAt": "2020-05-14T08:49:49Z", "url": "https://github.com/elastic/elasticsearch/pull/56745", "merged": true, "mergeCommit": {"oid": "66b5e4ec89a7562a38108840442ba21d0565adb7"}, "closed": true, "closedAt": "2020-11-10T17:32:00Z", "author": {"login": "csoulios"}, "timelineItems": {"totalCount": 49, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcTAXmKgH2gAyNDE3ODQ3MDQ5OjdiNjRkODNiNDQwNDg0YWVkZjlkNzU1YzM2NWRkMWMzZjcxMzg0Nzc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdbKb_igH2gAyNDE3ODQ3MDQ5OjdiNjI0MDcyYjlhNGZmMmJhZDA1MzE3N2JjYjI2NmE0MGZjNDQ3ZDI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "7b64d83b440484aedf9d755c365dd1c3f7138477", "author": {"user": {"login": "csoulios", "name": "Christos Soulios"}}, "url": "https://github.com/elastic/elasticsearch/commit/7b64d83b440484aedf9d755c365dd1c3f7138477", "committedDate": "2020-03-31T10:16:25Z", "message": "Implement aggregate_metric field mapper (#49830)\n\nImplemented aggregate_metric field type for storing pre-computed aggregates"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "098cf0f06bcb4fdefe35113a61fe4678a134db87", "author": {"user": {"login": "csoulios", "name": "Christos Soulios"}}, "url": "https://github.com/elastic/elasticsearch/commit/098cf0f06bcb4fdefe35113a61fe4678a134db87", "committedDate": "2020-03-31T10:17:10Z", "message": "Merge branch 'feature/aggregate-metrics' of github.com:elastic/elasticsearch into feature/aggregate-metrics"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3e273404f140aa20fcf7dfe226eddaef85e329a4", "author": {"user": {"login": "csoulios", "name": "Christos Soulios"}}, "url": "https://github.com/elastic/elasticsearch/commit/3e273404f140aa20fcf7dfe226eddaef85e329a4", "committedDate": "2020-04-07T14:49:46Z", "message": "Merge branch 'master' into feature/aggregate-metrics"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b37972564effc9972e27f2e1f599f4b55f8c2e22", "author": {"user": {"login": "csoulios", "name": "Christos Soulios"}}, "url": "https://github.com/elastic/elasticsearch/commit/b37972564effc9972e27f2e1f599f4b55f8c2e22", "committedDate": "2020-04-14T06:44:08Z", "message": "Merge branch 'master' into feature/aggregate-metrics"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7e277798dc51246a8a775920628d5b8738e1c8c5", "author": {"user": {"login": "csoulios", "name": "Christos Soulios"}}, "url": "https://github.com/elastic/elasticsearch/commit/7e277798dc51246a8a775920628d5b8738e1c8c5", "committedDate": "2020-04-21T12:04:57Z", "message": "Merge branch 'master' into feature/aggregate-metrics"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e0d355d4088f3336940b6b7558d9c75d9228c050", "author": {"user": {"login": "csoulios", "name": "Christos Soulios"}}, "url": "https://github.com/elastic/elasticsearch/commit/e0d355d4088f3336940b6b7558d9c75d9228c050", "committedDate": "2020-04-27T12:02:44Z", "message": "Merge branch 'master' into feature/aggregate-metrics"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f684601147d7bc9c00e9f5f6ca6991f5a0d5ada1", "author": {"user": {"login": "csoulios", "name": "Christos Soulios"}}, "url": "https://github.com/elastic/elasticsearch/commit/f684601147d7bc9c00e9f5f6ca6991f5a0d5ada1", "committedDate": "2020-04-28T08:46:23Z", "message": "Merge branch 'master' into feature/aggregate-metrics"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5e0c2cc11189ce4730439ce244f709a70c52198c", "author": {"user": {"login": "csoulios", "name": "Christos Soulios"}}, "url": "https://github.com/elastic/elasticsearch/commit/5e0c2cc11189ce4730439ce244f709a70c52198c", "committedDate": "2020-05-12T12:12:51Z", "message": "Merge branch 'master' into feature/aggregate-metrics"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1bc3f7585142cee7734d8b3e1d89a9aa84c21852", "author": {"user": {"login": "csoulios", "name": "Christos Soulios"}}, "url": "https://github.com/elastic/elasticsearch/commit/1bc3f7585142cee7734d8b3e1d89a9aa84c21852", "committedDate": "2020-05-12T12:41:34Z", "message": "Merge with master - fixes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9b77f773c019a0c3408b41d375f41d57070a0241", "author": {"user": {"login": "csoulios", "name": "Christos Soulios"}}, "url": "https://github.com/elastic/elasticsearch/commit/9b77f773c019a0c3408b41d375f41d57070a0241", "committedDate": "2020-05-13T15:16:31Z", "message": "Merge branch 'master' into feature/aggregate-metrics"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "046118cbe35bd5e3d14647d162075d12af30e350", "author": {"user": {"login": "csoulios", "name": "Christos Soulios"}}, "url": "https://github.com/elastic/elasticsearch/commit/046118cbe35bd5e3d14647d162075d12af30e350", "committedDate": "2020-05-14T06:46:54Z", "message": "Merge branch 'master' into feature/aggregate-metrics"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d89f9f32f0aa45ed48255853eaa8196bed97e562", "author": {"user": {"login": "csoulios", "name": "Christos Soulios"}}, "url": "https://github.com/elastic/elasticsearch/commit/d89f9f32f0aa45ed48255853eaa8196bed97e562", "committedDate": "2020-05-14T08:44:40Z", "message": "Implement aggregations on aggregate metrics (#53986)\n\nFollowing the implementation of the aggregate_metric_double field mapper(#49830) we are implementing the Min, Max, ValueCount, Sum and Average aggregations on aggregate metrics.\r\n\r\nThe code builds on the excellent work done for #42949 and uses the extensible ValuesSources infrastructure to wire up common metric aggregation on the aggregate_metric_double field type.\r\n\r\nThis PR is part of the rollups v2 refactoring as described in meta issue #42720"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "344f0133e16b064a301d6a4beab97d771d69a412", "author": {"user": {"login": "csoulios", "name": "Christos Soulios"}}, "url": "https://github.com/elastic/elasticsearch/commit/344f0133e16b064a301d6a4beab97d771d69a412", "committedDate": "2020-05-14T14:13:53Z", "message": "Merge branch 'master' into feature/aggregate-metrics"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "772112537115716c8daba3c4663f7b678b9cfcda", "author": {"user": {"login": "csoulios", "name": "Christos Soulios"}}, "url": "https://github.com/elastic/elasticsearch/commit/772112537115716c8daba3c4663f7b678b9cfcda", "committedDate": "2020-06-18T16:27:40Z", "message": "Merge branch 'master' into feature/aggregate-metrics"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "da07deb90734d12dec9c7a0e0d50579af77acd5f", "author": {"user": {"login": "csoulios", "name": "Christos Soulios"}}, "url": "https://github.com/elastic/elasticsearch/commit/da07deb90734d12dec9c7a0e0d50579af77acd5f", "committedDate": "2020-06-23T10:59:51Z", "message": "Merge branch 'master' into feature/aggregate-metrics"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM1ODczODU1", "url": "https://github.com/elastic/elasticsearch/pull/56745#pullrequestreview-435873855", "createdAt": "2020-06-23T15:00:29Z", "commit": {"oid": "da07deb90734d12dec9c7a0e0d50579af77acd5f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yM1QxNTowMDoyOVrOGntf8Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yM1QxNTowMDoyOVrOGntf8Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDI5MzEwNQ==", "bodyText": "Just a heads up - I changed MetricAggregatorSupplier to take a ValuesSourceConfig here instead of separate ValuesSource and DocValuesFormat args.  I've cleaned up VSConfig so it can be used as an actual config object rather than having to pick it apart in the factories.", "url": "https://github.com/elastic/elasticsearch/pull/56745#discussion_r444293105", "createdAt": "2020-06-23T15:00:29Z", "author": {"login": "not-napoleon"}, "path": "x-pack/plugin/mapper-aggregate-metric/src/main/java/org/elasticsearch/xpack/aggregatemetric/aggregations/metrics/AggregateMetricsAggregatorsRegistrar.java", "diffHunk": "@@ -0,0 +1,104 @@\n+/*\n+ * Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one\n+ * or more contributor license agreements. Licensed under the Elastic License;\n+ * you may not use this file except in compliance with the Elastic License.\n+ */\n+package org.elasticsearch.xpack.aggregatemetric.aggregations.metrics;\n+\n+import org.elasticsearch.search.aggregations.metrics.AvgAggregationBuilder;\n+import org.elasticsearch.search.aggregations.metrics.MaxAggregationBuilder;\n+import org.elasticsearch.search.aggregations.metrics.MetricAggregatorSupplier;\n+import org.elasticsearch.search.aggregations.metrics.MinAggregationBuilder;\n+import org.elasticsearch.search.aggregations.metrics.MinMaxAggregatorSupplier;\n+import org.elasticsearch.search.aggregations.metrics.SumAggregationBuilder;\n+import org.elasticsearch.search.aggregations.metrics.ValueCountAggregationBuilder;\n+import org.elasticsearch.search.aggregations.metrics.ValueCountAggregatorSupplier;\n+import org.elasticsearch.search.aggregations.support.ValuesSourceRegistry;\n+import org.elasticsearch.xpack.aggregatemetric.aggregations.support.AggregateMetricsValuesSource;\n+import org.elasticsearch.xpack.aggregatemetric.aggregations.support.AggregateMetricsValuesSourceType;\n+\n+/**\n+ * Utility class providing static methods to register aggregators for the aggregate_metric values source\n+ */\n+public class AggregateMetricsAggregatorsRegistrar {\n+\n+    public static void registerSumAggregator(ValuesSourceRegistry.Builder builder) {\n+        builder.register(\n+            SumAggregationBuilder.NAME,\n+            AggregateMetricsValuesSourceType.AGGREGATE_METRIC,\n+            (MetricAggregatorSupplier) (name, valuesSource, formatter, context, parent, metadata) -> new AggregateMetricBackedSumAggregator(\n+                name,\n+                (AggregateMetricsValuesSource.AggregateDoubleMetric) valuesSource,\n+                formatter,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "da07deb90734d12dec9c7a0e0d50579af77acd5f"}, "originalPosition": 32}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f0036bd659242a02e28911e4ab115eaf7444883b", "author": {"user": {"login": "csoulios", "name": "Christos Soulios"}}, "url": "https://github.com/elastic/elasticsearch/commit/f0036bd659242a02e28911e4ab115eaf7444883b", "committedDate": "2020-06-24T13:22:57Z", "message": "Merge branch 'master' into feature/aggregate-metrics"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a28665ebc40db54071aaf5bd6b87648893636769", "author": {"user": {"login": "csoulios", "name": "Christos Soulios"}}, "url": "https://github.com/elastic/elasticsearch/commit/a28665ebc40db54071aaf5bd6b87648893636769", "committedDate": "2020-06-30T10:27:37Z", "message": "Resolve conflicts from master"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4e14b1597b1c2e2262e3e35f85abd42d25385283", "author": {"user": {"login": "csoulios", "name": "Christos Soulios"}}, "url": "https://github.com/elastic/elasticsearch/commit/4e14b1597b1c2e2262e3e35f85abd42d25385283", "committedDate": "2020-06-30T10:29:14Z", "message": "Merge branch 'master' into feature/aggregate-metrics"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a99c84be9498b1c99a4393f5a7d58fe28c7ef799", "author": {"user": {"login": "csoulios", "name": "Christos Soulios"}}, "url": "https://github.com/elastic/elasticsearch/commit/a99c84be9498b1c99a4393f5a7d58fe28c7ef799", "committedDate": "2020-06-30T13:31:38Z", "message": "Fix integration tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "750d3a6484dfda02edcdcb2d1860ea9b99ec04fd", "author": {"user": {"login": "talevy", "name": "Tal Levy"}}, "url": "https://github.com/elastic/elasticsearch/commit/750d3a6484dfda02edcdcb2d1860ea9b99ec04fd", "committedDate": "2020-07-07T19:48:36Z", "message": "Merge remote-tracking branch 'elastic/master' into feature/aggregate-metrics"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8aed7074ee34b68352e478f07e20c8fe6474606f", "author": {"user": {"login": "csoulios", "name": "Christos Soulios"}}, "url": "https://github.com/elastic/elasticsearch/commit/8aed7074ee34b68352e478f07e20c8fe6474606f", "committedDate": "2020-07-17T07:01:19Z", "message": "Merge branch 'master' into feature/aggregate-metrics"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f0c5105981ec02ab5aca9d7023a818e99a088ad7", "author": {"user": {"login": "csoulios", "name": "Christos Soulios"}}, "url": "https://github.com/elastic/elasticsearch/commit/f0c5105981ec02ab5aca9d7023a818e99a088ad7", "committedDate": "2020-07-17T08:24:57Z", "message": "Updated branch to fix build after merge"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cff3edf04f7861611e57db711d2412ca190dabad", "author": {"user": {"login": "talevy", "name": "Tal Levy"}}, "url": "https://github.com/elastic/elasticsearch/commit/cff3edf04f7861611e57db711d2412ca190dabad", "committedDate": "2020-08-05T23:21:11Z", "message": "Merge remote-tracking branch 'elastic/master' into feature/aggregate-metrics"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d8b2606db9c4e64ac42068c9df46b3b6fb7af313", "author": {"user": {"login": "talevy", "name": "Tal Levy"}}, "url": "https://github.com/elastic/elasticsearch/commit/d8b2606db9c4e64ac42068c9df46b3b6fb7af313", "committedDate": "2020-08-06T00:34:23Z", "message": "update code in latest merge"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1062fb505e9e074fc3992fa38030fff728f26bcd", "author": {"user": {"login": "csoulios", "name": "Christos Soulios"}}, "url": "https://github.com/elastic/elasticsearch/commit/1062fb505e9e074fc3992fa38030fff728f26bcd", "committedDate": "2020-08-20T12:42:19Z", "message": "Merge branch 'master' into feature/aggregate-metrics"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f740c038d5fde7f16b425668629248611395aede", "author": {"user": {"login": "csoulios", "name": "Christos Soulios"}}, "url": "https://github.com/elastic/elasticsearch/commit/f740c038d5fde7f16b425668629248611395aede", "committedDate": "2020-08-25T12:20:09Z", "message": "Merge branch 'master' into feature/aggregate-metrics"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b638d4699f76a8be60adf939de0cf2b3626e0c36", "author": {"user": {"login": "csoulios", "name": "Christos Soulios"}}, "url": "https://github.com/elastic/elasticsearch/commit/b638d4699f76a8be60adf939de0cf2b3626e0c36", "committedDate": "2020-08-25T14:26:17Z", "message": "Fix errors after merge"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c6834ce6f31533e4b9a8bbd68220edb5a752a8d2", "author": {"user": {"login": "csoulios", "name": "Christos Soulios"}}, "url": "https://github.com/elastic/elasticsearch/commit/c6834ce6f31533e4b9a8bbd68220edb5a752a8d2", "committedDate": "2020-09-21T09:37:59Z", "message": "Merge branch 'master' into feature/aggregate-metrics"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "151d6080683721ade57ed9f83b3849c203af5f16", "author": {"user": {"login": "csoulios", "name": "Christos Soulios"}}, "url": "https://github.com/elastic/elasticsearch/commit/151d6080683721ade57ed9f83b3849c203af5f16", "committedDate": "2020-09-21T09:51:22Z", "message": "Fix errors after merge"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4e23148eb5c44a8df0dc2fde2047f609500c2300", "author": {"user": {"login": "csoulios", "name": "Christos Soulios"}}, "url": "https://github.com/elastic/elasticsearch/commit/4e23148eb5c44a8df0dc2fde2047f609500c2300", "committedDate": "2020-09-23T11:59:16Z", "message": "Merge branch 'master' into feature/aggregate-metrics"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3a4927875df5817aba6d031caedaed1b30cf8ca2", "author": {"user": {"login": "csoulios", "name": "Christos Soulios"}}, "url": "https://github.com/elastic/elasticsearch/commit/3a4927875df5817aba6d031caedaed1b30cf8ca2", "committedDate": "2020-09-23T12:48:34Z", "message": "Fix errors after merge"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "06e9b0b3d2f80fa3960fcba15fb3ae9e3295a3da", "author": {"user": {"login": "csoulios", "name": "Christos Soulios"}}, "url": "https://github.com/elastic/elasticsearch/commit/06e9b0b3d2f80fa3960fcba15fb3ae9e3295a3da", "committedDate": "2020-10-19T13:16:11Z", "message": "Merge branch 'master' into feature/aggregate-metrics"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9eb135f9c886c05f7c6e6326a37d3474ae876521", "author": {"user": {"login": "csoulios", "name": "Christos Soulios"}}, "url": "https://github.com/elastic/elasticsearch/commit/9eb135f9c886c05f7c6e6326a37d3474ae876521", "committedDate": "2020-10-20T09:27:51Z", "message": "Fix errors after merge"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f0d14130143d06ce46ddbc745fcb776ce47c48c0", "author": {"user": {"login": "csoulios", "name": "Christos Soulios"}}, "url": "https://github.com/elastic/elasticsearch/commit/f0d14130143d06ce46ddbc745fcb776ce47c48c0", "committedDate": "2020-10-20T09:28:27Z", "message": "Merge branch 'master' into feature/aggregate-metrics"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f743b4c79310a8f31e075448dfda57a365994b41", "author": {"user": {"login": "csoulios", "name": "Christos Soulios"}}, "url": "https://github.com/elastic/elasticsearch/commit/f743b4c79310a8f31e075448dfda57a365994b41", "committedDate": "2020-10-21T06:50:18Z", "message": "Merge branch 'master' into feature/aggregate-metrics"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b95f8496d636713f22f23f950a438b99ccfe252a", "author": {"user": {"login": "csoulios", "name": "Christos Soulios"}}, "url": "https://github.com/elastic/elasticsearch/commit/b95f8496d636713f22f23f950a438b99ccfe252a", "committedDate": "2020-10-26T15:20:06Z", "message": "Merge branch 'master' into feature/aggregate-metrics"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "26e650c8c600b8af0a1e6383b24d8cd04c1b1d7b", "author": {"user": {"login": "csoulios", "name": "Christos Soulios"}}, "url": "https://github.com/elastic/elasticsearch/commit/26e650c8c600b8af0a1e6383b24d8cd04c1b1d7b", "committedDate": "2020-10-27T10:12:32Z", "message": "Merge branch 'master' into feature/aggregate-metrics"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6b4dcabbf27678ba94157cfb48d3372492db7a62", "author": {"user": {"login": "csoulios", "name": "Christos Soulios"}}, "url": "https://github.com/elastic/elasticsearch/commit/6b4dcabbf27678ba94157cfb48d3372492db7a62", "committedDate": "2020-10-27T11:23:01Z", "message": "Converted aggregate_metric_double field mapper to parameterized mapper (#64172)\n\nAggregateDoubleMetricFieldMapper was originally not written as a parametrized field mapper.\r\n\r\nThis PR refactors AggregateDoubleMetricFieldMapper to extend ParametrizedFieldMapper.\r\n\r\nAlso, refactored AggregateDoubleMetricFieldMapperTests to extend MapperTestCase instead of ESSingleNodeTestCase"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dd0c42720eb8ee24590107887b5e382370532878", "author": {"user": {"login": "csoulios", "name": "Christos Soulios"}}, "url": "https://github.com/elastic/elasticsearch/commit/dd0c42720eb8ee24590107887b5e382370532878", "committedDate": "2020-10-27T17:40:11Z", "message": "Merge branch 'master' into feature/aggregate-metrics"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "41aa699f1386553184813586f472670963c08a33", "author": {"user": {"login": "csoulios", "name": "Christos Soulios"}}, "url": "https://github.com/elastic/elasticsearch/commit/41aa699f1386553184813586f472670963c08a33", "committedDate": "2020-10-27T17:47:19Z", "message": "Fix errors after merge"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0458002f4cabb4efa2fb55ffcf86be9de9e8d650", "author": {"user": {"login": "talevy", "name": "Tal Levy"}}, "url": "https://github.com/elastic/elasticsearch/commit/0458002f4cabb4efa2fb55ffcf86be9de9e8d650", "committedDate": "2020-10-28T19:09:51Z", "message": "Merge remote-tracking branch 'elastic/master' into feature/aggregate-metrics"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "745e9998b4372056dcb843f99a3f71f2964b4c9a", "author": {"user": {"login": "csoulios", "name": "Christos Soulios"}}, "url": "https://github.com/elastic/elasticsearch/commit/745e9998b4372056dcb843f99a3f71f2964b4c9a", "committedDate": "2020-11-02T16:04:57Z", "message": "Merge branch 'master' into feature/aggregate-metrics"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "af15450ac2b4bc4c7efa6bfa0ebc97d469f53daa", "author": {"user": {"login": "csoulios", "name": "Christos Soulios"}}, "url": "https://github.com/elastic/elasticsearch/commit/af15450ac2b4bc4c7efa6bfa0ebc97d469f53daa", "committedDate": "2020-11-02T16:34:54Z", "message": "Fix errors after merge"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "443856a68d53434e71d8423900cc3ea1155204c8", "author": {"user": {"login": "talevy", "name": "Tal Levy"}}, "url": "https://github.com/elastic/elasticsearch/commit/443856a68d53434e71d8423900cc3ea1155204c8", "committedDate": "2020-11-05T18:42:22Z", "message": "Merge remote-tracking branch 'elastic/master' into feature/aggregate-metrics"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2442f47a07465410c6919686adb06371abba8504", "author": {"user": {"login": "talevy", "name": "Tal Levy"}}, "url": "https://github.com/elastic/elasticsearch/commit/2442f47a07465410c6919686adb06371abba8504", "committedDate": "2020-11-05T23:04:41Z", "message": "Merge remote-tracking branch 'elastic/master' into feature/aggregate-metrics"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e0f0a36214e408a25471dc83d95bdfbe6c0c2b11", "author": {"user": {"login": "talevy", "name": "Tal Levy"}}, "url": "https://github.com/elastic/elasticsearch/commit/e0f0a36214e408a25471dc83d95bdfbe6c0c2b11", "committedDate": "2020-11-09T17:21:29Z", "message": "Hide metric sub-fields from aggregate_metric searches and add support for scripting (#64323)\n\nThis commit only adds one searchable field to the aggregate_metric\r\nfield mapper. It makes the defaultMetric value searchable under the\r\nsame field name as the aggregate_metric.\r\n\r\nThis should make aggregate_metric behave more like a numeric in\r\nmost use-cases.\r\n\r\n```\r\n{\r\n    ...\r\n    \"fields\": {\r\n        \"temperature\": {\r\n            \"aggregate_metric_double\": {\r\n                \"type\": \"aggregate_metric_double\",\r\n                \"searchable\": true,\r\n                \"aggregatable\": true\r\n            }\r\n        }\r\n    }\r\n}\r\n```\r\n\r\nOther things in this PR\r\n\r\n- `default_metric` is now required and does not default to `max`\r\n- the fields API's valueFetcher for `aggregate_metric_double` now returns the default-metric value\r\n- support for scripting, where the doc-value returned is that of the `default_metric`"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8123f2e210e474abc600356f349308f1359d0bf7", "author": {"user": {"login": "talevy", "name": "Tal Levy"}}, "url": "https://github.com/elastic/elasticsearch/commit/8123f2e210e474abc600356f349308f1359d0bf7", "committedDate": "2020-11-09T18:58:39Z", "message": "Merge remote-tracking branch 'elastic/master' into feature/aggregate-metrics"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7b624072b9a4ff2bad053177bcb266a40fc447d2", "author": {"user": {"login": "csoulios", "name": "Christos Soulios"}}, "url": "https://github.com/elastic/elasticsearch/commit/7b624072b9a4ff2bad053177bcb266a40fc447d2", "committedDate": "2020-11-10T14:42:49Z", "message": "Merge branch 'master' into feature/aggregate-metrics"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4963, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}