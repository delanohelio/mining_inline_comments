{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTAzMjM1MDcw", "number": 63655, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNFQxMTowMDowNlrOEtbegA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNFQxMTowMDowNlrOEtbegA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE2MDcxNTUyOnYy", "diffSide": "RIGHT", "path": "test/framework/src/main/java/org/elasticsearch/snapshots/AbstractSnapshotIntegTestCase.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNFQxMTowMDowNlrOHhNkfw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNFQxMTowMjo1MVrOHhNqaA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDU4NzM5MQ==", "bodyText": "This actually fixes a bug, we just didn't see the bug in practice yet because we only used this method in tests with a single master node ...", "url": "https://github.com/elastic/elasticsearch/pull/63655#discussion_r504587391", "createdAt": "2020-10-14T11:00:06Z", "author": {"login": "original-brownbear"}, "path": "test/framework/src/main/java/org/elasticsearch/snapshots/AbstractSnapshotIntegTestCase.java", "diffHunk": "@@ -582,7 +538,7 @@ protected SnapshotInfo getSnapshot(String repository, String snapshot) {\n \n     protected void awaitMasterFinishRepoOperations() throws Exception {\n         logger.info(\"--> waiting for master to finish all repo operations on its SNAPSHOT pool\");\n-        final ThreadPool masterThreadPool = internalCluster().getMasterNodeInstance(ThreadPool.class);\n+        final ThreadPool masterThreadPool = internalCluster().getCurrentMasterNodeInstance(ThreadPool.class);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "039d4f6bd2c63de7eb86baa5cf0eff1225fd34d0"}, "originalPosition": 260}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDU4ODkwNA==", "bodyText": "Yeah, I noticed similar issue in DiskThresholdDeciderIT. getMasterNodeInstance() is trappy and should be renamed.", "url": "https://github.com/elastic/elasticsearch/pull/63655#discussion_r504588904", "createdAt": "2020-10-14T11:02:51Z", "author": {"login": "tlrx"}, "path": "test/framework/src/main/java/org/elasticsearch/snapshots/AbstractSnapshotIntegTestCase.java", "diffHunk": "@@ -582,7 +538,7 @@ protected SnapshotInfo getSnapshot(String repository, String snapshot) {\n \n     protected void awaitMasterFinishRepoOperations() throws Exception {\n         logger.info(\"--> waiting for master to finish all repo operations on its SNAPSHOT pool\");\n-        final ThreadPool masterThreadPool = internalCluster().getMasterNodeInstance(ThreadPool.class);\n+        final ThreadPool masterThreadPool = internalCluster().getCurrentMasterNodeInstance(ThreadPool.class);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDU4NzM5MQ=="}, "originalCommit": {"oid": "039d4f6bd2c63de7eb86baa5cf0eff1225fd34d0"}, "originalPosition": 260}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2860, "cost": 1, "resetAt": "2021-11-12T11:57:46Z"}}}