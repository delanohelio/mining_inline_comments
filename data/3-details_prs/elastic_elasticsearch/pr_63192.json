{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDk2OTQzMzM0", "number": 63192, "title": "EQL: Change default indices options", "bodyText": "Ignore by default unavailable indices (same as ES) and verify that\nallowNoIndices is set to false since at least one index is required\nfor validating the query.\nFix #62986", "createdAt": "2020-10-02T14:27:56Z", "url": "https://github.com/elastic/elasticsearch/pull/63192", "merged": true, "mergeCommit": {"oid": "fd75ac27223cd1b699b8d9c311dc401a39f9e0c8"}, "closed": true, "closedAt": "2020-10-05T11:18:59Z", "author": {"login": "costin"}, "timelineItems": {"totalCount": 13, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdOmxlyAH2gAyNDk2OTQzMzM0OjJlNGRlODlkMDQ4ZDM2YzdhNGE3MDlkYTgwYmRkOGZjZjA1NmZiNDk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdPh7zKgH2gAyNDk2OTQzMzM0OmIxYjM1MmE1YzA0N2IxN2U0MTA3YmI2Yzg2Mzg5MDBhYzQyODUwYjE=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "2e4de89d048d36c7a4a709da80bdd8fcf056fb49", "author": {"user": {"login": "costin", "name": "Costin Leau"}}, "url": "https://github.com/elastic/elasticsearch/commit/2e4de89d048d36c7a4a709da80bdd8fcf056fb49", "committedDate": "2020-10-02T14:22:44Z", "message": "EQL: Change default indices options\n\nIgnore by default unavailable indices (same as ES) and verify that\nallowNoIndices is set to false since at least one index is required\nfor validating the query.\n\nFix #62986"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAxMTg1Mjgx", "url": "https://github.com/elastic/elasticsearch/pull/63192#pullrequestreview-501185281", "createdAt": "2020-10-02T14:29:08Z", "commit": {"oid": "2e4de89d048d36c7a4a709da80bdd8fcf056fb49"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMlQxNDoyOTowOFrOHbv1KA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMlQxNDoyOTowOFrOHbv1KA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODg1NzI1Ng==", "bodyText": "@imotov not sure why this fails now... Essentially by changing the index option ignoreUnavailable from false to true the 403/unauthorized became a 404...", "url": "https://github.com/elastic/elasticsearch/pull/63192#discussion_r498857256", "createdAt": "2020-10-02T14:29:08Z", "author": {"login": "costin"}, "path": "x-pack/plugin/eql/qa/security/src/javaRestTest/java/org/elasticsearch/xpack/eql/AsyncEqlSecurityIT.java", "diffHunk": "@@ -89,8 +89,8 @@ private void testCase(String user, String other) throws Exception {\n         }\n         ResponseException exc = expectThrows(ResponseException.class,\n             () -> submitAsyncEqlSearch(\"index-\" + other, \"*\", TimeValue.timeValueSeconds(10), user));\n-        assertThat(exc.getResponse().getStatusLine().getStatusCode(), equalTo(403));\n-        assertThat(exc.getMessage(), containsString(\"unauthorized\"));\n+        assertThat(exc.getResponse().getStatusLine().getStatusCode(), equalTo(404));\n+        //assertThat(exc.getMessage(), containsString(\"unauthorized\"));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2e4de89d048d36c7a4a709da80bdd8fcf056fb49"}, "originalPosition": 7}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAxMTk5MTEx", "url": "https://github.com/elastic/elasticsearch/pull/63192#pullrequestreview-501199111", "createdAt": "2020-10-02T14:45:33Z", "commit": {"oid": "2e4de89d048d36c7a4a709da80bdd8fcf056fb49"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAxMjAxMDQw", "url": "https://github.com/elastic/elasticsearch/pull/63192#pullrequestreview-501201040", "createdAt": "2020-10-02T14:47:46Z", "commit": {"oid": "2e4de89d048d36c7a4a709da80bdd8fcf056fb49"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAxMjM0ODc0", "url": "https://github.com/elastic/elasticsearch/pull/63192#pullrequestreview-501234874", "createdAt": "2020-10-02T15:27:51Z", "commit": {"oid": "2e4de89d048d36c7a4a709da80bdd8fcf056fb49"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMlQxNToyNzo1MVrOHbx_4w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMlQxNTozMDoxNlrOHbyFaQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODg5Mjc3MQ==", "bodyText": "I think it is because we ignore unavailable indices and ended up with no indices at all, which leads to 404.", "url": "https://github.com/elastic/elasticsearch/pull/63192#discussion_r498892771", "createdAt": "2020-10-02T15:27:51Z", "author": {"login": "imotov"}, "path": "x-pack/plugin/eql/qa/security/src/javaRestTest/java/org/elasticsearch/xpack/eql/AsyncEqlSecurityIT.java", "diffHunk": "@@ -89,8 +89,8 @@ private void testCase(String user, String other) throws Exception {\n         }\n         ResponseException exc = expectThrows(ResponseException.class,\n             () -> submitAsyncEqlSearch(\"index-\" + other, \"*\", TimeValue.timeValueSeconds(10), user));\n-        assertThat(exc.getResponse().getStatusLine().getStatusCode(), equalTo(403));\n-        assertThat(exc.getMessage(), containsString(\"unauthorized\"));\n+        assertThat(exc.getResponse().getStatusLine().getStatusCode(), equalTo(404));\n+        //assertThat(exc.getMessage(), containsString(\"unauthorized\"));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODg1NzI1Ng=="}, "originalCommit": {"oid": "2e4de89d048d36c7a4a709da80bdd8fcf056fb49"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODg5NDE4NQ==", "bodyText": "missing : at the end", "url": "https://github.com/elastic/elasticsearch/pull/63192#discussion_r498894185", "createdAt": "2020-10-02T15:30:16Z", "author": {"login": "imotov"}, "path": "x-pack/plugin/eql/qa/rest/src/yamlRestTest/resources/rest-api-spec/test/eql/10_basic.yml", "diffHunk": "@@ -83,6 +83,20 @@ setup:\n   - match: {hits.sequences.1.events.0._id: \"2\"}\n   - match: {hits.sequences.1.events.1._id: \"3\"}\n \n+---\n+\"Execute EQL sequence by default ignores unavailable indices\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2e4de89d048d36c7a4a709da80bdd8fcf056fb49"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "280a4bf98d0563a2f7c50adfa2123e24b5e91731", "author": {"user": {"login": "costin", "name": "Costin Leau"}}, "url": "https://github.com/elastic/elasticsearch/commit/280a4bf98d0563a2f7c50adfa2123e24b5e91731", "committedDate": "2020-10-02T18:25:58Z", "message": "Update yml file"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAxMzU3MjY5", "url": "https://github.com/elastic/elasticsearch/pull/63192#pullrequestreview-501357269", "createdAt": "2020-10-02T18:27:09Z", "commit": {"oid": "2e4de89d048d36c7a4a709da80bdd8fcf056fb49"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMlQxODoyNzowOVrOHb3jNQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMlQxODoyNzowOVrOHb3jNQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODk4MzczMw==", "bodyText": "@astefan the change inside EQL high-level rest client.", "url": "https://github.com/elastic/elasticsearch/pull/63192#discussion_r498983733", "createdAt": "2020-10-02T18:27:09Z", "author": {"login": "costin"}, "path": "client/rest-high-level/src/main/java/org/elasticsearch/client/eql/EqlSearchRequest.java", "diffHunk": "@@ -34,7 +34,7 @@\n public class EqlSearchRequest implements Validatable, ToXContentObject {\n \n     private String[] indices;\n-    private IndicesOptions indicesOptions = IndicesOptions.fromOptions(false, false, true, false);\n+    private IndicesOptions indicesOptions = IndicesOptions.fromOptions(true, false, true, false);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2e4de89d048d36c7a4a709da80bdd8fcf056fb49"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAxMzYwNTg1", "url": "https://github.com/elastic/elasticsearch/pull/63192#pullrequestreview-501360585", "createdAt": "2020-10-02T18:32:06Z", "commit": {"oid": "2e4de89d048d36c7a4a709da80bdd8fcf056fb49"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMlQxODozMjowN1rOHb3s-w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMlQxODozMjowN1rOHb3s-w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODk4NjIzNQ==", "bodyText": "@matriv the integration test against non-existing indices", "url": "https://github.com/elastic/elasticsearch/pull/63192#discussion_r498986235", "createdAt": "2020-10-02T18:32:07Z", "author": {"login": "costin"}, "path": "x-pack/plugin/eql/qa/rest/src/yamlRestTest/resources/rest-api-spec/test/eql/10_basic.yml", "diffHunk": "@@ -83,6 +83,20 @@ setup:\n   - match: {hits.sequences.1.events.0._id: \"2\"}\n   - match: {hits.sequences.1.events.1._id: \"3\"}\n \n+---\n+\"Execute EQL sequence by default ignores unavailable indices\"\n+  - do:\n+      eql.search:\n+        index: eql_test,non_existing", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2e4de89d048d36c7a4a709da80bdd8fcf056fb49"}, "originalPosition": 8}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAxNDA2NjM2", "url": "https://github.com/elastic/elasticsearch/pull/63192#pullrequestreview-501406636", "createdAt": "2020-10-02T19:50:22Z", "commit": {"oid": "280a4bf98d0563a2f7c50adfa2123e24b5e91731"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3e843d6a16121b254a317f759c275b7c9a4e0e93", "author": {"user": {"login": "costin", "name": "Costin Leau"}}, "url": "https://github.com/elastic/elasticsearch/commit/3e843d6a16121b254a317f759c275b7c9a4e0e93", "committedDate": "2020-10-03T09:17:11Z", "message": "Add integration test for non-existing index pattern"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAxNzQzMzY5", "url": "https://github.com/elastic/elasticsearch/pull/63192#pullrequestreview-501743369", "createdAt": "2020-10-05T06:11:01Z", "commit": {"oid": "3e843d6a16121b254a317f759c275b7c9a4e0e93"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNVQwNjoxMTowMVrOHcOsbA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNVQwNjoxMjoxMVrOHcOtqg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTM2MjkyNA==", "bodyText": "Should we remove it then?", "url": "https://github.com/elastic/elasticsearch/pull/63192#discussion_r499362924", "createdAt": "2020-10-05T06:11:01Z", "author": {"login": "matriv"}, "path": "x-pack/plugin/eql/qa/security/src/javaRestTest/java/org/elasticsearch/xpack/eql/AsyncEqlSecurityIT.java", "diffHunk": "@@ -89,8 +89,8 @@ private void testCase(String user, String other) throws Exception {\n         }\n         ResponseException exc = expectThrows(ResponseException.class,\n             () -> submitAsyncEqlSearch(\"index-\" + other, \"*\", TimeValue.timeValueSeconds(10), user));\n-        assertThat(exc.getResponse().getStatusLine().getStatusCode(), equalTo(403));\n-        assertThat(exc.getMessage(), containsString(\"unauthorized\"));\n+        assertThat(exc.getResponse().getStatusLine().getStatusCode(), equalTo(404));\n+        //assertThat(exc.getMessage(), containsString(\"unauthorized\"));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3e843d6a16121b254a317f759c275b7c9a4e0e93"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTM2MzI0Mg==", "bodyText": "I meant to query against only unavailable indices, just for completeness.", "url": "https://github.com/elastic/elasticsearch/pull/63192#discussion_r499363242", "createdAt": "2020-10-05T06:12:11Z", "author": {"login": "matriv"}, "path": "x-pack/plugin/eql/qa/rest/src/yamlRestTest/resources/rest-api-spec/test/eql/10_basic.yml", "diffHunk": "@@ -83,6 +83,20 @@ setup:\n   - match: {hits.sequences.1.events.0._id: \"2\"}\n   - match: {hits.sequences.1.events.1._id: \"3\"}\n \n+---\n+\"Execute EQL sequence by default ignores unavailable indices\"\n+  - do:\n+      eql.search:\n+        index: eql_test,non_existing", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODk4NjIzNQ=="}, "originalCommit": {"oid": "2e4de89d048d36c7a4a709da80bdd8fcf056fb49"}, "originalPosition": 8}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAxODg4Mjk3", "url": "https://github.com/elastic/elasticsearch/pull/63192#pullrequestreview-501888297", "createdAt": "2020-10-05T09:44:35Z", "commit": {"oid": "3e843d6a16121b254a317f759c275b7c9a4e0e93"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b1b352a5c047b17e4107bb6c8638900ac42850b1", "author": {"user": {"login": "costin", "name": "Costin Leau"}}, "url": "https://github.com/elastic/elasticsearch/commit/b1b352a5c047b17e4107bb6c8638900ac42850b1", "committedDate": "2020-10-05T11:18:17Z", "message": "Remove commented code"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4492, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}