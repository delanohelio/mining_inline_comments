{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA2OTE4MDE4", "number": 55558, "title": "Emit deprecation warning if multiple v1 templates match with a new index", "bodyText": "This change adds deprecation warning when multiple v1 templates match with a new index.\nThis is deprecated because with v2 templates only one template can match and multiple \"levels\" of settings should be done using component templates.\nRelates to #53101", "createdAt": "2020-04-21T21:26:16Z", "url": "https://github.com/elastic/elasticsearch/pull/55558", "merged": true, "mergeCommit": {"oid": "ad77c7ea31b7ba7d6273c6dc55ae313edaab116f"}, "closed": true, "closedAt": "2020-04-30T14:38:13Z", "author": {"login": "probakowski"}, "timelineItems": {"totalCount": 16, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcZ6eE2AH2gAyNDA2OTE4MDE4OjI4ZWM3NzA4YjRiZjliNGUxMGRjYWExM2QyYmYxNTEzZDQxMWViMDM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABccePpKAH2gAyNDA2OTE4MDE4OjQ2MTM4NTFjMWIwYjA2OTc2M2M5ZmEwZjUwZmFjOWEyNTJhMWQwMGY=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "28ec7708b4bf9b4e10dcaa13d2bf1513d411eb03", "author": {"user": {"login": "probakowski", "name": "Przemko Robakowski"}}, "url": "https://github.com/elastic/elasticsearch/commit/28ec7708b4bf9b4e10dcaa13d2bf1513d411eb03", "committedDate": "2020-04-21T21:21:32Z", "message": "Emit deprecation warning if multiple v1 templates match with a new index"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6743582f78099dca122f815a55c22ebba7adf174", "author": {"user": {"login": "probakowski", "name": "Przemko Robakowski"}}, "url": "https://github.com/elastic/elasticsearch/commit/6743582f78099dca122f815a55c22ebba7adf174", "committedDate": "2020-04-22T17:36:57Z", "message": "fix test"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk3Njk3NDg5", "url": "https://github.com/elastic/elasticsearch/pull/55558#pullrequestreview-397697489", "createdAt": "2020-04-21T21:42:53Z", "commit": {"oid": "28ec7708b4bf9b4e10dcaa13d2bf1513d411eb03"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMVQyMTo0Mjo1M1rOGJZvAA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMVQyMTo0Mjo1M1rOGJZvAA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjUxMjAwMA==", "bodyText": "minor wording change:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                                    \"[{}], it won't be supported with index templates v2\", request.index(),\n          \n          \n            \n                                    \"[{}], and won't be supported with v2 index templates\", request.index(),", "url": "https://github.com/elastic/elasticsearch/pull/55558#discussion_r412512000", "createdAt": "2020-04-21T21:42:53Z", "author": {"login": "dakrone"}, "path": "server/src/main/java/org/elasticsearch/cluster/metadata/MetadataCreateIndexService.java", "diffHunk": "@@ -345,6 +345,12 @@ public ClusterState applyCreateIndexRequest(ClusterState currentState, CreateInd\n                 final List<IndexTemplateMetadata> v1Templates = MetadataIndexTemplateService.findV1Templates(currentState.metadata(),\n                     request.index(), isHiddenFromRequest);\n \n+                if (v1Templates.size() > 1) {\n+                    deprecationLogger.deprecatedAndMaybeLog(\"index_template_multiple_match\", \"index [{}] matches multiple templates \" +\n+                        \"[{}], it won't be supported with index templates v2\", request.index(),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "28ec7708b4bf9b4e10dcaa13d2bf1513d411eb03"}, "originalPosition": 6}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "41beebce3e6d52f0f032fae1da9a7f2bdb0c4e17", "author": {"user": {"login": "probakowski", "name": "Przemko Robakowski"}}, "url": "https://github.com/elastic/elasticsearch/commit/41beebce3e6d52f0f032fae1da9a7f2bdb0c4e17", "committedDate": "2020-04-22T17:51:24Z", "message": "Update server/src/main/java/org/elasticsearch/cluster/metadata/MetadataCreateIndexService.java\n\nCo-Authored-By: Lee Hinman <dakrone@users.noreply.github.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8ef900637f249e52f02ea0620ab4f83bce1861de", "author": {"user": {"login": "probakowski", "name": "Przemko Robakowski"}}, "url": "https://github.com/elastic/elasticsearch/commit/8ef900637f249e52f02ea0620ab4f83bce1861de", "committedDate": "2020-04-22T17:52:32Z", "message": "fix test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bda8e7a976940899375c4c80cdea6ed788297adb", "author": {"user": {"login": "probakowski", "name": "Przemko Robakowski"}}, "url": "https://github.com/elastic/elasticsearch/commit/bda8e7a976940899375c4c80cdea6ed788297adb", "committedDate": "2020-04-27T21:41:45Z", "message": "run tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4f3ace6f1bd96f8c2397e70de632b36fa15aa4ad", "author": {"user": {"login": "elasticmachine", "name": "Elastic Machine"}}, "url": "https://github.com/elastic/elasticsearch/commit/4f3ace6f1bd96f8c2397e70de632b36fa15aa4ad", "committedDate": "2020-04-27T22:05:55Z", "message": "Merge branch 'master' into deprecate-multiple-v1-templates"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "98416cf8aae829258f9e8493d0d0ff6d2c4c10b5", "author": {"user": {"login": "probakowski", "name": "Przemko Robakowski"}}, "url": "https://github.com/elastic/elasticsearch/commit/98416cf8aae829258f9e8493d0d0ff6d2c4c10b5", "committedDate": "2020-04-28T15:38:15Z", "message": "fix tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "05219f5e53096698f4c654a3a80b01fc8df16db4", "author": {"user": {"login": "probakowski", "name": "Przemko Robakowski"}}, "url": "https://github.com/elastic/elasticsearch/commit/05219f5e53096698f4c654a3a80b01fc8df16db4", "committedDate": "2020-04-28T16:08:32Z", "message": "fix tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6593967b1c479f568bcccd0b0173663aa4e0e91f", "author": {"user": {"login": "probakowski", "name": "Przemko Robakowski"}}, "url": "https://github.com/elastic/elasticsearch/commit/6593967b1c479f568bcccd0b0173663aa4e0e91f", "committedDate": "2020-04-28T18:58:10Z", "message": "fix tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ec5b2b93c17bdf39cbfc981ec98d9b15fcf1adf0", "author": {"user": {"login": "elasticmachine", "name": "Elastic Machine"}}, "url": "https://github.com/elastic/elasticsearch/commit/ec5b2b93c17bdf39cbfc981ec98d9b15fcf1adf0", "committedDate": "2020-04-28T19:23:22Z", "message": "Merge branch 'master' into deprecate-multiple-v1-templates"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "96ad012fe4dd29298405d716c1d6e706433f374a", "author": {"user": {"login": "probakowski", "name": "Przemko Robakowski"}}, "url": "https://github.com/elastic/elasticsearch/commit/96ad012fe4dd29298405d716c1d6e706433f374a", "committedDate": "2020-04-28T20:47:14Z", "message": "fix tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5c0379259300e5cec625342ef7be905d5ee5970e", "author": {"user": {"login": "probakowski", "name": "Przemko Robakowski"}}, "url": "https://github.com/elastic/elasticsearch/commit/5c0379259300e5cec625342ef7be905d5ee5970e", "committedDate": "2020-04-29T07:38:28Z", "message": "fix tests"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAyODQ3NTUx", "url": "https://github.com/elastic/elasticsearch/pull/55558#pullrequestreview-402847551", "createdAt": "2020-04-29T16:41:56Z", "commit": {"oid": "5c0379259300e5cec625342ef7be905d5ee5970e"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOVQxNjo0MTo1N1rOGOHktg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOVQxNjo0MTo1N1rOGOHktg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzQ1NzMzNA==", "bodyText": "I think this is a little confusing about what will not be supported and what is not going to be supported going forward, maybe it should be something like:\n\"index [foo] matches multiple v1 templates [t1, t2], v2 index templates will only match a single index template\"\nWhat do you think?", "url": "https://github.com/elastic/elasticsearch/pull/55558#discussion_r417457334", "createdAt": "2020-04-29T16:41:57Z", "author": {"login": "dakrone"}, "path": "server/src/main/java/org/elasticsearch/cluster/metadata/MetadataCreateIndexService.java", "diffHunk": "@@ -345,6 +345,12 @@ public ClusterState applyCreateIndexRequest(ClusterState currentState, CreateInd\n                 final List<IndexTemplateMetadata> v1Templates = MetadataIndexTemplateService.findV1Templates(currentState.metadata(),\n                     request.index(), isHiddenFromRequest);\n \n+                if (v1Templates.size() > 1) {\n+                    deprecationLogger.deprecatedAndMaybeLog(\"index_template_multiple_match\", \"index [{}] matches multiple templates \" +\n+                        \"[{}], and won't be supported with v2 index templates\", request.index(),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5c0379259300e5cec625342ef7be905d5ee5970e"}, "originalPosition": 6}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e648e432d5b659581195d7e48501add544040b30", "author": {"user": {"login": "probakowski", "name": "Przemko Robakowski"}}, "url": "https://github.com/elastic/elasticsearch/commit/e648e432d5b659581195d7e48501add544040b30", "committedDate": "2020-04-29T19:45:21Z", "message": "message change"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4613851c1b0b069763c9fa0f50fac9a252a1d00f", "author": {"user": {"login": "elasticmachine", "name": "Elastic Machine"}}, "url": "https://github.com/elastic/elasticsearch/commit/4613851c1b0b069763c9fa0f50fac9a252a1d00f", "committedDate": "2020-04-29T20:10:12Z", "message": "Merge branch 'master' into deprecate-multiple-v1-templates"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 651, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}