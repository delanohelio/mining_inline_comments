{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzYzNzkyNDEx", "number": 51121, "title": "Improve file filter for insecure repo tests", "bodyText": "Tests in BuildPluginIT copy the workspace but exclude the build\ndirectories based on whether the directory string representation\nincludes /build/ or not. This check is problematic if the directory\nof the project has a parent directory also named build. The change in\nthis commit checks to see if the path relative to the project directory\nhas any path parts equal to build.", "createdAt": "2020-01-16T18:48:37Z", "url": "https://github.com/elastic/elasticsearch/pull/51121", "merged": true, "mergeCommit": {"oid": "0f7f1eca3807e73dd3625df3b9cc080b758d0d33"}, "closed": true, "closedAt": "2020-01-17T16:59:23Z", "author": {"login": "jaymode"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb6-rPigH2gAyMzYzNzkyNDExOmY4Y2M5MzIwYzVlYzg4MGQ5OWZhNDJlZWQxNWZkMDFlZjFjY2M2OGQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABb7RGnCAH2gAyMzYzNzkyNDExOjRjMjg2YTU0ODEyNmNkZjdiZTM3NGM0MzUzZTUzMzdiOWVjYjdiNTE=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "f8cc9320c5ec880d99fa42eed15fd01ef1ccc68d", "author": {"user": {"login": "jaymode", "name": "Jay Modi"}}, "url": "https://github.com/elastic/elasticsearch/commit/f8cc9320c5ec880d99fa42eed15fd01ef1ccc68d", "committedDate": "2020-01-16T18:43:53Z", "message": "Improve file filter for insecure repo tests\n\nTests in BuildPluginIT copy the workspace but exclude the build\ndirectories based on whether the directory string representation\nincludes `/build/` or not. This check is problematic if the directory\nof the project has a parent directory also named `build`. The change in\nthis commit checks to see if the path relative to the project directory\nhas any path parts equal to `build`."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4dbdd127d5454f3a6b96c732163b1082803ba08c", "author": {"user": {"login": "jaymode", "name": "Jay Modi"}}, "url": "https://github.com/elastic/elasticsearch/commit/4dbdd127d5454f3a6b96c732163b1082803ba08c", "committedDate": "2020-01-16T18:55:49Z", "message": "formatting"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ0MjE3NDUw", "url": "https://github.com/elastic/elasticsearch/pull/51121#pullrequestreview-344217450", "createdAt": "2020-01-16T21:09:38Z", "commit": {"oid": "4dbdd127d5454f3a6b96c732163b1082803ba08c"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNlQyMTowOTozOFrOFenohA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNlQyMTowOTozOFrOFenohA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzY1MDk0OA==", "bodyText": "Path is itself an Iterable so it might be easier to grok this if we replace it with for (Path segment : relativePath) { }.", "url": "https://github.com/elastic/elasticsearch/pull/51121#discussion_r367650948", "createdAt": "2020-01-16T21:09:38Z", "author": {"login": "mark-vieira"}, "path": "buildSrc/src/test/java/org/elasticsearch/gradle/BuildPluginIT.java", "diffHunk": "@@ -84,7 +85,16 @@ public void testInsecureIvyRepository() throws IOException {\n \n     private void runInsecureArtifactRepositoryTest(final String name, final String url, final List<String> lines) throws IOException {\n         final File projectDir = getProjectDir(\"elasticsearch.build\");\n-        FileUtils.copyDirectory(projectDir, tmpDir.getRoot(), pathname -> pathname.getPath().contains(\"/build/\") == false);\n+        final Path projectDirPath = projectDir.toPath();\n+        FileUtils.copyDirectory(projectDir, tmpDir.getRoot(), file -> {\n+            final Path relativePath = projectDirPath.relativize(file.toPath());\n+            for (int i = 0; i < relativePath.getNameCount(); i++) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4dbdd127d5454f3a6b96c732163b1082803ba08c"}, "originalPosition": 16}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a4ac52494b1630ba8ed4a04e2ab587f3a387f894", "author": {"user": {"login": "jaymode", "name": "Jay Modi"}}, "url": "https://github.com/elastic/elasticsearch/commit/a4ac52494b1630ba8ed4a04e2ab587f3a387f894", "committedDate": "2020-01-17T16:10:24Z", "message": "Merge branch 'master' into build_plugin_it_file_filter"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4c286a548126cdf7be374c4353e5337b9ecb7b51", "author": {"user": {"login": "jaymode", "name": "Jay Modi"}}, "url": "https://github.com/elastic/elasticsearch/commit/4c286a548126cdf7be374c4353e5337b9ecb7b51", "committedDate": "2020-01-17T16:12:04Z", "message": "path is iterable"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2927, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}