{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM1MjMwOTQ2", "number": 58169, "title": "Delete auto-generated annotations when job is deleted.", "bodyText": "This PR makes the auto-generated annotations associated with the job deleted when the job itself gets deleted.\nCloses #57976", "createdAt": "2020-06-16T13:51:23Z", "url": "https://github.com/elastic/elasticsearch/pull/58169", "merged": true, "mergeCommit": {"oid": "1c00ea9211e3b5eaea652809b072fe9121f0946c"}, "closed": true, "closedAt": "2020-06-17T05:59:29Z", "author": {"login": "przemekwitek"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcr1kSnAH2gAyNDM1MjMwOTQ2OjQzNzVjYjQxMmVhZGNhMDhhZTg4NjcyNWNkZDc4YTNhZDVhNmEyYmE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcsCzQqgH2gAyNDM1MjMwOTQ2OmU4YmU3NDQ5OWNkZTIwODhjNjFjNzk3ZjY2OTA4NjFjZDFlNTliMzA=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "4375cb412eadca08ae886725cdd78a3ad5a6a2ba", "author": {"user": {"login": "przemekwitek", "name": "Przemys\u0142aw Witek"}}, "url": "https://github.com/elastic/elasticsearch/commit/4375cb412eadca08ae886725cdd78a3ad5a6a2ba", "committedDate": "2020-06-16T13:49:26Z", "message": "Delete auto-generated annotations when job is deleted."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMxNTM0MjQx", "url": "https://github.com/elastic/elasticsearch/pull/58169#pullrequestreview-431534241", "createdAt": "2020-06-16T13:58:19Z", "commit": {"oid": "4375cb412eadca08ae886725cdd78a3ad5a6a2ba"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMxNTY2MjI2", "url": "https://github.com/elastic/elasticsearch/pull/58169#pullrequestreview-431566226", "createdAt": "2020-06-16T14:30:11Z", "commit": {"oid": "4375cb412eadca08ae886725cdd78a3ad5a6a2ba"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQxNDozMDoxMVrOGkeK5g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQxNDozMDo0MFrOGkeMYQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDg5NjIzMA==", "bodyText": "I know you've just copied it from above, but this comment is no longer correct - we are only deleting the most recent ID format.  So please delete this comment.", "url": "https://github.com/elastic/elasticsearch/pull/58169#discussion_r440896230", "createdAt": "2020-06-16T14:30:11Z", "author": {"login": "droberts195"}, "path": "x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/action/TransportDeleteJobAction.java", "diffHunk": "@@ -444,25 +451,18 @@ private void deleteJobDocuments(ParentTaskAssigningClient parentTaskClient, Stri\n     }\n \n     private void deleteQuantiles(ParentTaskAssigningClient parentTaskClient, String jobId, ActionListener<Boolean> finishedHandler) {\n-        // The quantiles type and doc ID changed in v5.5 so delete both the old and new format\n-        DeleteByQueryRequest request = new DeleteByQueryRequest(AnomalyDetectorsIndex.jobStateIndexPattern());\n         // Just use ID here, not type, as trying to delete different types spams the logs with an exception stack trace\n         IdsQueryBuilder query = new IdsQueryBuilder().addIds(Quantiles.documentId(jobId));\n-        request.setQuery(query);\n-        request.setIndicesOptions(MlIndicesUtils.addIgnoreUnavailable(IndicesOptions.lenientExpandOpen()));\n-        request.setAbortOnVersionConflict(false);\n-        request.setRefresh(true);\n+        // The quantiles type and doc ID changed in v5.5 so delete both the old and new format", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4375cb412eadca08ae886725cdd78a3ad5a6a2ba"}, "originalPosition": 85}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDg5NjYwOQ==", "bodyText": "As above, it's no longer true that we're deleting the 5.4 ID format, so please delete this comment.", "url": "https://github.com/elastic/elasticsearch/pull/58169#discussion_r440896609", "createdAt": "2020-06-16T14:30:40Z", "author": {"login": "droberts195"}, "path": "x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/action/TransportDeleteJobAction.java", "diffHunk": "@@ -479,14 +479,14 @@ private void deleteModelState(ParentTaskAssigningClient parentTaskClient, String\n \n     private void deleteCategorizerState(ParentTaskAssigningClient parentTaskClient, String jobId, int docNum,\n                                         ActionListener<Boolean> finishedHandler) {\n-        // The categorizer state type and doc ID changed in v5.5 so delete both the old and new format\n-        DeleteByQueryRequest request = new DeleteByQueryRequest(AnomalyDetectorsIndex.jobStateIndexPattern());\n         // Just use ID here, not type, as trying to delete different types spams the logs with an exception stack trace\n         IdsQueryBuilder query = new IdsQueryBuilder().addIds(CategorizerState.documentId(jobId, docNum));\n-        request.setQuery(query);\n-        request.setIndicesOptions(MlIndicesUtils.addIgnoreUnavailable(IndicesOptions.lenientExpandOpen()));\n-        request.setAbortOnVersionConflict(false);\n-        request.setRefresh(true);\n+        // The categorizer state type and doc ID changed in v5.5 so delete both the old and new format", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4375cb412eadca08ae886725cdd78a3ad5a6a2ba"}, "originalPosition": 118}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e8be74499cde2088c61c797f6690861cd1e59b30", "author": {"user": {"login": "przemekwitek", "name": "Przemys\u0142aw Witek"}}, "url": "https://github.com/elastic/elasticsearch/commit/e8be74499cde2088c61c797f6690861cd1e59b30", "committedDate": "2020-06-17T05:14:33Z", "message": "Apply review comments"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 529, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}