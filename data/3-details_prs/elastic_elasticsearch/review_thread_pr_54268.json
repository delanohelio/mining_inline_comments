{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk0MTY1MTE0", "number": 54268, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMVQxMzowNjoyMFrODthedg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMVQxMzowNjoyMFrODthedg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ5MDYwOTgyOnYy", "diffSide": "RIGHT", "path": "docs/reference/analysis/tokenfilters/flatten-graph-tokenfilter.asciidoc", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMVQxMzowNjoyMFrOF-_rsQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMVQxNzo0Nzo0OFrOF_L0Sw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTU5OTQwOQ==", "bodyText": "I think it would be good to reword this to strongly advise against using these at index time at all - generally speaking, filters that could produce graphs should be used at query time instead.  flatten_graph is a kind of shonky workaround for a problem that really should be fixed elsewhere.", "url": "https://github.com/elastic/elasticsearch/pull/54268#discussion_r401599409", "createdAt": "2020-04-01T13:06:20Z", "author": {"login": "romseygeek"}, "path": "docs/reference/analysis/tokenfilters/flatten-graph-tokenfilter.asciidoc", "diffHunk": "@@ -4,18 +4,232 @@\n <titleabbrev>Flatten graph</titleabbrev>\n ++++\n \n-The `flatten_graph` token filter accepts an arbitrary graph token\n-stream, such as that produced by\n-<<analysis-synonym-graph-tokenfilter>>, and flattens it into a single\n-linear chain of tokens suitable for indexing.\n-\n-This is a lossy process, as separate side paths are squashed on top of\n-one another, but it is necessary if you use a graph token stream\n-during indexing because a Lucene index cannot currently represent a\n-graph.  For this reason, it's best to apply graph analyzers only at\n-search time because that preserves the full graph structure and gives\n-correct matches for proximity queries.\n-\n-For more information on this topic and its various complexities,\n-please read the http://blog.mikemccandless.com/2012/04/lucenes-tokenstreams-are-actually.html[Lucene's\n-TokenStreams are actually graphs] blog post.\n+Flattens a <<token-graphs,token graph>> produced by a graph token filter, such\n+as <<analysis-synonym-graph-tokenfilter,`synonym_graph`>> or\n+<<analysis-word-delimiter-graph-tokenfilter,`word_delimiter_graph`>>.\n+\n+Flattening a token graph containing\n+<<token-graphs-multi-position-tokens,multi-position tokens>> makes the graph\n+suitable for <<analysis-index-search-time,indexing>>. Otherwise, indexing does\n+not support token graphs containing multi-position tokens.\n+\n+[WARNING]\n+====\n+Flattening graphs containing multi-position tokens is a lossy process.\n+Flattening collapses the side paths of a token graph into a linear path.\n+\n+If possible, avoid using graph token filters in\n+<<analysis-index-search-time,index analyzers>>. Use the respective\n+<<analysis-synonym-tokenfilter,`synonym`>> or\n+<<analysis-word-delimiter-tokenfilter,`word_delimiter`>> filters instead.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "65f5922b211aaf78202e4410591a38a0e0456df1"}, "originalPosition": 36}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTc5ODIxOQ==", "bodyText": "Thanks for the feedback @romseygeek!\nWith afcbebf, I reworded the warning to remove the recommendation for the synonym and word_delimiter filters. It also recommends that token graph filters only be used in search analyzers.\nLet me know if you see any other needed changes!", "url": "https://github.com/elastic/elasticsearch/pull/54268#discussion_r401798219", "createdAt": "2020-04-01T17:47:48Z", "author": {"login": "jrodewig"}, "path": "docs/reference/analysis/tokenfilters/flatten-graph-tokenfilter.asciidoc", "diffHunk": "@@ -4,18 +4,232 @@\n <titleabbrev>Flatten graph</titleabbrev>\n ++++\n \n-The `flatten_graph` token filter accepts an arbitrary graph token\n-stream, such as that produced by\n-<<analysis-synonym-graph-tokenfilter>>, and flattens it into a single\n-linear chain of tokens suitable for indexing.\n-\n-This is a lossy process, as separate side paths are squashed on top of\n-one another, but it is necessary if you use a graph token stream\n-during indexing because a Lucene index cannot currently represent a\n-graph.  For this reason, it's best to apply graph analyzers only at\n-search time because that preserves the full graph structure and gives\n-correct matches for proximity queries.\n-\n-For more information on this topic and its various complexities,\n-please read the http://blog.mikemccandless.com/2012/04/lucenes-tokenstreams-are-actually.html[Lucene's\n-TokenStreams are actually graphs] blog post.\n+Flattens a <<token-graphs,token graph>> produced by a graph token filter, such\n+as <<analysis-synonym-graph-tokenfilter,`synonym_graph`>> or\n+<<analysis-word-delimiter-graph-tokenfilter,`word_delimiter_graph`>>.\n+\n+Flattening a token graph containing\n+<<token-graphs-multi-position-tokens,multi-position tokens>> makes the graph\n+suitable for <<analysis-index-search-time,indexing>>. Otherwise, indexing does\n+not support token graphs containing multi-position tokens.\n+\n+[WARNING]\n+====\n+Flattening graphs containing multi-position tokens is a lossy process.\n+Flattening collapses the side paths of a token graph into a linear path.\n+\n+If possible, avoid using graph token filters in\n+<<analysis-index-search-time,index analyzers>>. Use the respective\n+<<analysis-synonym-tokenfilter,`synonym`>> or\n+<<analysis-word-delimiter-tokenfilter,`word_delimiter`>> filters instead.", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTU5OTQwOQ=="}, "originalCommit": {"oid": "65f5922b211aaf78202e4410591a38a0e0456df1"}, "originalPosition": 36}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4126, "cost": 1, "resetAt": "2021-11-12T13:16:51Z"}}}