{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDk1MDEwODAx", "number": 63035, "title": "Enable SourceLookup to leverage sequential stored fields reader", "bodyText": "This is a WIP draft of using similar optimizations as in #62509 for SourceLookup.\nThis PR is using the potentially better field reader from the fetch phase also in SourceLookup.\nFirst rally exeriments show that this speeds up e.g. when runtime fields that are using \"_source\" are\nadded e.g. via \"docvalue_fields\" in the search hits. Using runtime fields that are using \"_source\" in\nqueries or aggs isn't affected so far.", "createdAt": "2020-09-29T18:10:26Z", "url": "https://github.com/elastic/elasticsearch/pull/63035", "merged": true, "mergeCommit": {"oid": "49f83cc30097e4c33234e6ab050f4cd6c0c3f457"}, "closed": true, "closedAt": "2020-10-06T09:19:24Z", "author": {"login": "cbuescher"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdN5B5tgBqjM4MjM0NDc3OTI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdPnQDiAFqTUwMjI3MTczNw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "9d1d243f6b03951a711bff2a2f003c03cef916d3", "author": {"user": {"login": "cbuescher", "name": "Christoph B\u00fcscher"}}, "url": "https://github.com/elastic/elasticsearch/commit/9d1d243f6b03951a711bff2a2f003c03cef916d3", "committedDate": "2020-09-28T09:16:01Z", "message": "wip"}, "afterCommit": {"oid": "c49cd2cbbeb4e3f38dbb802c7337b68331c4908c", "author": {"user": {"login": "cbuescher", "name": "Christoph B\u00fcscher"}}, "url": "https://github.com/elastic/elasticsearch/commit/c49cd2cbbeb4e3f38dbb802c7337b68331c4908c", "committedDate": "2020-09-30T09:04:36Z", "message": "wip"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c49cd2cbbeb4e3f38dbb802c7337b68331c4908c", "author": {"user": {"login": "cbuescher", "name": "Christoph B\u00fcscher"}}, "url": "https://github.com/elastic/elasticsearch/commit/c49cd2cbbeb4e3f38dbb802c7337b68331c4908c", "committedDate": "2020-09-30T09:04:36Z", "message": "wip"}, "afterCommit": {"oid": "9d31ccf020dad537a19aadc674feda3ee0f92953", "author": {"user": {"login": "cbuescher", "name": "Christoph B\u00fcscher"}}, "url": "https://github.com/elastic/elasticsearch/commit/9d31ccf020dad537a19aadc674feda3ee0f92953", "committedDate": "2020-09-30T09:27:09Z", "message": "wip"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "03624965fafcb8d29337042ec601c170782e5d20", "author": {"user": {"login": "cbuescher", "name": "Christoph B\u00fcscher"}}, "url": "https://github.com/elastic/elasticsearch/commit/03624965fafcb8d29337042ec601c170782e5d20", "committedDate": "2020-09-30T09:59:03Z", "message": "wip"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "9d31ccf020dad537a19aadc674feda3ee0f92953", "author": {"user": {"login": "cbuescher", "name": "Christoph B\u00fcscher"}}, "url": "https://github.com/elastic/elasticsearch/commit/9d31ccf020dad537a19aadc674feda3ee0f92953", "committedDate": "2020-09-30T09:27:09Z", "message": "wip"}, "afterCommit": {"oid": "03624965fafcb8d29337042ec601c170782e5d20", "author": {"user": {"login": "cbuescher", "name": "Christoph B\u00fcscher"}}, "url": "https://github.com/elastic/elasticsearch/commit/03624965fafcb8d29337042ec601c170782e5d20", "committedDate": "2020-09-30T09:59:03Z", "message": "wip"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dcd0d5cf93b68afe9df488d5bf8e53f4ff9e26a0", "author": {"user": {"login": "cbuescher", "name": "Christoph B\u00fcscher"}}, "url": "https://github.com/elastic/elasticsearch/commit/dcd0d5cf93b68afe9df488d5bf8e53f4ff9e26a0", "committedDate": "2020-09-30T10:17:16Z", "message": "change in LeafSourceLookup"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fe1877fb60631ef5d108befb5b1f064516711dde", "author": {"user": {"login": "cbuescher", "name": "Christoph B\u00fcscher"}}, "url": "https://github.com/elastic/elasticsearch/commit/fe1877fb60631ef5d108befb5b1f064516711dde", "committedDate": "2020-09-30T10:57:15Z", "message": "Always check if can use optimized field reader"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6924c53d32c7c167e902438859a3d99e4561a2ad", "author": {"user": {"login": "cbuescher", "name": "Christoph B\u00fcscher"}}, "url": "https://github.com/elastic/elasticsearch/commit/6924c53d32c7c167e902438859a3d99e4561a2ad", "committedDate": "2020-09-30T14:36:12Z", "message": "Only when reader changes"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAwNDEwODQx", "url": "https://github.com/elastic/elasticsearch/pull/63035#pullrequestreview-500410841", "createdAt": "2020-10-01T14:31:32Z", "commit": {"oid": "6924c53d32c7c167e902438859a3d99e4561a2ad"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMVQxNDozMTozM1rOHbNQqg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMVQxNDozMTozM1rOHbNQqg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODI5MDg1OA==", "bodyText": "Can you remove this change now that SourceLookup leverages the sequential reader automatically ?", "url": "https://github.com/elastic/elasticsearch/pull/63035#discussion_r498290858", "createdAt": "2020-10-01T14:31:33Z", "author": {"login": "jimczi"}, "path": "server/src/main/java/org/elasticsearch/search/fetch/FetchSubPhase.java", "diffHunk": "@@ -45,6 +47,7 @@ public HitContext(\n             LeafReaderContext context,\n             int docId,\n             SourceLookup sourceLookup,\n+            CheckedBiConsumer<Integer, FieldsVisitor, IOException> fieldReader,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6924c53d32c7c167e902438859a3d99e4561a2ad"}, "originalPosition": 13}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "57876858a90f56c48a03eadbc75d9fda7c63d45a", "author": {"user": {"login": "cbuescher", "name": "Christoph B\u00fcscher"}}, "url": "https://github.com/elastic/elasticsearch/commit/57876858a90f56c48a03eadbc75d9fda7c63d45a", "committedDate": "2020-10-01T16:56:14Z", "message": "simplify"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d4e39cfc711514a2dde7725f53a968829ec37d83", "author": {"user": {"login": "cbuescher", "name": "Christoph B\u00fcscher"}}, "url": "https://github.com/elastic/elasticsearch/commit/d4e39cfc711514a2dde7725f53a968829ec37d83", "committedDate": "2020-10-01T17:05:12Z", "message": "Remove TODO"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAyMjcxNzM3", "url": "https://github.com/elastic/elasticsearch/pull/63035#pullrequestreview-502271737", "createdAt": "2020-10-05T17:29:56Z", "commit": {"oid": "d4e39cfc711514a2dde7725f53a968829ec37d83"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4538, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}