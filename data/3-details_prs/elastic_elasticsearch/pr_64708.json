{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE2NzQxNjQ2", "number": 64708, "title": "Handle incorrect header values", "bodyText": "When Accept or Content-Type header values are incorrect, a request\nshould be gracefully rejected and an exception message returned to a\nclient.\nrelates #64689\nrelates #51816", "createdAt": "2020-11-06T13:24:48Z", "url": "https://github.com/elastic/elasticsearch/pull/64708", "merged": true, "mergeCommit": {"oid": "0bb64cbe1e3ec3661f5f4af63e7cdcb767fd29d1"}, "closed": true, "closedAt": "2020-11-10T08:07:33Z", "author": {"login": "pgomulka"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdZ25Z5gH2gAyNTE2NzQxNjQ2OmE2ZDg5YzI5ODVjMjQ3YWNhZmI5ZmI0YWFlYjFhMWM1YmZhM2E5OTY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABda1bOHAH2gAyNTE2NzQxNjQ2OmMxMmZkOTZhYzY5NDA3Y2QxZmMyZjY4MmM1MDE3MjAwMDQyYzFmMjE=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "a6d89c2985c247acafb9fb4aaeb1a1c5bfa3a996", "author": {"user": {"login": "pgomulka", "name": "Przemyslaw Gomulka"}}, "url": "https://github.com/elastic/elasticsearch/commit/a6d89c2985c247acafb9fb4aaeb1a1c5bfa3a996", "committedDate": "2020-11-06T13:22:55Z", "message": "Handle incorrect header values\n\nWhen Accept or Content-Type header values are incorrect, a request\nshould be gracefully rejected and an exception message returned to a\nclient.\n\nrelates https://github.com/elastic/elasticsearch/issues/64689"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI1MzU2OTIy", "url": "https://github.com/elastic/elasticsearch/pull/64708#pullrequestreview-525356922", "createdAt": "2020-11-06T17:32:20Z", "commit": {"oid": "a6d89c2985c247acafb9fb4aaeb1a1c5bfa3a996"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNlQxNzozMjoyMFrOHu3JmQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNlQxNzozMjoyMFrOHu3JmQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODkwMDEyMQ==", "bodyText": "Is there anywhere that we can assert that the header name at fault is included in the error sent back to the user ?", "url": "https://github.com/elastic/elasticsearch/pull/64708#discussion_r518900121", "createdAt": "2020-11-06T17:32:20Z", "author": {"login": "jakelandis"}, "path": "server/src/test/java/org/elasticsearch/http/AbstractHttpServerTransportTests.java", "diffHunk": "@@ -173,6 +177,63 @@ public HttpStats stats() {\n         }\n     }\n \n+    public void testIncorrectHeaderHandling() {\n+\n+        final ClusterSettings clusterSettings = new ClusterSettings(Settings.EMPTY, ClusterSettings.BUILT_IN_CLUSTER_SETTINGS);\n+        try (AbstractHttpServerTransport transport =\n+                 new AbstractHttpServerTransport(Settings.EMPTY, networkService, bigArrays, threadPool, xContentRegistry(),\n+                     new HttpServerTransport.Dispatcher() {\n+                         @Override\n+                         public void dispatchRequest(RestRequest request, RestChannel channel, ThreadContext threadContext) {\n+                             Assert.fail();\n+                         }\n+\n+                         @Override\n+                         public void dispatchBadRequest(RestChannel channel, ThreadContext threadContext, Throwable cause) {\n+                             assertThat(cause, instanceOf(RestRequest.MediaTypeHeaderException.class));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a6d89c2985c247acafb9fb4aaeb1a1c5bfa3a996"}, "originalPosition": 41}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "12de009812a1b3d1e8c590b120fbd1e619b504e0", "author": {"user": {"login": "pgomulka", "name": "Przemyslaw Gomulka"}}, "url": "https://github.com/elastic/elasticsearch/commit/12de009812a1b3d1e8c590b120fbd1e619b504e0", "committedDate": "2020-11-09T09:01:49Z", "message": "surface header name value"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "81e160b90060ae774fe86c2fa472ab942862415b", "author": {"user": {"login": "pgomulka", "name": "Przemyslaw Gomulka"}}, "url": "https://github.com/elastic/elasticsearch/commit/81e160b90060ae774fe86c2fa472ab942862415b", "committedDate": "2020-11-09T09:49:30Z", "message": "reformat"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a838410035a23f7d87a339553cdb067d467e7990", "author": {"user": {"login": "pgomulka", "name": "Przemyslaw Gomulka"}}, "url": "https://github.com/elastic/elasticsearch/commit/a838410035a23f7d87a339553cdb067d467e7990", "committedDate": "2020-11-09T13:27:46Z", "message": "Merge branch 'master' into compat/handle_incorrect_accept_content_type"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI2MjcyNzcy", "url": "https://github.com/elastic/elasticsearch/pull/64708#pullrequestreview-526272772", "createdAt": "2020-11-09T13:48:48Z", "commit": {"oid": "81e160b90060ae774fe86c2fa472ab942862415b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c12fd96ac69407cd1fc2f682c5017200042c1f21", "author": {"user": {"login": "pgomulka", "name": "Przemyslaw Gomulka"}}, "url": "https://github.com/elastic/elasticsearch/commit/c12fd96ac69407cd1fc2f682c5017200042c1f21", "committedDate": "2020-11-09T14:13:58Z", "message": "fix tests after rename"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1216, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}