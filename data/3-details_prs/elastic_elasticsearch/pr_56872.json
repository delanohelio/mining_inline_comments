{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE5MTI5OTk0", "number": 56872, "title": "SQL: [Tests] Move JDBC integration tests to new module", "bodyText": "Move the JDBC functionality integration tests from :sql:qa to a separate\nmodule sql:jdbc. This way the tests are \"closer\" to the tested source and\nthey only depend to the sql:jdbc module, thus removing the danger of\naccidentally pulling in some dependency that may hide bugs.\nMoreover this is a preparation for #56722, so that we can run those tests\nbetween different JDBC and ES node versions and ensure forward\ncompatibility.", "createdAt": "2020-05-17T15:31:57Z", "url": "https://github.com/elastic/elasticsearch/pull/56872", "merged": true, "mergeCommit": {"oid": "c09f4a04484b8a43934fe58fbc41bd90b7dbcc76"}, "closed": true, "closedAt": "2020-05-22T13:52:42Z", "author": {"login": "matriv"}, "timelineItems": {"totalCount": 16, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABciNCrgAH2gAyNDE5MTI5OTk0OjIyZDRjM2VlMmE0YjljODhlYzg1ZDliYjYzN2MwMTU2MTgxZmQyMDg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcjj9eDgFqTQxNjQ4MDExNw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "22d4c3ee2a4b9c88ec85d9bb637c0156181fd208", "author": {"user": {"login": "matriv", "name": "Marios Trivyzas"}}, "url": "https://github.com/elastic/elasticsearch/commit/22d4c3ee2a4b9c88ec85d9bb637c0156181fd208", "committedDate": "2020-05-17T15:31:12Z", "message": "SQL: [Tests] Move JDBC integration tests to new module\n\nMove the JDBC functionality integration tests to a separate module."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "afa711ad4d582afc0c3d379595c47dcce1e163b7", "author": {"user": {"login": "matriv", "name": "Marios Trivyzas"}}, "url": "https://github.com/elastic/elasticsearch/commit/afa711ad4d582afc0c3d379595c47dcce1e163b7", "committedDate": "2020-05-17T16:13:49Z", "message": "remove duplicate tests from sql:qa module"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9023176044b68632a31484df9742083a6bac7302", "author": {"user": {"login": "matriv", "name": "Marios Trivyzas"}}, "url": "https://github.com/elastic/elasticsearch/commit/9023176044b68632a31484df9742083a6bac7302", "committedDate": "2020-05-17T16:21:21Z", "message": "fix imports"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c61c608de974ee6d586b314af2cbd863a24e1591", "author": {"user": {"login": "matriv", "name": "Marios Trivyzas"}}, "url": "https://github.com/elastic/elasticsearch/commit/c61c608de974ee6d586b314af2cbd863a24e1591", "committedDate": "2020-05-17T16:35:19Z", "message": "fix doc references"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "35d1f3c1460c579def31fe199f4845146c0a7dcc", "author": {"user": {"login": "matriv", "name": "Marios Trivyzas"}}, "url": "https://github.com/elastic/elasticsearch/commit/35d1f3c1460c579def31fe199f4845146c0a7dcc", "committedDate": "2020-05-17T17:04:26Z", "message": "attempt to fix java path for doc tests"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEzOTY3OTUx", "url": "https://github.com/elastic/elasticsearch/pull/56872#pullrequestreview-413967951", "createdAt": "2020-05-18T22:00:26Z", "commit": {"oid": "35d1f3c1460c579def31fe199f4845146c0a7dcc"}, "state": "COMMENTED", "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOFQyMjowMDoyNlrOGXI5Gw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOFQyMjowNzoxNFrOGXJDAw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjkxNjEyMw==", "bodyText": "Let's use elasticsearch.java here instead. This applies all our compile/test conventions, but doesn't add all these precommit check tasks which are not applicable to this project.", "url": "https://github.com/elastic/elasticsearch/pull/56872#discussion_r426916123", "createdAt": "2020-05-18T22:00:26Z", "author": {"login": "mark-vieira"}, "path": "x-pack/plugin/sql/jdbc/qa/build.gradle", "diffHunk": "@@ -0,0 +1,66 @@\n+description = 'Integration tests for SQL JDBC'\n+apply plugin: 'elasticsearch.build'", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "35d1f3c1460c579def31fe199f4845146c0a7dcc"}, "originalPosition": 2}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjkxNjMyMQ==", "bodyText": "We shouldn't need to override group or archivesBaseName since we aren't going to publish this module.", "url": "https://github.com/elastic/elasticsearch/pull/56872#discussion_r426916321", "createdAt": "2020-05-18T22:00:56Z", "author": {"login": "mark-vieira"}, "path": "x-pack/plugin/sql/jdbc/qa/build.gradle", "diffHunk": "@@ -0,0 +1,66 @@\n+description = 'Integration tests for SQL JDBC'\n+apply plugin: 'elasticsearch.build'\n+archivesBaseName = 'qa-sql-jdbc'\n+group = \"org.elasticsearch.x-pack.qa.sql.jdbc\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "35d1f3c1460c579def31fe199f4845146c0a7dcc"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjkxNjQzNA==", "bodyText": "Not, we should probably do this for the sql qa project as well. Would simplify that build script a bit since the same applies there.", "url": "https://github.com/elastic/elasticsearch/pull/56872#discussion_r426916434", "createdAt": "2020-05-18T22:01:17Z", "author": {"login": "mark-vieira"}, "path": "x-pack/plugin/sql/jdbc/qa/build.gradle", "diffHunk": "@@ -0,0 +1,66 @@\n+description = 'Integration tests for SQL JDBC'\n+apply plugin: 'elasticsearch.build'", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjkxNjEyMw=="}, "originalCommit": {"oid": "35d1f3c1460c579def31fe199f4845146c0a7dcc"}, "originalPosition": 2}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjkxNzQzNQ==", "bodyText": "Who uses this task?", "url": "https://github.com/elastic/elasticsearch/pull/56872#discussion_r426917435", "createdAt": "2020-05-18T22:04:00Z", "author": {"login": "mark-vieira"}, "path": "x-pack/plugin/sql/jdbc/qa/build.gradle", "diffHunk": "@@ -0,0 +1,66 @@\n+description = 'Integration tests for SQL JDBC'\n+apply plugin: 'elasticsearch.build'\n+archivesBaseName = 'qa-sql-jdbc'\n+group = \"org.elasticsearch.x-pack.qa.sql.jdbc\"\n+\n+dependencies {\n+    compile project(\":test:framework\")\n+\n+    // JDBC testing dependencies\n+    compile project(path: xpackModule('sql:jdbc'))\n+}\n+\n+/* disable unit tests because these are all integration tests used\n+ * other qa projects. */\n+test.enabled = false\n+\n+dependencyLicenses.enabled = false\n+dependenciesInfo.enabled = false\n+\n+// the main files are actually test files, so use the appropriate forbidden api sigs\n+tasks.named('forbiddenApisMain').configure {\n+    replaceSignatureFiles 'es-all-signatures', 'es-test-signatures'\n+}\n+\n+// just a test fixture: we aren't using this jars in releases and H2GIS requires disabling a lot of checks\n+thirdPartyAudit.enabled = false\n+\n+subprojects {\n+    if (subprojects.isEmpty()) {\n+        // leaf project\n+        apply plugin: 'elasticsearch.standalone-rest-test'\n+    } else {\n+        apply plugin: 'elasticsearch.build'\n+    }\n+\n+    dependencies {\n+        /* Since we're a standalone rest test we actually get transitive\n+         * dependencies but we don't really want them because they cause\n+         * all kinds of trouble with the jar hell checks. So we suppress\n+         * them explicitly for non-es projects. */\n+        testCompile(xpackProject('plugin:sql:jdbc:qa')) {\n+            transitive = false\n+        }\n+        testCompile project(\":test:framework\")\n+\n+        testRuntime project(path: xpackModule('sql:jdbc'))\n+    }\n+\n+    if (project.name != 'security') {\n+        // The security project just configures its subprojects\n+        apply plugin: 'elasticsearch.testclusters'\n+        apply plugin: 'elasticsearch.rest-test'\n+\n+        testClusters.integTest {\n+            testDistribution = 'DEFAULT'\n+            setting 'xpack.ml.enabled', 'false'\n+            setting 'xpack.watcher.enabled', 'false'\n+        }\n+\n+        task runqa {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "35d1f3c1460c579def31fe199f4845146c0a7dcc"}, "originalPosition": 60}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjkxNzY1OQ==", "bodyText": "We should use elasticsearch.java plugin again here. The nested qa projects don't need all that additional precommit stuff.", "url": "https://github.com/elastic/elasticsearch/pull/56872#discussion_r426917659", "createdAt": "2020-05-18T22:04:38Z", "author": {"login": "mark-vieira"}, "path": "x-pack/plugin/sql/jdbc/qa/build.gradle", "diffHunk": "@@ -0,0 +1,66 @@\n+description = 'Integration tests for SQL JDBC'\n+apply plugin: 'elasticsearch.build'\n+archivesBaseName = 'qa-sql-jdbc'\n+group = \"org.elasticsearch.x-pack.qa.sql.jdbc\"\n+\n+dependencies {\n+    compile project(\":test:framework\")\n+\n+    // JDBC testing dependencies\n+    compile project(path: xpackModule('sql:jdbc'))\n+}\n+\n+/* disable unit tests because these are all integration tests used\n+ * other qa projects. */\n+test.enabled = false\n+\n+dependencyLicenses.enabled = false\n+dependenciesInfo.enabled = false\n+\n+// the main files are actually test files, so use the appropriate forbidden api sigs\n+tasks.named('forbiddenApisMain').configure {\n+    replaceSignatureFiles 'es-all-signatures', 'es-test-signatures'\n+}\n+\n+// just a test fixture: we aren't using this jars in releases and H2GIS requires disabling a lot of checks\n+thirdPartyAudit.enabled = false\n+\n+subprojects {\n+    if (subprojects.isEmpty()) {\n+        // leaf project\n+        apply plugin: 'elasticsearch.standalone-rest-test'\n+    } else {\n+        apply plugin: 'elasticsearch.build'", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "35d1f3c1460c579def31fe199f4845146c0a7dcc"}, "originalPosition": 33}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjkxODY1OQ==", "bodyText": "Let's please not do this anymore. Instead of creating subprojects here, let's just define two separate test clusters. This mess of sharing test artifacts just to run tests two different ways is completely unnecessary. We should refactor the SQL project to ditch this but at least for this PR, let's not copy a bad pattern. Let me know if you need help refactoring this.", "url": "https://github.com/elastic/elasticsearch/pull/56872#discussion_r426918659", "createdAt": "2020-05-18T22:07:14Z", "author": {"login": "mark-vieira"}, "path": "x-pack/plugin/sql/jdbc/qa/security/build.gradle", "diffHunk": "@@ -0,0 +1,63 @@\n+dependencies {\n+    testCompile project(':x-pack:plugin:core')\n+}\n+\n+Project mainProject = project\n+\n+group = \"${group}.x-pack.qa.sql.security\"\n+\n+configurations.create('testArtifacts')\n+\n+TaskProvider testJar = tasks.register(\"testJar\", Jar) {\n+    appendix 'test'\n+    from sourceSets.test.output\n+}\n+\n+artifacts {\n+    testArtifacts testJar\n+}\n+\n+// Tests are pushed down to subprojects and will be checked there.\n+testingConventions.enabled = false\n+\n+subprojects {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "35d1f3c1460c579def31fe199f4845146c0a7dcc"}, "originalPosition": 23}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "584f367c742936ad8b304fb99f8eb50e0ed00541", "author": {"user": {"login": "matriv", "name": "Marios Trivyzas"}}, "url": "https://github.com/elastic/elasticsearch/commit/584f367c742936ad8b304fb99f8eb50e0ed00541", "committedDate": "2020-05-19T16:58:11Z", "message": "clean up build.gradle"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "462ff434cb66e85ef82ff667b4ed7d2e72708564", "author": {"user": {"login": "matriv", "name": "Marios Trivyzas"}}, "url": "https://github.com/elastic/elasticsearch/commit/462ff434cb66e85ef82ff667b4ed7d2e72708564", "committedDate": "2020-05-20T07:48:21Z", "message": "rename packages"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE1MjE1ODYy", "url": "https://github.com/elastic/elasticsearch/pull/56872#pullrequestreview-415215862", "createdAt": "2020-05-20T10:53:19Z", "commit": {"oid": "462ff434cb66e85ef82ff667b4ed7d2e72708564"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ba5137e5529401e20169631928cfc1150f9d7d39", "author": {"user": {"login": "matriv", "name": "Marios Trivyzas"}}, "url": "https://github.com/elastic/elasticsearch/commit/ba5137e5529401e20169631928cfc1150f9d7d39", "committedDate": "2020-05-21T10:13:12Z", "message": "Move jdbc qa inside sql/qa project\n\nMove the existing tests inside a new sql/qa/server project"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f12bceb6c5b3d293963f053ed3838245bb7e940e", "author": {"user": {"login": "matriv", "name": "Marios Trivyzas"}}, "url": "https://github.com/elastic/elasticsearch/commit/f12bceb6c5b3d293963f053ed3838245bb7e940e", "committedDate": "2020-05-21T10:13:16Z", "message": "Merge remote-tracking branch 'upstream/master' into split-jdbc-qa-tests"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE2MDM2MTgw", "url": "https://github.com/elastic/elasticsearch/pull/56872#pullrequestreview-416036180", "createdAt": "2020-05-21T10:22:16Z", "commit": {"oid": "f12bceb6c5b3d293963f053ed3838245bb7e940e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMVQxMDoyMjoxNlrOGYtxdQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMVQxMDoyMjoxNlrOGYtxdQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODU2ODk0OQ==", "bodyText": "@mark-vieira I've been struggling to understand why we end up with circular dependency without this. Any idea?\nDo you have a better suggestion? (I tried renaming the module to jdbc-qa instead of just jdbc which also works).", "url": "https://github.com/elastic/elasticsearch/pull/56872#discussion_r428568949", "createdAt": "2020-05-21T10:22:16Z", "author": {"login": "matriv"}, "path": "x-pack/plugin/sql/qa/jdbc/build.gradle", "diffHunk": "@@ -0,0 +1,61 @@\n+description = 'Integration tests for SQL JDBC driver'\n+apply plugin: 'elasticsearch.build'\n+\n+// Avoid circular dependency", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f12bceb6c5b3d293963f053ed3838245bb7e940e"}, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7919350d83b15f40877c8d019b46cc458dc275dd", "author": {"user": {"login": "matriv", "name": "Marios Trivyzas"}}, "url": "https://github.com/elastic/elasticsearch/commit/7919350d83b15f40877c8d019b46cc458dc275dd", "committedDate": "2020-05-21T10:25:17Z", "message": "fix doc example paths"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e4562e7bbf2611f3025344b7eee96165f4a20240", "author": {"user": {"login": "matriv", "name": "Marios Trivyzas"}}, "url": "https://github.com/elastic/elasticsearch/commit/e4562e7bbf2611f3025344b7eee96165f4a20240", "committedDate": "2020-05-21T10:32:38Z", "message": "fixup! fix doc example paths"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9b0f9155d013e61fae1b07ead971bf533495f79a", "author": {"user": {"login": "matriv", "name": "Marios Trivyzas"}}, "url": "https://github.com/elastic/elasticsearch/commit/9b0f9155d013e61fae1b07ead971bf533495f79a", "committedDate": "2020-05-21T10:42:49Z", "message": "fixup! fixup! fix doc example paths"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE2NDgwMTE3", "url": "https://github.com/elastic/elasticsearch/pull/56872#pullrequestreview-416480117", "createdAt": "2020-05-21T20:47:15Z", "commit": {"oid": "9b0f9155d013e61fae1b07ead971bf533495f79a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4828, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}