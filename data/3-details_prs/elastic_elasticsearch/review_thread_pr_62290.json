{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDg2NDE2Njg5", "number": 62290, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQyMToxNjoxOVrOEkPkLA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQyMToxNjoxOVrOEkPkLA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA2NDM5MjEyOnYy", "diffSide": "RIGHT", "path": "server/src/main/java/org/elasticsearch/common/time/JavaDateFormatter.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQyMToxNjoxOVrOHTEhgQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xN1QwODo1Mzo1NVrOHTYK4A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTc1OTEwNQ==", "bodyText": "How does this differ from the note above mentioning merges with || appending to the list of roundup formatters?", "url": "https://github.com/elastic/elasticsearch/pull/62290#discussion_r489759105", "createdAt": "2020-09-16T21:16:19Z", "author": {"login": "rjernst"}, "path": "server/src/main/java/org/elasticsearch/common/time/JavaDateFormatter.java", "diffHunk": "@@ -113,10 +113,14 @@ JavaDateFormatter getRoundupParser() {\n     private List<DateTimeFormatter> createRoundUpParser(String format,\n                                                         Consumer<DateTimeFormatterBuilder> roundupParserConsumer) {\n         if (format.contains(\"||\") == false) {\n-            DateTimeFormatterBuilder builder = new DateTimeFormatterBuilder();\n-            builder.append(this.parsers.get(0));\n-            roundupParserConsumer.accept(builder);\n-            return Arrays.asList(builder.toFormatter(locale()));\n+            List<DateTimeFormatter> roundUpParsers = new ArrayList<>();\n+            for (DateTimeFormatter parser : this.parsers) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "20ba8f3e040efcff9d8091b3a3055c490a219371"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDA4MDk5Mg==", "bodyText": "so the comment mentions In further merges (with ||) it will only append this one to a list. When probably it should mention this in plural.\nwhen a DateFormatter with multiple parsers like for instance date_time it will now also have a multiple round up parsers. When a date_time is then used in combination with other parsers, it will merge its parsers and round up parsers.\nfor instance date_time||date_time_no_millis\ndate_time has 2 parsers and 2 round up parsers\ndate_time_no_millis also has 4 parsers and round up parsers\ndate_time||date_time_no_millis will merge to have 6 parsers and 6 round up parsers\nI added a test case to confirm that all of them are being used.\nThe reason I initially only taken the first parser ( builder.append(this.parsers.get(0)); ) was that I tested for JavaDateFormatter created for a custom pattern.\nDateFormatter.forPattern(\"YYYY\") where there no multiple parsers\nlet me know if that makes it clear?", "url": "https://github.com/elastic/elasticsearch/pull/62290#discussion_r490080992", "createdAt": "2020-09-17T08:53:55Z", "author": {"login": "pgomulka"}, "path": "server/src/main/java/org/elasticsearch/common/time/JavaDateFormatter.java", "diffHunk": "@@ -113,10 +113,14 @@ JavaDateFormatter getRoundupParser() {\n     private List<DateTimeFormatter> createRoundUpParser(String format,\n                                                         Consumer<DateTimeFormatterBuilder> roundupParserConsumer) {\n         if (format.contains(\"||\") == false) {\n-            DateTimeFormatterBuilder builder = new DateTimeFormatterBuilder();\n-            builder.append(this.parsers.get(0));\n-            roundupParserConsumer.accept(builder);\n-            return Arrays.asList(builder.toFormatter(locale()));\n+            List<DateTimeFormatter> roundUpParsers = new ArrayList<>();\n+            for (DateTimeFormatter parser : this.parsers) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTc1OTEwNQ=="}, "originalCommit": {"oid": "20ba8f3e040efcff9d8091b3a3055c490a219371"}, "originalPosition": 9}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1531, "cost": 1, "resetAt": "2021-11-12T13:16:51Z"}}}