{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTExMDY1MTgw", "number": 64250, "title": "Reduce usages of SearchContext#mapperService", "bodyText": "We recently removed getMapperService from QueryShardContext in the attempt to prevent consumers from depending on the whole MapperService. SearchContext still has that problem although it is easier to solved as it can delegate to QueryShardContext for the most part, which is what this commit does for most of the existing usages.", "createdAt": "2020-10-27T21:02:38Z", "url": "https://github.com/elastic/elasticsearch/pull/64250", "merged": true, "mergeCommit": {"oid": "2186b75af9f76b866539c16e76ffc8e019ac11d3"}, "closed": true, "closedAt": "2020-10-28T08:55:53Z", "author": {"login": "javanna"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdWvcXAgH2gAyNTExMDY1MTgwOjJlNGY2ODlkYzhlZDY3ZDExMzk4ODA3ZWJiNjg3MmY3Yjg5MmFmNDI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdW4-1UgH2gAyNTExMDY1MTgwOmY5OWE1YjdmOGE4YjIzNTQ1ODI1ZTdjZGNkZTcwODQ4ODZkYzUxY2M=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "2e4f689dc8ed67d11398807ebb6872f7b892af42", "author": {"user": {"login": "javanna", "name": "Luca Cavanna"}}, "url": "https://github.com/elastic/elasticsearch/commit/2e4f689dc8ed67d11398807ebb6872f7b892af42", "committedDate": "2020-10-27T21:00:05Z", "message": "Reduce usages of SearchContext#mapperService\n\nWe recently removed getMapperService from QueryShardContext in the attempt to avoid consumers depending on the whole MapperService. SearchContext still has that problem although it is easier to solved as it can delegate to QueryShardContext for the most part, which is what this commit does for most of the existing usages."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE4MTQ5MTA2", "url": "https://github.com/elastic/elasticsearch/pull/64250#pullrequestreview-518149106", "createdAt": "2020-10-27T21:03:43Z", "commit": {"oid": "2e4f689dc8ed67d11398807ebb6872f7b892af42"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yN1QyMTowMzo0M1rOHpQ3EA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yN1QyMTowMzo0M1rOHpQ3EA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzAyOTkwNA==", "bodyText": "this made me nervous , but I tried removing, I do expect test failures caused by it, but let's see. Same for other changes in the test classes.", "url": "https://github.com/elastic/elasticsearch/pull/64250#discussion_r513029904", "createdAt": "2020-10-27T21:03:43Z", "author": {"login": "javanna"}, "path": "server/src/main/java/org/elasticsearch/search/query/QueryPhase.java", "diffHunk": "@@ -429,8 +429,7 @@ private static Query tryRewriteLongSort(SearchContext searchContext, IndexReader\n         // check if this is a field of type Long or Date, that is indexed and has doc values\n         String fieldName = sortField.getField();\n         if (fieldName == null) return null; // happens when _score or _doc is the 1st sort field\n-        if (searchContext.mapperService() == null) return null; // mapperService can be null in tests", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2e4f689dc8ed67d11398807ebb6872f7b892af42"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE4MTUxMjAy", "url": "https://github.com/elastic/elasticsearch/pull/64250#pullrequestreview-518151202", "createdAt": "2020-10-27T21:06:41Z", "commit": {"oid": "2e4f689dc8ed67d11398807ebb6872f7b892af42"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yN1QyMTowNjo0MVrOHpQ_TQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yN1QyMTowNjo0MVrOHpQ_TQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzAzMjAxMw==", "bodyText": "\ud83d\udc4d", "url": "https://github.com/elastic/elasticsearch/pull/64250#discussion_r513032013", "createdAt": "2020-10-27T21:06:41Z", "author": {"login": "nik9000"}, "path": "server/src/main/java/org/elasticsearch/search/query/QueryPhase.java", "diffHunk": "@@ -429,8 +429,7 @@ private static Query tryRewriteLongSort(SearchContext searchContext, IndexReader\n         // check if this is a field of type Long or Date, that is indexed and has doc values\n         String fieldName = sortField.getField();\n         if (fieldName == null) return null; // happens when _score or _doc is the 1st sort field\n-        if (searchContext.mapperService() == null) return null; // mapperService can be null in tests", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzAyOTkwNA=="}, "originalCommit": {"oid": "2e4f689dc8ed67d11398807ebb6872f7b892af42"}, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f99a5b7f8a8b23545825e7cdcde7084886dc51cc", "author": {"user": {"login": "javanna", "name": "Luca Cavanna"}}, "url": "https://github.com/elastic/elasticsearch/commit/f99a5b7f8a8b23545825e7cdcde7084886dc51cc", "committedDate": "2020-10-28T08:06:53Z", "message": "Merge branch 'master' into refactoring/search_context_mapper_service"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1031, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}