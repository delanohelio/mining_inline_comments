{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzkzNjcxMjIx", "number": 54200, "title": "HLRC: Don't send defaults for SubmitAsyncSearchRequest", "bodyText": "Currently we set the defaults for ccsMinimizeRoundtrips, preFilterShardSize and\nrequestCache on the HLRC SubmitAsyncSearchRequest in the constructor. This is no\nlonger needed since we now only send the parameters along with the rest request\nthat are supported (omitting e.g. ccsMinimizeRoundtrips) and the correct\ndefaults are set on the client side. This change removes setting and sending\nthese defaults where possible, leaving only the overwrite of batchedReduceSize\nwith a default value of 5, since the default used in the vanilla SearchRequest\nis 512. However, we don't need to send this value along as a request parameter\nif its the default since the correct one will be set on the receiving end if no\nvalue is specified.\nAlso adding tests for RestSubmitAsyncSearchAction that check the correct\ndefaults are set when parameters are missing on the server side.", "createdAt": "2020-03-25T15:53:00Z", "url": "https://github.com/elastic/elasticsearch/pull/54200", "merged": true, "mergeCommit": {"oid": "4ae258a27b1e234a6ed257b17e1f1c2dbf109f59"}, "closed": true, "closedAt": "2020-03-26T13:00:29Z", "author": {"login": "cbuescher"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcRJp7MAH2gAyMzkzNjcxMjIxOjMwZDU1NGQ0OGZhMWRlODY2ZmRiYjgwMTkwNTg2OGZiZjEzYjZhMWM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcRZ4NYgH2gAyMzkzNjcxMjIxOjNiMjI0OTE4NzZlZTUzMGY4MWYzYTM3ZTdlZmRlYTRkM2M3YTgyMzI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "30d554d48fa1de866fdbb801905868fbf13b6a1c", "author": {"user": {"login": "cbuescher", "name": "Christoph B\u00fcscher"}}, "url": "https://github.com/elastic/elasticsearch/commit/30d554d48fa1de866fdbb801905868fbf13b6a1c", "committedDate": "2020-03-25T15:57:44Z", "message": "HLRC: Don't send defaults for SubmitAsyncSearchRequest\n\nCurrently we set the defaults for ccsMinimizeRoundtrips, preFilterShardSize and\nrequestCache on the HLRC SubmitAsyncSearchRequest in the constructor. This is no\nlonger needed since we now only send the parameters along with the rest request\nthat are supported (omitting e.g. ccsMinimizeRoundtrips) and the correct\ndefaults are set on the client side. This change removes setting and sending\nthese defaults where possible, leaving only the overwrite of batchedReduceSize\nwith a default value of 5, since the default used in the vanilla SearchRequest\nis 512. However, we don't need to send this value along as a request parameter\nif its the default since the correct one will be set on the receiving end if no\nvalue is specified.\nAlso adding tests for RestSubmitAsyncSearchAction that check the correct\ndefaults are set when parameters are missing on the server side."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f843b588e8265e648be97a274323d6792cb0beb3", "author": {"user": {"login": "cbuescher", "name": "Christoph B\u00fcscher"}}, "url": "https://github.com/elastic/elasticsearch/commit/f843b588e8265e648be97a274323d6792cb0beb3", "committedDate": "2020-03-25T15:39:53Z", "message": "HLRC: Don't send defaults for SubmitAsyncSearchRequest\n\nCurrently we set the defaults for ccsMinimizeRoundtrips, preFilterShardSize and\nrequestCache on the HLRC SubmitAsyncSearchRequest in the constructor. This is no\nlonger needed since we now only send the parameters along with the rest request\nthat are supported (omitting e.g. ccsMinimizeRoundtrips) and the correct\ndefaults are set on the client side. This change removes setting and sending\nthese defaults where possible, leaving only the overwrite of batchedReduceSize\nwith a default value of 5, since the default used in the vanilla SearchRequest\nis 512. However, we don't need to send this value along as a request parameter\nif its the default since the correct one will be set on the receiving end if no\nvalue is specified.\nAlso adding tests for RestSubmitAsyncSearchAction that check the correct\ndefaults are set when parameters are missing on the server side."}, "afterCommit": {"oid": "30d554d48fa1de866fdbb801905868fbf13b6a1c", "author": {"user": {"login": "cbuescher", "name": "Christoph B\u00fcscher"}}, "url": "https://github.com/elastic/elasticsearch/commit/30d554d48fa1de866fdbb801905868fbf13b6a1c", "committedDate": "2020-03-25T15:57:44Z", "message": "HLRC: Don't send defaults for SubmitAsyncSearchRequest\n\nCurrently we set the defaults for ccsMinimizeRoundtrips, preFilterShardSize and\nrequestCache on the HLRC SubmitAsyncSearchRequest in the constructor. This is no\nlonger needed since we now only send the parameters along with the rest request\nthat are supported (omitting e.g. ccsMinimizeRoundtrips) and the correct\ndefaults are set on the client side. This change removes setting and sending\nthese defaults where possible, leaving only the overwrite of batchedReduceSize\nwith a default value of 5, since the default used in the vanilla SearchRequest\nis 512. However, we don't need to send this value along as a request parameter\nif its the default since the correct one will be set on the receiving end if no\nvalue is specified.\nAlso adding tests for RestSubmitAsyncSearchAction that check the correct\ndefaults are set when parameters are missing on the server side."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgxNTI0NjU1", "url": "https://github.com/elastic/elasticsearch/pull/54200#pullrequestreview-381524655", "createdAt": "2020-03-25T20:48:54Z", "commit": {"oid": "30d554d48fa1de866fdbb801905868fbf13b6a1c"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQyMDo0ODo1NFrOF7tueg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQyMDo0ODo1NFrOF7tueg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODE1OTQ4Mg==", "bodyText": "I would prefer if we found a way to not have the default value in the client too. Would it be an option to make this an Integer that is null by default, and only set it when it was explicitly set?", "url": "https://github.com/elastic/elasticsearch/pull/54200#discussion_r398159482", "createdAt": "2020-03-25T20:48:54Z", "author": {"login": "javanna"}, "path": "client/rest-high-level/src/main/java/org/elasticsearch/client/AsyncSearchRequestConverters.java", "diffHunk": "@@ -73,7 +73,9 @@ static void addSearchRequestParams(Params params, SubmitAsyncSearchRequest reque\n         if (request.getAllowPartialSearchResults() != null) {\n             params.withAllowPartialResults(request.getAllowPartialSearchResults());\n         }\n-        params.withBatchedReduceSize(request.getBatchedReduceSize());\n+        if (request.getBatchedReduceSize() != SubmitAsyncSearchRequest.DEFAULT_BATCHED_REDUCE_SIZE) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "30d554d48fa1de866fdbb801905868fbf13b6a1c"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8d3ef0c9006d0de6cd61800f908d7922ecac8094", "author": {"user": {"login": "cbuescher", "name": "Christoph B\u00fcscher"}}, "url": "https://github.com/elastic/elasticsearch/commit/8d3ef0c9006d0de6cd61800f908d7922ecac8094", "committedDate": "2020-03-26T10:15:06Z", "message": "Merge branch 'master' into asyncsearch-hlrc-cleanup-defaults"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "aa4ab12dd585b96cb797d278d0523a02702d075a", "author": {"user": {"login": "cbuescher", "name": "Christoph B\u00fcscher"}}, "url": "https://github.com/elastic/elasticsearch/commit/aa4ab12dd585b96cb797d278d0523a02702d075a", "committedDate": "2020-03-26T10:20:50Z", "message": "iter"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e594083ad7fd2bcc9c43e42bd1d83bb5ae121dbc", "author": {"user": {"login": "cbuescher", "name": "Christoph B\u00fcscher"}}, "url": "https://github.com/elastic/elasticsearch/commit/e594083ad7fd2bcc9c43e42bd1d83bb5ae121dbc", "committedDate": "2020-03-26T10:36:02Z", "message": "Hide batchedReducedSize from inner SearchRequest"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3b22491876ee530f81f3a37e7efdea4d3c7a8232", "author": {"user": {"login": "cbuescher", "name": "Christoph B\u00fcscher"}}, "url": "https://github.com/elastic/elasticsearch/commit/3b22491876ee530f81f3a37e7efdea4d3c7a8232", "committedDate": "2020-03-26T10:51:49Z", "message": "fix javadoc"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1549, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}