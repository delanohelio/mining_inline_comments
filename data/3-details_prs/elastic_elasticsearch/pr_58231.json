{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM1NzE4MjU2", "number": 58231, "title": "Add data stream support to put mapping and update index settings APIs.", "bodyText": "If a data stream is used in the list of index expressions then each\ndata stream is resolved to the latest backing index (write index) of data stream.\nUpdate index settings and put mapping apis calls that target a data stream are\nexecuted on all backing indices.\nIn a followup an additional parameter will be added to the put mapping api that controls\nwhether a put mapping api call that targets a data stream is executed on all backing indices (default) or\nonly the write index of a data stream. This is to support #58251.\nRelates #53100", "createdAt": "2020-06-17T09:19:06Z", "url": "https://github.com/elastic/elasticsearch/pull/58231", "merged": true, "mergeCommit": {"oid": "906aed4a88171ead31da25bdbef00afc95827e4d"}, "closed": true, "closedAt": "2020-06-30T15:23:28Z", "author": {"login": "martijnvg"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcsGSWAgH2gAyNDM1NzE4MjU2OjRkNDQ4MTkyM2RkMTE0NGNlMWJmM2U2Njg2ZDJiZTg4OTcwNWI1OTY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcwVj8lgH2gAyNDM1NzE4MjU2OjZjNThhNGY3ZjU4MjFmYmRhNTA3ZTAxYmVhNTZlNGRiZjZhMThjMjQ=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "4d4481923dd1144ce1bf3e6686d2be889705b596", "author": {"user": {"login": "martijnvg", "name": "Martijn van Groningen"}}, "url": "https://github.com/elastic/elasticsearch/commit/4d4481923dd1144ce1bf3e6686d2be889705b596", "committedDate": "2020-06-17T09:18:13Z", "message": "Add data stream support to put mapping and update index settings APIs.\n\nIf a data stream is used in the list of index expressions then each\ndata stream is resolved to the latest backing index (write index) of data stream.\n\nRelates #53100"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "20400d75ab2e3b4dcce7919445073bcd3f871181", "author": {"user": {"login": "martijnvg", "name": "Martijn van Groningen"}}, "url": "https://github.com/elastic/elasticsearch/commit/20400d75ab2e3b4dcce7919445073bcd3f871181", "committedDate": "2020-06-17T11:41:03Z", "message": "removed outdated yaml tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "aa64e482dab9f2c798c28304811cfc1cbedd461d", "author": {"user": {"login": "martijnvg", "name": "Martijn van Groningen"}}, "url": "https://github.com/elastic/elasticsearch/commit/aa64e482dab9f2c798c28304811cfc1cbedd461d", "committedDate": "2020-06-28T18:13:25Z", "message": "Merge remote-tracking branch 'es/master' into add_ds_support_put_mapping_update_settings"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e283fa42482b44e689781f7d94c8558b0c560ae9", "author": {"user": {"login": "martijnvg", "name": "Martijn van Groningen"}}, "url": "https://github.com/elastic/elasticsearch/commit/e283fa42482b44e689781f7d94c8558b0c560ae9", "committedDate": "2020-06-28T18:24:44Z", "message": "fixed compile errors after mere"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9def6e3768c3002eb483a6f12634cc244967fd87", "author": {"user": {"login": "martijnvg", "name": "Martijn van Groningen"}}, "url": "https://github.com/elastic/elasticsearch/commit/9def6e3768c3002eb483a6f12634cc244967fd87", "committedDate": "2020-06-28T19:32:23Z", "message": "Change update index setting and put mapping api\nto execute on all backing indices if data stream is targeted."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM5MTk0MTg3", "url": "https://github.com/elastic/elasticsearch/pull/58231#pullrequestreview-439194187", "createdAt": "2020-06-29T14:21:39Z", "commit": {"oid": "9def6e3768c3002eb483a6f12634cc244967fd87"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yOVQxNDoyMTozOVrOGqTSIQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yOVQxNDoyMTozOVrOGqTSIQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzAwOTMxMw==", "bodyText": "Is this comment correct? It looks like it applies the mapping to all backing indices.", "url": "https://github.com/elastic/elasticsearch/pull/58231#discussion_r447009313", "createdAt": "2020-06-29T14:21:39Z", "author": {"login": "danhermann"}, "path": "server/src/internalClusterTest/java/org/elasticsearch/indices/DataStreamIT.java", "diffHunk": "@@ -592,6 +605,58 @@ public void testTimestampFieldCustomAttributes() throws Exception {\n         client().admin().indices().deleteDataStream(deleteDataStreamRequest).actionGet();\n     }\n \n+    public void testUpdateMappingViaDataStream() throws Exception {\n+        putComposableIndexTemplate(\"id1\", \"@timestamp\", List.of(\"logs-*\"));\n+        CreateDataStreamAction.Request createDataStreamRequest = new CreateDataStreamAction.Request(\"logs-foobar\");\n+        client().admin().indices().createDataStream(createDataStreamRequest).actionGet();\n+\n+        String backingIndex1 = DataStream.getDefaultBackingIndexName(\"logs-foobar\", 1);\n+        String backingIndex2 = DataStream.getDefaultBackingIndexName(\"logs-foobar\", 2);\n+\n+        RolloverResponse rolloverResponse = client().admin().indices().rolloverIndex(new RolloverRequest(\"logs-foobar\", null)).get();\n+        assertThat(rolloverResponse.getNewIndex(), equalTo(backingIndex2));\n+        assertTrue(rolloverResponse.isRolledOver());\n+\n+        Map<?, ?> expectedMapping = Map.of(\"properties\", Map.of(\"@timestamp\", Map.of(\"type\", \"date\")));\n+        GetMappingsResponse getMappingsResponse = getMapping(\"logs-foobar\").get();\n+        assertThat(getMappingsResponse.getMappings().size(), equalTo(2));\n+        assertThat(getMappingsResponse.getMappings().get(backingIndex1).getSourceAsMap(), equalTo(expectedMapping));\n+        assertThat(getMappingsResponse.getMappings().get(backingIndex2).getSourceAsMap(), equalTo(expectedMapping));\n+\n+        expectedMapping = Map.of(\"properties\", Map.of(\"@timestamp\", Map.of(\"type\", \"date\"), \"my_field\", Map.of(\"type\", \"keyword\")));\n+        putMapping(\"{\\\"properties\\\":{\\\"my_field\\\":{\\\"type\\\":\\\"keyword\\\"}}}\", \"logs-foobar\").get();\n+        // Only the mapping of th latest backing index should be updated:", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9def6e3768c3002eb483a6f12634cc244967fd87"}, "originalPosition": 91}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4a1ed45a9d36b51fa93c695b18526e021f9c1766", "author": {"user": {"login": "martijnvg", "name": "Martijn van Groningen"}}, "url": "https://github.com/elastic/elasticsearch/commit/4a1ed45a9d36b51fa93c695b18526e021f9c1766", "committedDate": "2020-06-30T06:55:35Z", "message": "Merge remote-tracking branch 'es/master' into add_ds_support_put_mapping_update_settings"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "791289b976a82d6943a4db95b44213ef563949bb", "author": {"user": {"login": "martijnvg", "name": "Martijn van Groningen"}}, "url": "https://github.com/elastic/elasticsearch/commit/791289b976a82d6943a4db95b44213ef563949bb", "committedDate": "2020-06-30T06:56:56Z", "message": "fix comment"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7f3823606fdb7a503e10989f22e20716a819d236", "author": {"user": {"login": "martijnvg", "name": "Martijn van Groningen"}}, "url": "https://github.com/elastic/elasticsearch/commit/7f3823606fdb7a503e10989f22e20716a819d236", "committedDate": "2020-06-30T08:43:10Z", "message": "Merge remote-tracking branch 'es/master' into add_ds_support_put_mapping_update_settings"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6c58a4f7f5821fbda507e01bea56e4dbf6a18c24", "author": {"user": {"login": "martijnvg", "name": "Martijn van Groningen"}}, "url": "https://github.com/elastic/elasticsearch/commit/6c58a4f7f5821fbda507e01bea56e4dbf6a18c24", "committedDate": "2020-06-30T13:21:43Z", "message": "Merge remote-tracking branch 'es/master' into add_ds_support_put_mapping_update_settings"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 581, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}