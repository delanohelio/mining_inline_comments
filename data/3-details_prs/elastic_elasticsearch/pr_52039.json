{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzcyMzY3OTI5", "number": 52039, "title": "Upgrade to lucene-8.5.0-snapshot-d62f6307658", "bodyText": "Upgrade to a new snapshot.", "createdAt": "2020-02-07T11:34:06Z", "url": "https://github.com/elastic/elasticsearch/pull/52039", "merged": true, "mergeCommit": {"oid": "8b6e6a1639293be900e540bec265618ff156228b"}, "closed": true, "closedAt": "2020-02-10T08:08:17Z", "author": {"login": "iverase"}, "timelineItems": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcB9TA3gH2gAyMzcyMzY3OTI5OmI3ODBiYmY3MmI1MGZlY2E0MTUwMDFmOWVjYTY4YzM0ZTRkMzYyNDY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcCBMtVgH2gAyMzcyMzY3OTI5OmY5ZjU4MmJmNzIwNWVlMmE2Y2FlZjM1NGFlM2U3ZjhkMTc3NTI1MjQ=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "b780bbf72b50feca415001f9eca68c34e4d36246", "author": {"user": {"login": "iverase", "name": "Ignacio Vera"}}, "url": "https://github.com/elastic/elasticsearch/commit/b780bbf72b50feca415001f9eca68c34e4d36246", "committedDate": "2020-02-07T11:04:59Z", "message": "upgrade to lucene-snapshot-d62f6307658"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1f9334de4305c717d7e2af04f5685ed77faf7820", "author": {"user": {"login": "iverase", "name": "Ignacio Vera"}}, "url": "https://github.com/elastic/elasticsearch/commit/1f9334de4305c717d7e2af04f5685ed77faf7820", "committedDate": "2020-02-07T11:23:38Z", "message": "compile error and unused import"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU1MDk5NTc5", "url": "https://github.com/elastic/elasticsearch/pull/52039#pullrequestreview-355099579", "createdAt": "2020-02-07T11:37:52Z", "commit": {"oid": "1f9334de4305c717d7e2af04f5685ed77faf7820"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU1MTEwNzM4", "url": "https://github.com/elastic/elasticsearch/pull/52039#pullrequestreview-355110738", "createdAt": "2020-02-07T12:01:20Z", "commit": {"oid": "1f9334de4305c717d7e2af04f5685ed77faf7820"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wN1QxMjowMToyMFrOFm69cw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wN1QxMjowMToyMFrOFm69cw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjM1NjIxMQ==", "bodyText": "@jpountz I am not sure about this change, and it seems the extension name has been changed. I think there are failures related with this change.", "url": "https://github.com/elastic/elasticsearch/pull/52039#discussion_r376356211", "createdAt": "2020-02-07T12:01:20Z", "author": {"login": "iverase"}, "path": "x-pack/plugin/core/src/main/java/org/elasticsearch/snapshots/SourceOnlySnapshot.java", "diffHunk": "@@ -51,7 +51,7 @@\n import java.util.function.Supplier;\n \n import static org.apache.lucene.codecs.compressing.CompressingStoredFieldsWriter.FIELDS_EXTENSION;\n-import static org.apache.lucene.codecs.compressing.CompressingStoredFieldsWriter.FIELDS_INDEX_EXTENSION;\n+import static org.apache.lucene.codecs.compressing.CompressingStoredFieldsWriter.INDEX_EXTENSION_PREFIX;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1f9334de4305c717d7e2af04f5685ed77faf7820"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1663d2648a06c8e882d194ffb5b98c38a5c45b16", "author": {"user": {"login": "iverase", "name": "Ignacio Vera"}}, "url": "https://github.com/elastic/elasticsearch/commit/1663d2648a06c8e882d194ffb5b98c38a5c45b16", "committedDate": "2020-02-07T13:35:41Z", "message": "Adjust files created by new algorithm. I wonder if / how to support\nbackwards compatibility"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU1MTYwNTA3", "url": "https://github.com/elastic/elasticsearch/pull/52039#pullrequestreview-355160507", "createdAt": "2020-02-07T13:39:23Z", "commit": {"oid": "1663d2648a06c8e882d194ffb5b98c38a5c45b16"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wN1QxMzozOToyNFrOFm9Quw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wN1QxMzozOToyNFrOFm9Quw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjM5MzkxNQ==", "bodyText": "I believe it has to be done conditionally in order to support old indices.", "url": "https://github.com/elastic/elasticsearch/pull/52039#discussion_r376393915", "createdAt": "2020-02-07T13:39:24Z", "author": {"login": "jpountz"}, "path": "x-pack/plugin/core/src/main/java/org/elasticsearch/snapshots/SourceOnlySnapshot.java", "diffHunk": "@@ -206,13 +208,15 @@ private SegmentCommitInfo syncSegment(SegmentCommitInfo segmentCommitInfo, LiveD\n             FieldInfos newFieldInfos = new FieldInfos(fieldInfoCopy.toArray(new FieldInfo[0]));\n             codec.fieldInfosFormat().write(trackingDir, newSegmentInfo, segmentSuffix, newFieldInfos, IOContext.DEFAULT);\n             newInfo.setFieldInfosFiles(trackingDir.getCreatedFiles());\n-            String idxFile = IndexFileNames.segmentFileName(newSegmentInfo.name, segmentSuffix, INDEX_EXTENSION_PREFIX);\n+            String idxFile = IndexFileNames.segmentFileName(newSegmentInfo.name, segmentSuffix, INDEX_EXTENSION_PREFIX + FIELDS_INDEX_EXTENSION_SUFFIX);\n+            String metadataFile = IndexFileNames.segmentFileName(newSegmentInfo.name, segmentSuffix, INDEX_EXTENSION_PREFIX + FIELDS_META_EXTENSION_SUFFIX);\n             String dataFile = IndexFileNames.segmentFileName(newSegmentInfo.name, segmentSuffix, FIELDS_EXTENSION);\n             Directory sourceDir = newSegmentInfo.dir;\n             if (si.getUseCompoundFile()) {\n                 sourceDir = codec.compoundFormat().getCompoundReader(sourceDir, si, IOContext.DEFAULT);\n             }\n             trackingDir.copyFrom(sourceDir, idxFile, idxFile, IOContext.DEFAULT);\n+            trackingDir.copyFrom(sourceDir, metadataFile, metadataFile, IOContext.DEFAULT);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1663d2648a06c8e882d194ffb5b98c38a5c45b16"}, "originalPosition": 22}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU1MTYwNjky", "url": "https://github.com/elastic/elasticsearch/pull/52039#pullrequestreview-355160692", "createdAt": "2020-02-07T13:39:41Z", "commit": {"oid": "1663d2648a06c8e882d194ffb5b98c38a5c45b16"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wN1QxMzozOTo0MVrOFm9RVA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wN1QxMzozOTo0MVrOFm9RVA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjM5NDA2OA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        // we processed the segments_N file plus _1.si, _1.fdx, _1.fnm, _1.fdt, , _1.fdx\n          \n          \n            \n                        // we processed the segments_N file plus _1.si, _1.fdx, _1.fnm, _1.fdt, _1.fdm, _1.fdx", "url": "https://github.com/elastic/elasticsearch/pull/52039#discussion_r376394068", "createdAt": "2020-02-07T13:39:41Z", "author": {"login": "jpountz"}, "path": "x-pack/plugin/core/src/test/java/org/elasticsearch/snapshots/SourceOnlySnapshotShardTests.java", "diffHunk": "@@ -147,10 +147,10 @@ public void testIncrementalSnapshot() throws IOException {\n                 snapshotRef.getIndexCommit(), indexShardSnapshotStatus, true, Collections.emptyMap(), future));\n             shardGeneration = future.actionGet();\n             IndexShardSnapshotStatus.Copy copy = indexShardSnapshotStatus.asCopy();\n-            // we processed the segments_N file plus _1.si, _1.fdx, _1.fnm, _1.fdt\n-            assertEquals(5, copy.getIncrementalFileCount());\n+            // we processed the segments_N file plus _1.si, _1.fdx, _1.fnm, _1.fdt, , _1.fdx", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1663d2648a06c8e882d194ffb5b98c38a5c45b16"}, "originalPosition": 6}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "36a29e0552595336c8c595676724fa9cc51a868c", "author": {"user": {"login": "iverase", "name": "Ignacio Vera"}}, "url": "https://github.com/elastic/elasticsearch/commit/36a29e0552595336c8c595676724fa9cc51a868c", "committedDate": "2020-02-07T13:48:24Z", "message": "add conditional in new file as only exists for new indices."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1f720cdb4cce9b17f3c4b98c14b116f8d71e735e", "author": {"user": {"login": "iverase", "name": "Ignacio Vera"}}, "url": "https://github.com/elastic/elasticsearch/commit/1f720cdb4cce9b17f3c4b98c14b116f8d71e735e", "committedDate": "2020-02-07T13:51:42Z", "message": "update comments to new number of files"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU1MTk0NTcw", "url": "https://github.com/elastic/elasticsearch/pull/52039#pullrequestreview-355194570", "createdAt": "2020-02-07T14:31:56Z", "commit": {"oid": "1f720cdb4cce9b17f3c4b98c14b116f8d71e735e"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "32b2839ab77d652f7d71be24279c6d4112ded07c", "author": {"user": {"login": "iverase", "name": "Ignacio Vera"}}, "url": "https://github.com/elastic/elasticsearch/commit/32b2839ab77d652f7d71be24279c6d4112ded07c", "committedDate": "2020-02-07T15:16:17Z", "message": "update number of files of yaml test. I still think it can run in\ndifferent versions so it might not be the proper fix."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f9f582bf7205ee2a6caef354ae3e7f8d17752524", "author": {"user": {"login": "iverase", "name": "Ignacio Vera"}}, "url": "https://github.com/elastic/elasticsearch/commit/f9f582bf7205ee2a6caef354ae3e7f8d17752524", "committedDate": "2020-02-07T15:37:43Z", "message": "make sure the test does not fail in mixed version cluster"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2648, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}