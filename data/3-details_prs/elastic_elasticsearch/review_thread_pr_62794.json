{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDkxMjEyMTQ3", "number": 62794, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yM1QxMTo0MToyOFrOEmiiIw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yM1QxMTo0MToyOFrOEmiiIw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA4ODQ3MTM5OnYy", "diffSide": "RIGHT", "path": "libs/grok/src/main/java/org/elasticsearch/grok/GrokCaptureConfig.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yM1QxMTo0MToyOFrOHWoEWg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yM1QxMjo0NjoyNFrOHWrtiA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzQ4NzE5NA==", "bodyText": "Ah, I was thrown off by this initially.\nThe region starts at index 0 and we have to offset it just like we did the initial match because we are extracting from the original utf8Bytes.\nBut the question is...if region.beg[number] is 0, how does region.end[number] - region.beg[number] work? Doesn't it have to take the offset into account too?", "url": "https://github.com/elastic/elasticsearch/pull/62794#discussion_r493487194", "createdAt": "2020-09-23T11:41:28Z", "author": {"login": "benwtrent"}, "path": "libs/grok/src/main/java/org/elasticsearch/grok/GrokCaptureConfig.java", "diffHunk": "@@ -54,10 +54,10 @@ public GrokCaptureType type() {\n         return type;\n     }\n \n-    Object extract(byte[] textAsBytes, Region region) {\n+    Object extract(byte[] utf8Bytes, int offset, Region region) {\n         for (int number : backRefs) {\n             if (region.beg[number] >= 0) {\n-                String matchValue = new String(textAsBytes, region.beg[number], region.end[number] - region.beg[number],\n+                String matchValue = new String(utf8Bytes, offset + region.beg[number], region.end[number] - region.beg[number],", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "28f31a8b75bf25ed98f1279c325586b51b1dcdc8"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzUzODY2Nw==", "bodyText": "region.end[number] - region.beg[number] is a length so adding the offset would sort of break it.", "url": "https://github.com/elastic/elasticsearch/pull/62794#discussion_r493538667", "createdAt": "2020-09-23T12:38:12Z", "author": {"login": "nik9000"}, "path": "libs/grok/src/main/java/org/elasticsearch/grok/GrokCaptureConfig.java", "diffHunk": "@@ -54,10 +54,10 @@ public GrokCaptureType type() {\n         return type;\n     }\n \n-    Object extract(byte[] textAsBytes, Region region) {\n+    Object extract(byte[] utf8Bytes, int offset, Region region) {\n         for (int number : backRefs) {\n             if (region.beg[number] >= 0) {\n-                String matchValue = new String(textAsBytes, region.beg[number], region.end[number] - region.beg[number],\n+                String matchValue = new String(utf8Bytes, offset + region.beg[number], region.end[number] - region.beg[number],", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzQ4NzE5NA=="}, "originalCommit": {"oid": "28f31a8b75bf25ed98f1279c325586b51b1dcdc8"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzU0Njg4OA==", "bodyText": "@nik9000 D'OH", "url": "https://github.com/elastic/elasticsearch/pull/62794#discussion_r493546888", "createdAt": "2020-09-23T12:46:24Z", "author": {"login": "benwtrent"}, "path": "libs/grok/src/main/java/org/elasticsearch/grok/GrokCaptureConfig.java", "diffHunk": "@@ -54,10 +54,10 @@ public GrokCaptureType type() {\n         return type;\n     }\n \n-    Object extract(byte[] textAsBytes, Region region) {\n+    Object extract(byte[] utf8Bytes, int offset, Region region) {\n         for (int number : backRefs) {\n             if (region.beg[number] >= 0) {\n-                String matchValue = new String(textAsBytes, region.beg[number], region.end[number] - region.beg[number],\n+                String matchValue = new String(utf8Bytes, offset + region.beg[number], region.end[number] - region.beg[number],", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzQ4NzE5NA=="}, "originalCommit": {"oid": "28f31a8b75bf25ed98f1279c325586b51b1dcdc8"}, "originalPosition": 9}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3428, "cost": 1, "resetAt": "2021-11-12T13:16:51Z"}}}