{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc1NDc2NTA0", "number": 52373, "title": "Filter empty lines from \"docker ls\" response (#52081)", "bodyText": "Filter empty lines from docker ls response\n\nIn order to cut down on test time, our docker/vagrant tests build the\ndocker image outside of the vagrant VM. When we get around to launching\nthe Vagrant VM, we mount that already-built docker image to a known\nlocation. At that point, we need to load the docker image. But we only\nwant to load it once. As we're running tests, we use \"docker ls\" to\ncheck whether the local image is loaded for use. Empty output from the\nparticular ls invocation means no image is loaded.\nThere was a bug in how we checked this. In Java, splitting an empty\nstring will yield an array containing one empty string. So when we're\ncounting the output from the docker ls command, we need to filter out\nempty lines in order to proceed to loading the image for docker tests.\n\n\nHave you signed the contributor license agreement?\nHave you followed the contributor guidelines?\nIf submitting code, have you built your formula locally prior to submission with gradle check?\nIf submitting code, is your pull request against master? Unless there is a good reason otherwise, we prefer pull requests against master and will backport as needed.\nIf submitting code, have you checked that your submission is for an OS and architecture that we support?\nIf you are submitting this code for a class then read our policy for that.", "createdAt": "2020-02-14T16:42:10Z", "url": "https://github.com/elastic/elasticsearch/pull/52373", "merged": true, "mergeCommit": {"oid": "317d1469eb1f4c84bfa1c44350f64ecbbdedb4d4"}, "closed": true, "closedAt": "2020-02-14T19:39:25Z", "author": {"login": "williamrandolph"}, "timelineItems": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcESSdbAH2gAyMzc1NDc2NTA0OmNkMDY0YzUwMzUwYTkzNTM4ZDE2ZTU3Y2U2MmQzMDljOGZkYTAyYTc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcETdaTAFqTM1OTEyMDc1NQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "cd064c50350a93538d16e57ce62d309c8fda02a7", "author": {"user": {"login": "williamrandolph", "name": "William Brafford"}}, "url": "https://github.com/elastic/elasticsearch/commit/cd064c50350a93538d16e57ce62d309c8fda02a7", "committedDate": "2020-02-14T16:40:14Z", "message": "Filter empty lines from \"docker ls\" response (#52081)\n\n* Filter empty lines from docker ls response\r\n\r\nIn order to cut down on test time, our docker/vagrant tests build the\r\ndocker image outside of the vagrant VM. When we get around to launching\r\nthe Vagrant VM, we mount that already-built docker image to a known\r\nlocation. At that point, we need to load the docker image. But we only\r\nwant to load it once. As we're running tests, we use \"docker ls\" to\r\ncheck whether the local image is loaded for use. Empty output from the\r\nparticular ls invocation means no image is loaded.\r\n\r\nThere was a bug in how we checked this. In Java, splitting an empty\r\nstring will yield an array containing one empty string. So when we're\r\ncounting the output from the docker ls command, we need to filter out\r\nempty lines in order to proceed to loading the image for docker tests."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU5MTIwNzU1", "url": "https://github.com/elastic/elasticsearch/pull/52373#pullrequestreview-359120755", "createdAt": "2020-02-14T18:01:56Z", "commit": {"oid": "cd064c50350a93538d16e57ce62d309c8fda02a7"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xNFQxODowMTo1NlrOFp_Byw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xNFQxODowMTo1NlrOFp_Byw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTU2ODU4Nw==", "bodyText": "nit: This can be simplified as .filter(not(String::isEmpty))", "url": "https://github.com/elastic/elasticsearch/pull/52373#discussion_r379568587", "createdAt": "2020-02-14T18:01:56Z", "author": {"login": "rjernst"}, "path": "qa/os/src/test/java/org/elasticsearch/packaging/util/Docker.java", "diffHunk": "@@ -74,7 +75,12 @@\n      * @param distribution details about the docker image to potentially load.\n      */\n     public static void ensureImageIsLoaded(Distribution distribution) {\n-        final long count = sh.run(\"docker image ls --format '{{.Repository}}' \" + distribution.flavor.name).stdout.split(\"\\n\").length;\n+        Shell.Result result = sh.run(\"docker image ls --format '{{.Repository}}' \" + distribution.flavor.name);\n+\n+        final long count = Arrays.stream(result.stdout.split(\"\\n\"))\n+            .map(String::trim)\n+            .filter(s -> s.isEmpty() == false)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cd064c50350a93538d16e57ce62d309c8fda02a7"}, "originalPosition": 17}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2499, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}