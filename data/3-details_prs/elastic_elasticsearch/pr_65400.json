{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTI2MDY3MTQ2", "number": 65400, "title": "Add option to preserve data in test clusters", "bodyText": "This is a follow up to #64931. For some testing scenarios that require expensive setup, it can be convenient to be able to preserve the test cluster data directory between executions. In this pull request we enable this for the EQL correctness tests when passing -Deql.test.preserve.data=true as well as for ./gradlew run --preserve-data.", "createdAt": "2020-11-23T23:58:55Z", "url": "https://github.com/elastic/elasticsearch/pull/65400", "merged": true, "mergeCommit": {"oid": "1ce323e1368cf5231181f1efaba1c4e425066e37"}, "closed": true, "closedAt": "2020-11-24T19:24:27Z", "author": {"login": "mark-vieira"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdfeKYrgH2gAyNTI2MDY3MTQ2OjFhNGE2Nzc3ZGU0YTk1OWU2NTM4ZTdkYjlkZWY2NjQ4YzczYzE5Njc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdfuga-AFqTUzNzgxNzQxNw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "1a4a6777de4a959e6538e7db9def6648c73c1967", "author": {"user": {"login": "mark-vieira", "name": "Mark Vieira"}}, "url": "https://github.com/elastic/elasticsearch/commit/1a4a6777de4a959e6538e7db9def6648c73c1967", "committedDate": "2020-11-23T23:57:23Z", "message": "Add option to preserve data in test clusters"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e83c9189fcf6e3e00ef79468fd47791153266768", "author": {"user": {"login": "mark-vieira", "name": "Mark Vieira"}}, "url": "https://github.com/elastic/elasticsearch/commit/e83c9189fcf6e3e00ef79468fd47791153266768", "committedDate": "2020-11-24T00:14:19Z", "message": "Checkstyle fixes"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM3MzYxNDQ4", "url": "https://github.com/elastic/elasticsearch/pull/65400#pullrequestreview-537361448", "createdAt": "2020-11-24T10:40:48Z", "commit": {"oid": "e83c9189fcf6e3e00ef79468fd47791153266768"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNFQxMDo0MDo0OVrOH46FwA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNFQxMDo0MDo0OVrOH46FwA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTQzNDA0OA==", "bodyText": "Why do we need the special eql variable and not use --preserve-data ?", "url": "https://github.com/elastic/elasticsearch/pull/65400#discussion_r529434048", "createdAt": "2020-11-24T10:40:49Z", "author": {"login": "matriv"}, "path": "x-pack/plugin/eql/qa/correctness/README.md", "diffHunk": "@@ -85,3 +85,10 @@ Once the data is loaded, a specific query can be run against the running ES node\n ```\n \n **Set the `eql_test_credentials_file` environmental variable correctly in the shell before running the command above,**\n+\n+#### Preserve data across node restarts\n+If you'd like to preserve the restored index and avoid the network download and delay of restoring them on every run of the node,\n+you can set the `eql.test.preserve.data` system property, e.g.:\n+```shell script\n+./gradlew :x-pack:plugin:eql:qa:correctness:javaRestTest -Deql.test.preserve.data=true", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e83c9189fcf6e3e00ef79468fd47791153266768"}, "originalPosition": 50}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM3NzAxNjI5", "url": "https://github.com/elastic/elasticsearch/pull/65400#pullrequestreview-537701629", "createdAt": "2020-11-24T16:38:00Z", "commit": {"oid": "e83c9189fcf6e3e00ef79468fd47791153266768"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNFQxNjozODowMFrOH5LZOA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNFQxNjozODowMFrOH5LZOA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTcxNzU2MA==", "bodyText": "Can we use provider.systemProperty(...) here to slowly move towards gradle configuration cache compliant builds? System.getProperty isn't", "url": "https://github.com/elastic/elasticsearch/pull/65400#discussion_r529717560", "createdAt": "2020-11-24T16:38:00Z", "author": {"login": "breskeby"}, "path": "x-pack/plugin/eql/qa/correctness/build.gradle", "diffHunk": "@@ -28,6 +28,9 @@ testClusters {\n     if (serviceAccountFile) {\n       keystore 'gcs.client.eql_test.credentials_file', serviceAccountFile\n     }\n+    if (Boolean.parseBoolean(System.getProperty('eql.test.preserve.data', 'false'))) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e83c9189fcf6e3e00ef79468fd47791153266768"}, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "07b0ff3081b1a3652180ee3147f8146c9477c7e0", "author": {"user": {"login": "mark-vieira", "name": "Mark Vieira"}}, "url": "https://github.com/elastic/elasticsearch/commit/07b0ff3081b1a3652180ee3147f8146c9477c7e0", "committedDate": "2020-11-24T18:00:59Z", "message": "Use providers for configuration time system property access"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2c72d0791a22d7d172936465a8bb6d1b290eef67", "author": {"user": {"login": "elasticmachine", "name": "Elastic Machine"}}, "url": "https://github.com/elastic/elasticsearch/commit/2c72d0791a22d7d172936465a8bb6d1b290eef67", "committedDate": "2020-11-24T18:19:43Z", "message": "Merge branch 'master' into preserve-test-cluster-data"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM3ODE3NDE3", "url": "https://github.com/elastic/elasticsearch/pull/65400#pullrequestreview-537817417", "createdAt": "2020-11-24T18:59:30Z", "commit": {"oid": "2c72d0791a22d7d172936465a8bb6d1b290eef67"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNFQxODo1OTozMFrOH5Q_7g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNFQxODo1OTozMFrOH5Q_7g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTgwOTM5MA==", "bodyText": "I think it's better to move this paragraph before ### Run an ES node manually and run the tests against it\nand add a new paragraph here at the end to mention the --preserve-data for the ./gradlew :x-pack:plugin:eql:qa:correctness:runEqlCorrectnessNode:\n#### Preserve data across node restarts\nIf you'd like to preserve the restored index and avoid the network download and delay of restoring them on every run of the node, you can start the node with:\n\n```shell script\n./gradlew :x-pack:plugin:eql:qa:correctness:runEqlCorrectnessNode --debug-jvm --preserve-data\n```\n\nI could do it myself in a followup PR though.", "url": "https://github.com/elastic/elasticsearch/pull/65400#discussion_r529809390", "createdAt": "2020-11-24T18:59:30Z", "author": {"login": "matriv"}, "path": "x-pack/plugin/eql/qa/correctness/README.md", "diffHunk": "@@ -85,3 +85,10 @@ Once the data is loaded, a specific query can be run against the running ES node\n ```\n \n **Set the `eql_test_credentials_file` environmental variable correctly in the shell before running the command above,**\n+\n+#### Preserve data across node restarts\n+If you'd like to preserve the restored index and avoid the network download and delay of restoring them on every run of the node,\n+you can set the `eql.test.preserve.data` system property, e.g.:\n+```shell script\n+./gradlew :x-pack:plugin:eql:qa:correctness:javaRestTest -Deql.test.preserve.data=true", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTQzNDA0OA=="}, "originalCommit": {"oid": "e83c9189fcf6e3e00ef79468fd47791153266768"}, "originalPosition": 50}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4410, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}