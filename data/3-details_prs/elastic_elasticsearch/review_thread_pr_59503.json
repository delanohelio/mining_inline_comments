{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ4NzM0Mjgw", "number": 59503, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNFQxOTo0ODoxMlrOEOaBLw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNFQxOTo0ODoxMlrOEOaBLw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgzNTQxODA3OnYy", "diffSide": "RIGHT", "path": "server/src/main/java/org/elasticsearch/cluster/metadata/MetadataCreateDataStreamService.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNFQxOTo0ODoxMlrOGxiwGw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNVQxNjowODoyNFrOGyFHTQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDYwMjc3OQ==", "bodyText": "For me, it'd be nice to just remove this whole method validateTimestampMapping. It's a little fragile to be checking the raw JSON. And I'm not sure it adds much more confidence (users should really not be messing around with the internal _data_stream_timestamp field). I don't feel strongly about this though.", "url": "https://github.com/elastic/elasticsearch/pull/59503#discussion_r454602779", "createdAt": "2020-07-14T19:48:12Z", "author": {"login": "jtibshirani"}, "path": "server/src/main/java/org/elasticsearch/cluster/metadata/MetadataCreateDataStreamService.java", "diffHunk": "@@ -179,10 +179,11 @@ public static void validateTimestampFieldMapping(String timestampFieldName, Mapp\n \n         Map<String, Object> parsedTemplateMapping =\n             MapperService.parseMapping(NamedXContentRegistry.EMPTY, mapperService.documentMapper().mappingSource().string());\n-        String configuredPath = ObjectPath.eval(\"_doc._data_stream_timestamp.path\", parsedTemplateMapping);\n-        if (timestampFieldName.equals(configuredPath) == false) {\n-            throw new IllegalArgumentException(\"[_data_stream_timestamp] meta field doesn't point to data stream timestamp field [\" +\n-                timestampFieldName + \"]\");\n+        Boolean enabled = ObjectPath.eval(\"_doc._data_stream_timestamp.enabled\", parsedTemplateMapping);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8cf909ffd072762f2c20d285571bc5045d39a0c0"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTA3NzI0NQ==", "bodyText": "I don't think it is too fragile. If for some reason the json format changes then tests fail and this method needs to be adjusted.\nI still prefer to keep this method for in the case for some unknown reason the _data_stream_timestamp field mapping doesn't get applied. There is no mechanism in place that yells when this meta field mapper isn't applied when creating a backing index of data stream.", "url": "https://github.com/elastic/elasticsearch/pull/59503#discussion_r455077245", "createdAt": "2020-07-15T14:04:25Z", "author": {"login": "martijnvg"}, "path": "server/src/main/java/org/elasticsearch/cluster/metadata/MetadataCreateDataStreamService.java", "diffHunk": "@@ -179,10 +179,11 @@ public static void validateTimestampFieldMapping(String timestampFieldName, Mapp\n \n         Map<String, Object> parsedTemplateMapping =\n             MapperService.parseMapping(NamedXContentRegistry.EMPTY, mapperService.documentMapper().mappingSource().string());\n-        String configuredPath = ObjectPath.eval(\"_doc._data_stream_timestamp.path\", parsedTemplateMapping);\n-        if (timestampFieldName.equals(configuredPath) == false) {\n-            throw new IllegalArgumentException(\"[_data_stream_timestamp] meta field doesn't point to data stream timestamp field [\" +\n-                timestampFieldName + \"]\");\n+        Boolean enabled = ObjectPath.eval(\"_doc._data_stream_timestamp.enabled\", parsedTemplateMapping);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDYwMjc3OQ=="}, "originalCommit": {"oid": "8cf909ffd072762f2c20d285571bc5045d39a0c0"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTE2NTc3Mw==", "bodyText": "This works for me. I approved the PR earlier and feel it's ready to merge.", "url": "https://github.com/elastic/elasticsearch/pull/59503#discussion_r455165773", "createdAt": "2020-07-15T16:08:24Z", "author": {"login": "jtibshirani"}, "path": "server/src/main/java/org/elasticsearch/cluster/metadata/MetadataCreateDataStreamService.java", "diffHunk": "@@ -179,10 +179,11 @@ public static void validateTimestampFieldMapping(String timestampFieldName, Mapp\n \n         Map<String, Object> parsedTemplateMapping =\n             MapperService.parseMapping(NamedXContentRegistry.EMPTY, mapperService.documentMapper().mappingSource().string());\n-        String configuredPath = ObjectPath.eval(\"_doc._data_stream_timestamp.path\", parsedTemplateMapping);\n-        if (timestampFieldName.equals(configuredPath) == false) {\n-            throw new IllegalArgumentException(\"[_data_stream_timestamp] meta field doesn't point to data stream timestamp field [\" +\n-                timestampFieldName + \"]\");\n+        Boolean enabled = ObjectPath.eval(\"_doc._data_stream_timestamp.enabled\", parsedTemplateMapping);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDYwMjc3OQ=="}, "originalCommit": {"oid": "8cf909ffd072762f2c20d285571bc5045d39a0c0"}, "originalPosition": 8}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2382, "cost": 1, "resetAt": "2021-11-12T11:57:46Z"}}}