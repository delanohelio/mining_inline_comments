{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE5NzY1MTgx", "number": 56926, "title": "Add individual precommit task plugins", "bodyText": "Each precommit task is currently registered inside the shared\nPrecommitTasks class. Having a single class with all precommit tasks\nmakes individualizing which precommit tasks are needed based on type of\nproject difficult, where we often just disable somet tasks eg for all qa\nprojects. This commit creates plugins for each precommit task, and moves\nthe configuration of the task into each plugin. PrecommitTasks remains\nfor now, and just delegates to each plugin, but will be removed in a\nfuture change.", "createdAt": "2020-05-18T22:04:50Z", "url": "https://github.com/elastic/elasticsearch/pull/56926", "merged": true, "mergeCommit": {"oid": "c98d548944ae8b20c2895e72c9351015faa929d4"}, "closed": true, "closedAt": "2020-05-20T20:12:08Z", "author": {"login": "rjernst"}, "timelineItems": {"totalCount": 20, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcinOsJgH2gAyNDE5NzY1MTgxOjlhZWNhODc4YTNjODMwMjYxN2YwMjE1YTk1MGZlZjQ1ZTllMTIwMDM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcjNbBpgH2gAyNDE5NzY1MTgxOjZkMTExMDcxNTA3M2ViYjVhOGUyMDc2MTdjNTEyZTE1YjRiMmFjMzQ=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "9aeca878a3c8302617f0215a950fef45e9e12003", "author": {"user": {"login": "rjernst", "name": "Ryan Ernst"}}, "url": "https://github.com/elastic/elasticsearch/commit/9aeca878a3c8302617f0215a950fef45e9e12003", "committedDate": "2020-05-18T22:01:51Z", "message": "Add individual precommit task plugins\n\nEach precommit task is currently registered inside the shared\nPrecommitTasks class. Having a single class with all precommit tasks\nmakes individualizing which precommit tasks are needed based on type of\nproject difficult, where we often just disable somet tasks eg for all qa\nprojects. This commit creates plugins for each precommit task, and moves\nthe configuration of the task into each plugin. PrecommitTasks remains\nfor now, and just delegates to each plugin, but will be removed in a\nfuture change."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1b4afbfcddcc2dc44c974e07a7ca28a4a7cdef09", "author": {"user": {"login": "rjernst", "name": "Ryan Ernst"}}, "url": "https://github.com/elastic/elasticsearch/commit/1b4afbfcddcc2dc44c974e07a7ca28a4a7cdef09", "committedDate": "2020-05-18T22:30:52Z", "message": "iter"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE0MzE0MTQ5", "url": "https://github.com/elastic/elasticsearch/pull/56926#pullrequestreview-414314149", "createdAt": "2020-05-19T10:32:35Z", "commit": {"oid": "9aeca878a3c8302617f0215a950fef45e9e12003"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOVQxMDozMjozNVrOGXaKlw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOVQxMDozMjozNVrOGXaKlw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzE5OTEyNw==", "bodyText": "I think it would be better to not extend this Plugin in other PrecommitPlugins but use composition here. So we would have a PreCommit plugin that is applied by all other specific PreCommitPlugins (e.g. the CheckstylePreCommitPlugin). The PreCommitPlugin would only create a 'precommit' task that depends on all tasks of a certain marker type like tasks.withType(PreCommitTask.class). The other specific precommit plugins would only need to ensure that the tasks they create are of type PreCommitTask which can be just common interface.\nAlso this maybeRegister method is relative expensive.", "url": "https://github.com/elastic/elasticsearch/pull/56926#discussion_r427199127", "createdAt": "2020-05-19T10:32:35Z", "author": {"login": "breskeby"}, "path": "buildSrc/src/main/java/org/elasticsearch/gradle/precommit/PrecommitPlugin.java", "diffHunk": "@@ -0,0 +1,59 @@\n+/*\n+ * Licensed to Elasticsearch under one or more contributor\n+ * license agreements. See the NOTICE file distributed with\n+ * this work for additional information regarding copyright\n+ * ownership. Elasticsearch licenses this file to you under\n+ * the Apache License, Version 2.0 (the \"License\"); you may\n+ * not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.elasticsearch.gradle.precommit;\n+\n+import org.elasticsearch.gradle.util.GradleUtils;\n+import org.gradle.api.DefaultTask;\n+import org.gradle.api.Plugin;\n+import org.gradle.api.Project;\n+import org.gradle.api.Task;\n+import org.gradle.api.artifacts.Dependency;\n+import org.gradle.api.plugins.JavaBasePlugin;\n+import org.gradle.api.plugins.JavaPlugin;\n+import org.gradle.api.tasks.SourceSet;\n+import org.gradle.api.tasks.TaskProvider;\n+import org.gradle.language.base.plugins.LifecycleBasePlugin;\n+\n+/**\n+ * Base plugin for adding a precommit task.\n+ */\n+public abstract class PrecommitPlugin implements Plugin<Project> {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9aeca878a3c8302617f0215a950fef45e9e12003"}, "originalPosition": 37}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE0NDkwODk3", "url": "https://github.com/elastic/elasticsearch/pull/56926#pullrequestreview-414490897", "createdAt": "2020-05-19T14:16:52Z", "commit": {"oid": "9aeca878a3c8302617f0215a950fef45e9e12003"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOVQxNDoxNjo1MlrOGXikXg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOVQxNDoxNjo1MlrOGXikXg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzMzNjc5OA==", "bodyText": "In my opinion we should extract that into a JavaPreCommit plugin. this also ensure this code is not executed more than once per project.", "url": "https://github.com/elastic/elasticsearch/pull/56926#discussion_r427336798", "createdAt": "2020-05-19T14:16:52Z", "author": {"login": "breskeby"}, "path": "buildSrc/src/main/java/org/elasticsearch/gradle/precommit/PrecommitPlugin.java", "diffHunk": "@@ -0,0 +1,59 @@\n+/*\n+ * Licensed to Elasticsearch under one or more contributor\n+ * license agreements. See the NOTICE file distributed with\n+ * this work for additional information regarding copyright\n+ * ownership. Elasticsearch licenses this file to you under\n+ * the Apache License, Version 2.0 (the \"License\"); you may\n+ * not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.elasticsearch.gradle.precommit;\n+\n+import org.elasticsearch.gradle.util.GradleUtils;\n+import org.gradle.api.DefaultTask;\n+import org.gradle.api.Plugin;\n+import org.gradle.api.Project;\n+import org.gradle.api.Task;\n+import org.gradle.api.artifacts.Dependency;\n+import org.gradle.api.plugins.JavaBasePlugin;\n+import org.gradle.api.plugins.JavaPlugin;\n+import org.gradle.api.tasks.SourceSet;\n+import org.gradle.api.tasks.TaskProvider;\n+import org.gradle.language.base.plugins.LifecycleBasePlugin;\n+\n+/**\n+ * Base plugin for adding a precommit task.\n+ */\n+public abstract class PrecommitPlugin implements Plugin<Project> {\n+    @Override\n+    public final void apply(Project project) {\n+        TaskProvider<? extends Task> task = createTask(project);\n+        TaskProvider<DefaultTask> precommit = GradleUtils.maybeRegister(project.getTasks(), \"precommit\", DefaultTask.class, t -> {\n+            t.setGroup(JavaBasePlugin.VERIFICATION_GROUP);\n+            t.setDescription(\"Runs all non-test checks\");\n+        });\n+        precommit.configure(t -> t.dependsOn(task));\n+\n+        project.getPluginManager().withPlugin(\"java\", p -> {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9aeca878a3c8302617f0215a950fef45e9e12003"}, "originalPosition": 47}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "097877dae034ac42b9d431dcb4426cd9c4a5c646", "author": {"user": {"login": "rjernst", "name": "Ryan Ernst"}}, "url": "https://github.com/elastic/elasticsearch/commit/097877dae034ac42b9d431dcb4426cd9c4a5c646", "committedDate": "2020-05-19T14:47:11Z", "message": "use actual Closure"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "778d71a5b0076e9ed90a642c301670b43515b098", "author": {"user": {"login": "rjernst", "name": "Ryan Ernst"}}, "url": "https://github.com/elastic/elasticsearch/commit/778d71a5b0076e9ed90a642c301670b43515b098", "committedDate": "2020-05-19T14:47:40Z", "message": "Merge branch 'master' into buildsplit7"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b5dff5714484b9779d506e0e70a0f4826750da42", "author": {"user": {"login": "rjernst", "name": "Ryan Ernst"}}, "url": "https://github.com/elastic/elasticsearch/commit/b5dff5714484b9779d506e0e70a0f4826750da42", "committedDate": "2020-05-19T15:25:36Z", "message": "only create precommit once"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ff9c4625c4f264fa4e8950b57d98ee7e2dcbdade", "author": {"user": {"login": "rjernst", "name": "Ryan Ernst"}}, "url": "https://github.com/elastic/elasticsearch/commit/ff9c4625c4f264fa4e8950b57d98ee7e2dcbdade", "committedDate": "2020-05-19T15:30:58Z", "message": "split java specific to not be repeated"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE0NTg3Njcw", "url": "https://github.com/elastic/elasticsearch/pull/56926#pullrequestreview-414587670", "createdAt": "2020-05-19T15:51:13Z", "commit": {"oid": "ff9c4625c4f264fa4e8950b57d98ee7e2dcbdade"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cd68d7361795f8cf7416b5e3aabac0f266a3fed1", "author": {"user": {"login": "rjernst", "name": "Ryan Ernst"}}, "url": "https://github.com/elastic/elasticsearch/commit/cd68d7361795f8cf7416b5e3aabac0f266a3fed1", "committedDate": "2020-05-19T16:08:42Z", "message": "fix eql licenses"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "89c170dd99b48ed64418d05c3b9034b72347c409", "author": {"user": {"login": "rjernst", "name": "Ryan Ernst"}}, "url": "https://github.com/elastic/elasticsearch/commit/89c170dd99b48ed64418d05c3b9034b72347c409", "committedDate": "2020-05-19T16:26:24Z", "message": "package protected internal plugin"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "aa5fb8a9d700ec6b04632a19cb6e49320ddbaf38", "author": {"user": {"login": "rjernst", "name": "Ryan Ernst"}}, "url": "https://github.com/elastic/elasticsearch/commit/aa5fb8a9d700ec6b04632a19cb6e49320ddbaf38", "committedDate": "2020-05-19T16:27:46Z", "message": "remove debug"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "68c93e93227dcec844685c18db73a1fcfd6dc80c", "author": {"user": {"login": "rjernst", "name": "Ryan Ernst"}}, "url": "https://github.com/elastic/elasticsearch/commit/68c93e93227dcec844685c18db73a1fcfd6dc80c", "committedDate": "2020-05-19T16:28:02Z", "message": "actually add license files"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8cc4c284aa9e0e4ea5788e4556b86ece28c6a26c", "author": {"user": {"login": "rjernst", "name": "Ryan Ernst"}}, "url": "https://github.com/elastic/elasticsearch/commit/8cc4c284aa9e0e4ea5788e4556b86ece28c6a26c", "committedDate": "2020-05-19T16:36:19Z", "message": "overwrite existing checkstyle config"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e825db5e8c487f5a55d7d611f0c719b88a902e12", "author": {"user": {"login": "rjernst", "name": "Ryan Ernst"}}, "url": "https://github.com/elastic/elasticsearch/commit/e825db5e8c487f5a55d7d611f0c719b88a902e12", "committedDate": "2020-05-20T02:43:33Z", "message": "Merge branch 'master' into buildsplit7"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "32ef97117c2b79f0f03ffb59eabfe77eaa478a99", "author": {"user": {"login": "rjernst", "name": "Ryan Ernst"}}, "url": "https://github.com/elastic/elasticsearch/commit/32ef97117c2b79f0f03ffb59eabfe77eaa478a99", "committedDate": "2020-05-20T02:50:58Z", "message": "spotless"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "661d52785abfe33b7cd5296e2d0984d58a250377", "author": {"user": {"login": "rjernst", "name": "Ryan Ernst"}}, "url": "https://github.com/elastic/elasticsearch/commit/661d52785abfe33b7cd5296e2d0984d58a250377", "committedDate": "2020-05-20T16:17:48Z", "message": "add back substractions of compileOnly"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a59ee84673c32e85236d6377a6b86562cb426492", "author": {"user": {"login": "rjernst", "name": "Ryan Ernst"}}, "url": "https://github.com/elastic/elasticsearch/commit/a59ee84673c32e85236d6377a6b86562cb426492", "committedDate": "2020-05-20T18:25:16Z", "message": "revert eql change"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f7919c8ef4aff283c8b87a7f1e455b514c358cff", "author": {"user": {"login": "rjernst", "name": "Ryan Ernst"}}, "url": "https://github.com/elastic/elasticsearch/commit/f7919c8ef4aff283c8b87a7f1e455b514c358cff", "committedDate": "2020-05-20T18:30:14Z", "message": "remove licenses dir"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6d1110715073ebb5a8e207617c512e15b4b2ac34", "author": {"user": {"login": "rjernst", "name": "Ryan Ernst"}}, "url": "https://github.com/elastic/elasticsearch/commit/6d1110715073ebb5a8e207617c512e15b4b2ac34", "committedDate": "2020-05-20T18:31:43Z", "message": "Merge branch 'master' into buildsplit7"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4886, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}