{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTAxNTc1NjUz", "number": 63555, "title": "Match query to respect lenient flag", "bodyText": "A recent change (#63406) introduced throwing exception when a match query is executed against a field that does not support text search. The query would fail anyways, only at a later stage. The problem though is that the lenient flag needs to be taken into account.", "createdAt": "2020-10-12T13:23:52Z", "url": "https://github.com/elastic/elasticsearch/pull/63555", "merged": true, "mergeCommit": {"oid": "1e949ca10d45adeec480ff9d2dbe856f612d04d4"}, "closed": true, "closedAt": "2020-10-12T18:52:13Z", "author": {"login": "javanna"}, "timelineItems": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdRz3DFAH2gAyNTAxNTc1NjUzOjgwMmZjNmI1MjYzYzJhNjg4MGNkMDJjNGRjYzNlZGVmNzM3YWQwMGI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdR0iw7gH2gAyNTAxNTc1NjUzOmUxZmRiODdlNTVkNTI1NzRlOTRlYTNjODUwNzMwNzhmMTQzMjFhNTY=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "802fc6b5263c2a6880cd02c4dcc3edef737ad00b", "author": {"user": {"login": "javanna", "name": "Luca Cavanna"}}, "url": "https://github.com/elastic/elasticsearch/commit/802fc6b5263c2a6880cd02c4dcc3edef737ad00b", "committedDate": "2020-10-12T13:19:14Z", "message": "Match query to respect lenient flag\n\nA recent change introduced throwing exception when a match query is executed against a field that does not support text search. The query would fail anyways, only at a later stage. The problem though is that the lenient flag needs to be taken into account."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA2NjE2OTcy", "url": "https://github.com/elastic/elasticsearch/pull/63555#pullrequestreview-506616972", "createdAt": "2020-10-12T13:25:43Z", "commit": {"oid": "802fc6b5263c2a6880cd02c4dcc3edef737ad00b"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xMlQxMzoyNTo0M1rOHf-p6g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xMlQxMzoyNjoxMVrOHf-q8w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzI5NDQ0Mg==", "bodyText": "Maybe assert that this != TextSearchInfo.NONE?", "url": "https://github.com/elastic/elasticsearch/pull/63555#discussion_r503294442", "createdAt": "2020-10-12T13:25:43Z", "author": {"login": "romseygeek"}, "path": "server/src/main/java/org/elasticsearch/index/search/MatchQuery.java", "diffHunk": "@@ -297,13 +307,7 @@ protected final Query parseInternal(Type type, String fieldName, MatchQueryBuild\n     }\n \n     protected Analyzer getAnalyzer(MappedFieldType fieldType, boolean quoted) {\n-        // We check here that the field supports text searches and therefore has an analyzer -\n-        // if it doesn't, we can bail out early without doing any further parsing.\n         TextSearchInfo tsi = fieldType.getTextSearchInfo();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "802fc6b5263c2a6880cd02c4dcc3edef737ad00b"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzI5NDcwNw==", "bodyText": "check that this is a MatchNoDocsQuery?", "url": "https://github.com/elastic/elasticsearch/pull/63555#discussion_r503294707", "createdAt": "2020-10-12T13:26:11Z", "author": {"login": "romseygeek"}, "path": "server/src/test/java/org/elasticsearch/index/query/MatchQueryBuilderTests.java", "diffHunk": "@@ -297,7 +297,16 @@ public void testExactOnUnsupportedField() throws Exception {\n         query.toQuery(context); // no exception\n     }\n \n-    public void testParseFailsWithMultipleFields() throws IOException {\n+    public void testLenientFlag() throws Exception {\n+        MatchQueryBuilder query = new MatchQueryBuilder(BINARY_FIELD_NAME, \"test\");\n+        QueryShardContext context = createShardContext();\n+        IllegalArgumentException e = expectThrows(IllegalArgumentException.class, () -> query.toQuery(context));\n+        assertEquals(\"Field [mapped_binary] of type [binary does not support match queries\", e.getMessage());\n+        query.lenient(true);\n+        query.toQuery(context); // no exception", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "802fc6b5263c2a6880cd02c4dcc3edef737ad00b"}, "originalPosition": 11}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e1fdb87e55d52574e94ea3c85073078f14321a56", "author": {"user": {"login": "javanna", "name": "Luca Cavanna"}}, "url": "https://github.com/elastic/elasticsearch/commit/e1fdb87e55d52574e94ea3c85073078f14321a56", "committedDate": "2020-10-12T14:06:59Z", "message": "iter and more tests"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4052, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}