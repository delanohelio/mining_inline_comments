{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM5NDIzMTQ5", "number": 58514, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNFQxOTozNDoxOVrOEIgDzw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNFQxOTozNDoxOVrOEIgDzw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc3MzQ5MzI3OnYy", "diffSide": "RIGHT", "path": "server/src/main/java/org/elasticsearch/cluster/metadata/MetadataCreateIndexService.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNFQxOTozNDoxOVrOGogPqw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNFQxOTozNDoxOVrOGogPqw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTEyNDUyMw==", "bodyText": "This new logic looks quite different. The existing logic didn't actually make sense to me:\n\nWe call these 'source metadata mappings', when these are actually target mappings.\nHere we make sure to swap out the type name for the singleton type _doc. But then in validateResize we throw an error if we encounter any mapping besides _default_. So we necessarily throw an error if the mappings are not empty.", "url": "https://github.com/elastic/elasticsearch/pull/58514#discussion_r445124523", "createdAt": "2020-06-24T19:34:19Z", "author": {"login": "jtibshirani"}, "path": "server/src/main/java/org/elasticsearch/cluster/metadata/MetadataCreateIndexService.java", "diffHunk": "@@ -549,22 +549,17 @@ private ClusterState applyCreateIndexRequestWithExistingMetadata(final ClusterSt\n                                                                                             throws Exception {\n         logger.info(\"applying create index request using existing index [{}] metadata\", sourceMetadata.getIndex().getName());\n \n-        final Map<String, Map<String, Object>> mappings;\n-        if (request.mappings().size() == 0) {\n-            mappings = Collections.emptyMap();\n-        } else {\n-            assert request.mappings().size() == 1 : \"expected source metadata mappings to have 1 type but it had: \" + request.mappings();\n-            String sourceMappings = request.mappings().values().iterator().next();\n-            mappings = Collections.singletonMap(MapperService.SINGLE_MAPPING_NAME,\n-                Collections.unmodifiableMap(MapperService.parseMapping(xContentRegistry, sourceMappings)));\n+        if (request.mappings().size() > 0) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "330522ac27bdd73c237d64b79ddf8f787dd093ef"}, "originalPosition": 30}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1423, "cost": 1, "resetAt": "2021-11-12T11:57:46Z"}}}