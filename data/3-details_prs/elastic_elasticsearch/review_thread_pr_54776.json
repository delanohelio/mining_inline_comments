{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk5MjQ0ODAx", "number": 54776, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wNlQwOToyNjoxMVrODvCuMg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wNlQxNDo1OTowNlrODvK09w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUwNjU0MjU4OnYy", "diffSide": "RIGHT", "path": "qa/multi-cluster-search/src/test/resources/rest-api-spec/test/multi_cluster/10_basic.yml", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wNlQwOToyNjoxMVrOGBPI5A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wNlQxNToyODoyMVrOGBdUfA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzk0OTc5Ng==", "bodyText": "let's use the new format for total hits ?", "url": "https://github.com/elastic/elasticsearch/pull/54776#discussion_r403949796", "createdAt": "2020-04-06T09:26:11Z", "author": {"login": "jimczi"}, "path": "qa/multi-cluster-search/src/test/resources/rest-api-spec/test/multi_cluster/10_basic.yml", "diffHunk": "@@ -196,6 +196,45 @@\n   - match: { aggregations.cluster.buckets.1.animal.buckets.1.s.value: 0 }\n   - match: { aggregations.cluster.buckets.1.average_sum.value: 1 }\n \n+  # scripted_metric\n+  - do:\n+      search:\n+        rest_total_hits_as_int: true", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "99ebd13e4b42f7977ff19b9568566b30d019dc6b"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDE4MjE0MA==", "bodyText": "Sure! I figured I'd be backporting it and that I'd just uses what is with the rest of the file. But you are right, I really should use the new one.", "url": "https://github.com/elastic/elasticsearch/pull/54776#discussion_r404182140", "createdAt": "2020-04-06T15:28:21Z", "author": {"login": "nik9000"}, "path": "qa/multi-cluster-search/src/test/resources/rest-api-spec/test/multi_cluster/10_basic.yml", "diffHunk": "@@ -196,6 +196,45 @@\n   - match: { aggregations.cluster.buckets.1.animal.buckets.1.s.value: 0 }\n   - match: { aggregations.cluster.buckets.1.average_sum.value: 1 }\n \n+  # scripted_metric\n+  - do:\n+      search:\n+        rest_total_hits_as_int: true", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzk0OTc5Ng=="}, "originalCommit": {"oid": "99ebd13e4b42f7977ff19b9568566b30d019dc6b"}, "originalPosition": 7}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUwNzg2NTAwOnYy", "diffSide": "RIGHT", "path": "test/framework/src/main/java/org/elasticsearch/test/InternalAggregationTestCase.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wNlQxNDo1ODowN1rOGBb57Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wNlQxNDo1ODowN1rOGBb57Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDE1ODk1Nw==", "bodyText": "nit: a partial reduce", "url": "https://github.com/elastic/elasticsearch/pull/54776#discussion_r404158957", "createdAt": "2020-04-06T14:58:07Z", "author": {"login": "jimczi"}, "path": "test/framework/src/main/java/org/elasticsearch/test/InternalAggregationTestCase.java", "diffHunk": "@@ -296,7 +296,7 @@ public void testReduceRandom() {\n         ScriptService mockScriptService = mockScriptService();\n         MockBigArrays bigArrays = new MockBigArrays(new MockPageCacheRecycler(Settings.EMPTY), new NoneCircuitBreakerService());\n         if (randomBoolean() && toReduce.size() > 1) {\n-            // sometimes do an incremental reduce\n+            // sometimes do an partial reduce", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "99ebd13e4b42f7977ff19b9568566b30d019dc6b"}, "originalPosition": 14}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUwNzg3MDYzOnYy", "diffSide": "RIGHT", "path": "test/framework/src/main/java/org/elasticsearch/test/InternalAggregationTestCase.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wNlQxNDo1OTowNlrOGBb9Qg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wNlQxNToyOTozM1rOGBdX5g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDE1OTgxMA==", "bodyText": "Should it simply say that we test the serialization of partially reduced result since you have another change that will make this possible in normal search ?", "url": "https://github.com/elastic/elasticsearch/pull/54776#discussion_r404159810", "createdAt": "2020-04-06T14:59:06Z", "author": {"login": "jimczi"}, "path": "test/framework/src/main/java/org/elasticsearch/test/InternalAggregationTestCase.java", "diffHunk": "@@ -312,6 +312,13 @@ public void testReduceRandom() {\n             //check that non final reduction never adds buckets\n             assertThat(reducedBucketCount, lessThanOrEqualTo(initialBucketCount));\n             toReduce = new ArrayList<>(toReduce.subList(r, toReduceSize));\n+            /*\n+             * sometimes simulate cross cluster search by serializing and\n+             * deserializing the partially reduced result.\n+             */", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "99ebd13e4b42f7977ff19b9568566b30d019dc6b"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDE4MzAxNA==", "bodyText": "Sure.", "url": "https://github.com/elastic/elasticsearch/pull/54776#discussion_r404183014", "createdAt": "2020-04-06T15:29:33Z", "author": {"login": "nik9000"}, "path": "test/framework/src/main/java/org/elasticsearch/test/InternalAggregationTestCase.java", "diffHunk": "@@ -312,6 +312,13 @@ public void testReduceRandom() {\n             //check that non final reduction never adds buckets\n             assertThat(reducedBucketCount, lessThanOrEqualTo(initialBucketCount));\n             toReduce = new ArrayList<>(toReduce.subList(r, toReduceSize));\n+            /*\n+             * sometimes simulate cross cluster search by serializing and\n+             * deserializing the partially reduced result.\n+             */", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDE1OTgxMA=="}, "originalCommit": {"oid": "99ebd13e4b42f7977ff19b9568566b30d019dc6b"}, "originalPosition": 25}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1356, "cost": 1, "resetAt": "2021-11-12T11:57:46Z"}}}