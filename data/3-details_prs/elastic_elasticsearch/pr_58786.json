{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQyMzAxMTEw", "number": 58786, "title": "Re-enable support for array-valued geo_shape fields.", "bodyText": "A regression in the mapping code led to geo_shape no longer supporting\narray-valued fields. This commit fixes this support and adds an integration\ntest to make sure this problem does not return!\nexample:\nPUT /example\n{\n    \"mappings\": {\n        \"properties\": {\n            \"location\": {\n                \"type\": \"geo_shape\"\n            }\n        }\n    }\n}\n\nPUT /example/_doc/1\n{\n    \"location\": [\n        {\n            \"type\": \"LineString\",\n            \"coordinates\": [[100.0, 1.0], [101.0, 0.0]]\n        },\n        {\n            \"type\": \"LineString\",\n            \"coordinates\": [[100.0, 1.0], [101.0, 0.0]]\n        }\n    ]\n}\n\noriginal user issue posting: https://discuss.elastic.co/t/elastic-search-7-8-0-and-multiple-geoshapes/239350", "createdAt": "2020-06-30T21:20:03Z", "url": "https://github.com/elastic/elasticsearch/pull/58786", "merged": true, "mergeCommit": {"oid": "52ff121fcfc9a9caed5d4f7404ac7621cf6218b9"}, "closed": true, "closedAt": "2020-07-02T16:39:43Z", "author": {"login": "talevy"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcwcWo5gH2gAyNDQyMzAxMTEwOmY5YTk3NmQwMWMzYjc0NGY4ODZjOTMzZTdjNDRlNWVkODM1MTUwYmY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcxAmW0AH2gAyNDQyMzAxMTEwOmNkZmRiNGYzY2UzNmNmYWQxMWQ5ZTEwZTY1ZWU2OWJkYjdhZDg5OTQ=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "f9a976d01c3b744f886c933e7c44e5ed835150bf", "author": {"user": {"login": "talevy", "name": "Tal Levy"}}, "url": "https://github.com/elastic/elasticsearch/commit/f9a976d01c3b744f886c933e7c44e5ed835150bf", "committedDate": "2020-06-30T21:16:31Z", "message": "Re-enable support for array-valued geo_shape fields.\n\nA regression in the mapping code led to geo_shape no longer supporting\narray-valued fields. This commit fixes this support and adds an integration\ntest to make sure this problem does not return!"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQwNDAzODQ0", "url": "https://github.com/elastic/elasticsearch/pull/58786#pullrequestreview-440403844", "createdAt": "2020-06-30T21:36:21Z", "commit": {"oid": "f9a976d01c3b744f886c933e7c44e5ed835150bf"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0zMFQyMTozNjoyMVrOGrPWWw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0zMFQyMTozODoyMlrOGrPZ1Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Nzk5MzQzNQ==", "bodyText": "This test could also instead live in GeoShapeFieldMapperTests, which is closer to a unit test suite. It seems common to test document parsing logic in *FieldMapperTests.", "url": "https://github.com/elastic/elasticsearch/pull/58786#discussion_r447993435", "createdAt": "2020-06-30T21:36:21Z", "author": {"login": "jtibshirani"}, "path": "server/src/internalClusterTest/java/org/elasticsearch/search/geo/GeoShapeIntegrationIT.java", "diffHunk": "@@ -136,6 +136,34 @@ public void testIgnoreMalformed() throws Exception {\n         assertThat(searchResponse.getHits().getTotalHits().value, equalTo(1L));\n     }\n \n+    /**\n+     * Test that geo_shape field can parse input as an array of values.\n+     */\n+    public void testArrayOfGeoShapeParsing() throws Exception {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f9a976d01c3b744f886c933e7c44e5ed835150bf"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Nzk5NDMyNQ==", "bodyText": "I think we need to remove this override and instead  have GeoPointFieldMapper and PointFieldMapper implement it and return true?", "url": "https://github.com/elastic/elasticsearch/pull/58786#discussion_r447994325", "createdAt": "2020-06-30T21:38:22Z", "author": {"login": "jtibshirani"}, "path": "server/src/main/java/org/elasticsearch/index/mapper/AbstractGeometryFieldMapper.java", "diffHunk": "@@ -285,7 +285,7 @@ protected void parseCreateField(ParseContext context) throws IOException {\n \n     @Override\n     public final boolean parsesArrayValue() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f9a976d01c3b744f886c933e7c44e5ed835150bf"}, "originalPosition": 3}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fbdc79e90e7d8a1c41d24d35cde27dd1920c101d", "author": {"user": {"login": "talevy", "name": "Tal Levy"}}, "url": "https://github.com/elastic/elasticsearch/commit/fbdc79e90e7d8a1c41d24d35cde27dd1920c101d", "committedDate": "2020-07-01T17:51:44Z", "message": "Merge remote-tracking branch 'elastic/master' into fixgeoshapearray"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9ea931afc11b1739816c71879cceb353201165ff", "author": {"user": {"login": "talevy", "name": "Tal Levy"}}, "url": "https://github.com/elastic/elasticsearch/commit/9ea931afc11b1739816c71879cceb353201165ff", "committedDate": "2020-07-01T21:17:28Z", "message": "move test to unit tests and resolve overriding method"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a2b82d2258dfa181a3f5c30665844c90b01717ff", "author": {"user": {"login": "talevy", "name": "Tal Levy"}}, "url": "https://github.com/elastic/elasticsearch/commit/a2b82d2258dfa181a3f5c30665844c90b01717ff", "committedDate": "2020-07-01T22:50:34Z", "message": "fix last minute change"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQxMzY1NTIy", "url": "https://github.com/elastic/elasticsearch/pull/58786#pullrequestreview-441365522", "createdAt": "2020-07-02T05:46:33Z", "commit": {"oid": "a2b82d2258dfa181a3f5c30665844c90b01717ff"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cdfdb4f3ce36cfad11d9e10e65ee69bdb7ad8994", "author": {"user": {"login": "talevy", "name": "Tal Levy"}}, "url": "https://github.com/elastic/elasticsearch/commit/cdfdb4f3ce36cfad11d9e10e65ee69bdb7ad8994", "committedDate": "2020-07-02T15:30:16Z", "message": "add unit tests for geoshape-with-doc-values and legacy"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2445, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}