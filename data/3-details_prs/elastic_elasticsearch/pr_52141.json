{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzczMTA5Mzc3", "number": 52141, "title": "Add a new async search security origin", "bodyText": "Creates a new security origin, and an associated reserved user and role _async_search, which can be used by internal clients to manage the .async-search-* restricted index namespace.\nI think we will also need to create a new origin for ILM since the .async-search-* restricted indices are managed by ILM and ILM uses the xpack security origin which doesn't have restricted indices privileges.\nCC @jimczi\nRelates #49931 #50294", "createdAt": "2020-02-10T12:32:41Z", "url": "https://github.com/elastic/elasticsearch/pull/52141", "merged": true, "mergeCommit": {"oid": "97f6e972b997802dfa1da144202bc55a2a9a7f2f"}, "closed": true, "closedAt": "2020-02-11T15:40:59Z", "author": {"login": "albertzaharovits"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcC8F27AH2gAyMzczMTA5Mzc3OmFiYTcyNzg5ZmVlMGZiNTNjMTRkZjVmYTUxMjZjMmYzNWFjYzE3YmI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcDPa16gH2gAyMzczMTA5Mzc3OjY2Y2I3MjI3NmMxZDI2ODJjZjkyNjhjZmEzNGE0NjIwOTUwYjFhYTY=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "aba72789fee0fb53c14df5fa5126c2f35acc17bb", "author": {"user": {"login": "albertzaharovits", "name": "Albert Zaharovits"}}, "url": "https://github.com/elastic/elasticsearch/commit/aba72789fee0fb53c14df5fa5126c2f35acc17bb", "committedDate": "2020-02-10T12:14:38Z", "message": "Async search security origin"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "62a2ff2d11eb3822e02d1ee3a2358d6ab63be3bb", "author": {"user": {"login": "albertzaharovits", "name": "Albert Zaharovits"}}, "url": "https://github.com/elastic/elasticsearch/commit/62a2ff2d11eb3822e02d1ee3a2358d6ab63be3bb", "committedDate": "2020-02-11T10:20:21Z", "message": "Merge branch 'master' into async-search-security-origin"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU2NTQ2ODA1", "url": "https://github.com/elastic/elasticsearch/pull/52141#pullrequestreview-356546805", "createdAt": "2020-02-11T10:27:14Z", "commit": {"oid": "aba72789fee0fb53c14df5fa5126c2f35acc17bb"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMVQxMDoyNzoxNFrOFoDyTw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMVQxMDoyNzozMFrOFoDy9g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzU0OTM5MQ==", "bodyText": "\ud83d\udc4d", "url": "https://github.com/elastic/elasticsearch/pull/52141#discussion_r377549391", "createdAt": "2020-02-11T10:27:14Z", "author": {"login": "tvernum"}, "path": "x-pack/plugin/security/src/test/java/org/elasticsearch/xpack/security/authz/AuthorizationUtilsTests.java", "diffHunk": "@@ -95,9 +97,15 @@ public void testSwitchAndExecuteXpackSecurityUser() throws Exception {\n     }\n \n     public void testSwitchAndExecuteXpackUser() throws Exception {\n-        String origin = randomFrom(ClientHelper.ML_ORIGIN, ClientHelper.WATCHER_ORIGIN, ClientHelper.DEPRECATION_ORIGIN,\n-                ClientHelper.MONITORING_ORIGIN, ClientHelper.PERSISTENT_TASK_ORIGIN, ClientHelper.INDEX_LIFECYCLE_ORIGIN);\n-        assertSwitchBasedOnOriginAndExecute(origin, XPackUser.INSTANCE);\n+        for (String origin : Arrays.asList(ClientHelper.ML_ORIGIN, ClientHelper.WATCHER_ORIGIN, ClientHelper.DEPRECATION_ORIGIN,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "aba72789fee0fb53c14df5fa5126c2f35acc17bb"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzU0OTU1OA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    // test AyncSearch user short circuits to its onw reserved role\n          \n          \n            \n                    // test AyncSearch user short circuits to its own reserved role", "url": "https://github.com/elastic/elasticsearch/pull/52141#discussion_r377549558", "createdAt": "2020-02-11T10:27:30Z", "author": {"login": "tvernum"}, "path": "x-pack/plugin/security/src/test/java/org/elasticsearch/xpack/security/authz/store/CompositeRolesStoreTests.java", "diffHunk": "@@ -959,13 +960,23 @@ public void testDoesNotUseRolesStoreForXPackUser() {\n                 rds -> effectiveRoleDescriptors.set(rds));\n         verify(fileRolesStore).addListener(any(Consumer.class)); // adds a listener in ctor\n \n+        // test Xpack user short circuits to its own reserved role\n         PlainActionFuture<Role> rolesFuture = new PlainActionFuture<>();\n         Authentication auth = new Authentication(XPackUser.INSTANCE, new RealmRef(\"name\", \"type\", \"node\"), null);\n         compositeRolesStore.getRoles(XPackUser.INSTANCE, auth, rolesFuture);\n-        final Role roles = rolesFuture.actionGet();\n+        Role roles = rolesFuture.actionGet();\n         assertThat(roles, equalTo(XPackUser.ROLE));\n         assertThat(effectiveRoleDescriptors.get(), is(nullValue()));\n         verifyNoMoreInteractions(fileRolesStore, nativeRolesStore, reservedRolesStore);\n+\n+        // test AyncSearch user short circuits to its onw reserved role", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "aba72789fee0fb53c14df5fa5126c2f35acc17bb"}, "originalPosition": 31}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "66cb72276c1d2682cf9268cfa34a4620950b1aa6", "author": {"user": {"login": "albertzaharovits", "name": "Albert Zaharovits"}}, "url": "https://github.com/elastic/elasticsearch/commit/66cb72276c1d2682cf9268cfa34a4620950b1aa6", "committedDate": "2020-02-11T10:45:45Z", "message": "Update x-pack/plugin/security/src/test/java/org/elasticsearch/xpack/security/authz/store/CompositeRolesStoreTests.java\n\nCo-Authored-By: Tim Vernum <tim@adjective.org>"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2751, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}