{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY3NTc5NDkx", "number": 61113, "title": "Borrow more tests for runtime fields", "bodyText": "This \"borrows\" 150 more tests from core for runtime fields, extending\nthe work done in #60931. More precisely, it adds a template to every\ntest that forces dynamic mapping updates to build runtime fields where\npossible. In particular, long and double field are created as\nruntime fields. string-typed fields are mimick the out of the box\nbehavior and create a top level text field with a .keyword\nmulti-field, but this keyword multi-field executes a script and loads\nfrom source.", "createdAt": "2020-08-13T19:04:40Z", "url": "https://github.com/elastic/elasticsearch/pull/61113", "merged": true, "mergeCommit": {"oid": "76eb16e55ff59388bf40983045d6e6a15d4e8de1"}, "closed": true, "closedAt": "2020-08-17T14:40:12Z", "author": {"login": "nik9000"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc-kwZhAH2gAyNDY3NTc5NDkxOjUwOTM4NWNkMzNmMjA3NTRhOGIxZjJhN2I3OTIwNjMzNzE2NDg1NWY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc_zWzzgH2gAyNDY3NTc5NDkxOjRhM2UzZjRkNjhlODMyMjQwZjNlOTFjODYzOGMwMmQ0ZTkzZDI3Y2Y=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "509385cd33f20754a8b1f2a7b79206337164855f", "author": {"user": {"login": "nik9000", "name": "Nik Everett"}}, "url": "https://github.com/elastic/elasticsearch/commit/509385cd33f20754a8b1f2a7b79206337164855f", "committedDate": "2020-08-13T18:58:50Z", "message": "Borrow more tests for runtime fields\n\nThis \"borrows\" 150 more tests from core for runtime fields, extending\nthe work done in #60931. More precisely, it adds a template to every\ntest that forces dynamic mapping updates to build runtime fields where\npossible. In particular, `long` and `double` field are created as\nruntime fields. `string`-typed fields are mimick the out of the box\nbehavior and create a top level `text` field with a `.keyword`\nmulti-field, but this `keyword` multi-field executes a script and loads\nfrom source."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY3NDIwNDg3", "url": "https://github.com/elastic/elasticsearch/pull/61113#pullrequestreview-467420487", "createdAt": "2020-08-14T09:02:59Z", "commit": {"oid": "509385cd33f20754a8b1f2a7b79206337164855f"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xNFQwOTowMjo1OVrOHAtN8Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xNFQwOTowMjo1OVrOHAtN8Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDUwMjg5Nw==", "bodyText": "what is string here? Is it the old field type string from before we had text and keyword?", "url": "https://github.com/elastic/elasticsearch/pull/61113#discussion_r470502897", "createdAt": "2020-08-14T09:02:59Z", "author": {"login": "javanna"}, "path": "x-pack/plugin/runtime-fields/qa/rest/src/yamlRestTest/java/org/elasticsearch/xpack/runtimefields/rest/CoreTestsWithRuntimeFieldsIT.java", "diffHunk": "@@ -173,4 +195,54 @@ private static String painlessToLoadFromSource(String name, String type) {\n         )\n     );\n \n+    private static final ExecutableSection ADD_TEMPLATE = new ExecutableSection() {\n+        @Override\n+        public XContentLocation getLocation() {\n+            return new XContentLocation(-1, -1);\n+        }\n+\n+        @Override\n+        public void execute(ClientYamlTestExecutionContext executionContext) throws IOException {\n+            Map<String, String> params = Map.of(\"name\", \"convert_to_source_only\", \"create\", \"true\");\n+            List<Map<String, Object>> dynamicTemplates = new ArrayList<>();\n+            for (String type : PAINLESS_TO_EMIT.keySet()) {\n+                if (type.equals(\"ip\")) {\n+                    // There isn't a dynamic template to pick up ips. They'll just look like strings.\n+                    continue;\n+                }\n+                Map<String, Object> mapping = Map.ofEntries(\n+                    Map.entry(\"type\", \"runtime_script\"),\n+                    Map.entry(\"runtime_type\", type),\n+                    Map.entry(\"script\", painlessToLoadFromSource(\"{name}\", type))\n+                );\n+                Map<String, Object> body = Map.ofEntries(\n+                    Map.entry(\"match_mapping_type\", type.equals(\"keyword\") ? \"string\" : type),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "509385cd33f20754a8b1f2a7b79206337164855f"}, "originalPosition": 133}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2726de211564bb67d26215e589580fad322c7b14", "author": {"user": {"login": "nik9000", "name": "Nik Everett"}}, "url": "https://github.com/elastic/elasticsearch/commit/2726de211564bb67d26215e589580fad322c7b14", "committedDate": "2020-08-17T14:19:46Z", "message": "Merge branch 'feature/runtime_fields' into runtime_fields_moar_tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4a3e3f4d68e832240f3e91c8638c02d4e93d27cf", "author": {"user": {"login": "nik9000", "name": "Nik Everett"}}, "url": "https://github.com/elastic/elasticsearch/commit/4a3e3f4d68e832240f3e91c8638c02d4e93d27cf", "committedDate": "2020-08-17T14:33:23Z", "message": "Skip broken tests"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3292, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}