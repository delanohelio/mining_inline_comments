{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc4ODE1NTM0", "number": 52690, "title": "append index name for the source of the cluster put-mapping task", "bodyText": "When there are a lot of pending tasks with put-mapping in the cluster, the \"_cat/pending_tasks\" API result is too simple to quickly know which index is put-mapping.\nSince the task desc is obtained from the 'source' field of task, we can append the index name after the source field when pending task is submitted, it is helpful for us to quickly locate the put-mapping index", "createdAt": "2020-02-24T05:20:16Z", "url": "https://github.com/elastic/elasticsearch/pull/52690", "merged": true, "mergeCommit": {"oid": "99120a7b95238135fdfd9514bb716d35bd203f1e"}, "closed": true, "closedAt": "2020-02-27T11:15:41Z", "author": {"login": "zhanghezhen"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcHWgrAgH2gAyMzc4ODE1NTM0OmJlOWM0MGFhMDlhMTM0MmZmNzgxNDcwMDJhOTQxYzhiMGJhYzUwMTM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcIYVDyAFqTM2NTU0ODAyOQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "be9c40aa09a1342ff78147002a941c8b0bac5013", "author": {"user": {"login": "zhanghezhen", "name": "hezhen Zhang"}}, "url": "https://github.com/elastic/elasticsearch/commit/be9c40aa09a1342ff78147002a941c8b0bac5013", "committedDate": "2020-02-24T05:17:09Z", "message": "append index name for the source of the cluster put-mapping task"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY0ODgyMzE2", "url": "https://github.com/elastic/elasticsearch/pull/52690#pullrequestreview-364882316", "createdAt": "2020-02-26T13:08:51Z", "commit": {"oid": "be9c40aa09a1342ff78147002a941c8b0bac5013"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNlQxMzowODo1MVrOFuq0ww==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNlQxMzoxMTo0NlrOFuq6Jw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDQ4MDQ1MQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    clusterService.submitStateUpdateTask(\"put-mapping \" + getRequestIndex(request),\n          \n          \n            \n                    clusterService.submitStateUpdateTask(\"put-mapping \" + Strings.arrayToCommaDelimitedString(request.indices())),\n          \n      \n    \n    \n  \n\nThis removes the need for the method below too.", "url": "https://github.com/elastic/elasticsearch/pull/52690#discussion_r384480451", "createdAt": "2020-02-26T13:08:51Z", "author": {"login": "henningandersen"}, "path": "server/src/main/java/org/elasticsearch/cluster/metadata/MetaDataMappingService.java", "diffHunk": "@@ -326,7 +326,7 @@ private ClusterState applyRequest(ClusterState currentState, PutMappingClusterSt\n     }\n \n     public void putMapping(final PutMappingClusterStateUpdateRequest request, final ActionListener<ClusterStateUpdateResponse> listener) {\n-        clusterService.submitStateUpdateTask(\"put-mapping\",\n+        clusterService.submitStateUpdateTask(\"put-mapping \" + getRequestIndex(request),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "be9c40aa09a1342ff78147002a941c8b0bac5013"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDQ4MTgzMQ==", "bodyText": "Given that we have the comma concatenating logic, I think we can omit the test here.", "url": "https://github.com/elastic/elasticsearch/pull/52690#discussion_r384481831", "createdAt": "2020-02-26T13:11:46Z", "author": {"login": "henningandersen"}, "path": "server/src/test/java/org/elasticsearch/cluster/metadata/MetaDataMappingServiceTests.java", "diffHunk": "@@ -113,4 +113,17 @@ public void testMappingVersionUnchanged() throws Exception {\n         assertThat(result.resultingState.metaData().index(\"test\").getMappingVersion(), equalTo(previousVersion));\n     }\n \n+    public void testGetRequestIndex() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "be9c40aa09a1342ff78147002a941c8b0bac5013"}, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "71c9de5c0dc05769d8c80eeee345a086e4ddf1fc", "author": {"user": {"login": "zhanghezhen", "name": "hezhen Zhang"}}, "url": "https://github.com/elastic/elasticsearch/commit/71c9de5c0dc05769d8c80eeee345a086e4ddf1fc", "committedDate": "2020-02-27T05:55:49Z", "message": "append index name for the source of the cluster put-mapping task"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0800b33643d93bf3756126f91189e5e78ab55614", "author": {"user": {"login": "elasticmachine", "name": "Elastic Machine"}}, "url": "https://github.com/elastic/elasticsearch/commit/0800b33643d93bf3756126f91189e5e78ab55614", "committedDate": "2020-02-27T08:27:04Z", "message": "Merge branch 'master' into master"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY1NTQ3NDY2", "url": "https://github.com/elastic/elasticsearch/pull/52690#pullrequestreview-365547466", "createdAt": "2020-02-27T09:57:21Z", "commit": {"oid": "0800b33643d93bf3756126f91189e5e78ab55614"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY1NTQ4MDI5", "url": "https://github.com/elastic/elasticsearch/pull/52690#pullrequestreview-365548029", "createdAt": "2020-02-27T09:58:12Z", "commit": {"oid": "0800b33643d93bf3756126f91189e5e78ab55614"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2105, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}