{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY0NDc4NzUw", "number": 51192, "title": "Account soft-deletes in FrozenEngine", "bodyText": "Currently, we do not exclude soft-deleted documents when opening index reader in the FrozenEngine.\nRelates #50775", "createdAt": "2020-01-19T00:05:59Z", "url": "https://github.com/elastic/elasticsearch/pull/51192", "merged": true, "mergeCommit": {"oid": "c8e9f57348f69e472627e20e419793c9189100b7"}, "closed": true, "closedAt": "2020-01-20T14:48:29Z", "author": {"login": "dnhatn"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb7sZVEgH2gAyMzY0NDc4NzUwOjQ5Mzk2OTNjNmU0ZTNmYmM0YjRhMjc5Y2QxZjU1MzM1MjU3Yjk5MjE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABb8M9moAH2gAyMzY0NDc4NzUwOmI1Yzc2NThmY2MzOGI1OTA1NDA1NTQzMWE3ZDU5OTgzMTI3ZWZhOGM=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "4939693c6e4e3fbc4b4a279cd1f55335257b9921", "author": {"user": {"login": "dnhatn", "name": "Nhat Nguyen"}}, "url": "https://github.com/elastic/elasticsearch/commit/4939693c6e4e3fbc4b4a279cd1f55335257b9921", "committedDate": "2020-01-18T23:59:57Z", "message": "Add test verify frozen index without soft-deletes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "00eb1c4f45325314c8cf0a4e18f2e7a088089e01", "author": {"user": {"login": "dnhatn", "name": "Nhat Nguyen"}}, "url": "https://github.com/elastic/elasticsearch/commit/00eb1c4f45325314c8cf0a4e18f2e7a088089e01", "committedDate": "2020-01-19T01:08:53Z", "message": "fix indexing body"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1045b6b49679c2cb4f7567a188c573bd09960d4d", "author": {"user": {"login": "dnhatn", "name": "Nhat Nguyen"}}, "url": "https://github.com/elastic/elasticsearch/commit/1045b6b49679c2cb4f7567a188c573bd09960d4d", "committedDate": "2020-01-19T02:46:10Z", "message": "assert response"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "218183f165a872dec258ce7ba846b09be895fb98", "author": {"user": {"login": "dnhatn", "name": "Nhat Nguyen"}}, "url": "https://github.com/elastic/elasticsearch/commit/218183f165a872dec258ce7ba846b09be895fb98", "committedDate": "2020-01-19T23:02:47Z", "message": "Account soft deletes in frozen engine"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ1MTIwNDY1", "url": "https://github.com/elastic/elasticsearch/pull/51192#pullrequestreview-345120465", "createdAt": "2020-01-20T07:40:45Z", "commit": {"oid": "218183f165a872dec258ce7ba846b09be895fb98"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMFQwNzo0MDo0NVrOFfVgRA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMFQwNzo0MDo0NVrOFfVgRA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODQwMjUwMA==", "bodyText": "In 7.x and below, this will be dependent on the soft-deletes setting, right?", "url": "https://github.com/elastic/elasticsearch/pull/51192#discussion_r368402500", "createdAt": "2020-01-20T07:40:45Z", "author": {"login": "ywelsch"}, "path": "server/src/main/java/org/elasticsearch/index/engine/ReadOnlyEngine.java", "diffHunk": "@@ -528,4 +528,8 @@ public void advanceMaxSeqNoOfUpdatesOrDeletes(long maxSeqNoOfUpdatesOnPrimary) {\n         assert maxSeqNoOfUpdatesOnPrimary <= getMaxSeqNoOfUpdatesOrDeletes() :\n             maxSeqNoOfUpdatesOnPrimary + \">\" + getMaxSeqNoOfUpdatesOrDeletes();\n     }\n+\n+    protected static DirectoryReader openDirectory(Directory dir) throws IOException {\n+        return new SoftDeletesDirectoryReaderWrapper(DirectoryReader.open(dir, OFF_HEAP_READER_ATTRIBUTES), Lucene.SOFT_DELETES_FIELD);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "218183f165a872dec258ce7ba846b09be895fb98"}, "originalPosition": 15}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ1MTQ2MDc2", "url": "https://github.com/elastic/elasticsearch/pull/51192#pullrequestreview-345146076", "createdAt": "2020-01-20T08:41:26Z", "commit": {"oid": "218183f165a872dec258ce7ba846b09be895fb98"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b5c7658fcc38b59054055431a7d59983127efa8c", "author": {"user": {"login": "dnhatn", "name": "Nhat Nguyen"}}, "url": "https://github.com/elastic/elasticsearch/commit/b5c7658fcc38b59054055431a7d59983127efa8c", "committedDate": "2020-01-20T13:56:32Z", "message": "Merge branch 'master' into frozen-indices-restart"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3014, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}