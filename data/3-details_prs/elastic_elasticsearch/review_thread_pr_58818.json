{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQyNTk0MDkz", "number": 58818, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMlQwOTozMjoyMVrOEK0htA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMlQwOTozNjowNlrOEK0mmg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc5NzgxODEyOnYy", "diffSide": "RIGHT", "path": "server/src/internalClusterTest/java/org/elasticsearch/repositories/blobstore/BlobStoreRepositoryCleanupIT.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMlQwOTozMjoyMVrOGsFHMw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMlQxMjo0OToyM1rOGsLWFg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODg3NDI5MQ==", "bodyText": "I think it deserves a createFsRepository(); I'd also rarely set a random chunk size", "url": "https://github.com/elastic/elasticsearch/pull/58818#discussion_r448874291", "createdAt": "2020-07-02T09:32:21Z", "author": {"login": "tlrx"}, "path": "server/src/internalClusterTest/java/org/elasticsearch/repositories/blobstore/BlobStoreRepositoryCleanupIT.java", "diffHunk": "@@ -116,11 +112,8 @@ public void testCleanupOldIndexN() throws ExecutionException, InterruptedExcepti\n         internalCluster().startNodes(Settings.EMPTY);\n \n         final String repoName = \"test-repo\";\n-        logger.info(\"-->  creating repository\");\n-        assertAcked(client().admin().cluster().preparePutRepository(repoName).setType(\"fs\").setSettings(Settings.builder()\n-            .put(\"location\", randomRepoPath())\n-            .put(\"compress\", randomBoolean())\n-            .put(\"chunk_size\", randomIntBetween(100, 1000), ByteSizeUnit.BYTES)));\n+        createRepository(repoName, \"fs\", Settings.builder().put(\"location\", randomRepoPath()).put(\"compress\", randomBoolean())", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "57a340c4a1822d29797cdaa49660101790a99110"}, "originalPosition": 33}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODk2ODQ3NQ==", "bodyText": "Let's do this in a follow up since it's so many spots to change? I was thinking about unifying the various random settings we use as much as possible anyway. Currently there's so many different kinds of random which aren't really needed in most cases. There's just a handful of tests where things like compression -> false are actually necessary and the rest could all just use the same randomness. Just figured that's probably best done separately since it's a logical change to the tests?", "url": "https://github.com/elastic/elasticsearch/pull/58818#discussion_r448968475", "createdAt": "2020-07-02T12:35:22Z", "author": {"login": "original-brownbear"}, "path": "server/src/internalClusterTest/java/org/elasticsearch/repositories/blobstore/BlobStoreRepositoryCleanupIT.java", "diffHunk": "@@ -116,11 +112,8 @@ public void testCleanupOldIndexN() throws ExecutionException, InterruptedExcepti\n         internalCluster().startNodes(Settings.EMPTY);\n \n         final String repoName = \"test-repo\";\n-        logger.info(\"-->  creating repository\");\n-        assertAcked(client().admin().cluster().preparePutRepository(repoName).setType(\"fs\").setSettings(Settings.builder()\n-            .put(\"location\", randomRepoPath())\n-            .put(\"compress\", randomBoolean())\n-            .put(\"chunk_size\", randomIntBetween(100, 1000), ByteSizeUnit.BYTES)));\n+        createRepository(repoName, \"fs\", Settings.builder().put(\"location\", randomRepoPath()).put(\"compress\", randomBoolean())", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODg3NDI5MQ=="}, "originalCommit": {"oid": "57a340c4a1822d29797cdaa49660101790a99110"}, "originalPosition": 33}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODk3NjQwNg==", "bodyText": "Sure", "url": "https://github.com/elastic/elasticsearch/pull/58818#discussion_r448976406", "createdAt": "2020-07-02T12:49:23Z", "author": {"login": "tlrx"}, "path": "server/src/internalClusterTest/java/org/elasticsearch/repositories/blobstore/BlobStoreRepositoryCleanupIT.java", "diffHunk": "@@ -116,11 +112,8 @@ public void testCleanupOldIndexN() throws ExecutionException, InterruptedExcepti\n         internalCluster().startNodes(Settings.EMPTY);\n \n         final String repoName = \"test-repo\";\n-        logger.info(\"-->  creating repository\");\n-        assertAcked(client().admin().cluster().preparePutRepository(repoName).setType(\"fs\").setSettings(Settings.builder()\n-            .put(\"location\", randomRepoPath())\n-            .put(\"compress\", randomBoolean())\n-            .put(\"chunk_size\", randomIntBetween(100, 1000), ByteSizeUnit.BYTES)));\n+        createRepository(repoName, \"fs\", Settings.builder().put(\"location\", randomRepoPath()).put(\"compress\", randomBoolean())", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODg3NDI5MQ=="}, "originalCommit": {"oid": "57a340c4a1822d29797cdaa49660101790a99110"}, "originalPosition": 33}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc5NzgyOTgxOnYy", "diffSide": "RIGHT", "path": "server/src/test/java/org/elasticsearch/snapshots/AbstractSnapshotIntegTestCase.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMlQwOTozNTo1MFrOGsFO2w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMlQxMjo0ODo1N1rOGsLVFA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODg3NjI1MQ==", "bodyText": "Is it overriden somewhere? If not it can be static.", "url": "https://github.com/elastic/elasticsearch/pull/58818#discussion_r448876251", "createdAt": "2020-07-02T09:35:50Z", "author": {"login": "tlrx"}, "path": "server/src/test/java/org/elasticsearch/snapshots/AbstractSnapshotIntegTestCase.java", "diffHunk": "@@ -264,11 +264,14 @@ public static void unblockNode(final String repository, final String node) {\n         ((MockRepository)internalCluster().getInstance(RepositoriesService.class, node).repository(repository)).unblock();\n     }\n \n-    protected void createRepository(String repoName, String type, Path location) {\n-        logger.info(\"-->  creating repository\");\n+    protected void createRepository(String repoName, String type, Settings.Builder settings) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "57a340c4a1822d29797cdaa49660101790a99110"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODk2NzEzMg==", "bodyText": "It uses the logger instance which is not static in the tests (can't be because we want the test suit in the logger name).", "url": "https://github.com/elastic/elasticsearch/pull/58818#discussion_r448967132", "createdAt": "2020-07-02T12:32:52Z", "author": {"login": "original-brownbear"}, "path": "server/src/test/java/org/elasticsearch/snapshots/AbstractSnapshotIntegTestCase.java", "diffHunk": "@@ -264,11 +264,14 @@ public static void unblockNode(final String repository, final String node) {\n         ((MockRepository)internalCluster().getInstance(RepositoriesService.class, node).repository(repository)).unblock();\n     }\n \n-    protected void createRepository(String repoName, String type, Path location) {\n-        logger.info(\"-->  creating repository\");\n+    protected void createRepository(String repoName, String type, Settings.Builder settings) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODg3NjI1MQ=="}, "originalCommit": {"oid": "57a340c4a1822d29797cdaa49660101790a99110"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODk3NjE0OA==", "bodyText": "Right - did not spot that. Sorry for the noise.", "url": "https://github.com/elastic/elasticsearch/pull/58818#discussion_r448976148", "createdAt": "2020-07-02T12:48:57Z", "author": {"login": "tlrx"}, "path": "server/src/test/java/org/elasticsearch/snapshots/AbstractSnapshotIntegTestCase.java", "diffHunk": "@@ -264,11 +264,14 @@ public static void unblockNode(final String repository, final String node) {\n         ((MockRepository)internalCluster().getInstance(RepositoriesService.class, node).repository(repository)).unblock();\n     }\n \n-    protected void createRepository(String repoName, String type, Path location) {\n-        logger.info(\"-->  creating repository\");\n+    protected void createRepository(String repoName, String type, Settings.Builder settings) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODg3NjI1MQ=="}, "originalCommit": {"oid": "57a340c4a1822d29797cdaa49660101790a99110"}, "originalPosition": 6}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc5NzgzMDY2OnYy", "diffSide": "RIGHT", "path": "server/src/test/java/org/elasticsearch/snapshots/AbstractSnapshotIntegTestCase.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMlQwOTozNjowNlrOGsFPWg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMlQxMjozMzoyMFrOGsKy4g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODg3NjM3OA==", "bodyText": "Maybe static?", "url": "https://github.com/elastic/elasticsearch/pull/58818#discussion_r448876378", "createdAt": "2020-07-02T09:36:06Z", "author": {"login": "tlrx"}, "path": "server/src/test/java/org/elasticsearch/snapshots/AbstractSnapshotIntegTestCase.java", "diffHunk": "@@ -307,4 +310,16 @@ protected String initWithSnapshotVersion(String repoName, Path repoPath, Version\n                 StandardOpenOption.TRUNCATE_EXISTING);\n         return oldVersionSnapshot;\n     }\n+\n+    protected SnapshotInfo createFullSnapshot(String repoName, String snapshotName) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "57a340c4a1822d29797cdaa49660101790a99110"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODk2NzM5NA==", "bodyText": "Same explanation as above, the logger this thing uses isn't static.", "url": "https://github.com/elastic/elasticsearch/pull/58818#discussion_r448967394", "createdAt": "2020-07-02T12:33:20Z", "author": {"login": "original-brownbear"}, "path": "server/src/test/java/org/elasticsearch/snapshots/AbstractSnapshotIntegTestCase.java", "diffHunk": "@@ -307,4 +310,16 @@ protected String initWithSnapshotVersion(String repoName, Path repoPath, Version\n                 StandardOpenOption.TRUNCATE_EXISTING);\n         return oldVersionSnapshot;\n     }\n+\n+    protected SnapshotInfo createFullSnapshot(String repoName, String snapshotName) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODg3NjM3OA=="}, "originalCommit": {"oid": "57a340c4a1822d29797cdaa49660101790a99110"}, "originalPosition": 24}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2185, "cost": 1, "resetAt": "2021-11-12T13:16:51Z"}}}