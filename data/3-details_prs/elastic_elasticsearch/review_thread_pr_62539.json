{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDg4NjQxNjc2", "number": 62539, "reviewThreads": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xN1QxMzowMzoxN1rOEkhngA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMVQxNjo1MToxMlrOEpjtUQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA2NzM0OTc2OnYy", "diffSide": "RIGHT", "path": "x-pack/plugin/eql/src/main/java/org/elasticsearch/xpack/eql/parser/AbstractBuilder.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xN1QxMzowMzoxN1rOHThA8Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xN1QxMzoyMTo0NFrOHThzmQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDIyNTkwNQ==", "bodyText": "This is incorrect - in case of ?' the error message is invalid - it tells that double quotes should be used which is not the case.\nIn fact I would argue that since the string is always quoted, if it starts with ? an exception should be thrown regardless of what follows it.", "url": "https://github.com/elastic/elasticsearch/pull/62539#discussion_r490225905", "createdAt": "2020-09-17T13:03:17Z", "author": {"login": "costin"}, "path": "x-pack/plugin/eql/src/main/java/org/elasticsearch/xpack/eql/parser/AbstractBuilder.java", "diffHunk": "@@ -122,10 +122,18 @@ public static String unquoteString(Source source) {\n             return null;\n         }\n \n-        // unescaped strings can be interpreted directly\n+        // catch old method of ?\" and ?' to define unescaped strings\n         if (text.startsWith(\"?\")) {\n             checkForSingleQuotedString(source, text, 1);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "32e85fd2d94625dba4606ea92b53edfd5d0beb3d"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDIzODg3Mw==", "bodyText": "That's true, It's a 2-step error for the user: ?' -> ?\" -> \"\"\". I just thought that explicitly handling the single quotes (no matter of the preceding ?) was a \"better\" approach. I'll gladly change it.", "url": "https://github.com/elastic/elasticsearch/pull/62539#discussion_r490238873", "createdAt": "2020-09-17T13:21:44Z", "author": {"login": "matriv"}, "path": "x-pack/plugin/eql/src/main/java/org/elasticsearch/xpack/eql/parser/AbstractBuilder.java", "diffHunk": "@@ -122,10 +122,18 @@ public static String unquoteString(Source source) {\n             return null;\n         }\n \n-        // unescaped strings can be interpreted directly\n+        // catch old method of ?\" and ?' to define unescaped strings\n         if (text.startsWith(\"?\")) {\n             checkForSingleQuotedString(source, text, 1);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDIyNTkwNQ=="}, "originalCommit": {"oid": "32e85fd2d94625dba4606ea92b53edfd5d0beb3d"}, "originalPosition": 7}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA2ODYzODIxOnYy", "diffSide": "RIGHT", "path": "x-pack/plugin/eql/src/main/antlr/EqlBase.g4", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xN1QxNzoyMjo0OVrOHTtjVA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xOFQwODo0NDoyOVrOHUDyyg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDQzMTMxNg==", "bodyText": "Looks like ' needs to be escaped under this format.\nI also have some questions about the desired behavior of triple double quotes:\nHow would each of these be interpreted? I think we should know our edge cases up front. I'm wondering what the implication is for \" at the beginning or at the end of a string. And how many of them are supported\n\n\"\"\"\"\"\"\n\"\"\"\"\"x\"\"\"\n\"\"\"x\"\"\"\"\"\n\"\"\"\"\"\"\"\"", "url": "https://github.com/elastic/elasticsearch/pull/62539#discussion_r490431316", "createdAt": "2020-09-17T17:22:49Z", "author": {"login": "rw-access"}, "path": "x-pack/plugin/eql/src/main/antlr/EqlBase.g4", "diffHunk": "@@ -195,6 +195,7 @@ STRING\n     | '\"'   ('\\\\' [btnfr\"'\\\\] | ~[\\r\\n\"\\\\])* '\"'\n     | '?\"'  ('\\\\\"' |~[\"\\r\\n])* '\"'\n     | '?\\'' ('\\\\\\'' |~['\\r\\n])* '\\''\n+    | '\"\"\"' ('\\\\\\'' |~['\\r\\n])* '\"\"\"'", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "480aac541623a84d13ef7445a102067c381c8239"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDc5NTcyMg==", "bodyText": "Looks like ' needs to be escaped under this format.\n\nCorrect, I rushed and overlooked that.\n\nI also have some questions about the desired behavior of triple double quotes:\nHow would each of these be interpreted? I think we should know our edge cases up front. I'm wondering what the implication is for \" at the beginning or at the end of a string. And how many of them are supported\n\n\"\"\"\"\"\"\n\"\"\"\"\"x\"\"\"\n\"\"\"x\"\"\"\"\"\n\"\"\"\"\"\"\"\"\n\n\nThe extra \" in the beginning or end of the string would be part of the final string:\n\n`` -> empty string\n\"\"x\nx\"\"\n\"\"", "url": "https://github.com/elastic/elasticsearch/pull/62539#discussion_r490795722", "createdAt": "2020-09-18T08:44:29Z", "author": {"login": "matriv"}, "path": "x-pack/plugin/eql/src/main/antlr/EqlBase.g4", "diffHunk": "@@ -195,6 +195,7 @@ STRING\n     | '\"'   ('\\\\' [btnfr\"'\\\\] | ~[\\r\\n\"\\\\])* '\"'\n     | '?\"'  ('\\\\\"' |~[\"\\r\\n])* '\"'\n     | '?\\'' ('\\\\\\'' |~['\\r\\n])* '\\''\n+    | '\"\"\"' ('\\\\\\'' |~['\\r\\n])* '\"\"\"'", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDQzMTMxNg=="}, "originalCommit": {"oid": "480aac541623a84d13ef7445a102067c381c8239"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA3MjI0NDI5OnYy", "diffSide": "RIGHT", "path": "x-pack/plugin/eql/src/main/antlr/EqlBase.g4", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xOFQxNDoyMzoxNFrOHUPXwg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xOFQxNDoyMzoxNFrOHUPXwg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDk4NTQxMA==", "bodyText": "This sttill doesn't seem right and needs more tests.\nUnder this regex, you start and end with \"\"\", but you can't have any ' characters in between. In addition, you can have an infinite number of \" characters. This would mean \"\"\"\"\"\"\"\"\"\"\"\"\"\"\" is valid syntax. But I'm not sure that's good behavior.", "url": "https://github.com/elastic/elasticsearch/pull/62539#discussion_r490985410", "createdAt": "2020-09-18T14:23:14Z", "author": {"login": "rw-access"}, "path": "x-pack/plugin/eql/src/main/antlr/EqlBase.g4", "diffHunk": "@@ -199,6 +199,7 @@ STRING\n     | '\"'   ('\\\\' [btnfr\"'\\\\] | ~[\\r\\n\"\\\\])* '\"'\n     | '?\"'  ('\\\\\"' |~[\"\\r\\n])* '\"'\n     | '?\\'' ('\\\\\\'' |~['\\r\\n])* '\\''\n+    | '\"\"\"' ('\\\\\"' |~['\\r\\n])* '\"\"\"'", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "374bc92ec5d9c2d7e62fd3bf985bce862b83df6e"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEwNTM3MzY2OnYy", "diffSide": "RIGHT", "path": "x-pack/plugin/eql/src/test/java/org/elasticsearch/xpack/eql/parser/ExpressionTests.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOFQxNTo1MDozOFrOHZE2rQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOFQxNjowNDoxNlrOHZFbAg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjA1NTk4MQ==", "bodyText": "how is \"\"\"hello\"\"\" == \"\"\"world\"\"\" interpreted?\nit should be equivalent to this expression Equals(\"hello\", \"world):\n\"hello\" == \"world\"", "url": "https://github.com/elastic/elasticsearch/pull/62539#discussion_r496055981", "createdAt": "2020-09-28T15:50:38Z", "author": {"login": "rw-access"}, "path": "x-pack/plugin/eql/src/test/java/org/elasticsearch/xpack/eql/parser/ExpressionTests.java", "diffHunk": "@@ -99,18 +103,52 @@ public void testDoubleQuotedString() {\n \n     public void testSingleQuotedUnescapedStringDisallowed() {\n         ParsingException e = expectThrows(ParsingException.class, () -> expr(\"?'hello world'\"));\n-        assertEquals(\"line 1:2: Use double quotes [\\\"] to define string literals, not single quotes [']\",\n+        assertEquals(\"line 1:2: Use triple double quotes [\\\"\\\"\\\"] to define unescaped string literals, not [?']\",\n                 e.getMessage());\n-        e = expectThrows(ParsingException.class, () -> parser.createStatement(\"process where name==?'hello world'\"));\n-        assertEquals(\"line 1:22: Use double quotes [\\\"] to define string literals, not single quotes [']\",\n+        e = expectThrows(ParsingException.class, () -> parser.createStatement(\"process where name == ?'hello world'\"));\n+        assertEquals(\"line 1:24: Use triple double quotes [\\\"\\\"\\\"] to define unescaped string literals, not [?']\",\n                 e.getMessage());\n     }\n \n-    public void testDoubleQuotedUnescapedString() {\n-        // \"hello \\\" world\"\n-        Expression parsed = expr(\"?\\\"hello \\\\\\\" world!\\\"\");\n-        Expression expected = new Literal(null, \"hello \\\\\\\" world!\", DataTypes.KEYWORD);\n-        assertEquals(expected, parsed);\n+    public void testDoubleQuotedUnescapedStringForbidden() {\n+        ParsingException e = expectThrows(ParsingException.class, () -> expr(\"?\\\"hello world\\\"\"));\n+        assertEquals(\"line 1:2: Use triple double quotes [\\\"\\\"\\\"] to define unescaped string literals, not [?\\\"]\",\n+                e.getMessage());\n+        e = expectThrows(ParsingException.class, () -> parser.createStatement(\"process where name == ?\\\"hello world\\\"\"));\n+        assertEquals(\"line 1:24: Use triple double quotes [\\\"\\\"\\\"] to define unescaped string literals, not [?\\\"]\",\n+                e.getMessage());\n+    }\n+\n+    public void testTripleDoubleQuotedUnescapedString() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fec23cef7afd30d79a66b206ab841976c38c8a14"}, "originalPosition": 55}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjA2NTI4Mg==", "bodyText": "I can add a test for that", "url": "https://github.com/elastic/elasticsearch/pull/62539#discussion_r496065282", "createdAt": "2020-09-28T16:04:16Z", "author": {"login": "matriv"}, "path": "x-pack/plugin/eql/src/test/java/org/elasticsearch/xpack/eql/parser/ExpressionTests.java", "diffHunk": "@@ -99,18 +103,52 @@ public void testDoubleQuotedString() {\n \n     public void testSingleQuotedUnescapedStringDisallowed() {\n         ParsingException e = expectThrows(ParsingException.class, () -> expr(\"?'hello world'\"));\n-        assertEquals(\"line 1:2: Use double quotes [\\\"] to define string literals, not single quotes [']\",\n+        assertEquals(\"line 1:2: Use triple double quotes [\\\"\\\"\\\"] to define unescaped string literals, not [?']\",\n                 e.getMessage());\n-        e = expectThrows(ParsingException.class, () -> parser.createStatement(\"process where name==?'hello world'\"));\n-        assertEquals(\"line 1:22: Use double quotes [\\\"] to define string literals, not single quotes [']\",\n+        e = expectThrows(ParsingException.class, () -> parser.createStatement(\"process where name == ?'hello world'\"));\n+        assertEquals(\"line 1:24: Use triple double quotes [\\\"\\\"\\\"] to define unescaped string literals, not [?']\",\n                 e.getMessage());\n     }\n \n-    public void testDoubleQuotedUnescapedString() {\n-        // \"hello \\\" world\"\n-        Expression parsed = expr(\"?\\\"hello \\\\\\\" world!\\\"\");\n-        Expression expected = new Literal(null, \"hello \\\\\\\" world!\", DataTypes.KEYWORD);\n-        assertEquals(expected, parsed);\n+    public void testDoubleQuotedUnescapedStringForbidden() {\n+        ParsingException e = expectThrows(ParsingException.class, () -> expr(\"?\\\"hello world\\\"\"));\n+        assertEquals(\"line 1:2: Use triple double quotes [\\\"\\\"\\\"] to define unescaped string literals, not [?\\\"]\",\n+                e.getMessage());\n+        e = expectThrows(ParsingException.class, () -> parser.createStatement(\"process where name == ?\\\"hello world\\\"\"));\n+        assertEquals(\"line 1:24: Use triple double quotes [\\\"\\\"\\\"] to define unescaped string literals, not [?\\\"]\",\n+                e.getMessage());\n+    }\n+\n+    public void testTripleDoubleQuotedUnescapedString() {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjA1NTk4MQ=="}, "originalCommit": {"oid": "fec23cef7afd30d79a66b206ab841976c38c8a14"}, "originalPosition": 55}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEwNTM4MDI5OnYy", "diffSide": "RIGHT", "path": "x-pack/plugin/eql/src/main/antlr/EqlBase.g4", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOFQxNTo1MjowMFrOHZE6sw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOFQxNTo1MjowMFrOHZE6sw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjA1NzAxMQ==", "bodyText": "This shouldn't need to forbid ' inside the string.\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                | '\"\"\"' (~['\\r\\n])* '\"\"\"'\n          \n          \n            \n                | '\"\"\"' (~[\\r\\n])* '\"\"\"'", "url": "https://github.com/elastic/elasticsearch/pull/62539#discussion_r496057011", "createdAt": "2020-09-28T15:52:00Z", "author": {"login": "rw-access"}, "path": "x-pack/plugin/eql/src/main/antlr/EqlBase.g4", "diffHunk": "@@ -200,6 +200,7 @@ STRING\n     | '\"'   ('\\\\' [btnfr\"'\\\\] | ~[\\r\\n\"\\\\])* '\"'\n     | '?\"'  ('\\\\\"' |~[\"\\r\\n])* '\"'\n     | '?\\'' ('\\\\\\'' |~['\\r\\n])* '\\''\n+    | '\"\"\"' (~['\\r\\n])* '\"\"\"'", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fec23cef7afd30d79a66b206ab841976c38c8a14"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEyMDEyMTEzOnYy", "diffSide": "RIGHT", "path": "x-pack/plugin/eql/src/main/antlr/EqlBase.g4", "isResolved": false, "comments": {"totalCount": 15, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMVQxNjo1MToxM1rOHbTCgQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMlQxMTowMDoxNVrOHbpkug==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODM4NTUzNw==", "bodyText": "I think this could really come to bite us. Mostly because it means that a raw string is not a raw string. With this, there's no way to express a literal \\\" anywhere in the string.\nThis branch allows a literal \\\":\nmatriv/elasticsearch@replace-unescaped-triple-doublequotes...rw-access:raw-string-changes", "url": "https://github.com/elastic/elasticsearch/pull/62539#discussion_r498385537", "createdAt": "2020-10-01T16:51:13Z", "author": {"login": "rw-access"}, "path": "x-pack/plugin/eql/src/main/antlr/EqlBase.g4", "diffHunk": "@@ -200,6 +200,7 @@ STRING\n     | '\"'   ('\\\\' [btnfr\"'\\\\] | ~[\\r\\n\"\\\\])* '\"'\n     | '?\"'  ('\\\\\"' |~[\"\\r\\n])* '\"'\n     | '?\\'' ('\\\\\\'' |~['\\r\\n])* '\\''\n+    | '\"\"\"' ('\\\\\"' |~[\\r\\n])*? '\"\"\"'", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "60e1b4e87bb7dd58123b4bc1c586357ee68cf748"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODM4OTgyNg==", "bodyText": "This grammar has other issues:\n\"\"\"\"\"hello\\\"\"\"world!\\\"\"\"\" == \"\"\"\"foo\"\\\"\"bar\"\"\\\"\"\"\"\n\n=>\norg.elasticsearch.xpack.eql.parser.ParsingException: line 1:21: token recognition error at: '!\\'\n\nand with the proposed solution you can have a \\\" literal if you double escape it \\\\\"", "url": "https://github.com/elastic/elasticsearch/pull/62539#discussion_r498389826", "createdAt": "2020-10-01T16:58:47Z", "author": {"login": "matriv"}, "path": "x-pack/plugin/eql/src/main/antlr/EqlBase.g4", "diffHunk": "@@ -200,6 +200,7 @@ STRING\n     | '\"'   ('\\\\' [btnfr\"'\\\\] | ~[\\r\\n\"\\\\])* '\"'\n     | '?\"'  ('\\\\\"' |~[\"\\r\\n])* '\"'\n     | '?\\'' ('\\\\\\'' |~['\\r\\n])* '\\''\n+    | '\"\"\"' ('\\\\\"' |~[\\r\\n])*? '\"\"\"'", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODM4NTUzNw=="}, "originalCommit": {"oid": "60e1b4e87bb7dd58123b4bc1c586357ee68cf748"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODM5NzM2MQ==", "bodyText": "We could replace \\\" with \" only if part of an escaped triple double quote sequence, but I think that produces more confusion for a user.", "url": "https://github.com/elastic/elasticsearch/pull/62539#discussion_r498397361", "createdAt": "2020-10-01T17:12:50Z", "author": {"login": "matriv"}, "path": "x-pack/plugin/eql/src/main/antlr/EqlBase.g4", "diffHunk": "@@ -200,6 +200,7 @@ STRING\n     | '\"'   ('\\\\' [btnfr\"'\\\\] | ~[\\r\\n\"\\\\])* '\"'\n     | '?\"'  ('\\\\\"' |~[\"\\r\\n])* '\"'\n     | '?\\'' ('\\\\\\'' |~['\\r\\n])* '\\''\n+    | '\"\"\"' ('\\\\\"' |~[\\r\\n])*? '\"\"\"'", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODM4NTUzNw=="}, "originalCommit": {"oid": "60e1b4e87bb7dd58123b4bc1c586357ee68cf748"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODU5NDIxOQ==", "bodyText": "but it should give that syntax error because it's invalid syntax. the string was completed after seeing \"\"\".\nthat sounds like the correct behavior. If we introduce any escapes at all we defeat the purpose of this being a raw string, and require some potentially complex parsing logic and strange edge cases. although I don't think we should stop immediately when seeing \"\"\" because then a string can't end with \"\"\". we could process a few more quotes after without issue.  then a string will be able to end with quotes, too.", "url": "https://github.com/elastic/elasticsearch/pull/62539#discussion_r498594219", "createdAt": "2020-10-02T02:24:17Z", "author": {"login": "rw-access"}, "path": "x-pack/plugin/eql/src/main/antlr/EqlBase.g4", "diffHunk": "@@ -200,6 +200,7 @@ STRING\n     | '\"'   ('\\\\' [btnfr\"'\\\\] | ~[\\r\\n\"\\\\])* '\"'\n     | '?\"'  ('\\\\\"' |~[\"\\r\\n])* '\"'\n     | '?\\'' ('\\\\\\'' |~['\\r\\n])* '\\''\n+    | '\"\"\"' ('\\\\\"' |~[\\r\\n])*? '\"\"\"'", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODM4NTUzNw=="}, "originalCommit": {"oid": "60e1b4e87bb7dd58123b4bc1c586357ee68cf748"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODY5NTc2Mw==", "bodyText": "\"\"\"\"\"hello\\\"\"\"world!\\\"\"\"\" it's a valid syntax, it has a closing \"\"\".\nThe previous ?\" couldn't accept any \" and every \" should be escaped.\nWith this approach we only need to escape a \"\"\" which is very rare to occur.", "url": "https://github.com/elastic/elasticsearch/pull/62539#discussion_r498695763", "createdAt": "2020-10-02T08:50:53Z", "author": {"login": "matriv"}, "path": "x-pack/plugin/eql/src/main/antlr/EqlBase.g4", "diffHunk": "@@ -200,6 +200,7 @@ STRING\n     | '\"'   ('\\\\' [btnfr\"'\\\\] | ~[\\r\\n\"\\\\])* '\"'\n     | '?\"'  ('\\\\\"' |~[\"\\r\\n])* '\"'\n     | '?\\'' ('\\\\\\'' |~['\\r\\n])* '\\''\n+    | '\"\"\"' ('\\\\\"' |~[\\r\\n])*? '\"\"\"'", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODM4NTUzNw=="}, "originalCommit": {"oid": "60e1b4e87bb7dd58123b4bc1c586357ee68cf748"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODY5NzUyMg==", "bodyText": "but at the same time... Doesn't this make it impossible to end a string with a backslash? Or to end with an unescaped quote? it also means \\\" will be interpreted as \" so you have to do \\\\\" to literally express that, which seems surprising given the expectation that the string is raw.\ndoesn't seem worth the trade-off.", "url": "https://github.com/elastic/elasticsearch/pull/62539#discussion_r498697522", "createdAt": "2020-10-02T08:54:25Z", "author": {"login": "rw-access"}, "path": "x-pack/plugin/eql/src/main/antlr/EqlBase.g4", "diffHunk": "@@ -200,6 +200,7 @@ STRING\n     | '\"'   ('\\\\' [btnfr\"'\\\\] | ~[\\r\\n\"\\\\])* '\"'\n     | '?\"'  ('\\\\\"' |~[\"\\r\\n])* '\"'\n     | '?\\'' ('\\\\\\'' |~['\\r\\n])* '\\''\n+    | '\"\"\"' ('\\\\\"' |~[\\r\\n])*? '\"\"\"'", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODM4NTUzNw=="}, "originalCommit": {"oid": "60e1b4e87bb7dd58123b4bc1c586357ee68cf748"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODcwMDUyOA==", "bodyText": "the thing I'm the most concerned with -- escape sequences mean that you could paste a string that doesn't contain \"\"\" between two sets of \"\"\" and there's a decent chance that it is accepted but matches something entirely different, if it contains a \\\" anywhere in the original text. I just think that the \\\" escape sequence makes the behavior awkward and has a net negative effect on \"\"\" strings, mostly because it means they aren't actually raw anymore.", "url": "https://github.com/elastic/elasticsearch/pull/62539#discussion_r498700528", "createdAt": "2020-10-02T09:00:02Z", "author": {"login": "rw-access"}, "path": "x-pack/plugin/eql/src/main/antlr/EqlBase.g4", "diffHunk": "@@ -200,6 +200,7 @@ STRING\n     | '\"'   ('\\\\' [btnfr\"'\\\\] | ~[\\r\\n\"\\\\])* '\"'\n     | '?\"'  ('\\\\\"' |~[\"\\r\\n])* '\"'\n     | '?\\'' ('\\\\\\'' |~['\\r\\n])* '\\''\n+    | '\"\"\"' ('\\\\\"' |~[\\r\\n])*? '\"\"\"'", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODM4NTUzNw=="}, "originalCommit": {"oid": "60e1b4e87bb7dd58123b4bc1c586357ee68cf748"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODcwODMzMw==", "bodyText": "I wonder if this is also an edge case:\nhow do these compare? I think with the current pattern with the \\\" escape, the first one is valid syntax but the second one is not? which means the interpretation of a string depends if there's another \"\"\" later in the source text.\n\"\"\"my raw string\\\"\"\" == \"abc\"\n\"\"\"my raw string\\\"\"\" == \"\"\"abc\"\"\"", "url": "https://github.com/elastic/elasticsearch/pull/62539#discussion_r498708333", "createdAt": "2020-10-02T09:15:53Z", "author": {"login": "rw-access"}, "path": "x-pack/plugin/eql/src/main/antlr/EqlBase.g4", "diffHunk": "@@ -200,6 +200,7 @@ STRING\n     | '\"'   ('\\\\' [btnfr\"'\\\\] | ~[\\r\\n\"\\\\])* '\"'\n     | '?\"'  ('\\\\\"' |~[\"\\r\\n])* '\"'\n     | '?\\'' ('\\\\\\'' |~['\\r\\n])* '\\''\n+    | '\"\"\"' ('\\\\\"' |~[\\r\\n])*? '\"\"\"'", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODM4NTUzNw=="}, "originalCommit": {"oid": "60e1b4e87bb7dd58123b4bc1c586357ee68cf748"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODcxMDU0Mg==", "bodyText": "", "url": "https://github.com/elastic/elasticsearch/pull/62539#discussion_r498710542", "createdAt": "2020-10-02T09:20:22Z", "author": {"login": "rw-access"}, "path": "x-pack/plugin/eql/src/main/antlr/EqlBase.g4", "diffHunk": "@@ -200,6 +200,7 @@ STRING\n     | '\"'   ('\\\\' [btnfr\"'\\\\] | ~[\\r\\n\"\\\\])* '\"'\n     | '?\"'  ('\\\\\"' |~[\"\\r\\n])* '\"'\n     | '?\\'' ('\\\\\\'' |~['\\r\\n])* '\\''\n+    | '\"\"\"' ('\\\\\"' |~[\\r\\n])*? '\"\"\"'", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODM4NTUzNw=="}, "originalCommit": {"oid": "60e1b4e87bb7dd58123b4bc1c586357ee68cf748"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODcxNzUzOA==", "bodyText": "I can't think of a better solution myself. The \" is something you need to escape even with the current syntax of ?\".\nThe current proposal with \"\"\" allows to have unescaped \" within the string apart from the last char where it needs to be escaped. Using another character to escape \" like double \"\" won't work and to my eyes seems more weird for a raw string. I think I have exhaustive examples now in the tests, so I'm happy if you want to also try with different patterns in the grammar if we can end up with some better behaviour.", "url": "https://github.com/elastic/elasticsearch/pull/62539#discussion_r498717538", "createdAt": "2020-10-02T09:35:10Z", "author": {"login": "matriv"}, "path": "x-pack/plugin/eql/src/main/antlr/EqlBase.g4", "diffHunk": "@@ -200,6 +200,7 @@ STRING\n     | '\"'   ('\\\\' [btnfr\"'\\\\] | ~[\\r\\n\"\\\\])* '\"'\n     | '?\"'  ('\\\\\"' |~[\"\\r\\n])* '\"'\n     | '?\\'' ('\\\\\\'' |~['\\r\\n])* '\\''\n+    | '\"\"\"' ('\\\\\"' |~[\\r\\n])*? '\"\"\"'", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODM4NTUzNw=="}, "originalCommit": {"oid": "60e1b4e87bb7dd58123b4bc1c586357ee68cf748"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODcyNDU1NQ==", "bodyText": "There are a number of issues at hand:\n\n\" is a common character. To avoid escaping it too often, the raw string relies on 3 triple quotes \"\"\". This however can become a problem at the end of the raw string where a trailing \" can mess up quoting\n\" are allowed inside and can be escaped to avoid closing a string \"\"\" through \\. This again is it occurs at the end of the string.\n\nTo wit:\n\n\"\"\" dir \"c:\\dir\"\"\"\" <-- 4 ending quotes\n\"\"\" dir c:\\dir\\\"\"\"  <-- \\ escapes the \"\"\"\n\nDue to file paths on windows 2, aka \\\" is likely a common occurrence.\nI see several options to solve this:\nA. Require raw strings to not end with \" and advice folks to add a space for example:\n\"\"\" dir \"c:\\dir\" \"\"\"\nB. Use a different escape character from \\, say |. It solves 2 but not 1.\nC. Do not allow escaping inside raw strings. This solves 2 but not 1.\nD. Use a different set for quoting characters. Say \"?\"\"and\"\"?`. However this does not solve the problem, rather just minimizes the occurrences in which they appear. Which might be a win in itself.\nConsidering \\ is traditionally used for escaping and in Window paths, I have a preference for C over B. That's because introducing a new character for escaping is surprising and might backfire again depending on the raw string .\nB however mean that one cannot escape \"\"\" inside a raw string but then for that there's the regular string definition. Unfortunately this doesn't solve 1 either...", "url": "https://github.com/elastic/elasticsearch/pull/62539#discussion_r498724555", "createdAt": "2020-10-02T09:50:12Z", "author": {"login": "costin"}, "path": "x-pack/plugin/eql/src/main/antlr/EqlBase.g4", "diffHunk": "@@ -200,6 +200,7 @@ STRING\n     | '\"'   ('\\\\' [btnfr\"'\\\\] | ~[\\r\\n\"\\\\])* '\"'\n     | '?\"'  ('\\\\\"' |~[\"\\r\\n])* '\"'\n     | '?\\'' ('\\\\\\'' |~['\\r\\n])* '\\''\n+    | '\"\"\"' ('\\\\\"' |~[\\r\\n])*? '\"\"\"'", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODM4NTUzNw=="}, "originalCommit": {"oid": "60e1b4e87bb7dd58123b4bc1c586357ee68cf748"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODcyODI2Nw==", "bodyText": "A. I thing introducing a mandatory whitespace can lead to other issues, and is it only one space? what happens with more spaces, we keep all but one?, or with tabs?\nB. I also don't like a new escape char, doesn't address the main issue no1.\nD. I definitely don't like D since it still contains the ? char which usually refers to regex or query param.\nC. I'm ok with C so if a user needs to escape chars or needs a \"\"\", he/she has to resort to the normal \".....\" syntax and properly escape what's needed.", "url": "https://github.com/elastic/elasticsearch/pull/62539#discussion_r498728267", "createdAt": "2020-10-02T09:58:11Z", "author": {"login": "matriv"}, "path": "x-pack/plugin/eql/src/main/antlr/EqlBase.g4", "diffHunk": "@@ -200,6 +200,7 @@ STRING\n     | '\"'   ('\\\\' [btnfr\"'\\\\] | ~[\\r\\n\"\\\\])* '\"'\n     | '?\"'  ('\\\\\"' |~[\"\\r\\n])* '\"'\n     | '?\\'' ('\\\\\\'' |~['\\r\\n])* '\\''\n+    | '\"\"\"' ('\\\\\"' |~[\\r\\n])*? '\"\"\"'", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODM4NTUzNw=="}, "originalCommit": {"oid": "60e1b4e87bb7dd58123b4bc1c586357ee68cf748"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODcyOTI4OQ==", "bodyText": "option E:\nAllow for two optional additional trailing quotes with no escape sequences. then you can solve the trailing quotes issue without escapes.\nThe string can't contain \"\"\" anywhere inside.  If you ever need to write a string with that sequence, a raw string is insufficient, so users will need to switch to a traditional escaped \" string.\n\"\"\"[^\\r\\n]*?\"\"\"\"?\"?\n\n\nand it doesn't suffer from these contextual issues with \\\"", "url": "https://github.com/elastic/elasticsearch/pull/62539#discussion_r498729289", "createdAt": "2020-10-02T10:00:21Z", "author": {"login": "rw-access"}, "path": "x-pack/plugin/eql/src/main/antlr/EqlBase.g4", "diffHunk": "@@ -200,6 +200,7 @@ STRING\n     | '\"'   ('\\\\' [btnfr\"'\\\\] | ~[\\r\\n\"\\\\])* '\"'\n     | '?\"'  ('\\\\\"' |~[\"\\r\\n])* '\"'\n     | '?\\'' ('\\\\\\'' |~['\\r\\n])* '\\''\n+    | '\"\"\"' ('\\\\\"' |~[\\r\\n])*? '\"\"\"'", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODM4NTUzNw=="}, "originalCommit": {"oid": "60e1b4e87bb7dd58123b4bc1c586357ee68cf748"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODczMjkwMA==", "bodyText": "confirmed that \"\"\" isn't allowed anywhere in the string but \"\" is;", "url": "https://github.com/elastic/elasticsearch/pull/62539#discussion_r498732900", "createdAt": "2020-10-02T10:08:57Z", "author": {"login": "rw-access"}, "path": "x-pack/plugin/eql/src/main/antlr/EqlBase.g4", "diffHunk": "@@ -200,6 +200,7 @@ STRING\n     | '\"'   ('\\\\' [btnfr\"'\\\\] | ~[\\r\\n\"\\\\])* '\"'\n     | '?\"'  ('\\\\\"' |~[\"\\r\\n])* '\"'\n     | '?\\'' ('\\\\\\'' |~['\\r\\n])* '\\''\n+    | '\"\"\"' ('\\\\\"' |~[\\r\\n])*? '\"\"\"'", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODM4NTUzNw=="}, "originalCommit": {"oid": "60e1b4e87bb7dd58123b4bc1c586357ee68cf748"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODc1NDc0Ng==", "bodyText": "@rw-access I'm also happy with that, pushed the change and fixed all relevant tests.", "url": "https://github.com/elastic/elasticsearch/pull/62539#discussion_r498754746", "createdAt": "2020-10-02T11:00:15Z", "author": {"login": "matriv"}, "path": "x-pack/plugin/eql/src/main/antlr/EqlBase.g4", "diffHunk": "@@ -200,6 +200,7 @@ STRING\n     | '\"'   ('\\\\' [btnfr\"'\\\\] | ~[\\r\\n\"\\\\])* '\"'\n     | '?\"'  ('\\\\\"' |~[\"\\r\\n])* '\"'\n     | '?\\'' ('\\\\\\'' |~['\\r\\n])* '\\''\n+    | '\"\"\"' ('\\\\\"' |~[\\r\\n])*? '\"\"\"'", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODM4NTUzNw=="}, "originalCommit": {"oid": "60e1b4e87bb7dd58123b4bc1c586357ee68cf748"}, "originalPosition": 4}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3544, "cost": 1, "resetAt": "2021-11-12T13:16:51Z"}}}