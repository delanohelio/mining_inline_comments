{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk3NzI2ODIw", "number": 54669, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wM1QxMzowODozOFrODuXqyA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wM1QxMzoxNDoxMVrODuXzQA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ5OTQ4ODcyOnYy", "diffSide": "RIGHT", "path": "server/src/main/java/org/elasticsearch/action/bulk/TransportBulkAction.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wM1QxMzowODozOFrOGAUsgQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wM1QxMzowODozOFrOGAUsgQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjk5MjI1Nw==", "bodyText": "Should we also check v2 templates here, if default/final pipeline has been specified? If so then I think it is fine to do this in a follow up pr.", "url": "https://github.com/elastic/elasticsearch/pull/54669#discussion_r402992257", "createdAt": "2020-04-03T13:08:38Z", "author": {"login": "martijnvg"}, "path": "server/src/main/java/org/elasticsearch/action/bulk/TransportBulkAction.java", "diffHunk": "@@ -307,7 +307,7 @@ static boolean resolvePipelines(final DocWriteRequest<?> originalRequest, final\n                 }\n             } else if (indexRequest.index() != null) {\n                 // the index does not exist yet (and this is a valid request), so match index templates to look for pipelines\n-                List<IndexTemplateMetadata> templates = MetadataIndexTemplateService.findTemplates(metadata, indexRequest.index(), null);\n+                List<IndexTemplateMetadata> templates = MetadataIndexTemplateService.findV1Templates(metadata, indexRequest.index(), null);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "180cd169afaf82f93973aa4562d3028f091f1c7e"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ5OTQ5MzA5OnYy", "diffSide": "RIGHT", "path": "server/src/main/java/org/elasticsearch/action/admin/indices/rollover/MetadataRolloverService.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wM1QxMzowOTo0MVrOGAUvNA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wM1QxNTozNDoyOVrOGAat8A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjk5Mjk0OA==", "bodyText": "Should we check v2 templates here too? If so, then I think it is ok to do this in a followup change as well.", "url": "https://github.com/elastic/elasticsearch/pull/54669#discussion_r402992948", "createdAt": "2020-04-03T13:09:41Z", "author": {"login": "martijnvg"}, "path": "server/src/main/java/org/elasticsearch/action/admin/indices/rollover/MetadataRolloverService.java", "diffHunk": "@@ -161,10 +161,9 @@ static CreateIndexClusterStateUpdateRequest prepareCreateIndexRequest(final Stri\n      * the rollover alias will point to multiple indices. This causes indexing requests to be rejected.\n      * To avoid this, we make sure that there is no duplicated alias in index templates before creating a new index.\n      */\n-    static void checkNoDuplicatedAliasInIndexTemplate(\n-            Metadata metadata, String rolloverIndexName, String rolloverRequestAlias,\n-            @Nullable Boolean isHidden) {\n-        final List<IndexTemplateMetadata> matchedTemplates = findTemplates(metadata, rolloverIndexName, isHidden);\n+    static void checkNoDuplicatedAliasInIndexTemplate(Metadata metadata, String rolloverIndexName, String rolloverRequestAlias,\n+                                                      @Nullable Boolean isHidden) {\n+        final List<IndexTemplateMetadata> matchedTemplates = findV1Templates(metadata, rolloverIndexName, isHidden);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "180cd169afaf82f93973aa4562d3028f091f1c7e"}, "originalPosition": 19}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzA5MDkyOA==", "bodyText": "Definitely, I'll be addressing these in followups!", "url": "https://github.com/elastic/elasticsearch/pull/54669#discussion_r403090928", "createdAt": "2020-04-03T15:34:29Z", "author": {"login": "dakrone"}, "path": "server/src/main/java/org/elasticsearch/action/admin/indices/rollover/MetadataRolloverService.java", "diffHunk": "@@ -161,10 +161,9 @@ static CreateIndexClusterStateUpdateRequest prepareCreateIndexRequest(final Stri\n      * the rollover alias will point to multiple indices. This causes indexing requests to be rejected.\n      * To avoid this, we make sure that there is no duplicated alias in index templates before creating a new index.\n      */\n-    static void checkNoDuplicatedAliasInIndexTemplate(\n-            Metadata metadata, String rolloverIndexName, String rolloverRequestAlias,\n-            @Nullable Boolean isHidden) {\n-        final List<IndexTemplateMetadata> matchedTemplates = findTemplates(metadata, rolloverIndexName, isHidden);\n+    static void checkNoDuplicatedAliasInIndexTemplate(Metadata metadata, String rolloverIndexName, String rolloverRequestAlias,\n+                                                      @Nullable Boolean isHidden) {\n+        final List<IndexTemplateMetadata> matchedTemplates = findV1Templates(metadata, rolloverIndexName, isHidden);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjk5Mjk0OA=="}, "originalCommit": {"oid": "180cd169afaf82f93973aa4562d3028f091f1c7e"}, "originalPosition": 19}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ5OTUxMDQwOnYy", "diffSide": "LEFT", "path": "server/src/main/java/org/elasticsearch/cluster/metadata/MetadataIndexTemplateService.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wM1QxMzoxNDoxMVrOGAU59A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wM1QxNTozNDowOVrOGAatCg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjk5NTcwMA==", "bodyText": "Maybe leave the todo? I think we still need to validate whether templates with the same priority exist that have overlapping patterns?", "url": "https://github.com/elastic/elasticsearch/pull/54669#discussion_r402995700", "createdAt": "2020-04-03T13:14:11Z", "author": {"login": "martijnvg"}, "path": "server/src/main/java/org/elasticsearch/cluster/metadata/MetadataIndexTemplateService.java", "diffHunk": "@@ -295,12 +320,41 @@ static ClusterState addIndexTemplateV2(final ClusterState currentState, final bo\n             deprecationLogger.deprecated(warning);\n         }\n \n-        // TODO: validation of index template", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "180cd169afaf82f93973aa4562d3028f091f1c7e"}, "originalPosition": 77}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzA5MDY5OA==", "bodyText": "This todo was for validating the mappings and settings in an index template (which this PR adds), we have a TODO item in the list on #53101 to make sure explicitly add the check for overlapping v2 template, so no need to worry!", "url": "https://github.com/elastic/elasticsearch/pull/54669#discussion_r403090698", "createdAt": "2020-04-03T15:34:09Z", "author": {"login": "dakrone"}, "path": "server/src/main/java/org/elasticsearch/cluster/metadata/MetadataIndexTemplateService.java", "diffHunk": "@@ -295,12 +320,41 @@ static ClusterState addIndexTemplateV2(final ClusterState currentState, final bo\n             deprecationLogger.deprecated(warning);\n         }\n \n-        // TODO: validation of index template", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjk5NTcwMA=="}, "originalCommit": {"oid": "180cd169afaf82f93973aa4562d3028f091f1c7e"}, "originalPosition": 77}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3970, "cost": 1, "resetAt": "2021-11-12T13:16:51Z"}}}