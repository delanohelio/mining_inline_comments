{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg0NDYzMzI2", "number": 53184, "title": "Ensure only plugin REST tests are run for plugins", "bodyText": "This commit fixes ensures that for external builds\n(e.g. plugin development) that the REST tests that are\ncopied are properly filtered to only include the API\nby default.\nThe code prior to this change resulted in including both\nthe API and tests since the copy.include resulted as an\nempty list by default since the stream is empty unless\nexplictly configured.\nrelated #52114\nfixes #53183\n\nNote - this is how I tested\n# from elasticsearch directory\n./gradlew :build-tools:publishToMavenLocal\n\n./gradlew :rest-api-spec:publishToMavenLocal :test:framework:publishToMavenLocal :server:publishToMavenLocal :libs:elasticsearch-core:publishToMavenLocal :libs:elasticsearch-x-content:publishToMavenLocal :libs:elasticsearch-cli:publishToMavenLocal :libs:elasticsearch-nio:publishToMavenLocal :libs:elasticsearch-geo:publishToMavenLocal :libs:elasticsearch-secure-sm:publishToMavenLocal :distribution:archives:integ-test-zip:publishToMavenLocal :client:rest:publishToMavenLocal :client:sniffer:publishToMavenLocal :test:logger-usage:publishToMavenLocal\n\n\n\nWe can use @spinscale 's cookie cutter to help create a test project\n# requires python3\npip3 install cookiecutter\ncookiecutter gh:spinscale/cookiecutter-elasticsearch-ingest-processor\n# Add the master version when it asks: elasticsearch_version [7.6.1]: 8.0.0-SNAPSHOT\ncd ingest-awesome\n# Add to the build.gradle\nrepositories {\n   mavenLocal()\n}\n./gradlew check", "createdAt": "2020-03-05T19:39:43Z", "url": "https://github.com/elastic/elasticsearch/pull/53184", "merged": true, "mergeCommit": {"oid": "484372ada2c440c0161da7c59d8fec85a29fc41d"}, "closed": true, "closedAt": "2020-03-05T22:15:07Z", "author": {"login": "jakelandis"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcKwu1-AH2gAyMzg0NDYzMzI2OjY2ZDVmMzI0NjQyZWVkZTBiZGIzYzI2MjM2ZjY4NWVhZmY4YjFhNWQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcKxhkEAH2gAyMzg0NDYzMzI2Ojk3ZWFhNjM1YmRhNmRiZDRiMjFmNmE1M2IwODAxMDEwNDcyNWQyZjI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "66d5f324642eede0bdb3c26236f685eaff8b1a5d", "author": {"user": {"login": "jakelandis", "name": "Jake Landis"}}, "url": "https://github.com/elastic/elasticsearch/commit/66d5f324642eede0bdb3c26236f685eaff8b1a5d", "committedDate": "2020-03-05T19:31:56Z", "message": "Ensure only plugin REST tests are run for plugins\n\nThis commit fixes ensures that for external builds\n(e.g. plugin development) that the REST tests that are\ncopied are properly filtered to only include the API\nby default.\n\nThe code prior to this change resulted in including both\nthe API and tests since the copy.include resulted as an\nempty list by default since the stream is empty unless\nexplictly configured.\n\nrelated #52114"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY5ODY0MjQ2", "url": "https://github.com/elastic/elasticsearch/pull/53184#pullrequestreview-369864246", "createdAt": "2020-03-05T19:47:54Z", "commit": {"oid": "66d5f324642eede0bdb3c26236f685eaff8b1a5d"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQxOTo0Nzo1NFrOFyhoPw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQxOTo0Nzo1NFrOFyhoPw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODUyNDA5NQ==", "bodyText": "The fact we are calling the path prefix for api specs COPY_TO I think makes this hard to follow. I'm thinking \"why are we referencing the copy destination when filtering sources?\". If we are going to use this constant for both purposes, we should rename it appropriately, something like API_SPEC_PREFIX.", "url": "https://github.com/elastic/elasticsearch/pull/53184#discussion_r388524095", "createdAt": "2020-03-05T19:47:54Z", "author": {"login": "mark-vieira"}, "path": "buildSrc/src/main/java/org/elasticsearch/gradle/test/rest/CopyRestApiTask.java", "diffHunk": "@@ -132,7 +132,11 @@ void copy() {\n             project.copy(c -> {\n                 c.from(project.zipTree(coreConfig.getSingleFile()));\n                 c.into(getTestSourceSet().getOutput().getResourcesDir()); // this ends up as the same dir as outputDir\n-                c.include(includeCore.get().stream().map(prefix -> COPY_TO + \"/\" + prefix + \"*/**\").collect(Collectors.toList()));\n+                if (includeCore.get().isEmpty()) {\n+                    c.include(COPY_TO + \"/**\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "66d5f324642eede0bdb3c26236f685eaff8b1a5d"}, "originalPosition": 6}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f8459c9420d05ec90b70bbc75401ea5e1d84254e", "author": {"user": {"login": "jakelandis", "name": "Jake Landis"}}, "url": "https://github.com/elastic/elasticsearch/commit/f8459c9420d05ec90b70bbc75401ea5e1d84254e", "committedDate": "2020-03-05T20:12:30Z", "message": "rename some variables"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "97eaa635bda6dbd4b21f6a53b08010104725d2f2", "author": {"user": {"login": "jakelandis", "name": "Jake Landis"}}, "url": "https://github.com/elastic/elasticsearch/commit/97eaa635bda6dbd4b21f6a53b08010104725d2f2", "committedDate": "2020-03-05T20:27:20Z", "message": "over the line Smokey"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1807, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}