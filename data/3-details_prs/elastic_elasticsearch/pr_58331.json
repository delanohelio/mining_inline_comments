{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM2NTAxNDY1", "number": 58331, "title": "[ML] Make regression training set predictable in size", "bodyText": "Unlike classification, which is using a cross validation splitter\nthat produces training sets whose size is predictable and equal to\ntraining_percent * class_cardinality, for regression we have been\nusing a random splitter that takes an independent decision for each\ndocument. This means we cannot predict the exact size of the training\nset. This poses a problem as we move towards performing test inference\non the java side as we need to be able to provide an accurate upper\nbound of the training set size to the c++ process.\nThis commit replaces the random splitter we use for regression with\nthe same streaming-reservoir approach we do for classification.", "createdAt": "2020-06-18T14:12:55Z", "url": "https://github.com/elastic/elasticsearch/pull/58331", "merged": true, "mergeCommit": {"oid": "0fa0d5ec44331db7b8bd6c31f08eddfbb052fa3b"}, "closed": true, "closedAt": "2020-06-23T15:59:36Z", "author": {"login": "dimitris-athanasiou"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcsf6njAH2gAyNDM2NTAxNDY1OjlmMjU2YzM0MDk5MzYyNzEzYWY4Y2YxZTFjZDRmMThkNjY1ZjFkOTU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcuGK0pgH2gAyNDM2NTAxNDY1OmYyZWJkMDM0YmI1ZWIzMGFiNWNiNjg0OTcwNjU4NjVmZjcwYzRhYTM=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "9f256c34099362713af8cf1e1cd4f18d665f1d95", "author": {"user": {"login": "dimitris-athanasiou", "name": "Dimitris Athanasiou"}}, "url": "https://github.com/elastic/elasticsearch/commit/9f256c34099362713af8cf1e1cd4f18d665f1d95", "committedDate": "2020-06-18T15:09:50Z", "message": "[ML] Make regression training set predictable in size\n\nUnlike `classification`, which is using a cross validation splitter\nthat produces training sets whose size is predictable and equal to\n`training_percent * class_cardinality`, for regression we have been\nusing a random splitter that takes an independent decision for each\ndocument. This means we cannot predict the exact size of the training\nset. This poses a problem as we move towards performing test inference\non the java side as we need to be able to provide an accurate upper\nbound of the training set size to the c++ process.\n\nThis commit replaces the random splitter we use for regression with\nthe same streaming-reservoir approach we do for `classification`."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ff482b3089b44a7cfce2066fa3b48aa023405966", "author": {"user": {"login": "dimitris-athanasiou", "name": "Dimitris Athanasiou"}}, "url": "https://github.com/elastic/elasticsearch/commit/ff482b3089b44a7cfce2066fa3b48aa023405966", "committedDate": "2020-06-18T13:28:55Z", "message": "[ML] Make regression training set predictable in size\n\nUnlike `classification`, which is using a cross validation splitter\nthat produces training sets whose size is predictable and equal to\n`training_percent * class_cardinality`, for regression we have been\nusing a random splitter that takes an independent decision for each\ndocument. This means we cannot predict the exact size of the training\nset. This poses a problem as we move towards performing test inference\non the java side as we need to be able to provide an accurate upper\nbound of the training set size to the c++ process.\n\nThis commit replaces the random splitter we use for regression with\nthe same streaming-reservoir approach we do for `classification`."}, "afterCommit": {"oid": "9f256c34099362713af8cf1e1cd4f18d665f1d95", "author": {"user": {"login": "dimitris-athanasiou", "name": "Dimitris Athanasiou"}}, "url": "https://github.com/elastic/elasticsearch/commit/9f256c34099362713af8cf1e1cd4f18d665f1d95", "committedDate": "2020-06-18T15:09:50Z", "message": "[ML] Make regression training set predictable in size\n\nUnlike `classification`, which is using a cross validation splitter\nthat produces training sets whose size is predictable and equal to\n`training_percent * class_cardinality`, for regression we have been\nusing a random splitter that takes an independent decision for each\ndocument. This means we cannot predict the exact size of the training\nset. This poses a problem as we move towards performing test inference\non the java side as we need to be able to provide an accurate upper\nbound of the training set size to the c++ process.\n\nThis commit replaces the random splitter we use for regression with\nthe same streaming-reservoir approach we do for `classification`."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMzMzkwNTE5", "url": "https://github.com/elastic/elasticsearch/pull/58331#pullrequestreview-433390519", "createdAt": "2020-06-18T15:18:32Z", "commit": {"oid": "9f256c34099362713af8cf1e1cd4f18d665f1d95"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOFQxNToxODozMlrOGl0PEQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOFQxNToxODozMlrOGl0PEQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjMwNjMyMQ==", "bodyText": "I always double take when I read cardinality in the SampleInfo and here in this class.\nThe scope what what cardinality we are checking is unclear. Usually when I read cardinality I associate it with the  number of classes. But in this case, cardinality is the count of documents in our specific class", "url": "https://github.com/elastic/elasticsearch/pull/58331#discussion_r442306321", "createdAt": "2020-06-18T15:18:32Z", "author": {"login": "benwtrent"}, "path": "x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/dataframe/process/crossvalidation/SingleClassReservoirCrossValidationSplitter.java", "diffHunk": "@@ -0,0 +1,25 @@\n+/*\n+ * Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one\n+ * or more contributor license agreements. Licensed under the Elastic License;\n+ * you may not use this file except in compliance with the Elastic License.\n+ */\n+\n+package org.elasticsearch.xpack.ml.dataframe.process.crossvalidation;\n+\n+import java.util.List;\n+\n+public class SingleClassReservoirCrossValidationSplitter extends AbstractReservoirCrossValidationSplitter {\n+\n+    private final SampleInfo sampleInfo;\n+\n+    SingleClassReservoirCrossValidationSplitter(List<String> fieldNames, String dependentVariable, double trainingPercent,\n+                                                long randomizeSeed, long trainingCardinality) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9f256c34099362713af8cf1e1cd4f18d665f1d95"}, "originalPosition": 16}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5cface2f9f4a081204380b03cc514c0cf39124c9", "author": {"user": {"login": "dimitris-athanasiou", "name": "Dimitris Athanasiou"}}, "url": "https://github.com/elastic/elasticsearch/commit/5cface2f9f4a081204380b03cc514c0cf39124c9", "committedDate": "2020-06-23T13:33:02Z", "message": "Use count instead of cardinality"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f2ebd034bb5eb30ab5cb68497065865ff70c4aa3", "author": {"user": {"login": "elasticmachine", "name": "Elastic Machine"}}, "url": "https://github.com/elastic/elasticsearch/commit/f2ebd034bb5eb30ab5cb68497065865ff70c4aa3", "committedDate": "2020-06-23T14:17:51Z", "message": "Merge branch 'master' into make-regression-training-set-predictable-in-size"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 465, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}