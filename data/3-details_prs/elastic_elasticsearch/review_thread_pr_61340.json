{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDcwMjc5MDI1", "number": 61340, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMFQwODoyNDoxMlrOEaZoPA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMFQwODoyNToxM1rOEaZqgQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk2MTE4MzMyOnYy", "diffSide": "RIGHT", "path": "x-pack/qa/rolling-upgrade/src/test/java/org/elasticsearch/upgrades/MlMappingsUpgradeIT.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMFQwODoyNDoxMlrOHDzt8g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMVQxMTo0NDowOFrOHKyg9Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3Mzc1NTEyMg==", "bodyText": "Could using XContentMapValues::extractValue method make this more concise?", "url": "https://github.com/elastic/elasticsearch/pull/61340#discussion_r473755122", "createdAt": "2020-08-20T08:24:12Z", "author": {"login": "przemekwitek"}, "path": "x-pack/qa/rolling-upgrade/src/test/java/org/elasticsearch/upgrades/MlMappingsUpgradeIT.java", "diffHunk": "@@ -105,8 +120,40 @@ private void assertUpgradedMappings() throws Exception {\n             assertNotNull(propertiesLevel);\n             // TODO: as the years go by, the field we assert on here should be changed\n             // to the most recent field we've added that is NOT of type \"keyword\"\n-            Map<String, Object> fieldLevel = (Map<String, Object>) propertiesLevel.get(\"multi_bucket_impact\");\n-            assertEquals(Collections.singletonMap(\"type\", \"double\"), fieldLevel);\n+            Map<String, Object> objectLevel = (Map<String, Object>) propertiesLevel.get(\"model_size_stats\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8a6ec37484d26e55993f96fdcc3ca8324f5f526c"}, "originalPosition": 40}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTA3NTQ0NQ==", "bodyText": "Yes, good point.  I switched over to that.", "url": "https://github.com/elastic/elasticsearch/pull/61340#discussion_r481075445", "createdAt": "2020-09-01T11:44:08Z", "author": {"login": "droberts195"}, "path": "x-pack/qa/rolling-upgrade/src/test/java/org/elasticsearch/upgrades/MlMappingsUpgradeIT.java", "diffHunk": "@@ -105,8 +120,40 @@ private void assertUpgradedMappings() throws Exception {\n             assertNotNull(propertiesLevel);\n             // TODO: as the years go by, the field we assert on here should be changed\n             // to the most recent field we've added that is NOT of type \"keyword\"\n-            Map<String, Object> fieldLevel = (Map<String, Object>) propertiesLevel.get(\"multi_bucket_impact\");\n-            assertEquals(Collections.singletonMap(\"type\", \"double\"), fieldLevel);\n+            Map<String, Object> objectLevel = (Map<String, Object>) propertiesLevel.get(\"model_size_stats\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3Mzc1NTEyMg=="}, "originalCommit": {"oid": "8a6ec37484d26e55993f96fdcc3ca8324f5f526c"}, "originalPosition": 40}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk2MTE4OTEzOnYy", "diffSide": "RIGHT", "path": "x-pack/qa/rolling-upgrade/src/test/java/org/elasticsearch/upgrades/MlMappingsUpgradeIT.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMFQwODoyNToxM1rOHDzxow==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMFQwODoyNToxM1rOHDzxow==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3Mzc1NjA2Nw==", "bodyText": "The same here, could XContentMapValues::extractValue be used instead of this sequence of gets and casts?", "url": "https://github.com/elastic/elasticsearch/pull/61340#discussion_r473756067", "createdAt": "2020-08-20T08:25:13Z", "author": {"login": "przemekwitek"}, "path": "x-pack/qa/rolling-upgrade/src/test/java/org/elasticsearch/upgrades/MlMappingsUpgradeIT.java", "diffHunk": "@@ -105,8 +120,40 @@ private void assertUpgradedMappings() throws Exception {\n             assertNotNull(propertiesLevel);\n             // TODO: as the years go by, the field we assert on here should be changed\n             // to the most recent field we've added that is NOT of type \"keyword\"\n-            Map<String, Object> fieldLevel = (Map<String, Object>) propertiesLevel.get(\"multi_bucket_impact\");\n-            assertEquals(Collections.singletonMap(\"type\", \"double\"), fieldLevel);\n+            Map<String, Object> objectLevel = (Map<String, Object>) propertiesLevel.get(\"model_size_stats\");\n+            assertNotNull(objectLevel);\n+            Map<String, Object> propertiesLevel2 = (Map<String, Object>) objectLevel.get(\"properties\");\n+            assertNotNull(propertiesLevel2);\n+            Map<String, Object> fieldLevel = (Map<String, Object>) propertiesLevel2.get(\"peak_model_bytes\");\n+            assertEquals(Collections.singletonMap(\"type\", \"long\"), fieldLevel);\n+        });\n+    }\n+\n+    @SuppressWarnings(\"unchecked\")\n+    private void assertUpgradedConfigMappings() throws Exception {\n+\n+        assertBusy(() -> {\n+            Request getMappings = new Request(\"GET\", \".ml-config/_mappings\");\n+            Response response = client().performRequest(getMappings);\n+\n+            Map<String, Object> responseLevel = entityAsMap(response);\n+            assertNotNull(responseLevel);\n+            Map<String, Object> indexLevel = (Map<String, Object>) responseLevel.get(\".ml-config\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8a6ec37484d26e55993f96fdcc3ca8324f5f526c"}, "originalPosition": 58}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 855, "cost": 1, "resetAt": "2021-11-12T11:57:46Z"}}}