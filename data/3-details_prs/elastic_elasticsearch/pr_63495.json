{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDk5OTk0Mzc0", "number": 63495, "title": "Enable collapse on unsigned_long field", "bodyText": "Collapse was not working on unsigned_long field,\nas collapsing was enabled only on KeywordFieldType and NumberFieldType.\nThis introduces a new method collapseType to MappedFieldType,\nthat is checked to decide if collapsing should be enabled.\nRelates to #60050", "createdAt": "2020-10-08T15:06:35Z", "url": "https://github.com/elastic/elasticsearch/pull/63495", "merged": true, "mergeCommit": {"oid": "3d3837da1417bba274bb12ab56ac42f2fe5d4188"}, "closed": true, "closedAt": "2020-10-16T14:06:36Z", "author": {"login": "mayya-sharipova"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdQi7izAH2gAyNDk5OTk0Mzc0OjBlMmI0YzQyM2E0ODlkNzBiZGI2Y2NkNDBjN2VlYzM5NjZlMzk2ZWM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdTCMK7AFqTUxMDI2MzEwNQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "0e2b4c423a489d70bdb6ccd40c7eec3966e396ec", "author": {"user": {"login": "mayya-sharipova", "name": "Mayya Sharipova"}}, "url": "https://github.com/elastic/elasticsearch/commit/0e2b4c423a489d70bdb6ccd40c7eec3966e396ec", "committedDate": "2020-10-08T15:01:50Z", "message": "Enabled collapse on unsigned_long field\n\nCollapse was not working on unsigned_long field,\nas collapsing was enabled only on KeywordFieldType and NumberFieldType.\n\nThis introduces a new method `collapseType` to MappedFieldType,\nthat is checked to decide if collapsing should be enabled.\n\nRelates to #60050"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA4MzIyOTM0", "url": "https://github.com/elastic/elasticsearch/pull/63495#pullrequestreview-508322934", "createdAt": "2020-10-14T13:05:18Z", "commit": {"oid": "0e2b4c423a489d70bdb6ccd40c7eec3966e396ec"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNFQxMzowNToxOVrOHhR_gQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNFQxMzowNToxOVrOHhR_gQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDY1OTg0MQ==", "bodyText": "Should we keep adding the field name to the error message to make it more actionable? Maybe we also have the actual field type available here to add to the error?", "url": "https://github.com/elastic/elasticsearch/pull/63495#discussion_r504659841", "createdAt": "2020-10-14T13:05:19Z", "author": {"login": "cbuescher"}, "path": "server/src/main/java/org/elasticsearch/search/collapse/CollapseBuilder.java", "diffHunk": "@@ -203,12 +202,9 @@ public CollapseContext build(QueryShardContext queryShardContext) {\n         if (fieldType == null) {\n             throw new IllegalArgumentException(\"no mapping found for `\" + field + \"` in order to collapse on\");\n         }\n-        if (fieldType instanceof KeywordFieldMapper.KeywordFieldType == false &&\n-            fieldType instanceof NumberFieldMapper.NumberFieldType == false) {\n-            throw new IllegalArgumentException(\"unknown type for collapse field `\" + field +\n-                \"`, only keywords and numbers are accepted\");\n+        if (fieldType.collapseType() == CollapseType.NONE) {\n+            throw new IllegalArgumentException(\"collapse is not supported on this field type\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0e2b4c423a489d70bdb6ccd40c7eec3966e396ec"}, "originalPosition": 22}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "621992c7551fffdd6f4cf76eeabb055906d3eacc", "author": {"user": {"login": "mayya-sharipova", "name": "Mayya Sharipova"}}, "url": "https://github.com/elastic/elasticsearch/commit/621992c7551fffdd6f4cf76eeabb055906d3eacc", "committedDate": "2020-10-15T19:38:51Z", "message": "Change error message to include field name and type"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fcfe48edcd0189a84c1067aa097c9ba79e35b1c2", "author": {"user": {"login": "mayya-sharipova", "name": "Mayya Sharipova"}}, "url": "https://github.com/elastic/elasticsearch/commit/fcfe48edcd0189a84c1067aa097c9ba79e35b1c2", "committedDate": "2020-10-15T19:40:27Z", "message": "Merge remote-tracking branch 'upstream/master' into unsigned-long-make-collapsable"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTEwMjYzMTA1", "url": "https://github.com/elastic/elasticsearch/pull/63495#pullrequestreview-510263105", "createdAt": "2020-10-16T08:34:54Z", "commit": {"oid": "fcfe48edcd0189a84c1067aa097c9ba79e35b1c2"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4235, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}