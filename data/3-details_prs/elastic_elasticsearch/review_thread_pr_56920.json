{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE5Njg4MzIz", "number": 56920, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNlQyMzozNjo0NFrOD_4YNw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNlQyMzo0NTo1NVrOD_4fOg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY4MzEwNTgzOnYy", "diffSide": "RIGHT", "path": "docs/reference/snapshot-restore/register-repository.asciidoc", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNlQyMzozNjo0NFrOGazxOA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yN1QxNDowMzowNlrOGbLtEA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDc2NDM0NA==", "bodyText": "This intro feels awkward & doesn't really explain why you would want to use a URL repository. Is the point that you can write snapshots to a shared file system repository, and then serve them up so they can be restored to nodes that don't have access to the shared filesystem?", "url": "https://github.com/elastic/elasticsearch/pull/56920#discussion_r430764344", "createdAt": "2020-05-26T23:36:44Z", "author": {"login": "debadair"}, "path": "docs/reference/snapshot-restore/register-repository.asciidoc", "diffHunk": "@@ -153,22 +153,44 @@ unit, for example: `1GB`, `10MB`, `5KB`, `500B`. Defaults to `null` (unlimited c\n \n The URL repository (`\"type\": \"url\"`) can be used as an alternative read-only way to access data created by the shared file", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "72ce45e6e920d7210ca756cee18901f1d4dc0981"}, "originalPosition": 2}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTE1NjQ5Ng==", "bodyText": "Added some more context with aa2b76a.\nI don't think the primary issue is access but safety. A read-only shared file system could be accidentally switched to write, which could lead to corrupting snapshots if multiple clusters write to the same repository.", "url": "https://github.com/elastic/elasticsearch/pull/56920#discussion_r431156496", "createdAt": "2020-05-27T14:03:06Z", "author": {"login": "jrodewig"}, "path": "docs/reference/snapshot-restore/register-repository.asciidoc", "diffHunk": "@@ -153,22 +153,44 @@ unit, for example: `1GB`, `10MB`, `5KB`, `500B`. Defaults to `null` (unlimited c\n \n The URL repository (`\"type\": \"url\"`) can be used as an alternative read-only way to access data created by the shared file", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDc2NDM0NA=="}, "originalCommit": {"oid": "72ce45e6e920d7210ca756cee18901f1d4dc0981"}, "originalPosition": 2}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY4MzExMDgzOnYy", "diffSide": "RIGHT", "path": "docs/reference/snapshot-restore/register-repository.asciidoc", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNlQyMzozOToxOVrOGaz0Ow==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yN1QxNDowMzo0MVrOGbLurA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDc2NTExNQ==", "bodyText": "This is consistent with the other examples, but I think the naming adds to the confusion. You see put...backup, when you're not putting a backup, you're specifying a backup location.", "url": "https://github.com/elastic/elasticsearch/pull/56920#discussion_r430765115", "createdAt": "2020-05-26T23:39:19Z", "author": {"login": "debadair"}, "path": "docs/reference/snapshot-restore/register-repository.asciidoc", "diffHunk": "@@ -153,22 +153,44 @@ unit, for example: `1GB`, `10MB`, `5KB`, `500B`. Defaults to `null` (unlimited c\n \n The URL repository (`\"type\": \"url\"`) can be used as an alternative read-only way to access data created by the shared file\n system repository. The URL specified in the `url` parameter should point to the root of the shared filesystem repository.\n-The following settings are supported:\n \n-[horizontal]\n-`url`:: Location of the snapshots. Mandatory.\n+[source,console]\n+----\n+PUT /_snapshot/my_read_only_url_backup", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "72ce45e6e920d7210ca756cee18901f1d4dc0981"}, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTE1NjkwOA==", "bodyText": "Updated with 1866a79.", "url": "https://github.com/elastic/elasticsearch/pull/56920#discussion_r431156908", "createdAt": "2020-05-27T14:03:41Z", "author": {"login": "jrodewig"}, "path": "docs/reference/snapshot-restore/register-repository.asciidoc", "diffHunk": "@@ -153,22 +153,44 @@ unit, for example: `1GB`, `10MB`, `5KB`, `500B`. Defaults to `null` (unlimited c\n \n The URL repository (`\"type\": \"url\"`) can be used as an alternative read-only way to access data created by the shared file\n system repository. The URL specified in the `url` parameter should point to the root of the shared filesystem repository.\n-The following settings are supported:\n \n-[horizontal]\n-`url`:: Location of the snapshots. Mandatory.\n+[source,console]\n+----\n+PUT /_snapshot/my_read_only_url_backup", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDc2NTExNQ=="}, "originalCommit": {"oid": "72ce45e6e920d7210ca756cee18901f1d4dc0981"}, "originalPosition": 10}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY4MzExNzU4OnYy", "diffSide": "RIGHT", "path": "docs/reference/snapshot-restore/register-repository.asciidoc", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNlQyMzo0MjozOVrOGaz4OQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yN1QxNDowNDoxNVrOGbLwNw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDc2NjEzNw==", "bodyText": "It's not clear to me what the advantage is of using the file protocol over just using the filesystem repo directly. Is just because it is read only?", "url": "https://github.com/elastic/elasticsearch/pull/56920#discussion_r430766137", "createdAt": "2020-05-26T23:42:39Z", "author": {"login": "debadair"}, "path": "docs/reference/snapshot-restore/register-repository.asciidoc", "diffHunk": "@@ -153,22 +153,44 @@ unit, for example: `1GB`, `10MB`, `5KB`, `500B`. Defaults to `null` (unlimited c\n \n The URL repository (`\"type\": \"url\"`) can be used as an alternative read-only way to access data created by the shared file\n system repository. The URL specified in the `url` parameter should point to the root of the shared filesystem repository.\n-The following settings are supported:\n \n-[horizontal]\n-`url`:: Location of the snapshots. Mandatory.\n+[source,console]\n+----\n+PUT /_snapshot/my_read_only_url_backup\n+{\n+  \"type\": \"url\",\n+  \"settings\": {\n+    \"url\": \"file:/mount/backups/my_fs_backup_location\"\n+  }\n+}\n+----\n+// TEST[skip:no access to url file path]\n \n-URL Repository supports the following protocols: \"http\", \"https\", \"ftp\", \"file\" and \"jar\". URL repositories with `http:`,\n-`https:`, and `ftp:` URLs has to be whitelisted by specifying allowed URLs in the `repositories.url.allowed_urls` setting.\n-This setting supports wildcards in the place of host, path, query, and fragment. For example:\n+\n+The `url` parameter supports the following protocols:\n+\n+* `file`\n+* `ftp`\n+* `http`\n+* `https`\n+* `jar`\n+\n+URLs using the `file` protocol must point to the location of a shared filesystem", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "72ce45e6e920d7210ca756cee18901f1d4dc0981"}, "originalPosition": 32}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTE1NzMwMw==", "bodyText": "Yes. It being read-only is a safety feature. Updated with aa2b76a.", "url": "https://github.com/elastic/elasticsearch/pull/56920#discussion_r431157303", "createdAt": "2020-05-27T14:04:15Z", "author": {"login": "jrodewig"}, "path": "docs/reference/snapshot-restore/register-repository.asciidoc", "diffHunk": "@@ -153,22 +153,44 @@ unit, for example: `1GB`, `10MB`, `5KB`, `500B`. Defaults to `null` (unlimited c\n \n The URL repository (`\"type\": \"url\"`) can be used as an alternative read-only way to access data created by the shared file\n system repository. The URL specified in the `url` parameter should point to the root of the shared filesystem repository.\n-The following settings are supported:\n \n-[horizontal]\n-`url`:: Location of the snapshots. Mandatory.\n+[source,console]\n+----\n+PUT /_snapshot/my_read_only_url_backup\n+{\n+  \"type\": \"url\",\n+  \"settings\": {\n+    \"url\": \"file:/mount/backups/my_fs_backup_location\"\n+  }\n+}\n+----\n+// TEST[skip:no access to url file path]\n \n-URL Repository supports the following protocols: \"http\", \"https\", \"ftp\", \"file\" and \"jar\". URL repositories with `http:`,\n-`https:`, and `ftp:` URLs has to be whitelisted by specifying allowed URLs in the `repositories.url.allowed_urls` setting.\n-This setting supports wildcards in the place of host, path, query, and fragment. For example:\n+\n+The `url` parameter supports the following protocols:\n+\n+* `file`\n+* `ftp`\n+* `http`\n+* `https`\n+* `jar`\n+\n+URLs using the `file` protocol must point to the location of a shared filesystem", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDc2NjEzNw=="}, "originalCommit": {"oid": "72ce45e6e920d7210ca756cee18901f1d4dc0981"}, "originalPosition": 32}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY4MzEyMzc4OnYy", "diffSide": "RIGHT", "path": "docs/reference/snapshot-restore/register-repository.asciidoc", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNlQyMzo0NTo1NVrOGaz8HA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yN1QxNDowNTo1OFrOGbL1Ug==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDc2NzEzMg==", "bodyText": "Do not need to be, or should not be?", "url": "https://github.com/elastic/elasticsearch/pull/56920#discussion_r430767132", "createdAt": "2020-05-26T23:45:55Z", "author": {"login": "debadair"}, "path": "docs/reference/snapshot-restore/register-repository.asciidoc", "diffHunk": "@@ -153,22 +153,44 @@ unit, for example: `1GB`, `10MB`, `5KB`, `500B`. Defaults to `null` (unlimited c\n \n The URL repository (`\"type\": \"url\"`) can be used as an alternative read-only way to access data created by the shared file\n system repository. The URL specified in the `url` parameter should point to the root of the shared filesystem repository.\n-The following settings are supported:\n \n-[horizontal]\n-`url`:: Location of the snapshots. Mandatory.\n+[source,console]\n+----\n+PUT /_snapshot/my_read_only_url_backup\n+{\n+  \"type\": \"url\",\n+  \"settings\": {\n+    \"url\": \"file:/mount/backups/my_fs_backup_location\"\n+  }\n+}\n+----\n+// TEST[skip:no access to url file path]\n \n-URL Repository supports the following protocols: \"http\", \"https\", \"ftp\", \"file\" and \"jar\". URL repositories with `http:`,\n-`https:`, and `ftp:` URLs has to be whitelisted by specifying allowed URLs in the `repositories.url.allowed_urls` setting.\n-This setting supports wildcards in the place of host, path, query, and fragment. For example:\n+\n+The `url` parameter supports the following protocols:\n+\n+* `file`\n+* `ftp`\n+* `http`\n+* `https`\n+* `jar`\n+\n+URLs using the `file` protocol must point to the location of a shared filesystem\n+accessible to all master and data nodes in the cluster. This location must be\n+registered in the `path.repo` setting, similar to a\n+<<snapshots-filesystem-repository,shared file system repository>>.\n+\n+URLs using the `ftp`, `http`, or `https` protocols must be whitelisted in the\n+`repositories.url.allowed_urls` setting. This setting supports wildcards (`*`)\n+in place of a host, path, query, or fragment in the URL. For example:\n \n [source,yaml]\n------------------------------------\n+----\n repositories.url.allowed_urls: [\"http://www.example.org/root/*\", \"https://*.mydomain.com/*?*#*\"]\n------------------------------------\n+----\n \n-URL repositories with `file:` URLs can only point to locations registered in the `path.repo` setting similar to\n-shared file system repository.\n+NOTE: URLs using the `ftp`, `http`, `https`, or `jar` protocols do not need to", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "72ce45e6e920d7210ca756cee18901f1d4dc0981"}, "originalPosition": 50}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTE1ODYxMA==", "bodyText": "Gonna leave this as-is. There is no real harm in registering them but it's not necessary.", "url": "https://github.com/elastic/elasticsearch/pull/56920#discussion_r431158610", "createdAt": "2020-05-27T14:05:58Z", "author": {"login": "jrodewig"}, "path": "docs/reference/snapshot-restore/register-repository.asciidoc", "diffHunk": "@@ -153,22 +153,44 @@ unit, for example: `1GB`, `10MB`, `5KB`, `500B`. Defaults to `null` (unlimited c\n \n The URL repository (`\"type\": \"url\"`) can be used as an alternative read-only way to access data created by the shared file\n system repository. The URL specified in the `url` parameter should point to the root of the shared filesystem repository.\n-The following settings are supported:\n \n-[horizontal]\n-`url`:: Location of the snapshots. Mandatory.\n+[source,console]\n+----\n+PUT /_snapshot/my_read_only_url_backup\n+{\n+  \"type\": \"url\",\n+  \"settings\": {\n+    \"url\": \"file:/mount/backups/my_fs_backup_location\"\n+  }\n+}\n+----\n+// TEST[skip:no access to url file path]\n \n-URL Repository supports the following protocols: \"http\", \"https\", \"ftp\", \"file\" and \"jar\". URL repositories with `http:`,\n-`https:`, and `ftp:` URLs has to be whitelisted by specifying allowed URLs in the `repositories.url.allowed_urls` setting.\n-This setting supports wildcards in the place of host, path, query, and fragment. For example:\n+\n+The `url` parameter supports the following protocols:\n+\n+* `file`\n+* `ftp`\n+* `http`\n+* `https`\n+* `jar`\n+\n+URLs using the `file` protocol must point to the location of a shared filesystem\n+accessible to all master and data nodes in the cluster. This location must be\n+registered in the `path.repo` setting, similar to a\n+<<snapshots-filesystem-repository,shared file system repository>>.\n+\n+URLs using the `ftp`, `http`, or `https` protocols must be whitelisted in the\n+`repositories.url.allowed_urls` setting. This setting supports wildcards (`*`)\n+in place of a host, path, query, or fragment in the URL. For example:\n \n [source,yaml]\n------------------------------------\n+----\n repositories.url.allowed_urls: [\"http://www.example.org/root/*\", \"https://*.mydomain.com/*?*#*\"]\n------------------------------------\n+----\n \n-URL repositories with `file:` URLs can only point to locations registered in the `path.repo` setting similar to\n-shared file system repository.\n+NOTE: URLs using the `ftp`, `http`, `https`, or `jar` protocols do not need to", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDc2NzEzMg=="}, "originalCommit": {"oid": "72ce45e6e920d7210ca756cee18901f1d4dc0981"}, "originalPosition": 50}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 354, "cost": 1, "resetAt": "2021-11-12T11:57:46Z"}}}