{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzU5MjE0MTY3", "number": 50629, "title": "Correct search_after handling", "bodyText": "Correct the initial \"naive\" handling of search_after parameters.", "createdAt": "2020-01-04T13:31:19Z", "url": "https://github.com/elastic/elasticsearch/pull/50629", "merged": true, "mergeCommit": {"oid": "377732454ebdeb0ccbd9a56c77a753ce8eb6fe5f"}, "closed": true, "closedAt": "2020-01-06T22:56:14Z", "author": {"login": "aleksmaus"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb3C9OhgH2gAyMzU5MjE0MTY3OjBjYmYwMGFlY2U3MTI4NmZjZDU5ZDA0YmE2MjA2YmU0MDc3OTM0MDc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABb3zk5AgFqTMzODkyNDc4Mw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "0cbf00aece71286fcd59d04ba6206be407793407", "author": {"user": {"login": "aleksmaus", "name": "Aleksandr Maus"}}, "url": "https://github.com/elastic/elasticsearch/commit/0cbf00aece71286fcd59d04ba6206be407793407", "committedDate": "2020-01-04T13:27:27Z", "message": "Correct search_after handling"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzM4NzI2MjA2", "url": "https://github.com/elastic/elasticsearch/pull/50629#pullrequestreview-338726206", "createdAt": "2020-01-06T15:57:14Z", "commit": {"oid": "0cbf00aece71286fcd59d04ba6206be407793407"}, "state": "COMMENTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wNlQxNTo1NzoxNFrOFahdDQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wNlQxNjoyMzoxNFrOFaiNbA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzM1NTQwNQ==", "bodyText": "Could you make a constant out of this?", "url": "https://github.com/elastic/elasticsearch/pull/50629#discussion_r363355405", "createdAt": "2020-01-06T15:57:14Z", "author": {"login": "imotov"}, "path": "x-pack/plugin/eql/src/main/java/org/elasticsearch/xpack/eql/plugin/RestEqlSearchAction.java", "diffHunk": "@@ -29,10 +29,9 @@\n \n public class RestEqlSearchAction extends BaseRestHandler {\n     public RestEqlSearchAction(RestController controller) {\n-        // Not sure yet if we will always have index in the path or not\n-        // TODO: finalize the endpoints\n-        controller.registerHandler(GET, \"/{index}/_eql/search\", this);\n-        controller.registerHandler(POST, \"/{index}/_eql/search\", this);\n+        final String path = \"/{index}/_eql/search\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0cbf00aece71286fcd59d04ba6206be407793407"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzM1ODE4Mg==", "bodyText": "How about an empty list?", "url": "https://github.com/elastic/elasticsearch/pull/50629#discussion_r363358182", "createdAt": "2020-01-06T16:03:02Z", "author": {"login": "imotov"}, "path": "x-pack/plugin/eql/src/test/java/org/elasticsearch/xpack/eql/action/EqlSearchRequestTests.java", "diffHunk": "@@ -74,16 +83,53 @@ protected QueryBuilder parseQuery(XContentParser parser) throws IOException {\n         return parseInnerQueryBuilder;\n     }\n \n-    private List<String> randomSearchAfter() {\n-        if (randomBoolean()) {\n-            return Collections.emptyList();\n-        } else {\n-            int size = randomIntBetween(1, 50);\n-            List<String> arr = new ArrayList<>(size);\n-            for (int i = 0; i < size; i++) {\n-                arr.add(randomAlphaOfLength(randomIntBetween(1, 15)));\n+    private SearchAfterBuilder randomJsonSearchFromBuilder() throws IOException {\n+        int numSearchAfter = randomIntBetween(1, 10);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0cbf00aece71286fcd59d04ba6206be407793407"}, "originalPosition": 67}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzM1ODUyOA==", "bodyText": "I think there is LuceneTests.randomSortValue() that generates random sort values. I wonder if we could use it here.", "url": "https://github.com/elastic/elasticsearch/pull/50629#discussion_r363358528", "createdAt": "2020-01-06T16:03:45Z", "author": {"login": "imotov"}, "path": "x-pack/plugin/eql/src/test/java/org/elasticsearch/xpack/eql/action/EqlSearchRequestTests.java", "diffHunk": "@@ -74,16 +83,53 @@ protected QueryBuilder parseQuery(XContentParser parser) throws IOException {\n         return parseInnerQueryBuilder;\n     }\n \n-    private List<String> randomSearchAfter() {\n-        if (randomBoolean()) {\n-            return Collections.emptyList();\n-        } else {\n-            int size = randomIntBetween(1, 50);\n-            List<String> arr = new ArrayList<>(size);\n-            for (int i = 0; i < size; i++) {\n-                arr.add(randomAlphaOfLength(randomIntBetween(1, 15)));\n+    private SearchAfterBuilder randomJsonSearchFromBuilder() throws IOException {\n+        int numSearchAfter = randomIntBetween(1, 10);\n+        XContentBuilder jsonBuilder = XContentFactory.jsonBuilder();\n+        jsonBuilder.startObject();\n+        jsonBuilder.startArray(\"search_after\");\n+        for (int i = 0; i < numSearchAfter; i++) {\n+            int branch = randomInt(9);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0cbf00aece71286fcd59d04ba6206be407793407"}, "originalPosition": 72}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzM2Nzc4OA==", "bodyText": "If it is not possible, I think there is a better pattern for this base on randomFrom(...) and Supplier<...>", "url": "https://github.com/elastic/elasticsearch/pull/50629#discussion_r363367788", "createdAt": "2020-01-06T16:23:14Z", "author": {"login": "imotov"}, "path": "x-pack/plugin/eql/src/test/java/org/elasticsearch/xpack/eql/action/EqlSearchRequestTests.java", "diffHunk": "@@ -74,16 +83,53 @@ protected QueryBuilder parseQuery(XContentParser parser) throws IOException {\n         return parseInnerQueryBuilder;\n     }\n \n-    private List<String> randomSearchAfter() {\n-        if (randomBoolean()) {\n-            return Collections.emptyList();\n-        } else {\n-            int size = randomIntBetween(1, 50);\n-            List<String> arr = new ArrayList<>(size);\n-            for (int i = 0; i < size; i++) {\n-                arr.add(randomAlphaOfLength(randomIntBetween(1, 15)));\n+    private SearchAfterBuilder randomJsonSearchFromBuilder() throws IOException {\n+        int numSearchAfter = randomIntBetween(1, 10);\n+        XContentBuilder jsonBuilder = XContentFactory.jsonBuilder();\n+        jsonBuilder.startObject();\n+        jsonBuilder.startArray(\"search_after\");\n+        for (int i = 0; i < numSearchAfter; i++) {\n+            int branch = randomInt(9);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzM1ODUyOA=="}, "originalCommit": {"oid": "0cbf00aece71286fcd59d04ba6206be407793407"}, "originalPosition": 72}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "32eeae1d914b8b1563b77a2ce02793d113ebd600", "author": {"user": {"login": "aleksmaus", "name": "Aleksandr Maus"}}, "url": "https://github.com/elastic/elasticsearch/commit/32eeae1d914b8b1563b77a2ce02793d113ebd600", "committedDate": "2020-01-06T18:04:41Z", "message": "Address Igor's code review suggestions"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "1717177b4b47ce2b4df85de147bfe6ec7c5399e1", "author": {"user": {"login": "aleksmaus", "name": "Aleksandr Maus"}}, "url": "https://github.com/elastic/elasticsearch/commit/1717177b4b47ce2b4df85de147bfe6ec7c5399e1", "committedDate": "2020-01-06T19:58:04Z", "message": "Update EqlSearchRequest unit test for null searchAfterBuilder cases"}, "afterCommit": {"oid": "68ee15fc47bb3403ac5a2eebc20c83bf9681946c", "author": {"user": {"login": "aleksmaus", "name": "Aleksandr Maus"}}, "url": "https://github.com/elastic/elasticsearch/commit/68ee15fc47bb3403ac5a2eebc20c83bf9681946c", "committedDate": "2020-01-06T20:07:42Z", "message": "Update EqlSearchRequest unit test for null searchAfterBuilder cases"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1bd432752384dd2ff5d7f1996f23ba681a5b25bc", "author": {"user": {"login": "aleksmaus", "name": "Aleksandr Maus"}}, "url": "https://github.com/elastic/elasticsearch/commit/1bd432752384dd2ff5d7f1996f23ba681a5b25bc", "committedDate": "2020-01-06T20:31:27Z", "message": "Update EqlSearchRequest unit test for null searchAfterBuilder cases"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "68ee15fc47bb3403ac5a2eebc20c83bf9681946c", "author": {"user": {"login": "aleksmaus", "name": "Aleksandr Maus"}}, "url": "https://github.com/elastic/elasticsearch/commit/68ee15fc47bb3403ac5a2eebc20c83bf9681946c", "committedDate": "2020-01-06T20:07:42Z", "message": "Update EqlSearchRequest unit test for null searchAfterBuilder cases"}, "afterCommit": {"oid": "1bd432752384dd2ff5d7f1996f23ba681a5b25bc", "author": {"user": {"login": "aleksmaus", "name": "Aleksandr Maus"}}, "url": "https://github.com/elastic/elasticsearch/commit/1bd432752384dd2ff5d7f1996f23ba681a5b25bc", "committedDate": "2020-01-06T20:31:27Z", "message": "Update EqlSearchRequest unit test for null searchAfterBuilder cases"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzM4OTI0Nzgz", "url": "https://github.com/elastic/elasticsearch/pull/50629#pullrequestreview-338924783", "createdAt": "2020-01-06T22:06:13Z", "commit": {"oid": "1bd432752384dd2ff5d7f1996f23ba681a5b25bc"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3819, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}