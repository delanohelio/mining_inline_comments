{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ0MDA0MDIy", "number": 59007, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wN1QyMjowODozNlrOEMQphw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wN1QyMjowODozNlrOEMQphw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgxMjkxMTQzOnYy", "diffSide": "RIGHT", "path": "server/src/main/java/org/elasticsearch/env/NodeEnvironment.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wN1QyMjowODozNlrOGuRV2g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOFQwOToyNTo0OVrOGuftjg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTE3MTgwMg==", "bodyText": "Shouldn't this be checking nodePath.indicesPath.resolve(indexUniquePathId)?", "url": "https://github.com/elastic/elasticsearch/pull/59007#discussion_r451171802", "createdAt": "2020-07-07T22:08:36Z", "author": {"login": "rjernst"}, "path": "server/src/main/java/org/elasticsearch/env/NodeEnvironment.java", "diffHunk": "@@ -1044,15 +1044,8 @@ public String nodeId() {\n         final Set<ShardId> shardIds = new HashSet<>();\n         final String indexUniquePathId = index.getUUID();\n         for (final NodePath nodePath : nodePaths) {\n-            Path location = nodePath.indicesPath;\n-            if (Files.isDirectory(location)) {\n-                try (DirectoryStream<Path> indexStream = Files.newDirectoryStream(location)) {\n-                    for (Path indexPath : indexStream) {\n-                        if (indexUniquePathId.equals(indexPath.getFileName().toString())) {\n-                            shardIds.addAll(findAllShardsForIndex(indexPath, index));\n-                        }\n-                    }\n-                }\n+            if (Files.isDirectory(nodePath.indicesPath)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9bfb0e8d306f90b8b6a9fea0efd19222282efc02"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTQwNzI0Ng==", "bodyText": "This preserves the check in the original code; we already check Files.isDirectory(nodePath.indicesPath.resolve(indexUniquePathId)) within findAllShardsForIndex. Maybe we should just remove this check entirely?", "url": "https://github.com/elastic/elasticsearch/pull/59007#discussion_r451407246", "createdAt": "2020-07-08T09:25:49Z", "author": {"login": "DaveCTurner"}, "path": "server/src/main/java/org/elasticsearch/env/NodeEnvironment.java", "diffHunk": "@@ -1044,15 +1044,8 @@ public String nodeId() {\n         final Set<ShardId> shardIds = new HashSet<>();\n         final String indexUniquePathId = index.getUUID();\n         for (final NodePath nodePath : nodePaths) {\n-            Path location = nodePath.indicesPath;\n-            if (Files.isDirectory(location)) {\n-                try (DirectoryStream<Path> indexStream = Files.newDirectoryStream(location)) {\n-                    for (Path indexPath : indexStream) {\n-                        if (indexUniquePathId.equals(indexPath.getFileName().toString())) {\n-                            shardIds.addAll(findAllShardsForIndex(indexPath, index));\n-                        }\n-                    }\n-                }\n+            if (Files.isDirectory(nodePath.indicesPath)) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTE3MTgwMg=="}, "originalCommit": {"oid": "9bfb0e8d306f90b8b6a9fea0efd19222282efc02"}, "originalPosition": 13}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2019, "cost": 1, "resetAt": "2021-11-12T13:16:51Z"}}}