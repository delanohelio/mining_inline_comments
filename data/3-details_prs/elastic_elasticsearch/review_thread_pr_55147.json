{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDAzMDg2ODcw", "number": 55147, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNFQxMDowMDo1MVrODxkp7A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNFQxMDoyNzowMVrODxlQWA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUzMzA3MzcyOnYy", "diffSide": "RIGHT", "path": "x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/searchablesnapshots/SearchableSnapshotShardStats.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNFQxMDowMDo1MVrOGFHUuA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNFQxMDowMDo1MVrOGFHUuA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODAxNjA1Ng==", "bodyText": "Kinda unrelated change, but this was useful for debugging.", "url": "https://github.com/elastic/elasticsearch/pull/55147#discussion_r408016056", "createdAt": "2020-04-14T10:00:51Z", "author": {"login": "DaveCTurner"}, "path": "x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/searchablesnapshots/SearchableSnapshotShardStats.java", "diffHunk": "@@ -77,6 +77,7 @@ public XContentBuilder toXContent(XContentBuilder builder, Params params) throws\n             builder.field(\"index_uuid\", getIndexId().getId());\n             builder.startObject(\"shard\");\n             {\n+                builder.field(\"id\", shardRouting.shardId());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ad34e21a6e0fed5f92368e30fc59cbe2d40d6738"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUzMzA3NjY4OnYy", "diffSide": "RIGHT", "path": "x-pack/plugin/searchable-snapshots/src/test/java/org/elasticsearch/xpack/searchablesnapshots/BaseSearchableSnapshotsIntegTestCase.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNFQxMDowMTo0OFrOGFHWyA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNFQxMDowMTo0OFrOGFHWyA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODAxNjU4NA==", "bodyText": "Prior to this change the smallest nonzero cache size was 1kB which was typically larger than many of the files seen in this test, so I thought this might improve coverage a bit.", "url": "https://github.com/elastic/elasticsearch/pull/55147#discussion_r408016584", "createdAt": "2020-04-14T10:01:48Z", "author": {"login": "DaveCTurner"}, "path": "x-pack/plugin/searchable-snapshots/src/test/java/org/elasticsearch/xpack/searchablesnapshots/BaseSearchableSnapshotsIntegTestCase.java", "diffHunk": "@@ -55,7 +55,9 @@ protected Settings nodeSettings(int nodeOrdinal) {\n             builder.put(\n                 CacheService.SNAPSHOT_CACHE_SIZE_SETTING.getKey(),\n                 rarely()\n-                    ? new ByteSizeValue(randomIntBetween(0, 10), ByteSizeUnit.KB)\n+                    ? randomBoolean()\n+                        ? new ByteSizeValue(randomIntBetween(0, 10), ByteSizeUnit.KB)\n+                        : new ByteSizeValue(randomIntBetween(0, 1000), ByteSizeUnit.BYTES)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ad34e21a6e0fed5f92368e30fc59cbe2d40d6738"}, "originalPosition": 7}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUzMzE3MjA4OnYy", "diffSide": "RIGHT", "path": "x-pack/plugin/searchable-snapshots/src/test/java/org/elasticsearch/xpack/searchablesnapshots/SearchableSnapshotsIntegTests.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNFQxMDoyNzowMVrOGFIRFA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNFQxMDoyNzowMVrOGFIRFA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODAzMTUwOA==", "bodyText": "\ud83d\ude37", "url": "https://github.com/elastic/elasticsearch/pull/55147#discussion_r408031508", "createdAt": "2020-04-14T10:27:01Z", "author": {"login": "tlrx"}, "path": "x-pack/plugin/searchable-snapshots/src/test/java/org/elasticsearch/xpack/searchablesnapshots/SearchableSnapshotsIntegTests.java", "diffHunk": "@@ -261,11 +265,33 @@ private void assertSearchableSnapshotStats(String indexName, boolean cacheEnable\n         final NumShards restoredNumShards = getNumShards(indexName);\n         assertThat(statsResponse.getStats(), hasSize(restoredNumShards.totalNumShards));\n \n+        final long totalSize = statsResponse.getStats()\n+            .stream()\n+            .flatMap(s -> s.getStats().stream())\n+            .mapToLong(SearchableSnapshotShardStats.CacheIndexInputStats::getFileLength)\n+            .sum();\n+        final Set<String> nodeIdsWithLargeEnoughCache = new HashSet<>();\n+        for (ObjectCursor<DiscoveryNode> nodeCursor : client().admin()\n+            .cluster()\n+            .prepareState()\n+            .clear()\n+            .setNodes(true)\n+            .get()\n+            .getState()\n+            .nodes()\n+            .getDataNodes()\n+            .values()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "951cdfaebd4b97db50f23c093c13d329c773c736"}, "originalPosition": 60}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1149, "cost": 1, "resetAt": "2021-11-12T11:57:46Z"}}}