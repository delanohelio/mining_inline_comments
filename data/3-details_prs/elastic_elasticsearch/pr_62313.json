{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDg2NjMzNDIw", "number": 62313, "title": "[Enrich] add logging for when there are search/bulk failures on _execute", "bodyText": "When calling _execute there is a chance that there will be bulk indexing failures\nor search failures.\nThese will result in the call failing overall. But, no information is provided for troubleshooting the failure.\nThis commit adds logging to indicate the number of failures, and new debug level logging so that\nfailure details can be determined if necessary.\ncloses #60491", "createdAt": "2020-09-14T13:51:53Z", "url": "https://github.com/elastic/elasticsearch/pull/62313", "merged": true, "mergeCommit": {"oid": "23b9df8cd1497547e8a689b9da7d731d98fa6631"}, "closed": true, "closedAt": "2020-09-14T14:37:05Z", "author": {"login": "benwtrent"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdIzgtfgH2gAyNDg2NjMzNDIwOjlkODljYjQ1ZTdhZGJlMWI0MzQxOTUwNDE3ODA5ZjczY2UzN2M2NTM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdIzqXqAH2gAyNDg2NjMzNDIwOjhhNTRkODVlZDE3YTRmYjkyMWYzNTViMWM4YTkyN2QzNmFhMWRhNTM=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "9d89cb45e7adbe1b4341950417809f73ce37c653", "author": {"user": {"login": "benwtrent", "name": "Benjamin Trent"}}, "url": "https://github.com/elastic/elasticsearch/commit/9d89cb45e7adbe1b4341950417809f73ce37c653", "committedDate": "2020-09-14T13:49:31Z", "message": "[Enrich] add logging for when there are search/bulk failures on _execute"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg3Nzk2ODYz", "url": "https://github.com/elastic/elasticsearch/pull/62313#pullrequestreview-487796863", "createdAt": "2020-09-14T13:58:28Z", "commit": {"oid": "9d89cb45e7adbe1b4341950417809f73ce37c653"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg3Nzk4MjA4", "url": "https://github.com/elastic/elasticsearch/pull/62313#pullrequestreview-487798208", "createdAt": "2020-09-14T13:59:44Z", "commit": {"oid": "9d89cb45e7adbe1b4341950417809f73ce37c653"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNFQxMzo1OTo0NFrOHRVxXw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNFQxMzo1OTo0NFrOHRVxXw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Nzk0NDU0Mw==", "bodyText": "policyName is missing as argument.", "url": "https://github.com/elastic/elasticsearch/pull/62313#discussion_r487944543", "createdAt": "2020-09-14T13:59:44Z", "author": {"login": "martijnvg"}, "path": "x-pack/plugin/enrich/src/main/java/org/elasticsearch/xpack/enrich/EnrichPolicyRunner.java", "diffHunk": "@@ -352,8 +355,39 @@ private void transferDataToEnrichIndex(final String destinationIndexName) {\n             public void onResponse(BulkByScrollResponse bulkByScrollResponse) {\n                 // Do we want to fail the request if there were failures during the reindex process?\n                 if (bulkByScrollResponse.getBulkFailures().size() > 0) {\n+                    logger.warn(\n+                        \"Policy [{}]: encountered [{}] bulk failures. Turn on DEBUG logging for details.\",\n+                        policyName,\n+                        bulkByScrollResponse.getBulkFailures().size()\n+                    );\n+                    for (BulkItemResponse.Failure failure : bulkByScrollResponse.getBulkFailures()) {\n+                        logger.debug(\n+                            new ParameterizedMessage(\n+                                \"Policy [{}]: bulk index failed for index [{}], id [{}]\",\n+                                failure.getIndex(),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9d89cb45e7adbe1b4341950417809f73ce37c653"}, "originalPosition": 37}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8a54d85ed17a4fb921f355b1c8a927d36aa1da53", "author": {"user": {"login": "benwtrent", "name": "Benjamin Trent"}}, "url": "https://github.com/elastic/elasticsearch/commit/8a54d85ed17a4fb921f355b1c8a927d36aa1da53", "committedDate": "2020-09-14T14:00:04Z", "message": "adding debug predicate check"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4588, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}