{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTQyNTYxMDQz", "number": 66597, "title": "Fix IndexFoldersDeletionListenerIT", "bodyText": "This is another attempt to fix IndexFoldersDeletionListenerIT failures on CI like #66519 and #66571, where the tests assert that no deletions occurred (using assertNoDeletions()) before deleting/relocating the index which should this time trigger deletions.\nThis commit reduces the number of shards, moves to no replicas and disable rebalancing so that shards are not likely to be relocated before running tests.", "createdAt": "2020-12-18T14:02:00Z", "url": "https://github.com/elastic/elasticsearch/pull/66597", "merged": true, "mergeCommit": {"oid": "a3ab376c2477b5c5bdc748101e4a4be952e6b37c"}, "closed": true, "closedAt": "2021-01-04T10:39:55Z", "author": {"login": "tlrx"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdnXtF2gH2gAyNTQyNTYxMDQzOjI3MTgyMjI1ZDQzODUwMmY4NTAzNTQ3OWRhNmMwZTc0ZWJmY2FmYjA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdszKPlgH2gAyNTQyNTYxMDQzOjY4ZGViNjgzNzZmNGFiZjg5MjFiMzVhMWYwNzVjYmNkMzhhYjAxYTg=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "27182225d438502f85035479da6c0e74ebfcafb0", "author": {"user": {"login": "tlrx", "name": "Tanguy Leroux"}}, "url": "https://github.com/elastic/elasticsearch/commit/27182225d438502f85035479da6c0e74ebfcafb0", "committedDate": "2020-12-18T12:57:21Z", "message": "Fix IndexFoldersDeletionListenerIT"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU2MzQyNDg3", "url": "https://github.com/elastic/elasticsearch/pull/66597#pullrequestreview-556342487", "createdAt": "2020-12-21T12:25:58Z", "commit": {"oid": "27182225d438502f85035479da6c0e74ebfcafb0"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMVQxMjoyNTo1OFrOIJWlhw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMVQxMjoyNTo1OFrOIJWlhw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjY3ODE1MQ==", "bodyText": "I am not sure I follow how number of shards/replicas interact with this test?", "url": "https://github.com/elastic/elasticsearch/pull/66597#discussion_r546678151", "createdAt": "2020-12-21T12:25:58Z", "author": {"login": "henningandersen"}, "path": "server/src/internalClusterTest/java/org/elasticsearch/plugins/IndexFoldersDeletionListenerIT.java", "diffHunk": "@@ -67,15 +67,24 @@\n         return plugins;\n     }\n \n+    @Override\n+    protected Settings nodeSettings(int nodeOrdinal) {\n+        return Settings.builder()\n+            .put(super.nodeSettings(nodeOrdinal))\n+            // prevent shards to move around after they got assigned the first time\n+            .put(EnableAllocationDecider.CLUSTER_ROUTING_REBALANCE_ENABLE_SETTING.getKey(), EnableAllocationDecider.Rebalance.NONE)\n+            .build();\n+    }\n+\n     public void testListenersInvokedWhenIndexIsDeleted() throws Exception {\n         final String masterNode = internalCluster().startMasterOnlyNode();\n         internalCluster().startDataOnlyNodes(2);\n         ensureStableCluster(2 + 1, masterNode);\n \n         final String indexName = randomAlphaOfLength(10).toLowerCase(Locale.ROOT);\n         createIndex(indexName, Settings.builder()\n-            .put(IndexMetadata.SETTING_NUMBER_OF_SHARDS, 2 * between(1, 2))\n-            .put(IndexMetadata.SETTING_NUMBER_OF_REPLICAS, between(0, 1))\n+            .put(IndexMetadata.SETTING_NUMBER_OF_SHARDS, 2)\n+            .put(IndexMetadata.SETTING_NUMBER_OF_REPLICAS, 0)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "27182225d438502f85035479da6c0e74ebfcafb0"}, "originalPosition": 23}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "270fd76067a9708f7efe4f055d7da66ca477b19c", "author": {"user": {"login": "tlrx", "name": "Tanguy Leroux"}}, "url": "https://github.com/elastic/elasticsearch/commit/270fd76067a9708f7efe4f055d7da66ca477b19c", "committedDate": "2021-01-04T09:26:22Z", "message": "Merge branch 'master' into fix-IndexFoldersDeletionListenerIT"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "68deb68376f4abf8921b35a1f075cbcd38ab01a8", "author": {"user": {"login": "tlrx", "name": "Tanguy Leroux"}}, "url": "https://github.com/elastic/elasticsearch/commit/68deb68376f4abf8921b35a1f075cbcd38ab01a8", "committedDate": "2021-01-04T09:46:15Z", "message": "replicas"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4380, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}