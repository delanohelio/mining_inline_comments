{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM2NTE5MTI0", "number": 58332, "title": "Submit _async search task should cancel children on cancellation", "bodyText": "This change allows the submit async search task to cancel children\nand removes the manual indirection that cancels the search task when the submit\ntask is cancelled. This is now handled by the task cancellation, which can cancel\ngrand-children since #54757. So this commit doesn't change the behavior, it only cleans the internal to use the hierarchical cancellation introduced in #54757.", "createdAt": "2020-06-18T14:39:33Z", "url": "https://github.com/elastic/elasticsearch/pull/58332", "merged": true, "mergeCommit": {"oid": "19ec636d66cea621c35341abcd01d6898dc1653c"}, "closed": true, "closedAt": "2020-06-24T07:00:26Z", "author": {"login": "jimczi"}, "timelineItems": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcsfcsggH2gAyNDM2NTE5MTI0OjA4ODczNmVjMDY2ZTA5YmM4YmE3YmJhMWRhZjUwMWZhZWIzODliY2I=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcskeJwAFqTQzMzYyMTMxNA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "088736ec066e09bc8ba7bba1daf501faeb389bcb", "author": {"user": {"login": "jimczi", "name": "Jim Ferenczi"}}, "url": "https://github.com/elastic/elasticsearch/commit/088736ec066e09bc8ba7bba1daf501faeb389bcb", "committedDate": "2020-06-18T14:37:09Z", "message": "Submit _async search task should cancel children on cancellation\n\nThis change allows the submit async search task to cancel children\nand removes the manual indirection that cancels the search task when the submit\ntask is cancelled. This is now handled by the task cancellation, which can cancel\ngrand-children since #54757."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMzNjIxMzE0", "url": "https://github.com/elastic/elasticsearch/pull/58332#pullrequestreview-433621314", "createdAt": "2020-06-18T20:25:29Z", "commit": {"oid": "088736ec066e09bc8ba7bba1daf501faeb389bcb"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOFQyMDoyNToyOVrOGl_Adg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOFQyMDoyNToyOVrOGl_Adg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjQ4MjgwNg==", "bodyText": "I was wondering if it can still happen that we get here and submit is cancelled.", "url": "https://github.com/elastic/elasticsearch/pull/58332#discussion_r442482806", "createdAt": "2020-06-18T20:25:29Z", "author": {"login": "javanna"}, "path": "x-pack/plugin/async-search/src/main/java/org/elasticsearch/xpack/search/TransportSubmitAsyncSearchAction.java", "diffHunk": "@@ -88,42 +85,34 @@ public void onResponse(AsyncSearchResponse searchResponse) {\n                         // the task is still running and the user cannot wait more so we create\n                         // a document for further retrieval\n                         try {\n-                            if (submitTask.isCancelled()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "088736ec066e09bc8ba7bba1daf501faeb389bcb"}, "originalPosition": 24}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 469, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}