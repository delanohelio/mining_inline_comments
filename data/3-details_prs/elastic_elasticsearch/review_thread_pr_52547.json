{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc3NDkzMzg1", "number": 52547, "reviewThreads": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMFQxNjoyMDozNFrODhlvnA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wMlQxODoyNDoyNFrODkX4wg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM2NTQ3OTk2OnYy", "diffSide": "RIGHT", "path": "server/src/main/java/org/elasticsearch/cluster/metadata/AliasOrIndex.java", "isResolved": true, "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMFQxNjoyMDozNFrOFsZ_CQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yN1QxNzoxMDoxMFrOFvZsnA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjEwNzQwMQ==", "bodyText": "If I understand this correctly, this means that every place the alias is stored must have the same hidden value? Should we be more strict regarding false and null since it seems like a combination of those values would be accepted?", "url": "https://github.com/elastic/elasticsearch/pull/52547#discussion_r382107401", "createdAt": "2020-02-20T16:20:34Z", "author": {"login": "jaymode"}, "path": "server/src/main/java/org/elasticsearch/cluster/metadata/AliasOrIndex.java", "diffHunk": "@@ -153,6 +175,24 @@ public void computeAndValidateWriteIndex() {\n                 throw new IllegalStateException(\"alias [\" + aliasName + \"] has more than one write index [\" +\n                     Strings.collectionToCommaDelimitedString(writeIndicesStrings) + \"]\");\n             }\n+\n+            // Validate hidden status\n+            final Map<Boolean, List<IndexMetaData>> groupedByHiddenStatus = referenceIndexMetaDatas.stream()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c92b0cfa8beb7eb4c58740ef6084e5d913031bca"}, "originalPosition": 79}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjExNTI4OQ==", "bodyText": "Yes, every IndexMetaData that has an alias with a particular name must have the same logical value for is_hidden for that alias.  I thought about making it more strict about false vs null, but given that the default for this value is false, it would seem odd that adding an alias that is explicitly not hidden (is_hidden: false), when the alias already exists as non-hidden by default (is_hidden omitted or null), would fail.\nI would certainly be open to being more strict about false vs null, but I'm not sure what it would gain us, and it's a little unintuitive to be strict about explicitly false vs omitted with a false default.", "url": "https://github.com/elastic/elasticsearch/pull/52547#discussion_r382115289", "createdAt": "2020-02-20T16:32:31Z", "author": {"login": "gwbrown"}, "path": "server/src/main/java/org/elasticsearch/cluster/metadata/AliasOrIndex.java", "diffHunk": "@@ -153,6 +175,24 @@ public void computeAndValidateWriteIndex() {\n                 throw new IllegalStateException(\"alias [\" + aliasName + \"] has more than one write index [\" +\n                     Strings.collectionToCommaDelimitedString(writeIndicesStrings) + \"]\");\n             }\n+\n+            // Validate hidden status\n+            final Map<Boolean, List<IndexMetaData>> groupedByHiddenStatus = referenceIndexMetaDatas.stream()", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjEwNzQwMQ=="}, "originalCommit": {"oid": "c92b0cfa8beb7eb4c58740ef6084e5d913031bca"}, "originalPosition": 79}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTA1MjY1Mg==", "bodyText": "I haven't read all the code in detail but just wanted to make sure that this check won't prevent an existing alias that spans multiple indices from being made hidden.\nSuppose we have this situation in 7.6:\n\n.ml-annotations-1 and .ml-annotations-2 are indices\n.ml-annotations-read is an alias on both .ml-annotations-1 and .ml-annotations-2\n.ml-annotations-write is an alias on just .ml-annotations-2\n\nIn 7.7 we want to make all this hidden, so we:\n\nAdd the index.hidden setting to .ml-annotations-1 and .ml-annotations-2\nAdd the is_hidden property to .ml-annotations-read and .ml-annotations-write\n\nI just wanted to check that this won't fall foul of this validation because there's an instant during the updates where .ml-annotations-read is only hidden on .ml-annotations-1 but not .ml-annotations-2, even though it would be applied consistently an instant later.", "url": "https://github.com/elastic/elasticsearch/pull/52547#discussion_r385052652", "createdAt": "2020-02-27T10:54:03Z", "author": {"login": "droberts195"}, "path": "server/src/main/java/org/elasticsearch/cluster/metadata/AliasOrIndex.java", "diffHunk": "@@ -153,6 +175,24 @@ public void computeAndValidateWriteIndex() {\n                 throw new IllegalStateException(\"alias [\" + aliasName + \"] has more than one write index [\" +\n                     Strings.collectionToCommaDelimitedString(writeIndicesStrings) + \"]\");\n             }\n+\n+            // Validate hidden status\n+            final Map<Boolean, List<IndexMetaData>> groupedByHiddenStatus = referenceIndexMetaDatas.stream()", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjEwNzQwMQ=="}, "originalCommit": {"oid": "c92b0cfa8beb7eb4c58740ef6084e5d913031bca"}, "originalPosition": 79}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTI0MjY0OQ==", "bodyText": "@droberts195 What you'll have to do is update the alias on all indices that have that alias simultaneously, like so:\nPOST _aliases\n{\n    \"actions\": [\n        {\n            \"add\": {\n                \"index\": \".ml-annotations-1\",\n                \"alias\": \".ml-annotations-read\",\n                \"is_hidden\": true\n            }\n        },\n        {\n            \"add\": {\n                \"index\": \".ml-annotations-2\",\n                \"alias\": \".ml-annotations-read\",\n                \"is_hidden\": true\n            }\n        }\n    ]\n}\n\nEven though the action is add, you can use it to update aliases that already exist. This is a bit inconvenient, but it's somewhat of a limitation of the alias infrastructure, and we should be able to work around it by querying for the list of indices and alias points to and generating the update aliases list from that. Let me know if this would be troublesome for you/your team.", "url": "https://github.com/elastic/elasticsearch/pull/52547#discussion_r385242649", "createdAt": "2020-02-27T17:00:21Z", "author": {"login": "gwbrown"}, "path": "server/src/main/java/org/elasticsearch/cluster/metadata/AliasOrIndex.java", "diffHunk": "@@ -153,6 +175,24 @@ public void computeAndValidateWriteIndex() {\n                 throw new IllegalStateException(\"alias [\" + aliasName + \"] has more than one write index [\" +\n                     Strings.collectionToCommaDelimitedString(writeIndicesStrings) + \"]\");\n             }\n+\n+            // Validate hidden status\n+            final Map<Boolean, List<IndexMetaData>> groupedByHiddenStatus = referenceIndexMetaDatas.stream()", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjEwNzQwMQ=="}, "originalCommit": {"oid": "c92b0cfa8beb7eb4c58740ef6084e5d913031bca"}, "originalPosition": 79}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTI0ODQxMg==", "bodyText": "Thanks @gwbrown.  I think doing the update as you've shown should be OK for us.", "url": "https://github.com/elastic/elasticsearch/pull/52547#discussion_r385248412", "createdAt": "2020-02-27T17:10:10Z", "author": {"login": "droberts195"}, "path": "server/src/main/java/org/elasticsearch/cluster/metadata/AliasOrIndex.java", "diffHunk": "@@ -153,6 +175,24 @@ public void computeAndValidateWriteIndex() {\n                 throw new IllegalStateException(\"alias [\" + aliasName + \"] has more than one write index [\" +\n                     Strings.collectionToCommaDelimitedString(writeIndicesStrings) + \"]\");\n             }\n+\n+            // Validate hidden status\n+            final Map<Boolean, List<IndexMetaData>> groupedByHiddenStatus = referenceIndexMetaDatas.stream()", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjEwNzQwMQ=="}, "originalCommit": {"oid": "c92b0cfa8beb7eb4c58740ef6084e5d913031bca"}, "originalPosition": 79}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM5NDY2MjM5OnYy", "diffSide": "RIGHT", "path": "server/src/main/java/org/elasticsearch/cluster/metadata/AliasAction.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wMlQxODoyMjo1MlrOFwqIyg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wMlQxODoyMjo1MlrOFwqIyg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjU2NjM0Ng==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                               @Nullable Boolean writeIndex, Boolean isHidden) {\n          \n          \n            \n                               @Nullable Boolean writeIndex, @Nullable Boolean isHidden) {", "url": "https://github.com/elastic/elasticsearch/pull/52547#discussion_r386566346", "createdAt": "2020-03-02T18:22:52Z", "author": {"login": "jaymode"}, "path": "server/src/main/java/org/elasticsearch/cluster/metadata/AliasAction.java", "diffHunk": "@@ -85,11 +85,13 @@ public String getIndex() {\n         @Nullable\n         private final Boolean writeIndex;\n \n+        @Nullable final Boolean isHidden;\n+\n         /**\n          * Build the operation.\n          */\n-        public Add(String index, String alias, @Nullable String filter, @Nullable String indexRouting,\n-                   @Nullable String searchRouting, @Nullable Boolean writeIndex) {\n+        public Add(String index, String alias, @Nullable String filter, @Nullable String indexRouting, @Nullable String searchRouting,\n+                   @Nullable Boolean writeIndex, Boolean isHidden) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "88a3d75ecab45f7c93b87b7ef65d979e16189a07"}, "originalPosition": 12}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM5NDY2NDQ1OnYy", "diffSide": "RIGHT", "path": "server/src/main/java/org/elasticsearch/cluster/metadata/AliasAction.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wMlQxODoyMzozMVrOFwqKCg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wMlQxODoyMzozMVrOFwqKCg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjU2NjY2Ng==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    public Boolean isHidden() {\n          \n          \n            \n                    @Nullable\n          \n          \n            \n                    public Boolean isHidden() {", "url": "https://github.com/elastic/elasticsearch/pull/52547#discussion_r386566666", "createdAt": "2020-03-02T18:23:31Z", "author": {"login": "jaymode"}, "path": "server/src/main/java/org/elasticsearch/cluster/metadata/AliasAction.java", "diffHunk": "@@ -112,6 +115,10 @@ public Boolean writeIndex() {\n             return writeIndex;\n         }\n \n+        public Boolean isHidden() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "88a3d75ecab45f7c93b87b7ef65d979e16189a07"}, "originalPosition": 28}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM5NDY2NjMyOnYy", "diffSide": "RIGHT", "path": "server/src/main/java/org/elasticsearch/cluster/metadata/AliasMetaData.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wMlQxODoyNDowOFrOFwqLMw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wMlQxODoyNDowOFrOFwqLMw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjU2Njk2Mw==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                                      Boolean isHidden) {\n          \n          \n            \n                                      @Nullable Boolean isHidden) {", "url": "https://github.com/elastic/elasticsearch/pull/52547#discussion_r386566963", "createdAt": "2020-03-02T18:24:08Z", "author": {"login": "jaymode"}, "path": "server/src/main/java/org/elasticsearch/cluster/metadata/AliasMetaData.java", "diffHunk": "@@ -59,7 +61,11 @@\n     @Nullable\n     private final Boolean writeIndex;\n \n-    private AliasMetaData(String alias, CompressedXContent filter, String indexRouting, String searchRouting, Boolean writeIndex) {\n+    @Nullable\n+    private final Boolean isHidden;\n+\n+    private AliasMetaData(String alias, CompressedXContent filter, String indexRouting, String searchRouting, Boolean writeIndex,\n+                          Boolean isHidden) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "88a3d75ecab45f7c93b87b7ef65d979e16189a07"}, "originalPosition": 25}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM5NDY2NjkwOnYy", "diffSide": "RIGHT", "path": "server/src/main/java/org/elasticsearch/cluster/metadata/AliasMetaData.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wMlQxODoyNDoyNFrOFwqLsA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wMlQxODoyNDoyNFrOFwqLsA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjU2NzA4OA==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                public Boolean isHidden() {\n          \n          \n            \n                @Nullable\n          \n          \n            \n                public Boolean isHidden() {", "url": "https://github.com/elastic/elasticsearch/pull/52547#discussion_r386567088", "createdAt": "2020-03-02T18:24:24Z", "author": {"login": "jaymode"}, "path": "server/src/main/java/org/elasticsearch/cluster/metadata/AliasMetaData.java", "diffHunk": "@@ -120,6 +128,10 @@ public Boolean writeIndex() {\n         return writeIndex;\n     }\n \n+    public Boolean isHidden() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "88a3d75ecab45f7c93b87b7ef65d979e16189a07"}, "originalPosition": 47}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3826, "cost": 1, "resetAt": "2021-11-12T19:05:54Z"}}}