{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDMyNzEwNDU1", "number": 57951, "title": "Correct how meta-field is defined for pre 7.8 hits", "bodyText": "We keep a static list of meta-fields: META_FIELDS_BEFORE_7_8\nas it was before.\nThis is done to ensure the backwards compatability with pre 7.8 nodes.\nRelates to #57771\nCloses #57831", "createdAt": "2020-06-10T21:23:09Z", "url": "https://github.com/elastic/elasticsearch/pull/57951", "merged": true, "mergeCommit": {"oid": "8bd0147ba79e1753034cd8766a0f305b9f8056c8"}, "closed": true, "closedAt": "2020-06-12T13:39:54Z", "author": {"login": "mayya-sharipova"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcqAaF2AH2gAyNDMyNzEwNDU1OjhjZDA1OGIzNTEzODEzMzNmYTEyMWVmYTI1OTc0YzczNDU4Zjg0OTE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcqiDwzgH2gAyNDMyNzEwNDU1OmQzYzgzOWZiMzUzZDJiM2JmMzhiMGMzNjIyNDhmYzM3NWQ5MjE5OWI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "8cd058b351381333fa121efa25974c73458f8491", "author": {"user": {"login": "mayya-sharipova", "name": "Mayya Sharipova"}}, "url": "https://github.com/elastic/elasticsearch/commit/8cd058b351381333fa121efa25974c73458f8491", "committedDate": "2020-06-10T21:19:24Z", "message": "Correct how meta-field is defined for pre 7.8 hits\n\nWe keep a static list of meta-fields: META_FIELDS_BEFORE_7_8\nas it was before.\nThis is done to ensure the backwards compatability with pre 7.8 nodes.\n\nCloses #57831"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI4Njg2NDYy", "url": "https://github.com/elastic/elasticsearch/pull/57951#pullrequestreview-428686462", "createdAt": "2020-06-11T08:11:07Z", "commit": {"oid": "8cd058b351381333fa121efa25974c73458f8491"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMVQwODoxMTowOFrOGiS_qw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMVQwODoxMTowOFrOGiS_qw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODYxNTk3OQ==", "bodyText": "If I remember correctly we only use isMetadataFieldStatic in a few places now where we read from older nodes. Should we simply make the collection public and remove the static method? Or rename method to something like \"isMetaFieldBefore7dot8\" or something, just to improve readability in the locations where this it is actually used.", "url": "https://github.com/elastic/elasticsearch/pull/57951#discussion_r438615979", "createdAt": "2020-06-11T08:11:08Z", "author": {"login": "cbuescher"}, "path": "server/src/main/java/org/elasticsearch/index/mapper/MapperService.java", "diffHunk": "@@ -813,11 +818,7 @@ public void close() throws IOException {\n      */\n     @Deprecated\n     public static boolean isMetadataFieldStatic(String fieldName) {\n-        if (IndicesModule.getBuiltInMetadataFields().contains(fieldName)) {\n-            return true;\n-        }\n-        // if a node had Size Plugin installed, _size field should also be considered a meta-field\n-        return fieldName.equals(\"_size\");\n+        return META_FIELDS_BEFORE_7_8.contains(fieldName);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8cd058b351381333fa121efa25974c73458f8491"}, "originalPosition": 28}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI4Nzg2NDYw", "url": "https://github.com/elastic/elasticsearch/pull/57951#pullrequestreview-428786460", "createdAt": "2020-06-11T10:30:16Z", "commit": {"oid": "8cd058b351381333fa121efa25974c73458f8491"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "44add125cbff5b57dd93b688f3c461b36efe9923", "author": {"user": {"login": "mayya-sharipova", "name": "Mayya Sharipova"}}, "url": "https://github.com/elastic/elasticsearch/commit/44add125cbff5b57dd93b688f3c461b36efe9923", "committedDate": "2020-06-11T12:38:12Z", "message": "Address Chrishoph's feedback"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7eadf78be25c5952c8187ff130a75f6ed69446c6", "author": {"user": {"login": "mayya-sharipova", "name": "Mayya Sharipova"}}, "url": "https://github.com/elastic/elasticsearch/commit/7eadf78be25c5952c8187ff130a75f6ed69446c6", "committedDate": "2020-06-11T13:47:41Z", "message": "Ensure that META_FIELDS_BEFORE_7DOT8 is used to create test hit instances\n\nSearchHitsTests.testSerializationPre6_6_0 will fail\nif you use different meta-fields that were before"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI4OTQ5Nzcw", "url": "https://github.com/elastic/elasticsearch/pull/57951#pullrequestreview-428949770", "createdAt": "2020-06-11T14:08:03Z", "commit": {"oid": "7eadf78be25c5952c8187ff130a75f6ed69446c6"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMVQxNDowODowNFrOGifGEg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMVQxNDowODowNFrOGifGEg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODgxNDIyNg==", "bodyText": "Just as a last question: why is this necessary? I though the \"old\" collection of meta field names is only used when reading from \"old\" nodes? Why can't we use all built-in fields here since we're already on master?", "url": "https://github.com/elastic/elasticsearch/pull/57951#discussion_r438814226", "createdAt": "2020-06-11T14:08:04Z", "author": {"login": "cbuescher"}, "path": "server/src/test/java/org/elasticsearch/index/get/DocumentFieldTests.java", "diffHunk": "@@ -106,7 +106,7 @@ private static DocumentField mutateDocumentField(DocumentField documentField) {\n             Predicate<String> excludeMetaFieldFilter) {\n         if (isMetafield) {\n             String metaField = randomValueOtherThanMany(excludeMetaFieldFilter,\n-                () -> randomFrom(IndicesModule.getBuiltInMetadataFields()));\n+                () -> randomFrom(MapperService.META_FIELDS_BEFORE_7DOT8));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7eadf78be25c5952c8187ff130a75f6ed69446c6"}, "originalPosition": 14}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d3c839fb353d2b3bf38b0c362248fc375d92199b", "author": {"user": {"login": "mayya-sharipova", "name": "Mayya Sharipova"}}, "url": "https://github.com/elastic/elasticsearch/commit/d3c839fb353d2b3bf38b0c362248fc375d92199b", "committedDate": "2020-06-12T12:31:47Z", "message": "Remove pre 6.6 tests"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 757, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}