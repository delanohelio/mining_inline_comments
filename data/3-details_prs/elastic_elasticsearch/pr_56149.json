{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDEzMTI3MTI3", "number": 56149, "title": "Update DeprecationMap to DynamicMap", "bodyText": "This renames DeprecationMap to DynamicMap, and changes the deprecation messages Map to accept a Map of String (keys) to Functions (updated values) instead. This creates more flexibility in either logging or updating values from params within a script. This change is required to fix (#52103) in a future PR.", "createdAt": "2020-05-04T19:00:15Z", "url": "https://github.com/elastic/elasticsearch/pull/56149", "merged": true, "mergeCommit": {"oid": "6da58eb398411fb4f9012f44cb967623dc18946b"}, "closed": true, "closedAt": "2020-05-05T22:36:42Z", "author": {"login": "jdconrad"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABceC-QKgH2gAyNDEzMTI3MTI3OjFhNmJhZDA3NjA3M2IwZThkY2M5ZGU1ZjQ0Y2QyOTk0YmU3Y2FhNWE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABceX59YAH2gAyNDEzMTI3MTI3OmE5YjE2MTMzYzk0YWJkZGU4NmUyZDIwYjE5MjdiMjk3ODBkZWM0N2Y=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "1a6bad076073b0e8dcc9de5f44cd2994be7caa5a", "author": {"user": {"login": "jdconrad", "name": "Jack Conradson"}}, "url": "https://github.com/elastic/elasticsearch/commit/1a6bad076073b0e8dcc9de5f44cd2994be7caa5a", "committedDate": "2020-05-04T17:31:37Z", "message": "change deprecation map to dynamic map"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA1NDI3NzI2", "url": "https://github.com/elastic/elasticsearch/pull/56149#pullrequestreview-405427726", "createdAt": "2020-05-05T00:08:27Z", "commit": {"oid": "1a6bad076073b0e8dcc9de5f44cd2994be7caa5a"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNVQwMDowODoyOFrOGQWe5g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNVQwMDowOTowOVrOGQWf4A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTc5ODc1OA==", "bodyText": "I might name this like PARAMS_FUNCTIONS or something like that, so it is clear they are part of params.", "url": "https://github.com/elastic/elasticsearch/pull/56149#discussion_r419798758", "createdAt": "2020-05-05T00:08:28Z", "author": {"login": "rjernst"}, "path": "server/src/main/java/org/elasticsearch/script/AbstractSortScript.java", "diffHunk": "@@ -29,14 +31,25 @@\n import java.io.IOException;\n import java.util.HashMap;\n import java.util.Map;\n+import java.util.function.Function;\n \n abstract class AbstractSortScript implements ScorerAware {\n \n-    private static final Map<String, String> DEPRECATIONS = Map.of(\n-            \"doc\",\n-            \"Accessing variable [doc] via [params.doc] from within a sort-script is deprecated in favor of directly accessing [doc].\",\n-            \"_doc\",\n-            \"Accessing variable [doc] via [params._doc] from within a sort-script is deprecated in favor of directly accessing [doc].\");\n+    private static final DeprecationLogger deprecationLogger =\n+            new DeprecationLogger(LogManager.getLogger(DynamicMap.class));\n+    private static final Map<String, Function<Object, Object>> FUNCTIONS = Map.of(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1a6bad076073b0e8dcc9de5f44cd2994be7caa5a"}, "originalPosition": 27}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTc5OTAwOA==", "bodyText": "Could you please add a brief javadoc explaining what this class is?", "url": "https://github.com/elastic/elasticsearch/pull/56149#discussion_r419799008", "createdAt": "2020-05-05T00:09:09Z", "author": {"login": "rjernst"}, "path": "server/src/main/java/org/elasticsearch/script/DynamicMap.java", "diffHunk": "@@ -19,28 +19,20 @@\n \n package org.elasticsearch.script;\n \n-import org.apache.logging.log4j.LogManager;\n-import org.elasticsearch.common.logging.DeprecationLogger;\n-\n import java.util.Collection;\n import java.util.Map;\n import java.util.Set;\n+import java.util.function.Function;\n \n-public final class DeprecationMap implements Map<String, Object> {\n-\n-    private static final DeprecationLogger deprecationLogger =\n-        new DeprecationLogger(LogManager.getLogger(DeprecationMap.class));\n+public final class DynamicMap implements Map<String, Object> {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1a6bad076073b0e8dcc9de5f44cd2994be7caa5a"}, "originalPosition": 16}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f91cadfc80286540750da3943b476a6066d532e3", "author": {"user": {"login": "jdconrad", "name": "Jack Conradson"}}, "url": "https://github.com/elastic/elasticsearch/commit/f91cadfc80286540750da3943b476a6066d532e3", "committedDate": "2020-05-05T16:34:01Z", "message": "response to pr comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a9b16133c94abdde86e2d20b1927b29780dec47f", "author": {"user": {"login": "jdconrad", "name": "Jack Conradson"}}, "url": "https://github.com/elastic/elasticsearch/commit/a9b16133c94abdde86e2d20b1927b29780dec47f", "committedDate": "2020-05-05T17:54:56Z", "message": "Merge branch 'master' into dynamicmap"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 80, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}