{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzgwODIzNzIx", "number": 52884, "title": "EQL: Disable field extraction for source return", "bodyText": "Metric mappings have lots of mappings which, in case of individual field selection, can easily hit the limit of maximum doc value fields or automatons.\nAs fields are not used in EQL, this commit disables field extraction and returns the entire source instead.", "createdAt": "2020-02-27T12:31:53Z", "url": "https://github.com/elastic/elasticsearch/pull/52884", "merged": true, "mergeCommit": {"oid": "79ca586ab1d89d645fb58142b82202f14ce5d361"}, "closed": true, "closedAt": "2020-02-28T11:45:21Z", "author": {"login": "costin"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcIaekkAH2gAyMzgwODIzNzIxOmYwMTIzMDRjYjVmYTY0MTEzMTdiMzYyNmMyMjJjZDY5MTQ4MTU3MDM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcIth8mgH2gAyMzgwODIzNzIxOjBlZWQ2M2ZmNDNjZmU4OTkzZWIxZjkwYWJiMWEwMGQ2NmZiNTRkMzI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "f012304cb5fa6411317b3626c222cd6914815703", "author": {"user": {"login": "costin", "name": "Costin Leau"}}, "url": "https://github.com/elastic/elasticsearch/commit/f012304cb5fa6411317b3626c222cd6914815703", "committedDate": "2020-02-27T12:28:24Z", "message": "EQL: Disable field extraction for source return"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY1NzgzMzcw", "url": "https://github.com/elastic/elasticsearch/pull/52884#pullrequestreview-365783370", "createdAt": "2020-02-27T16:03:05Z", "commit": {"oid": "f012304cb5fa6411317b3626c222cd6914815703"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY2MjIzMDA2", "url": "https://github.com/elastic/elasticsearch/pull/52884#pullrequestreview-366223006", "createdAt": "2020-02-28T08:19:26Z", "commit": {"oid": "f012304cb5fa6411317b3626c222cd6914815703"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yOFQwODoxOToyNlrOFvsvhw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yOFQwODoyOTozNlrOFvs95w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTU2MDQ1NQ==", "bodyText": "The sortBuilder is still defined above. Needs removal? Also, the two comments above are not needed anymore.", "url": "https://github.com/elastic/elasticsearch/pull/52884#discussion_r385560455", "createdAt": "2020-02-28T08:19:26Z", "author": {"login": "astefan"}, "path": "x-pack/plugin/eql/src/main/java/org/elasticsearch/xpack/eql/execution/search/SourceGenerator.java", "diffHunk": "@@ -45,10 +45,7 @@ public static SearchSourceBuilder sourceBuilder(QueryContainer container, QueryB\n         // Iterate through all the columns requested, collecting the fields that\n         // need to be retrieved from the result documents\n \n-        // NB: the sortBuilder takes care of eliminating duplicates\n-        container.fields().forEach(f -> f.v1().collectFields(sortBuilder));\n-        sortBuilder.build(source);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f012304cb5fa6411317b3626c222cd6914815703"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTU2NDEzNQ==", "bodyText": "I would add a comment here explaining the reason for 250 value (that value larger than the 100 doc_values limit in ES). Maybe take the default limit in ES and use here a value made of that limit + 100 or something like that?", "url": "https://github.com/elastic/elasticsearch/pull/52884#discussion_r385564135", "createdAt": "2020-02-28T08:29:36Z", "author": {"login": "astefan"}, "path": "client/rest-high-level/src/test/java/org/elasticsearch/client/EqlIT.java", "diffHunk": "@@ -61,4 +63,31 @@ public void testBasicSearch() throws Exception {\n         assertNotNull(response.hits().events());\n         assertThat(response.hits().events().size(), equalTo(1));\n     }\n+\n+    public void testLargeMapping() throws Exception {\n+        Request doc1 = new Request(HttpPut.METHOD_NAME, \"/index/_doc/1\");\n+\n+        String now = DateUtils.nowWithMillisResolution().format(DateTimeFormatter.ISO_DATE_TIME);\n+        StringBuilder sb = new StringBuilder();\n+        sb.append(\"{\");\n+        for (int i = 0; i < 250; i++) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f012304cb5fa6411317b3626c222cd6914815703"}, "originalPosition": 31}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ffb90b0ed708c6e31df4fa51ce1aeaf5b94f3b99", "author": {"user": {"login": "costin", "name": "Costin Leau"}}, "url": "https://github.com/elastic/elasticsearch/commit/ffb90b0ed708c6e31df4fa51ce1aeaf5b94f3b99", "committedDate": "2020-02-28T09:45:21Z", "message": "Address feedback"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5445289902e15887dec6802f72bd3a9c3a9adffd", "author": {"user": {"login": "costin", "name": "Costin Leau"}}, "url": "https://github.com/elastic/elasticsearch/commit/5445289902e15887dec6802f72bd3a9c3a9adffd", "committedDate": "2020-02-28T10:02:46Z", "message": "Add comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0eed63ff43cfe8993eb1f90abb1a00d66fb54d32", "author": {"user": {"login": "costin", "name": "Costin Leau"}}, "url": "https://github.com/elastic/elasticsearch/commit/0eed63ff43cfe8993eb1f90abb1a00d66fb54d32", "committedDate": "2020-02-28T10:40:17Z", "message": "Merge remote-tracking branch 'remotes/upstream/master' into eql/source-only"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2026, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}