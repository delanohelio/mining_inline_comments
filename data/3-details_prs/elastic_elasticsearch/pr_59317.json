{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ2OTYzOTE0", "number": 59317, "title": "Default to @timestamp in composable template datastream definition", "bodyText": "This removes the data_stream timestamp field specification when\ndefining a composable template.\nThe timestamp field is locked to @timestamp for which we provide a default\nmapping of type date with default options (added with #59244 ), but the user\ncan still provide a custom mapping in the template.\nThe data_stream definition in the composable template is now an empty object:\ndata_stream: {}\n\nRelates to #53100", "createdAt": "2020-07-09T16:20:41Z", "url": "https://github.com/elastic/elasticsearch/pull/59317", "merged": true, "mergeCommit": {"oid": "5609353c5d164e15a636c22019c9c17fa98aac30"}, "closed": true, "closedAt": "2020-07-14T10:45:49Z", "author": {"login": "andreidan"}, "timelineItems": {"totalCount": 31, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABczRfXeAH2gAyNDQ2OTYzOTE0OjhmNmM1ZGE2Y2E3NjNiOWIyZTY4MDFhMWJjMGUzMjEwMjA0NGExNzE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc0yy85gH2gAyNDQ2OTYzOTE0OmQ3NWRiOWUyZGRlNDQxMjAzYzNjMmFiNzAzYjBmNTg2NDI0NmYwYjg=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "8f6c5da6ca763b9b2e6801a1bc0e32102044a171", "author": {"user": {"login": "andreidan", "name": "Andrei Dan"}}, "url": "https://github.com/elastic/elasticsearch/commit/8f6c5da6ca763b9b2e6801a1bc0e32102044a171", "committedDate": "2020-07-09T16:18:52Z", "message": "Default to @timestamp in composable template datastream definition\n\nThis makes the data_stream timestamp field specification optional when\ndefining a composable template.\nWhen there isn't one specified it will default to `@timestamp`."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ1NzgzNTAz", "url": "https://github.com/elastic/elasticsearch/pull/59317#pullrequestreview-445783503", "createdAt": "2020-07-09T16:32:50Z", "commit": {"oid": "8f6c5da6ca763b9b2e6801a1bc0e32102044a171"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOVQxNjozMjo1MVrOGvY9HA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOVQxNjozNToyNlrOGvZC9g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjM0NTExNg==", "bodyText": "I'm not sure if there is any advantage to including the timestamp_field param in the data_stream object anymore. I think it's easier to just tell users to supply an empty body.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            * A `data_stream` definition, optionally containing `@timestamp` in the `timestamp_field`\n          \n          \n            \n            property. If the `@timestamp` field definition is omitted {es} will default to it.\n          \n          \n            \n            The `@timestamp` field must be included in every document indexed to\n          \n          \n            \n            * A `data_stream` object with an empty body (`{ }`). \n          \n      \n    \n    \n  \n\nThe timestamp requirements are already included in the prerequisites:\nhttps://www.elastic.co/guide/en/elasticsearch/reference/master/set-up-a-data-stream.html#data-stream-prereqs\nWe may just want to re-emphasize the @timestamp field is required in the doc index example shown later on this page.\nWe'll also need to update the index template examples. I can do both of those in a follow-up PR.", "url": "https://github.com/elastic/elasticsearch/pull/59317#discussion_r452345116", "createdAt": "2020-07-09T16:32:51Z", "author": {"login": "jrodewig"}, "path": "docs/reference/data-streams/set-up-a-data-stream.asciidoc", "diffHunk": "@@ -131,8 +131,9 @@ this pattern.\n ----\n ====\n \n-* A `data_stream` definition containing `@timestamp` in the `timestamp_field`\n-property. The `@timestamp` field must be included in every document indexed to\n+* A `data_stream` definition, optionally containing `@timestamp` in the `timestamp_field`\n+property. If the `@timestamp` field definition is omitted {es} will default to it.\n+The `@timestamp` field must be included in every document indexed to", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8f6c5da6ca763b9b2e6801a1bc0e32102044a171"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjM0NjYxNA==", "bodyText": "I'd change the last sentence to:\n\nMust be @timestamp, which is the default.", "url": "https://github.com/elastic/elasticsearch/pull/59317#discussion_r452346614", "createdAt": "2020-07-09T16:35:26Z", "author": {"login": "jrodewig"}, "path": "docs/reference/indices/index-templates.asciidoc", "diffHunk": "@@ -505,9 +505,9 @@ PUT /_index_template/template_1\n Required properties of a data stream definition:\n \n `timestamp_field`::\n-(Required, string) The name of the timestamp field. This field must be present\n+(Optional, string) The name of the timestamp field. This field must be present\n in all documents indexed into the data stream and must be of type\n-<<date, `date`>> or <<date_nanos, `date_nanos`>>.\n+<<date, `date`>> or <<date_nanos, `date_nanos`>>. Defaults to `@timestamp`.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8f6c5da6ca763b9b2e6801a1bc0e32102044a171"}, "originalPosition": 8}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fb6b62aa87be213f226a78138b067c4ee1528ed8", "author": {"user": {"login": "andreidan", "name": "Andrei Dan"}}, "url": "https://github.com/elastic/elasticsearch/commit/fb6b62aa87be213f226a78138b067c4ee1528ed8", "committedDate": "2020-07-09T17:15:39Z", "message": "Fix yaml test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "65c1d5d7da1cb6bad87491fc0de3a8d359ce40e4", "author": {"user": {"login": "andreidan", "name": "Andrei Dan"}}, "url": "https://github.com/elastic/elasticsearch/commit/65c1d5d7da1cb6bad87491fc0de3a8d359ce40e4", "committedDate": "2020-07-09T17:59:05Z", "message": "Update index templates doc"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9646bdc670f140af6aaa979fd769ca0b40da600a", "author": {"user": {"login": "andreidan", "name": "Andrei Dan"}}, "url": "https://github.com/elastic/elasticsearch/commit/9646bdc670f140af6aaa979fd769ca0b40da600a", "committedDate": "2020-07-09T17:59:55Z", "message": "Mention only the empty body `data_stream`\n\nCo-authored-by: James Rodewig <james.rodewig@elastic.co>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c920a53ba9d23954c776c324dbd8794844fdd2eb", "author": {"user": {"login": "elasticmachine", "name": "Elastic Machine"}}, "url": "https://github.com/elastic/elasticsearch/commit/c920a53ba9d23954c776c324dbd8794844fdd2eb", "committedDate": "2020-07-09T18:00:26Z", "message": "Merge branch 'master' into default-ds-timestamp-definition"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cce093db1c4c37d271c508d0f3cc4ed376d326e7", "author": {"user": {"login": "andreidan", "name": "Andrei Dan"}}, "url": "https://github.com/elastic/elasticsearch/commit/cce093db1c4c37d271c508d0f3cc4ed376d326e7", "committedDate": "2020-07-09T20:21:13Z", "message": "Use the empty `data_stream` definition in yaml tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8d1d81953f7b889b2ad0562998ab8406af156089", "author": {"user": {"login": "andreidan", "name": "Andrei Dan"}}, "url": "https://github.com/elastic/elasticsearch/commit/8d1d81953f7b889b2ad0562998ab8406af156089", "committedDate": "2020-07-10T15:24:10Z", "message": "Disablle more yaml tests in 7.9"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "69a34f72d7c31a90b9fd346b8884cbbd779642ed", "author": {"user": {"login": "elasticmachine", "name": "Elastic Machine"}}, "url": "https://github.com/elastic/elasticsearch/commit/69a34f72d7c31a90b9fd346b8884cbbd779642ed", "committedDate": "2020-07-13T08:47:07Z", "message": "Merge branch 'master' into default-ds-timestamp-definition"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ3MDU5MTIw", "url": "https://github.com/elastic/elasticsearch/pull/59317#pullrequestreview-447059120", "createdAt": "2020-07-13T08:58:25Z", "commit": {"oid": "69a34f72d7c31a90b9fd346b8884cbbd779642ed"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xM1QwODo1ODoyNlrOGwfXIw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xM1QwODo1ODoyNlrOGwfXIw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzQ5ODY1OQ==", "bodyText": "maybe remove this field from the xcontent format? So that the only valid format is an empty json object?", "url": "https://github.com/elastic/elasticsearch/pull/59317#discussion_r453498659", "createdAt": "2020-07-13T08:58:26Z", "author": {"login": "martijnvg"}, "path": "server/src/main/java/org/elasticsearch/cluster/metadata/ComposableIndexTemplate.java", "diffHunk": "@@ -250,11 +250,11 @@ public String toString() {\n \n         private static final ConstructingObjectParser<DataStreamTemplate, Void> PARSER = new ConstructingObjectParser<>(\n             \"data_stream_template\",\n-            args -> new DataStreamTemplate((String) args[0])\n+            args -> new DataStreamTemplate(args[0] != null ? (String) args[0] : FIXED_TIMESTAMP_FIELD)\n         );\n \n         static {\n-            PARSER.declareString(ConstructingObjectParser.constructorArg(), DataStream.TIMESTAMP_FIELD_FIELD);\n+            PARSER.declareString(ConstructingObjectParser.optionalConstructorArg(), DataStream.TIMESTAMP_FIELD_FIELD);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "69a34f72d7c31a90b9fd346b8884cbbd779642ed"}, "originalPosition": 10}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d55060dad39c4f663ab0da9e3a109dbe196fc22b", "author": {"user": {"login": "andreidan", "name": "Andrei Dan"}}, "url": "https://github.com/elastic/elasticsearch/commit/d55060dad39c4f663ab0da9e3a109dbe196fc22b", "committedDate": "2020-07-13T13:00:08Z", "message": "Remove timestamp_field from data_stream definition\n\nThis will always be @timestamp"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "98b23e5f025ff744688426ea41947cd6b1af4289", "author": {"user": {"login": "andreidan", "name": "Andrei Dan"}}, "url": "https://github.com/elastic/elasticsearch/commit/98b23e5f025ff744688426ea41947cd6b1af4289", "committedDate": "2020-07-13T14:02:49Z", "message": "Handle equals and hashcode for empty DataStreamTemplate"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1a73aaffbd1a83aa68dc5c8fa46376fc0f7a22cf", "author": {"user": {"login": "andreidan", "name": "Andrei Dan"}}, "url": "https://github.com/elastic/elasticsearch/commit/1a73aaffbd1a83aa68dc5c8fa46376fc0f7a22cf", "committedDate": "2020-07-13T14:03:07Z", "message": "Update xpack templates to not specify the timestamp_field"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0bc0ae46e13b35b40a9dc0d5e99cb5d1695cbcfd", "author": {"user": {"login": "andreidan", "name": "Andrei Dan"}}, "url": "https://github.com/elastic/elasticsearch/commit/0bc0ae46e13b35b40a9dc0d5e99cb5d1695cbcfd", "committedDate": "2020-07-13T14:52:32Z", "message": "Merge branch 'master' into default-ds-timestamp-definition"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8a1a75d8b6c90e9b7364c1f3ad3aaf06e50cf7fd", "author": {"user": {"login": "andreidan", "name": "Andrei Dan"}}, "url": "https://github.com/elastic/elasticsearch/commit/8a1a75d8b6c90e9b7364c1f3ad3aaf06e50cf7fd", "committedDate": "2020-07-13T15:59:43Z", "message": "Deleting this test as it's been moved to the `data-streams` module"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0b4b0b27dade2a202b12219a0317c20735ddfc6a", "author": {"user": {"login": "andreidan", "name": "Andrei Dan"}}, "url": "https://github.com/elastic/elasticsearch/commit/0b4b0b27dade2a202b12219a0317c20735ddfc6a", "committedDate": "2020-07-13T16:01:35Z", "message": "Fix merge"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "aaa65676b53569fc404a4393e10853cf588faa44", "author": {"user": {"login": "andreidan", "name": "Andrei Dan"}}, "url": "https://github.com/elastic/elasticsearch/commit/aaa65676b53569fc404a4393e10853cf588faa44", "committedDate": "2020-07-13T16:10:18Z", "message": "Drop timestamp_field from data_stream definitions"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "757376088f69972513d5c5d405abb57ffde6cab0", "author": {"user": {"login": "andreidan", "name": "Andrei Dan"}}, "url": "https://github.com/elastic/elasticsearch/commit/757376088f69972513d5c5d405abb57ffde6cab0", "committedDate": "2020-07-13T16:10:33Z", "message": "Spotless"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6dad7fbe22c577e588fb00e5ce33bd60a89061ae", "author": {"user": {"login": "andreidan", "name": "Andrei Dan"}}, "url": "https://github.com/elastic/elasticsearch/commit/6dad7fbe22c577e588fb00e5ce33bd60a89061ae", "committedDate": "2020-07-13T16:15:11Z", "message": "DOCS: remove mention of the `timestamp_field` in the `data_stream` definition"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f7ac1ef18225a41eed2b55511025532586c7ae91", "author": {"user": {"login": "andreidan", "name": "Andrei Dan"}}, "url": "https://github.com/elastic/elasticsearch/commit/f7ac1ef18225a41eed2b55511025532586c7ae91", "committedDate": "2020-07-13T17:39:53Z", "message": "Fix post merge compilation errors"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c62f1d419d2457a5b049137bcc2fca265f7f32c8", "author": {"user": {"login": "andreidan", "name": "Andrei Dan"}}, "url": "https://github.com/elastic/elasticsearch/commit/c62f1d419d2457a5b049137bcc2fca265f7f32c8", "committedDate": "2020-07-13T17:47:42Z", "message": "DOCS: update ilm tutorial"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "23b8cd623ba2a5120d184a047a500acaf37bc4d3", "author": {"user": {"login": "andreidan", "name": "Andrei Dan"}}, "url": "https://github.com/elastic/elasticsearch/commit/23b8cd623ba2a5120d184a047a500acaf37bc4d3", "committedDate": "2020-07-13T18:21:00Z", "message": "Drop the timestamp_field definition from tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "40de34bd24802e1c34ebbadf69942c30aedb65f4", "author": {"user": {"login": "elasticmachine", "name": "Elastic Machine"}}, "url": "https://github.com/elastic/elasticsearch/commit/40de34bd24802e1c34ebbadf69942c30aedb65f4", "committedDate": "2020-07-13T18:55:55Z", "message": "Merge branch 'master' into default-ds-timestamp-definition"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b81a69f1d0278bc8ecc0ed3fc9634624916918ce", "author": {"user": {"login": "andreidan", "name": "Andrei Dan"}}, "url": "https://github.com/elastic/elasticsearch/commit/b81a69f1d0278bc8ecc0ed3fc9634624916918ce", "committedDate": "2020-07-13T18:56:27Z", "message": "Fix docs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2543e17189fa83716f64b0a7cbddaa319443f672", "author": {"user": {"login": "andreidan", "name": "Andrei Dan"}}, "url": "https://github.com/elastic/elasticsearch/commit/2543e17189fa83716f64b0a7cbddaa319443f672", "committedDate": "2020-07-13T18:58:02Z", "message": "Disable bwc tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6c5d3f7e2ab0aa816cb6526494ec2722b2e82e7d", "author": {"user": {"login": "andreidan", "name": "Andrei Dan"}}, "url": "https://github.com/elastic/elasticsearch/commit/6c5d3f7e2ab0aa816cb6526494ec2722b2e82e7d", "committedDate": "2020-07-13T19:20:03Z", "message": "Remove more timestamp_field declarations"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c2a750b5fdecfb2374d0d4ff78ebd992e21d57c2", "author": {"user": {"login": "andreidan", "name": "Andrei Dan"}}, "url": "https://github.com/elastic/elasticsearch/commit/c2a750b5fdecfb2374d0d4ff78ebd992e21d57c2", "committedDate": "2020-07-13T21:07:28Z", "message": "Fix TimeSeriesDataStreamsIT"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fc191757afea898129621765f8e1d5d4e78d4927", "author": {"user": {"login": "andreidan", "name": "Andrei Dan"}}, "url": "https://github.com/elastic/elasticsearch/commit/fc191757afea898129621765f8e1d5d4e78d4927", "committedDate": "2020-07-14T03:04:11Z", "message": "Fix TransformRestTestCase"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3c737c2af9bcc57da073b2e50e3a78216e22ca32", "author": {"user": {"login": "andreidan", "name": "Andrei Dan"}}, "url": "https://github.com/elastic/elasticsearch/commit/3c737c2af9bcc57da073b2e50e3a78216e22ca32", "committedDate": "2020-07-14T08:15:38Z", "message": "Fix DataStreamsUpgradeIT"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fc7fb1eb36b4c6011ff412b305472621786d06bd", "author": {"user": {"login": "andreidan", "name": "Andrei Dan"}}, "url": "https://github.com/elastic/elasticsearch/commit/fc7fb1eb36b4c6011ff412b305472621786d06bd", "committedDate": "2020-07-14T09:30:23Z", "message": "Merge branch 'master' into default-ds-timestamp-definition"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d75db9e2dde441203c3c2ab703b0f5864246f0b8", "author": {"user": {"login": "andreidan", "name": "Andrei Dan"}}, "url": "https://github.com/elastic/elasticsearch/commit/d75db9e2dde441203c3c2ab703b0f5864246f0b8", "committedDate": "2020-07-14T09:41:03Z", "message": "Fix merge"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2138, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}