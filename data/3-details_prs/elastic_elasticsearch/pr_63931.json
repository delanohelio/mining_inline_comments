{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTA2NzQzMTkw", "number": 63931, "title": "make sure AggregationTest creates reduced aggregations.", "bodyText": "The test calls  InternalAggregationTestCase#createTestInstanceForXContent()  instead  of InternalAggregationTestCase#createTestInstance().  The method needs to become public.\nFixes #63925", "createdAt": "2020-10-20T12:15:02Z", "url": "https://github.com/elastic/elasticsearch/pull/63931", "merged": true, "mergeCommit": {"oid": "658acdb2540c3500e8535c022dc7a4a816e7c258"}, "closed": true, "closedAt": "2020-10-20T14:59:54Z", "author": {"login": "iverase"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdUXpgCAH2gAyNTA2NzQzMTkwOjhiYmRiNjQ0NzNhYWE0ODNkMjQ1ZDhmM2YyYWZkOTMwMjE1MzFkMTk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdUYmMzAFqTUxMjY5Mzk1OA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "8bbdb64473aaa483d245d8f3f2afd93021531d19", "author": {"user": {"login": "iverase", "name": "Ignacio Vera"}}, "url": "https://github.com/elastic/elasticsearch/commit/8bbdb64473aaa483d245d8f3f2afd93021531d19", "committedDate": "2020-10-20T12:08:52Z", "message": "make sure aggregation list has at least one element"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTEyNjU2MzM4", "url": "https://github.com/elastic/elasticsearch/pull/63931#pullrequestreview-512656338", "createdAt": "2020-10-20T12:35:07Z", "commit": {"oid": "8bbdb64473aaa483d245d8f3f2afd93021531d19"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMFQxMjozNTowOFrOHk6FUg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMFQxMjozNTowOFrOHk6FUg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODQ2MjQxOA==", "bodyText": "I don't think this is the right fix. The tests that fail are the one that always expect a reduced aggregation so they require a single element. That's why InternalAggregationTestCase#createTestInstanceForXContent was added but it's not used in AggregationsTests. See \n  \n    \n      elasticsearch/server/src/test/java/org/elasticsearch/search/aggregations/AggregationsTests.java\n    \n    \n         Line 299\n      in\n      f20699e\n    \n    \n    \n    \n\n        \n          \n           aggs.add(testCase.createTestInstance()); \n        \n    \n  \n\n where replacing the call with createTestInstanceForXContent fixes all the failures.", "url": "https://github.com/elastic/elasticsearch/pull/63931#discussion_r508462418", "createdAt": "2020-10-20T12:35:08Z", "author": {"login": "jimczi"}, "path": "server/src/test/java/org/elasticsearch/search/aggregations/metrics/InternalScriptedMetricTests.java", "diffHunk": "@@ -91,7 +91,7 @@ protected InternalScriptedMetric createTestInstance(String name, Map<String, Obj\n     }\n \n     private List<Object> randomAggregations() {\n-        return randomList(randomBoolean() ? 1 : 5, this::randomAggregation);\n+        return randomList(1, randomBoolean() ? 1 : 5, this::randomAggregation);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8bbdb64473aaa483d245d8f3f2afd93021531d19"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cca16eaa99c77b4f8f6e34f8da81ad3d390e2e47", "author": {"user": {"login": "iverase", "name": "Ignacio Vera"}}, "url": "https://github.com/elastic/elasticsearch/commit/cca16eaa99c77b4f8f6e34f8da81ad3d390e2e47", "committedDate": "2020-10-20T12:59:26Z", "message": "apply fix by making createTestInstanceForXContent accessible to the test"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTEyNjkzOTU4", "url": "https://github.com/elastic/elasticsearch/pull/63931#pullrequestreview-512693958", "createdAt": "2020-10-20T13:15:10Z", "commit": {"oid": "cca16eaa99c77b4f8f6e34f8da81ad3d390e2e47"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1185, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}