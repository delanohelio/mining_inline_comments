{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY0NjUxNzk0", "number": 51207, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMVQxMjo0MTozMlrODZejig==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMVQxMjo0NjoxNFrODZeoeQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI4MDQxNjEwOnYy", "diffSide": "RIGHT", "path": "server/src/main/java/org/elasticsearch/search/DefaultSearchContext.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMVQxMjo0MTozMlrOFf4mWQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMVQxMjo0MTozMlrOFf4mWQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODk3NzQ5Nw==", "bodyText": "nit: space before else", "url": "https://github.com/elastic/elasticsearch/pull/51207#discussion_r368977497", "createdAt": "2020-01-21T12:41:32Z", "author": {"login": "mayya-sharipova"}, "path": "server/src/main/java/org/elasticsearch/search/DefaultSearchContext.java", "diffHunk": "@@ -274,7 +275,12 @@ public Query buildFilteredQuery(Query query) {\n         }\n \n         if (sliceBuilder != null) {\n-            filters.add(sliceBuilder.toFilter(clusterService, request, queryShardContext));\n+            Query slicedQuery = sliceBuilder.toFilter(clusterService, request, queryShardContext);\n+            if ( slicedQuery instanceof MatchNoDocsQuery){\n+                return slicedQuery;\n+            }else {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ede23e028a848f13b88416ce8addb305154e7c48"}, "originalPosition": 16}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI4MDQxNzkyOnYy", "diffSide": "RIGHT", "path": "server/src/main/java/org/elasticsearch/search/DefaultSearchContext.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMVQxMjo0MjoxNVrOFf4neQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMVQxMjo0MjoxNVrOFf4neQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODk3Nzc4NQ==", "bodyText": "extra space after (", "url": "https://github.com/elastic/elasticsearch/pull/51207#discussion_r368977785", "createdAt": "2020-01-21T12:42:15Z", "author": {"login": "mayya-sharipova"}, "path": "server/src/main/java/org/elasticsearch/search/DefaultSearchContext.java", "diffHunk": "@@ -274,7 +275,12 @@ public Query buildFilteredQuery(Query query) {\n         }\n \n         if (sliceBuilder != null) {\n-            filters.add(sliceBuilder.toFilter(clusterService, request, queryShardContext));\n+            Query slicedQuery = sliceBuilder.toFilter(clusterService, request, queryShardContext);\n+            if ( slicedQuery instanceof MatchNoDocsQuery){", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ede23e028a848f13b88416ce8addb305154e7c48"}, "originalPosition": 14}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI4MDQyNjg4OnYy", "diffSide": "RIGHT", "path": "server/src/test/java/org/elasticsearch/search/DefaultSearchContextTests.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMVQxMjo0NTozM1rOFf4s5Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMVQxMjo0NTozM1rOFf4s5Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODk3OTE3Mw==", "bodyText": "nit: new DefaultSearchContext(3L, =>  new DefaultSearchContext(4L,", "url": "https://github.com/elastic/elasticsearch/pull/51207#discussion_r368979173", "createdAt": "2020-01-21T12:45:33Z", "author": {"login": "mayya-sharipova"}, "path": "server/src/test/java/org/elasticsearch/search/DefaultSearchContextTests.java", "diffHunk": "@@ -178,6 +182,20 @@ public void testPreProcess() throws Exception {\n             ParsedQuery parsedQuery = ParsedQuery.parsedMatchAllQuery();\n             context3.sliceBuilder(null).parsedQuery(parsedQuery).preProcess(false);\n             assertEquals(context3.query(), context3.buildFilteredQuery(parsedQuery.query()));\n+\n+            when(queryShardContext.getIndexSettings()).thenReturn(indexSettings);\n+            when(indexService.newQueryShardContext(anyInt(),anyObject(),anyObject(),anyString())).thenReturn(queryShardContext);\n+            when(queryShardContext.fieldMapper(anyString())).thenReturn(mock(MappedFieldType.class));\n+            when(shardSearchRequest.indexRoutings()).thenReturn(new String[0]);\n+\n+            DefaultSearchContext context4 = new DefaultSearchContext(3L, shardSearchRequest, target, searcher, null,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ede23e028a848f13b88416ce8addb305154e7c48"}, "originalPosition": 35}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI4MDQyODczOnYy", "diffSide": "RIGHT", "path": "server/src/test/java/org/elasticsearch/search/DefaultSearchContextTests.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMVQxMjo0NjoxNFrOFf4uBA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMVQxNDoxMzoxMVrOFf7X0Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODk3OTQ2MA==", "bodyText": "Looks like, line 187 in not necessary", "url": "https://github.com/elastic/elasticsearch/pull/51207#discussion_r368979460", "createdAt": "2020-01-21T12:46:14Z", "author": {"login": "mayya-sharipova"}, "path": "server/src/test/java/org/elasticsearch/search/DefaultSearchContextTests.java", "diffHunk": "@@ -178,6 +182,20 @@ public void testPreProcess() throws Exception {\n             ParsedQuery parsedQuery = ParsedQuery.parsedMatchAllQuery();\n             context3.sliceBuilder(null).parsedQuery(parsedQuery).preProcess(false);\n             assertEquals(context3.query(), context3.buildFilteredQuery(parsedQuery.query()));\n+\n+            when(queryShardContext.getIndexSettings()).thenReturn(indexSettings);\n+            when(indexService.newQueryShardContext(anyInt(),anyObject(),anyObject(),anyString())).thenReturn(queryShardContext);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ede23e028a848f13b88416ce8addb305154e7c48"}, "originalPosition": 31}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTAyMjkyOQ==", "bodyText": "Thanks for review , it is not necessary. I think i added in my first attempt to include use-case with routings in test. I've reformatted code with intelliJ   - sorry for formatting issues.", "url": "https://github.com/elastic/elasticsearch/pull/51207#discussion_r369022929", "createdAt": "2020-01-21T14:13:11Z", "author": {"login": "nirmalc"}, "path": "server/src/test/java/org/elasticsearch/search/DefaultSearchContextTests.java", "diffHunk": "@@ -178,6 +182,20 @@ public void testPreProcess() throws Exception {\n             ParsedQuery parsedQuery = ParsedQuery.parsedMatchAllQuery();\n             context3.sliceBuilder(null).parsedQuery(parsedQuery).preProcess(false);\n             assertEquals(context3.query(), context3.buildFilteredQuery(parsedQuery.query()));\n+\n+            when(queryShardContext.getIndexSettings()).thenReturn(indexSettings);\n+            when(indexService.newQueryShardContext(anyInt(),anyObject(),anyObject(),anyString())).thenReturn(queryShardContext);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODk3OTQ2MA=="}, "originalCommit": {"oid": "ede23e028a848f13b88416ce8addb305154e7c48"}, "originalPosition": 31}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4555, "cost": 1, "resetAt": "2021-11-12T13:16:51Z"}}}