{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQxMzE2NzIx", "number": 58658, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yOVQxMzo1Mjo1NVrOEJq4Gg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0zMFQwODowMjoyNlrOEJ-xaw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc4NTc1MTMwOnYy", "diffSide": "RIGHT", "path": "docs/plugins/repository-shared-settings.asciidoc", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yOVQxMzo1Mjo1NVrOGqSA5g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yOVQxNDowMDoyNlrOGqSWVQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Njk4ODUxOA==", "bodyText": "This file is used in the Plugins and Integrations book, which is separate from the Elasticsearch Reference. Because an internal xref is used, the system assumes the reference exists in Plugins and Integrations.\nYou can fix this by using an external link instead:\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                Note that restores are also throttled through <<recovery,recovery settings>>.\n          \n          \n            \n                Note that restores are also throttled through {ref}/recovery.html[recovery settings].", "url": "https://github.com/elastic/elasticsearch/pull/58658#discussion_r446988518", "createdAt": "2020-06-29T13:52:55Z", "author": {"login": "jrodewig"}, "path": "docs/plugins/repository-shared-settings.asciidoc", "diffHunk": "@@ -1,11 +1,12 @@\n `max_restore_bytes_per_sec`::\n \n-    Throttles per node restore rate. Defaults to `40mb` per second.\n+    Throttles per node restore rate. Defaults to unlimited.\n+    Note that restores are also throttled through <<recovery,recovery settings>>.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "35a1f569752bed83e481b602f201f9fae87f499b"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Njk5MzA0Ng==", "bodyText": "Thank you so much!", "url": "https://github.com/elastic/elasticsearch/pull/58658#discussion_r446993046", "createdAt": "2020-06-29T13:59:09Z", "author": {"login": "ywelsch"}, "path": "docs/plugins/repository-shared-settings.asciidoc", "diffHunk": "@@ -1,11 +1,12 @@\n `max_restore_bytes_per_sec`::\n \n-    Throttles per node restore rate. Defaults to `40mb` per second.\n+    Throttles per node restore rate. Defaults to unlimited.\n+    Note that restores are also throttled through <<recovery,recovery settings>>.", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Njk4ODUxOA=="}, "originalCommit": {"oid": "35a1f569752bed83e481b602f201f9fae87f499b"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Njk5NDAwNQ==", "bodyText": "Happy to help!", "url": "https://github.com/elastic/elasticsearch/pull/58658#discussion_r446994005", "createdAt": "2020-06-29T14:00:26Z", "author": {"login": "jrodewig"}, "path": "docs/plugins/repository-shared-settings.asciidoc", "diffHunk": "@@ -1,11 +1,12 @@\n `max_restore_bytes_per_sec`::\n \n-    Throttles per node restore rate. Defaults to `40mb` per second.\n+    Throttles per node restore rate. Defaults to unlimited.\n+    Note that restores are also throttled through <<recovery,recovery settings>>.", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Njk4ODUxOA=="}, "originalCommit": {"oid": "35a1f569752bed83e481b602f201f9fae87f499b"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc4NjEyODg2OnYy", "diffSide": "RIGHT", "path": "server/src/main/java/org/elasticsearch/repositories/blobstore/BlobStoreRepository.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yOVQxNToxMzozNlrOGqVogQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0zMFQwNzozMToxN1rOGqvbAw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzA0NzgwOQ==", "bodyText": "recoverySettings.rateLimiter() doesn't stay constant if you completely enable/disable recovery rate limiting. In peer recovery we get it anew for each file chunk sent/received, whereas here a change may only take effect at the start of a blob.", "url": "https://github.com/elastic/elasticsearch/pull/58658#discussion_r447047809", "createdAt": "2020-06-29T15:13:36Z", "author": {"login": "DaveCTurner"}, "path": "server/src/main/java/org/elasticsearch/repositories/blobstore/BlobStoreRepository.java", "diffHunk": "@@ -2032,7 +2037,8 @@ private static InputStream maybeRateLimit(InputStream stream, @Nullable RateLimi\n     }\n \n     public InputStream maybeRateLimitRestores(InputStream stream) {\n-        return maybeRateLimit(stream, restoreRateLimiter, restoreRateLimitingTimeInNanos);\n+        return maybeRateLimit(maybeRateLimit(stream, restoreRateLimiter, restoreRateLimitingTimeInNanos),\n+            recoverySettings.rateLimiter(), restoreRateLimitingTimeInNanos);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f44ad38b27545db9fcda958cb27a34ff0af879a6"}, "originalPosition": 40}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzQ3MDMzOQ==", "bodyText": "I've pushed a576d8d", "url": "https://github.com/elastic/elasticsearch/pull/58658#discussion_r447470339", "createdAt": "2020-06-30T07:31:17Z", "author": {"login": "ywelsch"}, "path": "server/src/main/java/org/elasticsearch/repositories/blobstore/BlobStoreRepository.java", "diffHunk": "@@ -2032,7 +2037,8 @@ private static InputStream maybeRateLimit(InputStream stream, @Nullable RateLimi\n     }\n \n     public InputStream maybeRateLimitRestores(InputStream stream) {\n-        return maybeRateLimit(stream, restoreRateLimiter, restoreRateLimitingTimeInNanos);\n+        return maybeRateLimit(maybeRateLimit(stream, restoreRateLimiter, restoreRateLimitingTimeInNanos),\n+            recoverySettings.rateLimiter(), restoreRateLimitingTimeInNanos);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzA0NzgwOQ=="}, "originalCommit": {"oid": "f44ad38b27545db9fcda958cb27a34ff0af879a6"}, "originalPosition": 40}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc4OTAxMDk5OnYy", "diffSide": "RIGHT", "path": "server/src/internalClusterTest/java/org/elasticsearch/snapshots/SharedClusterSnapshotRestoreIT.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0zMFQwODowMjoyNlrOGqwluA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0zMFQwOTowODozMVrOGqzMHQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzQ4OTQ2NA==", "bodyText": "I think this test would have passed before this change, although maybe a bit slower. Doesn't seem to be much slower, however. Can we somehow assert that it really does run at full speed at the end?\n(I couldn't think of a simple way to do this, we can leave it as-is if you can't either)", "url": "https://github.com/elastic/elasticsearch/pull/58658#discussion_r447489464", "createdAt": "2020-06-30T08:02:26Z", "author": {"login": "DaveCTurner"}, "path": "server/src/internalClusterTest/java/org/elasticsearch/snapshots/SharedClusterSnapshotRestoreIT.java", "diffHunk": "@@ -2072,6 +2072,57 @@ public void testThrottling() throws Exception {\n             .putNull(INDICES_RECOVERY_MAX_BYTES_PER_SEC_SETTING.getKey()).build()).get();\n     }\n \n+    public void testDynamicRestoreThrottling() throws Exception {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a576d8d77ff6b77a04e41011591498d7dc9bc04b"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzUzMjA2MQ==", "bodyText": "I've pushed a5c576b. Let me know what you think", "url": "https://github.com/elastic/elasticsearch/pull/58658#discussion_r447532061", "createdAt": "2020-06-30T09:08:31Z", "author": {"login": "ywelsch"}, "path": "server/src/internalClusterTest/java/org/elasticsearch/snapshots/SharedClusterSnapshotRestoreIT.java", "diffHunk": "@@ -2072,6 +2072,57 @@ public void testThrottling() throws Exception {\n             .putNull(INDICES_RECOVERY_MAX_BYTES_PER_SEC_SETTING.getKey()).build()).get();\n     }\n \n+    public void testDynamicRestoreThrottling() throws Exception {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzQ4OTQ2NA=="}, "originalCommit": {"oid": "a576d8d77ff6b77a04e41011591498d7dc9bc04b"}, "originalPosition": 4}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2234, "cost": 1, "resetAt": "2021-11-12T13:16:51Z"}}}