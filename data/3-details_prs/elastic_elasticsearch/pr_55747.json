{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA4NzQxMjU1", "number": 55747, "title": "Removed ValuesSourceRegistry.registerAny()", "bodyText": "ValuesSourcesRegistry implemented method registerAny() that would automatically register a default aggregator implementation for any ValuesSourceType. Although, this was a very powerful feature, it was not very flexible, as there was no way to override the default aggregator for one or more ValuesSourceTypes.\nThe aggregations that used the registerAny() method so far were: missing, value_count and cardinality.\nIn this PR we remove the registerAny() method and replace it with explicitly registering all ValuesSourceType with their aggregator. This means that all CoreValuesSourceType classes are registered explicitly with their aggregators (for missing, value_count and cardinality).\nFor the sub-classes of ValuesSourceType that live in plugins, registering their aggregator is delegated to the plugins.  This allows plugins to register their own implementation of common aggregations.", "createdAt": "2020-04-24T20:05:26Z", "url": "https://github.com/elastic/elasticsearch/pull/55747", "merged": true, "mergeCommit": {"oid": "ee9b492249bc661b9f10a005974d07563f4b0b33"}, "closed": true, "closedAt": "2020-04-27T21:47:19Z", "author": {"login": "csoulios"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABca2_lJAH2gAyNDA4NzQxMjU1OjQ0ZDJhYmI1ZmFjOTEwMTJlMDc3M2ZjNzAzODMwYTJmYTZiMjhmOTU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcb1jeKgH2gAyNDA4NzQxMjU1OjkwZWE3ZGRkMWE2ZWFhZWI3ZmFlY2M4M2UwMWE5MTI3OGRlZjAwOGM=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "44d2abb5fac91012e0773fc703830a2fa6b28f95", "author": {"user": {"login": "csoulios", "name": "Christos Soulios"}}, "url": "https://github.com/elastic/elasticsearch/commit/44d2abb5fac91012e0773fc703830a2fa6b28f95", "committedDate": "2020-04-24T19:52:26Z", "message": "Removed VSRegistry.registerAny()\n\nAll ValuesSourceTypes must be registered\nexplicitly"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1c41ae9d94d55af2d8c9fce4d3fa70a23cdb8b6f", "author": {"user": {"login": "csoulios", "name": "Christos Soulios"}}, "url": "https://github.com/elastic/elasticsearch/commit/1c41ae9d94d55af2d8c9fce4d3fa70a23cdb8b6f", "committedDate": "2020-04-24T20:21:03Z", "message": "Minor style changes"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAwMjYwOTg3", "url": "https://github.com/elastic/elasticsearch/pull/55747#pullrequestreview-400260987", "createdAt": "2020-04-24T20:48:30Z", "commit": {"oid": "1c41ae9d94d55af2d8c9fce4d3fa70a23cdb8b6f"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAwMjY0NTA2", "url": "https://github.com/elastic/elasticsearch/pull/55747#pullrequestreview-400264506", "createdAt": "2020-04-24T20:55:08Z", "commit": {"oid": "1c41ae9d94d55af2d8c9fce4d3fa70a23cdb8b6f"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yNFQyMDo1NTowOVrOGLo47w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yNFQyMDo1NTowOVrOGLo47w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDg1NzQ1NQ==", "bodyText": "I think ALL might be a bit confusing here. I wonder if renaming it into ALL_CORE or using Arrays.asList(CoreValuesSourceType.values()) instead of the constant will better demonstrate the actual scope here for future readers.", "url": "https://github.com/elastic/elasticsearch/pull/55747#discussion_r414857455", "createdAt": "2020-04-24T20:55:09Z", "author": {"login": "imotov"}, "path": "server/src/main/java/org/elasticsearch/search/aggregations/support/CoreValuesSourceType.java", "diffHunk": "@@ -288,4 +291,6 @@ public String value() {\n         return name().toLowerCase(Locale.ROOT);\n     }\n \n+    /** List containing all members of the enumeration. */\n+    public static List<ValuesSourceType> ALL = Arrays.asList(CoreValuesSourceType.values());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1c41ae9d94d55af2d8c9fce4d3fa70a23cdb8b6f"}, "originalPosition": 22}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4033b98b78adc8e893db3aece581dae6bc1f5ea2", "author": {"user": {"login": "csoulios", "name": "Christos Soulios"}}, "url": "https://github.com/elastic/elasticsearch/commit/4033b98b78adc8e893db3aece581dae6bc1f5ea2", "committedDate": "2020-04-26T12:19:21Z", "message": "Renamed CoreValuesSourceType.ALL to ALL_CORE"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2c709d3558cd05ba1d97a35343925130dcf64a3f", "author": {"user": {"login": "csoulios", "name": "Christos Soulios"}}, "url": "https://github.com/elastic/elasticsearch/commit/2c709d3558cd05ba1d97a35343925130dcf64a3f", "committedDate": "2020-04-26T14:40:12Z", "message": "Removed lambdas in ValuesSourceRegistry"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3feb89965c0bd312715ca4bd515b0bfc4dd7fd15", "author": {"user": {"login": "csoulios", "name": "Christos Soulios"}}, "url": "https://github.com/elastic/elasticsearch/commit/3feb89965c0bd312715ca4bd515b0bfc4dd7fd15", "committedDate": "2020-04-26T16:04:18Z", "message": "Merge branch 'master' into vsregistry-remove-any"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAwOTg2NDQy", "url": "https://github.com/elastic/elasticsearch/pull/55747#pullrequestreview-400986442", "createdAt": "2020-04-27T14:06:37Z", "commit": {"oid": "3feb89965c0bd312715ca4bd515b0bfc4dd7fd15"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yN1QxNDowNjozN1rOGMlA3A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yN1QxNDowNjozN1rOGMlA3A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTg0MjUyNA==", "bodyText": "This doesn't need to be a List now.  We can just make it Map<String, Map<ValuesSourceType, AggregatorSupplier>>. \u00a0The list was only necessary because lambdas make bad hash keys.", "url": "https://github.com/elastic/elasticsearch/pull/55747#discussion_r415842524", "createdAt": "2020-04-27T14:06:37Z", "author": {"login": "not-napoleon"}, "path": "server/src/main/java/org/elasticsearch/search/aggregations/support/ValuesSourceRegistry.java", "diffHunk": "@@ -42,99 +41,67 @@\n  */\n public class ValuesSourceRegistry {\n     public static class Builder {\n-        private Map<String, List<Map.Entry<Predicate<ValuesSourceType>, AggregatorSupplier>>> aggregatorRegistry = new HashMap<>();\n+        private Map<String, List<Map.Entry<ValuesSourceType, AggregatorSupplier>>> aggregatorRegistry = new HashMap<>();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3feb89965c0bd312715ca4bd515b0bfc4dd7fd15"}, "originalPosition": 13}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAxMjQwMTcx", "url": "https://github.com/elastic/elasticsearch/pull/55747#pullrequestreview-401240171", "createdAt": "2020-04-27T19:00:10Z", "commit": {"oid": "3feb89965c0bd312715ca4bd515b0bfc4dd7fd15"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "90ea7ddd1a6eaaeb7faecc83e01a91278def008c", "author": {"user": {"login": "csoulios", "name": "Christos Soulios"}}, "url": "https://github.com/elastic/elasticsearch/commit/90ea7ddd1a6eaaeb7faecc83e01a91278def008c", "committedDate": "2020-04-27T20:45:45Z", "message": "Merge branch 'master' into vsregistry-remove-any"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 346, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}