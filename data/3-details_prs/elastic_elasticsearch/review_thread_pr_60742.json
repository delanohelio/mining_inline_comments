{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDYzMzk1Mjk5", "number": 60742, "reviewThreads": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNVQxNzo0MToxNFrOEVg0cA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xNFQyMDo0NjowNlrOEYnLCQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkwOTkzMjY0OnYy", "diffSide": "RIGHT", "path": "buildSrc/src/main/java/org/elasticsearch/gradle/ElasticsearchDistribution.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNVQxNzo0MToxNFrOG8T_Xg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQxNDozNjowMVrOG82bYg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTg5NTI2Mg==", "bodyText": "Maybe DOCKER_UBI then?", "url": "https://github.com/elastic/elasticsearch/pull/60742#discussion_r465895262", "createdAt": "2020-08-05T17:41:14Z", "author": {"login": "mark-vieira"}, "path": "buildSrc/src/main/java/org/elasticsearch/gradle/ElasticsearchDistribution.java", "diffHunk": "@@ -50,7 +50,9 @@ public String toString() {\n         ARCHIVE,\n         RPM,\n         DEB,\n-        DOCKER;\n+        DOCKER,\n+        // This is a different flavour of Docker image\n+        UBI;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b4e9f7ac1d001aa2417f582490762d8f62d6b893"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjQ1OTQ5MA==", "bodyText": "That's probably clearer, I'll go with DOCKER_UBI.", "url": "https://github.com/elastic/elasticsearch/pull/60742#discussion_r466459490", "createdAt": "2020-08-06T14:36:01Z", "author": {"login": "pugnascotia"}, "path": "buildSrc/src/main/java/org/elasticsearch/gradle/ElasticsearchDistribution.java", "diffHunk": "@@ -50,7 +50,9 @@ public String toString() {\n         ARCHIVE,\n         RPM,\n         DEB,\n-        DOCKER;\n+        DOCKER,\n+        // This is a different flavour of Docker image\n+        UBI;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTg5NTI2Mg=="}, "originalCommit": {"oid": "b4e9f7ac1d001aa2417f582490762d8f62d6b893"}, "originalPosition": 7}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkwOTk0NDkzOnYy", "diffSide": "RIGHT", "path": "buildSrc/src/main/java/org/elasticsearch/gradle/Variant.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNVQxNzo0NDoyOFrOG8UG2Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMlQyMTo1MzoyM1rOG_0KeA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTg5NzE3Nw==", "bodyText": "I assume you decided that introducing yet another axis on ElasticsearchDistribution was folly and therefore this isn't actually used? ;)", "url": "https://github.com/elastic/elasticsearch/pull/60742#discussion_r465897177", "createdAt": "2020-08-05T17:44:28Z", "author": {"login": "mark-vieira"}, "path": "buildSrc/src/main/java/org/elasticsearch/gradle/Variant.java", "diffHunk": "@@ -0,0 +1,29 @@\n+/*\n+ * Licensed to Elasticsearch under one or more contributor\n+ * license agreements. See the NOTICE file distributed with\n+ * this work for additional information regarding copyright\n+ * ownership. Elasticsearch licenses this file to you under\n+ * the Apache License, Version 2.0 (the \"License\"); you may\n+ * not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.elasticsearch.gradle;\n+\n+/**\n+ * Models the different varieties of Docker image that the build can create.\n+ */\n+public enum Variant {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b4e9f7ac1d001aa2417f582490762d8f62d6b893"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjQ2MTY2OQ==", "bodyText": "I use this in distribution/docker/build.gradle. I introduced it before going on to add support for UBI in the distro tests. It's sort of a blend of ElasticsearchDistribution.Type and ElasticsearchDistribution.Flavour, which is why I created a new enum for it.", "url": "https://github.com/elastic/elasticsearch/pull/60742#discussion_r466461669", "createdAt": "2020-08-06T14:39:14Z", "author": {"login": "pugnascotia"}, "path": "buildSrc/src/main/java/org/elasticsearch/gradle/Variant.java", "diffHunk": "@@ -0,0 +1,29 @@\n+/*\n+ * Licensed to Elasticsearch under one or more contributor\n+ * license agreements. See the NOTICE file distributed with\n+ * this work for additional information regarding copyright\n+ * ownership. Elasticsearch licenses this file to you under\n+ * the Apache License, Version 2.0 (the \"License\"); you may\n+ * not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.elasticsearch.gradle;\n+\n+/**\n+ * Models the different varieties of Docker image that the build can create.\n+ */\n+public enum Variant {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTg5NzE3Nw=="}, "originalCommit": {"oid": "b4e9f7ac1d001aa2417f582490762d8f62d6b893"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTU2ODEyMA==", "bodyText": "Perhaps then it should just live there, given there are no other references to it in buildSrc.", "url": "https://github.com/elastic/elasticsearch/pull/60742#discussion_r469568120", "createdAt": "2020-08-12T21:53:23Z", "author": {"login": "mark-vieira"}, "path": "buildSrc/src/main/java/org/elasticsearch/gradle/Variant.java", "diffHunk": "@@ -0,0 +1,29 @@\n+/*\n+ * Licensed to Elasticsearch under one or more contributor\n+ * license agreements. See the NOTICE file distributed with\n+ * this work for additional information regarding copyright\n+ * ownership. Elasticsearch licenses this file to you under\n+ * the Apache License, Version 2.0 (the \"License\"); you may\n+ * not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.elasticsearch.gradle;\n+\n+/**\n+ * Models the different varieties of Docker image that the build can create.\n+ */\n+public enum Variant {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTg5NzE3Nw=="}, "originalCommit": {"oid": "b4e9f7ac1d001aa2417f582490762d8f62d6b893"}, "originalPosition": 25}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkzNzQzNzA2OnYy", "diffSide": "RIGHT", "path": "buildSrc/src/main/java/org/elasticsearch/gradle/ElasticsearchDistribution.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QxNjo0Njo1NlrOHAT2GQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xNFQxMDowNToxM1rOHAvGHg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDA4NzE5Mw==", "bodyText": "We should actually add some validation in here so you can't choose DOCKER_UBI along with the OSS flavor.", "url": "https://github.com/elastic/elasticsearch/pull/60742#discussion_r470087193", "createdAt": "2020-08-13T16:46:56Z", "author": {"login": "mark-vieira"}, "path": "buildSrc/src/main/java/org/elasticsearch/gradle/ElasticsearchDistribution.java", "diffHunk": "@@ -283,7 +289,7 @@ void finalizeValues() {\n                     \"platform cannot be set on elasticsearch distribution [\" + name + \"] of type [\" + getType() + \"]\"\n                 );\n             }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "724117c5fe526d08dd294e34f95fc351f0116426"}, "originalPosition": 54}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDUzMzY2Mg==", "bodyText": "I've added a check here.", "url": "https://github.com/elastic/elasticsearch/pull/60742#discussion_r470533662", "createdAt": "2020-08-14T10:05:13Z", "author": {"login": "pugnascotia"}, "path": "buildSrc/src/main/java/org/elasticsearch/gradle/ElasticsearchDistribution.java", "diffHunk": "@@ -283,7 +289,7 @@ void finalizeValues() {\n                     \"platform cannot be set on elasticsearch distribution [\" + name + \"] of type [\" + getType() + \"]\"\n                 );\n             }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDA4NzE5Mw=="}, "originalCommit": {"oid": "724117c5fe526d08dd294e34f95fc351f0116426"}, "originalPosition": 54}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk0MTY0MjA5OnYy", "diffSide": "RIGHT", "path": "distribution/docker/build.gradle", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xNFQxNjozNToyNVrOHA7NAA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xNFQxOTowNjo0MFrOHBAZBw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDczMjAzMg==", "bodyText": "Let's just add a comment here explaining we only ship a default distribution version of the UBI image.", "url": "https://github.com/elastic/elasticsearch/pull/60742#discussion_r470732032", "createdAt": "2020-08-14T16:35:25Z", "author": {"login": "mark-vieira"}, "path": "distribution/docker/build.gradle", "diffHunk": "@@ -239,9 +252,14 @@ void addBuildDockerImage(Architecture architecture, Variant variant) {\n }\n \n for (final Architecture architecture : Architecture.values()) {\n-  for (Variant variant : Variant.values()) {\n-    addCopyDockerContextTask(architecture, variant)\n-    addBuildDockerImage(architecture, variant)\n+  for (final DockerBase base : DockerBase.values()) {\n+    for (final boolean oss : [false, true]) {\n+      if (oss && base != DockerBase.CENTOS) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6a4ecf8393571163868124102a013c3dd8cc50a2"}, "originalPosition": 185}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDgxNzAzMQ==", "bodyText": "Done.", "url": "https://github.com/elastic/elasticsearch/pull/60742#discussion_r470817031", "createdAt": "2020-08-14T19:06:40Z", "author": {"login": "pugnascotia"}, "path": "distribution/docker/build.gradle", "diffHunk": "@@ -239,9 +252,14 @@ void addBuildDockerImage(Architecture architecture, Variant variant) {\n }\n \n for (final Architecture architecture : Architecture.values()) {\n-  for (Variant variant : Variant.values()) {\n-    addCopyDockerContextTask(architecture, variant)\n-    addBuildDockerImage(architecture, variant)\n+  for (final DockerBase base : DockerBase.values()) {\n+    for (final boolean oss : [false, true]) {\n+      if (oss && base != DockerBase.CENTOS) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDczMjAzMg=="}, "originalCommit": {"oid": "6a4ecf8393571163868124102a013c3dd8cc50a2"}, "originalPosition": 185}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk0MjQzMDgxOnYy", "diffSide": "RIGHT", "path": "qa/os/src/test/java/org/elasticsearch/packaging/util/Distribution.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xNFQyMDo0NjowNlrOHBC2Ew==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xN1QxMTozNzowMlrOHBlKkg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDg1NzIzNQ==", "bodyText": "This doesn't appear to be used, since the same condition is written in isDocker above?", "url": "https://github.com/elastic/elasticsearch/pull/60742#discussion_r470857235", "createdAt": "2020-08-14T20:46:06Z", "author": {"login": "rjernst"}, "path": "qa/os/src/test/java/org/elasticsearch/packaging/util/Distribution.java", "diffHunk": "@@ -92,6 +95,10 @@ public boolean isDocker() {\n             this.extension = extension;\n             this.compatible = compatible;\n         }\n+\n+        public boolean isDocker() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "eea1bacf7a4c38c2f891f166c7db9618cd2afc2e"}, "originalPosition": 33}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTQxOTUzOA==", "bodyText": "Ah, yeah, good catch.", "url": "https://github.com/elastic/elasticsearch/pull/60742#discussion_r471419538", "createdAt": "2020-08-17T11:37:02Z", "author": {"login": "pugnascotia"}, "path": "qa/os/src/test/java/org/elasticsearch/packaging/util/Distribution.java", "diffHunk": "@@ -92,6 +95,10 @@ public boolean isDocker() {\n             this.extension = extension;\n             this.compatible = compatible;\n         }\n+\n+        public boolean isDocker() {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDg1NzIzNQ=="}, "originalCommit": {"oid": "eea1bacf7a4c38c2f891f166c7db9618cd2afc2e"}, "originalPosition": 33}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2566, "cost": 1, "resetAt": "2021-11-12T11:57:46Z"}}}