{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTI3NjE3NjUz", "number": 65510, "title": "Add 6.8 branch to packer cache script", "bodyText": "This allows us to cache dependencies from the elasticsearch 6.8 branch which should help reducing the overall CI failures on that branch caused by dependency resolution errors.", "createdAt": "2020-11-25T18:11:09Z", "url": "https://github.com/elastic/elasticsearch/pull/65510", "merged": true, "mergeCommit": {"oid": "44a60d00a64fe73136ef8ab878e4f067dcaef7f2"}, "closed": true, "closedAt": "2020-12-01T16:23:54Z", "author": {"login": "breskeby"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdgCZ1_gH2gAyNTI3NjE3NjUzOmVjMGZkMDI0MzRlMGY0ZTFmNGQ3NzlkNTcyNjUxNWUxMGUyNmU4NzQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdhtrbdAFqTU0MTM2NzcwNg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "ec0fd02434e0f4e1f4d779d5726515e10e26e874", "author": {"user": {"login": "breskeby", "name": "Rene Groeschke"}}, "url": "https://github.com/elastic/elasticsearch/commit/ec0fd02434e0f4e1f4d779d5726515e10e26e874", "committedDate": "2020-11-25T18:10:51Z", "message": "Add 6.8 branch to packer cache script"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM4ODM5ODE0", "url": "https://github.com/elastic/elasticsearch/pull/65510#pullrequestreview-538839814", "createdAt": "2020-11-25T20:54:30Z", "commit": {"oid": "ec0fd02434e0f4e1f4d779d5726515e10e26e874"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNVQyMDo1NDozMVrOH6DjpQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNVQyMDo1NDozMVrOH6DjpQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDYzNzczMw==", "bodyText": "Maybe use git clone --reference ${SCRIPT}/../.git https://github.com/elastic/elasticsearch.git --branch 6.8 --single-branch checkout/6.8 to speed up the clone a bit?", "url": "https://github.com/elastic/elasticsearch/pull/65510#discussion_r530637733", "createdAt": "2020-11-25T20:54:31Z", "author": {"login": "nik9000"}, "path": ".ci/packer_cache.sh", "diffHunk": "@@ -16,12 +16,21 @@ while [ -h \"$SCRIPT\" ] ; do\n done\n \n source $(dirname \"${SCRIPT}\")/java-versions.properties\n-export JAVA_HOME=\"${HOME}\"/.java/${ES_BUILD_JAVA}\n-# We are caching BWC versions too, need these so we can build those\n+## We are caching BWC versions too, need these so we can build those\n export JAVA8_HOME=\"${HOME}\"/.java/java8\n export JAVA11_HOME=\"${HOME}\"/.java/java11\n export JAVA12_HOME=\"${HOME}\"/.java/openjdk12\n export JAVA13_HOME=\"${HOME}\"/.java/openjdk13\n export JAVA14_HOME=\"${HOME}\"/.java/openjdk14\n-./gradlew --parallel clean -s resolveAllDependencies\n \n+## 6.8 branch is not referenced from any bwc project in master so we need to\n+## resolve its dependencies explicitly\n+rm -rf checkout/6.8\n+git clone https://github.com/elastic/elasticsearch.git --branch 6.8 --single-branch checkout/6.8", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ec0fd02434e0f4e1f4d779d5726515e10e26e874"}, "originalPosition": 17}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "31a826c5b1e50a0ee5fb8f5aa108a53b7e159c41", "author": {"user": {"login": "breskeby", "name": "Rene Groeschke"}}, "url": "https://github.com/elastic/elasticsearch/commit/31a826c5b1e50a0ee5fb8f5aa108a53b7e159c41", "committedDate": "2020-11-30T09:45:40Z", "message": "Apply review feedback\n\n- use --reference on cloning 6.8 brach to speed cloning up a bit"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQxMjMyNzk3", "url": "https://github.com/elastic/elasticsearch/pull/65510#pullrequestreview-541232797", "createdAt": "2020-11-30T19:40:10Z", "commit": {"oid": "31a826c5b1e50a0ee5fb8f5aa108a53b7e159c41"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQxMjMzMzc0", "url": "https://github.com/elastic/elasticsearch/pull/65510#pullrequestreview-541233374", "createdAt": "2020-11-30T19:40:59Z", "commit": {"oid": "31a826c5b1e50a0ee5fb8f5aa108a53b7e159c41"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0zMFQxOTo0MDo1OVrOH8Kuzw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0zMFQxOTo0MDo1OVrOH8Kuzw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjg1MjQzMQ==", "bodyText": "Maybe rm -rf checkout/6.8 just to keep the build image a little smaller.", "url": "https://github.com/elastic/elasticsearch/pull/65510#discussion_r532852431", "createdAt": "2020-11-30T19:40:59Z", "author": {"login": "nik9000"}, "path": ".ci/packer_cache.sh", "diffHunk": "@@ -16,12 +16,21 @@ while [ -h \"$SCRIPT\" ] ; do\n done\n \n source $(dirname \"${SCRIPT}\")/java-versions.properties\n-export JAVA_HOME=\"${HOME}\"/.java/${ES_BUILD_JAVA}\n-# We are caching BWC versions too, need these so we can build those\n+## We are caching BWC versions too, need these so we can build those\n export JAVA8_HOME=\"${HOME}\"/.java/java8\n export JAVA11_HOME=\"${HOME}\"/.java/java11\n export JAVA12_HOME=\"${HOME}\"/.java/openjdk12\n export JAVA13_HOME=\"${HOME}\"/.java/openjdk13\n export JAVA14_HOME=\"${HOME}\"/.java/openjdk14\n-./gradlew --parallel clean -s resolveAllDependencies\n \n+## 6.8 branch is not referenced from any bwc project in master so we need to\n+## resolve its dependencies explicitly\n+rm -rf checkout/6.8\n+git clone --reference $(dirname \"${SCRIPT}\")/../.git https://github.com/elastic/elasticsearch.git --branch 6.8 --single-branch checkout/6.8\n+export JAVA_HOME=\"${JAVA11_HOME}\"\n+./checkout/6.8/gradlew --project-dir ./checkout/6.8 --parallel clean --scan -Porg.elasticsearch.acceptScanTOS=true --stacktrace resolveAllDependencies\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "31a826c5b1e50a0ee5fb8f5aa108a53b7e159c41"}, "originalPosition": 20}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2d052c582f666ce6538646bfe98309b59a32d77b", "author": {"user": {"login": "breskeby", "name": "Rene Groeschke"}}, "url": "https://github.com/elastic/elasticsearch/commit/2d052c582f666ce6538646bfe98309b59a32d77b", "committedDate": "2020-11-30T20:46:37Z", "message": "Remove 6.8 branch checkout after resolving deps to keep image small"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQxMzY3NzA2", "url": "https://github.com/elastic/elasticsearch/pull/65510#pullrequestreview-541367706", "createdAt": "2020-11-30T23:09:55Z", "commit": {"oid": "2d052c582f666ce6538646bfe98309b59a32d77b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4280, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}