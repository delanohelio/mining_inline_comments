{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDAzNTY0OTUw", "number": 55201, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQwNjo1MzoyNlrODx7_vA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQwNzoxODoxMFrODx8cfw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUzNjg5Nzg4OnYy", "diffSide": "RIGHT", "path": "x-pack/plugin/identity-provider/src/main/java/org/elasticsearch/xpack/idp/saml/sp/SamlServiceProviderDocument.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQwNjo1MzoyNlrOGFsGUA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNlQwNToyMzo1MFrOGGVCHA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODYxODU3Ng==", "bodyText": "I don't see how we would get a null String in the Collection here but I assume that the NPE we would throw is fine and we don;t want to guard this with requireNonNull or similar ?", "url": "https://github.com/elastic/elasticsearch/pull/55201#discussion_r408618576", "createdAt": "2020-04-15T06:53:26Z", "author": {"login": "jkakavas"}, "path": "x-pack/plugin/identity-provider/src/main/java/org/elasticsearch/xpack/idp/saml/sp/SamlServiceProviderDocument.java", "diffHunk": "@@ -52,14 +54,15 @@\n \n     public static class Privileges {\n         public String resource;\n-        public Set<String> rolePatterns = Set.of();\n+        // we use a sorted set so that the order is consistent in XContent APIs\n+        public SortedSet<String> rolePatterns = new TreeSet<>();\n \n         public void setResource(String resource) {\n             this.resource = resource;\n         }\n \n         public void setRolePatterns(Collection<String> rolePatterns) {\n-            this.rolePatterns = Set.copyOf(rolePatterns);\n+            this.rolePatterns = new TreeSet<>(rolePatterns);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e8c783ffc356d6d7ab030b03594accfa44cd880f"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTI4OTI0NA==", "bodyText": "copyOf would fail on null Strings, so I don't think there's any change here.", "url": "https://github.com/elastic/elasticsearch/pull/55201#discussion_r409289244", "createdAt": "2020-04-16T05:23:50Z", "author": {"login": "tvernum"}, "path": "x-pack/plugin/identity-provider/src/main/java/org/elasticsearch/xpack/idp/saml/sp/SamlServiceProviderDocument.java", "diffHunk": "@@ -52,14 +54,15 @@\n \n     public static class Privileges {\n         public String resource;\n-        public Set<String> rolePatterns = Set.of();\n+        // we use a sorted set so that the order is consistent in XContent APIs\n+        public SortedSet<String> rolePatterns = new TreeSet<>();\n \n         public void setResource(String resource) {\n             this.resource = resource;\n         }\n \n         public void setRolePatterns(Collection<String> rolePatterns) {\n-            this.rolePatterns = Set.copyOf(rolePatterns);\n+            this.rolePatterns = new TreeSet<>(rolePatterns);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODYxODU3Ng=="}, "originalCommit": {"oid": "e8c783ffc356d6d7ab030b03594accfa44cd880f"}, "originalPosition": 23}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUzNjk3MTUxOnYy", "diffSide": "RIGHT", "path": "x-pack/plugin/identity-provider/src/main/java/org/elasticsearch/xpack/idp/saml/sp/SamlServiceProviderDocument.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQwNzoxODoxMFrOGFszJg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNlQwNToyNTozNVrOGGVD9w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODYzMDA1NA==", "bodyText": "We don't need this to be sorted/consistent for any other reason that testing the XContent to/from right?  We use it in https://github.com/elastic/elasticsearch/blob/7.7/x-pack/plugin/identity-provider/src/main/java/org/elasticsearch/xpack/idp/saml/sp/SamlServiceProviderFactory.java#L67 so we shouldn't care about performance that much since we cache the built service provider. Just thinking out loud here", "url": "https://github.com/elastic/elasticsearch/pull/55201#discussion_r408630054", "createdAt": "2020-04-15T07:18:10Z", "author": {"login": "jkakavas"}, "path": "x-pack/plugin/identity-provider/src/main/java/org/elasticsearch/xpack/idp/saml/sp/SamlServiceProviderDocument.java", "diffHunk": "@@ -52,14 +54,15 @@\n \n     public static class Privileges {\n         public String resource;\n-        public Set<String> rolePatterns = Set.of();\n+        // we use a sorted set so that the order is consistent in XContent APIs\n+        public SortedSet<String> rolePatterns = new TreeSet<>();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e8c783ffc356d6d7ab030b03594accfa44cd880f"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTI4OTcxOQ==", "bodyText": "I had the same thought stream. I don't think there's really any issue here. Yes, we're sorting the set where it might not be needed, but 99% of the time it will have 1 item in it, so the impact is effectively zero in real world usage.", "url": "https://github.com/elastic/elasticsearch/pull/55201#discussion_r409289719", "createdAt": "2020-04-16T05:25:35Z", "author": {"login": "tvernum"}, "path": "x-pack/plugin/identity-provider/src/main/java/org/elasticsearch/xpack/idp/saml/sp/SamlServiceProviderDocument.java", "diffHunk": "@@ -52,14 +54,15 @@\n \n     public static class Privileges {\n         public String resource;\n-        public Set<String> rolePatterns = Set.of();\n+        // we use a sorted set so that the order is consistent in XContent APIs\n+        public SortedSet<String> rolePatterns = new TreeSet<>();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODYzMDA1NA=="}, "originalCommit": {"oid": "e8c783ffc356d6d7ab030b03594accfa44cd880f"}, "originalPosition": 15}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1030, "cost": 1, "resetAt": "2021-11-12T11:57:46Z"}}}