{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk3Njg1MTYx", "number": 54664, "title": "Rest spec and documentation", "bodyText": "This change adds the spec for the new REST APIs that we\nintroduce for the IDP and documentation for each of the APIs. The\ndocumentation pages are intentionally not included in the API\nreference so as to minimize unnecessary exposure.\nsupersedes: #53858", "createdAt": "2020-04-02T16:28:30Z", "url": "https://github.com/elastic/elasticsearch/pull/54664", "merged": true, "mergeCommit": {"oid": "dfb3355952d1000144d30e4145b809d3e06d203b"}, "closed": true, "closedAt": "2020-04-16T12:52:34Z", "author": {"login": "jkakavas"}, "timelineItems": {"totalCount": 13, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcTu3ZVgH2gAyMzk3Njg1MTYxOjE2ZDQzMzRjOGE2NTJkNGQ0ZTM5NmNmM2FjZmEyOWNhMTIwYWJhZTA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcYLzingFqTM5NDU3OTMxNA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "16d4334c8a652d4d4e396cf3acfa29ca120abae0", "author": {"user": {"login": "jkakavas", "name": "Ioannis Kakavas"}}, "url": "https://github.com/elastic/elasticsearch/commit/16d4334c8a652d4d4e396cf3acfa29ca120abae0", "committedDate": "2020-04-02T16:26:47Z", "message": "Rest spec and documentation\n\nThis change adds the spec for the new REST APIs that we\nintroduce for the IDP and documentation for each of the APIs. The\ndocumentation pages are intentionally not included in the API\nreference so as to minimize unnecessary exposure.\n\nsupersedes: #53858"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fa717bde656ebb0405846c4173a22c00a39d5ce4", "author": {"user": {"login": "jkakavas", "name": "Ioannis Kakavas"}}, "url": "https://github.com/elastic/elasticsearch/commit/fa717bde656ebb0405846c4173a22c00a39d5ce4", "committedDate": "2020-04-07T06:53:43Z", "message": "Merge remote-tracking branch 'origin/master' into rest-spec-idp-master"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8ae0bfb6b6c2f50a4f16f317ee703d7ea4f75d9d", "author": {"user": {"login": "jkakavas", "name": "Ioannis Kakavas"}}, "url": "https://github.com/elastic/elasticsearch/commit/8ae0bfb6b6c2f50a4f16f317ee703d7ea4f75d9d", "committedDate": "2020-04-07T07:59:39Z", "message": "Adjust metadata API docs"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg5NjYzNTUz", "url": "https://github.com/elastic/elasticsearch/pull/54664#pullrequestreview-389663553", "createdAt": "2020-04-08T05:36:17Z", "commit": {"oid": "8ae0bfb6b6c2f50a4f16f317ee703d7ea4f75d9d"}, "state": "COMMENTED", "comments": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQwNTozNjoxN1rOGCfm2g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQwNTo1NjoxMVrOGCf_pg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTI2ODE4Ng==", "bodyText": "FYI, @lcawl is working on some generic docs for secondary authentication, which we can link to when they're ready.", "url": "https://github.com/elastic/elasticsearch/pull/54664#discussion_r405268186", "createdAt": "2020-04-08T05:36:17Z", "author": {"login": "tvernum"}, "path": "x-pack/plugin/identity-provider/docs/en/rest-api/idp-saml-init.asciidoc", "diffHunk": "@@ -0,0 +1,122 @@\n+[role=\"xpack\"]\n+[[idp-saml-init]]\n+=== Generate a SAML authentication response message\n+++++\n+<titleabbrev>Generate SAML response</titleabbrev>\n+++++\n+Generates a SAML Response message to be sent to a Service Provider\n+\n+[[idp-saml-init-request]]\n+==== {api-request-title}\n+\n+`POST /_idp/saml/init`\n+\n+[[idp-saml-init-prereqs]]\n+==== {api-prereq-title}\n+\n+* To use this API, you must have a role that grants the `cluster:admin/idp/saml/init` privilege.\n+\n+[[idp-saml-init-desc]]\n+==== {api-description-title}\n+\n+This API generates a SAML Response message that should be sent to a Service Provider as part of an\n+IDP initiated or SP initiated SAML Single Sign On. This API expects the caller to present\n+credentials for the user that the SAML Response will be created for as \"Secondary Authentication\"\n+using the `es-secondary-authorization` HTTP Request header.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8ae0bfb6b6c2f50a4f16f317ee703d7ea4f75d9d"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTI2ODQ2Nw==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            The SAML response is returned as an XML String and the caller of the API is responsible to instruct\n          \n          \n            \n            The SAML response is returned as a String that contains an XML document. The caller of the API is responsible to instruct", "url": "https://github.com/elastic/elasticsearch/pull/54664#discussion_r405268467", "createdAt": "2020-04-08T05:37:17Z", "author": {"login": "tvernum"}, "path": "x-pack/plugin/identity-provider/docs/en/rest-api/idp-saml-init.asciidoc", "diffHunk": "@@ -0,0 +1,122 @@\n+[role=\"xpack\"]\n+[[idp-saml-init]]\n+=== Generate a SAML authentication response message\n+++++\n+<titleabbrev>Generate SAML response</titleabbrev>\n+++++\n+Generates a SAML Response message to be sent to a Service Provider\n+\n+[[idp-saml-init-request]]\n+==== {api-request-title}\n+\n+`POST /_idp/saml/init`\n+\n+[[idp-saml-init-prereqs]]\n+==== {api-prereq-title}\n+\n+* To use this API, you must have a role that grants the `cluster:admin/idp/saml/init` privilege.\n+\n+[[idp-saml-init-desc]]\n+==== {api-description-title}\n+\n+This API generates a SAML Response message that should be sent to a Service Provider as part of an\n+IDP initiated or SP initiated SAML Single Sign On. This API expects the caller to present\n+credentials for the user that the SAML Response will be created for as \"Secondary Authentication\"\n+using the `es-secondary-authorization` HTTP Request header.\n+\n+The SAML response is returned as an XML String and the caller of the API is responsible to instruct", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8ae0bfb6b6c2f50a4f16f317ee703d7ea4f75d9d"}, "originalPosition": 27}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTI2ODkyNw==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            curl -u idp_admin:idp_admin_pwd <1> -H 'Content-Type: application/json' \\\n          \n          \n            \n            curl -u idp_admin:idp_admin_pwd <1> \\\n          \n          \n            \n              -H 'Content-Type: application/json' \\\n          \n      \n    \n    \n  \n\nI think this will be neater if the footnotes are always at the end of line (but that's a personal view)", "url": "https://github.com/elastic/elasticsearch/pull/54664#discussion_r405268927", "createdAt": "2020-04-08T05:38:32Z", "author": {"login": "tvernum"}, "path": "x-pack/plugin/identity-provider/docs/en/rest-api/idp-saml-init.asciidoc", "diffHunk": "@@ -0,0 +1,122 @@\n+[role=\"xpack\"]\n+[[idp-saml-init]]\n+=== Generate a SAML authentication response message\n+++++\n+<titleabbrev>Generate SAML response</titleabbrev>\n+++++\n+Generates a SAML Response message to be sent to a Service Provider\n+\n+[[idp-saml-init-request]]\n+==== {api-request-title}\n+\n+`POST /_idp/saml/init`\n+\n+[[idp-saml-init-prereqs]]\n+==== {api-prereq-title}\n+\n+* To use this API, you must have a role that grants the `cluster:admin/idp/saml/init` privilege.\n+\n+[[idp-saml-init-desc]]\n+==== {api-description-title}\n+\n+This API generates a SAML Response message that should be sent to a Service Provider as part of an\n+IDP initiated or SP initiated SAML Single Sign On. This API expects the caller to present\n+credentials for the user that the SAML Response will be created for as \"Secondary Authentication\"\n+using the `es-secondary-authorization` HTTP Request header.\n+\n+The SAML response is returned as an XML String and the caller of the API is responsible to instruct\n+the end user's browser to make an HTTP Post request to the Service Provider with the SAML response\n+Base64 encoded.\n+\n+[[idp-saml-init-body]]\n+==== {api-request-body-title}\n+\n+The following parameters can be specified in the body of a POST request:\n+\n+`entity_id`::\n+(Required, string) The SAML entity Id of the service provider that will be the recipient of the SAML Response.\n+\n+`acs`::\n+(Required, string) The assertion consumer service URL of the service provider that will be the recipient of the SAML Response.\n+\n+`authn_state`::\n+(Optional, object) The JSON structure that <<idp-saml-validate>> returns. This should only be\n+provided when calling this API as part of an SP initiated Single Sign On.\n+\n+\n+[[idp-saml-init-example]]\n+==== {api-examples-title}\n+\n+The following example generates a SAML Response for an IDP initiated SAML Single Sign On to the Service Provider with entity Id\n+`https://sp1.kibana.org` and an assertion consumer service URL that is `https://sp1.kibana.org/saml/acs`\n+\n+[source, sh]\n+--------------------------------------------------------------------\n+curl -u idp_admin:idp_admin_pwd <1> -H 'Content-Type: application/json' \\", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8ae0bfb6b6c2f50a4f16f317ee703d7ea4f75d9d"}, "originalPosition": 55}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTI2OTE1Ng==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            header, an elasticsearch access token, or an API key.\n          \n          \n            \n            header, an {es} access token, or an API key.", "url": "https://github.com/elastic/elasticsearch/pull/54664#discussion_r405269156", "createdAt": "2020-04-08T05:39:10Z", "author": {"login": "tvernum"}, "path": "x-pack/plugin/identity-provider/docs/en/rest-api/idp-saml-init.asciidoc", "diffHunk": "@@ -0,0 +1,122 @@\n+[role=\"xpack\"]\n+[[idp-saml-init]]\n+=== Generate a SAML authentication response message\n+++++\n+<titleabbrev>Generate SAML response</titleabbrev>\n+++++\n+Generates a SAML Response message to be sent to a Service Provider\n+\n+[[idp-saml-init-request]]\n+==== {api-request-title}\n+\n+`POST /_idp/saml/init`\n+\n+[[idp-saml-init-prereqs]]\n+==== {api-prereq-title}\n+\n+* To use this API, you must have a role that grants the `cluster:admin/idp/saml/init` privilege.\n+\n+[[idp-saml-init-desc]]\n+==== {api-description-title}\n+\n+This API generates a SAML Response message that should be sent to a Service Provider as part of an\n+IDP initiated or SP initiated SAML Single Sign On. This API expects the caller to present\n+credentials for the user that the SAML Response will be created for as \"Secondary Authentication\"\n+using the `es-secondary-authorization` HTTP Request header.\n+\n+The SAML response is returned as an XML String and the caller of the API is responsible to instruct\n+the end user's browser to make an HTTP Post request to the Service Provider with the SAML response\n+Base64 encoded.\n+\n+[[idp-saml-init-body]]\n+==== {api-request-body-title}\n+\n+The following parameters can be specified in the body of a POST request:\n+\n+`entity_id`::\n+(Required, string) The SAML entity Id of the service provider that will be the recipient of the SAML Response.\n+\n+`acs`::\n+(Required, string) The assertion consumer service URL of the service provider that will be the recipient of the SAML Response.\n+\n+`authn_state`::\n+(Optional, object) The JSON structure that <<idp-saml-validate>> returns. This should only be\n+provided when calling this API as part of an SP initiated Single Sign On.\n+\n+\n+[[idp-saml-init-example]]\n+==== {api-examples-title}\n+\n+The following example generates a SAML Response for an IDP initiated SAML Single Sign On to the Service Provider with entity Id\n+`https://sp1.kibana.org` and an assertion consumer service URL that is `https://sp1.kibana.org/saml/acs`\n+\n+[source, sh]\n+--------------------------------------------------------------------\n+curl -u idp_admin:idp_admin_pwd <1> -H 'Content-Type: application/json' \\\n+-H 'es-secondary-authorization: ApiKey dVhmUDBuQUJERWhZWEZaQVg5S0k6WUJubmZwNEtRZ1d4cGRxdXBzZmFDUQ==' <2> \\\n+localhost:9200/_idp/saml/init -d '{\"entity_id\":\"https://sp1.kibana.org\",\"acs\":\"https://sp1.kibana.org/saml/acs\"}'\n+--------------------------------------------------------------------\n+// NOTCONSOLE\n+<1> The credentials of the user that has the necessary privileges to call this API\n+<2> The credentials of the end user for which the SAML Response will be generated. These can be in the form of a Basic authentication\n+header, an elasticsearch access token, or an API key.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8ae0bfb6b6c2f50a4f16f317ee703d7ea4f75d9d"}, "originalPosition": 62}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTI3MTc5NA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            (string) The SAML Assertion Consumer Service URL of the service provider that will consume this SAML\n          \n          \n            \n            (Optional, string) The SAML Assertion Consumer Service URL of the service provider that will consume this SAML.\n          \n          \n            \n            If this is not set, then this API will ignore any wildcard services and will fail if `sp_entity_id` is not a directly registered Service Provider.", "url": "https://github.com/elastic/elasticsearch/pull/54664#discussion_r405271794", "createdAt": "2020-04-08T05:48:01Z", "author": {"login": "tvernum"}, "path": "x-pack/plugin/identity-provider/docs/en/rest-api/idp-saml-metadata.asciidoc", "diffHunk": "@@ -0,0 +1,55 @@\n+[role=\"xpack\"]\n+[[idp-saml-metadata]]\n+=== Generate SAML metadata for the IDP\n+++++\n+<titleabbrev>Generate SAML metadata for the IDP</titleabbrev>\n+++++\n+Generates a SAML metadata document for the Identity Provider, describing its configuration and capabilities.\n+\n+[[idp-saml-metadata-request]]\n+==== {api-request-title}\n+\n+`GET /_idp/saml/metadata/{sp_entity_id}`\n+\n+[[idp-saml-metadata-prereqs]]\n+==== {api-prereq-title}\n+\n+* To use this API, you must have a role that grants the `cluster:admin/idp/saml/metadata` privilege.\n+\n+[[idp-saml-metadata-desc]]\n+==== {api-description-title}\n+\n+This API generates a SAML metadata XML Document that can be consumed by a service provider in order\n+to be configured to work with this identity provider\n+\n+[[idp-saml-metadata-path-params]]\n+==== {api-path-parms-title}\n+\n+`sp_entity_id::\n+(string) The SAML entity Id of the service provider that will consume this SAML metadata document.\n+\n+`acs`::\n+(string) The SAML Assertion Consumer Service URL of the service provider that will consume this SAML", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8ae0bfb6b6c2f50a4f16f317ee703d7ea4f75d9d"}, "originalPosition": 32}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTI3MjI0MA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            `POST /_idp/saml/sp/{sp_entity_id} +\n          \n          \n            \n             PUT  /_idp/saml/sp/{sp_entity_id}`\n          \n          \n            \n            `POST /_idp/saml/sp/{sp_entity_id}` +\n          \n          \n            \n            `PUT  /_idp/saml/sp/{sp_entity_id}`", "url": "https://github.com/elastic/elasticsearch/pull/54664#discussion_r405272240", "createdAt": "2020-04-08T05:49:10Z", "author": {"login": "tvernum"}, "path": "x-pack/plugin/identity-provider/docs/en/rest-api/idp-saml-register-sp.asciidoc", "diffHunk": "@@ -0,0 +1,101 @@\n+[role=\"xpack\"]\n+[[idp-saml-register-sp]]\n+=== Register or update a SAML service provider\n+++++\n+<titleabbrev>Register or update a SAML service provider</titleabbrev>\n+++++\n+Registers a SAML service provider for use with this Identity Provider or updates the configuration of an existing one.\n+\n+[[idp-saml-register-sp-request]]\n+==== {api-request-title}\n+\n+`POST /_idp/saml/sp/{sp_entity_id} +\n+ PUT  /_idp/saml/sp/{sp_entity_id}`", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8ae0bfb6b6c2f50a4f16f317ee703d7ea4f75d9d"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTI3MzE4OQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            `sp_entity_id::\n          \n          \n            \n            `sp_entity_id`::", "url": "https://github.com/elastic/elasticsearch/pull/54664#discussion_r405273189", "createdAt": "2020-04-08T05:52:13Z", "author": {"login": "tvernum"}, "path": "x-pack/plugin/identity-provider/docs/en/rest-api/idp-saml-register-sp.asciidoc", "diffHunk": "@@ -0,0 +1,101 @@\n+[role=\"xpack\"]\n+[[idp-saml-register-sp]]\n+=== Register or update a SAML service provider\n+++++\n+<titleabbrev>Register or update a SAML service provider</titleabbrev>\n+++++\n+Registers a SAML service provider for use with this Identity Provider or updates the configuration of an existing one.\n+\n+[[idp-saml-register-sp-request]]\n+==== {api-request-title}\n+\n+`POST /_idp/saml/sp/{sp_entity_id} +\n+ PUT  /_idp/saml/sp/{sp_entity_id}`\n+\n+[[idp-saml-register-sp-prereqs]]\n+==== {api-prereq-title}\n+\n+* To use this API, you must have a role that grants the `cluster:admin/idp/saml/sp` privilege.\n+\n+[[idp-saml-register-desc]]\n+==== {api-description-title}\n+\n+This API registers a Service Provider with the Identity Provider and sets the necessary configuration options for that SP.\n+\n+\n+[[idp-saml-register-sp-path-params]]\n+==== {api-path-parms-title}\n+\n+`sp_entity_id::", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8ae0bfb6b6c2f50a4f16f317ee703d7ea4f75d9d"}, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTI3MzI2Ng==", "bodyText": "This isn't required.\nIf it is not set, it will be populated from the URL parameter.\nIf it is set, it must match the URL parameter.\n\n  \n    \n      elasticsearch/x-pack/plugin/identity-provider/src/main/java/org/elasticsearch/xpack/idp/action/PutSamlServiceProviderRequest.java\n    \n    \n        Lines 36 to 43\n      in\n      8552c5e\n    \n    \n    \n    \n\n        \n          \n           if (document.entityId == null) { \n        \n\n        \n          \n               document.setEntityId(entityId); \n        \n\n        \n          \n           } else if (entityId != null) { \n        \n\n        \n          \n               if (entityId.equals(document.entityId) == false) { \n        \n\n        \n          \n                   throw new ElasticsearchParseException( \n        \n\n        \n          \n                       \"Entity id [{}] inside request body and entity id [{}] from parameter do not match\", document.entityId, entityId); \n        \n\n        \n          \n               } \n        \n\n        \n          \n           }", "url": "https://github.com/elastic/elasticsearch/pull/54664#discussion_r405273266", "createdAt": "2020-04-08T05:52:31Z", "author": {"login": "tvernum"}, "path": "x-pack/plugin/identity-provider/docs/en/rest-api/idp-saml-register-sp.asciidoc", "diffHunk": "@@ -0,0 +1,101 @@\n+[role=\"xpack\"]\n+[[idp-saml-register-sp]]\n+=== Register or update a SAML service provider\n+++++\n+<titleabbrev>Register or update a SAML service provider</titleabbrev>\n+++++\n+Registers a SAML service provider for use with this Identity Provider or updates the configuration of an existing one.\n+\n+[[idp-saml-register-sp-request]]\n+==== {api-request-title}\n+\n+`POST /_idp/saml/sp/{sp_entity_id} +\n+ PUT  /_idp/saml/sp/{sp_entity_id}`\n+\n+[[idp-saml-register-sp-prereqs]]\n+==== {api-prereq-title}\n+\n+* To use this API, you must have a role that grants the `cluster:admin/idp/saml/sp` privilege.\n+\n+[[idp-saml-register-desc]]\n+==== {api-description-title}\n+\n+This API registers a Service Provider with the Identity Provider and sets the necessary configuration options for that SP.\n+\n+\n+[[idp-saml-register-sp-path-params]]\n+==== {api-path-parms-title}\n+\n+`sp_entity_id::\n+(string) The SAML entity Id of the service provider to be registered or updated. In case the entity Id is a URL, it should be urlencoded.\n+\n+[[idp-saml-register-sp-params]]\n+==== {api-query-parms-title}\n+\n+`refresh`::\n+(Optional, string) One of `true`, `false`, or `wait_for`.\n+These values have the same meaning as in the <<docs-refresh, Index API>>,\n+but the default value for this API is `false`.\n+\n+[[idp-saml-register-sp-body]]\n+==== {api-request-body-title}\n+\n+The following parameters can be specified in the body of a POST or PUT request:\n+\n+`name`::\n+(Required, string) A name to identify this service provider. Used only for informational purposes\n+\n+`entity_id`::\n+(Required, string) The SAML entity Id of the service provider.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8ae0bfb6b6c2f50a4f16f317ee703d7ea4f75d9d"}, "originalPosition": 49}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTI3NDUzNA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                }\n          \n          \n            \n                },\n          \n          \n            \n                \"params\": {\n          \n          \n            \n                  \"acs\": { ... }\n          \n          \n            \n                }", "url": "https://github.com/elastic/elasticsearch/pull/54664#discussion_r405274534", "createdAt": "2020-04-08T05:56:11Z", "author": {"login": "tvernum"}, "path": "x-pack/plugin/identity-provider/src/test/resources/rest-api-spec/api/idp.saml_get_metadata.json", "diffHunk": "@@ -0,0 +1,24 @@\n+{\n+  \"idp.saml_get_metadata\": {\n+    \"documentation\": {\n+      \"url\": \"https://www.elastic.co/guide/en/elasticsearch/reference/current/idp-saml-metadata.html\"\n+    },\n+    \"stability\": \"stable\",\n+    \"url\": {\n+      \"paths\": [\n+        {\n+          \"path\": \"/_idp/saml/metadata/{sp_entity_id}\",\n+          \"methods\": [\n+            \"GET\"\n+          ],\n+          \"parts\": {\n+            \"sp_entity_id\": {\n+              \"type\": \"string\",\n+              \"description\": \"The SAML entity ID of the Service Provider that will consume the metadata\"\n+            }\n+          }\n+        }\n+      ]\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8ae0bfb6b6c2f50a4f16f317ee703d7ea4f75d9d"}, "originalPosition": 22}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ff35089bef5e87dcc48a8f3b3c6228cd7439e13c", "author": {"user": {"login": "jkakavas", "name": "Ioannis Kakavas"}}, "url": "https://github.com/elastic/elasticsearch/commit/ff35089bef5e87dcc48a8f3b3c6228cd7439e13c", "committedDate": "2020-04-08T13:00:32Z", "message": "Apply suggestions from code review\n\nCo-Authored-By: Tim Vernum <tim@adjective.org>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1103e58a3e850168fc43739e6d82310950961651", "author": {"user": {"login": "jkakavas", "name": "Ioannis Kakavas"}}, "url": "https://github.com/elastic/elasticsearch/commit/1103e58a3e850168fc43739e6d82310950961651", "committedDate": "2020-04-08T13:04:08Z", "message": "address feedback"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "850658243bc5c3a5488029a34dbaaba2550955f6", "author": {"user": {"login": "jkakavas", "name": "Ioannis Kakavas"}}, "url": "https://github.com/elastic/elasticsearch/commit/850658243bc5c3a5488029a34dbaaba2550955f6", "committedDate": "2020-04-08T13:04:56Z", "message": "Merge remote-tracking branch 'origin/master' into rest-spec-idp-master"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkwNjAxMjk4", "url": "https://github.com/elastic/elasticsearch/pull/54664#pullrequestreview-390601298", "createdAt": "2020-04-09T08:43:23Z", "commit": {"oid": "850658243bc5c3a5488029a34dbaaba2550955f6"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOVQwODo0MzoyNFrOGDPTRA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOVQwODo0MzoyNFrOGDPTRA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjA0OTYwNA==", "bodyText": "From my experimentations, I got 403s when I tried to hit this endpoint with a user that doesn't have access to the resource, and 401s when the es-secondary-authorization is wrong.\nEDIT: and I also wasn't able to to get the 403 to show up when using basic auth..", "url": "https://github.com/elastic/elasticsearch/pull/54664#discussion_r406049604", "createdAt": "2020-04-09T08:43:24Z", "author": {"login": "lloydmeta"}, "path": "x-pack/plugin/identity-provider/docs/en/rest-api/idp-saml-init.asciidoc", "diffHunk": "@@ -0,0 +1,123 @@\n+[role=\"xpack\"]\n+[[idp-saml-init]]\n+=== Generate a SAML authentication response message\n+++++\n+<titleabbrev>Generate SAML response</titleabbrev>\n+++++\n+Generates a SAML Response message to be sent to a Service Provider\n+\n+[[idp-saml-init-request]]\n+==== {api-request-title}\n+\n+`POST /_idp/saml/init`\n+\n+[[idp-saml-init-prereqs]]\n+==== {api-prereq-title}\n+\n+* To use this API, you must have a role that grants the `cluster:admin/idp/saml/init` privilege.\n+\n+[[idp-saml-init-desc]]\n+==== {api-description-title}\n+\n+This API generates a SAML Response message that should be sent to a Service Provider as part of an\n+IDP initiated or SP initiated SAML Single Sign On. This API expects the caller to present\n+credentials for the user that the SAML Response will be created for as \"Secondary Authentication\"\n+using the `es-secondary-authorization` HTTP Request header.\n+\n+The SAML response is returned as a String that contains an XML document. The caller of the API is responsible to instruct\n+the end user's browser to make an HTTP Post request to the Service Provider with the SAML response\n+Base64 encoded.\n+\n+[[idp-saml-init-body]]\n+==== {api-request-body-title}\n+\n+The following parameters can be specified in the body of a POST request:\n+\n+`entity_id`::\n+(Required, string) The SAML entity Id of the service provider that will be the recipient of the SAML Response.\n+\n+`acs`::\n+(Required, string) The assertion consumer service URL of the service provider that will be the recipient of the SAML Response.\n+\n+`authn_state`::\n+(Optional, object) The JSON structure that <<idp-saml-validate>> returns. This should only be\n+provided when calling this API as part of an SP initiated Single Sign On.\n+\n+\n+[[idp-saml-init-example]]\n+==== {api-examples-title}\n+\n+The following example generates a SAML Response for an IDP initiated SAML Single Sign On to the Service Provider with entity Id\n+`https://sp1.kibana.org` and an assertion consumer service URL that is `https://sp1.kibana.org/saml/acs`\n+\n+[source, sh]\n+--------------------------------------------------------------------\n+curl -u idp_admin:idp_admin_pwd <1> \\\n+  -H 'Content-Type: application/json' \\\n+-H 'es-secondary-authorization: ApiKey dVhmUDBuQUJERWhZWEZaQVg5S0k6WUJubmZwNEtRZ1d4cGRxdXBzZmFDUQ==' <2> \\\n+localhost:9200/_idp/saml/init -d '{\"entity_id\":\"https://sp1.kibana.org\",\"acs\":\"https://sp1.kibana.org/saml/acs\"}'\n+--------------------------------------------------------------------\n+// NOTCONSOLE\n+<1> The credentials of the user that has the necessary privileges to call this API\n+<2> The credentials of the end user for which the SAML Response will be generated. These can be in the form of a Basic authentication\n+header, an {es} access token, or an API key.\n+\n+\n+The following example generates a SAML Response for an SP initiated SAML Single Sign On to the Service Provider with entity Id\n+`https://sp1.kibana.org` that would have originally sent an authentication request and which has been validated with the\n+use of <<idp-saml-validate>>\n+\n+[source, sh]\n+--------------------------------------------------------------------\n+curl -u idp_admin:idp_admin_pwd <1> -H 'Content-Type: application/json' \\\n+-H 'es-secondary-authorization: ApiKey dVhmUDBuQUJERWhZWEZaQVg5S0k6WUJubmZwNEtRZ1d4cGRxdXBzZmFDUQ==' <2>\\\n+localhost:9200/_idp/saml/init -d '{\"entity_id\":\"https://sp1.kibana.org\",\"acs\":\"https://sp1.kibana.org/saml/acs\",\n+\"authn_state\":{\"authn_request_id\":\"_3243243243fdwfsd34r2f32f23\",\"nameid_format\":\"urn:oasis:names:tc:SAML:2.0:nameid-format:transient\"}<3>}'\n+--------------------------------------------------------------------\n+// NOTCONSOLE\n+<1> The credentials of the user that has the necessary privileges to call this API\n+<2> The credentials of the end user for which the SAML Response will be generated. These can be in the form of a Basic authentication\n+header, an elasticsearch access token, or an API key.\n+<3> The `authn_state` JSON structure as it was returned by <<idp-saml-validate>>\n+\n+\n+A successful call returns the SAML Response as an XML String, the URL to post this SAML Response to, and information about the Service\n+Provider that should receive this SAML Response.\n+\n+[source, console-result]\n+--------------------------------------------------------------------\n+{\n+  \"post_url\" : \"https://sp1.kibana.org/saml/acs\",\n+  \"saml_response\" : \"<?xml version=\"1.0\" encoding=\"UTF-8\"?><saml2p:Response xmlns:saml2p=\"urn:oasis:names:tc:SAML:2.0:protocol\" xmlns:xsd=\"http://www.w3.org/2001/XMLSchema\" Destination=\"https://sp.some.org/api/security/v1/saml\" ID=\"_845fbfc9f3254162ce1e161c91b07d85311d65cd\" IssueInstant=\"2020-03-19T15:45:00.158Z\" ...removed for brevity ... </saml2p:Response>\",\n+  \"saml_status\" : \"urn:oasis:names:tc:SAML:2.0:status:Success\",\n+  \"error\" : null,\n+  \"service_provider\" : {\n+    \"entity_id\" : \"https://sp1.kibana.org\"\n+  }\n+}\n+--------------------------------------------------------------------\n+// TESTRESPONSE[skip:Do not enable identity provider for the docs cluster, at least not yet]\n+\n+A failed call, in the case of an SP initiated SSO returns a SAML Response as an XML String with its status set to the appropriate error\n+code indicating that the authentication request failed and the reason for that failure. A `saml_status` of\n+`urn:oasis:names:tc:SAML:2.0:status:Requester` indicates that the error is on the side of the SP or the user, while a `saml_status` of\n+`urn:oasis:names:tc:SAML:2.0:status:Responder` indicates that something went wrong in the IDP side. The `error` field contains a short\n+human friendly interpretation of the error that is outside the SAML standard and is meant to be communicated to the user, especially\n+if the user is not  redirected back the SP with the `saml_response`\n+\n+[source, console-result]\n+--------------------------------------------------------------------\n+{\n+  \"post_url\" : \"https://sp1.kibana.org/saml/acs\",\n+  \"saml_response\" : \"?xml version=\"1.0\" encoding=\"UTF-8\"?><saml2p:Response xmlns:saml2p=\"urn:oasis:names:tc:SAML:2.0:protocol\" xmlns:xsd=\"http://www.w3.org/2001/XMLSchema\" Destination=\"https://sp1.kibana.org/api/saml/acs\" ID=\"_845fbfc9f3254162ce1e161c91b07d85311d65cd\" IssueInstant=\"2020-03-19T15:45:00.158Z\" Version=\"2.0\"><saml2:Issuer xmlns:saml2=\"urn:oasis:names:tc:SAML:2.0:assertion\">https://idp.cloud.elastic.co</saml2:Issuer><ds:Signature xmlns:ds=\"http://www.w3.org/2000/09/xmldsig#\">...removed for brevity...</ds:Signature><saml2p:Status><saml2p:StatusCode Value=\"urn:oasis:names:tc:SAML:2.0:status:Requester\"><samlp:StatusCode xmlns:saml2p=\"urn:oasis:names:tc:SAML:2.0:protocol\" Value=\"urn:oasis:names:tc:SAML:2.0:status:InvalidNameIDPolicy\"/></saml2p:StatusCode></saml2p:Status></saml2p:Response>\",\n+  \"saml_status\" : \"urn:oasis:names:tc:SAML:2.0:status:Requester\",\n+  \"error\" : \"User [user1] is not permitted to access service [https://sp1.kibana.org]\",\n+  \"service_provider\" : {\n+    \"entity_id\" : \"https://sp1.kibana.org\"\n+  }\n+}\n+--------------------------------------------------------------------\n+// TESTRESPONSE[skip:Do not enable identity provider for the docs cluster, at least not yet]\n+\n+A failed call, in the case of an IDP initiated SSO returns an error with the appropriate HTTP Status code. i.e. if the value of the\n+`es-secondary-authorization` is wrong, the IDP will respond with `403`", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "850658243bc5c3a5488029a34dbaaba2550955f6"}, "originalPosition": 123}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk0MzEwMTk3", "url": "https://github.com/elastic/elasticsearch/pull/54664#pullrequestreview-394310197", "createdAt": "2020-04-16T05:34:53Z", "commit": {"oid": "850658243bc5c3a5488029a34dbaaba2550955f6"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNlQwNTozNDo1NFrOGGVOuw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNlQwNTozNjowNlrOGGVQSg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTI5MjQ3NQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            If set, it musth match the value that is passed in the URL parameter.\n          \n          \n            \n            If set, it must match the value that is passed in the URL parameter.", "url": "https://github.com/elastic/elasticsearch/pull/54664#discussion_r409292475", "createdAt": "2020-04-16T05:34:54Z", "author": {"login": "tvernum"}, "path": "x-pack/plugin/identity-provider/docs/en/rest-api/idp-saml-register-sp.asciidoc", "diffHunk": "@@ -46,7 +46,8 @@ The following parameters can be specified in the body of a POST or PUT request:\n (Required, string) A name to identify this service provider. Used only for informational purposes\n \n `entity_id`::\n-(Required, string) The SAML entity Id of the service provider.\n+(Optional, string) The SAML entity Id of the service provider. If not set, it will be populated with the value from the URL parameter.\n+If set, it musth match the value that is passed in the URL parameter.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "850658243bc5c3a5488029a34dbaaba2550955f6"}, "originalPosition": 26}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTI5Mjg3NA==", "bodyText": "My use of ... was just a placeholder - I think this should be populated with something meaningful.", "url": "https://github.com/elastic/elasticsearch/pull/54664#discussion_r409292874", "createdAt": "2020-04-16T05:36:06Z", "author": {"login": "tvernum"}, "path": "x-pack/plugin/identity-provider/src/test/resources/rest-api-spec/api/idp.saml_get_metadata.json", "diffHunk": "@@ -19,6 +19,9 @@\n           }\n         }\n       ]\n+    },\n+    \"params\": {\n+      \"acs\": { ... }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "850658243bc5c3a5488029a34dbaaba2550955f6"}, "originalPosition": 6}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk0MzExOTk4", "url": "https://github.com/elastic/elasticsearch/pull/54664#pullrequestreview-394311998", "createdAt": "2020-04-16T05:39:45Z", "commit": {"oid": "850658243bc5c3a5488029a34dbaaba2550955f6"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3216f316c362fd54b22b979a333c3644deac7c85", "author": {"user": {"login": "jkakavas", "name": "Ioannis Kakavas"}}, "url": "https://github.com/elastic/elasticsearch/commit/3216f316c362fd54b22b979a333c3644deac7c85", "committedDate": "2020-04-16T08:53:38Z", "message": "Address feedback"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "465ef8f67fc4316059da301649db52896cde07ad", "author": {"user": {"login": "elasticmachine", "name": "Elastic Machine"}}, "url": "https://github.com/elastic/elasticsearch/commit/465ef8f67fc4316059da301649db52896cde07ad", "committedDate": "2020-04-16T09:10:45Z", "message": "Merge branch 'master' into rest-spec-idp-master"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk0NTc5MzE0", "url": "https://github.com/elastic/elasticsearch/pull/54664#pullrequestreview-394579314", "createdAt": "2020-04-16T12:25:31Z", "commit": {"oid": "465ef8f67fc4316059da301649db52896cde07ad"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1306, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}