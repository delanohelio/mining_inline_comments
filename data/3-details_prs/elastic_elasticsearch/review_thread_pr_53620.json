{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg5Mzk2MjEw", "number": 53620, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QxNzo0MToxMVrODo0pnQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QxNzo0NjoyOVrODo0xaA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ0MTMyMjUzOnYy", "diffSide": "RIGHT", "path": "buildSrc/src/main/java/org/elasticsearch/gradle/test/rest/RestResourcesPlugin.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QxNzo0MToxMVrOF3nIGw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QyMDoyMDo1OVrOF3sjAQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mzg1NzA1MQ==", "bodyText": "We should probalby not be creating these configurations inside this configuration block. The reason being, because we are using the lazy task creation api, that means that sometimes we create these, and sometimes we don't, depending on the requested task graph. When it comes to configuration API elements, we should always create these or we could get funny errors depending on what tasks you ask to run.", "url": "https://github.com/elastic/elasticsearch/pull/53620#discussion_r393857051", "createdAt": "2020-03-17T17:41:11Z", "author": {"login": "mark-vieira"}, "path": "buildSrc/src/main/java/org/elasticsearch/gradle/test/rest/RestResourcesPlugin.java", "diffHunk": "@@ -86,21 +86,29 @@\n     public void apply(Project project) {\n         RestResourcesExtension extension = project.getExtensions().create(EXTENSION_NAME, RestResourcesExtension.class);\n \n+        // tests\n         Provider<CopyRestTestsTask> copyRestYamlTestTask = project.getTasks()\n             .register(\"copyYamlTestsTask\", CopyRestTestsTask.class, task -> {\n                 task.includeCore.set(extension.restTests.getIncludeCore());\n                 task.includeXpack.set(extension.restTests.getIncludeXpack());\n-                task.coreConfig = project.getConfigurations().create(\"restTest\");\n+                task.coreConfig = project.getConfigurations().create(\"restTestConfig\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6fa7176500c989f11414dfa5d6c44a1e981af364"}, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mzk0NTg1Nw==", "bodyText": "thanks, implemented on 287fb72", "url": "https://github.com/elastic/elasticsearch/pull/53620#discussion_r393945857", "createdAt": "2020-03-17T20:20:59Z", "author": {"login": "jakelandis"}, "path": "buildSrc/src/main/java/org/elasticsearch/gradle/test/rest/RestResourcesPlugin.java", "diffHunk": "@@ -86,21 +86,29 @@\n     public void apply(Project project) {\n         RestResourcesExtension extension = project.getExtensions().create(EXTENSION_NAME, RestResourcesExtension.class);\n \n+        // tests\n         Provider<CopyRestTestsTask> copyRestYamlTestTask = project.getTasks()\n             .register(\"copyYamlTestsTask\", CopyRestTestsTask.class, task -> {\n                 task.includeCore.set(extension.restTests.getIncludeCore());\n                 task.includeXpack.set(extension.restTests.getIncludeXpack());\n-                task.coreConfig = project.getConfigurations().create(\"restTest\");\n+                task.coreConfig = project.getConfigurations().create(\"restTestConfig\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mzg1NzA1MQ=="}, "originalCommit": {"oid": "6fa7176500c989f11414dfa5d6c44a1e981af364"}, "originalPosition": 10}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ0MTMzNTU5OnYy", "diffSide": "RIGHT", "path": "buildSrc/src/main/java/org/elasticsearch/gradle/test/rest/RestResourcesPlugin.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QxNzo0NDo0M1rOF3nQww==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QyMTozNjo0N1rOF3u8VA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mzg1OTI2Nw==", "bodyText": "I'm not particular excited about us hard-coding these mappings. Are we going to have to add something here for every project that shares tests. Also, if we want to get to a point where we can aggregate all xpack tests (as the clients team has asked about) we'll need a more generic solution here likely based on some convention.", "url": "https://github.com/elastic/elasticsearch/pull/53620#discussion_r393859267", "createdAt": "2020-03-17T17:44:43Z", "author": {"login": "mark-vieira"}, "path": "buildSrc/src/main/java/org/elasticsearch/gradle/test/rest/RestResourcesPlugin.java", "diffHunk": "@@ -86,21 +86,29 @@\n     public void apply(Project project) {\n         RestResourcesExtension extension = project.getExtensions().create(EXTENSION_NAME, RestResourcesExtension.class);\n \n+        // tests\n         Provider<CopyRestTestsTask> copyRestYamlTestTask = project.getTasks()\n             .register(\"copyYamlTestsTask\", CopyRestTestsTask.class, task -> {\n                 task.includeCore.set(extension.restTests.getIncludeCore());\n                 task.includeXpack.set(extension.restTests.getIncludeXpack());\n-                task.coreConfig = project.getConfigurations().create(\"restTest\");\n+                task.coreConfig = project.getConfigurations().create(\"restTestConfig\");\n+                project.getConfigurations().maybeCreate(\"restTests\");\n+                project.getConfigurations().maybeCreate(\"restXpackTests\");\n                 if (BuildParams.isInternal()) {\n+                    // core\n                     Dependency restTestdependency = project.getDependencies()\n                         .project(Map.of(\"path\", \":rest-api-spec\", \"configuration\", \"restTests\"));\n                     project.getDependencies().add(task.coreConfig.getName(), restTestdependency);\n-\n+                    // x-pack\n                     task.xpackConfig = project.getConfigurations().create(\"restXpackTest\");\n                     Dependency restXPackTestdependency = project.getDependencies()\n                         .project(Map.of(\"path\", \":x-pack:plugin\", \"configuration\", \"restXpackTests\"));\n                     project.getDependencies().add(task.xpackConfig.getName(), restXPackTestdependency);\n                     task.dependsOn(task.xpackConfig);\n+                    // watcher", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6fa7176500c989f11414dfa5d6c44a1e981af364"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mzk4NTEwOA==", "bodyText": "Are we going to have to add something here for every project that shares tests\n\nYeah, as-is unfortunately. I agree this is less then ideal, and will get ugly after a few more of these. If you have any suggestions, I can explore (but preferably in a different PR).", "url": "https://github.com/elastic/elasticsearch/pull/53620#discussion_r393985108", "createdAt": "2020-03-17T21:36:47Z", "author": {"login": "jakelandis"}, "path": "buildSrc/src/main/java/org/elasticsearch/gradle/test/rest/RestResourcesPlugin.java", "diffHunk": "@@ -86,21 +86,29 @@\n     public void apply(Project project) {\n         RestResourcesExtension extension = project.getExtensions().create(EXTENSION_NAME, RestResourcesExtension.class);\n \n+        // tests\n         Provider<CopyRestTestsTask> copyRestYamlTestTask = project.getTasks()\n             .register(\"copyYamlTestsTask\", CopyRestTestsTask.class, task -> {\n                 task.includeCore.set(extension.restTests.getIncludeCore());\n                 task.includeXpack.set(extension.restTests.getIncludeXpack());\n-                task.coreConfig = project.getConfigurations().create(\"restTest\");\n+                task.coreConfig = project.getConfigurations().create(\"restTestConfig\");\n+                project.getConfigurations().maybeCreate(\"restTests\");\n+                project.getConfigurations().maybeCreate(\"restXpackTests\");\n                 if (BuildParams.isInternal()) {\n+                    // core\n                     Dependency restTestdependency = project.getDependencies()\n                         .project(Map.of(\"path\", \":rest-api-spec\", \"configuration\", \"restTests\"));\n                     project.getDependencies().add(task.coreConfig.getName(), restTestdependency);\n-\n+                    // x-pack\n                     task.xpackConfig = project.getConfigurations().create(\"restXpackTest\");\n                     Dependency restXPackTestdependency = project.getDependencies()\n                         .project(Map.of(\"path\", \":x-pack:plugin\", \"configuration\", \"restXpackTests\"));\n                     project.getDependencies().add(task.xpackConfig.getName(), restXPackTestdependency);\n                     task.dependsOn(task.xpackConfig);\n+                    // watcher", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mzg1OTI2Nw=="}, "originalCommit": {"oid": "6fa7176500c989f11414dfa5d6c44a1e981af364"}, "originalPosition": 25}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ0MTM0MjQ4OnYy", "diffSide": "RIGHT", "path": "buildSrc/src/main/java/org/elasticsearch/gradle/test/rest/RestResourcesPlugin.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QxNzo0NjoyOVrOF3nVEg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QyMDoyMTowOVrOF3sjUg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mzg2MDM3MA==", "bodyText": "I think we should just use create instead of maybeCreate and remove any instances in projects that are manually creating these. The risk with the lenient approach is that some project declares this configuration for one purpose, and we see it and use it for a different one. This should be explicit. If you create a conflicting configuration we should error.", "url": "https://github.com/elastic/elasticsearch/pull/53620#discussion_r393860370", "createdAt": "2020-03-17T17:46:29Z", "author": {"login": "mark-vieira"}, "path": "buildSrc/src/main/java/org/elasticsearch/gradle/test/rest/RestResourcesPlugin.java", "diffHunk": "@@ -86,21 +86,29 @@\n     public void apply(Project project) {\n         RestResourcesExtension extension = project.getExtensions().create(EXTENSION_NAME, RestResourcesExtension.class);\n \n+        // tests\n         Provider<CopyRestTestsTask> copyRestYamlTestTask = project.getTasks()\n             .register(\"copyYamlTestsTask\", CopyRestTestsTask.class, task -> {\n                 task.includeCore.set(extension.restTests.getIncludeCore());\n                 task.includeXpack.set(extension.restTests.getIncludeXpack());\n-                task.coreConfig = project.getConfigurations().create(\"restTest\");\n+                task.coreConfig = project.getConfigurations().create(\"restTestConfig\");\n+                project.getConfigurations().maybeCreate(\"restTests\");\n+                project.getConfigurations().maybeCreate(\"restXpackTests\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6fa7176500c989f11414dfa5d6c44a1e981af364"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mzk0NTkzOA==", "bodyText": "good call, implemented on 287fb72", "url": "https://github.com/elastic/elasticsearch/pull/53620#discussion_r393945938", "createdAt": "2020-03-17T20:21:09Z", "author": {"login": "jakelandis"}, "path": "buildSrc/src/main/java/org/elasticsearch/gradle/test/rest/RestResourcesPlugin.java", "diffHunk": "@@ -86,21 +86,29 @@\n     public void apply(Project project) {\n         RestResourcesExtension extension = project.getExtensions().create(EXTENSION_NAME, RestResourcesExtension.class);\n \n+        // tests\n         Provider<CopyRestTestsTask> copyRestYamlTestTask = project.getTasks()\n             .register(\"copyYamlTestsTask\", CopyRestTestsTask.class, task -> {\n                 task.includeCore.set(extension.restTests.getIncludeCore());\n                 task.includeXpack.set(extension.restTests.getIncludeXpack());\n-                task.coreConfig = project.getConfigurations().create(\"restTest\");\n+                task.coreConfig = project.getConfigurations().create(\"restTestConfig\");\n+                project.getConfigurations().maybeCreate(\"restTests\");\n+                project.getConfigurations().maybeCreate(\"restXpackTests\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mzg2MDM3MA=="}, "originalCommit": {"oid": "6fa7176500c989f11414dfa5d6c44a1e981af364"}, "originalPosition": 12}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3274, "cost": 1, "resetAt": "2021-11-12T11:57:46Z"}}}