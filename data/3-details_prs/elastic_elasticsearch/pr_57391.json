{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDI1NDE4NTk3", "number": 57391, "title": "SQL: Implement DATE_PARSE function for parsing strings into DATE values", "bodyText": "Implement DATE_PARSE(<time_str>, <pattern_str>) function\nwhich allows to parse a time string according to the specified\npattern into a time object. The patterns allowed are those of\njava.time.format.DateTimeFormatter.\nCloses #54962", "createdAt": "2020-05-30T05:36:16Z", "url": "https://github.com/elastic/elasticsearch/pull/57391", "merged": true, "mergeCommit": {"oid": "647a413d9b21bd3938f1716bb19f8407e1334125"}, "closed": true, "closedAt": "2020-07-16T13:33:47Z", "author": {"login": "Patrick0308"}, "timelineItems": {"totalCount": 28, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcmQKPKAH2gAyNDI1NDE4NTk3OmU1NzUwNGJlZDI2YmMwOTY4YmI1MWYzOGFiZTgxNzFiNjQ3YzM2MGY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc1biyRAH2gAyNDI1NDE4NTk3OjMyMzYwNjI5YTZjOTFhNzNmZDY2ZWFiOWJlZTdhMzY3YjljNjUwNDU=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "e57504bed26bc0968bb51f38abe8171b647c360f", "author": {"user": {"login": "Patrick0308", "name": "\u767d\u6cfd"}}, "url": "https://github.com/elastic/elasticsearch/commit/e57504bed26bc0968bb51f38abe8171b647c360f", "committedDate": "2020-05-30T05:24:52Z", "message": "add DateParse Function"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9b1313cf33061c92d007fe55f743321c1970698b", "author": {"user": {"login": "Patrick0308", "name": "\u767d\u6cfd"}}, "url": "https://github.com/elastic/elasticsearch/commit/9b1313cf33061c92d007fe55f743321c1970698b", "committedDate": "2020-05-30T16:07:21Z", "message": "fix imports"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f19d477d2a724f8c901fa7a036cf5f7eb19c9c6a", "author": {"user": {"login": "Patrick0308", "name": "\u767d\u6cfd"}}, "url": "https://github.com/elastic/elasticsearch/commit/f19d477d2a724f8c901fa7a036cf5f7eb19c9c6a", "committedDate": "2020-06-02T04:59:11Z", "message": "modify LocalDate to ZoneDateTime and fix function name"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "969f1f65d36f7e93e2e9b4163c6a4a021a5d262c", "author": {"user": {"login": "Patrick0308", "name": "\u767d\u6cfd"}}, "url": "https://github.com/elastic/elasticsearch/commit/969f1f65d36f7e93e2e9b4163c6a4a021a5d262c", "committedDate": "2020-06-02T05:29:22Z", "message": "add DATE_PARSE unit tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "62f2b099640db3ac9bc9a6e7d561d680e78deccb", "author": {"user": {"login": "Patrick0308", "name": "\u767d\u6cfd"}}, "url": "https://github.com/elastic/elasticsearch/commit/62f2b099640db3ac9bc9a6e7d561d680e78deccb", "committedDate": "2020-06-03T07:02:40Z", "message": "add integration tests and InternalSqlScriptUtils.dateParse function"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f4fa462469e8ad63f12e09b913ce7c7f54644f3b", "author": {"user": {"login": "Patrick0308", "name": "\u767d\u6cfd"}}, "url": "https://github.com/elastic/elasticsearch/commit/f4fa462469e8ad63f12e09b913ce7c7f54644f3b", "committedDate": "2020-06-03T07:03:14Z", "message": "sort sql function"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "28b5068bd561d039020723c20d1c46f7049a4fef", "author": {"user": {"login": "Patrick0308", "name": "\u767d\u6cfd"}}, "url": "https://github.com/elastic/elasticsearch/commit/28b5068bd561d039020723c20d1c46f7049a4fef", "committedDate": "2020-06-03T07:46:04Z", "message": "add doc"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI0NjQwNzcw", "url": "https://github.com/elastic/elasticsearch/pull/57391#pullrequestreview-424640770", "createdAt": "2020-06-04T16:47:31Z", "commit": {"oid": "28b5068bd561d039020723c20d1c46f7049a4fef"}, "state": "COMMENTED", "comments": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNFQxNjo0NzozMlrOGfO2Rw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNFQxNjo1OTo1NVrOGfPUjw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTQwMjMxMQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            ==== `DATEE_PARSE`\n          \n          \n            \n            ==== `DATE_PARSE`", "url": "https://github.com/elastic/elasticsearch/pull/57391#discussion_r435402311", "createdAt": "2020-06-04T16:47:32Z", "author": {"login": "matriv"}, "path": "docs/reference/sql/functions/date-time.asciidoc", "diffHunk": "@@ -404,6 +404,49 @@ include-tagged::{sql-specs}/docs/docs.csv-spec[dateDiffDateTimeMinutes]\n include-tagged::{sql-specs}/docs/docs.csv-spec[dateDiffDateMinutes]\n --------------------------------------------------\n \n+[[sql-functions-datetime-dateparse]]\n+==== `DATEE_PARSE`", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "28b5068bd561d039020723c20d1c46f7049a4fef"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTQwMjc0NQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            If the parsing pattern contains date units (e.g. 'HH:mm:ss', 'dd-MM HH:mm:ss', etc.) an error is returned\n          \n          \n            \n            If the parsing pattern contains time units (e.g. 'HH:mm:ss', 'dd-MM HH:mm:ss', etc.) an error is returned", "url": "https://github.com/elastic/elasticsearch/pull/57391#discussion_r435402745", "createdAt": "2020-06-04T16:48:16Z", "author": {"login": "matriv"}, "path": "docs/reference/sql/functions/date-time.asciidoc", "diffHunk": "@@ -404,6 +404,49 @@ include-tagged::{sql-specs}/docs/docs.csv-spec[dateDiffDateTimeMinutes]\n include-tagged::{sql-specs}/docs/docs.csv-spec[dateDiffDateMinutes]\n --------------------------------------------------\n \n+[[sql-functions-datetime-dateparse]]\n+==== `DATEE_PARSE`\n+\n+.Synopsis:\n+[source, sql]\n+--------------------------------------------------\n+DATE_PARSE(\n+    string_exp, <1>\n+    string_exp) <2>\n+--------------------------------------------------\n+\n+*Input*:\n+\n+<1> date expression as a string\n+<2> parsing pattern\n+\n+*Output*: date\n+\n+*Description*: Returns a date by parsing the 1st argument using the format specified in the 2nd argument. The parsing\n+format pattern used is the one from\n+https://docs.oracle.com/en/java/javase/14/docs/api/java.base/java/time/format/DateTimeFormatter.html[`java.time.format.DateTimeFormatter`].\n+If any of the two arguments is `null` or an empty string `null` is returned.\n+\n+[NOTE]\n+If the parsing pattern contains date units (e.g. 'HH:mm:ss', 'dd-MM HH:mm:ss', etc.) an error is returned", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "28b5068bd561d039020723c20d1c46f7049a4fef"}, "originalPosition": 28}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTQwMzA4MQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            as the function needs to return a value of `date` type which will contain only date.\n          \n          \n            \n            as the function needs to return a value of `date` type which will contain only date part.", "url": "https://github.com/elastic/elasticsearch/pull/57391#discussion_r435403081", "createdAt": "2020-06-04T16:48:47Z", "author": {"login": "matriv"}, "path": "docs/reference/sql/functions/date-time.asciidoc", "diffHunk": "@@ -404,6 +404,49 @@ include-tagged::{sql-specs}/docs/docs.csv-spec[dateDiffDateTimeMinutes]\n include-tagged::{sql-specs}/docs/docs.csv-spec[dateDiffDateMinutes]\n --------------------------------------------------\n \n+[[sql-functions-datetime-dateparse]]\n+==== `DATEE_PARSE`\n+\n+.Synopsis:\n+[source, sql]\n+--------------------------------------------------\n+DATE_PARSE(\n+    string_exp, <1>\n+    string_exp) <2>\n+--------------------------------------------------\n+\n+*Input*:\n+\n+<1> date expression as a string\n+<2> parsing pattern\n+\n+*Output*: date\n+\n+*Description*: Returns a date by parsing the 1st argument using the format specified in the 2nd argument. The parsing\n+format pattern used is the one from\n+https://docs.oracle.com/en/java/javase/14/docs/api/java.base/java/time/format/DateTimeFormatter.html[`java.time.format.DateTimeFormatter`].\n+If any of the two arguments is `null` or an empty string `null` is returned.\n+\n+[NOTE]\n+If the parsing pattern contains date units (e.g. 'HH:mm:ss', 'dd-MM HH:mm:ss', etc.) an error is returned\n+as the function needs to return a value of `date` type which will contain only date.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "28b5068bd561d039020723c20d1c46f7049a4fef"}, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTQwNDM0NQ==", "bodyText": "How come this works? the parsing pattern contains HH which is time information.", "url": "https://github.com/elastic/elasticsearch/pull/57391#discussion_r435404345", "createdAt": "2020-06-04T16:50:49Z", "author": {"login": "matriv"}, "path": "x-pack/plugin/sql/qa/server/src/main/resources/date.csv-spec", "diffHunk": "@@ -164,3 +164,105 @@ SELECT MAX(salary) FROM test_emp GROUP BY TODAY();\n ---------------\n 74999\n ;\n+\n+selectDateParse\n+schema::date1:date\n+SELECT DATE_PARSE('07/04/2020', 'dd/MM/uuuu') AS date1;\n+\n+   date1       \n+------------\n+2020-04-07 \n+;\n+\n+\n+selectDateParseWithField\n+schema::birth_date:ts|dp_birth_date:date\n+SELECT birth_date, DATE_PARSE(DATETIME_FORMAT(birth_date, 'MM/dd/ HH uuuu'), concat(gender, 'M/dd/ HH uuuu')) AS dp_birth_date", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "28b5068bd561d039020723c20d1c46f7049a4fef"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTQwNTg1MQ==", "bodyText": "I think it makes sense to show:\n2020-04-07T00:00:00.000+03:00 so that it's visible that the timezone is considered.", "url": "https://github.com/elastic/elasticsearch/pull/57391#discussion_r435405851", "createdAt": "2020-06-04T16:53:20Z", "author": {"login": "matriv"}, "path": "x-pack/plugin/sql/qa/server/src/main/resources/docs/docs.csv-spec", "diffHunk": "@@ -2841,6 +2842,31 @@ schema::time:time\n // end::timeParse3\n ;\n \n+dateParse1\n+schema::date:date\n+// tag::dateParse1\n+SELECT DATE_PARSE('07/04/2020', 'dd/MM/uuuu') AS \"date\";\n+\n+   date\n+-----------\n+2020-04-07\n+// end::dateParse1\n+;\n+\n+dateParse2-Ignore\n+schema::date:date\n+// tag::timeParse3\n+{\n+    \"query\" : \"SELECT DATE_PARSE('07/04/2020', 'dd/MM/uuuu') AS \\\"date\\\"\",\n+    \"time_zone\" : \"Europe/Athens\"\n+}\n+\n+   date\n+------------\n+2020-04-07", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "28b5068bd561d039020723c20d1c46f7049a4fef"}, "originalPosition": 33}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTQwNzI3NA==", "bodyText": "I don't think you should throw an exception here, it should be handled by the code here: https://github.com/elastic/elasticsearch/pull/57391/files#diff-abec0662fc741468125e83032b91a634R66", "url": "https://github.com/elastic/elasticsearch/pull/57391#discussion_r435407274", "createdAt": "2020-06-04T16:55:36Z", "author": {"login": "matriv"}, "path": "x-pack/plugin/sql/src/main/java/org/elasticsearch/xpack/sql/expression/function/scalar/datetime/DateTimeParseProcessor.java", "diffHunk": "@@ -31,7 +32,8 @@\n \n     public enum Parser {\n         DATE_TIME(\"datetime\", ZonedDateTime::from, LocalDateTime::from), \n-        TIME(\"time\", OffsetTime::from, LocalTime::from);\n+        TIME(\"time\", OffsetTime::from, LocalTime::from),\n+        DATE(\"date\", LocalDate::from, (TemporalAccessor ta) -> {throw new RuntimeException();});", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "28b5068bd561d039020723c20d1c46f7049a4fef"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTQwNzUzOA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    } else if (ta instanceof LocalDate){\n          \n          \n            \n                    } else if (ta instanceof LocalDate) {", "url": "https://github.com/elastic/elasticsearch/pull/57391#discussion_r435407538", "createdAt": "2020-06-04T16:56:00Z", "author": {"login": "matriv"}, "path": "x-pack/plugin/sql/src/main/java/org/elasticsearch/xpack/sql/util/DateUtils.java", "diffHunk": "@@ -235,6 +239,8 @@ public static TemporalAccessor atTimeZone(TemporalAccessor ta, ZoneId zoneId) {\n             return atTimeZone((OffsetTime) ta, zoneId);\n         } else if (ta instanceof LocalTime) {\n             return atTimeZone((LocalTime) ta, zoneId);\n+        } else if (ta instanceof LocalDate){", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "28b5068bd561d039020723c20d1c46f7049a4fef"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTQwOTM0MQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                public static ZonedDateTime date(int year, int month, int day, ZoneId zoneId){\n          \n          \n            \n                public static ZonedDateTime date(int year, int month, int day, ZoneId zoneId) {", "url": "https://github.com/elastic/elasticsearch/pull/57391#discussion_r435409341", "createdAt": "2020-06-04T16:58:47Z", "author": {"login": "matriv"}, "path": "x-pack/plugin/sql/src/test/java/org/elasticsearch/xpack/sql/expression/function/scalar/datetime/DateTimeTestUtils.java", "diffHunk": "@@ -63,6 +63,10 @@ public static OffsetTime time(int hour, int minute, int second, int nano, ZoneId\n         return OffsetTime.of(lt, zoneId.getRules().getValidOffsets(ldt).get(0));\n     }\n \n+    public static ZonedDateTime date(int year, int month, int day, ZoneId zoneId){", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "28b5068bd561d039020723c20d1c46f7049a4fef"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTQxMDA2Mw==", "bodyText": "Please add one more test where there are both valid date and time parts which should also throw an exception as time parts are not allowed.", "url": "https://github.com/elastic/elasticsearch/pull/57391#discussion_r435410063", "createdAt": "2020-06-04T16:59:55Z", "author": {"login": "matriv"}, "path": "x-pack/plugin/sql/src/test/java/org/elasticsearch/xpack/sql/expression/function/scalar/datetime/DateTimeParseProcessorTests.java", "diffHunk": "@@ -113,44 +114,86 @@ public void testDateTimeInvalidInputs() {\n     \n     public void testTimeInvalidInputs() {\n         SqlIllegalArgumentException siae = expectThrows(\n-                SqlIllegalArgumentException.class,\n-                () -> new TimeParse(Source.EMPTY, l(10), randomStringLiteral(), randomZone()).makePipe().asProcessor().process(null)\n+            SqlIllegalArgumentException.class,\n+            () -> new TimeParse(Source.EMPTY, l(10), randomStringLiteral(), randomZone()).makePipe().asProcessor().process(null)\n         );\n         assertEquals(\"A string is required; received [10]\", siae.getMessage());\n         \n         siae = expectThrows(\n-                SqlIllegalArgumentException.class,\n-                () -> new TimeParse(Source.EMPTY, randomStringLiteral(), l(20), randomZone()).makePipe().asProcessor().process(null)\n+            SqlIllegalArgumentException.class,\n+            () -> new TimeParse(Source.EMPTY, randomStringLiteral(), l(20), randomZone()).makePipe().asProcessor().process(null)\n         );\n         assertEquals(\"A string is required; received [20]\", siae.getMessage());\n         \n         siae = expectThrows(\n-                SqlIllegalArgumentException.class,\n-                () -> new TimeParse(Source.EMPTY, l(\"11:04:07\"), l(\"invalid\"), randomZone()).makePipe().asProcessor().process(null)\n+            SqlIllegalArgumentException.class,\n+            () -> new TimeParse(Source.EMPTY, l(\"11:04:07\"), l(\"invalid\"), randomZone()).makePipe().asProcessor().process(null)\n         );\n         assertEquals(\n-                \"Invalid time string [11:04:07] or pattern [invalid] is received; Unknown pattern letter: i\",\n-                siae.getMessage()\n+            \"Invalid time string [11:04:07] or pattern [invalid] is received; Unknown pattern letter: i\",\n+            siae.getMessage()\n         );\n         \n         siae = expectThrows(\n-                SqlIllegalArgumentException.class,\n-                () -> new TimeParse(Source.EMPTY, l(\"11:04:07\"), l(\"HH:mm\"), randomZone()).makePipe().asProcessor().process(null)\n+            SqlIllegalArgumentException.class,\n+            () -> new TimeParse(Source.EMPTY, l(\"11:04:07\"), l(\"HH:mm\"), randomZone()).makePipe().asProcessor().process(null)\n         );\n         assertEquals(\n-                \"Invalid time string [11:04:07] or pattern [HH:mm] is received; \" +\n-                        \"Text '11:04:07' could not be parsed, unparsed text found at index 5\",\n-                siae.getMessage()\n+            \"Invalid time string [11:04:07] or pattern [HH:mm] is received; \" +\n+                \"Text '11:04:07' could not be parsed, unparsed text found at index 5\",\n+            siae.getMessage()\n         );\n         \n         siae = expectThrows(\n-                SqlIllegalArgumentException.class,\n-                () -> new TimeParse(Source.EMPTY, l(\"07/05/2020\"), l(\"dd/MM/uuuu\"), randomZone()).makePipe().asProcessor().process(null)\n+            SqlIllegalArgumentException.class,\n+            () -> new TimeParse(Source.EMPTY, l(\"07/05/2020\"), l(\"dd/MM/uuuu\"), randomZone()).makePipe().asProcessor().process(null)\n+        );\n+        assertEquals(\n+            \"Invalid time string [07/05/2020] or pattern [dd/MM/uuuu] is received; Unable to convert parsed text into [time]\",\n+            siae.getMessage()\n+        );\n+    }\n+ \n+    public void testDateInvalidInputs() {\n+        SqlIllegalArgumentException siae = expectThrows(\n+            SqlIllegalArgumentException.class,\n+            () -> new DateParse(Source.EMPTY, l(10), randomStringLiteral(), randomZone()).makePipe().asProcessor().process(null)\n+        );\n+        assertEquals(\"A string is required; received [10]\", siae.getMessage());\n+\n+        siae = expectThrows(\n+            SqlIllegalArgumentException.class,\n+            () -> new DateParse(Source.EMPTY, randomStringLiteral(), l(20), randomZone()).makePipe().asProcessor().process(null)\n+        );\n+        assertEquals(\"A string is required; received [20]\", siae.getMessage());\n+\n+        siae = expectThrows(\n+            SqlIllegalArgumentException.class,\n+            () -> new DateParse(Source.EMPTY, l(\"07/05/2020\"), l(\"invalid\"), randomZone()).makePipe().asProcessor().process(null)\n         );\n         assertEquals(\n-                \"Invalid time string [07/05/2020] or pattern [dd/MM/uuuu] is received; Unable to convert parsed text into [time]\",\n+            \"Invalid date string [07/05/2020] or pattern [invalid] is received; Unknown pattern letter: i\",\n                 siae.getMessage()\n         );\n+\n+        siae = expectThrows(\n+             SqlIllegalArgumentException.class,\n+             () -> new DateParse(Source.EMPTY, l(\"07/05/2020\"), l(\"dd/MM\"), randomZone()).makePipe().asProcessor().process(null)\n+        );\n+        assertEquals(\n+           \"Invalid date string [07/05/2020] or pattern [dd/MM] is received; \" +\n+                \"Text '07/05/2020' could not be parsed, unparsed text found at index 5\",\n+           siae.getMessage()\n+        );\n+    \n+        siae = expectThrows(\n+            SqlIllegalArgumentException.class,\n+            () -> new DateParse(Source.EMPTY, l(\"11:04:07\"), l(\"HH:mm:ss\"), randomZone()).makePipe().asProcessor().process(null)\n+        );\n+        assertEquals(\n+            \"Invalid date string [11:04:07] or pattern [HH:mm:ss] is received; Unable to convert parsed text into [date]\",\n+            siae.getMessage()\n+        );", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "28b5068bd561d039020723c20d1c46f7049a4fef"}, "originalPosition": 107}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8761fe5d1d1132723dc7e6524bed988299c3248f", "author": {"user": {"login": "Patrick0308", "name": "\u767d\u6cfd"}}, "url": "https://github.com/elastic/elasticsearch/commit/8761fe5d1d1132723dc7e6524bed988299c3248f", "committedDate": "2020-06-05T08:25:35Z", "message": "modify parser constructor"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "72dd036c75105c36c7dda48a2fd222fa819944a9", "author": {"user": {"login": "Patrick0308", "name": "\u767d\u6cfd"}}, "url": "https://github.com/elastic/elasticsearch/commit/72dd036c75105c36c7dda48a2fd222fa819944a9", "committedDate": "2020-06-10T15:02:24Z", "message": "formats code and modify doc"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "769cd21e0c6ec1b6e6f4e15b333920dbbaa96dbe", "author": {"user": {"login": "Patrick0308", "name": "\u767d\u6cfd"}}, "url": "https://github.com/elastic/elasticsearch/commit/769cd21e0c6ec1b6e6f4e15b333920dbbaa96dbe", "committedDate": "2020-06-10T15:05:12Z", "message": "formats code"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a65f074e7d34eb737a90b3bdd696f2a75d4fdc4d", "author": {"user": {"login": "Patrick0308", "name": "\u767d\u6cfd"}}, "url": "https://github.com/elastic/elasticsearch/commit/a65f074e7d34eb737a90b3bdd696f2a75d4fdc4d", "committedDate": "2020-06-10T15:14:51Z", "message": "add DATE_PARSE unit test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ff7f1461ca2b3dd5a4bf776f78b8be18208740ea", "author": {"user": {"login": "Patrick0308", "name": "\u767d\u6cfd"}}, "url": "https://github.com/elastic/elasticsearch/commit/ff7f1461ca2b3dd5a4bf776f78b8be18208740ea", "committedDate": "2020-06-10T15:16:00Z", "message": "format code"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMxNjYxNzM3", "url": "https://github.com/elastic/elasticsearch/pull/57391#pullrequestreview-431661737", "createdAt": "2020-06-16T16:01:32Z", "commit": {"oid": "ff7f1461ca2b3dd5a4bf776f78b8be18208740ea"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQxNjowMTozMlrOGkieDQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQxNzowNDoxNVrOGkk8Ig==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDk2NjY2OQ==", "bodyText": "You need to close the ====", "url": "https://github.com/elastic/elasticsearch/pull/57391#discussion_r440966669", "createdAt": "2020-06-16T16:01:32Z", "author": {"login": "matriv"}, "path": "docs/reference/sql/functions/date-time.asciidoc", "diffHunk": "@@ -404,6 +404,49 @@ include-tagged::{sql-specs}/docs/docs.csv-spec[dateDiffDateTimeMinutes]\n include-tagged::{sql-specs}/docs/docs.csv-spec[dateDiffDateMinutes]\n --------------------------------------------------\n \n+[[sql-functions-datetime-dateparse]]\n+==== `DATE_PARSE`\n+\n+.Synopsis:\n+[source, sql]\n+--------------------------------------------------\n+DATE_PARSE(\n+    string_exp, <1>\n+    string_exp) <2>\n+--------------------------------------------------\n+\n+*Input*:\n+\n+<1> date expression as a string\n+<2> parsing pattern\n+\n+*Output*: date\n+\n+*Description*: Returns a date by parsing the 1st argument using the format specified in the 2nd argument. The parsing\n+format pattern used is the one from\n+https://docs.oracle.com/en/java/javase/14/docs/api/java.base/java/time/format/DateTimeFormatter.html[`java.time.format.DateTimeFormatter`].\n+If any of the two arguments is `null` or an empty string `null` is returned.\n+\n+[NOTE]\n+If the parsing pattern not contains date units completely (e.g. 'HH:mm:ss', 'dd-MM HH:mm:ss', etc.) an error is returned\n+as the function needs to return a value of `date` type which will contain date part.\n+\n+[source, sql]\n+--------------------------------------------------\n+include-tagged::{sql-specs}/docs/docs.csv-spec[dateParse1]\n+--------------------------------------------------\n+\n+[NOTE]\n+====\n+The resulting `date` will have the time zone specified by the user through the \n+<<sql-rest-fields-timezone,`time_zone`>>/<<jdbc-cfg-timezone,`timezone`>> REST/driver parameters\n+with no conversion applied.\n+\n+[source, sql]\n+--------------------------------------------------\n+include-tagged::{sql-specs}/docs/docs.csv-spec[dateParse2]\n+--------------------------------------------------\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ff7f1461ca2b3dd5a4bf776f78b8be18208740ea"}, "originalPosition": 46}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTAwNjQ0OA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            If the parsing pattern not contains date units completely (e.g. 'HH:mm:ss', 'dd-MM HH:mm:ss', etc.) an error is returned\n          \n          \n            \n            If the parsing pattern does not contain all valid date units (e.g. 'HH:mm:ss', 'dd-MM HH:mm:ss', etc.) an error is returned", "url": "https://github.com/elastic/elasticsearch/pull/57391#discussion_r441006448", "createdAt": "2020-06-16T17:03:04Z", "author": {"login": "matriv"}, "path": "docs/reference/sql/functions/date-time.asciidoc", "diffHunk": "@@ -404,6 +404,49 @@ include-tagged::{sql-specs}/docs/docs.csv-spec[dateDiffDateTimeMinutes]\n include-tagged::{sql-specs}/docs/docs.csv-spec[dateDiffDateMinutes]\n --------------------------------------------------\n \n+[[sql-functions-datetime-dateparse]]\n+==== `DATE_PARSE`\n+\n+.Synopsis:\n+[source, sql]\n+--------------------------------------------------\n+DATE_PARSE(\n+    string_exp, <1>\n+    string_exp) <2>\n+--------------------------------------------------\n+\n+*Input*:\n+\n+<1> date expression as a string\n+<2> parsing pattern\n+\n+*Output*: date\n+\n+*Description*: Returns a date by parsing the 1st argument using the format specified in the 2nd argument. The parsing\n+format pattern used is the one from\n+https://docs.oracle.com/en/java/javase/14/docs/api/java.base/java/time/format/DateTimeFormatter.html[`java.time.format.DateTimeFormatter`].\n+If any of the two arguments is `null` or an empty string `null` is returned.\n+\n+[NOTE]\n+If the parsing pattern not contains date units completely (e.g. 'HH:mm:ss', 'dd-MM HH:mm:ss', etc.) an error is returned", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ff7f1461ca2b3dd5a4bf776f78b8be18208740ea"}, "originalPosition": 28}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTAwNzEzOA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    DATE_TIME(\"datetime\", ZonedDateTime::from, LocalDateTime::from), \n          \n          \n            \n                    DATE_TIME(DataTypes.DATETIME, ZonedDateTime::from, LocalDateTime::from),\n          \n          \n            \n                    TIME(SqlDataTypes.TIME, OffsetTime::from, LocalTime::from),\n          \n          \n            \n                    DATE(SqlDataTypes.DATE, LocalDate::from, (TemporalAccessor ta) -> { throw new DateTimeException(\"InvalidDate\");});\n          \n          \n            \n                    \n          \n          \n            \n                    private final BiFunction<String, String, TemporalAccessor> parser;\n          \n          \n            \n                    \n          \n          \n            \n                    private final String parseType;\n          \n          \n            \n            \n          \n          \n            \n                    Parser(DataType parseType,  TemporalQuery<?>... queries) {\n          \n          \n            \n                        this.parseType = parseType.typeName();\n          \n          \n            \n                        this.parser = (timestampStr, pattern) -> DateTimeFormatter.ofPattern(pattern, Locale.ROOT).parseBest(timestampStr, queries);\n          \n          \n            \n                    }", "url": "https://github.com/elastic/elasticsearch/pull/57391#discussion_r441007138", "createdAt": "2020-06-16T17:04:15Z", "author": {"login": "matriv"}, "path": "x-pack/plugin/sql/src/main/java/org/elasticsearch/xpack/sql/expression/function/scalar/datetime/DateTimeParseProcessor.java", "diffHunk": "@@ -31,16 +32,21 @@\n \n     public enum Parser {\n         DATE_TIME(\"datetime\", ZonedDateTime::from, LocalDateTime::from), ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ff7f1461ca2b3dd5a4bf776f78b8be18208740ea"}, "originalPosition": 11}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5cf4020c50f0f584e40da4e76c734297a22b1efd", "author": {"user": {"login": "Patrick0308", "name": "\u767d\u6cfd"}}, "url": "https://github.com/elastic/elasticsearch/commit/5cf4020c50f0f584e40da4e76c734297a22b1efd", "committedDate": "2020-06-17T08:20:35Z", "message": "fix some problem"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9ed890e32a7836e85804bbd479d0681a8897d9db", "author": {"user": {"login": "Patrick0308", "name": "\u767d\u6cfd"}}, "url": "https://github.com/elastic/elasticsearch/commit/9ed890e32a7836e85804bbd479d0681a8897d9db", "committedDate": "2020-06-17T08:23:48Z", "message": "add comment"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "819176f07dd840dd9ec11a21fae867fb575c1d2d", "author": {"user": {"login": "Patrick0308", "name": "\u767d\u6cfd"}}, "url": "https://github.com/elastic/elasticsearch/commit/819176f07dd840dd9ec11a21fae867fb575c1d2d", "committedDate": "2020-06-19T02:04:21Z", "message": "Merge remote-tracking branch 'upstream/master' into date-parse"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM1NzU0NDgx", "url": "https://github.com/elastic/elasticsearch/pull/57391#pullrequestreview-435754481", "createdAt": "2020-06-23T12:59:03Z", "commit": {"oid": "819176f07dd840dd9ec11a21fae867fb575c1d2d"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yM1QxMjo1OTowM1rOGnn__g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yM1QxMzowMDoxOFrOGnoDDQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDIwMzAwNg==", "bodyText": "Please remove.", "url": "https://github.com/elastic/elasticsearch/pull/57391#discussion_r444203006", "createdAt": "2020-06-23T12:59:03Z", "author": {"login": "matriv"}, "path": "x-pack/plugin/sql/src/main/java/org/elasticsearch/xpack/sql/expression/function/scalar/datetime/DateTimeParseProcessor.java", "diffHunk": "@@ -30,15 +34,17 @@\n public class DateTimeParseProcessor extends BinaryDateTimeProcessor {\n \n     public enum Parser {\n-        DATE_TIME(\"datetime\", ZonedDateTime::from, LocalDateTime::from), \n-        TIME(\"time\", OffsetTime::from, LocalTime::from);\n+        DATE_TIME(DataTypes.DATETIME, ZonedDateTime::from, LocalDateTime::from), \n+        TIME(SqlDataTypes.TIME, OffsetTime::from, LocalTime::from),\n+        DATE(SqlDataTypes.DATE, LocalDate::from, (TemporalAccessor ta) -> {throw new DateTimeException(\"InvalidDate\");});\n         \n         private final BiFunction<String, String, TemporalAccessor> parser;\n         \n-        private final String parseType;\n+        private final DataType parseType;\n \n-        Parser(String parseType,  TemporalQuery<?>... queries) {\n+        Parser(DataType parseType, TemporalQuery<?>... queries) {\n             this.parseType = parseType;\n+            // queries's length must must be greater than one", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "819176f07dd840dd9ec11a21fae867fb575c1d2d"}, "originalPosition": 34}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDIwMzY2NQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        this.parseType = parseType;\n          \n          \n            \n                        this.parseType = parseType.typeName();", "url": "https://github.com/elastic/elasticsearch/pull/57391#discussion_r444203665", "createdAt": "2020-06-23T13:00:04Z", "author": {"login": "matriv"}, "path": "x-pack/plugin/sql/src/main/java/org/elasticsearch/xpack/sql/expression/function/scalar/datetime/DateTimeParseProcessor.java", "diffHunk": "@@ -30,15 +34,17 @@\n public class DateTimeParseProcessor extends BinaryDateTimeProcessor {\n \n     public enum Parser {\n-        DATE_TIME(\"datetime\", ZonedDateTime::from, LocalDateTime::from), \n-        TIME(\"time\", OffsetTime::from, LocalTime::from);\n+        DATE_TIME(DataTypes.DATETIME, ZonedDateTime::from, LocalDateTime::from), \n+        TIME(SqlDataTypes.TIME, OffsetTime::from, LocalTime::from),\n+        DATE(SqlDataTypes.DATE, LocalDate::from, (TemporalAccessor ta) -> {throw new DateTimeException(\"InvalidDate\");});\n         \n         private final BiFunction<String, String, TemporalAccessor> parser;\n         \n-        private final String parseType;\n+        private final DataType parseType;\n \n-        Parser(String parseType,  TemporalQuery<?>... queries) {\n+        Parser(DataType parseType, TemporalQuery<?>... queries) {\n             this.parseType = parseType;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "819176f07dd840dd9ec11a21fae867fb575c1d2d"}, "originalPosition": 33}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDIwMzc4OQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    private final DataType parseType;\n          \n          \n            \n                    private final String parseType;", "url": "https://github.com/elastic/elasticsearch/pull/57391#discussion_r444203789", "createdAt": "2020-06-23T13:00:18Z", "author": {"login": "matriv"}, "path": "x-pack/plugin/sql/src/main/java/org/elasticsearch/xpack/sql/expression/function/scalar/datetime/DateTimeParseProcessor.java", "diffHunk": "@@ -30,15 +34,17 @@\n public class DateTimeParseProcessor extends BinaryDateTimeProcessor {\n \n     public enum Parser {\n-        DATE_TIME(\"datetime\", ZonedDateTime::from, LocalDateTime::from), \n-        TIME(\"time\", OffsetTime::from, LocalTime::from);\n+        DATE_TIME(DataTypes.DATETIME, ZonedDateTime::from, LocalDateTime::from), \n+        TIME(SqlDataTypes.TIME, OffsetTime::from, LocalTime::from),\n+        DATE(SqlDataTypes.DATE, LocalDate::from, (TemporalAccessor ta) -> {throw new DateTimeException(\"InvalidDate\");});\n         \n         private final BiFunction<String, String, TemporalAccessor> parser;\n         \n-        private final String parseType;\n+        private final DataType parseType;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "819176f07dd840dd9ec11a21fae867fb575c1d2d"}, "originalPosition": 29}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a802cc0406b16352c792cf08a399c4d57b0d5ab0", "author": {"user": {"login": "Patrick0308", "name": "\u767d\u6cfd"}}, "url": "https://github.com/elastic/elasticsearch/commit/a802cc0406b16352c792cf08a399c4d57b0d5ab0", "committedDate": "2020-06-24T08:29:28Z", "message": "modify dateType to String"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM2OTIzNDM1", "url": "https://github.com/elastic/elasticsearch/pull/57391#pullrequestreview-436923435", "createdAt": "2020-06-24T18:59:17Z", "commit": {"oid": "a802cc0406b16352c792cf08a399c4d57b0d5ab0"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNFQxODo1OToxN1rOGofH6w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNFQxOTowMDowOVrOGofJvg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTEwNjE1NQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            dateTimeParseHaving\n          \n          \n            \n            dateParseHaving", "url": "https://github.com/elastic/elasticsearch/pull/57391#discussion_r445106155", "createdAt": "2020-06-24T18:59:17Z", "author": {"login": "matriv"}, "path": "x-pack/plugin/sql/qa/server/src/main/resources/date.csv-spec", "diffHunk": "@@ -164,3 +164,105 @@ SELECT MAX(salary) FROM test_emp GROUP BY TODAY();\n ---------------\n 74999\n ;\n+\n+selectDateParse\n+schema::date1:date\n+SELECT DATE_PARSE('07/04/2020', 'dd/MM/uuuu') AS date1;\n+\n+   date1       \n+------------\n+2020-04-07 \n+;\n+\n+\n+selectDateParseWithField\n+schema::birth_date:ts|dp_birth_date:date\n+SELECT birth_date, DATE_PARSE(DATETIME_FORMAT(birth_date, 'MM/dd/ HH uuuu'), concat(gender, 'M/dd/ HH uuuu')) AS dp_birth_date\n+FROM test_emp WHERE gender = 'M' AND emp_no BETWEEN 10037 AND 10052 ORDER BY emp_no;\n+\n+       birth_date        | dp_birth_date\n+-------------------------+----------------\n+1963-07-22 00:00:00.000Z | 1963-07-22\n+1960-07-20 00:00:00.000Z | 1960-07-20\n+1959-10-01 00:00:00.000Z | 1959-10-01\n+null                     | null\n+null                     | null\n+null                     | null\n+null                     | null\n+null                     | null\n+1958-05-21 00:00:00.000Z | 1958-05-21\n+1953-07-28 00:00:00.000Z | 1953-07-28\n+1961-02-26 00:00:00.000Z | 1961-02-26\n+;\n+\n+dateParseWhere\n+schema::birth_date:ts|dp_birth_date:date\n+SELECT birth_date, DATE_PARSE(DATETIME_FORMAT(birth_date, 'MM_dd_uuuu'), 'MM_dd_uuuu') AS dp_birth_date\n+FROM test_emp WHERE dp_birth_date > '1963-10-20'::date ORDER BY emp_no;\n+\n+       birth_date        | dp_birth_date\n+-------------------------+----------------\n+1964-06-02 00:00:00.000Z | 1964-06-02\n+1963-11-26 00:00:00.000Z | 1963-11-26\n+1964-04-18 00:00:00.000Z | 1964-04-18\n+1964-10-18 00:00:00.000Z | 1964-10-18\n+1964-06-11 00:00:00.000Z | 1964-06-11\n+1965-01-03 00:00:00.000Z | 1965-01-03\n+;\n+\n+dateParseOrderBy\n+schema::birth_date:ts|dp_birth_date:date\n+SELECT birth_date, DATE_PARSE(DATETIME_FORMAT(birth_date, 'MM/dd/uuuu'), 'MM/dd/uuuu') AS dp_birth_date\n+FROM test_emp ORDER BY 2 DESC NULLS LAST LIMIT 10;\n+\n+       birth_date        | dp_birth_date\n+-------------------------+---------------\n+1965-01-03 00:00:00.000Z | 1965-01-03\n+1964-10-18 00:00:00.000Z | 1964-10-18\n+1964-06-11 00:00:00.000Z | 1964-06-11\n+1964-06-02 00:00:00.000Z | 1964-06-02\n+1964-04-18 00:00:00.000Z | 1964-04-18\n+1963-11-26 00:00:00.000Z | 1963-11-26\n+1963-09-09 00:00:00.000Z | 1963-09-09\n+1963-07-22 00:00:00.000Z | 1963-07-22\n+1963-06-07 00:00:00.000Z | 1963-06-07\n+1963-06-01 00:00:00.000Z | 1963-06-01\n+;\n+\n+dateParseGroupBy\n+schema::count:l|df_birth_date:s\n+SELECT count(*) AS count, DATETIME_FORMAT(DATE_PARSE(DATETIME_FORMAT(birth_date, 'dd/MM/uuuu'), 'dd/MM/uuuu'), 'MM') AS df_birth_date\n+FROM test_emp GROUP BY df_birth_date ORDER BY 1 DESC, 2 DESC NULLS LAST LIMIT 10;\n+\n+ count | df_birth_date\n+-------+---------------\n+10     | 09\n+10     | 05\n+10     | null\n+9      | 10\n+9      | 07\n+8      | 11\n+8      | 04\n+8      | 02\n+7      | 12\n+7      | 06\n+;\n+\n+dateTimeParseHaving", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a802cc0406b16352c792cf08a399c4d57b0d5ab0"}, "originalPosition": 88}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTEwNjYyMg==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            // tag::timeParse3\n          \n          \n            \n            // tag::dateParse2", "url": "https://github.com/elastic/elasticsearch/pull/57391#discussion_r445106622", "createdAt": "2020-06-24T19:00:09Z", "author": {"login": "matriv"}, "path": "x-pack/plugin/sql/qa/server/src/main/resources/docs/docs.csv-spec", "diffHunk": "@@ -2864,6 +2865,31 @@ schema::time:time\n // end::timeParse3\n ;\n \n+dateParse1\n+schema::date:date\n+// tag::dateParse1\n+SELECT DATE_PARSE('07/04/2020', 'dd/MM/uuuu') AS \"date\";\n+\n+   date\n+-----------\n+2020-04-07\n+// end::dateParse1\n+;\n+\n+dateParse2-Ignore\n+schema::date:date\n+// tag::timeParse3", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a802cc0406b16352c792cf08a399c4d57b0d5ab0"}, "originalPosition": 25}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "188e3760f15bdba115f9aafe5dbd475585c972f5", "author": {"user": {"login": "Patrick0308", "name": "\u767d\u6cfd"}}, "url": "https://github.com/elastic/elasticsearch/commit/188e3760f15bdba115f9aafe5dbd475585c972f5", "committedDate": "2020-06-28T06:06:57Z", "message": "modify csv"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fb9f4700fee3b67b8d484ed412dd7a01e9182e47", "author": {"user": {"login": "elasticmachine", "name": "Elastic Machine"}}, "url": "https://github.com/elastic/elasticsearch/commit/fb9f4700fee3b67b8d484ed412dd7a01e9182e47", "committedDate": "2020-06-30T10:06:46Z", "message": "Merge branch 'master' into date-parse"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "70c2d72a74ddf9d0621f8bc62d64b979383c69c5", "author": {"user": {"login": "elasticmachine", "name": "Elastic Machine"}}, "url": "https://github.com/elastic/elasticsearch/commit/70c2d72a74ddf9d0621f8bc62d64b979383c69c5", "committedDate": "2020-07-06T14:12:28Z", "message": "Merge branch 'master' into date-parse"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ3Mzk4NDMw", "url": "https://github.com/elastic/elasticsearch/pull/57391#pullrequestreview-447398430", "createdAt": "2020-07-13T16:13:52Z", "commit": {"oid": "70c2d72a74ddf9d0621f8bc62d64b979383c69c5"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ4MTI4MjYx", "url": "https://github.com/elastic/elasticsearch/pull/57391#pullrequestreview-448128261", "createdAt": "2020-07-14T13:54:05Z", "commit": {"oid": "70c2d72a74ddf9d0621f8bc62d64b979383c69c5"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNFQxMzo1NDowNVrOGxUvtw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNFQxMzo1NDowNVrOGxUvtw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDM3MzMwMw==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            If any of the two arguments is `null` or an empty string `null` is returned.\n          \n          \n            \n            If any of the two arguments is `null` or an empty string, then `null` is returned.", "url": "https://github.com/elastic/elasticsearch/pull/57391#discussion_r454373303", "createdAt": "2020-07-14T13:54:05Z", "author": {"login": "bpintea"}, "path": "docs/reference/sql/functions/date-time.asciidoc", "diffHunk": "@@ -404,6 +404,50 @@ include-tagged::{sql-specs}/docs/docs.csv-spec[dateDiffDateTimeMinutes]\n include-tagged::{sql-specs}/docs/docs.csv-spec[dateDiffDateMinutes]\n --------------------------------------------------\n \n+[[sql-functions-datetime-dateparse]]\n+==== `DATE_PARSE`\n+\n+.Synopsis:\n+[source, sql]\n+--------------------------------------------------\n+DATE_PARSE(\n+    string_exp, <1>\n+    string_exp) <2>\n+--------------------------------------------------\n+\n+*Input*:\n+\n+<1> date expression as a string\n+<2> parsing pattern\n+\n+*Output*: date\n+\n+*Description*: Returns a date by parsing the 1st argument using the format specified in the 2nd argument. The parsing\n+format pattern used is the one from\n+https://docs.oracle.com/en/java/javase/14/docs/api/java.base/java/time/format/DateTimeFormatter.html[`java.time.format.DateTimeFormatter`].\n+If any of the two arguments is `null` or an empty string `null` is returned.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "70c2d72a74ddf9d0621f8bc62d64b979383c69c5"}, "originalPosition": 25}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ4MTI4NDM1", "url": "https://github.com/elastic/elasticsearch/pull/57391#pullrequestreview-448128435", "createdAt": "2020-07-14T13:54:18Z", "commit": {"oid": "70c2d72a74ddf9d0621f8bc62d64b979383c69c5"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c6c4d6d63a79c7bc24d8b187c7b667938c7d2975", "author": {"user": {"login": "Patrick0308", "name": "\u767d\u6cfd"}}, "url": "https://github.com/elastic/elasticsearch/commit/c6c4d6d63a79c7bc24d8b187c7b667938c7d2975", "committedDate": "2020-07-15T04:38:49Z", "message": "Update docs/reference/sql/functions/date-time.asciidoc\n\nCo-authored-by: Bogdan Pintea <bpintea@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "32360629a6c91a73fd66eab9bee7a367b9c65045", "author": {"user": {"login": "elasticmachine", "name": "Elastic Machine"}}, "url": "https://github.com/elastic/elasticsearch/commit/32360629a6c91a73fd66eab9bee7a367b9c65045", "committedDate": "2020-07-16T09:09:30Z", "message": "Merge branch 'master' into date-parse"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4041, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}