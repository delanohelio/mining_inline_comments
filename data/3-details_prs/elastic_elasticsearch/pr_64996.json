{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE5ODc1MzUx", "number": 64996, "title": "Add deprecation check for Java version", "bodyText": "Supersedes PR #41092.\nAdds a deprecation check for Java version, as Java 11 will be required\nin the next version of Elasticsearch.\nRelates to #40756 and #40754.", "createdAt": "2020-11-12T13:11:50Z", "url": "https://github.com/elastic/elasticsearch/pull/64996", "merged": true, "mergeCommit": {"oid": "2d0b01294ba5190cade4fa93befd0a76027633fb"}, "closed": true, "closedAt": "2020-11-19T09:23:42Z", "author": {"login": "pugnascotia"}, "timelineItems": {"totalCount": 14, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABagkX7KAH2gAyNTE5ODc1MzUxOjk2YTI1ZDIwYzgxMmQzMzczMDUyY2FmYmM4YzE5OWUwYzUyYjBmYWE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdd7twcgFqTUzNDA4NzU5OQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "96a25d20c812d3373052cafbc8c199e0c52b0faa", "author": {"user": {"login": "gwbrown", "name": "Gordon Brown"}}, "url": "https://github.com/elastic/elasticsearch/commit/96a25d20c812d3373052cafbc8c199e0c52b0faa", "committedDate": "2019-04-10T21:12:04Z", "message": "Add deprecation check for Java version\n\nAdds a deprecation check for Java version, as Java 11 will be required\nin the next version of Elasticsearch."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "250da3e3e6e12e88aac8afb83a4bafd857069fc0", "author": {"user": {"login": "pugnascotia", "name": "Rory Hunter"}}, "url": "https://github.com/elastic/elasticsearch/commit/250da3e3e6e12e88aac8afb83a4bafd857069fc0", "committedDate": "2020-11-06T13:30:39Z", "message": "Merge remote-tracking branch 'upstream/7.x' into deprecation-check-java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2b5c1a96d00ec808ca63a155f27f24dc65f187d1", "author": {"user": {"login": "pugnascotia", "name": "Rory Hunter"}}, "url": "https://github.com/elastic/elasticsearch/commit/2b5c1a96d00ec808ca63a155f27f24dc65f187d1", "committedDate": "2020-11-12T12:51:18Z", "message": "Merge remote-tracking branch 'upstream/7.x' into deprecation-check-java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "612c511a2b80f245c626c78ed697b0ec1b990cb0", "author": {"user": {"login": "pugnascotia", "name": "Rory Hunter"}}, "url": "https://github.com/elastic/elasticsearch/commit/612c511a2b80f245c626c78ed697b0ec1b990cb0", "committedDate": "2020-11-12T13:39:52Z", "message": "Test fixes across JVM versions"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8611b507a619bb88ebb3cb306ff0dfea245c36c6", "author": {"user": {"login": "pugnascotia", "name": "Rory Hunter"}}, "url": "https://github.com/elastic/elasticsearch/commit/8611b507a619bb88ebb3cb306ff0dfea245c36c6", "committedDate": "2020-11-12T14:09:05Z", "message": "More fixes"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI5MzY4MTY2", "url": "https://github.com/elastic/elasticsearch/pull/64996#pullrequestreview-529368166", "createdAt": "2020-11-12T18:22:59Z", "commit": {"oid": "8611b507a619bb88ebb3cb306ff0dfea245c36c6"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e661070b854eddc30843867e1f1abbc794b010ae", "author": {"user": {"login": "pugnascotia", "name": "Rory Hunter"}}, "url": "https://github.com/elastic/elasticsearch/commit/e661070b854eddc30843867e1f1abbc794b010ae", "committedDate": "2020-11-16T11:51:53Z", "message": "Merge remote-tracking branch 'upstream/7.x' into deprecation-check-java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7b10767a7a2028bd9012433d1518fe4f6f41c4d2", "author": {"user": {"login": "pugnascotia", "name": "Rory Hunter"}}, "url": "https://github.com/elastic/elasticsearch/commit/7b10767a7a2028bd9012433d1518fe4f6f41c4d2", "committedDate": "2020-11-16T12:07:46Z", "message": "Disable node deprecation length checks in REST tests\n\nSome tests check the length of the `node_settings` array that comes back\nfrom the `/_migration/deprecations` API. However, the length can now\nvary depending on the JDK being used by ES, and that can't be\nrepresented in the REST tests at the moment."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMxMjYyNTcz", "url": "https://github.com/elastic/elasticsearch/pull/64996#pullrequestreview-531262573", "createdAt": "2020-11-16T12:09:59Z", "commit": {"oid": "7b10767a7a2028bd9012433d1518fe4f6f41c4d2"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNlQxMjoxMDowMFrOHz6kaw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNlQxMjoxMDowMFrOHz6kaw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDE5OTAxOQ==", "bodyText": "@rjernst can you can think of a better approach here?", "url": "https://github.com/elastic/elasticsearch/pull/64996#discussion_r524199019", "createdAt": "2020-11-16T12:10:00Z", "author": {"login": "pugnascotia"}, "path": "x-pack/plugin/src/test/resources/rest-api-spec/test/deprecation/10_basic.yml", "diffHunk": "@@ -10,7 +10,10 @@ setup:\n       migration.deprecations:\n         index: \"*\"\n   - length: { cluster_settings: 0 }\n-  - length: { node_settings: 0 }\n+  # We don't check this field because for ES <8.0 && Java < 11, a node-level deprecation warning is triggered\n+  # and it isn't easy to codify this in the REST tests without extra test infrastructure. `MigrationIT.java`\n+  # does check this, however.\n+  # - length: { node_settings: 0 }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7b10767a7a2028bd9012433d1518fe4f6f41c4d2"}, "originalPosition": 8}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMxNjMyODk5", "url": "https://github.com/elastic/elasticsearch/pull/64996#pullrequestreview-531632899", "createdAt": "2020-11-16T19:21:38Z", "commit": {"oid": "7b10767a7a2028bd9012433d1518fe4f6f41c4d2"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNlQxOToyMTozOFrOH0N3Lg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNlQxOToyNDoxNlrOH0N9Cg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDUxNTExOA==", "bodyText": "I wonder if we should first suggest using the bundled jdk?", "url": "https://github.com/elastic/elasticsearch/pull/64996#discussion_r524515118", "createdAt": "2020-11-16T19:21:38Z", "author": {"login": "rjernst"}, "path": "x-pack/plugin/deprecation/src/main/java/org/elasticsearch/xpack/deprecation/NodeDeprecationChecks.java", "diffHunk": "@@ -255,4 +256,15 @@ static DeprecationIssue checkRemovedSetting(final Settings settings, final Setti\n         return new DeprecationIssue(DeprecationIssue.Level.CRITICAL, message, url, details);\n     }\n \n+    static DeprecationIssue javaVersionCheck(Settings nodeSettings, PluginsAndModules plugins) {\n+        if (JavaVersion.current().compareTo(JavaVersion.parse(\"11\")) < 0) {\n+            return new DeprecationIssue(DeprecationIssue.Level.CRITICAL,\n+                \"Java 11 is required\",\n+                \"https://www.elastic.co/guide/en/elasticsearch/reference/master/breaking-changes-8.0.html#_java_11_is_required\",\n+                \"Java 11 will be required for future versions of Elasticsearch, this node is running version \"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7b10767a7a2028bd9012433d1518fe4f6f41c4d2"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDUxNjYxOA==", "bodyText": "I think this is fine. Thanks for the note point to MigrationIT", "url": "https://github.com/elastic/elasticsearch/pull/64996#discussion_r524516618", "createdAt": "2020-11-16T19:24:16Z", "author": {"login": "rjernst"}, "path": "x-pack/plugin/src/test/resources/rest-api-spec/test/deprecation/10_basic.yml", "diffHunk": "@@ -10,7 +10,10 @@ setup:\n       migration.deprecations:\n         index: \"*\"\n   - length: { cluster_settings: 0 }\n-  - length: { node_settings: 0 }\n+  # We don't check this field because for ES <8.0 && Java < 11, a node-level deprecation warning is triggered\n+  # and it isn't easy to codify this in the REST tests without extra test infrastructure. `MigrationIT.java`\n+  # does check this, however.\n+  # - length: { node_settings: 0 }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDE5OTAxOQ=="}, "originalCommit": {"oid": "7b10767a7a2028bd9012433d1518fe4f6f41c4d2"}, "originalPosition": 8}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "be54f00f03e8e4e420314204221af414cb25e91c", "author": {"user": {"login": "pugnascotia", "name": "Rory Hunter"}}, "url": "https://github.com/elastic/elasticsearch/commit/be54f00f03e8e4e420314204221af414cb25e91c", "committedDate": "2020-11-17T10:53:32Z", "message": "Reference bundled JDK in deprecation message"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c5e27d52c8706bbc258c009bcd5f3205c88f0255", "author": {"user": {"login": "pugnascotia", "name": "Rory Hunter"}}, "url": "https://github.com/elastic/elasticsearch/commit/c5e27d52c8706bbc258c009bcd5f3205c88f0255", "committedDate": "2020-11-17T10:58:25Z", "message": "Reference bundled JDK in other deprecation messages also"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "df2489f6d1b3fa5e3d523c47d9e21f9828629d9d", "author": {"user": {"login": "pugnascotia", "name": "Rory Hunter"}}, "url": "https://github.com/elastic/elasticsearch/commit/df2489f6d1b3fa5e3d523c47d9e21f9828629d9d", "committedDate": "2020-11-18T10:02:24Z", "message": "Expand JDK message further"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM0MDg3NTk5", "url": "https://github.com/elastic/elasticsearch/pull/64996#pullrequestreview-534087599", "createdAt": "2020-11-19T05:15:25Z", "commit": {"oid": "df2489f6d1b3fa5e3d523c47d9e21f9828629d9d"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1063, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}