{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc5NTg1MTc0", "number": 52763, "title": "[ML] Adds the class_assignment_objective parameter to classification", "bodyText": "Adds a new parameter for classification that enables choosing whether to assign labels to maximise accuracy or to maximise the minimum class recall.\n#52427.", "createdAt": "2020-02-25T13:34:19Z", "url": "https://github.com/elastic/elasticsearch/pull/52763", "merged": true, "mergeCommit": {"oid": "58340c2dbef564939b59f762eb312404bbba28b8"}, "closed": true, "closedAt": "2020-03-12T18:39:30Z", "author": {"login": "tveasey"}, "timelineItems": {"totalCount": 18, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcHxTLhgH2gAyMzc5NTg1MTc0OjBlZWUzOGIwYzZjYjlkZWM4NGE2M2RkZjg3NWNkODlkMDczODUzYzY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcM_Bn9AH2gAyMzc5NTg1MTc0OjQ3YzNmOThjODE0ODgxZWNiZTgyZjMzNzdhZWUyNzhkZDY4MDdmYTc=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "0eee38b0c6cb9dec84a63ddf875cd89d073853c6", "author": {"user": {"login": "tveasey", "name": "Tom Veasey"}}, "url": "https://github.com/elastic/elasticsearch/commit/0eee38b0c6cb9dec84a63ddf875cd89d073853c6", "committedDate": "2020-02-25T12:29:51Z", "message": "Add a new classification parameter: class assignment objective"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "edfebc27dfa95dca28110351d7e25bcaa0add610", "author": {"user": {"login": "tveasey", "name": "Tom Veasey"}}, "url": "https://github.com/elastic/elasticsearch/commit/edfebc27dfa95dca28110351d7e25bcaa0add610", "committedDate": "2020-02-26T16:17:42Z", "message": "Assorted fixes"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "63aa35d0d75b39e247fdd94e7488ab9c620b64f0", "author": {"user": {"login": "tveasey", "name": "Tom Veasey"}}, "url": "https://github.com/elastic/elasticsearch/commit/63aa35d0d75b39e247fdd94e7488ab9c620b64f0", "committedDate": "2020-02-26T12:06:37Z", "message": "Another fix"}, "afterCommit": {"oid": "edfebc27dfa95dca28110351d7e25bcaa0add610", "author": {"user": {"login": "tveasey", "name": "Tom Veasey"}}, "url": "https://github.com/elastic/elasticsearch/commit/edfebc27dfa95dca28110351d7e25bcaa0add610", "committedDate": "2020-02-26T16:17:42Z", "message": "Assorted fixes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d8c4a770263ccee17a66e38d751441ee6024a53d", "author": {"user": {"login": "tveasey", "name": "Tom Veasey"}}, "url": "https://github.com/elastic/elasticsearch/commit/d8c4a770263ccee17a66e38d751441ee6024a53d", "committedDate": "2020-02-26T20:55:10Z", "message": "Merge branch 'master' into add-class-assignment-objective"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY4NzM0Mzc4", "url": "https://github.com/elastic/elasticsearch/pull/52763#pullrequestreview-368734378", "createdAt": "2020-03-04T12:25:15Z", "commit": {"oid": "d8c4a770263ccee17a66e38d751441ee6024a53d"}, "state": "COMMENTED", "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQxMjoyODowOFrOFxrUBg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQxMjozODozNFrOFxrnaw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzYzNDE4Mg==", "bodyText": "Is there a reason for not adding it as the last param of the constructor (and possibly the members list above too)? If not, I think it'd be best to move it last as it would make it simpler for users of the client to address upon upgrading.", "url": "https://github.com/elastic/elasticsearch/pull/52763#discussion_r387634182", "createdAt": "2020-03-04T12:28:08Z", "author": {"login": "dimitris-athanasiou"}, "path": "client/rest-high-level/src/main/java/org/elasticsearch/client/ml/dataframe/Classification.java", "diffHunk": "@@ -92,13 +102,15 @@ public static Builder builder(String dependentVariable) {\n     private final Integer numTopFeatureImportanceValues;\n     private final String predictionFieldName;\n     private final Double trainingPercent;\n+    private final ClassAssignmentObjective classAssignmentObjective;\n     private final Integer numTopClasses;\n     private final Long randomizeSeed;\n \n     private Classification(String dependentVariable, @Nullable Double lambda, @Nullable Double gamma, @Nullable Double eta,\n                            @Nullable Integer maximumNumberTrees, @Nullable Double featureBagFraction,\n                            @Nullable Integer numTopFeatureImportanceValues, @Nullable String predictionFieldName,\n-                           @Nullable Double trainingPercent, @Nullable Integer numTopClasses, @Nullable Long randomizeSeed) {\n+                           @Nullable Double trainingPercent, @Nullable ClassAssignmentObjective classAssignmentObjective,\n+                           @Nullable Integer numTopClasses, @Nullable Long randomizeSeed) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d8c4a770263ccee17a66e38d751441ee6024a53d"}, "originalPosition": 59}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzYzNjg4MA==", "bodyText": "Do we need the qualification here?", "url": "https://github.com/elastic/elasticsearch/pull/52763#discussion_r387636880", "createdAt": "2020-03-04T12:33:48Z", "author": {"login": "dimitris-athanasiou"}, "path": "client/rest-high-level/src/test/java/org/elasticsearch/client/MachineLearningIT.java", "diffHunk": "@@ -1336,6 +1336,8 @@ public void testPutDataFrameAnalyticsConfig_GivenClassification() throws Excepti\n                 .setPredictionFieldName(\"my_dependent_variable_prediction\")\n                 .setTrainingPercent(80.0)\n                 .setRandomizeSeed(42L)\n+                .setClassAssignmentObjective(\n+                    org.elasticsearch.client.ml.dataframe.Classification.ClassAssignmentObjective.MAXIMIZE_ACCURACY)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d8c4a770263ccee17a66e38d751441ee6024a53d"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzYzNzYwNA==", "bodyText": "Could we wrap the enum values in \"`\" here?", "url": "https://github.com/elastic/elasticsearch/pull/52763#discussion_r387637604", "createdAt": "2020-03-04T12:35:23Z", "author": {"login": "dimitris-athanasiou"}, "path": "docs/reference/ml/ml-shared.asciidoc", "diffHunk": "@@ -284,6 +283,14 @@ include::{docdir}/ml/ml-shared.asciidoc[tag=mode]\n include::{docdir}/ml/ml-shared.asciidoc[tag=time-span]\n end::chunking-config[]\n \n+tag::class-assignment-objective[]\n+Defines the objective to optimize when assigning class labels. Available\n+objectives are maximize_accuracy and maximize_minimum_recall. When maximizing", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d8c4a770263ccee17a66e38d751441ee6024a53d"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzYzODE1NA==", "bodyText": "I think we have to go with chosen", "url": "https://github.com/elastic/elasticsearch/pull/52763#discussion_r387638154", "createdAt": "2020-03-04T12:36:36Z", "author": {"login": "dimitris-athanasiou"}, "path": "docs/reference/ml/ml-shared.asciidoc", "diffHunk": "@@ -284,6 +283,14 @@ include::{docdir}/ml/ml-shared.asciidoc[tag=mode]\n include::{docdir}/ml/ml-shared.asciidoc[tag=time-span]\n end::chunking-config[]\n \n+tag::class-assignment-objective[]\n+Defines the objective to optimize when assigning class labels. Available\n+objectives are maximize_accuracy and maximize_minimum_recall. When maximizing\n+accuracy class labels are choosen to maximize the number of correct predictions.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d8c4a770263ccee17a66e38d751441ee6024a53d"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzYzODQ5OQ==", "bodyText": "ditto", "url": "https://github.com/elastic/elasticsearch/pull/52763#discussion_r387638499", "createdAt": "2020-03-04T12:37:11Z", "author": {"login": "dimitris-athanasiou"}, "path": "docs/reference/ml/ml-shared.asciidoc", "diffHunk": "@@ -284,6 +283,14 @@ include::{docdir}/ml/ml-shared.asciidoc[tag=mode]\n include::{docdir}/ml/ml-shared.asciidoc[tag=time-span]\n end::chunking-config[]\n \n+tag::class-assignment-objective[]\n+Defines the objective to optimize when assigning class labels. Available\n+objectives are maximize_accuracy and maximize_minimum_recall. When maximizing\n+accuracy class labels are choosen to maximize the number of correct predictions.\n+When maximizing minimum recall labels are choosen to maximize the minimum recall", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d8c4a770263ccee17a66e38d751441ee6024a53d"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzYzOTE0Nw==", "bodyText": "Both this and the one in the write function will have to be changed to version 8.0.0 initially. We'll change them back to 7.7.0 after backporting to the 7.x branch.", "url": "https://github.com/elastic/elasticsearch/pull/52763#discussion_r387639147", "createdAt": "2020-03-04T12:38:34Z", "author": {"login": "dimitris-athanasiou"}, "path": "x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/ml/dataframe/analyses/Classification.java", "diffHunk": "@@ -108,19 +120,26 @@ public Classification(String dependentVariable,\n         this.dependentVariable = ExceptionsHelper.requireNonNull(dependentVariable, DEPENDENT_VARIABLE);\n         this.boostedTreeParams = ExceptionsHelper.requireNonNull(boostedTreeParams, BoostedTreeParams.NAME);\n         this.predictionFieldName = predictionFieldName == null ? dependentVariable + \"_prediction\" : predictionFieldName;\n+        this.classAssignmentObjective = classAssignmentObjective == null ?\n+            ClassAssignmentObjective.MAXIMIZE_MINIMUM_RECALL : classAssignmentObjective;\n         this.numTopClasses = numTopClasses == null ? DEFAULT_NUM_TOP_CLASSES : numTopClasses;\n         this.trainingPercent = trainingPercent == null ? 100.0 : trainingPercent;\n         this.randomizeSeed = randomizeSeed == null ? Randomness.get().nextLong() : randomizeSeed;\n     }\n \n     public Classification(String dependentVariable) {\n-        this(dependentVariable, BoostedTreeParams.builder().build(), null, null, null, null);\n+        this(dependentVariable, BoostedTreeParams.builder().build(), null, null, null, null, null);\n     }\n \n     public Classification(StreamInput in) throws IOException {\n         dependentVariable = in.readString();\n         boostedTreeParams = new BoostedTreeParams(in);\n         predictionFieldName = in.readOptionalString();\n+        if (in.getVersion().onOrAfter(Version.V_7_7_0)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d8c4a770263ccee17a66e38d751441ee6024a53d"}, "originalPosition": 83}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "beaf0604114c81529211a72de5db637510661438", "author": {"user": {"login": "tveasey", "name": "Tom Veasey"}}, "url": "https://github.com/elastic/elasticsearch/commit/beaf0604114c81529211a72de5db637510661438", "committedDate": "2020-03-04T14:21:50Z", "message": "Typo"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d635bde1762e1cbff76d1a95dd168b26807f10b0", "author": {"user": {"login": "tveasey", "name": "Tom Veasey"}}, "url": "https://github.com/elastic/elasticsearch/commit/d635bde1762e1cbff76d1a95dd168b26807f10b0", "committedDate": "2020-03-04T14:22:06Z", "message": "Backwards compatibility tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ed57848ff489345e4ab23d38fb1ed65f13e5c767", "author": {"user": {"login": "tveasey", "name": "Tom Veasey"}}, "url": "https://github.com/elastic/elasticsearch/commit/ed57848ff489345e4ab23d38fb1ed65f13e5c767", "committedDate": "2020-03-04T14:22:46Z", "message": "Merge branch 'master' into add-class-assignment-objective"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "854fdf734bb5841364b098c79fb9a44e1b26e2eb", "author": {"user": {"login": "tveasey", "name": "Tom Veasey"}}, "url": "https://github.com/elastic/elasticsearch/commit/854fdf734bb5841364b098c79fb9a44e1b26e2eb", "committedDate": "2020-03-04T14:25:21Z", "message": "Quotes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4e0ded77b33c9699553bc1a6e5df1216433fc3a0", "author": {"user": {"login": "tveasey", "name": "Tom Veasey"}}, "url": "https://github.com/elastic/elasticsearch/commit/4e0ded77b33c9699553bc1a6e5df1216433fc3a0", "committedDate": "2020-03-04T15:47:04Z", "message": "Move new parameter to end of constructor"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a1b5e2b90b30d20cebbf9febe8a78be8f73e9404", "author": {"user": {"login": "tveasey", "name": "Tom Veasey"}}, "url": "https://github.com/elastic/elasticsearch/commit/a1b5e2b90b30d20cebbf9febe8a78be8f73e9404", "committedDate": "2020-03-04T15:52:06Z", "message": "Only in version 8.0 at present"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ed56c5058993cffd893f0adc3ed512649eac62e1", "author": {"user": {"login": "tveasey", "name": "Tom Veasey"}}, "url": "https://github.com/elastic/elasticsearch/commit/ed56c5058993cffd893f0adc3ed512649eac62e1", "committedDate": "2020-03-05T11:00:03Z", "message": "Correct order in which fields are added to the parser"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "08b2614ab1de436766f7d7717a4b43d68d799e62", "author": {"user": {"login": "tveasey", "name": "Tom Veasey"}}, "url": "https://github.com/elastic/elasticsearch/commit/08b2614ab1de436766f7d7717a4b43d68d799e62", "committedDate": "2020-03-05T11:09:48Z", "message": "Missing setup in bwc tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "60189eeb9a3474d9ce90f9957ffb4a96863fff39", "author": {"user": {"login": "tveasey", "name": "Tom Veasey"}}, "url": "https://github.com/elastic/elasticsearch/commit/60189eeb9a3474d9ce90f9957ffb4a96863fff39", "committedDate": "2020-03-05T12:44:08Z", "message": "Always write to JSON"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b4aed75bf28324d8270cb1dd82bd689c60ab3701", "author": {"user": {"login": "tveasey", "name": "Tom Veasey"}}, "url": "https://github.com/elastic/elasticsearch/commit/b4aed75bf28324d8270cb1dd82bd689c60ab3701", "committedDate": "2020-03-05T16:15:04Z", "message": "Merge branch 'master' into add-class-assignment-objective"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4dfefc485287ac24ad2def60660d996b008ec057", "author": {"user": {"login": "tveasey", "name": "Tom Veasey"}}, "url": "https://github.com/elastic/elasticsearch/commit/4dfefc485287ac24ad2def60660d996b008ec057", "committedDate": "2020-03-12T14:31:03Z", "message": "Merge branch 'master' into add-class-assignment-objective"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzczNjM4OTQz", "url": "https://github.com/elastic/elasticsearch/pull/52763#pullrequestreview-373638943", "createdAt": "2020-03-12T15:05:27Z", "commit": {"oid": "4dfefc485287ac24ad2def60660d996b008ec057"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "47c3f98c814881ecbe82f3377aee278dd6807fa7", "author": {"user": {"login": "tveasey", "name": "Tom Veasey"}}, "url": "https://github.com/elastic/elasticsearch/commit/47c3f98c814881ecbe82f3377aee278dd6807fa7", "committedDate": "2020-03-12T17:18:58Z", "message": "Test fix"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2146, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}