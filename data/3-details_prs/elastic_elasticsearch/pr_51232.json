{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY0OTI5Mzg2", "number": 51232, "title": "[ML] Validate classification dependent_variable cardinality is at lea\u2026", "bodyText": "\u2026st two\nData frame analytics classification currently only supports 2 classes for the\ndependent variable. We were checking that the field's cardinality is not higher\nthan 2 but we should also check it is not less than that as otherwise the process\nfails.", "createdAt": "2020-01-20T16:59:37Z", "url": "https://github.com/elastic/elasticsearch/pull/51232", "merged": true, "mergeCommit": {"oid": "a6fa577b85371f47f16e8888865abf5511bb8a92"}, "closed": true, "closedAt": "2020-01-22T13:47:08Z", "author": {"login": "dimitris-athanasiou"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb8P474gFqTM0NTQ0ODUyMg==", "endCursor": "Y3Vyc29yOnYyOpPPAAABb80jhhgH2gAyMzY0OTI5Mzg2OmVhYjg1ZDVmNDU1Yjg2YWU3YzJkMjYyOGFiM2NjYzA2MGQ2ODQ5MGE=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ1NDQ4NTIy", "url": "https://github.com/elastic/elasticsearch/pull/51232#pullrequestreview-345448522", "createdAt": "2020-01-20T17:16:01Z", "commit": {"oid": "017be7852fb418eae981d8f3556df7e587277eab"}, "state": "APPROVED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMFQxNzoxNjowMlrOFflCxQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMFQxNzoxOTowOVrOFflHRw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODY1NzA5Mw==", "bodyText": "s/limits/constraints\n?", "url": "https://github.com/elastic/elasticsearch/pull/51232#discussion_r368657093", "createdAt": "2020-01-20T17:16:02Z", "author": {"login": "przemekwitek"}, "path": "x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/ml/dataframe/analyses/DataFrameAnalysis.java", "diffHunk": "@@ -37,9 +37,9 @@\n     List<RequiredField> getRequiredFields();\n \n     /**\n-     * @return {@link Map} containing cardinality limits for the selected (analysis-specific) fields\n+     * @return {@link List} containing cardinality limits for the selected (analysis-specific) fields", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "017be7852fb418eae981d8f3556df7e587277eab"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODY1NzIwMg==", "bodyText": "s/Limits/Constraints\n?", "url": "https://github.com/elastic/elasticsearch/pull/51232#discussion_r368657202", "createdAt": "2020-01-20T17:16:19Z", "author": {"login": "przemekwitek"}, "path": "x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/ml/dataframe/analyses/DataFrameAnalysis.java", "diffHunk": "@@ -37,9 +37,9 @@\n     List<RequiredField> getRequiredFields();\n \n     /**\n-     * @return {@link Map} containing cardinality limits for the selected (analysis-specific) fields\n+     * @return {@link List} containing cardinality limits for the selected (analysis-specific) fields\n      */\n-    Map<String, Long> getFieldCardinalityLimits();\n+    List<FieldCardinalityConstraint> getFieldCardinalityLimits();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "017be7852fb418eae981d8f3556df7e587277eab"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODY1ODIxMQ==", "bodyText": "There is a \"Matchers.empty()\" matcher that could be used here.", "url": "https://github.com/elastic/elasticsearch/pull/51232#discussion_r368658211", "createdAt": "2020-01-20T17:19:03Z", "author": {"login": "przemekwitek"}, "path": "x-pack/plugin/core/src/test/java/org/elasticsearch/xpack/core/ml/dataframe/analyses/OutlierDetectionTests.java", "diffHunk": "@@ -89,7 +89,7 @@ public void testRequiredFieldsIsEmpty() {\n     }\n \n     public void testFieldCardinalityLimitsIsEmpty() {\n-        assertThat(createTestInstance().getFieldCardinalityLimits(), is(anEmptyMap()));\n+        assertThat(createTestInstance().getFieldCardinalityLimits().isEmpty(), is(true));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "017be7852fb418eae981d8f3556df7e587277eab"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODY1ODI0Nw==", "bodyText": "There is a \"Matchers.empty()\" matcher that could be used here.", "url": "https://github.com/elastic/elasticsearch/pull/51232#discussion_r368658247", "createdAt": "2020-01-20T17:19:09Z", "author": {"login": "przemekwitek"}, "path": "x-pack/plugin/core/src/test/java/org/elasticsearch/xpack/core/ml/dataframe/analyses/RegressionTests.java", "diffHunk": "@@ -106,7 +106,7 @@ public void testRequiredFieldsIsNonEmpty() {\n     }\n \n     public void testFieldCardinalityLimitsIsEmpty() {\n-        assertThat(createTestInstance().getFieldCardinalityLimits(), is(anEmptyMap()));\n+        assertThat(createTestInstance().getFieldCardinalityLimits().isEmpty(), is(true));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "017be7852fb418eae981d8f3556df7e587277eab"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ1OTU1OTM4", "url": "https://github.com/elastic/elasticsearch/pull/51232#pullrequestreview-345955938", "createdAt": "2020-01-21T15:16:33Z", "commit": {"oid": "f96b35073794e10e5a36718c3367ff48fc330392"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMVQxNToxNjozM1rOFf9tsA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMVQxNToxNjozM1rOFf9tsA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTA2MTI5Ng==", "bodyText": "Note that this is now necessary as we are checking the field cardinality before we call startAnalytics which refreshes the dest index.", "url": "https://github.com/elastic/elasticsearch/pull/51232#discussion_r369061296", "createdAt": "2020-01-21T15:16:33Z", "author": {"login": "dimitris-athanasiou"}, "path": "x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/dataframe/DataFrameAnalyticsManager.java", "diffHunk": "@@ -177,6 +177,7 @@ private void reindexDataframeAndStartAnalysis(DataFrameAnalyticsTask task, DataF\n         ActionListener<CreateIndexResponse> copyIndexCreatedListener = ActionListener.wrap(\n             createIndexResponse -> {\n                 ReindexRequest reindexRequest = new ReindexRequest();\n+                reindexRequest.setRefresh(true);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f96b35073794e10e5a36718c3367ff48fc330392"}, "originalPosition": 13}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ1OTY3OTI1", "url": "https://github.com/elastic/elasticsearch/pull/51232#pullrequestreview-345967925", "createdAt": "2020-01-21T15:30:52Z", "commit": {"oid": "f96b35073794e10e5a36718c3367ff48fc330392"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMVQxNTozMDo1MlrOFf-Q_w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMVQxNTozMDo1MlrOFf-Q_w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTA3MDMzNQ==", "bodyText": "Should this be reverted?", "url": "https://github.com/elastic/elasticsearch/pull/51232#discussion_r369070335", "createdAt": "2020-01-21T15:30:52Z", "author": {"login": "przemekwitek"}, "path": "x-pack/plugin/ml/qa/native-multi-node-tests/src/test/java/org/elasticsearch/xpack/ml/integration/ClassificationIT.java", "diffHunk": "@@ -492,7 +492,7 @@ private void initialize(String jobId) {\n         this.jobId = jobId;\n         this.sourceIndex = jobId + \"_source_index\";\n         this.destIndex = sourceIndex + \"_results\";\n-        this.analysisUsesExistingDestIndex = randomBoolean();\n+        this.analysisUsesExistingDestIndex = false;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f96b35073794e10e5a36718c3367ff48fc330392"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "607fbc41c11d5bb08e471f09918d78f0de1d045d", "author": {"user": {"login": "dimitris-athanasiou", "name": "Dimitris Athanasiou"}}, "url": "https://github.com/elastic/elasticsearch/commit/607fbc41c11d5bb08e471f09918d78f0de1d045d", "committedDate": "2020-01-22T11:43:53Z", "message": "[ML] Validate classification dependent_variable cardinality is at least two\n\nData frame analytics classification currently only supports 2 classes for the\ndependent variable. We were checking that the field's cardinality is not higher\nthan 2 but we should also check it is not less than that as otherwise the process\nfails."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "de2c194024674ffb7fbce651fc706c99f0882067", "author": {"user": {"login": "dimitris-athanasiou", "name": "Dimitris Athanasiou"}}, "url": "https://github.com/elastic/elasticsearch/commit/de2c194024674ffb7fbce651fc706c99f0882067", "committedDate": "2020-01-22T11:43:54Z", "message": "Address review comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b197ed888e06048389f2c6980e9e227947a5eb17", "author": {"user": {"login": "dimitris-athanasiou", "name": "Dimitris Athanasiou"}}, "url": "https://github.com/elastic/elasticsearch/commit/b197ed888e06048389f2c6980e9e227947a5eb17", "committedDate": "2020-01-22T11:43:54Z", "message": "Revert accidental change in test and fix another test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "283c012fc70a60128bb889aa7ae8bf8efa9eda79", "author": {"user": {"login": "dimitris-athanasiou", "name": "Dimitris Athanasiou"}}, "url": "https://github.com/elastic/elasticsearch/commit/283c012fc70a60128bb889aa7ae8bf8efa9eda79", "committedDate": "2020-01-22T11:43:54Z", "message": "Refresh dest before detected extracted fields"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e51393e052903927b777eb5dfc094330adb2ac1d", "author": {"user": {"login": "dimitris-athanasiou", "name": "Dimitris Athanasiou"}}, "url": "https://github.com/elastic/elasticsearch/commit/e51393e052903927b777eb5dfc094330adb2ac1d", "committedDate": "2020-01-22T11:40:05Z", "message": "Refresh dest before detected extracted fields"}, "afterCommit": {"oid": "eab85d5f455b86ae7c2d2628ab3ccc060d68490a", "author": {"user": {"login": "dimitris-athanasiou", "name": "Dimitris Athanasiou"}}, "url": "https://github.com/elastic/elasticsearch/commit/eab85d5f455b86ae7c2d2628ab3ccc060d68490a", "committedDate": "2020-01-22T12:04:15Z", "message": "Remove unused imports after rebase"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "eab85d5f455b86ae7c2d2628ab3ccc060d68490a", "author": {"user": {"login": "dimitris-athanasiou", "name": "Dimitris Athanasiou"}}, "url": "https://github.com/elastic/elasticsearch/commit/eab85d5f455b86ae7c2d2628ab3ccc060d68490a", "committedDate": "2020-01-22T12:04:15Z", "message": "Remove unused imports after rebase"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3053, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}