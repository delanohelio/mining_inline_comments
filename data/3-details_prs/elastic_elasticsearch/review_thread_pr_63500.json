{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTAwMDM4ODEy", "number": 63500, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOFQyMTo1NzowMFrOErzfxQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOFQyMTo1Nzo0NFrOErzgeg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE0MzY3OTQxOnYy", "diffSide": "RIGHT", "path": "qa/os/src/test/java/org/elasticsearch/packaging/test/ConfigurationTests.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOFQyMTo1NzowMFrOHexzkw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xM1QxMzoxMDowOFrOHgl2bQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjAzNTM0Nw==", "bodyText": "I don't think install should be in a Before. This means we would reinstall before each test, which is costly. The packaging tests are generally written to cleanup after themselves, so deleting the installation should not be necessary?", "url": "https://github.com/elastic/elasticsearch/pull/63500#discussion_r502035347", "createdAt": "2020-10-08T21:57:00Z", "author": {"login": "rjernst"}, "path": "qa/os/src/test/java/org/elasticsearch/packaging/test/ConfigurationTests.java", "diffHunk": "@@ -22,22 +22,44 @@\n import org.apache.http.client.fluent.Request;\n import org.elasticsearch.packaging.util.FileUtils;\n import org.elasticsearch.packaging.util.Platforms;\n+import org.junit.After;\n import org.junit.Before;\n \n+import java.nio.file.Files;\n+import java.util.List;\n+\n+import static java.nio.file.StandardOpenOption.APPEND;\n+import static java.nio.file.StandardOpenOption.CREATE;\n import static org.elasticsearch.packaging.util.FileUtils.append;\n import static org.elasticsearch.packaging.util.ServerUtils.makeRequest;\n+import static org.hamcrest.CoreMatchers.containsString;\n import static org.hamcrest.Matchers.equalTo;\n import static org.junit.Assume.assumeFalse;\n \n public class ConfigurationTests extends PackagingTestCase {\n \n     @Before\n-    public void filterDistros() {\n+    public void filterDistrosAndInstall() throws Exception {\n         assumeFalse(\"no docker\", distribution.isDocker());\n+        install();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "263dc7c01571640a85216912713629aee1fc7552"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzQ3MjgzNA==", "bodyText": "I'm getting errors when I don't reinstall. I'll dig on it.", "url": "https://github.com/elastic/elasticsearch/pull/63500#discussion_r503472834", "createdAt": "2020-10-12T18:45:55Z", "author": {"login": "williamrandolph"}, "path": "qa/os/src/test/java/org/elasticsearch/packaging/test/ConfigurationTests.java", "diffHunk": "@@ -22,22 +22,44 @@\n import org.apache.http.client.fluent.Request;\n import org.elasticsearch.packaging.util.FileUtils;\n import org.elasticsearch.packaging.util.Platforms;\n+import org.junit.After;\n import org.junit.Before;\n \n+import java.nio.file.Files;\n+import java.util.List;\n+\n+import static java.nio.file.StandardOpenOption.APPEND;\n+import static java.nio.file.StandardOpenOption.CREATE;\n import static org.elasticsearch.packaging.util.FileUtils.append;\n import static org.elasticsearch.packaging.util.ServerUtils.makeRequest;\n+import static org.hamcrest.CoreMatchers.containsString;\n import static org.hamcrest.Matchers.equalTo;\n import static org.junit.Assume.assumeFalse;\n \n public class ConfigurationTests extends PackagingTestCase {\n \n     @Before\n-    public void filterDistros() {\n+    public void filterDistrosAndInstall() throws Exception {\n         assumeFalse(\"no docker\", distribution.isDocker());\n+        install();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjAzNTM0Nw=="}, "originalCommit": {"oid": "263dc7c01571640a85216912713629aee1fc7552"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzkzNjYyMQ==", "bodyText": "I found the problem. I am going to fix it in a different PR because it's unrelated to this ticket and it ought to be fixed on master as well.", "url": "https://github.com/elastic/elasticsearch/pull/63500#discussion_r503936621", "createdAt": "2020-10-13T13:10:08Z", "author": {"login": "williamrandolph"}, "path": "qa/os/src/test/java/org/elasticsearch/packaging/test/ConfigurationTests.java", "diffHunk": "@@ -22,22 +22,44 @@\n import org.apache.http.client.fluent.Request;\n import org.elasticsearch.packaging.util.FileUtils;\n import org.elasticsearch.packaging.util.Platforms;\n+import org.junit.After;\n import org.junit.Before;\n \n+import java.nio.file.Files;\n+import java.util.List;\n+\n+import static java.nio.file.StandardOpenOption.APPEND;\n+import static java.nio.file.StandardOpenOption.CREATE;\n import static org.elasticsearch.packaging.util.FileUtils.append;\n import static org.elasticsearch.packaging.util.ServerUtils.makeRequest;\n+import static org.hamcrest.CoreMatchers.containsString;\n import static org.hamcrest.Matchers.equalTo;\n import static org.junit.Assume.assumeFalse;\n \n public class ConfigurationTests extends PackagingTestCase {\n \n     @Before\n-    public void filterDistros() {\n+    public void filterDistrosAndInstall() throws Exception {\n         assumeFalse(\"no docker\", distribution.isDocker());\n+        install();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjAzNTM0Nw=="}, "originalCommit": {"oid": "263dc7c01571640a85216912713629aee1fc7552"}, "originalPosition": 24}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE0MzY4MTIyOnYy", "diffSide": "RIGHT", "path": "server/src/main/java/org/elasticsearch/bootstrap/Bootstrap.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOFQyMTo1Nzo0NFrOHex0qA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xMlQxODo0NToxOVrOHgJhyw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjAzNTYyNA==", "bodyText": "Why using System.getProperty here, but BootstrapInfo above?", "url": "https://github.com/elastic/elasticsearch/pull/63500#discussion_r502035624", "createdAt": "2020-10-08T21:57:44Z", "author": {"login": "rjernst"}, "path": "server/src/main/java/org/elasticsearch/bootstrap/Bootstrap.java", "diffHunk": "@@ -363,6 +363,14 @@ static void init(\n                             System.getProperty(\"java.home\"));\n             DeprecationLogger.getLogger(Bootstrap.class).deprecate(\"java_version_11_required\", message);\n         }\n+        if (BootstrapInfo.getSystemProperties().get(\"es.xcontent.strict_duplicate_detection\") != null) {\n+            final String message = String.format(\n+                Locale.ROOT,\n+                \"The Java option es.xcontent.strict_duplicate_detection is set to [%s]; \" +\n+                    \"this option is deprecated and non-functional and should be removed from Java configuration.\",\n+                System.getProperty(\"es.xcontent.strict_duplicate_detection\"));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "263dc7c01571640a85216912713629aee1fc7552"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzQ3MjU4Nw==", "bodyText": "Good catch. Initially I used System.getProperty in both places, but the Forbidden APIs check only caught the use in the conditional. I'll make it consistent.", "url": "https://github.com/elastic/elasticsearch/pull/63500#discussion_r503472587", "createdAt": "2020-10-12T18:45:19Z", "author": {"login": "williamrandolph"}, "path": "server/src/main/java/org/elasticsearch/bootstrap/Bootstrap.java", "diffHunk": "@@ -363,6 +363,14 @@ static void init(\n                             System.getProperty(\"java.home\"));\n             DeprecationLogger.getLogger(Bootstrap.class).deprecate(\"java_version_11_required\", message);\n         }\n+        if (BootstrapInfo.getSystemProperties().get(\"es.xcontent.strict_duplicate_detection\") != null) {\n+            final String message = String.format(\n+                Locale.ROOT,\n+                \"The Java option es.xcontent.strict_duplicate_detection is set to [%s]; \" +\n+                    \"this option is deprecated and non-functional and should be removed from Java configuration.\",\n+                System.getProperty(\"es.xcontent.strict_duplicate_detection\"));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjAzNTYyNA=="}, "originalCommit": {"oid": "263dc7c01571640a85216912713629aee1fc7552"}, "originalPosition": 9}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3068, "cost": 1, "resetAt": "2021-11-12T11:57:46Z"}}}