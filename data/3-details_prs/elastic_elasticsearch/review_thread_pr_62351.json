{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDg3MDA4Mzgx", "number": 62351, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNVQxNzo1Mjo0MFrOEjtI7g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQwNToyMToyN1rOEj5EqQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA1ODc1MTgyOnYy", "diffSide": "RIGHT", "path": "x-pack/docs/en/rest-api/security/create-api-keys.asciidoc", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNVQxNzo1Mjo0MFrOHSNetQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQxODo1Mzo1N1rOHS-5xg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODg1NzI2OQ==", "bodyText": "Does the API return an error if you try to create a derived key with privileges? Maybe it's clearer to say something like this:\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            an API key, then the derived API key that is created cannot have any privileges.\n          \n          \n            \n            an API key, the derived API key cannot have any privileges. If you specify privileges, the API returns an error.", "url": "https://github.com/elastic/elasticsearch/pull/62351#discussion_r488857269", "createdAt": "2020-09-15T17:52:40Z", "author": {"login": "lcawl"}, "path": "x-pack/docs/en/rest-api/security/create-api-keys.asciidoc", "diffHunk": "@@ -19,6 +19,10 @@ Creates an API key for access without requiring basic authentication.\n \n * To use this API, you must have at least the `manage_api_key` cluster privilege.\n \n+IMPORTANT: If the credential that is used to authenticate this request is\n+an API key, then the derived API key that is created cannot have any privileges.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "238a459b77a72da5c00bf0148aad8a02db8d0f2f"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTE2ODM2OQ==", "bodyText": "I like calling out explicity that an error will be generated if privileges are specified for the derived key. So let's add that sentence.\nBut for the sentence precedes it, I prefer Tim's version better because the phrase of \"the result is ...\" somehow feels like we would internally discard any privileges specified for the derived key and \"the result is no privilge\", which I personally feels a bit confusing when read together with \"If you specify ...\".", "url": "https://github.com/elastic/elasticsearch/pull/62351#discussion_r489168369", "createdAt": "2020-09-16T05:17:20Z", "author": {"login": "ywangd"}, "path": "x-pack/docs/en/rest-api/security/create-api-keys.asciidoc", "diffHunk": "@@ -19,6 +19,10 @@ Creates an API key for access without requiring basic authentication.\n \n * To use this API, you must have at least the `manage_api_key` cluster privilege.\n \n+IMPORTANT: If the credential that is used to authenticate this request is\n+an API key, then the derived API key that is created cannot have any privileges.", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODg1NzI2OQ=="}, "originalCommit": {"oid": "238a459b77a72da5c00bf0148aad8a02db8d0f2f"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTY2NzAxNA==", "bodyText": "@ywangd I've altered my suggestion to try to address your comments.", "url": "https://github.com/elastic/elasticsearch/pull/62351#discussion_r489667014", "createdAt": "2020-09-16T18:53:57Z", "author": {"login": "lcawl"}, "path": "x-pack/docs/en/rest-api/security/create-api-keys.asciidoc", "diffHunk": "@@ -19,6 +19,10 @@ Creates an API key for access without requiring basic authentication.\n \n * To use this API, you must have at least the `manage_api_key` cluster privilege.\n \n+IMPORTANT: If the credential that is used to authenticate this request is\n+an API key, then the derived API key that is created cannot have any privileges.", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODg1NzI2OQ=="}, "originalCommit": {"oid": "238a459b77a72da5c00bf0148aad8a02db8d0f2f"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA1ODc2Mzk4OnYy", "diffSide": "RIGHT", "path": "x-pack/docs/en/rest-api/security/create-api-keys.asciidoc", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNVQxNzo1NjowNFrOHSNmZw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNVQxNzo1NjowNFrOHSNmZw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODg1OTIzOQ==", "bodyText": "Not mandatory, but I think this could be split into two sentences.\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            role descriptor with no privileges, and the derived API key can be used for\n          \n          \n            \n            role descriptor with no privileges. The derived API key can be used for", "url": "https://github.com/elastic/elasticsearch/pull/62351#discussion_r488859239", "createdAt": "2020-09-15T17:56:04Z", "author": {"login": "lcawl"}, "path": "x-pack/docs/en/rest-api/security/create-api-keys.asciidoc", "diffHunk": "@@ -57,6 +61,12 @@ thereby limiting the access scope for API keys.\n The structure of role descriptor is the same as the request for create role API.\n For more details, see <<security-api-put-role, create or update roles API>>.\n \n+NOTE: Due to the way in which this permission intersection is calculated, it is not\n+possible to create an API key that is a child of another API key, unless the derived\n+key is created without any privileges. In this case, you must explicitly specify a\n+role descriptor with no privileges, and the derived API key can be used for", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "238a459b77a72da5c00bf0148aad8a02db8d0f2f"}, "originalPosition": 18}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA1ODc3MTA2OnYy", "diffSide": "RIGHT", "path": "x-pack/docs/en/rest-api/security/create-api-keys.asciidoc", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNVQxNzo1ODoxM1rOHSNrEQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQxODo1NToxMFrOHS--yg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODg2MDQzMw==", "bodyText": "I think \"but\" should be removed here. Should \"access\" also be changed to \"authority\"?\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            authentication only, but will not have access to call {es} APIs.\n          \n          \n            \n            authentication; it will not have authority to call {es} APIs.", "url": "https://github.com/elastic/elasticsearch/pull/62351#discussion_r488860433", "createdAt": "2020-09-15T17:58:13Z", "author": {"login": "lcawl"}, "path": "x-pack/docs/en/rest-api/security/create-api-keys.asciidoc", "diffHunk": "@@ -57,6 +61,12 @@ thereby limiting the access scope for API keys.\n The structure of role descriptor is the same as the request for create role API.\n For more details, see <<security-api-put-role, create or update roles API>>.\n \n+NOTE: Due to the way in which this permission intersection is calculated, it is not\n+possible to create an API key that is a child of another API key, unless the derived\n+key is created without any privileges. In this case, you must explicitly specify a\n+role descriptor with no privileges, and the derived API key can be used for\n+authentication only, but will not have access to call {es} APIs.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "238a459b77a72da5c00bf0148aad8a02db8d0f2f"}, "originalPosition": 19}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTY2ODI5OA==", "bodyText": "Without complicating things too much by explaining all the details, maybe we could just drop the only bit.\n\nI've made that change in my suggestion, thanks!", "url": "https://github.com/elastic/elasticsearch/pull/62351#discussion_r489668298", "createdAt": "2020-09-16T18:55:10Z", "author": {"login": "lcawl"}, "path": "x-pack/docs/en/rest-api/security/create-api-keys.asciidoc", "diffHunk": "@@ -57,6 +61,12 @@ thereby limiting the access scope for API keys.\n The structure of role descriptor is the same as the request for create role API.\n For more details, see <<security-api-put-role, create or update roles API>>.\n \n+NOTE: Due to the way in which this permission intersection is calculated, it is not\n+possible to create an API key that is a child of another API key, unless the derived\n+key is created without any privileges. In this case, you must explicitly specify a\n+role descriptor with no privileges, and the derived API key can be used for\n+authentication only, but will not have access to call {es} APIs.", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODg2MDQzMw=="}, "originalCommit": {"oid": "238a459b77a72da5c00bf0148aad8a02db8d0f2f"}, "originalPosition": 19}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA2MDcwNjk3OnYy", "diffSide": "RIGHT", "path": "x-pack/docs/en/rest-api/security/create-api-keys.asciidoc", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQwNToyMToyN1rOHSgilg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQwNToyMToyN1rOHSgilg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTE2OTU1OA==", "bodyText": "Technically, it is not \"only\" the authentication, but a few actions that requires \"the same user\", e.g. it can also call GET _security/api_key?owner=true. Without complicating things too much by explaining all the details, maybe we could just drop the only bit.", "url": "https://github.com/elastic/elasticsearch/pull/62351#discussion_r489169558", "createdAt": "2020-09-16T05:21:27Z", "author": {"login": "ywangd"}, "path": "x-pack/docs/en/rest-api/security/create-api-keys.asciidoc", "diffHunk": "@@ -56,6 +60,15 @@ would be an intersection of API keys permissions and authenticated user's permis\n thereby limiting the access scope for API keys.\n The structure of role descriptor is the same as the request for create role API.\n For more details, see <<security-api-put-role, create or update roles API>>.\n++\n+--\n+NOTE: Due to the way in which this permission intersection is calculated, it is not\n+possible to create an API key that is a child of another API key, unless the derived\n+key is created without any privileges. In this case, you must explicitly specify a\n+role descriptor with no privileges, and the derived API key can be used for\n+authentication only, but will not have access to call {es} APIs.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b885b3a9ce4fc0321ea5340235924ed7b10d98f9"}, "originalPosition": 21}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1568, "cost": 1, "resetAt": "2021-11-12T13:16:51Z"}}}