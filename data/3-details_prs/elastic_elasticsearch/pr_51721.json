{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY5MzcyNDIw", "number": 51721, "title": "Create a class to hold field capabilities for one index.", "bodyText": "Currently, the same class FieldCapabilities is used both to represent the\ncapabilities for one index, and also the merged capabilities across indices. To\nhelp clarify the logic, this PR proposes to create a separate class\nIndexFieldCapabilities for the capabilities in one index. The refactor will\nalso help when adding source_path information in #49264, since the merged\nsource path field will have a different structure from the field for a single index.\nIndividual changes:\n\nAdd a new class IndexFieldCapabilities.\nRemove extra constructor from FieldCapabilities.\nCombine the add and merge methods in FieldCapabilities.Builder.", "createdAt": "2020-01-31T01:48:23Z", "url": "https://github.com/elastic/elasticsearch/pull/51721", "merged": true, "mergeCommit": {"oid": "fef0e1dd89731aace184a509970fa77d6f75372c"}, "closed": true, "closedAt": "2020-02-04T00:20:23Z", "author": {"login": "jtibshirani"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb_k106AH2gAyMzY5MzcyNDIwOjNlNzE1MGRjOTQ4MjUzNzlkOTdkZGYzYTFjZDRjODhiNmFkNzJiYTQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcA1eA3AH2gAyMzY5MzcyNDIwOjhiYTMyMzhmOGVmMDQ5MjI3ZjYwMzcyMTcwYjI3MTY4YTMyMTY1YmI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "3e7150dc94825379d97ddf3a1cd4c88b6ad72ba4", "author": {"user": {"login": "jtibshirani", "name": "Julie Tibshirani"}}, "url": "https://github.com/elastic/elasticsearch/commit/3e7150dc94825379d97ddf3a1cd4c88b6ad72ba4", "committedDate": "2020-01-31T01:27:32Z", "message": "Add a new class IndexFieldCapabilities."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0bdf19bcbd1209fa1bfd327c2768c428aa49b523", "author": {"user": {"login": "jtibshirani", "name": "Julie Tibshirani"}}, "url": "https://github.com/elastic/elasticsearch/commit/0bdf19bcbd1209fa1bfd327c2768c428aa49b523", "committedDate": "2020-01-31T01:27:32Z", "message": "Remove extra constructor from FieldCapabilities."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fa6e4d15974d352575d01086f2e0bd4786ef5c4d", "author": {"user": {"login": "jtibshirani", "name": "Julie Tibshirani"}}, "url": "https://github.com/elastic/elasticsearch/commit/fa6e4d15974d352575d01086f2e0bd4786ef5c4d", "committedDate": "2020-01-31T01:27:32Z", "message": "Combine the add and merge methods in FieldCapabilities.Builder."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8364937fb9124d0406a1121cc89dd25bcd02797a", "author": {"user": {"login": "jtibshirani", "name": "Julie Tibshirani"}}, "url": "https://github.com/elastic/elasticsearch/commit/8364937fb9124d0406a1121cc89dd25bcd02797a", "committedDate": "2020-01-31T02:41:56Z", "message": "Fix bwc for meta information."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUxNzg2MTU5", "url": "https://github.com/elastic/elasticsearch/pull/51721#pullrequestreview-351786159", "createdAt": "2020-01-31T21:23:58Z", "commit": {"oid": "8364937fb9124d0406a1121cc89dd25bcd02797a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0zMVQyMToyMzo1OFrOFkYWDA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0zMVQyMToyMzo1OFrOFkYWDA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzY5MTkxNg==", "bodyText": "The serialization turned out to be a bit messy unfortunately.", "url": "https://github.com/elastic/elasticsearch/pull/51721#discussion_r373691916", "createdAt": "2020-01-31T21:23:58Z", "author": {"login": "jtibshirani"}, "path": "server/src/main/java/org/elasticsearch/action/fieldcaps/IndexFieldCapabilities.java", "diffHunk": "@@ -0,0 +1,152 @@\n+/*\n+ * Licensed to Elasticsearch under one or more contributor\n+ * license agreements. See the NOTICE file distributed with\n+ * this work for additional information regarding copyright\n+ * ownership. Elasticsearch licenses this file to you under\n+ * the Apache License, Version 2.0 (the \"License\"); you may\n+ * not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *    http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.elasticsearch.action.fieldcaps;\n+\n+import org.elasticsearch.Version;\n+import org.elasticsearch.common.io.stream.StreamInput;\n+import org.elasticsearch.common.io.stream.StreamOutput;\n+import org.elasticsearch.common.io.stream.Writeable;\n+\n+import java.io.IOException;\n+import java.util.Collections;\n+import java.util.Map;\n+import java.util.Objects;\n+import java.util.Set;\n+import java.util.stream.Collectors;\n+\n+/**\n+ * Describes the capabilities of a field in a single index.\n+ */\n+public class IndexFieldCapabilities implements Writeable {\n+\n+    private final String name;\n+    private final String type;\n+    private final boolean isSearchable;\n+    private final boolean isAggregatable;\n+    private final Map<String, String> meta;\n+\n+    /**\n+     * @param name The name of the field.\n+     * @param type The type associated with the field.\n+     * @param isSearchable Whether this field is indexed for search.\n+     * @param isAggregatable Whether this field can be aggregated on.\n+     * @param meta Metadata about the field.\n+     */\n+    IndexFieldCapabilities(String name, String type,\n+                           boolean isSearchable, boolean isAggregatable,\n+                           Map<String, String> meta) {\n+\n+        this.name = name;\n+        this.type = type;\n+        this.isSearchable = isSearchable;\n+        this.isAggregatable = isAggregatable;\n+        this.meta = meta;\n+    }\n+\n+    IndexFieldCapabilities(StreamInput in) throws IOException {\n+        this.name = in.readString();\n+        this.type = in.readString();\n+        this.isSearchable = in.readBoolean();\n+        this.isAggregatable = in.readBoolean();\n+\n+        // Previously we also stored placeholders for the 'indices' arrays.\n+        if (in.getVersion().onOrAfter(Version.V_8_0_0)) {\n+            // Do nothing.\n+        } else {\n+            in.readOptionalStringArray();\n+            in.readOptionalStringArray();\n+            in.readOptionalStringArray();\n+        }\n+\n+        if (in.getVersion().onOrAfter(Version.V_8_0_0)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8364937fb9124d0406a1121cc89dd25bcd02797a"}, "originalPosition": 78}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUyNTk4MzQ1", "url": "https://github.com/elastic/elasticsearch/pull/51721#pullrequestreview-352598345", "createdAt": "2020-02-03T22:08:33Z", "commit": {"oid": "8364937fb9124d0406a1121cc89dd25bcd02797a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9b6b6bb0d549570d2672e0bbbf1b441cd95322af", "author": {"user": {"login": "jtibshirani", "name": "Julie Tibshirani"}}, "url": "https://github.com/elastic/elasticsearch/commit/9b6b6bb0d549570d2672e0bbbf1b441cd95322af", "committedDate": "2020-02-03T22:43:57Z", "message": "Simplify serialization logic."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUyNjMyMDk3", "url": "https://github.com/elastic/elasticsearch/pull/51721#pullrequestreview-352632097", "createdAt": "2020-02-03T23:19:20Z", "commit": {"oid": "9b6b6bb0d549570d2672e0bbbf1b441cd95322af"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8ba3238f8ef049227f60372170b27168a32165bb", "author": {"user": {"login": "jtibshirani", "name": "Julie Tibshirani"}}, "url": "https://github.com/elastic/elasticsearch/commit/8ba3238f8ef049227f60372170b27168a32165bb", "committedDate": "2020-02-03T23:23:50Z", "message": "Merge remote-tracking branch 'upstream/master' into field-caps"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3140, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}