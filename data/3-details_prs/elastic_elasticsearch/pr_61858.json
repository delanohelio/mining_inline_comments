{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDc3ODgwMDY3", "number": 61858, "title": "Add a template parameter to override auto_create_index value", "bodyText": "Closes #20640.\nThis PR introduces a new parameter to v2 templates, allow_auto_create, which allows templates to override the cluster setting auto_create_index. Notes:\n\nAutoCreateIndex now looks for a matching v2 template, and if its allow_auto_create setting is true, it overrides the usual logic.\nTransportBulkAction previously used AutoCreateIndex to check whether missing indices should be created. After talking to @martijnvg, we now rely on AutoCreateAction, which was already differentiating between creating indices and creating data streams. I've updated AutoCreateAction to use AutoCreateIndex.\nMost of the Java file changes are due to introducing an extra constructor parameter to ComposableIndexTemplate.\nI've added the new setting to various x-pack templates\nI added a YAML test to check that watches can be created even when auto_create_index is false.", "createdAt": "2020-09-02T14:58:14Z", "url": "https://github.com/elastic/elasticsearch/pull/61858", "merged": true, "mergeCommit": {"oid": "dc855add492f3b447a2d3ea0a290458f9fc9207e"}, "closed": true, "closedAt": "2020-10-26T12:35:38Z", "author": {"login": "pugnascotia"}, "timelineItems": {"totalCount": 88, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc7TkadgH2gAyNDc3ODgwMDY3OmVlNTA5MjRiZDAwMzk3ZTRlMDFmOWZjNDk5ZTYxZDI4OTNiMDFhMTg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdWSSsqgFqTUxNjY2NjkxOQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "ee50924bd00397e4e01f9fc499e61d2893b01a18", "author": {"user": {"login": "pugnascotia", "name": "Rory Hunter"}}, "url": "https://github.com/elastic/elasticsearch/commit/ee50924bd00397e4e01f9fc499e61d2893b01a18", "committedDate": "2020-08-03T15:15:35Z", "message": "Override auto-create index behaviour via a template flag"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f62c83b2ccd790b4b631ef786c4c6387f227991d", "author": {"user": {"login": "pugnascotia", "name": "Rory Hunter"}}, "url": "https://github.com/elastic/elasticsearch/commit/f62c83b2ccd790b4b631ef786c4c6387f227991d", "committedDate": "2020-08-04T19:52:20Z", "message": "WIP - trying to test watcher"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "097d9f567297cd296ce38f4f21fe25f1c361d631", "author": {"user": {"login": "pugnascotia", "name": "Rory Hunter"}}, "url": "https://github.com/elastic/elasticsearch/commit/097d9f567297cd296ce38f4f21fe25f1c361d631", "committedDate": "2020-09-01T13:23:16Z", "message": "Merge remote-tracking branch 'upstream/master' into 20640-auto-create-templates"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3bb580ca7a16b15405b93b95bba4116657ed0e33", "author": {"user": {"login": "pugnascotia", "name": "Rory Hunter"}}, "url": "https://github.com/elastic/elasticsearch/commit/3bb580ca7a16b15405b93b95bba4116657ed0e33", "committedDate": "2020-09-02T10:10:36Z", "message": "Fixes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "42cfc007eb7e2486a4ef11aa3fcf34264cbd20a7", "author": {"user": {"login": "pugnascotia", "name": "Rory Hunter"}}, "url": "https://github.com/elastic/elasticsearch/commit/42cfc007eb7e2486a4ef11aa3fcf34264cbd20a7", "committedDate": "2020-09-02T14:35:48Z", "message": "Remove logging"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8c173711811b8577eb8360b3b84caf4f23b66796", "author": {"user": {"login": "pugnascotia", "name": "Rory Hunter"}}, "url": "https://github.com/elastic/elasticsearch/commit/8c173711811b8577eb8360b3b84caf4f23b66796", "committedDate": "2020-09-02T15:07:00Z", "message": "Merge remote-tracking branch 'upstream/master' into 20640-auto-create-templates"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgxODEyNTMy", "url": "https://github.com/elastic/elasticsearch/pull/61858#pullrequestreview-481812532", "createdAt": "2020-09-03T12:59:45Z", "commit": {"oid": "8c173711811b8577eb8360b3b84caf4f23b66796"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wM1QxMjo1OTo0NVrOHMlbiA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wM1QxMjo1OTo0NVrOHMlbiA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Mjk1ODIxNg==", "bodyText": "We talked about the auto create index logic and the allow auto create template flag yesterday. This logic is invoked from the bulk action and is evaluated on the coordinating node. While the decision the auto create an index or data stream is done in the AutoCreateAction on the elected master node.\nThe reason why we decided to make the decision to auto create an index or data stream in the AutoCreateAction and not here is, because if for some reason a node is lacking behind and doesn't have all the templates then an index is auto created instead of a data stream. Fixing the erroneous situation requires a lot of manual work, hence we moved making this decision to elected master node.\nThe question is whether the auto create index check (with this enhancement) should be moved to AutoCreateAction class too, so that all the decisions are made on the elected master node.\nI'm currently thinking the following:\n\nIn the case a coordinating node doesn't have the latest action.auto_create_index setting values or composable index templates then the worst that can happen is a new few write requests fail, because the target index doesn't exist.\nCurrently if action.auto_create_index is set to false then also data streams are no longer created. I think this is a bug, because the name of the setting implies auto creation of indices only.\nIf this logic is moved to AutoCreateAction class then the overhead is that remote requests are made to the elected master node in the case target indices don't exist. Most requests will index into an existing data stream or index, so the cost is acceptable.\nI remember that we eventually want to deprecate and remove the action.auto_create_index setting, but I may be mistaken.\n\nIf we are going to remove action.auto_create_index with the new allow auto create template flag then I think let's keep it here? And then maybe also add logic here that if a non existing index matches with a template that auto create data streams then checking the action.auto_create_index setting should be ignored?", "url": "https://github.com/elastic/elasticsearch/pull/61858#discussion_r482958216", "createdAt": "2020-09-03T12:59:45Z", "author": {"login": "martijnvg"}, "path": "server/src/main/java/org/elasticsearch/action/support/AutoCreateIndex.java", "diffHunk": "@@ -67,6 +62,13 @@ public boolean shouldAutoCreate(String index, ClusterState state) {\n         if (resolver.hasIndexAbstraction(index, state)) {\n             return false;\n         }\n+\n+        // Templates can override the AUTO_CREATE_INDEX_SETTING setting\n+        final ComposableIndexTemplate template = findTemplate(index, state.metadata());\n+        if (template != null && template.getAllowAutoCreate()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8c173711811b8577eb8360b3b84caf4f23b66796"}, "originalPosition": 40}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9a1e10ac9900dcf2d4dceffbdf8370af77ba43ae", "author": {"user": {"login": "pugnascotia", "name": "Rory Hunter"}}, "url": "https://github.com/elastic/elasticsearch/commit/9a1e10ac9900dcf2d4dceffbdf8370af77ba43ae", "committedDate": "2020-09-04T09:12:37Z", "message": "Merge remote-tracking branch 'upstream/master' into 20640-auto-create-templates"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "961cfcf792de36cc688c87271cc4c2dcba2e3c65", "author": {"user": {"login": "pugnascotia", "name": "Rory Hunter"}}, "url": "https://github.com/elastic/elasticsearch/commit/961cfcf792de36cc688c87271cc4c2dcba2e3c65", "committedDate": "2020-09-09T11:17:54Z", "message": "Use AutoCreateIndex in AutoCreateAction"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "41fdcb3907271c7e5a91cefcad157c39ebd0c7bf", "author": {"user": {"login": "pugnascotia", "name": "Rory Hunter"}}, "url": "https://github.com/elastic/elasticsearch/commit/41fdcb3907271c7e5a91cefcad157c39ebd0c7bf", "committedDate": "2020-09-10T14:42:01Z", "message": "Imports"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "22280339dd25212af07115449f448fa1aa678a63", "author": {"user": {"login": "pugnascotia", "name": "Rory Hunter"}}, "url": "https://github.com/elastic/elasticsearch/commit/22280339dd25212af07115449f448fa1aa678a63", "committedDate": "2020-09-10T14:42:06Z", "message": "Merge remote-tracking branch 'upstream/master' into 20640-auto-create-templates"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b00297e5e09ab23a05a2058cabe5c1e86d3864a0", "author": {"user": {"login": "pugnascotia", "name": "Rory Hunter"}}, "url": "https://github.com/elastic/elasticsearch/commit/b00297e5e09ab23a05a2058cabe5c1e86d3864a0", "committedDate": "2020-09-14T10:57:15Z", "message": "Fixes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ad5021def7e035c361494bb73cd7d3b5e441b892", "author": {"user": {"login": "pugnascotia", "name": "Rory Hunter"}}, "url": "https://github.com/elastic/elasticsearch/commit/ad5021def7e035c361494bb73cd7d3b5e441b892", "committedDate": "2020-09-14T12:20:04Z", "message": "Merge remote-tracking branch 'upstream/master' into 20640-auto-create-templates"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ad9e699cb813c432dd4265569eb8605fae779aca", "author": {"user": {"login": "pugnascotia", "name": "Rory Hunter"}}, "url": "https://github.com/elastic/elasticsearch/commit/ad9e699cb813c432dd4265569eb8605fae779aca", "committedDate": "2020-09-14T12:42:23Z", "message": "Fix compile error"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c42e3cebae0183aee5c03ea4e80423ce2d961d5b", "author": {"user": {"login": "pugnascotia", "name": "Rory Hunter"}}, "url": "https://github.com/elastic/elasticsearch/commit/c42e3cebae0183aee5c03ea4e80423ce2d961d5b", "committedDate": "2020-09-14T15:39:32Z", "message": "Tweak ComposableIndexTemplate serialisation under code changes land in 7.10"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6a689b26b0a7f7dbb3769457f6158055d993077c", "author": {"user": {"login": "pugnascotia", "name": "Rory Hunter"}}, "url": "https://github.com/elastic/elasticsearch/commit/6a689b26b0a7f7dbb3769457f6158055d993077c", "committedDate": "2020-09-16T10:23:00Z", "message": "Fix auto create index bug"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f81a5106a9e1d4ca4bf5e431fb33b42741e7729b", "author": {"user": {"login": "pugnascotia", "name": "Rory Hunter"}}, "url": "https://github.com/elastic/elasticsearch/commit/f81a5106a9e1d4ca4bf5e431fb33b42741e7729b", "committedDate": "2020-09-16T12:31:40Z", "message": "Merge remote-tracking branch 'upstream/master' into 20640-auto-create-templates"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2d54d2c6c79b007a813d367c901fb49dae35921e", "author": {"user": {"login": "pugnascotia", "name": "Rory Hunter"}}, "url": "https://github.com/elastic/elasticsearch/commit/2d54d2c6c79b007a813d367c901fb49dae35921e", "committedDate": "2020-09-16T12:54:14Z", "message": "Test fix"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "85abcbc721a3cf86a8d8b325e5b6038ed89dd98f", "author": {"user": {"login": "pugnascotia", "name": "Rory Hunter"}}, "url": "https://github.com/elastic/elasticsearch/commit/85abcbc721a3cf86a8d8b325e5b6038ed89dd98f", "committedDate": "2020-09-16T13:47:01Z", "message": "Handle null Boolean"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "eb299a0936449cac3e4758b508b03f65cd9c3b00", "author": {"user": {"login": "pugnascotia", "name": "Rory Hunter"}}, "url": "https://github.com/elastic/elasticsearch/commit/eb299a0936449cac3e4758b508b03f65cd9c3b00", "committedDate": "2020-09-18T11:00:01Z", "message": "Merge remote-tracking branch 'upstream/master' into 20640-auto-create-templates"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a3e3691da0d2ac82251d99884035afcd5d3624b3", "author": {"user": {"login": "pugnascotia", "name": "Rory Hunter"}}, "url": "https://github.com/elastic/elasticsearch/commit/a3e3691da0d2ac82251d99884035afcd5d3624b3", "committedDate": "2020-09-18T11:08:29Z", "message": "Imports"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9421140135bd9c79a1be9f0cc740b3ad670669e8", "author": {"user": {"login": "pugnascotia", "name": "Rory Hunter"}}, "url": "https://github.com/elastic/elasticsearch/commit/9421140135bd9c79a1be9f0cc740b3ad670669e8", "committedDate": "2020-09-18T15:13:19Z", "message": "Checkstyle"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ebb42d4a1085279f04e5f82c41db574a56bd871c", "author": {"user": {"login": "pugnascotia", "name": "Rory Hunter"}}, "url": "https://github.com/elastic/elasticsearch/commit/ebb42d4a1085279f04e5f82c41db574a56bd871c", "committedDate": "2020-09-18T15:26:59Z", "message": "Tweaks"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a93cfb2b10fdc41b3d746e0e5fcb2a88e673d664", "author": {"user": {"login": "pugnascotia", "name": "Rory Hunter"}}, "url": "https://github.com/elastic/elasticsearch/commit/a93cfb2b10fdc41b3d746e0e5fcb2a88e673d664", "committedDate": "2020-09-18T15:50:33Z", "message": "Merge remote-tracking branch 'upstream/master' into 20640-auto-create-templates"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bfe8c8c4666ef56323d504747fd296e796121ccb", "author": {"user": {"login": "pugnascotia", "name": "Rory Hunter"}}, "url": "https://github.com/elastic/elasticsearch/commit/bfe8c8c4666ef56323d504747fd296e796121ccb", "committedDate": "2020-09-18T15:52:14Z", "message": "Post-merge fix"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2694fb2776c4f710f9159bf85c5412d6ff535af9", "author": {"user": {"login": "pugnascotia", "name": "Rory Hunter"}}, "url": "https://github.com/elastic/elasticsearch/commit/2694fb2776c4f710f9159bf85c5412d6ff535af9", "committedDate": "2020-09-18T16:03:07Z", "message": "Update synthentics template to add allow_auto_create"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkxNzM1ODc3", "url": "https://github.com/elastic/elasticsearch/pull/61858#pullrequestreview-491735877", "createdAt": "2020-09-18T19:41:51Z", "commit": {"oid": "2694fb2776c4f710f9159bf85c5412d6ff535af9"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xOFQxOTo0MTo1MVrOHUZu-w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xOFQxOTo0NjoxMVrOHUZ2Kg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTE1NTE5NQ==", "bodyText": "Typically, we set this to V.8_0_0 until after we backport", "url": "https://github.com/elastic/elasticsearch/pull/61858#discussion_r491155195", "createdAt": "2020-09-18T19:41:51Z", "author": {"login": "jaymode"}, "path": "server/src/main/java/org/elasticsearch/cluster/metadata/ComposableIndexTemplate.java", "diffHunk": "@@ -132,6 +138,11 @@ public ComposableIndexTemplate(StreamInput in) throws IOException {\n         } else {\n             this.dataStreamTemplate = null;\n         }\n+        if (in.getVersion().after(Version.V_7_10_0)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2694fb2776c4f710f9159bf85c5412d6ff535af9"}, "originalPosition": 62}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTE1NzAzNA==", "bodyText": "we probably don't want this change to go in?", "url": "https://github.com/elastic/elasticsearch/pull/61858#discussion_r491157034", "createdAt": "2020-09-18T19:46:11Z", "author": {"login": "jaymode"}, "path": "x-pack/plugin/monitoring/src/main/java/org/elasticsearch/xpack/monitoring/exporter/local/LocalExporter.java", "diffHunk": "@@ -430,7 +430,7 @@ private boolean hasTemplate(final ClusterState clusterState, final String templa\n \n     // FIXME this should use the IndexTemplateMetadataUpgrader\n     private void putTemplate(String template, String source, ActionListener<AcknowledgedResponse> listener) {\n-        logger.debug(\"installing template [{}]\", template);\n+        logger.warn(\"installing template [{}]\", template);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2694fb2776c4f710f9159bf85c5412d6ff535af9"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5d5eeb440e6d6e7ce3c5b0c41b8f31e0c4e63340", "author": {"user": {"login": "pugnascotia", "name": "Rory Hunter"}}, "url": "https://github.com/elastic/elasticsearch/commit/5d5eeb440e6d6e7ce3c5b0c41b8f31e0c4e63340", "committedDate": "2020-09-22T09:20:38Z", "message": "Merge remote-tracking branch 'upstream/master' into 20640-auto-create-templates"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "39abb3816a8884705ae406a2b6be9fc33d9a7217", "author": {"user": {"login": "pugnascotia", "name": "Rory Hunter"}}, "url": "https://github.com/elastic/elasticsearch/commit/39abb3816a8884705ae406a2b6be9fc33d9a7217", "committedDate": "2020-09-22T09:23:16Z", "message": "Address review feedback"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkzMjc4ODAx", "url": "https://github.com/elastic/elasticsearch/pull/61858#pullrequestreview-493278801", "createdAt": "2020-09-22T09:28:17Z", "commit": {"oid": "39abb3816a8884705ae406a2b6be9fc33d9a7217"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQwOToyODoxOFrOHVxsIA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQwOToyODoxOFrOHVxsIA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjU5NjI1Ng==", "bodyText": "I think that allow_auto_create doesn't need to be defined? Since auto creation is allowed by default?", "url": "https://github.com/elastic/elasticsearch/pull/61858#discussion_r492596256", "createdAt": "2020-09-22T09:28:18Z", "author": {"login": "martijnvg"}, "path": "x-pack/plugin/core/src/main/resources/ilm-history.json", "diffHunk": "@@ -80,6 +80,7 @@\n         }\n       }\n   },\n+  \"allow_auto_create\": true,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "39abb3816a8884705ae406a2b6be9fc33d9a7217"}, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4b9034aea89ed39b671e4f59f608001edcb91f31", "author": {"user": {"login": "pugnascotia", "name": "Rory Hunter"}}, "url": "https://github.com/elastic/elasticsearch/commit/4b9034aea89ed39b671e4f59f608001edcb91f31", "committedDate": "2020-09-22T09:45:17Z", "message": "Address review feedback"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ce8c2ed9d123df5406af2ff6ec493722da1a31bd", "author": {"user": {"login": "pugnascotia", "name": "Rory Hunter"}}, "url": "https://github.com/elastic/elasticsearch/commit/ce8c2ed9d123df5406af2ff6ec493722da1a31bd", "committedDate": "2020-09-22T11:11:56Z", "message": "Merge remote-tracking branch 'upstream/master' into 20640-auto-create-templates"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2e9a4c716a8e432701e42a0c8065dccccc2bf030", "author": {"user": {"login": "pugnascotia", "name": "Rory Hunter"}}, "url": "https://github.com/elastic/elasticsearch/commit/2e9a4c716a8e432701e42a0c8065dccccc2bf030", "committedDate": "2020-09-22T13:48:46Z", "message": "Specify the same version for ser/deser\n\nHonestly, what was I thinking."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d5db431bf8c31c06f28565011149289e203b2fe0", "author": {"user": {"login": "pugnascotia", "name": "Rory Hunter"}}, "url": "https://github.com/elastic/elasticsearch/commit/d5db431bf8c31c06f28565011149289e203b2fe0", "committedDate": "2020-09-24T11:47:39Z", "message": "Merge remote-tracking branch 'upstream/master' into 20640-auto-create-templates"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1d0770988fe672838603ce7aa7e15263e1dd90e4", "author": {"user": {"login": "pugnascotia", "name": "Rory Hunter"}}, "url": "https://github.com/elastic/elasticsearch/commit/1d0770988fe672838603ce7aa7e15263e1dd90e4", "committedDate": "2020-09-24T11:47:55Z", "message": "Fix stupid typo"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk1NzIxNDU1", "url": "https://github.com/elastic/elasticsearch/pull/61858#pullrequestreview-495721455", "createdAt": "2020-09-24T15:56:58Z", "commit": {"oid": "1d0770988fe672838603ce7aa7e15263e1dd90e4"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNFQxNTo1Njo1OFrOHXhwUQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNFQxNTo1Njo1OFrOHXhwUQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDQzMjMzNw==", "bodyText": "I think we need to do a little more for this to be a full feature and only fall back to the setting if the value is null in the template:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    if (template != null && template.getAllowAutoCreate() != null && template.getAllowAutoCreate()) {\n          \n          \n            \n                        return true;\n          \n          \n            \n                    }\n          \n          \n            \n                    if (template != null && template.getAllowAutoCreate() != null) {\n          \n          \n            \n                        if (template.getAllowAutoCreate()) {\n          \n          \n            \n                            return true;\n          \n          \n            \n                        } else {\n          \n          \n            \n                            // explicit false overrides AUTO_CREATE_INDEX_SETTING\n          \n          \n            \n                            throw new IndexNotFoundException(\"composable template [\" + template.getIndexPatterns() + \"] forbids index auto creation\");\n          \n          \n            \n                        }\n          \n          \n            \n                    }", "url": "https://github.com/elastic/elasticsearch/pull/61858#discussion_r494432337", "createdAt": "2020-09-24T15:56:58Z", "author": {"login": "jaymode"}, "path": "server/src/main/java/org/elasticsearch/action/support/AutoCreateIndex.java", "diffHunk": "@@ -67,6 +62,13 @@ public boolean shouldAutoCreate(String index, ClusterState state) {\n         if (resolver.hasIndexAbstraction(index, state)) {\n             return false;\n         }\n+\n+        // Templates can override the AUTO_CREATE_INDEX_SETTING setting\n+        final ComposableIndexTemplate template = findTemplate(index, state.metadata());\n+        if (template != null && template.getAllowAutoCreate() != null && template.getAllowAutoCreate()) {\n+            return true;\n+        }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1d0770988fe672838603ce7aa7e15263e1dd90e4"}, "originalPosition": 42}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk1OTk3MDUw", "url": "https://github.com/elastic/elasticsearch/pull/61858#pullrequestreview-495997050", "createdAt": "2020-09-24T22:37:55Z", "commit": {"oid": "1d0770988fe672838603ce7aa7e15263e1dd90e4"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNFQyMjozNzo1NVrOHXu83w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNFQyMzowMjo0MlrOHXvcXw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDY0ODU0Mw==", "bodyText": "Can we define a constant for this version? It's less error-prone to only have to update it in one place when backporting.", "url": "https://github.com/elastic/elasticsearch/pull/61858#discussion_r494648543", "createdAt": "2020-09-24T22:37:55Z", "author": {"login": "gwbrown"}, "path": "server/src/main/java/org/elasticsearch/cluster/metadata/ComposableIndexTemplate.java", "diffHunk": "@@ -132,6 +138,11 @@ public ComposableIndexTemplate(StreamInput in) throws IOException {\n         } else {\n             this.dataStreamTemplate = null;\n         }\n+        if (in.getVersion().onOrAfter(Version.V_8_0_0)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1d0770988fe672838603ce7aa7e15263e1dd90e4"}, "originalPosition": 62}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDY1NDI1MA==", "bodyText": "Could you add a positive version of this test case where the template has allow_auto_create=null, but action.auto_create_index is a pattern that allows creation of the index? This might be paranoia, but unit tests are cheap.", "url": "https://github.com/elastic/elasticsearch/pull/61858#discussion_r494654250", "createdAt": "2020-09-24T22:55:21Z", "author": {"login": "gwbrown"}, "path": "server/src/test/java/org/elasticsearch/action/support/AutoCreateIndexTests.java", "diffHunk": "@@ -191,6 +192,86 @@ public void testUpdate() {\n         assertThat(autoCreateIndex.getAutoCreate().getExpressions().get(0).v1(), equalTo(\"logs-*\"));\n     }\n \n+    /**\n+     * Check that if a template matches the index to be created, but that template does not have a value\n+     * for the allow_auto_create setting at all, then it does not cause the auto-create logic to trip over\n+     * on a null value.\n+     */\n+    public void testCanHandleNullAutoCreateSettingInTemplate() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1d0770988fe672838603ce7aa7e15263e1dd90e4"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDY1NjYwNw==", "bodyText": "I like this test case, but I think it should be moved to the put_watch directory, rather than being in execute_watch.", "url": "https://github.com/elastic/elasticsearch/pull/61858#discussion_r494656607", "createdAt": "2020-09-24T23:02:42Z", "author": {"login": "gwbrown"}, "path": "x-pack/plugin/watcher/qa/rest/src/yamlRestTest/resources/rest-api-spec/test/watcher/execute_watch/90_auto_create_index.yml", "diffHunk": "@@ -0,0 +1,52 @@\n+---", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1d0770988fe672838603ce7aa7e15263e1dd90e4"}, "originalPosition": 1}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "36b9ca8580be9b2ce68ca40454569b5c39e3886e", "author": {"user": {"login": "pugnascotia", "name": "Rory Hunter"}}, "url": "https://github.com/elastic/elasticsearch/commit/36b9ca8580be9b2ce68ca40454569b5c39e3886e", "committedDate": "2020-09-28T10:32:40Z", "message": "Merge remote-tracking branch 'upstream/master' into 20640-auto-create-templates"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "93e2440d98bd07edfc7dd22ec8f85ebdb805858f", "author": {"user": {"login": "pugnascotia", "name": "Rory Hunter"}}, "url": "https://github.com/elastic/elasticsearch/commit/93e2440d98bd07edfc7dd22ec8f85ebdb805858f", "committedDate": "2020-09-28T11:08:25Z", "message": "Address review comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4a2e64c85312130a20c2e97cc40e14a58fcde260", "author": {"user": {"login": "pugnascotia", "name": "Rory Hunter"}}, "url": "https://github.com/elastic/elasticsearch/commit/4a2e64c85312130a20c2e97cc40e14a58fcde260", "committedDate": "2020-09-28T11:15:25Z", "message": "Increment some template versions due to the new setting"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "82ad6e46e7268ad7b11da38cfd00eded94fc4fde", "author": {"user": {"login": "pugnascotia", "name": "Rory Hunter"}}, "url": "https://github.com/elastic/elasticsearch/commit/82ad6e46e7268ad7b11da38cfd00eded94fc4fde", "committedDate": "2020-09-28T13:02:29Z", "message": "Add Java REST tests for auto-creating indices"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6022b3c35e5996b1cfe6a44db64dde824ea86292", "author": {"user": {"login": "pugnascotia", "name": "Rory Hunter"}}, "url": "https://github.com/elastic/elasticsearch/commit/6022b3c35e5996b1cfe6a44db64dde824ea86292", "committedDate": "2020-09-28T13:53:12Z", "message": "Checkstyle"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "41b2fc6588c839ff91af7e354eed44726295f523", "author": {"user": {"login": "pugnascotia", "name": "Rory Hunter"}}, "url": "https://github.com/elastic/elasticsearch/commit/41b2fc6588c839ff91af7e354eed44726295f523", "committedDate": "2020-10-12T13:26:28Z", "message": "Merge remote-tracking branch 'upstream/master' into 20640-auto-create-templates"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6127caf1c0fc37feaca3f3bc6446df140bd77150", "author": {"user": {"login": "pugnascotia", "name": "Rory Hunter"}}, "url": "https://github.com/elastic/elasticsearch/commit/6127caf1c0fc37feaca3f3bc6446df140bd77150", "committedDate": "2020-10-12T13:33:45Z", "message": "Update component template docs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9d6b6cf42129484a50ef9d08a267f8df3d116e03", "author": {"user": {"login": "pugnascotia", "name": "Rory Hunter"}}, "url": "https://github.com/elastic/elasticsearch/commit/9d6b6cf42129484a50ef9d08a267f8df3d116e03", "committedDate": "2020-10-12T14:14:52Z", "message": "Checkstyle"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA2ODk0NDEy", "url": "https://github.com/elastic/elasticsearch/pull/61858#pullrequestreview-506894412", "createdAt": "2020-10-12T20:26:28Z", "commit": {"oid": "6127caf1c0fc37feaca3f3bc6446df140bd77150"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xMlQyMDoyNjoyOFrOHgMLcQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xMlQyMDozODowN1rOHgMc8w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzUxNjAxNw==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            `actions.auto_create_index`.  If set to `false`, then indices matching the\n          \n          \n            \n            `actions.auto_create_index`. If set to `false`, then indices matching the\n          \n      \n    \n    \n  \n\nSuper nitpick: Prefer single spaces following a full stop in the docs.", "url": "https://github.com/elastic/elasticsearch/pull/61858#discussion_r503516017", "createdAt": "2020-10-12T20:26:28Z", "author": {"login": "gwbrown"}, "path": "docs/reference/indices/put-component-template.asciidoc", "diffHunk": "@@ -112,6 +112,16 @@ include::{es-repo-dir}/rest-api/common-parms.asciidoc[tag=settings]\n Version number used to manage component templates externally.\n This number is not automatically generated or incremented by {es}.\n \n+`allow_auto_create`::\n+(Optional, boolean)\n+This setting overrides the value of the\n+<<index-creation,`action.auto_create_index`>> cluster setting. If set to\n+`true` in a template, then indices can be automatically created using that\n+template even if auto-creation of indices is disabled via\n+`actions.auto_create_index`.  If set to `false`, then indices matching the", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6127caf1c0fc37feaca3f3bc6446df140bd77150"}, "originalPosition": 39}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzUyMDQ5OQ==", "bodyText": "How do data streams interact with auto-creation and does it make sense to have both on the same template? I know that you can create a data stream via \"auto-creation\", but I'm not sure exactly how that's implemented.", "url": "https://github.com/elastic/elasticsearch/pull/61858#discussion_r503520499", "createdAt": "2020-10-12T20:38:07Z", "author": {"login": "gwbrown"}, "path": "x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/slm/history/SnapshotLifecycleTemplateRegistry.java", "diffHunk": "@@ -37,8 +37,9 @@\n     // version 1: initial\n     // version 2: converted to hidden index\n     // version 3: templates moved to composable templates\n-    // version 4: add `allow_auto_create` setting\n-    public static final int INDEX_TEMPLATE_VERSION = 4;\n+    // version 4:converted data stream\n+    // version 5: add `allow_auto_create` setting", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "41b2fc6588c839ff91af7e354eed44726295f523"}, "originalPosition": 7}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c0394e4da0efacbf0d3eaee45de6f47e5ff784f2", "author": {"user": {"login": "pugnascotia", "name": "Rory Hunter"}}, "url": "https://github.com/elastic/elasticsearch/commit/c0394e4da0efacbf0d3eaee45de6f47e5ff784f2", "committedDate": "2020-10-13T09:17:22Z", "message": "Docs tweak"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cbfbb9826f3bc362b2158a50f88a8b027b8a3685", "author": {"user": {"login": "pugnascotia", "name": "Rory Hunter"}}, "url": "https://github.com/elastic/elasticsearch/commit/cbfbb9826f3bc362b2158a50f88a8b027b8a3685", "committedDate": "2020-10-13T09:17:37Z", "message": "Merge remote-tracking branch 'upstream/master' into 20640-auto-create-templates"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "383d6ffc3d9c5272f3747ef9596327327f6e3941", "author": {"user": {"login": "pugnascotia", "name": "Rory Hunter"}}, "url": "https://github.com/elastic/elasticsearch/commit/383d6ffc3d9c5272f3747ef9596327327f6e3941", "committedDate": "2020-10-19T09:47:56Z", "message": "Merge remote-tracking branch 'upstream/master' into 20640-auto-create-templates"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "61ab28ecaaed2915c7b1002434575d9410cd3bca", "author": {"user": {"login": "pugnascotia", "name": "Rory Hunter"}}, "url": "https://github.com/elastic/elasticsearch/commit/61ab28ecaaed2915c7b1002434575d9410cd3bca", "committedDate": "2020-10-19T10:35:00Z", "message": "Make data stream subject to auto_create_index"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6c4c81769993bfc544e0909cf6484e98f4f7a740", "author": {"user": {"login": "pugnascotia", "name": "Rory Hunter"}}, "url": "https://github.com/elastic/elasticsearch/commit/6c4c81769993bfc544e0909cf6484e98f4f7a740", "committedDate": "2020-10-19T12:44:31Z", "message": "Add tests for auto-creating data streams"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ed692c7d595e6caa7d3e7a807b49825eda4a14bf", "author": {"user": {"login": "pugnascotia", "name": "Rory Hunter"}}, "url": "https://github.com/elastic/elasticsearch/commit/ed692c7d595e6caa7d3e7a807b49825eda4a14bf", "committedDate": "2020-10-19T13:23:34Z", "message": "Formatting"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e8617b681aa8b33ad79a0a4dd53086f253e3d5fc", "author": {"user": {"login": "elasticmachine", "name": "Elastic Machine"}}, "url": "https://github.com/elastic/elasticsearch/commit/e8617b681aa8b33ad79a0a4dd53086f253e3d5fc", "committedDate": "2020-10-19T18:52:21Z", "message": "Merge branch 'master' into 20640-auto-create-templates"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTEyMTU3NDA3", "url": "https://github.com/elastic/elasticsearch/pull/61858#pullrequestreview-512157407", "createdAt": "2020-10-19T21:03:24Z", "commit": {"oid": "e8617b681aa8b33ad79a0a4dd53086f253e3d5fc"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xOVQyMTowMzoyNFrOHkhkQQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xOVQyMTowMzoyNFrOHkhkQQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODA2MDczNw==", "bodyText": "Moving this call here has the side effect of also applying action.auto_create_index to data streams if the template does not have allow_auto_create set, which I don't think is what we wanted to do.", "url": "https://github.com/elastic/elasticsearch/pull/61858#discussion_r508060737", "createdAt": "2020-10-19T21:03:24Z", "author": {"login": "gwbrown"}, "path": "server/src/main/java/org/elasticsearch/action/admin/indices/create/AutoCreateAction.java", "diffHunk": "@@ -116,25 +116,25 @@ protected ClusterStateUpdateResponse newResponse(boolean acknowledged) {\n \n                 @Override\n                 public ClusterState execute(ClusterState currentState) throws Exception {\n-                    DataStreamTemplate dataStreamTemplate = resolveAutoCreateDataStream(request, currentState.metadata());\n+                    final String indexName = indexNameExpressionResolver.resolveDateMathExpression(request.index());\n+\n+                    // This will throw an exception if the index or data stream does not exist and creating it is prohibited.\n+                    final boolean shouldAutoCreate = autoCreateIndex.shouldAutoCreate(indexName, currentState);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e8617b681aa8b33ad79a0a4dd53086f253e3d5fc"}, "originalPosition": 8}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4f051af5c0842e944de6e315b12433621e3d143b", "author": {"user": {"login": "mayya-sharipova", "name": "Mayya Sharipova"}}, "url": "https://github.com/elastic/elasticsearch/commit/4f051af5c0842e944de6e315b12433621e3d143b", "committedDate": "2020-10-21T11:10:28Z", "message": "Fix max/min aggs for unsigned_long (#63904)\n\nMax and min aggs were producing wrong results for unsigned_long field\r\nif field was indexed. If field is indexed for max/min aggs instead of\r\nfield data, we use values from indexed Points, values of which\r\nare derived using method pointReaderIfPossible. Before\r\nUnsignedLongFieldType#pointReaderIfPossible was incorrectly\r\nproducing values, as it failed to shift them back to original\r\nvalues.\r\n\r\nThis patch fixes method pointReaderIfPossible to produce\r\ncorrect original values.\r\n\r\nRelates to #60050"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "44d7d6619a680ab72ebb7493e436e2a9451f2b6b", "author": {"user": {"login": "williamrandolph", "name": "William Brafford"}}, "url": "https://github.com/elastic/elasticsearch/commit/44d7d6619a680ab72ebb7493e436e2a9451f2b6b", "committedDate": "2020-10-21T11:10:28Z", "message": "Add APM configuration index to Kibana system indices (#63756)\n\n* Add APM index to Kibana system indices, making it \r\naccessible through the _kibana endpoint and giving it the\r\nsame access privileges as the other Kibana system indices.\r\n* Parameterize kibana system index tests by index name"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e145266634a3e9f44d4888165bb5e3dcddca411b", "author": {"user": {"login": "dimitris-athanasiou", "name": "Dimitris Athanasiou"}}, "url": "https://github.com/elastic/elasticsearch/commit/e145266634a3e9f44d4888165bb5e3dcddca411b", "committedDate": "2020-10-21T11:10:28Z", "message": "[ML] Rename evaluation metric result fields to value (#63809)\n\nRenames data frame analytics _evaluate API results as follows:\r\n\r\n  - per class accuracy renamed from `accuracy` to `value`\r\n  - per class precision renamed from `precision` to `value`\r\n  - per class recall renamed from `recall` to `value`\r\n  - auc_roc `score` renamed to `value` for both outlier detection and classification"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9e8221a0ef4c1543184ace665be92ea23410ca12", "author": {"user": {"login": "breskeby", "name": "Rene Groeschke"}}, "url": "https://github.com/elastic/elasticsearch/commit/9e8221a0ef4c1543184ace665be92ea23410ca12", "committedDate": "2020-10-21T11:10:29Z", "message": "Update gradle wrapper to Gradle 6.7 (#62386)\n\n- Ignore Memory Manager thread in Gradle thread filter\r\n- Update gradle wrapper to 6.7 GA release"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dd7a22fcabb764f123074ede7e0ea258e196513a", "author": {"user": {"login": "tlrx", "name": "Tanguy Leroux"}}, "url": "https://github.com/elastic/elasticsearch/commit/dd7a22fcabb764f123074ede7e0ea258e196513a", "committedDate": "2020-10-21T11:10:29Z", "message": "Add snapshot shard size based test in DiskThresholdDeciderTests (#63546)\n\nThis commit adds a test in DiskThresholdDeciderTests that verifies\r\n the allocation of a snapshot recovery source based shard in the \r\nsituation where the snapshot shard size was successfully provided \r\nby the SnapshotInfoService introduced in #61906 and when the \r\nservice failed to provide the size.\r\n\r\nRelates #61906"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cfca1e4186933d99d9b0cbd028d8ee05fac827ce", "author": {"user": {"login": "javanna", "name": "Luca Cavanna"}}, "url": "https://github.com/elastic/elasticsearch/commit/cfca1e4186933d99d9b0cbd028d8ee05fac827ce", "committedDate": "2020-10-21T11:10:29Z", "message": "DocumentMapperParser to no longer depend directly on MapperService (#63850)\n\nThis change was mainly triggered by the need for `MapperService` to pass `this` during its constructor when creating `DocumentMapperParser`. Also, `MapperService` is carried around in some places where only a subset of it is needed.\r\n\r\nWith this change we rather carry around the components that are strictly needed, in a couple of cases functions that `MapperService` provides, which helps clarifying the dependency between `DocumentMapperParser`, `DocumentMapper` and `MapperService`, as well as removing the need for MapperService to pass `this` to `DocumentMapperParser`"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "85c0b5483d79bff8768d5140527d2d3dfaf52074", "author": {"user": {"login": "jimczi", "name": "Jim Ferenczi"}}, "url": "https://github.com/elastic/elasticsearch/commit/85c0b5483d79bff8768d5140527d2d3dfaf52074", "committedDate": "2020-10-21T11:10:29Z", "message": "Composite aggregation must check live docs when the index is sorted (#63864)\n\nThis change ensures that the live docs are checked in the composite aggregator\r\nwhen the index is sorted."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0204f0af7a9f0544420d96be865fad39869747bd", "author": {"user": {"login": "breskeby", "name": "Rene Groeschke"}}, "url": "https://github.com/elastic/elasticsearch/commit/0204f0af7a9f0544420d96be865fad39869747bd", "committedDate": "2020-10-21T11:10:29Z", "message": "Fix build tools integTest failure after vault update (#63914)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "eae0eaac87f06dcf903203d570d2bec2ab73237a", "author": {"user": {"login": "iverase", "name": "Ignacio Vera"}}, "url": "https://github.com/elastic/elasticsearch/commit/eae0eaac87f06dcf903203d570d2bec2ab73237a", "committedDate": "2020-10-21T11:10:29Z", "message": "Upgrade to lucene-8.7.0-snapshot-72d8528c3a6 (#63912)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d9aea1c83beee93cbfa667b7e9e998d42cd268f8", "author": {"user": {"login": "benwtrent", "name": "Benjamin Trent"}}, "url": "https://github.com/elastic/elasticsearch/commit/d9aea1c83beee93cbfa667b7e9e998d42cd268f8", "committedDate": "2020-10-21T11:10:29Z", "message": "[ML] fix inference binary classification predication label and feature importance (#63688)\n\nWhen calculating feature importance, the leaf values directly correlate the value of the importance.\r\n\r\nConsequently, positive leaf values -> positive feature importance\r\n\r\nnegative leaf values -> negative feature importance.\r\n\r\nIt follows that for binary classification, this is done such that the importance relates to the leaf values, which relate directly to the \"probability of class 1\".\r\n\r\nSo, the feature importance calculated is always for the importance as it relates to class 1.\r\n\r\nThe inverse is the importance as it relates to class 0."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "13ef3ab3ea4c63e2235ad70c32a80d367c2a8d29", "author": {"user": {"login": "lockewritesdocs", "name": "Adam Locke"}}, "url": "https://github.com/elastic/elasticsearch/commit/13ef3ab3ea4c63e2235ad70c32a80d367c2a8d29", "committedDate": "2020-10-21T11:10:29Z", "message": "Move clone snapshot API page. (#63902)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4bdc32227c2c178fbe7ccf38f74669667e7463e7", "author": {"user": {"login": "javanna", "name": "Luca Cavanna"}}, "url": "https://github.com/elastic/elasticsearch/commit/4bdc32227c2c178fbe7ccf38f74669667e7463e7", "committedDate": "2020-10-21T11:10:29Z", "message": "Remove two redundant DocumentMapper methods (#63922)\n\nDocumentMapper exposes field types and object mappers through specific getter methods, that call the corresponding getters exposed by MappingLookup. MappingLookup is though exposed directly by DocumentMapper, hence there is no need for additional methods other than the one to retrieve the mapping lookup object."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c3d1981021cb59698bf6893be92d31af78bd2bee", "author": {"user": {"login": "iverase", "name": "Ignacio Vera"}}, "url": "https://github.com/elastic/elasticsearch/commit/c3d1981021cb59698bf6893be92d31af78bd2bee", "committedDate": "2020-10-21T11:10:29Z", "message": "make sure AggregationTest creates reduced aggregations. (#63931)\n\nThe test calls InternalAggregationTestCase#createTestInstanceForXContent() instead of InternalAggregationTestCase#createTestInstance() (The method needs to become public)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ae05665c4c4d4ccaab18f8a5fecd81c755b8b66f", "author": {"user": {"login": "benwtrent", "name": "Benjamin Trent"}}, "url": "https://github.com/elastic/elasticsearch/commit/ae05665c4c4d4ccaab18f8a5fecd81c755b8b66f", "committedDate": "2020-10-21T11:10:29Z", "message": "[ML] adding new flag exclude_generated that removes generated fields in GET config APIs (#63899)\n\nWhen exporting and cloning ml configurations in a cluster it can be\r\nfrustrating to remove all the fields that were generated by\r\nthe plugin. Especially as the number of these fields change\r\nfrom version to version.\r\n\r\nThis flag, exclude_generated, allows the GET config APIs to return\r\nconfigurations with these generated fields removed.\r\n\r\nAPIs supporting this flag: \r\n- GET _ml/anomaly_detection/<job_id>\r\n- GET _ml/datafeeds/<datafeed_id>\r\n- GET _ml/data_frame/analytics/<analytics_id>\r\n\r\nThe following fields are not returned in the objects:\r\n\r\n- any field that is not user settable (e.g. version, create_time)\r\n- any field that is a calculated default value (e.g. datafeed chunking_config)\r\n- any field that is automatically set via another Elastic stack process (e.g. anomaly job custom_settings.created_by)\r\n\r\nrelates to #63055"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2cd82f2b46c7e88e368df03102f85ac81a827c65", "author": {"user": {"login": "benwtrent", "name": "Benjamin Trent"}}, "url": "https://github.com/elastic/elasticsearch/commit/2cd82f2b46c7e88e368df03102f85ac81a827c65", "committedDate": "2020-10-21T11:10:29Z", "message": "[Transform] add new exclude_generated flag to GET transform (#63093)\n\nThis adds a new flag `exclude_generated` for GET transform API.\r\n\r\nThis flag is useful for when a transform needs to be cloned within a cluster or exported/imported between clusters.\r\n\r\nIt removes certain fields that are not able to be set via the PUT api (e.g. version, create_time).\r\n\r\nrelates https://github.com/elastic/elasticsearch/issues/63055"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8bf7976f50b4acf4ea64a994cc1bca14b8d482ab", "author": {"user": {"login": "jakelandis", "name": "Jake Landis"}}, "url": "https://github.com/elastic/elasticsearch/commit/8bf7976f50b4acf4ea64a994cc1bca14b8d482ab", "committedDate": "2020-10-21T11:10:29Z", "message": "Gradle - compatible REST test plugin - adopt bwc artifact (#63629)\n\nUse newly exposed bwc:minor / checkout artifact as opposed to coding directly against\r\nthe output of a bwc:minor checkout task. The copy test/api tasks have been updated\r\nto lazily compute the subset of the files from the configuration. This is to facilitate\r\ncompatible testing which needs to filter singular bwc:minor checkout in core/x-pack/project\r\nset of files. By default (unless explicitly requested) the copy test/api tasks will continue\r\nto use the full fileTree of the configuration.\r\n\r\nrelated: #63173"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b4cc55c82232dbebd7ae90383d02c2c6fe5377bf", "author": {"user": {"login": "javanna", "name": "Luca Cavanna"}}, "url": "https://github.com/elastic/elasticsearch/commit/b4cc55c82232dbebd7ae90383d02c2c6fe5377bf", "committedDate": "2020-10-21T11:10:29Z", "message": "Remove documentMapperParser method from MapperService (#63938)\n\nMapperService allows to retrieve its internal DocumentMapperParser instance. Such method is only used in tests, and always to parse mappings which is already exposed by MapperService through a specific parse method.\r\n\r\nThis commit removes the getter for DocumentMapperParser from MapperService in favour of calling MapperService#parse"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1545c0aa78ee8c5cf2ff87ae3e171f05a65ba4e9", "author": {"user": {"login": "javanna", "name": "Luca Cavanna"}}, "url": "https://github.com/elastic/elasticsearch/commit/1545c0aa78ee8c5cf2ff87ae3e171f05a65ba4e9", "committedDate": "2020-10-21T11:10:29Z", "message": "Minor FieldTypeLookup tweaks (#63944)\n\nRemove the default constructor, make the class final and adjust visibility of its methods: if the class is package private, it makes little sense to have public methods."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "55172b6bc0a2c072f9b80a3fc595429ec35ea36d", "author": {"user": {"login": "hendrikmuhs", "name": "Hendrik Muhs"}}, "url": "https://github.com/elastic/elasticsearch/commit/55172b6bc0a2c072f9b80a3fc595429ec35ea36d", "committedDate": "2020-10-21T11:10:29Z", "message": "[Transform] add support for unsigned_long data type (#63940)\n\nadd support for unsigned_long, which required a change in\r\nwriting out integer results properly, because coerce is not\r\nsupported for unsigned_long\r\n\r\nfixes #63871"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9a9b96b30b9fa89810a81c4e087898aba1842951", "author": {"user": {"login": "nik9000", "name": "Nik Everett"}}, "url": "https://github.com/elastic/elasticsearch/commit/9a9b96b30b9fa89810a81c4e087898aba1842951", "committedDate": "2020-10-21T11:10:29Z", "message": "Make agg test less confusing (#63952)\n\nWe have an `@After` annotated method in `AggregatorTestCase` that cleans\r\nup releasibles. But it was `private`! Confusingly, it seemed to be\r\nworking! I'm not sure why. This makes it public which is a little more\r\nsensible."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7db889c79cd9462ae7fa611753d154f84cac08b7", "author": {"user": {"login": "nik9000", "name": "Nik Everett"}}, "url": "https://github.com/elastic/elasticsearch/commit/7db889c79cd9462ae7fa611753d154f84cac08b7", "committedDate": "2020-10-21T11:10:29Z", "message": "Add a test for regex usage to runtime fields (#63951)\n\nNow that we've got regexes enabled by default (#63029) this adds a test\r\nto runtime fields just to make sure that it works with regexes. It does,\r\nbut this adds a test to make sure it continues to work."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "70f758e198ca0ffa52ae1d7779906ad5c510f778", "author": {"user": {"login": "dimitris-athanasiou", "name": "Dimitris Athanasiou"}}, "url": "https://github.com/elastic/elasticsearch/commit/70f758e198ca0ffa52ae1d7779906ad5c510f778", "committedDate": "2020-10-21T11:10:29Z", "message": "[ML] Extend default evaluation metrics to all available (#63939)\n\nThis commit extends the set of default metrics for the\r\ndata frame analytics evaluation API to all available metrics.\r\nThe motivation is that if the user skips setting an explicit\r\nset of metrics, they get most of the evaluation offering."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1376afd82871398bf0ad5c0f56824e6d3352cebc", "author": {"user": {"login": "iverase", "name": "Ignacio Vera"}}, "url": "https://github.com/elastic/elasticsearch/commit/1376afd82871398bf0ad5c0f56824e6d3352cebc", "committedDate": "2020-10-21T11:10:29Z", "message": "geo_point runtime field implementation (#63164)\n\nRun time field that emits geo points from lat/lon values."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dec6ea937fe0d2c6687f77b0eef2a7f4c39ed5ee", "author": {"user": {"login": "javanna", "name": "Luca Cavanna"}}, "url": "https://github.com/elastic/elasticsearch/commit/dec6ea937fe0d2c6687f77b0eef2a7f4c39ed5ee", "committedDate": "2020-10-21T11:10:29Z", "message": "Mute CoreValuesSourceTypeTests.testDatePrepareRoundingWithDocs (#63970)\n\nRelates to #63969"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "00b0bdff6a396656286abbc54525241cb89291f7", "author": {"user": {"login": "cbuescher", "name": "Christoph B\u00fcscher"}}, "url": "https://github.com/elastic/elasticsearch/commit/00b0bdff6a396656286abbc54525241cb89291f7", "committedDate": "2020-10-21T11:10:29Z", "message": "Handle range query edge case (#63397)\n\nCurrently when searching with an empty string as lower bound for a range query\r\non text-based fields we return all documents when 'gte' is used (including the\r\nlower bound) but no documents when 'gt' is used. This might seem\r\ncounterintuitive since every value should be greate than the empty string. \r\nThe bug has been fixed in Lucene and this PR adds a test for assuring we observe\r\nthe fixed behaviour on searches now.\r\n\r\nCloses #63386"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "473975c4d57f5795c61ed0fb53f8771c0517ddb6", "author": {"user": {"login": "javanna", "name": "Luca Cavanna"}}, "url": "https://github.com/elastic/elasticsearch/commit/473975c4d57f5795c61ed0fb53f8771c0517ddb6", "committedDate": "2020-10-21T11:10:29Z", "message": "Mute DatafeedJobsIT#testDatafeedTimingStats_DatafeedRecreated (#63974)\n\nRelates to #63973"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f45ea3068cd65b6f5b12d7b9de90e1bb19620fbc", "author": {"user": {"login": "javanna", "name": "Luca Cavanna"}}, "url": "https://github.com/elastic/elasticsearch/commit/f45ea3068cd65b6f5b12d7b9de90e1bb19620fbc", "committedDate": "2020-10-21T11:10:29Z", "message": "Mute FieldSortIT#testCastDate (#63972)\n\nRelates to #63719"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0482f5cb8f89c067293766f584c9ed5f20767ffa", "author": {"user": {"login": "pugnascotia", "name": "Rory Hunter"}}, "url": "https://github.com/elastic/elasticsearch/commit/0482f5cb8f89c067293766f584c9ed5f20767ffa", "committedDate": "2020-10-21T11:10:29Z", "message": "Only subject data streams to allow_auto_create, not auto_create_index"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "421679d02c310eb2e6f5f7498b000f8deb404f55", "author": {"user": {"login": "pugnascotia", "name": "Rory Hunter"}}, "url": "https://github.com/elastic/elasticsearch/commit/421679d02c310eb2e6f5f7498b000f8deb404f55", "committedDate": "2020-10-21T11:11:23Z", "message": "Merge remote-tracking branch 'upstream/master' into 20640-auto-create-templates"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE0MTU3MTY2", "url": "https://github.com/elastic/elasticsearch/pull/61858#pullrequestreview-514157166", "createdAt": "2020-10-21T20:24:41Z", "commit": {"oid": "421679d02c310eb2e6f5f7498b000f8deb404f55"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMVQyMDoyNDo0MVrOHmDfFw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMVQyMDoyNDo0MVrOHmDfFw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTY2NTA0Nw==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            `actions.auto_create_index`. If set to `false`, then indices matching the\n          \n          \n            \n            `actions.auto_create_index`. If set to `false`, then indices or data streams matching the\n          \n      \n    \n    \n  \n\nThis is the only note I'd make in the documentation, I think.", "url": "https://github.com/elastic/elasticsearch/pull/61858#discussion_r509665047", "createdAt": "2020-10-21T20:24:41Z", "author": {"login": "gwbrown"}, "path": "docs/reference/indices/put-component-template.asciidoc", "diffHunk": "@@ -112,6 +112,16 @@ include::{es-repo-dir}/rest-api/common-parms.asciidoc[tag=settings]\n Version number used to manage component templates externally.\n This number is not automatically generated or incremented by {es}.\n \n+`allow_auto_create`::\n+(Optional, boolean)\n+This setting overrides the value of the\n+<<index-creation,`action.auto_create_index`>> cluster setting. If set to\n+`true` in a template, then indices can be automatically created using that\n+template even if auto-creation of indices is disabled via\n+`actions.auto_create_index`. If set to `false`, then indices matching the", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "421679d02c310eb2e6f5f7498b000f8deb404f55"}, "originalPosition": 39}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6bd545661d510b7846627124e495ceb6ce65dbbd", "author": {"user": {"login": "pugnascotia", "name": "Rory Hunter"}}, "url": "https://github.com/elastic/elasticsearch/commit/6bd545661d510b7846627124e495ceb6ce65dbbd", "committedDate": "2020-10-22T08:29:59Z", "message": "Tweak docs\r\n\r\nMention data streams in the docs changes.\n\nCo-authored-by: Gordon Brown <arcsech@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0fd0f84799db02991f1fa84342288354d32fdc03", "author": {"user": {"login": "elasticmachine", "name": "Elastic Machine"}}, "url": "https://github.com/elastic/elasticsearch/commit/0fd0f84799db02991f1fa84342288354d32fdc03", "committedDate": "2020-10-22T09:49:21Z", "message": "Merge branch 'master' into 20640-auto-create-templates"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE0OTAwNDAz", "url": "https://github.com/elastic/elasticsearch/pull/61858#pullrequestreview-514900403", "createdAt": "2020-10-22T16:15:24Z", "commit": {"oid": "0fd0f84799db02991f1fa84342288354d32fdc03"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE2NjY2OTE5", "url": "https://github.com/elastic/elasticsearch/pull/61858#pullrequestreview-516666919", "createdAt": "2020-10-26T11:01:39Z", "commit": {"oid": "0fd0f84799db02991f1fa84342288354d32fdc03"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yNlQxMTowMTozOVrOHoKgug==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yNlQxMTowMTozOVrOHoKgug==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTg3NzMwNg==", "bodyText": "Maybe distribution/archives/integ-test-zip is a better place for this test class? Given that it doesn't extend HttpSmokeTestCase and this test class doesn't seem to require to start a node with special settings or plugins.", "url": "https://github.com/elastic/elasticsearch/pull/61858#discussion_r511877306", "createdAt": "2020-10-26T11:01:39Z", "author": {"login": "martijnvg"}, "path": "qa/smoke-test-http/src/test/java/org/elasticsearch/http/AutoCreateIndexIT.java", "diffHunk": "@@ -0,0 +1,126 @@\n+/*\n+ * Licensed to Elasticsearch under one or more contributor\n+ * license agreements. See the NOTICE file distributed with\n+ * this work for additional information regarding copyright\n+ * ownership. Elasticsearch licenses this file to you under\n+ * the Apache License, Version 2.0 (the \"License\"); you may\n+ * not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.elasticsearch.http;\n+\n+import org.elasticsearch.action.support.AutoCreateIndex;\n+import org.elasticsearch.client.Request;\n+import org.elasticsearch.client.Response;\n+import org.elasticsearch.client.ResponseException;\n+import org.elasticsearch.common.Strings;\n+import org.elasticsearch.common.io.Streams;\n+import org.elasticsearch.common.xcontent.XContentBuilder;\n+import org.elasticsearch.common.xcontent.json.JsonXContent;\n+import org.elasticsearch.test.rest.ESRestTestCase;\n+\n+import java.io.IOException;\n+import java.io.InputStreamReader;\n+\n+import static java.nio.charset.StandardCharsets.UTF_8;\n+import static org.hamcrest.Matchers.containsString;\n+\n+public class AutoCreateIndexIT extends ESRestTestCase {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0fd0f84799db02991f1fa84342288354d32fdc03"}, "originalPosition": 38}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 8, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}