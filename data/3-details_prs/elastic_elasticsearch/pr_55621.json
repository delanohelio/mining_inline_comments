{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA3NDk2Mzc3", "number": 55621, "title": "Refactor Spatial Field Mappers", "bodyText": "This PR refactors all spatial Field Mappers to a common AbstractGeometryFieldMapper that implements shared parameter functionality (e.g., ignore_malformed, ignore_z_value) and provides a common framework for overriding type parsing, and building in xpack. Common shape functionality is implemented in a new AbstractShapeGeometryFieldMapper that is reused and overridden in GeoShapeFieldMapper, GeoShapeFieldMapperWithDocValues, LegacyGeoShapeFieldMapper, and ShapeFieldMapper, respectively. This abstraction provides a reusable foundation for adding new xpack features; such as coordinate reference system support.", "createdAt": "2020-04-22T19:34:31Z", "url": "https://github.com/elastic/elasticsearch/pull/55621", "merged": true, "mergeCommit": {"oid": "eb0b2c8f6996ff90becc8875f20ac34b925f5795"}, "closed": true, "closedAt": "2020-04-23T16:40:05Z", "author": {"login": "nknize"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcaNhFcgH2gAyNDA3NDk2Mzc3OmRmMjlmNzY5NTdkZmNmMzg5NGY3ZjQyZmY0MDg4ZWQ1OWYyNTEzNzY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcafTRMgFqTM5OTI2MTQxOQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "df29f76957dfcf3894f7f42ff4088ed59f251376", "author": {"user": {"login": "nknize", "name": "Nick Knize"}}, "url": "https://github.com/elastic/elasticsearch/commit/df29f76957dfcf3894f7f42ff4088ed59f251376", "committedDate": "2020-04-22T19:33:01Z", "message": "Refactor Spatial Field Mappers\n\nThis commit refactors all spatial Field Mappers to a common AbstractGeometryFieldMapper that implements shared parameter functionality (e.g., ignore_malformed, ignore_z_value) and provides a common framework for overriding type parsing, and building in xpack. Common shape functionality is implemented in a new AbstractShapeGeometryFieldMapper that is reused and overridden in GeoShapeFieldMapper, GeoShapeFieldMapperWithDocValues, LegacyGeoShapeFieldMapper, and ShapeFieldMapper. This abstraction provides a reusable foundation for adding new xpack features; such as coordinate reference system support."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2dfe4868fa7a05c4c33aaa50aa22b78462789eef", "author": {"user": {"login": "nknize", "name": "Nick Knize"}}, "url": "https://github.com/elastic/elasticsearch/commit/2dfe4868fa7a05c4c33aaa50aa22b78462789eef", "committedDate": "2020-04-22T20:01:04Z", "message": "fix failing test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9b90260796d361898135aff4f02960c958cd632c", "author": {"user": {"login": "nknize", "name": "Nick Knize"}}, "url": "https://github.com/elastic/elasticsearch/commit/9b90260796d361898135aff4f02960c958cd632c", "committedDate": "2020-04-22T21:41:10Z", "message": "fix doXContentBody failure"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "65c92571d5bd0e5d075d1c9d60017fcf7bd9a905", "author": {"user": {"login": "nknize", "name": "Nick Knize"}}, "url": "https://github.com/elastic/elasticsearch/commit/65c92571d5bd0e5d075d1c9d60017fcf7bd9a905", "committedDate": "2020-04-22T22:08:14Z", "message": "Merge branch 'master' into refactor/SpatialFieldMappers"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk4ODUyODY2", "url": "https://github.com/elastic/elasticsearch/pull/55621#pullrequestreview-398852866", "createdAt": "2020-04-23T08:01:58Z", "commit": {"oid": "65c92571d5bd0e5d075d1c9d60017fcf7bd9a905"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yM1QwODowMTo1OVrOGKcFrQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yM1QwODowMTo1OVrOGKcFrQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzU5OTE0OQ==", "bodyText": "Ca we use generics here? I think using them will avoid the casting we are doing in the subclasses and it would look cleaner? Something like:\npublic abstract static class TypeParser<T extends Builder> implements Mapper.TypeParser {", "url": "https://github.com/elastic/elasticsearch/pull/55621#discussion_r413599149", "createdAt": "2020-04-23T08:01:59Z", "author": {"login": "iverase"}, "path": "server/src/main/java/org/elasticsearch/index/mapper/AbstractGeometryFieldMapper.java", "diffHunk": "@@ -177,88 +122,50 @@ protected void setupFieldType(BuilderContext context) {\n             if (name().isEmpty()) {\n                 throw new IllegalArgumentException(\"name cannot be empty string\");\n             }\n-\n-            AbstractGeometryFieldType ft = (AbstractGeometryFieldType)fieldType();\n-            ft.setOrientation(orientation().value());\n         }\n     }\n \n-    protected static final String DEPRECATED_PARAMETERS_KEY = \"deprecated_parameters\";\n-\n     public abstract static class TypeParser implements Mapper.TypeParser {\n         protected abstract Builder newBuilder(String name, Map<String, Object> params);\n \n-        protected boolean parseXContentParameters(String name, Map.Entry<String, Object> entry, Map<String, Object> params)\n-                throws MapperParsingException {\n-            if (DeprecatedParameters.parse(name, entry.getKey(), entry.getValue(),\n-                (DeprecatedParameters)params.get(DEPRECATED_PARAMETERS_KEY))) {\n-                return true;\n-            }\n-            return false;\n-        }\n-\n-        @Override\n-        public Mapper.Builder parse(String name, Map<String, Object> node, ParserContext parserContext) throws MapperParsingException {\n-            Map<String, Object> params = new HashMap<>();\n-            boolean parsedDeprecatedParameters = false;\n-            params.put(DEPRECATED_PARAMETERS_KEY, new DeprecatedParameters());\n+        public Builder parse(String name, Map<String, Object> node, Map<String, Object> params, ParserContext parserContext) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "65c92571d5bd0e5d075d1c9d60017fcf7bd9a905"}, "originalPosition": 200}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "67a75b4f5a59d5bad2b9217d570a399adcfb16dd", "author": {"user": {"login": "nknize", "name": "Nick Knize"}}, "url": "https://github.com/elastic/elasticsearch/commit/67a75b4f5a59d5bad2b9217d570a399adcfb16dd", "committedDate": "2020-04-23T15:37:40Z", "message": "Merge branch 'master' into refactor/SpatialFieldMappers"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dab64723574f060bf44c39f7e16b28caf64d06ce", "author": {"user": {"login": "nknize", "name": "Nick Knize"}}, "url": "https://github.com/elastic/elasticsearch/commit/dab64723574f060bf44c39f7e16b28caf64d06ce", "committedDate": "2020-04-23T15:53:11Z", "message": "switch TypeParser to use generics"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk5MjU2ODcw", "url": "https://github.com/elastic/elasticsearch/pull/55621#pullrequestreview-399256870", "createdAt": "2020-04-23T16:11:09Z", "commit": {"oid": "dab64723574f060bf44c39f7e16b28caf64d06ce"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk5MjYxNDE5", "url": "https://github.com/elastic/elasticsearch/pull/55621#pullrequestreview-399261419", "createdAt": "2020-04-23T16:16:13Z", "commit": {"oid": "dab64723574f060bf44c39f7e16b28caf64d06ce"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 486, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}