{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE5Njg4MzIz", "number": 56920, "title": "[DOCS] Fix clarity of URL snapshot repo docs", "bodyText": "Makes following changes to better clarify docs for read-only URL\nsnapshot repositories:\n\nAdds an example snippet for registering a URL repository\nRewrites the protocols paragraph\nAdds a note to explicitly point out that only URLs using the ftp,\nhttp, http, and jar protocols do not need the path.repo\nsetting.\n\nFixes #16280", "createdAt": "2020-05-18T19:09:03Z", "url": "https://github.com/elastic/elasticsearch/pull/56920", "merged": true, "mergeCommit": {"oid": "626f67e651b81d5a96b38adfba1665f57f9c92a5"}, "closed": true, "closedAt": "2020-05-27T14:34:27Z", "author": {"login": "jrodewig"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcifz1hgH2gAyNDE5Njg4MzIzOjg5NTIzZTRjNjkyYzBjZTVmYmJjMDRhNWE5ZTM3NjhjNDE2YWE1OTE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABclZ8oeAH2gAyNDE5Njg4MzIzOjM5ODRmZDk0MTk1NjZmYjVhZGVkZWRlYjcyZGJjZmZhMWM4MzVhZGI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "89523e4c692c0ce5fbbc04a5a9e3768c416aa591", "author": {"user": {"login": "jrodewig", "name": "James Rodewig"}}, "url": "https://github.com/elastic/elasticsearch/commit/89523e4c692c0ce5fbbc04a5a9e3768c416aa591", "committedDate": "2020-05-18T13:23:11Z", "message": "[DOCS] Fix clarity of URL snapshot repo docs\n\nMakes following changes to better clarify docs for read-only URL\nsnapshot repositories:\n\n* Adds an example snippet for registering a URL repository\n* Rewrites the protocols paragraph\n* Adds a note to explicitly point out that only URLs using the `ftp`,\n  `http`, `http`, and `jar` protocols do not need the `path.repo`\n  setting.\n\nFixes #16280"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "72ce45e6e920d7210ca756cee18901f1d4dc0981", "author": {"user": {"login": "jrodewig", "name": "James Rodewig"}}, "url": "https://github.com/elastic/elasticsearch/commit/72ce45e6e920d7210ca756cee18901f1d4dc0981", "committedDate": "2020-05-18T20:15:26Z", "message": "fix tests"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE4NzQ4NTEx", "url": "https://github.com/elastic/elasticsearch/pull/56920#pullrequestreview-418748511", "createdAt": "2020-05-26T23:36:44Z", "commit": {"oid": "72ce45e6e920d7210ca756cee18901f1d4dc0981"}, "state": "APPROVED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNlQyMzozNjo0NFrOGazxOA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNlQyMzo0NTo1NVrOGaz8HA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDc2NDM0NA==", "bodyText": "This intro feels awkward & doesn't really explain why you would want to use a URL repository. Is the point that you can write snapshots to a shared file system repository, and then serve them up so they can be restored to nodes that don't have access to the shared filesystem?", "url": "https://github.com/elastic/elasticsearch/pull/56920#discussion_r430764344", "createdAt": "2020-05-26T23:36:44Z", "author": {"login": "debadair"}, "path": "docs/reference/snapshot-restore/register-repository.asciidoc", "diffHunk": "@@ -153,22 +153,44 @@ unit, for example: `1GB`, `10MB`, `5KB`, `500B`. Defaults to `null` (unlimited c\n \n The URL repository (`\"type\": \"url\"`) can be used as an alternative read-only way to access data created by the shared file", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "72ce45e6e920d7210ca756cee18901f1d4dc0981"}, "originalPosition": 2}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDc2NTExNQ==", "bodyText": "This is consistent with the other examples, but I think the naming adds to the confusion. You see put...backup, when you're not putting a backup, you're specifying a backup location.", "url": "https://github.com/elastic/elasticsearch/pull/56920#discussion_r430765115", "createdAt": "2020-05-26T23:39:19Z", "author": {"login": "debadair"}, "path": "docs/reference/snapshot-restore/register-repository.asciidoc", "diffHunk": "@@ -153,22 +153,44 @@ unit, for example: `1GB`, `10MB`, `5KB`, `500B`. Defaults to `null` (unlimited c\n \n The URL repository (`\"type\": \"url\"`) can be used as an alternative read-only way to access data created by the shared file\n system repository. The URL specified in the `url` parameter should point to the root of the shared filesystem repository.\n-The following settings are supported:\n \n-[horizontal]\n-`url`:: Location of the snapshots. Mandatory.\n+[source,console]\n+----\n+PUT /_snapshot/my_read_only_url_backup", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "72ce45e6e920d7210ca756cee18901f1d4dc0981"}, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDc2NjEzNw==", "bodyText": "It's not clear to me what the advantage is of using the file protocol over just using the filesystem repo directly. Is just because it is read only?", "url": "https://github.com/elastic/elasticsearch/pull/56920#discussion_r430766137", "createdAt": "2020-05-26T23:42:39Z", "author": {"login": "debadair"}, "path": "docs/reference/snapshot-restore/register-repository.asciidoc", "diffHunk": "@@ -153,22 +153,44 @@ unit, for example: `1GB`, `10MB`, `5KB`, `500B`. Defaults to `null` (unlimited c\n \n The URL repository (`\"type\": \"url\"`) can be used as an alternative read-only way to access data created by the shared file\n system repository. The URL specified in the `url` parameter should point to the root of the shared filesystem repository.\n-The following settings are supported:\n \n-[horizontal]\n-`url`:: Location of the snapshots. Mandatory.\n+[source,console]\n+----\n+PUT /_snapshot/my_read_only_url_backup\n+{\n+  \"type\": \"url\",\n+  \"settings\": {\n+    \"url\": \"file:/mount/backups/my_fs_backup_location\"\n+  }\n+}\n+----\n+// TEST[skip:no access to url file path]\n \n-URL Repository supports the following protocols: \"http\", \"https\", \"ftp\", \"file\" and \"jar\". URL repositories with `http:`,\n-`https:`, and `ftp:` URLs has to be whitelisted by specifying allowed URLs in the `repositories.url.allowed_urls` setting.\n-This setting supports wildcards in the place of host, path, query, and fragment. For example:\n+\n+The `url` parameter supports the following protocols:\n+\n+* `file`\n+* `ftp`\n+* `http`\n+* `https`\n+* `jar`\n+\n+URLs using the `file` protocol must point to the location of a shared filesystem", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "72ce45e6e920d7210ca756cee18901f1d4dc0981"}, "originalPosition": 32}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDc2NzEzMg==", "bodyText": "Do not need to be, or should not be?", "url": "https://github.com/elastic/elasticsearch/pull/56920#discussion_r430767132", "createdAt": "2020-05-26T23:45:55Z", "author": {"login": "debadair"}, "path": "docs/reference/snapshot-restore/register-repository.asciidoc", "diffHunk": "@@ -153,22 +153,44 @@ unit, for example: `1GB`, `10MB`, `5KB`, `500B`. Defaults to `null` (unlimited c\n \n The URL repository (`\"type\": \"url\"`) can be used as an alternative read-only way to access data created by the shared file\n system repository. The URL specified in the `url` parameter should point to the root of the shared filesystem repository.\n-The following settings are supported:\n \n-[horizontal]\n-`url`:: Location of the snapshots. Mandatory.\n+[source,console]\n+----\n+PUT /_snapshot/my_read_only_url_backup\n+{\n+  \"type\": \"url\",\n+  \"settings\": {\n+    \"url\": \"file:/mount/backups/my_fs_backup_location\"\n+  }\n+}\n+----\n+// TEST[skip:no access to url file path]\n \n-URL Repository supports the following protocols: \"http\", \"https\", \"ftp\", \"file\" and \"jar\". URL repositories with `http:`,\n-`https:`, and `ftp:` URLs has to be whitelisted by specifying allowed URLs in the `repositories.url.allowed_urls` setting.\n-This setting supports wildcards in the place of host, path, query, and fragment. For example:\n+\n+The `url` parameter supports the following protocols:\n+\n+* `file`\n+* `ftp`\n+* `http`\n+* `https`\n+* `jar`\n+\n+URLs using the `file` protocol must point to the location of a shared filesystem\n+accessible to all master and data nodes in the cluster. This location must be\n+registered in the `path.repo` setting, similar to a\n+<<snapshots-filesystem-repository,shared file system repository>>.\n+\n+URLs using the `ftp`, `http`, or `https` protocols must be whitelisted in the\n+`repositories.url.allowed_urls` setting. This setting supports wildcards (`*`)\n+in place of a host, path, query, or fragment in the URL. For example:\n \n [source,yaml]\n------------------------------------\n+----\n repositories.url.allowed_urls: [\"http://www.example.org/root/*\", \"https://*.mydomain.com/*?*#*\"]\n------------------------------------\n+----\n \n-URL repositories with `file:` URLs can only point to locations registered in the `path.repo` setting similar to\n-shared file system repository.\n+NOTE: URLs using the `ftp`, `http`, `https`, or `jar` protocols do not need to", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "72ce45e6e920d7210ca756cee18901f1d4dc0981"}, "originalPosition": 50}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "aa2b76ad0b922d370771ae0977ec4e6478765877", "author": {"user": {"login": "jrodewig", "name": "James Rodewig"}}, "url": "https://github.com/elastic/elasticsearch/commit/aa2b76ad0b922d370771ae0977ec4e6478765877", "committedDate": "2020-05-27T14:01:53Z", "message": "Add intro context"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1866a79cf2ff470a945c47f56228930add302074", "author": {"user": {"login": "jrodewig", "name": "James Rodewig"}}, "url": "https://github.com/elastic/elasticsearch/commit/1866a79cf2ff470a945c47f56228930add302074", "committedDate": "2020-05-27T14:03:27Z", "message": "rename url repo"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3984fd9419566fb5adededeb72dbcffa1c835adb", "author": {"user": {"login": "jrodewig", "name": "James Rodewig"}}, "url": "https://github.com/elastic/elasticsearch/commit/3984fd9419566fb5adededeb72dbcffa1c835adb", "committedDate": "2020-05-27T14:15:08Z", "message": "tweak"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4877, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}