{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzYyMTgzMTM1", "number": 50925, "title": "EQL: Replace EqlSearchResponse.Hits parser with ObjectParser", "bodyText": "Replaces the existing hand-build Hits parser with a\nConstructingObjectParser version.\nRelates to #49581", "createdAt": "2020-01-13T15:39:37Z", "url": "https://github.com/elastic/elasticsearch/pull/50925", "merged": true, "mergeCommit": {"oid": "5c7b827b918cfbe9ea8d1adce9ec605ef27d0d01"}, "closed": true, "closedAt": "2020-01-13T17:53:37Z", "author": {"login": "imotov"}, "timelineItems": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb5-N1LAH2gAyMzYyMTgzMTM1OmMwYTVhN2E3MzQ0M2Q5MTI5ZmFkZDliNGI4MTU1MTExYWY0YTEwNTA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABb5-or7AFqTM0MTk1NDcwNA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "c0a5a7a73443d9129fadd9b4b8155111af4a1050", "author": {"user": {"login": "imotov", "name": "Igor Motov"}}, "url": "https://github.com/elastic/elasticsearch/commit/c0a5a7a73443d9129fadd9b4b8155111af4a1050", "committedDate": "2020-01-13T15:37:50Z", "message": "EQL: Replace EqlSearchResponse.Hits parser with ObjectParser\n\nReplaces the existing hand-build Hits parser with a\nConstructingObjectParser version.\n\nRelates to #49581"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQxOTM0Mzc3", "url": "https://github.com/elastic/elasticsearch/pull/50925#pullrequestreview-341934377", "createdAt": "2020-01-13T15:40:30Z", "commit": {"oid": "c0a5a7a73443d9129fadd9b4b8155111af4a1050"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xM1QxNTo0MDozMVrOFc7DBw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xM1QxNTo0MDozMVrOFc7DBw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTg3MTg3OQ==", "bodyText": "I didn't implement this path since it existed in the original parser only for backward compatibility with the older version hits total and shouldn't occur in this version.", "url": "https://github.com/elastic/elasticsearch/pull/50925#discussion_r365871879", "createdAt": "2020-01-13T15:40:31Z", "author": {"login": "imotov"}, "path": "x-pack/plugin/eql/src/main/java/org/elasticsearch/xpack/eql/action/EqlSearchResponse.java", "diffHunk": "@@ -414,53 +411,30 @@ public void writeTo(StreamOutput out) throws IOException {\n             }\n         }\n \n+        private static final ConstructingObjectParser<EqlSearchResponse.Hits, Void> PARSER =\n+            new ConstructingObjectParser<>(\"eql/search_response_count\", true,\n+                args -> {\n+                    int i = 0;\n+                    @SuppressWarnings(\"unchecked\") List<SearchHit> searchHits = (List<SearchHit>) args[i++];\n+                    @SuppressWarnings(\"unchecked\") List<Sequence> sequences = (List<Sequence>) args[i++];\n+                    @SuppressWarnings(\"unchecked\") List<Count> counts = (List<Count>) args[i++];\n+                    TotalHits totalHits = (TotalHits) args[i];\n+                    return new EqlSearchResponse.Hits(searchHits, sequences, counts, totalHits);\n+                });\n+\n+        static {\n+            PARSER.declareObjectArray(ConstructingObjectParser.optionalConstructorArg(), (p, c) -> SearchHit.fromXContent(p),\n+                new ParseField(Fields.EVENTS));\n+            PARSER.declareObjectArray(ConstructingObjectParser.optionalConstructorArg(), Sequence.PARSER,\n+                new ParseField(Fields.SEQUENCES));\n+            PARSER.declareObjectArray(ConstructingObjectParser.optionalConstructorArg(), Count.PARSER,\n+                new ParseField(Fields.COUNTS));\n+            PARSER.declareObject(ConstructingObjectParser.optionalConstructorArg(), (p, c) -> SearchHits.parseTotalHitsFragment(p),\n+                new ParseField(Fields.TOTAL));\n+        }\n+\n         public static Hits fromXContent(XContentParser parser) throws IOException {\n-            if (parser.currentToken() != XContentParser.Token.START_OBJECT) {\n-                parser.nextToken();\n-                ensureExpectedToken(XContentParser.Token.START_OBJECT, parser.currentToken(), parser::getTokenLocation);\n-            }\n-            XContentParser.Token token = parser.currentToken();\n-            String currentFieldName = null;\n-            TotalHits totalHits = null;\n-            ArrayList<SearchHit> searchHits = null;\n-            ArrayList<Sequence> sequences = null;\n-            ArrayList<Count> counts = null;\n-\n-            while ((token = parser.nextToken()) != XContentParser.Token.END_OBJECT) {\n-                if (token == XContentParser.Token.FIELD_NAME) {\n-                    currentFieldName = parser.currentName();\n-                } else if (token.isValue()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c0a5a7a73443d9129fadd9b4b8155111af4a1050"}, "originalPosition": 55}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQxOTU0NzA0", "url": "https://github.com/elastic/elasticsearch/pull/50925#pullrequestreview-341954704", "createdAt": "2020-01-13T16:07:10Z", "commit": {"oid": "c0a5a7a73443d9129fadd9b4b8155111af4a1050"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3202, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}