{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQyNjgzODg4", "number": 58834, "title": "Simplify Repository.finalizeSnapshot Signature", "bodyText": "Many of the parameters we pass into this method were only used to\nbuild the SnapshotInfo instance to write.\nThis change simplifies the signature. Also, it seems less error prone to build\nSnapshotInfo in SnapshotsService isntead of relying on the fact that each repository\nimplementation will build the correct SnapshotInfo.", "createdAt": "2020-07-01T13:00:57Z", "url": "https://github.com/elastic/elasticsearch/pull/58834", "merged": true, "mergeCommit": {"oid": "99be035f2cf74450f5d6019d0b1a4514289b8173"}, "closed": true, "closedAt": "2020-07-02T13:38:54Z", "author": {"login": "original-brownbear"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcwp2CtgH2gAyNDQyNjgzODg4OmNiOTZjM2E0ZDQwYzE1YzExYmYxZDQxNGVmYTBlNDk4YTI4ZmQ2Yzc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcw97u5AFqTQ0MTYyNjE4Ng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "cb96c3a4d40c15c11bf1d414efa0e498a28fd6c7", "author": {"user": {"login": "original-brownbear", "name": "Armin Braun"}}, "url": "https://github.com/elastic/elasticsearch/commit/cb96c3a4d40c15c11bf1d414efa0e498a28fd6c7", "committedDate": "2020-07-01T12:59:35Z", "message": "Simplify Repository.finalizeSnapshot Signature\n\nMany of the parameters we pass into this method were only used to\nbuild the `SnapshotInfo` instance to write.\nThis change simplifies the signature. Also, it seems less error prone to build\n`SnapshotInfo` in `SnapshotsService` isntead of relying on the fact that each repository\nimplementation will build the correct `SnapshotInfo`."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQxNDI4MTI2", "url": "https://github.com/elastic/elasticsearch/pull/58834#pullrequestreview-441428126", "createdAt": "2020-07-02T07:44:57Z", "commit": {"oid": "cb96c3a4d40c15c11bf1d414efa0e498a28fd6c7"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMlQwNzo0NDo1OFrOGsBOcQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMlQwNzo0NDo1OFrOGsBOcQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODgxMDYwOQ==", "bodyText": "Are we using a Supplier here so that the SnapshotInfo end time is updated when it is built?", "url": "https://github.com/elastic/elasticsearch/pull/58834#discussion_r448810609", "createdAt": "2020-07-02T07:44:58Z", "author": {"login": "tlrx"}, "path": "plugins/repository-s3/src/main/java/org/elasticsearch/repositories/s3/S3Repository.java", "diffHunk": "@@ -240,16 +238,15 @@\n     private final AtomicReference<Scheduler.Cancellable> finalizationFuture = new AtomicReference<>();\n \n     @Override\n-    public void finalizeSnapshot(SnapshotId snapshotId, ShardGenerations shardGenerations, long startTime, String failure, int totalShards,\n-                                 List<SnapshotShardFailure> shardFailures, long repositoryStateId, boolean includeGlobalState,\n-                                 Metadata clusterMetadata, Map<String, Object> userMetadata, Version repositoryMetaVersion,\n+    public void finalizeSnapshot(SnapshotId snapshotId, ShardGenerations shardGenerations, long repositoryStateId, Metadata clusterMetadata,\n+                                 Supplier<SnapshotInfo> buildSnapshotInfo, Version repositoryMetaVersion,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cb96c3a4d40c15c11bf1d414efa0e498a28fd6c7"}, "originalPosition": 27}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2ffc7d8e2f10910f87cf2ca202269b2b61295446", "author": {"user": {"login": "original-brownbear", "name": "Armin Braun"}}, "url": "https://github.com/elastic/elasticsearch/commit/2ffc7d8e2f10910f87cf2ca202269b2b61295446", "committedDate": "2020-07-02T09:51:23Z", "message": "Merge remote-tracking branch 'elastic/master' into simplify-snapshot-finalization"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "123a0dd73aa8e079d6373492a0c1cbcd70ed7082", "author": {"user": {"login": "original-brownbear", "name": "Armin Braun"}}, "url": "https://github.com/elastic/elasticsearch/commit/123a0dd73aa8e079d6373492a0c1cbcd70ed7082", "committedDate": "2020-07-02T12:20:43Z", "message": "much simpler"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQxNjI2MTg2", "url": "https://github.com/elastic/elasticsearch/pull/58834#pullrequestreview-441626186", "createdAt": "2020-07-02T12:23:54Z", "commit": {"oid": "123a0dd73aa8e079d6373492a0c1cbcd70ed7082"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2478, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}