{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTA3NDUyMjEy", "number": 63986, "title": "Improve interface for multivalue aggregations", "bodyText": "Multi value aggregations (percentiles, top_metrics, stats, boxplot,...) are hard to integrate with. They all implement NumericMetricsAggregation.MultiValue, however that's an empty interface.\nThis PR is a follow up of a discussion about adding top_metrics to transform, see #52236 (comment) to read more about the use case and the challenges.\nTo follow up on the discussion, I implemented the proposed interface from @nik9000:\n    interface MultiValue extends NumericMetricsAggregation {\n\n        Iterable<String> valueNames();\n\n        double value(String name);\n    }\n\n(#52236 (comment))\nAdding those 2 methods forces the implementation of it in several classes, this is what this PR is mainly about.\nBefore jumping on the details of the implementation, lets 1st focus on the interface and see if we agree on it.\nFor the implementation I decided for an on-demand caching pattern. Names are created on the fly if they are dynamic.", "createdAt": "2020-10-21T11:08:43Z", "url": "https://github.com/elastic/elasticsearch/pull/63986", "merged": true, "mergeCommit": {"oid": "9aba924594688b23309b5842db80295c178a01d3"}, "closed": true, "closedAt": "2020-10-26T07:45:50Z", "author": {"login": "hendrikmuhs"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdUrEnmgH2gAyNTA3NDUyMjEyOjc4Y2E2MWUxOTk3MTc5ZWEyNWMzYmE2M2IyODJhN2NhZmE2ODM1YmM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdVBm7OAFqTUxNDY5OTM5NQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "78ca61e1997179ea25c3ba63b282a7cafa6835bc", "author": {"user": {"login": "hendrikmuhs", "name": "Hendrik Muhs"}}, "url": "https://github.com/elastic/elasticsearch/commit/78ca61e1997179ea25c3ba63b282a7cafa6835bc", "committedDate": "2020-10-21T10:46:41Z", "message": "add an interface for multi value aggs in order to retrieve\nall names and values this agg provides"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "41bd6f86ba3afc5959c0e3b732db596050e92665", "author": {"user": {"login": "hendrikmuhs", "name": "Hendrik Muhs"}}, "url": "https://github.com/elastic/elasticsearch/commit/41bd6f86ba3afc5959c0e3b732db596050e92665", "committedDate": "2020-10-21T11:49:39Z", "message": "fix boxplot tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f05be5467337132792440dc50018c804ecc67337", "author": {"user": {"login": "hendrikmuhs", "name": "Hendrik Muhs"}}, "url": "https://github.com/elastic/elasticsearch/commit/f05be5467337132792440dc50018c804ecc67337", "committedDate": "2020-10-21T12:25:38Z", "message": "fix SQL test"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTEzNzQ1ODQy", "url": "https://github.com/elastic/elasticsearch/pull/63986#pullrequestreview-513745842", "createdAt": "2020-10-21T14:23:47Z", "commit": {"oid": "f05be5467337132792440dc50018c804ecc67337"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMVQxNDoyMzo0OFrOHlvLgg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMVQxNDoyNDozMlrOHlvN-A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTMzMjM1NA==", "bodyText": "I think it'd probably be worth adding javadoc, just because lots of folks have to implement it, even if it is obvious.", "url": "https://github.com/elastic/elasticsearch/pull/63986#discussion_r509332354", "createdAt": "2020-10-21T14:23:48Z", "author": {"login": "nik9000"}, "path": "server/src/main/java/org/elasticsearch/search/aggregations/metrics/NumericMetricsAggregation.java", "diffHunk": "@@ -32,5 +32,10 @@\n     }\n \n     interface MultiValue extends NumericMetricsAggregation {\n+\n+        Iterable<String> valueNames();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f05be5467337132792440dc50018c804ecc67337"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTMzMjk4NA==", "bodyText": "I think it'd be fine to rebuild the list each time rather than have to think about the thing being mutable, even though it is only mutable in this fairly limited way.", "url": "https://github.com/elastic/elasticsearch/pull/63986#discussion_r509332984", "createdAt": "2020-10-21T14:24:32Z", "author": {"login": "nik9000"}, "path": "server/src/main/java/org/elasticsearch/search/aggregations/metrics/AbstractInternalHDRPercentiles.java", "diffHunk": "@@ -40,6 +41,8 @@\n     protected final DoubleHistogram state;\n     protected final boolean keyed;\n \n+    private List<String> keysAsStrings;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f05be5467337132792440dc50018c804ecc67337"}, "originalPosition": 12}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "60c71c34e797444fba75ce2085643aa57427a83a", "author": {"user": {"login": "hendrikmuhs", "name": "Hendrik Muhs"}}, "url": "https://github.com/elastic/elasticsearch/commit/60c71c34e797444fba75ce2085643aa57427a83a", "committedDate": "2020-10-22T11:00:08Z", "message": "document multi value interface"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ddab348959325d0bac3003cc5f575a80905ea70f", "author": {"user": {"login": "hendrikmuhs", "name": "Hendrik Muhs"}}, "url": "https://github.com/elastic/elasticsearch/commit/ddab348959325d0bac3003cc5f575a80905ea70f", "committedDate": "2020-10-22T11:00:28Z", "message": "remove caching of value names"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE0Njk5Mzk1", "url": "https://github.com/elastic/elasticsearch/pull/63986#pullrequestreview-514699395", "createdAt": "2020-10-22T13:02:04Z", "commit": {"oid": "ddab348959325d0bac3003cc5f575a80905ea70f"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1230, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}