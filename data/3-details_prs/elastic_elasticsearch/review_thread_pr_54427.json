{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk1Njc5NDIw", "number": 54427, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMFQxNDo0NjoxOFrODstThA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMFQxNDo0NzoxM1rODstVTA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ4MjA2MjEyOnYy", "diffSide": "RIGHT", "path": "x-pack/plugin/autoscaling/src/main/java/org/elasticsearch/xpack/autoscaling/Autoscaling.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMFQxNDo0NjoxOFrOF9tVyA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMFQxNDo1NTowMlrOF9txOQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDI1MDMxMg==", "bodyText": "I suggest leaving it as a non-nullable boolean and saying this here.\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        AUTOSCALING_FEATURE_FLAG_REGISTERED = null;\n          \n          \n            \n                        AUTOSCALING_FEATURE_FLAG_REGISTERED = Build.CURRENT.isSnapshot();\n          \n      \n    \n    \n  \n\nThen this flag exactly reflects whether the feature flag is registered or not.", "url": "https://github.com/elastic/elasticsearch/pull/54427#discussion_r400250312", "createdAt": "2020-03-30T14:46:18Z", "author": {"login": "DaveCTurner"}, "path": "x-pack/plugin/autoscaling/src/main/java/org/elasticsearch/xpack/autoscaling/Autoscaling.java", "diffHunk": "@@ -41,8 +41,10 @@\n         }\n         if (\"true\".equals(property)) {\n             AUTOSCALING_FEATURE_FLAG_REGISTERED = true;\n-        } else if (\"false\".equals(property) || property == null) {\n+        } else if (\"false\".equals(property)) {\n             AUTOSCALING_FEATURE_FLAG_REGISTERED = false;\n+        } else if (property == null) {\n+            AUTOSCALING_FEATURE_FLAG_REGISTERED = null;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a168389e762403400adb53a017a8b7a8918ecd33"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDI1NzMzNw==", "bodyText": "There's two issues with that suggestion:\n\nmy intention is that the field is aligned with the value of the system property es.autoscaling_feature_flag_registered, it's merely a Boolean representation of the value of that system property\nthe intention of using Autoscaling#isSnapshot in determining whether or not to register the setting is so that it can be overridden in tests; if we tie whether or not to register the setting directly to Build#Current#isSnapshot as you suggest, we lose that ability", "url": "https://github.com/elastic/elasticsearch/pull/54427#discussion_r400257337", "createdAt": "2020-03-30T14:55:02Z", "author": {"login": "jasontedor"}, "path": "x-pack/plugin/autoscaling/src/main/java/org/elasticsearch/xpack/autoscaling/Autoscaling.java", "diffHunk": "@@ -41,8 +41,10 @@\n         }\n         if (\"true\".equals(property)) {\n             AUTOSCALING_FEATURE_FLAG_REGISTERED = true;\n-        } else if (\"false\".equals(property) || property == null) {\n+        } else if (\"false\".equals(property)) {\n             AUTOSCALING_FEATURE_FLAG_REGISTERED = false;\n+        } else if (property == null) {\n+            AUTOSCALING_FEATURE_FLAG_REGISTERED = null;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDI1MDMxMg=="}, "originalCommit": {"oid": "a168389e762403400adb53a017a8b7a8918ecd33"}, "originalPosition": 17}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ4MjA2NjY4OnYy", "diffSide": "RIGHT", "path": "x-pack/plugin/autoscaling/src/main/java/org/elasticsearch/xpack/autoscaling/Autoscaling.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMFQxNDo0NzoxM1rOF9tYiQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMFQxNDo0NzoxM1rOF9tYiQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDI1MTAxNw==", "bodyText": "With my previous suggestion, this simplifies to the following:\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    if (isSnapshot() || (AUTOSCALING_FEATURE_FLAG_REGISTERED != null && AUTOSCALING_FEATURE_FLAG_REGISTERED)) {\n          \n          \n            \n                    if (AUTOSCALING_FEATURE_FLAG_REGISTERED) {", "url": "https://github.com/elastic/elasticsearch/pull/54427#discussion_r400251017", "createdAt": "2020-03-30T14:47:13Z", "author": {"login": "DaveCTurner"}, "path": "x-pack/plugin/autoscaling/src/main/java/org/elasticsearch/xpack/autoscaling/Autoscaling.java", "diffHunk": "@@ -69,7 +71,7 @@ public Autoscaling(final Settings settings) {\n      */\n     @Override\n     public List<Setting<?>> getSettings() {\n-        if (isSnapshot() || AUTOSCALING_FEATURE_FLAG_REGISTERED) {\n+        if (isSnapshot() || (AUTOSCALING_FEATURE_FLAG_REGISTERED != null && AUTOSCALING_FEATURE_FLAG_REGISTERED)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a168389e762403400adb53a017a8b7a8918ecd33"}, "originalPosition": 26}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4069, "cost": 1, "resetAt": "2021-11-12T13:16:51Z"}}}