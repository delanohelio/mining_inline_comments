{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDk3ODI5NDk3", "number": 63239, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNVQxMzoxNTo1N1rOEqUBXQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNVQxMzoxNjowNFrOEqUBiA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEyODAzNjc3OnYy", "diffSide": "RIGHT", "path": "server/src/main/java/org/elasticsearch/index/query/functionscore/FieldValueFactorFunctionBuilder.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNVQxMzoxNTo1N1rOHcchlg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNVQxMzozMDozOVrOHcdJ0g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTU4OTUyNg==", "bodyText": "Maybe we should rename this fieldType rather than fieldMapper?", "url": "https://github.com/elastic/elasticsearch/pull/63239#discussion_r499589526", "createdAt": "2020-10-05T13:15:57Z", "author": {"login": "romseygeek"}, "path": "server/src/main/java/org/elasticsearch/index/query/functionscore/FieldValueFactorFunctionBuilder.java", "diffHunk": "@@ -144,7 +144,7 @@ protected int doHashCode() {\n \n     @Override\n     protected ScoreFunction doToFunction(QueryShardContext context) {\n-        MappedFieldType fieldType = context.getMapperService().fieldType(field);\n+        MappedFieldType fieldType = context.fieldMapper(field);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "687ddb33f83d976e411f21240adf72ce79ada762"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTU5OTgyNg==", "bodyText": "yes indeed, I planned to do it as a follow-up", "url": "https://github.com/elastic/elasticsearch/pull/63239#discussion_r499599826", "createdAt": "2020-10-05T13:30:39Z", "author": {"login": "javanna"}, "path": "server/src/main/java/org/elasticsearch/index/query/functionscore/FieldValueFactorFunctionBuilder.java", "diffHunk": "@@ -144,7 +144,7 @@ protected int doHashCode() {\n \n     @Override\n     protected ScoreFunction doToFunction(QueryShardContext context) {\n-        MappedFieldType fieldType = context.getMapperService().fieldType(field);\n+        MappedFieldType fieldType = context.fieldMapper(field);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTU4OTUyNg=="}, "originalCommit": {"oid": "687ddb33f83d976e411f21240adf72ce79ada762"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEyODAzNzIwOnYy", "diffSide": "RIGHT", "path": "server/src/main/java/org/elasticsearch/index/fieldvisitor/FieldsVisitor.java", "isResolved": false, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNVQxMzoxNjowNFrOHcch2A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNVQxNToxMDo0MlrOHchlHw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTU4OTU5Mg==", "bodyText": "I do wonder if we can remove this step entirely, or replace it with the ValueFetcher functionality somehow - for a followup though.", "url": "https://github.com/elastic/elasticsearch/pull/63239#discussion_r499589592", "createdAt": "2020-10-05T13:16:04Z", "author": {"login": "romseygeek"}, "path": "server/src/main/java/org/elasticsearch/index/fieldvisitor/FieldsVisitor.java", "diffHunk": "@@ -87,9 +87,9 @@ public Status needsField(FieldInfo fieldInfo) {\n                 : Status.NO;\n     }\n \n-    public void postProcess(MapperService mapperService) {\n+    public final void postProcess(Function<String, MappedFieldType> fieldTypeLookup) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "687ddb33f83d976e411f21240adf72ce79ada762"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTU5MjQ5Nw==", "bodyText": "So this doesn't do anything to the _id, _source or _routing fields, so I think we can remove the call to it entirely from LuceneChangesSnapshot and possibly a few other places as well.", "url": "https://github.com/elastic/elasticsearch/pull/63239#discussion_r499592497", "createdAt": "2020-10-05T13:20:12Z", "author": {"login": "romseygeek"}, "path": "server/src/main/java/org/elasticsearch/index/fieldvisitor/FieldsVisitor.java", "diffHunk": "@@ -87,9 +87,9 @@ public Status needsField(FieldInfo fieldInfo) {\n                 : Status.NO;\n     }\n \n-    public void postProcess(MapperService mapperService) {\n+    public final void postProcess(Function<String, MappedFieldType> fieldTypeLookup) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTU4OTU5Mg=="}, "originalCommit": {"oid": "687ddb33f83d976e411f21240adf72ce79ada762"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTYwMDUxOA==", "bodyText": "ok I will look at it, possibly make this change in a separate PR then.", "url": "https://github.com/elastic/elasticsearch/pull/63239#discussion_r499600518", "createdAt": "2020-10-05T13:31:44Z", "author": {"login": "javanna"}, "path": "server/src/main/java/org/elasticsearch/index/fieldvisitor/FieldsVisitor.java", "diffHunk": "@@ -87,9 +87,9 @@ public Status needsField(FieldInfo fieldInfo) {\n                 : Status.NO;\n     }\n \n-    public void postProcess(MapperService mapperService) {\n+    public final void postProcess(Function<String, MappedFieldType> fieldTypeLookup) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTU4OTU5Mg=="}, "originalCommit": {"oid": "687ddb33f83d976e411f21240adf72ce79ada762"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTY3MjM1MQ==", "bodyText": "++", "url": "https://github.com/elastic/elasticsearch/pull/63239#discussion_r499672351", "createdAt": "2020-10-05T15:10:42Z", "author": {"login": "romseygeek"}, "path": "server/src/main/java/org/elasticsearch/index/fieldvisitor/FieldsVisitor.java", "diffHunk": "@@ -87,9 +87,9 @@ public Status needsField(FieldInfo fieldInfo) {\n                 : Status.NO;\n     }\n \n-    public void postProcess(MapperService mapperService) {\n+    public final void postProcess(Function<String, MappedFieldType> fieldTypeLookup) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTU4OTU5Mg=="}, "originalCommit": {"oid": "687ddb33f83d976e411f21240adf72ce79ada762"}, "originalPosition": 21}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3186, "cost": 1, "resetAt": "2021-11-12T11:57:46Z"}}}