{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTIzNTgwMzYz", "number": 65243, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQwMDozODoyMFrOE60x1w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQwMDo0MjozOVrOE6017Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMwMTE3NTkxOnYy", "diffSide": "RIGHT", "path": "test/framework/src/main/java/org/elasticsearch/bootstrap/BootstrapForTesting.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQwMDozODoyMFrOH2H9XA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQwMDo0NToxOFrOH2IGwQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjUxNTU0OA==", "bodyText": "Is this intellij policy actaully specific to intellij or should we rename to \"ide\" or similar?", "url": "https://github.com/elastic/elasticsearch/pull/65243#discussion_r526515548", "createdAt": "2020-11-19T00:38:20Z", "author": {"login": "mark-vieira"}, "path": "test/framework/src/main/java/org/elasticsearch/bootstrap/BootstrapForTesting.java", "diffHunk": "@@ -146,10 +146,8 @@\n                 final Policy runnerPolicy;\n                 if (System.getProperty(\"tests.gradle\") != null) {\n                     runnerPolicy = PolicyUtil.readPolicy(Bootstrap.class.getResource(\"gradle.policy\"), codebases);\n-                } else if (codebases.containsKey(\"junit-rt.jar\")) {\n-                    runnerPolicy = PolicyUtil.readPolicy(Bootstrap.class.getResource(\"intellij.policy\"), codebases);\n                 } else {\n-                    runnerPolicy = PolicyUtil.readPolicy(Bootstrap.class.getResource(\"eclipse.policy\"), codebases);\n+                    runnerPolicy = PolicyUtil.readPolicy(Bootstrap.class.getResource(\"intellij.policy\"), codebases);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "027a8ee37fe3d317b2c4aa0555f2cdd7f16cc981"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjUxNzk1Mw==", "bodyText": "Oops, this was completely unintentional.", "url": "https://github.com/elastic/elasticsearch/pull/65243#discussion_r526517953", "createdAt": "2020-11-19T00:45:18Z", "author": {"login": "rjernst"}, "path": "test/framework/src/main/java/org/elasticsearch/bootstrap/BootstrapForTesting.java", "diffHunk": "@@ -146,10 +146,8 @@\n                 final Policy runnerPolicy;\n                 if (System.getProperty(\"tests.gradle\") != null) {\n                     runnerPolicy = PolicyUtil.readPolicy(Bootstrap.class.getResource(\"gradle.policy\"), codebases);\n-                } else if (codebases.containsKey(\"junit-rt.jar\")) {\n-                    runnerPolicy = PolicyUtil.readPolicy(Bootstrap.class.getResource(\"intellij.policy\"), codebases);\n                 } else {\n-                    runnerPolicy = PolicyUtil.readPolicy(Bootstrap.class.getResource(\"eclipse.policy\"), codebases);\n+                    runnerPolicy = PolicyUtil.readPolicy(Bootstrap.class.getResource(\"intellij.policy\"), codebases);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjUxNTU0OA=="}, "originalCommit": {"oid": "027a8ee37fe3d317b2c4aa0555f2cdd7f16cc981"}, "originalPosition": 8}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMwMTE4NjM3OnYy", "diffSide": "RIGHT", "path": "buildSrc/src/main/groovy/org/elasticsearch/gradle/plugin/PluginBuildPlugin.groovy", "isResolved": true, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQwMDo0MjozOVrOH2IDLg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQwMToxMzowMlrOH2Iq9g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjUxNzAzOA==", "bodyText": "Rather than do this why don't we just define pluginMetadata up top as the individual file isntead of the entire `plugin-metadata?\nAlso, is there any use case for throwing other stuff in that location? Could external plugin authors being doing this, therefore this be a breaking change? Would it be better to explicitly exclude the codebases file?", "url": "https://github.com/elastic/elasticsearch/pull/65243#discussion_r526517038", "createdAt": "2020-11-19T00:42:39Z", "author": {"login": "mark-vieira"}, "path": "buildSrc/src/main/groovy/org/elasticsearch/gradle/plugin/PluginBuildPlugin.groovy", "diffHunk": "@@ -204,7 +204,11 @@ class PluginBuildPlugin implements Plugin<Project> {\n         // create the actual bundle task, which zips up all the files for the plugin\n         TaskProvider<Zip> bundle = project.tasks.register('bundlePlugin', Zip) {\n             from buildProperties\n-            from pluginMetadata // metadata (eg custom security policy)\n+            from(pluginMetadata) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "027a8ee37fe3d317b2c4aa0555f2cdd7f16cc981"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjUxOTk2NA==", "bodyText": "We need the pluginMetadata above to still contain everything, which is the policy file and the codebases file, because that is what goes into the test resources dir. We really just want to remove the file when building the jar, which is what we do here.\nIn theory external plugin authors could add other stuff to the plugin metadata. I could flip this so that it is an exclude of the codebases file. However, there are other ways plugin authors could add files to the root of their plugin zip, so I think it's ok this convention is our own, and not general purpose.", "url": "https://github.com/elastic/elasticsearch/pull/65243#discussion_r526519964", "createdAt": "2020-11-19T00:51:23Z", "author": {"login": "rjernst"}, "path": "buildSrc/src/main/groovy/org/elasticsearch/gradle/plugin/PluginBuildPlugin.groovy", "diffHunk": "@@ -204,7 +204,11 @@ class PluginBuildPlugin implements Plugin<Project> {\n         // create the actual bundle task, which zips up all the files for the plugin\n         TaskProvider<Zip> bundle = project.tasks.register('bundlePlugin', Zip) {\n             from buildProperties\n-            from pluginMetadata // metadata (eg custom security policy)\n+            from(pluginMetadata) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjUxNzAzOA=="}, "originalCommit": {"oid": "027a8ee37fe3d317b2c4aa0555f2cdd7f16cc981"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjUyMzA2NA==", "bodyText": "Right, I think you misread the first part of my comment though. If indeed we just want to add only the plugin-security.policy file to the jar, why not simplify it to File pluginMetadata = project.file('src/main/plugin-metadata/plugin-security.policy') and call it a day rather than say \"copy this directory, but filter everything but this one file\".", "url": "https://github.com/elastic/elasticsearch/pull/65243#discussion_r526523064", "createdAt": "2020-11-19T01:00:13Z", "author": {"login": "mark-vieira"}, "path": "buildSrc/src/main/groovy/org/elasticsearch/gradle/plugin/PluginBuildPlugin.groovy", "diffHunk": "@@ -204,7 +204,11 @@ class PluginBuildPlugin implements Plugin<Project> {\n         // create the actual bundle task, which zips up all the files for the plugin\n         TaskProvider<Zip> bundle = project.tasks.register('bundlePlugin', Zip) {\n             from buildProperties\n-            from pluginMetadata // metadata (eg custom security policy)\n+            from(pluginMetadata) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjUxNzAzOA=="}, "originalCommit": {"oid": "027a8ee37fe3d317b2c4aa0555f2cdd7f16cc981"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjUyNzIyMg==", "bodyText": "That is fair. I'd rather make that decision whether we should only copy the policy file separately, so for now I've flipped the logic to exclude the codebases file.", "url": "https://github.com/elastic/elasticsearch/pull/65243#discussion_r526527222", "createdAt": "2020-11-19T01:13:02Z", "author": {"login": "rjernst"}, "path": "buildSrc/src/main/groovy/org/elasticsearch/gradle/plugin/PluginBuildPlugin.groovy", "diffHunk": "@@ -204,7 +204,11 @@ class PluginBuildPlugin implements Plugin<Project> {\n         // create the actual bundle task, which zips up all the files for the plugin\n         TaskProvider<Zip> bundle = project.tasks.register('bundlePlugin', Zip) {\n             from buildProperties\n-            from pluginMetadata // metadata (eg custom security policy)\n+            from(pluginMetadata) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjUxNzAzOA=="}, "originalCommit": {"oid": "027a8ee37fe3d317b2c4aa0555f2cdd7f16cc981"}, "originalPosition": 5}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2864, "cost": 1, "resetAt": "2021-11-12T13:16:51Z"}}}