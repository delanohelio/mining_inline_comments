{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk2NDgxNTE0", "number": 54522, "title": "[DOCS] Clarifies API key breaking change", "bodyText": "Related to #53647\nThis PR adds a description for the breaking change related to API key privileges.\nPreview:\n\nhttp://elasticsearch_54522.docs-preview.app.elstc.co/guide/en/elasticsearch/reference/7.6/breaking-changes-7.6.html\nhttp://elasticsearch_54522.docs-preview.app.elstc.co/guide/en/elasticsearch/reference/7.6/release-notes-7.6.2.html#breaking-7.6.2", "createdAt": "2020-03-31T17:26:28Z", "url": "https://github.com/elastic/elasticsearch/pull/54522", "merged": true, "mergeCommit": {"oid": "d02fded9e20bae8b707f5d0e58673d575b6e6fe8"}, "closed": true, "closedAt": "2020-04-01T14:34:46Z", "author": {"login": "lcawl"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcTGcBigH2gAyMzk2NDgxNTE0OjdkN2ExYzQ1MzQ5NDRiM2MwZTI3OTFlY2EzOGZkN2ZhMjYyOTQyMzg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcTNtKGAH2gAyMzk2NDgxNTE0OjEyYjM0ZTk0MmQwZGUzNmZkM2VmOTZlNTVlNjliZjA3YWZiZDM5OTU=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "7d7a1c4534944b3c0e2791eca38fd7fa26294238", "author": {"user": {"login": "lcawl", "name": "Lisa Cawley"}}, "url": "https://github.com/elastic/elasticsearch/commit/7d7a1c4534944b3c0e2791eca38fd7fa26294238", "committedDate": "2020-03-31T17:20:41Z", "message": "[DOCS] Clarify API key breaking change"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fb195a1260ed860e9304dc0286aa06ed9f16a60b", "author": {"user": {"login": "lcawl", "name": "Lisa Cawley"}}, "url": "https://github.com/elastic/elasticsearch/commit/fb195a1260ed860e9304dc0286aa06ed9f16a60b", "committedDate": "2020-03-31T17:24:24Z", "message": "[DOCS] More edits"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg0OTUzMjYx", "url": "https://github.com/elastic/elasticsearch/pull/54522#pullrequestreview-384953261", "createdAt": "2020-03-31T17:30:12Z", "commit": {"oid": "fb195a1260ed860e9304dc0286aa06ed9f16a60b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMVQxNzozMDoxMlrOF-gkpA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMVQxNzozMDoxMlrOF-gkpA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTA4OTcwMA==", "bodyText": "by default it had no privileges...\n\nThe documentation for the create API key API (https://www.elastic.co/guide/en/elasticsearch/reference/master/security-api-create-api-key.html) says \"When [role_descriptors] is not specified or is an empty array, then the API key will have a point in time snapshot of permissions of the authenticated user. If you supply role descriptors then the resultant permissions would be an intersection of API keys permissions and authenticated user\u2019s permissions thereby limiting the access scope for API keys...\".  Is that still correct?  Or does it need a clarification that this behaviour differs when you're creating a derived key?", "url": "https://github.com/elastic/elasticsearch/pull/54522#discussion_r401089700", "createdAt": "2020-03-31T17:30:12Z", "author": {"login": "lcawl"}, "path": "docs/reference/migration/migrate_7_6.asciidoc", "diffHunk": "@@ -14,12 +14,43 @@ See also <<release-highlights>> and <<es-release-notes>>.\n //Installation and Upgrade Guide\n \n //tag::notable-breaking-changes[]\n+[discrete]\n+[[breaking_76_security_changes]]\n+=== Security changes\n+\n+[discrete]\n+==== {es} authentication API key privileges\n+\n+If you use the {es} API key service to generate API keys, the behavior of new\n+API keys is impacted by the fix for\n+https://www.elastic.co/community/security[CVE-2020-7009].\n+\n+When you make a request to create API keys, you can specify an expiration and\n+permissions for the API key. Previously, if you used an API key to create\n+another API key (sometimes called a _derived key_), by default it had no\n+privileges. It could nonetheless perform some operations such as running", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fb195a1260ed860e9304dc0286aa06ed9f16a60b"}, "originalPosition": 18}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b1387ac2a593a9618a92b08d7030882676a3bb3e", "author": {"user": {"login": "lcawl", "name": "Lisa Cawley"}}, "url": "https://github.com/elastic/elasticsearch/commit/b1387ac2a593a9618a92b08d7030882676a3bb3e", "committedDate": "2020-03-31T17:36:14Z", "message": "[DOCS] Skips snippet test"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg1MTM5NTM2", "url": "https://github.com/elastic/elasticsearch/pull/54522#pullrequestreview-385139536", "createdAt": "2020-03-31T22:07:50Z", "commit": {"oid": "b1387ac2a593a9618a92b08d7030882676a3bb3e"}, "state": "COMMENTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMVQyMjowNzo1MVrOF-qAhQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMVQyMjoxMzo1NFrOF-qKhQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTI0NDI5Mw==", "bodyText": "Should we be more explicity about the previous behaviour? that is the derived key had no privilege regardless of the role descriptors specified at creation time", "url": "https://github.com/elastic/elasticsearch/pull/54522#discussion_r401244293", "createdAt": "2020-03-31T22:07:51Z", "author": {"login": "ywangd"}, "path": "docs/reference/migration/migrate_7_6.asciidoc", "diffHunk": "@@ -14,12 +14,44 @@ See also <<release-highlights>> and <<es-release-notes>>.\n //Installation and Upgrade Guide\n \n //tag::notable-breaking-changes[]\n+[discrete]\n+[[breaking_76_security_changes]]\n+=== Security changes\n+\n+[discrete]\n+==== {es} authentication API key privileges\n+\n+If you use the {es} API key service to generate API keys, the behavior of new\n+API keys is impacted by the fix for\n+https://www.elastic.co/community/security[CVE-2020-7009].\n+\n+When you make a request to create API keys, you can specify an expiration and\n+permissions for the API key. Previously, if you used an API key to create\n+another API key (sometimes called a _derived key_), by default it had no", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b1387ac2a593a9618a92b08d7030882676a3bb3e"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTI0NDk3MQ==", "bodyText": "Is it possible or necessary to emphasize in the beginning that the change only impact derived keys? Since most users are probably not using them and they can skip the details.", "url": "https://github.com/elastic/elasticsearch/pull/54522#discussion_r401244971", "createdAt": "2020-03-31T22:09:25Z", "author": {"login": "ywangd"}, "path": "docs/reference/migration/migrate_7_6.asciidoc", "diffHunk": "@@ -14,12 +14,44 @@ See also <<release-highlights>> and <<es-release-notes>>.\n //Installation and Upgrade Guide\n \n //tag::notable-breaking-changes[]\n+[discrete]\n+[[breaking_76_security_changes]]\n+=== Security changes\n+\n+[discrete]\n+==== {es} authentication API key privileges\n+\n+If you use the {es} API key service to generate API keys, the behavior of new\n+API keys is impacted by the fix for\n+https://www.elastic.co/community/security[CVE-2020-7009].\n+\n+When you make a request to create API keys, you can specify an expiration and", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b1387ac2a593a9618a92b08d7030882676a3bb3e"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTI0NTgzOA==", "bodyText": "It's called \"child\" keys here. Probably better to use a consistent name. I have no preference over either \"derived\" or \"child\" keys.", "url": "https://github.com/elastic/elasticsearch/pull/54522#discussion_r401245838", "createdAt": "2020-03-31T22:11:32Z", "author": {"login": "ywangd"}, "path": "docs/reference/release-notes/7.6.asciidoc", "diffHunk": "@@ -3,6 +3,13 @@\n \n Also see <<breaking-changes-7.6,Breaking changes in 7.6>>.\n \n+[[breaking-7.6.2]]\n+[float]\n+=== Breaking changes\n+\n+Authorization::\n+* Creation of child API keys (keys created by existing keys) now requires explicit \"no privileges\" configuration {pull}53647[#53647], https://www.elastic.co/community/security[CVE-2020-7009]", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b1387ac2a593a9618a92b08d7030882676a3bb3e"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTI0Njg1Mw==", "bodyText": "The word \"authentication\" does not seem to be necessary here. Also privileges are in the scope of authorization.", "url": "https://github.com/elastic/elasticsearch/pull/54522#discussion_r401246853", "createdAt": "2020-03-31T22:13:54Z", "author": {"login": "ywangd"}, "path": "docs/reference/migration/migrate_7_6.asciidoc", "diffHunk": "@@ -14,12 +14,44 @@ See also <<release-highlights>> and <<es-release-notes>>.\n //Installation and Upgrade Guide\n \n //tag::notable-breaking-changes[]\n+[discrete]\n+[[breaking_76_security_changes]]\n+=== Security changes\n+\n+[discrete]\n+==== {es} authentication API key privileges", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b1387ac2a593a9618a92b08d7030882676a3bb3e"}, "originalPosition": 9}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ce0a26f7fcc8414412574fdc2034c50cdf0f6470", "author": {"user": {"login": "lcawl", "name": "Lisa Cawley"}}, "url": "https://github.com/elastic/elasticsearch/commit/ce0a26f7fcc8414412574fdc2034c50cdf0f6470", "committedDate": "2020-04-01T01:04:52Z", "message": "[DOCS] Addresses feedback"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg1MjEyMzMz", "url": "https://github.com/elastic/elasticsearch/pull/54522#pullrequestreview-385212333", "createdAt": "2020-04-01T01:36:04Z", "commit": {"oid": "ce0a26f7fcc8414412574fdc2034c50cdf0f6470"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMVQwMTozNjowNFrOF-t4jQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMVQwMTozNjowNFrOF-t4jQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTMwNzc4OQ==", "bodyText": "The role_descriptors is technically an object not an array.", "url": "https://github.com/elastic/elasticsearch/pull/54522#discussion_r401307789", "createdAt": "2020-04-01T01:36:04Z", "author": {"login": "ywangd"}, "path": "docs/reference/migration/migrate_7_6.asciidoc", "diffHunk": "@@ -14,12 +14,42 @@ See also <<release-highlights>> and <<es-release-notes>>.\n //Installation and Upgrade Guide\n \n //tag::notable-breaking-changes[]\n+[discrete]\n+[[breaking_76_security_changes]]\n+=== Security changes\n+\n+[discrete]\n+==== {es} API key privileges\n+\n+If you use an API key to create another API key (sometimes called a\n+_derived key_), its behavior is impacted by the fix for\n+https://www.elastic.co/community/security[CVE-2020-7009].\n+\n+When you make a request to create API keys, you can specify an expiration and\n+privileges for the API key. Previously, when you created a derived key, it had\n+no privileges. This behavior disregarded any privileges that you specified in\n+the {ref}/security-api-create-api-key.html[create API key API].\n+\n+As of 7.6.2, this behavior changes. To create derived keys with no privileges,\n+you must explicitly specify an empty object in the `role_descriptors` array.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ce0a26f7fcc8414412574fdc2034c50cdf0f6470"}, "originalPosition": 21}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg1MjE0MDU2", "url": "https://github.com/elastic/elasticsearch/pull/54522#pullrequestreview-385214056", "createdAt": "2020-04-01T01:42:43Z", "commit": {"oid": "ce0a26f7fcc8414412574fdc2034c50cdf0f6470"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "12b34e942d0de36fd3ef96e55e69bf07afbd3995", "author": {"user": {"login": "lcawl", "name": "Lisa Cawley"}}, "url": "https://github.com/elastic/elasticsearch/commit/12b34e942d0de36fd3ef96e55e69bf07afbd3995", "committedDate": "2020-04-01T01:48:44Z", "message": "[DOCS] Clarify role descriptor object"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1404, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}