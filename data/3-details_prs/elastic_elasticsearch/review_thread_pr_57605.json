{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDI3MjQ3MDE4", "number": 57605, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wM1QxNDo0Njo0M1rOECL-yw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wM1QxNDo0Njo0M1rOECL-yw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcwNzI4OTA3OnYy", "diffSide": "RIGHT", "path": "x-pack/plugin/ql/src/main/java/org/elasticsearch/xpack/ql/expression/function/scalar/ScalarFunction.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wM1QxNDo0Njo0M1rOGefXQQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wM1QxNDo1MDoxOFrOGefh6g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDYyNDMyMQ==", "bodyText": "Shouldn't we remove this method as currently there is no such case that a groupingfunction (actually histogram) results into a script?", "url": "https://github.com/elastic/elasticsearch/pull/57605#discussion_r434624321", "createdAt": "2020-06-03T14:46:43Z", "author": {"login": "matriv"}, "path": "x-pack/plugin/ql/src/main/java/org/elasticsearch/xpack/ql/expression/function/scalar/ScalarFunction.java", "diffHunk": "@@ -108,19 +109,28 @@ protected ScriptTemplate scriptWithScalar(ScalarFunction scalar) {\n     }\n     \n     protected ScriptTemplate scriptWithAggregate(AggregateFunction aggregate) {\n-        String template = \"{}\";\n+        String template = basicTemplate(aggregate);\n         return new ScriptTemplate(processScript(template),\n                 paramsBuilder().agg(aggregate).build(),\n                 dataType());\n     }\n \n     protected ScriptTemplate scriptWithGrouping(GroupingFunction grouping) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f6a4d6730157fdf37e48c8deadaa7b9372651c36"}, "originalPosition": 19}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDYyNTUxNw==", "bodyText": "Chose to keep it there since, before the bug was introduced, the code was using asDateTime for grouping functions, as well.", "url": "https://github.com/elastic/elasticsearch/pull/57605#discussion_r434625517", "createdAt": "2020-06-03T14:48:19Z", "author": {"login": "astefan"}, "path": "x-pack/plugin/ql/src/main/java/org/elasticsearch/xpack/ql/expression/function/scalar/ScalarFunction.java", "diffHunk": "@@ -108,19 +109,28 @@ protected ScriptTemplate scriptWithScalar(ScalarFunction scalar) {\n     }\n     \n     protected ScriptTemplate scriptWithAggregate(AggregateFunction aggregate) {\n-        String template = \"{}\";\n+        String template = basicTemplate(aggregate);\n         return new ScriptTemplate(processScript(template),\n                 paramsBuilder().agg(aggregate).build(),\n                 dataType());\n     }\n \n     protected ScriptTemplate scriptWithGrouping(GroupingFunction grouping) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDYyNDMyMQ=="}, "originalCommit": {"oid": "f6a4d6730157fdf37e48c8deadaa7b9372651c36"}, "originalPosition": 19}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDYyNzA1MA==", "bodyText": "Would you mind adding a comment then, please, to avoid pursuing it again in the future?", "url": "https://github.com/elastic/elasticsearch/pull/57605#discussion_r434627050", "createdAt": "2020-06-03T14:50:18Z", "author": {"login": "matriv"}, "path": "x-pack/plugin/ql/src/main/java/org/elasticsearch/xpack/ql/expression/function/scalar/ScalarFunction.java", "diffHunk": "@@ -108,19 +109,28 @@ protected ScriptTemplate scriptWithScalar(ScalarFunction scalar) {\n     }\n     \n     protected ScriptTemplate scriptWithAggregate(AggregateFunction aggregate) {\n-        String template = \"{}\";\n+        String template = basicTemplate(aggregate);\n         return new ScriptTemplate(processScript(template),\n                 paramsBuilder().agg(aggregate).build(),\n                 dataType());\n     }\n \n     protected ScriptTemplate scriptWithGrouping(GroupingFunction grouping) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDYyNDMyMQ=="}, "originalCommit": {"oid": "f6a4d6730157fdf37e48c8deadaa7b9372651c36"}, "originalPosition": 19}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3646, "cost": 1, "resetAt": "2021-11-12T13:16:51Z"}}}