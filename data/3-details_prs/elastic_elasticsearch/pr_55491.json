{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA2Mjg4MzU0", "number": 55491, "title": "Use official checksums to verify Tini", "bodyText": "This PR introduces using the official checksums published by Tini.\nMore information in issue #55490\nCloses #55490", "createdAt": "2020-04-20T20:35:47Z", "url": "https://github.com/elastic/elasticsearch/pull/55491", "merged": true, "mergeCommit": {"oid": "f7e705dc337b4049981f58f9d0fca30e9f1c230d"}, "closed": true, "closedAt": "2020-04-24T10:17:23Z", "author": {"login": "james-crowley"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcXSTr4AH2gAyNDA2Mjg4MzU0OjA2N2ZiNTljMDFiOTNiODZlMjI0MWNmMjJiNGY0YjkxYWFjNzRhZTU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcaeQ1PgFqTM5OTE5MTQwMQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "067fb59c01b93b86e2241cf22b4f4b91aac74ae5", "author": {"user": null}, "url": "https://github.com/elastic/elasticsearch/commit/067fb59c01b93b86e2241cf22b4f4b91aac74ae5", "committedDate": "2020-04-13T17:26:08Z", "message": "Merge pull request #1 from elastic/master\n\nMerge Remote Tracking Branch"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9875a820f1acb8547f3b7fea7c5ea9ec438d3088", "author": {"user": null}, "url": "https://github.com/elastic/elasticsearch/commit/9875a820f1acb8547f3b7fea7c5ea9ec438d3088", "committedDate": "2020-04-20T17:01:32Z", "message": "Merge pull request #3 from elastic/master\n\nMerge Remote Tracking Branch"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "57fc36493755db94a898c091f3de53a4f51cac1e", "author": {"user": null}, "url": "https://github.com/elastic/elasticsearch/commit/57fc36493755db94a898c091f3de53a4f51cac1e", "committedDate": "2020-04-20T19:36:47Z", "message": "Removed generated tini SHAs and now pull from SHAs uploaded to releases for tini"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk3NTI2ODA3", "url": "https://github.com/elastic/elasticsearch/pull/55491#pullrequestreview-397526807", "createdAt": "2020-04-21T17:36:06Z", "commit": {"oid": "57fc36493755db94a898c091f3de53a4f51cac1e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMVQxNzozNjowNlrOGJQNTg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMVQxNzozNjowNlrOGJQNTg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjM1NTkxOA==", "bodyText": "@jasontedor Question for you, since centos uses manifests for their Docker builds pulling from the specific arch is unneeded. Was there another reason to directly pull from arm64v8/centos:7? Or would pulling from centos:7 work? You can see the manifests/archs that Centos supports here, https://hub.docker.com/_/centos?tab=tags.", "url": "https://github.com/elastic/elasticsearch/pull/55491#discussion_r412355918", "createdAt": "2020-04-21T17:36:06Z", "author": {"login": "james-crowley"}, "path": "distribution/docker/build.gradle", "diffHunk": "@@ -38,13 +38,12 @@ ext.expansions = { architecture, oss, local ->\n   final String classifier = \"aarch64\".equals(architecture) ? \"linux-aarch64\" : \"linux-x86_64\"\n   final String elasticsearch = oss ? \"elasticsearch-oss-${VersionProperties.elasticsearch}-${classifier}.tar.gz\" : \"elasticsearch-${VersionProperties.elasticsearch}-${classifier}.tar.gz\"\n   return [\n-    'base_image'          : \"aarch64\".equals(architecture) ? \"arm64v8/centos:7\" : \"centos:7\",\n+    'base_image'          : \"centos:7\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "57fc36493755db94a898c091f3de53a4f51cac1e"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk3OTY0NTk2", "url": "https://github.com/elastic/elasticsearch/pull/55491#pullrequestreview-397964596", "createdAt": "2020-04-22T08:34:11Z", "commit": {"oid": "57fc36493755db94a898c091f3de53a4f51cac1e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMlQwODozNDoxMVrOGJqVqQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMlQwODozNDoxMVrOGJqVqQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjc4NDA0MQ==", "bodyText": "Rather than installing a Debian packaging tool, let's replace the tini_suffix build variable with tini_arch, and populate it with amd64 or arm64 as appropriate.", "url": "https://github.com/elastic/elasticsearch/pull/55491#discussion_r412784041", "createdAt": "2020-04-22T08:34:11Z", "author": {"login": "pugnascotia"}, "path": "distribution/docker/src/docker/Dockerfile", "diffHunk": "@@ -14,7 +14,7 @@\n FROM ${base_image} AS builder\n \n RUN for iter in {1..10}; do yum update --setopt=tsflags=nodocs -y && \\\n-    yum install --setopt=tsflags=nodocs -y gzip shadow-utils tar && \\\n+    yum install --setopt=tsflags=nodocs -y epel-release && yum install --setopt=tsflags=nodocs -y dpkg wget gzip shadow-utils tar && \\", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "57fc36493755db94a898c091f3de53a4f51cac1e"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk3OTY1OTMz", "url": "https://github.com/elastic/elasticsearch/pull/55491#pullrequestreview-397965933", "createdAt": "2020-04-22T08:35:50Z", "commit": {"oid": "57fc36493755db94a898c091f3de53a4f51cac1e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMlQwODozNTo1MVrOGJqaLg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMlQwODozNTo1MVrOGJqaLg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjc4NTE5OA==", "bodyText": "I don't feel comfortable with not checking the certificate here. Is there any particular reason for using this flag?", "url": "https://github.com/elastic/elasticsearch/pull/55491#discussion_r412785198", "createdAt": "2020-04-22T08:35:51Z", "author": {"login": "pugnascotia"}, "path": "distribution/docker/src/docker/Dockerfile", "diffHunk": "@@ -40,11 +40,13 @@ RUN chmod 0660 config/elasticsearch.yml config/log4j2.properties\n #\n # The tini GitHub page gives instructions for verifying the binary using\n # gpg, but the keyservers are slow to return the key and this can fail the\n-# build. Instead, we check the binary against a checksum that we have\n-# computed.\n-ADD https://github.com/krallin/tini/releases/download/v0.18.0/tini${tini_suffix} /tini\n-COPY config/tini${tini_suffix}.sha512 /tini.sha512\n-RUN sha512sum -c /tini.sha512 && chmod +x /tini\n+# build. Instead, we check the binary against a checksum that they provide.\n+RUN wget --no-check-certificate --no-cookies --quiet https://github.com/krallin/tini/releases/download/v0.19.0/tini-\\$(dpkg --print-architecture) \\", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "57fc36493755db94a898c091f3de53a4f51cac1e"}, "originalPosition": 19}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk3OTY3NDMz", "url": "https://github.com/elastic/elasticsearch/pull/55491#pullrequestreview-397967433", "createdAt": "2020-04-22T08:37:41Z", "commit": {"oid": "57fc36493755db94a898c091f3de53a4f51cac1e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMlQwODozNzo0MVrOGJqfWw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMlQwODozNzo0MVrOGJqfWw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjc4NjUyMw==", "bodyText": "Assuming we add a tini_arch variable, how about:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                && echo \"\\$(cat tini-\\$(dpkg --print-architecture).sha256sum)\" | sha256sum -c \\\n          \n          \n            \n                && sha256sum -c tini-${tini_arch}.sha256sum \\", "url": "https://github.com/elastic/elasticsearch/pull/55491#discussion_r412786523", "createdAt": "2020-04-22T08:37:41Z", "author": {"login": "pugnascotia"}, "path": "distribution/docker/src/docker/Dockerfile", "diffHunk": "@@ -40,11 +40,13 @@ RUN chmod 0660 config/elasticsearch.yml config/log4j2.properties\n #\n # The tini GitHub page gives instructions for verifying the binary using\n # gpg, but the keyservers are slow to return the key and this can fail the\n-# build. Instead, we check the binary against a checksum that we have\n-# computed.\n-ADD https://github.com/krallin/tini/releases/download/v0.18.0/tini${tini_suffix} /tini\n-COPY config/tini${tini_suffix}.sha512 /tini.sha512\n-RUN sha512sum -c /tini.sha512 && chmod +x /tini\n+# build. Instead, we check the binary against a checksum that they provide.\n+RUN wget --no-check-certificate --no-cookies --quiet https://github.com/krallin/tini/releases/download/v0.19.0/tini-\\$(dpkg --print-architecture) \\\n+    && wget --no-check-certificate --no-cookies --quiet https://github.com/krallin/tini/releases/download/v0.19.0/tini-\\$(dpkg --print-architecture).sha256sum \\\n+    && echo \"\\$(cat tini-\\$(dpkg --print-architecture).sha256sum)\" | sha256sum -c \\", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "57fc36493755db94a898c091f3de53a4f51cac1e"}, "originalPosition": 21}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk3OTY3Njgy", "url": "https://github.com/elastic/elasticsearch/pull/55491#pullrequestreview-397967682", "createdAt": "2020-04-22T08:37:59Z", "commit": {"oid": "57fc36493755db94a898c091f3de53a4f51cac1e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMlQwODozNzo1OVrOGJqgNA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMlQwODozNzo1OVrOGJqgNA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjc4Njc0MA==", "bodyText": "There's no need to remove the checksum, since this is just the builder image.", "url": "https://github.com/elastic/elasticsearch/pull/55491#discussion_r412786740", "createdAt": "2020-04-22T08:37:59Z", "author": {"login": "pugnascotia"}, "path": "distribution/docker/src/docker/Dockerfile", "diffHunk": "@@ -40,11 +40,13 @@ RUN chmod 0660 config/elasticsearch.yml config/log4j2.properties\n #\n # The tini GitHub page gives instructions for verifying the binary using\n # gpg, but the keyservers are slow to return the key and this can fail the\n-# build. Instead, we check the binary against a checksum that we have\n-# computed.\n-ADD https://github.com/krallin/tini/releases/download/v0.18.0/tini${tini_suffix} /tini\n-COPY config/tini${tini_suffix}.sha512 /tini.sha512\n-RUN sha512sum -c /tini.sha512 && chmod +x /tini\n+# build. Instead, we check the binary against a checksum that they provide.\n+RUN wget --no-check-certificate --no-cookies --quiet https://github.com/krallin/tini/releases/download/v0.19.0/tini-\\$(dpkg --print-architecture) \\\n+    && wget --no-check-certificate --no-cookies --quiet https://github.com/krallin/tini/releases/download/v0.19.0/tini-\\$(dpkg --print-architecture).sha256sum \\\n+    && echo \"\\$(cat tini-\\$(dpkg --print-architecture).sha256sum)\" | sha256sum -c \\\n+    && rm -f tini-\\$(dpkg --print-architecture).sha256sum \\", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "57fc36493755db94a898c091f3de53a4f51cac1e"}, "originalPosition": 22}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "73af316fa444ff789a28ff2b2815d9fbbd485402", "author": {"user": null}, "url": "https://github.com/elastic/elasticsearch/commit/73af316fa444ff789a28ff2b2815d9fbbd485402", "committedDate": "2020-04-22T14:57:39Z", "message": "Utilize switch case for arch info and bring in changes suggested by pugnascotia"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8909ebc0dfd7ce28d01f4708a8dbfa47127e7760", "author": {"user": {"login": "elasticmachine", "name": "Elastic Machine"}}, "url": "https://github.com/elastic/elasticsearch/commit/8909ebc0dfd7ce28d01f4708a8dbfa47127e7760", "committedDate": "2020-04-23T10:41:52Z", "message": "Merge branch 'master' into tini_sha"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk5MTkxNDAx", "url": "https://github.com/elastic/elasticsearch/pull/55491#pullrequestreview-399191401", "createdAt": "2020-04-23T15:03:39Z", "commit": {"oid": "8909ebc0dfd7ce28d01f4708a8dbfa47127e7760"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 587, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}