{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDg4OTY4NzI1", "number": 62589, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xOFQxMzoxOToyOFrOEk93_A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xOFQxMzoyMjozMVrOEk98vw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA3MTk3OTQ4OnYy", "diffSide": "RIGHT", "path": "x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/cluster/routing/allocation/DataTierAllocationDecider.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xOFQxMzoxOToyOFrOHUMzhA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xOFQxMzoxOToyOFrOHUMzhA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDk0MzM2NA==", "bodyText": "would this be better named as preferedAvailableTier or preferedPresentTier?", "url": "https://github.com/elastic/elasticsearch/pull/62589#discussion_r490943364", "createdAt": "2020-09-18T13:19:28Z", "author": {"login": "andreidan"}, "path": "x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/cluster/routing/allocation/DataTierAllocationDecider.java", "diffHunk": "@@ -186,6 +231,29 @@ private Decision shouldClusterFilter(DiscoveryNode node, RoutingAllocation alloc\n         OR\n     }\n \n+    /**\n+     * Given a string of comma-separated prioritized tiers (highest priority\n+     * first) and an allocation, find the highest priority tier for which nodes\n+     * exist. If no nodes for any of the tiers are available, returns an empty\n+     * {@code Optional<String>}.\n+     */\n+    private static Optional<String> preferredTier(String prioritizedTiers, RoutingAllocation allocation) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "872f5e7f8d7711acbc0930eaeab2aa9651b36bf6"}, "originalPosition": 110}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA3MTk5MTY3OnYy", "diffSide": "RIGHT", "path": "x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/cluster/routing/allocation/DataTierAllocationDecider.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xOFQxMzoyMjozMVrOHUM6_g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xOFQxMzoyMjozMVrOHUM6_g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDk0NTI3OA==", "bodyText": "should we make both these methods as default visible and add unit tests?", "url": "https://github.com/elastic/elasticsearch/pull/62589#discussion_r490945278", "createdAt": "2020-09-18T13:22:31Z", "author": {"login": "andreidan"}, "path": "x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/cluster/routing/allocation/DataTierAllocationDecider.java", "diffHunk": "@@ -186,6 +231,29 @@ private Decision shouldClusterFilter(DiscoveryNode node, RoutingAllocation alloc\n         OR\n     }\n \n+    /**\n+     * Given a string of comma-separated prioritized tiers (highest priority\n+     * first) and an allocation, find the highest priority tier for which nodes\n+     * exist. If no nodes for any of the tiers are available, returns an empty\n+     * {@code Optional<String>}.\n+     */\n+    private static Optional<String> preferredTier(String prioritizedTiers, RoutingAllocation allocation) {\n+        String[] tiers = Strings.tokenizeToStringArray(prioritizedTiers, \",\");\n+        return Arrays.stream(tiers).filter(tier -> tierNodesPresent(tier, allocation)).findFirst();\n+    }\n+\n+    private static boolean tierNodesPresent(String singleTier, RoutingAllocation allocation) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "872f5e7f8d7711acbc0930eaeab2aa9651b36bf6"}, "originalPosition": 115}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3451, "cost": 1, "resetAt": "2021-11-12T13:16:51Z"}}}