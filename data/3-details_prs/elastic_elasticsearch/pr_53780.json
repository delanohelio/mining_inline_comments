{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzkwNzc0ODQx", "number": 53780, "title": "EQL: EqlActionIT improvements", "bodyText": "Move EqlActionIT to EQL QA project.\nUse HL client for EQL verification harness.\nImprove the speed of tests, setting the data once and reusing for each parameterized test.\nImprove naming for the tests, using \"description\" or \"note\" and falling back to \"query\".\nRelated to #53598", "createdAt": "2020-03-19T03:22:43Z", "url": "https://github.com/elastic/elasticsearch/pull/53780", "merged": true, "mergeCommit": {"oid": "065fc151d4b6848a1189f0ecfe62accf17e8f6ea"}, "closed": true, "closedAt": "2020-03-20T17:33:47Z", "author": {"login": "aleksmaus"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcPDTuCAFqTM3NzM5ODc5OA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcPg6uTgH2gAyMzkwNzc0ODQxOjE5NDQ0Y2U1MDc3ODkyNDVmNTg4ZTYxNGZhNmNjNzAwYTFiYzY3MzM=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc3Mzk4Nzk4", "url": "https://github.com/elastic/elasticsearch/pull/53780#pullrequestreview-377398798", "createdAt": "2020-03-19T03:26:11Z", "commit": {"oid": "d39adc551434f9b392a7825b5b0e543cfe1bd10a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOVQwMzoyNjoxMVrOF4e3Cg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOVQwMzoyNjoxMVrOF4e3Cg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDc3MDE4Ng==", "bodyText": "@costin I was not sure what to put in here, but now looks like I need these files for jtoml dependency verification task in EQL QA project.\nlet me know.", "url": "https://github.com/elastic/elasticsearch/pull/53780#discussion_r394770186", "createdAt": "2020-03-19T03:26:11Z", "author": {"login": "aleksmaus"}, "path": "x-pack/plugin/eql/qa/common/licenses/jtoml-NOTICE", "diffHunk": "@@ -0,0 +1,2 @@\n+jtoml\n+TOML Parser for Java", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d39adc551434f9b392a7825b5b0e543cfe1bd10a"}, "originalPosition": 2}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d39adc551434f9b392a7825b5b0e543cfe1bd10a", "author": {"user": {"login": "aleksmaus", "name": "Aleksandr Maus"}}, "url": "https://github.com/elastic/elasticsearch/commit/d39adc551434f9b392a7825b5b0e543cfe1bd10a", "committedDate": "2020-03-19T03:12:33Z", "message": "EQL: EqlActionIT improvements"}, "afterCommit": {"oid": "a592b9a1f3a933b94c6a88b412ff8249465be985", "author": {"user": {"login": "aleksmaus", "name": "Aleksandr Maus"}}, "url": "https://github.com/elastic/elasticsearch/commit/a592b9a1f3a933b94c6a88b412ff8249465be985", "committedDate": "2020-03-19T03:47:24Z", "message": "EQL: EqlActionIT improvements"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc3ODMxNzgw", "url": "https://github.com/elastic/elasticsearch/pull/53780#pullrequestreview-377831780", "createdAt": "2020-03-19T15:28:05Z", "commit": {"oid": "a592b9a1f3a933b94c6a88b412ff8249465be985"}, "state": "COMMENTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOVQxNToyODowNVrOF4z0lA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOVQxNzowOToyOFrOF44Ojg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTExMzYyMA==", "bodyText": "Simply add the license from the jar - no need to modify it to add copyright or something else.", "url": "https://github.com/elastic/elasticsearch/pull/53780#discussion_r395113620", "createdAt": "2020-03-19T15:28:05Z", "author": {"login": "costin"}, "path": "x-pack/plugin/eql/qa/common/licenses/jtoml-LICENSE", "diffHunk": "@@ -0,0 +1,13 @@\n+Copyright 2013 asafh, ous.io", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a592b9a1f3a933b94c6a88b412ff8249465be985"}, "originalPosition": 1}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTE2Njk0NQ==", "bodyText": "If the library doesn't have a NOTICE file, then I don't think you need to add one.", "url": "https://github.com/elastic/elasticsearch/pull/53780#discussion_r395166945", "createdAt": "2020-03-19T16:42:02Z", "author": {"login": "costin"}, "path": "x-pack/plugin/eql/qa/common/licenses/jtoml-NOTICE", "diffHunk": "@@ -0,0 +1,2 @@\n+jtoml\n+TOML Parser for Java", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDc3MDE4Ng=="}, "originalCommit": {"oid": "d39adc551434f9b392a7825b5b0e543cfe1bd10a"}, "originalPosition": 2}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTE2NzE5Nw==", "bodyText": "Why synchronized?", "url": "https://github.com/elastic/elasticsearch/pull/53780#discussion_r395167197", "createdAt": "2020-03-19T16:42:24Z", "author": {"login": "costin"}, "path": "x-pack/plugin/eql/qa/common/src/main/java/org/elasticsearch/test/eql/CommonEqlActionTestCase.java", "diffHunk": "@@ -39,13 +46,20 @@ public static void checkForSnapshot() {\n         assumeTrue(\"Only works on snapshot builds for now\", Build.CURRENT.isSnapshot());\n     }\n \n-    @Before\n+    private static boolean isSetUp = false;\n+    private static int counter = 0;\n+\n     @SuppressWarnings(\"unchecked\")\n-    public void setUpData() throws Exception {\n-        // Insert test data\n-        ObjectMapper mapper = new ObjectMapper();\n-        BulkRequestBuilder bulkBuilder = client().prepareBulk();\n-        try (XContentParser parser = createParser(JsonXContent.jsonXContent, EqlActionIT.class.getResourceAsStream(\"/test_data.json\"))) {\n+    private static synchronized void setupData(CommonEqlActionTestCase tc) throws Exception {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a592b9a1f3a933b94c6a88b412ff8249465be985"}, "originalPosition": 57}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTE4NTgwNg==", "bodyText": "You could use the approach used in SQL:\n  \n    \n      elasticsearch/x-pack/plugin/sql/qa/src/main/java/org/elasticsearch/xpack/sql/qa/jdbc/SpecBaseIntegrationTestCase.java\n    \n    \n         Line 60\n      in\n      8279f82\n    \n    \n    \n    \n\n        \n          \n           public void setupTestDataIfNeeded() throws Exception { \n        \n    \n  \n\n, that is on each test check whether the index exists - if it doesn't load the data, otherwise ignore it.\nAnd wipe the data in a @AfterClass. Note that you could do the loading inside @BeforeClass as well if there are no modifications to the index at all.", "url": "https://github.com/elastic/elasticsearch/pull/53780#discussion_r395185806", "createdAt": "2020-03-19T17:09:28Z", "author": {"login": "costin"}, "path": "x-pack/plugin/eql/qa/common/src/main/java/org/elasticsearch/test/eql/CommonEqlActionTestCase.java", "diffHunk": "@@ -39,13 +46,20 @@ public static void checkForSnapshot() {\n         assumeTrue(\"Only works on snapshot builds for now\", Build.CURRENT.isSnapshot());\n     }\n \n-    @Before\n+    private static boolean isSetUp = false;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a592b9a1f3a933b94c6a88b412ff8249465be985"}, "originalPosition": 48}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c8a4cc02304f9221c2f3a4fd72cd3372e58f02f3", "author": {"user": {"login": "aleksmaus", "name": "Aleksandr Maus"}}, "url": "https://github.com/elastic/elasticsearch/commit/c8a4cc02304f9221c2f3a4fd72cd3372e58f02f3", "committedDate": "2020-03-19T17:44:24Z", "message": "EQL: EqlActionIT improvements"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a592b9a1f3a933b94c6a88b412ff8249465be985", "author": {"user": {"login": "aleksmaus", "name": "Aleksandr Maus"}}, "url": "https://github.com/elastic/elasticsearch/commit/a592b9a1f3a933b94c6a88b412ff8249465be985", "committedDate": "2020-03-19T03:47:24Z", "message": "EQL: EqlActionIT improvements"}, "afterCommit": {"oid": "c8a4cc02304f9221c2f3a4fd72cd3372e58f02f3", "author": {"user": {"login": "aleksmaus", "name": "Aleksandr Maus"}}, "url": "https://github.com/elastic/elasticsearch/commit/c8a4cc02304f9221c2f3a4fd72cd3372e58f02f3", "committedDate": "2020-03-19T17:44:24Z", "message": "EQL: EqlActionIT improvements"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a358264353b5af6feeadbaeaf8aa1a7b49d72779", "author": {"user": {"login": "aleksmaus", "name": "Aleksandr Maus"}}, "url": "https://github.com/elastic/elasticsearch/commit/a358264353b5af6feeadbaeaf8aa1a7b49d72779", "committedDate": "2020-03-19T19:10:55Z", "message": "Update jtoml-LICENSE and jtom-NOTICE files content"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc4NDcwNTUx", "url": "https://github.com/elastic/elasticsearch/pull/53780#pullrequestreview-378470551", "createdAt": "2020-03-20T13:15:08Z", "commit": {"oid": "a358264353b5af6feeadbaeaf8aa1a7b49d72779"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "19444ce507789245f588e614fa6cc700a1bc6733", "author": {"user": {"login": "aleksmaus", "name": "Aleksandr Maus"}}, "url": "https://github.com/elastic/elasticsearch/commit/19444ce507789245f588e614fa6cc700a1bc6733", "committedDate": "2020-03-20T13:56:03Z", "message": "Remove 'synchronize' locks  on the tests data setup/teardown per code review request."}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2045, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}