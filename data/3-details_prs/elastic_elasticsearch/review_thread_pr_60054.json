{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDU1MTk1OTU5", "number": 60054, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMlQxNTozNDo1MlrOERGfHA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMlQxNTozNDo1MlrOERGfHA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg2MzY3NTE2OnYy", "diffSide": "RIGHT", "path": "x-pack/plugin/ccr/src/main/java/org/elasticsearch/xpack/ccr/action/ShardFollowTasksExecutor.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMlQxNTozNDo1MlrOG1oGnQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMlQxNjoyNTo1MVrOG1qWTA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODg4NDc2NQ==", "bodyText": "I am not sure if we should remove this validation. Should we be able to create a follow task while some follower shards are temporarily unavailable?", "url": "https://github.com/elastic/elasticsearch/pull/60054#discussion_r458884765", "createdAt": "2020-07-22T15:34:52Z", "author": {"login": "dnhatn"}, "path": "x-pack/plugin/ccr/src/main/java/org/elasticsearch/xpack/ccr/action/ShardFollowTasksExecutor.java", "diffHunk": "@@ -111,9 +112,10 @@ public ShardFollowTasksExecutor(Client client,\n \n     @Override\n     public void validate(ShardFollowTask params, ClusterState clusterState) {\n-        IndexRoutingTable routingTable = clusterState.getRoutingTable().index(params.getFollowShardId().getIndex());\n-        if (routingTable.shard(params.getFollowShardId().id()).primaryShard().started() == false) {\n-            throw new IllegalArgumentException(\"Not all copies of follow shard are started\");\n+        final IndexRoutingTable routingTable = clusterState.getRoutingTable().index(params.getFollowShardId().getIndex());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5ff6ff0c7a1f86407d804e788d5e1746f075a31d"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODkyMTU0OA==", "bodyText": "yeah, I'm not sure either what the point of this validation is at this specific point in the code (maybe @martijnvg can help with that). It forces retry behavior upstream for \"put follow\" and \"resume follow\" to be resilient.", "url": "https://github.com/elastic/elasticsearch/pull/60054#discussion_r458921548", "createdAt": "2020-07-22T16:25:51Z", "author": {"login": "ywelsch"}, "path": "x-pack/plugin/ccr/src/main/java/org/elasticsearch/xpack/ccr/action/ShardFollowTasksExecutor.java", "diffHunk": "@@ -111,9 +112,10 @@ public ShardFollowTasksExecutor(Client client,\n \n     @Override\n     public void validate(ShardFollowTask params, ClusterState clusterState) {\n-        IndexRoutingTable routingTable = clusterState.getRoutingTable().index(params.getFollowShardId().getIndex());\n-        if (routingTable.shard(params.getFollowShardId().id()).primaryShard().started() == false) {\n-            throw new IllegalArgumentException(\"Not all copies of follow shard are started\");\n+        final IndexRoutingTable routingTable = clusterState.getRoutingTable().index(params.getFollowShardId().getIndex());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODg4NDc2NQ=="}, "originalCommit": {"oid": "5ff6ff0c7a1f86407d804e788d5e1746f075a31d"}, "originalPosition": 15}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2107, "cost": 1, "resetAt": "2021-11-12T11:57:46Z"}}}