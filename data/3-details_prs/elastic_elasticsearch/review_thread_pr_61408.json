{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDcxNTM2MDk1", "number": 61408, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMVQxMDoyMToyN1rOEa6d1w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMVQxMDoyMToyN1rOEa6d1w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk2NjU2MzQzOnYy", "diffSide": "RIGHT", "path": "server/src/test/java/org/elasticsearch/transport/RemoteClusterConnectionTests.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMVQxMDoyMToyN1rOHEn7aA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMVQxMDoyMToyN1rOHEn7aA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDYxMDUzNg==", "bodyText": "NIT: could we do a normal .get to not lose the full stack trace if this ever fails and maybe use 10s for the timeout just because we upped so many of these 5s ones to 10s+ eventually?", "url": "https://github.com/elastic/elasticsearch/pull/61408#discussion_r474610536", "createdAt": "2020-08-21T10:21:27Z", "author": {"login": "original-brownbear"}, "path": "server/src/test/java/org/elasticsearch/transport/RemoteClusterConnectionTests.java", "diffHunk": "@@ -462,6 +463,36 @@ public void testCollectNodes() throws Exception {\n         }\n     }\n \n+    public void testNoChannelsExceptREG() throws Exception {\n+        List<DiscoveryNode> knownNodes = new CopyOnWriteArrayList<>();\n+        try (MockTransportService seedTransport = startTransport(\"seed_node\", knownNodes, Version.CURRENT)) {\n+            DiscoveryNode seedNode = seedTransport.getLocalDiscoNode();\n+            knownNodes.add(seedTransport.getLocalDiscoNode());\n+            try (MockTransportService service = MockTransportService.createNewService(Settings.EMPTY, Version.CURRENT, threadPool, null)) {\n+                service.start();\n+                service.acceptIncomingRequests();\n+                String clusterAlias = \"test-cluster\";\n+                Settings settings = buildRandomSettings(clusterAlias, addresses(seedNode));\n+\n+                try (RemoteClusterConnection connection = new RemoteClusterConnection(settings, clusterAlias, service)) {\n+                    PlainActionFuture<Void> plainActionFuture = new PlainActionFuture<>();\n+                    connection.ensureConnected(plainActionFuture);\n+                    plainActionFuture.actionGet(5000);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f28468f9168c0cdb650e999188414943c1095756"}, "originalPosition": 26}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 899, "cost": 1, "resetAt": "2021-11-12T11:57:46Z"}}}