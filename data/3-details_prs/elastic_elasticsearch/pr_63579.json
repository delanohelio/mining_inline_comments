{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTAxODI3OTk3", "number": 63579, "title": "Fix Background Merge Breaking Snapshot Restore Test", "bodyText": "If we run into a background merge between creating the snapshot and closing the index\nthen with compound files we could be in a situation where we get zero file reuse\non restore.\nForce merging before the snapshot gives us a single segment that won't change down the line\nso the restore always sees file reuse from the close index.\nCloses #63476", "createdAt": "2020-10-12T21:26:40Z", "url": "https://github.com/elastic/elasticsearch/pull/63579", "merged": true, "mergeCommit": {"oid": "9cba9125558c2da75817d671a975ae97f6664bc3"}, "closed": true, "closedAt": "2020-10-13T12:39:02Z", "author": {"login": "original-brownbear"}, "timelineItems": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdR6yTPgH2gAyNTAxODI3OTk3OmQwOTM1NjdkNjg3ZDU3NTQ1NDRhM2VmMmM4OGU2ODUxMDZjNzMyOGU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdSHuEyAFqTUwNzM3NzM3NQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "d093567d687d5754544a3ef2c88e685106c7328e", "author": {"user": {"login": "original-brownbear", "name": "Armin Braun"}}, "url": "https://github.com/elastic/elasticsearch/commit/d093567d687d5754544a3ef2c88e685106c7328e", "committedDate": "2020-10-12T21:23:23Z", "message": "Fix Background Merge Breaking Snapshot Restore Test\n\nIf we run into a background merge between creating the snapshot and closing the index\nthen with compound files we could be in a situation where we get zero file reuse\non restore.\nForce merging before the snapshot gives us a single segment that won't change down the line\nso the restore always sees file reuse from the close index.\n\nCloses #63476"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA2OTI2NTQy", "url": "https://github.com/elastic/elasticsearch/pull/63579#pullrequestreview-506926542", "createdAt": "2020-10-12T21:27:31Z", "commit": {"oid": "d093567d687d5754544a3ef2c88e685106c7328e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xMlQyMToyNzozMVrOHgNqww==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xMlQyMToyNzozMVrOHgNqww==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzU0MDQxOQ==", "bodyText": "These are unnecessary, we already set this rebalance to none in the parent (AbstractSnapshotIntegTestCase)", "url": "https://github.com/elastic/elasticsearch/pull/63579#discussion_r503540419", "createdAt": "2020-10-12T21:27:31Z", "author": {"login": "original-brownbear"}, "path": "server/src/internalClusterTest/java/org/elasticsearch/snapshots/DedicatedClusterSnapshotRestoreIT.java", "diffHunk": "@@ -562,11 +561,8 @@ public void testRestoreIndexWithMissingShards() throws Exception {\n \n     public void testRestoreIndexWithShardsMissingInLocalGateway() throws Exception {\n         logger.info(\"--> start 2 nodes\");\n-        Settings nodeSettings = Settings.builder()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d093567d687d5754544a3ef2c88e685106c7328e"}, "originalPosition": 12}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA3Mzc3Mzc1", "url": "https://github.com/elastic/elasticsearch/pull/63579#pullrequestreview-507377375", "createdAt": "2020-10-13T12:27:32Z", "commit": {"oid": "d093567d687d5754544a3ef2c88e685106c7328e"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4072, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}