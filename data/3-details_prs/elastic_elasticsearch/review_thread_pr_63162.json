{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDk2NzY5NTUz", "number": 63162, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wN1QxNjoyNTo1NFrOErQoWQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wN1QxNjoyNTo1NFrOErQoWQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEzNzk2Njk3OnYy", "diffSide": "RIGHT", "path": "server/src/main/java/org/elasticsearch/cluster/metadata/MetadataIndexTemplateService.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wN1QxNjoyNTo1NFrOHd7mwA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOFQxMToyNDoyOVrOHeZ8lw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTE0NzMyOA==", "bodyText": "I actually don't think we should persist this one. Putting a template in place with is_write_index: true will be confusing because only a single index can be marked as the write index. I think we should instead throw an exception if alias.writeIndex() is set to true here (fail early rather than fail late)", "url": "https://github.com/elastic/elasticsearch/pull/63162#discussion_r501147328", "createdAt": "2020-10-07T16:25:54Z", "author": {"login": "dakrone"}, "path": "server/src/main/java/org/elasticsearch/cluster/metadata/MetadataIndexTemplateService.java", "diffHunk": "@@ -823,8 +823,13 @@ static ClusterState innerPutTemplate(final ClusterState currentState, PutRequest\n         }\n \n         for (Alias alias : request.aliases) {\n-            AliasMetadata aliasMetadata = AliasMetadata.builder(alias.name()).filter(alias.filter())\n-                .indexRouting(alias.indexRouting()).searchRouting(alias.searchRouting()).build();\n+            AliasMetadata aliasMetadata = AliasMetadata.builder(alias.name())\n+                .filter(alias.filter())\n+                .indexRouting(alias.indexRouting())\n+                .searchRouting(alias.searchRouting())\n+                .writeIndex(alias.writeIndex())", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e07ebac0ee11d6c2f24f6b44186a4f98a4572e46"}, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTY0NDQzOQ==", "bodyText": "Makes perfect sense. I added a validation against the alias having is_write_index: true and updated the tests", "url": "https://github.com/elastic/elasticsearch/pull/63162#discussion_r501644439", "createdAt": "2020-10-08T11:24:29Z", "author": {"login": "davidkyle"}, "path": "server/src/main/java/org/elasticsearch/cluster/metadata/MetadataIndexTemplateService.java", "diffHunk": "@@ -823,8 +823,13 @@ static ClusterState innerPutTemplate(final ClusterState currentState, PutRequest\n         }\n \n         for (Alias alias : request.aliases) {\n-            AliasMetadata aliasMetadata = AliasMetadata.builder(alias.name()).filter(alias.filter())\n-                .indexRouting(alias.indexRouting()).searchRouting(alias.searchRouting()).build();\n+            AliasMetadata aliasMetadata = AliasMetadata.builder(alias.name())\n+                .filter(alias.filter())\n+                .indexRouting(alias.indexRouting())\n+                .searchRouting(alias.searchRouting())\n+                .writeIndex(alias.writeIndex())", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTE0NzMyOA=="}, "originalCommit": {"oid": "e07ebac0ee11d6c2f24f6b44186a4f98a4572e46"}, "originalPosition": 10}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3223, "cost": 1, "resetAt": "2021-11-12T13:16:51Z"}}}