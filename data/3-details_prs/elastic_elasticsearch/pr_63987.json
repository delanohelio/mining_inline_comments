{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTA3NDY2NTYy", "number": 63987, "title": "Hidden data streams", "bodyText": "This change adds possibility to mark data stream as hidden. To use it you set usual \"index.hidden\":true setting in data stream template.\nThis change also relaxes naming convention for data streams - data stream can start with . but can't start with backing index prefix (.ds- currently) to avoid clashes.\nCloses #63889", "createdAt": "2020-10-21T11:34:25Z", "url": "https://github.com/elastic/elasticsearch/pull/63987", "merged": true, "mergeCommit": {"oid": "0e81fc641a827082ac2dd411c67f6f7519e39849"}, "closed": true, "closedAt": "2020-10-30T10:41:59Z", "author": {"login": "probakowski"}, "timelineItems": {"totalCount": 38, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdUrL_SAH2gAyNTA3NDY2NTYyOmQ3ZjA1YTFjOWU4YjIzODgwNTNjY2MxOWFmNDgzN2E3NzU1MjgyZTI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdXjylEgFqTUyMDUyMTAwNA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "d7f05a1c9e8b2388053ccc19af4837a7755282e2", "author": {"user": {"login": "probakowski", "name": "Przemko Robakowski"}}, "url": "https://github.com/elastic/elasticsearch/commit/d7f05a1c9e8b2388053ccc19af4837a7755282e2", "committedDate": "2020-10-21T10:54:44Z", "message": "Hidden data streams"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b182d368e25d0b4122f311e39ffb74407f7c3045", "author": {"user": {"login": "probakowski", "name": "Przemko Robakowski"}}, "url": "https://github.com/elastic/elasticsearch/commit/b182d368e25d0b4122f311e39ffb74407f7c3045", "committedDate": "2020-10-21T11:00:48Z", "message": "whitespace reverted"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "100dba5f3c9561a2e8bc5c52bffa5881c114b6c7", "author": {"user": {"login": "probakowski", "name": "Przemko Robakowski"}}, "url": "https://github.com/elastic/elasticsearch/commit/100dba5f3c9561a2e8bc5c52bffa5881c114b6c7", "committedDate": "2020-10-21T11:27:29Z", "message": "stricter ds name"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0d778f54aa069ed0763122630dcf6d41da48ccd2", "author": {"user": {"login": "probakowski", "name": "Przemko Robakowski"}}, "url": "https://github.com/elastic/elasticsearch/commit/0d778f54aa069ed0763122630dcf6d41da48ccd2", "committedDate": "2020-10-21T11:30:04Z", "message": "Revert \"stricter ds name\"\n\nThis reverts commit 100dba5f3c9561a2e8bc5c52bffa5881c114b6c7."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTEzNTg4MTcy", "url": "https://github.com/elastic/elasticsearch/pull/63987#pullrequestreview-513588172", "createdAt": "2020-10-21T11:47:56Z", "commit": {"oid": "0d778f54aa069ed0763122630dcf6d41da48ccd2"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "98e45c5229ed6dc52a4ad04f430c3256d8ef2c39", "author": {"user": {"login": "probakowski", "name": "Przemko Robakowski"}}, "url": "https://github.com/elastic/elasticsearch/commit/98e45c5229ed6dc52a4ad04f430c3256d8ef2c39", "committedDate": "2020-10-21T11:55:28Z", "message": "String.format removed"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTEzNjA0MDU0", "url": "https://github.com/elastic/elasticsearch/pull/63987#pullrequestreview-513604054", "createdAt": "2020-10-21T12:08:14Z", "commit": {"oid": "98e45c5229ed6dc52a4ad04f430c3256d8ef2c39"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cf74871a0b506ee4264a5ff3e33c27cfb2bbf113", "author": {"user": {"login": "probakowski", "name": "Przemko Robakowski"}}, "url": "https://github.com/elastic/elasticsearch/commit/cf74871a0b506ee4264a5ff3e33c27cfb2bbf113", "committedDate": "2020-10-21T15:00:03Z", "message": "fix test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a856a8f464f82f397319fbece6c95154fca51c87", "author": {"user": {"login": "probakowski", "name": "Przemko Robakowski"}}, "url": "https://github.com/elastic/elasticsearch/commit/a856a8f464f82f397319fbece6c95154fca51c87", "committedDate": "2020-10-21T21:44:47Z", "message": "fix GetDataStream action"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4a0e20d82c30988faacead6b4eb9b7d018655a11", "author": {"user": {"login": "probakowski", "name": "Przemko Robakowski"}}, "url": "https://github.com/elastic/elasticsearch/commit/4a0e20d82c30988faacead6b4eb9b7d018655a11", "committedDate": "2020-10-22T10:25:43Z", "message": "fix test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "19af04d6bdfa19eb5fd802f44ecdb9596adaa45d", "author": {"user": {"login": "probakowski", "name": "Przemko Robakowski"}}, "url": "https://github.com/elastic/elasticsearch/commit/19af04d6bdfa19eb5fd802f44ecdb9596adaa45d", "committedDate": "2020-10-22T10:47:02Z", "message": "fix test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5b940396e55367fa7013b2f758c2240d68b14d10", "author": {"user": {"login": "probakowski", "name": "Przemko Robakowski"}}, "url": "https://github.com/elastic/elasticsearch/commit/5b940396e55367fa7013b2f758c2240d68b14d10", "committedDate": "2020-10-22T11:52:09Z", "message": "rest test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "44415330000762b72aa94ccab65141524f75be54", "author": {"user": {"login": "probakowski", "name": "Przemko Robakowski"}}, "url": "https://github.com/elastic/elasticsearch/commit/44415330000762b72aa94ccab65141524f75be54", "committedDate": "2020-10-22T12:09:32Z", "message": "rest test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "404d3417b3a38fb52cce82a31540c4eb6a3fc4c0", "author": {"user": {"login": "probakowski", "name": "Przemko Robakowski"}}, "url": "https://github.com/elastic/elasticsearch/commit/404d3417b3a38fb52cce82a31540c4eb6a3fc4c0", "committedDate": "2020-10-22T14:51:34Z", "message": "spotless"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0059e16b4cc949c13c040a3ef2581862fdd5bfd2", "author": {"user": {"login": "probakowski", "name": "Przemko Robakowski"}}, "url": "https://github.com/elastic/elasticsearch/commit/0059e16b4cc949c13c040a3ef2581862fdd5bfd2", "committedDate": "2020-10-22T20:23:46Z", "message": "tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2c540befc03fd767a3efb74a56865a6e7467f211", "author": {"user": {"login": "probakowski", "name": "Przemko Robakowski"}}, "url": "https://github.com/elastic/elasticsearch/commit/2c540befc03fd767a3efb74a56865a6e7467f211", "committedDate": "2020-10-22T20:26:10Z", "message": "Merge remote-tracking branch 'origin/master' into hidden-data-streams"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "54dddc4c27590407e731c7cfade5427e33d9fdcb", "author": {"user": {"login": "probakowski", "name": "Przemko Robakowski"}}, "url": "https://github.com/elastic/elasticsearch/commit/54dddc4c27590407e731c7cfade5427e33d9fdcb", "committedDate": "2020-10-22T21:49:14Z", "message": "Delete a.json"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "63c0702224915b8186632c57a11976c9776626dc", "author": {"user": {"login": "probakowski", "name": "Przemko Robakowski"}}, "url": "https://github.com/elastic/elasticsearch/commit/63c0702224915b8186632c57a11976c9776626dc", "committedDate": "2020-10-26T10:42:26Z", "message": "added expand_wildcards for GetDataStream and DeleteDataStream"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE2NjM3NDg1", "url": "https://github.com/elastic/elasticsearch/pull/63987#pullrequestreview-516637485", "createdAt": "2020-10-26T10:21:41Z", "commit": {"oid": "54dddc4c27590407e731c7cfade5427e33d9fdcb"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yNlQxMDoyMTo0MVrOHoJFOA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yNlQxMDoyMTo0MVrOHoJFOA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTg1Mzg4MA==", "bodyText": "I feel that reusing the index.hidden setting is adding ambiguity to the setting, since it will then be controlling whether an index is hidden or data stream depending on the context how it is being used.\nI would prefer that a data stream can be made hidden via the data_stream section of a composable index template. I think this way it is clearer what is being made hidden. Currently DataStreamTemplate is empty, but I think we will be adding more configuration options that are data stream specific later (e.g. timestamp field name).\nNote that aliases are also made hidden via a property on an alias instead of reusing the index.hidden setting. So making data stream hidden via a parameter on DataStreamTemplate is inline how aliases\ncan be made hidden.\nLet me know what you think. I think this change would be a minor change to this PR.", "url": "https://github.com/elastic/elasticsearch/pull/63987#discussion_r511853880", "createdAt": "2020-10-26T10:21:41Z", "author": {"login": "martijnvg"}, "path": "server/src/main/java/org/elasticsearch/cluster/metadata/MetadataCreateDataStreamService.java", "diffHunk": "@@ -156,9 +157,11 @@ static ClusterState createDataStream(MetadataCreateIndexService metadataCreateIn\n         assert firstBackingIndex != null;\n         assert firstBackingIndex.mapping() != null : \"no mapping found for backing index [\" + firstBackingIndexName + \"]\";\n \n-        String fieldName = template.getDataStreamTemplate().getTimestampField();\n+        String fieldName = composableTemplate.getDataStreamTemplate().getTimestampField();\n         DataStream.TimestampField timestampField = new DataStream.TimestampField(fieldName);\n-        DataStream newDataStream = new DataStream(request.name, timestampField, List.of(firstBackingIndex.getIndex()));\n+        Template template = composableTemplate.template();\n+        boolean hidden = template != null && template.settings() != null && IndexMetadata.INDEX_HIDDEN_SETTING.get(template.settings());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "54dddc4c27590407e731c7cfade5427e33d9fdcb"}, "originalPosition": 25}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dd9afafe7a4771d76059bf306423cd843464f1fe", "author": {"user": {"login": "probakowski", "name": "Przemko Robakowski"}}, "url": "https://github.com/elastic/elasticsearch/commit/dd9afafe7a4771d76059bf306423cd843464f1fe", "committedDate": "2020-10-26T10:56:46Z", "message": "unused imports"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6152f02629d28c659b6ddb6d0faa1c0863d4a481", "author": {"user": {"login": "probakowski", "name": "Przemko Robakowski"}}, "url": "https://github.com/elastic/elasticsearch/commit/6152f02629d28c659b6ddb6d0faa1c0863d4a481", "committedDate": "2020-10-26T12:50:47Z", "message": "Merge remote-tracking branch 'origin/master' into hidden-data-streams"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4e71b539b8fe85a442af9d4f0119b97a5b92e707", "author": {"user": {"login": "probakowski", "name": "Przemko Robakowski"}}, "url": "https://github.com/elastic/elasticsearch/commit/4e71b539b8fe85a442af9d4f0119b97a5b92e707", "committedDate": "2020-10-26T22:28:27Z", "message": "add hidden setting to data stream template"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f00df2d4b67b524bf6a299b04cdc6654652d42ea", "author": {"user": {"login": "probakowski", "name": "Przemko Robakowski"}}, "url": "https://github.com/elastic/elasticsearch/commit/f00df2d4b67b524bf6a299b04cdc6654652d42ea", "committedDate": "2020-10-26T22:55:31Z", "message": "fix expand_wildcards"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b92f159f2131a48f4a07dc356231bc8f90ac48ba", "author": {"user": {"login": "probakowski", "name": "Przemko Robakowski"}}, "url": "https://github.com/elastic/elasticsearch/commit/b92f159f2131a48f4a07dc356231bc8f90ac48ba", "committedDate": "2020-10-26T23:04:19Z", "message": "Merge remote-tracking branch 'origin/master' into hidden-data-streams"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "194b49291705a88efb26de18b333efff377af756", "author": {"user": {"login": "probakowski", "name": "Przemko Robakowski"}}, "url": "https://github.com/elastic/elasticsearch/commit/194b49291705a88efb26de18b333efff377af756", "committedDate": "2020-10-26T23:05:35Z", "message": "spotless"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "66c8d585874dcb8197e664cae0e5d86cb5f7c86a", "author": {"user": {"login": "probakowski", "name": "Przemko Robakowski"}}, "url": "https://github.com/elastic/elasticsearch/commit/66c8d585874dcb8197e664cae0e5d86cb5f7c86a", "committedDate": "2020-10-26T23:15:38Z", "message": "fix compilation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d0ee5e7134272be2abc1fa127376b335d603614b", "author": {"user": {"login": "probakowski", "name": "Przemko Robakowski"}}, "url": "https://github.com/elastic/elasticsearch/commit/d0ee5e7134272be2abc1fa127376b335d603614b", "committedDate": "2020-10-26T23:23:53Z", "message": "unused import"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "72add9202709c615f6780c9c52c24548317bbcbf", "author": {"user": {"login": "probakowski", "name": "Przemko Robakowski"}}, "url": "https://github.com/elastic/elasticsearch/commit/72add9202709c615f6780c9c52c24548317bbcbf", "committedDate": "2020-10-26T23:49:51Z", "message": "yaml test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cfe3b643712d0fa0f2cd3735f49292d0776a9e5b", "author": {"user": {"login": "probakowski", "name": "Przemko Robakowski"}}, "url": "https://github.com/elastic/elasticsearch/commit/cfe3b643712d0fa0f2cd3735f49292d0776a9e5b", "committedDate": "2020-10-26T23:56:00Z", "message": "fix test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "247524445b67923d0f4ce629a10b09fc73a5e7bb", "author": {"user": {"login": "probakowski", "name": "Przemko Robakowski"}}, "url": "https://github.com/elastic/elasticsearch/commit/247524445b67923d0f4ce629a10b09fc73a5e7bb", "committedDate": "2020-10-27T09:53:48Z", "message": "fix cleanup"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE4NTEwMTIy", "url": "https://github.com/elastic/elasticsearch/pull/63987#pullrequestreview-518510122", "createdAt": "2020-10-28T10:18:37Z", "commit": {"oid": "247524445b67923d0f4ce629a10b09fc73a5e7bb"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOFQxMDoxODozOFrOHpjDnw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOFQxMDoxODozOFrOHpjDnw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzMyODAzMQ==", "bodyText": "I don't fully understand the purpose of this logic here. It always ensures that expressions get expanded to open data streams / indices. Why is this needed?\nAlso the rest spec for this and get data stream api only indicates that expand_wildcards is supported, but I think the way the corresponding request class and with this logic also the other indices options rest parameters are supported as well? Is the intention of this logic to only support expand_wildcards in get and delete data streams apis?", "url": "https://github.com/elastic/elasticsearch/pull/63987#discussion_r513328031", "createdAt": "2020-10-28T10:18:38Z", "author": {"login": "martijnvg"}, "path": "x-pack/plugin/data-streams/src/main/java/org/elasticsearch/xpack/datastreams/action/DeleteDataStreamTransportAction.java", "diffHunk": "@@ -106,9 +108,11 @@ static ClusterState removeDataStream(\n         ClusterState currentState,\n         DeleteDataStreamAction.Request request\n     ) {\n-        Set<String> dataStreams = new HashSet<>(\n-            indexNameExpressionResolver.dataStreamNames(currentState, request.indicesOptions(), request.getNames())\n-        );\n+        IndicesOptions options = request.indicesOptions();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "247524445b67923d0f4ce629a10b09fc73a5e7bb"}, "originalPosition": 23}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "070cbf3e27d8d504c23d24fd06112e8065cb1ade", "author": {"user": {"login": "probakowski", "name": "Przemko Robakowski"}}, "url": "https://github.com/elastic/elasticsearch/commit/070cbf3e27d8d504c23d24fd06112e8065cb1ade", "committedDate": "2020-10-28T12:25:15Z", "message": "Merge remote-tracking branch 'origin/master' into hidden-data-streams"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ff845eb1f51de26af4aa0bb187f90fda74ff58fd", "author": {"user": {"login": "probakowski", "name": "Przemko Robakowski"}}, "url": "https://github.com/elastic/elasticsearch/commit/ff845eb1f51de26af4aa0bb187f90fda74ff58fd", "committedDate": "2020-10-30T00:53:37Z", "message": "review"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b9fc82d71e4db7ac2498c011b9af3af1e1cda503", "author": {"user": {"login": "probakowski", "name": "Przemko Robakowski"}}, "url": "https://github.com/elastic/elasticsearch/commit/b9fc82d71e4db7ac2498c011b9af3af1e1cda503", "committedDate": "2020-10-30T07:39:57Z", "message": "Merge branch 'master' into hidden-data-streams"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8ffd4445f069e9d9a89c7dae00f4c7c7634aaab7", "author": {"user": {"login": "probakowski", "name": "Przemko Robakowski"}}, "url": "https://github.com/elastic/elasticsearch/commit/8ffd4445f069e9d9a89c7dae00f4c7c7634aaab7", "committedDate": "2020-10-30T07:48:11Z", "message": "compilation fix"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d3d5a6a4096b8564bf21524fd2f8e9f232601107", "author": {"user": {"login": "probakowski", "name": "Przemko Robakowski"}}, "url": "https://github.com/elastic/elasticsearch/commit/d3d5a6a4096b8564bf21524fd2f8e9f232601107", "committedDate": "2020-10-30T07:53:29Z", "message": "fix javadoc"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9a9700ad6eba31868ca8467393e268778fbd1ce5", "author": {"user": {"login": "probakowski", "name": "Przemko Robakowski"}}, "url": "https://github.com/elastic/elasticsearch/commit/9a9700ad6eba31868ca8467393e268778fbd1ce5", "committedDate": "2020-10-30T07:57:28Z", "message": "fix javadoc"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIwNTIxMDA0", "url": "https://github.com/elastic/elasticsearch/pull/63987#pullrequestreview-520521004", "createdAt": "2020-10-30T09:59:25Z", "commit": {"oid": "9a9700ad6eba31868ca8467393e268778fbd1ce5"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1234, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}