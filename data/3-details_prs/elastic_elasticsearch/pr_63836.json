{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTA0OTY2OTgz", "number": 63836, "title": "Convert geo field mappers to Parametrized form", "bodyText": "Relates to #62988", "createdAt": "2020-10-16T16:38:21Z", "url": "https://github.com/elastic/elasticsearch/pull/63836", "merged": true, "mergeCommit": {"oid": "bfaf3040c6e5245b6d3367483ba86c676dd09bd2"}, "closed": true, "closedAt": "2020-10-22T08:11:42Z", "author": {"login": "romseygeek"}, "timelineItems": {"totalCount": 20, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdTJFxngH2gAyNTA0OTY2OTgzOjlkNDgzNDMxMWIxYmJlNGEyYTE5ZGE4OGVkNDM5NjdhZWRlYTU2YTA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdU8wYOAH2gAyNTA0OTY2OTgzOmQ3MzE1NDIwMTc1ZjZhMTAyNjc5OGVhZGQ5ZmE0MWUxNjlkNWExMTk=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "9d4834311b1bbe4a2a19da88ed43967aedea56a0", "author": {"user": {"login": "romseygeek", "name": "Alan Woodward"}}, "url": "https://github.com/elastic/elasticsearch/commit/9d4834311b1bbe4a2a19da88ed43967aedea56a0", "committedDate": "2020-10-16T16:37:15Z", "message": "Convert geo field mappers to Parametrized form"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6ef3e685d429e7be803e73001b492a00a6bb7218", "author": {"user": {"login": "romseygeek", "name": "Alan Woodward"}}, "url": "https://github.com/elastic/elasticsearch/commit/6ef3e685d429e7be803e73001b492a00a6bb7218", "committedDate": "2020-10-16T19:38:15Z", "message": "duh"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "61de96c9b7c67b13af75a6a95fc36984db7bb107", "author": {"user": {"login": "romseygeek", "name": "Alan Woodward"}}, "url": "https://github.com/elastic/elasticsearch/commit/61de96c9b7c67b13af75a6a95fc36984db7bb107", "committedDate": "2020-10-17T11:08:02Z", "message": "tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9fcd17dd42e5ad1267b5d6fd35b7b132c3de7742", "author": {"user": {"login": "romseygeek", "name": "Alan Woodward"}}, "url": "https://github.com/elastic/elasticsearch/commit/9fcd17dd42e5ad1267b5d6fd35b7b132c3de7742", "committedDate": "2020-10-19T08:05:39Z", "message": "Merge remote-tracking branch 'origin/master' into mapper/geo-params"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "db49a6938ad3cd9080b613c822269df334a4e8d0", "author": {"user": {"login": "romseygeek", "name": "Alan Woodward"}}, "url": "https://github.com/elastic/elasticsearch/commit/db49a6938ad3cd9080b613c822269df334a4e8d0", "committedDate": "2020-10-19T09:29:54Z", "message": "points_only fixes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "393631d6e1666bc579fc9048902df82d1bfe3f88", "author": {"user": {"login": "romseygeek", "name": "Alan Woodward"}}, "url": "https://github.com/elastic/elasticsearch/commit/393631d6e1666bc579fc9048902df82d1bfe3f88", "committedDate": "2020-10-19T09:36:29Z", "message": "geopoint takes arrays"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "76feae0d15c1c2d2a8e3e0f43500981de4988c03", "author": {"user": {"login": "romseygeek", "name": "Alan Woodward"}}, "url": "https://github.com/elastic/elasticsearch/commit/76feae0d15c1c2d2a8e3e0f43500981de4988c03", "committedDate": "2020-10-19T10:28:24Z", "message": "tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9e1307ad316d702c6257df78f7226e38f798602c", "author": {"user": {"login": "romseygeek", "name": "Alan Woodward"}}, "url": "https://github.com/elastic/elasticsearch/commit/9e1307ad316d702c6257df78f7226e38f798602c", "committedDate": "2020-10-19T11:37:58Z", "message": "legacy -> bkd merges"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b4d892f6a848cd5963787e2623b54f0d9b5b7bf8", "author": {"user": {"login": "romseygeek", "name": "Alan Woodward"}}, "url": "https://github.com/elastic/elasticsearch/commit/b4d892f6a848cd5963787e2623b54f0d9b5b7bf8", "committedDate": "2020-10-19T12:50:03Z", "message": "wut"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTExNzc1OTE4", "url": "https://github.com/elastic/elasticsearch/pull/63836#pullrequestreview-511775918", "createdAt": "2020-10-19T13:44:56Z", "commit": {"oid": "b4d892f6a848cd5963787e2623b54f0d9b5b7bf8"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xOVQxMzo0NDo1NlrOHkPFhw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xOVQxMzo1MToyNVrOHkPYiA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzc1Nzk1OQ==", "bodyText": "This ended up catching a pre-existing bug in GeoShapeQueryTests, which was asking for TERM instead of term as a strategy, and therefore ending up falling back on null here, which was getting translated to recursive once the mapper had been parsed.  Silently falling back to recursive is a bug, I think, although on backport we will need to change this to emit a warning instead, as you can't change the strategy once it has been set and so existing mappings with badly-spelled term strategies will have to stay using recursive", "url": "https://github.com/elastic/elasticsearch/pull/63836#discussion_r507757959", "createdAt": "2020-10-19T13:44:56Z", "author": {"login": "romseygeek"}, "path": "server/src/main/java/org/elasticsearch/common/geo/SpatialStrategy.java", "diffHunk": "@@ -54,6 +54,12 @@ public static SpatialStrategy fromString(String strategyName) {\n                 return strategy;\n             }\n         }\n-        return null;\n+        throw new IllegalArgumentException(\"Unknown strategy [\" + strategyName + \"]\");\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b4d892f6a848cd5963787e2623b54f0d9b5b7bf8"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzc1OTA5OQ==", "bodyText": "Whether or not a parameter has been explicitly set is of interest only to the mapper itself, and its serialization code; the PR changes these getters on the mappers to return simple booleans.", "url": "https://github.com/elastic/elasticsearch/pull/63836#discussion_r507759099", "createdAt": "2020-10-19T13:46:24Z", "author": {"login": "romseygeek"}, "path": "server/src/main/java/org/elasticsearch/common/geo/parsers/GeoJsonParser.java", "diffHunk": "@@ -50,14 +49,10 @@ protected static ShapeBuilder parse(XContentParser parser, AbstractShapeGeometry\n         GeometryCollectionBuilder geometryCollections = null;\n \n         Orientation orientation = (shapeMapper == null)\n-            ? AbstractShapeGeometryFieldMapper.Defaults.ORIENTATION.value()\n+            ? Orientation.RIGHT\n             : shapeMapper.orientation();\n-        Explicit<Boolean> coerce = (shapeMapper == null)\n-            ? AbstractShapeGeometryFieldMapper.Defaults.COERCE\n-            : shapeMapper.coerce();\n-        Explicit<Boolean> ignoreZValue = (shapeMapper == null)\n-            ? AbstractShapeGeometryFieldMapper.Defaults.IGNORE_Z_VALUE\n-            : shapeMapper.ignoreZValue();\n+        boolean coerce = shapeMapper != null && shapeMapper.coerce();\n+        boolean ignoreZValue = shapeMapper == null || shapeMapper.ignoreZValue();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b4d892f6a848cd5963787e2623b54f0d9b5b7bf8"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzc2MjgyNA==", "bodyText": "These needed to be changed to getters, rather than just asserting in themselves, so that the checks for deprecated boost parameters didn't get confused by the additional warnings.", "url": "https://github.com/elastic/elasticsearch/pull/63836#discussion_r507762824", "createdAt": "2020-10-19T13:51:25Z", "author": {"login": "romseygeek"}, "path": "test/framework/src/main/java/org/elasticsearch/index/mapper/MapperTestCase.java", "diffHunk": "@@ -205,12 +205,28 @@ public void testMinimalToMaximal() throws IOException {\n         assertParseMaximalWarnings();\n     }\n \n-    protected void assertParseMinimalWarnings() {\n+    protected final void assertParseMinimalWarnings() {\n+        String[] warnings = getParseMinimalWarnings();\n+        if (warnings.length > 0) {\n+            assertWarnings(warnings);\n+        }\n+    }\n+\n+    protected final void assertParseMaximalWarnings() {\n+        String[] warnings = getParseMaximalWarnings();\n+        if (warnings.length > 0) {\n+            assertWarnings(warnings);\n+        }\n+    }\n+\n+    protected String[] getParseMinimalWarnings() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b4d892f6a848cd5963787e2623b54f0d9b5b7bf8"}, "originalPosition": 19}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ff0269d5d759cdc2321acfed790c3ba7737ea3a1", "author": {"user": {"login": "romseygeek", "name": "Alan Woodward"}}, "url": "https://github.com/elastic/elasticsearch/commit/ff0269d5d759cdc2321acfed790c3ba7737ea3a1", "committedDate": "2020-10-19T14:42:57Z", "message": "remove unnecessary bit"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c49b6270b7d4336227d46e77a77c051d76089169", "author": {"user": {"login": "romseygeek", "name": "Alan Woodward"}}, "url": "https://github.com/elastic/elasticsearch/commit/c49b6270b7d4336227d46e77a77c051d76089169", "committedDate": "2020-10-19T14:43:40Z", "message": "Merge remote-tracking branch 'origin/master' into mapper/geo-params"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTExOTc3ODkx", "url": "https://github.com/elastic/elasticsearch/pull/63836#pullrequestreview-511977891", "createdAt": "2020-10-19T17:08:39Z", "commit": {"oid": "c49b6270b7d4336227d46e77a77c051d76089169"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xOVQxNzowODozOVrOHkYq6w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xOVQxNzoxMDoxMlrOHkYugg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzkxNDk4Nw==", "bodyText": "It looks like the old code had a comment that this was intentionally a noop. I think it is worth keeping that.", "url": "https://github.com/elastic/elasticsearch/pull/63836#discussion_r507914987", "createdAt": "2020-10-19T17:08:39Z", "author": {"login": "nik9000"}, "path": "x-pack/plugin/spatial/src/main/java/org/elasticsearch/xpack/spatial/index/mapper/GeoShapeWithDocValuesFieldMapper.java", "diffHunk": "@@ -198,8 +221,12 @@ public GeoShapeWithDocValuesFieldType fieldType() {\n     }\n \n     @Override\n-    protected String contentType() {\n-        return CONTENT_TYPE;\n+    protected void addStoredFields(ParseContext context, Geometry geometry) {\n+\n     }\n \n+    @Override\n+    protected void addMultiFields(ParseContext context, Geometry geometry) {\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c49b6270b7d4336227d46e77a77c051d76089169"}, "originalPosition": 263}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzkxNTkwNg==", "bodyText": "We don't need to be equal to ParsedCartesianPoints?", "url": "https://github.com/elastic/elasticsearch/pull/63836#discussion_r507915906", "createdAt": "2020-10-19T17:10:12Z", "author": {"login": "nik9000"}, "path": "x-pack/plugin/spatial/src/main/java/org/elasticsearch/xpack/spatial/index/mapper/PointFieldMapper.java", "diffHunk": "@@ -186,12 +212,8 @@ public boolean equals(Object other) {\n                 CartesianPoint o = (CartesianPoint)other;\n                 oX = o.getX();\n                 oY = o.getY();\n-            } else if (other instanceof ParsedCartesianPoint == false) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c49b6270b7d4336227d46e77a77c051d76089169"}, "originalPosition": 143}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b53b33bbbc3d2d0d7e171bfc5b79f77857a11062", "author": {"user": {"login": "romseygeek", "name": "Alan Woodward"}}, "url": "https://github.com/elastic/elasticsearch/commit/b53b33bbbc3d2d0d7e171bfc5b79f77857a11062", "committedDate": "2020-10-21T08:49:02Z", "message": "Merge remote-tracking branch 'origin/master' into mapper/geo-params"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ec447e9d2f93d7573355f89edf66dc99accf5d17", "author": {"user": {"login": "romseygeek", "name": "Alan Woodward"}}, "url": "https://github.com/elastic/elasticsearch/commit/ec447e9d2f93d7573355f89edf66dc99accf5d17", "committedDate": "2020-10-21T08:56:31Z", "message": "add comments back in"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTEzNDgwOTY1", "url": "https://github.com/elastic/elasticsearch/pull/63836#pullrequestreview-513480965", "createdAt": "2020-10-21T09:27:38Z", "commit": {"oid": "ec447e9d2f93d7573355f89edf66dc99accf5d17"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTEzNzI1NTYy", "url": "https://github.com/elastic/elasticsearch/pull/63836#pullrequestreview-513725562", "createdAt": "2020-10-21T14:05:45Z", "commit": {"oid": "ec447e9d2f93d7573355f89edf66dc99accf5d17"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c62cbd8a94545e2f9e01ac0365ca3f2faf81f642", "author": {"user": {"login": "elasticmachine", "name": "Elastic Machine"}}, "url": "https://github.com/elastic/elasticsearch/commit/c62cbd8a94545e2f9e01ac0365ca3f2faf81f642", "committedDate": "2020-10-21T14:19:55Z", "message": "Merge branch 'master' into mapper/geo-params"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7bddf07f4d5ac5952c87a0fcce225e2b273c9e91", "author": {"user": {"login": "romseygeek", "name": "Alan Woodward"}}, "url": "https://github.com/elastic/elasticsearch/commit/7bddf07f4d5ac5952c87a0fcce225e2b273c9e91", "committedDate": "2020-10-21T14:25:29Z", "message": "Add to breaking changes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d7315420175f6a1026798eadd9fa41e169d5a119", "author": {"user": {"login": "elasticmachine", "name": "Elastic Machine"}}, "url": "https://github.com/elastic/elasticsearch/commit/d7315420175f6a1026798eadd9fa41e169d5a119", "committedDate": "2020-10-22T07:22:52Z", "message": "Merge branch 'master' into mapper/geo-params"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3897, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}