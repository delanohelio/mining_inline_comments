{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE0OTA4MDc1", "number": 64546, "title": "SQL: Test `IN` operator out of range validation", "bodyText": "Additional tests.\nTest if the type of the field is actually picked up from the field\nmapping and if the values specified for the IN operator are\nconverted to the type of the field (for numerical fields).\nRelates to #64238", "createdAt": "2020-11-03T18:07:10Z", "url": "https://github.com/elastic/elasticsearch/pull/64546", "merged": true, "mergeCommit": {"oid": "479cc164d0e3e4b62a60ce948a9200f114ec390e"}, "closed": true, "closedAt": "2020-11-05T00:27:41Z", "author": {"login": "palesz"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdY9Jd3AH2gAyNTE0OTA4MDc1OjZmOTZjOTdjMGU4YWJkYmYwNGMwNDk4YTQwOGIxOGRkYWY0YzI3Nzc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdZWP-RAH2gAyNTE0OTA4MDc1OjU1OWE5NWU5ZTFlNDdmZWMxNGZlNzM1YzMxYzJiOTUwZTdiMWEyMmE=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "6f96c97c0e8abdbf04c0498a408b18ddaf4c2777", "author": {"user": {"login": "palesz", "name": "Andras Palinkas"}}, "url": "https://github.com/elastic/elasticsearch/commit/6f96c97c0e8abdbf04c0498a408b18ddaf4c2777", "committedDate": "2020-11-03T18:05:58Z", "message": "SQL: Test `IN` operator out of range validation\n\nAdditional tests.\n\nTest if the type of the field is actually picked up from the field\nmapping and if the values specified for the `IN` operator are\nconverter to the type of the field (for numerical fields).\n\nRelates to #64238"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIyNzYzMjYx", "url": "https://github.com/elastic/elasticsearch/pull/64546#pullrequestreview-522763261", "createdAt": "2020-11-03T18:18:23Z", "commit": {"oid": "6f96c97c0e8abdbf04c0498a408b18ddaf4c2777"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "118966855c6176800ab33abe5f474b2db8639073", "author": {"user": {"login": "palesz", "name": "Andras Palinkas"}}, "url": "https://github.com/elastic/elasticsearch/commit/118966855c6176800ab33abe5f474b2db8639073", "committedDate": "2020-11-03T22:19:38Z", "message": "Fix checkstyle complaint"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "573a271121a3d0a125661b1fc56b534b9915874c", "author": {"user": {"login": "palesz", "name": "Andras Palinkas"}}, "url": "https://github.com/elastic/elasticsearch/commit/573a271121a3d0a125661b1fc56b534b9915874c", "committedDate": "2020-11-03T22:20:08Z", "message": "Merge remote-tracking branch 'origin/master' into fix/64238"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIyOTMxNjEz", "url": "https://github.com/elastic/elasticsearch/pull/64546#pullrequestreview-522931613", "createdAt": "2020-11-03T22:51:10Z", "commit": {"oid": "573a271121a3d0a125661b1fc56b534b9915874c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIzMTI0MDA2", "url": "https://github.com/elastic/elasticsearch/pull/64546#pullrequestreview-523124006", "createdAt": "2020-11-04T08:14:57Z", "commit": {"oid": "573a271121a3d0a125661b1fc56b534b9915874c"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNFQwODoxNDo1N1rOHtNGWA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNFQwODoxNToyNVrOHtNHWQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzE2MjU4NA==", "bodyText": "This test might be a good fit in x-pack/plugin/sql/src/test/java/org/elasticsearch/xpack/sql/planner/PostOptimizerVerifierTests.java?", "url": "https://github.com/elastic/elasticsearch/pull/64546#discussion_r517162584", "createdAt": "2020-11-04T08:14:57Z", "author": {"login": "bpintea"}, "path": "x-pack/plugin/sql/src/test/java/org/elasticsearch/xpack/sql/planner/QueryTranslatorTests.java", "diffHunk": "@@ -2239,4 +2260,16 @@ public void testScriptsInsideAggregateFunctions_WithDateField_AndExtendedStats()\n             + \"InternalSqlScriptUtils.asDateTime(params.a0),InternalSqlScriptUtils.asDateTime(params.v0)))\\\",\\\"lang\\\":\\\"painless\\\",\"\n             + \"\\\"params\\\":{\\\"v0\\\":\\\"2020-05-03T00:00:00.000Z\\\"}},\\\"gap_policy\\\":\\\"skip\\\"}}}}}}\"));\n     }\n+\n+    public void testInOutOfRangeValues() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "573a271121a3d0a125661b1fc56b534b9915874c"}, "originalPosition": 109}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzE2Mjg0MQ==", "bodyText": "This might be suitable for x-pack/plugin/sql/qa/server/src/main/resources/filter.sql-spec.", "url": "https://github.com/elastic/elasticsearch/pull/64546#discussion_r517162841", "createdAt": "2020-11-04T08:15:25Z", "author": {"login": "bpintea"}, "path": "x-pack/plugin/sql/src/test/java/org/elasticsearch/xpack/sql/planner/QueryTranslatorTests.java", "diffHunk": "@@ -2239,4 +2260,16 @@ public void testScriptsInsideAggregateFunctions_WithDateField_AndExtendedStats()\n             + \"InternalSqlScriptUtils.asDateTime(params.a0),InternalSqlScriptUtils.asDateTime(params.v0)))\\\",\\\"lang\\\":\\\"painless\\\",\"\n             + \"\\\"params\\\":{\\\"v0\\\":\\\"2020-05-03T00:00:00.000Z\\\"}},\\\"gap_policy\\\":\\\"skip\\\"}}}}}}\"));\n     }\n+\n+    public void testInOutOfRangeValues() {\n+        QlIllegalArgumentException ex = expectThrows(QlIllegalArgumentException.class,\n+            () -> optimizeAndPlan(\"SELECT int FROM test WHERE int IN (1, 2, 3, \" + Long.MAX_VALUE + \", 5, 6, 7)\"));\n+        assertThat(ex.getMessage(), is(\"[\" + Long.MAX_VALUE + \"] out of [integer] range\"));\n+    }\n+\n+    public void testInInRangeValues() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "573a271121a3d0a125661b1fc56b534b9915874c"}, "originalPosition": 115}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4fd124bf431663b8fd66fc40674e4e6ebdfccd70", "author": {"user": {"login": "palesz", "name": "Andras Palinkas"}}, "url": "https://github.com/elastic/elasticsearch/commit/4fd124bf431663b8fd66fc40674e4e6ebdfccd70", "committedDate": "2020-11-04T22:48:42Z", "message": "Merge remote-tracking branch 'origin/master' into fix/64238"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "559a95e9e1e47fec14fe735c31c2b950e7b1a22a", "author": {"user": {"login": "palesz", "name": "Andras Palinkas"}}, "url": "https://github.com/elastic/elasticsearch/commit/559a95e9e1e47fec14fe735c31c2b950e7b1a22a", "committedDate": "2020-11-04T23:20:42Z", "message": "Fix merge issue"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 794, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}