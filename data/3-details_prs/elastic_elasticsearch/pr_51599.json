{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY4NDc5OTY5", "number": 51599, "title": "Reindex rethrottle persistent task", "bodyText": "This adds support for rethrottling resilient/persistent reindex\nthrough updating the .reindex index and notifying the task. This\nensures that the new throttle value sticks on failovers while\nalso ensuring that the task wakes up immediately if it had a very\nlow throttle value.\nRelated to #42612\nThis is the replacement for #50854.\nTests on the transport layer are missing, but I wanted to ensure\nwe agree on approach first and then tackle adding those\nin a follow-up.", "createdAt": "2020-01-29T10:27:38Z", "url": "https://github.com/elastic/elasticsearch/pull/51599", "merged": true, "mergeCommit": {"oid": "5c667356443ee471fbad9f6153f0d7f534074d6d"}, "closed": true, "closedAt": "2020-02-13T15:51:51Z", "author": {"login": "henningandersen"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb_DR9CgH2gAyMzY4NDc5OTY5OjcxMjBkZmM3MGQwNGQzOGI1NDQyOGE5YzA2OTEwY2IwOTBiM2E2YmQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcB-U7ngFqTM1NTExODA4Mg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "7120dfc70d04d38b54428a9c06910cb090b3a6bd", "author": {"user": {"login": "henningandersen", "name": "Henning Andersen"}}, "url": "https://github.com/elastic/elasticsearch/commit/7120dfc70d04d38b54428a9c06910cb090b3a6bd", "committedDate": "2020-01-29T10:21:29Z", "message": "Reindex rethrottle persistent task\n\nThis adds support for rethrottling resilient/persistent reindex\nthrough updating the .reindex index and notifying the task. This\nensures that the new throttle value sticks on failovers while\nalso ensuring that the task wakes up immediately if it had a very\nlow throttle value.\n\nRelated to #42612"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUxMjU5NDUz", "url": "https://github.com/elastic/elasticsearch/pull/51599#pullrequestreview-351259453", "createdAt": "2020-01-31T02:09:46Z", "commit": {"oid": "7120dfc70d04d38b54428a9c06910cb090b3a6bd"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0zMVQwMjowOTo0NlrOFj_rdg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0zMVQwMjowOTo0NlrOFj_rdg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzI4Nzc5OA==", "bodyText": "Do we need this? I feel like adding the \"poll\" interaction model when we are doing all the working to implement the \"push\" component makes the interaction with the state updater and task more complicated that required.", "url": "https://github.com/elastic/elasticsearch/pull/51599#discussion_r373287798", "createdAt": "2020-01-31T02:09:46Z", "author": {"login": "tbrooks8"}, "path": "modules/reindex/src/main/java/org/elasticsearch/index/reindex/ReindexTaskStateUpdater.java", "diffHunk": "@@ -43,31 +45,36 @@\n \n     private final ReindexIndexClient reindexIndexClient;\n     private final ThreadPool threadPool;\n-    private final String taskId;\n+    private final String persistentTaskId;\n     private final long allocationId;\n+    private final TaskId ephemeralTaskId;\n     private final ActionListener<ReindexTaskStateDoc> finishedListener;\n     private final Runnable onCheckpointAssignmentConflict;\n+    private Consumer<Float> requestsPerSecondObserver;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7120dfc70d04d38b54428a9c06910cb090b3a6bd"}, "originalPosition": 22}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b6096a9398a458273c392fcb832e140eaaa73fb2", "author": {"user": {"login": "henningandersen", "name": "Henning Andersen"}}, "url": "https://github.com/elastic/elasticsearch/commit/b6096a9398a458273c392fcb832e140eaaa73fb2", "committedDate": "2020-02-03T14:56:18Z", "message": "Review comments:\n\nModify reindex request instead of passing in requestsPerSecond\nRemove rethrottle on .reindex version conflict."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "01841aab22e4bc5489fcf39f4cc004fe3be2d9fc", "author": {"user": {"login": "henningandersen", "name": "Henning Andersen"}}, "url": "https://github.com/elastic/elasticsearch/commit/01841aab22e4bc5489fcf39f4cc004fe3be2d9fc", "committedDate": "2020-02-03T15:00:46Z", "message": "checkstyle"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "72dff96c1ddd9d5212b3afc1effa10b5b34ffbbd", "author": {"user": {"login": "henningandersen", "name": "Henning Andersen"}}, "url": "https://github.com/elastic/elasticsearch/commit/72dff96c1ddd9d5212b3afc1effa10b5b34ffbbd", "committedDate": "2020-02-03T15:15:51Z", "message": "Formatting"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bfe93fb07a1955c4880f5a41999e293eaa99fd89", "author": {"user": {"login": "henningandersen", "name": "Henning Andersen"}}, "url": "https://github.com/elastic/elasticsearch/commit/bfe93fb07a1955c4880f5a41999e293eaa99fd89", "committedDate": "2020-02-03T15:16:14Z", "message": "Add copy constructor test."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ed7e78740bc692aa50cbbf8836a0c077fd4a40d4", "author": {"user": {"login": "henningandersen", "name": "Henning Andersen"}}, "url": "https://github.com/elastic/elasticsearch/commit/ed7e78740bc692aa50cbbf8836a0c077fd4a40d4", "committedDate": "2020-02-03T19:21:17Z", "message": "Merge remote-tracking branch 'origin/reindex_v2' into enhance_reindex_rethrottle_via_index"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUzNDMyMzAy", "url": "https://github.com/elastic/elasticsearch/pull/51599#pullrequestreview-353432302", "createdAt": "2020-02-05T02:26:46Z", "commit": {"oid": "ed7e78740bc692aa50cbbf8836a0c077fd4a40d4"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e18208d24cea4bcda1c557d1649b7625b8ddb6c9", "author": {"user": {"login": "henningandersen", "name": "Henning Andersen"}}, "url": "https://github.com/elastic/elasticsearch/commit/e18208d24cea4bcda1c557d1649b7625b8ddb6c9", "committedDate": "2020-02-05T08:54:08Z", "message": "Merge remote-tracking branch 'origin/reindex_v2' into enhance_reindex_rethrottle_via_index"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f15970d716d5a110e03db6131016076a828ff4cd", "author": {"user": {"login": "henningandersen", "name": "Henning Andersen"}}, "url": "https://github.com/elastic/elasticsearch/commit/f15970d716d5a110e03db6131016076a828ff4cd", "committedDate": "2020-02-05T12:34:44Z", "message": "Merge remote-tracking branch 'origin/reindex_v2' into enhance_reindex_rethrottle_via_index"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU1MTE4MDgy", "url": "https://github.com/elastic/elasticsearch/pull/51599#pullrequestreview-355118082", "createdAt": "2020-02-07T12:16:59Z", "commit": {"oid": "f15970d716d5a110e03db6131016076a828ff4cd"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3037, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}