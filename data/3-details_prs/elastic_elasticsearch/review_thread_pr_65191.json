{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTIzMTE5MzQx", "number": 65191, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOFQyMDo1NjowNVrOE6wxrg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOFQyMDo1NjowNVrOE6wxrg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMwMDUyMDE0OnYy", "diffSide": "RIGHT", "path": "plugins/quota-aware-fs/src/main/java/org/elasticsearch/fs/quotaaware/QuotaAwarePath.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOFQyMDo1NjowNVrOH2BznA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQxNzo0MDoxMVrOH2qK0w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjQxNDc0OA==", "bodyText": "In master we simply don't override this method at all, instead implicitly delegating to the default implementation on the Path interface. Is there a reason we can't just do that here instead of duplicating this?", "url": "https://github.com/elastic/elasticsearch/pull/65191#discussion_r526414748", "createdAt": "2020-11-18T20:56:05Z", "author": {"login": "mark-vieira"}, "path": "plugins/quota-aware-fs/src/main/java/org/elasticsearch/fs/quotaaware/QuotaAwarePath.java", "diffHunk": "@@ -179,7 +180,11 @@ public Path toRealPath(LinkOption... options) throws IOException {\n     @SuppressForbidden(reason = \"Implementation required by super type\")\n     @Override\n     public File toFile() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3006ad30a3e4abc7d7a0df72b17aa5bbe98fa402"}, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjgzNTg2OA==", "bodyText": "As I understand it, 7.x compiles against an older version of the JDK, where Path.toFile() doesn't have a default implementation, so we have to provide an implementation (Cloud has the same issue), even though the runtime JDK provides one. All I did was take the default implementation and paste it into the 7.x source. That means that the same code ends up being run in any case, except now a delegate.toFile() call is removed, and that seems to change the context enough to fix the problem.\nI managed to replicate the problem that @mieciu found by running the an ES configuration from him against 7.x. I then iterated on the plugin source until the problem went away.", "url": "https://github.com/elastic/elasticsearch/pull/65191#discussion_r526835868", "createdAt": "2020-11-19T12:28:16Z", "author": {"login": "pugnascotia"}, "path": "plugins/quota-aware-fs/src/main/java/org/elasticsearch/fs/quotaaware/QuotaAwarePath.java", "diffHunk": "@@ -179,7 +180,11 @@ public Path toRealPath(LinkOption... options) throws IOException {\n     @SuppressForbidden(reason = \"Implementation required by super type\")\n     @Override\n     public File toFile() {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjQxNDc0OA=="}, "originalCommit": {"oid": "3006ad30a3e4abc7d7a0df72b17aa5bbe98fa402"}, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzA3NjA1MQ==", "bodyText": "Ah yes, you are absolutely right. So yes, in 7.x the minimum runtime version is Java 8 (vs Java 11 for master), so when we compile (although we compile using a  Java 14 JDK) we use --release 8 so we \"effectively\" compile against the Java 8 APIs. The bundled runtime JDK includes an implementation here, but we support folks running with a Java 8 JRE so we can't rely on that.\nLGTM.", "url": "https://github.com/elastic/elasticsearch/pull/65191#discussion_r527076051", "createdAt": "2020-11-19T17:40:11Z", "author": {"login": "mark-vieira"}, "path": "plugins/quota-aware-fs/src/main/java/org/elasticsearch/fs/quotaaware/QuotaAwarePath.java", "diffHunk": "@@ -179,7 +180,11 @@ public Path toRealPath(LinkOption... options) throws IOException {\n     @SuppressForbidden(reason = \"Implementation required by super type\")\n     @Override\n     public File toFile() {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjQxNDc0OA=="}, "originalCommit": {"oid": "3006ad30a3e4abc7d7a0df72b17aa5bbe98fa402"}, "originalPosition": 11}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2947, "cost": 1, "resetAt": "2021-11-12T13:16:51Z"}}}