{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDAzMzY5OTA5", "number": 55179, "title": "Add support for more named curves", "bodyText": "We implicitly only supported the prime256v1 ( aka secp256r1 )\ncurve for the EC keys we read as PEM files to be used in any\nSSL Context. We would not fail when trying to read a key\npair using a different curve but we would silently assume\nthat it was using secp256r1 which would lead to strange\nTLS handshake issues if the curve was actually another one.\nThis commit fixes that behavior in that it\nsupports parsing EC keys that use any of the named curves\ndefined in rfc5915 and rfc5480 making no assumptions about\nwhether the security provider in use supports them (JDK8 and\nhigher support all the curves defined in rfc5480).\nresolves: #55031", "createdAt": "2020-04-14T19:24:38Z", "url": "https://github.com/elastic/elasticsearch/pull/55179", "merged": true, "mergeCommit": {"oid": "1cec91ec8673ec7f64f253659d52d44f416cf585"}, "closed": true, "closedAt": "2020-04-15T07:39:15Z", "author": {"login": "jkakavas"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcXoh5XAH2gAyNDAzMzY5OTA5OjZiNjk2NWVhZmFlNTVlNjY1ZmQyM2JjYjUwZDQxNjc3MGM2MzJiM2I=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcXwgcKgH2gAyNDAzMzY5OTA5OjQyZTcxYjE1ZGUyNTAyMWI1MGFlNThjMTFkNTljMTlhYzZkOTE0Njc=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "6b6965eafae55e665fd23bcb50d416770c632b3b", "author": {"user": {"login": "jkakavas", "name": "Ioannis Kakavas"}}, "url": "https://github.com/elastic/elasticsearch/commit/6b6965eafae55e665fd23bcb50d416770c632b3b", "committedDate": "2020-04-14T19:19:34Z", "message": "Add support for more named curves\n\nWe implicitly only supported the prime256v1 ( aka secp256r1 )\ncurve for the EC keys we read as PEM files to be used in any\nSSL Context. We would not fail when trying to read a key\npair using a different curve but we would silently assume\nthat it was using `secp256r1` which would lead to strange\nTLS handshake issues if the curve was actually another one.\n\nThis commit fixes that behavior in that it\nsupports parsing EC keys that use any of the named curves\ndefined in rfc5915 and rfc5480 making no assumptions about\nwhether the security provider in use supports them (JDK8 and\nhigher support all the curves defined in rfc5480)."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b815d3e73bc4c07f300913ce1d2a436b1884e8e6", "author": {"user": {"login": "jkakavas", "name": "Ioannis Kakavas"}}, "url": "https://github.com/elastic/elasticsearch/commit/b815d3e73bc4c07f300913ce1d2a436b1884e8e6", "committedDate": "2020-04-14T19:47:22Z", "message": "add missing resources"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkzMzUzNzEw", "url": "https://github.com/elastic/elasticsearch/pull/55179#pullrequestreview-393353710", "createdAt": "2020-04-14T23:04:34Z", "commit": {"oid": "b815d3e73bc4c07f300913ce1d2a436b1884e8e6"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNFQyMzowNDozNFrOGFkA1g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNFQyMzowNDozNFrOGFkA1g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODQ4NjEwMg==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    throw new GeneralSecurityException(\"Error parsing EC named curve identifier. Named curve with OID: \" + oidString + \" is not \" +\n          \n          \n            \n                        \"supported\");\n          \n          \n            \n                    throw new GeneralSecurityException(\"Error parsing EC named curve identifier. Named curve with OID: \" + oidString \n          \n          \n            \n                        + \" is not supported\");", "url": "https://github.com/elastic/elasticsearch/pull/55179#discussion_r408486102", "createdAt": "2020-04-14T23:04:34Z", "author": {"login": "tvernum"}, "path": "libs/ssl-config/src/main/java/org/elasticsearch/common/ssl/PemUtils.java", "diffHunk": "@@ -602,4 +605,42 @@ private static String getKeyAlgorithmIdentifier(byte[] keyBytes) throws IOExcept\n         return certificates;\n     }\n \n+    private static String getEcCurveNameFromOid(String oidString) throws GeneralSecurityException {\n+        switch (oidString) {\n+            // see https://tools.ietf.org/html/rfc5480#section-2.1.1.1\n+            case \"1.2.840.10045.3.1\":\n+                return \"secp192r1\";\n+            case \"1.3.132.0.1\":\n+                return \"sect163k1\";\n+            case \"1.3.132.0.15\":\n+                return \"sect163r2\";\n+            case \"1.3.132.0.33\":\n+                return \"secp224r1\";\n+            case \"1.3.132.0.26\":\n+                return \"sect233k1\";\n+            case \"1.3.132.0.27\":\n+                return \"sect233r1\";\n+            case \"1.2.840.10045.3.1.7\":\n+                return \"secp256r1\";\n+            case \"1.3.132.0.16\":\n+                return \"sect283k1\";\n+            case \"1.3.132.0.17\":\n+                return \"sect283r1\";\n+            case \"1.3.132.0.34\":\n+                return \"secp384r1\";\n+            case \"1.3.132.0.36\":\n+                return \"sect409k1\";\n+            case \"1.3.132.0.37\":\n+                return \"sect409r1\";\n+            case \"1.3.132.0.35\":\n+                return \"secp521r1\";\n+            case \"1.3.132.0.38\":\n+                return \"sect571k1\";\n+            case \"1.3.132.0.39\":\n+                return \"sect571r1\";\n+        }\n+        throw new GeneralSecurityException(\"Error parsing EC named curve identifier. Named curve with OID: \" + oidString + \" is not \" +\n+            \"supported\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b815d3e73bc4c07f300913ce1d2a436b1884e8e6"}, "originalPosition": 54}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "42e71b15de25021b50ae58c11d59c19ac6d91467", "author": {"user": {"login": "jkakavas", "name": "Ioannis Kakavas"}}, "url": "https://github.com/elastic/elasticsearch/commit/42e71b15de25021b50ae58c11d59c19ac6d91467", "committedDate": "2020-04-15T04:37:13Z", "message": "Update libs/ssl-config/src/main/java/org/elasticsearch/common/ssl/PemUtils.java\n\nCo-Authored-By: Tim Vernum <tim@adjective.org>"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3328, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}