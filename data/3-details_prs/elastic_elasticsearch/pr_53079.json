{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzgzMTYwNzk1", "number": 53079, "title": "Consolidate duplication of BWC testing task setup in script plugin", "bodyText": "We have a good deal of duplication of build configuration across our QA projects that do backward-compatibility testing. It was recently discovered that disabling BWC testing in the root build script by setting bwc_tests_enabled = false didn't in-fact disable all BWC tests. Our current strategy of copy/pasting build logic to setup new BWC testing projects is likely to blame for this omission.\nThis PR moves much of the redundant configuration around setting up test task conventions for BWC testing into a script plugin. I opted against a binary plugin here because we have open issues to address several items around testing conventions so this will undoubtably change. The goal here was just to iterate toward that goal, and a script plugin is still better than the current situation.", "createdAt": "2020-03-03T20:33:46Z", "url": "https://github.com/elastic/elasticsearch/pull/53079", "merged": true, "mergeCommit": {"oid": "33fc8e7ebfac8d47a5f9f026b3836bb47bea141a"}, "closed": true, "closedAt": "2020-03-03T22:40:56Z", "author": {"login": "mark-vieira"}, "timelineItems": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcKIV2hAH2gAyMzgzMTYwNzk1OjhiNTk0YTU0OGNkNjY3YzZhNjk0NDQ2YTdjNDdiNmYxMzg4YThiNTI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcKKGSzgFqTM2ODM3NDc0Mg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "8b594a548cd667c6a694446a7c47b6f1388a8b52", "author": {"user": {"login": "mark-vieira", "name": "Mark Vieira"}}, "url": "https://github.com/elastic/elasticsearch/commit/8b594a548cd667c6a694446a7c47b6f1388a8b52", "committedDate": "2020-03-03T20:28:26Z", "message": "Consolidate duplication of BWC testing task setup in script plugin\n\nSigned-off-by: Mark Vieira <portugee@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY4MzM0OTk5", "url": "https://github.com/elastic/elasticsearch/pull/53079#pullrequestreview-368334999", "createdAt": "2020-03-03T21:24:30Z", "commit": {"oid": "8b594a548cd667c6a694446a7c47b6f1388a8b52"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wM1QyMToyNDozMFrOFxXCoQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wM1QyMToyNDozMFrOFxXCoQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzMwMjA0OQ==", "bodyText": "Why would we be adding a test task if there are no unit tests?", "url": "https://github.com/elastic/elasticsearch/pull/53079#discussion_r387302049", "createdAt": "2020-03-03T21:24:30Z", "author": {"login": "rjernst"}, "path": "gradle/bwc-test.gradle", "diffHunk": "@@ -0,0 +1,30 @@\n+import org.elasticsearch.gradle.Version\n+\n+ext.bwcTaskName = { Version version ->\n+  return \"v${version}#bwcTest\"\n+}\n+\n+def bwcTestSnapshots = tasks.register(\"bwcTestSnapshots\") {\n+  if (project.bwc_tests_enabled) {\n+    dependsOn tasks.matching { task -> bwcVersions.unreleased.any { version -> bwcTaskName(version) == task.name } }\n+  }\n+}\n+\n+tasks.register(\"bwcTest\") {\n+  description = 'Runs backwards compatibility tests.'\n+  group = 'verification'\n+\n+  if (project.bwc_tests_enabled) {\n+    dependsOn tasks.matching { it.name ==~ /v[0-9\\.]+#bwcTest/ }\n+  }\n+}\n+\n+tasks.withType(Test).configureEach {\n+  onlyIf { project.bwc_tests_enabled }\n+}\n+\n+tasks.named(\"check\").configure {\n+  dependsOn(bwcTestSnapshots)\n+}\n+\n+test.enabled = false", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8b594a548cd667c6a694446a7c47b6f1388a8b52"}, "originalPosition": 30}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY4Mzc0NzQy", "url": "https://github.com/elastic/elasticsearch/pull/53079#pullrequestreview-368374742", "createdAt": "2020-03-03T22:31:15Z", "commit": {"oid": "8b594a548cd667c6a694446a7c47b6f1388a8b52"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1714, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}