{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE0NjcyODE5", "number": 56339, "title": "[ML] Ensure phase progress may only increase", "bodyText": "Due to multi-threading it is possible that phase progress\nupdates written from the c++ process arrive reordered.\nWe can address this by ensuring that progress may only increase.\nCloses #56282", "createdAt": "2020-05-07T13:03:27Z", "url": "https://github.com/elastic/elasticsearch/pull/56339", "merged": true, "mergeCommit": {"oid": "6645cc59c35bf60243716c47add8068bc0ddb5ab"}, "closed": true, "closedAt": "2020-05-07T15:14:55Z", "author": {"login": "dimitris-athanasiou"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABce81tpgH2gAyNDE0NjcyODE5OjE2NTE2YjMzMDUzMGQ0YjNkYjkxNjBjYjg2ZTA5MjEwOTMxNDI4NzM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABce-A1RAH2gAyNDE0NjcyODE5Ojg4YzRiOWVlNGJhZWZlZTNlMGEzYzZhMzA2MDlhNWFmZWRjZTU1YzA=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "16516b330530d4b3db9160cb86e0921093142873", "author": {"user": {"login": "dimitris-athanasiou", "name": "Dimitris Athanasiou"}}, "url": "https://github.com/elastic/elasticsearch/commit/16516b330530d4b3db9160cb86e0921093142873", "committedDate": "2020-05-07T12:56:47Z", "message": "[ML] Ensure phase progress may only increase\n\nDue to multi-threading it is possible that phase progress\nupdates written from the c++ process arrive reordered.\nWe can address this by ensuring that progress may only increase.\n\nCloses #56282"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA3NDUzNDcy", "url": "https://github.com/elastic/elasticsearch/pull/56339#pullrequestreview-407453472", "createdAt": "2020-05-07T13:08:51Z", "commit": {"oid": "16516b330530d4b3db9160cb86e0921093142873"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA3NDU5Mzcx", "url": "https://github.com/elastic/elasticsearch/pull/56339#pullrequestreview-407459371", "createdAt": "2020-05-07T13:15:54Z", "commit": {"oid": "16516b330530d4b3db9160cb86e0921093142873"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wN1QxMzoxNTo1NVrOGR9-Jw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wN1QxMzoxNTo1NVrOGR9-Jw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTQ5NDMxMQ==", "bodyText": "Could you also add the same assertion after line 90?\nThat would make the test stronger.", "url": "https://github.com/elastic/elasticsearch/pull/56339#discussion_r421494311", "createdAt": "2020-05-07T13:15:55Z", "author": {"login": "przemekwitek"}, "path": "x-pack/plugin/ml/src/test/java/org/elasticsearch/xpack/ml/dataframe/stats/ProgressTrackerTests.java", "diffHunk": "@@ -79,4 +79,15 @@ public void testUpdatePhase_GivenUnknownPhase() {\n         assertThat(phases.stream().map(PhaseProgress::getPhase).collect(Collectors.toList()),\n             contains(\"reindexing\", \"loading_data\", \"foo\", \"writing_results\"));\n     }\n+\n+    public void testUpdatePhase_GivenLowerValueThanCurrentProgress() {\n+        ProgressTracker progressTracker = ProgressTracker.fromZeroes(Collections.singletonList(\"foo\"));\n+        progressTracker.updateReindexingProgress(10);\n+\n+        progressTracker.updateReindexingProgress(11);\n+        assertThat(progressTracker.getReindexingProgressPercent(), equalTo(11));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "16516b330530d4b3db9160cb86e0921093142873"}, "originalPosition": 10}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "24f4542ceaddc14890f71b57de536cd39744c24a", "author": {"user": {"login": "dimitris-athanasiou", "name": "Dimitris Athanasiou"}}, "url": "https://github.com/elastic/elasticsearch/commit/24f4542ceaddc14890f71b57de536cd39744c24a", "committedDate": "2020-05-07T13:59:08Z", "message": "Fix test assertion"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA3NTA5NDU1", "url": "https://github.com/elastic/elasticsearch/pull/56339#pullrequestreview-407509455", "createdAt": "2020-05-07T14:09:14Z", "commit": {"oid": "24f4542ceaddc14890f71b57de536cd39744c24a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "88c4b9ee4baefee3e0a3c6a30609a5afedce55c0", "author": {"user": {"login": "dimitris-athanasiou", "name": "Dimitris Athanasiou"}}, "url": "https://github.com/elastic/elasticsearch/commit/88c4b9ee4baefee3e0a3c6a30609a5afedce55c0", "committedDate": "2020-05-07T14:18:50Z", "message": "Make it actually work"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 199, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}