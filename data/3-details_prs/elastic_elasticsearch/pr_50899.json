{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzYyMDE2MTY5", "number": 50899, "title": "PutIndexTemplateRequest contains a single mapping", "bodyText": "New index templates can only contain a single mapping, as we no longer support\nmultiple types.  This commit changes the internal classes used to represent a\nPutIndexTemplateRequest from holding a map of types to mappings, to instead\nholding a single mapping string.\nRelates to #41059", "createdAt": "2020-01-13T09:32:21Z", "url": "https://github.com/elastic/elasticsearch/pull/50899", "merged": true, "mergeCommit": {"oid": "6573de2ab0ee733c6b82c6cf65bbd219d38761be"}, "closed": true, "closedAt": "2020-01-20T15:05:52Z", "author": {"login": "romseygeek"}, "timelineItems": {"totalCount": 15, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb54iUhgH2gAyMzYyMDE2MTY5Ojg2OTYwY2JlYTAyZjcxZmI3YTlmMzIyMTIxZWEzM2Q5NjgwYWFjMjU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABb8MtafgH2gAyMzYyMDE2MTY5OmYxMGM5N2QxYTVmNDYzNzc2OTI1YjQ5M2JjODhhMWNiNWM3ZmU0ZjQ=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "86960cbea02f71fb7a9f322121ea33d9680aac25", "author": {"user": {"login": "romseygeek", "name": "Alan Woodward"}}, "url": "https://github.com/elastic/elasticsearch/commit/86960cbea02f71fb7a9f322121ea33d9680aac25", "committedDate": "2020-01-13T09:00:47Z", "message": "PutIndexTemplateRequest contains a single mapping"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQyOTA4NzEw", "url": "https://github.com/elastic/elasticsearch/pull/50899#pullrequestreview-342908710", "createdAt": "2020-01-14T23:34:11Z", "commit": {"oid": "86960cbea02f71fb7a9f322121ea33d9680aac25"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNFQyMzozNDoxMVrOFdpOnA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNFQyMzo1NzozOFrOFdpnUg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjYyODUwOA==", "bodyText": "Small comment: this could be marked @Nullable.", "url": "https://github.com/elastic/elasticsearch/pull/50899#discussion_r366628508", "createdAt": "2020-01-14T23:34:11Z", "author": {"login": "jtibshirani"}, "path": "server/src/main/java/org/elasticsearch/action/admin/indices/template/put/PutIndexTemplateRequest.java", "diffHunk": "@@ -79,7 +78,7 @@\n \n     private Settings settings = EMPTY_SETTINGS;\n \n-    private Map<String, String> mappings = new HashMap<>();\n+    private String mappings;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "86960cbea02f71fb7a9f322121ea33d9680aac25"}, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjYzMjkzNQ==", "bodyText": "This test still seems relevant, since we kept the type wrapping logic in PutIndexTemplateRequest:\nif (source.size() != 1 || source.containsKey(MapperService.SINGLE_MAPPING_NAME) == false) {\n    Map.of(MapperService.SINGLE_MAPPING_NAME, source);\n}\n\nWe could wait to remove it until we stop wrapping mappings with a type name?", "url": "https://github.com/elastic/elasticsearch/pull/50899#discussion_r366632935", "createdAt": "2020-01-14T23:50:23Z", "author": {"login": "jtibshirani"}, "path": "server/src/test/java/org/elasticsearch/action/admin/indices/template/put/PutIndexTemplateRequestTests.java", "diffHunk": "@@ -57,67 +53,6 @@ public void testValidateErrorMessage() {\n         assertThat(noError, is(nullValue()));\n     }\n \n-    public void testMappingKeyedByType() throws IOException {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "86960cbea02f71fb7a9f322121ea33d9680aac25"}, "originalPosition": 26}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjYzNDgzNA==", "bodyText": "This seems to both perform the refactor but also adjust the scope of the try ... catch. Is there a good reason to change this? Otherwise we could leave it as-is to minimize extra changes.", "url": "https://github.com/elastic/elasticsearch/pull/50899#discussion_r366634834", "createdAt": "2020-01-14T23:57:38Z", "author": {"login": "jtibshirani"}, "path": "server/src/main/java/org/elasticsearch/cluster/metadata/MetaDataIndexTemplateService.java", "diffHunk": "@@ -240,19 +238,15 @@ private static void validateAndAddTemplate(final PutRequest request, IndexTempla\n             templateBuilder.patterns(request.indexPatterns);\n             templateBuilder.settings(request.settings);\n \n-            Map<String, Map<String, Object>> mappingsForValidation = new HashMap<>();\n-            for (Map.Entry<String, String> entry : request.mappings.entrySet()) {\n+            if (request.mappings != null) {\n                 try {\n-                    templateBuilder.putMapping(entry.getKey(), entry.getValue());\n-                } catch (Exception e) {\n-                    throw new MapperParsingException(\"Failed to parse mapping [{}]: {}\", e, entry.getKey(), e.getMessage());\n+                    templateBuilder.putMapping(MapperService.SINGLE_MAPPING_NAME, request.mappings);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "86960cbea02f71fb7a9f322121ea33d9680aac25"}, "originalPosition": 23}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "223852e489bad66960c07d864ca90c79d8a672e0", "author": {"user": {"login": "romseygeek", "name": "Alan Woodward"}}, "url": "https://github.com/elastic/elasticsearch/commit/223852e489bad66960c07d864ca90c79d8a672e0", "committedDate": "2020-01-15T09:28:25Z", "message": "Merge remote-tracking branch 'origin/master' into types-removal/put-index-template"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8a298cd14217bd608a08f42bbf342da278551ea8", "author": {"user": {"login": "romseygeek", "name": "Alan Woodward"}}, "url": "https://github.com/elastic/elasticsearch/commit/8a298cd14217bd608a08f42bbf342da278551ea8", "committedDate": "2020-01-15T09:42:27Z", "message": "reinstate test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "33903f3e92af1ad0e9302acfa54636ca9c764f6b", "author": {"user": {"login": "elasticmachine", "name": "Elastic Machine"}}, "url": "https://github.com/elastic/elasticsearch/commit/33903f3e92af1ad0e9302acfa54636ca9c764f6b", "committedDate": "2020-01-15T11:39:09Z", "message": "Merge branch 'master' into types-removal/put-index-template"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9624e11f503e0a83af89f0cdbe54e28c8b8f855f", "author": {"user": {"login": "romseygeek", "name": "Alan Woodward"}}, "url": "https://github.com/elastic/elasticsearch/commit/9624e11f503e0a83af89f0cdbe54e28c8b8f855f", "committedDate": "2020-01-16T11:51:42Z", "message": "Remove unnecessary try-catch"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f84041f093eebd2aea17329a9e6b901356eb6dd1", "author": {"user": {"login": "romseygeek", "name": "Alan Woodward"}}, "url": "https://github.com/elastic/elasticsearch/commit/f84041f093eebd2aea17329a9e6b901356eb6dd1", "committedDate": "2020-01-16T11:52:32Z", "message": "Merge remote-tracking branch 'romseygeek/types-removal/put-index-template' into types-removal/put-index-template"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "02044ecf8c7c105397c43a9d2d860808f51f715b", "author": {"user": {"login": "elasticmachine", "name": "Elastic Machine"}}, "url": "https://github.com/elastic/elasticsearch/commit/02044ecf8c7c105397c43a9d2d860808f51f715b", "committedDate": "2020-01-16T12:21:54Z", "message": "Merge branch 'master' into types-removal/put-index-template"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQzODgyMzE1", "url": "https://github.com/elastic/elasticsearch/pull/50899#pullrequestreview-343882315", "createdAt": "2020-01-16T12:40:21Z", "commit": {"oid": "02044ecf8c7c105397c43a9d2d860808f51f715b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ec856387247f583a7779349d849c6db393b366dc", "author": {"user": {"login": "romseygeek", "name": "Alan Woodward"}}, "url": "https://github.com/elastic/elasticsearch/commit/ec856387247f583a7779349d849c6db393b366dc", "committedDate": "2020-01-16T13:50:04Z", "message": "tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d975d9e64fb148e4b2b5a3eba316f19ef2815050", "author": {"user": {"login": "romseygeek", "name": "Alan Woodward"}}, "url": "https://github.com/elastic/elasticsearch/commit/d975d9e64fb148e4b2b5a3eba316f19ef2815050", "committedDate": "2020-01-17T08:48:51Z", "message": "Merge remote-tracking branch 'origin/master' into types-removal/put-index-template"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4401adb957ad1df76b133e412e964fca1b6ee35c", "author": {"user": {"login": "romseygeek", "name": "Alan Woodward"}}, "url": "https://github.com/elastic/elasticsearch/commit/4401adb957ad1df76b133e412e964fca1b6ee35c", "committedDate": "2020-01-17T08:55:21Z", "message": "Add try-catch back"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1c866a8f8555a9cef573407f50373f741d7797a0", "author": {"user": {"login": "romseygeek", "name": "Alan Woodward"}}, "url": "https://github.com/elastic/elasticsearch/commit/1c866a8f8555a9cef573407f50373f741d7797a0", "committedDate": "2020-01-17T14:26:54Z", "message": "Merge remote-tracking branch 'origin/master' into types-removal/put-index-template"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ0NzQ0Njk1", "url": "https://github.com/elastic/elasticsearch/pull/50899#pullrequestreview-344744695", "createdAt": "2020-01-17T17:55:48Z", "commit": {"oid": "1c866a8f8555a9cef573407f50373f741d7797a0"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f10c97d1a5f463776925b493bc88a1cb5c7fe4f4", "author": {"user": {"login": "romseygeek", "name": "Alan Woodward"}}, "url": "https://github.com/elastic/elasticsearch/commit/f10c97d1a5f463776925b493bc88a1cb5c7fe4f4", "committedDate": "2020-01-20T13:38:51Z", "message": "Merge remote-tracking branch 'origin/master' into types-removal/put-index-template"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3155, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}