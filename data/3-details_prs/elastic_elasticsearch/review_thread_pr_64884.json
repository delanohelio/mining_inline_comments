{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE4NjUxMjgz", "number": 64884, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQxODozMjo1M1rOE3W3Jw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQxODozMjo1M1rOE3W3Jw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI2NDgxNzAzOnYy", "diffSide": "RIGHT", "path": "server/src/main/java/org/elasticsearch/index/mapper/FieldTypeLookup.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQxODozMjo1M1rOHwp8cg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQxODo1NjowMFrOHwrDVA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDc4MDkxNA==", "bodyText": "I think we can extend this to DynamicKeyFieldTypeLookup as well?  Rather than passing the whole alias map, just check for each alias path to see if it matches an existing entry in the dynamicKeyMappers map, and if it does, add a new entry with the alias path and the original dynamic mapper.", "url": "https://github.com/elastic/elasticsearch/pull/64884#discussion_r520780914", "createdAt": "2020-11-10T18:32:53Z", "author": {"login": "romseygeek"}, "path": "server/src/main/java/org/elasticsearch/index/mapper/FieldTypeLookup.java", "diffHunk": "@@ -70,10 +69,12 @@\n             }\n         }\n \n+        final Map<String, String> aliasToConcreteName = new HashMap<>();\n         for (FieldAliasMapper fieldAliasMapper : fieldAliasMappers) {\n             String aliasName = fieldAliasMapper.name();\n             String path = fieldAliasMapper.path();\n             aliasToConcreteName.put(aliasName, path);\n+            fullNameToFieldType.put(aliasName, fullNameToFieldType.get(path));\n         }\n \n         this.dynamicKeyLookup = new DynamicKeyFieldTypeLookup(dynamicKeyMappers, aliasToConcreteName);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fff36206c5faf007934b0601e535de8832d18d99"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDc5OTA2MA==", "bodyText": "I was a bit nervous about adapting DynamicKeyFieldTypeLookup, I did not find a straight-forward replacement for the map, and I am happy to look as a followup", "url": "https://github.com/elastic/elasticsearch/pull/64884#discussion_r520799060", "createdAt": "2020-11-10T18:56:00Z", "author": {"login": "javanna"}, "path": "server/src/main/java/org/elasticsearch/index/mapper/FieldTypeLookup.java", "diffHunk": "@@ -70,10 +69,12 @@\n             }\n         }\n \n+        final Map<String, String> aliasToConcreteName = new HashMap<>();\n         for (FieldAliasMapper fieldAliasMapper : fieldAliasMappers) {\n             String aliasName = fieldAliasMapper.name();\n             String path = fieldAliasMapper.path();\n             aliasToConcreteName.put(aliasName, path);\n+            fullNameToFieldType.put(aliasName, fullNameToFieldType.get(path));\n         }\n \n         this.dynamicKeyLookup = new DynamicKeyFieldTypeLookup(dynamicKeyMappers, aliasToConcreteName);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDc4MDkxNA=="}, "originalCommit": {"oid": "fff36206c5faf007934b0601e535de8832d18d99"}, "originalPosition": 20}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3076, "cost": 1, "resetAt": "2021-11-12T13:16:51Z"}}}