{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzYzODM4NTQ0", "number": 51130, "title": "Expose master timeout for ILM actions", "bodyText": "This change exposes master timeout to ILM steps through global dynamic setting.\nAll currently implemented steps make use of this setting as well.\nCloses #44136", "createdAt": "2020-01-16T20:48:34Z", "url": "https://github.com/elastic/elasticsearch/pull/51130", "merged": true, "mergeCommit": {"oid": "0801f39eddc586a2aa90e69294463fa8c031e2dd"}, "closed": true, "closedAt": "2020-01-23T13:24:27Z", "author": {"login": "probakowski"}, "timelineItems": {"totalCount": 25, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb4cwX6AH2gAyMzYzODM4NTQ0OmI1YTgwY2YxOWJlY2EyZTg5ZGJjMTdiYjgxMWNiYTVmNjcyZDQ5Y2Q=", "endCursor": "Y3Vyc29yOnYyOpPPAAABb9IWnRgFqTM0NzIxNzAwNw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "b5a80cf19beca2e89dbc17bb811cba5f672d49cd", "author": {"user": {"login": "probakowski", "name": "Przemko Robakowski"}}, "url": "https://github.com/elastic/elasticsearch/commit/b5a80cf19beca2e89dbc17bb811cba5f672d49cd", "committedDate": "2020-01-08T22:04:52Z", "message": "Master timeout in ILM actions"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9b229119797efc66723089951703af8753dac5c7", "author": {"user": {"login": "probakowski", "name": "Przemko Robakowski"}}, "url": "https://github.com/elastic/elasticsearch/commit/9b229119797efc66723089951703af8753dac5c7", "committedDate": "2020-01-13T22:36:23Z", "message": "Tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4823366bc1a6202b929e0dc8a15b606d529db3d9", "author": {"user": {"login": "probakowski", "name": "Przemko Robakowski"}}, "url": "https://github.com/elastic/elasticsearch/commit/4823366bc1a6202b929e0dc8a15b606d529db3d9", "committedDate": "2020-01-14T21:24:38Z", "message": "Merge remote-tracking branch 'origin/master' into ilm-master-timeout"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f93a9099dc4e1dd616b1027c18ed2bd92521d909", "author": {"user": {"login": "probakowski", "name": "Przemko Robakowski"}}, "url": "https://github.com/elastic/elasticsearch/commit/f93a9099dc4e1dd616b1027c18ed2bd92521d909", "committedDate": "2020-01-15T12:21:02Z", "message": "Additional tests/refactoring"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7bd6d9a8c8dd9352398b3b740b965def1327b179", "author": {"user": {"login": "probakowski", "name": "Przemko Robakowski"}}, "url": "https://github.com/elastic/elasticsearch/commit/7bd6d9a8c8dd9352398b3b740b965def1327b179", "committedDate": "2020-01-15T12:33:48Z", "message": "Spelling fix"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6b63fcca5355fd9c175785697074a8e8aed0ec38", "author": {"user": {"login": "probakowski", "name": "Przemko Robakowski"}}, "url": "https://github.com/elastic/elasticsearch/commit/6b63fcca5355fd9c175785697074a8e8aed0ec38", "committedDate": "2020-01-16T20:36:31Z", "message": "Moved setting to LifecycleSettings"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5540736da148514725cab163c77b873159a0eb64", "author": {"user": {"login": "probakowski", "name": "Przemko Robakowski"}}, "url": "https://github.com/elastic/elasticsearch/commit/5540736da148514725cab163c77b873159a0eb64", "committedDate": "2020-01-16T20:48:19Z", "message": "Changed evaluateCondition method"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9d3c67f65d76ebb3231a735f7b716dbf81996f95", "author": {"user": {"login": "probakowski", "name": "Przemko Robakowski"}}, "url": "https://github.com/elastic/elasticsearch/commit/9d3c67f65d76ebb3231a735f7b716dbf81996f95", "committedDate": "2020-01-16T21:11:23Z", "message": "Unused imports removed"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9bcf64b35b099f9b8721881ce3c80cf10063a8dc", "author": {"user": {"login": "probakowski", "name": "Przemko Robakowski"}}, "url": "https://github.com/elastic/elasticsearch/commit/9bcf64b35b099f9b8721881ce3c80cf10063a8dc", "committedDate": "2020-01-16T21:37:59Z", "message": "Compilation fixed"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "264f5a4ad9e7e8c198c34521aec2999afe2d9fea", "author": {"user": {"login": "probakowski", "name": "Przemko Robakowski"}}, "url": "https://github.com/elastic/elasticsearch/commit/264f5a4ad9e7e8c198c34521aec2999afe2d9fea", "committedDate": "2020-01-16T22:12:47Z", "message": "Unused imports removed"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "55fbd4cfe088dbd26dae178c18a73c203a9e78c8", "author": {"user": {"login": "probakowski", "name": "Przemko Robakowski"}}, "url": "https://github.com/elastic/elasticsearch/commit/55fbd4cfe088dbd26dae178c18a73c203a9e78c8", "committedDate": "2020-01-16T22:38:56Z", "message": "Test fix"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "090b6b470982040fc29a4fd701d5a221260d6939", "author": {"user": {"login": "elasticmachine", "name": "Elastic Machine"}}, "url": "https://github.com/elastic/elasticsearch/commit/090b6b470982040fc29a4fd701d5a221260d6939", "committedDate": "2020-01-16T22:59:03Z", "message": "Merge branch 'master' into ilm-master-timeout"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ0NDY3Nzk2", "url": "https://github.com/elastic/elasticsearch/pull/51130#pullrequestreview-344467796", "createdAt": "2020-01-17T09:52:58Z", "commit": {"oid": "090b6b470982040fc29a4fd701d5a221260d6939"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xN1QwOTo1Mjo1OVrOFez3gg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xN1QxMDowNzoxMVrOFe0QmA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Nzg1MTM5NA==", "bodyText": "Could we call the listener here directly? ie. listener.onFailure(new UnsupportedOperationException())", "url": "https://github.com/elastic/elasticsearch/pull/51130#discussion_r367851394", "createdAt": "2020-01-17T09:52:59Z", "author": {"login": "andreidan"}, "path": "x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/ilm/AsyncWaitStep.java", "diffHunk": "@@ -28,11 +29,21 @@ protected Client getClient() {\n         return client;\n     }\n \n-    public abstract void evaluateCondition(IndexMetaData indexMetaData, Listener listener);\n+    public void evaluateCondition(Settings settings, IndexMetaData indexMetaData, Listener listener){\n+        evaluateCondition(indexMetaData, listener);\n+    }\n+\n+    public void evaluateCondition(IndexMetaData indexMetaData, Listener listener){\n+        try {\n+            throw new UnsupportedOperationException();\n+        } catch (UnsupportedOperationException e) {\n+            listener.onFailure(e);\n+        }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "090b6b470982040fc29a4fd701d5a221260d6939"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Nzg1MzkwNQ==", "bodyText": "We don't work with null cluster states so I think this null check could be dropped. Or is there a particular case where a null ClusterState is passed in?", "url": "https://github.com/elastic/elasticsearch/pull/51130#discussion_r367853905", "createdAt": "2020-01-17T09:58:20Z", "author": {"login": "andreidan"}, "path": "x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/ilm/Step.java", "diffHunk": "@@ -60,14 +64,21 @@ public boolean equals(Object obj) {\n         }\n         Step other = (Step) obj;\n         return Objects.equals(key, other.key) &&\n-                Objects.equals(nextStepKey, other.nextStepKey);\n+            Objects.equals(nextStepKey, other.nextStepKey);\n     }\n \n     @Override\n     public String toString() {\n         return key + \" => \" + nextStepKey;\n     }\n \n+    protected TimeValue getMasterTimeout(ClusterState clusterState){\n+        if(clusterState == null){", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "090b6b470982040fc29a4fd701d5a221260d6939"}, "originalPosition": 37}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Nzg1NzgxNg==", "bodyText": "On second thought, would it make sense to have only one method? ie. add the Settings as parameter? Or even more, maybe pass the timeout directly (as currently that's the only reason we want to modify this signature) ?", "url": "https://github.com/elastic/elasticsearch/pull/51130#discussion_r367857816", "createdAt": "2020-01-17T10:07:11Z", "author": {"login": "andreidan"}, "path": "x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/ilm/AsyncWaitStep.java", "diffHunk": "@@ -28,11 +29,21 @@ protected Client getClient() {\n         return client;\n     }\n \n-    public abstract void evaluateCondition(IndexMetaData indexMetaData, Listener listener);\n+    public void evaluateCondition(Settings settings, IndexMetaData indexMetaData, Listener listener){\n+        evaluateCondition(indexMetaData, listener);\n+    }\n+\n+    public void evaluateCondition(IndexMetaData indexMetaData, Listener listener){\n+        try {\n+            throw new UnsupportedOperationException();\n+        } catch (UnsupportedOperationException e) {\n+            listener.onFailure(e);\n+        }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Nzg1MTM5NA=="}, "originalCommit": {"oid": "090b6b470982040fc29a4fd701d5a221260d6939"}, "originalPosition": 22}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ0ODcwMTk1", "url": "https://github.com/elastic/elasticsearch/pull/51130#pullrequestreview-344870195", "createdAt": "2020-01-17T22:14:26Z", "commit": {"oid": "090b6b470982040fc29a4fd701d5a221260d6939"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xN1QyMjoxNDoyNlrOFfGmjQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xN1QyMjozNDo1NFrOFfG9JA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODE1ODM0OQ==", "bodyText": "I think it would make more sense to change the single, abstract, method. We should be able to pass in the Settings where necessary and just ignore them on the steps that don't need them.", "url": "https://github.com/elastic/elasticsearch/pull/51130#discussion_r368158349", "createdAt": "2020-01-17T22:14:26Z", "author": {"login": "dakrone"}, "path": "x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/ilm/AsyncWaitStep.java", "diffHunk": "@@ -28,11 +29,21 @@ protected Client getClient() {\n         return client;\n     }\n \n-    public abstract void evaluateCondition(IndexMetaData indexMetaData, Listener listener);\n+    public void evaluateCondition(Settings settings, IndexMetaData indexMetaData, Listener listener){\n+        evaluateCondition(indexMetaData, listener);\n+    }\n+\n+    public void evaluateCondition(IndexMetaData indexMetaData, Listener listener){\n+        try {\n+            throw new UnsupportedOperationException();\n+        } catch (UnsupportedOperationException e) {\n+            listener.onFailure(e);\n+        }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Nzg1MTM5NA=="}, "originalCommit": {"oid": "090b6b470982040fc29a4fd701d5a221260d6939"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODE1ODg0Ng==", "bodyText": "I think this should be Objects.requireNonNull(clusterState, \"cannot determine master timeout when cluster state is null\");, even though I agree and think it won't be possible (could still be possible if someone invokes it incorrectly)", "url": "https://github.com/elastic/elasticsearch/pull/51130#discussion_r368158846", "createdAt": "2020-01-17T22:16:23Z", "author": {"login": "dakrone"}, "path": "x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/ilm/Step.java", "diffHunk": "@@ -60,14 +64,21 @@ public boolean equals(Object obj) {\n         }\n         Step other = (Step) obj;\n         return Objects.equals(key, other.key) &&\n-                Objects.equals(nextStepKey, other.nextStepKey);\n+            Objects.equals(nextStepKey, other.nextStepKey);\n     }\n \n     @Override\n     public String toString() {\n         return key + \" => \" + nextStepKey;\n     }\n \n+    protected TimeValue getMasterTimeout(ClusterState clusterState){\n+        if(clusterState == null){", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Nzg1MzkwNQ=="}, "originalCommit": {"oid": "090b6b470982040fc29a4fd701d5a221260d6939"}, "originalPosition": 37}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODE1OTA3MA==", "bodyText": "This method can be static", "url": "https://github.com/elastic/elasticsearch/pull/51130#discussion_r368159070", "createdAt": "2020-01-17T22:17:04Z", "author": {"login": "dakrone"}, "path": "x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/ilm/Step.java", "diffHunk": "@@ -60,14 +64,21 @@ public boolean equals(Object obj) {\n         }\n         Step other = (Step) obj;\n         return Objects.equals(key, other.key) &&\n-                Objects.equals(nextStepKey, other.nextStepKey);\n+            Objects.equals(nextStepKey, other.nextStepKey);\n     }\n \n     @Override\n     public String toString() {\n         return key + \" => \" + nextStepKey;\n     }\n \n+    protected TimeValue getMasterTimeout(ClusterState clusterState){", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "090b6b470982040fc29a4fd701d5a221260d6939"}, "originalPosition": 36}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODE1OTgwMA==", "bodyText": "can this use the getMasterTimeout method instead?", "url": "https://github.com/elastic/elasticsearch/pull/51130#discussion_r368159800", "createdAt": "2020-01-17T22:19:32Z", "author": {"login": "dakrone"}, "path": "x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/ilm/WaitForRolloverReadyStep.java", "diffHunk": "@@ -113,7 +119,8 @@ public void evaluateCondition(IndexMetaData indexMetaData, Listener listener) {\n                 \"index [%s] is not the write index for alias [%s]\", indexMetaData.getIndex().getName(), rolloverAlias)));\n         }\n \n-        RolloverRequest rolloverRequest = new RolloverRequest(rolloverAlias, null);\n+        RolloverRequest rolloverRequest = new RolloverRequest(rolloverAlias, null)\n+            .masterNodeTimeout(LifecycleSettings.LIFECYCLE_STEP_MASTER_TIMEOUT_SETTING.get(settings));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "090b6b470982040fc29a4fd701d5a221260d6939"}, "originalPosition": 26}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODE2NDEzMg==", "bodyText": "I think we can do all this without mocking. I think by subclassing NoOpClient to check the executed request's master node timeout we can essentially do this check. I think this will be cleaner and less likely to break in the future than mocks.", "url": "https://github.com/elastic/elasticsearch/pull/51130#discussion_r368164132", "createdAt": "2020-01-17T22:34:54Z", "author": {"login": "dakrone"}, "path": "x-pack/plugin/core/src/test/java/org/elasticsearch/xpack/core/ilm/AbstractStepMasterTimeoutTestCase.java", "diffHunk": "@@ -0,0 +1,83 @@\n+/*\n+ * Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one\n+ * or more contributor license agreements. Licensed under the Elastic License;\n+ * you may not use this file except in compliance with the Elastic License.\n+ */\n+package org.elasticsearch.xpack.core.ilm;\n+\n+import org.elasticsearch.action.support.master.MasterNodeRequest;\n+import org.elasticsearch.client.AdminClient;\n+import org.elasticsearch.client.Client;\n+import org.elasticsearch.client.IndicesAdminClient;\n+import org.elasticsearch.cluster.ClusterName;\n+import org.elasticsearch.cluster.ClusterState;\n+import org.elasticsearch.cluster.metadata.IndexMetaData;\n+import org.elasticsearch.cluster.metadata.MetaData;\n+import org.elasticsearch.common.settings.Settings;\n+import org.elasticsearch.common.unit.TimeValue;\n+import org.junit.Before;\n+import org.mockito.Mockito;\n+import org.mockito.stubbing.Stubber;\n+\n+import static org.elasticsearch.xpack.core.ilm.LifecycleSettings.LIFECYCLE_STEP_MASTER_TIMEOUT;\n+import static org.hamcrest.Matchers.equalTo;\n+\n+public abstract class AbstractStepMasterTimeoutTestCase<T extends AsyncActionStep> extends AbstractStepTestCase<T> {\n+\n+    protected Client client;\n+    protected AdminClient adminClient;\n+    protected IndicesAdminClient indicesClient;\n+\n+    @Before\n+    public void setup() {\n+        client = Mockito.mock(Client.class);\n+        adminClient = Mockito.mock(AdminClient.class);\n+        Mockito.when(client.admin()).thenReturn(adminClient);\n+        indicesClient = Mockito.mock(IndicesAdminClient.class);\n+        Mockito.when(adminClient.indices()).thenReturn(indicesClient);\n+    }\n+\n+    public void testMasterTimeout() {\n+        checkMasterTimeout(TimeValue.timeValueSeconds(30),\n+            ClusterState.builder(ClusterName.DEFAULT).metaData(MetaData.builder().build()).build());\n+        checkMasterTimeout(TimeValue.timeValueSeconds(10),\n+            ClusterState.builder(ClusterName.DEFAULT)\n+                .metaData(MetaData.builder()\n+                    .persistentSettings(Settings.builder().put(LIFECYCLE_STEP_MASTER_TIMEOUT, \"10s\").build())\n+                    .build())\n+                .build());\n+    }\n+\n+    @SuppressWarnings(\"rawtypes\")\n+    private void checkMasterTimeout(TimeValue timeValue, ClusterState currentClusterState) {\n+        IndexMetaData indexMetadata = getIndexMetaData();\n+\n+        Stubber checkTimeout = Mockito.doAnswer(invocation -> {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "090b6b470982040fc29a4fd701d5a221260d6939"}, "originalPosition": 55}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7cc4dc5cc8b6c8e74898652a60434ebd013b67cf", "author": {"user": {"login": "probakowski", "name": "Przemko Robakowski"}}, "url": "https://github.com/elastic/elasticsearch/commit/7cc4dc5cc8b6c8e74898652a60434ebd013b67cf", "committedDate": "2020-01-20T22:48:44Z", "message": "PR review comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e2be19695280d9de1cc312fc8a946bc9d6f09483", "author": {"user": {"login": "probakowski", "name": "Przemko Robakowski"}}, "url": "https://github.com/elastic/elasticsearch/commit/e2be19695280d9de1cc312fc8a946bc9d6f09483", "committedDate": "2020-01-21T10:50:13Z", "message": "PR review comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2be49726e8717d4a53e5779f71a5ef5bfa603796", "author": {"user": {"login": "probakowski", "name": "Przemko Robakowski"}}, "url": "https://github.com/elastic/elasticsearch/commit/2be49726e8717d4a53e5779f71a5ef5bfa603796", "committedDate": "2020-01-21T11:02:12Z", "message": "Unused imports removed"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4d16cd68d9e44c1fa28e3ee9def7620b72d48d41", "author": {"user": {"login": "elasticmachine", "name": "Elastic Machine"}}, "url": "https://github.com/elastic/elasticsearch/commit/4d16cd68d9e44c1fa28e3ee9def7620b72d48d41", "committedDate": "2020-01-21T11:29:05Z", "message": "Merge branch 'master' into ilm-master-timeout"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ1ODc0NzM1", "url": "https://github.com/elastic/elasticsearch/pull/51130#pullrequestreview-345874735", "createdAt": "2020-01-21T13:28:57Z", "commit": {"oid": "4d16cd68d9e44c1fa28e3ee9def7620b72d48d41"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMVQxMzoyODo1OFrOFf566A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMVQxMzoyODo1OFrOFf566A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODk5OTE0NA==", "bodyText": "Most subclasses already shadow these mockings/instances in the tests where they are applicable. I think this base class should not attempt to instantiate more than it uses/templates (ie. ThreadPool) and if we decide to centralise all the mocks/stubs in the base class I think we should remove the re-declaration from the tests (eg. OpenFollowerIndexStepTests, RolloverStepTests etc). I think that could be a follow-up PR to reduce the scope of this one, so I propose we remove the mocks/stubs from the base class for now.\nWhat do you think?", "url": "https://github.com/elastic/elasticsearch/pull/51130#discussion_r368999144", "createdAt": "2020-01-21T13:28:58Z", "author": {"login": "andreidan"}, "path": "x-pack/plugin/core/src/test/java/org/elasticsearch/xpack/core/ilm/AbstractStepMasterTimeoutTestCase.java", "diffHunk": "@@ -0,0 +1,95 @@\n+/*\n+ * Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one\n+ * or more contributor license agreements. Licensed under the Elastic License;\n+ * you may not use this file except in compliance with the Elastic License.\n+ */\n+package org.elasticsearch.xpack.core.ilm;\n+\n+import org.elasticsearch.action.ActionListener;\n+import org.elasticsearch.action.ActionRequest;\n+import org.elasticsearch.action.ActionResponse;\n+import org.elasticsearch.action.ActionType;\n+import org.elasticsearch.action.support.master.MasterNodeRequest;\n+import org.elasticsearch.client.AdminClient;\n+import org.elasticsearch.client.Client;\n+import org.elasticsearch.client.IndicesAdminClient;\n+import org.elasticsearch.cluster.ClusterName;\n+import org.elasticsearch.cluster.ClusterState;\n+import org.elasticsearch.cluster.metadata.IndexMetaData;\n+import org.elasticsearch.cluster.metadata.MetaData;\n+import org.elasticsearch.common.settings.Settings;\n+import org.elasticsearch.common.unit.TimeValue;\n+import org.elasticsearch.test.client.NoOpClient;\n+import org.elasticsearch.threadpool.TestThreadPool;\n+import org.elasticsearch.threadpool.ThreadPool;\n+import org.junit.After;\n+import org.junit.Before;\n+import org.mockito.Mockito;\n+\n+import static org.elasticsearch.xpack.core.ilm.LifecycleSettings.LIFECYCLE_STEP_MASTER_TIMEOUT;\n+import static org.hamcrest.Matchers.equalTo;\n+\n+public abstract class AbstractStepMasterTimeoutTestCase<T extends AsyncActionStep> extends AbstractStepTestCase<T> {\n+\n+    protected Client client;\n+    protected AdminClient adminClient;\n+    protected IndicesAdminClient indicesClient;\n+    protected ThreadPool pool;\n+\n+    @Before\n+    public void setup() {\n+        client = Mockito.mock(Client.class);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4d16cd68d9e44c1fa28e3ee9def7620b72d48d41"}, "originalPosition": 41}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ2MjQ3MzEz", "url": "https://github.com/elastic/elasticsearch/pull/51130#pullrequestreview-346247313", "createdAt": "2020-01-21T22:51:44Z", "commit": {"oid": "4d16cd68d9e44c1fa28e3ee9def7620b72d48d41"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "32d263e8beb3c7a4bde54b2f8cac36e99ea90b6d", "author": {"user": {"login": "probakowski", "name": "Przemko Robakowski"}}, "url": "https://github.com/elastic/elasticsearch/commit/32d263e8beb3c7a4bde54b2f8cac36e99ea90b6d", "committedDate": "2020-01-23T00:03:21Z", "message": "PR review comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "393111ee9bca08ab1e5d4ba0c9db90cbf57d8b00", "author": {"user": {"login": "probakowski", "name": "Przemko Robakowski"}}, "url": "https://github.com/elastic/elasticsearch/commit/393111ee9bca08ab1e5d4ba0c9db90cbf57d8b00", "committedDate": "2020-01-23T00:05:54Z", "message": "Removed unnecessary changes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fd0a50709fd4f4c1370da98b0f2f694b92946b4a", "author": {"user": {"login": "probakowski", "name": "Przemko Robakowski"}}, "url": "https://github.com/elastic/elasticsearch/commit/fd0a50709fd4f4c1370da98b0f2f694b92946b4a", "committedDate": "2020-01-23T00:19:47Z", "message": "Merge branch 'master' into ilm-master-timeout"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6fc450fe3ffe869c85f1c1c1457f5753dfbbc0ca", "author": {"user": {"login": "probakowski", "name": "Przemko Robakowski"}}, "url": "https://github.com/elastic/elasticsearch/commit/6fc450fe3ffe869c85f1c1c1457f5753dfbbc0ca", "committedDate": "2020-01-23T01:05:15Z", "message": "Setup/teardown renamed"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ3MjE3MDA3", "url": "https://github.com/elastic/elasticsearch/pull/51130#pullrequestreview-347217007", "createdAt": "2020-01-23T11:08:15Z", "commit": {"oid": "6fc450fe3ffe869c85f1c1c1457f5753dfbbc0ca"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2943, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}