{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY5ODkxNzk4", "number": 51783, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wM1QxMDoxNzozMVrODclMgQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNFQxMDo0MTozMFrODc7oXw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMxMjk2MTI5OnYy", "diffSide": "RIGHT", "path": "server/src/main/java/org/elasticsearch/index/mapper/RootObjectMapper.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wM1QxMDoxNzozMVrOFksYYQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wM1QyMzoyNTo0N1rOFlDgoQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDAyMDE5Mw==", "bodyText": "small style nit: can you use ((fieldNode instanceof List) == false) instead? We prefer that kind of more verbose state to the negate operator for better readability throughout the codebase.", "url": "https://github.com/elastic/elasticsearch/pull/51783#discussion_r374020193", "createdAt": "2020-02-03T10:17:31Z", "author": {"login": "cbuescher"}, "path": "server/src/main/java/org/elasticsearch/index/mapper/RootObjectMapper.java", "diffHunk": "@@ -168,6 +168,9 @@ protected boolean processField(RootObjectMapper.Builder builder, String fieldNam\n                       }\n                   ]\n                 */\n+                if (!(fieldNode instanceof List)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "41b90b3e2af9fb7004ea6fa238a98ad77e7c7035"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDM5OTEzNw==", "bodyText": "@cbuescher ok I will fix for you suggest", "url": "https://github.com/elastic/elasticsearch/pull/51783#discussion_r374399137", "createdAt": "2020-02-03T23:25:47Z", "author": {"login": "feifeiiiiiiiiiii"}, "path": "server/src/main/java/org/elasticsearch/index/mapper/RootObjectMapper.java", "diffHunk": "@@ -168,6 +168,9 @@ protected boolean processField(RootObjectMapper.Builder builder, String fieldNam\n                       }\n                   ]\n                 */\n+                if (!(fieldNode instanceof List)) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDAyMDE5Mw=="}, "originalCommit": {"oid": "41b90b3e2af9fb7004ea6fa238a98ad77e7c7035"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMxMjk3Njg4OnYy", "diffSide": "RIGHT", "path": "server/src/main/java/org/elasticsearch/index/mapper/RootObjectMapper.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wM1QxMDoyMjowOFrOFkshVQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wM1QxMDoyMjowOFrOFkshVQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDAyMjQ4NQ==", "bodyText": "I think it would be good to provide some more information the user what went wrong. In this case it would be great to tell the user know that dynamic_templates expects an array of named objects or something along those lines.", "url": "https://github.com/elastic/elasticsearch/pull/51783#discussion_r374022485", "createdAt": "2020-02-03T10:22:08Z", "author": {"login": "cbuescher"}, "path": "server/src/main/java/org/elasticsearch/index/mapper/RootObjectMapper.java", "diffHunk": "@@ -168,6 +168,9 @@ protected boolean processField(RootObjectMapper.Builder builder, String fieldNam\n                       }\n                   ]\n                 */\n+                if (!(fieldNode instanceof List)) {\n+                    throw new MapperParsingException(\"Dynamic template syntax error\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "41b90b3e2af9fb7004ea6fa238a98ad77e7c7035"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMxNjYyNTYzOnYy", "diffSide": "RIGHT", "path": "server/src/test/java/org/elasticsearch/index/mapper/RootObjectMapperTests.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNFQxMDozNzo0N1rOFlPZcQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNFQxMDozNzo0N1rOFlPZcQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDU5MzkwNQ==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            }\n          \n          \n            \n            }\n          \n      \n    \n    \n  \n\nThis closing bracket is too much now, class closed in line 203 already so the test doesn't compile. Please remove the last two lines so the class compiles.", "url": "https://github.com/elastic/elasticsearch/pull/51783#discussion_r374593905", "createdAt": "2020-02-04T10:37:47Z", "author": {"login": "cbuescher"}, "path": "server/src/test/java/org/elasticsearch/index/mapper/RootObjectMapperTests.java", "diffHunk": "@@ -185,4 +185,21 @@ public void testIllegalFormatField() throws Exception {\n             assertEquals(\"Invalid format: [[test_format]]: expected string value\", e.getMessage());\n         }\n     }\n+\n+    public void testIllegalDynamicTemplates() throws Exception {\n+        String mapping = Strings.toString(XContentFactory.jsonBuilder()\n+                .startObject()\n+                .startObject(\"type\")\n+                    .startObject(\"dynamic_templates\")\n+                    .endObject()\n+                .endObject()\n+            .endObject());\n+\n+        DocumentMapperParser parser = createIndex(\"test\").mapperService().documentMapperParser();\n+        MapperParsingException e = expectThrows(MapperParsingException.class,\n+                    () -> parser.parse(\"type\", new CompressedXContent(mapping)));\n+            assertEquals(\"Dynamic template syntax error, expects an array of named objects\", e.getMessage());\n+    }\n+}\n+\n }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8e4460bd00b7552228e61378cc745312f54a82c4"}, "originalPosition": 21}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMxNjYzNzExOnYy", "diffSide": "RIGHT", "path": "server/src/main/java/org/elasticsearch/index/mapper/RootObjectMapper.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNFQxMDo0MTozMFrOFlPgbQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNFQxMDo0MTozMFrOFlPgbQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDU5NTY5Mw==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                                throw new MapperParsingException(\"Dynamic template syntax error, expects an array of named objects\");\n          \n          \n            \n                                throw new MapperParsingException(\"Dynamic template syntax error. An array of named objects is expected.\");\n          \n      \n    \n    \n  \n\nsmall wording nit, with \"expects\" in the previous example its not clear what the subject is (i.e. what expects the array. Using passive voice this should be clearer.", "url": "https://github.com/elastic/elasticsearch/pull/51783#discussion_r374595693", "createdAt": "2020-02-04T10:41:30Z", "author": {"login": "cbuescher"}, "path": "server/src/main/java/org/elasticsearch/index/mapper/RootObjectMapper.java", "diffHunk": "@@ -168,6 +168,9 @@ protected boolean processField(RootObjectMapper.Builder builder, String fieldNam\n                       }\n                   ]\n                 */\n+                if ((fieldNode instanceof List) == false) {\n+                    throw new MapperParsingException(\"Dynamic template syntax error, expects an array of named objects\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8e4460bd00b7552228e61378cc745312f54a82c4"}, "originalPosition": 5}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 33, "cost": 1, "resetAt": "2021-11-12T11:57:46Z"}}}