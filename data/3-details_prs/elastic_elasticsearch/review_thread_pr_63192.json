{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDk2OTQzMzM0", "number": 63192, "reviewThreads": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMlQxNDoyOTowOFrOEp1dWQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNVQwNjoxMTowMVrOEqLC7w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEyMzAyOTM3OnYy", "diffSide": "RIGHT", "path": "x-pack/plugin/eql/qa/security/src/javaRestTest/java/org/elasticsearch/xpack/eql/AsyncEqlSecurityIT.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMlQxNDoyOTowOFrOHbv1KA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMlQxNjo0MDo1NFrOHb0XMQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODg1NzI1Ng==", "bodyText": "@imotov not sure why this fails now... Essentially by changing the index option ignoreUnavailable from false to true the 403/unauthorized became a 404...", "url": "https://github.com/elastic/elasticsearch/pull/63192#discussion_r498857256", "createdAt": "2020-10-02T14:29:08Z", "author": {"login": "costin"}, "path": "x-pack/plugin/eql/qa/security/src/javaRestTest/java/org/elasticsearch/xpack/eql/AsyncEqlSecurityIT.java", "diffHunk": "@@ -89,8 +89,8 @@ private void testCase(String user, String other) throws Exception {\n         }\n         ResponseException exc = expectThrows(ResponseException.class,\n             () -> submitAsyncEqlSearch(\"index-\" + other, \"*\", TimeValue.timeValueSeconds(10), user));\n-        assertThat(exc.getResponse().getStatusLine().getStatusCode(), equalTo(403));\n-        assertThat(exc.getMessage(), containsString(\"unauthorized\"));\n+        assertThat(exc.getResponse().getStatusLine().getStatusCode(), equalTo(404));\n+        //assertThat(exc.getMessage(), containsString(\"unauthorized\"));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2e4de89d048d36c7a4a709da80bdd8fcf056fb49"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODg5Mjc3MQ==", "bodyText": "I think it is because we ignore unavailable indices and ended up with no indices at all, which leads to 404.", "url": "https://github.com/elastic/elasticsearch/pull/63192#discussion_r498892771", "createdAt": "2020-10-02T15:27:51Z", "author": {"login": "imotov"}, "path": "x-pack/plugin/eql/qa/security/src/javaRestTest/java/org/elasticsearch/xpack/eql/AsyncEqlSecurityIT.java", "diffHunk": "@@ -89,8 +89,8 @@ private void testCase(String user, String other) throws Exception {\n         }\n         ResponseException exc = expectThrows(ResponseException.class,\n             () -> submitAsyncEqlSearch(\"index-\" + other, \"*\", TimeValue.timeValueSeconds(10), user));\n-        assertThat(exc.getResponse().getStatusLine().getStatusCode(), equalTo(403));\n-        assertThat(exc.getMessage(), containsString(\"unauthorized\"));\n+        assertThat(exc.getResponse().getStatusLine().getStatusCode(), equalTo(404));\n+        //assertThat(exc.getMessage(), containsString(\"unauthorized\"));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODg1NzI1Ng=="}, "originalCommit": {"oid": "2e4de89d048d36c7a4a709da80bdd8fcf056fb49"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODkzMTUwNQ==", "bodyText": "And previously we did not ignore them but because we couldn't get access to them to verify their existence we got the 403...Make sense.", "url": "https://github.com/elastic/elasticsearch/pull/63192#discussion_r498931505", "createdAt": "2020-10-02T16:40:54Z", "author": {"login": "costin"}, "path": "x-pack/plugin/eql/qa/security/src/javaRestTest/java/org/elasticsearch/xpack/eql/AsyncEqlSecurityIT.java", "diffHunk": "@@ -89,8 +89,8 @@ private void testCase(String user, String other) throws Exception {\n         }\n         ResponseException exc = expectThrows(ResponseException.class,\n             () -> submitAsyncEqlSearch(\"index-\" + other, \"*\", TimeValue.timeValueSeconds(10), user));\n-        assertThat(exc.getResponse().getStatusLine().getStatusCode(), equalTo(403));\n-        assertThat(exc.getMessage(), containsString(\"unauthorized\"));\n+        assertThat(exc.getResponse().getStatusLine().getStatusCode(), equalTo(404));\n+        //assertThat(exc.getMessage(), containsString(\"unauthorized\"));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODg1NzI1Ng=="}, "originalCommit": {"oid": "2e4de89d048d36c7a4a709da80bdd8fcf056fb49"}, "originalPosition": 7}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEyMzI1NzM0OnYy", "diffSide": "RIGHT", "path": "x-pack/plugin/eql/qa/rest/src/yamlRestTest/resources/rest-api-spec/test/eql/10_basic.yml", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMlQxNTozMDoxNlrOHbyFaQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMlQxNTozMDoxNlrOHbyFaQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODg5NDE4NQ==", "bodyText": "missing : at the end", "url": "https://github.com/elastic/elasticsearch/pull/63192#discussion_r498894185", "createdAt": "2020-10-02T15:30:16Z", "author": {"login": "imotov"}, "path": "x-pack/plugin/eql/qa/rest/src/yamlRestTest/resources/rest-api-spec/test/eql/10_basic.yml", "diffHunk": "@@ -83,6 +83,20 @@ setup:\n   - match: {hits.sequences.1.events.0._id: \"2\"}\n   - match: {hits.sequences.1.events.1._id: \"3\"}\n \n+---\n+\"Execute EQL sequence by default ignores unavailable indices\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2e4de89d048d36c7a4a709da80bdd8fcf056fb49"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEyMzgwNDgxOnYy", "diffSide": "RIGHT", "path": "client/rest-high-level/src/main/java/org/elasticsearch/client/eql/EqlSearchRequest.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMlQxODoyNzowOVrOHb3jNQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMlQxODoyNzowOVrOHb3jNQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODk4MzczMw==", "bodyText": "@astefan the change inside EQL high-level rest client.", "url": "https://github.com/elastic/elasticsearch/pull/63192#discussion_r498983733", "createdAt": "2020-10-02T18:27:09Z", "author": {"login": "costin"}, "path": "client/rest-high-level/src/main/java/org/elasticsearch/client/eql/EqlSearchRequest.java", "diffHunk": "@@ -34,7 +34,7 @@\n public class EqlSearchRequest implements Validatable, ToXContentObject {\n \n     private String[] indices;\n-    private IndicesOptions indicesOptions = IndicesOptions.fromOptions(false, false, true, false);\n+    private IndicesOptions indicesOptions = IndicesOptions.fromOptions(true, false, true, false);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2e4de89d048d36c7a4a709da80bdd8fcf056fb49"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEyMzgyMDY5OnYy", "diffSide": "RIGHT", "path": "x-pack/plugin/eql/qa/rest/src/yamlRestTest/resources/rest-api-spec/test/eql/10_basic.yml", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMlQxODozMjowN1rOHb3s-w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNVQwNjoxMjoxMVrOHcOtqg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODk4NjIzNQ==", "bodyText": "@matriv the integration test against non-existing indices", "url": "https://github.com/elastic/elasticsearch/pull/63192#discussion_r498986235", "createdAt": "2020-10-02T18:32:07Z", "author": {"login": "costin"}, "path": "x-pack/plugin/eql/qa/rest/src/yamlRestTest/resources/rest-api-spec/test/eql/10_basic.yml", "diffHunk": "@@ -83,6 +83,20 @@ setup:\n   - match: {hits.sequences.1.events.0._id: \"2\"}\n   - match: {hits.sequences.1.events.1._id: \"3\"}\n \n+---\n+\"Execute EQL sequence by default ignores unavailable indices\"\n+  - do:\n+      eql.search:\n+        index: eql_test,non_existing", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2e4de89d048d36c7a4a709da80bdd8fcf056fb49"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTM2MzI0Mg==", "bodyText": "I meant to query against only unavailable indices, just for completeness.", "url": "https://github.com/elastic/elasticsearch/pull/63192#discussion_r499363242", "createdAt": "2020-10-05T06:12:11Z", "author": {"login": "matriv"}, "path": "x-pack/plugin/eql/qa/rest/src/yamlRestTest/resources/rest-api-spec/test/eql/10_basic.yml", "diffHunk": "@@ -83,6 +83,20 @@ setup:\n   - match: {hits.sequences.1.events.0._id: \"2\"}\n   - match: {hits.sequences.1.events.1._id: \"3\"}\n \n+---\n+\"Execute EQL sequence by default ignores unavailable indices\"\n+  - do:\n+      eql.search:\n+        index: eql_test,non_existing", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODk4NjIzNQ=="}, "originalCommit": {"oid": "2e4de89d048d36c7a4a709da80bdd8fcf056fb49"}, "originalPosition": 8}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEyNjU2NjIzOnYy", "diffSide": "RIGHT", "path": "x-pack/plugin/eql/qa/security/src/javaRestTest/java/org/elasticsearch/xpack/eql/AsyncEqlSecurityIT.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNVQwNjoxMTowMVrOHcOsbA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNVQwNjoxMTowMVrOHcOsbA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTM2MjkyNA==", "bodyText": "Should we remove it then?", "url": "https://github.com/elastic/elasticsearch/pull/63192#discussion_r499362924", "createdAt": "2020-10-05T06:11:01Z", "author": {"login": "matriv"}, "path": "x-pack/plugin/eql/qa/security/src/javaRestTest/java/org/elasticsearch/xpack/eql/AsyncEqlSecurityIT.java", "diffHunk": "@@ -89,8 +89,8 @@ private void testCase(String user, String other) throws Exception {\n         }\n         ResponseException exc = expectThrows(ResponseException.class,\n             () -> submitAsyncEqlSearch(\"index-\" + other, \"*\", TimeValue.timeValueSeconds(10), user));\n-        assertThat(exc.getResponse().getStatusLine().getStatusCode(), equalTo(403));\n-        assertThat(exc.getMessage(), containsString(\"unauthorized\"));\n+        assertThat(exc.getResponse().getStatusLine().getStatusCode(), equalTo(404));\n+        //assertThat(exc.getMessage(), containsString(\"unauthorized\"));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3e843d6a16121b254a317f759c275b7c9a4e0e93"}, "originalPosition": 7}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3241, "cost": 1, "resetAt": "2021-11-12T13:16:51Z"}}}