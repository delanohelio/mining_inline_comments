{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk1ODM1NDQy", "number": 54460, "title": "NodeInfo response should use a collection rather than fields", "bodyText": "When the nodes info endpoint is pluggable, the NodeInfo objects will need to be able to hold more than just a known group of heterogeneous objects representing different kinds of information. To this end, this PR introduces a ReportingService.Info interface, which each of the component info objects now inherits. The NodeInfo class can then replace its individual fields with a collection of ReportingService.Info objects. For this collection, I've chosen a map keyed on object type, which gives us the ability to handle casting dynamically in the getInfo() method. I'm open to alternate approaches.\nI'm leaving the serialization of the NodeInfo object alone until I'm sure about how it should look in the long term. We don't want to get stuck supporting an intermediate serialization in future releases. (See #54305 for context.)\nRelates #52975", "createdAt": "2020-03-30T18:55:06Z", "url": "https://github.com/elastic/elasticsearch/pull/54460", "merged": true, "mergeCommit": {"oid": "633790fa99f30d8de02ab7d6af07dfb22332a8d8"}, "closed": true, "closedAt": "2020-04-13T19:48:18Z", "author": {"login": "williamrandolph"}, "timelineItems": {"totalCount": 16, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcQ8vNCAH2gAyMzk1ODM1NDQyOmRlMDBhYmNiYTFlYWNjMTIyN2FhNzQyZTZmN2ExNWNhZWYyYzkwZjQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcXQY_VgH2gAyMzk1ODM1NDQyOjVmOWE3NjdhYjIwZjI1ZTM4NDQxZGVmMTcxMmIyZjEzYmFiMzA1MzY=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "de00abcba1eacc1227aa742e6f7a15caef2c90f4", "author": {"user": {"login": "williamrandolph", "name": "William Brafford"}}, "url": "https://github.com/elastic/elasticsearch/commit/de00abcba1eacc1227aa742e6f7a15caef2c90f4", "committedDate": "2020-03-25T00:54:44Z", "message": "Use flexible structure for OsInfo in NodeInfo\n\nThis is a first cut at giving NodeInfo the ability to carry a flexible\nlist of heterogeneous info responses. The trick is to be able to\nserialize and deserialize an arbitrary list of blocks of information. It\nis convenient to be able to deserialize into usable Java objects so that\nwe can aggregate nodes stats for the cluster stats endpoint.\n\nIn order to provide a little bit of clarity about which objects can and\ncan't be used as info blocks, I've introduced a new interface called\n\"ReportingService.\""}}, {"__typename": "PullRequestCommit", "commit": {"oid": "10f6f9b119fad1816464a56bbc78eb457d97b75a", "author": {"user": {"login": "williamrandolph", "name": "William Brafford"}}, "url": "https://github.com/elastic/elasticsearch/commit/10f6f9b119fad1816464a56bbc78eb457d97b75a", "committedDate": "2020-03-26T13:11:24Z", "message": "Add other info blocks to service info map"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "928fd53846daa3ce899bb158b0993957b039cf35", "author": {"user": {"login": "williamrandolph", "name": "William Brafford"}}, "url": "https://github.com/elastic/elasticsearch/commit/928fd53846daa3ce899bb158b0993957b039cf35", "committedDate": "2020-03-26T13:11:45Z", "message": "Merge branch 'master' into nodes-info-response-transport-refactor"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "28c285d1470db4a52ee684e9cd0b360bd418e074", "author": {"user": {"login": "williamrandolph", "name": "William Brafford"}}, "url": "https://github.com/elastic/elasticsearch/commit/28c285d1470db4a52ee684e9cd0b360bd418e074", "committedDate": "2020-03-26T18:14:26Z", "message": "Use helper method to filter nulls"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "458e5eafa71a829f9bc477524ee63c30b8983fe1", "author": {"user": {"login": "williamrandolph", "name": "William Brafford"}}, "url": "https://github.com/elastic/elasticsearch/commit/458e5eafa71a829f9bc477524ee63c30b8983fe1", "committedDate": "2020-03-27T11:21:50Z", "message": "Remove unused imports"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5b9dc646c92322e44447dee4a7425ef162dd2df3", "author": {"user": {"login": "williamrandolph", "name": "William Brafford"}}, "url": "https://github.com/elastic/elasticsearch/commit/5b9dc646c92322e44447dee4a7425ef162dd2df3", "committedDate": "2020-03-27T11:22:25Z", "message": "Merge branch 'master' into nodes-info-response-transport-refactor"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ada09b335a18233f827cba7d021bf44c87079947", "author": {"user": {"login": "williamrandolph", "name": "William Brafford"}}, "url": "https://github.com/elastic/elasticsearch/commit/ada09b335a18233f827cba7d021bf44c87079947", "committedDate": "2020-03-27T19:44:58Z", "message": "Remove transport refactor and hardcoded getters\n\nI tried a different serialization for NodeInfo that would allow writing\nflexible, arbitrary lists of node info blocks, but it seems too early in\nthe process to commit to anything definite, so I've backed out the\nchange.\n\nI have removed the hard-coded getters (e.g., getOs()) in favor of a\nflexible method that can return heterogeneous kinds of info blocks\n(e.g., getInfo(OsInfo.class)). Taking a class as an argument removes the\nneed to cast in the client code."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "084d585a6579c2a631a61c063b45db8163604972", "author": {"user": {"login": "williamrandolph", "name": "William Brafford"}}, "url": "https://github.com/elastic/elasticsearch/commit/084d585a6579c2a631a61c063b45db8163604972", "committedDate": "2020-03-30T17:05:03Z", "message": "Merge branch 'master' into nodes-info-response-fields-to-collection"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a7be9a18d8d781b4a661a2a27ec1d0de92bbc027", "author": {"user": {"login": "williamrandolph", "name": "William Brafford"}}, "url": "https://github.com/elastic/elasticsearch/commit/a7be9a18d8d781b4a661a2a27ec1d0de92bbc027", "committedDate": "2020-03-30T17:48:52Z", "message": "ReportingService.Info should just be Writeable"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "32b0e59c3f8c81f100fa0a1fe5724e9692a130a8", "author": {"user": {"login": "williamrandolph", "name": "William Brafford"}}, "url": "https://github.com/elastic/elasticsearch/commit/32b0e59c3f8c81f100fa0a1fe5724e9692a130a8", "committedDate": "2020-03-30T19:07:59Z", "message": "Add a few unit tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "376d74c5fdd4798d7bc58a6947311a063a4aa1a1", "author": {"user": {"login": "williamrandolph", "name": "William Brafford"}}, "url": "https://github.com/elastic/elasticsearch/commit/376d74c5fdd4798d7bc58a6947311a063a4aa1a1", "committedDate": "2020-03-30T20:55:45Z", "message": "Adhere to testing conventions"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg0NjIzNjQ2", "url": "https://github.com/elastic/elasticsearch/pull/54460#pullrequestreview-384623646", "createdAt": "2020-03-31T11:02:26Z", "commit": {"oid": "376d74c5fdd4798d7bc58a6947311a063a4aa1a1"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMVQxMTowMjoyNlrOF-QZKw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMVQxMTowMjoyNlrOF-QZKw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDgyNDYxOQ==", "bodyText": "Maybename it maybeAddInfo(...)? I'm unsure if that's an improvement.", "url": "https://github.com/elastic/elasticsearch/pull/54460#discussion_r400824619", "createdAt": "2020-03-31T11:02:26Z", "author": {"login": "pugnascotia"}, "path": "server/src/main/java/org/elasticsearch/action/admin/cluster/node/info/NodeInfo.java", "diffHunk": "@@ -147,60 +129,22 @@ public Settings getSettings() {\n         return this.settings;\n     }\n \n-    /**\n-     * Operating System level information.\n-     */\n-    @Nullable\n-    public OsInfo getOs() {\n-        return this.os;\n-    }\n-\n-    /**\n-     * Process level information.\n-     */\n-    @Nullable\n-    public ProcessInfo getProcess() {\n-        return process;\n-    }\n-\n-    /**\n-     * JVM level information.\n-     */\n-    @Nullable\n-    public JvmInfo getJvm() {\n-        return jvm;\n-    }\n-\n-    @Nullable\n-    public ThreadPoolInfo getThreadPool() {\n-        return this.threadPool;\n-    }\n-\n-    @Nullable\n-    public TransportInfo getTransport() {\n-        return transport;\n-    }\n-\n-    @Nullable\n-    public HttpInfo getHttp() {\n-        return http;\n-    }\n-\n-    @Nullable\n-    public PluginsAndModules getPlugins() {\n-        return this.plugins;\n-    }\n-\n-    @Nullable\n-    public IngestInfo getIngest() {\n-        return ingest;\n+    // TODO: javadoc on the utility of a method that hides casting\n+    public <T extends ReportingService.Info> T getInfo(Class<T> clazz) {\n+        return clazz.cast(infoMap.get(clazz));\n     }\n \n     @Nullable\n     public ByteSizeValue getTotalIndexingBuffer() {\n         return totalIndexingBuffer;\n     }\n \n+    private void addInfoIfNonNull(Class<? extends ReportingService.Info> clazz, ReportingService.Info info) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "376d74c5fdd4798d7bc58a6947311a063a4aa1a1"}, "originalPosition": 153}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg0NjI0NzA5", "url": "https://github.com/elastic/elasticsearch/pull/54460#pullrequestreview-384624709", "createdAt": "2020-03-31T11:04:03Z", "commit": {"oid": "376d74c5fdd4798d7bc58a6947311a063a4aa1a1"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg4NzMyNDQy", "url": "https://github.com/elastic/elasticsearch/pull/54460#pullrequestreview-388732442", "createdAt": "2020-04-07T01:48:49Z", "commit": {"oid": "376d74c5fdd4798d7bc58a6947311a063a4aa1a1"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wN1QwMTo0ODo0OVrOGBwEuQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wN1QwMTo0ODo0OVrOGBwEuQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDQ4OTQwMQ==", "bodyText": "Can this java doc be added before committing?", "url": "https://github.com/elastic/elasticsearch/pull/54460#discussion_r404489401", "createdAt": "2020-04-07T01:48:49Z", "author": {"login": "rjernst"}, "path": "server/src/main/java/org/elasticsearch/action/admin/cluster/node/info/NodeInfo.java", "diffHunk": "@@ -147,60 +129,22 @@ public Settings getSettings() {\n         return this.settings;\n     }\n \n-    /**\n-     * Operating System level information.\n-     */\n-    @Nullable\n-    public OsInfo getOs() {\n-        return this.os;\n-    }\n-\n-    /**\n-     * Process level information.\n-     */\n-    @Nullable\n-    public ProcessInfo getProcess() {\n-        return process;\n-    }\n-\n-    /**\n-     * JVM level information.\n-     */\n-    @Nullable\n-    public JvmInfo getJvm() {\n-        return jvm;\n-    }\n-\n-    @Nullable\n-    public ThreadPoolInfo getThreadPool() {\n-        return this.threadPool;\n-    }\n-\n-    @Nullable\n-    public TransportInfo getTransport() {\n-        return transport;\n-    }\n-\n-    @Nullable\n-    public HttpInfo getHttp() {\n-        return http;\n-    }\n-\n-    @Nullable\n-    public PluginsAndModules getPlugins() {\n-        return this.plugins;\n-    }\n-\n-    @Nullable\n-    public IngestInfo getIngest() {\n-        return ingest;\n+    // TODO: javadoc on the utility of a method that hides casting", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "376d74c5fdd4798d7bc58a6947311a063a4aa1a1"}, "originalPosition": 143}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "65ec0f7f38841aa11ff87592dee035cee0540bfc", "author": {"user": {"login": "williamrandolph", "name": "William Brafford"}}, "url": "https://github.com/elastic/elasticsearch/commit/65ec0f7f38841aa11ff87592dee035cee0540bfc", "committedDate": "2020-04-13T14:57:39Z", "message": "Merge branch 'master' into nodes-info-response-fields-to-collection"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5f9a767ab20f25e38441def1712b2f13bab30536", "author": {"user": {"login": "williamrandolph", "name": "William Brafford"}}, "url": "https://github.com/elastic/elasticsearch/commit/5f9a767ab20f25e38441def1712b2f13bab30536", "committedDate": "2020-04-13T15:12:07Z", "message": "Add javadoc for heterogeneous typesafe access"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1356, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}