{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzczNDY2MjEy", "number": 52179, "title": "Fix delete enrich policy bug", "bodyText": "This PR relates to #51228.\nThe changes are:\n\nList all enrich index for the policy which will be deleted, and delete the concrete indices instead of a wildcard suffix.\nAdd action.destructive_requires_name cluster setting in TransportDeleteEnrichPolicyActionTests#testDeleteIsNotLocked method, ensure the test result is always correct whether the setting is set to true or not.", "createdAt": "2020-02-11T04:17:23Z", "url": "https://github.com/elastic/elasticsearch/pull/52179", "merged": true, "mergeCommit": {"oid": "a7ddbcf4aac6712369532a4e89a1968ee716f4c9"}, "closed": true, "closedAt": "2020-02-18T07:20:36Z", "author": {"login": "gaobinlong"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcDJkJcgH2gAyMzczNDY2MjEyOjM0YTY4Y2EwZWRlZWNhZjA3NWYzOTkxMTUwYWZhMjFhNGY4ZThjODY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcFM054gH2gAyMzczNDY2MjEyOjNhMDhhNzM3YzYwYWFlYTE0NDQ4NzBiNTBlMTMwYWI3YzYyNjQwOGU=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "34a68ca0edeecaf075f3991150afa21a4f8e8c86", "author": {"user": {"login": "gaobinlong", "name": "bellengao"}}, "url": "https://github.com/elastic/elasticsearch/commit/34a68ca0edeecaf075f3991150afa21a4f8e8c86", "committedDate": "2020-02-11T03:56:29Z", "message": "Fix bug for deleting enrich policy"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU5MDUzMTk5", "url": "https://github.com/elastic/elasticsearch/pull/52179#pullrequestreview-359053199", "createdAt": "2020-02-14T16:13:05Z", "commit": {"oid": "34a68ca0edeecaf075f3991150afa21a4f8e8c86"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xNFQxNjoxMzowNVrOFp74Dw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xNFQxNjoxMzowNVrOFp74Dw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTUxNjk0Mw==", "bodyText": "Maybe add a comment here why the delete enrich index api can't rely on just deleting all the enrich indices by a wildcard index expression?", "url": "https://github.com/elastic/elasticsearch/pull/52179#discussion_r379516943", "createdAt": "2020-02-14T16:13:05Z", "author": {"login": "martijnvg"}, "path": "x-pack/plugin/enrich/src/main/java/org/elasticsearch/xpack/enrich/action/TransportDeleteEnrichPolicyAction.java", "diffHunk": "@@ -128,7 +129,12 @@ protected void masterOperation(\n             return;\n         }\n \n-        deleteIndicesAndPolicy(request.getName(), ActionListener.wrap((response) -> {\n+        GetIndexRequest indices = new GetIndexRequest().indices(EnrichPolicy.getBaseName(request.getName()) + \"-*\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "34a68ca0edeecaf075f3991150afa21a4f8e8c86"}, "originalPosition": 13}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9c043f105af918aa38c05ccdf3da98037c3c8ed3", "author": {"user": {"login": "gaobinlong", "name": "bellengao"}}, "url": "https://github.com/elastic/elasticsearch/commit/9c043f105af918aa38c05ccdf3da98037c3c8ed3", "committedDate": "2020-02-16T07:34:31Z", "message": "add a comment for deleting enrich index"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "204a326da21a037191706cbf48e0fa76b4c3d639", "author": {"user": {"login": "gaobinlong", "name": "bellengao"}}, "url": "https://github.com/elastic/elasticsearch/commit/204a326da21a037191706cbf48e0fa76b4c3d639", "committedDate": "2020-02-16T07:35:18Z", "message": "Merge remote-tracking branch 'origin/master' into patch#51228"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ea45f4706ebfc7b6bab0962d577d3930282f4781", "author": {"user": {"login": "gaobinlong", "name": "bellengao"}}, "url": "https://github.com/elastic/elasticsearch/commit/ea45f4706ebfc7b6bab0962d577d3930282f4781", "committedDate": "2020-02-17T12:31:19Z", "message": "Merge remote-tracking branch 'origin/master' into patch#51228"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3a08a737c60aaea1444870b50e130ab7c626408e", "author": {"user": {"login": "gaobinlong", "name": "bellengao"}}, "url": "https://github.com/elastic/elasticsearch/commit/3a08a737c60aaea1444870b50e130ab7c626408e", "committedDate": "2020-02-17T12:52:21Z", "message": "format code"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2522, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}