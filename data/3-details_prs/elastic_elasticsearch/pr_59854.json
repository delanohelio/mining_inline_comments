{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDUzMzY5NDky", "number": 59854, "title": "Introduce reserved_ml_apm_user kibana privilege", "bodyText": "Adds a new Kibana \"reserved\" Kibana application privilege to the apm_user role, in order to grant access to a subset of ML functionality within Kibana.\nPreviously, the apm_user role was authorized to retrieve ML jobs by virtue of its privileges against the .ml-anomalies* set of indices. This access is no longer sufficient, now that the ML feature is taking advantage of the Kibana privilege model.\nIn order to maintain BWC for existing users of the apm_user role, it's necessary to create a reserved privilege which mimics the previous access that this role used to have. Eventually, the Kibana privilege model will be updated to support access to ML jobs in a more holistic manner, but that is a longer term initiative.\nCorresponding Kibana PR: elastic/kibana#72266", "createdAt": "2020-07-20T11:52:27Z", "url": "https://github.com/elastic/elasticsearch/pull/59854", "merged": true, "mergeCommit": {"oid": "fc94423c3fbcdf99fb774ccd517932225a074c71"}, "closed": true, "closedAt": "2020-07-22T14:13:20Z", "author": {"login": "legrego"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc2wQ9zAH2gAyNDUzMzY5NDkyOjU4Y2FjOWQ3ZGUyNGFlZDkwYzBiMTcxZTNjMTNkZmQxZDJlMzk5MmQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc3O_ywAFqTQ1MjkwMTE4MA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "58cac9d7de24aed90c0b171e3c13dfd1d2e3992d", "author": {"user": {"login": "legrego", "name": "Larry Gregory"}}, "url": "https://github.com/elastic/elasticsearch/commit/58cac9d7de24aed90c0b171e3c13dfd1d2e3992d", "committedDate": "2020-07-20T11:51:58Z", "message": "introduce reserved_ml_apm_user kibana privilege"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUxODgxMjE3", "url": "https://github.com/elastic/elasticsearch/pull/59854#pullrequestreview-451881217", "createdAt": "2020-07-20T19:05:43Z", "commit": {"oid": "58cac9d7de24aed90c0b171e3c13dfd1d2e3992d"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQxOTowNTo0M1rOG0be3Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQxOTowNTo0M1rOG0be3Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzYyOTQwNQ==", "bodyText": "Clarifying question since I'm not familiar with \"reserved\" privileges: I couldn't find reserved_ml_apm_user in elastic/kibana#72266 but I did find ml_apm_user. Is reserved_  an implied prefix somehow?", "url": "https://github.com/elastic/elasticsearch/pull/59854#discussion_r457629405", "createdAt": "2020-07-20T19:05:43Z", "author": {"login": "sqren"}, "path": "x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/security/authz/store/ReservedRolesStore.java", "diffHunk": "@@ -183,7 +183,10 @@\n                             .privileges(\"read\", \"view_index_metadata\").build(),\n                         RoleDescriptor.IndicesPrivileges.builder().indices(\"observability-annotations\")\n                             .privileges(\"read\", \"view_index_metadata\").build()\n-                    }, null, MetadataUtils.DEFAULT_RESERVED_METADATA))\n+                    }, new RoleDescriptor.ApplicationResourcePrivileges[] {\n+                            RoleDescriptor.ApplicationResourcePrivileges.builder()\n+                                .application(\"kibana-*\").resources(\"*\").privileges(\"reserved_ml_apm_user\").build()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "58cac9d7de24aed90c0b171e3c13dfd1d2e3992d"}, "originalPosition": 7}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUxODgxMzEz", "url": "https://github.com/elastic/elasticsearch/pull/59854#pullrequestreview-451881313", "createdAt": "2020-07-20T19:05:52Z", "commit": {"oid": "58cac9d7de24aed90c0b171e3c13dfd1d2e3992d"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUyOTAxMTgw", "url": "https://github.com/elastic/elasticsearch/pull/59854#pullrequestreview-452901180", "createdAt": "2020-07-21T23:40:16Z", "commit": {"oid": "58cac9d7de24aed90c0b171e3c13dfd1d2e3992d"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4244, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}