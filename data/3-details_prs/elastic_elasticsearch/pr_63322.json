{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDk4NTAwNTE5", "number": 63322, "title": "Add isFieldMapped method to QueryShardContext", "bodyText": "As part of #63239 we have moved some usages of QueryShardContext#getMapperService that were looking up a field type through the fieldType method, to use the existing QueryShardContext#fieldMapper. The latter though has additional handling for unmapped fields when the functionality is enabled, and may throw exception if the field is not mapped. This additional behaviour is not desirable and may cause issues in cases where the callers have their own specific handling for situations where the field is not mapped.\nTo address this we introduce an additional isFieldMapped method to QueryShardContext that allows to check if a field is mapped or not.\nrelates to #63239", "createdAt": "2020-10-06T12:26:59Z", "url": "https://github.com/elastic/elasticsearch/pull/63322", "merged": true, "mergeCommit": {"oid": "b21b79d4a533507b03a756aa79ccb7a4c4601f07"}, "closed": true, "closedAt": "2020-10-07T08:09:00Z", "author": {"login": "javanna"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdP3gM3gH2gAyNDk4NTAwNTE5OjczNGQ3ZjNjMjk4NDE0YTYzZThmZjY3NjNlMTU3ZjM5NjZlM2MzNGE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdP6WTKgFqTUwMzEwODg5OQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "734d7f3c298414a63e8ff6763e157f3966e3c34a", "author": {"user": {"login": "javanna", "name": "Luca Cavanna"}}, "url": "https://github.com/elastic/elasticsearch/commit/734d7f3c298414a63e8ff6763e157f3966e3c34a", "committedDate": "2020-10-06T12:26:03Z", "message": "Add fieldType method to QueryShardContext\n\nAs part of #63239 we have moved some usages of `QueryShardContext#getMapperService` that were looking up a field type through the `fieldType` method, to use the existing `QueryShardContext#fieldMapper`. The latter though has additional handling for unmapped fields when the functionality is enabled, and may throw exception if the field is not mapped. This additional behaviour is not desirable and may cause issues in cases where the callers have their own specific handling for situations where the field is not mapped.\n\nTo address this we introduce an additional fieldType method to `QueryShardContext` that allows to simply look up a field type given its name.\n\nrelates to #63239"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "eca9b268c77c5a40bf2355394cf8242d8a576944", "author": {"user": {"login": "javanna", "name": "Luca Cavanna"}}, "url": "https://github.com/elastic/elasticsearch/commit/eca9b268c77c5a40bf2355394cf8242d8a576944", "committedDate": "2020-10-06T12:33:55Z", "message": "javadocs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "09f5062d335de52cdfdbfe9d04aab6150ebd2f60", "author": {"user": {"login": "javanna", "name": "Luca Cavanna"}}, "url": "https://github.com/elastic/elasticsearch/commit/09f5062d335de52cdfdbfe9d04aab6150ebd2f60", "committedDate": "2020-10-06T12:35:04Z", "message": "leftover"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAyODg5ODA2", "url": "https://github.com/elastic/elasticsearch/pull/63322#pullrequestreview-502889806", "createdAt": "2020-10-06T12:34:13Z", "commit": {"oid": "734d7f3c298414a63e8ff6763e157f3966e3c34a"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNlQxMjozNDoxM1rOHdEHlg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNlQxMjozNTo1MVrOHdELyg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDIzODIzMA==", "bodyText": "Can we put some javadocs on here, specifically around the fact that it may return null?", "url": "https://github.com/elastic/elasticsearch/pull/63322#discussion_r500238230", "createdAt": "2020-10-06T12:34:13Z", "author": {"login": "romseygeek"}, "path": "server/src/main/java/org/elasticsearch/index/query/QueryShardContext.java", "diffHunk": "@@ -231,6 +231,10 @@ public MappedFieldType fieldMapper(String name) {\n         return failIfFieldMappingNotFound(name, mapperService.fieldType(name));\n     }\n \n+    public MappedFieldType fieldType(String name) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "734d7f3c298414a63e8ff6763e157f3966e3c34a"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDIzOTMwNg==", "bodyText": "Too fast! Can you add a note about null?", "url": "https://github.com/elastic/elasticsearch/pull/63322#discussion_r500239306", "createdAt": "2020-10-06T12:35:51Z", "author": {"login": "romseygeek"}, "path": "server/src/main/java/org/elasticsearch/index/query/QueryShardContext.java", "diffHunk": "@@ -231,6 +231,10 @@ public MappedFieldType fieldMapper(String name) {\n         return failIfFieldMappingNotFound(name, mapperService.fieldType(name));\n     }\n \n+    public MappedFieldType fieldType(String name) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDIzODIzMA=="}, "originalCommit": {"oid": "734d7f3c298414a63e8ff6763e157f3966e3c34a"}, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "957fa8b62969a96496c5c2ce16a784fceab9bcab", "author": {"user": {"login": "javanna", "name": "Luca Cavanna"}}, "url": "https://github.com/elastic/elasticsearch/commit/957fa8b62969a96496c5c2ce16a784fceab9bcab", "committedDate": "2020-10-06T12:47:44Z", "message": "javadocs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d99e2cbcbc114bfae56774ad90beafeff21df8f8", "author": {"user": {"login": "javanna", "name": "Luca Cavanna"}}, "url": "https://github.com/elastic/elasticsearch/commit/d99e2cbcbc114bfae56774ad90beafeff21df8f8", "committedDate": "2020-10-06T12:50:20Z", "message": "javadocs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "049c0222493ee8c755827199ba0e89c18099efc2", "author": {"user": {"login": "javanna", "name": "Luca Cavanna"}}, "url": "https://github.com/elastic/elasticsearch/commit/049c0222493ee8c755827199ba0e89c18099efc2", "committedDate": "2020-10-06T13:48:46Z", "message": "replace fieldType with isMappedField"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAyOTg1NDI1", "url": "https://github.com/elastic/elasticsearch/pull/63322#pullrequestreview-502985425", "createdAt": "2020-10-06T13:51:14Z", "commit": {"oid": "049c0222493ee8c755827199ba0e89c18099efc2"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNlQxMzo1MToxNFrOHdHstw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNlQxMzo1MToxNFrOHdHstw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDI5Njg4Nw==", "bodyText": "I moved this logic to the caller, it is now part of the lookup function that is provided.", "url": "https://github.com/elastic/elasticsearch/pull/63322#discussion_r500296887", "createdAt": "2020-10-06T13:51:14Z", "author": {"login": "javanna"}, "path": "server/src/main/java/org/elasticsearch/index/fieldvisitor/FieldsVisitor.java", "diffHunk": "@@ -90,10 +90,6 @@ public Status needsField(FieldInfo fieldInfo) {\n     public final void postProcess(Function<String, MappedFieldType> fieldTypeLookup) {\n         for (Map.Entry<String, List<Object>> entry : fields().entrySet()) {\n             MappedFieldType fieldType = fieldTypeLookup.apply(entry.getKey());\n-            if (fieldType == null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "049c0222493ee8c755827199ba0e89c18099efc2"}, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "92a8c731607ae49f945dc4f6993a90f6c4402cbd", "author": {"user": {"login": "javanna", "name": "Luca Cavanna"}}, "url": "https://github.com/elastic/elasticsearch/commit/92a8c731607ae49f945dc4f6993a90f6c4402cbd", "committedDate": "2020-10-06T15:02:22Z", "message": "true != false"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAzMTA4ODk5", "url": "https://github.com/elastic/elasticsearch/pull/63322#pullrequestreview-503108899", "createdAt": "2020-10-06T15:44:57Z", "commit": {"oid": "92a8c731607ae49f945dc4f6993a90f6c4402cbd"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4316, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}