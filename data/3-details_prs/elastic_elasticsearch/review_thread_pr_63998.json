{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTA3NTA1NjUy", "number": 63998, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMVQxMjo0OTo1OFrOEwOwRA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMVQxMjo0OTo1OFrOEwOwRA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE5MDA4ODM2OnYy", "diffSide": "RIGHT", "path": "server/src/main/java/org/elasticsearch/index/query/QueryShardContext.java", "isResolved": false, "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMVQxMjo0OTo1OFrOHlqIng==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMlQwODowNjozMVrOHmVhlg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTI0OTY5NA==", "bodyText": "This is only used for the RandomScoreFunctionBuilder, correct?  Do we need to add it, or can we just remove that 'no mappings' special case?", "url": "https://github.com/elastic/elasticsearch/pull/63998#discussion_r509249694", "createdAt": "2020-10-21T12:49:58Z", "author": {"login": "romseygeek"}, "path": "server/src/main/java/org/elasticsearch/index/query/QueryShardContext.java", "diffHunk": "@@ -216,6 +221,23 @@ public void addNamedQuery(String name, Query query) {\n         return Map.copyOf(namedQueries);\n     }\n \n+    public ParsedDocument parseDocument(SourceToParse source) throws MapperParsingException {\n+        return mapperService.documentMapper() == null ? null : mapperService.documentMapper().parse(source);\n+    }\n+\n+    public FieldNameAnalyzer getFieldNameIndexAnalyzer() {\n+        DocumentMapper documentMapper = mapperService.documentMapper();\n+        return documentMapper == null ? null : documentMapper.mappers().indexAnalyzer();\n+    }\n+\n+    public boolean hasNested() {\n+        return mapperService.hasNested();\n+    }\n+\n+    public boolean hasMappings() {\n+        return mapperService.documentMapper() != null;\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7cf860ccc64fa7f6ede7a31613b8f2fce9562ec5"}, "originalPosition": 40}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTI1MTkzOA==", "bodyText": "yes that is surprisingly the only usage. but I don't feel comfortable removing that no mappings special case. I think it's legit, although annoying to support, and we test it.", "url": "https://github.com/elastic/elasticsearch/pull/63998#discussion_r509251938", "createdAt": "2020-10-21T12:53:17Z", "author": {"login": "javanna"}, "path": "server/src/main/java/org/elasticsearch/index/query/QueryShardContext.java", "diffHunk": "@@ -216,6 +221,23 @@ public void addNamedQuery(String name, Query query) {\n         return Map.copyOf(namedQueries);\n     }\n \n+    public ParsedDocument parseDocument(SourceToParse source) throws MapperParsingException {\n+        return mapperService.documentMapper() == null ? null : mapperService.documentMapper().parse(source);\n+    }\n+\n+    public FieldNameAnalyzer getFieldNameIndexAnalyzer() {\n+        DocumentMapper documentMapper = mapperService.documentMapper();\n+        return documentMapper == null ? null : documentMapper.mappers().indexAnalyzer();\n+    }\n+\n+    public boolean hasNested() {\n+        return mapperService.hasNested();\n+    }\n+\n+    public boolean hasMappings() {\n+        return mapperService.documentMapper() != null;\n+    }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTI0OTY5NA=="}, "originalCommit": {"oid": "7cf860ccc64fa7f6ede7a31613b8f2fce9562ec5"}, "originalPosition": 40}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTY0MTExNg==", "bodyText": "@romseygeek are you ok with this or maybe do you have other ideas?", "url": "https://github.com/elastic/elasticsearch/pull/63998#discussion_r509641116", "createdAt": "2020-10-21T20:05:34Z", "author": {"login": "javanna"}, "path": "server/src/main/java/org/elasticsearch/index/query/QueryShardContext.java", "diffHunk": "@@ -216,6 +221,23 @@ public void addNamedQuery(String name, Query query) {\n         return Map.copyOf(namedQueries);\n     }\n \n+    public ParsedDocument parseDocument(SourceToParse source) throws MapperParsingException {\n+        return mapperService.documentMapper() == null ? null : mapperService.documentMapper().parse(source);\n+    }\n+\n+    public FieldNameAnalyzer getFieldNameIndexAnalyzer() {\n+        DocumentMapper documentMapper = mapperService.documentMapper();\n+        return documentMapper == null ? null : documentMapper.mappers().indexAnalyzer();\n+    }\n+\n+    public boolean hasNested() {\n+        return mapperService.hasNested();\n+    }\n+\n+    public boolean hasMappings() {\n+        return mapperService.documentMapper() != null;\n+    }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTI0OTY5NA=="}, "originalCommit": {"oid": "7cf860ccc64fa7f6ede7a31613b8f2fce9562ec5"}, "originalPosition": 40}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTk1MDk3NA==", "bodyText": "Let's leave it in for now, if we decide to go with a no-op mapper by default in MapperService we can remove it then.", "url": "https://github.com/elastic/elasticsearch/pull/63998#discussion_r509950974", "createdAt": "2020-10-22T07:50:48Z", "author": {"login": "romseygeek"}, "path": "server/src/main/java/org/elasticsearch/index/query/QueryShardContext.java", "diffHunk": "@@ -216,6 +221,23 @@ public void addNamedQuery(String name, Query query) {\n         return Map.copyOf(namedQueries);\n     }\n \n+    public ParsedDocument parseDocument(SourceToParse source) throws MapperParsingException {\n+        return mapperService.documentMapper() == null ? null : mapperService.documentMapper().parse(source);\n+    }\n+\n+    public FieldNameAnalyzer getFieldNameIndexAnalyzer() {\n+        DocumentMapper documentMapper = mapperService.documentMapper();\n+        return documentMapper == null ? null : documentMapper.mappers().indexAnalyzer();\n+    }\n+\n+    public boolean hasNested() {\n+        return mapperService.hasNested();\n+    }\n+\n+    public boolean hasMappings() {\n+        return mapperService.documentMapper() != null;\n+    }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTI0OTY5NA=="}, "originalCommit": {"oid": "7cf860ccc64fa7f6ede7a31613b8f2fce9562ec5"}, "originalPosition": 40}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTk2MDU5OA==", "bodyText": "true, I will try that idea very soon.", "url": "https://github.com/elastic/elasticsearch/pull/63998#discussion_r509960598", "createdAt": "2020-10-22T08:06:31Z", "author": {"login": "javanna"}, "path": "server/src/main/java/org/elasticsearch/index/query/QueryShardContext.java", "diffHunk": "@@ -216,6 +221,23 @@ public void addNamedQuery(String name, Query query) {\n         return Map.copyOf(namedQueries);\n     }\n \n+    public ParsedDocument parseDocument(SourceToParse source) throws MapperParsingException {\n+        return mapperService.documentMapper() == null ? null : mapperService.documentMapper().parse(source);\n+    }\n+\n+    public FieldNameAnalyzer getFieldNameIndexAnalyzer() {\n+        DocumentMapper documentMapper = mapperService.documentMapper();\n+        return documentMapper == null ? null : documentMapper.mappers().indexAnalyzer();\n+    }\n+\n+    public boolean hasNested() {\n+        return mapperService.hasNested();\n+    }\n+\n+    public boolean hasMappings() {\n+        return mapperService.documentMapper() != null;\n+    }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTI0OTY5NA=="}, "originalCommit": {"oid": "7cf860ccc64fa7f6ede7a31613b8f2fce9562ec5"}, "originalPosition": 40}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4241, "cost": 1, "resetAt": "2021-11-12T19:05:54Z"}}}