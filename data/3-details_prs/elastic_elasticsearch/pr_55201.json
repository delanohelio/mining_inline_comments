{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDAzNTY0OTUw", "number": 55201, "title": "Treat IdP roles as a SortedSet", "bodyText": "The Saml SP document stored the role mapping in a Set, but this made\nthe order in XContent inconsistent. This switched it to use a TreeSet.\nResolves: #54733", "createdAt": "2020-04-15T06:21:36Z", "url": "https://github.com/elastic/elasticsearch/pull/55201", "merged": true, "mergeCommit": {"oid": "5920d1bf05d5f42936f0afb39e4df1271ea4787c"}, "closed": true, "closedAt": "2020-04-16T05:25:52Z", "author": {"login": "tvernum"}, "timelineItems": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcXw8BygH2gAyNDAzNTY0OTUwOmU4Yzc4M2ZmYzM1NmQ2ZDdhYjAzMGIwMzU5NGFjY2ZhNDRjZDg4MGY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcXzbIaAFqTM5MzQ5OTIzNQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "e8c783ffc356d6d7ab030b03594accfa44cd880f", "author": {"user": {"login": "tvernum", "name": "Tim Vernum"}}, "url": "https://github.com/elastic/elasticsearch/commit/e8c783ffc356d6d7ab030b03594accfa44cd880f", "committedDate": "2020-04-15T05:07:21Z", "message": "Treat roles as a SortedSet\n\nThe Saml SP document stored the role mapping in a Set, but this made\nthe order in XContent inconsistent. This switched it to use a TreeSet.\n\nResolves: #54733"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkzNDk5MjM1", "url": "https://github.com/elastic/elasticsearch/pull/55201#pullrequestreview-393499235", "createdAt": "2020-04-15T06:53:26Z", "commit": {"oid": "e8c783ffc356d6d7ab030b03594accfa44cd880f"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQwNjo1MzoyNlrOGFsGUA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQwNzoxODoxMFrOGFszJg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODYxODU3Ng==", "bodyText": "I don't see how we would get a null String in the Collection here but I assume that the NPE we would throw is fine and we don;t want to guard this with requireNonNull or similar ?", "url": "https://github.com/elastic/elasticsearch/pull/55201#discussion_r408618576", "createdAt": "2020-04-15T06:53:26Z", "author": {"login": "jkakavas"}, "path": "x-pack/plugin/identity-provider/src/main/java/org/elasticsearch/xpack/idp/saml/sp/SamlServiceProviderDocument.java", "diffHunk": "@@ -52,14 +54,15 @@\n \n     public static class Privileges {\n         public String resource;\n-        public Set<String> rolePatterns = Set.of();\n+        // we use a sorted set so that the order is consistent in XContent APIs\n+        public SortedSet<String> rolePatterns = new TreeSet<>();\n \n         public void setResource(String resource) {\n             this.resource = resource;\n         }\n \n         public void setRolePatterns(Collection<String> rolePatterns) {\n-            this.rolePatterns = Set.copyOf(rolePatterns);\n+            this.rolePatterns = new TreeSet<>(rolePatterns);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e8c783ffc356d6d7ab030b03594accfa44cd880f"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODYzMDA1NA==", "bodyText": "We don't need this to be sorted/consistent for any other reason that testing the XContent to/from right?  We use it in https://github.com/elastic/elasticsearch/blob/7.7/x-pack/plugin/identity-provider/src/main/java/org/elasticsearch/xpack/idp/saml/sp/SamlServiceProviderFactory.java#L67 so we shouldn't care about performance that much since we cache the built service provider. Just thinking out loud here", "url": "https://github.com/elastic/elasticsearch/pull/55201#discussion_r408630054", "createdAt": "2020-04-15T07:18:10Z", "author": {"login": "jkakavas"}, "path": "x-pack/plugin/identity-provider/src/main/java/org/elasticsearch/xpack/idp/saml/sp/SamlServiceProviderDocument.java", "diffHunk": "@@ -52,14 +54,15 @@\n \n     public static class Privileges {\n         public String resource;\n-        public Set<String> rolePatterns = Set.of();\n+        // we use a sorted set so that the order is consistent in XContent APIs\n+        public SortedSet<String> rolePatterns = new TreeSet<>();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e8c783ffc356d6d7ab030b03594accfa44cd880f"}, "originalPosition": 15}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3348, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}