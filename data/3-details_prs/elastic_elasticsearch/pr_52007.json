{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzcyMDA5MDUw", "number": 52007, "title": "Make sorting by an agg results a real abstraction", "bodyText": "This removes a bunch of instanceofs in favor of two new methods on\nInernalAggregation. The default implementations of these methods just\nthrow exceptions explaining that you can't sort on this aggregation.\nThey are overridden by all of the classes that used to have instanceof\nchecks against them.\nI doubt this is really any faster in practice. The real benefit here is\nthat it is a little more obvious that you can sort by the results of\nan aggregation and it should be much more obvious where to look at\nhow aggregations sort themselves.\nThere are still a bunch more instanceofs in left in AggregationPath\nbut those will wait for a followup change.", "createdAt": "2020-02-06T16:59:51Z", "url": "https://github.com/elastic/elasticsearch/pull/52007", "merged": true, "mergeCommit": {"oid": "1390c9909e7aa5b382bb013646deabdd59a0d756"}, "closed": true, "closedAt": "2020-02-11T15:09:54Z", "author": {"login": "nik9000"}, "timelineItems": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcBtoTCgH2gAyMzcyMDA5MDUwOmM0YjRkZDhmMTU2Y2M0MzBmNTZhOTg3ZDIzM2IyNTlmOGEyOTQ3Yzk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcCF9ztAFqTM1NTQzODg5Nw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "c4b4dd8f156cc430f56a987d233b259f8a2947c9", "author": {"user": {"login": "nik9000", "name": "Nik Everett"}}, "url": "https://github.com/elastic/elasticsearch/commit/c4b4dd8f156cc430f56a987d233b259f8a2947c9", "committedDate": "2020-02-06T16:49:45Z", "message": "Make sorting by an agg results a real abstraction\n\nThis removes a bunch of `instanceof`s in favor of two new methods on\n`InernalAggregation`. The default implementations of these methods just\nthrow exceptions explaining that you can't sort on this aggregation.\nThey are overridden by all of the classes that used to have `instanceof`\nchecks against them.\n\nI doubt this is really any faster in practice. The real benefit here is\nthat it is a little more obvious *that* you can sort by the results of\nan aggregation and it should be *much* more obvious where to look at\n*how* aggregations sort themselves.\n\nThere are still a bunch more `instanceof`s in left in `AggregationPath`\nbut those will wait for a followup change."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU0NjE3Njg0", "url": "https://github.com/elastic/elasticsearch/pull/52007#pullrequestreview-354617684", "createdAt": "2020-02-06T17:02:04Z", "commit": {"oid": "c4b4dd8f156cc430f56a987d233b259f8a2947c9"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNlQxNzowMjowNVrOFmi57A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNlQxNzowMjowNVrOFmi57A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTk2MjA5Mg==", "bodyText": "This feels a little sneaky, but nowhere near as sneaky as the old instanceofs. And this stuff seems to only be used internally so I think we're safe here.", "url": "https://github.com/elastic/elasticsearch/pull/52007#discussion_r375962092", "createdAt": "2020-02-06T17:02:05Z", "author": {"login": "nik9000"}, "path": "server/src/main/java/org/elasticsearch/search/aggregations/InternalOrder.java", "diffHunk": "@@ -153,8 +153,8 @@ public AggregationPath path() {\n \n             @Override\n             public int compare(Bucket b1, Bucket b2) {\n-                double v1 = path.resolveValue(b1);\n-                double v2 = path.resolveValue(b2);\n+                double v1 = path.resolveValue(((InternalAggregations) b1.getAggregations()));\n+                double v2 = path.resolveValue(((InternalAggregations) b2.getAggregations()));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c4b4dd8f156cc430f56a987d233b259f8a2947c9"}, "originalPosition": 7}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU1NDM4ODk3", "url": "https://github.com/elastic/elasticsearch/pull/52007#pullrequestreview-355438897", "createdAt": "2020-02-07T21:10:58Z", "commit": {"oid": "c4b4dd8f156cc430f56a987d233b259f8a2947c9"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2888, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}