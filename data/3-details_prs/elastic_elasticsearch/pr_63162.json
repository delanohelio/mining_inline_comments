{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDk2NzY5NTUz", "number": 63162, "title": "Some template alias settings are not persisted on PUT template ", "bodyText": "Templates that use aliases do not persist all of the alias options. The fix is to copy over those settings to the alias metadata\nThe bug is easy to recreate\nPUT _template/with_alias\n{\n  \"index_patterns\": [\n    \"my-prefix-*\"\n  ],\n  \"mappings\": {\n    \"properties\": {\n      \"timestamp\": {\n        \"type\": \"date\"\n      }\n    }\n  },\n  \"aliases\": {\n    \"my-read\": {\n      \"is_hidden\" : true\n    }\n  }\n}\n\nThen when the template is read back the is_hidden field has mysteriously disappeared.\nGET _template/with_alias\n\n\n\n{\n  \"with_alias\" : {\n    \"order\" : 0,\n    \"index_patterns\" : [\n      \"my-prefix-*\"\n    ],\n    \"settings\" : { },\n    \"mappings\" : {\n      \"properties\" : {\n        \"timestamp\" : {\n          \"type\" : \"date\"\n        }\n      }\n    },\n    \"aliases\" : {\n      \"my-read\" : { }.  <-- somethings changed here\n    }\n  }\n}", "createdAt": "2020-10-02T08:41:43Z", "url": "https://github.com/elastic/elasticsearch/pull/63162", "merged": true, "mergeCommit": {"oid": "d5f60b502f745b4f499afd15316880dbdcc4b13e"}, "closed": true, "closedAt": "2020-10-13T07:33:49Z", "author": {"login": "davidkyle"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdOmVPVABqjM4MzQwNzU0MDE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdR6PvVAFqTUwNjkwNjQ1OA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3207114972a15e832c2938e06ff78afa88c37e9f", "author": {"user": {"login": "davidkyle", "name": "David Kyle"}}, "url": "https://github.com/elastic/elasticsearch/commit/3207114972a15e832c2938e06ff78afa88c37e9f", "committedDate": "2020-10-02T08:24:30Z", "message": "Copy all the template alias settings"}, "afterCommit": {"oid": "e07ebac0ee11d6c2f24f6b44186a4f98a4572e46", "author": {"user": {"login": "davidkyle", "name": "David Kyle"}}, "url": "https://github.com/elastic/elasticsearch/commit/e07ebac0ee11d6c2f24f6b44186a4f98a4572e46", "committedDate": "2020-10-02T13:50:45Z", "message": "Copy all the template alias settings"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA0MDU4NTM1", "url": "https://github.com/elastic/elasticsearch/pull/63162#pullrequestreview-504058535", "createdAt": "2020-10-07T16:25:54Z", "commit": {"oid": "e07ebac0ee11d6c2f24f6b44186a4f98a4572e46"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wN1QxNjoyNTo1NFrOHd7mwA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wN1QxNjoyNTo1NFrOHd7mwA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTE0NzMyOA==", "bodyText": "I actually don't think we should persist this one. Putting a template in place with is_write_index: true will be confusing because only a single index can be marked as the write index. I think we should instead throw an exception if alias.writeIndex() is set to true here (fail early rather than fail late)", "url": "https://github.com/elastic/elasticsearch/pull/63162#discussion_r501147328", "createdAt": "2020-10-07T16:25:54Z", "author": {"login": "dakrone"}, "path": "server/src/main/java/org/elasticsearch/cluster/metadata/MetadataIndexTemplateService.java", "diffHunk": "@@ -823,8 +823,13 @@ static ClusterState innerPutTemplate(final ClusterState currentState, PutRequest\n         }\n \n         for (Alias alias : request.aliases) {\n-            AliasMetadata aliasMetadata = AliasMetadata.builder(alias.name()).filter(alias.filter())\n-                .indexRouting(alias.indexRouting()).searchRouting(alias.searchRouting()).build();\n+            AliasMetadata aliasMetadata = AliasMetadata.builder(alias.name())\n+                .filter(alias.filter())\n+                .indexRouting(alias.indexRouting())\n+                .searchRouting(alias.searchRouting())\n+                .writeIndex(alias.writeIndex())", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e07ebac0ee11d6c2f24f6b44186a4f98a4572e46"}, "originalPosition": 10}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ab4b119747b0534d294360b8ae50d2b9f58aefd5", "author": {"user": {"login": "davidkyle", "name": "David Kyle"}}, "url": "https://github.com/elastic/elasticsearch/commit/ab4b119747b0534d294360b8ae50d2b9f58aefd5", "committedDate": "2020-10-08T12:00:29Z", "message": "Copy all the template alias settings"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f215de9e18a9ba8e14e42dc2662e4afe81929f9e", "author": {"user": {"login": "davidkyle", "name": "David Kyle"}}, "url": "https://github.com/elastic/elasticsearch/commit/f215de9e18a9ba8e14e42dc2662e4afe81929f9e", "committedDate": "2020-10-08T12:00:29Z", "message": "Validate template alias cannot have write alias"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4d3002c70db8de2aefa5c2e2ee514e5f52506bdf", "author": {"user": {"login": "davidkyle", "name": "David Kyle"}}, "url": "https://github.com/elastic/elasticsearch/commit/4d3002c70db8de2aefa5c2e2ee514e5f52506bdf", "committedDate": "2020-10-08T11:20:51Z", "message": "Validate template alias cannot have write alias"}, "afterCommit": {"oid": "f215de9e18a9ba8e14e42dc2662e4afe81929f9e", "author": {"user": {"login": "davidkyle", "name": "David Kyle"}}, "url": "https://github.com/elastic/elasticsearch/commit/f215de9e18a9ba8e14e42dc2662e4afe81929f9e", "committedDate": "2020-10-08T12:00:29Z", "message": "Validate template alias cannot have write alias"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d9eefa0ffb1d602fd9633154a742e7d4469535fe", "author": {"user": {"login": "davidkyle", "name": "David Kyle"}}, "url": "https://github.com/elastic/elasticsearch/commit/d9eefa0ffb1d602fd9633154a742e7d4469535fe", "committedDate": "2020-10-12T08:13:51Z", "message": "Revert \"Validate template alias cannot have write alias\"\n\nThis reverts commit f215de9e18a9ba8e14e42dc2662e4afe81929f9e."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA2OTA2NDU4", "url": "https://github.com/elastic/elasticsearch/pull/63162#pullrequestreview-506906458", "createdAt": "2020-10-12T20:45:38Z", "commit": {"oid": "d9eefa0ffb1d602fd9633154a742e7d4469535fe"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4466, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}