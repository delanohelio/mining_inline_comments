{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDAyMTYzMzc0", "number": 55094, "title": "SQL: introduce a query builder for the Rest tests", "bodyText": "The new BaseRestSqlTestCase.RequestObjectBuilder class is a helper class\nto build REST request objects for the tests. Consequently, \"manual\" string\nconcatenation to form JSON is done away with.\nThe class mimics SqlQueryRequestBuilder API.\nThe PR also extracts the attribute names used in SQL's JSON\nrequest/replies as Protocol static final strings and updates the classes\nthat make use of the hard-coded strings to use these references.", "createdAt": "2020-04-11T09:12:13Z", "url": "https://github.com/elastic/elasticsearch/pull/55094", "merged": true, "mergeCommit": {"oid": "c8363f04c029542c233a758e9286d33c51d9c0c4"}, "closed": true, "closedAt": "2020-05-04T19:05:34Z", "author": {"login": "bpintea"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcWNU77gH2gAyNDAyMTYzMzc0Ojg5ODE0ZTI5NDgxNThmOGY4NjNhZGVmOGY1NzlhNTRiMzQ3NWEyOWQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABceCaJngFqTQwNTE2ODA2Mw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "89814e2948158f8f863adef8f579a54b3475a29d", "author": {"user": {"login": "bpintea", "name": "Bogdan Pintea"}}, "url": "https://github.com/elastic/elasticsearch/commit/89814e2948158f8f863adef8f579a54b3475a29d", "committedDate": "2020-04-10T09:04:03Z", "message": "Introduce a query builder for the rest tests\n\nThe new BaseRestSqlTestCase.RequestObjectBuilder class is a helper class\nto build REST request objects for the tests. Consequently, \"manual\" string\nconcatenation to form JSON is done away with.\n\nThe class mimics SqlQueryRequestBuilder API."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ef2f13ffa6d254c852d0ccbdd648413324582338", "author": {"user": {"login": "bpintea", "name": "Bogdan Pintea"}}, "url": "https://github.com/elastic/elasticsearch/commit/ef2f13ffa6d254c852d0ccbdd648413324582338", "committedDate": "2020-04-11T08:21:04Z", "message": "Further extension for RequestObjectBuilder usage\n\nReplace more \"manual\" JSON building with RequestObjectBuilder calls."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "52668f7289d6ca2fc55276481f51bde1449e10fc", "author": {"user": {"login": "bpintea", "name": "Bogdan Pintea"}}, "url": "https://github.com/elastic/elasticsearch/commit/52668f7289d6ca2fc55276481f51bde1449e10fc", "committedDate": "2020-04-11T09:05:57Z", "message": "Extract SQL req/repl JSON obj attribute names\n\nThis commit extracts the attribute names used in SQL's JSON\nrequest/replies as Protocol static final strings and updates the classes\nthat make use of the hard-coded strings to use these references."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cbd409a815c89a2737b7be615c42768792dbde80", "author": {"user": {"login": "bpintea", "name": "Bogdan Pintea"}}, "url": "https://github.com/elastic/elasticsearch/commit/cbd409a815c89a2737b7be615c42768792dbde80", "committedDate": "2020-05-04T10:46:45Z", "message": "Merge remote-tracking branch 'upstream/master' into enh/query_builder_rest_test"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA0OTIyMjA2", "url": "https://github.com/elastic/elasticsearch/pull/55094#pullrequestreview-404922206", "createdAt": "2020-05-04T12:00:58Z", "commit": {"oid": "cbd409a815c89a2737b7be615c42768792dbde80"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNFQxMjowMDo1OVrOGP9Nug==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNFQxMjowMDo1OVrOGP9Nug==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTM4NDc2Mg==", "bodyText": "I would add a method that accepts Mode directly so callers don't have to keep calling mode(someMode.toString())", "url": "https://github.com/elastic/elasticsearch/pull/55094#discussion_r419384762", "createdAt": "2020-05-04T12:00:59Z", "author": {"login": "costin"}, "path": "x-pack/plugin/sql/qa/src/main/java/org/elasticsearch/xpack/sql/qa/rest/BaseRestSqlTestCase.java", "diffHunk": "@@ -19,10 +18,119 @@\n \n import java.io.IOException;\n import java.io.InputStream;\n+import java.util.Locale;\n import java.util.Map;\n \n+import static org.elasticsearch.xpack.sql.proto.Protocol.BINARY_FORMAT_NAME;\n+import static org.elasticsearch.xpack.sql.proto.Protocol.CLIENT_ID_NAME;\n+import static org.elasticsearch.xpack.sql.proto.Protocol.VERSION_NAME;\n+import static org.elasticsearch.xpack.sql.proto.Protocol.COLUMNAR_NAME;\n+import static org.elasticsearch.xpack.sql.proto.Protocol.CURSOR_NAME;\n+import static org.elasticsearch.xpack.sql.proto.Protocol.FETCH_SIZE_NAME;\n+import static org.elasticsearch.xpack.sql.proto.Protocol.FILTER_NAME;\n+import static org.elasticsearch.xpack.sql.proto.Protocol.MODE_NAME;\n+import static org.elasticsearch.xpack.sql.proto.Protocol.PARAMS_NAME;\n+import static org.elasticsearch.xpack.sql.proto.Protocol.QUERY_NAME;\n+import static org.elasticsearch.xpack.sql.proto.Protocol.TIME_ZONE_NAME;\n+\n public abstract class BaseRestSqlTestCase extends ESRestTestCase {\n-    \n+\n+    public static class RequestObjectBuilder {\n+        private StringBuilder request;\n+        private final boolean isQuery;\n+\n+        private RequestObjectBuilder(String init, boolean isQuery) {\n+            request = new StringBuilder(init);\n+            this.isQuery = isQuery;\n+        }\n+\n+        public static RequestObjectBuilder query(String query) {\n+            return new RequestObjectBuilder(field(QUERY_NAME, query).substring(1), true);\n+        }\n+\n+        public static RequestObjectBuilder cursor(String cursor) {\n+            return new RequestObjectBuilder(field(CURSOR_NAME, cursor).substring(1), false);\n+        }\n+\n+        public RequestObjectBuilder version(String version) {\n+            request.append(field(VERSION_NAME, version));\n+            return this;\n+        }\n+\n+        public RequestObjectBuilder mode(String mode) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cbd409a815c89a2737b7be615c42768792dbde80"}, "originalPosition": 52}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA0OTI1NzA5", "url": "https://github.com/elastic/elasticsearch/pull/55094#pullrequestreview-404925709", "createdAt": "2020-05-04T12:06:37Z", "commit": {"oid": "cbd409a815c89a2737b7be615c42768792dbde80"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA0OTQwOTc4", "url": "https://github.com/elastic/elasticsearch/pull/55094#pullrequestreview-404940978", "createdAt": "2020-05-04T12:30:00Z", "commit": {"oid": "cbd409a815c89a2737b7be615c42768792dbde80"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNFQxMjozMDowMFrOGP-HIw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNFQxMjozMzozNlrOGP-OgQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTM5OTQ1OQ==", "bodyText": "Nice!", "url": "https://github.com/elastic/elasticsearch/pull/55094#discussion_r419399459", "createdAt": "2020-05-04T12:30:00Z", "author": {"login": "matriv"}, "path": "x-pack/plugin/sql/sql-proto/src/main/java/org/elasticsearch/xpack/sql/proto/Protocol.java", "diffHunk": "@@ -14,6 +14,32 @@\n  * Sql protocol defaults and end-points shared between JDBC and REST protocol implementations\n  */\n public final class Protocol {\n+    /**\n+     * The attribute names used in the protocol request/response objects.\n+     */\n+    // requests\n+    public static final String QUERY_NAME = \"query\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cbd409a815c89a2737b7be615c42768792dbde80"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTQwMTM0NQ==", "bodyText": "Can this (and the methods) be private or package private?", "url": "https://github.com/elastic/elasticsearch/pull/55094#discussion_r419401345", "createdAt": "2020-05-04T12:33:36Z", "author": {"login": "matriv"}, "path": "x-pack/plugin/sql/qa/src/main/java/org/elasticsearch/xpack/sql/qa/rest/BaseRestSqlTestCase.java", "diffHunk": "@@ -19,10 +18,119 @@\n \n import java.io.IOException;\n import java.io.InputStream;\n+import java.util.Locale;\n import java.util.Map;\n \n+import static org.elasticsearch.xpack.sql.proto.Protocol.BINARY_FORMAT_NAME;\n+import static org.elasticsearch.xpack.sql.proto.Protocol.CLIENT_ID_NAME;\n+import static org.elasticsearch.xpack.sql.proto.Protocol.VERSION_NAME;\n+import static org.elasticsearch.xpack.sql.proto.Protocol.COLUMNAR_NAME;\n+import static org.elasticsearch.xpack.sql.proto.Protocol.CURSOR_NAME;\n+import static org.elasticsearch.xpack.sql.proto.Protocol.FETCH_SIZE_NAME;\n+import static org.elasticsearch.xpack.sql.proto.Protocol.FILTER_NAME;\n+import static org.elasticsearch.xpack.sql.proto.Protocol.MODE_NAME;\n+import static org.elasticsearch.xpack.sql.proto.Protocol.PARAMS_NAME;\n+import static org.elasticsearch.xpack.sql.proto.Protocol.QUERY_NAME;\n+import static org.elasticsearch.xpack.sql.proto.Protocol.TIME_ZONE_NAME;\n+\n public abstract class BaseRestSqlTestCase extends ESRestTestCase {\n-    \n+\n+    public static class RequestObjectBuilder {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cbd409a815c89a2737b7be615c42768792dbde80"}, "originalPosition": 30}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bd8d19de82daede68447912f7cb47c5036995775", "author": {"user": {"login": "bpintea", "name": "Bogdan Pintea"}}, "url": "https://github.com/elastic/elasticsearch/commit/bd8d19de82daede68447912f7cb47c5036995775", "committedDate": "2020-05-04T13:51:04Z", "message": "Address review comments\n\nAdd a method to take Mode as parameter, besides its string\nrepresentation."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "72ce7f76fa1569a56519f7cf737089274c2bc49a", "author": {"user": {"login": "bpintea", "name": "Bogdan Pintea"}}, "url": "https://github.com/elastic/elasticsearch/commit/72ce7f76fa1569a56519f7cf737089274c2bc49a", "committedDate": "2020-05-04T15:50:46Z", "message": "Merge overrides to disambiguate call\n\nDisambiguate mode(String|Mode) to all compiler resolve the method when\ncalled from packages with not access to Mode class."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA1MTY4MDYz", "url": "https://github.com/elastic/elasticsearch/pull/55094#pullrequestreview-405168063", "createdAt": "2020-05-04T16:52:11Z", "commit": {"oid": "72ce7f76fa1569a56519f7cf737089274c2bc49a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3496, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}