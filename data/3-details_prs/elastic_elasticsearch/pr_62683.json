{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDkwMTA4NjQ4", "number": 62683, "title": "Override needsScore() on ValueCountAggregator", "bodyText": "This aggregator does not implement needScore() and therefore it always return false as it cannot have sub-aggregations. The issue is that if it contains a script that needs scores, then the assumption is wrong. Note that this test has starting failing due to work on apache/lucene-solr#1834\ncloses #62438", "createdAt": "2020-09-21T07:42:30Z", "url": "https://github.com/elastic/elasticsearch/pull/62683", "merged": true, "mergeCommit": {"oid": "651e70d5e78b3f45124a9485d8ce91ba9cc0af77"}, "closed": true, "closedAt": "2020-09-22T05:45:06Z", "author": {"login": "iverase"}, "timelineItems": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdK-WRRgH2gAyNDkwMTA4NjQ4OjBhZGZhN2FiNWI4MGVmZjEwY2NhMjBjN2U5ODQyY2M4YmFkMmU1NjQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdLD45kAFqTQ5MjYzMzYwOQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "0adfa7ab5b80eff10cca20c7e9842cc8bad2e564", "author": {"user": {"login": "iverase", "name": "Ignacio Vera"}}, "url": "https://github.com/elastic/elasticsearch/commit/0adfa7ab5b80eff10cca20c7e9842cc8bad2e564", "committedDate": "2020-09-21T07:34:55Z", "message": "override needsScore() on ValueCountAggregator"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkyMzY1MjE5", "url": "https://github.com/elastic/elasticsearch/pull/62683#pullrequestreview-492365219", "createdAt": "2020-09-21T08:14:28Z", "commit": {"oid": "0adfa7ab5b80eff10cca20c7e9842cc8bad2e564"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMVQwODoxNDoyOFrOHVE2LA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMVQwODoxNDoyOFrOHVE2LA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTg2MTU0OA==", "bodyText": "Note that this construct seems to be used by all NumericMetricsAggregator, I winder if we can move it to the parent class?", "url": "https://github.com/elastic/elasticsearch/pull/62683#discussion_r491861548", "createdAt": "2020-09-21T08:14:28Z", "author": {"login": "iverase"}, "path": "server/src/main/java/org/elasticsearch/search/aggregations/metrics/ValueCountAggregator.java", "diffHunk": "@@ -125,6 +126,11 @@ public InternalAggregation buildAggregation(long bucket) {\n         return new InternalValueCount(name, counts.get(bucket), metadata());\n     }\n \n+    @Override\n+    public ScoreMode scoreMode() {\n+        return valuesSource != null && valuesSource.needsScores() ? ScoreMode.COMPLETE : ScoreMode.COMPLETE_NO_SCORES;\n+    }\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0adfa7ab5b80eff10cca20c7e9842cc8bad2e564"}, "originalPosition": 16}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkyNjMzNjA5", "url": "https://github.com/elastic/elasticsearch/pull/62683#pullrequestreview-492633609", "createdAt": "2020-09-21T14:02:16Z", "commit": {"oid": "0adfa7ab5b80eff10cca20c7e9842cc8bad2e564"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3599, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}