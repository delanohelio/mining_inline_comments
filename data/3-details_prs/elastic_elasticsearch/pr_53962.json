{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzkyMjg2NTQx", "number": 53962, "title": "Upgrade to AWS SDK 1.11.749", "bodyText": "Upgrading AWS SDK to v1.11.749.\nRequired building clients inside privileged contexts because some class loading that requires privileges now happens there\nand working around a new SDK bug in the S3 client builder.\nCloses #53191", "createdAt": "2020-03-23T10:12:03Z", "url": "https://github.com/elastic/elasticsearch/pull/53962", "merged": true, "mergeCommit": {"oid": "d56d2cf08c97944c163dc36be3608ff800353246"}, "closed": true, "closedAt": "2020-03-23T12:50:03Z", "author": {"login": "original-brownbear"}, "timelineItems": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcQbfxwgH2gAyMzkyMjg2NTQxOjY1ODZmMDdlNGZiMGM4N2FiNTQ0MDFiNjg0OGZmN2NhMDFhODY1NjI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcQc-s9AFqTM3OTM1OTMwNQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "6586f07e4fb0c87ab54401b6848ff7ca01a86562", "author": {"user": {"login": "original-brownbear", "name": "Armin Braun"}}, "url": "https://github.com/elastic/elasticsearch/commit/6586f07e4fb0c87ab54401b6848ff7ca01a86562", "committedDate": "2020-03-23T10:11:01Z", "message": "Upgrade to AWS SDK 1.11.749\n\nUpgrading AWS SDK to v1.11.749.\nRequired building clients inside privileged contexts because some class loading that requires privileges now happens there\nand working around a new SDK bug in the S3 client builder.\n\nCloses #53191"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc5MzU5MzA1", "url": "https://github.com/elastic/elasticsearch/pull/53962#pullrequestreview-379359305", "createdAt": "2020-03-23T11:54:33Z", "commit": {"oid": "6586f07e4fb0c87ab54401b6848ff7ca01a86562"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QxMTo1NDozNFrOF6CGYg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QxMTo1NDozNFrOF6CGYg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjM5NjEzMA==", "bodyText": ":(", "url": "https://github.com/elastic/elasticsearch/pull/53962#discussion_r396396130", "createdAt": "2020-03-23T11:54:34Z", "author": {"login": "tlrx"}, "path": "plugins/repository-s3/src/main/java/org/elasticsearch/repositories/s3/S3Service.java", "diffHunk": "@@ -141,7 +141,12 @@ AmazonS3 buildClient(final S3ClientSettings clientSettings) {\n         builder.withCredentials(buildCredentials(logger, clientSettings));\n         builder.withClientConfiguration(buildConfiguration(clientSettings));\n \n-        final String endpoint = Strings.hasLength(clientSettings.endpoint) ? clientSettings.endpoint : Constants.S3_HOSTNAME;\n+        String endpoint = Strings.hasLength(clientSettings.endpoint) ? clientSettings.endpoint : Constants.S3_HOSTNAME;\n+        if ((endpoint.startsWith(\"http://\") || endpoint.startsWith(\"https://\")) == false) {\n+            // Manually add the schema to the endpoint to work around https://github.com/aws/aws-sdk-java/issues/2274\n+            // TODO: Remove this once fixed in the AWS SDK\n+            endpoint = clientSettings.protocol.toString() + \"://\" + endpoint;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6586f07e4fb0c87ab54401b6848ff7ca01a86562"}, "originalPosition": 9}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1775, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}