{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE3MjY2MTA1", "number": 56673, "title": "Disable search context release checks after every test", "bodyText": "This change adds a way to disable the checks that search contexts are all released\nafter each test in ESTestCase.\nThis is used by ESIntegTestCase to disable these checks if the cluster is shared\nacross all methods (SUITE scope). In this case, the contexts are checked at the end\nwhen the cluster is cleared. This fixes integration tests that starts components that\nperform search requests internally with a fixed delay (e.g.: async search maintenance service).\nFixes #55988", "createdAt": "2020-05-13T10:23:19Z", "url": "https://github.com/elastic/elasticsearch/pull/56673", "merged": true, "mergeCommit": {"oid": "39a2dec558003dcb3dea268d55fc9cc93d08695c"}, "closed": true, "closedAt": "2020-05-14T09:45:37Z", "author": {"login": "jimczi"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcg2NJ3AH2gAyNDE3MjY2MTA1OmZmY2Y0NmUxZGEwYjVkYzczMWI5M2UyOGY2MmIyOTVhMTY4NTExODc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABchI8_5gH2gAyNDE3MjY2MTA1OmE0YmRiNmQ5Y2QzMDNkOGVlZjU3OGVjODBlMGE2MGMyZThlNzdlMDk=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "ffcf46e1da0b5dc731b93e28f62b295a16851187", "author": {"user": {"login": "jimczi", "name": "Jim Ferenczi"}}, "url": "https://github.com/elastic/elasticsearch/commit/ffcf46e1da0b5dc731b93e28f62b295a16851187", "committedDate": "2020-05-13T10:20:54Z", "message": "Disable search context release checks after every test\n\nThis change adds a way to disable the checks that search contexts are all released\nafter each test in ESTestCase.\nThis is used by ESIntegTestCase to disable these checks if the cluster is shared\nacross all methods (SUITE scope). In this case, the contexts are checked at the end\nwhen the cluster is cleared. This fixes integration tests that starts components that\nperform search requests internally with a fixed delay (e.g.: async search maintenance service).\n\nFixes #55988"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEwODY2OTA4", "url": "https://github.com/elastic/elasticsearch/pull/56673#pullrequestreview-410866908", "createdAt": "2020-05-13T12:22:02Z", "commit": {"oid": "ffcf46e1da0b5dc731b93e28f62b295a16851187"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDExMDg3MTE3", "url": "https://github.com/elastic/elasticsearch/pull/56673#pullrequestreview-411087117", "createdAt": "2020-05-13T16:15:54Z", "commit": {"oid": "ffcf46e1da0b5dc731b93e28f62b295a16851187"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QxNjoxNTo1NFrOGU5UBQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QxNjoxNTo1NFrOGU5UBQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDU2MzcxNw==", "bodyText": "I think debugging would be easier if we return true here and false in AsyncSearchActionIT instead.", "url": "https://github.com/elastic/elasticsearch/pull/56673#discussion_r424563717", "createdAt": "2020-05-13T16:15:54Z", "author": {"login": "dnhatn"}, "path": "test/framework/src/main/java/org/elasticsearch/test/ESIntegTestCase.java", "diffHunk": "@@ -348,6 +348,14 @@ protected final boolean enableWarningsCheck() {\n         return false;\n     }\n \n+    @Override\n+    protected boolean enableSearchContextAfterCheck() {\n+        // We don't want to check the release of search contexts between tests if the cluster is shared.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ffcf46e1da0b5dc731b93e28f62b295a16851187"}, "originalPosition": 6}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "59603cbd7e2866cf598570d5c7a14a6f6a71b92e", "author": {"user": {"login": "jimczi", "name": "Jim Ferenczi"}}, "url": "https://github.com/elastic/elasticsearch/commit/59603cbd7e2866cf598570d5c7a14a6f6a71b92e", "committedDate": "2020-05-13T19:45:10Z", "message": "start/stop the maintenance service between each test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f8f223ca810f8a5b5f8784ffc33b61711e963442", "author": {"user": {"login": "jimczi", "name": "Jim Ferenczi"}}, "url": "https://github.com/elastic/elasticsearch/commit/f8f223ca810f8a5b5f8784ffc33b61711e963442", "committedDate": "2020-05-13T19:45:48Z", "message": "Merge branch 'master' into scope_search_context"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDExMjY3MzI0", "url": "https://github.com/elastic/elasticsearch/pull/56673#pullrequestreview-411267324", "createdAt": "2020-05-13T20:17:11Z", "commit": {"oid": "f8f223ca810f8a5b5f8784ffc33b61711e963442"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QyMDoxNzoxMVrOGVB_Og==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QyMDoxNzoxMVrOGVB_Og==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDcwNTg1MA==", "bodyText": "s/Maitenance/Maintenance here and below", "url": "https://github.com/elastic/elasticsearch/pull/56673#discussion_r424705850", "createdAt": "2020-05-13T20:17:11Z", "author": {"login": "javanna"}, "path": "x-pack/plugin/async-search/src/test/java/org/elasticsearch/xpack/search/AsyncSearchIntegTestCase.java", "diffHunk": "@@ -71,6 +75,25 @@ public SearchTestPlugin() {}\n         }\n     }\n \n+    @Before\n+    public void startMaitenanceService() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f8f223ca810f8a5b5f8784ffc33b61711e963442"}, "originalPosition": 24}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "86a17aa450e57f464df7d57929079642aae1b571", "author": {"user": {"login": "jimczi", "name": "Jim Ferenczi"}}, "url": "https://github.com/elastic/elasticsearch/commit/86a17aa450e57f464df7d57929079642aae1b571", "committedDate": "2020-05-13T20:57:11Z", "message": "fix typo"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a4bdb6d9cd303d8eef578ec80e0a60c2e8e77e09", "author": {"user": {"login": "jimczi", "name": "Jim Ferenczi"}}, "url": "https://github.com/elastic/elasticsearch/commit/a4bdb6d9cd303d8eef578ec80e0a60c2e8e77e09", "committedDate": "2020-05-14T08:11:27Z", "message": "Merge branch 'master' into scope_search_context"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 79, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}