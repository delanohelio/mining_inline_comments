{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE0MDQzMzM4", "number": 64472, "title": "Compress audit logs", "bodyText": "audit logs should be compressed when rolling over due to size based\ntriggering policy breaching 1GB.\nFiles are not being deleted.\ncloses #63843\n\n\nHave you signed the contributor license agreement?\nHave you followed the contributor guidelines?\nIf submitting code, have you built your formula locally prior to submission with gradle check?\nIf submitting code, is your pull request against master? Unless there is a good reason otherwise, we prefer pull requests against master and will backport as needed.\nIf submitting code, have you checked that your submission is for an OS and architecture that we support?\nIf you are submitting this code for a class then read our policy for that.", "createdAt": "2020-11-02T13:02:15Z", "url": "https://github.com/elastic/elasticsearch/pull/64472", "merged": true, "mergeCommit": {"oid": "3b859f56a9589de0aa1f32f35364906847804b0a"}, "closed": true, "closedAt": "2020-12-02T16:36:32Z", "author": {"login": "pgomulka"}, "timelineItems": {"totalCount": 16, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdYkKBmgH2gAyNTE0MDQzMzM4OjIyNmJjOGMyMTg0MmIwOWRiZmY1ODk2MDg4YmNhMjBkNWVmOTFhMjg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdiKJa4AH2gAyNTE0MDQzMzM4OjIxYWVmNjkzNWQ3MzM0OWE1YmU3NzEwODhhYjc4Njc2NTFjNTUzYmE=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "226bc8c21842b09dbff5896088bca20d5ef91a28", "author": {"user": {"login": "pgomulka", "name": "Przemyslaw Gomulka"}}, "url": "https://github.com/elastic/elasticsearch/commit/226bc8c21842b09dbff5896088bca20d5ef91a28", "committedDate": "2020-11-02T12:58:57Z", "message": "Compress audit logs\n\naudit logs should be compressed when rolling over due to size based\ntriggering policy breaching 1GB.\nTotal number of zipped files should be the same as for other log = 4\n\ncloses #63843"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIyMTcxOTE4", "url": "https://github.com/elastic/elasticsearch/pull/64472#pullrequestreview-522171918", "createdAt": "2020-11-03T03:34:05Z", "commit": {"oid": "226bc8c21842b09dbff5896088bca20d5ef91a28"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wM1QwMzozNDowNVrOHsfQUw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wM1QwMzozNDowNVrOHsfQUw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjQxMTQ3NQ==", "bodyText": "?", "url": "https://github.com/elastic/elasticsearch/pull/64472#discussion_r516411475", "createdAt": "2020-11-03T03:34:05Z", "author": {"login": "tvernum"}, "path": "x-pack/plugin/core/src/main/config/log4j2.properties", "diffHunk": "@@ -67,15 +67,19 @@ appender.audit_rolling.layout.pattern = {\\\n # \"indices\" the array of indices that the \"action\" is acting upon\n # \"opaque_id\" opaque value conveyed by the \"X-Opaque-Id\" request header\n # \"x_forwarded_for\" the addresses from the \"X-Forwarded-For\" request header, as a verbatim string value (not an array)\n-# \"transport.profile\" name of the transport profile in case this is a \"connection_granted\" or \"connection_denied\" event\n+# \"transport.profile\" name of the transport profile iLoggingAuditTrailn case this is a \"connection_granted\" or \"connection_denied\" event", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "226bc8c21842b09dbff5896088bca20d5ef91a28"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "27f2b4c6959f572937206ca54766b3df80051e59", "author": {"user": {"login": "pgomulka", "name": "Przemyslaw Gomulka"}}, "url": "https://github.com/elastic/elasticsearch/commit/27f2b4c6959f572937206ca54766b3df80051e59", "committedDate": "2020-11-03T07:55:36Z", "message": "remove accidental change"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e0dfbf54e44c678508f713577da9a9e70f930268", "author": {"user": {"login": "pgomulka", "name": "Przemyslaw Gomulka"}}, "url": "https://github.com/elastic/elasticsearch/commit/e0dfbf54e44c678508f713577da9a9e70f930268", "committedDate": "2020-11-03T07:55:38Z", "message": "Merge branch 'master' into zipping_audit_logs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "13da2934c55dab2a30129e1d433ad2a072a5cc2e", "author": {"user": {"login": "pgomulka", "name": "Przemyslaw Gomulka"}}, "url": "https://github.com/elastic/elasticsearch/commit/13da2934c55dab2a30129e1d433ad2a072a5cc2e", "committedDate": "2020-11-06T15:57:21Z", "message": "remove rolling policy"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c165661b630ea0268e83b5772b20e988166598e6", "author": {"user": {"login": "pgomulka", "name": "Przemyslaw Gomulka"}}, "url": "https://github.com/elastic/elasticsearch/commit/c165661b630ea0268e83b5772b20e988166598e6", "committedDate": "2020-11-06T16:18:48Z", "message": "Merge branch 'master' into zipping_audit_logs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "eaca5d5b52a65b5e109385e4ce073eab38a4e636", "author": {"user": {"login": "elasticmachine", "name": "Elastic Machine"}}, "url": "https://github.com/elastic/elasticsearch/commit/eaca5d5b52a65b5e109385e4ce073eab38a4e636", "committedDate": "2020-11-10T12:12:05Z", "message": "Merge branch 'master' into zipping_audit_logs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d8546394a6647f3f364fd30b83c882fdb02e1a6e", "author": {"user": {"login": "pgomulka", "name": "Przemyslaw Gomulka"}}, "url": "https://github.com/elastic/elasticsearch/commit/d8546394a6647f3f364fd30b83c882fdb02e1a6e", "committedDate": "2020-11-10T13:25:04Z", "message": "empty line"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cb0b66317459d4f78a611ccedba5205bcd15f829", "author": {"user": {"login": "pgomulka", "name": "Przemyslaw Gomulka"}}, "url": "https://github.com/elastic/elasticsearch/commit/cb0b66317459d4f78a611ccedba5205bcd15f829", "committedDate": "2020-11-10T13:37:56Z", "message": "Merge branch 'zipping_audit_logs' of github.com:pgomulka/elasticsearch into zipping_audit_logs"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQxODU1MDk5", "url": "https://github.com/elastic/elasticsearch/pull/64472#pullrequestreview-541855099", "createdAt": "2020-12-01T12:39:49Z", "commit": {"oid": "cb0b66317459d4f78a611ccedba5205bcd15f829"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wMVQxMjozOTo1MFrOH8qyIQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wMVQxMjozOTo1MFrOH8qyIQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzM3NzU2OQ==", "bodyText": "I think we need to explicitly set the nomax file index attribute.\nappender.audit_rolling.strategy.type = DefaultRolloverStrategy\nappender.audit_rolling.strategy.fileIndex = nomax", "url": "https://github.com/elastic/elasticsearch/pull/64472#discussion_r533377569", "createdAt": "2020-12-01T12:39:50Z", "author": {"login": "albertzaharovits"}, "path": "x-pack/plugin/core/src/main/config/log4j2.properties", "diffHunk": "@@ -71,11 +71,13 @@ appender.audit_rolling.layout.pattern = {\\\n # \"rule\" name of the applied rule if the \"origin.type\" is \"ip_filter\"\n # \"event.category\" fixed value \"elasticsearch-audit\"\n \n-appender.audit_rolling.filePattern = ${sys:es.logs.base_path}${sys:file.separator}${sys:es.logs.cluster_name}_audit-%d{yyyy-MM-dd}.json\n+appender.audit_rolling.filePattern = ${sys:es.logs.base_path}${sys:file.separator}${sys:es.logs.cluster_name}_audit-%d{yyyy-MM-dd}-%i.json.gz\n appender.audit_rolling.policies.type = Policies\n appender.audit_rolling.policies.time.type = TimeBasedTriggeringPolicy\n appender.audit_rolling.policies.time.interval = 1\n appender.audit_rolling.policies.time.modulate = true\n+appender.audit_rolling.policies.size.type = SizeBasedTriggeringPolicy\n+appender.audit_rolling.policies.size.size = 1GB", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cb0b66317459d4f78a611ccedba5205bcd15f829"}, "originalPosition": 11}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5d6f559b5cbdd70fd382f511d1927399a2eaa7da", "author": {"user": {"login": "pgomulka", "name": "Przemyslaw Gomulka"}}, "url": "https://github.com/elastic/elasticsearch/commit/5d6f559b5cbdd70fd382f511d1927399a2eaa7da", "committedDate": "2020-12-01T13:08:44Z", "message": "set nomax for rollover"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0a10eabacc7508454cfd97b5a97f9b00feaa80cf", "author": {"user": {"login": "elasticmachine", "name": "Elastic Machine"}}, "url": "https://github.com/elastic/elasticsearch/commit/0a10eabacc7508454cfd97b5a97f9b00feaa80cf", "committedDate": "2020-12-01T15:28:42Z", "message": "Merge branch 'master' into zipping_audit_logs"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQyMDIxNTkx", "url": "https://github.com/elastic/elasticsearch/pull/64472#pullrequestreview-542021591", "createdAt": "2020-12-01T15:33:28Z", "commit": {"oid": "0a10eabacc7508454cfd97b5a97f9b00feaa80cf"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5c298bc6878f14412bcc839704d9dd85bd768b82", "author": {"user": {"login": "pgomulka", "name": "Przemyslaw Gomulka"}}, "url": "https://github.com/elastic/elasticsearch/commit/5c298bc6878f14412bcc839704d9dd85bd768b82", "committedDate": "2020-12-01T15:43:49Z", "message": "breaking change doc"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f834bdc1841785eca3e0ed1706becf1008c62c84", "author": {"user": {"login": "pgomulka", "name": "Przemyslaw Gomulka"}}, "url": "https://github.com/elastic/elasticsearch/commit/f834bdc1841785eca3e0ed1706becf1008c62c84", "committedDate": "2020-12-01T15:49:15Z", "message": "Merge branch 'zipping_audit_logs' of github.com:pgomulka/elasticsearch into zipping_audit_logs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "21aef6935d73349a5be771088ab7867651c553ba", "author": {"user": {"login": "pgomulka", "name": "Przemyslaw Gomulka"}}, "url": "https://github.com/elastic/elasticsearch/commit/21aef6935d73349a5be771088ab7867651c553ba", "committedDate": "2020-12-02T08:20:00Z", "message": "fix docs"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 915, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}