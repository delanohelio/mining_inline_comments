{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg3OTY0NjI5", "number": 53562, "title": "Create new `geo` module and migrate geo_shape registration", "bodyText": "This commit introduces a new geo module that is intended\nto contain all the geo-spatial-specific features in server.\nAs a first step, the responsibility of registering the geo_shape\nfield mapper is moved to this module.", "createdAt": "2020-03-13T20:23:35Z", "url": "https://github.com/elastic/elasticsearch/pull/53562", "merged": true, "mergeCommit": {"oid": "cf9603c6fdc9b1d80f9c4aaebeb0f8fa2470f5a6"}, "closed": true, "closedAt": "2020-04-07T19:27:30Z", "author": {"login": "talevy"}, "timelineItems": {"totalCount": 30, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcNWNfugH2gAyMzg3OTY0NjI5OmFhYjkyMGY0OGNmYjgzZmE5YjYxMTkwODQ1ZDM1YTcyZGMwODFjOGI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcVYU7EAFqTM4OTQxODIyNQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "aab920f48cfb83fa9b61190845d35a72dc081c8b", "author": {"user": {"login": "talevy", "name": "Tal Levy"}}, "url": "https://github.com/elastic/elasticsearch/commit/aab920f48cfb83fa9b61190845d35a72dc081c8b", "committedDate": "2020-03-13T20:19:45Z", "message": "Create new spatial-extras module and migrate geo_shape registration\n\nThis commit introduces a new spatial-extras module that is intended\nto be contain all the geo-spatial-specific features in server.\n\nAs a first step, the responsibility of registering the geo_shape\nfield mapper is moved to this module."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fe11a26684d2e834877eaa3aca7e51dac3501384", "author": {"user": {"login": "talevy", "name": "Tal Levy"}}, "url": "https://github.com/elastic/elasticsearch/commit/fe11a26684d2e834877eaa3aca7e51dac3501384", "committedDate": "2020-03-13T20:43:38Z", "message": "cover more test cases and take ownership of exists yaml tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fae51f52ba2fe002e63820b9f633857601c22133", "author": {"user": {"login": "talevy", "name": "Tal Levy"}}, "url": "https://github.com/elastic/elasticsearch/commit/fae51f52ba2fe002e63820b9f633857601c22133", "committedDate": "2020-03-13T21:06:31Z", "message": "more tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e7d8efdc0820259dd987792b71f718721426b36c", "author": {"user": {"login": "talevy", "name": "Tal Levy"}}, "url": "https://github.com/elastic/elasticsearch/commit/e7d8efdc0820259dd987792b71f718721426b36c", "committedDate": "2020-03-13T22:22:36Z", "message": "more fixes"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc0NjUxNDk2", "url": "https://github.com/elastic/elasticsearch/pull/53562#pullrequestreview-374651496", "createdAt": "2020-03-13T22:27:19Z", "commit": {"oid": "e7d8efdc0820259dd987792b71f718721426b36c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xM1QyMjoyNzoxOVrOF2VGSQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xM1QyMjoyNzoxOVrOF2VGSQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjUxMzA5Nw==", "bodyText": "I think there is room to pull the TestGeoShapeFieldMapperPlugin to the parent test class and inherited by those that need it or need to extend to include more plugins. I could see it stay either way since it is fairly low impact and the dependency is expected to go away", "url": "https://github.com/elastic/elasticsearch/pull/53562#discussion_r392513097", "createdAt": "2020-03-13T22:27:19Z", "author": {"login": "talevy"}, "path": "modules/mapper-extras/src/test/java/org/elasticsearch/index/query/RankFeatureQueryBuilderTests.java", "diffHunk": "@@ -52,7 +52,7 @@ protected void initializeAdditionalMappings(MapperService mapperService) throws\n \n     @Override\n     protected Collection<Class<? extends Plugin>> getPlugins() {\n-        return Collections.singleton(MapperExtrasPlugin.class);\n+        return List.of(MapperExtrasPlugin.class, TestGeoShapeFieldMapperPlugin.class);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e7d8efdc0820259dd987792b71f718721426b36c"}, "originalPosition": 18}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ff1024d1acd96c4a17a628b83fd604ffe8cb67ac", "author": {"user": {"login": "talevy", "name": "Tal Levy"}}, "url": "https://github.com/elastic/elasticsearch/commit/ff1024d1acd96c4a17a628b83fd604ffe8cb67ac", "committedDate": "2020-03-13T22:38:03Z", "message": "fix enrich test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "99d4240eb9b54ad7afd360db78a30c5c183a81d9", "author": {"user": {"login": "talevy", "name": "Tal Levy"}}, "url": "https://github.com/elastic/elasticsearch/commit/99d4240eb9b54ad7afd360db78a30c5c183a81d9", "committedDate": "2020-03-13T22:43:55Z", "message": "add empty unit tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3d9fb1227a1a21544454bb811f1de39fa7ba5a45", "author": {"user": {"login": "talevy", "name": "Tal Levy"}}, "url": "https://github.com/elastic/elasticsearch/commit/3d9fb1227a1a21544454bb811f1de39fa7ba5a45", "committedDate": "2020-03-13T22:44:38Z", "message": "add license header"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc0NjU4MDk5", "url": "https://github.com/elastic/elasticsearch/pull/53562#pullrequestreview-374658099", "createdAt": "2020-03-13T22:50:09Z", "commit": {"oid": "3d9fb1227a1a21544454bb811f1de39fa7ba5a45"}, "state": "COMMENTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xM1QyMjo1MDowOVrOF2VcAg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xM1QyMjo1NDozNlrOF2VgCQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjUxODY1OA==", "bodyText": "Why changing to these newer methods? It will make backporting more difficult and should probably be done separately if we want to clean this up in master.", "url": "https://github.com/elastic/elasticsearch/pull/53562#discussion_r392518658", "createdAt": "2020-03-13T22:50:09Z", "author": {"login": "rjernst"}, "path": "modules/mapper-extras/src/test/java/org/elasticsearch/index/query/RankFeatureQueryBuilderTests.java", "diffHunk": "@@ -52,7 +52,7 @@ protected void initializeAdditionalMappings(MapperService mapperService) throws\n \n     @Override\n     protected Collection<Class<? extends Plugin>> getPlugins() {\n-        return Collections.singleton(MapperExtrasPlugin.class);\n+        return List.of(MapperExtrasPlugin.class, TestGeoShapeFieldMapperPlugin.class);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3d9fb1227a1a21544454bb811f1de39fa7ba5a45"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjUxODk4OA==", "bodyText": "This also seems like it at least warrants a followup issue for cleanup. I don't see why we should need geo mappers inside tests of all these other modules?", "url": "https://github.com/elastic/elasticsearch/pull/53562#discussion_r392518988", "createdAt": "2020-03-13T22:51:30Z", "author": {"login": "rjernst"}, "path": "modules/mapper-extras/src/test/java/org/elasticsearch/index/query/RankFeatureQueryBuilderTests.java", "diffHunk": "@@ -52,7 +52,7 @@ protected void initializeAdditionalMappings(MapperService mapperService) throws\n \n     @Override\n     protected Collection<Class<? extends Plugin>> getPlugins() {\n-        return Collections.singleton(MapperExtrasPlugin.class);\n+        return List.of(MapperExtrasPlugin.class, TestGeoShapeFieldMapperPlugin.class);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjUxODY1OA=="}, "originalCommit": {"oid": "3d9fb1227a1a21544454bb811f1de39fa7ba5a45"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjUxOTQ2MQ==", "bodyText": "This name doesn't make sense to me. These aren't extra classes, these are the geo classes. Can we just call this module geo or spatial or something similar?", "url": "https://github.com/elastic/elasticsearch/pull/53562#discussion_r392519461", "createdAt": "2020-03-13T22:53:33Z", "author": {"login": "rjernst"}, "path": "modules/spatial-extras/build.gradle", "diffHunk": "@@ -0,0 +1,23 @@\n+/*\n+ * Licensed to Elasticsearch under one or more contributor\n+ * license agreements. See the NOTICE file distributed with\n+ * this work for additional information regarding copyright\n+ * ownership. Elasticsearch licenses this file to you under\n+ * the Apache License, Version 2.0 (the \"License\"); you may\n+ * not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *    http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+esplugin {\n+  description 'Placeholder plugin for spatial features in ES. only registers geo-shape field mapper for now'\n+  classname 'org.elasticsearch.spatial.SpatialExtrasPlugin'", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3d9fb1227a1a21544454bb811f1de39fa7ba5a45"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjUxOTY4OQ==", "bodyText": "You can do this in a single line with Collections.singletonMap", "url": "https://github.com/elastic/elasticsearch/pull/53562#discussion_r392519689", "createdAt": "2020-03-13T22:54:36Z", "author": {"login": "rjernst"}, "path": "modules/spatial-extras/src/main/java/org/elasticsearch/spatial/SpatialExtrasPlugin.java", "diffHunk": "@@ -0,0 +1,40 @@\n+/*\n+ * Licensed to Elasticsearch under one or more contributor\n+ * license agreements. See the NOTICE file distributed with\n+ * this work for additional information regarding copyright\n+ * ownership. Elasticsearch licenses this file to you under\n+ * the Apache License, Version 2.0 (the \"License\"); you may\n+ * not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *    http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.elasticsearch.spatial;\n+\n+import org.elasticsearch.index.mapper.AbstractGeometryFieldMapper;\n+import org.elasticsearch.index.mapper.GeoShapeFieldMapper;\n+import org.elasticsearch.index.mapper.Mapper;\n+import org.elasticsearch.plugins.MapperPlugin;\n+import org.elasticsearch.plugins.Plugin;\n+\n+import java.util.Collections;\n+import java.util.LinkedHashMap;\n+import java.util.Map;\n+\n+public class SpatialExtrasPlugin extends Plugin implements MapperPlugin {\n+\n+    @Override\n+    public Map<String, Mapper.TypeParser> getMappers() {\n+        Map<String, Mapper.TypeParser> mappers = new LinkedHashMap<>();\n+        mappers.put(GeoShapeFieldMapper.CONTENT_TYPE, new AbstractGeometryFieldMapper.TypeParser());\n+        return Collections.unmodifiableMap(mappers);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3d9fb1227a1a21544454bb811f1de39fa7ba5a45"}, "originalPosition": 38}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "136a2cf2e7351b30c54d35cd68422293da2996aa", "author": {"user": {"login": "talevy", "name": "Tal Levy"}}, "url": "https://github.com/elastic/elasticsearch/commit/136a2cf2e7351b30c54d35cd68422293da2996aa", "committedDate": "2020-03-13T23:21:37Z", "message": "moar"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d7f2279943a71b176efad56bc274ce48ffd54fa9", "author": {"user": {"login": "talevy", "name": "Tal Levy"}}, "url": "https://github.com/elastic/elasticsearch/commit/d7f2279943a71b176efad56bc274ce48ffd54fa9", "committedDate": "2020-03-13T23:25:05Z", "message": "singletonmap"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ad4a4bdd1f1cb7a3b6e33cdb4b289d22992c2a96", "author": {"user": {"login": "talevy", "name": "Tal Levy"}}, "url": "https://github.com/elastic/elasticsearch/commit/ad4a4bdd1f1cb7a3b6e33cdb4b289d22992c2a96", "committedDate": "2020-03-13T23:44:40Z", "message": "List.of -> Arrays.asList"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c954df7df5a5c502960e9330bfa9a3b36d3a8d3d", "author": {"user": {"login": "nknize", "name": "Nick Knize"}}, "url": "https://github.com/elastic/elasticsearch/commit/c954df7df5a5c502960e9330bfa9a3b36d3a8d3d", "committedDate": "2020-03-18T20:17:12Z", "message": "refactor spatial-extras to geo"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f6d68f61eb857c81491928b80f26bbc9094ec787", "author": {"user": {"login": "nknize", "name": "Nick Knize"}}, "url": "https://github.com/elastic/elasticsearch/commit/f6d68f61eb857c81491928b80f26bbc9094ec787", "committedDate": "2020-03-18T20:25:53Z", "message": "Merge branch 'master' into spatial-extras"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3daf04645b39dacf408bd97b0198266154726864", "author": {"user": {"login": "nknize", "name": "Nick Knize"}}, "url": "https://github.com/elastic/elasticsearch/commit/3daf04645b39dacf408bd97b0198266154726864", "committedDate": "2020-03-18T20:28:40Z", "message": "spotless apply"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e45d92c30c797aec328adc3017d636e015000f9f", "author": {"user": {"login": "nknize", "name": "Nick Knize"}}, "url": "https://github.com/elastic/elasticsearch/commit/e45d92c30c797aec328adc3017d636e015000f9f", "committedDate": "2020-03-23T20:10:19Z", "message": "added TestGeoShapeFieldMapperPlugin to PinnedQueryBuilderTests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e93f6a0b6ffb7a7a22aa20dfd4fc441486a56ebe", "author": {"user": {"login": "talevy", "name": "Tal Levy"}}, "url": "https://github.com/elastic/elasticsearch/commit/e93f6a0b6ffb7a7a22aa20dfd4fc441486a56ebe", "committedDate": "2020-03-31T22:53:56Z", "message": "Merge remote-tracking branch 'elastic/master' into spatial-extras"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4329d0e5c5d9781e6697cefef10376e5f3708b0d", "author": {"user": {"login": "talevy", "name": "Tal Levy"}}, "url": "https://github.com/elastic/elasticsearch/commit/4329d0e5c5d9781e6697cefef10376e5f3708b0d", "committedDate": "2020-03-31T23:10:32Z", "message": "fix checkstyle"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "40ce9d7335f27c709a23e81e2750546f18836bfd", "author": {"user": {"login": "talevy", "name": "Tal Levy"}}, "url": "https://github.com/elastic/elasticsearch/commit/40ce9d7335f27c709a23e81e2750546f18836bfd", "committedDate": "2020-03-31T23:41:54Z", "message": "fix percolator query test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "508b17504e9a621ad866eec5d91b63c80b770675", "author": {"user": {"login": "talevy", "name": "Tal Levy"}}, "url": "https://github.com/elastic/elasticsearch/commit/508b17504e9a621ad866eec5d91b63c80b770675", "committedDate": "2020-04-01T21:42:07Z", "message": "Merge remote-tracking branch 'elastic/master' into spatial-extras"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "64c0bea9caccbc6e5929e64ad5002ab295cae21e", "author": {"user": {"login": "talevy", "name": "Tal Levy"}}, "url": "https://github.com/elastic/elasticsearch/commit/64c0bea9caccbc6e5929e64ad5002ab295cae21e", "committedDate": "2020-04-01T23:40:37Z", "message": "try to make Percolator test happy"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "558d32df3250300df50869c7d167bf5e988db61c", "author": {"user": {"login": "talevy", "name": "Tal Levy"}}, "url": "https://github.com/elastic/elasticsearch/commit/558d32df3250300df50869c7d167bf5e988db61c", "committedDate": "2020-04-02T01:00:13Z", "message": "make gradle happy"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "252d8e101e15f5e54f1e82e553f9f3abb5c15144", "author": {"user": {"login": "talevy", "name": "Tal Levy"}}, "url": "https://github.com/elastic/elasticsearch/commit/252d8e101e15f5e54f1e82e553f9f3abb5c15144", "committedDate": "2020-04-02T02:25:45Z", "message": "fix ShapeQueryBuilderTests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4ccb497ba4e99e01a9ef901fefea5831aef4fba5", "author": {"user": {"login": "talevy", "name": "Tal Levy"}}, "url": "https://github.com/elastic/elasticsearch/commit/4ccb497ba4e99e01a9ef901fefea5831aef4fba5", "committedDate": "2020-04-02T20:27:25Z", "message": "no client-only nodes in percolator tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dbc9414d5a6a6300061df8eab6c52aa120e669ba", "author": {"user": {"login": "talevy", "name": "Tal Levy"}}, "url": "https://github.com/elastic/elasticsearch/commit/dbc9414d5a6a6300061df8eab6c52aa120e669ba", "committedDate": "2020-04-02T21:19:37Z", "message": "Merge remote-tracking branch 'elastic/master' into spatial-extras"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f1a4136d2bbe36461cfdd5484dc41f6d67657623", "author": {"user": {"login": "talevy", "name": "Tal Levy"}}, "url": "https://github.com/elastic/elasticsearch/commit/f1a4136d2bbe36461cfdd5484dc41f6d67657623", "committedDate": "2020-04-03T17:15:51Z", "message": "stop using smile in percolator test, no valid UTF8"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "61f2b1357b3978eab337f6c24934dd18fa79b81f", "author": {"user": {"login": "talevy", "name": "Tal Levy"}}, "url": "https://github.com/elastic/elasticsearch/commit/61f2b1357b3978eab337f6c24934dd18fa79b81f", "committedDate": "2020-04-03T18:17:27Z", "message": "fix unsused imports"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "917e538c2fec840430e841fba1a15b82e35aa0c2", "author": {"user": {"login": "talevy", "name": "Tal Levy"}}, "url": "https://github.com/elastic/elasticsearch/commit/917e538c2fec840430e841fba1a15b82e35aa0c2", "committedDate": "2020-04-03T19:31:08Z", "message": "Merge remote-tracking branch 'elastic/master' into spatial-extras"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "be57a8051aae866d9aa195d9c89036e37720c17d", "author": {"user": {"login": "talevy", "name": "Tal Levy"}}, "url": "https://github.com/elastic/elasticsearch/commit/be57a8051aae866d9aa195d9c89036e37720c17d", "committedDate": "2020-04-07T17:19:50Z", "message": "Merge remote-tracking branch 'elastic/master' into spatial-extras"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg5NDE4MjI1", "url": "https://github.com/elastic/elasticsearch/pull/53562#pullrequestreview-389418225", "createdAt": "2020-04-07T19:19:04Z", "commit": {"oid": "be57a8051aae866d9aa195d9c89036e37720c17d"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1406, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}