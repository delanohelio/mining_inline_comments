{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE5NDI2MDY4", "number": 64966, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMlQwMjoxODozNFrOE39ToQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNlQwMTo0NTozNFrOE5PYsw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI3MTExNTg1OnYy", "diffSide": "RIGHT", "path": "x-pack/qa/oidc-op-tests/src/test/java/org/elasticsearch/xpack/security/authc/oidc/OpenIdConnectAuthIT.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMlQwMjoxODozNFrOHxmoAQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMlQyMDo1MjoyM1rOHyN60g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTc3NTEwNQ==", "bodyText": "A similar assertion for realm_name of the prepare response can also be added in method OpenIdConnectAuthIT#getRedirectedFromFacilitator.", "url": "https://github.com/elastic/elasticsearch/pull/64966#discussion_r521775105", "createdAt": "2020-11-12T02:18:34Z", "author": {"login": "ywangd"}, "path": "x-pack/qa/oidc-op-tests/src/test/java/org/elasticsearch/xpack/security/authc/oidc/OpenIdConnectAuthIT.java", "diffHunk": "@@ -420,6 +420,7 @@ private PrepareAuthResponse getRedirectedFromFacilitator(String realmName) throw\n             logger.info(\" OpenIDConnect authentication response {}\", responseBody);\n             assertNotNull(responseBody.get(\"access_token\"));\n             assertNotNull(responseBody.get(\"refresh_token\"));\n+            assertNotNull(responseBody.get(\"realm_name\"));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "819d4f1ea4624aaf87ce2c46fe54dd0f94d60286"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjQxODg5OA==", "bodyText": "Made realm param no nullable for PrepareAuthResponse called from OpenIdConnectAuthIT#getRedirectedFromFacilitator", "url": "https://github.com/elastic/elasticsearch/pull/64966#discussion_r522418898", "createdAt": "2020-11-12T20:52:23Z", "author": {"login": "BigPandaToo"}, "path": "x-pack/qa/oidc-op-tests/src/test/java/org/elasticsearch/xpack/security/authc/oidc/OpenIdConnectAuthIT.java", "diffHunk": "@@ -420,6 +420,7 @@ private PrepareAuthResponse getRedirectedFromFacilitator(String realmName) throw\n             logger.info(\" OpenIDConnect authentication response {}\", responseBody);\n             assertNotNull(responseBody.get(\"access_token\"));\n             assertNotNull(responseBody.get(\"refresh_token\"));\n+            assertNotNull(responseBody.get(\"realm_name\"));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTc3NTEwNQ=="}, "originalCommit": {"oid": "819d4f1ea4624aaf87ce2c46fe54dd0f94d60286"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI3MTEyNjEzOnYy", "diffSide": "RIGHT", "path": "x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/security/action/oidc/OpenIdConnectAuthenticateResponse.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMlQwMjoyNDoxM1rOHxmuDQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMlQyMDo1MzoyMVrOHyN8rw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTc3NjY1Mw==", "bodyText": "I think we can save this new parameter because the realm information is already available via authentication.getSourceRealm().", "url": "https://github.com/elastic/elasticsearch/pull/64966#discussion_r521776653", "createdAt": "2020-11-12T02:24:13Z", "author": {"login": "ywangd"}, "path": "x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/security/action/oidc/OpenIdConnectAuthenticateResponse.java", "diffHunk": "@@ -19,14 +19,16 @@\n     private String accessTokenString;\n     private String refreshTokenString;\n     private TimeValue expiresIn;\n+    private String realmName;\n     private Authentication authentication;\n \n     public OpenIdConnectAuthenticateResponse(Authentication authentication, String accessTokenString, String refreshTokenString,\n-                                             TimeValue expiresIn) {\n+                                             TimeValue expiresIn, String realmName) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "819d4f1ea4624aaf87ce2c46fe54dd0f94d60286"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjQxOTM3NQ==", "bodyText": "Revert the changes for OIDC authenticate, as you point out - no need for this anymore.", "url": "https://github.com/elastic/elasticsearch/pull/64966#discussion_r522419375", "createdAt": "2020-11-12T20:53:21Z", "author": {"login": "BigPandaToo"}, "path": "x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/security/action/oidc/OpenIdConnectAuthenticateResponse.java", "diffHunk": "@@ -19,14 +19,16 @@\n     private String accessTokenString;\n     private String refreshTokenString;\n     private TimeValue expiresIn;\n+    private String realmName;\n     private Authentication authentication;\n \n     public OpenIdConnectAuthenticateResponse(Authentication authentication, String accessTokenString, String refreshTokenString,\n-                                             TimeValue expiresIn) {\n+                                             TimeValue expiresIn, String realmName) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTc3NjY1Mw=="}, "originalCommit": {"oid": "819d4f1ea4624aaf87ce2c46fe54dd0f94d60286"}, "originalPosition": 9}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI4NDU2Mjg5OnYy", "diffSide": "RIGHT", "path": "x-pack/qa/oidc-op-tests/src/test/java/org/elasticsearch/xpack/security/authc/oidc/OpenIdConnectAuthIT.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNlQwMTo0NToxMFrOHzlkRg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNlQxMDozNDoyNFrOHz0NtQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzg1NDkxOA==", "bodyText": "This is no longer necessary since the realm field is removed from the response (due to presence of the authentication field).", "url": "https://github.com/elastic/elasticsearch/pull/64966#discussion_r523854918", "createdAt": "2020-11-16T01:45:10Z", "author": {"login": "ywangd"}, "path": "x-pack/qa/oidc-op-tests/src/test/java/org/elasticsearch/xpack/security/authc/oidc/OpenIdConnectAuthIT.java", "diffHunk": "@@ -420,6 +420,7 @@ private PrepareAuthResponse getRedirectedFromFacilitator(String realmName) throw\n             logger.info(\" OpenIDConnect authentication response {}\", responseBody);\n             assertNotNull(responseBody.get(\"access_token\"));\n             assertNotNull(responseBody.get(\"refresh_token\"));\n+            assertNotNull(responseBody.get(\"realm\"));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8bacf63d735945446e854e9effb9de8817ac293b"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDA5NDkwMQ==", "bodyText": "Ah, yes, late Sunday commits don't do dood )", "url": "https://github.com/elastic/elasticsearch/pull/64966#discussion_r524094901", "createdAt": "2020-11-16T10:34:24Z", "author": {"login": "BigPandaToo"}, "path": "x-pack/qa/oidc-op-tests/src/test/java/org/elasticsearch/xpack/security/authc/oidc/OpenIdConnectAuthIT.java", "diffHunk": "@@ -420,6 +420,7 @@ private PrepareAuthResponse getRedirectedFromFacilitator(String realmName) throw\n             logger.info(\" OpenIDConnect authentication response {}\", responseBody);\n             assertNotNull(responseBody.get(\"access_token\"));\n             assertNotNull(responseBody.get(\"refresh_token\"));\n+            assertNotNull(responseBody.get(\"realm\"));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzg1NDkxOA=="}, "originalCommit": {"oid": "8bacf63d735945446e854e9effb9de8817ac293b"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI4NDU2MzcxOnYy", "diffSide": "RIGHT", "path": "x-pack/qa/oidc-op-tests/src/test/java/org/elasticsearch/xpack/security/authc/oidc/OpenIdConnectAuthIT.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNlQwMTo0NTozNFrOHzlksw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNlQwMTo0NTozNFrOHzlksw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzg1NTAyNw==", "bodyText": "Similarly, this change can be reverted.", "url": "https://github.com/elastic/elasticsearch/pull/64966#discussion_r523855027", "createdAt": "2020-11-16T01:45:34Z", "author": {"login": "ywangd"}, "path": "x-pack/qa/oidc-op-tests/src/test/java/org/elasticsearch/xpack/security/authc/oidc/OpenIdConnectAuthIT.java", "diffHunk": "@@ -517,11 +518,13 @@ private RestClient getClient() throws Exception {\n         private URI authUri;\n         private String state;\n         private String nonce;\n+        private String realm;\n \n-        PrepareAuthResponse(URI authUri, String state, String nonce, @Nullable String realm) {\n+        PrepareAuthResponse(URI authUri, String state, String nonce, String realm) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8bacf63d735945446e854e9effb9de8817ac293b"}, "originalPosition": 15}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2966, "cost": 1, "resetAt": "2021-11-12T13:16:51Z"}}}