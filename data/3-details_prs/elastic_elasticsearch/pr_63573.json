{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTAxNzMwNTk1", "number": 63573, "title": "EQL: make allow_no_indices true by default", "bodyText": "allow_no_indices is now true by default and, as before, can be set in the _eql request as a parameter. Irrespective of allow_no_indices value, throw verification_exception when there is no index validated from the provided patterns. If allow_no_indices is false and there is a pattern that results in a no index being returned, the Elasticsearch's mapping_exception is thrown.\nFixes #62986.", "createdAt": "2020-10-12T18:09:46Z", "url": "https://github.com/elastic/elasticsearch/pull/63573", "merged": true, "mergeCommit": {"oid": "5ec70e52200aab15967cc75ac5d8becdfb86b7d9"}, "closed": true, "closedAt": "2020-10-12T20:02:36Z", "author": {"login": "astefan"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdR3uLfAH2gAyNTAxNzMwNTk1OjE5OGYxZjUyODI5MGFkY2QxNTVjOGVjYzI1ODA0ZmZkMGYwYjUyYzg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdR4zaJgH2gAyNTAxNzMwNTk1OmVjOTNkYzQwZDE4Yjk3ZGE0NzZlYjFjM2Q3MzRiYTk2Y2QzZTZkYjI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "198f1f528290adcd155c8ecc25804ffd0f0b52c8", "author": {"user": {"login": "astefan", "name": "Andrei Stefan"}}, "url": "https://github.com/elastic/elasticsearch/commit/198f1f528290adcd155c8ecc25804ffd0f0b52c8", "committedDate": "2020-10-12T17:49:10Z", "message": "Allow all indices options variants\nIrrespective of allow_no_indices value, throw VerificationException when\nthere is no index validated"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "af85c63a1b8d2466cdfb1484891b124400be6586", "author": {"user": {"login": "astefan", "name": "Andrei Stefan"}}, "url": "https://github.com/elastic/elasticsearch/commit/af85c63a1b8d2466cdfb1484891b124400be6586", "committedDate": "2020-10-12T17:50:59Z", "message": "Merge branch 'master' of https://github.com/elastic/elasticsearch into 62986_fix"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA2ODM2MDkw", "url": "https://github.com/elastic/elasticsearch/pull/63573#pullrequestreview-506836090", "createdAt": "2020-10-12T18:32:42Z", "commit": {"oid": "af85c63a1b8d2466cdfb1484891b124400be6586"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xMlQxODozMjo0MlrOHgJM_w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xMlQxODozNDowN1rOHgJPcw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzQ2NzI2Mw==", "bodyText": "Use indices.isValid instead to check if the index is valid and if it's not, call toString() on it which returns the message instead of the index name.\nPotentially pass the listener in the method to call onFailure with the failure instead of throwing it.", "url": "https://github.com/elastic/elasticsearch/pull/63573#discussion_r503467263", "createdAt": "2020-10-12T18:32:42Z", "author": {"login": "costin"}, "path": "x-pack/plugin/eql/src/main/java/org/elasticsearch/xpack/eql/analysis/PreAnalyzer.java", "diffHunk": "@@ -6,16 +6,28 @@\n \n package org.elasticsearch.xpack.eql.analysis;\n \n+import org.elasticsearch.xpack.ql.common.Failure;\n+import org.elasticsearch.xpack.ql.index.EsIndex;\n import org.elasticsearch.xpack.ql.index.IndexResolution;\n+import org.elasticsearch.xpack.ql.index.MappingException;\n import org.elasticsearch.xpack.ql.plan.logical.EsRelation;\n import org.elasticsearch.xpack.ql.plan.logical.LogicalPlan;\n import org.elasticsearch.xpack.ql.plan.logical.UnresolvedRelation;\n \n+import java.util.Collections;\n+\n public class PreAnalyzer {\n \n     public LogicalPlan preAnalyze(LogicalPlan plan, IndexResolution indices) {\n+        EsIndex esIndex = null;\n+        // wrap a potential index_not_found_exception with a VerificationException (expected by client)\n+        try {\n+            esIndex = indices.get();\n+        } catch (MappingException me) {\n+            throw new VerificationException(Collections.singletonList(Failure.fail(plan, me.getMessage())));\n+        }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "af85c63a1b8d2466cdfb1484891b124400be6586"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzQ2Nzg5MQ==", "bodyText": "\ud83d\udc4d", "url": "https://github.com/elastic/elasticsearch/pull/63573#discussion_r503467891", "createdAt": "2020-10-12T18:34:07Z", "author": {"login": "costin"}, "path": "x-pack/plugin/eql/src/main/java/org/elasticsearch/xpack/eql/session/EqlSession.java", "diffHunk": "@@ -100,7 +100,7 @@ public void analyzedPlan(LogicalPlan parsed, ActionListener<LogicalPlan> listene\n             listener.onFailure(new TaskCancelledException(\"cancelled\"));\n             return;\n         }\n-        indexResolver.resolveAsMergedMapping(indexWildcard, null, configuration.includeFrozen(), configuration.filter(),\n+        indexResolver.resolveAsMergedMapping(indexWildcard, null, configuration.indicesOptions(), configuration.filter(),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "af85c63a1b8d2466cdfb1484891b124400be6586"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ec93dc40d18b97da476eb1c3d734ba96cd3e6db2", "author": {"user": {"login": "astefan", "name": "Andrei Stefan"}}, "url": "https://github.com/elastic/elasticsearch/commit/ec93dc40d18b97da476eb1c3d734ba96cd3e6db2", "committedDate": "2020-10-12T19:04:47Z", "message": "Update PreAnalyzer"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4068, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}