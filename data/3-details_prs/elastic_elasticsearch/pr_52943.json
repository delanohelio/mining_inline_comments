{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzgxMzI4NTE5", "number": 52943, "title": "Improve closing mock webserver when failed to start", "bodyText": "Fix NPE when closing a mock webserver that hasn't started correctly.\nThis occurred with many watcher tests that use the mock webserver\nThis can happen when ssl context isn't initialized. The server instance is then never set,\nwhich causes an NPE that masks the actual failure.\nExample stacktrace that would mask an actual failure:\njava.lang.NullPointerException\n\tat org.elasticsearch.test.http.MockWebServer.close(MockWebServer.java:271)\n\tat org.elasticsearch.xpack.watcher.test.integration.HttpSecretsIntegrationTests.cleanup(HttpSecretsIntegrationTests.java:70)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n\tat java.lang.reflect.Method.invoke(Method.java:498)", "createdAt": "2020-02-28T10:55:29Z", "url": "https://github.com/elastic/elasticsearch/pull/52943", "merged": true, "mergeCommit": {"oid": "461f02ae52581a13dffb69375d78bca16a89271e"}, "closed": true, "closedAt": "2020-03-02T06:16:34Z", "author": {"login": "martijnvg"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcItuI4AH2gAyMzgxMzI4NTE5OmZhYjgwZmFmNWQ5MDZjZjYzMDIwZDUwNjFkZWIyYmQzNmY4Yzg3NWE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcIxXhZgFqTM2NjQ2NTAxOA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "fab80faf5d906cf63020d5061deb2bd36f8c875a", "author": {"user": {"login": "martijnvg", "name": "Martijn van Groningen"}}, "url": "https://github.com/elastic/elasticsearch/commit/fab80faf5d906cf63020d5061deb2bd36f8c875a", "committedDate": "2020-02-28T10:53:36Z", "message": "Improve closing mock webserver when failed to start\n\nFix NPE when closing a webserver that hasn't started correctly.\n\nThis can happen when ssl context isn't initialized. The server instance is then never set,\nwhich causes an NPE that masks the actual failure.\n\nExample stacktrace that would mask an actual failure:\n\n```\njava.lang.NullPointerException\n\tat org.elasticsearch.test.http.MockWebServer.close(MockWebServer.java:271)\n\tat org.elasticsearch.xpack.watcher.test.integration.HttpSecretsIntegrationTests.cleanup(HttpSecretsIntegrationTests.java:70)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n\tat java.lang.reflect.Method.invoke(Method.java:498)\n```"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY2MzE0NDgx", "url": "https://github.com/elastic/elasticsearch/pull/52943#pullrequestreview-366314481", "createdAt": "2020-02-28T10:56:24Z", "commit": {"oid": "fab80faf5d906cf63020d5061deb2bd36f8c875a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yOFQxMDo1NjoyNFrOFvxG2Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yOFQxMDo1NjoyNFrOFvxG2Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTYzMTk2MQ==", "bodyText": "Fix for slightly different NPE:\njava.lang.NullPointerException\n\tat org.elasticsearch.xpack.watcher.actions.webhook.WebhookHttpsIntegrationTests.stopWebservice(WebhookHttpsIntegrationTests.java:75)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n\tat java.lang.reflect.Method.invoke(Method.java:498)", "url": "https://github.com/elastic/elasticsearch/pull/52943#discussion_r385631961", "createdAt": "2020-02-28T10:56:24Z", "author": {"login": "martijnvg"}, "path": "x-pack/plugin/watcher/src/test/java/org/elasticsearch/xpack/watcher/actions/webhook/WebhookHttpsIntegrationTests.java", "diffHunk": "@@ -72,7 +72,9 @@ public void startWebservice() throws Exception {\n \n     @After\n     public void stopWebservice() throws Exception {\n-        webServer.close();\n+        if (webServer != null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fab80faf5d906cf63020d5061deb2bd36f8c875a"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7fcf0a12db34e1edf15dd3e3730a7d31f4d27500", "author": {"user": {"login": "martijnvg", "name": "Martijn van Groningen"}}, "url": "https://github.com/elastic/elasticsearch/commit/7fcf0a12db34e1edf15dd3e3730a7d31f4d27500", "committedDate": "2020-02-28T12:21:42Z", "message": "Merge remote-tracking branch 'es/master' into fix_npe_closing_mock_webserver"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY2NDY1MDE4", "url": "https://github.com/elastic/elasticsearch/pull/52943#pullrequestreview-366465018", "createdAt": "2020-02-28T15:08:31Z", "commit": {"oid": "7fcf0a12db34e1edf15dd3e3730a7d31f4d27500"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2081, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}