{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY5MTExMDU3", "number": 51682, "title": "Add IDP Configuration settings and related tests", "bodyText": "", "createdAt": "2020-01-30T14:40:52Z", "url": "https://github.com/elastic/elasticsearch/pull/51682", "merged": true, "mergeCommit": {"oid": "207dce8092a107c26c61a2426e1cc8d1d10bda4f"}, "closed": true, "closedAt": "2020-02-03T11:12:25Z", "author": {"login": "jkakavas"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb_bg14AH2gAyMzY5MTExMDU3OjU3ZDJkNzZmM2Q4NjQxNzhmZDJkNmYzYmY1ZjdmMTEzMWNmMTkxNTU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcAp6nkgH2gAyMzY5MTExMDU3OjAwY2FhODVhMGUzZjY1OTE1OTY2M2FmZDhjOTAxOWE0NDFhZWU4MDU=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "57d2d76f3d864178fd2d6f3bf5f7f1131cf19155", "author": {"user": {"login": "jkakavas", "name": "Ioannis Kakavas"}}, "url": "https://github.com/elastic/elasticsearch/commit/57d2d76f3d864178fd2d6f3bf5f7f1131cf19155", "committedDate": "2020-01-30T14:35:28Z", "message": "Add IDP Configuration settings and related tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fcb2e8c28112e00dae8cb5a29d919a2772ba17ab", "author": {"user": {"login": "jkakavas", "name": "Ioannis Kakavas"}}, "url": "https://github.com/elastic/elasticsearch/commit/fcb2e8c28112e00dae8cb5a29d919a2772ba17ab", "committedDate": "2020-01-30T14:40:33Z", "message": "license and missing conf"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "db7cb6719c4d60050183e5fc3ab0446228e837cf", "author": {"user": {"login": "jkakavas", "name": "Ioannis Kakavas"}}, "url": "https://github.com/elastic/elasticsearch/commit/db7cb6719c4d60050183e5fc3ab0446228e837cf", "committedDate": "2020-01-30T14:51:40Z", "message": "Add scope to settings"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUxMjE5NjAy", "url": "https://github.com/elastic/elasticsearch/pull/51682#pullrequestreview-351219602", "createdAt": "2020-01-30T23:49:40Z", "commit": {"oid": "db7cb6719c4d60050183e5fc3ab0446228e837cf"}, "state": "COMMENTED", "comments": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0zMFQyMzo0OTo0MVrOFj9qXQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0zMVQwMDoyMjozOFrOFj-LkQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzI1NDc0OQ==", "bodyText": "Should we make these Setting<URI> instead?", "url": "https://github.com/elastic/elasticsearch/pull/51682#discussion_r373254749", "createdAt": "2020-01-30T23:49:41Z", "author": {"login": "tvernum"}, "path": "x-pack/plugin/identity-provider/src/main/java/org/elasticsearch/xpack/idp/IdentityProviderPlugin.java", "diffHunk": "@@ -31,22 +38,72 @@\n  */\n public class IdentityProviderPlugin extends Plugin implements ActionPlugin {\n \n-    private final Setting<Boolean> ENABLED_SETTING = Setting.boolSetting(\"xpack.idp.enabled\", false, Setting.Property.NodeScope);\n+    private static final Setting<Boolean> ENABLED_SETTING = Setting.boolSetting(\"xpack.idp.enabled\", false, Setting.Property.NodeScope);\n+    public static final Setting<String> IDP_ENTITY_ID = Setting.simpleString(\"xpack.idp.entity_id\", Setting.Property.NodeScope);\n+    public static final Setting<String> IDP_SSO_REDIRECT_ENDPOINT = Setting.simpleString(\"xpack.idp.sso_endpoint.redirect\", value -> {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "db7cb6719c4d60050183e5fc3ab0446228e837cf"}, "originalPosition": 31}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzI1Njc0NA==", "bodyText": "The previous implementation is actually correct.\nPlugins should do as little as possible in the constructor, and everything that can be, should be handled in createComponents\nSee: #49667\nThe main issue is that a plugin is permitted to override the node's settings. But due to the plugin lifecycle, that has to happen after the plugin is constructed, which means after all plugins are constructed.\nSo the Settings object here is only a subset of the settings that the node might actually run with.", "url": "https://github.com/elastic/elasticsearch/pull/51682#discussion_r373256744", "createdAt": "2020-01-30T23:57:05Z", "author": {"login": "tvernum"}, "path": "x-pack/plugin/identity-provider/src/main/java/org/elasticsearch/xpack/idp/IdentityProviderPlugin.java", "diffHunk": "@@ -31,22 +38,72 @@\n  */\n public class IdentityProviderPlugin extends Plugin implements ActionPlugin {\n \n-    private final Setting<Boolean> ENABLED_SETTING = Setting.boolSetting(\"xpack.idp.enabled\", false, Setting.Property.NodeScope);\n+    private static final Setting<Boolean> ENABLED_SETTING = Setting.boolSetting(\"xpack.idp.enabled\", false, Setting.Property.NodeScope);\n+    public static final Setting<String> IDP_ENTITY_ID = Setting.simpleString(\"xpack.idp.entity_id\", Setting.Property.NodeScope);\n+    public static final Setting<String> IDP_SSO_REDIRECT_ENDPOINT = Setting.simpleString(\"xpack.idp.sso_endpoint.redirect\", value -> {\n+        try {\n+            new URI(value);\n+        } catch (URISyntaxException e) {\n+            throw new IllegalArgumentException(\"Invalid value [\" + value + \"] for  [xpack.idp.sso_endpoint.redirect]. Not a valid URI\", e);\n+        }\n+    }, Setting.Property.NodeScope);\n+    public static final Setting<String> IDP_SSO_POST_ENDPOINT = Setting.simpleString(\"xpack.idp.sso_endpoint.post\", value -> {\n+        try {\n+            new URI(value);\n+        } catch (URISyntaxException e) {\n+            throw new IllegalArgumentException(\"Invalid value [\" + value + \"] for  [xpack.idp.sso_endpoint.post]. Not a valid URI\", e);\n+        }\n+    }, Setting.Property.NodeScope);\n+    public static final Setting<String> IDP_SLO_REDIRECT_ENDPOINT = Setting.simpleString(\"xpack.idp.slo_endpoint.redirect\", value -> {\n+        try {\n+            new URI(value);\n+        } catch (URISyntaxException e) {\n+            throw new IllegalArgumentException(\"Invalid value [\" + value + \"] for  [xpack.idp.slo_endpoint.redirect]. Not a valid URI\", e);\n+        }\n+    }, Setting.Property.NodeScope);\n+    public static final Setting<String> IDP_SLO_POST_ENDPOINT = Setting.simpleString(\"xpack.idp.slo_endpoint.post\", value -> {\n+        try {\n+            new URI(value);\n+        } catch (URISyntaxException e) {\n+            throw new IllegalArgumentException(\"Invalid value [\" + value + \"] for  [xpack.idp.slo_endpoint.post]. Not a valid URI\", e);\n+        }\n+    }, Setting.Property.NodeScope);\n+    public static final Setting<String> IDP_SIGNING_KEY_ALIAS = Setting.simpleString(\"xpack.idp.signing.keystore.alias\",\n+        Setting.Property.NodeScope);\n \n     private final Logger logger = LogManager.getLogger();\n     private boolean enabled;\n+    private final Settings settings;\n+\n+    public IdentityProviderPlugin(Settings settings) {\n+        this.settings = settings;\n+        this.enabled = ENABLED_SETTING.get(settings);\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "db7cb6719c4d60050183e5fc3ab0446228e837cf"}, "originalPosition": 69}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzI1OTc1OA==", "bodyText": "I don't understand why we have 1 put and 3 computeIfAbsent\nI think you'd get the same bevahiour with 4 put wouldn't you? None of the keys are going to be present.", "url": "https://github.com/elastic/elasticsearch/pull/51682#discussion_r373259758", "createdAt": "2020-01-31T00:08:48Z", "author": {"login": "tvernum"}, "path": "x-pack/plugin/identity-provider/src/main/java/org/elasticsearch/xpack/idp/saml/idp/CloudIdp.java", "diffHunk": "@@ -0,0 +1,121 @@\n+/*\n+ * Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one\n+ * or more contributor license agreements. Licensed under the Elastic License;\n+ * you may not use this file except in compliance with the Elastic License.\n+ */\n+\n+package org.elasticsearch.xpack.idp.saml.idp;\n+\n+import org.elasticsearch.common.Strings;\n+import org.elasticsearch.common.settings.Setting;\n+import org.elasticsearch.common.settings.Settings;\n+import org.elasticsearch.common.settings.SettingsException;\n+import org.elasticsearch.env.Environment;\n+import org.elasticsearch.xpack.core.ssl.CertParsingUtils;\n+import org.elasticsearch.xpack.core.ssl.X509KeyPairSettings;\n+import org.opensaml.security.x509.X509Credential;\n+import org.opensaml.security.x509.impl.X509KeyManagerX509CredentialAdapter;\n+\n+import javax.net.ssl.X509KeyManager;\n+import java.util.ArrayList;\n+import java.util.Arrays;\n+import java.util.HashMap;\n+import java.util.HashSet;\n+import java.util.Set;\n+\n+import static org.elasticsearch.xpack.idp.IdentityProviderPlugin.IDP_ENTITY_ID;\n+import static org.elasticsearch.xpack.idp.IdentityProviderPlugin.IDP_SIGNING_KEY_ALIAS;\n+import static org.elasticsearch.xpack.idp.IdentityProviderPlugin.IDP_SLO_POST_ENDPOINT;\n+import static org.elasticsearch.xpack.idp.IdentityProviderPlugin.IDP_SLO_REDIRECT_ENDPOINT;\n+import static org.elasticsearch.xpack.idp.IdentityProviderPlugin.IDP_SSO_POST_ENDPOINT;\n+import static org.elasticsearch.xpack.idp.IdentityProviderPlugin.IDP_SSO_REDIRECT_ENDPOINT;\n+\n+public class CloudIdp implements SamlIdentityProvider {\n+\n+    private final String entityId;\n+    private final HashMap<String, String> ssoEndpoints = new HashMap<>();\n+    private final HashMap<String, String> sloEndpoints = new HashMap<>();\n+    private final X509Credential signingCredential;\n+\n+    public CloudIdp(Environment env, Settings settings) {\n+        this.entityId = require(settings, IDP_ENTITY_ID);\n+        this.ssoEndpoints.put(\"redirect\", require(settings, IDP_SSO_REDIRECT_ENDPOINT));\n+        this.ssoEndpoints.computeIfAbsent(\"post\", v -> settings.get(IDP_SSO_POST_ENDPOINT.getKey()));\n+        this.sloEndpoints.computeIfAbsent(\"post\", v -> settings.get(IDP_SLO_POST_ENDPOINT.getKey()));\n+        this.sloEndpoints.computeIfAbsent(\"redirect\", v -> settings.get(IDP_SLO_REDIRECT_ENDPOINT.getKey()));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "db7cb6719c4d60050183e5fc3ab0446228e837cf"}, "originalPosition": 45}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzI2MDQ3Mg==", "bodyText": "Nit: I prefer putting the whole string on a new line rather than splitting it. I find it easier to check that the message has the right spaces, and no duplicate words, etc if I can read it in 1 unit.\n    throw new IllegalArgumentException(\n        \"The configured keystore for xpack.idp.signing.keystore does not contain any RSA or EC key pairs\");", "url": "https://github.com/elastic/elasticsearch/pull/51682#discussion_r373260472", "createdAt": "2020-01-31T00:11:56Z", "author": {"login": "tvernum"}, "path": "x-pack/plugin/identity-provider/src/main/java/org/elasticsearch/xpack/idp/saml/idp/CloudIdp.java", "diffHunk": "@@ -0,0 +1,121 @@\n+/*\n+ * Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one\n+ * or more contributor license agreements. Licensed under the Elastic License;\n+ * you may not use this file except in compliance with the Elastic License.\n+ */\n+\n+package org.elasticsearch.xpack.idp.saml.idp;\n+\n+import org.elasticsearch.common.Strings;\n+import org.elasticsearch.common.settings.Setting;\n+import org.elasticsearch.common.settings.Settings;\n+import org.elasticsearch.common.settings.SettingsException;\n+import org.elasticsearch.env.Environment;\n+import org.elasticsearch.xpack.core.ssl.CertParsingUtils;\n+import org.elasticsearch.xpack.core.ssl.X509KeyPairSettings;\n+import org.opensaml.security.x509.X509Credential;\n+import org.opensaml.security.x509.impl.X509KeyManagerX509CredentialAdapter;\n+\n+import javax.net.ssl.X509KeyManager;\n+import java.util.ArrayList;\n+import java.util.Arrays;\n+import java.util.HashMap;\n+import java.util.HashSet;\n+import java.util.Set;\n+\n+import static org.elasticsearch.xpack.idp.IdentityProviderPlugin.IDP_ENTITY_ID;\n+import static org.elasticsearch.xpack.idp.IdentityProviderPlugin.IDP_SIGNING_KEY_ALIAS;\n+import static org.elasticsearch.xpack.idp.IdentityProviderPlugin.IDP_SLO_POST_ENDPOINT;\n+import static org.elasticsearch.xpack.idp.IdentityProviderPlugin.IDP_SLO_REDIRECT_ENDPOINT;\n+import static org.elasticsearch.xpack.idp.IdentityProviderPlugin.IDP_SSO_POST_ENDPOINT;\n+import static org.elasticsearch.xpack.idp.IdentityProviderPlugin.IDP_SSO_REDIRECT_ENDPOINT;\n+\n+public class CloudIdp implements SamlIdentityProvider {\n+\n+    private final String entityId;\n+    private final HashMap<String, String> ssoEndpoints = new HashMap<>();\n+    private final HashMap<String, String> sloEndpoints = new HashMap<>();\n+    private final X509Credential signingCredential;\n+\n+    public CloudIdp(Environment env, Settings settings) {\n+        this.entityId = require(settings, IDP_ENTITY_ID);\n+        this.ssoEndpoints.put(\"redirect\", require(settings, IDP_SSO_REDIRECT_ENDPOINT));\n+        this.ssoEndpoints.computeIfAbsent(\"post\", v -> settings.get(IDP_SSO_POST_ENDPOINT.getKey()));\n+        this.sloEndpoints.computeIfAbsent(\"post\", v -> settings.get(IDP_SLO_POST_ENDPOINT.getKey()));\n+        this.sloEndpoints.computeIfAbsent(\"redirect\", v -> settings.get(IDP_SLO_REDIRECT_ENDPOINT.getKey()));\n+        this.signingCredential = buildSigningCredential(env, settings);\n+    }\n+\n+    @Override\n+    public String getEntityId() {\n+        return entityId;\n+    }\n+\n+    @Override\n+    public String getSingleSignOnEndpoint(String binding) {\n+        return ssoEndpoints.get(binding);\n+    }\n+\n+    @Override\n+    public String getSingleLogoutEndpoint(String binding) {\n+        return sloEndpoints.get(binding);\n+    }\n+\n+    @Override\n+    public X509Credential getSigningCredential() {\n+        return signingCredential;\n+    }\n+\n+    private static String require(Settings settings, Setting<String> setting) {\n+        if (settings.hasValue(setting.getKey())) {\n+            return setting.get(settings);\n+        } else {\n+            throw new SettingsException(\"The configuration setting [\" + setting.getKey() + \"] is required\");\n+        }\n+    }\n+\n+    static X509Credential buildSigningCredential(Environment env, Settings settings) {\n+        final X509KeyPairSettings keyPairSettings = X509KeyPairSettings.withPrefix(\"xpack.idp.signing.\", false);\n+        final X509KeyManager keyManager = CertParsingUtils.getKeyManager(keyPairSettings, settings, null, env);\n+        if (keyManager == null) {\n+            return null;\n+        }\n+        final Set<String> aliases = new HashSet<>();\n+        final String configAlias = IDP_SIGNING_KEY_ALIAS.get(settings);\n+        if (Strings.isNullOrEmpty(configAlias)) {\n+            final String[] rsaAliases = keyManager.getServerAliases(\"RSA\", null);\n+            if (null != rsaAliases) {\n+                aliases.addAll(Arrays.asList(rsaAliases));\n+            }\n+            final String[] ecAliases = keyManager.getServerAliases(\"EC\", null);\n+            if (null != ecAliases) {\n+                aliases.addAll(Arrays.asList(ecAliases));\n+            }\n+            if (aliases.isEmpty()) {\n+                throw new IllegalArgumentException(\"The configured keystore for xpack.idp.signing.keystore does not contain any RSA or EC\" +\n+                    \" key pairs\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "db7cb6719c4d60050183e5fc3ab0446228e837cf"}, "originalPosition": 96}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzI2MDYzNw==", "bodyText": "This is an obvious exception since it can't fit on a single line :)", "url": "https://github.com/elastic/elasticsearch/pull/51682#discussion_r373260637", "createdAt": "2020-01-31T00:12:34Z", "author": {"login": "tvernum"}, "path": "x-pack/plugin/identity-provider/src/main/java/org/elasticsearch/xpack/idp/saml/idp/CloudIdp.java", "diffHunk": "@@ -0,0 +1,121 @@\n+/*\n+ * Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one\n+ * or more contributor license agreements. Licensed under the Elastic License;\n+ * you may not use this file except in compliance with the Elastic License.\n+ */\n+\n+package org.elasticsearch.xpack.idp.saml.idp;\n+\n+import org.elasticsearch.common.Strings;\n+import org.elasticsearch.common.settings.Setting;\n+import org.elasticsearch.common.settings.Settings;\n+import org.elasticsearch.common.settings.SettingsException;\n+import org.elasticsearch.env.Environment;\n+import org.elasticsearch.xpack.core.ssl.CertParsingUtils;\n+import org.elasticsearch.xpack.core.ssl.X509KeyPairSettings;\n+import org.opensaml.security.x509.X509Credential;\n+import org.opensaml.security.x509.impl.X509KeyManagerX509CredentialAdapter;\n+\n+import javax.net.ssl.X509KeyManager;\n+import java.util.ArrayList;\n+import java.util.Arrays;\n+import java.util.HashMap;\n+import java.util.HashSet;\n+import java.util.Set;\n+\n+import static org.elasticsearch.xpack.idp.IdentityProviderPlugin.IDP_ENTITY_ID;\n+import static org.elasticsearch.xpack.idp.IdentityProviderPlugin.IDP_SIGNING_KEY_ALIAS;\n+import static org.elasticsearch.xpack.idp.IdentityProviderPlugin.IDP_SLO_POST_ENDPOINT;\n+import static org.elasticsearch.xpack.idp.IdentityProviderPlugin.IDP_SLO_REDIRECT_ENDPOINT;\n+import static org.elasticsearch.xpack.idp.IdentityProviderPlugin.IDP_SSO_POST_ENDPOINT;\n+import static org.elasticsearch.xpack.idp.IdentityProviderPlugin.IDP_SSO_REDIRECT_ENDPOINT;\n+\n+public class CloudIdp implements SamlIdentityProvider {\n+\n+    private final String entityId;\n+    private final HashMap<String, String> ssoEndpoints = new HashMap<>();\n+    private final HashMap<String, String> sloEndpoints = new HashMap<>();\n+    private final X509Credential signingCredential;\n+\n+    public CloudIdp(Environment env, Settings settings) {\n+        this.entityId = require(settings, IDP_ENTITY_ID);\n+        this.ssoEndpoints.put(\"redirect\", require(settings, IDP_SSO_REDIRECT_ENDPOINT));\n+        this.ssoEndpoints.computeIfAbsent(\"post\", v -> settings.get(IDP_SSO_POST_ENDPOINT.getKey()));\n+        this.sloEndpoints.computeIfAbsent(\"post\", v -> settings.get(IDP_SLO_POST_ENDPOINT.getKey()));\n+        this.sloEndpoints.computeIfAbsent(\"redirect\", v -> settings.get(IDP_SLO_REDIRECT_ENDPOINT.getKey()));\n+        this.signingCredential = buildSigningCredential(env, settings);\n+    }\n+\n+    @Override\n+    public String getEntityId() {\n+        return entityId;\n+    }\n+\n+    @Override\n+    public String getSingleSignOnEndpoint(String binding) {\n+        return ssoEndpoints.get(binding);\n+    }\n+\n+    @Override\n+    public String getSingleLogoutEndpoint(String binding) {\n+        return sloEndpoints.get(binding);\n+    }\n+\n+    @Override\n+    public X509Credential getSigningCredential() {\n+        return signingCredential;\n+    }\n+\n+    private static String require(Settings settings, Setting<String> setting) {\n+        if (settings.hasValue(setting.getKey())) {\n+            return setting.get(settings);\n+        } else {\n+            throw new SettingsException(\"The configuration setting [\" + setting.getKey() + \"] is required\");\n+        }\n+    }\n+\n+    static X509Credential buildSigningCredential(Environment env, Settings settings) {\n+        final X509KeyPairSettings keyPairSettings = X509KeyPairSettings.withPrefix(\"xpack.idp.signing.\", false);\n+        final X509KeyManager keyManager = CertParsingUtils.getKeyManager(keyPairSettings, settings, null, env);\n+        if (keyManager == null) {\n+            return null;\n+        }\n+        final Set<String> aliases = new HashSet<>();\n+        final String configAlias = IDP_SIGNING_KEY_ALIAS.get(settings);\n+        if (Strings.isNullOrEmpty(configAlias)) {\n+            final String[] rsaAliases = keyManager.getServerAliases(\"RSA\", null);\n+            if (null != rsaAliases) {\n+                aliases.addAll(Arrays.asList(rsaAliases));\n+            }\n+            final String[] ecAliases = keyManager.getServerAliases(\"EC\", null);\n+            if (null != ecAliases) {\n+                aliases.addAll(Arrays.asList(ecAliases));\n+            }\n+            if (aliases.isEmpty()) {\n+                throw new IllegalArgumentException(\"The configured keystore for xpack.idp.signing.keystore does not contain any RSA or EC\" +\n+                    \" key pairs\");\n+            }\n+            if (aliases.size() > 1) {\n+                throw new IllegalArgumentException(\"The configured keystore for xpack.idp.signing.keystore contains multiple key pairs\" +\n+                    \" but no alias has been configured with [\" + IDP_SIGNING_KEY_ALIAS.getKey() + \"]\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "db7cb6719c4d60050183e5fc3ab0446228e837cf"}, "originalPosition": 100}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzI2MDk0Mw==", "bodyText": "My preference is to refer to the Setting object for the key\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                            throw new IllegalArgumentException(\"The configured keystore for xpack.idp.signing.keystore does not contain any RSA or EC\" +\n          \n          \n            \n                            throw new IllegalArgumentException(\"The configured keystore for \" + IDP_SIGNING_KEY_ALIAS.getKey() + \" does not contain any RSA or EC\" +", "url": "https://github.com/elastic/elasticsearch/pull/51682#discussion_r373260943", "createdAt": "2020-01-31T00:13:53Z", "author": {"login": "tvernum"}, "path": "x-pack/plugin/identity-provider/src/main/java/org/elasticsearch/xpack/idp/saml/idp/CloudIdp.java", "diffHunk": "@@ -0,0 +1,121 @@\n+/*\n+ * Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one\n+ * or more contributor license agreements. Licensed under the Elastic License;\n+ * you may not use this file except in compliance with the Elastic License.\n+ */\n+\n+package org.elasticsearch.xpack.idp.saml.idp;\n+\n+import org.elasticsearch.common.Strings;\n+import org.elasticsearch.common.settings.Setting;\n+import org.elasticsearch.common.settings.Settings;\n+import org.elasticsearch.common.settings.SettingsException;\n+import org.elasticsearch.env.Environment;\n+import org.elasticsearch.xpack.core.ssl.CertParsingUtils;\n+import org.elasticsearch.xpack.core.ssl.X509KeyPairSettings;\n+import org.opensaml.security.x509.X509Credential;\n+import org.opensaml.security.x509.impl.X509KeyManagerX509CredentialAdapter;\n+\n+import javax.net.ssl.X509KeyManager;\n+import java.util.ArrayList;\n+import java.util.Arrays;\n+import java.util.HashMap;\n+import java.util.HashSet;\n+import java.util.Set;\n+\n+import static org.elasticsearch.xpack.idp.IdentityProviderPlugin.IDP_ENTITY_ID;\n+import static org.elasticsearch.xpack.idp.IdentityProviderPlugin.IDP_SIGNING_KEY_ALIAS;\n+import static org.elasticsearch.xpack.idp.IdentityProviderPlugin.IDP_SLO_POST_ENDPOINT;\n+import static org.elasticsearch.xpack.idp.IdentityProviderPlugin.IDP_SLO_REDIRECT_ENDPOINT;\n+import static org.elasticsearch.xpack.idp.IdentityProviderPlugin.IDP_SSO_POST_ENDPOINT;\n+import static org.elasticsearch.xpack.idp.IdentityProviderPlugin.IDP_SSO_REDIRECT_ENDPOINT;\n+\n+public class CloudIdp implements SamlIdentityProvider {\n+\n+    private final String entityId;\n+    private final HashMap<String, String> ssoEndpoints = new HashMap<>();\n+    private final HashMap<String, String> sloEndpoints = new HashMap<>();\n+    private final X509Credential signingCredential;\n+\n+    public CloudIdp(Environment env, Settings settings) {\n+        this.entityId = require(settings, IDP_ENTITY_ID);\n+        this.ssoEndpoints.put(\"redirect\", require(settings, IDP_SSO_REDIRECT_ENDPOINT));\n+        this.ssoEndpoints.computeIfAbsent(\"post\", v -> settings.get(IDP_SSO_POST_ENDPOINT.getKey()));\n+        this.sloEndpoints.computeIfAbsent(\"post\", v -> settings.get(IDP_SLO_POST_ENDPOINT.getKey()));\n+        this.sloEndpoints.computeIfAbsent(\"redirect\", v -> settings.get(IDP_SLO_REDIRECT_ENDPOINT.getKey()));\n+        this.signingCredential = buildSigningCredential(env, settings);\n+    }\n+\n+    @Override\n+    public String getEntityId() {\n+        return entityId;\n+    }\n+\n+    @Override\n+    public String getSingleSignOnEndpoint(String binding) {\n+        return ssoEndpoints.get(binding);\n+    }\n+\n+    @Override\n+    public String getSingleLogoutEndpoint(String binding) {\n+        return sloEndpoints.get(binding);\n+    }\n+\n+    @Override\n+    public X509Credential getSigningCredential() {\n+        return signingCredential;\n+    }\n+\n+    private static String require(Settings settings, Setting<String> setting) {\n+        if (settings.hasValue(setting.getKey())) {\n+            return setting.get(settings);\n+        } else {\n+            throw new SettingsException(\"The configuration setting [\" + setting.getKey() + \"] is required\");\n+        }\n+    }\n+\n+    static X509Credential buildSigningCredential(Environment env, Settings settings) {\n+        final X509KeyPairSettings keyPairSettings = X509KeyPairSettings.withPrefix(\"xpack.idp.signing.\", false);\n+        final X509KeyManager keyManager = CertParsingUtils.getKeyManager(keyPairSettings, settings, null, env);\n+        if (keyManager == null) {\n+            return null;\n+        }\n+        final Set<String> aliases = new HashSet<>();\n+        final String configAlias = IDP_SIGNING_KEY_ALIAS.get(settings);\n+        if (Strings.isNullOrEmpty(configAlias)) {\n+            final String[] rsaAliases = keyManager.getServerAliases(\"RSA\", null);\n+            if (null != rsaAliases) {\n+                aliases.addAll(Arrays.asList(rsaAliases));\n+            }\n+            final String[] ecAliases = keyManager.getServerAliases(\"EC\", null);\n+            if (null != ecAliases) {\n+                aliases.addAll(Arrays.asList(ecAliases));\n+            }\n+            if (aliases.isEmpty()) {\n+                throw new IllegalArgumentException(\"The configured keystore for xpack.idp.signing.keystore does not contain any RSA or EC\" +", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "db7cb6719c4d60050183e5fc3ab0446228e837cf"}, "originalPosition": 95}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzI2MTc3MA==", "bodyText": "I wish there was an obviously neater way to get the element from a singleton set...\nConstructing a list just to get at the element makes me feel dirty.\nWe do have Iterables.get(aliases, 0), but maybe we need to implement Iterables.head(aliases) (or Sets.head)", "url": "https://github.com/elastic/elasticsearch/pull/51682#discussion_r373261770", "createdAt": "2020-01-31T00:17:17Z", "author": {"login": "tvernum"}, "path": "x-pack/plugin/identity-provider/src/main/java/org/elasticsearch/xpack/idp/saml/idp/CloudIdp.java", "diffHunk": "@@ -0,0 +1,121 @@\n+/*\n+ * Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one\n+ * or more contributor license agreements. Licensed under the Elastic License;\n+ * you may not use this file except in compliance with the Elastic License.\n+ */\n+\n+package org.elasticsearch.xpack.idp.saml.idp;\n+\n+import org.elasticsearch.common.Strings;\n+import org.elasticsearch.common.settings.Setting;\n+import org.elasticsearch.common.settings.Settings;\n+import org.elasticsearch.common.settings.SettingsException;\n+import org.elasticsearch.env.Environment;\n+import org.elasticsearch.xpack.core.ssl.CertParsingUtils;\n+import org.elasticsearch.xpack.core.ssl.X509KeyPairSettings;\n+import org.opensaml.security.x509.X509Credential;\n+import org.opensaml.security.x509.impl.X509KeyManagerX509CredentialAdapter;\n+\n+import javax.net.ssl.X509KeyManager;\n+import java.util.ArrayList;\n+import java.util.Arrays;\n+import java.util.HashMap;\n+import java.util.HashSet;\n+import java.util.Set;\n+\n+import static org.elasticsearch.xpack.idp.IdentityProviderPlugin.IDP_ENTITY_ID;\n+import static org.elasticsearch.xpack.idp.IdentityProviderPlugin.IDP_SIGNING_KEY_ALIAS;\n+import static org.elasticsearch.xpack.idp.IdentityProviderPlugin.IDP_SLO_POST_ENDPOINT;\n+import static org.elasticsearch.xpack.idp.IdentityProviderPlugin.IDP_SLO_REDIRECT_ENDPOINT;\n+import static org.elasticsearch.xpack.idp.IdentityProviderPlugin.IDP_SSO_POST_ENDPOINT;\n+import static org.elasticsearch.xpack.idp.IdentityProviderPlugin.IDP_SSO_REDIRECT_ENDPOINT;\n+\n+public class CloudIdp implements SamlIdentityProvider {\n+\n+    private final String entityId;\n+    private final HashMap<String, String> ssoEndpoints = new HashMap<>();\n+    private final HashMap<String, String> sloEndpoints = new HashMap<>();\n+    private final X509Credential signingCredential;\n+\n+    public CloudIdp(Environment env, Settings settings) {\n+        this.entityId = require(settings, IDP_ENTITY_ID);\n+        this.ssoEndpoints.put(\"redirect\", require(settings, IDP_SSO_REDIRECT_ENDPOINT));\n+        this.ssoEndpoints.computeIfAbsent(\"post\", v -> settings.get(IDP_SSO_POST_ENDPOINT.getKey()));\n+        this.sloEndpoints.computeIfAbsent(\"post\", v -> settings.get(IDP_SLO_POST_ENDPOINT.getKey()));\n+        this.sloEndpoints.computeIfAbsent(\"redirect\", v -> settings.get(IDP_SLO_REDIRECT_ENDPOINT.getKey()));\n+        this.signingCredential = buildSigningCredential(env, settings);\n+    }\n+\n+    @Override\n+    public String getEntityId() {\n+        return entityId;\n+    }\n+\n+    @Override\n+    public String getSingleSignOnEndpoint(String binding) {\n+        return ssoEndpoints.get(binding);\n+    }\n+\n+    @Override\n+    public String getSingleLogoutEndpoint(String binding) {\n+        return sloEndpoints.get(binding);\n+    }\n+\n+    @Override\n+    public X509Credential getSigningCredential() {\n+        return signingCredential;\n+    }\n+\n+    private static String require(Settings settings, Setting<String> setting) {\n+        if (settings.hasValue(setting.getKey())) {\n+            return setting.get(settings);\n+        } else {\n+            throw new SettingsException(\"The configuration setting [\" + setting.getKey() + \"] is required\");\n+        }\n+    }\n+\n+    static X509Credential buildSigningCredential(Environment env, Settings settings) {\n+        final X509KeyPairSettings keyPairSettings = X509KeyPairSettings.withPrefix(\"xpack.idp.signing.\", false);\n+        final X509KeyManager keyManager = CertParsingUtils.getKeyManager(keyPairSettings, settings, null, env);\n+        if (keyManager == null) {\n+            return null;\n+        }\n+        final Set<String> aliases = new HashSet<>();\n+        final String configAlias = IDP_SIGNING_KEY_ALIAS.get(settings);\n+        if (Strings.isNullOrEmpty(configAlias)) {\n+            final String[] rsaAliases = keyManager.getServerAliases(\"RSA\", null);\n+            if (null != rsaAliases) {\n+                aliases.addAll(Arrays.asList(rsaAliases));\n+            }\n+            final String[] ecAliases = keyManager.getServerAliases(\"EC\", null);\n+            if (null != ecAliases) {\n+                aliases.addAll(Arrays.asList(ecAliases));\n+            }\n+            if (aliases.isEmpty()) {\n+                throw new IllegalArgumentException(\"The configured keystore for xpack.idp.signing.keystore does not contain any RSA or EC\" +\n+                    \" key pairs\");\n+            }\n+            if (aliases.size() > 1) {\n+                throw new IllegalArgumentException(\"The configured keystore for xpack.idp.signing.keystore contains multiple key pairs\" +\n+                    \" but no alias has been configured with [\" + IDP_SIGNING_KEY_ALIAS.getKey() + \"]\");\n+            }\n+        } else {\n+            aliases.add(configAlias);\n+        }\n+        String alias = new ArrayList<>(aliases).get(0);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "db7cb6719c4d60050183e5fc3ab0446228e837cf"}, "originalPosition": 105}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzI2MjU0Mg==", "bodyText": "This seems strange to me.\nCouldn't we\n\ncreate a final String selectedAlias local var where we currently declare aliases\nmove aliases to be contained in the if block.\nchange this line to selectedAlias = configAlias\nmove the \"get element from singleton set\" into the if block.\n?", "url": "https://github.com/elastic/elasticsearch/pull/51682#discussion_r373262542", "createdAt": "2020-01-31T00:20:01Z", "author": {"login": "tvernum"}, "path": "x-pack/plugin/identity-provider/src/main/java/org/elasticsearch/xpack/idp/saml/idp/CloudIdp.java", "diffHunk": "@@ -0,0 +1,121 @@\n+/*\n+ * Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one\n+ * or more contributor license agreements. Licensed under the Elastic License;\n+ * you may not use this file except in compliance with the Elastic License.\n+ */\n+\n+package org.elasticsearch.xpack.idp.saml.idp;\n+\n+import org.elasticsearch.common.Strings;\n+import org.elasticsearch.common.settings.Setting;\n+import org.elasticsearch.common.settings.Settings;\n+import org.elasticsearch.common.settings.SettingsException;\n+import org.elasticsearch.env.Environment;\n+import org.elasticsearch.xpack.core.ssl.CertParsingUtils;\n+import org.elasticsearch.xpack.core.ssl.X509KeyPairSettings;\n+import org.opensaml.security.x509.X509Credential;\n+import org.opensaml.security.x509.impl.X509KeyManagerX509CredentialAdapter;\n+\n+import javax.net.ssl.X509KeyManager;\n+import java.util.ArrayList;\n+import java.util.Arrays;\n+import java.util.HashMap;\n+import java.util.HashSet;\n+import java.util.Set;\n+\n+import static org.elasticsearch.xpack.idp.IdentityProviderPlugin.IDP_ENTITY_ID;\n+import static org.elasticsearch.xpack.idp.IdentityProviderPlugin.IDP_SIGNING_KEY_ALIAS;\n+import static org.elasticsearch.xpack.idp.IdentityProviderPlugin.IDP_SLO_POST_ENDPOINT;\n+import static org.elasticsearch.xpack.idp.IdentityProviderPlugin.IDP_SLO_REDIRECT_ENDPOINT;\n+import static org.elasticsearch.xpack.idp.IdentityProviderPlugin.IDP_SSO_POST_ENDPOINT;\n+import static org.elasticsearch.xpack.idp.IdentityProviderPlugin.IDP_SSO_REDIRECT_ENDPOINT;\n+\n+public class CloudIdp implements SamlIdentityProvider {\n+\n+    private final String entityId;\n+    private final HashMap<String, String> ssoEndpoints = new HashMap<>();\n+    private final HashMap<String, String> sloEndpoints = new HashMap<>();\n+    private final X509Credential signingCredential;\n+\n+    public CloudIdp(Environment env, Settings settings) {\n+        this.entityId = require(settings, IDP_ENTITY_ID);\n+        this.ssoEndpoints.put(\"redirect\", require(settings, IDP_SSO_REDIRECT_ENDPOINT));\n+        this.ssoEndpoints.computeIfAbsent(\"post\", v -> settings.get(IDP_SSO_POST_ENDPOINT.getKey()));\n+        this.sloEndpoints.computeIfAbsent(\"post\", v -> settings.get(IDP_SLO_POST_ENDPOINT.getKey()));\n+        this.sloEndpoints.computeIfAbsent(\"redirect\", v -> settings.get(IDP_SLO_REDIRECT_ENDPOINT.getKey()));\n+        this.signingCredential = buildSigningCredential(env, settings);\n+    }\n+\n+    @Override\n+    public String getEntityId() {\n+        return entityId;\n+    }\n+\n+    @Override\n+    public String getSingleSignOnEndpoint(String binding) {\n+        return ssoEndpoints.get(binding);\n+    }\n+\n+    @Override\n+    public String getSingleLogoutEndpoint(String binding) {\n+        return sloEndpoints.get(binding);\n+    }\n+\n+    @Override\n+    public X509Credential getSigningCredential() {\n+        return signingCredential;\n+    }\n+\n+    private static String require(Settings settings, Setting<String> setting) {\n+        if (settings.hasValue(setting.getKey())) {\n+            return setting.get(settings);\n+        } else {\n+            throw new SettingsException(\"The configuration setting [\" + setting.getKey() + \"] is required\");\n+        }\n+    }\n+\n+    static X509Credential buildSigningCredential(Environment env, Settings settings) {\n+        final X509KeyPairSettings keyPairSettings = X509KeyPairSettings.withPrefix(\"xpack.idp.signing.\", false);\n+        final X509KeyManager keyManager = CertParsingUtils.getKeyManager(keyPairSettings, settings, null, env);\n+        if (keyManager == null) {\n+            return null;\n+        }\n+        final Set<String> aliases = new HashSet<>();\n+        final String configAlias = IDP_SIGNING_KEY_ALIAS.get(settings);\n+        if (Strings.isNullOrEmpty(configAlias)) {\n+            final String[] rsaAliases = keyManager.getServerAliases(\"RSA\", null);\n+            if (null != rsaAliases) {\n+                aliases.addAll(Arrays.asList(rsaAliases));\n+            }\n+            final String[] ecAliases = keyManager.getServerAliases(\"EC\", null);\n+            if (null != ecAliases) {\n+                aliases.addAll(Arrays.asList(ecAliases));\n+            }\n+            if (aliases.isEmpty()) {\n+                throw new IllegalArgumentException(\"The configured keystore for xpack.idp.signing.keystore does not contain any RSA or EC\" +\n+                    \" key pairs\");\n+            }\n+            if (aliases.size() > 1) {\n+                throw new IllegalArgumentException(\"The configured keystore for xpack.idp.signing.keystore contains multiple key pairs\" +\n+                    \" but no alias has been configured with [\" + IDP_SIGNING_KEY_ALIAS.getKey() + \"]\");\n+            }\n+        } else {\n+            aliases.add(configAlias);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "db7cb6719c4d60050183e5fc3ab0446228e837cf"}, "originalPosition": 103}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzI2MjcyMw==", "bodyText": "Minor: Can we extract keyManager.getPrivateKey(alias) into a local since we call it twice?", "url": "https://github.com/elastic/elasticsearch/pull/51682#discussion_r373262723", "createdAt": "2020-01-31T00:20:45Z", "author": {"login": "tvernum"}, "path": "x-pack/plugin/identity-provider/src/main/java/org/elasticsearch/xpack/idp/saml/idp/CloudIdp.java", "diffHunk": "@@ -0,0 +1,121 @@\n+/*\n+ * Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one\n+ * or more contributor license agreements. Licensed under the Elastic License;\n+ * you may not use this file except in compliance with the Elastic License.\n+ */\n+\n+package org.elasticsearch.xpack.idp.saml.idp;\n+\n+import org.elasticsearch.common.Strings;\n+import org.elasticsearch.common.settings.Setting;\n+import org.elasticsearch.common.settings.Settings;\n+import org.elasticsearch.common.settings.SettingsException;\n+import org.elasticsearch.env.Environment;\n+import org.elasticsearch.xpack.core.ssl.CertParsingUtils;\n+import org.elasticsearch.xpack.core.ssl.X509KeyPairSettings;\n+import org.opensaml.security.x509.X509Credential;\n+import org.opensaml.security.x509.impl.X509KeyManagerX509CredentialAdapter;\n+\n+import javax.net.ssl.X509KeyManager;\n+import java.util.ArrayList;\n+import java.util.Arrays;\n+import java.util.HashMap;\n+import java.util.HashSet;\n+import java.util.Set;\n+\n+import static org.elasticsearch.xpack.idp.IdentityProviderPlugin.IDP_ENTITY_ID;\n+import static org.elasticsearch.xpack.idp.IdentityProviderPlugin.IDP_SIGNING_KEY_ALIAS;\n+import static org.elasticsearch.xpack.idp.IdentityProviderPlugin.IDP_SLO_POST_ENDPOINT;\n+import static org.elasticsearch.xpack.idp.IdentityProviderPlugin.IDP_SLO_REDIRECT_ENDPOINT;\n+import static org.elasticsearch.xpack.idp.IdentityProviderPlugin.IDP_SSO_POST_ENDPOINT;\n+import static org.elasticsearch.xpack.idp.IdentityProviderPlugin.IDP_SSO_REDIRECT_ENDPOINT;\n+\n+public class CloudIdp implements SamlIdentityProvider {\n+\n+    private final String entityId;\n+    private final HashMap<String, String> ssoEndpoints = new HashMap<>();\n+    private final HashMap<String, String> sloEndpoints = new HashMap<>();\n+    private final X509Credential signingCredential;\n+\n+    public CloudIdp(Environment env, Settings settings) {\n+        this.entityId = require(settings, IDP_ENTITY_ID);\n+        this.ssoEndpoints.put(\"redirect\", require(settings, IDP_SSO_REDIRECT_ENDPOINT));\n+        this.ssoEndpoints.computeIfAbsent(\"post\", v -> settings.get(IDP_SSO_POST_ENDPOINT.getKey()));\n+        this.sloEndpoints.computeIfAbsent(\"post\", v -> settings.get(IDP_SLO_POST_ENDPOINT.getKey()));\n+        this.sloEndpoints.computeIfAbsent(\"redirect\", v -> settings.get(IDP_SLO_REDIRECT_ENDPOINT.getKey()));\n+        this.signingCredential = buildSigningCredential(env, settings);\n+    }\n+\n+    @Override\n+    public String getEntityId() {\n+        return entityId;\n+    }\n+\n+    @Override\n+    public String getSingleSignOnEndpoint(String binding) {\n+        return ssoEndpoints.get(binding);\n+    }\n+\n+    @Override\n+    public String getSingleLogoutEndpoint(String binding) {\n+        return sloEndpoints.get(binding);\n+    }\n+\n+    @Override\n+    public X509Credential getSigningCredential() {\n+        return signingCredential;\n+    }\n+\n+    private static String require(Settings settings, Setting<String> setting) {\n+        if (settings.hasValue(setting.getKey())) {\n+            return setting.get(settings);\n+        } else {\n+            throw new SettingsException(\"The configuration setting [\" + setting.getKey() + \"] is required\");\n+        }\n+    }\n+\n+    static X509Credential buildSigningCredential(Environment env, Settings settings) {\n+        final X509KeyPairSettings keyPairSettings = X509KeyPairSettings.withPrefix(\"xpack.idp.signing.\", false);\n+        final X509KeyManager keyManager = CertParsingUtils.getKeyManager(keyPairSettings, settings, null, env);\n+        if (keyManager == null) {\n+            return null;\n+        }\n+        final Set<String> aliases = new HashSet<>();\n+        final String configAlias = IDP_SIGNING_KEY_ALIAS.get(settings);\n+        if (Strings.isNullOrEmpty(configAlias)) {\n+            final String[] rsaAliases = keyManager.getServerAliases(\"RSA\", null);\n+            if (null != rsaAliases) {\n+                aliases.addAll(Arrays.asList(rsaAliases));\n+            }\n+            final String[] ecAliases = keyManager.getServerAliases(\"EC\", null);\n+            if (null != ecAliases) {\n+                aliases.addAll(Arrays.asList(ecAliases));\n+            }\n+            if (aliases.isEmpty()) {\n+                throw new IllegalArgumentException(\"The configured keystore for xpack.idp.signing.keystore does not contain any RSA or EC\" +\n+                    \" key pairs\");\n+            }\n+            if (aliases.size() > 1) {\n+                throw new IllegalArgumentException(\"The configured keystore for xpack.idp.signing.keystore contains multiple key pairs\" +\n+                    \" but no alias has been configured with [\" + IDP_SIGNING_KEY_ALIAS.getKey() + \"]\");\n+            }\n+        } else {\n+            aliases.add(configAlias);\n+        }\n+        String alias = new ArrayList<>(aliases).get(0);\n+        if (keyManager.getPrivateKey(alias) == null) {\n+            throw new IllegalArgumentException(\"The configured keystore for xpack.idp.signing.keystore does not have a private key\" +\n+                \" associated with alias [\" + alias + \"]\");\n+        }\n+\n+        final String keyType = keyManager.getPrivateKey(alias).getAlgorithm();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "db7cb6719c4d60050183e5fc3ab0446228e837cf"}, "originalPosition": 111}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzI2MzI0OQ==", "bodyText": "Could these return URI instead?\nAlso where do we expect to need these? Is it just for metadata? (which is a real need - I just want to check how we expect to consume them).", "url": "https://github.com/elastic/elasticsearch/pull/51682#discussion_r373263249", "createdAt": "2020-01-31T00:22:38Z", "author": {"login": "tvernum"}, "path": "x-pack/plugin/identity-provider/src/main/java/org/elasticsearch/xpack/idp/saml/idp/SamlIdentityProvider.java", "diffHunk": "@@ -7,10 +7,18 @@\n package org.elasticsearch.xpack.idp.saml.idp;\n \n \n+import org.opensaml.security.x509.X509Credential;\n+\n /**\n  * SAML 2.0 configuration information about this IdP\n  */\n public interface SamlIdentityProvider {\n \n     String getEntityId();\n+\n+    String getSingleSignOnEndpoint(String binding);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "db7cb6719c4d60050183e5fc3ab0446228e837cf"}, "originalPosition": 13}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8ed79cbab0a48778566813e4776750ae6cc5b031", "author": {"user": {"login": "jkakavas", "name": "Ioannis Kakavas"}}, "url": "https://github.com/elastic/elasticsearch/commit/8ed79cbab0a48778566813e4776750ae6cc5b031", "committedDate": "2020-01-31T05:28:14Z", "message": "address feedback"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a4136c7166685413ee1f9032c301310039e41ee4", "author": {"user": {"login": "jkakavas", "name": "Ioannis Kakavas"}}, "url": "https://github.com/elastic/elasticsearch/commit/a4136c7166685413ee1f9032c301310039e41ee4", "committedDate": "2020-01-31T10:01:49Z", "message": "add missing file"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUyMDI2ODM5", "url": "https://github.com/elastic/elasticsearch/pull/51682#pullrequestreview-352026839", "createdAt": "2020-02-03T05:29:10Z", "commit": {"oid": "a4136c7166685413ee1f9032c301310039e41ee4"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5252c8bd7e4462999cc4fe82589c8fbb7aa7c730", "author": {"user": {"login": "jkakavas", "name": "Ioannis Kakavas"}}, "url": "https://github.com/elastic/elasticsearch/commit/5252c8bd7e4462999cc4fe82589c8fbb7aa7c730", "committedDate": "2020-02-03T09:06:54Z", "message": "address feedback"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "00caa85a0e3f659159663afd8c9019a441aee805", "author": {"user": {"login": "jkakavas", "name": "Ioannis Kakavas"}}, "url": "https://github.com/elastic/elasticsearch/commit/00caa85a0e3f659159663afd8c9019a441aee805", "committedDate": "2020-02-03T09:56:13Z", "message": "Merge branch 'feature-internal-idp' into idp-configuration"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3100, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}