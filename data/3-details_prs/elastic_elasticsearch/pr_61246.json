{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY5MjAwMDA5", "number": 61246, "title": "Add DEBUG logging for undefined role mapping field", "bodyText": "A role mapping with the following content:\n\"rules\": { \"field\": { \"userid\" : \"admin\" } }\n\nwill never match because userid is not a valid field. The correct\nfield is username.\nThis change adds DEBUG logging when an undefined field is referenced.\nThe choice to use DEBUG rather than INFO/WARN is that the set of\nfields is partially dynamic (e.g. the metadata.* fields), so\nit may be perfectly reasonable to check a field that is not defined\nfor that user. For example this rule:\n\"rules\": { \"field\": { \"metadata.ranking\" : \"A\" } }\n\nwould generate a log message for an unranked user, which would\nerroneously suggest that such a rule is an error.\nThis DEBUG logging will assist in diagnosing problems, without\nintroducing that confusion.\nResolves: #48562", "createdAt": "2020-08-18T04:54:42Z", "url": "https://github.com/elastic/elasticsearch/pull/61246", "merged": true, "mergeCommit": {"oid": "836577d82bbd150adf7bf662b897fae00b5971da"}, "closed": true, "closedAt": "2020-08-21T06:08:11Z", "author": {"login": "tvernum"}, "timelineItems": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc__LoVAH2gAyNDY5MjAwMDA5OjM5NzRlMDhkYmFlYmMzZjVkZGQ4YTJmN2JiM2M4ZTVjYjUxMTU2NjQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdAW_rZAFqTQ3MDE3NDI1Nw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "3974e08dbaebc3f5ddd8a2f7bb3c8e5cb5115664", "author": {"user": {"login": "tvernum", "name": "Tim Vernum"}}, "url": "https://github.com/elastic/elasticsearch/commit/3974e08dbaebc3f5ddd8a2f7bb3c8e5cb5115664", "committedDate": "2020-08-18T04:20:02Z", "message": "Add DEBUG logging for undefined role mapping field\n\nA role mapping with the following content:\n\n    \"rules\": { \"field\": { \"userid\" : \"admin\" } }\n\nwill never match because `userid` is not a valid field. The correct\nfield is `username`.\n\nThis change adds DEBUG logging when an undefined field is referenced.\n\nThe choice to use DEBUG rather than INFO/WARN is that the set of\nfields is partially dynamic (e.g. the `metadata.*` fields), so\nit may be perfectly reasonable to check a field that is not defined\nfor that user. For example this rule:\n\n    \"rules\": { \"field\": { \"metadata.ranking\" : \"A\" } }\n\nwould generate a log message for an unranked user, which would\nerroneously suggest that such a rule is an error.\nThis DEBUG logging will assist in diagnosing problems, without\nintroducing that confusion."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDcwMTc0MjU3", "url": "https://github.com/elastic/elasticsearch/pull/61246#pullrequestreview-470174257", "createdAt": "2020-08-19T06:58:53Z", "commit": {"oid": "3974e08dbaebc3f5ddd8a2f7bb3c8e5cb5115664"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOVQwNjo1ODo1M1rOHC4KYQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOVQwNjo1ODo1M1rOHC4KYQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3Mjc3OTM2MQ==", "bodyText": "This string format will not be very useful if the value is an array. But I think it can only be primitive values as guaranteed by ExpressionParser#parseFieldValue?", "url": "https://github.com/elastic/elasticsearch/pull/61246#discussion_r472779361", "createdAt": "2020-08-19T06:58:53Z", "author": {"login": "ywangd"}, "path": "x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/security/authc/support/mapper/expressiondsl/FieldExpression.java", "diffHunk": "@@ -148,6 +148,11 @@ public XContentBuilder toXContent(XContentBuilder builder, Params params) throws\n             return builder.value(value);\n         }\n \n+        @Override\n+        public String toString() {\n+            return Objects.toString(value);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3974e08dbaebc3f5ddd8a2f7bb3c8e5cb5115664"}, "originalPosition": 6}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4896, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}