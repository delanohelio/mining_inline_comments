{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM1NjE2OTEy", "number": 58217, "title": "Display enterprise license as platinum in /_xpack", "bodyText": "The GET /_license endpoint displays \"enterprise\" licenses as\n\"platinum\" by default so that old clients (including beats, kibana and\nlogstash) know to interpret this new license type as if it were a\nplatinum license.\nHowever, this compatibility layer was not applied to the GET /_xpack/\nendpoint which also displays a license type & mode.\nThis commit causes the _xpack API to mimic the _license API and treat\nenterprise as platinum by default, with a new accept_enterprise\nparameter that will cause the API to return the correct \"enterprise\"\nvalue.\nThis BWC layer exists only for the 7.x branch.\nThis is bug fix is marked as a breaking change because, since 7.6,\nthe _xpack API has (incorrectly) returned \"enterprise\" for enterprise\nlicenses, and it is possible that some clients rely on this incorrect\nbehaviour.", "createdAt": "2020-06-17T05:44:38Z", "url": "https://github.com/elastic/elasticsearch/pull/58217", "merged": true, "mergeCommit": {"oid": "dcc5a06decca4cc60bb7c69bb9902eedb7e26316"}, "closed": true, "closedAt": "2020-06-30T06:42:29Z", "author": {"login": "tvernum"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcsDGxsAH2gAyNDM1NjE2OTEyOmRlNDYyNTY3ODJjNWM1YTEwNTMzZDNlYTlmM2FjMjBjMWI1ZDc3ZTc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcv7UVeAH2gAyNDM1NjE2OTEyOmVkOGQ1MjMwNjMwOTkxOGI5ZGJmM2EzYjZiNWVkM2IxZGI1ZmU0MDk=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "de46256782c5c5a10533d3ea9f3ac20c1b5d77e7", "author": {"user": {"login": "tvernum", "name": "Tim Vernum"}}, "url": "https://github.com/elastic/elasticsearch/commit/de46256782c5c5a10533d3ea9f3ac20c1b5d77e7", "committedDate": "2020-06-17T05:35:52Z", "message": "Display enterprise license as platinum in /_xpack\n\nThe GET /_license endpoint displays \"enterprise\" licenses as\n\"platinum\" by default so that old clients (including beats, kibana and\nlogstash) know to interpret this new license type as if it were a\nplatinum license.\n\nHowever, this compatibility layer was not applied to the GET /_xpack/\nendpoint which also displays a license type & mode.\n\nThis commit causes the _xpack API to mimic the _license API and treat\nenterprise as platinum by default, with a new accept_enterprise\nparameter that will cause the API to return the correct \"enterprise\"\nvalue.\n\nThis BWC layer exists only for the 7.x branch.\nThis is a breaking change because, since 7.6, the _xpack API has\nreturned \"enterprise\" for enterprise liceses, but this has been found\nto break old versions of beats and logstash so needs to be corrected."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a101fed0b9bf9cb8532c87e0cc418ba466e00597", "author": {"user": {"login": "tvernum", "name": "Tim Vernum"}}, "url": "https://github.com/elastic/elasticsearch/commit/a101fed0b9bf9cb8532c87e0cc418ba466e00597", "committedDate": "2020-06-17T06:28:59Z", "message": "Restore lost test"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMyMjQzMjc4", "url": "https://github.com/elastic/elasticsearch/pull/58217#pullrequestreview-432243278", "createdAt": "2020-06-17T09:54:52Z", "commit": {"oid": "a101fed0b9bf9cb8532c87e0cc418ba466e00597"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMyMTEwMzY3", "url": "https://github.com/elastic/elasticsearch/pull/58217#pullrequestreview-432110367", "createdAt": "2020-06-17T06:59:47Z", "commit": {"oid": "a101fed0b9bf9cb8532c87e0cc418ba466e00597"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xN1QwNjo1OTo0N1rOGk4Mgg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xN1QwNjo1OTo0N1rOGk4Mgg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTMyMjYyNg==", "bodyText": "Would it be better to use enums here, e.g. License.LicenseType.ENTERPRISE.getTypeName()? It is rather verbose but safer.", "url": "https://github.com/elastic/elasticsearch/pull/58217#discussion_r441322626", "createdAt": "2020-06-17T06:59:47Z", "author": {"login": "ywangd"}, "path": "x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/action/TransportXPackInfoAction.java", "diffHunk": "@@ -49,8 +49,18 @@ protected void doExecute(Task task, XPackInfoRequest request, ActionListener<XPa\n         if (request.getCategories().contains(XPackInfoRequest.Category.LICENSE)) {\n             License license = licenseService.getLicense();\n             if (license != null) {\n-                licenseInfo = new LicenseInfo(license.uid(), license.type(), license.operationMode().description(),\n-                        license.status(), license.expiryDate());\n+                String type = license.type();\n+                License.OperationMode mode = license.operationMode();\n+                if (request.getLicenseVersion() < License.VERSION_ENTERPRISE) {\n+                    if (\"enterprise\".equals(type)) {\n+                        type = \"platinum\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a101fed0b9bf9cb8532c87e0cc418ba466e00597"}, "originalPosition": 10}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "09da1b0dffbcc841f18e7a16c95de6a7d484ad7f", "author": {"user": {"login": "elasticmachine", "name": "Elastic Machine"}}, "url": "https://github.com/elastic/elasticsearch/commit/09da1b0dffbcc841f18e7a16c95de6a7d484ad7f", "committedDate": "2020-06-29T03:25:15Z", "message": "Merge branch '7.x' into xpack-license-type-enterprise-bwc"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "93f3cb7cb4262f04b841d06132a75bc82d632566", "author": {"user": {"login": "tvernum", "name": "Tim Vernum"}}, "url": "https://github.com/elastic/elasticsearch/commit/93f3cb7cb4262f04b841d06132a75bc82d632566", "committedDate": "2020-06-29T05:07:13Z", "message": "Switch license type to use enum"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ed8d52306309918b9dbf3a3b6b5ed3b1db5fe409", "author": {"user": {"login": "tvernum", "name": "Tim Vernum"}}, "url": "https://github.com/elastic/elasticsearch/commit/ed8d52306309918b9dbf3a3b6b5ed3b1db5fe409", "committedDate": "2020-06-29T06:47:08Z", "message": "Use 7.8.1 constant and skip test during backport"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 568, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}