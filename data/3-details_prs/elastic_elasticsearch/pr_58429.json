{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM4NTM3ODU3", "number": 58429, "title": "SQL: fix handling of escaped chars in JDBC connection string", "bodyText": "This PR fixes an issue emerging when the connection string URI\ncontains escaped characters.\nThe original URI is pre-parsed in order to re-assemble a new URI having\nthe optional elements filled in with defaults. The new URI has been\nusing however the unescaped query and fragment parts. So if these\ncontained any escaped & or = (such as in the password option value),\nthe unescaping would reveal them and make them later interfere with the\noptions parsing.\nThe PR changes that, so that the new URI be built from the unescaped\n\"raw\" parts of the original URI.\nCloses #57927", "createdAt": "2020-06-23T12:28:49Z", "url": "https://github.com/elastic/elasticsearch/pull/58429", "merged": true, "mergeCommit": {"oid": "94eb5a05e79c6e203de548d05b13e00295bd4489"}, "closed": true, "closedAt": "2020-06-26T08:19:45Z", "author": {"login": "bpintea"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcuEXkrAH2gAyNDM4NTM3ODU3Ojk2NTA4ZmU5M2ZkMTBmYzhhZGU2ZjY0N2NmZDU3YjkwNTU4YjM1OTg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcu-sBoAFqTQzODA5NTg1Mw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "96508fe93fd10fc8ade6f647cfd57b90558b3598", "author": {"user": {"login": "bpintea", "name": "Bogdan Pintea"}}, "url": "https://github.com/elastic/elasticsearch/commit/96508fe93fd10fc8ade6f647cfd57b90558b3598", "committedDate": "2020-06-23T12:11:58Z", "message": "Fix: preserve URI query and fragment char escaping\n\nThis commit fixes an issue emerging when the connection string URI\ncontains escaped characters.\n\nThe original URI is pre-parsed in order to re-assemble a new URI having\nthe optional elements filled in with defaults. The new URI has been\nusing however the unescaped query and fragment parts. So if these\ncontained any escaped `&` or `=` (such as in the password option value),\nthe unescaping would reveal them and make them later interfere with the\noptions parsing.\n\nThe commit changes that, so that the new URI be built from the unescaped\n\"raw\" parts of the original URI."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1ff8944c66f2edbaebf8d3bd8513d141f1f7162f", "author": {"user": {"login": "elasticmachine", "name": "Elastic Machine"}}, "url": "https://github.com/elastic/elasticsearch/commit/1ff8944c66f2edbaebf8d3bd8513d141f1f7162f", "committedDate": "2020-06-23T13:42:27Z", "message": "Merge branch 'master' into fix/57927_escaped_chars_in_uri_query"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5ee799532c27d56ff16100d672874fb6641dbe81", "author": {"user": {"login": "elasticmachine", "name": "Elastic Machine"}}, "url": "https://github.com/elastic/elasticsearch/commit/5ee799532c27d56ff16100d672874fb6641dbe81", "committedDate": "2020-06-24T07:36:33Z", "message": "Merge branch 'master' into fix/57927_escaped_chars_in_uri_query"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM2NTQ1OTcw", "url": "https://github.com/elastic/elasticsearch/pull/58429#pullrequestreview-436545970", "createdAt": "2020-06-24T11:08:19Z", "commit": {"oid": "5ee799532c27d56ff16100d672874fb6641dbe81"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM2NTY1MjYw", "url": "https://github.com/elastic/elasticsearch/pull/58429#pullrequestreview-436565260", "createdAt": "2020-06-24T11:39:44Z", "commit": {"oid": "5ee799532c27d56ff16100d672874fb6641dbe81"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNFQxMTozOTo0NFrOGoObDA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNFQxMTozOTo0NFrOGoObDA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDgzMjUyNA==", "bodyText": "minor: I would trim the url and use a local var to avoid trimming it potentially twice.", "url": "https://github.com/elastic/elasticsearch/pull/58429#discussion_r444832524", "createdAt": "2020-06-24T11:39:44Z", "author": {"login": "matriv"}, "path": "x-pack/plugin/sql/jdbc/src/main/java/org/elasticsearch/xpack/sql/jdbc/JdbcConfiguration.java", "diffHunk": "@@ -208,7 +215,8 @@ public boolean indexIncludeFrozen() {\n     }\n \n     public static boolean canAccept(String url) {\n-        return (StringUtils.hasText(url) && url.trim().startsWith(JdbcConfiguration.URL_PREFIX));\n+        return (StringUtils.hasText(url) &&", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5ee799532c27d56ff16100d672874fb6641dbe81"}, "originalPosition": 43}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM3MjE4NDk5", "url": "https://github.com/elastic/elasticsearch/pull/58429#pullrequestreview-437218499", "createdAt": "2020-06-25T07:02:59Z", "commit": {"oid": "5ee799532c27d56ff16100d672874fb6641dbe81"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9f74792259ca61768d8ffcfef505cccb60b2d0f1", "author": {"user": {"login": "bpintea", "name": "Bogdan Pintea"}}, "url": "https://github.com/elastic/elasticsearch/commit/9f74792259ca61768d8ffcfef505cccb60b2d0f1", "committedDate": "2020-06-25T20:39:06Z", "message": "Address review comments\n\n- prevent double trimming of the connection string;\n- improve docs"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM4MDk1ODUz", "url": "https://github.com/elastic/elasticsearch/pull/58429#pullrequestreview-438095853", "createdAt": "2020-06-26T08:08:48Z", "commit": {"oid": "9f74792259ca61768d8ffcfef505cccb60b2d0f1"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 355, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}