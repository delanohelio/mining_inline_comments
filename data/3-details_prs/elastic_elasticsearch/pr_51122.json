{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzYzNzk0MjE5", "number": 51122, "title": "Make soft-deletes mandatory in 8.0", "bodyText": "Creating indices with soft deletes disabled is no longer supported in 8.0.", "createdAt": "2020-01-16T18:53:15Z", "url": "https://github.com/elastic/elasticsearch/pull/51122", "merged": true, "mergeCommit": {"oid": "c893a3e4956aa85a29c80e66cfb9d1622d7f5da4"}, "closed": true, "closedAt": "2020-01-17T22:34:23Z", "author": {"login": "dnhatn"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb6-xh4gH2gAyMzYzNzk0MjE5OjQyMDMzZDEyYzBkYTMzNDAxYjUxMzJkODhkNzQxZDY0YTU0OTZmNTc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABb7RWzKgFqTM0NDY5NTc5Ng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "42033d12c0da33401b5132d88d741d64a5496f57", "author": {"user": {"login": "dnhatn", "name": "Nhat Nguyen"}}, "url": "https://github.com/elastic/elasticsearch/commit/42033d12c0da33401b5132d88d741d64a5496f57", "committedDate": "2020-01-16T18:50:45Z", "message": "Make soft-deletes mandatory in 8.0"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ0MTQxNjY1", "url": "https://github.com/elastic/elasticsearch/pull/51122#pullrequestreview-344141665", "createdAt": "2020-01-16T18:58:02Z", "commit": {"oid": "42033d12c0da33401b5132d88d741d64a5496f57"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNlQxODo1ODowMlrOFekF7g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNlQxOTozMDoxMlrOFek_og==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzU5Mjk0Mg==", "bodyText": "Perhaps state the second sentence as \"The setting index.soft_deletes.enabled can no longer be set to false. As the setting defaults to true, simply leave the setting unset.\"", "url": "https://github.com/elastic/elasticsearch/pull/51122#discussion_r367592942", "createdAt": "2020-01-16T18:58:02Z", "author": {"login": "ywelsch"}, "path": "docs/reference/migration/migrate_8_0/indices.asciidoc", "diffHunk": "@@ -34,3 +34,11 @@ removed in 8.0.\n \n Synced flush was deprecated in 7.6 and is removed in 8.0. Use a regular flush\n instead as it has the same effect as a synced flush in 7.6 and later.\n+\n+\n+[float]\n+==== Indices with soft deletes disabled\n+\n+Creating indices with soft deletes disabled was deprecated in 7.6 and\n+is no longer supported in 8.0. Do not specify value for the setting\n+`[index.soft_deletes.enabled]`.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "42033d12c0da33401b5132d88d741d64a5496f57"}, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzU5ODMxNQ==", "bodyText": "why remove this? We still don't want people to be able to modify this on restore, do we? Otherwise they could just set this to false on restore.", "url": "https://github.com/elastic/elasticsearch/pull/51122#discussion_r367598315", "createdAt": "2020-01-16T19:09:49Z", "author": {"login": "ywelsch"}, "path": "server/src/main/java/org/elasticsearch/snapshots/RestoreService.java", "diffHunk": "@@ -124,8 +123,7 @@\n             SETTING_NUMBER_OF_SHARDS,\n             SETTING_VERSION_CREATED,\n             SETTING_INDEX_UUID,\n-            SETTING_CREATION_DATE,\n-            IndexSettings.INDEX_SOFT_DELETES_SETTING.getKey()));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "42033d12c0da33401b5132d88d741d64a5496f57"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzYwNjgxOQ==", "bodyText": "should we still allow IndexSettings.INDEX_SOFT_DELETES_SETTING to be set to false if SETTING_INDEX_VERSION_CREATED is before V_8_0_0. This will allow shrink/split of non-soft-deleted indices continue to work. Also, a test for this would be good", "url": "https://github.com/elastic/elasticsearch/pull/51122#discussion_r367606819", "createdAt": "2020-01-16T19:28:13Z", "author": {"login": "ywelsch"}, "path": "server/src/main/java/org/elasticsearch/cluster/metadata/MetaDataCreateIndexService.java", "diffHunk": "@@ -437,10 +435,9 @@ static Settings aggregateIndexSettings(ClusterState currentState, CreateIndexClu\n          * that will be used to create this index.\n          */\n         MetaDataCreateIndexService.checkShardLimit(indexSettings, currentState);\n-        if (indexSettings.getAsBoolean(IndexSettings.INDEX_SOFT_DELETES_SETTING.getKey(), true) == false) {\n-            DEPRECATION_LOGGER.deprecatedAndMaybeLog(\"soft_deletes_disabled\",\n-                \"Creating indices with soft-deletes disabled is deprecated and will be removed in future Elasticsearch versions. \" +\n-                \"Please do not specify value for setting [index.soft_deletes.enabled] of index [\" + request.index() + \"].\");\n+        if (IndexSettings.INDEX_SOFT_DELETES_SETTING.get(indexSettings) == false) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "42033d12c0da33401b5132d88d741d64a5496f57"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzYwNzM0Ng==", "bodyText": "specify a value", "url": "https://github.com/elastic/elasticsearch/pull/51122#discussion_r367607346", "createdAt": "2020-01-16T19:29:23Z", "author": {"login": "ywelsch"}, "path": "server/src/main/java/org/elasticsearch/cluster/metadata/MetaDataCreateIndexService.java", "diffHunk": "@@ -437,10 +435,9 @@ static Settings aggregateIndexSettings(ClusterState currentState, CreateIndexClu\n          * that will be used to create this index.\n          */\n         MetaDataCreateIndexService.checkShardLimit(indexSettings, currentState);\n-        if (indexSettings.getAsBoolean(IndexSettings.INDEX_SOFT_DELETES_SETTING.getKey(), true) == false) {\n-            DEPRECATION_LOGGER.deprecatedAndMaybeLog(\"soft_deletes_disabled\",\n-                \"Creating indices with soft-deletes disabled is deprecated and will be removed in future Elasticsearch versions. \" +\n-                \"Please do not specify value for setting [index.soft_deletes.enabled] of index [\" + request.index() + \"].\");\n+        if (IndexSettings.INDEX_SOFT_DELETES_SETTING.get(indexSettings) == false) {\n+            throw new IllegalArgumentException(\"Creating indices with soft-deletes disabled is no longer supported. \" +\n+                \"Please do not specify value for setting [index.soft_deletes.enabled].\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "42033d12c0da33401b5132d88d741d64a5496f57"}, "originalPosition": 26}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzYwNzcxNA==", "bodyText": "I think we should keep this condition in place (see my other comment)", "url": "https://github.com/elastic/elasticsearch/pull/51122#discussion_r367607714", "createdAt": "2020-01-16T19:30:12Z", "author": {"login": "ywelsch"}, "path": "server/src/main/java/org/elasticsearch/action/admin/indices/shrink/TransportResizeAction.java", "diffHunk": "@@ -175,9 +175,7 @@ static CreateIndexClusterStateUpdateRequest prepareCreateIndexRequest(final Resi\n                 throw new IllegalArgumentException(\"cannot provide index.number_of_routing_shards on resize\");\n             }\n         }\n-        if (IndexSettings.INDEX_SOFT_DELETES_SETTING.get(metaData.getSettings()) &&\n-            IndexSettings.INDEX_SOFT_DELETES_SETTING.exists(targetIndexSettings) &&\n-            IndexSettings.INDEX_SOFT_DELETES_SETTING.get(targetIndexSettings) == false) {\n+        if (IndexSettings.INDEX_SOFT_DELETES_SETTING.get(targetIndexSettings) == false) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "42033d12c0da33401b5132d88d741d64a5496f57"}, "originalPosition": 7}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "66c507d38fbb2c456d146e8b9be7968d09f792ff", "author": {"user": {"login": "dnhatn", "name": "Nhat Nguyen"}}, "url": "https://github.com/elastic/elasticsearch/commit/66c507d38fbb2c456d146e8b9be7968d09f792ff", "committedDate": "2020-01-16T22:05:08Z", "message": "wording"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1c08c1da683f9c2d122c428b96f83f68f9a73399", "author": {"user": {"login": "dnhatn", "name": "Nhat Nguyen"}}, "url": "https://github.com/elastic/elasticsearch/commit/1c08c1da683f9c2d122c428b96f83f68f9a73399", "committedDate": "2020-01-16T22:22:05Z", "message": "fix the test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0ecee877a4c92beef7bfac4735e68056555b48e3", "author": {"user": {"login": "dnhatn", "name": "Nhat Nguyen"}}, "url": "https://github.com/elastic/elasticsearch/commit/0ecee877a4c92beef7bfac4735e68056555b48e3", "committedDate": "2020-01-17T02:48:09Z", "message": "resize without soft-deletes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9a992a9aff741adc98e494eed9814769e7e21dbc", "author": {"user": {"login": "dnhatn", "name": "Nhat Nguyen"}}, "url": "https://github.com/elastic/elasticsearch/commit/9a992a9aff741adc98e494eed9814769e7e21dbc", "committedDate": "2020-01-17T02:50:03Z", "message": "snapshot/restore without soft-deletes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "014b558228d5164cd200b79207676ccc2b51b437", "author": {"user": {"login": "dnhatn", "name": "Nhat Nguyen"}}, "url": "https://github.com/elastic/elasticsearch/commit/014b558228d5164cd200b79207676ccc2b51b437", "committedDate": "2020-01-17T03:13:26Z", "message": "less random settings"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a794188d69e9d96ef7ded89b156d4c396e17eaee", "author": {"user": {"login": "dnhatn", "name": "Nhat Nguyen"}}, "url": "https://github.com/elastic/elasticsearch/commit/a794188d69e9d96ef7ded89b156d4c396e17eaee", "committedDate": "2020-01-17T03:49:20Z", "message": "fix settings"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "babe135f76731eabf3f2a2885b19b6a2613b8fa6", "author": {"user": {"login": "dnhatn", "name": "Nhat Nguyen"}}, "url": "https://github.com/elastic/elasticsearch/commit/babe135f76731eabf3f2a2885b19b6a2613b8fa6", "committedDate": "2020-01-17T03:49:40Z", "message": "Merge branch 'master' into soft-deletes-mandatory"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f1c09e7a7cc147d18cb176275bc35b5c91c01edc", "author": {"user": {"login": "dnhatn", "name": "Nhat Nguyen"}}, "url": "https://github.com/elastic/elasticsearch/commit/f1c09e7a7cc147d18cb176275bc35b5c91c01edc", "committedDate": "2020-01-17T04:34:35Z", "message": "Remove translog test"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ0Njk1Nzk2", "url": "https://github.com/elastic/elasticsearch/pull/51122#pullrequestreview-344695796", "createdAt": "2020-01-17T16:29:45Z", "commit": {"oid": "f1c09e7a7cc147d18cb176275bc35b5c91c01edc"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2930, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}