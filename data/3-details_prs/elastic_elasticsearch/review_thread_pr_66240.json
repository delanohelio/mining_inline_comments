{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTM5MTE3NjUy", "number": 66240, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNFQwNDo1MTozOVrOFEzQ0g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNFQwNDo1MTozOVrOFEzQ0g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQwNTc4NTE0OnYy", "diffSide": "RIGHT", "path": "x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/security/action/InvalidateApiKeyRequest.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNFQwNDo1MTozOVrOIE_yUA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNFQwNToxNjoyNlrOIFANsQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjExMDI4OA==", "bodyText": "Before I touched this class in 7.10, there is no check for id in either constructor. Last time I added\nids = Strings.hasText(id) == false ? null : new String[] { id };\n\nin the constructor with StreamInput. Looking back now, this introduced a tiny inconsistency of how empty id is handled in different constructors. Your change here fixed this inconsistency. Thanks!\nNow I have a new question: since a single empty string is now handled and excluded from the constructor, should we also apply the empty check for the string array of ids, i.e., should we move the validation logic of ids into here as well? On one hand, relocating the check for ids is good for consistency in that validate() is more about interactions between multiple fields. On the other hand, it complicates the constructors and also could be considered as a slight behaviour change. Overall, I think I prefer to not touch it.", "url": "https://github.com/elastic/elasticsearch/pull/66240#discussion_r542110288", "createdAt": "2020-12-14T04:51:39Z", "author": {"login": "ywangd"}, "path": "x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/security/action/InvalidateApiKeyRequest.java", "diffHunk": "@@ -65,17 +65,21 @@ public InvalidateApiKeyRequest(@Nullable String realmName, @Nullable String user\n             throw new IllegalArgumentException(\"Must use either [id] or [ids], not both at the same time\");\n         }\n \n-        this.realmName = realmName;\n-        this.userName = userName;\n-        if (id != null) {\n-            this.ids = new String[] {id};\n+        this.realmName = textOrNull(realmName);\n+        this.userName = textOrNull(userName);\n+        if (Strings.hasText(id)) {\n+            this.ids = new String[]{id};\n         } else {\n             this.ids = ids;\n         }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a464afc34cf6a358826488f39d5c339d36278f5a"}, "originalPosition": 33}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjExNzI5Nw==", "bodyText": "I took the cautious approach and decided to make this as close as possible to having zero visible changes.\nSince the deserialisation code has a hasText check (as you note) I decided that this fix made sense, but chose not to try and filter empty values in the ids array. That seemed like a behavioural change that was outside the scope of this PR.\nI'm not necessarily opposed to someone making that change I just wanted this PR to be quick and simple.", "url": "https://github.com/elastic/elasticsearch/pull/66240#discussion_r542117297", "createdAt": "2020-12-14T05:16:26Z", "author": {"login": "tvernum"}, "path": "x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/security/action/InvalidateApiKeyRequest.java", "diffHunk": "@@ -65,17 +65,21 @@ public InvalidateApiKeyRequest(@Nullable String realmName, @Nullable String user\n             throw new IllegalArgumentException(\"Must use either [id] or [ids], not both at the same time\");\n         }\n \n-        this.realmName = realmName;\n-        this.userName = userName;\n-        if (id != null) {\n-            this.ids = new String[] {id};\n+        this.realmName = textOrNull(realmName);\n+        this.userName = textOrNull(userName);\n+        if (Strings.hasText(id)) {\n+            this.ids = new String[]{id};\n         } else {\n             this.ids = ids;\n         }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjExMDI4OA=="}, "originalCommit": {"oid": "a464afc34cf6a358826488f39d5c339d36278f5a"}, "originalPosition": 33}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4660, "cost": 1, "resetAt": "2021-11-12T19:05:54Z"}}}