{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzkyNTA2Njky", "number": 53998, "title": "[ML] Data frame analytics data counts", "bodyText": "This commit instruments data frame analytics\nwith stats for the data that are being analyzed.\nIn particular, we count training docs, test docs,\nand skipped docs.\nIn order to account docs with missing values as skipped\ndocs for analyses that do not support missing values,\nthis commit changes the extractor so that it only ignores\ndocs with missing values when it collects the data summary,\nwhich is used to estimate memory usage.", "createdAt": "2020-03-23T16:54:03Z", "url": "https://github.com/elastic/elasticsearch/pull/53998", "merged": true, "mergeCommit": {"oid": "39785ebdbb276b365027cb4401e68acf029f6463"}, "closed": true, "closedAt": "2020-03-23T21:29:02Z", "author": {"login": "dimitris-athanasiou"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcQg-PcgH2gAyMzkyNTA2NjkyOjI2NmNkMWRlM2RlYWVjZDNhNGYzOTRmZGQ1M2YzYTMxOTIxMzljZDY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcQkT1XgH2gAyMzkyNTA2NjkyOmM1ZDVlNjlkM2QxOGJjM2QxZTM0MDFkYmQ2ZTExYTgxMzY1MjY2MTY=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "266cd1de3deaecd3a4f394fdd53f3a3192139cd6", "author": {"user": {"login": "dimitris-athanasiou", "name": "Dimitris Athanasiou"}}, "url": "https://github.com/elastic/elasticsearch/commit/266cd1de3deaecd3a4f394fdd53f3a3192139cd6", "committedDate": "2020-03-23T16:33:49Z", "message": "[ML] Data frame analytics data counts\n\nThis commit instruments data frame analytics\nwith stats for the data that are being analyzed.\nIn particular, we count training docs, test docs,\nand skipped docs.\n\nIn order to account docs with missing values as skipped\ndocs for analyses that do not support missing values,\nthis commit changes the extractor so that it only ignores\ndocs with missing values when it collects the data summary,\nwhich is used to estimate memory usage."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc5NjQwNjI1", "url": "https://github.com/elastic/elasticsearch/pull/53998#pullrequestreview-379640625", "createdAt": "2020-03-23T17:12:25Z", "commit": {"oid": "266cd1de3deaecd3a4f394fdd53f3a3192139cd6"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QxNzoxMjoyNVrOF6Pg1A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QxNzoxMjoyNVrOF6Pg1A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjYxNTg5Mg==", "bodyText": "AnalyticsResultProcessor#cancel() should call this.statsPersister.cancel()", "url": "https://github.com/elastic/elasticsearch/pull/53998#discussion_r396615892", "createdAt": "2020-03-23T17:12:25Z", "author": {"login": "benwtrent"}, "path": "x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/dataframe/process/AnalyticsResultProcessor.java", "diffHunk": "@@ -77,22 +70,21 @@\n     private final StatsHolder statsHolder;\n     private final TrainedModelProvider trainedModelProvider;\n     private final DataFrameAnalyticsAuditor auditor;\n-    private final ResultsPersisterService resultsPersisterService;\n+    private final StatsPersister statsPersister;\n     private final List<ExtractedField> fieldNames;\n     private final CountDownLatch completionLatch = new CountDownLatch(1);\n     private volatile String failure;\n     private volatile boolean isCancelled;\n \n     public AnalyticsResultProcessor(DataFrameAnalyticsConfig analytics, DataFrameRowsJoiner dataFrameRowsJoiner,\n                                     StatsHolder statsHolder, TrainedModelProvider trainedModelProvider,\n-                                    DataFrameAnalyticsAuditor auditor, ResultsPersisterService resultsPersisterService,\n-                                    List<ExtractedField> fieldNames) {\n+                                    DataFrameAnalyticsAuditor auditor, StatsPersister statsPersister, List<ExtractedField> fieldNames) {\n         this.analytics = Objects.requireNonNull(analytics);\n         this.dataFrameRowsJoiner = Objects.requireNonNull(dataFrameRowsJoiner);\n         this.statsHolder = Objects.requireNonNull(statsHolder);\n         this.trainedModelProvider = Objects.requireNonNull(trainedModelProvider);\n         this.auditor = Objects.requireNonNull(auditor);\n-        this.resultsPersisterService = Objects.requireNonNull(resultsPersisterService);\n+        this.statsPersister = Objects.requireNonNull(statsPersister);\n         this.fieldNames = Collections.unmodifiableList(Objects.requireNonNull(fieldNames));\n     }\n ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "266cd1de3deaecd3a4f394fdd53f3a3192139cd6"}, "originalPosition": 68}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c852d9af61635119a40c03c24249f6b2cf223c88", "author": {"user": {"login": "dimitris-athanasiou", "name": "Dimitris Athanasiou"}}, "url": "https://github.com/elastic/elasticsearch/commit/c852d9af61635119a40c03c24249f6b2cf223c88", "committedDate": "2020-03-23T18:30:40Z", "message": "Cancel stats persister from result processor"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc5NzIyNzkw", "url": "https://github.com/elastic/elasticsearch/pull/53998#pullrequestreview-379722790", "createdAt": "2020-03-23T18:48:23Z", "commit": {"oid": "c852d9af61635119a40c03c24249f6b2cf223c88"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c5d5e69d3d18bc3d1e3401dbd6e11a8136526616", "author": {"user": {"login": "elasticmachine", "name": "Elastic Machine"}}, "url": "https://github.com/elastic/elasticsearch/commit/c5d5e69d3d18bc3d1e3401dbd6e11a8136526616", "committedDate": "2020-03-23T20:27:07Z", "message": "Merge branch 'master' into df-analytics-data-counts"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1808, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}