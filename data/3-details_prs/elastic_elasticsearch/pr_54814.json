{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk5Njg4NDA2", "number": 54814, "title": "Add RepositoriesService to createComponents() args", "bodyText": "Today we pass the RepositoriesService to the searchable snapshots plugin\nduring the initialization of the RepositoryModule, forcing the plugin to be a\nRepositoryPlugin even though it does not implement any repositories.\nAfter discussion we decided it best for now to pass this in via\nPlugin#createComponents instead, pending some future work in which plugins\ncan depend on services more dynamically.", "createdAt": "2020-04-06T14:31:12Z", "url": "https://github.com/elastic/elasticsearch/pull/54814", "merged": true, "mergeCommit": {"oid": "6e98af385ae27cb9296901ec980fe8d8639ab7e6"}, "closed": true, "closedAt": "2020-04-16T14:40:29Z", "author": {"login": "DaveCTurner"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcU_mBZgH2gAyMzk5Njg4NDA2OjQwZGI1OTFlMDAzODFhM2NhZDY3Yzc3MDJlNTEzMDlhYzRlMjY3ZTQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcYMvboAH2gAyMzk5Njg4NDA2OjIzMjE3Nzk0Y2Q0OTNkOTlmOGI1MGVlNzQwYmI3NGIzYzNhMzhlOTc=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "40db591e00381a3cad67c7702e51309ac4e267e4", "author": {"user": {"login": "DaveCTurner", "name": "David Turner"}}, "url": "https://github.com/elastic/elasticsearch/commit/40db591e00381a3cad67c7702e51309ac4e267e4", "committedDate": "2020-04-06T14:30:07Z", "message": "Add RepositoriesService to createComponents() args\n\nToday we pass the `RepositoriesService` to the searchable snapshots plugin\nduring the initialization of the `RepositoryModule`, forcing the plugin to be a\n`RepositoryPlugin` even though it does not implement any repositories.\n\nAfter discussion we decided it best for now to pass this in via\n`Plugin#createComponents` instead, pending some future work in which plugins\ncan depend on services more dynamically."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg5MDQ5NjIz", "url": "https://github.com/elastic/elasticsearch/pull/54814#pullrequestreview-389049623", "createdAt": "2020-04-07T12:06:51Z", "commit": {"oid": "40db591e00381a3cad67c7702e51309ac4e267e4"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg5MzQyNzcy", "url": "https://github.com/elastic/elasticsearch/pull/54814#pullrequestreview-389342772", "createdAt": "2020-04-07T17:36:14Z", "commit": {"oid": "40db591e00381a3cad67c7702e51309ac4e267e4"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wN1QxNzozNjoxNFrOGCOs3A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wN1QxNzozNjoxNFrOGCOs3A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDk5MTE5Ng==", "bodyText": "component creation (ie services created by plugins) should happen almost last within node initialization. I don't think we should be passing in a Supplier. Instead, we should move the call to createComponents down later, so that we have the RepositoriesService.", "url": "https://github.com/elastic/elasticsearch/pull/54814#discussion_r404991196", "createdAt": "2020-04-07T17:36:14Z", "author": {"login": "rjernst"}, "path": "modules/lang-painless/src/main/java/org/elasticsearch/painless/PainlessPlugin.java", "diffHunk": "@@ -115,7 +116,8 @@ public ScriptEngine getScriptEngine(Settings settings, Collection<ScriptContext<\n                                                ResourceWatcherService resourceWatcherService, ScriptService scriptService,\n                                                NamedXContentRegistry xContentRegistry, Environment environment,\n                                                NodeEnvironment nodeEnvironment, NamedWriteableRegistry namedWriteableRegistry,\n-                                               IndexNameExpressionResolver expressionResolver) {\n+                                               IndexNameExpressionResolver expressionResolver,\n+                                               Supplier<RepositoriesService> repositoriesServiceSupplier) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "40db591e00381a3cad67c7702e51309ac4e267e4"}, "originalPosition": 14}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b2b53332800d512c546a61f461c9997e3441d392", "author": {"user": {"login": "DaveCTurner", "name": "David Turner"}}, "url": "https://github.com/elastic/elasticsearch/commit/b2b53332800d512c546a61f461c9997e3441d392", "committedDate": "2020-04-08T07:44:41Z", "message": "Create components later, no need for supplier"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5b41c580316484665325c97ec8be887c3319f78c", "author": {"user": {"login": "DaveCTurner", "name": "David Turner"}}, "url": "https://github.com/elastic/elasticsearch/commit/5b41c580316484665325c97ec8be887c3319f78c", "committedDate": "2020-04-08T07:46:05Z", "message": "Merge branch 'master' into 2020-04-06-initialize-repositories-service-in-createcomponents"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "57e8286003a62773fd97ab0722602c346dff01c1", "author": {"user": {"login": "DaveCTurner", "name": "David Turner"}}, "url": "https://github.com/elastic/elasticsearch/commit/57e8286003a62773fd97ab0722602c346dff01c1", "committedDate": "2020-04-08T08:23:46Z", "message": "Revert \"Create components later, no need for supplier\"\n\nThis reverts commit b2b53332800d512c546a61f461c9997e3441d392."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkxMDM4MzY0", "url": "https://github.com/elastic/elasticsearch/pull/54814#pullrequestreview-391038364", "createdAt": "2020-04-09T18:37:13Z", "commit": {"oid": "57e8286003a62773fd97ab0722602c346dff01c1"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOVQxODozNzoxM1rOGDkwaA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOVQxODozNzoxM1rOGDkwaA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjQwMTEyOA==", "bodyText": "Thanks for trying, @DaveCTurner. The action module part is avoidable by tweaking when the security rest wrapper invokes getSslService(), but the aggressive creation of transport doesn't seem to be resolvable, at least for now. This is all a result of the odd sharing of the ssl service across xpack plugins. I'll take this as a TODO to investigate how we can clean this up with other plugin/node initialization cleanup work.", "url": "https://github.com/elastic/elasticsearch/pull/54814#discussion_r406401128", "createdAt": "2020-04-09T18:37:13Z", "author": {"login": "rjernst"}, "path": "modules/lang-painless/src/main/java/org/elasticsearch/painless/PainlessPlugin.java", "diffHunk": "@@ -115,7 +116,8 @@ public ScriptEngine getScriptEngine(Settings settings, Collection<ScriptContext<\n                                                ResourceWatcherService resourceWatcherService, ScriptService scriptService,\n                                                NamedXContentRegistry xContentRegistry, Environment environment,\n                                                NodeEnvironment nodeEnvironment, NamedWriteableRegistry namedWriteableRegistry,\n-                                               IndexNameExpressionResolver expressionResolver) {\n+                                               IndexNameExpressionResolver expressionResolver,\n+                                               Supplier<RepositoriesService> repositoriesServiceSupplier) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDk5MTE5Ng=="}, "originalCommit": {"oid": "40db591e00381a3cad67c7702e51309ac4e267e4"}, "originalPosition": 14}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "23217794cd493d99f8b50ee740bb74b3c3a38e97", "author": {"user": {"login": "DaveCTurner", "name": "David Turner"}}, "url": "https://github.com/elastic/elasticsearch/commit/23217794cd493d99f8b50ee740bb74b3c3a38e97", "committedDate": "2020-04-16T13:30:56Z", "message": "Merge branch 'master' into 2020-04-06-initialize-repositories-service-in-createcomponents"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3681, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}