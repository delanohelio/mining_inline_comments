{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE1NDg4MzYw", "number": 64597, "title": "Don't expose TextFieldMapper subfields", "bodyText": "TextFieldMapper can optionally index data into subfields for accelerated\nprefix and phrase queries.  Currently, these subfields are implemented\nas FieldMappers in their own right, made available via TextFieldMapper's\niterator() method and with their own standalone MappedFieldType objects.\nThis has the disadvantage that these subfields are directly available for\nsearching, and appear in APIs such as field caps.  In addition, because\nexists queries are not implemented on them, an exists query against an\nobject which contains a text field with one of the subfields enabled can\nthrow an error (see #63585).\nThis commit reworks the subfields so that they are no longer implemented\nas FieldMappers, and are no longer exposed to classes outside\nTextFieldMapper either as MappedFieldTypes or as FieldMappers.  The\nparent TextFieldMapper handles indexing and analyzer registration,\nPhraseFieldType is removed entirely, and PrefixFieldType is retained as\na private implementation for fast prefix queries but is unavailable for\nquerying directly.\nFixes #63585\nCloses #63446\nCloses #64585", "createdAt": "2020-11-04T16:12:45Z", "url": "https://github.com/elastic/elasticsearch/pull/64597", "merged": true, "mergeCommit": {"oid": "cea93d1c65b014ac02abf546bdb3a27150088bd2"}, "closed": true, "closedAt": "2020-11-05T13:16:32Z", "author": {"login": "romseygeek"}, "timelineItems": {"totalCount": 38, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdUYZNvgH2gAyNTE1NDg4MzYwOjM0OTc3ZTRiZDg2MTdlNDJlY2Y5ZWRkM2I2NzY1YmU2ZWVmMmQ5N2M=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdZhK1zgH2gAyNTE1NDg4MzYwOjBhOGY0YWVkM2E2YTRjNjNjNDM3NmFmMDFlMjY2ZDQ4YTZkNmNmYzU=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "34977e4bd8617e42ecf9edd3b6765be6eef2d97c", "author": {"user": {"login": "romseygeek", "name": "Alan Woodward"}}, "url": "https://github.com/elastic/elasticsearch/commit/34977e4bd8617e42ecf9edd3b6765be6eef2d97c", "committedDate": "2020-10-20T13:00:59Z", "message": "Centralize index analyzer management"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3d8dfc708758b9c3396a3a892f8e114d268e6389", "author": {"user": {"login": "romseygeek", "name": "Alan Woodward"}}, "url": "https://github.com/elastic/elasticsearch/commit/3d8dfc708758b9c3396a3a892f8e114d268e6389", "committedDate": "2020-10-20T13:03:26Z", "message": "Merge remote-tracking branch 'origin/master' into mapper/indexanalyzer"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d098bcdace36fcc663ede0d9e34cbbef748a870d", "author": {"user": {"login": "romseygeek", "name": "Alan Woodward"}}, "url": "https://github.com/elastic/elasticsearch/commit/d098bcdace36fcc663ede0d9e34cbbef748a870d", "committedDate": "2020-10-20T13:39:12Z", "message": "precommit"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3a8807a8c8c88783409fdf5f5ac61727f5d7765a", "author": {"user": {"login": "romseygeek", "name": "Alan Woodward"}}, "url": "https://github.com/elastic/elasticsearch/commit/3a8807a8c8c88783409fdf5f5ac61727f5d7765a", "committedDate": "2020-10-20T14:06:32Z", "message": "Merge remote-tracking branch 'origin/master' into mapper/indexanalyzer"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4cccf095acf1c7fc9e1cbacf26600e144137fc66", "author": {"user": {"login": "romseygeek", "name": "Alan Woodward"}}, "url": "https://github.com/elastic/elasticsearch/commit/4cccf095acf1c7fc9e1cbacf26600e144137fc66", "committedDate": "2020-10-20T17:33:10Z", "message": "delegating analyzers"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c9437df65f23fa53c62c1b94748e9d1876cb1632", "author": {"user": {"login": "romseygeek", "name": "Alan Woodward"}}, "url": "https://github.com/elastic/elasticsearch/commit/c9437df65f23fa53c62c1b94748e9d1876cb1632", "committedDate": "2020-10-21T08:37:41Z", "message": "precommit"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1885058cf535880a619480bde0a21ca73133844d", "author": {"user": {"login": "romseygeek", "name": "Alan Woodward"}}, "url": "https://github.com/elastic/elasticsearch/commit/1885058cf535880a619480bde0a21ca73133844d", "committedDate": "2020-10-21T08:37:44Z", "message": "Merge remote-tracking branch 'origin/master' into mapper/indexanalyzer"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "32382ad10226da332423054c78351e3d10ad688a", "author": {"user": {"login": "romseygeek", "name": "Alan Woodward"}}, "url": "https://github.com/elastic/elasticsearch/commit/32382ad10226da332423054c78351e3d10ad688a", "committedDate": "2020-10-21T10:12:39Z", "message": "position increments on annotations"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0b963be352c40d6d22dc664f2ace18b6f851239a", "author": {"user": {"login": "romseygeek", "name": "Alan Woodward"}}, "url": "https://github.com/elastic/elasticsearch/commit/0b963be352c40d6d22dc664f2ace18b6f851239a", "committedDate": "2020-10-26T16:21:32Z", "message": "Merge remote-tracking branch 'origin/master' into mapper/indexanalyzer"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d6adf804bb2a5ceb35aa35062f1ebb35f1bfd1c3", "author": {"user": {"login": "romseygeek", "name": "Alan Woodward"}}, "url": "https://github.com/elastic/elasticsearch/commit/d6adf804bb2a5ceb35aa35062f1ebb35f1bfd1c3", "committedDate": "2020-10-27T14:40:06Z", "message": "Merge remote-tracking branch 'origin/master' into mapper/indexanalyzer"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f1b8095fdddd17457339486d13d1954e89ed8871", "author": {"user": {"login": "romseygeek", "name": "Alan Woodward"}}, "url": "https://github.com/elastic/elasticsearch/commit/f1b8095fdddd17457339486d13d1954e89ed8871", "committedDate": "2020-10-27T15:29:11Z", "message": "Move to returning maps"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bb81e255fc362f3afb43df1666bf0bf495fdcc04", "author": {"user": {"login": "romseygeek", "name": "Alan Woodward"}}, "url": "https://github.com/elastic/elasticsearch/commit/bb81e255fc362f3afb43df1666bf0bf495fdcc04", "committedDate": "2020-10-27T15:48:45Z", "message": "imports"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2585186afbf02d47db257c5b97c382e39eeb3c4d", "author": {"user": {"login": "romseygeek", "name": "Alan Woodward"}}, "url": "https://github.com/elastic/elasticsearch/commit/2585186afbf02d47db257c5b97c382e39eeb3c4d", "committedDate": "2020-10-27T16:18:25Z", "message": "Merge remote-tracking branch 'origin/master' into mapper/indexanalyzer"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4f3da1d43c7615e7ae2c51704a66966485a8791e", "author": {"user": {"login": "romseygeek", "name": "Alan Woodward"}}, "url": "https://github.com/elastic/elasticsearch/commit/4f3da1d43c7615e7ae2c51704a66966485a8791e", "committedDate": "2020-10-29T11:42:30Z", "message": "Make everything a NamedAnalyzer"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "be55995bc711fb6b5c35ffb1fa92a6f7b7fe2b30", "author": {"user": {"login": "romseygeek", "name": "Alan Woodward"}}, "url": "https://github.com/elastic/elasticsearch/commit/be55995bc711fb6b5c35ffb1fa92a6f7b7fe2b30", "committedDate": "2020-10-29T11:54:26Z", "message": "Merge remote-tracking branch 'origin/master' into mapper/indexanalyzer"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "73044b58cab37ba8a4dea29e98332b8bd297eef0", "author": {"user": {"login": "romseygeek", "name": "Alan Woodward"}}, "url": "https://github.com/elastic/elasticsearch/commit/73044b58cab37ba8a4dea29e98332b8bd297eef0", "committedDate": "2020-10-29T12:04:05Z", "message": "warnings"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "25f3c0d4cc16fff576b1a6c71ad9437253f7e8f8", "author": {"user": {"login": "romseygeek", "name": "Alan Woodward"}}, "url": "https://github.com/elastic/elasticsearch/commit/25f3c0d4cc16fff576b1a6c71ad9437253f7e8f8", "committedDate": "2020-10-29T14:53:56Z", "message": "sigtext"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c04c7d1bbd124b9dd74fbb9d6706edd14bc940d1", "author": {"user": {"login": "romseygeek", "name": "Alan Woodward"}}, "url": "https://github.com/elastic/elasticsearch/commit/c04c7d1bbd124b9dd74fbb9d6706edd14bc940d1", "committedDate": "2020-10-29T16:30:03Z", "message": "Collapse ParametrizedFieldMapper into FieldMapper"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "639126e07d876bddb7008c98c2cb6617f9c9edca", "author": {"user": {"login": "romseygeek", "name": "Alan Woodward"}}, "url": "https://github.com/elastic/elasticsearch/commit/639126e07d876bddb7008c98c2cb6617f9c9edca", "committedDate": "2020-10-29T21:30:14Z", "message": "SAYT shouldn't try to add fields if index=false and store=false"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "feea031ef463d700c3598349cf432ff66bc71c38", "author": {"user": {"login": "romseygeek", "name": "Alan Woodward"}}, "url": "https://github.com/elastic/elasticsearch/commit/feea031ef463d700c3598349cf432ff66bc71c38", "committedDate": "2020-11-02T12:13:52Z", "message": "Merge remote-tracking branch 'origin/master' into mapper/indexanalyzer"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9ee7dda1d3d02ee313dd46def7d4e40651517c0c", "author": {"user": {"login": "romseygeek", "name": "Alan Woodward"}}, "url": "https://github.com/elastic/elasticsearch/commit/9ee7dda1d3d02ee313dd46def7d4e40651517c0c", "committedDate": "2020-11-02T12:23:36Z", "message": "Merge branch 'mapper/fieldmapper' into mapper/indexanalyzer"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "88ad7e5dcd9d94f28da59d0831b2e5850211b99a", "author": {"user": {"login": "romseygeek", "name": "Alan Woodward"}}, "url": "https://github.com/elastic/elasticsearch/commit/88ad7e5dcd9d94f28da59d0831b2e5850211b99a", "committedDate": "2020-11-02T15:31:22Z", "message": "Make indexAnalyzers passed via constructor"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "040ec026700af36ec70059a4b9d943cfb48a0206", "author": {"user": {"login": "romseygeek", "name": "Alan Woodward"}}, "url": "https://github.com/elastic/elasticsearch/commit/040ec026700af36ec70059a4b9d943cfb48a0206", "committedDate": "2020-11-02T15:46:39Z", "message": "Merge remote-tracking branch 'origin/master' into mapper/indexanalyzer"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0d2a081fe06c0ccbe67f5777a829b05bbbf193d4", "author": {"user": {"login": "romseygeek", "name": "Alan Woodward"}}, "url": "https://github.com/elastic/elasticsearch/commit/0d2a081fe06c0ccbe67f5777a829b05bbbf193d4", "committedDate": "2020-11-02T16:59:26Z", "message": "SearchAsYouType tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7b28b2c5a606ea8c41620ff387d400accb642149", "author": {"user": {"login": "romseygeek", "name": "Alan Woodward"}}, "url": "https://github.com/elastic/elasticsearch/commit/7b28b2c5a606ea8c41620ff387d400accb642149", "committedDate": "2020-11-03T17:42:07Z", "message": "Merge remote-tracking branch 'origin/master' into mapper/indexanalyzer"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "22357b772908c5a7f08ebc185cb7b7df902b5bdc", "author": {"user": {"login": "elasticmachine", "name": "Elastic Machine"}}, "url": "https://github.com/elastic/elasticsearch/commit/22357b772908c5a7f08ebc185cb7b7df902b5bdc", "committedDate": "2020-11-03T18:10:19Z", "message": "Merge branch 'master' into mapper/indexanalyzer"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "479309734141b6006c49bc8268e72e042eba3e94", "author": {"user": {"login": "elasticmachine", "name": "Elastic Machine"}}, "url": "https://github.com/elastic/elasticsearch/commit/479309734141b6006c49bc8268e72e042eba3e94", "committedDate": "2020-11-04T09:14:49Z", "message": "Merge branch 'master' into mapper/indexanalyzer"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a9051a48d45912bc7c8054faa9404d3b260a1358", "author": {"user": {"login": "romseygeek", "name": "Alan Woodward"}}, "url": "https://github.com/elastic/elasticsearch/commit/a9051a48d45912bc7c8054faa9404d3b260a1358", "committedDate": "2020-11-04T11:26:31Z", "message": "Merge remote-tracking branch 'origin/master' into mapper/indexanalyzer"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "342525c7fcf18cfdcbd85b1afe453d5fbdc0cf70", "author": {"user": {"login": "romseygeek", "name": "Alan Woodward"}}, "url": "https://github.com/elastic/elasticsearch/commit/342525c7fcf18cfdcbd85b1afe453d5fbdc0cf70", "committedDate": "2020-11-04T11:26:46Z", "message": "Merge remote-tracking branch 'romseygeek/mapper/indexanalyzer' into mapper/indexanalyzer"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5099a60e7d3bcf3068f05e388fdd474b88fc7056", "author": {"user": {"login": "romseygeek", "name": "Alan Woodward"}}, "url": "https://github.com/elastic/elasticsearch/commit/5099a60e7d3bcf3068f05e388fdd474b88fc7056", "committedDate": "2020-11-04T11:30:07Z", "message": "Don't call FetchContext#mapperService"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e4f78828bba7e499c234210e48d7cbdc9e24bbc3", "author": {"user": {"login": "romseygeek", "name": "Alan Woodward"}}, "url": "https://github.com/elastic/elasticsearch/commit/e4f78828bba7e499c234210e48d7cbdc9e24bbc3", "committedDate": "2020-11-04T12:05:30Z", "message": "No really, don't use mapperservice"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cbf355abde4b7b206fa102ff9a62bd27cd4c05ff", "author": {"user": {"login": "romseygeek", "name": "Alan Woodward"}}, "url": "https://github.com/elastic/elasticsearch/commit/cbf355abde4b7b206fa102ff9a62bd27cd4c05ff", "committedDate": "2020-11-04T16:01:47Z", "message": "Don't expose TextFieldMapper subfields as mappers"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ce5d93f6dbf131f760337e212038331cfaba1393", "author": {"user": {"login": "romseygeek", "name": "Alan Woodward"}}, "url": "https://github.com/elastic/elasticsearch/commit/ce5d93f6dbf131f760337e212038331cfaba1393", "committedDate": "2020-11-04T16:06:34Z", "message": "Merge remote-tracking branch 'origin/master' into mapper/text-subfields"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "483b26c1fe454f58461b8b0bd6c9b032e1dab199", "author": {"user": {"login": "romseygeek", "name": "Alan Woodward"}}, "url": "https://github.com/elastic/elasticsearch/commit/483b26c1fe454f58461b8b0bd6c9b032e1dab199", "committedDate": "2020-11-04T16:49:52Z", "message": "FieldFetcher test"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIzNjE5NzI1", "url": "https://github.com/elastic/elasticsearch/pull/64597#pullrequestreview-523619725", "createdAt": "2020-11-04T18:16:57Z", "commit": {"oid": "483b26c1fe454f58461b8b0bd6c9b032e1dab199"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNFQxODoxNjo1N1rOHtkLiQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNFQxODoxODowMFrOHtkNrw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzU0MDc0NQ==", "bodyText": "buildPrefixMapper -> buildPrefixInfo", "url": "https://github.com/elastic/elasticsearch/pull/64597#discussion_r517540745", "createdAt": "2020-11-04T18:16:57Z", "author": {"login": "jtibshirani"}, "path": "server/src/main/java/org/elasticsearch/index/mapper/TextFieldMapper.java", "diffHunk": "@@ -330,7 +329,7 @@ private TextFieldType buildFieldType(FieldType fieldType, BuilderContext context\n             return ft;\n         }\n \n-        private PrefixFieldMapper buildPrefixMapper(BuilderContext context, FieldType fieldType, TextFieldType tft) {\n+        private SubFieldInfo buildPrefixMapper(BuilderContext context, FieldType fieldType, TextFieldType tft) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "483b26c1fe454f58461b8b0bd6c9b032e1dab199"}, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzU0MTI5NQ==", "bodyText": "We could switch to the *Info naming here too,", "url": "https://github.com/elastic/elasticsearch/pull/64597#discussion_r517541295", "createdAt": "2020-11-04T18:18:00Z", "author": {"login": "jtibshirani"}, "path": "server/src/main/java/org/elasticsearch/index/mapper/TextFieldMapper.java", "diffHunk": "@@ -407,12 +405,18 @@ private PhraseFieldMapper buildPhraseMapper(FieldType fieldType, TextFieldType p\n         public TextFieldMapper build(BuilderContext context) {\n             FieldType fieldType = TextParams.buildFieldType(index, store, indexOptions, norms, termVectors);\n             TextFieldType tft = buildFieldType(fieldType, context);\n-            PhraseFieldMapper phraseFieldMapper = buildPhraseMapper(fieldType, tft);\n-            PrefixFieldMapper prefixFieldMapper = buildPrefixMapper(context, fieldType, tft);\n+            SubFieldInfo phraseFieldMapper = buildPhraseInfo(fieldType, tft);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "483b26c1fe454f58461b8b0bd6c9b032e1dab199"}, "originalPosition": 95}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "13062bed434c85aea94fdc55a46806e96ddd7122", "author": {"user": {"login": "romseygeek", "name": "Alan Woodward"}}, "url": "https://github.com/elastic/elasticsearch/commit/13062bed434c85aea94fdc55a46806e96ddd7122", "committedDate": "2020-11-05T10:06:31Z", "message": "Merge remote-tracking branch 'origin/master' into mapper/text-subfields"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6ad4804b3c21fdf91c18a5881980e2d2fe522b0b", "author": {"user": {"login": "romseygeek", "name": "Alan Woodward"}}, "url": "https://github.com/elastic/elasticsearch/commit/6ad4804b3c21fdf91c18a5881980e2d2fe522b0b", "committedDate": "2020-11-05T10:08:13Z", "message": "naming"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0a8f4aed3a6a4c63c4376af01e266d48a6d6cfc5", "author": {"user": {"login": "romseygeek", "name": "Alan Woodward"}}, "url": "https://github.com/elastic/elasticsearch/commit/0a8f4aed3a6a4c63c4376af01e266d48a6d6cfc5", "committedDate": "2020-11-05T12:04:03Z", "message": "Merge remote-tracking branch 'origin/master' into mapper/text-subfields"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 820, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}