{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTAxNzMwNTk1", "number": 63573, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xMlQxODozMjo0MlrOEsvO1A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xMlQxODozNDowN1rOEsvQgw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE1MzQ2NjQ0OnYy", "diffSide": "RIGHT", "path": "x-pack/plugin/eql/src/main/java/org/elasticsearch/xpack/eql/analysis/PreAnalyzer.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xMlQxODozMjo0MlrOHgJM_w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xMlQxODozMjo0MlrOHgJM_w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzQ2NzI2Mw==", "bodyText": "Use indices.isValid instead to check if the index is valid and if it's not, call toString() on it which returns the message instead of the index name.\nPotentially pass the listener in the method to call onFailure with the failure instead of throwing it.", "url": "https://github.com/elastic/elasticsearch/pull/63573#discussion_r503467263", "createdAt": "2020-10-12T18:32:42Z", "author": {"login": "costin"}, "path": "x-pack/plugin/eql/src/main/java/org/elasticsearch/xpack/eql/analysis/PreAnalyzer.java", "diffHunk": "@@ -6,16 +6,28 @@\n \n package org.elasticsearch.xpack.eql.analysis;\n \n+import org.elasticsearch.xpack.ql.common.Failure;\n+import org.elasticsearch.xpack.ql.index.EsIndex;\n import org.elasticsearch.xpack.ql.index.IndexResolution;\n+import org.elasticsearch.xpack.ql.index.MappingException;\n import org.elasticsearch.xpack.ql.plan.logical.EsRelation;\n import org.elasticsearch.xpack.ql.plan.logical.LogicalPlan;\n import org.elasticsearch.xpack.ql.plan.logical.UnresolvedRelation;\n \n+import java.util.Collections;\n+\n public class PreAnalyzer {\n \n     public LogicalPlan preAnalyze(LogicalPlan plan, IndexResolution indices) {\n+        EsIndex esIndex = null;\n+        // wrap a potential index_not_found_exception with a VerificationException (expected by client)\n+        try {\n+            esIndex = indices.get();\n+        } catch (MappingException me) {\n+            throw new VerificationException(Collections.singletonList(Failure.fail(plan, me.getMessage())));\n+        }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "af85c63a1b8d2466cdfb1484891b124400be6586"}, "originalPosition": 23}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE1MzQ3MDc1OnYy", "diffSide": "RIGHT", "path": "x-pack/plugin/eql/src/main/java/org/elasticsearch/xpack/eql/session/EqlSession.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xMlQxODozNDowN1rOHgJPcw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xMlQxODozNDowN1rOHgJPcw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzQ2Nzg5MQ==", "bodyText": "\ud83d\udc4d", "url": "https://github.com/elastic/elasticsearch/pull/63573#discussion_r503467891", "createdAt": "2020-10-12T18:34:07Z", "author": {"login": "costin"}, "path": "x-pack/plugin/eql/src/main/java/org/elasticsearch/xpack/eql/session/EqlSession.java", "diffHunk": "@@ -100,7 +100,7 @@ public void analyzedPlan(LogicalPlan parsed, ActionListener<LogicalPlan> listene\n             listener.onFailure(new TaskCancelledException(\"cancelled\"));\n             return;\n         }\n-        indexResolver.resolveAsMergedMapping(indexWildcard, null, configuration.includeFrozen(), configuration.filter(),\n+        indexResolver.resolveAsMergedMapping(indexWildcard, null, configuration.indicesOptions(), configuration.filter(),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "af85c63a1b8d2466cdfb1484891b124400be6586"}, "originalPosition": 5}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2946, "cost": 1, "resetAt": "2021-11-12T11:57:46Z"}}}