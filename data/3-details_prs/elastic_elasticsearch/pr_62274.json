{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDg1MTczNjIw", "number": 62274, "title": "Fix NPE when deleting multiple backing indices on a data stream", "bodyText": "Fixes #62272.", "createdAt": "2020-09-11T15:09:36Z", "url": "https://github.com/elastic/elasticsearch/pull/62274", "merged": true, "mergeCommit": {"oid": "f7e5ed5efc08b1ebf6621e85a1ab433421c6b4b0"}, "closed": true, "closedAt": "2020-09-14T17:33:53Z", "author": {"login": "danhermann"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdH21LmAH2gAyNDg1MTczNjIwOjgwZGUzMjA3MWVhNTRhNTQ0OGY0OGJiNmU3YTYxZDE2YTNlMmE5NTA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdI2DtIgH2gAyNDg1MTczNjIwOjA5YjIyZTZhNTRjNGZmNTE4MjRhMjdkNmRmMWQxYjA5N2YxZGYwNjE=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "80de32071ea54a5448f48bb6e7a61d16a3e2a950", "author": {"user": {"login": "danhermann", "name": "Dan Hermann"}}, "url": "https://github.com/elastic/elasticsearch/commit/80de32071ea54a5448f48bb6e7a61d16a3e2a950", "committedDate": "2020-09-11T15:07:40Z", "message": "Fix NPE when deleting multiple backing indices on a data stream"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg3NTgyNjk4", "url": "https://github.com/elastic/elasticsearch/pull/62274#pullrequestreview-487582698", "createdAt": "2020-09-14T09:36:02Z", "commit": {"oid": "80de32071ea54a5448f48bb6e7a61d16a3e2a950"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNFQwOTozNjowMlrOHRLtKw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNFQwOTozNjowMlrOHRLtKw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Nzc3OTYyNw==", "bodyText": "I think numBackingIndices needs to be changed into numBackingIndices - 1, otherwise the test tries to delete the write index which would fail.", "url": "https://github.com/elastic/elasticsearch/pull/62274#discussion_r487779627", "createdAt": "2020-09-14T09:36:02Z", "author": {"login": "martijnvg"}, "path": "server/src/test/java/org/elasticsearch/cluster/metadata/MetadataDeleteIndexServiceTests.java", "diffHunk": "@@ -129,6 +132,29 @@ public void testDeleteBackingIndexForDataStream() {\n             DataStream.getDefaultBackingIndexName(dataStreamName, numIndexToDelete)), IsNull.nullValue());\n     }\n \n+    public void testDeleteMultipleBackingIndexForDataStream() {\n+        int numBackingIndices = randomIntBetween(3, 5);\n+        int numBackingIndicesToDelete = randomIntBetween(2, numBackingIndices - 1);\n+        String dataStreamName = randomAlphaOfLength(6).toLowerCase(Locale.ROOT);\n+        ClusterState before = DataStreamTestHelper.getClusterStateWithDataStreams(\n+            List.of(new Tuple<>(dataStreamName, numBackingIndices)), List.of());\n+\n+        List<Integer> indexNumbersToDelete =\n+            randomSubsetOf(numBackingIndicesToDelete, IntStream.rangeClosed(1, numBackingIndices).boxed().collect(Collectors.toList()));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "80de32071ea54a5448f48bb6e7a61d16a3e2a950"}, "originalPosition": 25}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "aa381fe5084ca26bd36e1304f14c16b512bdc9e6", "author": {"user": {"login": "elasticmachine", "name": "Elastic Machine"}}, "url": "https://github.com/elastic/elasticsearch/commit/aa381fe5084ca26bd36e1304f14c16b512bdc9e6", "committedDate": "2020-09-14T12:23:56Z", "message": "Merge branch 'master' into 62272_npe_when_deleting_multiple_backing_indices"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ffd5b070ab2a9dd5d80eee6529270ff0f63514c4", "author": {"user": {"login": "danhermann", "name": "Dan Hermann"}}, "url": "https://github.com/elastic/elasticsearch/commit/ffd5b070ab2a9dd5d80eee6529270ff0f63514c4", "committedDate": "2020-09-14T12:26:11Z", "message": "review comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "51a140ad2d59d0ea9ac43bc74f27d9eef8948590", "author": {"user": {"login": "danhermann", "name": "Dan Hermann"}}, "url": "https://github.com/elastic/elasticsearch/commit/51a140ad2d59d0ea9ac43bc74f27d9eef8948590", "committedDate": "2020-09-14T16:28:50Z", "message": "fix test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "09b22e6a54c4ff51824a27d6df1d1b097f1df061", "author": {"user": {"login": "danhermann", "name": "Dan Hermann"}}, "url": "https://github.com/elastic/elasticsearch/commit/09b22e6a54c4ff51824a27d6df1d1b097f1df061", "committedDate": "2020-09-14T16:47:33Z", "message": "checkstyle"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4541, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}