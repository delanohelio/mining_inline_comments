{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzU4OTUyMjc3", "number": 50594, "title": "Remove the 'local' parameter of /_cat/nodes", "bodyText": "The cat nodes API performs a ClusterStateAction then a NodesInfoAction.\nToday it accepts the ?local parameter and passes this to the\nClusterStateAction but this parameter has no effect on the NodesInfoAction.\nThis is surprising, because GET _cat/nodes?local looks like it might be a\ncompletely local call but in fact it still depends on every node in the\ncluster.\nThis parameter was deprecated in 7.x in #50499 and this commit removes it.\nRelates #50088", "createdAt": "2020-01-03T11:06:29Z", "url": "https://github.com/elastic/elasticsearch/pull/50594", "merged": true, "mergeCommit": {"oid": "8c6f821c756f56a95596b64b26d6e2873bb405d4"}, "closed": true, "closedAt": "2020-01-06T14:12:52Z", "author": {"login": "DaveCTurner"}, "timelineItems": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb2sUEbgH2gAyMzU4OTUyMjc3OjgwZjAyNDFkOGQ3ZjcwNmIwODAxNGY3OGMwNThjMDUxMzA2YmMzMTY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABb3syD6AFqTMzODY2Mjk3MA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "80f0241d8d7f706b08014f78c058c051306bc316", "author": {"user": {"login": "DaveCTurner", "name": "David Turner"}}, "url": "https://github.com/elastic/elasticsearch/commit/80f0241d8d7f706b08014f78c058c051306bc316", "committedDate": "2020-01-03T11:04:35Z", "message": "Remove the 'local' parameter of /_cat/nodes\n\nThe cat nodes API performs a `ClusterStateAction` then a `NodesInfoAction`.\nToday it accepts the `?local` parameter and passes this to the\n`ClusterStateAction` but this parameter has no effect on the `NodesInfoAction`.\nThis is surprising, because `GET _cat/nodes?local` looks like it might be a\ncompletely local call but in fact it still depends on every node in the\ncluster.\n\nThis parameter was deprecated in 7.x in #50499 and this commit removes it.\n\nRelates #50088"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzM4NjU4NzY3", "url": "https://github.com/elastic/elasticsearch/pull/50594#pullrequestreview-338658767", "createdAt": "2020-01-06T14:03:38Z", "commit": {"oid": "80f0241d8d7f706b08014f78c058c051306bc316"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wNlQxNDowMzozOVrOFaeaLw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wNlQxNDowNDozNlrOFaebZQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzMwNTUxOQ==", "bodyText": "Why not Version.V_8_0_0.major? :)", "url": "https://github.com/elastic/elasticsearch/pull/50594#discussion_r363305519", "createdAt": "2020-01-06T14:03:39Z", "author": {"login": "original-brownbear"}, "path": "server/src/main/java/org/elasticsearch/rest/action/cat/RestNodesAction.java", "diffHunk": "@@ -92,10 +87,9 @@ protected void documentation(StringBuilder sb) {\n     public RestChannelConsumer doCatRequest(final RestRequest request, final NodeClient client) {\n         final ClusterStateRequest clusterStateRequest = new ClusterStateRequest();\n         clusterStateRequest.clear().nodes(true);\n-        if (request.hasParam(\"local\")) {\n-            deprecationLogger.deprecated(LOCAL_DEPRECATED_MESSAGE);\n+        if (request.hasParam(\"local\") && Version.CURRENT.major == Version.V_7_0_0.major + 1) { // only needed in v8 to catch breaking usages", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "80f0241d8d7f706b08014f78c058c051306bc316"}, "originalPosition": 34}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzMwNTgyOQ==", "bodyText": "Wouldn't we want to assertTrue here so that this starts failing on the version bump and we can remove it instaed of having it live on as dead code in a skipped test?", "url": "https://github.com/elastic/elasticsearch/pull/50594#discussion_r363305829", "createdAt": "2020-01-06T14:04:36Z", "author": {"login": "original-brownbear"}, "path": "server/src/test/java/org/elasticsearch/rest/action/cat/RestNodesActionTests.java", "diffHunk": "@@ -69,15 +70,14 @@ public void testBuildTableDoesNotThrowGivenNullNodeInfoAndStats() {\n         action.buildTable(false, new FakeRestRequest(), clusterStateResponse, nodesInfoResponse, nodesStatsResponse);\n     }\n \n-    public void testCatNodesWithLocalDeprecationWarning() {\n+    public void testCatNodesRejectsLocalParameter() {\n+        assumeTrue(\"test is only needed in v8, can be removed in v9\", Version.CURRENT.major == Version.V_7_0_0.major + 1);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "80f0241d8d7f706b08014f78c058c051306bc316"}, "originalPosition": 14}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzM4NjYyOTcw", "url": "https://github.com/elastic/elasticsearch/pull/50594#pullrequestreview-338662970", "createdAt": "2020-01-06T14:11:16Z", "commit": {"oid": "80f0241d8d7f706b08014f78c058c051306bc316"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3964, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}