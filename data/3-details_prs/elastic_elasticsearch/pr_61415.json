{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDcxNjExNTMz", "number": 61415, "title": "Remove Potentially Expensive Use of BytesReference.toBytesRef", "bodyText": "This method might materialize all the bytes in a reference into a fresh byte[].\nUsing the stream is much safer and only trivially more expensive.\nOne example where this might cause trouble would be when checking if a some bytes are compressed (like for example in the BlobStoreRepository when used with compress set to false).", "createdAt": "2020-08-21T12:44:22Z", "url": "https://github.com/elastic/elasticsearch/pull/61415", "merged": true, "mergeCommit": {"oid": "a4a5fb13823e5cd7e4c300fd8c0aad116d91495f"}, "closed": true, "closedAt": "2020-08-24T19:39:04Z", "author": {"login": "original-brownbear"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdBEClQAH2gAyNDcxNjExNTMzOjU0MmQyODhhZjk1YzkwNWI5ZmIxNWNlZWJhNGZlM2QzYTNhMWE1MjA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdCHVEfAFqTQ3Mzc3MzkxMQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "542d288af95c905b9fb15ceeba4fe3d3a3a1a520", "author": {"user": {"login": "original-brownbear", "name": "Armin Braun"}}, "url": "https://github.com/elastic/elasticsearch/commit/542d288af95c905b9fb15ceeba4fe3d3a3a1a520", "committedDate": "2020-08-21T12:33:36Z", "message": "Remove Potentially Expensive Use of BytesReference.toBytesRef\n\nThis method might materialize all the bytes in a reference into a fresh `byte[]`.\nUsing the stream is much safer and only trivially more expensive."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDczNjAyMzAy", "url": "https://github.com/elastic/elasticsearch/pull/61415#pullrequestreview-473602302", "createdAt": "2020-08-24T15:16:46Z", "commit": {"oid": "542d288af95c905b9fb15ceeba4fe3d3a3a1a520"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNFQxNToxNjo0NlrOHFp8iA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNFQxNToxNjo0NlrOHFp8iA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTY5MjE2OA==", "bodyText": "We should probably catch and handle IllegalArgumentException in case the stream input doesn't support marking", "url": "https://github.com/elastic/elasticsearch/pull/61415#discussion_r475692168", "createdAt": "2020-08-24T15:16:46Z", "author": {"login": "jaymode"}, "path": "server/src/main/java/org/elasticsearch/common/xcontent/XContentHelper.java", "diffHunk": "@@ -380,8 +380,13 @@ public static BytesReference toXContent(ToXContent toXContent, XContentType xCon\n      */\n     @Deprecated\n     public static XContentType xContentType(BytesReference bytes) {\n-        BytesRef br = bytes.toBytesRef();\n-        return XContentFactory.xContentType(br.bytes, br.offset, br.length);\n+        try {\n+            final InputStream inputStream = bytes.streamInput();\n+            return XContentFactory.xContentType(inputStream);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "542d288af95c905b9fb15ceeba4fe3d3a3a1a520"}, "originalPosition": 24}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2eee242365b23b3cb0ae2906eab6c65910564a48", "author": {"user": {"login": "original-brownbear", "name": "Armin Braun"}}, "url": "https://github.com/elastic/elasticsearch/commit/2eee242365b23b3cb0ae2906eab6c65910564a48", "committedDate": "2020-08-24T18:46:26Z", "message": "Merge remote-tracking branch 'elastic/master' into cheaper-content-type-determination"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a4cc7e74acb11e92b6fdf5d2c40e88dbe5dfa6c4", "author": {"user": {"login": "original-brownbear", "name": "Armin Braun"}}, "url": "https://github.com/elastic/elasticsearch/commit/a4cc7e74acb11e92b6fdf5d2c40e88dbe5dfa6c4", "committedDate": "2020-08-24T18:52:11Z", "message": "faster and assertion"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDczNzczOTEx", "url": "https://github.com/elastic/elasticsearch/pull/61415#pullrequestreview-473773911", "createdAt": "2020-08-24T18:57:26Z", "commit": {"oid": "a4cc7e74acb11e92b6fdf5d2c40e88dbe5dfa6c4"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4630, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}