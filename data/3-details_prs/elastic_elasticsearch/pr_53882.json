{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzkxNjEwNTYw", "number": 53882, "title": "Add pre-configured \u201clowercase\u201d normalizer", "bodyText": "Simplify the common scenario of wanting to lower-case values.\nCloses #53872", "createdAt": "2020-03-20T15:57:23Z", "url": "https://github.com/elastic/elasticsearch/pull/53882", "merged": true, "mergeCommit": {"oid": "d83798f237aa27d4695d830bfe732ba82c83aa49"}, "closed": true, "closedAt": "2020-04-03T09:12:07Z", "author": {"login": "markharwood"}, "timelineItems": {"totalCount": 22, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcPkI1tgBqjMxNTAyOTMyNjU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcT8UMKABqjMxOTUzMDQ4MDI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a67a9a7b73ab20bfe03e991574f4c60e95fe3f4a", "author": {"user": {"login": "markharwood", "name": null}}, "url": "https://github.com/elastic/elasticsearch/commit/a67a9a7b73ab20bfe03e991574f4c60e95fe3f4a", "committedDate": "2020-03-20T17:01:31Z", "message": "Doc changes to reference new lowercase normalizer."}, "afterCommit": {"oid": "562a7301dfff96eb610ae87afc3cb61d0a2f56ec", "author": {"user": {"login": "markharwood", "name": null}}, "url": "https://github.com/elastic/elasticsearch/commit/562a7301dfff96eb610ae87afc3cb61d0a2f56ec", "committedDate": "2020-03-20T17:40:50Z", "message": "Doc changes to reference new lowercase normalizer."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc5NzI4Njc1", "url": "https://github.com/elastic/elasticsearch/pull/53882#pullrequestreview-379728675", "createdAt": "2020-03-23T18:56:21Z", "commit": {"oid": "562a7301dfff96eb610ae87afc3cb61d0a2f56ec"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QxODo1NjoyMVrOF6TtoA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QxOTowMjoyMVrOF6T7TQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjY4NDcwNA==", "bodyText": "Small note, this could just be TokenStream stream = new LowerCaseFilter(tokenizer);.", "url": "https://github.com/elastic/elasticsearch/pull/53882#discussion_r396684704", "createdAt": "2020-03-23T18:56:21Z", "author": {"login": "jtibshirani"}, "path": "server/src/main/java/org/elasticsearch/index/analysis/LowercaseNormalizer.java", "diffHunk": "@@ -0,0 +1,43 @@\n+/*\n+ * Licensed to Elasticsearch under one or more contributor\n+ * license agreements. See the NOTICE file distributed with\n+ * this work for additional information regarding copyright\n+ * ownership. Elasticsearch licenses this file to you under\n+ * the Apache License, Version 2.0 (the \"License\"); you may\n+ * not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *    http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.elasticsearch.index.analysis;\n+\n+import org.apache.lucene.analysis.Analyzer;\n+import org.apache.lucene.analysis.LowerCaseFilter;\n+import org.apache.lucene.analysis.TokenStream;\n+import org.apache.lucene.analysis.Tokenizer;\n+import org.apache.lucene.analysis.core.KeywordTokenizer;\n+\n+/** Normalizer used to lowercase values */\n+public final class LowercaseNormalizer extends Analyzer {\n+\n+    @Override\n+    protected TokenStreamComponents createComponents(String s) {\n+        final Tokenizer tokenizer = new KeywordTokenizer();\n+        TokenStream stream = tokenizer;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "562a7301dfff96eb610ae87afc3cb61d0a2f56ec"}, "originalPosition": 34}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjY4ODIwNQ==", "bodyText": "This looks like a typo, although it existed before your change too. I think it can just be \"Custom normalizers take a list of <<analysis-charfilters, character filters>> and ...\".", "url": "https://github.com/elastic/elasticsearch/pull/53882#discussion_r396688205", "createdAt": "2020-03-23T19:02:21Z", "author": {"login": "jtibshirani"}, "path": "docs/reference/analysis/normalizers.asciidoc", "diffHunk": "@@ -13,11 +13,13 @@ following: `arabic_normalization`, `asciifolding`, `bengali_normalization`,\n `persian_normalization`, `scandinavian_folding`, `serbian_normalization`,\n `sorani_normalization`, `uppercase`.\n \n+Elasticsearch ships with a `lowercase` built-in normalizer. For other forms of\n+normalization a custom configuration is required.\n+\n [float]\n === Custom normalizers\n \n-Elasticsearch does not ship with built-in normalizers so far, so the only way\n-to get one is by building a custom one. Custom normalizers take a list of char\n+Custom normalizers take a list of char", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "562a7301dfff96eb610ae87afc3cb61d0a2f56ec"}, "originalPosition": 12}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "562a7301dfff96eb610ae87afc3cb61d0a2f56ec", "author": {"user": {"login": "markharwood", "name": null}}, "url": "https://github.com/elastic/elasticsearch/commit/562a7301dfff96eb610ae87afc3cb61d0a2f56ec", "committedDate": "2020-03-20T17:40:50Z", "message": "Doc changes to reference new lowercase normalizer."}, "afterCommit": {"oid": "93c96725da3757a64ebe3b5641c156b51c6ffefc", "author": {"user": {"login": "markharwood", "name": null}}, "url": "https://github.com/elastic/elasticsearch/commit/93c96725da3757a64ebe3b5641c156b51c6ffefc", "committedDate": "2020-03-30T10:27:09Z", "message": "Address review comments - typo and test for new in-built normalizer"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "93c96725da3757a64ebe3b5641c156b51c6ffefc", "author": {"user": {"login": "markharwood", "name": null}}, "url": "https://github.com/elastic/elasticsearch/commit/93c96725da3757a64ebe3b5641c156b51c6ffefc", "committedDate": "2020-03-30T10:27:09Z", "message": "Address review comments - typo and test for new in-built normalizer"}, "afterCommit": {"oid": "814155567fc31749cd100a63ddf332516ed29012", "author": {"user": {"login": "markharwood", "name": null}}, "url": "https://github.com/elastic/elasticsearch/commit/814155567fc31749cd100a63ddf332516ed29012", "committedDate": "2020-03-30T11:10:24Z", "message": "Address review comments - typo and test for new in-built normalizer"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "814155567fc31749cd100a63ddf332516ed29012", "author": {"user": {"login": "markharwood", "name": null}}, "url": "https://github.com/elastic/elasticsearch/commit/814155567fc31749cd100a63ddf332516ed29012", "committedDate": "2020-03-30T11:10:24Z", "message": "Address review comments - typo and test for new in-built normalizer"}, "afterCommit": {"oid": "37a3d022c629f8f0dce9e8369ccb3734d7ab1572", "author": {"user": {"login": "markharwood", "name": null}}, "url": "https://github.com/elastic/elasticsearch/commit/37a3d022c629f8f0dce9e8369ccb3734d7ab1572", "committedDate": "2020-03-30T12:45:07Z", "message": "Address review comments - typo and test for new in-built normalizer"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "37a3d022c629f8f0dce9e8369ccb3734d7ab1572", "author": {"user": {"login": "markharwood", "name": null}}, "url": "https://github.com/elastic/elasticsearch/commit/37a3d022c629f8f0dce9e8369ccb3734d7ab1572", "committedDate": "2020-03-30T12:45:07Z", "message": "Address review comments - typo and test for new in-built normalizer"}, "afterCommit": {"oid": "9f07520ac69c824ae9acf844804e595d6e5f1cf0", "author": {"user": {"login": "markharwood", "name": null}}, "url": "https://github.com/elastic/elasticsearch/commit/9f07520ac69c824ae9acf844804e595d6e5f1cf0", "committedDate": "2020-03-30T13:48:51Z", "message": "Address review comments - typo and test for new in-built normalizer"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg0MjE5Mzk4", "url": "https://github.com/elastic/elasticsearch/pull/53882#pullrequestreview-384219398", "createdAt": "2020-03-30T20:49:47Z", "commit": {"oid": "9f07520ac69c824ae9acf844804e595d6e5f1cf0"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg1MDcwOTI4", "url": "https://github.com/elastic/elasticsearch/pull/53882#pullrequestreview-385070928", "createdAt": "2020-03-31T20:15:48Z", "commit": {"oid": "835b1f95b484b6be065f25b4c8112f8573e55c37"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMVQyMDo0MTo1N1rOF-nb1A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMVQyMDo0MTo1N1rOF-nb1A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTIwMjEzMg==", "bodyText": "I think it'd make sense for this check to live in AnalysisRegistryTests, because it is really testing our analyzer registration behavior instead of anything specific to the keyword field mapper. I took a look and it seems straightforward to add a test there.", "url": "https://github.com/elastic/elasticsearch/pull/53882#discussion_r401202132", "createdAt": "2020-03-31T20:41:57Z", "author": {"login": "jtibshirani"}, "path": "server/src/test/java/org/elasticsearch/index/mapper/KeywordFieldMapperTests.java", "diffHunk": "@@ -381,6 +391,54 @@ public void testNormalizer() throws IOException {\n         assertThat(fieldType.indexOptions(), equalTo(IndexOptions.NONE));\n         assertEquals(DocValuesType.SORTED_SET, fieldType.docValuesType());\n     }\n+    \n+    // Test that a name clash with a custom normalizer will favour the index's normalizer rather than the out-of-the-box \n+    // one of the same name. (However this \"feature\" will be removed with https://github.com/elastic/elasticsearch/issues/22263 ) \n+    public void testNameClashNormalizer() throws IOException {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "835b1f95b484b6be065f25b4c8112f8573e55c37"}, "originalPosition": 61}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "44a587a7d896708b5dc2ba4f6dfd553a0910c690", "author": {"user": {"login": "markharwood", "name": null}}, "url": "https://github.com/elastic/elasticsearch/commit/44a587a7d896708b5dc2ba4f6dfd553a0910c690", "committedDate": "2020-04-01T10:44:52Z", "message": "Shifted name-clash test logic from KeywordFieldMapperTests to AnalysisRegistryTests"}, "afterCommit": {"oid": "7125f23fb46b061f1d4c8a7fb599651d2a6df184", "author": {"user": {"login": "markharwood", "name": null}}, "url": "https://github.com/elastic/elasticsearch/commit/7125f23fb46b061f1d4c8a7fb599651d2a6df184", "committedDate": "2020-04-01T12:34:32Z", "message": "Shifted name-clash test logic from KeywordFieldMapperTests to AnalysisRegistryTests"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7125f23fb46b061f1d4c8a7fb599651d2a6df184", "author": {"user": {"login": "markharwood", "name": null}}, "url": "https://github.com/elastic/elasticsearch/commit/7125f23fb46b061f1d4c8a7fb599651d2a6df184", "committedDate": "2020-04-01T12:34:32Z", "message": "Shifted name-clash test logic from KeywordFieldMapperTests to AnalysisRegistryTests"}, "afterCommit": {"oid": "de9f454587829667639bf0557a59bc22410844b4", "author": {"user": {"login": "markharwood", "name": null}}, "url": "https://github.com/elastic/elasticsearch/commit/de9f454587829667639bf0557a59bc22410844b4", "committedDate": "2020-04-01T14:09:57Z", "message": "Shifted name-clash test logic from KeywordFieldMapperTests to AnalysisRegistryTests"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "de9f454587829667639bf0557a59bc22410844b4", "author": {"user": {"login": "markharwood", "name": null}}, "url": "https://github.com/elastic/elasticsearch/commit/de9f454587829667639bf0557a59bc22410844b4", "committedDate": "2020-04-01T14:09:57Z", "message": "Shifted name-clash test logic from KeywordFieldMapperTests to AnalysisRegistryTests"}, "afterCommit": {"oid": "5387a514debd5455ac15772d13d28564ce38a54e", "author": {"user": {"login": "markharwood", "name": null}}, "url": "https://github.com/elastic/elasticsearch/commit/5387a514debd5455ac15772d13d28564ce38a54e", "committedDate": "2020-04-01T15:35:51Z", "message": "Shifted name-clash test logic from KeywordFieldMapperTests to AnalysisRegistryTests"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg1NzExODg3", "url": "https://github.com/elastic/elasticsearch/pull/53882#pullrequestreview-385711887", "createdAt": "2020-04-01T15:42:28Z", "commit": {"oid": "5387a514debd5455ac15772d13d28564ce38a54e"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMVQxNTo0MjoyOFrOF_Gvwg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMVQxNTo0MjoyOFrOF_Gvwg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTcxNTEzOA==", "bodyText": "Super small comment, extra whitespace.", "url": "https://github.com/elastic/elasticsearch/pull/53882#discussion_r401715138", "createdAt": "2020-04-01T15:42:28Z", "author": {"login": "jtibshirani"}, "path": "server/src/test/java/org/elasticsearch/index/mapper/KeywordFieldMapperTests.java", "diffHunk": "@@ -381,7 +389,7 @@ public void testNormalizer() throws IOException {\n         assertThat(fieldType.indexOptions(), equalTo(IndexOptions.NONE));\n         assertEquals(DocValuesType.SORTED_SET, fieldType.docValuesType());\n     }\n-\n+    ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5387a514debd5455ac15772d13d28564ce38a54e"}, "originalPosition": 26}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "5387a514debd5455ac15772d13d28564ce38a54e", "author": {"user": {"login": "markharwood", "name": null}}, "url": "https://github.com/elastic/elasticsearch/commit/5387a514debd5455ac15772d13d28564ce38a54e", "committedDate": "2020-04-01T15:35:51Z", "message": "Shifted name-clash test logic from KeywordFieldMapperTests to AnalysisRegistryTests"}, "afterCommit": {"oid": "5a411ee699be3491cf73169a9d17bfe83b068de2", "author": {"user": {"login": "markharwood", "name": null}}, "url": "https://github.com/elastic/elasticsearch/commit/5a411ee699be3491cf73169a9d17bfe83b068de2", "committedDate": "2020-04-01T16:18:36Z", "message": "Shifted name-clash test logic from KeywordFieldMapperTests to AnalysisRegistryTests"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "65798a62ba3d746463d525bb6d8f5bacc77ac330", "author": {"user": {"login": "markharwood", "name": null}}, "url": "https://github.com/elastic/elasticsearch/commit/65798a62ba3d746463d525bb6d8f5bacc77ac330", "committedDate": "2020-04-01T17:05:48Z", "message": "Whitespace fix"}, "afterCommit": {"oid": "e8e7f83ed4a4a052743ac0ce697629179b780841", "author": {"user": {"login": "markharwood", "name": null}}, "url": "https://github.com/elastic/elasticsearch/commit/e8e7f83ed4a4a052743ac0ce697629179b780841", "committedDate": "2020-04-02T16:21:45Z", "message": "Reverse this comment now that we\u2019re introducing lowercase normalizer first in 7x"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "56731ca2d89ee3dcd3821a11908bc70a788c54e9", "author": {"user": {"login": "markharwood", "name": null}}, "url": "https://github.com/elastic/elasticsearch/commit/56731ca2d89ee3dcd3821a11908bc70a788c54e9", "committedDate": "2020-04-03T08:06:49Z", "message": "Add pre-configured \u201clowercase\u201d normalizer\n\nCloses #53872"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "67da5d4fdcfacfb2d860b0047e62f4a71c3cff99", "author": {"user": {"login": "markharwood", "name": null}}, "url": "https://github.com/elastic/elasticsearch/commit/67da5d4fdcfacfb2d860b0047e62f4a71c3cff99", "committedDate": "2020-04-03T08:06:49Z", "message": "Doc changes to reference new lowercase normalizer."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cb86000148b2d74efced59c8575aaddb588a9930", "author": {"user": {"login": "markharwood", "name": null}}, "url": "https://github.com/elastic/elasticsearch/commit/cb86000148b2d74efced59c8575aaddb588a9930", "committedDate": "2020-04-03T08:06:49Z", "message": "Address review comments - typo and test for new in-built normalizer"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b58b2b7d36e9a0ec776a8d46265c03d91021760c", "author": {"user": {"login": "markharwood", "name": null}}, "url": "https://github.com/elastic/elasticsearch/commit/b58b2b7d36e9a0ec776a8d46265c03d91021760c", "committedDate": "2020-04-03T08:06:49Z", "message": "Added name-clash test for normalizer, migration change and removed superfluous TODO."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e4962a7d42eef5f9d5b03c461342a12b7557f714", "author": {"user": {"login": "markharwood", "name": null}}, "url": "https://github.com/elastic/elasticsearch/commit/e4962a7d42eef5f9d5b03c461342a12b7557f714", "committedDate": "2020-04-03T08:06:49Z", "message": "Shifted name-clash test logic from KeywordFieldMapperTests to AnalysisRegistryTests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a6d319b29a53801315785060d90a74b88d767aef", "author": {"user": {"login": "markharwood", "name": null}}, "url": "https://github.com/elastic/elasticsearch/commit/a6d319b29a53801315785060d90a74b88d767aef", "committedDate": "2020-04-03T08:06:49Z", "message": "Whitespace fix"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "88f5f72b766f78073ac49b8fb5928112b8f523c9", "author": {"user": {"login": "markharwood", "name": null}}, "url": "https://github.com/elastic/elasticsearch/commit/88f5f72b766f78073ac49b8fb5928112b8f523c9", "committedDate": "2020-04-03T08:06:50Z", "message": "Reverse this comment now that we\u2019re introducing lowercase normalizer first in 7x"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e8e7f83ed4a4a052743ac0ce697629179b780841", "author": {"user": {"login": "markharwood", "name": null}}, "url": "https://github.com/elastic/elasticsearch/commit/e8e7f83ed4a4a052743ac0ce697629179b780841", "committedDate": "2020-04-02T16:21:45Z", "message": "Reverse this comment now that we\u2019re introducing lowercase normalizer first in 7x"}, "afterCommit": {"oid": "88f5f72b766f78073ac49b8fb5928112b8f523c9", "author": {"user": {"login": "markharwood", "name": null}}, "url": "https://github.com/elastic/elasticsearch/commit/88f5f72b766f78073ac49b8fb5928112b8f523c9", "committedDate": "2020-04-03T08:06:50Z", "message": "Reverse this comment now that we\u2019re introducing lowercase normalizer first in 7x"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1927, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}