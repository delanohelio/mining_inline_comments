{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY4MDAxNzI4", "number": 51529, "reviewThreads": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0zMVQxMToyMDoxMFrODcNQQw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0zMVQxMTo0NDo1MFrODcNmDA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMwOTAzODc1OnYy", "diffSide": "RIGHT", "path": "x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/rest/cat/RestCatTrainedModelsAction.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0zMVQxMToyMDoxMFrOFkIghQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0zMVQxMTo1NjoxOFrOFkJRgA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzQzMjQ1Mw==", "bodyText": "This is the only cat action that supports paging", "url": "https://github.com/elastic/elasticsearch/pull/51529#discussion_r373432453", "createdAt": "2020-01-31T11:20:10Z", "author": {"login": "davidkyle"}, "path": "x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/rest/cat/RestCatTrainedModelsAction.java", "diffHunk": "@@ -0,0 +1,262 @@\n+/*\n+ * Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one\n+ * or more contributor license agreements. Licensed under the Elastic License;\n+ * you may not use this file except in compliance with the Elastic License.\n+ */\n+package org.elasticsearch.xpack.ml.rest.cat;\n+\n+import org.apache.logging.log4j.LogManager;\n+import org.apache.logging.log4j.Logger;\n+import org.elasticsearch.action.ActionListener;\n+import org.elasticsearch.action.ActionResponse;\n+import org.elasticsearch.action.support.GroupedActionListener;\n+import org.elasticsearch.client.node.NodeClient;\n+import org.elasticsearch.cluster.metadata.MetaData;\n+import org.elasticsearch.common.Strings;\n+import org.elasticsearch.common.Table;\n+import org.elasticsearch.common.unit.ByteSizeValue;\n+import org.elasticsearch.common.unit.TimeValue;\n+import org.elasticsearch.rest.RestController;\n+import org.elasticsearch.rest.RestRequest;\n+import org.elasticsearch.rest.RestResponse;\n+import org.elasticsearch.rest.action.RestResponseListener;\n+import org.elasticsearch.rest.action.cat.AbstractCatAction;\n+import org.elasticsearch.rest.action.cat.RestTable;\n+import org.elasticsearch.xpack.core.action.util.PageParams;\n+import org.elasticsearch.xpack.core.ml.action.GetDataFrameAnalyticsAction;\n+import org.elasticsearch.xpack.core.ml.action.GetTrainedModelsAction;\n+import org.elasticsearch.xpack.core.ml.action.GetTrainedModelsStatsAction;\n+import org.elasticsearch.xpack.core.ml.dataframe.DataFrameAnalyticsConfig;\n+import org.elasticsearch.xpack.core.ml.inference.TrainedModelConfig;\n+import org.elasticsearch.xpack.core.security.user.XPackUser;\n+\n+import java.util.Collection;\n+import java.util.Collections;\n+import java.util.HashSet;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Set;\n+import java.util.function.Function;\n+import java.util.stream.Collectors;\n+\n+import static org.elasticsearch.rest.RestRequest.Method.GET;\n+import static org.elasticsearch.xpack.core.ml.action.GetTrainedModelsAction.Request.ALLOW_NO_MATCH;\n+\n+public class RestCatTrainedModelsAction extends AbstractCatAction {\n+\n+    private static final Logger logger = LogManager.getLogger(RestCatTrainedModelsAction.class);\n+\n+    public RestCatTrainedModelsAction(RestController controller) {\n+        controller.registerHandler(GET, \"_cat/ml/trained_models/{\" + TrainedModelConfig.MODEL_ID.getPreferredName() + \"}\", this);\n+        controller.registerHandler(GET, \"_cat/ml/trained_models\", this);\n+    }\n+\n+    @Override\n+    public String getName() {\n+        return \"cat_ml_get_trained_models_action\";\n+    }\n+\n+    @Override\n+    protected RestChannelConsumer doCatRequest(RestRequest restRequest, NodeClient client) {\n+        String modelId = restRequest.param(TrainedModelConfig.MODEL_ID.getPreferredName());\n+        if (Strings.isNullOrEmpty(modelId)) {\n+            modelId = MetaData.ALL;\n+        }\n+        GetTrainedModelsStatsAction.Request statsRequest = new GetTrainedModelsStatsAction.Request(modelId);\n+        GetTrainedModelsAction.Request modelsAction = new GetTrainedModelsAction.Request(modelId, false, null);\n+        if (restRequest.hasParam(PageParams.FROM.getPreferredName()) || restRequest.hasParam(PageParams.SIZE.getPreferredName())) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "250a1147634825bd8921bc3c3ad7844ddad9e112"}, "originalPosition": 67}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzQ0NDk5Mg==", "bodyText": "Correct, and it probably should as there is a limit of 10K when reading configs from an index.\nOur _cat APIs are the only ones that return data that are stored in indices (i think)", "url": "https://github.com/elastic/elasticsearch/pull/51529#discussion_r373444992", "createdAt": "2020-01-31T11:56:18Z", "author": {"login": "benwtrent"}, "path": "x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/rest/cat/RestCatTrainedModelsAction.java", "diffHunk": "@@ -0,0 +1,262 @@\n+/*\n+ * Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one\n+ * or more contributor license agreements. Licensed under the Elastic License;\n+ * you may not use this file except in compliance with the Elastic License.\n+ */\n+package org.elasticsearch.xpack.ml.rest.cat;\n+\n+import org.apache.logging.log4j.LogManager;\n+import org.apache.logging.log4j.Logger;\n+import org.elasticsearch.action.ActionListener;\n+import org.elasticsearch.action.ActionResponse;\n+import org.elasticsearch.action.support.GroupedActionListener;\n+import org.elasticsearch.client.node.NodeClient;\n+import org.elasticsearch.cluster.metadata.MetaData;\n+import org.elasticsearch.common.Strings;\n+import org.elasticsearch.common.Table;\n+import org.elasticsearch.common.unit.ByteSizeValue;\n+import org.elasticsearch.common.unit.TimeValue;\n+import org.elasticsearch.rest.RestController;\n+import org.elasticsearch.rest.RestRequest;\n+import org.elasticsearch.rest.RestResponse;\n+import org.elasticsearch.rest.action.RestResponseListener;\n+import org.elasticsearch.rest.action.cat.AbstractCatAction;\n+import org.elasticsearch.rest.action.cat.RestTable;\n+import org.elasticsearch.xpack.core.action.util.PageParams;\n+import org.elasticsearch.xpack.core.ml.action.GetDataFrameAnalyticsAction;\n+import org.elasticsearch.xpack.core.ml.action.GetTrainedModelsAction;\n+import org.elasticsearch.xpack.core.ml.action.GetTrainedModelsStatsAction;\n+import org.elasticsearch.xpack.core.ml.dataframe.DataFrameAnalyticsConfig;\n+import org.elasticsearch.xpack.core.ml.inference.TrainedModelConfig;\n+import org.elasticsearch.xpack.core.security.user.XPackUser;\n+\n+import java.util.Collection;\n+import java.util.Collections;\n+import java.util.HashSet;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Set;\n+import java.util.function.Function;\n+import java.util.stream.Collectors;\n+\n+import static org.elasticsearch.rest.RestRequest.Method.GET;\n+import static org.elasticsearch.xpack.core.ml.action.GetTrainedModelsAction.Request.ALLOW_NO_MATCH;\n+\n+public class RestCatTrainedModelsAction extends AbstractCatAction {\n+\n+    private static final Logger logger = LogManager.getLogger(RestCatTrainedModelsAction.class);\n+\n+    public RestCatTrainedModelsAction(RestController controller) {\n+        controller.registerHandler(GET, \"_cat/ml/trained_models/{\" + TrainedModelConfig.MODEL_ID.getPreferredName() + \"}\", this);\n+        controller.registerHandler(GET, \"_cat/ml/trained_models\", this);\n+    }\n+\n+    @Override\n+    public String getName() {\n+        return \"cat_ml_get_trained_models_action\";\n+    }\n+\n+    @Override\n+    protected RestChannelConsumer doCatRequest(RestRequest restRequest, NodeClient client) {\n+        String modelId = restRequest.param(TrainedModelConfig.MODEL_ID.getPreferredName());\n+        if (Strings.isNullOrEmpty(modelId)) {\n+            modelId = MetaData.ALL;\n+        }\n+        GetTrainedModelsStatsAction.Request statsRequest = new GetTrainedModelsStatsAction.Request(modelId);\n+        GetTrainedModelsAction.Request modelsAction = new GetTrainedModelsAction.Request(modelId, false, null);\n+        if (restRequest.hasParam(PageParams.FROM.getPreferredName()) || restRequest.hasParam(PageParams.SIZE.getPreferredName())) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzQzMjQ1Mw=="}, "originalCommit": {"oid": "250a1147634825bd8921bc3c3ad7844ddad9e112"}, "originalPosition": 67}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMwOTA0NDgzOnYy", "diffSide": "RIGHT", "path": "x-pack/plugin/src/test/resources/rest-api-spec/api/cat.ml.trained_models.json", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0zMVQxMToyMjoyNVrOFkIkBw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0zMVQxMTo1NzowOVrOFkJSpQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzQzMzM1MQ==", "bodyText": "cat indices does not have the allow_no_indices option. Is this conventional?", "url": "https://github.com/elastic/elasticsearch/pull/51529#discussion_r373433351", "createdAt": "2020-01-31T11:22:25Z", "author": {"login": "davidkyle"}, "path": "x-pack/plugin/src/test/resources/rest-api-spec/api/cat.ml.trained_models.json", "diffHunk": "@@ -0,0 +1,100 @@\n+{\n+  \"cat.ml.trained_models\":{\n+    \"documentation\":{\n+      \"url\":\"https://www.elastic.co/guide/en/elasticsearch/reference/current/get-inference-stats.html\"\n+    },\n+    \"stability\":\"stable\",\n+    \"url\":{\n+      \"paths\":[\n+        {\n+          \"path\":\"/_cat/ml/trained_models\",\n+          \"methods\":[\n+            \"GET\"\n+          ]\n+        },\n+        {\n+          \"path\":\"/_cat/ml/trained_models/{model_id}\",\n+          \"methods\":[\n+            \"GET\"\n+          ],\n+          \"parts\":{\n+            \"model_id\":{\n+              \"type\":\"string\",\n+              \"description\":\"The ID of the trained models stats to fetch\"\n+            }\n+          }\n+        }\n+      ]\n+    },\n+    \"params\":{\n+      \"allow_no_match\":{", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "250a1147634825bd8921bc3c3ad7844ddad9e112"}, "originalPosition": 30}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzQ0NTI4NQ==", "bodyText": "This matches up with our GET <resource> pattern.\nI could remove the option and make it always true.", "url": "https://github.com/elastic/elasticsearch/pull/51529#discussion_r373445285", "createdAt": "2020-01-31T11:57:09Z", "author": {"login": "benwtrent"}, "path": "x-pack/plugin/src/test/resources/rest-api-spec/api/cat.ml.trained_models.json", "diffHunk": "@@ -0,0 +1,100 @@\n+{\n+  \"cat.ml.trained_models\":{\n+    \"documentation\":{\n+      \"url\":\"https://www.elastic.co/guide/en/elasticsearch/reference/current/get-inference-stats.html\"\n+    },\n+    \"stability\":\"stable\",\n+    \"url\":{\n+      \"paths\":[\n+        {\n+          \"path\":\"/_cat/ml/trained_models\",\n+          \"methods\":[\n+            \"GET\"\n+          ]\n+        },\n+        {\n+          \"path\":\"/_cat/ml/trained_models/{model_id}\",\n+          \"methods\":[\n+            \"GET\"\n+          ],\n+          \"parts\":{\n+            \"model_id\":{\n+              \"type\":\"string\",\n+              \"description\":\"The ID of the trained models stats to fetch\"\n+            }\n+          }\n+        }\n+      ]\n+    },\n+    \"params\":{\n+      \"allow_no_match\":{", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzQzMzM1MQ=="}, "originalCommit": {"oid": "250a1147634825bd8921bc3c3ad7844ddad9e112"}, "originalPosition": 30}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMwOTA1MzA4OnYy", "diffSide": "RIGHT", "path": "x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/rest/cat/RestCatTrainedModelsAction.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0zMVQxMToyNTo1NVrOFkIo3g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0zMVQxMjowNzoyNFrOFkJgLA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzQzNDU5MA==", "bodyText": "I think we want a better way of differentiating user models and DFA models in the future. Maybe a reserved tag for DFA models", "url": "https://github.com/elastic/elasticsearch/pull/51529#discussion_r373434590", "createdAt": "2020-01-31T11:25:55Z", "author": {"login": "davidkyle"}, "path": "x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/rest/cat/RestCatTrainedModelsAction.java", "diffHunk": "@@ -0,0 +1,262 @@\n+/*\n+ * Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one\n+ * or more contributor license agreements. Licensed under the Elastic License;\n+ * you may not use this file except in compliance with the Elastic License.\n+ */\n+package org.elasticsearch.xpack.ml.rest.cat;\n+\n+import org.apache.logging.log4j.LogManager;\n+import org.apache.logging.log4j.Logger;\n+import org.elasticsearch.action.ActionListener;\n+import org.elasticsearch.action.ActionResponse;\n+import org.elasticsearch.action.support.GroupedActionListener;\n+import org.elasticsearch.client.node.NodeClient;\n+import org.elasticsearch.cluster.metadata.MetaData;\n+import org.elasticsearch.common.Strings;\n+import org.elasticsearch.common.Table;\n+import org.elasticsearch.common.unit.ByteSizeValue;\n+import org.elasticsearch.common.unit.TimeValue;\n+import org.elasticsearch.rest.RestController;\n+import org.elasticsearch.rest.RestRequest;\n+import org.elasticsearch.rest.RestResponse;\n+import org.elasticsearch.rest.action.RestResponseListener;\n+import org.elasticsearch.rest.action.cat.AbstractCatAction;\n+import org.elasticsearch.rest.action.cat.RestTable;\n+import org.elasticsearch.xpack.core.action.util.PageParams;\n+import org.elasticsearch.xpack.core.ml.action.GetDataFrameAnalyticsAction;\n+import org.elasticsearch.xpack.core.ml.action.GetTrainedModelsAction;\n+import org.elasticsearch.xpack.core.ml.action.GetTrainedModelsStatsAction;\n+import org.elasticsearch.xpack.core.ml.dataframe.DataFrameAnalyticsConfig;\n+import org.elasticsearch.xpack.core.ml.inference.TrainedModelConfig;\n+import org.elasticsearch.xpack.core.security.user.XPackUser;\n+\n+import java.util.Collection;\n+import java.util.Collections;\n+import java.util.HashSet;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Set;\n+import java.util.function.Function;\n+import java.util.stream.Collectors;\n+\n+import static org.elasticsearch.rest.RestRequest.Method.GET;\n+import static org.elasticsearch.xpack.core.ml.action.GetTrainedModelsAction.Request.ALLOW_NO_MATCH;\n+\n+public class RestCatTrainedModelsAction extends AbstractCatAction {\n+\n+    private static final Logger logger = LogManager.getLogger(RestCatTrainedModelsAction.class);\n+\n+    public RestCatTrainedModelsAction(RestController controller) {\n+        controller.registerHandler(GET, \"_cat/ml/trained_models/{\" + TrainedModelConfig.MODEL_ID.getPreferredName() + \"}\", this);\n+        controller.registerHandler(GET, \"_cat/ml/trained_models\", this);\n+    }\n+\n+    @Override\n+    public String getName() {\n+        return \"cat_ml_get_trained_models_action\";\n+    }\n+\n+    @Override\n+    protected RestChannelConsumer doCatRequest(RestRequest restRequest, NodeClient client) {\n+        String modelId = restRequest.param(TrainedModelConfig.MODEL_ID.getPreferredName());\n+        if (Strings.isNullOrEmpty(modelId)) {\n+            modelId = MetaData.ALL;\n+        }\n+        GetTrainedModelsStatsAction.Request statsRequest = new GetTrainedModelsStatsAction.Request(modelId);\n+        GetTrainedModelsAction.Request modelsAction = new GetTrainedModelsAction.Request(modelId, false, null);\n+        if (restRequest.hasParam(PageParams.FROM.getPreferredName()) || restRequest.hasParam(PageParams.SIZE.getPreferredName())) {\n+            statsRequest.setPageParams(new PageParams(restRequest.paramAsInt(PageParams.FROM.getPreferredName(), PageParams.DEFAULT_FROM),\n+                restRequest.paramAsInt(PageParams.SIZE.getPreferredName(), PageParams.DEFAULT_SIZE)));\n+            modelsAction.setPageParams(new PageParams(restRequest.paramAsInt(PageParams.FROM.getPreferredName(), PageParams.DEFAULT_FROM),\n+                restRequest.paramAsInt(PageParams.SIZE.getPreferredName(), PageParams.DEFAULT_SIZE)));\n+        }\n+        statsRequest.setAllowNoResources(restRequest.paramAsBoolean(ALLOW_NO_MATCH.getPreferredName(),\n+            statsRequest.isAllowNoResources()));\n+        modelsAction.setAllowNoResources(restRequest.paramAsBoolean(ALLOW_NO_MATCH.getPreferredName(),\n+            statsRequest.isAllowNoResources()));\n+\n+        return channel -> {\n+            final ActionListener<Table> listener = ActionListener.notifyOnce(new RestResponseListener<>(channel) {\n+                @Override\n+                public RestResponse buildResponse(final Table table) throws Exception {\n+                    return RestTable.buildResponse(table, channel);\n+                }\n+            });\n+\n+            client.execute(GetTrainedModelsAction.INSTANCE, modelsAction, ActionListener.wrap(\n+                trainedModels -> {\n+                    final List<TrainedModelConfig> trainedModelConfigs = trainedModels.getResources().results();\n+\n+                    Set<String> potentialAnalyticsIds = new HashSet<>();\n+                    // Analytics Configs are created by the XPackUser\n+                    trainedModelConfigs.stream()\n+                        .filter(c -> XPackUser.NAME.equals(c.getCreatedBy()))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "250a1147634825bd8921bc3c3ad7844ddad9e112"}, "originalPosition": 93}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzQ0ODc0OA==", "bodyText": "@davidkyle possibly. Users cannot set the created_by, and XPackUser.NAME is a reserved name.\nBut I see your point for models we provide as a resource. Those weren't created by a DFA.", "url": "https://github.com/elastic/elasticsearch/pull/51529#discussion_r373448748", "createdAt": "2020-01-31T12:07:24Z", "author": {"login": "benwtrent"}, "path": "x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/rest/cat/RestCatTrainedModelsAction.java", "diffHunk": "@@ -0,0 +1,262 @@\n+/*\n+ * Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one\n+ * or more contributor license agreements. Licensed under the Elastic License;\n+ * you may not use this file except in compliance with the Elastic License.\n+ */\n+package org.elasticsearch.xpack.ml.rest.cat;\n+\n+import org.apache.logging.log4j.LogManager;\n+import org.apache.logging.log4j.Logger;\n+import org.elasticsearch.action.ActionListener;\n+import org.elasticsearch.action.ActionResponse;\n+import org.elasticsearch.action.support.GroupedActionListener;\n+import org.elasticsearch.client.node.NodeClient;\n+import org.elasticsearch.cluster.metadata.MetaData;\n+import org.elasticsearch.common.Strings;\n+import org.elasticsearch.common.Table;\n+import org.elasticsearch.common.unit.ByteSizeValue;\n+import org.elasticsearch.common.unit.TimeValue;\n+import org.elasticsearch.rest.RestController;\n+import org.elasticsearch.rest.RestRequest;\n+import org.elasticsearch.rest.RestResponse;\n+import org.elasticsearch.rest.action.RestResponseListener;\n+import org.elasticsearch.rest.action.cat.AbstractCatAction;\n+import org.elasticsearch.rest.action.cat.RestTable;\n+import org.elasticsearch.xpack.core.action.util.PageParams;\n+import org.elasticsearch.xpack.core.ml.action.GetDataFrameAnalyticsAction;\n+import org.elasticsearch.xpack.core.ml.action.GetTrainedModelsAction;\n+import org.elasticsearch.xpack.core.ml.action.GetTrainedModelsStatsAction;\n+import org.elasticsearch.xpack.core.ml.dataframe.DataFrameAnalyticsConfig;\n+import org.elasticsearch.xpack.core.ml.inference.TrainedModelConfig;\n+import org.elasticsearch.xpack.core.security.user.XPackUser;\n+\n+import java.util.Collection;\n+import java.util.Collections;\n+import java.util.HashSet;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Set;\n+import java.util.function.Function;\n+import java.util.stream.Collectors;\n+\n+import static org.elasticsearch.rest.RestRequest.Method.GET;\n+import static org.elasticsearch.xpack.core.ml.action.GetTrainedModelsAction.Request.ALLOW_NO_MATCH;\n+\n+public class RestCatTrainedModelsAction extends AbstractCatAction {\n+\n+    private static final Logger logger = LogManager.getLogger(RestCatTrainedModelsAction.class);\n+\n+    public RestCatTrainedModelsAction(RestController controller) {\n+        controller.registerHandler(GET, \"_cat/ml/trained_models/{\" + TrainedModelConfig.MODEL_ID.getPreferredName() + \"}\", this);\n+        controller.registerHandler(GET, \"_cat/ml/trained_models\", this);\n+    }\n+\n+    @Override\n+    public String getName() {\n+        return \"cat_ml_get_trained_models_action\";\n+    }\n+\n+    @Override\n+    protected RestChannelConsumer doCatRequest(RestRequest restRequest, NodeClient client) {\n+        String modelId = restRequest.param(TrainedModelConfig.MODEL_ID.getPreferredName());\n+        if (Strings.isNullOrEmpty(modelId)) {\n+            modelId = MetaData.ALL;\n+        }\n+        GetTrainedModelsStatsAction.Request statsRequest = new GetTrainedModelsStatsAction.Request(modelId);\n+        GetTrainedModelsAction.Request modelsAction = new GetTrainedModelsAction.Request(modelId, false, null);\n+        if (restRequest.hasParam(PageParams.FROM.getPreferredName()) || restRequest.hasParam(PageParams.SIZE.getPreferredName())) {\n+            statsRequest.setPageParams(new PageParams(restRequest.paramAsInt(PageParams.FROM.getPreferredName(), PageParams.DEFAULT_FROM),\n+                restRequest.paramAsInt(PageParams.SIZE.getPreferredName(), PageParams.DEFAULT_SIZE)));\n+            modelsAction.setPageParams(new PageParams(restRequest.paramAsInt(PageParams.FROM.getPreferredName(), PageParams.DEFAULT_FROM),\n+                restRequest.paramAsInt(PageParams.SIZE.getPreferredName(), PageParams.DEFAULT_SIZE)));\n+        }\n+        statsRequest.setAllowNoResources(restRequest.paramAsBoolean(ALLOW_NO_MATCH.getPreferredName(),\n+            statsRequest.isAllowNoResources()));\n+        modelsAction.setAllowNoResources(restRequest.paramAsBoolean(ALLOW_NO_MATCH.getPreferredName(),\n+            statsRequest.isAllowNoResources()));\n+\n+        return channel -> {\n+            final ActionListener<Table> listener = ActionListener.notifyOnce(new RestResponseListener<>(channel) {\n+                @Override\n+                public RestResponse buildResponse(final Table table) throws Exception {\n+                    return RestTable.buildResponse(table, channel);\n+                }\n+            });\n+\n+            client.execute(GetTrainedModelsAction.INSTANCE, modelsAction, ActionListener.wrap(\n+                trainedModels -> {\n+                    final List<TrainedModelConfig> trainedModelConfigs = trainedModels.getResources().results();\n+\n+                    Set<String> potentialAnalyticsIds = new HashSet<>();\n+                    // Analytics Configs are created by the XPackUser\n+                    trainedModelConfigs.stream()\n+                        .filter(c -> XPackUser.NAME.equals(c.getCreatedBy()))", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzQzNDU5MA=="}, "originalCommit": {"oid": "250a1147634825bd8921bc3c3ad7844ddad9e112"}, "originalPosition": 93}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMwOTA4NDUyOnYy", "diffSide": "RIGHT", "path": "x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/rest/cat/RestCatTrainedModelsAction.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0zMVQxMTozOTo0OVrOFkI79w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0zMVQxMjoyMTozNFrOFkJzzw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzQzOTQ3OQ==", "bodyText": "Do you need the wrap?", "url": "https://github.com/elastic/elasticsearch/pull/51529#discussion_r373439479", "createdAt": "2020-01-31T11:39:49Z", "author": {"login": "davidkyle"}, "path": "x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/rest/cat/RestCatTrainedModelsAction.java", "diffHunk": "@@ -0,0 +1,262 @@\n+/*\n+ * Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one\n+ * or more contributor license agreements. Licensed under the Elastic License;\n+ * you may not use this file except in compliance with the Elastic License.\n+ */\n+package org.elasticsearch.xpack.ml.rest.cat;\n+\n+import org.apache.logging.log4j.LogManager;\n+import org.apache.logging.log4j.Logger;\n+import org.elasticsearch.action.ActionListener;\n+import org.elasticsearch.action.ActionResponse;\n+import org.elasticsearch.action.support.GroupedActionListener;\n+import org.elasticsearch.client.node.NodeClient;\n+import org.elasticsearch.cluster.metadata.MetaData;\n+import org.elasticsearch.common.Strings;\n+import org.elasticsearch.common.Table;\n+import org.elasticsearch.common.unit.ByteSizeValue;\n+import org.elasticsearch.common.unit.TimeValue;\n+import org.elasticsearch.rest.RestController;\n+import org.elasticsearch.rest.RestRequest;\n+import org.elasticsearch.rest.RestResponse;\n+import org.elasticsearch.rest.action.RestResponseListener;\n+import org.elasticsearch.rest.action.cat.AbstractCatAction;\n+import org.elasticsearch.rest.action.cat.RestTable;\n+import org.elasticsearch.xpack.core.action.util.PageParams;\n+import org.elasticsearch.xpack.core.ml.action.GetDataFrameAnalyticsAction;\n+import org.elasticsearch.xpack.core.ml.action.GetTrainedModelsAction;\n+import org.elasticsearch.xpack.core.ml.action.GetTrainedModelsStatsAction;\n+import org.elasticsearch.xpack.core.ml.dataframe.DataFrameAnalyticsConfig;\n+import org.elasticsearch.xpack.core.ml.inference.TrainedModelConfig;\n+import org.elasticsearch.xpack.core.security.user.XPackUser;\n+\n+import java.util.Collection;\n+import java.util.Collections;\n+import java.util.HashSet;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Set;\n+import java.util.function.Function;\n+import java.util.stream.Collectors;\n+\n+import static org.elasticsearch.rest.RestRequest.Method.GET;\n+import static org.elasticsearch.xpack.core.ml.action.GetTrainedModelsAction.Request.ALLOW_NO_MATCH;\n+\n+public class RestCatTrainedModelsAction extends AbstractCatAction {\n+\n+    private static final Logger logger = LogManager.getLogger(RestCatTrainedModelsAction.class);\n+\n+    public RestCatTrainedModelsAction(RestController controller) {\n+        controller.registerHandler(GET, \"_cat/ml/trained_models/{\" + TrainedModelConfig.MODEL_ID.getPreferredName() + \"}\", this);\n+        controller.registerHandler(GET, \"_cat/ml/trained_models\", this);\n+    }\n+\n+    @Override\n+    public String getName() {\n+        return \"cat_ml_get_trained_models_action\";\n+    }\n+\n+    @Override\n+    protected RestChannelConsumer doCatRequest(RestRequest restRequest, NodeClient client) {\n+        String modelId = restRequest.param(TrainedModelConfig.MODEL_ID.getPreferredName());\n+        if (Strings.isNullOrEmpty(modelId)) {\n+            modelId = MetaData.ALL;\n+        }\n+        GetTrainedModelsStatsAction.Request statsRequest = new GetTrainedModelsStatsAction.Request(modelId);\n+        GetTrainedModelsAction.Request modelsAction = new GetTrainedModelsAction.Request(modelId, false, null);\n+        if (restRequest.hasParam(PageParams.FROM.getPreferredName()) || restRequest.hasParam(PageParams.SIZE.getPreferredName())) {\n+            statsRequest.setPageParams(new PageParams(restRequest.paramAsInt(PageParams.FROM.getPreferredName(), PageParams.DEFAULT_FROM),\n+                restRequest.paramAsInt(PageParams.SIZE.getPreferredName(), PageParams.DEFAULT_SIZE)));\n+            modelsAction.setPageParams(new PageParams(restRequest.paramAsInt(PageParams.FROM.getPreferredName(), PageParams.DEFAULT_FROM),\n+                restRequest.paramAsInt(PageParams.SIZE.getPreferredName(), PageParams.DEFAULT_SIZE)));\n+        }\n+        statsRequest.setAllowNoResources(restRequest.paramAsBoolean(ALLOW_NO_MATCH.getPreferredName(),\n+            statsRequest.isAllowNoResources()));\n+        modelsAction.setAllowNoResources(restRequest.paramAsBoolean(ALLOW_NO_MATCH.getPreferredName(),\n+            statsRequest.isAllowNoResources()));\n+\n+        return channel -> {\n+            final ActionListener<Table> listener = ActionListener.notifyOnce(new RestResponseListener<>(channel) {\n+                @Override\n+                public RestResponse buildResponse(final Table table) throws Exception {\n+                    return RestTable.buildResponse(table, channel);\n+                }\n+            });\n+\n+            client.execute(GetTrainedModelsAction.INSTANCE, modelsAction, ActionListener.wrap(\n+                trainedModels -> {\n+                    final List<TrainedModelConfig> trainedModelConfigs = trainedModels.getResources().results();\n+\n+                    Set<String> potentialAnalyticsIds = new HashSet<>();\n+                    // Analytics Configs are created by the XPackUser\n+                    trainedModelConfigs.stream()\n+                        .filter(c -> XPackUser.NAME.equals(c.getCreatedBy()))\n+                        .forEach(c -> potentialAnalyticsIds.addAll(c.getTags()));\n+\n+\n+                    // Find the related DataFrameAnalyticsConfigs\n+                    String requestIdPattern = Strings.collectionToDelimitedString(potentialAnalyticsIds, \"*,\") + \"*\";\n+\n+                    final GroupedActionListener<ActionResponse> groupedListener = createGroupedListener(restRequest,\n+                        2,\n+                        trainedModels.getResources().results(),\n+                        listener);\n+\n+                    client.execute(GetTrainedModelsStatsAction.INSTANCE,\n+                        statsRequest,\n+                        ActionListener.wrap(groupedListener::onResponse, groupedListener::onFailure));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "250a1147634825bd8921bc3c3ad7844ddad9e112"}, "originalPosition": 107}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzQ1Mzc3NQ==", "bodyText": "Yes, generic types get upset if there is no wrapper.", "url": "https://github.com/elastic/elasticsearch/pull/51529#discussion_r373453775", "createdAt": "2020-01-31T12:21:34Z", "author": {"login": "benwtrent"}, "path": "x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/rest/cat/RestCatTrainedModelsAction.java", "diffHunk": "@@ -0,0 +1,262 @@\n+/*\n+ * Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one\n+ * or more contributor license agreements. Licensed under the Elastic License;\n+ * you may not use this file except in compliance with the Elastic License.\n+ */\n+package org.elasticsearch.xpack.ml.rest.cat;\n+\n+import org.apache.logging.log4j.LogManager;\n+import org.apache.logging.log4j.Logger;\n+import org.elasticsearch.action.ActionListener;\n+import org.elasticsearch.action.ActionResponse;\n+import org.elasticsearch.action.support.GroupedActionListener;\n+import org.elasticsearch.client.node.NodeClient;\n+import org.elasticsearch.cluster.metadata.MetaData;\n+import org.elasticsearch.common.Strings;\n+import org.elasticsearch.common.Table;\n+import org.elasticsearch.common.unit.ByteSizeValue;\n+import org.elasticsearch.common.unit.TimeValue;\n+import org.elasticsearch.rest.RestController;\n+import org.elasticsearch.rest.RestRequest;\n+import org.elasticsearch.rest.RestResponse;\n+import org.elasticsearch.rest.action.RestResponseListener;\n+import org.elasticsearch.rest.action.cat.AbstractCatAction;\n+import org.elasticsearch.rest.action.cat.RestTable;\n+import org.elasticsearch.xpack.core.action.util.PageParams;\n+import org.elasticsearch.xpack.core.ml.action.GetDataFrameAnalyticsAction;\n+import org.elasticsearch.xpack.core.ml.action.GetTrainedModelsAction;\n+import org.elasticsearch.xpack.core.ml.action.GetTrainedModelsStatsAction;\n+import org.elasticsearch.xpack.core.ml.dataframe.DataFrameAnalyticsConfig;\n+import org.elasticsearch.xpack.core.ml.inference.TrainedModelConfig;\n+import org.elasticsearch.xpack.core.security.user.XPackUser;\n+\n+import java.util.Collection;\n+import java.util.Collections;\n+import java.util.HashSet;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Set;\n+import java.util.function.Function;\n+import java.util.stream.Collectors;\n+\n+import static org.elasticsearch.rest.RestRequest.Method.GET;\n+import static org.elasticsearch.xpack.core.ml.action.GetTrainedModelsAction.Request.ALLOW_NO_MATCH;\n+\n+public class RestCatTrainedModelsAction extends AbstractCatAction {\n+\n+    private static final Logger logger = LogManager.getLogger(RestCatTrainedModelsAction.class);\n+\n+    public RestCatTrainedModelsAction(RestController controller) {\n+        controller.registerHandler(GET, \"_cat/ml/trained_models/{\" + TrainedModelConfig.MODEL_ID.getPreferredName() + \"}\", this);\n+        controller.registerHandler(GET, \"_cat/ml/trained_models\", this);\n+    }\n+\n+    @Override\n+    public String getName() {\n+        return \"cat_ml_get_trained_models_action\";\n+    }\n+\n+    @Override\n+    protected RestChannelConsumer doCatRequest(RestRequest restRequest, NodeClient client) {\n+        String modelId = restRequest.param(TrainedModelConfig.MODEL_ID.getPreferredName());\n+        if (Strings.isNullOrEmpty(modelId)) {\n+            modelId = MetaData.ALL;\n+        }\n+        GetTrainedModelsStatsAction.Request statsRequest = new GetTrainedModelsStatsAction.Request(modelId);\n+        GetTrainedModelsAction.Request modelsAction = new GetTrainedModelsAction.Request(modelId, false, null);\n+        if (restRequest.hasParam(PageParams.FROM.getPreferredName()) || restRequest.hasParam(PageParams.SIZE.getPreferredName())) {\n+            statsRequest.setPageParams(new PageParams(restRequest.paramAsInt(PageParams.FROM.getPreferredName(), PageParams.DEFAULT_FROM),\n+                restRequest.paramAsInt(PageParams.SIZE.getPreferredName(), PageParams.DEFAULT_SIZE)));\n+            modelsAction.setPageParams(new PageParams(restRequest.paramAsInt(PageParams.FROM.getPreferredName(), PageParams.DEFAULT_FROM),\n+                restRequest.paramAsInt(PageParams.SIZE.getPreferredName(), PageParams.DEFAULT_SIZE)));\n+        }\n+        statsRequest.setAllowNoResources(restRequest.paramAsBoolean(ALLOW_NO_MATCH.getPreferredName(),\n+            statsRequest.isAllowNoResources()));\n+        modelsAction.setAllowNoResources(restRequest.paramAsBoolean(ALLOW_NO_MATCH.getPreferredName(),\n+            statsRequest.isAllowNoResources()));\n+\n+        return channel -> {\n+            final ActionListener<Table> listener = ActionListener.notifyOnce(new RestResponseListener<>(channel) {\n+                @Override\n+                public RestResponse buildResponse(final Table table) throws Exception {\n+                    return RestTable.buildResponse(table, channel);\n+                }\n+            });\n+\n+            client.execute(GetTrainedModelsAction.INSTANCE, modelsAction, ActionListener.wrap(\n+                trainedModels -> {\n+                    final List<TrainedModelConfig> trainedModelConfigs = trainedModels.getResources().results();\n+\n+                    Set<String> potentialAnalyticsIds = new HashSet<>();\n+                    // Analytics Configs are created by the XPackUser\n+                    trainedModelConfigs.stream()\n+                        .filter(c -> XPackUser.NAME.equals(c.getCreatedBy()))\n+                        .forEach(c -> potentialAnalyticsIds.addAll(c.getTags()));\n+\n+\n+                    // Find the related DataFrameAnalyticsConfigs\n+                    String requestIdPattern = Strings.collectionToDelimitedString(potentialAnalyticsIds, \"*,\") + \"*\";\n+\n+                    final GroupedActionListener<ActionResponse> groupedListener = createGroupedListener(restRequest,\n+                        2,\n+                        trainedModels.getResources().results(),\n+                        listener);\n+\n+                    client.execute(GetTrainedModelsStatsAction.INSTANCE,\n+                        statsRequest,\n+                        ActionListener.wrap(groupedListener::onResponse, groupedListener::onFailure));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzQzOTQ3OQ=="}, "originalCommit": {"oid": "250a1147634825bd8921bc3c3ad7844ddad9e112"}, "originalPosition": 107}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMwOTA5NDUyOnYy", "diffSide": "RIGHT", "path": "x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/rest/cat/RestCatTrainedModelsAction.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0zMVQxMTo0NDo1MFrOFkJCQA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0zMVQxMTo0NDo1MFrOFkJCQA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzQ0MTA4OA==", "bodyText": "left over debug?", "url": "https://github.com/elastic/elasticsearch/pull/51529#discussion_r373441088", "createdAt": "2020-01-31T11:44:50Z", "author": {"login": "davidkyle"}, "path": "x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/rest/cat/RestCatTrainedModelsAction.java", "diffHunk": "@@ -0,0 +1,262 @@\n+/*\n+ * Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one\n+ * or more contributor license agreements. Licensed under the Elastic License;\n+ * you may not use this file except in compliance with the Elastic License.\n+ */\n+package org.elasticsearch.xpack.ml.rest.cat;\n+\n+import org.apache.logging.log4j.LogManager;\n+import org.apache.logging.log4j.Logger;\n+import org.elasticsearch.action.ActionListener;\n+import org.elasticsearch.action.ActionResponse;\n+import org.elasticsearch.action.support.GroupedActionListener;\n+import org.elasticsearch.client.node.NodeClient;\n+import org.elasticsearch.cluster.metadata.MetaData;\n+import org.elasticsearch.common.Strings;\n+import org.elasticsearch.common.Table;\n+import org.elasticsearch.common.unit.ByteSizeValue;\n+import org.elasticsearch.common.unit.TimeValue;\n+import org.elasticsearch.rest.RestController;\n+import org.elasticsearch.rest.RestRequest;\n+import org.elasticsearch.rest.RestResponse;\n+import org.elasticsearch.rest.action.RestResponseListener;\n+import org.elasticsearch.rest.action.cat.AbstractCatAction;\n+import org.elasticsearch.rest.action.cat.RestTable;\n+import org.elasticsearch.xpack.core.action.util.PageParams;\n+import org.elasticsearch.xpack.core.ml.action.GetDataFrameAnalyticsAction;\n+import org.elasticsearch.xpack.core.ml.action.GetTrainedModelsAction;\n+import org.elasticsearch.xpack.core.ml.action.GetTrainedModelsStatsAction;\n+import org.elasticsearch.xpack.core.ml.dataframe.DataFrameAnalyticsConfig;\n+import org.elasticsearch.xpack.core.ml.inference.TrainedModelConfig;\n+import org.elasticsearch.xpack.core.security.user.XPackUser;\n+\n+import java.util.Collection;\n+import java.util.Collections;\n+import java.util.HashSet;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Set;\n+import java.util.function.Function;\n+import java.util.stream.Collectors;\n+\n+import static org.elasticsearch.rest.RestRequest.Method.GET;\n+import static org.elasticsearch.xpack.core.ml.action.GetTrainedModelsAction.Request.ALLOW_NO_MATCH;\n+\n+public class RestCatTrainedModelsAction extends AbstractCatAction {\n+\n+    private static final Logger logger = LogManager.getLogger(RestCatTrainedModelsAction.class);\n+\n+    public RestCatTrainedModelsAction(RestController controller) {\n+        controller.registerHandler(GET, \"_cat/ml/trained_models/{\" + TrainedModelConfig.MODEL_ID.getPreferredName() + \"}\", this);\n+        controller.registerHandler(GET, \"_cat/ml/trained_models\", this);\n+    }\n+\n+    @Override\n+    public String getName() {\n+        return \"cat_ml_get_trained_models_action\";\n+    }\n+\n+    @Override\n+    protected RestChannelConsumer doCatRequest(RestRequest restRequest, NodeClient client) {\n+        String modelId = restRequest.param(TrainedModelConfig.MODEL_ID.getPreferredName());\n+        if (Strings.isNullOrEmpty(modelId)) {\n+            modelId = MetaData.ALL;\n+        }\n+        GetTrainedModelsStatsAction.Request statsRequest = new GetTrainedModelsStatsAction.Request(modelId);\n+        GetTrainedModelsAction.Request modelsAction = new GetTrainedModelsAction.Request(modelId, false, null);\n+        if (restRequest.hasParam(PageParams.FROM.getPreferredName()) || restRequest.hasParam(PageParams.SIZE.getPreferredName())) {\n+            statsRequest.setPageParams(new PageParams(restRequest.paramAsInt(PageParams.FROM.getPreferredName(), PageParams.DEFAULT_FROM),\n+                restRequest.paramAsInt(PageParams.SIZE.getPreferredName(), PageParams.DEFAULT_SIZE)));\n+            modelsAction.setPageParams(new PageParams(restRequest.paramAsInt(PageParams.FROM.getPreferredName(), PageParams.DEFAULT_FROM),\n+                restRequest.paramAsInt(PageParams.SIZE.getPreferredName(), PageParams.DEFAULT_SIZE)));\n+        }\n+        statsRequest.setAllowNoResources(restRequest.paramAsBoolean(ALLOW_NO_MATCH.getPreferredName(),\n+            statsRequest.isAllowNoResources()));\n+        modelsAction.setAllowNoResources(restRequest.paramAsBoolean(ALLOW_NO_MATCH.getPreferredName(),\n+            statsRequest.isAllowNoResources()));\n+\n+        return channel -> {\n+            final ActionListener<Table> listener = ActionListener.notifyOnce(new RestResponseListener<>(channel) {\n+                @Override\n+                public RestResponse buildResponse(final Table table) throws Exception {\n+                    return RestTable.buildResponse(table, channel);\n+                }\n+            });\n+\n+            client.execute(GetTrainedModelsAction.INSTANCE, modelsAction, ActionListener.wrap(\n+                trainedModels -> {\n+                    final List<TrainedModelConfig> trainedModelConfigs = trainedModels.getResources().results();\n+\n+                    Set<String> potentialAnalyticsIds = new HashSet<>();\n+                    // Analytics Configs are created by the XPackUser\n+                    trainedModelConfigs.stream()\n+                        .filter(c -> XPackUser.NAME.equals(c.getCreatedBy()))\n+                        .forEach(c -> potentialAnalyticsIds.addAll(c.getTags()));\n+\n+\n+                    // Find the related DataFrameAnalyticsConfigs\n+                    String requestIdPattern = Strings.collectionToDelimitedString(potentialAnalyticsIds, \"*,\") + \"*\";\n+\n+                    final GroupedActionListener<ActionResponse> groupedListener = createGroupedListener(restRequest,\n+                        2,\n+                        trainedModels.getResources().results(),\n+                        listener);\n+\n+                    client.execute(GetTrainedModelsStatsAction.INSTANCE,\n+                        statsRequest,\n+                        ActionListener.wrap(groupedListener::onResponse, groupedListener::onFailure));\n+\n+                    GetDataFrameAnalyticsAction.Request dataFrameAnalyticsRequest =\n+                        new GetDataFrameAnalyticsAction.Request(requestIdPattern);\n+                    dataFrameAnalyticsRequest.setAllowNoResources(true);\n+                    dataFrameAnalyticsRequest.setPageParams(new PageParams(0, potentialAnalyticsIds.size()));\n+                    client.execute(GetDataFrameAnalyticsAction.INSTANCE,\n+                        dataFrameAnalyticsRequest,\n+                        ActionListener.wrap(groupedListener::onResponse, groupedListener::onFailure));\n+                },\n+                listener::onFailure\n+            ));\n+        };\n+    }\n+\n+    @Override\n+    protected void documentation(StringBuilder sb) {\n+        sb.append(\"/_cat/ml/trained_models\\n\");\n+        sb.append(\"/_cat/ml/trained_models/{model_id}\\n\");\n+    }\n+\n+    @Override\n+    protected Table getTableWithHeader(RestRequest request) {\n+        Table table = new Table();\n+        table.startHeaders();\n+\n+        // Trained Model Info\n+        table.addCell(\"id\", TableColumnAttributeBuilder.builder().setDescription(\"the trained model id\").build());\n+        table.addCell(\"created_by\", TableColumnAttributeBuilder.builder(\"who created the model\", false)\n+            .setAliases(\"c\", \"createdBy\")\n+            .setTextAlignment(TableColumnAttributeBuilder.TextAlign.RIGHT)\n+            .build());\n+        table.addCell(\"heap_size\", TableColumnAttributeBuilder.builder()\n+            .setDescription(\"the estimated heap size to keep the model in memory\")\n+            .setAliases(\"hs\",\"modelHeapSize\")\n+            .build());\n+        table.addCell(\"operations\", TableColumnAttributeBuilder.builder()\n+            .setDescription(\"the estimated number of operations to use the model\")\n+            .setAliases(\"o\", \"modelOperations\")\n+            .build());\n+        table.addCell(\"license\", TableColumnAttributeBuilder.builder(\"The license level of the model\", false)\n+            .setAliases(\"l\")\n+            .build());\n+        table.addCell(\"create_time\", TableColumnAttributeBuilder.builder(\"The time the model was created\", false)\n+            .setAliases(\"ct\")\n+            .build());\n+        table.addCell(\"version\", TableColumnAttributeBuilder.builder(\"The version of Elasticsearch when the model was created\", false)\n+            .setAliases(\"v\")\n+            .build());\n+        table.addCell(\"description\", TableColumnAttributeBuilder.builder(\"The model description\", false)\n+            .setAliases(\"d\")\n+            .build());\n+        table.addCell(\"data_frame_analytics_id\", TableColumnAttributeBuilder.builder(\n+            \"The data frame analytics config id that created the model (if still available)\",\n+            false)\n+            .setAliases(\"df\", \"dataFrameAnalytics\")\n+            .build());\n+\n+        // Trained Model Stats\n+        table.addCell(\"ingest.pipelines\", TableColumnAttributeBuilder.builder(\"The number of pipelines referencing the model\")\n+            .setAliases(\"ip\", \"ingestPipelines\")\n+            .build());\n+        table.addCell(\"ingest.count\", TableColumnAttributeBuilder.builder(\"The total number of docs processed by the model\", false)\n+            .setAliases(\"ic\", \"ingestCount\")\n+            .build());\n+        table.addCell(\"ingest.time\", TableColumnAttributeBuilder.builder(\n+            \"The total time spent processing docs with this model\",\n+            false)\n+            .setAliases(\"it\", \"ingestTime\")\n+            .build());\n+        table.addCell(\"ingest.current\", TableColumnAttributeBuilder.builder(\n+            \"The total documents currently being handled by the model\",\n+            false)\n+            .setAliases(\"icurr\", \"ingestCurrent\")\n+            .build());\n+        table.addCell(\"ingest.failed\", TableColumnAttributeBuilder.builder(\n+            \"The total count of failed ingest attempts with this model\",\n+            false)\n+            .setAliases(\"if\", \"ingestFailed\")\n+            .build());\n+\n+        table.endHeaders();\n+        return table;\n+    }\n+\n+    private GroupedActionListener<ActionResponse> createGroupedListener(final RestRequest request,\n+                                                                        final int size,\n+                                                                        final List<TrainedModelConfig> configs,\n+                                                                        final ActionListener<Table> listener) {\n+        return new GroupedActionListener<>(new ActionListener<>() {\n+            @Override\n+            public void onResponse(final Collection<ActionResponse> responses) {\n+                GetTrainedModelsStatsAction.Response statsResponse = extractResponse(responses, GetTrainedModelsStatsAction.Response.class);\n+                GetDataFrameAnalyticsAction.Response analytics = extractResponse(responses, GetDataFrameAnalyticsAction.Response.class);\n+                listener.onResponse(buildTable(request,\n+                    statsResponse.getResources().results(),\n+                    configs,\n+                    analytics == null ? Collections.emptyList() : analytics.getResources().results()));\n+            }\n+\n+            @Override\n+            public void onFailure(final Exception e) {\n+                listener.onFailure(e);\n+            }\n+        }, size);\n+    }\n+\n+\n+    private Table buildTable(RestRequest request,\n+                             List<GetTrainedModelsStatsAction.Response.TrainedModelStats> stats,\n+                             List<TrainedModelConfig> configs,\n+                             List<DataFrameAnalyticsConfig> analyticsConfigs) {\n+        Table table = getTableWithHeader(request);\n+        assert configs.size() == stats.size();\n+\n+        Map<String, String> analyticsMap = analyticsConfigs.stream()\n+            .map(DataFrameAnalyticsConfig::getId)\n+            .collect(Collectors.toMap(Function.identity(), Function.identity()));\n+        logger.warn(\"ANALYTICS MAP  \" + analyticsMap);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "250a1147634825bd8921bc3c3ad7844ddad9e112"}, "originalPosition": 225}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 198, "cost": 1, "resetAt": "2021-11-12T11:57:46Z"}}}