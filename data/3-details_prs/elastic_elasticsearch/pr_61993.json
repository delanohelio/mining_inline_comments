{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDc5NzEwMDU1", "number": 61993, "title": "Add data stream support to CCR", "bodyText": "This is a draft PR, so that the overall approach can be validated before adding more tests.\nThis commit adds support data stream support to CCR's auto following by making the following changes:\n\nWhen the auto follow coordinator iterates over the candidate indices to follow,\nthe auto follow coordinator also checks whether the index is part of a data stream and\nif the name of data stream also matches with the auto follow pattern then the index\nwill be auto followed.\nWhen following an index, the put follow api also checks whether that index is part\nof a data stream and if so then also replicates the data stream definition to the\nlocal cluster.\nIn order for the follow index api to determine whether an index is part of a data\nstream, the cluster state api was modified to also fetch the data stream definition\nof the cluster state if only the state is queried for specific indices.\n\nWhen a data stream is auto followed, only new backing indices are auto followed.\nThis is in line with how time based indices patterns are replicated today. This\nmeans that the data stream isn't copied 1 to 1 into the local cluster. The local\ncluster's data stream definition contains the same name, timestamp field and\ngeneration, but the list of backing indices may be different (depending on when\na data stream was auto followed).\nCloses #56259", "createdAt": "2020-09-04T13:56:32Z", "url": "https://github.com/elastic/elasticsearch/pull/61993", "merged": true, "mergeCommit": {"oid": "c4c3c8b42254b40ad86a2a963c91fb648da37720"}, "closed": true, "closedAt": "2020-11-03T13:01:15Z", "author": {"login": "martijnvg"}, "timelineItems": {"totalCount": 26, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdFlljrAH2gAyNDc5NzEwMDU1OjAzMjk4YjZlYzgzZGE0ZThhMTBiYzJmMjVlMjY4OWM0NjI0NmQxZTg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdY1j3vAH2gAyNDc5NzEwMDU1Ojk0ODI3YzNiNjc3OTk1ZTVhOGMzODY5ZDU3M2I1OTM2MTg3ZWQ5OGQ=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "03298b6ec83da4e8a10bc2f25e2689c46246d1e8", "author": {"user": {"login": "martijnvg", "name": "Martijn van Groningen"}}, "url": "https://github.com/elastic/elasticsearch/commit/03298b6ec83da4e8a10bc2f25e2689c46246d1e8", "committedDate": "2020-09-04T13:54:22Z", "message": "Add data stream support to CCR\n\nThis commit adds support data stream support to CCR's auto following by making the following changes:\n* When the auto follow coordinator iterates over the candidate indices to follow,\n  the auto follow coordinator also checks whether the index is part of a data stream and\n  if the name of data stream also matches with the auto follow pattern then the index\n  will be auto followed.\n* When following an index, the put follow api also checks whether that index is part\n  of a data stream and if so then also replicates the data stream definition to the\n  local cluster.\n* In order for the follow index api to determine whether an index is part of a data\n  stream, the cluster state api was modified to also fetch the data stream definition\n  of the cluster state if only the state is queried for specific indices.\n\nWhen a data stream is auto followed, only new backing indices are auto followed.\nThis is in line with how time based indices patterns are replicated today. This\nmeans that the data stream isn't copied 1 to 1 into the local cluster. The local\ncluster's data stream definition contains the same name, timestamp field and\ngeneration, but the list of backing indices may be different (depending on when\na data stream was auto followed).\n\nCloses #56259"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ca215b1bd2106b981e8827d78fef35d0757b9b74", "author": {"user": {"login": "martijnvg", "name": "Martijn van Groningen"}}, "url": "https://github.com/elastic/elasticsearch/commit/ca215b1bd2106b981e8827d78fef35d0757b9b74", "committedDate": "2020-09-07T14:06:01Z", "message": "Merge remote-tracking branch 'es/master' into ccr_data_stream_support"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "206fbf05782519f7da1f3735e30e0d967575680c", "author": {"user": {"login": "martijnvg", "name": "Martijn van Groningen"}}, "url": "https://github.com/elastic/elasticsearch/commit/206fbf05782519f7da1f3735e30e0d967575680c", "committedDate": "2020-09-07T14:11:42Z", "message": "move the check that checks parent data stream after the check whether index actually exists"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "addf40f637e1c4ba0e14239501e0ec92d9d77335", "author": {"user": {"login": "martijnvg", "name": "Martijn van Groningen"}}, "url": "https://github.com/elastic/elasticsearch/commit/addf40f637e1c4ba0e14239501e0ec92d9d77335", "committedDate": "2020-09-07T15:26:26Z", "message": "delete auto follow pattern after test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "40236726f06b7a4f76016d11b909c0b5c3a8ac20", "author": {"user": {"login": "martijnvg", "name": "Martijn van Groningen"}}, "url": "https://github.com/elastic/elasticsearch/commit/40236726f06b7a4f76016d11b909c0b5c3a8ac20", "committedDate": "2020-09-21T08:23:04Z", "message": "Merge remote-tracking branch 'es/master' into ccr_data_stream_support"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "606da3dd85f1f8b0ffe99070d8b9ed290113eba3", "author": {"user": {"login": "martijnvg", "name": "Martijn van Groningen"}}, "url": "https://github.com/elastic/elasticsearch/commit/606da3dd85f1f8b0ffe99070d8b9ed290113eba3", "committedDate": "2020-09-21T12:05:08Z", "message": "added tests and docs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "551adc88f55afd843389a7de5cbb47b5999020a0", "author": {"user": {"login": "martijnvg", "name": "Martijn van Groningen"}}, "url": "https://github.com/elastic/elasticsearch/commit/551adc88f55afd843389a7de5cbb47b5999020a0", "committedDate": "2020-09-21T12:18:19Z", "message": "updated jdocs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f81cc8b0e4a5586507aeca096c4b1e1a7cced1d7", "author": {"user": {"login": "martijnvg", "name": "Martijn van Groningen"}}, "url": "https://github.com/elastic/elasticsearch/commit/f81cc8b0e4a5586507aeca096c4b1e1a7cced1d7", "committedDate": "2020-09-21T13:10:58Z", "message": "iter"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2e9cd8fc3db9ae5a5dacfc398d2982f3179bd675", "author": {"user": {"login": "elasticmachine", "name": "Elastic Machine"}}, "url": "https://github.com/elastic/elasticsearch/commit/2e9cd8fc3db9ae5a5dacfc398d2982f3179bd675", "committedDate": "2020-09-23T02:23:40Z", "message": "Merge branch 'master' into ccr_data_stream_support"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "715dfe3532cbfc17fc84512ba6be168b973e0449", "author": {"user": {"login": "martijnvg", "name": "Martijn van Groningen"}}, "url": "https://github.com/elastic/elasticsearch/commit/715dfe3532cbfc17fc84512ba6be168b973e0449", "committedDate": "2020-09-28T11:43:15Z", "message": "Merge remote-tracking branch 'es/master' into ccr_data_stream_support"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk5OTYzNjU2", "url": "https://github.com/elastic/elasticsearch/pull/61993#pullrequestreview-499963656", "createdAt": "2020-10-01T02:00:30Z", "commit": {"oid": "715dfe3532cbfc17fc84512ba6be168b973e0449"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMVQwMjowMTozN1rOHa3mqg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMVQwMjoxMzoxNlrOHa4Dsg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzkzNjA0Mg==", "bodyText": "Can you add a test where an auto-follow pattern is added after the leader cluster has created a data stream?", "url": "https://github.com/elastic/elasticsearch/pull/61993#discussion_r497936042", "createdAt": "2020-10-01T02:01:37Z", "author": {"login": "dnhatn"}, "path": "x-pack/plugin/ccr/qa/multi-cluster/src/test/java/org/elasticsearch/xpack/ccr/AutoFollowIT.java", "diffHunk": "@@ -163,12 +172,142 @@ public void testPutAutoFollowPatternThatOverridesRequiredLeaderSetting() throws\n         );\n     }\n \n+    public void testDataStreams() throws Exception {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "715dfe3532cbfc17fc84512ba6be168b973e0449"}, "originalPosition": 42}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Nzk0MzQ3NA==", "bodyText": "Can we make this change directly in RestoreService? A SnapshotInfo from CcrReposity should contain the data streams from the leader cluster?", "url": "https://github.com/elastic/elasticsearch/pull/61993#discussion_r497943474", "createdAt": "2020-10-01T02:13:16Z", "author": {"login": "dnhatn"}, "path": "x-pack/plugin/ccr/src/main/java/org/elasticsearch/xpack/ccr/action/TransportPutFollowAction.java", "diffHunk": "@@ -158,9 +165,24 @@ public void onFailure(Exception e) {\n \n             @Override\n             protected void doRun() {\n-                restoreService.restoreSnapshot(restoreRequest,\n-                    ActionListener.delegateFailure(listener,\n-                        (delegatedListener, response) -> afterRestoreStarted(clientWithHeaders, request, delegatedListener, response)));\n+                ActionListener<RestoreService.RestoreCompletionResponse> delegatelistener = ActionListener.delegateFailure(\n+                    listener,\n+                    (delegatedListener, response) -> afterRestoreStarted(clientWithHeaders, request, delegatedListener, response)\n+                );\n+                if (remoteDataStream == null) {\n+                    restoreService.restoreSnapshot(restoreRequest, delegatelistener);\n+                } else {\n+                    String followerIndexName = request.getFollowerIndex();\n+                    BiConsumer<ClusterState, Metadata.Builder> updater = (currentState, mdBuilder) -> {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "715dfe3532cbfc17fc84512ba6be168b973e0449"}, "originalPosition": 58}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAxNDM4NjM1", "url": "https://github.com/elastic/elasticsearch/pull/61993#pullrequestreview-501438635", "createdAt": "2020-10-02T20:48:37Z", "commit": {"oid": "715dfe3532cbfc17fc84512ba6be168b973e0449"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMlQyMDo0ODozN1rOHb7NMA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMlQyMDo0ODozN1rOHb7NMA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTA0MzYzMg==", "bodyText": "@martijnvg, this is great! I'm trying to clarify this statement and landed on two renditions. Please let me know if the condensed version or the longer version is most appropriate without losing meaning.\nCondensed version\n\nWhen a data stream name matches an auto-follow pattern on the remote cluster, only new backing indices are followed. If you create a data stream after creating an auto-follow pattern, all backing indices are followed.\n\nLonger version\n\nYou can also create auto-follow patterns for data streams. When a new backing index is generated on a remote cluster, that index and its data stream are followed automatically if the data stream name matches an auto-follow pattern. If you create a data stream after creating an auto-follow pattern, all backing indices are followed automatically.", "url": "https://github.com/elastic/elasticsearch/pull/61993#discussion_r499043632", "createdAt": "2020-10-02T20:48:37Z", "author": {"login": "lockewritesdocs"}, "path": "docs/reference/ccr/auto-follow.asciidoc", "diffHunk": "@@ -7,6 +7,13 @@ each new index in the series is replicated automatically. Whenever the name of\n a new index on the remote cluster matches the auto-follow pattern, a\n corresponding follower index is added to the local cluster.\n \n+Data streams can also be auto followed. If a new backing index's data stream name\n+on the remote cluster matches with the auto-follow pattern then that index and\n+data stream is also auto followed. If a data stream is created on or after the\n+moment the auto follow pattern is created then all backing indices are auto\n+followed, otherwise only the backing indices on or after the creation of\n+the auto follow pattern are auto followed.\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "715dfe3532cbfc17fc84512ba6be168b973e0449"}, "originalPosition": 10}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAyMjM5NjUw", "url": "https://github.com/elastic/elasticsearch/pull/61993#pullrequestreview-502239650", "createdAt": "2020-10-05T16:46:57Z", "commit": {"oid": "715dfe3532cbfc17fc84512ba6be168b973e0449"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNVQxNjo0Njo1N1rOHclb1g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNVQxNjo0Njo1N1rOHclb1g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTczNTUxMA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            Data streams can also be auto followed. If a new backing index's data stream name\n          \n          \n            \n            on the remote cluster matches with the auto-follow pattern then that index and\n          \n          \n            \n            data stream is also auto followed. If a data stream is created on or after the\n          \n          \n            \n            moment the auto follow pattern is created then all backing indices are auto\n          \n          \n            \n            followed, otherwise only the backing indices on or after the creation of\n          \n          \n            \n            the auto follow pattern are auto followed.\n          \n          \n            \n            You can also create auto-follow patterns for data streams. When a new backing\n          \n          \n            \n            index is generated on a remote cluster, that index and its data stream are\n          \n          \n            \n            automatically followed if the data stream name matches an auto-follow\n          \n          \n            \n            pattern. If you create a data stream after creating the auto-follow pattern,\n          \n          \n            \n            all backing indices are followed automatically.", "url": "https://github.com/elastic/elasticsearch/pull/61993#discussion_r499735510", "createdAt": "2020-10-05T16:46:57Z", "author": {"login": "lockewritesdocs"}, "path": "docs/reference/ccr/auto-follow.asciidoc", "diffHunk": "@@ -7,6 +7,13 @@ each new index in the series is replicated automatically. Whenever the name of\n a new index on the remote cluster matches the auto-follow pattern, a\n corresponding follower index is added to the local cluster.\n \n+Data streams can also be auto followed. If a new backing index's data stream name\n+on the remote cluster matches with the auto-follow pattern then that index and\n+data stream is also auto followed. If a data stream is created on or after the\n+moment the auto follow pattern is created then all backing indices are auto\n+followed, otherwise only the backing indices on or after the creation of\n+the auto follow pattern are auto followed.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "715dfe3532cbfc17fc84512ba6be168b973e0449"}, "originalPosition": 9}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c5ec9a68625c98ab9dfe353d77e7a0d7d3978b0b", "author": {"user": {"login": "martijnvg", "name": "Martijn van Groningen"}}, "url": "https://github.com/elastic/elasticsearch/commit/c5ec9a68625c98ab9dfe353d77e7a0d7d3978b0b", "committedDate": "2020-10-19T13:12:08Z", "message": "Applying @lockewritesdocs' doc suggestion.\n\nCo-authored-by: Adam Locke <adam.locke@elastic.co>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "520b8c1110c513a4505418074dde8df5841516ac", "author": {"user": {"login": "martijnvg", "name": "Martijn van Groningen"}}, "url": "https://github.com/elastic/elasticsearch/commit/520b8c1110c513a4505418074dde8df5841516ac", "committedDate": "2020-10-19T13:17:00Z", "message": "Merge remote-tracking branch 'es/master' into ccr_data_stream_support"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "71e2932a40b22792b5a2294f6d662c5169161bfd", "author": {"user": {"login": "martijnvg", "name": "Martijn van Groningen"}}, "url": "https://github.com/elastic/elasticsearch/commit/71e2932a40b22792b5a2294f6d662c5169161bfd", "committedDate": "2020-10-20T09:21:08Z", "message": "Make use of builtin composable index template for logs-* and\nadded test that follows a data stream after its creation."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8d4cf01b58c667de57c67880aba669d1ee7c1ef7", "author": {"user": {"login": "martijnvg", "name": "Martijn van Groningen"}}, "url": "https://github.com/elastic/elasticsearch/commit/8d4cf01b58c667de57c67880aba669d1ee7c1ef7", "committedDate": "2020-10-20T11:15:07Z", "message": "Ensure the ordering of the backing indices in the follow cluster takes the generation into account."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1d705625937484c0878799820a1d377eb7df4b3d", "author": {"user": {"login": "martijnvg", "name": "Martijn van Groningen"}}, "url": "https://github.com/elastic/elasticsearch/commit/1d705625937484c0878799820a1d377eb7df4b3d", "committedDate": "2020-10-20T12:15:12Z", "message": "removed unused imports"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "abe709406e3fb2e274f9490467d9e787bc9adb30", "author": {"user": {"login": "martijnvg", "name": "Martijn van Groningen"}}, "url": "https://github.com/elastic/elasticsearch/commit/abe709406e3fb2e274f9490467d9e787bc9adb30", "committedDate": "2020-10-20T12:45:53Z", "message": "Throw a specific error when attempting to follow a data stream or alias."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "261ce1c5865468d4e6697ec07b8539c9b198bd08", "author": {"user": {"login": "martijnvg", "name": "Martijn van Groningen"}}, "url": "https://github.com/elastic/elasticsearch/commit/261ce1c5865468d4e6697ec07b8539c9b198bd08", "committedDate": "2020-10-20T13:01:49Z", "message": "Prohibit changing a backing index name when during follow index."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d042d00053903280038d75455e6ce648cfe26f9e", "author": {"user": {"login": "martijnvg", "name": "Martijn van Groningen"}}, "url": "https://github.com/elastic/elasticsearch/commit/d042d00053903280038d75455e6ce648cfe26f9e", "committedDate": "2020-10-21T14:24:28Z", "message": "Merge remote-tracking branch 'es/master' into ccr_data_stream_support"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "498a1ff8d6b8a378ea2aa7d2e4c3cc24beb1d8f0", "author": {"user": {"login": "martijnvg", "name": "Martijn van Groningen"}}, "url": "https://github.com/elastic/elasticsearch/commit/498a1ff8d6b8a378ea2aa7d2e4c3cc24beb1d8f0", "committedDate": "2020-10-28T08:44:30Z", "message": "Merge remote-tracking branch 'es/master' into ccr_data_stream_support"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "efac2e45687d828f0cf7fb587289ed53f6ff9a82", "author": {"user": {"login": "martijnvg", "name": "Martijn van Groningen"}}, "url": "https://github.com/elastic/elasticsearch/commit/efac2e45687d828f0cf7fb587289ed53f6ff9a82", "committedDate": "2020-10-28T09:08:17Z", "message": "fixed compile errors after merging in master"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE5MDQ0NTA5", "url": "https://github.com/elastic/elasticsearch/pull/61993#pullrequestreview-519044509", "createdAt": "2020-10-28T20:11:24Z", "commit": {"oid": "efac2e45687d828f0cf7fb587289ed53f6ff9a82"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOFQyMDoxMToyNFrOHp7mbw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOFQyMDoxMjoxMFrOHp7oFQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzczMDE1OQ==", "bodyText": "I think we can't use the generation from the remoteDataStream as it will break the assertion in DataStream's constructor. For example, here we are following .ds-1 and the ds generation on the remote is 2 already.", "url": "https://github.com/elastic/elasticsearch/pull/61993#discussion_r513730159", "createdAt": "2020-10-28T20:11:24Z", "author": {"login": "dnhatn"}, "path": "x-pack/plugin/ccr/src/main/java/org/elasticsearch/xpack/ccr/action/TransportPutFollowAction.java", "diffHunk": "@@ -211,6 +244,29 @@ private void initiateFollowing(\n         ));\n     }\n \n+    static DataStream updateLocalDataStream(Index backingIndexToFollow,\n+                                            DataStream localDataStream,\n+                                            DataStream remoteDataStream) {\n+        if (localDataStream == null) {\n+            // The data stream and the backing indices have been created and validated in the remote cluster,\n+            // just copying the data stream is in this case safe.\n+            return new DataStream(remoteDataStream.getName(), remoteDataStream.getTimeStampField(),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "efac2e45687d828f0cf7fb587289ed53f6ff9a82"}, "originalPosition": 107}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzczMDU4MQ==", "bodyText": "What if the generation of the local datastream is higher than the remote?", "url": "https://github.com/elastic/elasticsearch/pull/61993#discussion_r513730581", "createdAt": "2020-10-28T20:12:10Z", "author": {"login": "dnhatn"}, "path": "x-pack/plugin/ccr/src/main/java/org/elasticsearch/xpack/ccr/action/TransportPutFollowAction.java", "diffHunk": "@@ -211,6 +244,29 @@ private void initiateFollowing(\n         ));\n     }\n \n+    static DataStream updateLocalDataStream(Index backingIndexToFollow,\n+                                            DataStream localDataStream,\n+                                            DataStream remoteDataStream) {\n+        if (localDataStream == null) {\n+            // The data stream and the backing indices have been created and validated in the remote cluster,\n+            // just copying the data stream is in this case safe.\n+            return new DataStream(remoteDataStream.getName(), remoteDataStream.getTimeStampField(),\n+                List.of(backingIndexToFollow), remoteDataStream.getGeneration(), remoteDataStream.getMetadata());\n+        } else {\n+            List<Index> backingIndices = new ArrayList<>(localDataStream.getIndices());\n+            backingIndices.add(backingIndexToFollow);\n+\n+            // When following an older backing index it should be positioned before the newer backing indices.\n+            // Currently the assumption is that the newest index (highest generation) is the write index.\n+            // (just appending an older backing index to the list of backing indices would break that assumption)\n+            // (string sorting works because of the naming backing index naming scheme)\n+            backingIndices.sort(Comparator.comparing(Index::getName));\n+\n+            return new DataStream(localDataStream.getName(), localDataStream.getTimeStampField(), backingIndices,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "efac2e45687d828f0cf7fb587289ed53f6ff9a82"}, "originalPosition": 119}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIyMTY2Mjg0", "url": "https://github.com/elastic/elasticsearch/pull/61993#pullrequestreview-522166284", "createdAt": "2020-11-03T03:08:49Z", "commit": {"oid": "efac2e45687d828f0cf7fb587289ed53f6ff9a82"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "94827c3b677995e5a8c3869d573b5936187ed98d", "author": {"user": {"login": "martijnvg", "name": "Martijn van Groningen"}}, "url": "https://github.com/elastic/elasticsearch/commit/94827c3b677995e5a8c3869d573b5936187ed98d", "committedDate": "2020-11-03T09:15:34Z", "message": "Merge remote-tracking branch 'es/master' into ccr_data_stream_support"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4887, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}