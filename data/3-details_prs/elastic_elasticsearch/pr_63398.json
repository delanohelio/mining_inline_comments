{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDk5MTk0MzEz", "number": 63398, "title": "Add searchAnalyzer method to QueryShardContext", "bodyText": "Some callers of QueryShardContext#getMapperService only need to retrieve the search analyzer from the MapperService. With this commit we add a getSearchAnalyzer method to QueryShardContext which can be called directly without having direct access to MapperService", "createdAt": "2020-10-07T11:55:34Z", "url": "https://github.com/elastic/elasticsearch/pull/63398", "merged": true, "mergeCommit": {"oid": "2049fb0bdd4d16e63d9c423880d68725ec6bf6c0"}, "closed": true, "closedAt": "2020-10-07T12:41:37Z", "author": {"login": "javanna"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdQLoHoAH2gAyNDk5MTk0MzEzOmJjMjcwNGJjNzEyYzM3OWE5NjBhOTQzMGE4MTkzZTg4NDBkOTY4ZmY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdQMMV_AFqTUwMzgyNjc0MA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "bc2704bc712c379a960a9430a8193e8840d968ff", "author": {"user": {"login": "javanna", "name": "Luca Cavanna"}}, "url": "https://github.com/elastic/elasticsearch/commit/bc2704bc712c379a960a9430a8193e8840d968ff", "committedDate": "2020-10-07T11:52:48Z", "message": "Add searchAnalyzer method to QueryShardContext\n\nSome callers of `QueryShardContext#getMapperService` only need to retrieve the search analyzer from the `MapperService`. With this commit we add a searchAnalyzer method to QueryShardContext` which can be called directly without having direct access to `MapperService`"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ac3fee32c1df76fc5674e3ba2557f807216d9580", "author": {"user": {"login": "javanna", "name": "Luca Cavanna"}}, "url": "https://github.com/elastic/elasticsearch/commit/ac3fee32c1df76fc5674e3ba2557f807216d9580", "committedDate": "2020-10-07T11:54:37Z", "message": "javadocs"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAzODExMjUy", "url": "https://github.com/elastic/elasticsearch/pull/63398#pullrequestreview-503811252", "createdAt": "2020-10-07T12:12:22Z", "commit": {"oid": "ac3fee32c1df76fc5674e3ba2557f807216d9580"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wN1QxMjoxMjoyMlrOHdwO_w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wN1QxMjoxMjoyMlrOHdwO_w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDk2MTAyMw==", "bodyText": "possibly, searchQuoteAnalyzer and searchAnalyzer could be removed from MapperService as they are only used through QueryShardContext. Only they are now a subclass of MapperAnalyzerWrapper which is package protected within MapperService and used also for indexAnalyzer which must stay where it is.", "url": "https://github.com/elastic/elasticsearch/pull/63398#discussion_r500961023", "createdAt": "2020-10-07T12:12:22Z", "author": {"login": "javanna"}, "path": "server/src/main/java/org/elasticsearch/index/query/QueryShardContext.java", "diffHunk": "@@ -258,6 +258,13 @@ public Analyzer getSearchAnalyzer(MappedFieldType fieldType) {\n         return mapperService.searchAnalyzer();\n     }\n \n+    /**\n+     * Returns the default search analyzer\n+     */\n+    public Analyzer getSearchAnalyzer() {\n+        return this.mapperService.searchAnalyzer();\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ac3fee32c1df76fc5674e3ba2557f807216d9580"}, "originalPosition": 9}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAzODI2NzQw", "url": "https://github.com/elastic/elasticsearch/pull/63398#pullrequestreview-503826740", "createdAt": "2020-10-07T12:32:01Z", "commit": {"oid": "ac3fee32c1df76fc5674e3ba2557f807216d9580"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wN1QxMjozMjowMlrOHdw-vA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wN1QxMjozMjowMlrOHdw-vA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDk3MzI0NA==", "bodyText": "Yes, MapperService builds the per-field analyzer here so we need to keep it, I think.  Although we may be able to remove the per-field delegation for search/searchQuote because generally speaking queries get their analyzers directly from the field types.  We can look at it later.", "url": "https://github.com/elastic/elasticsearch/pull/63398#discussion_r500973244", "createdAt": "2020-10-07T12:32:02Z", "author": {"login": "romseygeek"}, "path": "server/src/main/java/org/elasticsearch/index/query/QueryShardContext.java", "diffHunk": "@@ -258,6 +258,13 @@ public Analyzer getSearchAnalyzer(MappedFieldType fieldType) {\n         return mapperService.searchAnalyzer();\n     }\n \n+    /**\n+     * Returns the default search analyzer\n+     */\n+    public Analyzer getSearchAnalyzer() {\n+        return this.mapperService.searchAnalyzer();\n+    }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDk2MTAyMw=="}, "originalCommit": {"oid": "ac3fee32c1df76fc5674e3ba2557f807216d9580"}, "originalPosition": 9}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4358, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}