{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc1MDU0MTky", "number": 52336, "title": "Decode max and min optimization more carefully", "bodyText": "Fixes the the no-query optimization for min and max aggregations\nfor date_nanos fields by delegating decoding dates \"through\" their\nresolution member.\nCloses #52220", "createdAt": "2020-02-13T19:43:57Z", "url": "https://github.com/elastic/elasticsearch/pull/52336", "merged": true, "mergeCommit": {"oid": "cd50922fa0a59d98c41020a9f772ead45d98225d"}, "closed": true, "closedAt": "2020-02-14T10:56:53Z", "author": {"login": "nik9000"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcEAO-QAH2gAyMzc1MDU0MTkyOjFmYjliOTkyZmI0MGYzNzJlMmZmY2U2ZTUxNjM1NjRkMGU0ZDI1NmM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcEC-97AH2gAyMzc1MDU0MTkyOjhjNDkxMTVkMWE1NTQxNTA1Yjg5OGRlOWNjZTJjYzY3OTY1NDdmNmM=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "1fb9b992fb40f372e2ffce6e5163564d0e4d256c", "author": {"user": {"login": "nik9000", "name": "Nik Everett"}}, "url": "https://github.com/elastic/elasticsearch/commit/1fb9b992fb40f372e2ffce6e5163564d0e4d256c", "committedDate": "2020-02-13T19:38:08Z", "message": "Decode max and min optimization more carefully\n\nFixes the the no-query optimization for `min` and `max` aggregations\nfor `date_nanos` fields by delegating decoding dates \"through\" their\n`resolution` member.\n\nCloses #52220"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a583cad635bf18f811831723d0f1d023566cdd20", "author": {"user": {"login": "nik9000", "name": "Nik Everett"}}, "url": "https://github.com/elastic/elasticsearch/commit/a583cad635bf18f811831723d0f1d023566cdd20", "committedDate": "2020-02-13T19:44:05Z", "message": "One more!"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU4NTAxMTY1", "url": "https://github.com/elastic/elasticsearch/pull/52336#pullrequestreview-358501165", "createdAt": "2020-02-13T19:44:35Z", "commit": {"oid": "1fb9b992fb40f372e2ffce6e5163564d0e4d256c"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xM1QxOTo0NDozNlrOFphNpQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xM1QxOTo0NTozM1rOFphPdQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTA4MDEwMQ==", "bodyText": "This was a javadoc comment in an invalid spot for javadoc.", "url": "https://github.com/elastic/elasticsearch/pull/52336#discussion_r379080101", "createdAt": "2020-02-13T19:44:36Z", "author": {"login": "nik9000"}, "path": "server/src/main/java/org/elasticsearch/search/aggregations/metrics/MaxAggregator.java", "diffHunk": "@@ -98,7 +98,7 @@ public LeafBucketCollector getLeafCollector(LeafReaderContext ctx,\n         if (pointConverter != null) {\n             Number segMax = findLeafMaxValue(ctx.reader(), pointField, pointConverter);\n             if (segMax != null) {\n-                /**", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1fb9b992fb40f372e2ffce6e5163564d0e4d256c"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTA4MDMyMA==", "bodyText": "This isn't used any more.", "url": "https://github.com/elastic/elasticsearch/pull/52336#discussion_r379080320", "createdAt": "2020-02-13T19:45:05Z", "author": {"login": "nik9000"}, "path": "server/src/test/java/org/elasticsearch/search/aggregations/metrics/MinAggregatorTests.java", "diffHunk": "@@ -799,21 +815,6 @@ public void testMinShortcutRandom() throws Exception {\n             (v) -> DoublePoint.decodeDimension(v, 0));\n     }\n \n-    private void testMinCase(IndexSearcher searcher,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1fb9b992fb40f372e2ffce6e5163564d0e4d256c"}, "originalPosition": 107}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTA4MDU2NQ==", "bodyText": "There is a ton more ceremony here because resolution is only set when you call build. Bleh.", "url": "https://github.com/elastic/elasticsearch/pull/52336#discussion_r379080565", "createdAt": "2020-02-13T19:45:33Z", "author": {"login": "nik9000"}, "path": "server/src/test/java/org/elasticsearch/search/aggregations/metrics/MinAggregatorTests.java", "diffHunk": "@@ -889,12 +890,17 @@ private Aggregator mockAggregator() {\n         return config;\n     }\n \n-    private ValuesSourceConfig<ValuesSource.Numeric> mockDateValuesSourceConfig(String fieldName, boolean indexed) {\n+    private ValuesSourceConfig<ValuesSource.Numeric> mockDateValuesSourceConfig(String fieldName, boolean indexed,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1fb9b992fb40f372e2ffce6e5163564d0e4d256c"}, "originalPosition": 130}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU4NTIzNzU2", "url": "https://github.com/elastic/elasticsearch/pull/52336#pullrequestreview-358523756", "createdAt": "2020-02-13T20:21:07Z", "commit": {"oid": "a583cad635bf18f811831723d0f1d023566cdd20"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xM1QyMDoyMTowOFrOFpiQ1Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xM1QyMDoyMTowOFrOFpiQ1Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTA5NzMwMQ==", "bodyText": "I'm a little uncomfortable using a randomization for coverage here.  I'd rather loop over the possible resolution values like we loop over the possible numeric types above.", "url": "https://github.com/elastic/elasticsearch/pull/52336#discussion_r379097301", "createdAt": "2020-02-13T20:21:08Z", "author": {"login": "not-napoleon"}, "path": "server/src/test/java/org/elasticsearch/search/aggregations/metrics/MinAggregatorTests.java", "diffHunk": "@@ -740,41 +743,54 @@ public void testShortcutIsApplicable() {\n                 )\n             );\n         }\n-        assertNotNull(\n-            MinAggregator.getPointReaderOrNull(\n-                mockSearchContext(new MatchAllDocsQuery()),\n-                null,\n-                mockDateValuesSourceConfig(\"number\", true)\n-            )\n-        );\n         assertNull(\n             MinAggregator.getPointReaderOrNull(\n                 mockSearchContext(new MatchAllDocsQuery()),\n                 mockAggregator(),\n-                mockDateValuesSourceConfig(\"number\", true)\n+                mockDateValuesSourceConfig(\"number\", true, randomFrom(DateFieldMapper.Resolution.values()))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a583cad635bf18f811831723d0f1d023566cdd20"}, "originalPosition": 53}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ce60006247d53e6da8ddfb881127f91618c2ea8e", "author": {"user": {"login": "nik9000", "name": "Nik Everett"}}, "url": "https://github.com/elastic/elasticsearch/commit/ce60006247d53e6da8ddfb881127f91618c2ea8e", "committedDate": "2020-02-13T22:41:33Z", "message": "Merge branch 'master' into date_nanos_weird_opt"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8c49115d1a5541505b898de9cce2cc6796547f6c", "author": {"user": {"login": "nik9000", "name": "Nik Everett"}}, "url": "https://github.com/elastic/elasticsearch/commit/8c49115d1a5541505b898de9cce2cc6796547f6c", "committedDate": "2020-02-13T22:50:22Z", "message": "Bigger test"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2467, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}