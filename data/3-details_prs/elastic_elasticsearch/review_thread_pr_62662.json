{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDg5NTA5Mjk3", "number": 62662, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xOFQxOTo1MTozOFrOElGNDQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xOFQxOTo1MTozOFrOElGNDQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA3MzM0NDEzOnYy", "diffSide": "RIGHT", "path": "server/src/internalClusterTest/java/org/elasticsearch/cluster/coordination/RareClusterStateIT.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xOFQxOTo1MTozOFrOHUZ-xg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xOFQxOTo1MTozOFrOHUZ-xg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTE1OTIzOA==", "bodyText": "Made this whole thing a little less weird to read as well here, the stream + iterator + array size assertion was just weirdly complicated.", "url": "https://github.com/elastic/elasticsearch/pull/62662#discussion_r491159238", "createdAt": "2020-09-18T19:51:38Z", "author": {"login": "original-brownbear"}, "path": "server/src/internalClusterTest/java/org/elasticsearch/cluster/coordination/RareClusterStateIT.java", "diffHunk": "@@ -142,17 +140,16 @@ public void onFailure(String source, Exception e) {\n             ActionRequestBuilder<Req, Res> req) throws Exception {\n         // Wait for no publication in progress to not accidentally cancel a publication different from the one triggered by the given\n         // request.\n-        assertBusy(\n-            () -> {\n-                assertFalse(((Coordinator) internalCluster().getCurrentMasterNodeInstance(Discovery.class)).publicationInProgress());\n-                assertThat(StreamSupport.stream(\n-                    internalCluster().getInstances(Discovery.class).spliterator(), false)\n-                    .map(coordinator -> ((Coordinator) coordinator).getLastAcceptedState().version())\n-                    .distinct().toArray(), arrayWithSize(1));\n-            });\n+        final Coordinator masterCoordinator = (Coordinator) internalCluster().getCurrentMasterNodeInstance(Discovery.class);\n+        assertBusy(() -> {\n+            assertFalse(masterCoordinator.publicationInProgress());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "01d768088c1f29e9e109c168c0134caffcc13c42"}, "originalPosition": 29}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3486, "cost": 1, "resetAt": "2021-11-12T13:16:51Z"}}}