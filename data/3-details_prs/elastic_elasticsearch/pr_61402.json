{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDcxMzk3MjY5", "number": 61402, "title": "Warn about unlicensed realms if no auth token can be extracted", "bodyText": "There are warnings about unlicense realms when user lookup fails. This PR adds the similar warnings for when no authentication token can be extracted from the request.\nResolves: #61090", "createdAt": "2020-08-21T05:33:03Z", "url": "https://github.com/elastic/elasticsearch/pull/61402", "merged": true, "mergeCommit": {"oid": "2e4394c1735c1a449e815ece7a4fbb0ba3087c79"}, "closed": true, "closedAt": "2020-08-21T12:20:44Z", "author": {"login": "ywangd"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdA9-kPgH2gAyNDcxMzk3MjY5OmIwMmYzMmUzOTU4NTJiOWY3NTRiZDE4MDRmNDBlNjRmZTNjZjkwYTA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdA_KnbgH2gAyNDcxMzk3MjY5OjU2MTU3ZTdkMDVlYTkzYjYwNjgzNjY3NTNkMjY1ODY5NjYwZDA0ZjA=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "b02f32e395852b9f754bd1804f40e64fe3cf90a0", "author": {"user": {"login": "ywangd", "name": "Yang Wang"}}, "url": "https://github.com/elastic/elasticsearch/commit/b02f32e395852b9f754bd1804f40e64fe3cf90a0", "committedDate": "2020-08-21T05:29:47Z", "message": "Add warnings for unlicensed realms when no authentication token can be extracted"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDcyMjAwMDY2", "url": "https://github.com/elastic/elasticsearch/pull/61402#pullrequestreview-472200066", "createdAt": "2020-08-21T06:26:50Z", "commit": {"oid": "b02f32e395852b9f754bd1804f40e64fe3cf90a0"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMVQwNjoyNjo1MFrOHEdH0g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMVQwNjoyNjo1MFrOHEdH0g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDQzMzQ5MA==", "bodyText": "Can we avoid the token word? It leads people to look at the token service and ....\nIn the section below we say No valid credentials found which is terminology that could probably be adapted to work here.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                            logger.warn(\"No authentication token can be extracted using realms [{}].\" +\n          \n          \n            \n                            logger.warn(\"No authentication credential could be extracted using realms [{}].\" +", "url": "https://github.com/elastic/elasticsearch/pull/61402#discussion_r474433490", "createdAt": "2020-08-21T06:26:50Z", "author": {"login": "tvernum"}, "path": "x-pack/plugin/security/src/main/java/org/elasticsearch/xpack/security/authc/AuthenticationService.java", "diffHunk": "@@ -554,6 +554,13 @@ private void consumeToken(AuthenticationToken token) {\n          */\n         // pkg-private for tests\n         void handleNullToken() {\n+            List<Realm> unlicensedRealms = realms.getUnlicensedRealms();\n+            if (unlicensedRealms.isEmpty() == false) {\n+                logger.warn(\"No authentication token can be extracted using realms [{}].\" +", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b02f32e395852b9f754bd1804f40e64fe3cf90a0"}, "originalPosition": 6}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8f7caff05d043f0cd04f89e3e79d7bbff0d1c8a6", "author": {"user": {"login": "ywangd", "name": "Yang Wang"}}, "url": "https://github.com/elastic/elasticsearch/commit/8f7caff05d043f0cd04f89e3e79d7bbff0d1c8a6", "committedDate": "2020-08-21T06:38:17Z", "message": "Update x-pack/plugin/security/src/main/java/org/elasticsearch/xpack/security/authc/AuthenticationService.java\n\nCo-authored-by: Tim Vernum <tim@adjective.org>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cb282711bf78a15ce677f7a14b18a2d9b6141db4", "author": {"user": {"login": "ywangd", "name": "Yang Wang"}}, "url": "https://github.com/elastic/elasticsearch/commit/cb282711bf78a15ce677f7a14b18a2d9b6141db4", "committedDate": "2020-08-21T06:39:35Z", "message": "Address feedback"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "56157e7d05ea93b6068366753d265869660d04f0", "author": {"user": {"login": "ywangd", "name": "Yang Wang"}}, "url": "https://github.com/elastic/elasticsearch/commit/56157e7d05ea93b6068366753d265869660d04f0", "committedDate": "2020-08-21T06:52:51Z", "message": "Merge remote-tracking branch 'origin/master' into es-61090-warn-on-unlicensed-realms"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4831, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}