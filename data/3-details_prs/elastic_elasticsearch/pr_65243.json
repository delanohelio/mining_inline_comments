{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTIzNTgwMzYz", "number": 65243, "title": "Move security manager codebases files to plugin-metadata", "bodyText": "The codebases files are hints that allow the test framework to map\ncodebase names required by plugin security policy files to urls that may\nexist as classes directories on disk. These files end up in the same\ntest resources directory in gradle, but in eclipse they exist in\ndifferent directories. This commit reorganizes the files so they exist\nwithin the same plugin-metadata source, thereby existing in the same\noutput directory used by tests. Finally, the codebases files are\nfiltered out of the final jar within the plugin build.", "createdAt": "2020-11-18T23:44:30Z", "url": "https://github.com/elastic/elasticsearch/pull/65243", "merged": true, "mergeCommit": {"oid": "06b2deb6745c39d356053ae8645393c1e2101efd"}, "closed": true, "closedAt": "2020-11-19T17:18:42Z", "author": {"login": "rjernst"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdd2-IzgH2gAyNTIzNTgwMzYzOjAyN2E4ZWUzN2ZlM2QzMTdiMmM0YWEwNTU1ZjJjZGQ3ZjE2Y2M5ODE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdeDzTfgFqTUzNDUxMjE5Mg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "027a8ee37fe3d317b2c4aa0555f2cdd7f16cc981", "author": {"user": {"login": "rjernst", "name": "Ryan Ernst"}}, "url": "https://github.com/elastic/elasticsearch/commit/027a8ee37fe3d317b2c4aa0555f2cdd7f16cc981", "committedDate": "2020-11-18T23:43:47Z", "message": "Move security manager codebases files to plugin-metadata\n\nThe codebases files are hints that allow the test framework to map\ncodebase names required by plugin security policy files to urls that may\nexist as classes directories on disk. These files end up in the same\ntest resources directory in gradle, but in eclipse they exist in\ndifferent directories. This commit reorganizes the files so they exist\nwithin the same plugin-metadata source, thereby existing in the same\noutput directory used by tests. Finally, the codebases files are\nfiltered out of the final jar within the plugin build."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMzOTkzMjI3", "url": "https://github.com/elastic/elasticsearch/pull/65243#pullrequestreview-533993227", "createdAt": "2020-11-19T00:38:20Z", "commit": {"oid": "027a8ee37fe3d317b2c4aa0555f2cdd7f16cc981"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQwMDozODoyMFrOH2H9XA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQwMDo0MjozOVrOH2IDLg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjUxNTU0OA==", "bodyText": "Is this intellij policy actaully specific to intellij or should we rename to \"ide\" or similar?", "url": "https://github.com/elastic/elasticsearch/pull/65243#discussion_r526515548", "createdAt": "2020-11-19T00:38:20Z", "author": {"login": "mark-vieira"}, "path": "test/framework/src/main/java/org/elasticsearch/bootstrap/BootstrapForTesting.java", "diffHunk": "@@ -146,10 +146,8 @@\n                 final Policy runnerPolicy;\n                 if (System.getProperty(\"tests.gradle\") != null) {\n                     runnerPolicy = PolicyUtil.readPolicy(Bootstrap.class.getResource(\"gradle.policy\"), codebases);\n-                } else if (codebases.containsKey(\"junit-rt.jar\")) {\n-                    runnerPolicy = PolicyUtil.readPolicy(Bootstrap.class.getResource(\"intellij.policy\"), codebases);\n                 } else {\n-                    runnerPolicy = PolicyUtil.readPolicy(Bootstrap.class.getResource(\"eclipse.policy\"), codebases);\n+                    runnerPolicy = PolicyUtil.readPolicy(Bootstrap.class.getResource(\"intellij.policy\"), codebases);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "027a8ee37fe3d317b2c4aa0555f2cdd7f16cc981"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjUxNzAzOA==", "bodyText": "Rather than do this why don't we just define pluginMetadata up top as the individual file isntead of the entire `plugin-metadata?\nAlso, is there any use case for throwing other stuff in that location? Could external plugin authors being doing this, therefore this be a breaking change? Would it be better to explicitly exclude the codebases file?", "url": "https://github.com/elastic/elasticsearch/pull/65243#discussion_r526517038", "createdAt": "2020-11-19T00:42:39Z", "author": {"login": "mark-vieira"}, "path": "buildSrc/src/main/groovy/org/elasticsearch/gradle/plugin/PluginBuildPlugin.groovy", "diffHunk": "@@ -204,7 +204,11 @@ class PluginBuildPlugin implements Plugin<Project> {\n         // create the actual bundle task, which zips up all the files for the plugin\n         TaskProvider<Zip> bundle = project.tasks.register('bundlePlugin', Zip) {\n             from buildProperties\n-            from pluginMetadata // metadata (eg custom security policy)\n+            from(pluginMetadata) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "027a8ee37fe3d317b2c4aa0555f2cdd7f16cc981"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "550ce05f801a42bd33170f053a80937682c3b9bb", "author": {"user": {"login": "rjernst", "name": "Ryan Ernst"}}, "url": "https://github.com/elastic/elasticsearch/commit/550ce05f801a42bd33170f053a80937682c3b9bb", "committedDate": "2020-11-19T00:47:24Z", "message": "restore"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7d648cd0ab9e4540e3a4cff12609d7ccf80574c5", "author": {"user": {"login": "rjernst", "name": "Ryan Ernst"}}, "url": "https://github.com/elastic/elasticsearch/commit/7d648cd0ab9e4540e3a4cff12609d7ccf80574c5", "committedDate": "2020-11-19T01:09:57Z", "message": "Flip to exclusion of the codebases file"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM0NTEyMTky", "url": "https://github.com/elastic/elasticsearch/pull/65243#pullrequestreview-534512192", "createdAt": "2020-11-19T14:40:43Z", "commit": {"oid": "7d648cd0ab9e4540e3a4cff12609d7ccf80574c5"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 869, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}