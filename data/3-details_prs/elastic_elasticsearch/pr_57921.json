{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDMyMzA2NTI0", "number": 57921, "title": "Remove deprecated usage of testCompile configuration", "bodyText": "This is related to #57920", "createdAt": "2020-06-10T08:53:16Z", "url": "https://github.com/elastic/elasticsearch/pull/57921", "merged": true, "mergeCommit": {"oid": "680ea07f7ff00e52e15cc5ad250ce5398ce0f0e3"}, "closed": true, "closedAt": "2020-06-12T11:34:54Z", "author": {"login": "breskeby"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcp1sotAH2gAyNDMyMzA2NTI0OmZiYTRjZGRiMmI2N2VjNTYzY2NjZTlmZGM3OTlmMWVhNjIyYzI2YTk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcqenl_AH2gAyNDMyMzA2NTI0OmNkODA5MTViMmJlYjBhNTcxZGY5ZWFmOWZhODAxNDdjOTE3MmNiYWQ=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "fba4cddb2b67ec563ccce9fdc799f1ea622c26a9", "author": {"user": {"login": "breskeby", "name": "Rene Groeschke"}}, "url": "https://github.com/elastic/elasticsearch/commit/fba4cddb2b67ec563ccce9fdc799f1ea622c26a9", "committedDate": "2020-06-10T08:50:42Z", "message": "Remove deprecated testCompile configuration"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "85ede2af28911bde902aaa0f9cd667889f96375b", "author": {"user": {"login": "breskeby", "name": "Rene Groeschke"}}, "url": "https://github.com/elastic/elasticsearch/commit/85ede2af28911bde902aaa0f9cd667889f96375b", "committedDate": "2020-06-10T09:38:51Z", "message": "Replace testCompile in StandaloneRestTest plugin"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b0d2b646a3bdcece5d9ae74f18087884fce08811", "author": {"user": {"login": "breskeby", "name": "Rene Groeschke"}}, "url": "https://github.com/elastic/elasticsearch/commit/b0d2b646a3bdcece5d9ae74f18087884fce08811", "committedDate": "2020-06-10T15:53:57Z", "message": "Replace testCompile usage by testImplementation\n\n- fix taskArtifact declaration\n- make testImplementation non transitive by default (as we did for testCompile"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f33705783e75697c163a1258de484a0cca708297", "author": {"user": {"login": "breskeby", "name": "Rene Groeschke"}}, "url": "https://github.com/elastic/elasticsearch/commit/f33705783e75697c163a1258de484a0cca708297", "committedDate": "2020-06-10T16:09:53Z", "message": "Remove debugging output"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f1ddc523504d62c055edcd647c82ba2897880559", "author": {"user": {"login": "breskeby", "name": "Rene Groeschke"}}, "url": "https://github.com/elastic/elasticsearch/commit/f1ddc523504d62c055edcd647c82ba2897880559", "committedDate": "2020-06-11T09:18:28Z", "message": "Update CONTRIBUTING about using testImplementation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2b161b28badb7739bb59bedde24ba13ebafb7172", "author": {"user": {"login": "breskeby", "name": "Rene Groeschke"}}, "url": "https://github.com/elastic/elasticsearch/commit/2b161b28badb7739bb59bedde24ba13ebafb7172", "committedDate": "2020-06-11T09:45:30Z", "message": "Fail on testCompile configuration usage"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI5MzMzMDQ0", "url": "https://github.com/elastic/elasticsearch/pull/57921#pullrequestreview-429333044", "createdAt": "2020-06-11T22:21:45Z", "commit": {"oid": "2b161b28badb7739bb59bedde24ba13ebafb7172"}, "state": "APPROVED", "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMVQyMjoyMTo0NlrOGiwvSQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMVQyMjoyOTozOFrOGiw5rw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTEwMzMwNQ==", "bodyText": "Nice \ud83d\udc4d", "url": "https://github.com/elastic/elasticsearch/pull/57921#discussion_r439103305", "createdAt": "2020-06-11T22:21:46Z", "author": {"login": "mark-vieira"}, "path": "buildSrc/src/main/java/org/elasticsearch/gradle/ElasticsearchJavaPlugin.java", "diffHunk": "@@ -114,9 +114,24 @@ public void apply(Project project) {\n     public static void configureConfigurations(Project project) {\n         // we want to test compileOnly deps!\n         Configuration compileOnlyConfig = project.getConfigurations().getByName(JavaPlugin.COMPILE_ONLY_CONFIGURATION_NAME);\n-        Configuration testCompileConfig = project.getConfigurations().getByName(JavaPlugin.TEST_COMPILE_CONFIGURATION_NAME);\n-        testCompileConfig.extendsFrom(compileOnlyConfig);\n-\n+        Configuration testImplementationConfig = project.getConfigurations().getByName(JavaPlugin.TEST_IMPLEMENTATION_CONFIGURATION_NAME);\n+        testImplementationConfig.extendsFrom(compileOnlyConfig);\n+\n+        // fail on using deprecated testCompile\n+        project.getConfigurations()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2b161b28badb7739bb59bedde24ba13ebafb7172"}, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTEwMzUwMg==", "bodyText": "We can probably remove this now since we fail if you add any dependencies to this configuration.", "url": "https://github.com/elastic/elasticsearch/pull/57921#discussion_r439103502", "createdAt": "2020-06-11T22:22:22Z", "author": {"login": "mark-vieira"}, "path": "buildSrc/src/main/java/org/elasticsearch/gradle/ElasticsearchJavaPlugin.java", "diffHunk": "@@ -145,6 +160,7 @@ public static void configureConfigurations(Project project) {\n         disableTransitiveDeps.accept(JavaPlugin.TEST_COMPILE_CONFIGURATION_NAME);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2b161b28badb7739bb59bedde24ba13ebafb7172"}, "originalPosition": 38}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTEwNDUzNw==", "bodyText": "I assume this is to deal with standalone test projects, that don't have a \"main\" sourceset. If so, should we be using testRuntimeClasspath here? I dunno, @rjernst, what do you think? Should we even be auditing third party libraries for qa projects? I think we were discussion what all precommit checks should apply to those recently.", "url": "https://github.com/elastic/elasticsearch/pull/57921#discussion_r439104537", "createdAt": "2020-06-11T22:25:29Z", "author": {"login": "mark-vieira"}, "path": "buildSrc/src/main/java/org/elasticsearch/gradle/precommit/ThirdPartyAuditTask.java", "diffHunk": "@@ -391,7 +391,7 @@ private String runForbiddenAPIsCli() throws IOException {\n     private Configuration getRuntimeConfiguration() {\n         Configuration runtime = getProject().getConfigurations().findByName(\"runtimeClasspath\");\n         if (runtime == null) {\n-            return getProject().getConfigurations().getByName(\"testCompile\");\n+            return getProject().getConfigurations().getByName(\"testCompileClasspath\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2b161b28badb7739bb59bedde24ba13ebafb7172"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTEwNTEwNg==", "bodyText": "If we just used testRuntimeClasspath wouldn't that work as well?", "url": "https://github.com/elastic/elasticsearch/pull/57921#discussion_r439105106", "createdAt": "2020-06-11T22:27:10Z", "author": {"login": "mark-vieira"}, "path": "qa/full-cluster-restart/build.gradle", "diffHunk": "@@ -74,6 +74,7 @@ for (Version bwcVersion : BuildParams.bwcVersions.indexCompatible) {\n \n configurations {\n   testArtifacts.extendsFrom testRuntime\n+  testArtifacts.extendsFrom testImplementation", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2b161b28badb7739bb59bedde24ba13ebafb7172"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTEwNTk2Nw==", "bodyText": "Can we just remove this?", "url": "https://github.com/elastic/elasticsearch/pull/57921#discussion_r439105967", "createdAt": "2020-06-11T22:29:38Z", "author": {"login": "mark-vieira"}, "path": "x-pack/plugin/security/build.gradle", "diffHunk": "@@ -65,71 +65,71 @@ dependencies {\n   compile \"net.minidev:accessors-smart:1.2\"\n   compile \"org.ow2.asm:asm:7.1\"\n \n-  testCompile 'org.elasticsearch:securemock:1.2'\n-  testCompile \"org.elasticsearch:mocksocket:${versions.mocksocket}\"\n-  //testCompile \"org.yaml:snakeyaml:${versions.snakeyaml}\"\n+  testImplementation 'org.elasticsearch:securemock:1.2'\n+  testImplementation \"org.elasticsearch:mocksocket:${versions.mocksocket}\"\n+  //testImplementation \"org.yaml:snakeyaml:${versions.snakeyaml}\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2b161b28badb7739bb59bedde24ba13ebafb7172"}, "originalPosition": 87}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b4eb75ebd66884773e6af8cb97d45c4ea4863e6f", "author": {"user": {"login": "breskeby", "name": "Rene Groeschke"}}, "url": "https://github.com/elastic/elasticsearch/commit/b4eb75ebd66884773e6af8cb97d45c4ea4863e6f", "committedDate": "2020-06-12T06:53:10Z", "message": "Apply review feedback & cleanup"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cd80915b2beb0a571df9eaf9fa80147c9172cbad", "author": {"user": {"login": "elasticmachine", "name": "Elastic Machine"}}, "url": "https://github.com/elastic/elasticsearch/commit/cd80915b2beb0a571df9eaf9fa80147c9172cbad", "committedDate": "2020-06-12T08:31:18Z", "message": "Merge branch 'master' into remove-deprecated-testcompile-config-use"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 731, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}