{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg0NDgyODc4", "number": 53187, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMVQyMTo0MjoyMFrODnQx3g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMVQyMTo0MjoyMFrODnQx3g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQyNDk1OTY2OnYy", "diffSide": "RIGHT", "path": "x-pack/plugin/eql/src/test/java/org/elasticsearch/xpack/eql/planner/QueryFolderFailTests.java", "isResolved": false, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMVQyMTo0MjoyMFrOF1KIug==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMlQxMjozNDowMlrOF1cuug==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTI4NDkyMg==", "bodyText": "This error message is confusing to the end user: there is no equality comparison in the query... I'm not saying the test is incorrect, but the way we report the error in the context of EQL is slightly incorrect.", "url": "https://github.com/elastic/elasticsearch/pull/53187#discussion_r391284922", "createdAt": "2020-03-11T21:42:20Z", "author": {"login": "astefan"}, "path": "x-pack/plugin/eql/src/test/java/org/elasticsearch/xpack/eql/planner/QueryFolderFailTests.java", "diffHunk": "@@ -0,0 +1,25 @@\n+/*\n+ * Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one\n+ * or more contributor license agreements. Licensed under the Elastic License;\n+ * you may not use this file except in compliance with the Elastic License.\n+ */\n+\n+package org.elasticsearch.xpack.eql.planner;\n+\n+import org.elasticsearch.xpack.ql.QlIllegalArgumentException;\n+\n+public class QueryFolderFailTests extends AbstractQueryFolderTestCase {\n+    public void testPropertyEquationFilterUnsupported() {\n+        QlIllegalArgumentException e = expectThrows(QlIllegalArgumentException.class,\n+                () -> plan(\"process where (serial_event_id<9 and serial_event_id >= 7) or (opcode == pid)\"));\n+        String msg = e.getMessage();\n+        assertEquals(\"Line 1:74: Comparisons against variables are not (currently) supported; offender [pid] in [==]\", msg);\n+    }\n+\n+    public void testPropertyEquationInClauseFilterUnsupported() {\n+        QlIllegalArgumentException e = expectThrows(QlIllegalArgumentException.class,\n+                () -> plan(\"process where opcode in (1,3) and process_name in (parent_process_name, \\\"SYSTEM\\\")\"));\n+        String msg = e.getMessage();\n+        assertEquals(\"Line 1:52: Comparisons against variables are not (currently) supported; offender [parent_process_name] in [==]\", msg);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7c5c6af7bd130565bf2b51e9c231792f2b436288"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTM3MTYyOQ==", "bodyText": "Agreed. @costin thoughts?", "url": "https://github.com/elastic/elasticsearch/pull/53187#discussion_r391371629", "createdAt": "2020-03-12T02:34:34Z", "author": {"login": "aleksmaus"}, "path": "x-pack/plugin/eql/src/test/java/org/elasticsearch/xpack/eql/planner/QueryFolderFailTests.java", "diffHunk": "@@ -0,0 +1,25 @@\n+/*\n+ * Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one\n+ * or more contributor license agreements. Licensed under the Elastic License;\n+ * you may not use this file except in compliance with the Elastic License.\n+ */\n+\n+package org.elasticsearch.xpack.eql.planner;\n+\n+import org.elasticsearch.xpack.ql.QlIllegalArgumentException;\n+\n+public class QueryFolderFailTests extends AbstractQueryFolderTestCase {\n+    public void testPropertyEquationFilterUnsupported() {\n+        QlIllegalArgumentException e = expectThrows(QlIllegalArgumentException.class,\n+                () -> plan(\"process where (serial_event_id<9 and serial_event_id >= 7) or (opcode == pid)\"));\n+        String msg = e.getMessage();\n+        assertEquals(\"Line 1:74: Comparisons against variables are not (currently) supported; offender [pid] in [==]\", msg);\n+    }\n+\n+    public void testPropertyEquationInClauseFilterUnsupported() {\n+        QlIllegalArgumentException e = expectThrows(QlIllegalArgumentException.class,\n+                () -> plan(\"process where opcode in (1,3) and process_name in (parent_process_name, \\\"SYSTEM\\\")\"));\n+        String msg = e.getMessage();\n+        assertEquals(\"Line 1:52: Comparisons against variables are not (currently) supported; offender [parent_process_name] in [==]\", msg);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTI4NDkyMg=="}, "originalCommit": {"oid": "7c5c6af7bd130565bf2b51e9c231792f2b436288"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTUyODY3MQ==", "bodyText": "I agree - to improve the message one could either look and check whether it's the first comparison (which might not work if any is added) or check whether the comparison is added against the event_type field and if so, mention that in the error message (e.g. offender eventy.category`).", "url": "https://github.com/elastic/elasticsearch/pull/53187#discussion_r391528671", "createdAt": "2020-03-12T10:30:42Z", "author": {"login": "costin"}, "path": "x-pack/plugin/eql/src/test/java/org/elasticsearch/xpack/eql/planner/QueryFolderFailTests.java", "diffHunk": "@@ -0,0 +1,25 @@\n+/*\n+ * Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one\n+ * or more contributor license agreements. Licensed under the Elastic License;\n+ * you may not use this file except in compliance with the Elastic License.\n+ */\n+\n+package org.elasticsearch.xpack.eql.planner;\n+\n+import org.elasticsearch.xpack.ql.QlIllegalArgumentException;\n+\n+public class QueryFolderFailTests extends AbstractQueryFolderTestCase {\n+    public void testPropertyEquationFilterUnsupported() {\n+        QlIllegalArgumentException e = expectThrows(QlIllegalArgumentException.class,\n+                () -> plan(\"process where (serial_event_id<9 and serial_event_id >= 7) or (opcode == pid)\"));\n+        String msg = e.getMessage();\n+        assertEquals(\"Line 1:74: Comparisons against variables are not (currently) supported; offender [pid] in [==]\", msg);\n+    }\n+\n+    public void testPropertyEquationInClauseFilterUnsupported() {\n+        QlIllegalArgumentException e = expectThrows(QlIllegalArgumentException.class,\n+                () -> plan(\"process where opcode in (1,3) and process_name in (parent_process_name, \\\"SYSTEM\\\")\"));\n+        String msg = e.getMessage();\n+        assertEquals(\"Line 1:52: Comparisons against variables are not (currently) supported; offender [parent_process_name] in [==]\", msg);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTI4NDkyMg=="}, "originalCommit": {"oid": "7c5c6af7bd130565bf2b51e9c231792f2b436288"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTU4OTU2Mg==", "bodyText": "Will open a separate issue for the error message per conversation with Costin.", "url": "https://github.com/elastic/elasticsearch/pull/53187#discussion_r391589562", "createdAt": "2020-03-12T12:34:02Z", "author": {"login": "aleksmaus"}, "path": "x-pack/plugin/eql/src/test/java/org/elasticsearch/xpack/eql/planner/QueryFolderFailTests.java", "diffHunk": "@@ -0,0 +1,25 @@\n+/*\n+ * Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one\n+ * or more contributor license agreements. Licensed under the Elastic License;\n+ * you may not use this file except in compliance with the Elastic License.\n+ */\n+\n+package org.elasticsearch.xpack.eql.planner;\n+\n+import org.elasticsearch.xpack.ql.QlIllegalArgumentException;\n+\n+public class QueryFolderFailTests extends AbstractQueryFolderTestCase {\n+    public void testPropertyEquationFilterUnsupported() {\n+        QlIllegalArgumentException e = expectThrows(QlIllegalArgumentException.class,\n+                () -> plan(\"process where (serial_event_id<9 and serial_event_id >= 7) or (opcode == pid)\"));\n+        String msg = e.getMessage();\n+        assertEquals(\"Line 1:74: Comparisons against variables are not (currently) supported; offender [pid] in [==]\", msg);\n+    }\n+\n+    public void testPropertyEquationInClauseFilterUnsupported() {\n+        QlIllegalArgumentException e = expectThrows(QlIllegalArgumentException.class,\n+                () -> plan(\"process where opcode in (1,3) and process_name in (parent_process_name, \\\"SYSTEM\\\")\"));\n+        String msg = e.getMessage();\n+        assertEquals(\"Line 1:52: Comparisons against variables are not (currently) supported; offender [parent_process_name] in [==]\", msg);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTI4NDkyMg=="}, "originalCommit": {"oid": "7c5c6af7bd130565bf2b51e9c231792f2b436288"}, "originalPosition": 23}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3441, "cost": 1, "resetAt": "2021-11-12T11:57:46Z"}}}