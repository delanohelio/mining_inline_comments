{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDk5ODM1OTU0", "number": 63465, "title": "Convert WildcardFieldMapper to parametrized form", "bodyText": "Relates to #62988", "createdAt": "2020-10-08T10:58:22Z", "url": "https://github.com/elastic/elasticsearch/pull/63465", "merged": true, "mergeCommit": {"oid": "6db5b5f2abcb03631e199205880ca5d22c56cb83"}, "closed": true, "closedAt": "2020-10-13T13:26:56Z", "author": {"login": "romseygeek"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdQfbnvgH2gAyNDk5ODM1OTU0OmYxYjY1YjAxNmUwYWU5YmJmZmRlNDVmNzUwYWVmY2Y5MzQ3MjJiMzc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdSH_OcAH2gAyNDk5ODM1OTU0OmVjNzUxN2MxMGQwZWQzYmFiZWYzODNkZjEzMGQzZGQ5MjkzYjQ3NWE=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "f1b65b016e0ae9bbffde45f750aefcf934722b37", "author": {"user": {"login": "romseygeek", "name": "Alan Woodward"}}, "url": "https://github.com/elastic/elasticsearch/commit/f1b65b016e0ae9bbffde45f750aefcf934722b37", "committedDate": "2020-10-08T10:57:15Z", "message": "Convert WildcardFieldMapper to parametrized form"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8a0721199dc68b96d6c2f3ab9ff4de73717d2f13", "author": {"user": {"login": "elasticmachine", "name": "Elastic Machine"}}, "url": "https://github.com/elastic/elasticsearch/commit/8a0721199dc68b96d6c2f3ab9ff4de73717d2f13", "committedDate": "2020-10-13T10:02:37Z", "message": "Merge branch 'master' into mapper/wildcard"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA3MzY4NTU0", "url": "https://github.com/elastic/elasticsearch/pull/63465#pullrequestreview-507368554", "createdAt": "2020-10-13T12:16:15Z", "commit": {"oid": "8a0721199dc68b96d6c2f3ab9ff4de73717d2f13"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xM1QxMjoxNjoxNlrOHgjtwg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xM1QxMjoxNjoyMlrOHgjuAQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzkwMTYzNA==", "bodyText": "Was this unused?", "url": "https://github.com/elastic/elasticsearch/pull/63465#discussion_r503901634", "createdAt": "2020-10-13T12:16:16Z", "author": {"login": "cbuescher"}, "path": "x-pack/plugin/wildcard/src/main/java/org/elasticsearch/xpack/wildcard/mapper/WildcardFieldMapper.java", "diffHunk": "@@ -690,12 +634,6 @@ static boolean isMatchAll(Query q) {\n             return q instanceof MatchAllDocsQuery || q instanceof MatchAllButRequireVerificationQuery;\n         }\n \n-        protected String firstNgramToken(String fragment, Analyzer analyzer) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8a0721199dc68b96d6c2f3ab9ff4de73717d2f13"}, "originalPosition": 253}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzkwMTY5Nw==", "bodyText": "Just curious because haven't reviews that many of these moves to ParametrizedFieldMapper yet: These errors woll now happen automatically if no Parameter is defined?", "url": "https://github.com/elastic/elasticsearch/pull/63465#discussion_r503901697", "createdAt": "2020-10-13T12:16:22Z", "author": {"login": "cbuescher"}, "path": "x-pack/plugin/wildcard/src/main/java/org/elasticsearch/xpack/wildcard/mapper/WildcardFieldMapper.java", "diffHunk": "@@ -185,115 +172,73 @@ private static int normalize(int codepoint) {\n \n     public static class Defaults {\n         public static final FieldType FIELD_TYPE = new FieldType();\n-\n         static {\n             FIELD_TYPE.setTokenized(false);\n             FIELD_TYPE.setIndexOptions(IndexOptions.DOCS);\n             FIELD_TYPE.setStoreTermVectorOffsets(false);\n             FIELD_TYPE.setOmitNorms(true);\n             FIELD_TYPE.freeze();\n         }\n+        public static final TextSearchInfo TEXT_SEARCH_INFO\n+            = new TextSearchInfo(FIELD_TYPE, null, Lucene.KEYWORD_ANALYZER, Lucene.KEYWORD_ANALYZER);\n         public static final int IGNORE_ABOVE = Integer.MAX_VALUE;\n-        public static final String NULL_VALUE = null;\n     }\n \n-    public static class Builder extends FieldMapper.Builder<Builder> {\n-        protected int ignoreAbove = Defaults.IGNORE_ABOVE;\n-        protected String nullValue = Defaults.NULL_VALUE;\n+    private static WildcardFieldMapper toType(FieldMapper in) {\n+        return (WildcardFieldMapper) in;\n+    }\n \n-        public Builder(String name) {\n-            super(name, Defaults.FIELD_TYPE);\n-            builder = this;\n-        }\n+    public static class Builder extends ParametrizedFieldMapper.Builder {\n \n-        @Override\n-        public Builder docValues(boolean docValues) {\n-            if (docValues == false) {\n-                throw new MapperParsingException(\"The field [\" + name + \"] cannot have doc values = false\");\n-            }\n-            return this;\n-        }\n+        final Parameter<Integer> ignoreAbove\n+            = Parameter.intParam(\"ignore_above\", true, m -> toType(m).ignoreAbove, Defaults.IGNORE_ABOVE)\n+            .setValidator(v -> {\n+                if (v < 0) {\n+                    throw new IllegalArgumentException(\"[ignore_above] must be positive, got [\" + v + \"]\");\n+                }\n+            });\n+        final Parameter<String> nullValue\n+            = Parameter.stringParam(\"null_value\", false, m -> toType(m).nullValue, null).acceptsNull();\n \n-        @Override\n-        public Builder indexOptions(IndexOptions indexOptions) {\n-            if (indexOptions != IndexOptions.DOCS) {\n-                throw new MapperParsingException(\"The field [\" + name + \"] cannot have indexOptions = \" + indexOptions);\n-            }\n-            return this;\n-        }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8a0721199dc68b96d6c2f3ab9ff4de73717d2f13"}, "originalPosition": 141}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7c2190defd42a57fd2385f6cc5a85ff5f3138506", "author": {"user": {"login": "romseygeek", "name": "Alan Woodward"}}, "url": "https://github.com/elastic/elasticsearch/commit/7c2190defd42a57fd2385f6cc5a85ff5f3138506", "committedDate": "2020-10-13T12:46:00Z", "message": "Merge remote-tracking branch 'origin/master' into mapper/wildcard"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ec7517c10d0ed3babef383df130d3dd9293b475a", "author": {"user": {"login": "romseygeek", "name": "Alan Woodward"}}, "url": "https://github.com/elastic/elasticsearch/commit/ec7517c10d0ed3babef383df130d3dd9293b475a", "committedDate": "2020-10-13T12:46:16Z", "message": "Merge remote-tracking branch 'romseygeek/mapper/wildcard' into mapper/wildcard"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4211, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}