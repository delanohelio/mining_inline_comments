{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQwNTc2OTU0", "number": 58597, "title": "Week based parsing for ingest date processor", "bodyText": "Date processor was incorrectly parsing week based dates as when a\nweekbased year was provided ingest module was thinking year was not\non a date and was trying to applying the logic for dd/MM type of\ndates.\nFor testing ingest has to have access to ISOCalendarDataProvider in\norder to correctly calculate week based dates with ISO rules.\nDate Processor is also allowing users to specify locale parameter. It\nshould be taken into account when parsing dates - currently only used\nfor formatting. If someone specifies 'en-us' locale, then calendar data\nrules for that locale should be used.\nThe exception is iso8601 format. If someone is using that format,\nthen locale should not override calendar data rules.\ncloses #58479", "createdAt": "2020-06-26T13:09:31Z", "url": "https://github.com/elastic/elasticsearch/pull/58597", "merged": true, "mergeCommit": {"oid": "ee79ae072ba14117e4429291f9ecc5368a2be432"}, "closed": true, "closedAt": "2020-07-01T07:28:09Z", "author": {"login": "pgomulka"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcvC4XdAH2gAyNDQwNTc2OTU0OmUxMmJkOTVlNTk4OTFiNmY2MzMwMzc3ZGU5NzNhMjYwMTBjOTUyNzQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcwdbB2gFqTQ0MDQzMDU1NQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "e12bd95e59891b6f6330377de973a26010c95274", "author": {"user": {"login": "pgomulka", "name": "Przemyslaw Gomulka"}}, "url": "https://github.com/elastic/elasticsearch/commit/e12bd95e59891b6f6330377de973a26010c95274", "committedDate": "2020-06-26T13:01:54Z", "message": "Week based parsing for ingest date processor\n\nDate processor was incorrectly parsing week based dates as when a\nweekbased year was provided ingest module was thinking year was not\non a date and was trying to applying the logic for `dd/MM` type of\ndates.\nFor testing ingest has to have access to ISOCalendarDataProvider in\norder to correctly calculate week based dates with ISO rules.\nDate Processor is also allowing users to specify locale parameter. It\nshould be taken into account when parsing dates - currently only used\nfor formatting. If someone specifies 'en-us' locale, then calendar data\nrules for that locale should be used.\n\ncloses https://github.com/elastic/elasticsearch/issues/58479"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d83791602f4937224aa6220cec67c44e99f9f0ae", "author": {"user": {"login": "pgomulka", "name": "Przemyslaw Gomulka"}}, "url": "https://github.com/elastic/elasticsearch/commit/d83791602f4937224aa6220cec67c44e99f9f0ae", "committedDate": "2020-06-26T13:14:26Z", "message": "do not allow chaning locale for iso8601 date format"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM5NTIzMDI3", "url": "https://github.com/elastic/elasticsearch/pull/58597#pullrequestreview-439523027", "createdAt": "2020-06-29T21:45:31Z", "commit": {"oid": "d83791602f4937224aa6220cec67c44e99f9f0ae"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yOVQyMTo0NTozMVrOGqjV2w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yOVQyMTo0Njo0MFrOGqjYVA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzI3MjQxMQ==", "bodyText": "unfinished comment?", "url": "https://github.com/elastic/elasticsearch/pull/58597#discussion_r447272411", "createdAt": "2020-06-29T21:45:31Z", "author": {"login": "rjernst"}, "path": "modules/ingest-common/src/main/java/org/elasticsearch/ingest/common/DateFormat.java", "diffHunk": "@@ -45,8 +46,13 @@\n     Iso8601 {\n         @Override\n         Function<String, ZonedDateTime> getFunction(String format, ZoneId timezone, Locale locale) {\n-            return (date) -> DateFormatters.from(DateFormatter.forPattern(\"iso8601\").parse(date), timezone)\n-                                            .withZoneSameInstant(timezone);\n+            //", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d83791602f4937224aa6220cec67c44e99f9f0ae"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzI3MjUyNg==", "bodyText": "nit: extra newlines?", "url": "https://github.com/elastic/elasticsearch/pull/58597#discussion_r447272526", "createdAt": "2020-06-29T21:45:47Z", "author": {"login": "rjernst"}, "path": "modules/ingest-common/src/test/java/org/elasticsearch/ingest/common/DateFormatTests.java", "diffHunk": "@@ -126,4 +143,6 @@ public void testFromString() {\n         assertThat(DateFormat.fromString(\"tai64n\"), equalTo(DateFormat.Java));\n         assertThat(DateFormat.fromString(\"prefix-\" + randomAlphaOfLengthBetween(1, 10)), equalTo(DateFormat.Java));\n     }\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d83791602f4937224aa6220cec67c44e99f9f0ae"}, "originalPosition": 28}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzI3MzA0NA==", "bodyText": "Why is this necessary? modules depend on server, implicitly, so we should be able to use the date classes moved there from server, not need them in core lib", "url": "https://github.com/elastic/elasticsearch/pull/58597#discussion_r447273044", "createdAt": "2020-06-29T21:46:40Z", "author": {"login": "rjernst"}, "path": "modules/ingest-common/build.gradle", "diffHunk": "@@ -25,6 +25,7 @@ esplugin {\n \n dependencies {\n   compileOnly project(':modules:lang-painless')\n+  compile project(':libs:elasticsearch-core')", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d83791602f4937224aa6220cec67c44e99f9f0ae"}, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "be15503d09f7c10d9980f586bc46d13bedb76551", "author": {"user": {"login": "pgomulka", "name": "Przemyslaw Gomulka"}}, "url": "https://github.com/elastic/elasticsearch/commit/be15503d09f7c10d9980f586bc46d13bedb76551", "committedDate": "2020-06-30T06:39:46Z", "message": "cleanup after review"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "554881794a723153b9b0f638289773f846990fc9", "author": {"user": {"login": "pgomulka", "name": "Przemyslaw Gomulka"}}, "url": "https://github.com/elastic/elasticsearch/commit/554881794a723153b9b0f638289773f846990fc9", "committedDate": "2020-06-30T11:00:35Z", "message": "Merge branch 'master' into date_processor_weeks_and_locale"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "baf45e71ec0e7997645d237946e171ee5b1f8691", "author": {"user": {"login": "pgomulka", "name": "Przemyslaw Gomulka"}}, "url": "https://github.com/elastic/elasticsearch/commit/baf45e71ec0e7997645d237946e171ee5b1f8691", "committedDate": "2020-06-30T11:23:47Z", "message": "api"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "59ee920f0ccd78a560817fdc8e8780754b0d20a2", "author": {"user": {"login": "pgomulka", "name": "Przemyslaw Gomulka"}}, "url": "https://github.com/elastic/elasticsearch/commit/59ee920f0ccd78a560817fdc8e8780754b0d20a2", "committedDate": "2020-06-30T12:52:46Z", "message": "move isocalendardataprovider back to server and remove dependency"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQwNDMwNTU1", "url": "https://github.com/elastic/elasticsearch/pull/58597#pullrequestreview-440430555", "createdAt": "2020-06-30T22:31:13Z", "commit": {"oid": "59ee920f0ccd78a560817fdc8e8780754b0d20a2"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2658, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}