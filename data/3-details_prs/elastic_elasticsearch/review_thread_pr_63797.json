{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTA0NzM3NTM2", "number": 63797, "reviewThreads": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNlQxMTozNjowN1rOEudEFw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNlQxMjo1NDo0M1rOEufQOA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE3MTQ2MTM1OnYy", "diffSide": "RIGHT", "path": "x-pack/docs/en/rest-api/security/get-tokens.asciidoc", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNlQxMTozNjowN1rOHi3h3Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNlQxNDo0ODo0OFrOHjCkyA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjMyMzQyMQ==", "bodyText": "The format is still incorrect for this section. Other places look good.", "url": "https://github.com/elastic/elasticsearch/pull/63797#discussion_r506323421", "createdAt": "2020-10-16T11:36:07Z", "author": {"login": "ywangd"}, "path": "x-pack/docs/en/rest-api/security/get-tokens.asciidoc", "diffHunk": "@@ -125,21 +125,21 @@ seconds) that the token expires in, and the type:\n   \"type\" : \"Bearer\",\n   \"expires_in\" : 1200,\n   \"authentication\" : {\n-   \"username\" : \"test_admin\",\n-   \"roles\" : [\n-    \"superuser\"\n-   ],\n-  \"full_name\" : null,\n-  \"email\" : null,\n-  \"metadata\" : { },\n-  \"enabled\" : true,\n-  \"authentication_realm\" : {\n-   \"name\" : \"file\",\n-   \"type\" : \"file\"\n-  },\n-  \"lookup_realm\" : {\n-   \"name\" : \"file\",\n-   \"type\" : \"file\"\n+    \"username\" : \"test_admin\",\n+    \"roles\" : [\n+      \"superuser\"\n+    ],\n+    \"full_name\" : null,\n+    \"email\" : null,\n+    \"metadata\" : { },\n+    \"enabled\" : true,\n+    \"authentication_realm\" : {\n+      \"name\" : \"file\",\n+      \"type\" : \"file\"\n+    },\n+    \"lookup_realm\" : {\n+    \"name\" : \"file\",\n+    \"type\" : \"file\"\n   },\n   \"authentication_type\" : \"realm\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e17c289be8b02f4dd48f14619039059a3b3d1648"}, "originalPosition": 35}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjUwNDM5Mg==", "bodyText": "Done", "url": "https://github.com/elastic/elasticsearch/pull/63797#discussion_r506504392", "createdAt": "2020-10-16T14:48:48Z", "author": {"login": "BigPandaToo"}, "path": "x-pack/docs/en/rest-api/security/get-tokens.asciidoc", "diffHunk": "@@ -125,21 +125,21 @@ seconds) that the token expires in, and the type:\n   \"type\" : \"Bearer\",\n   \"expires_in\" : 1200,\n   \"authentication\" : {\n-   \"username\" : \"test_admin\",\n-   \"roles\" : [\n-    \"superuser\"\n-   ],\n-  \"full_name\" : null,\n-  \"email\" : null,\n-  \"metadata\" : { },\n-  \"enabled\" : true,\n-  \"authentication_realm\" : {\n-   \"name\" : \"file\",\n-   \"type\" : \"file\"\n-  },\n-  \"lookup_realm\" : {\n-   \"name\" : \"file\",\n-   \"type\" : \"file\"\n+    \"username\" : \"test_admin\",\n+    \"roles\" : [\n+      \"superuser\"\n+    ],\n+    \"full_name\" : null,\n+    \"email\" : null,\n+    \"metadata\" : { },\n+    \"enabled\" : true,\n+    \"authentication_realm\" : {\n+      \"name\" : \"file\",\n+      \"type\" : \"file\"\n+    },\n+    \"lookup_realm\" : {\n+    \"name\" : \"file\",\n+    \"type\" : \"file\"\n   },\n   \"authentication_type\" : \"realm\"", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjMyMzQyMQ=="}, "originalCommit": {"oid": "e17c289be8b02f4dd48f14619039059a3b3d1648"}, "originalPosition": 35}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE3MTQ5MzYyOnYy", "diffSide": "RIGHT", "path": "x-pack/plugin/security/src/internalClusterTest/java/org/elasticsearch/xpack/security/authc/TokenAuthIntegTests.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNlQxMTo0MzowNVrOHi34CQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNlQxNDo0ODo1N1rOHjClSA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjMyOTA5Nw==", "bodyText": "The parameter order of assertEquals should be first \"expected\", then \"actual\", i.e.:\nassertEquals(SecuritySettingsSource.TEST_USER_NAME, response.getAuthentication().getUser().getUsername());", "url": "https://github.com/elastic/elasticsearch/pull/63797#discussion_r506329097", "createdAt": "2020-10-16T11:43:05Z", "author": {"login": "ywangd"}, "path": "x-pack/plugin/security/src/internalClusterTest/java/org/elasticsearch/xpack/security/authc/TokenAuthIntegTests.java", "diffHunk": "@@ -134,7 +134,8 @@ public void testTokenServiceCanRotateKeys() throws Exception {\n             assertNotNull(userTokenFuture.actionGet());\n             assertNotEquals(activeKeyHash, tokenService.getActiveKeyHash());\n         }\n-        assertNotNull(response.getAuthenticationResponse());\n+        assertNotNull(response.getAuthentication());\n+        assertEquals(response.getAuthentication().getUser().getUsername(), SecuritySettingsSource.TEST_USER_NAME);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e17c289be8b02f4dd48f14619039059a3b3d1648"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjUwNDUyMA==", "bodyText": "Done", "url": "https://github.com/elastic/elasticsearch/pull/63797#discussion_r506504520", "createdAt": "2020-10-16T14:48:57Z", "author": {"login": "BigPandaToo"}, "path": "x-pack/plugin/security/src/internalClusterTest/java/org/elasticsearch/xpack/security/authc/TokenAuthIntegTests.java", "diffHunk": "@@ -134,7 +134,8 @@ public void testTokenServiceCanRotateKeys() throws Exception {\n             assertNotNull(userTokenFuture.actionGet());\n             assertNotEquals(activeKeyHash, tokenService.getActiveKeyHash());\n         }\n-        assertNotNull(response.getAuthenticationResponse());\n+        assertNotNull(response.getAuthentication());\n+        assertEquals(response.getAuthentication().getUser().getUsername(), SecuritySettingsSource.TEST_USER_NAME);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjMyOTA5Nw=="}, "originalCommit": {"oid": "e17c289be8b02f4dd48f14619039059a3b3d1648"}, "originalPosition": 22}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE3MTUwNDg5OnYy", "diffSide": "RIGHT", "path": "x-pack/plugin/security/src/internalClusterTest/java/org/elasticsearch/xpack/security/authc/pki/PkiAuthDelegationIntegTests.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNlQxMTo0NToyOFrOHi3_rg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNlQxNDo0OTowOFrOHjCl3A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjMzMTA1NA==", "bodyText": "We should also assert the authentication's principal here for the same reason that there are two credentials involved.\nThis comment also applies to where the authentication object is verified in OpenIdConnectAuthIT and SamlAuthenticationIT, i.e. authentication principal should be checked in those places as well.", "url": "https://github.com/elastic/elasticsearch/pull/63797#discussion_r506331054", "createdAt": "2020-10-16T11:45:28Z", "author": {"login": "ywangd"}, "path": "x-pack/plugin/security/src/internalClusterTest/java/org/elasticsearch/xpack/security/authc/pki/PkiAuthDelegationIntegTests.java", "diffHunk": "@@ -149,7 +149,7 @@ public void testDelegateThenAuthenticate() throws Exception {\n                         optionsBuilder.build());\n                 String token = delegatePkiResponse.getAccessToken();\n                 assertThat(token, is(notNullValue()));\n-                assertNotNull(delegatePkiResponse.getAuthenticationResponse());\n+                assertNotNull(delegatePkiResponse.getAuthentication());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e17c289be8b02f4dd48f14619039059a3b3d1648"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjUwNDY2OA==", "bodyText": "Done", "url": "https://github.com/elastic/elasticsearch/pull/63797#discussion_r506504668", "createdAt": "2020-10-16T14:49:08Z", "author": {"login": "BigPandaToo"}, "path": "x-pack/plugin/security/src/internalClusterTest/java/org/elasticsearch/xpack/security/authc/pki/PkiAuthDelegationIntegTests.java", "diffHunk": "@@ -149,7 +149,7 @@ public void testDelegateThenAuthenticate() throws Exception {\n                         optionsBuilder.build());\n                 String token = delegatePkiResponse.getAccessToken();\n                 assertThat(token, is(notNullValue()));\n-                assertNotNull(delegatePkiResponse.getAuthenticationResponse());\n+                assertNotNull(delegatePkiResponse.getAuthentication());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjMzMTA1NA=="}, "originalCommit": {"oid": "e17c289be8b02f4dd48f14619039059a3b3d1648"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE3MTU0MDc0OnYy", "diffSide": "RIGHT", "path": "x-pack/plugin/security/src/internalClusterTest/java/org/elasticsearch/xpack/security/authc/TokenAuthIntegTests.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNlQxMTo1Mzo0N1rOHi4X9Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNlQxNDo0OToyMFrOHjCmbQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjMzNzI2OQ==", "bodyText": "Can we assert authentication principal here as well? Because this is a refresh response which goes through a different transport action than the token creation with password grant (which is asserted).", "url": "https://github.com/elastic/elasticsearch/pull/63797#discussion_r506337269", "createdAt": "2020-10-16T11:53:47Z", "author": {"login": "ywangd"}, "path": "x-pack/plugin/security/src/internalClusterTest/java/org/elasticsearch/xpack/security/authc/TokenAuthIntegTests.java", "diffHunk": "@@ -367,7 +368,7 @@ public void testRefreshingToken() throws IOException {\n \n         // Assert that we can authenticate with the refreshed access token\n         assertAuthenticateWithToken(refreshResponse.getAccessToken(), SecuritySettingsSource.TEST_USER_NAME);\n-        assertNotNull(refreshResponse.getAuthenticationResponse());\n+        assertNotNull(refreshResponse.getAuthentication());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e17c289be8b02f4dd48f14619039059a3b3d1648"}, "originalPosition": 31}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjUwNDgxMw==", "bodyText": "Done", "url": "https://github.com/elastic/elasticsearch/pull/63797#discussion_r506504813", "createdAt": "2020-10-16T14:49:20Z", "author": {"login": "BigPandaToo"}, "path": "x-pack/plugin/security/src/internalClusterTest/java/org/elasticsearch/xpack/security/authc/TokenAuthIntegTests.java", "diffHunk": "@@ -367,7 +368,7 @@ public void testRefreshingToken() throws IOException {\n \n         // Assert that we can authenticate with the refreshed access token\n         assertAuthenticateWithToken(refreshResponse.getAccessToken(), SecuritySettingsSource.TEST_USER_NAME);\n-        assertNotNull(refreshResponse.getAuthenticationResponse());\n+        assertNotNull(refreshResponse.getAuthentication());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjMzNzI2OQ=="}, "originalCommit": {"oid": "e17c289be8b02f4dd48f14619039059a3b3d1648"}, "originalPosition": 31}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE3MTgyMDA4OnYy", "diffSide": "RIGHT", "path": "x-pack/docs/en/rest-api/security/get-tokens.asciidoc", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNlQxMjo1NDo0M1rOHi7QUQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNlQxNDo0OTo0OFrOHjCn-A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjM4NDQ2NQ==", "bodyText": "These two lines are still not aligned.", "url": "https://github.com/elastic/elasticsearch/pull/63797#discussion_r506384465", "createdAt": "2020-10-16T12:54:43Z", "author": {"login": "ywangd"}, "path": "x-pack/docs/en/rest-api/security/get-tokens.asciidoc", "diffHunk": "@@ -125,21 +125,21 @@ seconds) that the token expires in, and the type:\n   \"type\" : \"Bearer\",\n   \"expires_in\" : 1200,\n   \"authentication\" : {\n-   \"username\" : \"test_admin\",\n-   \"roles\" : [\n-    \"superuser\"\n-   ],\n-  \"full_name\" : null,\n-  \"email\" : null,\n-  \"metadata\" : { },\n-  \"enabled\" : true,\n-  \"authentication_realm\" : {\n-   \"name\" : \"file\",\n-   \"type\" : \"file\"\n-  },\n-  \"lookup_realm\" : {\n-   \"name\" : \"file\",\n-   \"type\" : \"file\"\n+    \"username\" : \"test_admin\",\n+    \"roles\" : [\n+      \"superuser\"\n+    ],\n+    \"full_name\" : null,\n+    \"email\" : null,\n+    \"metadata\" : { },\n+    \"enabled\" : true,\n+    \"authentication_realm\" : {\n+      \"name\" : \"file\",\n+      \"type\" : \"file\"\n+    },\n+    \"lookup_realm\" : {\n+      \"name\" : \"file\",\n+      \"type\" : \"file\"\n   },\n   \"authentication_type\" : \"realm\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bc2758967ce4ba5085145b0a048d0911cc612704"}, "originalPosition": 35}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjUwNTIwOA==", "bodyText": "Fixed", "url": "https://github.com/elastic/elasticsearch/pull/63797#discussion_r506505208", "createdAt": "2020-10-16T14:49:48Z", "author": {"login": "BigPandaToo"}, "path": "x-pack/docs/en/rest-api/security/get-tokens.asciidoc", "diffHunk": "@@ -125,21 +125,21 @@ seconds) that the token expires in, and the type:\n   \"type\" : \"Bearer\",\n   \"expires_in\" : 1200,\n   \"authentication\" : {\n-   \"username\" : \"test_admin\",\n-   \"roles\" : [\n-    \"superuser\"\n-   ],\n-  \"full_name\" : null,\n-  \"email\" : null,\n-  \"metadata\" : { },\n-  \"enabled\" : true,\n-  \"authentication_realm\" : {\n-   \"name\" : \"file\",\n-   \"type\" : \"file\"\n-  },\n-  \"lookup_realm\" : {\n-   \"name\" : \"file\",\n-   \"type\" : \"file\"\n+    \"username\" : \"test_admin\",\n+    \"roles\" : [\n+      \"superuser\"\n+    ],\n+    \"full_name\" : null,\n+    \"email\" : null,\n+    \"metadata\" : { },\n+    \"enabled\" : true,\n+    \"authentication_realm\" : {\n+      \"name\" : \"file\",\n+      \"type\" : \"file\"\n+    },\n+    \"lookup_realm\" : {\n+      \"name\" : \"file\",\n+      \"type\" : \"file\"\n   },\n   \"authentication_type\" : \"realm\"", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjM4NDQ2NQ=="}, "originalCommit": {"oid": "bc2758967ce4ba5085145b0a048d0911cc612704"}, "originalPosition": 35}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2810, "cost": 1, "resetAt": "2021-11-12T11:57:46Z"}}}