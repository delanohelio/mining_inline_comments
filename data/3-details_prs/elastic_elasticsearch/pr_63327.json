{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDk4NTY3NDA2", "number": 63327, "title": "Handle error conditions when simulating ingest pipelines with verbosity enabled", "bodyText": "Fixes #63199.", "createdAt": "2020-10-06T13:57:37Z", "url": "https://github.com/elastic/elasticsearch/pull/63327", "merged": true, "mergeCommit": {"oid": "a644ba1ed6132153c97f707b5504bfdf4400dc6a"}, "closed": true, "closedAt": "2020-10-07T19:11:50Z", "author": {"login": "danhermann"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdP3_OOAH2gAyNDk4NTY3NDA2OjQwZDU1NGMzNmI2NzM0NTU4OGZkMjliY2FhYjYwYzU2ZGVlMTYyZmQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdP_JDAAH2gAyNDk4NTY3NDA2OmEzNWRmZDQ5ZjZiYzE2NTA5ODFjZTAyMzJjZTJhNTU4MWYwZTYxZTM=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "40d554c36b67345588fd29bcaab60c56dee162fd", "author": {"user": {"login": "danhermann", "name": "Dan Hermann"}}, "url": "https://github.com/elastic/elasticsearch/commit/40d554c36b67345588fd29bcaab60c56dee162fd", "committedDate": "2020-10-06T12:59:56Z", "message": "Change conditional to handle all exception scenarios"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2b7c651e8dc02dd0e06004e2ad9996309ccea9a2", "author": {"user": {"login": "danhermann", "name": "Dan Hermann"}}, "url": "https://github.com/elastic/elasticsearch/commit/2b7c651e8dc02dd0e06004e2ad9996309ccea9a2", "committedDate": "2020-10-06T13:57:49Z", "message": "add unit test"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAyOTk2NTI4", "url": "https://github.com/elastic/elasticsearch/pull/63327#pullrequestreview-502996528", "createdAt": "2020-10-06T14:01:23Z", "commit": {"oid": "2b7c651e8dc02dd0e06004e2ad9996309ccea9a2"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNlQxNDowMToyM1rOHdITFA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNlQxNDowMToyM1rOHdITFA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDMwNjcwOA==", "bodyText": "This combination of if statements allowed cases of ElasticsearchException with causes other than those of type IllegalStateException to fall through with invoking the failure handler. I believe the original intention was to catch cyclical pipelines so I believe the correct behavior is to check for both conditions at once and allow any other exception scenarios to fall through to the \"now that we know there are no cycles\" condition.", "url": "https://github.com/elastic/elasticsearch/pull/63327#discussion_r500306708", "createdAt": "2020-10-06T14:01:23Z", "author": {"login": "danhermann"}, "path": "server/src/main/java/org/elasticsearch/ingest/TrackingResultProcessor.java", "diffHunk": "@@ -74,19 +74,15 @@ public void execute(IngestDocument ingestDocument, BiConsumer<IngestDocument, Ex\n             }\n             ingestDocumentCopy.executePipeline(pipelineToCall, (result, e) -> {\n                 // do nothing, let the tracking processors throw the exception while recording the path up to the failure\n-                if (e instanceof ElasticsearchException) {\n-                    ElasticsearchException elasticsearchException = (ElasticsearchException) e;\n-                    //else do nothing, let the tracking processors throw the exception while recording the path up to the failure\n-                    if (elasticsearchException.getCause() instanceof IllegalStateException) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2b7c651e8dc02dd0e06004e2ad9996309ccea9a2"}, "originalPosition": 7}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2285091040df53dbd9786b912bf1f04e0db7a8ca", "author": {"user": {"login": "elasticmachine", "name": "Elastic Machine"}}, "url": "https://github.com/elastic/elasticsearch/commit/2285091040df53dbd9786b912bf1f04e0db7a8ca", "committedDate": "2020-10-06T14:54:56Z", "message": "Merge branch 'master' into 63199_simulate_pipeline_error"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAzMTY3Mjg5", "url": "https://github.com/elastic/elasticsearch/pull/63327#pullrequestreview-503167289", "createdAt": "2020-10-06T16:49:33Z", "commit": {"oid": "2285091040df53dbd9786b912bf1f04e0db7a8ca"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNlQxNjo0OTozM1rOHdQ9nA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNlQxNjo0OTozM1rOHdQ9nA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDQ0ODY2OA==", "bodyText": "This was briefly discussed a while back #34155 (comment) ..IIRC it had to do with amount of overhead to introduce a custom exception for an edge case.", "url": "https://github.com/elastic/elasticsearch/pull/63327#discussion_r500448668", "createdAt": "2020-10-06T16:49:33Z", "author": {"login": "jakelandis"}, "path": "server/src/main/java/org/elasticsearch/ingest/TrackingResultProcessor.java", "diffHunk": "@@ -74,19 +74,15 @@ public void execute(IngestDocument ingestDocument, BiConsumer<IngestDocument, Ex\n             }\n             ingestDocumentCopy.executePipeline(pipelineToCall, (result, e) -> {\n                 // do nothing, let the tracking processors throw the exception while recording the path up to the failure\n-                if (e instanceof ElasticsearchException) {\n-                    ElasticsearchException elasticsearchException = (ElasticsearchException) e;\n-                    //else do nothing, let the tracking processors throw the exception while recording the path up to the failure\n-                    if (elasticsearchException.getCause() instanceof IllegalStateException) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDMwNjcwOA=="}, "originalCommit": {"oid": "2b7c651e8dc02dd0e06004e2ad9996309ccea9a2"}, "originalPosition": 7}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b4ec09ca90228f80aba15cb72dcad10d7e6cde91", "author": {"user": {"login": "danhermann", "name": "Dan Hermann"}}, "url": "https://github.com/elastic/elasticsearch/commit/b4ec09ca90228f80aba15cb72dcad10d7e6cde91", "committedDate": "2020-10-06T20:14:05Z", "message": "check exception message in addition to class for pipeline cycle errors"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0b7127207de25699a047be77c553b7b17d80a477", "author": {"user": {"login": "danhermann", "name": "Dan Hermann"}}, "url": "https://github.com/elastic/elasticsearch/commit/0b7127207de25699a047be77c553b7b17d80a477", "committedDate": "2020-10-06T20:29:48Z", "message": "add REST test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8337ef76d3d4bd43616e3b7a562f5160642037f1", "author": {"user": {"login": "danhermann", "name": "Dan Hermann"}}, "url": "https://github.com/elastic/elasticsearch/commit/8337ef76d3d4bd43616e3b7a562f5160642037f1", "committedDate": "2020-10-06T21:02:29Z", "message": "fix REST test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a35dfd49f6bc1650981ce0232ce2a5581f0e61e3", "author": {"user": {"login": "elasticmachine", "name": "Elastic Machine"}}, "url": "https://github.com/elastic/elasticsearch/commit/a35dfd49f6bc1650981ce0232ce2a5581f0e61e3", "committedDate": "2020-10-06T21:20:00Z", "message": "Merge branch 'master' into 63199_simulate_pipeline_error"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4328, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}