{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDkwMjcwNzg3", "number": 62694, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQxMjo1OTo0MVrOEmEk-g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQxMzoxMDoxMVrOEmE2wg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA4MzU2MzQ2OnYy", "diffSide": "RIGHT", "path": "x-pack/plugin/ml/qa/native-multi-node-tests/src/javaRestTest/java/org/elasticsearch/xpack/ml/integration/ModelSnapshotRetentionIT.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQxMjo1OTo0MVrOHV4ynQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQxMjo1OTo0MVrOHV4ynQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjcxMjYwNQ==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                @Before\n          \n          \n            \n                public void addMlState() {\n          \n          \n            \n                /**\n          \n          \n            \n                 * In production the only way to create a model snapshot is to open a job, and\n          \n          \n            \n                 * opening a job ensures that the state index exists. This suite does not open jobs\n          \n          \n            \n                 * but instead inserts snapshot and state documents directly to the results and\n          \n          \n            \n                 * state indices. This means it needs to create the state index explicitly. This\n          \n          \n            \n                 * method should not be copied to test suites that run jobs in the way they are\n          \n          \n            \n                 * run in production.\n          \n          \n            \n                 */\n          \n          \n            \n                @Before\n          \n          \n            \n                public void addMlStateIndex() {", "url": "https://github.com/elastic/elasticsearch/pull/62694#discussion_r492712605", "createdAt": "2020-09-22T12:59:41Z", "author": {"login": "droberts195"}, "path": "x-pack/plugin/ml/qa/native-multi-node-tests/src/javaRestTest/java/org/elasticsearch/xpack/ml/integration/ModelSnapshotRetentionIT.java", "diffHunk": "@@ -51,6 +56,12 @@\n \n     private static final long MS_IN_DAY = TimeValue.timeValueDays(1).millis();\n \n+    @Before\n+    public void addMlState() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ba65e9bad5457aadffeaa3d33e04bc4d248283c5"}, "originalPosition": 32}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA4MzU2NDU4OnYy", "diffSide": "RIGHT", "path": "x-pack/plugin/ml/qa/native-multi-node-tests/src/javaRestTest/java/org/elasticsearch/xpack/ml/integration/ModelSnapshotRetentionIT.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQxMjo1OTo1M1rOHV4zOg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQxMjo1OTo1M1rOHV4zOg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjcxMjc2Mg==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                }\n          \n          \n            \n                }", "url": "https://github.com/elastic/elasticsearch/pull/62694#discussion_r492712762", "createdAt": "2020-09-22T12:59:53Z", "author": {"login": "droberts195"}, "path": "x-pack/plugin/ml/qa/native-multi-node-tests/src/javaRestTest/java/org/elasticsearch/xpack/ml/integration/ModelSnapshotRetentionIT.java", "diffHunk": "@@ -51,6 +56,12 @@\n \n     private static final long MS_IN_DAY = TimeValue.timeValueDays(1).millis();\n \n+    @Before\n+    public void addMlState() {\n+        PlainActionFuture<Boolean> future = new PlainActionFuture<>();\n+        createStateIndexAndAliasIfNecessary(client(), ClusterState.EMPTY_STATE, new IndexNameExpressionResolver(), future);\n+        future.actionGet();\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ba65e9bad5457aadffeaa3d33e04bc4d248283c5"}, "originalPosition": 36}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA4MzU4NTU4OnYy", "diffSide": "RIGHT", "path": "x-pack/plugin/ml/src/internalClusterTest/java/org/elasticsearch/xpack/ml/integration/JobResultsProviderIT.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQxMzowNDo0NFrOHV5ADg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQxMzowNDo0NFrOHV5ADg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjcxNjA0Ng==", "bodyText": "I think you should move this into the indexQuantiles method, so it's closer to the reason why it's needed.  Without comments it's very hard to see why this test needs this and the others don't.", "url": "https://github.com/elastic/elasticsearch/pull/62694#discussion_r492716046", "createdAt": "2020-09-22T13:04:44Z", "author": {"login": "droberts195"}, "path": "x-pack/plugin/ml/src/internalClusterTest/java/org/elasticsearch/xpack/ml/integration/JobResultsProviderIT.java", "diffHunk": "@@ -684,6 +686,9 @@ public void testGetSnapshots() {\n     }\n \n     public void testGetAutodetectParams() throws Exception {\n+        PlainActionFuture<Boolean> future = new PlainActionFuture<>();\n+        createStateIndexAndAliasIfNecessary(client(), ClusterState.EMPTY_STATE, new IndexNameExpressionResolver(), future);\n+        future.get();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ba65e9bad5457aadffeaa3d33e04bc4d248283c5"}, "originalPosition": 22}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA4MzYwODk4OnYy", "diffSide": "RIGHT", "path": "x-pack/plugin/ml/src/internalClusterTest/java/org/elasticsearch/xpack/ml/integration/AutodetectResultProcessorIT.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQxMzoxMDoxMVrOHV5OcA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQxMzoxMDoxMVrOHV5OcA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjcxOTcyOA==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    PlainActionFuture<Boolean> future = new PlainActionFuture<>();\n          \n          \n            \n                    // In production opening a job ensures the state index exists. These tests\n          \n          \n            \n                    // do not open jobs, but instead feed JSON directly to the results processor.\n          \n          \n            \n                    // A a result they must create the index as part of the test setup. Do not\n          \n          \n            \n                    // copy this setup to tests that run jobs in the way they are run in production.\n          \n          \n            \n                    PlainActionFuture<Boolean> future = new PlainActionFuture<>();", "url": "https://github.com/elastic/elasticsearch/pull/62694#discussion_r492719728", "createdAt": "2020-09-22T13:10:11Z", "author": {"login": "droberts195"}, "path": "x-pack/plugin/ml/src/internalClusterTest/java/org/elasticsearch/xpack/ml/integration/AutodetectResultProcessorIT.java", "diffHunk": "@@ -166,6 +169,9 @@ protected void updateModelSnapshotOnJob(ModelSnapshot modelSnapshot) {\n         };\n         waitForMlTemplates();\n         putJob();\n+        PlainActionFuture<Boolean> future = new PlainActionFuture<>();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ba65e9bad5457aadffeaa3d33e04bc4d248283c5"}, "originalPosition": 23}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3523, "cost": 1, "resetAt": "2021-11-12T13:16:51Z"}}}