{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk1NTI4NzUw", "number": 54399, "title": "Remove unused environment from anomaly detector classes", "bodyText": "Following #54371 I realised the Environment variable being passed in to the various AD managers is unused.\nThis takes removes the environment var and some minor tidying up to clean up Intellij inspection warnings", "createdAt": "2020-03-30T09:39:13Z", "url": "https://github.com/elastic/elasticsearch/pull/54399", "merged": true, "mergeCommit": {"oid": "8a359891003b27632cf7518dfa5923a6bbf83a77"}, "closed": true, "closedAt": "2020-03-30T17:49:28Z", "author": {"login": "davidkyle"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcSrTc6gFqTM4MzY4OTk5Nw==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcSt6adgBqjMxNzg0NDgwMTg=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgzNjg5OTk3", "url": "https://github.com/elastic/elasticsearch/pull/54399#pullrequestreview-383689997", "createdAt": "2020-03-30T09:43:52Z", "commit": {"oid": "6b8706e5192e9d9de20faeab5d4043e5b98b569b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMFQwOTo0Mzo1M1rOF9hsKQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMFQwOTo0Mzo1M1rOF9hsKQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDA1OTQzMw==", "bodyText": "Intellij flagged this as a get on an optional without a isPresent check which is a very valid warning. In practice I don't think we could hit an NPE here but it shows the value in the inspections if you can keep the noise level down.", "url": "https://github.com/elastic/elasticsearch/pull/54399#discussion_r400059433", "createdAt": "2020-03-30T09:43:53Z", "author": {"login": "davidkyle"}, "path": "x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/job/process/autodetect/AutodetectProcessManager.java", "diffHunk": "@@ -333,10 +330,16 @@ public void writeUpdateProcessMessage(JobTask jobTask, UpdateParams updateParams\n                     updateProcessMessage.setFilter(filter);\n \n                     if (updateParams.isUpdateScheduledEvents()) {\n-                        jobManager.getJob(jobTask.getJobId(), new ActionListener<Job>() {\n+                        jobManager.getJob(jobTask.getJobId(), new ActionListener<>() {\n                             @Override\n                             public void onResponse(Job job) {\n-                                DataCounts dataCounts = getStatistics(jobTask).get().v1();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6b8706e5192e9d9de20faeab5d4043e5b98b569b"}, "originalPosition": 39}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgzNzAyMTg3", "url": "https://github.com/elastic/elasticsearch/pull/54399#pullrequestreview-383702187", "createdAt": "2020-03-30T09:59:30Z", "commit": {"oid": "6b8706e5192e9d9de20faeab5d4043e5b98b569b"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMFQwOTo1OTozMFrOF9iSjw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMFQwOTo1OTozMFrOF9iSjw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDA2OTI2Mw==", "bodyText": "nit: make it a single liner using ternary?", "url": "https://github.com/elastic/elasticsearch/pull/54399#discussion_r400069263", "createdAt": "2020-03-30T09:59:30Z", "author": {"login": "dimitris-athanasiou"}, "path": "x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/job/process/autodetect/AutodetectProcessManager.java", "diffHunk": "@@ -333,10 +330,16 @@ public void writeUpdateProcessMessage(JobTask jobTask, UpdateParams updateParams\n                     updateProcessMessage.setFilter(filter);\n \n                     if (updateParams.isUpdateScheduledEvents()) {\n-                        jobManager.getJob(jobTask.getJobId(), new ActionListener<Job>() {\n+                        jobManager.getJob(jobTask.getJobId(), new ActionListener<>() {\n                             @Override\n                             public void onResponse(Job job) {\n-                                DataCounts dataCounts = getStatistics(jobTask).get().v1();\n+                                Optional<Tuple<DataCounts, Tuple<ModelSizeStats, TimingStats>>> stats = getStatistics(jobTask);\n+                                DataCounts dataCounts;\n+                                if (stats.isPresent()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6b8706e5192e9d9de20faeab5d4043e5b98b569b"}, "originalPosition": 42}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgzNzU1NzAy", "url": "https://github.com/elastic/elasticsearch/pull/54399#pullrequestreview-383755702", "createdAt": "2020-03-30T11:18:18Z", "commit": {"oid": "6b8706e5192e9d9de20faeab5d4043e5b98b569b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "59d6b124684a7d50e93d2733a7c103e66f594426", "author": {"user": {"login": "davidkyle", "name": "David Kyle"}}, "url": "https://github.com/elastic/elasticsearch/commit/59d6b124684a7d50e93d2733a7c103e66f594426", "committedDate": "2020-03-30T12:32:53Z", "message": "Remove unused environment from anomaly detector classes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b183c63461cd3b919cd10b0df309b86ac3c4b997", "author": {"user": {"login": "davidkyle", "name": "David Kyle"}}, "url": "https://github.com/elastic/elasticsearch/commit/b183c63461cd3b919cd10b0df309b86ac3c4b997", "committedDate": "2020-03-30T12:32:54Z", "message": "Use ternery assignment"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7e0d9f2f80a851cc3c30c2ecb7b945196ebd5084", "author": {"user": {"login": "davidkyle", "name": "David Kyle"}}, "url": "https://github.com/elastic/elasticsearch/commit/7e0d9f2f80a851cc3c30c2ecb7b945196ebd5084", "committedDate": "2020-03-30T11:50:55Z", "message": "Use ternery assignment"}, "afterCommit": {"oid": "b183c63461cd3b919cd10b0df309b86ac3c4b997", "author": {"user": {"login": "davidkyle", "name": "David Kyle"}}, "url": "https://github.com/elastic/elasticsearch/commit/b183c63461cd3b919cd10b0df309b86ac3c4b997", "committedDate": "2020-03-30T12:32:54Z", "message": "Use ternery assignment"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1488, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}