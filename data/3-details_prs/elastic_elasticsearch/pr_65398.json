{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTI2MDQzNDQy", "number": 65398, "title": "[DOCS] Add rollup V2 API docs", "bodyText": "Changes:\n\nDocuments new <index>/_rollup API\nUpdates rollup APIs overview page\nEnables rollups V2 in docs integ tests\n\nRelates to #64900\nScope\nThis PR is focused on API reference documentation This PR does not include a more general overview or tutorial for rollups V2. I plan to cover those in later PRs. I also plan to open additional PR(s) to better label legacy rollup APIs.\nPreviews\n\nRollup APIs overview: https://elasticsearch_65398.docs-preview.app.elstc.co/guide/en/elasticsearch/reference/master/rollup-apis.html\nRollup API docs: https://elasticsearch_65398.docs-preview.app.elstc.co/guide/en/elasticsearch/reference/master/rollup-api.html", "createdAt": "2020-11-23T22:48:56Z", "url": "https://github.com/elastic/elasticsearch/pull/65398", "merged": true, "mergeCommit": {"oid": "a941c7147f878b40a8bb58526d985437d79adcb3"}, "closed": true, "closedAt": "2020-11-25T16:16:07Z", "author": {"login": "jrodewig"}, "timelineItems": {"totalCount": 16, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdfd5hlABqjQwMzAwOTU3OTc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdfyBVgAH2gAyNTI2MDQzNDQyOmM1YjRkNGMxZTBmMzUwM2UwM2Q2YWIzODlhZjIyZDRlMDc5ZmQ0MjU=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f82b93327d8a996bd69424b7c88231282309f1de", "author": {"user": {"login": "jrodewig", "name": "James Rodewig"}}, "url": "https://github.com/elastic/elasticsearch/commit/f82b93327d8a996bd69424b7c88231282309f1de", "committedDate": "2020-11-23T23:38:20Z", "message": "Use attribute"}, "afterCommit": {"oid": "8d433342ad7beb7b91787343a4bd953841a2fe3d", "author": {"user": {"login": "jrodewig", "name": "James Rodewig"}}, "url": "https://github.com/elastic/elasticsearch/commit/8d433342ad7beb7b91787343a4bd953841a2fe3d", "committedDate": "2020-11-23T23:38:49Z", "message": "[DOCS] Add rollup API docs\n\n* Documents new `<index>/_rollup` API\n* Updates rollup APIs overview page\n* Enables rollups V2 in docs integ tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d1e11d6c5113dffcd4f41b209b874a8734574b4e", "author": {"user": {"login": "jrodewig", "name": "James Rodewig"}}, "url": "https://github.com/elastic/elasticsearch/commit/d1e11d6c5113dffcd4f41b209b874a8734574b4e", "committedDate": "2020-11-24T13:23:55Z", "message": "[DOCS] Add rollup API docs\n\n* Documents new `<index>/_rollup` API\n* Updates rollup APIs overview page\n* Enables rollups V2 in docs integ tests"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "422544191e076e821809cad0a8d57c3e4093d17e", "author": {"user": {"login": "jrodewig", "name": "James Rodewig"}}, "url": "https://github.com/elastic/elasticsearch/commit/422544191e076e821809cad0a8d57c3e4093d17e", "committedDate": "2020-11-24T13:17:32Z", "message": "Fixes"}, "afterCommit": {"oid": "d1e11d6c5113dffcd4f41b209b874a8734574b4e", "author": {"user": {"login": "jrodewig", "name": "James Rodewig"}}, "url": "https://github.com/elastic/elasticsearch/commit/d1e11d6c5113dffcd4f41b209b874a8734574b4e", "committedDate": "2020-11-24T13:23:55Z", "message": "[DOCS] Add rollup API docs\n\n* Documents new `<index>/_rollup` API\n* Updates rollup APIs overview page\n* Enables rollups V2 in docs integ tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ff8bdbf109ea96ad8c435bce1de3e516f32787f2", "author": {"user": {"login": "jrodewig", "name": "James Rodewig"}}, "url": "https://github.com/elastic/elasticsearch/commit/ff8bdbf109ea96ad8c435bce1de3e516f32787f2", "committedDate": "2020-11-24T13:52:18Z", "message": "Undo run.gradle changes"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6952c4627d02906da22743c25a6a2cf1a6fcda23", "author": {"user": {"login": "jrodewig", "name": "James Rodewig"}}, "url": "https://github.com/elastic/elasticsearch/commit/6952c4627d02906da22743c25a6a2cf1a6fcda23", "committedDate": "2020-11-24T13:25:32Z", "message": "Undo run.gradle changes"}, "afterCommit": {"oid": "ff8bdbf109ea96ad8c435bce1de3e516f32787f2", "author": {"user": {"login": "jrodewig", "name": "James Rodewig"}}, "url": "https://github.com/elastic/elasticsearch/commit/ff8bdbf109ea96ad8c435bce1de3e516f32787f2", "committedDate": "2020-11-24T13:52:18Z", "message": "Undo run.gradle changes"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM3NTEzNDMy", "url": "https://github.com/elastic/elasticsearch/pull/65398#pullrequestreview-537513432", "createdAt": "2020-11-24T13:55:28Z", "commit": {"oid": "ff8bdbf109ea96ad8c435bce1de3e516f32787f2"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNFQxMzo1NToyOVrOH5B60g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNFQxMzo1NToyOVrOH5B60g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTU2MjMyMg==", "bodyText": "delay is also a valid param for date_histogram but seems to be inert. Let me know if I should document it here.", "url": "https://github.com/elastic/elasticsearch/pull/65398#discussion_r529562322", "createdAt": "2020-11-24T13:55:29Z", "author": {"login": "jrodewig"}, "path": "docs/reference/rollup/apis/rollup-api.asciidoc", "diffHunk": "@@ -0,0 +1,191 @@\n+[role=\"xpack\"]\n+[testenv=\"basic\"]\n+[[rollup-api]]\n+=== Rollup API\n+++++\n+<titleabbrev>Rollup</titleabbrev>\n+++++\n+\n+Aggregates an index's time-series data and stores the results in another index.\n+For example, you can roll up hourly data into daily or weekly summaries.\n+\n+[source,console]\n+----\n+POST /my-index-000001/_rollup\n+{\n+  \"rollup_index\": \"my-rollup-index\",\n+  \"groups\": {\n+    \"date_histogram\": {\n+      \"field\": \"@timestamp\",\n+      \"calendar_interval\": \"1d\"\n+    },\n+    \"terms\": {\n+      \"fields\": [\n+        \"my-keyword-field\",\n+        \"my-other-keyword-field\"\n+      ]\n+    }\n+  },\n+  \"metrics\": [\n+    {\n+      \"field\": \"my-numeric-field\",\n+      \"metrics\": [\n+        \"min\",\n+        \"max\",\n+        \"avg\"\n+      ]\n+    }\n+  ]\n+}\n+----\n+// TEST[setup:my_index]\n+\n+[[rollup-api-request]]\n+==== {api-request-title}\n+\n+`PUT /<index>/_rollup`\n+\n+[[rollup-api-prereqs]]\n+==== {api-prereq-title}\n+\n+If the {es} {security-features} are enabled, you must have the `manage` cluster\n+privilege to use this API. See <<security-privileges>>.\n+\n+[[rollup-api-path-params]]\n+==== {api-path-parms-title}\n+\n+`<index>`::\n+(Required, string)\n+Index to roll up. Does not support <<multi-index,multi-target syntax>> or\n+wildcards (`*`).\n++\n+You can't use this argument to directly target a <<data-streams,data stream>> or\n+<<indices-aliases,index alias>>. However, you can target their backing or\n+concrete indices.\n+\n+\n+[role=\"child_attributes\"]\n+[[rollup-api-request-body]]\n+==== {api-request-body-title}\n+\n+`rollup_index`::\n+(Required, index)\n+Index that stores the rollup results. Cannot be a <<data-streams,data stream>>\n+or <<indices-aliases,index alias>>.\n++\n+If this index does not exist, the request creates it. If the `<index>` is a\n+backing index for a data stream, this new index is a backing index of the same\n+stream.\n+\n+`groups`::\n+(Required, object)\n+Aggregates and stores fields in the rollup.\n++\n+.Properties of `groups`\n+[%collapsible%open]\n+====\n+`date_histogram`::\n+(Required,\n+<<search-aggregations-bucket-datehistogram-aggregation,`date_histogram`\n+aggregation>> object)\n+Groups documents in the original `<index>` based on a provided time interval.\n++\n+.Properties of `date_histogram`\n+[%collapsible%open]\n+=====\n+`field`::\n+(Required, string)\n+<<date,`date`>> or <<date_nanos,`date_nanos`>> field containing the `<index>`'s\n+timestamp. If you're rolling up a backing index or using the {ecs-ref}[Elastic\n+Common Schema (ECS)], we recommend using `@timestamp`.\n+\n+`calendar_interval` or `fixed_interval`::\n+(Required, <<time-units,time units>>)\n+Time interval used to group documents. For differences between\n+`calendar_interval` and `fixed_interval`, see <<calendar_and_fixed_intervals>>.\n++\n+TIP: Choose this value carefully. You won't be able to use a smaller interval\n+later. For example, you can't aggregate daily rollups into hourly\n+summaries. However, smaller time intervals can greatly increase the size of your\n+`rollup_index`.\n+\n+`time_zone`::\n+(Optional, string)\n+Time zone for the `field`. Valid values are ISO 8601 UTC offsets, such as\n+`+01:00` or `-08:00`, and IANA time zone IDs, such as `America/Los_Angeles`.\n+Defaults to `+00:00` (UTC).\n+=====", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ff8bdbf109ea96ad8c435bce1de3e516f32787f2"}, "originalPosition": 117}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM3NTEzNDk1", "url": "https://github.com/elastic/elasticsearch/pull/65398#pullrequestreview-537513495", "createdAt": "2020-11-24T13:55:32Z", "commit": {"oid": "ff8bdbf109ea96ad8c435bce1de3e516f32787f2"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNFQxMzo1NTozMlrOH5B7EQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNFQxMzo1NTozMlrOH5B7EQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTU2MjM4NQ==", "bodyText": "The manage_rollup privilege doesn't seem to have any effect on this API. Let me know if we plan to phase it out or only use it for legacy rollups. I'll update the privileges docs in another PR.", "url": "https://github.com/elastic/elasticsearch/pull/65398#discussion_r529562385", "createdAt": "2020-11-24T13:55:32Z", "author": {"login": "jrodewig"}, "path": "docs/reference/rollup/apis/rollup-api.asciidoc", "diffHunk": "@@ -0,0 +1,191 @@\n+[role=\"xpack\"]\n+[testenv=\"basic\"]\n+[[rollup-api]]\n+=== Rollup API\n+++++\n+<titleabbrev>Rollup</titleabbrev>\n+++++\n+\n+Aggregates an index's time-series data and stores the results in another index.\n+For example, you can roll up hourly data into daily or weekly summaries.\n+\n+[source,console]\n+----\n+POST /my-index-000001/_rollup\n+{\n+  \"rollup_index\": \"my-rollup-index\",\n+  \"groups\": {\n+    \"date_histogram\": {\n+      \"field\": \"@timestamp\",\n+      \"calendar_interval\": \"1d\"\n+    },\n+    \"terms\": {\n+      \"fields\": [\n+        \"my-keyword-field\",\n+        \"my-other-keyword-field\"\n+      ]\n+    }\n+  },\n+  \"metrics\": [\n+    {\n+      \"field\": \"my-numeric-field\",\n+      \"metrics\": [\n+        \"min\",\n+        \"max\",\n+        \"avg\"\n+      ]\n+    }\n+  ]\n+}\n+----\n+// TEST[setup:my_index]\n+\n+[[rollup-api-request]]\n+==== {api-request-title}\n+\n+`PUT /<index>/_rollup`\n+\n+[[rollup-api-prereqs]]\n+==== {api-prereq-title}\n+\n+If the {es} {security-features} are enabled, you must have the `manage` cluster\n+privilege to use this API. See <<security-privileges>>.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ff8bdbf109ea96ad8c435bce1de3e516f32787f2"}, "originalPosition": 52}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM3NTE5MDU5", "url": "https://github.com/elastic/elasticsearch/pull/65398#pullrequestreview-537519059", "createdAt": "2020-11-24T14:01:25Z", "commit": {"oid": "ff8bdbf109ea96ad8c435bce1de3e516f32787f2"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNFQxNDowMToyNVrOH5CLnQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNFQxNDowMToyNVrOH5CLnQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTU2NjYyMQ==", "bodyText": "Prior to {es} 7.x, you could only create a rollup using a periodic cron jobs.\n\nI'll update with the actual release version once we're closer to that.", "url": "https://github.com/elastic/elasticsearch/pull/65398#discussion_r529566621", "createdAt": "2020-11-24T14:01:25Z", "author": {"login": "jrodewig"}, "path": "docs/reference/rollup/rollup-apis.asciidoc", "diffHunk": "@@ -0,0 +1,88 @@\n+[role=\"xpack\"]\n+[testenv=\"basic\"]\n+[[rollup-apis]]\n+== Rollup APIs\n+\n+ifdef::permanently-unreleased-branch[]\n+\n+A rollup aggregates an index's time-series data and stores the results in\n+another index, called a rollup index. For example, you can aggregate hourly data\n+into daily or weekly summaries.\n+\n+* <<rollup-api,Rollup API>>\n+\n+[discrete]\n+[[legacy-rollup-apis]]\n+=== Legacy rollup APIs\n+\n+Prior to {es} 7.x, you could only create a rollup using a periodic cron jobs.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ff8bdbf109ea96ad8c435bce1de3e516f32787f2"}, "originalPosition": 18}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e81ff574cc802f45e13e9821ce07fbb70cbdbba4", "author": {"user": {"login": "jrodewig", "name": "James Rodewig"}}, "url": "https://github.com/elastic/elasticsearch/commit/e81ff574cc802f45e13e9821ce07fbb70cbdbba4", "committedDate": "2020-11-24T15:17:41Z", "message": "Consistent wording"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f8b4c24bda374ce8d7a7024f916d57cd931fb4f2", "author": {"user": {"login": "jrodewig", "name": "James Rodewig"}}, "url": "https://github.com/elastic/elasticsearch/commit/f8b4c24bda374ce8d7a7024f916d57cd931fb4f2", "committedDate": "2020-11-24T18:18:26Z", "message": "Reword"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8da43743bff262a6e4a8baf295374b9346115187", "author": {"user": {"login": "jrodewig", "name": "James Rodewig"}}, "url": "https://github.com/elastic/elasticsearch/commit/8da43743bff262a6e4a8baf295374b9346115187", "committedDate": "2020-11-24T18:19:07Z", "message": "Reword"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1c7360fad7866c3ca62f123bb541beca412234ee", "author": {"user": {"login": "jrodewig", "name": "James Rodewig"}}, "url": "https://github.com/elastic/elasticsearch/commit/1c7360fad7866c3ca62f123bb541beca412234ee", "committedDate": "2020-11-24T18:19:50Z", "message": "Fix whitespace"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM3OTg4Njk4", "url": "https://github.com/elastic/elasticsearch/pull/65398#pullrequestreview-537988698", "createdAt": "2020-11-24T21:45:35Z", "commit": {"oid": "1c7360fad7866c3ca62f123bb541beca412234ee"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNFQyMTo0NTozNVrOH5WZ3Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNFQyMTo0NTozNVrOH5WZ3Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTg5Nzk0OQ==", "bodyText": "now that I am seeing this, I may have to change how I've done this in my PRs.\nI feel it is safe to always set the system property in test clusters. I'll change all of them at a later point", "url": "https://github.com/elastic/elasticsearch/pull/65398#discussion_r529897949", "createdAt": "2020-11-24T21:45:35Z", "author": {"login": "talevy"}, "path": "docs/build.gradle", "diffHunk": "@@ -52,6 +52,9 @@ testClusters.integTest {\n   if (singleNode().testDistribution == DEFAULT) {\n     setting 'xpack.license.self_generated.type', 'trial'\n     setting 'indices.lifecycle.history_index_enabled', 'false'\n+    if (BuildParams.isSnapshotBuild() == true) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1c7360fad7866c3ca62f123bb541beca412234ee"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM3OTk0NDk1", "url": "https://github.com/elastic/elasticsearch/pull/65398#pullrequestreview-537994495", "createdAt": "2020-11-24T21:49:16Z", "commit": {"oid": "1c7360fad7866c3ca62f123bb541beca412234ee"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNFQyMTo0OToxNlrOH5Wicw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNFQyMTo0OToxNlrOH5Wicw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTkwMDE0Nw==", "bodyText": "drop the \"a\"?", "url": "https://github.com/elastic/elasticsearch/pull/65398#discussion_r529900147", "createdAt": "2020-11-24T21:49:16Z", "author": {"login": "talevy"}, "path": "docs/reference/rollup/rollup-apis.asciidoc", "diffHunk": "@@ -0,0 +1,88 @@\n+[role=\"xpack\"]\n+[testenv=\"basic\"]\n+[[rollup-apis]]\n+== Rollup APIs\n+\n+ifdef::permanently-unreleased-branch[]\n+\n+A rollup aggregates an index's time-series data and stores the results in\n+another index, called a rollup index. For example, you can roll up hourly data\n+into daily or weekly summaries.\n+\n+* <<rollup-api,Rollup API>>\n+\n+[discrete]\n+[[legacy-rollup-apis]]\n+=== Legacy rollup APIs\n+\n+Prior to {es} 7.x, you could only create a rollup using a periodic cron jobs.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1c7360fad7866c3ca62f123bb541beca412234ee"}, "originalPosition": 18}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a233013a70284be4271fa35ca4e1e577bf7fe96e", "author": {"user": {"login": "jrodewig", "name": "James Rodewig"}}, "url": "https://github.com/elastic/elasticsearch/commit/a233013a70284be4271fa35ca4e1e577bf7fe96e", "committedDate": "2020-11-24T21:52:18Z", "message": "Fix typo"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c5b4d4c1e0f3503e03d6ab389af22d4e079fd425", "author": {"user": {"login": "jrodewig", "name": "James Rodewig"}}, "url": "https://github.com/elastic/elasticsearch/commit/c5b4d4c1e0f3503e03d6ab389af22d4e079fd425", "committedDate": "2020-11-24T23:05:36Z", "message": "Fix typos"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4406, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}