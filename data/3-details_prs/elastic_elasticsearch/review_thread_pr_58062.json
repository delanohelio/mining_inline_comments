{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDMzNzc5MTk0", "number": 58062, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNVQxMzoyMDo1NlrOEFiHlQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xN1QxMjo0ODo1NlrOEZB_nA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc0MjM3MzMzOnYy", "diffSide": "RIGHT", "path": "x-pack/plugin/ql/src/main/java/org/elasticsearch/xpack/ql/expression/function/scalar/whitelist/InternalQlScriptUtils.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNVQxMzoyMDo1NlrOGjx2yQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNVQxMzoyMDo1NlrOGjx2yQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDE3MDE4NQ==", "bodyText": "The issues seems fixed, can you remove the workaround?", "url": "https://github.com/elastic/elasticsearch/pull/58062#discussion_r440170185", "createdAt": "2020-06-15T13:20:56Z", "author": {"login": "matriv"}, "path": "x-pack/plugin/ql/src/main/java/org/elasticsearch/xpack/ql/expression/function/scalar/whitelist/InternalQlScriptUtils.java", "diffHunk": "@@ -32,7 +33,9 @@\n         if (doc.containsKey(fieldName)) {\n             ScriptDocValues<T> docValues = doc.get(fieldName);\n             if (!docValues.isEmpty()) {\n-                return docValues.get(0);\n+                T value = docValues.get(0);\n+                // FIXME temporary workaround until https://github.com/elastic/elasticsearch/issues/58044 gets fixed", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "07451948c91c88eccd1caefd422dfe0c565df805"}, "originalPosition": 14}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc0MjM5Mzk1OnYy", "diffSide": "RIGHT", "path": "x-pack/plugin/sql/qa/server/src/main/resources/wildcard.csv-spec", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNVQxMzoyNjoxMlrOGjyDlA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNVQxMzoyNjoxMlrOGjyDlA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDE3MzQ2MA==", "bodyText": "Wouldn't groupBy be more appropriate?", "url": "https://github.com/elastic/elasticsearch/pull/58062#discussion_r440173460", "createdAt": "2020-06-15T13:26:12Z", "author": {"login": "matriv"}, "path": "x-pack/plugin/sql/qa/server/src/main/resources/wildcard.csv-spec", "diffHunk": "@@ -0,0 +1,236 @@\n+// To mute tests follow example in file: example.csv-spec\n+\n+//\n+// Tests testing wildcard field type (introduced in ES 7.9?)\n+//\n+\n+// filtering\n+\n+filterEquals\n+SELECT last_name, first_name, wildcard_name FROM test_emp_copy WHERE wildcard_name = 'Saniya Kalloufi';\n+\n+   last_name:s |  first_name:s |wildcard_name:s \n+---------------+---------------+---------------\n+Kalloufi       |Saniya         |Saniya Kalloufi\n+;\n+\n+filterNotEquals\n+SELECT COUNT(*) AS c FROM \"test_emp_copy\" WHERE wildcard_name <> 'Saniya Kalloufi';\n+\n+    c:l     \n+---------------\n+99\n+;\n+\n+aggWithNullFilter\n+SELECT COUNT(*) count FROM test_emp_copy WHERE wildcard_name IS NOT NULL;\n+\n+     count:l     \n+---------------\n+90\n+;\n+\n+aggWithNullFilter\n+SELECT COUNT(*) count FROM test_emp_copy WHERE wildcard_name IS NULL;\n+\n+     count:l     \n+---------------\n+10\n+;\n+\n+functionOverAlias\n+SELECT BIT_LENGTH(wildcard_name) bit, wildcard_name, length(wildcard_name) l FROM test_emp_copy ORDER BY bit DESC LIMIT 10;\n+\n+      bit      |    wildcard_name     |       l       \n+---------------+----------------------+---------------\n+176            |Sudharsan Flasterstein|22             \n+168            |Arumugam Ossenbruggen |21             \n+168            |Sreekrishna Servieres |21             \n+160            |Kazuhito Cappelletti  |20             \n+160            |Breannda Billingsley  |20             \n+152            |Cristinel Bouloucos   |19             \n+144            |Duangkaew Piveteau    |18             \n+144            |Patricio Bridgland    |18             \n+144            |Guoxiang Nooteboom    |18             \n+144            |Alejandro McAlpine    |18             \n+;\n+\n+\n+singlePercentile", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "07451948c91c88eccd1caefd422dfe0c565df805"}, "originalPosition": 59}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc0MjM5NTI1OnYy", "diffSide": "RIGHT", "path": "x-pack/plugin/sql/qa/server/src/main/resources/wildcard.csv-spec", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNVQxMzoyNjozMVrOGjyEYA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNVQxMzoyNjozMVrOGjyEYA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDE3MzY2NA==", "bodyText": "and here complexGroupBy ?", "url": "https://github.com/elastic/elasticsearch/pull/58062#discussion_r440173664", "createdAt": "2020-06-15T13:26:31Z", "author": {"login": "matriv"}, "path": "x-pack/plugin/sql/qa/server/src/main/resources/wildcard.csv-spec", "diffHunk": "@@ -0,0 +1,236 @@\n+// To mute tests follow example in file: example.csv-spec\n+\n+//\n+// Tests testing wildcard field type (introduced in ES 7.9?)\n+//\n+\n+// filtering\n+\n+filterEquals\n+SELECT last_name, first_name, wildcard_name FROM test_emp_copy WHERE wildcard_name = 'Saniya Kalloufi';\n+\n+   last_name:s |  first_name:s |wildcard_name:s \n+---------------+---------------+---------------\n+Kalloufi       |Saniya         |Saniya Kalloufi\n+;\n+\n+filterNotEquals\n+SELECT COUNT(*) AS c FROM \"test_emp_copy\" WHERE wildcard_name <> 'Saniya Kalloufi';\n+\n+    c:l     \n+---------------\n+99\n+;\n+\n+aggWithNullFilter\n+SELECT COUNT(*) count FROM test_emp_copy WHERE wildcard_name IS NOT NULL;\n+\n+     count:l     \n+---------------\n+90\n+;\n+\n+aggWithNullFilter\n+SELECT COUNT(*) count FROM test_emp_copy WHERE wildcard_name IS NULL;\n+\n+     count:l     \n+---------------\n+10\n+;\n+\n+functionOverAlias\n+SELECT BIT_LENGTH(wildcard_name) bit, wildcard_name, length(wildcard_name) l FROM test_emp_copy ORDER BY bit DESC LIMIT 10;\n+\n+      bit      |    wildcard_name     |       l       \n+---------------+----------------------+---------------\n+176            |Sudharsan Flasterstein|22             \n+168            |Arumugam Ossenbruggen |21             \n+168            |Sreekrishna Servieres |21             \n+160            |Kazuhito Cappelletti  |20             \n+160            |Breannda Billingsley  |20             \n+152            |Cristinel Bouloucos   |19             \n+144            |Duangkaew Piveteau    |18             \n+144            |Patricio Bridgland    |18             \n+144            |Guoxiang Nooteboom    |18             \n+144            |Alejandro McAlpine    |18             \n+;\n+\n+\n+singlePercentile\n+SELECT wildcard_name AS w, PERCENTILE(emp_no, 97) p1 FROM test_emp_copy GROUP BY wildcard_name LIMIT 10;\n+\n+          w:s        |      p1:d       \n+---------------------+---------------\n+null                 |10039.0        \n+Alejandro McAlpine   |10059.0        \n+Amabile Gomatam      |10091.0        \n+Anneke Preusig       |10006.0        \n+Anoosh Peyn          |10062.0        \n+Arumugam Ossenbruggen|10094.0        \n+Basil Tramer         |10049.0        \n+Berhard McFarlin     |10058.0        \n+Berni Genin          |10014.0        \n+Bezalel Simmel       |10002.0        \n+;\n+\n+complexPercentile", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "07451948c91c88eccd1caefd422dfe0c565df805"}, "originalPosition": 76}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk0NjgyNTI0OnYy", "diffSide": "RIGHT", "path": "x-pack/plugin/ql/src/main/java/org/elasticsearch/xpack/ql/type/Types.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xN1QxMjo0ODo1NlrOHBnUug==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xN1QxMjo1NDoxNlrOHBngbw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTQ1NDkwNg==", "bodyText": "Why is this needed? Aren't wildcard returned as keywords? Or is this using a different API/source?", "url": "https://github.com/elastic/elasticsearch/pull/58062#discussion_r471454906", "createdAt": "2020-08-17T12:48:56Z", "author": {"login": "costin"}, "path": "x-pack/plugin/ql/src/main/java/org/elasticsearch/xpack/ql/type/Types.java", "diffHunk": "@@ -48,8 +48,12 @@\n \n     private static DataType getType(DataTypeRegistry typeRegistry, Map<String, Object> content) {\n         if (content.containsKey(\"type\")) {\n+            String typeName = content.get(\"type\").toString();\n+            if (\"wildcard\".equals(typeName)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5a5786c33345dabc21a95dc437a40147edc62845"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTQ1NzkwMw==", "bodyText": "That's for testing. We use .json files having an index' complete mapping (see org.elasticsearch.xpack.ql.type.TypesTests) and the wildcard comparison is for bypassing SQL's and EQL's specific data types auto-resolver in the specific case of wildcard.", "url": "https://github.com/elastic/elasticsearch/pull/58062#discussion_r471457903", "createdAt": "2020-08-17T12:54:16Z", "author": {"login": "astefan"}, "path": "x-pack/plugin/ql/src/main/java/org/elasticsearch/xpack/ql/type/Types.java", "diffHunk": "@@ -48,8 +48,12 @@\n \n     private static DataType getType(DataTypeRegistry typeRegistry, Map<String, Object> content) {\n         if (content.containsKey(\"type\")) {\n+            String typeName = content.get(\"type\").toString();\n+            if (\"wildcard\".equals(typeName)) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTQ1NDkwNg=="}, "originalCommit": {"oid": "5a5786c33345dabc21a95dc437a40147edc62845"}, "originalPosition": 5}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1594, "cost": 1, "resetAt": "2021-11-12T11:57:46Z"}}}