{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzgwODM2MzEy", "number": 52888, "title": "Fix roles parsing in client nodes sniffer", "bodyText": "We mades roles pluggable, but never updated the client to account for this. This means that when speaking to a modern cluster, application logs are spammed with warning messages around unrecognized roles. This commit addresses this by accounting for the fact that roles can extend beyond master/data/ingest now.\nCloses #52864", "createdAt": "2020-02-27T12:58:43Z", "url": "https://github.com/elastic/elasticsearch/pull/52888", "merged": true, "mergeCommit": {"oid": "89b0aad7bd875f50f91aca286f47912baf604856"}, "closed": true, "closedAt": "2020-02-27T20:25:54Z", "author": {"login": "jasontedor"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcIa4dygH2gAyMzgwODM2MzEyOjBiOWYyNTgzZjQ0NDMyZTkwZGFiZTNiMzczNDFjZjcxOTM2NTUxOTQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcIeu6QAFqTM2NTg1MDA5NA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "0b9f2583f44432e90dabe3b37341cf7193655194", "author": {"user": {"login": "jasontedor", "name": "Jason Tedor"}}, "url": "https://github.com/elastic/elasticsearch/commit/0b9f2583f44432e90dabe3b37341cf7193655194", "committedDate": "2020-02-27T12:56:41Z", "message": "Fix roles parsing in client nodes sniffer\n\nWe mades roles pluggable, but never updated the client to account for\nthis. This means that when speaking to a modern cluster, application\nlogs are spammed with warning messages around unrecognized roles. This\ncommit addresses this by accounting for the fact that roles can extend\nbeyond master/data/ingest now."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e3a76b315ddfa9022a4a0ec8da72e87bf73bc0a5", "author": {"user": {"login": "elasticmachine", "name": "Elastic Machine"}}, "url": "https://github.com/elastic/elasticsearch/commit/e3a76b315ddfa9022a4a0ec8da72e87bf73bc0a5", "committedDate": "2020-02-27T14:00:16Z", "message": "Merge branch 'master' into fix-roles-parsing-in-llrc"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b97eca169cd24ebf7c325ca722a6d9bdbde58fa2", "author": {"user": {"login": "jasontedor", "name": "Jason Tedor"}}, "url": "https://github.com/elastic/elasticsearch/commit/b97eca169cd24ebf7c325ca722a6d9bdbde58fa2", "committedDate": "2020-02-27T15:41:44Z", "message": "Fix compilation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "124ac22745f9c254066d0eb60126aa7233e8af8c", "author": {"user": {"login": "jasontedor", "name": "Jason Tedor"}}, "url": "https://github.com/elastic/elasticsearch/commit/124ac22745f9c254066d0eb60126aa7233e8af8c", "committedDate": "2020-02-27T15:57:33Z", "message": "Fix tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "44ed4100480e331391690ad2b3beee50668384a9", "author": {"user": {"login": "jasontedor", "name": "Jason Tedor"}}, "url": "https://github.com/elastic/elasticsearch/commit/44ed4100480e331391690ad2b3beee50668384a9", "committedDate": "2020-02-27T16:02:09Z", "message": "Fix compilation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "01ce6c6d0091f0a8a5b3f06a1363571eafad0653", "author": {"user": {"login": "jasontedor", "name": "Jason Tedor"}}, "url": "https://github.com/elastic/elasticsearch/commit/01ce6c6d0091f0a8a5b3f06a1363571eafad0653", "committedDate": "2020-02-27T16:08:12Z", "message": "Fix test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1700773fc153f4826563e3bfbefb639f185c137b", "author": {"user": {"login": "jasontedor", "name": "Jason Tedor"}}, "url": "https://github.com/elastic/elasticsearch/commit/1700773fc153f4826563e3bfbefb639f185c137b", "committedDate": "2020-02-27T16:18:39Z", "message": "Fix line length"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY1ODUwMDk0", "url": "https://github.com/elastic/elasticsearch/pull/52888#pullrequestreview-365850094", "createdAt": "2020-02-27T17:22:39Z", "commit": {"oid": "1700773fc153f4826563e3bfbefb639f185c137b"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yN1QxNzoyMjozOVrOFvaJ-w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yN1QxNzoyMjozOVrOFvaJ-w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTI1NTkzMQ==", "bodyText": "Out of curiosity, should we make these constants since they're hardcoded as strings all over the place? (in separate work, not this PR)", "url": "https://github.com/elastic/elasticsearch/pull/52888#discussion_r385255931", "createdAt": "2020-02-27T17:22:39Z", "author": {"login": "dakrone"}, "path": "client/rest/src/main/java/org/elasticsearch/client/Node.java", "diffHunk": "@@ -175,42 +176,35 @@ public int hashCode() {\n      * Role information about an Elasticsearch process.\n      */\n     public static final class Roles {\n-        private final boolean masterEligible;\n-        private final boolean data;\n-        private final boolean ingest;\n-\n-        public Roles(boolean masterEligible, boolean data, boolean ingest) {\n-            this.masterEligible = masterEligible;\n-            this.data = data;\n-            this.ingest = ingest;\n+\n+        private final Set<String> roles;\n+\n+        public Roles(final Set<String> roles) {\n+            this.roles = new TreeSet<>(roles);\n         }\n \n         /**\n          * Teturns whether or not the node <strong>could</strong> be elected master.\n          */\n         public boolean isMasterEligible() {\n-            return masterEligible;\n+            return roles.contains(\"master\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1700773fc153f4826563e3bfbefb639f185c137b"}, "originalPosition": 40}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2035, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}