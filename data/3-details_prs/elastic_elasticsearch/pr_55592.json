{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA3MzA2NjMy", "number": 55592, "title": "Make xpack.ilm.enabled setting a no-op", "bodyText": "In #54816, we deprecated a group of toggle settings for basic license level features. In #55416 (in review), we are turning most of those settings into no-ops, i.e., having them in your settings file won't throw an error, but they won't do anything at all. I left monitoring and ILM for separate PRs because turning them into no-ops affects logic in other modules.\nThis PR turns xpack.ilm.enabled into a no-op. It removes logic and tests in xpack core, ML, and Watcher. The latter two modules in particular had to switch behavior based on the enablement or disablement of ILM, which is the kind of thing we're trying to eliminate with this effort; ILM should be a basic \"building block\" for higher level modules.\nMeta issue: #54745\n\n documentation", "createdAt": "2020-04-22T13:54:03Z", "url": "https://github.com/elastic/elasticsearch/pull/55592", "merged": true, "mergeCommit": {"oid": "c4b11e46a02d3f5fc5db2ae16d62324abed4f3b2"}, "closed": true, "closedAt": "2020-04-29T19:44:45Z", "author": {"login": "williamrandolph"}, "timelineItems": {"totalCount": 17, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcaIceDgH2gAyNDA3MzA2NjMyOjQ4MDA5YWYwMzNkYmJkYmFjMjU3ZTg3N2UwNjY2NzMwMzAzZTdjZWU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABccEkh-gH2gAyNDA3MzA2NjMyOmQ1Y2NlNTZhMmVhOGQ2ZmNlM2FmNjZlOGRjMDRiMTljZmZlYmRhMmE=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "48009af033dbbdbac257e877e0666730303e7cee", "author": {"user": {"login": "williamrandolph", "name": "William Brafford"}}, "url": "https://github.com/elastic/elasticsearch/commit/48009af033dbbdbac257e877e0666730303e7cee", "committedDate": "2020-04-22T13:38:27Z", "message": "Make xpack.ilm.enabled setting a no-op"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "de89eac2ccccff9f6c1b607222ef7354c157b3d7", "author": {"user": {"login": "williamrandolph", "name": "William Brafford"}}, "url": "https://github.com/elastic/elasticsearch/commit/de89eac2ccccff9f6c1b607222ef7354c157b3d7", "committedDate": "2020-04-22T13:39:35Z", "message": "Merge branch 'master' into disabled-ilm-is-no-op"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "715bdbb7f62218cce66c8ded68645c506fdb5386", "author": {"user": {"login": "williamrandolph", "name": "William Brafford"}}, "url": "https://github.com/elastic/elasticsearch/commit/715bdbb7f62218cce66c8ded68645c506fdb5386", "committedDate": "2020-04-22T18:59:24Z", "message": "Merge branch 'master' into disabled-ilm-is-no-op"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ad7186f1df3167f78e39054d5f9c6538c7dd328f", "author": {"user": {"login": "williamrandolph", "name": "William Brafford"}}, "url": "https://github.com/elastic/elasticsearch/commit/ad7186f1df3167f78e39054d5f9c6538c7dd328f", "committedDate": "2020-04-23T18:47:02Z", "message": "Add watcher setting to not use ILM"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk5NDE0MTI5", "url": "https://github.com/elastic/elasticsearch/pull/55592#pullrequestreview-399414129", "createdAt": "2020-04-23T19:34:23Z", "commit": {"oid": "ad7186f1df3167f78e39054d5f9c6538c7dd328f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yM1QxOTozNDoyM1rOGK4wrQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yM1QxOTozNDoyM1rOGK4wrQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDA2ODkwOQ==", "bodyText": "Can you explain this change, just so I can better understand?", "url": "https://github.com/elastic/elasticsearch/pull/55592#discussion_r414068909", "createdAt": "2020-04-23T19:34:23Z", "author": {"login": "pugnascotia"}, "path": "x-pack/plugin/ilm/src/test/java/org/elasticsearch/xpack/slm/SnapshotLifecycleInitialisationTests.java", "diffHunk": "@@ -44,7 +45,7 @@ public static void setupRepositoryPath() {\n     @Override\n     protected Settings nodeSettings() {\n         Settings.Builder settings = Settings.builder().put(super.nodeSettings());\n-        settings.put(XPackSettings.INDEX_LIFECYCLE_ENABLED.getKey(), false);\n+        settings.put(LifecycleSettings.LIFECYCLE_HISTORY_INDEX_ENABLED_SETTING.getKey(), false);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ad7186f1df3167f78e39054d5f9c6538c7dd328f"}, "originalPosition": 13}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk5NDE0NzY0", "url": "https://github.com/elastic/elasticsearch/pull/55592#pullrequestreview-399414764", "createdAt": "2020-04-23T19:35:19Z", "commit": {"oid": "ad7186f1df3167f78e39054d5f9c6538c7dd328f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yM1QxOTozNToxOVrOGK4ytQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yM1QxOTozNToxOVrOGK4ytQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDA2OTQyOQ==", "bodyText": "Can we remove ANOMALY_DETECTION_STATE_TEMPLATE_NO_ILM and STATS_TEMPLATE_NO_ILM now?", "url": "https://github.com/elastic/elasticsearch/pull/55592#discussion_r414069429", "createdAt": "2020-04-23T19:35:19Z", "author": {"login": "pugnascotia"}, "path": "x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/MlIndexTemplateRegistry.java", "diffHunk": "@@ -125,15 +124,14 @@ private static IndexTemplateConfig statsTemplate(boolean ilmEnabled) {\n     public MlIndexTemplateRegistry(Settings nodeSettings, ClusterService clusterService, ThreadPool threadPool, Client client,\n                                    NamedXContentRegistry xContentRegistry) {\n         super(nodeSettings, clusterService, threadPool, client, xContentRegistry);\n-        boolean ilmEnabled = XPackSettings.INDEX_LIFECYCLE_ENABLED.get(settings);\n         templatesToUse = Arrays.asList(\n             ANOMALY_DETECTION_RESULTS_TEMPLATE,\n-            ilmEnabled ? ANOMALY_DETECTION_STATE_TEMPLATE : ANOMALY_DETECTION_STATE_TEMPLATE_NO_ILM,\n+            ANOMALY_DETECTION_STATE_TEMPLATE,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ad7186f1df3167f78e39054d5f9c6538c7dd328f"}, "originalPosition": 16}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "beb6555453e1d0505dc6fec0f577ed257a79867e", "author": {"user": {"login": "williamrandolph", "name": "William Brafford"}}, "url": "https://github.com/elastic/elasticsearch/commit/beb6555453e1d0505dc6fec0f577ed257a79867e", "committedDate": "2020-04-23T21:27:12Z", "message": "Update documentation for no-op setting"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "88b4044c6d0be9751cef35c1864fb2a8f5dbbb8c", "author": {"user": {"login": "williamrandolph", "name": "William Brafford"}}, "url": "https://github.com/elastic/elasticsearch/commit/88b4044c6d0be9751cef35c1864fb2a8f5dbbb8c", "committedDate": "2020-04-24T15:11:16Z", "message": "Remove NO_ILM ml index templates"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "14f086e1d483ca51403a75abd742a0d933dc5632", "author": {"user": {"login": "williamrandolph", "name": "William Brafford"}}, "url": "https://github.com/elastic/elasticsearch/commit/14f086e1d483ca51403a75abd742a0d933dc5632", "committedDate": "2020-04-24T15:11:31Z", "message": "Remove unneeded setting from test setup"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAwMDY0NjU2", "url": "https://github.com/elastic/elasticsearch/pull/55592#pullrequestreview-400064656", "createdAt": "2020-04-24T15:46:50Z", "commit": {"oid": "14f086e1d483ca51403a75abd742a0d933dc5632"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "438725cd0d288121c5bbfbf382f05ea853c3d5f0", "author": {"user": {"login": "williamrandolph", "name": "William Brafford"}}, "url": "https://github.com/elastic/elasticsearch/commit/438725cd0d288121c5bbfbf382f05ea853c3d5f0", "committedDate": "2020-04-24T17:28:05Z", "message": "Inline variable definitions for ML templates"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e5f384ac1f55fcb2bc73353728a4090070806bd8", "author": {"user": {"login": "williamrandolph", "name": "William Brafford"}}, "url": "https://github.com/elastic/elasticsearch/commit/e5f384ac1f55fcb2bc73353728a4090070806bd8", "committedDate": "2020-04-26T01:26:40Z", "message": "Use identical parameter names in templates"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAwNjQ5OTUz", "url": "https://github.com/elastic/elasticsearch/pull/55592#pullrequestreview-400649953", "createdAt": "2020-04-27T06:10:30Z", "commit": {"oid": "e5f384ac1f55fcb2bc73353728a4090070806bd8"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yN1QwNjoxMDozMFrOGMSULg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yN1QwNjoxMDozMFrOGMSULg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTUzNjE3NA==", "bodyText": "Thank you!", "url": "https://github.com/elastic/elasticsearch/pull/55592#discussion_r415536174", "createdAt": "2020-04-27T06:10:30Z", "author": {"login": "przemekwitek"}, "path": "x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/MlIndexTemplateRegistry.java", "diffHunk": "@@ -125,15 +124,14 @@ private static IndexTemplateConfig statsTemplate(boolean ilmEnabled) {\n     public MlIndexTemplateRegistry(Settings nodeSettings, ClusterService clusterService, ThreadPool threadPool, Client client,\n                                    NamedXContentRegistry xContentRegistry) {\n         super(nodeSettings, clusterService, threadPool, client, xContentRegistry);\n-        boolean ilmEnabled = XPackSettings.INDEX_LIFECYCLE_ENABLED.get(settings);\n         templatesToUse = Arrays.asList(\n             ANOMALY_DETECTION_RESULTS_TEMPLATE,\n-            ilmEnabled ? ANOMALY_DETECTION_STATE_TEMPLATE : ANOMALY_DETECTION_STATE_TEMPLATE_NO_ILM,\n+            ANOMALY_DETECTION_STATE_TEMPLATE,", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDA2OTQyOQ=="}, "originalCommit": {"oid": "ad7186f1df3167f78e39054d5f9c6538c7dd328f"}, "originalPosition": 16}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "91eabaa09e355616de0193e842b19d19bb5b68ab", "author": {"user": {"login": "williamrandolph", "name": "William Brafford"}}, "url": "https://github.com/elastic/elasticsearch/commit/91eabaa09e355616de0193e842b19d19bb5b68ab", "committedDate": "2020-04-27T21:21:56Z", "message": "New ILM/watcher setting falls back to old setting"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAxNDE5MDk5", "url": "https://github.com/elastic/elasticsearch/pull/55592#pullrequestreview-401419099", "createdAt": "2020-04-28T00:31:13Z", "commit": {"oid": "91eabaa09e355616de0193e842b19d19bb5b68ab"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "061da3b04447c778eda43feafd9ef04e80a095b7", "author": {"user": {"login": "williamrandolph", "name": "William Brafford"}}, "url": "https://github.com/elastic/elasticsearch/commit/061da3b04447c778eda43feafd9ef04e80a095b7", "committedDate": "2020-04-28T13:35:28Z", "message": "Merge branch 'master' into disabled-ilm-is-no-op"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d5cce56a2ea8d6fce3af66e8dc04b19cffebda2a", "author": {"user": {"login": "williamrandolph", "name": "William Brafford"}}, "url": "https://github.com/elastic/elasticsearch/commit/d5cce56a2ea8d6fce3af66e8dc04b19cffebda2a", "committedDate": "2020-04-28T14:15:29Z", "message": "Add fallback unit test for watcher/ilm setting"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 673, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}