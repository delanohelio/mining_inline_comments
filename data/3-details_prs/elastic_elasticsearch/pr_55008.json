{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDAxMzkyMDA0", "number": 55008, "title": "Fix non-deterministic behaviour in ModelLoadingServiceTests", "bodyText": "ModelLoadingServiceTests::testMaxCachedLimitReached is testing models get evicted from the cache when the total size of all the models is too large for the cache. There is some non-deterministic behaviour when the models are first loaded as it it known what order they are loaded in and therefore which will be evicted by a later load. This change adjusts the assertions to account for that uncertainty.\nI believe the non-deterministic behaviour comes from a loss of ordering going from a list of IDs to a set. Model loading is mocked so there shouldn't be a race there.\nCloses #54986", "createdAt": "2020-04-09T12:21:06Z", "url": "https://github.com/elastic/elasticsearch/pull/55008", "merged": true, "mergeCommit": {"oid": "6863751c580eb4169eebe5c393a989b968619116"}, "closed": true, "closedAt": "2020-04-15T08:23:24Z", "author": {"login": "davidkyle"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcV7lmzAFqTM5MDc0MzUzMw==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcXfgTigH2gAyNDAxMzkyMDA0OjMyN2YwZDQwZDQ5ODBjODQ0NzMxZjcyYTBhYWJlYzRhZGZhODQ2OGI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkwNzQzNTMz", "url": "https://github.com/elastic/elasticsearch/pull/55008#pullrequestreview-390743533", "createdAt": "2020-04-09T12:23:57Z", "commit": {"oid": "47e800c54f29023601cf5825accaf36ad9b79fcd"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOVQxMjoyMzo1N1rOGDWZ1Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOVQxMjoyMzo1N1rOGDWZ1Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjE2NTk3Mw==", "bodyText": "A model being evicted from the cache is a routine event and not a warning level event. I would prefer this to be debug as it really is a non-issue (the model will be reloaded if required) but there is very little insight into the internals of the cache (which models are loaded etc). Once we have a model management system this should be debug or trace.\nI'm raising here for discussion before I forget but I'd be happy to revert the change for this PR", "url": "https://github.com/elastic/elasticsearch/pull/55008#discussion_r406165973", "createdAt": "2020-04-09T12:23:57Z", "author": {"login": "davidkyle"}, "path": "x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/inference/loadingservice/ModelLoadingService.java", "diffHunk": "@@ -353,9 +353,9 @@ private void auditIfNecessary(String modelId, MessageSupplier msg) {\n             logger.trace(() -> new ParameterizedMessage(\"[{}] {}\", modelId, msg.get().getFormattedMessage()));\n             return;\n         }\n-        auditor.warning(modelId, msg.get().getFormattedMessage());\n+        auditor.info(modelId, msg.get().getFormattedMessage());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "47e800c54f29023601cf5825accaf36ad9b79fcd"}, "originalPosition": 14}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkxMDIxODMy", "url": "https://github.com/elastic/elasticsearch/pull/55008#pullrequestreview-391021832", "createdAt": "2020-04-09T18:13:17Z", "commit": {"oid": "47e800c54f29023601cf5825accaf36ad9b79fcd"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "42baf3faec0c378acfd9d3f75ea9e9eb79728034", "author": {"user": {"login": "davidkyle", "name": "David Kyle"}}, "url": "https://github.com/elastic/elasticsearch/commit/42baf3faec0c378acfd9d3f75ea9e9eb79728034", "committedDate": "2020-04-14T08:21:45Z", "message": "Fix non-deterministic behaviour in ModelLoadingServiceTests"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "47e800c54f29023601cf5825accaf36ad9b79fcd", "author": {"user": {"login": "davidkyle", "name": "David Kyle"}}, "url": "https://github.com/elastic/elasticsearch/commit/47e800c54f29023601cf5825accaf36ad9b79fcd", "committedDate": "2020-04-09T12:12:45Z", "message": "Fix non-deterministic behaviour in ModelLoadingServiceTests"}, "afterCommit": {"oid": "42baf3faec0c378acfd9d3f75ea9e9eb79728034", "author": {"user": {"login": "davidkyle", "name": "David Kyle"}}, "url": "https://github.com/elastic/elasticsearch/commit/42baf3faec0c378acfd9d3f75ea9e9eb79728034", "committedDate": "2020-04-14T08:21:45Z", "message": "Fix non-deterministic behaviour in ModelLoadingServiceTests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "327f0d40d4980c844731f72a0aabec4adfa8468b", "author": {"user": {"login": "davidkyle", "name": "David Kyle"}}, "url": "https://github.com/elastic/elasticsearch/commit/327f0d40d4980c844731f72a0aabec4adfa8468b", "committedDate": "2020-04-14T08:48:41Z", "message": "Fix compilation after conflict"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3641, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}