{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzgwNTg5Njg1", "number": 52861, "title": "add explicit tests for geo_shape with doc values on old indices", "bodyText": "This PR adds tests to verify behavior of geo-aggregations on indices that have\ndoc-values disabled by default due to an old index version.\nthe version bounds to 7.x can be updated after merge of geoshape-doc-values into master", "createdAt": "2020-02-27T01:26:59Z", "url": "https://github.com/elastic/elasticsearch/pull/52861", "merged": true, "mergeCommit": {"oid": "b773b46a613fc1850c1c07977875add30f81c60d"}, "closed": true, "closedAt": "2020-03-05T16:01:18Z", "author": {"login": "talevy"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcIQ_FqAH2gAyMzgwNTg5Njg1OjQwNjFjZjFiNDc1MWM4OWVkMWRkMGYwZmFhNjYzMDU3ZTk2NGNjMjc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcJqIaSAFqTM2NzA0Mzk5NA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "4061cf1b4751c89ed1dd0f0faa663057e964cc27", "author": {"user": {"login": "talevy", "name": "Tal Levy"}}, "url": "https://github.com/elastic/elasticsearch/commit/4061cf1b4751c89ed1dd0f0faa663057e964cc27", "committedDate": "2020-02-27T01:24:52Z", "message": "add explicit tests for geo_shape with doc values on old indices"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "21d2431d450667063089c45ed0057cd45d32b64a", "author": {"user": {"login": "talevy", "name": "Tal Levy"}}, "url": "https://github.com/elastic/elasticsearch/commit/21d2431d450667063089c45ed0057cd45d32b64a", "committedDate": "2020-02-27T18:36:33Z", "message": "fix test"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY2MjgzODc1", "url": "https://github.com/elastic/elasticsearch/pull/52861#pullrequestreview-366283875", "createdAt": "2020-02-28T10:06:02Z", "commit": {"oid": "21d2431d450667063089c45ed0057cd45d32b64a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yOFQxMDowNjowMlrOFvvp0A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yOFQxMDowNjowMlrOFvvp0A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTYwODE0NA==", "bodyText": "Not sure if am reading this correctly. If you mix index with different versions then we do not fail? Is this the expected behavior?", "url": "https://github.com/elastic/elasticsearch/pull/52861#discussion_r385608144", "createdAt": "2020-02-28T10:06:02Z", "author": {"login": "iverase"}, "path": "server/src/test/java/org/elasticsearch/search/aggregations/metrics/GeoCentroidIT.java", "diffHunk": "@@ -45,6 +48,31 @@\n public class GeoCentroidIT extends AbstractGeoTestCase {\n     private static final String aggName = \"geoCentroid\";\n \n+    public void test7xIndexOnly() {\n+        SearchPhaseExecutionException exception = expectThrows(SearchPhaseExecutionException.class,\n+            () -> client().prepareSearch(IDX_NAME_7x) .addAggregation(geoCentroid(aggName).field(SINGLE_VALUED_GEOSHAPE_FIELD_NAME))\n+            .get());\n+        assertNotNull(exception.getRootCause());\n+        assertThat(exception.getRootCause().getMessage(),\n+            equalTo(\"Can't load fielddata on [geoshape_value] because fielddata is unsupported on fields of type [geo_shape].\" +\n+                \" Use doc values instead.\"));\n+    }\n+\n+    public void test7xIndexWith8Index() {\n+        SearchResponse response = client().prepareSearch(IDX_NAME_7x, IDX_NAME)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "21d2431d450667063089c45ed0057cd45d32b64a"}, "originalPosition": 34}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY3MDQzOTk0", "url": "https://github.com/elastic/elasticsearch/pull/52861#pullrequestreview-367043994", "createdAt": "2020-03-02T09:16:36Z", "commit": {"oid": "21d2431d450667063089c45ed0057cd45d32b64a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1993, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}