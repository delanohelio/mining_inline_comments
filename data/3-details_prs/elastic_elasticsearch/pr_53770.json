{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzkwNjgyNjA5", "number": 53770, "title": "[Transform][Rollup] add processing stats to record the time spent for processing results", "bodyText": "add 2 additional stats: processing time and processing total which capture the time spent for processing results and how often it ran. The 2 new stats correspond to the existing indexing and search stats. Together with indexing and search this now allows the user to see the full picture, all 3 stages.\nNote: Processing time is not expected to use a significant amount of time, however a user that looks at rollup/transform as black box this is not a given. Having stats for all 3 stages allows a complete view. LBNL result processing might have a bug, it's also possible that processing gets more complicated in future.\nprocessing made sense to me, if you have better name suggestion, please let me know.", "createdAt": "2020-03-18T21:49:28Z", "url": "https://github.com/elastic/elasticsearch/pull/53770", "merged": true, "mergeCommit": {"oid": "da9273ab7be558ff99ddc5caf86bb66895b386aa"}, "closed": true, "closedAt": "2020-03-23T19:32:20Z", "author": {"login": "hendrikmuhs"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcO-AJnAH2gAyMzkwNjgyNjA5OjBhZGI0YjkxYTQ5ZmQ0YWIzYzZkNmFkZTcyOWVlMzk2MWVmZTQ1YzE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcQdmtgAFqTM3OTM4NjEyMQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "0adb4b91a49fd4ab3c6d6ade729ee3961efe45c1", "author": {"user": {"login": "hendrikmuhs", "name": "Hendrik Muhs"}}, "url": "https://github.com/elastic/elasticsearch/commit/0adb4b91a49fd4ab3c6d6ade729ee3961efe45c1", "committedDate": "2020-03-18T21:15:18Z", "message": "add processing stats to record the time spent for processing results"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "75d12725668995cae626f3572b8187f8fbbadcbb", "author": {"user": {"login": "hendrikmuhs", "name": "Hendrik Muhs"}}, "url": "https://github.com/elastic/elasticsearch/commit/75d12725668995cae626f3572b8187f8fbbadcbb", "committedDate": "2020-03-19T06:39:44Z", "message": "fix some rest tests"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc3NjM2NjU1", "url": "https://github.com/elastic/elasticsearch/pull/53770#pullrequestreview-377636655", "createdAt": "2020-03-19T11:34:02Z", "commit": {"oid": "75d12725668995cae626f3572b8187f8fbbadcbb"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOVQxMTozNDowMlrOF4qieg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOVQxMTozNToxNlrOF4qk2g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDk2MTUzMA==", "bodyText": "The new long values need to be Long since they won't exist in older stats files. This will throw an NPE if it tries to parse XContent where these new values don't exist.", "url": "https://github.com/elastic/elasticsearch/pull/53770#discussion_r394961530", "createdAt": "2020-03-19T11:34:02Z", "author": {"login": "benwtrent"}, "path": "x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/transform/transforms/TransformIndexerStats.java", "diffHunk": "@@ -73,8 +77,10 @@\n         LENIENT_PARSER.declareLong(constructorArg(), NUM_INVOCATIONS);\n         LENIENT_PARSER.declareLong(constructorArg(), INDEX_TIME_IN_MS);\n         LENIENT_PARSER.declareLong(constructorArg(), SEARCH_TIME_IN_MS);\n+        LENIENT_PARSER.declareLong(constructorArg(), PROCESSING_TIME_IN_MS);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "75d12725668995cae626f3572b8187f8fbbadcbb"}, "originalPosition": 30}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDk2MjEzOA==", "bodyText": "We also need to be BWC with de-serializing an old stats document via XContent.", "url": "https://github.com/elastic/elasticsearch/pull/53770#discussion_r394962138", "createdAt": "2020-03-19T11:35:16Z", "author": {"login": "benwtrent"}, "path": "x-pack/plugin/core/src/test/java/org/elasticsearch/xpack/core/transform/transforms/TransformStatsTests.java", "diffHunk": "@@ -89,4 +89,32 @@ public void testBwcWith73() throws IOException {\n             }\n         }\n     }\n+\n+    public void testBwcWith76() throws IOException {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "75d12725668995cae626f3572b8187f8fbbadcbb"}, "originalPosition": 14}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b2f609bce196fe1ce3eba45c36acde597b50ba88", "author": {"user": {"login": "hendrikmuhs", "name": "Hendrik Muhs"}}, "url": "https://github.com/elastic/elasticsearch/commit/b2f609bce196fe1ce3eba45c36acde597b50ba88", "committedDate": "2020-03-19T13:22:21Z", "message": "fix rest tests, bump internal index and add additional mappings"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "87cec095f40f1d903f57a26cfc7a6c0f9d88e24f", "author": {"user": {"login": "hendrikmuhs", "name": "Hendrik Muhs"}}, "url": "https://github.com/elastic/elasticsearch/commit/87cec095f40f1d903f57a26cfc7a6c0f9d88e24f", "committedDate": "2020-03-20T09:52:29Z", "message": "make all stats field optional, avoids BWC issues"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2c7cca7e41652ffe44b90d748d383931eb15b4d6", "author": {"user": {"login": "hendrikmuhs", "name": "Hendrik Muhs"}}, "url": "https://github.com/elastic/elasticsearch/commit/2c7cca7e41652ffe44b90d748d383931eb15b4d6", "committedDate": "2020-03-20T11:07:04Z", "message": "fix else code style"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc5Mzg2MTIx", "url": "https://github.com/elastic/elasticsearch/pull/53770#pullrequestreview-379386121", "createdAt": "2020-03-23T12:34:52Z", "commit": {"oid": "2c7cca7e41652ffe44b90d748d383931eb15b4d6"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QxMjozNDo1M1rOF6DYmg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QxMjozNDo1M1rOF6DYmg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjQxNzE3OA==", "bodyText": "\u2764\ufe0f", "url": "https://github.com/elastic/elasticsearch/pull/53770#discussion_r396417178", "createdAt": "2020-03-23T12:34:53Z", "author": {"login": "benwtrent"}, "path": "client/rest-high-level/src/main/java/org/elasticsearch/client/transform/transforms/TransformIndexerStats.java", "diffHunk": "@@ -109,19 +149,44 @@ public boolean equals(Object other) {\n             && Objects.equals(this.numInvocations, that.numInvocations)\n             && Objects.equals(this.indexTime, that.indexTime)\n             && Objects.equals(this.searchTime, that.searchTime)\n+            && Objects.equals(this.processingTime, that.processingTime)\n             && Objects.equals(this.indexFailures, that.indexFailures)\n             && Objects.equals(this.searchFailures, that.searchFailures)\n             && Objects.equals(this.indexTotal, that.indexTotal)\n             && Objects.equals(this.searchTotal, that.searchTotal)\n+            && Objects.equals(this.processingTotal, that.processingTotal)\n             && Objects.equals(this.expAvgCheckpointDurationMs, that.expAvgCheckpointDurationMs)\n             && Objects.equals(this.expAvgDocumentsIndexed, that.expAvgDocumentsIndexed)\n             && Objects.equals(this.expAvgDocumentsProcessed, that.expAvgDocumentsProcessed);\n     }\n \n     @Override\n     public int hashCode() {\n-        return Objects.hash(numPages, numInputDocuments, numOuputDocuments, numInvocations,\n-            indexTime, searchTime, indexFailures, searchFailures, indexTotal, searchTotal,\n-            expAvgCheckpointDurationMs, expAvgDocumentsIndexed, expAvgDocumentsProcessed);\n+        return Objects.hash(\n+            numPages,\n+            numInputDocuments,\n+            numOuputDocuments,\n+            numInvocations,\n+            indexTime,\n+            searchTime,\n+            processingTime,\n+            indexFailures,\n+            searchFailures,\n+            indexTotal,\n+            searchTotal,\n+            processingTotal,\n+            expAvgCheckpointDurationMs,\n+            expAvgDocumentsIndexed,\n+            expAvgDocumentsProcessed\n+        );\n+    }\n+\n+    @SuppressWarnings(\"unchecked\")\n+    private static <T> T unboxSafe(Object l, T default_value) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2c7cca7e41652ffe44b90d748d383931eb15b4d6"}, "originalPosition": 151}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2038, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}