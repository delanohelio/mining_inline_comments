{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk4NDkxODE2", "number": 54761, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wNlQwMDoxNzoxOFrODu7w9Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wNlQwMDoxNzoxOFrODu7w9Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUwNTQwMjc3OnYy", "diffSide": "RIGHT", "path": "x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/security/user/InternalUserSerializationHelper.java", "isResolved": false, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wNlQwMDoxNzoxOFrOGBEsdw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wNlQxMzo0MjozMVrOGBYS0w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzc3ODY3OQ==", "bodyText": "Is this a concern for bwc? I think, in a mixed cluster environment, writing and reading this information from different versions would fail. But current failures don't seem to be releavant. I don't know the details about async search work. Is it 8.0 only?", "url": "https://github.com/elastic/elasticsearch/pull/54761#discussion_r403778679", "createdAt": "2020-04-06T00:17:18Z", "author": {"login": "ywangd"}, "path": "x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/security/user/InternalUserSerializationHelper.java", "diffHunk": "@@ -36,6 +38,9 @@ public static void writeTo(User user, StreamOutput output) throws IOException {\n         } else if (XPackSecurityUser.is(user)) {\n             output.writeBoolean(true);\n             output.writeString(XPackSecurityUser.NAME);\n+        } else if (AsyncSearchUser.is(user)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9ddb7ae633a04e0829e3323c9b8af95c7431a070"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzg5NzUxMw==", "bodyText": "It's a 7.7 feature so nodes in this version will be able to run _async_search and to create the new .async-search index. For the few cases where an older node could be  picked, the IllegalStateException thrown by readFrom should be enough to handle failures gracefully ?", "url": "https://github.com/elastic/elasticsearch/pull/54761#discussion_r403897513", "createdAt": "2020-04-06T07:59:27Z", "author": {"login": "jimczi"}, "path": "x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/security/user/InternalUserSerializationHelper.java", "diffHunk": "@@ -36,6 +38,9 @@ public static void writeTo(User user, StreamOutput output) throws IOException {\n         } else if (XPackSecurityUser.is(user)) {\n             output.writeBoolean(true);\n             output.writeString(XPackSecurityUser.NAME);\n+        } else if (AsyncSearchUser.is(user)) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzc3ODY3OQ=="}, "originalCommit": {"oid": "9ddb7ae633a04e0829e3323c9b8af95c7431a070"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDA5MzE1Ng==", "bodyText": "This is indeed a problem, but I don't see an easy way around it.\nWith the proposed changes, async search won't work until the master node is also upgraded, even if the coordinating node is. Does this sound reasonable to you @jimczi ? Are there other issues that would prevent the async search feature to work in a mixed cluster (assuming no, but maybe there is :) )?", "url": "https://github.com/elastic/elasticsearch/pull/54761#discussion_r404093156", "createdAt": "2020-04-06T13:33:14Z", "author": {"login": "albertzaharovits"}, "path": "x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/security/user/InternalUserSerializationHelper.java", "diffHunk": "@@ -36,6 +38,9 @@ public static void writeTo(User user, StreamOutput output) throws IOException {\n         } else if (XPackSecurityUser.is(user)) {\n             output.writeBoolean(true);\n             output.writeString(XPackSecurityUser.NAME);\n+        } else if (AsyncSearchUser.is(user)) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzc3ODY3OQ=="}, "originalCommit": {"oid": "9ddb7ae633a04e0829e3323c9b8af95c7431a070"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDA5OTc5NQ==", "bodyText": "That's fine IMO. We expect users to upgrade clusters entirely before using new features . Also, Kibana will use _async_search internally so the ES cluster must be fully upgraded before upgrading Kibana.", "url": "https://github.com/elastic/elasticsearch/pull/54761#discussion_r404099795", "createdAt": "2020-04-06T13:42:31Z", "author": {"login": "jimczi"}, "path": "x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/security/user/InternalUserSerializationHelper.java", "diffHunk": "@@ -36,6 +38,9 @@ public static void writeTo(User user, StreamOutput output) throws IOException {\n         } else if (XPackSecurityUser.is(user)) {\n             output.writeBoolean(true);\n             output.writeString(XPackSecurityUser.NAME);\n+        } else if (AsyncSearchUser.is(user)) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzc3ODY3OQ=="}, "originalCommit": {"oid": "9ddb7ae633a04e0829e3323c9b8af95c7431a070"}, "originalPosition": 13}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1340, "cost": 1, "resetAt": "2021-11-12T11:57:46Z"}}}