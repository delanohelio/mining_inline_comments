{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDI1MTE1MzY2", "number": 57361, "title": "Fold some of sig_terms into terms", "bodyText": "This merges the global-ordinals-based implementation for\nsignificant_terms into the global-ordinals-based implementation of\nterms, removing a bunch of copy and pasted code that is subtly\ndifferent across the two implementations and replacing it with an\nexplicit ResultStrategy with nice stuff like Javadoc.\nThe actual behavior is mostly unchanged, though I was able to remove a\nredundant copy of bytes representing the string from the result\nconstruction phase of significant_terms.", "createdAt": "2020-05-29T13:50:47Z", "url": "https://github.com/elastic/elasticsearch/pull/57361", "merged": true, "mergeCommit": {"oid": "10dc1446935a39607941041d9e5df733a670dcf2"}, "closed": true, "closedAt": "2020-05-29T21:07:00Z", "author": {"login": "nik9000"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcmCaSwAH2gAyNDI1MTE1MzY2OjdmN2Q3OWViNDljNWVjMTY5N2FhNGY0Y2VmYzM3MjUwMDUxMzdhMDM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcmIK2pAH2gAyNDI1MTE1MzY2OjhiYjFkMjI3ZGE5ODYwNjI0NmVjMWUxYmU2ZGVkMjU1NzM1YzdhOTY=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "7f7d79eb49c5ec1697aa4f4cefc3725005137a03", "author": {"user": {"login": "nik9000", "name": "Nik Everett"}}, "url": "https://github.com/elastic/elasticsearch/commit/7f7d79eb49c5ec1697aa4f4cefc3725005137a03", "committedDate": "2020-05-29T13:23:44Z", "message": "Fold some of sig_terms into terms\n\nThis merges the global-ordinals-based implementation for\n`significant_terms` into the global-ordinals-based implementation of\n`terms`, removing a bunch of copy and pasted code that is subtly\ndifferent across the two implementations and replacing it with an\nexplicit `ResultStrategy` with nice stuff like Javadoc.\n\nThe actual behavior is mostly unchanged, though I was able to remove a\nredundant copy of bytes representing the string from the result\nconstruction phase of `significant_terms`."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a98e32f34b55ef46118dbf329ac50be08263a39c", "author": {"user": {"login": "nik9000", "name": "Nik Everett"}}, "url": "https://github.com/elastic/elasticsearch/commit/a98e32f34b55ef46118dbf329ac50be08263a39c", "committedDate": "2020-05-29T14:43:39Z", "message": "Add missing"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIxMDIzNTc0", "url": "https://github.com/elastic/elasticsearch/pull/57361#pullrequestreview-421023574", "createdAt": "2020-05-29T14:46:27Z", "commit": {"oid": "7f7d79eb49c5ec1697aa4f4cefc3725005137a03"}, "state": "APPROVED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOVQxNDo0NjoyN1rOGcf8kA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOVQxNTowNjowOFrOGcgt6w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjUzNjcyMA==", "bodyText": "Nit: Maybe run the formatter on this method declaration?", "url": "https://github.com/elastic/elasticsearch/pull/57361#discussion_r432536720", "createdAt": "2020-05-29T14:46:27Z", "author": {"login": "not-napoleon"}, "path": "server/src/main/java/org/elasticsearch/search/aggregations/bucket/terms/GlobalOrdinalsStringTermsAggregator.java", "diffHunk": "@@ -65,16 +69,17 @@\n     // first defined one.\n     // So currently for each instance of this aggregator the acceptedglobalValues will be computed, this is unnecessary\n     // especially if this agg is on a second layer or deeper.\n-    protected final LongPredicate acceptedGlobalOrdinals;\n-    protected final long valueCount;\n-    protected final GlobalOrdLookupFunction lookupGlobalOrd;\n+    private final LongPredicate acceptedGlobalOrdinals;\n+    private final long valueCount;\n+    private final GlobalOrdLookupFunction lookupGlobalOrd;\n     protected final CollectionStrategy collectionStrategy;\n \n     public interface GlobalOrdLookupFunction {\n         BytesRef apply(long ord) throws IOException;\n     }\n \n     public GlobalOrdinalsStringTermsAggregator(String name, AggregatorFactories factories,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7f7d79eb49c5ec1697aa4f4cefc3725005137a03"}, "originalPosition": 52}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjU0NzA3MA==", "bodyText": "Nit: Since the syntax backing this is somewhat rare in aggs, maybe toss a quick comment here that we need the reference to this in order to construct the closure?  I figured it out, but did a double take when I first saw it.", "url": "https://github.com/elastic/elasticsearch/pull/57361#discussion_r432547070", "createdAt": "2020-05-29T15:02:18Z", "author": {"login": "not-napoleon"}, "path": "server/src/main/java/org/elasticsearch/search/aggregations/bucket/terms/GlobalOrdinalsStringTermsAggregator.java", "diffHunk": "@@ -87,6 +92,7 @@ public GlobalOrdinalsStringTermsAggregator(String name, AggregatorFactories fact\n                                                boolean showTermDocCountError,\n                                                Map<String, Object> metadata) throws IOException {\n         super(name, factories, context, parent, order, format, bucketCountThresholds, collectionMode, showTermDocCountError, metadata);\n+        this.resultStrategy = resultStrategy.apply(this);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7f7d79eb49c5ec1697aa4f4cefc3725005137a03"}, "originalPosition": 61}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjU0OTM1NQ==", "bodyText": "Nit: maybe update the javadoc to say this can only be used for StandardTerms?", "url": "https://github.com/elastic/elasticsearch/pull/57361#discussion_r432549355", "createdAt": "2020-05-29T15:06:08Z", "author": {"login": "not-napoleon"}, "path": "server/src/main/java/org/elasticsearch/search/aggregations/bucket/terms/GlobalOrdinalsStringTermsAggregator.java", "diffHunk": "@@ -276,15 +227,14 @@ protected void doClose() {\n                        SubAggCollectionMode collectionMode,\n                        boolean showTermDocCountError,\n                        Map<String, Object> metadata) throws IOException {\n-            super(name, factories, valuesSource, order, format, bucketCountThresholds, null,\n+            super(name, factories, a -> a.new StandardTermsResults(), valuesSource, order, format, bucketCountThresholds, null,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7f7d79eb49c5ec1697aa4f4cefc3725005137a03"}, "originalPosition": 191}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "001df04451401e7e42284c16a701620c357937d0", "author": {"user": {"login": "nik9000", "name": "Nik Everett"}}, "url": "https://github.com/elastic/elasticsearch/commit/001df04451401e7e42284c16a701620c357937d0", "committedDate": "2020-05-29T19:58:23Z", "message": "Merge branch 'master' into global_ords_result_strategy"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8bb1d227da98606246ec1e1be6ded255735c7a96", "author": {"user": {"login": "nik9000", "name": "Nik Everett"}}, "url": "https://github.com/elastic/elasticsearch/commit/8bb1d227da98606246ec1e1be6ded255735c7a96", "committedDate": "2020-05-29T20:06:18Z", "message": "Feedback"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4017, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}