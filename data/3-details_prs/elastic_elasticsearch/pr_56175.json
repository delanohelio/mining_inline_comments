{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDEzMzYzNTg4", "number": 56175, "title": "upgrade to Lucene 8.6.0 snapshot", "bodyText": "upgrade to new Lucene snapshot.", "createdAt": "2020-05-05T08:01:18Z", "url": "https://github.com/elastic/elasticsearch/pull/56175", "merged": true, "mergeCommit": {"oid": "e62fb090fa5452a1c088cb778299a02ace40c18e"}, "closed": true, "closedAt": "2020-05-13T06:37:36Z", "author": {"login": "iverase"}, "timelineItems": {"totalCount": 32, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcePYMqgH2gAyNDEzMzYzNTg4OjcwYzViZGU4ODkwMzBjMTAxNGViNTAzNzU2Yjc3ZWE2Y2U3MmYxZTI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcgfygegH2gAyNDEzMzYzNTg4OjY5MGE3MWY0ZjRhMjc4NjhhMTg1OTUzYWVmOTY4YTk1NDE5OTBmZDc=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "70c5bde889030c1014eb503756b77ea6ce72f1e2", "author": {"user": {"login": "iverase", "name": "Ignacio Vera"}}, "url": "https://github.com/elastic/elasticsearch/commit/70c5bde889030c1014eb503756b77ea6ce72f1e2", "committedDate": "2020-05-05T07:58:49Z", "message": "upgrade to Lucene 8.6.0 snapshot"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA1NTc5MTk4", "url": "https://github.com/elastic/elasticsearch/pull/56175#pullrequestreview-405579198", "createdAt": "2020-05-05T08:18:07Z", "commit": {"oid": "70c5bde889030c1014eb503756b77ea6ce72f1e2"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNVQwODoxODowN1rOGQfATw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNVQwODoxODowN1rOGQfATw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTkzODM4Mw==", "bodyText": "We should try to read directly into the ByteBuffer instead of materializing a byte[]?", "url": "https://github.com/elastic/elasticsearch/pull/56175#discussion_r419938383", "createdAt": "2020-05-05T08:18:07Z", "author": {"login": "jpountz"}, "path": "x-pack/plugin/searchable-snapshots/src/main/java/org/elasticsearch/index/store/cache/CachedBlobContainerIndexInput.java", "diffHunk": "@@ -319,9 +317,16 @@ private boolean assertRangeIsAlignedWithPart(Tuple<Long, Long> range) {\n         return true;\n     }\n \n-    private int readCacheFile(FileChannel fc, long end, long position, byte[] buffer, int offset, long length) throws IOException {\n+    private int readCacheFile(FileChannel fc, long end, long position, ByteBuffer b, long length) throws IOException {\n         assert assertFileChannelOpen(fc);\n-        int bytesRead = Channels.readFromFileChannel(fc, position, buffer, offset, Math.toIntExact(Math.min(length, end - position)));\n+        int bytesRead;\n+        if (end - position < b.remaining()) {\n+            int l = Math.toIntExact(end - position);\n+            b.put(Channels.readFromFileChannel(fc, position, l));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "70c5bde889030c1014eb503756b77ea6ce72f1e2"}, "originalPosition": 48}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fdc7138ebe54bb35636e2ff220d14e17887633ab", "author": {"user": {"login": "iverase", "name": "Ignacio Vera"}}, "url": "https://github.com/elastic/elasticsearch/commit/fdc7138ebe54bb35636e2ff220d14e17887633ab", "committedDate": "2020-05-05T09:12:52Z", "message": "remove ON_HEAP_ID_TERMS_INDEX index setting"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3537f63e41ac54533cda46150978d1fe552dd3e8", "author": {"user": {"login": "iverase", "name": "Ignacio Vera"}}, "url": "https://github.com/elastic/elasticsearch/commit/3537f63e41ac54533cda46150978d1fe552dd3e8", "committedDate": "2020-05-05T09:45:25Z", "message": "remove assertions. I believe LUCENE-9276 has removed the need of different update docs paths."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ef684d14d4e98b5e84a11934058cc2f46f9abb78", "author": {"user": {"login": "iverase", "name": "Ignacio Vera"}}, "url": "https://github.com/elastic/elasticsearch/commit/ef684d14d4e98b5e84a11934058cc2f46f9abb78", "committedDate": "2020-05-05T09:57:58Z", "message": "fix compile error"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8b49fbe0b4dbe06477bb01e8a539441a80aaede6", "author": {"user": {"login": "iverase", "name": "Ignacio Vera"}}, "url": "https://github.com/elastic/elasticsearch/commit/8b49fbe0b4dbe06477bb01e8a539441a80aaede6", "committedDate": "2020-05-05T10:18:46Z", "message": "fix checkStyle"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "458f0acbfaf1b844a9a5e3dab2ccb291cde9b41d", "author": {"user": {"login": "iverase", "name": "Ignacio Vera"}}, "url": "https://github.com/elastic/elasticsearch/commit/458f0acbfaf1b844a9a5e3dab2ccb291cde9b41d", "committedDate": "2020-05-05T11:07:40Z", "message": "remove corruption workaround"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5d99a6411fc44574e52968c739240caeb3da0deb", "author": {"user": {"login": "iverase", "name": "Ignacio Vera"}}, "url": "https://github.com/elastic/elasticsearch/commit/5d99a6411fc44574e52968c739240caeb3da0deb", "committedDate": "2020-05-05T11:09:36Z", "message": "remove corruption workaround"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "05dc43abffdd1368896377ed5b29f37f92fdbbc8", "author": {"user": {"login": "iverase", "name": "Ignacio Vera"}}, "url": "https://github.com/elastic/elasticsearch/commit/05dc43abffdd1368896377ed5b29f37f92fdbbc8", "committedDate": "2020-05-05T11:09:42Z", "message": "Merge branch 'master' into lucene-8.6.0-snapshot-6c9024f7735"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b6ac6e23be4df51e5719ce8eb1961596cb6e3296", "author": {"user": {"login": "iverase", "name": "Ignacio Vera"}}, "url": "https://github.com/elastic/elasticsearch/commit/b6ac6e23be4df51e5719ce8eb1961596cb6e3296", "committedDate": "2020-05-05T12:58:35Z", "message": "override consumeTermsMatching in QueryAnalyzer#ResultBuilder"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "20ec5f7087604f51ebfe9148db5f421c7d526ce6", "author": {"user": {"login": "iverase", "name": "Ignacio Vera"}}, "url": "https://github.com/elastic/elasticsearch/commit/20ec5f7087604f51ebfe9148db5f421c7d526ce6", "committedDate": "2020-05-05T13:56:20Z", "message": "Merge branch 'master' into lucene-8.6.0-snapshot-6c9024f7735"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA1ODI1NzI4", "url": "https://github.com/elastic/elasticsearch/pull/56175#pullrequestreview-405825728", "createdAt": "2020-05-05T14:09:31Z", "commit": {"oid": "20ec5f7087604f51ebfe9148db5f421c7d526ce6"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNVQxNDowOTozMVrOGQrPSg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNVQxNDowOTozMVrOGQrPSg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDEzODgyNg==", "bodyText": "After removing this, the test times out. I have not found a way to do this in Lucene 8.6 as this is now private in the Index writer. @original-brownbear you were the last one to modify this class, you might have an idea what we can do here?", "url": "https://github.com/elastic/elasticsearch/pull/56175#discussion_r420138826", "createdAt": "2020-05-05T14:09:31Z", "author": {"login": "iverase"}, "path": "qa/evil-tests/src/test/java/org/elasticsearch/index/engine/EvilInternalEngineTests.java", "diffHunk": "@@ -64,21 +64,6 @@ public void testOutOfMemoryErrorWhileMergingIsRethrownAndIsUncaught() throws IOE\n                         public void merge(final MergePolicy.OneMerge merge) throws IOException {\n                             throw new OutOfMemoryError(\"640K ought to be enough for anybody\");\n                         }\n-\n-                        @Override\n-                        public synchronized MergePolicy.OneMerge getNextMerge() {\n-                            /*\n-                             * This will be called when we flush when we will not be ready to return the segments. After the segments are on\n-                             * disk, we can only return them from here once or the merge scheduler will be stuck in a loop repeatedly\n-                             * peeling off the same segments to schedule for merging.\n-                             */\n-                            if (segmentsReference.get() == null) {\n-                                return super.getNextMerge();\n-                            } else {\n-                                final List<SegmentCommitInfo> segments = segmentsReference.getAndSet(null);\n-                                return new MergePolicy.OneMerge(segments);\n-                            }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "20ec5f7087604f51ebfe9148db5f421c7d526ce6"}, "originalPosition": 17}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b7fcfa1de5e4c1e224e4fcdbe2cdbe4b951a7471", "author": {"user": {"login": "iverase", "name": "Ignacio Vera"}}, "url": "https://github.com/elastic/elasticsearch/commit/b7fcfa1de5e4c1e224e4fcdbe2cdbe4b951a7471", "committedDate": "2020-05-05T15:34:48Z", "message": "read directly into the ByteBuffer instead of materializing a byte[]"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA1ODU0NzU1", "url": "https://github.com/elastic/elasticsearch/pull/56175#pullrequestreview-405854755", "createdAt": "2020-05-05T14:39:11Z", "commit": {"oid": "20ec5f7087604f51ebfe9148db5f421c7d526ce6"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNVQxNDozOToxMVrOGQsnYg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNVQxNDo1NjoxNlrOGQtcVw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDE2MTM3OA==", "bodyText": "nit: no need to break the line", "url": "https://github.com/elastic/elasticsearch/pull/56175#discussion_r420161378", "createdAt": "2020-05-05T14:39:11Z", "author": {"login": "tlrx"}, "path": "x-pack/plugin/core/src/main/java/org/elasticsearch/snapshots/SourceOnlySnapshot.java", "diffHunk": "@@ -219,7 +218,8 @@ private SegmentCommitInfo syncSegment(SegmentCommitInfo segmentCommitInfo, LiveD\n                 SegmentInfo newSegmentInfo = new SegmentInfo(targetDirectory, si.getVersion(), si.getMinVersion(), si.name, si.maxDoc(),\n                     false, si.getCodec(), si.getDiagnostics(), si.getId(), si.getAttributes(), null);\n                 // we drop the sort on purpose since the field we sorted on doesn't exist in the target index anymore.\n-                newInfo = new SegmentCommitInfo(newSegmentInfo, 0, 0, -1, -1, -1);\n+                newInfo = new SegmentCommitInfo(newSegmentInfo, 0, 0, -1,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "20ec5f7087604f51ebfe9148db5f421c7d526ce6"}, "originalPosition": 40}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDE3NDkzNQ==", "bodyText": "This should be final", "url": "https://github.com/elastic/elasticsearch/pull/56175#discussion_r420174935", "createdAt": "2020-05-05T14:56:16Z", "author": {"login": "tlrx"}, "path": "x-pack/plugin/searchable-snapshots/src/main/java/org/elasticsearch/index/store/cache/CachedBlobContainerIndexInput.java", "diffHunk": "@@ -128,16 +128,14 @@ private CacheFile getCacheFileSafe() throws Exception {\n     }\n \n     @Override\n-    protected void readInternal(final byte[] buffer, final int offset, final int length) throws IOException {\n+    protected void readInternal(ByteBuffer b) throws IOException {\n         ensureContext(ctx -> ctx != CACHE_WARMING_CONTEXT);\n         final long position = getFilePointer() + this.offset;\n-\n+        int length = b.remaining();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "20ec5f7087604f51ebfe9148db5f421c7d526ce6"}, "originalPosition": 9}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2090b8b926184ccc5fc96021c0a746c033223fe6", "author": {"user": {"login": "iverase", "name": "Ignacio Vera"}}, "url": "https://github.com/elastic/elasticsearch/commit/2090b8b926184ccc5fc96021c0a746c033223fe6", "committedDate": "2020-05-05T17:36:48Z", "message": "address review comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "835b783d42568f6aba38a9a8a8dfce494b694b42", "author": {"user": {"login": "iverase", "name": "Ignacio Vera"}}, "url": "https://github.com/elastic/elasticsearch/commit/835b783d42568f6aba38a9a8a8dfce494b694b42", "committedDate": "2020-05-05T18:06:28Z", "message": "Fix EvilInternalEngineTests, thanks Nhat for the fix!"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e83d3fd566a0f2530bd0b47c1128a61dfc135347", "author": {"user": {"login": "iverase", "name": "Ignacio Vera"}}, "url": "https://github.com/elastic/elasticsearch/commit/e83d3fd566a0f2530bd0b47c1128a61dfc135347", "committedDate": "2020-05-06T08:52:10Z", "message": "Merge branch 'master' into lucene-8.6.0-snapshot-6c9024f7735"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a7980b5a7e190af19addf37593f54df4a36b8ba2", "author": {"user": {"login": "iverase", "name": "Ignacio Vera"}}, "url": "https://github.com/elastic/elasticsearch/commit/a7980b5a7e190af19addf37593f54df4a36b8ba2", "committedDate": "2020-05-06T09:02:30Z", "message": "Merge branch 'master' into lucene-8.6.0-snapshot-6c9024f7735"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA2NDEzOTk5", "url": "https://github.com/elastic/elasticsearch/pull/56175#pullrequestreview-406413999", "createdAt": "2020-05-06T08:47:25Z", "commit": {"oid": "835b783d42568f6aba38a9a8a8dfce494b694b42"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNlQwODo0NzoyNlrOGRJhrw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNlQwODo0OTo1NFrOGRJm0Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDYzNTA1NQ==", "bodyText": "This does not restore the original limit if something goes wrong while reading the channel. I think we should duplicate the ByteBuffer first (by using the duplicate() method) and sets a new limit on the duplicate, and only update the position if the read on the duplicate succeed. WDYT?", "url": "https://github.com/elastic/elasticsearch/pull/56175#discussion_r420635055", "createdAt": "2020-05-06T08:47:26Z", "author": {"login": "tlrx"}, "path": "x-pack/plugin/searchable-snapshots/src/main/java/org/elasticsearch/index/store/cache/CachedBlobContainerIndexInput.java", "diffHunk": "@@ -319,9 +317,18 @@ private boolean assertRangeIsAlignedWithPart(Tuple<Long, Long> range) {\n         return true;\n     }\n \n-    private int readCacheFile(FileChannel fc, long end, long position, byte[] buffer, int offset, long length) throws IOException {\n+    private int readCacheFile(FileChannel fc, long end, long position, ByteBuffer b) throws IOException {\n         assert assertFileChannelOpen(fc);\n-        int bytesRead = Channels.readFromFileChannel(fc, position, buffer, offset, Math.toIntExact(Math.min(length, end - position)));\n+        final int bytesRead;\n+        if (end - position < b.remaining()) {\n+            final int originalLimit = b.limit();\n+            b.limit(b.position() + Math.toIntExact(end - position));\n+            bytesRead = Channels.readFromFileChannel(fc, position, b);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "835b783d42568f6aba38a9a8a8dfce494b694b42"}, "originalPosition": 49}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDYzNjM2OQ==", "bodyText": "I also think that removing the length method parameter changes the meaning of the EOFException message", "url": "https://github.com/elastic/elasticsearch/pull/56175#discussion_r420636369", "createdAt": "2020-05-06T08:49:54Z", "author": {"login": "tlrx"}, "path": "x-pack/plugin/searchable-snapshots/src/main/java/org/elasticsearch/index/store/cache/CachedBlobContainerIndexInput.java", "diffHunk": "@@ -319,9 +317,18 @@ private boolean assertRangeIsAlignedWithPart(Tuple<Long, Long> range) {\n         return true;\n     }\n \n-    private int readCacheFile(FileChannel fc, long end, long position, byte[] buffer, int offset, long length) throws IOException {\n+    private int readCacheFile(FileChannel fc, long end, long position, ByteBuffer b) throws IOException {\n         assert assertFileChannelOpen(fc);\n-        int bytesRead = Channels.readFromFileChannel(fc, position, buffer, offset, Math.toIntExact(Math.min(length, end - position)));\n+        final int bytesRead;\n+        if (end - position < b.remaining()) {\n+            final int originalLimit = b.limit();\n+            b.limit(b.position() + Math.toIntExact(end - position));\n+            bytesRead = Channels.readFromFileChannel(fc, position, b);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDYzNTA1NQ=="}, "originalCommit": {"oid": "835b783d42568f6aba38a9a8a8dfce494b694b42"}, "originalPosition": 49}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a2db1fc3b7d0661d15f85cf41d03b41875c5fd93", "author": {"user": {"login": "iverase", "name": "Ignacio Vera"}}, "url": "https://github.com/elastic/elasticsearch/commit/a2db1fc3b7d0661d15f85cf41d03b41875c5fd93", "committedDate": "2020-05-06T09:54:36Z", "message": "duplicate buffer when reading incomplete buffers"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "34f4d9882a3c022e999e88a1e54bb231686ecc12", "author": {"user": {"login": "iverase", "name": "Ignacio Vera"}}, "url": "https://github.com/elastic/elasticsearch/commit/34f4d9882a3c022e999e88a1e54bb231686ecc12", "committedDate": "2020-05-06T12:01:15Z", "message": "Merge branch 'master' into lucene-8.6.0-snapshot-6c9024f7735"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cdcf4c8f3a25b51d2a6c1b92e510c01706ea0ebb", "author": {"user": {"login": "iverase", "name": "Ignacio Vera"}}, "url": "https://github.com/elastic/elasticsearch/commit/cdcf4c8f3a25b51d2a6c1b92e510c01706ea0ebb", "committedDate": "2020-05-07T07:56:16Z", "message": "Merge branch 'master' into lucene-8.6.0-snapshot-6c9024f7735"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA3NjE1MzAy", "url": "https://github.com/elastic/elasticsearch/pull/56175#pullrequestreview-407615302", "createdAt": "2020-05-07T15:59:19Z", "commit": {"oid": "cdcf4c8f3a25b51d2a6c1b92e510c01706ea0ebb"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bb7252bd2bd1631c3c5884298965a341bef0e8f2", "author": {"user": {"login": "iverase", "name": "Ignacio Vera"}}, "url": "https://github.com/elastic/elasticsearch/commit/bb7252bd2bd1631c3c5884298965a341bef0e8f2", "committedDate": "2020-05-08T08:52:52Z", "message": "Merge branch 'master' into lucene-8.6.0-snapshot-6c9024f7735"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d1cfbb217608c9822f06e04d3e1440472663b398", "author": {"user": {"login": "iverase", "name": "Ignacio Vera"}}, "url": "https://github.com/elastic/elasticsearch/commit/d1cfbb217608c9822f06e04d3e1440472663b398", "committedDate": "2020-05-08T08:53:57Z", "message": "disable BWC for lucene upgrade"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "828a81e220495ec9f6199b4609076fbdfda59d60", "author": {"user": {"login": "iverase", "name": "Ignacio Vera"}}, "url": "https://github.com/elastic/elasticsearch/commit/828a81e220495ec9f6199b4609076fbdfda59d60", "committedDate": "2020-05-08T09:20:25Z", "message": "revert disable BWC for lucene upgrade"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ad80d34d916130f59b284f1043408819b43e6a0b", "author": {"user": {"login": "iverase", "name": "Ignacio Vera"}}, "url": "https://github.com/elastic/elasticsearch/commit/ad80d34d916130f59b284f1043408819b43e6a0b", "committedDate": "2020-05-08T10:26:11Z", "message": "Merge branch 'master' into lucene-8.6.0-snapshot-6c9024f7735"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7c2046d19ff52c9502c75ab95b1b97bf612546bf", "author": {"user": {"login": "iverase", "name": "Ignacio Vera"}}, "url": "https://github.com/elastic/elasticsearch/commit/7c2046d19ff52c9502c75ab95b1b97bf612546bf", "committedDate": "2020-05-09T09:51:52Z", "message": "increase number of docs to make sure we have a tree with plenty of leaf nodes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a402a2b64eb2e3f3e48411afbfb2730720689ab0", "author": {"user": {"login": "iverase", "name": "Ignacio Vera"}}, "url": "https://github.com/elastic/elasticsearch/commit/a402a2b64eb2e3f3e48411afbfb2730720689ab0", "committedDate": "2020-05-09T09:53:07Z", "message": "Merge branch 'master' into lucene-8.6.0-snapshot-6c9024f7735"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA5MjE0MTAw", "url": "https://github.com/elastic/elasticsearch/pull/56175#pullrequestreview-409214100", "createdAt": "2020-05-11T14:15:52Z", "commit": {"oid": "7c2046d19ff52c9502c75ab95b1b97bf612546bf"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMVQxNDoxNTo1MlrOGTeOsA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMVQxNDoxNTo1MlrOGTeOsA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzA3MTQwOA==", "bodyText": "This part feels wrong, we should instead use trackTotalHitsUpTo() or fix assertSortResults to no longer fail if the expected hit count is greater than the actual hit count and relation=gte? @mayya-sharipova @jimczi opinions?", "url": "https://github.com/elastic/elasticsearch/pull/56175#discussion_r423071408", "createdAt": "2020-05-11T14:15:52Z", "author": {"login": "jpountz"}, "path": "server/src/test/java/org/elasticsearch/search/query/QueryPhaseTests.java", "diffHunk": "@@ -675,7 +675,7 @@ public void testNumericLongOrDateSortOptimization() throws Exception {\n         searchContext.sort(sortAndFormats);\n         searchContext.parsedQuery(new ParsedQuery(new MatchAllDocsQuery()));\n         searchContext.setTask(new SearchShardTask(123L, \"\", \"\", \"\", null, Collections.emptyMap()));\n-        searchContext.setSize(10);\n+        searchContext.setSize(numDocs);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7c2046d19ff52c9502c75ab95b1b97bf612546bf"}, "originalPosition": 16}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "195607430d10cfb1a372abb33af9cc99fba360a7", "author": {"user": {"login": "iverase", "name": "Ignacio Vera"}}, "url": "https://github.com/elastic/elasticsearch/commit/195607430d10cfb1a372abb33af9cc99fba360a7", "committedDate": "2020-05-12T08:12:44Z", "message": "assertSortResults no longer fail if the expected hit count is greater than the actual hit count and relation=gte"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "690a71f4f4a27868a185953aef968a9541990fd7", "author": {"user": {"login": "iverase", "name": "Ignacio Vera"}}, "url": "https://github.com/elastic/elasticsearch/commit/690a71f4f4a27868a185953aef968a9541990fd7", "committedDate": "2020-05-12T08:13:53Z", "message": "Merge branch 'master' into lucene-8.6.0-snapshot-6c9024f7735"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 94, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}