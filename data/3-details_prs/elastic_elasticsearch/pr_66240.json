{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTM5MTE3NjUy", "number": 66240, "title": "Coerce blank fields to null in ApiKey requests", "bodyText": "API Key request objects (InvalidateApiKeyRequest and\nGetApiKeyRequest) support multiple key-selection parameters such as\nrealm-name, user-name, key-id and key-name.\nThe specified behaviour is that if any of these are blank then they\nact as a wildcard and do not restrict the search criteria.\nThis change moves the \"is blank\" logic into the constructor for these\nrequests so that there is a single consistent way to determine blank\n(Strings.hasText(arg) == false) and all usage of these fields can\nrely on the getter returning either null or a real value, and\nnever a non-null blank.\nRelates: #62916", "createdAt": "2020-12-14T04:22:58Z", "url": "https://github.com/elastic/elasticsearch/pull/66240", "merged": true, "mergeCommit": {"oid": "fcf28c319796a99402079c50310a81b271f15c56"}, "closed": true, "closedAt": "2020-12-15T00:59:51Z", "author": {"login": "tvernum"}, "timelineItems": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdl9iVugH2gAyNTM5MTE3NjUyOmE0NjRhZmMzNGNmNmEzNTg4MjY0ODhmMzlkNWMzMzlkMzYyNzhmNWE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdmDsRpAFqTU1MTI2MjQzMA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "a464afc34cf6a358826488f39d5c339d36278f5a", "author": {"user": {"login": "tvernum", "name": "Tim Vernum"}}, "url": "https://github.com/elastic/elasticsearch/commit/a464afc34cf6a358826488f39d5c339d36278f5a", "committedDate": "2020-12-14T03:54:09Z", "message": "Coerce blank fields to null in ApiKey requests\n\nAPI Key request objects (`InvalidateApiKeyRequest` and\n`GetApiKeyRequest`) support multiple key-selection parameters such as\nrealm-name, user-name, key-id and key-name.\n\nThe specified behaviour is that if any of these are _blank_ then they\nact as a wildcard and do not restrict the search criteria.\n\nThis change moves the \"is blank\" logic into the constructor for these\nrequests so that there is a single consistent way to determine blank\n(`Strings.hasText(arg) == false`) and all usage of these fields can\nrely on the getter returning either `null` or a _real value_, and\nnever a non-null blank.\n\nRelates: #62916"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUxMDQxODA0", "url": "https://github.com/elastic/elasticsearch/pull/66240#pullrequestreview-551041804", "createdAt": "2020-12-14T04:51:38Z", "commit": {"oid": "a464afc34cf6a358826488f39d5c339d36278f5a"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNFQwNDo1MTozOVrOIE_yUA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNFQwNDo1MTozOVrOIE_yUA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjExMDI4OA==", "bodyText": "Before I touched this class in 7.10, there is no check for id in either constructor. Last time I added\nids = Strings.hasText(id) == false ? null : new String[] { id };\n\nin the constructor with StreamInput. Looking back now, this introduced a tiny inconsistency of how empty id is handled in different constructors. Your change here fixed this inconsistency. Thanks!\nNow I have a new question: since a single empty string is now handled and excluded from the constructor, should we also apply the empty check for the string array of ids, i.e., should we move the validation logic of ids into here as well? On one hand, relocating the check for ids is good for consistency in that validate() is more about interactions between multiple fields. On the other hand, it complicates the constructors and also could be considered as a slight behaviour change. Overall, I think I prefer to not touch it.", "url": "https://github.com/elastic/elasticsearch/pull/66240#discussion_r542110288", "createdAt": "2020-12-14T04:51:39Z", "author": {"login": "ywangd"}, "path": "x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/security/action/InvalidateApiKeyRequest.java", "diffHunk": "@@ -65,17 +65,21 @@ public InvalidateApiKeyRequest(@Nullable String realmName, @Nullable String user\n             throw new IllegalArgumentException(\"Must use either [id] or [ids], not both at the same time\");\n         }\n \n-        this.realmName = realmName;\n-        this.userName = userName;\n-        if (id != null) {\n-            this.ids = new String[] {id};\n+        this.realmName = textOrNull(realmName);\n+        this.userName = textOrNull(userName);\n+        if (Strings.hasText(id)) {\n+            this.ids = new String[]{id};\n         } else {\n             this.ids = ids;\n         }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a464afc34cf6a358826488f39d5c339d36278f5a"}, "originalPosition": 33}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUxMjYyNDMw", "url": "https://github.com/elastic/elasticsearch/pull/66240#pullrequestreview-551262430", "createdAt": "2020-12-14T11:04:26Z", "commit": {"oid": "a464afc34cf6a358826488f39d5c339d36278f5a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4608, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}