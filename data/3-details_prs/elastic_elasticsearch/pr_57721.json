{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDI4NDIxMDQz", "number": 57721, "title": "Change default backing index naming scheme", "bodyText": "By default, backing indices will now be named .ds-<datastreamName>-<generation> instead of <datastreamName>-<generation> so that they do not match the common wildcard patterns such as <datastreamName>* that are intended to match the data stream itself.\nRelates to #53100.", "createdAt": "2020-06-05T12:31:02Z", "url": "https://github.com/elastic/elasticsearch/pull/57721", "merged": true, "mergeCommit": {"oid": "904bdae9ffd3da757f71f3cdd8c2d335269cce06"}, "closed": true, "closedAt": "2020-06-08T13:39:56Z", "author": {"login": "danhermann"}, "timelineItems": {"totalCount": 20, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcoRzbqgH2gAyNDI4NDIxMDQzOmFhZTc5NzViNTJlYjcyZGRlYTU1MGEzZGJkYWE2M2M2MGNiMGQ3MzA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcpP732gH2gAyNDI4NDIxMDQzOjI0YWVkNzg2MDMwODU0ZjliNDYyY2RiN2FmNDQ1MGI2ZGUyMDBjNTQ=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "aae7975b52eb72ddea550a3dbdaa63c60cb0d730", "author": {"user": {"login": "danhermann", "name": "Dan Hermann"}}, "url": "https://github.com/elastic/elasticsearch/commit/aae7975b52eb72ddea550a3dbdaa63c60cb0d730", "committedDate": "2020-06-05T12:27:37Z", "message": "Change default backing index naming scheme"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8973e04ad0ba7f3a25777dd3ebe3f7c99bab96b7", "author": {"user": {"login": "elasticmachine", "name": "Elastic Machine"}}, "url": "https://github.com/elastic/elasticsearch/commit/8973e04ad0ba7f3a25777dd3ebe3f7c99bab96b7", "committedDate": "2020-06-05T12:54:14Z", "message": "Merge branch 'master' into change_backing_index_names"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "94867871f7bc68ee7723ea4e66d593c965c97712", "author": {"user": {"login": "danhermann", "name": "Dan Hermann"}}, "url": "https://github.com/elastic/elasticsearch/commit/94867871f7bc68ee7723ea4e66d593c965c97712", "committedDate": "2020-06-05T13:15:29Z", "message": "fix ILM tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "56fd4731d3505d97614459527a662930c6ea2bad", "author": {"user": {"login": "danhermann", "name": "Dan Hermann"}}, "url": "https://github.com/elastic/elasticsearch/commit/56fd4731d3505d97614459527a662930c6ea2bad", "committedDate": "2020-06-05T20:26:50Z", "message": "fix yaml tests"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI1NjA1ODk2", "url": "https://github.com/elastic/elasticsearch/pull/57721#pullrequestreview-425605896", "createdAt": "2020-06-05T20:28:44Z", "commit": {"oid": "56fd4731d3505d97614459527a662930c6ea2bad"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNVQyMDoyODo0NFrOGf8b0Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNVQyMDoyODo0NFrOGf8b0Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjE0OTIwMQ==", "bodyText": "TIL that JSON paths in the YAML tests beginning with . have to be escaped.", "url": "https://github.com/elastic/elasticsearch/pull/57721#discussion_r436149201", "createdAt": "2020-06-05T20:28:44Z", "author": {"login": "danhermann"}, "path": "rest-api-spec/src/main/resources/rest-api-spec/test/indices.data_stream/10_basic.yml", "diffHunk": "@@ -178,18 +178,18 @@ setup:\n \n   - do:\n       indices.get:\n-        index: ['simple-data-stream1-000001', 'test_index']\n+        index: ['.ds-simple-data-stream1-000001', 'test_index']\n \n   - is_true: test_index.settings\n-  - is_true: simple-data-stream1-000001.settings\n+  - is_true: \\.ds-simple-data-stream1-000001.settings", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "56fd4731d3505d97614459527a662930c6ea2bad"}, "originalPosition": 55}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "54d9078e1134a8bfe1151c1a61164325c6870709", "author": {"user": {"login": "danhermann", "name": "Dan Hermann"}}, "url": "https://github.com/elastic/elasticsearch/commit/54d9078e1134a8bfe1151c1a61164325c6870709", "committedDate": "2020-06-05T21:03:27Z", "message": "more YAML test fixes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e25893015e4eb46dabfa64ff0214d3749d761c2f", "author": {"user": {"login": "danhermann", "name": "Dan Hermann"}}, "url": "https://github.com/elastic/elasticsearch/commit/e25893015e4eb46dabfa64ff0214d3749d761c2f", "committedDate": "2020-06-05T21:25:59Z", "message": "more YAML test fixes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3feebe4d59d1e00523bf08266057e48f0a43e6fe", "author": {"user": {"login": "danhermann", "name": "Dan Hermann"}}, "url": "https://github.com/elastic/elasticsearch/commit/3feebe4d59d1e00523bf08266057e48f0a43e6fe", "committedDate": "2020-06-05T22:17:43Z", "message": "another test fix"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "07d8c787c4f65993bdc52929e989ceef8a7a0b94", "author": {"user": {"login": "danhermann", "name": "Dan Hermann"}}, "url": "https://github.com/elastic/elasticsearch/commit/07d8c787c4f65993bdc52929e989ceef8a7a0b94", "committedDate": "2020-06-06T14:59:03Z", "message": "more test fixes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "590b9cf34404222fe71a328b314a6c0f35ceb52d", "author": {"user": {"login": "danhermann", "name": "Dan Hermann"}}, "url": "https://github.com/elastic/elasticsearch/commit/590b9cf34404222fe71a328b314a6c0f35ceb52d", "committedDate": "2020-06-06T16:03:03Z", "message": "docs and test fixes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9fddbf9305e529b21de85731ce594f7a68aefaa0", "author": {"user": {"login": "danhermann", "name": "Dan Hermann"}}, "url": "https://github.com/elastic/elasticsearch/commit/9fddbf9305e529b21de85731ce594f7a68aefaa0", "committedDate": "2020-06-06T16:09:09Z", "message": "more doc fixes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d2ae87ed954383501001b699ec6768b9867d56b7", "author": {"user": {"login": "danhermann", "name": "Dan Hermann"}}, "url": "https://github.com/elastic/elasticsearch/commit/d2ae87ed954383501001b699ec6768b9867d56b7", "committedDate": "2020-06-06T17:14:45Z", "message": "yet more doc fixes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0c803082b7a879324a26d64797d8160d89f092a9", "author": {"user": {"login": "elasticmachine", "name": "Elastic Machine"}}, "url": "https://github.com/elastic/elasticsearch/commit/0c803082b7a879324a26d64797d8160d89f092a9", "committedDate": "2020-06-06T18:22:02Z", "message": "Merge branch 'master' into change_backing_index_names"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9d979dc167b048151ec70783b8259742fe762b92", "author": {"user": {"login": "danhermann", "name": "Dan Hermann"}}, "url": "https://github.com/elastic/elasticsearch/commit/9d979dc167b048151ec70783b8259742fe762b92", "committedDate": "2020-06-06T18:37:35Z", "message": "fix new YAML test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "da2cc2b04b83822b0400cd7603ab14f29e23aec4", "author": {"user": {"login": "danhermann", "name": "Dan Hermann"}}, "url": "https://github.com/elastic/elasticsearch/commit/da2cc2b04b83822b0400cd7603ab14f29e23aec4", "committedDate": "2020-06-06T19:00:30Z", "message": "test fix"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI1ODIzODcx", "url": "https://github.com/elastic/elasticsearch/pull/57721#pullrequestreview-425823871", "createdAt": "2020-06-07T14:14:18Z", "commit": {"oid": "da2cc2b04b83822b0400cd7603ab14f29e23aec4"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wN1QxNDoxNDoxOVrOGgJw8A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wN1QxNDoxODo0NFrOGgJynA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjM2NzYwMA==", "bodyText": "Maybe turn .ds- into a constant?", "url": "https://github.com/elastic/elasticsearch/pull/57721#discussion_r436367600", "createdAt": "2020-06-07T14:14:19Z", "author": {"login": "martijnvg"}, "path": "server/src/main/java/org/elasticsearch/cluster/metadata/DataStream.java", "diffHunk": "@@ -101,15 +101,15 @@ public DataStream removeBackingIndex(Index index) {\n     }\n \n     /**\n-     * Generates the name of the index that conforms to the naming convention for backing indices\n+     * Generates the name of the index that conforms to the default naming convention for backing indices\n      * on data streams given the specified data stream name and generation.\n      *\n      * @param dataStreamName name of the data stream\n      * @param generation generation of the data stream\n      * @return backing index name\n      */\n-    public static String getBackingIndexName(String dataStreamName, long generation) {\n-        return String.format(Locale.ROOT, \"%s-%06d\", dataStreamName, generation);\n+    public static String getDefaultBackingIndexName(String dataStreamName, long generation) {\n+        return String.format(Locale.ROOT, \".ds-%s-%06d\", dataStreamName, generation);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "da2cc2b04b83822b0400cd7603ab14f29e23aec4"}, "originalPosition": 38}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjM2ODAyOA==", "bodyText": "Maybe also add a unit test just for this method? This method is used in many unit / integ tests to validate the naming of backing indices and these tests wouldn't fail if an unintended was made to this method. In later stage the rest or docs test would fail.", "url": "https://github.com/elastic/elasticsearch/pull/57721#discussion_r436368028", "createdAt": "2020-06-07T14:18:44Z", "author": {"login": "martijnvg"}, "path": "server/src/main/java/org/elasticsearch/cluster/metadata/DataStream.java", "diffHunk": "@@ -101,15 +101,15 @@ public DataStream removeBackingIndex(Index index) {\n     }\n \n     /**\n-     * Generates the name of the index that conforms to the naming convention for backing indices\n+     * Generates the name of the index that conforms to the default naming convention for backing indices\n      * on data streams given the specified data stream name and generation.\n      *\n      * @param dataStreamName name of the data stream\n      * @param generation generation of the data stream\n      * @return backing index name\n      */\n-    public static String getBackingIndexName(String dataStreamName, long generation) {\n-        return String.format(Locale.ROOT, \"%s-%06d\", dataStreamName, generation);\n+    public static String getDefaultBackingIndexName(String dataStreamName, long generation) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "da2cc2b04b83822b0400cd7603ab14f29e23aec4"}, "originalPosition": 37}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ec48a9532c979d88b90ffcd8d9f1b50a5175e096", "author": {"user": {"login": "danhermann", "name": "Dan Hermann"}}, "url": "https://github.com/elastic/elasticsearch/commit/ec48a9532c979d88b90ffcd8d9f1b50a5175e096", "committedDate": "2020-06-07T21:45:24Z", "message": "review comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7574e9a8c294cc7a187477206f4f5b90f7f3c65d", "author": {"user": {"login": "danhermann", "name": "Dan Hermann"}}, "url": "https://github.com/elastic/elasticsearch/commit/7574e9a8c294cc7a187477206f4f5b90f7f3c65d", "committedDate": "2020-06-08T12:17:19Z", "message": "Merge branch 'master' into change_backing_index_names"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b68a0c8289610ac2eeb8d11a0184e5d9c76fa48c", "author": {"user": {"login": "danhermann", "name": "Dan Hermann"}}, "url": "https://github.com/elastic/elasticsearch/commit/b68a0c8289610ac2eeb8d11a0184e5d9c76fa48c", "committedDate": "2020-06-08T12:29:42Z", "message": "fix compile error after merge"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "24aed786030854f9b462cdb7af4450b6de200c54", "author": {"user": {"login": "danhermann", "name": "Dan Hermann"}}, "url": "https://github.com/elastic/elasticsearch/commit/24aed786030854f9b462cdb7af4450b6de200c54", "committedDate": "2020-06-08T12:50:57Z", "message": "update validation logic and corresponding tests"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3923, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}