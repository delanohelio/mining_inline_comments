{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTA0NzM3NTM2", "number": 63797, "title": "Nit fixes and formatting following #62490 comments", "bodyText": "Resolves: #63792", "createdAt": "2020-10-16T10:14:13Z", "url": "https://github.com/elastic/elasticsearch/pull/63797", "merged": true, "mergeCommit": {"oid": "2a20bd81626c2fbca2ba34e17dc9e664d0a66804"}, "closed": true, "closedAt": "2020-10-16T15:47:30Z", "author": {"login": "BigPandaToo"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdTDj0TAH2gAyNTA0NzM3NTM2OmUxN2MyODliZThiMDJmNGRkNDhmMTQ2MTkwMzkwNTlhM2IzZDE2NDg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdTHhuTAH2gAyNTA0NzM3NTM2OmE0ZGQ2ZTI5MDM4ZDVlNTNjMGY2MGQ0ZmIwMmZjN2ZjMDFmZmIwYTg=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "e17c289be8b02f4dd48f14619039059a3b3d1648", "author": {"user": {"login": "BigPandaToo", "name": "Lyudmila Fokina"}}, "url": "https://github.com/elastic/elasticsearch/commit/e17c289be8b02f4dd48f14619039059a3b3d1648", "committedDate": "2020-10-16T10:10:38Z", "message": "Nit fixes and formatting following #62490 comments\n\nResolves: #63792"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTEwMzg4Mzkw", "url": "https://github.com/elastic/elasticsearch/pull/63797#pullrequestreview-510388390", "createdAt": "2020-10-16T11:36:06Z", "commit": {"oid": "e17c289be8b02f4dd48f14619039059a3b3d1648"}, "state": "APPROVED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNlQxMTozNjowN1rOHi3h3Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNlQxMTo1Mzo0N1rOHi4X9Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjMyMzQyMQ==", "bodyText": "The format is still incorrect for this section. Other places look good.", "url": "https://github.com/elastic/elasticsearch/pull/63797#discussion_r506323421", "createdAt": "2020-10-16T11:36:07Z", "author": {"login": "ywangd"}, "path": "x-pack/docs/en/rest-api/security/get-tokens.asciidoc", "diffHunk": "@@ -125,21 +125,21 @@ seconds) that the token expires in, and the type:\n   \"type\" : \"Bearer\",\n   \"expires_in\" : 1200,\n   \"authentication\" : {\n-   \"username\" : \"test_admin\",\n-   \"roles\" : [\n-    \"superuser\"\n-   ],\n-  \"full_name\" : null,\n-  \"email\" : null,\n-  \"metadata\" : { },\n-  \"enabled\" : true,\n-  \"authentication_realm\" : {\n-   \"name\" : \"file\",\n-   \"type\" : \"file\"\n-  },\n-  \"lookup_realm\" : {\n-   \"name\" : \"file\",\n-   \"type\" : \"file\"\n+    \"username\" : \"test_admin\",\n+    \"roles\" : [\n+      \"superuser\"\n+    ],\n+    \"full_name\" : null,\n+    \"email\" : null,\n+    \"metadata\" : { },\n+    \"enabled\" : true,\n+    \"authentication_realm\" : {\n+      \"name\" : \"file\",\n+      \"type\" : \"file\"\n+    },\n+    \"lookup_realm\" : {\n+    \"name\" : \"file\",\n+    \"type\" : \"file\"\n   },\n   \"authentication_type\" : \"realm\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e17c289be8b02f4dd48f14619039059a3b3d1648"}, "originalPosition": 35}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjMyOTA5Nw==", "bodyText": "The parameter order of assertEquals should be first \"expected\", then \"actual\", i.e.:\nassertEquals(SecuritySettingsSource.TEST_USER_NAME, response.getAuthentication().getUser().getUsername());", "url": "https://github.com/elastic/elasticsearch/pull/63797#discussion_r506329097", "createdAt": "2020-10-16T11:43:05Z", "author": {"login": "ywangd"}, "path": "x-pack/plugin/security/src/internalClusterTest/java/org/elasticsearch/xpack/security/authc/TokenAuthIntegTests.java", "diffHunk": "@@ -134,7 +134,8 @@ public void testTokenServiceCanRotateKeys() throws Exception {\n             assertNotNull(userTokenFuture.actionGet());\n             assertNotEquals(activeKeyHash, tokenService.getActiveKeyHash());\n         }\n-        assertNotNull(response.getAuthenticationResponse());\n+        assertNotNull(response.getAuthentication());\n+        assertEquals(response.getAuthentication().getUser().getUsername(), SecuritySettingsSource.TEST_USER_NAME);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e17c289be8b02f4dd48f14619039059a3b3d1648"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjMzMTA1NA==", "bodyText": "We should also assert the authentication's principal here for the same reason that there are two credentials involved.\nThis comment also applies to where the authentication object is verified in OpenIdConnectAuthIT and SamlAuthenticationIT, i.e. authentication principal should be checked in those places as well.", "url": "https://github.com/elastic/elasticsearch/pull/63797#discussion_r506331054", "createdAt": "2020-10-16T11:45:28Z", "author": {"login": "ywangd"}, "path": "x-pack/plugin/security/src/internalClusterTest/java/org/elasticsearch/xpack/security/authc/pki/PkiAuthDelegationIntegTests.java", "diffHunk": "@@ -149,7 +149,7 @@ public void testDelegateThenAuthenticate() throws Exception {\n                         optionsBuilder.build());\n                 String token = delegatePkiResponse.getAccessToken();\n                 assertThat(token, is(notNullValue()));\n-                assertNotNull(delegatePkiResponse.getAuthenticationResponse());\n+                assertNotNull(delegatePkiResponse.getAuthentication());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e17c289be8b02f4dd48f14619039059a3b3d1648"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjMzNzI2OQ==", "bodyText": "Can we assert authentication principal here as well? Because this is a refresh response which goes through a different transport action than the token creation with password grant (which is asserted).", "url": "https://github.com/elastic/elasticsearch/pull/63797#discussion_r506337269", "createdAt": "2020-10-16T11:53:47Z", "author": {"login": "ywangd"}, "path": "x-pack/plugin/security/src/internalClusterTest/java/org/elasticsearch/xpack/security/authc/TokenAuthIntegTests.java", "diffHunk": "@@ -367,7 +368,7 @@ public void testRefreshingToken() throws IOException {\n \n         // Assert that we can authenticate with the refreshed access token\n         assertAuthenticateWithToken(refreshResponse.getAccessToken(), SecuritySettingsSource.TEST_USER_NAME);\n-        assertNotNull(refreshResponse.getAuthenticationResponse());\n+        assertNotNull(refreshResponse.getAuthentication());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e17c289be8b02f4dd48f14619039059a3b3d1648"}, "originalPosition": 31}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bc2758967ce4ba5085145b0a048d0911cc612704", "author": {"user": {"login": "BigPandaToo", "name": "Lyudmila Fokina"}}, "url": "https://github.com/elastic/elasticsearch/commit/bc2758967ce4ba5085145b0a048d0911cc612704", "committedDate": "2020-10-16T12:49:58Z", "message": "Nit fixes and formatting following #62490 comments\n\nResolves: #63792"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTEwNDQwMzEx", "url": "https://github.com/elastic/elasticsearch/pull/63797#pullrequestreview-510440311", "createdAt": "2020-10-16T12:54:43Z", "commit": {"oid": "bc2758967ce4ba5085145b0a048d0911cc612704"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNlQxMjo1NDo0M1rOHi7QUQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNlQxMjo1NDo0M1rOHi7QUQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjM4NDQ2NQ==", "bodyText": "These two lines are still not aligned.", "url": "https://github.com/elastic/elasticsearch/pull/63797#discussion_r506384465", "createdAt": "2020-10-16T12:54:43Z", "author": {"login": "ywangd"}, "path": "x-pack/docs/en/rest-api/security/get-tokens.asciidoc", "diffHunk": "@@ -125,21 +125,21 @@ seconds) that the token expires in, and the type:\n   \"type\" : \"Bearer\",\n   \"expires_in\" : 1200,\n   \"authentication\" : {\n-   \"username\" : \"test_admin\",\n-   \"roles\" : [\n-    \"superuser\"\n-   ],\n-  \"full_name\" : null,\n-  \"email\" : null,\n-  \"metadata\" : { },\n-  \"enabled\" : true,\n-  \"authentication_realm\" : {\n-   \"name\" : \"file\",\n-   \"type\" : \"file\"\n-  },\n-  \"lookup_realm\" : {\n-   \"name\" : \"file\",\n-   \"type\" : \"file\"\n+    \"username\" : \"test_admin\",\n+    \"roles\" : [\n+      \"superuser\"\n+    ],\n+    \"full_name\" : null,\n+    \"email\" : null,\n+    \"metadata\" : { },\n+    \"enabled\" : true,\n+    \"authentication_realm\" : {\n+      \"name\" : \"file\",\n+      \"type\" : \"file\"\n+    },\n+    \"lookup_realm\" : {\n+      \"name\" : \"file\",\n+      \"type\" : \"file\"\n   },\n   \"authentication_type\" : \"realm\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bc2758967ce4ba5085145b0a048d0911cc612704"}, "originalPosition": 35}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7dd0839723119b32891d4b5e0599c9d09ad81c87", "author": {"user": {"login": "BigPandaToo", "name": "Lyudmila Fokina"}}, "url": "https://github.com/elastic/elasticsearch/commit/7dd0839723119b32891d4b5e0599c9d09ad81c87", "committedDate": "2020-10-16T13:41:20Z", "message": "Nit fixes and formatting following #62490 comments\nFixing username"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a4dd6e29038d5e53c0f60d4fb02fc7fc01ffb0a8", "author": {"user": {"login": "BigPandaToo", "name": "Lyudmila Fokina"}}, "url": "https://github.com/elastic/elasticsearch/commit/a4dd6e29038d5e53c0f60d4fb02fc7fc01ffb0a8", "committedDate": "2020-10-16T14:47:58Z", "message": "Nit fixes and formatting following #62490 comments\nFixing formatting"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3874, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}