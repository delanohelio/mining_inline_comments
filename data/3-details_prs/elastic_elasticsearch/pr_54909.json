{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDAwMzk0Mzk2", "number": 54909, "title": "ILM use Priority.IMMEDIATE for stop ILM cluster update", "bodyText": "This changes the priority of the cluster state update that stops ILM\naltogether to IMMEDIATE. We've chosen to change this as it can be useful to\ntemporarily stop ILM if a cluster is overwhelmed, but a NORMAL\npriority can see the \"stop ilm update\" not make it up the tasks queue.\nOn the same note, we're keeping the start ILM cluster update priority\nto NORMAL on purpose such that we only start ILM if the cluster can\nhandle it.", "createdAt": "2020-04-07T17:08:09Z", "url": "https://github.com/elastic/elasticsearch/pull/54909", "merged": true, "mergeCommit": {"oid": "d67df3a7cd2a8619c2c9efac4dde3ba83271f2fa"}, "closed": true, "closedAt": "2020-04-08T15:40:02Z", "author": {"login": "andreidan"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcVWbvNAH2gAyNDAwMzk0Mzk2OjFkYzE4YTYzOWMwNjE2MDA5OGQ2ZjkwYzIxYzNjZDM2MjMwMzIwYjM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcVpK-LgFqTM5MDA1NTEyOA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "1dc18a639c06160098d6f90c21c3cd36230320b3", "author": {"user": {"login": "andreidan", "name": "Andrei Dan"}}, "url": "https://github.com/elastic/elasticsearch/commit/1dc18a639c06160098d6f90c21c3cd36230320b3", "committedDate": "2020-04-07T17:06:42Z", "message": "ILM use Priority.URGENT for stop ILM cluster update\n\nThis changes the priority of the cluster state update that stops ILM\naltogether to `URGENT`. We've chosen to change this as it can be useful to\ntemporarily stop ILM if a cluster is overwhelemed, but a `NORMAL`\npriority can see the \"stop ilm update\" not make it up the tasks queue.\n\nOn the same note, we're keeping the `start ILM` cluster update priority\nto `NORMAL` on purpose such that we only start `ILM` if the cluster can\nhandle it."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6d6aadefd74d1dacbc08ff6ee629eaeee911dd60", "author": {"user": {"login": "elasticmachine", "name": "Elastic Machine"}}, "url": "https://github.com/elastic/elasticsearch/commit/6d6aadefd74d1dacbc08ff6ee629eaeee911dd60", "committedDate": "2020-04-07T17:08:27Z", "message": "Merge branch 'master' into stop-ilm-cluster-update-priority"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg5MzI2NTYx", "url": "https://github.com/elastic/elasticsearch/pull/54909#pullrequestreview-389326561", "createdAt": "2020-04-07T17:15:07Z", "commit": {"oid": "6d6aadefd74d1dacbc08ff6ee629eaeee911dd60"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wN1QxNzoxNTowN1rOGCN4IQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wN1QxNzoxNTowN1rOGCN4IQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDk3NzY5Nw==", "bodyText": "This also needs to change the cluster state update on line 366 of IndexLifecycleService (submitOperationModeUpdate), that is the second half that moves the state from STOPPING -> STOPPED", "url": "https://github.com/elastic/elasticsearch/pull/54909#discussion_r404977697", "createdAt": "2020-04-07T17:15:07Z", "author": {"login": "dakrone"}, "path": "x-pack/plugin/ilm/src/main/java/org/elasticsearch/xpack/ilm/action/TransportStopILMAction.java", "diffHunk": "@@ -50,7 +51,8 @@ protected AcknowledgedResponse read(StreamInput in) throws IOException {\n     @Override\n     protected void masterOperation(Task task, StopILMRequest request, ClusterState state, ActionListener<AcknowledgedResponse> listener) {\n         clusterService.submitStateUpdateTask(\"ilm_operation_mode_update\",\n-                new AckedClusterStateUpdateTask<AcknowledgedResponse>(request, listener) {\n+                new AckedClusterStateUpdateTask<AcknowledgedResponse>(Priority.URGENT, request, listener) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6d6aadefd74d1dacbc08ff6ee629eaeee911dd60"}, "originalPosition": 13}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "791e6027bf58d71ac3853efd4279812362f876bb", "author": {"user": {"login": "andreidan", "name": "Andrei Dan"}}, "url": "https://github.com/elastic/elasticsearch/commit/791e6027bf58d71ac3853efd4279812362f876bb", "committedDate": "2020-04-08T08:49:40Z", "message": "ILM Make STOPPED cluster updates URGENT"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fc6c65fd2ca28cba962c83c95ff6c2abeb203a8c", "author": {"user": {"login": "andreidan", "name": "Andrei Dan"}}, "url": "https://github.com/elastic/elasticsearch/commit/fc6c65fd2ca28cba962c83c95ff6c2abeb203a8c", "committedDate": "2020-04-08T09:30:06Z", "message": "Fix tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "04b08eb5f8dfafd14c2ebb9e8997a175152d6146", "author": {"user": {"login": "andreidan", "name": "Andrei Dan"}}, "url": "https://github.com/elastic/elasticsearch/commit/04b08eb5f8dfafd14c2ebb9e8997a175152d6146", "committedDate": "2020-04-08T12:03:39Z", "message": "Make stop ILM updates run at IMMEDIATE priority"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkwMDU1MTI4", "url": "https://github.com/elastic/elasticsearch/pull/54909#pullrequestreview-390055128", "createdAt": "2020-04-08T14:56:35Z", "commit": {"oid": "04b08eb5f8dfafd14c2ebb9e8997a175152d6146"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3558, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}