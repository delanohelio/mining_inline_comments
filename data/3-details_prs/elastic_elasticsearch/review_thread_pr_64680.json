{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE2NDIyMjg4", "number": 64680, "reviewThreads": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wOVQxNzo0NzoyMVrOE24ZKg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQxOTo0MToxMFrOE3Yn7Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI1OTgyNTA2OnYy", "diffSide": "RIGHT", "path": "server/src/main/java/org/elasticsearch/cluster/metadata/RollupGroup.java", "isResolved": true, "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wOVQxNzo0NzoyMlrOHv6aVg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wOVQyMDoxNjo0NVrOHv__5A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDAwMjEzNA==", "bodyText": "Why are we using String here instead of (e.g.) ZoneId?  And also for the date, why is that just a string?  Also also, if we're reading the dates in as strings, do we also need a date format?  What formats are supported?", "url": "https://github.com/elastic/elasticsearch/pull/64680#discussion_r520002134", "createdAt": "2020-11-09T17:47:22Z", "author": {"login": "not-napoleon"}, "path": "server/src/main/java/org/elasticsearch/cluster/metadata/RollupGroup.java", "diffHunk": "@@ -0,0 +1,155 @@\n+/*\n+ * Licensed to Elasticsearch under one or more contributor\n+ * license agreements. See the NOTICE file distributed with\n+ * this work for additional information regarding copyright\n+ * ownership. Elasticsearch licenses this file to you under\n+ * the Apache License, Version 2.0 (the \"License\"); you may\n+ * not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *    http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.elasticsearch.cluster.metadata;\n+\n+import org.elasticsearch.cluster.AbstractDiffable;\n+import org.elasticsearch.cluster.Diff;\n+import org.elasticsearch.common.ParseField;\n+import org.elasticsearch.common.Strings;\n+import org.elasticsearch.common.io.stream.StreamInput;\n+import org.elasticsearch.common.io.stream.StreamOutput;\n+import org.elasticsearch.common.xcontent.ConstructingObjectParser;\n+import org.elasticsearch.common.xcontent.ToXContentObject;\n+import org.elasticsearch.common.xcontent.XContentBuilder;\n+import org.elasticsearch.common.xcontent.XContentParser;\n+\n+import java.io.IOException;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Objects;\n+\n+/**\n+ * Object representing information about rollup-v2 indices and their respective original-indexes. These objects\n+ * also include information about their capabilities, like which date-intervals and date-timezones they are configured\n+ * with. Used by {@link RollupMetadata}.\n+ */\n+public class RollupGroup extends AbstractDiffable<RollupGroup> implements ToXContentObject {\n+    private static final ParseField GROUP_FIELD = new ParseField(\"group\");\n+    private static final ParseField DATE_INTERVAL_FIELD = new ParseField(\"interval\");\n+    private static final ParseField DATE_TIMEZONE_FIELD = new ParseField(\"timezone\");\n+\n+    // the list of indices part of this rollup group\n+    private List<String> group;\n+    // a map from index-name to the date interval used in the associated index\n+    private Map<String, String> dateInterval;\n+    // a map from index-name to timezone used in the associated index\n+    private Map<String, String> dateTimezone;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d2871315cf142bbbe1a30739934c28169aa5ddec"}, "originalPosition": 53}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDAyMjgwMQ==", "bodyText": "I can wrap ZoneId for sure. ZoneId itself cannot be used because it is not Writeable", "url": "https://github.com/elastic/elasticsearch/pull/64680#discussion_r520022801", "createdAt": "2020-11-09T18:21:45Z", "author": {"login": "talevy"}, "path": "server/src/main/java/org/elasticsearch/cluster/metadata/RollupGroup.java", "diffHunk": "@@ -0,0 +1,155 @@\n+/*\n+ * Licensed to Elasticsearch under one or more contributor\n+ * license agreements. See the NOTICE file distributed with\n+ * this work for additional information regarding copyright\n+ * ownership. Elasticsearch licenses this file to you under\n+ * the Apache License, Version 2.0 (the \"License\"); you may\n+ * not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *    http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.elasticsearch.cluster.metadata;\n+\n+import org.elasticsearch.cluster.AbstractDiffable;\n+import org.elasticsearch.cluster.Diff;\n+import org.elasticsearch.common.ParseField;\n+import org.elasticsearch.common.Strings;\n+import org.elasticsearch.common.io.stream.StreamInput;\n+import org.elasticsearch.common.io.stream.StreamOutput;\n+import org.elasticsearch.common.xcontent.ConstructingObjectParser;\n+import org.elasticsearch.common.xcontent.ToXContentObject;\n+import org.elasticsearch.common.xcontent.XContentBuilder;\n+import org.elasticsearch.common.xcontent.XContentParser;\n+\n+import java.io.IOException;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Objects;\n+\n+/**\n+ * Object representing information about rollup-v2 indices and their respective original-indexes. These objects\n+ * also include information about their capabilities, like which date-intervals and date-timezones they are configured\n+ * with. Used by {@link RollupMetadata}.\n+ */\n+public class RollupGroup extends AbstractDiffable<RollupGroup> implements ToXContentObject {\n+    private static final ParseField GROUP_FIELD = new ParseField(\"group\");\n+    private static final ParseField DATE_INTERVAL_FIELD = new ParseField(\"interval\");\n+    private static final ParseField DATE_TIMEZONE_FIELD = new ParseField(\"timezone\");\n+\n+    // the list of indices part of this rollup group\n+    private List<String> group;\n+    // a map from index-name to the date interval used in the associated index\n+    private Map<String, String> dateInterval;\n+    // a map from index-name to timezone used in the associated index\n+    private Map<String, String> dateTimezone;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDAwMjEzNA=="}, "originalCommit": {"oid": "d2871315cf142bbbe1a30739934c28169aa5ddec"}, "originalPosition": 53}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDAzMzE3NQ==", "bodyText": "Yeah, I was thinking for the internal usage, not for the serialization/deserialization layer", "url": "https://github.com/elastic/elasticsearch/pull/64680#discussion_r520033175", "createdAt": "2020-11-09T18:39:55Z", "author": {"login": "not-napoleon"}, "path": "server/src/main/java/org/elasticsearch/cluster/metadata/RollupGroup.java", "diffHunk": "@@ -0,0 +1,155 @@\n+/*\n+ * Licensed to Elasticsearch under one or more contributor\n+ * license agreements. See the NOTICE file distributed with\n+ * this work for additional information regarding copyright\n+ * ownership. Elasticsearch licenses this file to you under\n+ * the Apache License, Version 2.0 (the \"License\"); you may\n+ * not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *    http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.elasticsearch.cluster.metadata;\n+\n+import org.elasticsearch.cluster.AbstractDiffable;\n+import org.elasticsearch.cluster.Diff;\n+import org.elasticsearch.common.ParseField;\n+import org.elasticsearch.common.Strings;\n+import org.elasticsearch.common.io.stream.StreamInput;\n+import org.elasticsearch.common.io.stream.StreamOutput;\n+import org.elasticsearch.common.xcontent.ConstructingObjectParser;\n+import org.elasticsearch.common.xcontent.ToXContentObject;\n+import org.elasticsearch.common.xcontent.XContentBuilder;\n+import org.elasticsearch.common.xcontent.XContentParser;\n+\n+import java.io.IOException;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Objects;\n+\n+/**\n+ * Object representing information about rollup-v2 indices and their respective original-indexes. These objects\n+ * also include information about their capabilities, like which date-intervals and date-timezones they are configured\n+ * with. Used by {@link RollupMetadata}.\n+ */\n+public class RollupGroup extends AbstractDiffable<RollupGroup> implements ToXContentObject {\n+    private static final ParseField GROUP_FIELD = new ParseField(\"group\");\n+    private static final ParseField DATE_INTERVAL_FIELD = new ParseField(\"interval\");\n+    private static final ParseField DATE_TIMEZONE_FIELD = new ParseField(\"timezone\");\n+\n+    // the list of indices part of this rollup group\n+    private List<String> group;\n+    // a map from index-name to the date interval used in the associated index\n+    private Map<String, String> dateInterval;\n+    // a map from index-name to timezone used in the associated index\n+    private Map<String, String> dateTimezone;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDAwMjEzNA=="}, "originalCommit": {"oid": "d2871315cf142bbbe1a30739934c28169aa5ddec"}, "originalPosition": 53}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDA0NjIzMg==", "bodyText": "got it, I'd prefer if it were a simple object that serialized and was not a concern of this class. So I'll try making a thin Writeable wrapper for ZoneId and others. Let me know if you think that is overkill and the String->Obj conversion should occur within this class to reduce extra class hierarchies. I see both sides, but lean towards wrapping.", "url": "https://github.com/elastic/elasticsearch/pull/64680#discussion_r520046232", "createdAt": "2020-11-09T19:01:16Z", "author": {"login": "talevy"}, "path": "server/src/main/java/org/elasticsearch/cluster/metadata/RollupGroup.java", "diffHunk": "@@ -0,0 +1,155 @@\n+/*\n+ * Licensed to Elasticsearch under one or more contributor\n+ * license agreements. See the NOTICE file distributed with\n+ * this work for additional information regarding copyright\n+ * ownership. Elasticsearch licenses this file to you under\n+ * the Apache License, Version 2.0 (the \"License\"); you may\n+ * not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *    http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.elasticsearch.cluster.metadata;\n+\n+import org.elasticsearch.cluster.AbstractDiffable;\n+import org.elasticsearch.cluster.Diff;\n+import org.elasticsearch.common.ParseField;\n+import org.elasticsearch.common.Strings;\n+import org.elasticsearch.common.io.stream.StreamInput;\n+import org.elasticsearch.common.io.stream.StreamOutput;\n+import org.elasticsearch.common.xcontent.ConstructingObjectParser;\n+import org.elasticsearch.common.xcontent.ToXContentObject;\n+import org.elasticsearch.common.xcontent.XContentBuilder;\n+import org.elasticsearch.common.xcontent.XContentParser;\n+\n+import java.io.IOException;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Objects;\n+\n+/**\n+ * Object representing information about rollup-v2 indices and their respective original-indexes. These objects\n+ * also include information about their capabilities, like which date-intervals and date-timezones they are configured\n+ * with. Used by {@link RollupMetadata}.\n+ */\n+public class RollupGroup extends AbstractDiffable<RollupGroup> implements ToXContentObject {\n+    private static final ParseField GROUP_FIELD = new ParseField(\"group\");\n+    private static final ParseField DATE_INTERVAL_FIELD = new ParseField(\"interval\");\n+    private static final ParseField DATE_TIMEZONE_FIELD = new ParseField(\"timezone\");\n+\n+    // the list of indices part of this rollup group\n+    private List<String> group;\n+    // a map from index-name to the date interval used in the associated index\n+    private Map<String, String> dateInterval;\n+    // a map from index-name to timezone used in the associated index\n+    private Map<String, String> dateTimezone;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDAwMjEzNA=="}, "originalCommit": {"oid": "d2871315cf142bbbe1a30739934c28169aa5ddec"}, "originalPosition": 53}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDA5MzY2OA==", "bodyText": "Making it not this class's problem seems sensible.  What I want is for it not to be the problem of clients of this class either.  I think a wrapper solves both, and actually I'm a little surprised we haven't needed one already.  I think that's got my vote.  I'd also be okay with leaving it as a ToDo for now, since it doesn't look like anything is reading these values yet?", "url": "https://github.com/elastic/elasticsearch/pull/64680#discussion_r520093668", "createdAt": "2020-11-09T20:16:45Z", "author": {"login": "not-napoleon"}, "path": "server/src/main/java/org/elasticsearch/cluster/metadata/RollupGroup.java", "diffHunk": "@@ -0,0 +1,155 @@\n+/*\n+ * Licensed to Elasticsearch under one or more contributor\n+ * license agreements. See the NOTICE file distributed with\n+ * this work for additional information regarding copyright\n+ * ownership. Elasticsearch licenses this file to you under\n+ * the Apache License, Version 2.0 (the \"License\"); you may\n+ * not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *    http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.elasticsearch.cluster.metadata;\n+\n+import org.elasticsearch.cluster.AbstractDiffable;\n+import org.elasticsearch.cluster.Diff;\n+import org.elasticsearch.common.ParseField;\n+import org.elasticsearch.common.Strings;\n+import org.elasticsearch.common.io.stream.StreamInput;\n+import org.elasticsearch.common.io.stream.StreamOutput;\n+import org.elasticsearch.common.xcontent.ConstructingObjectParser;\n+import org.elasticsearch.common.xcontent.ToXContentObject;\n+import org.elasticsearch.common.xcontent.XContentBuilder;\n+import org.elasticsearch.common.xcontent.XContentParser;\n+\n+import java.io.IOException;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Objects;\n+\n+/**\n+ * Object representing information about rollup-v2 indices and their respective original-indexes. These objects\n+ * also include information about their capabilities, like which date-intervals and date-timezones they are configured\n+ * with. Used by {@link RollupMetadata}.\n+ */\n+public class RollupGroup extends AbstractDiffable<RollupGroup> implements ToXContentObject {\n+    private static final ParseField GROUP_FIELD = new ParseField(\"group\");\n+    private static final ParseField DATE_INTERVAL_FIELD = new ParseField(\"interval\");\n+    private static final ParseField DATE_TIMEZONE_FIELD = new ParseField(\"timezone\");\n+\n+    // the list of indices part of this rollup group\n+    private List<String> group;\n+    // a map from index-name to the date interval used in the associated index\n+    private Map<String, String> dateInterval;\n+    // a map from index-name to timezone used in the associated index\n+    private Map<String, String> dateTimezone;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDAwMjEzNA=="}, "originalCommit": {"oid": "d2871315cf142bbbe1a30739934c28169aa5ddec"}, "originalPosition": 53}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI1OTkxMTM4OnYy", "diffSide": "RIGHT", "path": "server/src/main/java/org/elasticsearch/cluster/metadata/RollupGroup.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wOVQxODowOToyOFrOHv7PIA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wOVQxODoyMjowNVrOHv7r4A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDAxNTY0OA==", "bodyText": "An example of how this is used would help.  For example, I don't think it's clear why we need a time zone per input index.", "url": "https://github.com/elastic/elasticsearch/pull/64680#discussion_r520015648", "createdAt": "2020-11-09T18:09:28Z", "author": {"login": "not-napoleon"}, "path": "server/src/main/java/org/elasticsearch/cluster/metadata/RollupGroup.java", "diffHunk": "@@ -0,0 +1,155 @@\n+/*\n+ * Licensed to Elasticsearch under one or more contributor\n+ * license agreements. See the NOTICE file distributed with\n+ * this work for additional information regarding copyright\n+ * ownership. Elasticsearch licenses this file to you under\n+ * the Apache License, Version 2.0 (the \"License\"); you may\n+ * not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *    http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.elasticsearch.cluster.metadata;\n+\n+import org.elasticsearch.cluster.AbstractDiffable;\n+import org.elasticsearch.cluster.Diff;\n+import org.elasticsearch.common.ParseField;\n+import org.elasticsearch.common.Strings;\n+import org.elasticsearch.common.io.stream.StreamInput;\n+import org.elasticsearch.common.io.stream.StreamOutput;\n+import org.elasticsearch.common.xcontent.ConstructingObjectParser;\n+import org.elasticsearch.common.xcontent.ToXContentObject;\n+import org.elasticsearch.common.xcontent.XContentBuilder;\n+import org.elasticsearch.common.xcontent.XContentParser;\n+\n+import java.io.IOException;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Objects;\n+\n+/**\n+ * Object representing information about rollup-v2 indices and their respective original-indexes. These objects\n+ * also include information about their capabilities, like which date-intervals and date-timezones they are configured\n+ * with. Used by {@link RollupMetadata}.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d2871315cf142bbbe1a30739934c28169aa5ddec"}, "originalPosition": 41}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDAyMzAwOA==", "bodyText": "++ will add example usage in the javadoc.", "url": "https://github.com/elastic/elasticsearch/pull/64680#discussion_r520023008", "createdAt": "2020-11-09T18:22:05Z", "author": {"login": "talevy"}, "path": "server/src/main/java/org/elasticsearch/cluster/metadata/RollupGroup.java", "diffHunk": "@@ -0,0 +1,155 @@\n+/*\n+ * Licensed to Elasticsearch under one or more contributor\n+ * license agreements. See the NOTICE file distributed with\n+ * this work for additional information regarding copyright\n+ * ownership. Elasticsearch licenses this file to you under\n+ * the Apache License, Version 2.0 (the \"License\"); you may\n+ * not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *    http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.elasticsearch.cluster.metadata;\n+\n+import org.elasticsearch.cluster.AbstractDiffable;\n+import org.elasticsearch.cluster.Diff;\n+import org.elasticsearch.common.ParseField;\n+import org.elasticsearch.common.Strings;\n+import org.elasticsearch.common.io.stream.StreamInput;\n+import org.elasticsearch.common.io.stream.StreamOutput;\n+import org.elasticsearch.common.xcontent.ConstructingObjectParser;\n+import org.elasticsearch.common.xcontent.ToXContentObject;\n+import org.elasticsearch.common.xcontent.XContentBuilder;\n+import org.elasticsearch.common.xcontent.XContentParser;\n+\n+import java.io.IOException;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Objects;\n+\n+/**\n+ * Object representing information about rollup-v2 indices and their respective original-indexes. These objects\n+ * also include information about their capabilities, like which date-intervals and date-timezones they are configured\n+ * with. Used by {@link RollupMetadata}.", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDAxNTY0OA=="}, "originalCommit": {"oid": "d2871315cf142bbbe1a30739934c28169aa5ddec"}, "originalPosition": 41}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI1OTkxODYyOnYy", "diffSide": "RIGHT", "path": "server/src/main/java/org/elasticsearch/rollup/RollupV2.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wOVQxODoxMToyMVrOHv7Tnw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wOVQxODoyMjo1MFrOHv7trA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDAxNjc5OQ==", "bodyText": "Shouldn't we just default to false for now?  Is there a benefit for making this nullable throughout the code?", "url": "https://github.com/elastic/elasticsearch/pull/64680#discussion_r520016799", "createdAt": "2020-11-09T18:11:21Z", "author": {"login": "not-napoleon"}, "path": "server/src/main/java/org/elasticsearch/rollup/RollupV2.java", "diffHunk": "@@ -0,0 +1,44 @@\n+/*\n+ * Licensed to Elasticsearch under one or more contributor\n+ * license agreements. See the NOTICE file distributed with\n+ * this work for additional information regarding copyright\n+ * ownership. Elasticsearch licenses this file to you under\n+ * the Apache License, Version 2.0 (the \"License\"); you may\n+ * not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.elasticsearch.rollup;\n+\n+import org.elasticsearch.Build;\n+\n+public class RollupV2 {\n+    public static final Boolean ROLLUPV2_FEATURE_FLAG_REGISTERED;\n+\n+    static {\n+        final String property = System.getProperty(\"es.rollupv2_feature_flag_registered\");\n+        if (Build.CURRENT.isSnapshot() && property != null) {\n+            throw new IllegalArgumentException(\"es.rollupv2_feature_flag_registered is only supported in non-snapshot builds\");\n+        }\n+        if (\"true\".equals(property)) {\n+            ROLLUPV2_FEATURE_FLAG_REGISTERED = true;\n+        } else if (\"false\".equals(property)) {\n+            ROLLUPV2_FEATURE_FLAG_REGISTERED = false;\n+        } else if (property == null) {\n+            ROLLUPV2_FEATURE_FLAG_REGISTERED = null;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d2871315cf142bbbe1a30739934c28169aa5ddec"}, "originalPosition": 37}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDAyMzQ2OA==", "bodyText": "Unclear. I kind of chose the \"keep feature-flag behavior consistent\" route. Instead of asking which is better, I decided to just follow the same pattern that was used by Autoscaling", "url": "https://github.com/elastic/elasticsearch/pull/64680#discussion_r520023468", "createdAt": "2020-11-09T18:22:50Z", "author": {"login": "talevy"}, "path": "server/src/main/java/org/elasticsearch/rollup/RollupV2.java", "diffHunk": "@@ -0,0 +1,44 @@\n+/*\n+ * Licensed to Elasticsearch under one or more contributor\n+ * license agreements. See the NOTICE file distributed with\n+ * this work for additional information regarding copyright\n+ * ownership. Elasticsearch licenses this file to you under\n+ * the Apache License, Version 2.0 (the \"License\"); you may\n+ * not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.elasticsearch.rollup;\n+\n+import org.elasticsearch.Build;\n+\n+public class RollupV2 {\n+    public static final Boolean ROLLUPV2_FEATURE_FLAG_REGISTERED;\n+\n+    static {\n+        final String property = System.getProperty(\"es.rollupv2_feature_flag_registered\");\n+        if (Build.CURRENT.isSnapshot() && property != null) {\n+            throw new IllegalArgumentException(\"es.rollupv2_feature_flag_registered is only supported in non-snapshot builds\");\n+        }\n+        if (\"true\".equals(property)) {\n+            ROLLUPV2_FEATURE_FLAG_REGISTERED = true;\n+        } else if (\"false\".equals(property)) {\n+            ROLLUPV2_FEATURE_FLAG_REGISTERED = false;\n+        } else if (property == null) {\n+            ROLLUPV2_FEATURE_FLAG_REGISTERED = null;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDAxNjc5OQ=="}, "originalCommit": {"oid": "d2871315cf142bbbe1a30739934c28169aa5ddec"}, "originalPosition": 37}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI2MzU4MTkwOnYy", "diffSide": "RIGHT", "path": "server/src/main/java/org/elasticsearch/cluster/metadata/RollupGroup.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQxNDowMTowOFrOHwd4ww==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQxNDowMTowOFrOHwd4ww==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDU4MzM2Mw==", "bodyText": "Example helps a lot, thank you!", "url": "https://github.com/elastic/elasticsearch/pull/64680#discussion_r520583363", "createdAt": "2020-11-10T14:01:08Z", "author": {"login": "not-napoleon"}, "path": "server/src/main/java/org/elasticsearch/cluster/metadata/RollupGroup.java", "diffHunk": "@@ -0,0 +1,182 @@\n+/*\n+ * Licensed to Elasticsearch under one or more contributor\n+ * license agreements. See the NOTICE file distributed with\n+ * this work for additional information regarding copyright\n+ * ownership. Elasticsearch licenses this file to you under\n+ * the Apache License, Version 2.0 (the \"License\"); you may\n+ * not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *    http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.elasticsearch.cluster.metadata;\n+\n+import org.elasticsearch.cluster.AbstractDiffable;\n+import org.elasticsearch.cluster.Diff;\n+import org.elasticsearch.common.ParseField;\n+import org.elasticsearch.common.Strings;\n+import org.elasticsearch.common.io.stream.StreamInput;\n+import org.elasticsearch.common.io.stream.StreamOutput;\n+import org.elasticsearch.common.time.WriteableZoneId;\n+import org.elasticsearch.common.xcontent.ConstructingObjectParser;\n+import org.elasticsearch.common.xcontent.ToXContentObject;\n+import org.elasticsearch.common.xcontent.XContentBuilder;\n+import org.elasticsearch.common.xcontent.XContentParser;\n+import org.elasticsearch.search.aggregations.bucket.histogram.DateHistogramInterval;\n+\n+import java.io.IOException;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Objects;\n+\n+/**\n+ * Object representing information about rollup-v2 indices and their respective original-indexes. These objects\n+ * also include information about their capabilities, like which date-intervals and date-timezones they are configured\n+ * with. Used by {@link RollupMetadata}.\n+ *\n+ * The information in this class will be used to decide which index within the <code>group</code> will be chosen\n+ * for a specific aggregation. For example, if there are two indices with different intervals (`1h`, `1d`) and\n+ * a date-histogram aggregation request is sent for daily intervals, then the index with the associated `1d` interval\n+ * will be chosen.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "376edee3c2e7b5563b6ee774a7a4df5873213a51"}, "originalPosition": 49}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI2MzU5MzA5OnYy", "diffSide": "RIGHT", "path": "server/src/main/java/org/elasticsearch/common/time/WriteableZoneId.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQxNDowMzo1M1rOHwd_4A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQxNDowMzo1M1rOHwd_4A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDU4NTE4NA==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n             * Simple wrapper around {@link ZoneId} so that it can be\n          \n          \n            \n             * Simple wrapper around {@link ZoneId} so that it can be written to XContent", "url": "https://github.com/elastic/elasticsearch/pull/64680#discussion_r520585184", "createdAt": "2020-11-10T14:03:53Z", "author": {"login": "not-napoleon"}, "path": "server/src/main/java/org/elasticsearch/common/time/WriteableZoneId.java", "diffHunk": "@@ -0,0 +1,83 @@\n+/*\n+ * Licensed to Elasticsearch under one or more contributor\n+ * license agreements. See the NOTICE file distributed with\n+ * this work for additional information regarding copyright\n+ * ownership. Elasticsearch licenses this file to you under\n+ * the Apache License, Version 2.0 (the \"License\"); you may\n+ * not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *    http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.elasticsearch.common.time;\n+\n+\n+import org.elasticsearch.common.io.stream.StreamInput;\n+import org.elasticsearch.common.io.stream.StreamOutput;\n+import org.elasticsearch.common.io.stream.Writeable;\n+import org.elasticsearch.common.xcontent.ToXContentFragment;\n+import org.elasticsearch.common.xcontent.XContentBuilder;\n+\n+import java.io.IOException;\n+import java.time.ZoneId;\n+import java.util.Objects;\n+\n+/**\n+ * Simple wrapper around {@link ZoneId} so that it can be", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "376edee3c2e7b5563b6ee774a7a4df5873213a51"}, "originalPosition": 34}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI2NTEwNTczOnYy", "diffSide": "RIGHT", "path": "server/src/main/java/org/elasticsearch/cluster/metadata/RollupGroup.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQxOTo0MToxMFrOHwszRA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQxOTo0NDowN1rOHws6KA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDgyNzcxNg==", "bodyText": "Can we condense this down to maybe just one map with a value that holds the interval and the time zone?", "url": "https://github.com/elastic/elasticsearch/pull/64680#discussion_r520827716", "createdAt": "2020-11-10T19:41:10Z", "author": {"login": "not-napoleon"}, "path": "server/src/main/java/org/elasticsearch/cluster/metadata/RollupGroup.java", "diffHunk": "@@ -0,0 +1,182 @@\n+/*\n+ * Licensed to Elasticsearch under one or more contributor\n+ * license agreements. See the NOTICE file distributed with\n+ * this work for additional information regarding copyright\n+ * ownership. Elasticsearch licenses this file to you under\n+ * the Apache License, Version 2.0 (the \"License\"); you may\n+ * not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *    http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.elasticsearch.cluster.metadata;\n+\n+import org.elasticsearch.cluster.AbstractDiffable;\n+import org.elasticsearch.cluster.Diff;\n+import org.elasticsearch.common.ParseField;\n+import org.elasticsearch.common.Strings;\n+import org.elasticsearch.common.io.stream.StreamInput;\n+import org.elasticsearch.common.io.stream.StreamOutput;\n+import org.elasticsearch.common.time.WriteableZoneId;\n+import org.elasticsearch.common.xcontent.ConstructingObjectParser;\n+import org.elasticsearch.common.xcontent.ToXContentObject;\n+import org.elasticsearch.common.xcontent.XContentBuilder;\n+import org.elasticsearch.common.xcontent.XContentParser;\n+import org.elasticsearch.search.aggregations.bucket.histogram.DateHistogramInterval;\n+\n+import java.io.IOException;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Objects;\n+\n+/**\n+ * Object representing information about rollup-v2 indices and their respective original-indexes. These objects\n+ * also include information about their capabilities, like which date-intervals and date-timezones they are configured\n+ * with. Used by {@link RollupMetadata}.\n+ *\n+ * The information in this class will be used to decide which index within the <code>group</code> will be chosen\n+ * for a specific aggregation. For example, if there are two indices with different intervals (`1h`, `1d`) and\n+ * a date-histogram aggregation request is sent for daily intervals, then the index with the associated `1d` interval\n+ * will be chosen.\n+ */\n+public class RollupGroup extends AbstractDiffable<RollupGroup> implements ToXContentObject {\n+    private static final ParseField GROUP_FIELD = new ParseField(\"group\");\n+    private static final ParseField DATE_INTERVAL_FIELD = new ParseField(\"interval\");\n+    private static final ParseField DATE_TIMEZONE_FIELD = new ParseField(\"timezone\");\n+\n+    // the list of indices part of this rollup group\n+    private List<String> group;\n+    // a map from index-name to the date interval used in the associated index\n+    private Map<String, DateHistogramInterval> dateInterval;\n+    // a map from index-name to timezone used in the associated index\n+    private Map<String, WriteableZoneId> dateTimezone;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "376edee3c2e7b5563b6ee774a7a4df5873213a51"}, "originalPosition": 61}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDgyOTQ4MA==", "bodyText": "very much so. Once all the data is being used by the search-resolution code, I suspect the contents of these maps will change \ud83d\udc4d and be simplified into one Map containing a larger Object holding the necessary information in one place", "url": "https://github.com/elastic/elasticsearch/pull/64680#discussion_r520829480", "createdAt": "2020-11-10T19:44:07Z", "author": {"login": "talevy"}, "path": "server/src/main/java/org/elasticsearch/cluster/metadata/RollupGroup.java", "diffHunk": "@@ -0,0 +1,182 @@\n+/*\n+ * Licensed to Elasticsearch under one or more contributor\n+ * license agreements. See the NOTICE file distributed with\n+ * this work for additional information regarding copyright\n+ * ownership. Elasticsearch licenses this file to you under\n+ * the Apache License, Version 2.0 (the \"License\"); you may\n+ * not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *    http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.elasticsearch.cluster.metadata;\n+\n+import org.elasticsearch.cluster.AbstractDiffable;\n+import org.elasticsearch.cluster.Diff;\n+import org.elasticsearch.common.ParseField;\n+import org.elasticsearch.common.Strings;\n+import org.elasticsearch.common.io.stream.StreamInput;\n+import org.elasticsearch.common.io.stream.StreamOutput;\n+import org.elasticsearch.common.time.WriteableZoneId;\n+import org.elasticsearch.common.xcontent.ConstructingObjectParser;\n+import org.elasticsearch.common.xcontent.ToXContentObject;\n+import org.elasticsearch.common.xcontent.XContentBuilder;\n+import org.elasticsearch.common.xcontent.XContentParser;\n+import org.elasticsearch.search.aggregations.bucket.histogram.DateHistogramInterval;\n+\n+import java.io.IOException;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Objects;\n+\n+/**\n+ * Object representing information about rollup-v2 indices and their respective original-indexes. These objects\n+ * also include information about their capabilities, like which date-intervals and date-timezones they are configured\n+ * with. Used by {@link RollupMetadata}.\n+ *\n+ * The information in this class will be used to decide which index within the <code>group</code> will be chosen\n+ * for a specific aggregation. For example, if there are two indices with different intervals (`1h`, `1d`) and\n+ * a date-histogram aggregation request is sent for daily intervals, then the index with the associated `1d` interval\n+ * will be chosen.\n+ */\n+public class RollupGroup extends AbstractDiffable<RollupGroup> implements ToXContentObject {\n+    private static final ParseField GROUP_FIELD = new ParseField(\"group\");\n+    private static final ParseField DATE_INTERVAL_FIELD = new ParseField(\"interval\");\n+    private static final ParseField DATE_TIMEZONE_FIELD = new ParseField(\"timezone\");\n+\n+    // the list of indices part of this rollup group\n+    private List<String> group;\n+    // a map from index-name to the date interval used in the associated index\n+    private Map<String, DateHistogramInterval> dateInterval;\n+    // a map from index-name to timezone used in the associated index\n+    private Map<String, WriteableZoneId> dateTimezone;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDgyNzcxNg=="}, "originalCommit": {"oid": "376edee3c2e7b5563b6ee774a7a4df5873213a51"}, "originalPosition": 61}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3190, "cost": 1, "resetAt": "2021-11-12T13:16:51Z"}}}