{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDkwMDc2NDMw", "number": 62682, "title": "QL: Optimize Like/Rlike all", "bodyText": "Replace common Like and RLike queries that match all characters with\nIsNotNull (exists) queries\nFix #62585", "createdAt": "2020-09-21T06:35:43Z", "url": "https://github.com/elastic/elasticsearch/pull/62682", "merged": true, "mergeCommit": {"oid": "4c23fad0468a9edd7325b06c6a96f7af37625dbf"}, "closed": true, "closedAt": "2020-09-24T10:32:57Z", "author": {"login": "costin"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdK9ek0gH2gAyNDkwMDc2NDMwOjFmZWJmOThlN2U3YjM4MTRlZmY4N2EwYjRjYTU3NTBlYWI1ZDliZmQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdNO12AAFqTQ5NzI2ODU5Mw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "1febf98e7e7b3814eff87a0b4ca5750eab5d9bfd", "author": {"user": {"login": "costin", "name": "Costin Leau"}}, "url": "https://github.com/elastic/elasticsearch/commit/1febf98e7e7b3814eff87a0b4ca5750eab5d9bfd", "committedDate": "2020-09-21T06:34:05Z", "message": "QL: Optimize Like/Rlike all\n\nReplace common Like and RLike queries that match all characters with\nIsNotNull (exists) queries\n\nFix #62585"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkyMzg5MzEz", "url": "https://github.com/elastic/elasticsearch/pull/62682#pullrequestreview-492389313", "createdAt": "2020-09-21T08:47:34Z", "commit": {"oid": "1febf98e7e7b3814eff87a0b4ca5750eab5d9bfd"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMVQwODo0NzozNFrOHVF_Fw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMVQwODo0NzozNFrOHVF_Fw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTg4MDIxNQ==", "bodyText": "Isn't the wildcard character a %? To my understanding the replacement of % -> * happens later here: https://github.com/elastic/elasticsearch/pull/62682/files#diff-cb6f05d0222f3291ea3df5d33525d6f6R80", "url": "https://github.com/elastic/elasticsearch/pull/62682#discussion_r491880215", "createdAt": "2020-09-21T08:47:34Z", "author": {"login": "matriv"}, "path": "x-pack/plugin/ql/src/main/java/org/elasticsearch/xpack/ql/expression/predicate/regex/LikePattern.java", "diffHunk": "@@ -48,6 +48,16 @@ public String asJavaRegex() {\n         return regex;\n     }\n \n+    @Override\n+    public boolean matchesAll() {\n+        for (int i = 0 ; i < pattern.length(); i++) {\n+            if (pattern.charAt(i) != '*') {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1febf98e7e7b3814eff87a0b4ca5750eab5d9bfd"}, "originalPosition": 7}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a5f5a2fa5ba6c3eddc1e455a6d4f19992b6d103a", "author": {"user": {"login": "costin", "name": "Costin Leau"}}, "url": "https://github.com/elastic/elasticsearch/commit/a5f5a2fa5ba6c3eddc1e455a6d4f19992b6d103a", "committedDate": "2020-09-21T11:45:11Z", "message": "Fix query translation"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkyNTkyMjI4", "url": "https://github.com/elastic/elasticsearch/pull/62682#pullrequestreview-492592228", "createdAt": "2020-09-21T13:20:25Z", "commit": {"oid": "a5f5a2fa5ba6c3eddc1e455a6d4f19992b6d103a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMVQxMzoyMDoyNVrOHVPo3Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMVQxMzoyMDoyNVrOHVPo3Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjAzODM2NQ==", "bodyText": "I think that now the \"problem\" is reversed since the ReplaceWildcards takes place before this rule, but the test seems to work: https://github.com/elastic/elasticsearch/pull/62682/files#diff-6dd3fd1d0809ee5978cdccbc6bb7d7e1R17 ? In any case I think we should have a comment mentioning the order of the rules are applied and the choice of % or * in this rule.", "url": "https://github.com/elastic/elasticsearch/pull/62682#discussion_r492038365", "createdAt": "2020-09-21T13:20:25Z", "author": {"login": "matriv"}, "path": "x-pack/plugin/ql/src/main/java/org/elasticsearch/xpack/ql/expression/predicate/regex/LikePattern.java", "diffHunk": "@@ -48,6 +48,16 @@ public String asJavaRegex() {\n         return regex;\n     }\n \n+    @Override\n+    public boolean matchesAll() {\n+        for (int i = 0 ; i < pattern.length(); i++) {\n+            if (pattern.charAt(i) != '%') {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a5f5a2fa5ba6c3eddc1e455a6d4f19992b6d103a"}, "originalPosition": 7}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8ba14257ea0312a0383e34f6fe84a8021c7d0302", "author": {"user": {"login": "costin", "name": "Costin Leau"}}, "url": "https://github.com/elastic/elasticsearch/commit/8ba14257ea0312a0383e34f6fe84a8021c7d0302", "committedDate": "2020-09-22T21:37:30Z", "message": "Change pattern detection to Lucene automaton"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2f6900da3ca1cfd8f733b172234d20c7f08d47c2", "author": {"user": {"login": "elasticmachine", "name": "Elastic Machine"}}, "url": "https://github.com/elastic/elasticsearch/commit/2f6900da3ca1cfd8f733b172234d20c7f08d47c2", "committedDate": "2020-09-23T06:13:24Z", "message": "Merge branch 'master' into fix/62585"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f370368733a084dc9ac91ad4e6f2c109dd8fc9ae", "author": {"user": {"login": "costin", "name": "Costin Leau"}}, "url": "https://github.com/elastic/elasticsearch/commit/f370368733a084dc9ac91ad4e6f2c109dd8fc9ae", "committedDate": "2020-09-23T08:53:46Z", "message": "Add left-over test"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk0NzE2NDA0", "url": "https://github.com/elastic/elasticsearch/pull/62682#pullrequestreview-494716404", "createdAt": "2020-09-23T14:23:05Z", "commit": {"oid": "f370368733a084dc9ac91ad4e6f2c109dd8fc9ae"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk3MjY4NTkz", "url": "https://github.com/elastic/elasticsearch/pull/62682#pullrequestreview-497268593", "createdAt": "2020-09-28T07:55:44Z", "commit": {"oid": "f370368733a084dc9ac91ad4e6f2c109dd8fc9ae"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3596, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}