{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTMzNzc3Njkx", "number": 65958, "title": "Remove the rollup thread pool", "bodyText": "This commit removes the rollup thread pool and replaces all its usage\nwith the generic one. The rollup indexer uses the internal client to\nperform asynchronous search and indexation tasks so we don't need a\nseparate pool to handle these requests.", "createdAt": "2020-12-07T16:01:05Z", "url": "https://github.com/elastic/elasticsearch/pull/65958", "merged": true, "mergeCommit": {"oid": "cbf6499ba782515c8fa136e266120c03238eba2d"}, "closed": true, "closedAt": "2020-12-16T16:55:28Z", "author": {"login": "jimczi"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdi3-duAH2gAyNTMzNzc3NjkxOjU0MzlkMmU3YzU0ZjI5ZDc3MTEyZTRmMzdlMGQ5OWVhZGMwNzI1YWQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdmtdZuAH2gAyNTMzNzc3NjkxOjdlODY4ZWYxNDIyODRiYzU0MTNkMmFjMWQ3ZTVjNjY0ZTI3N2MxNzM=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "5439d2e7c54f29d77112e4f37e0d99eadc0725ad", "author": {"user": {"login": "jimczi", "name": "Jim Ferenczi"}}, "url": "https://github.com/elastic/elasticsearch/commit/5439d2e7c54f29d77112e4f37e0d99eadc0725ad", "committedDate": "2020-12-04T13:43:40Z", "message": "Perform rollup locally per shard\n\nThis commit refactors the rollup action in order to execute on a per shard basis.\nEach shard is responsible for sending its local buckets to the target rollup index.\nThe shard action is executed in the rollup thread pool in order to limit the\nnumber of shards that can rollup concurrently per node.\nBuckets are computed on the fly using the index searcher and they are sorted\nusing a compressed offline sorter.\n\nThis commit also removes the rollup thread pool usage in the RollupAsyncIndexer that is used by\nthe legacy rollup and transforms. All actions performed by this indexer are asynchronous so\nusing the generic thread pool to fire search and bulk requests is ok."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e36f0aebc9d4e16bc9621e90f343185bf5d319ee", "author": {"user": {"login": "jimczi", "name": "Jim Ferenczi"}}, "url": "https://github.com/elastic/elasticsearch/commit/e36f0aebc9d4e16bc9621e90f343185bf5d319ee", "committedDate": "2020-12-07T15:58:31Z", "message": "Remove the rollup thread pool\n\nThis commit removes the rollup thread pool and replaces all its usage\nwith the generic one. The rollup indexer uses the internal client to\nperform asynchronous search and indexation tasks so we don't need a\nseparate pool to handle these requests."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ2MjkzMjY2", "url": "https://github.com/elastic/elasticsearch/pull/65958#pullrequestreview-546293266", "createdAt": "2020-12-07T16:03:15Z", "commit": {"oid": "e36f0aebc9d4e16bc9621e90f343185bf5d319ee"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wN1QxNjowMzoxNVrOIAt-OA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wN1QxNjowNjowN1rOIAuHPQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzYyNDEyMA==", "bodyText": "is this class meant to be included in this PR?", "url": "https://github.com/elastic/elasticsearch/pull/65958#discussion_r537624120", "createdAt": "2020-12-07T16:03:15Z", "author": {"login": "talevy"}, "path": "x-pack/plugin/rollup/src/main/java/org/elasticsearch/xpack/rollup/v2/FieldValueFetcher.java", "diffHunk": "@@ -0,0 +1,66 @@\n+/*", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e36f0aebc9d4e16bc9621e90f343185bf5d319ee"}, "originalPosition": 1}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzYyNjQyOQ==", "bodyText": "not really important since this is just a test, but do we need to keep this executorName instance variable if it is static?", "url": "https://github.com/elastic/elasticsearch/pull/65958#discussion_r537626429", "createdAt": "2020-12-07T16:06:07Z", "author": {"login": "talevy"}, "path": "x-pack/plugin/transform/src/test/java/org/elasticsearch/xpack/transform/transforms/TransformIndexerStateTests.java", "diffHunk": "@@ -134,7 +132,7 @@\n                 context\n             );\n             this.threadPool = threadPool;\n-            this.executorName = executorName;\n+            this.executorName = ThreadPool.Names.GENERIC;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e36f0aebc9d4e16bc9621e90f343185bf5d319ee"}, "originalPosition": 21}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b7dc2270c0d44a988319856c1f2c0ae1e89ce4e0", "author": {"user": {"login": "jimczi", "name": "Jim Ferenczi"}}, "url": "https://github.com/elastic/elasticsearch/commit/b7dc2270c0d44a988319856c1f2c0ae1e89ce4e0", "committedDate": "2020-12-07T16:21:50Z", "message": "apply review comments"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ2NDAxNjc4", "url": "https://github.com/elastic/elasticsearch/pull/65958#pullrequestreview-546401678", "createdAt": "2020-12-07T18:03:45Z", "commit": {"oid": "b7dc2270c0d44a988319856c1f2c0ae1e89ce4e0"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wN1QxODowMzo0NVrOIAzg3g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wN1QxODowMzo0NVrOIAzg3g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzcxNDkxMA==", "bodyText": "I am not sure about this change. This got recently introduced:\n#65721\nto fix:\n#65542\nThe change reverts #65721 and we might get test failures again. However, I am not sure the test problem justifies keeping the executor name. \ud83e\udd14", "url": "https://github.com/elastic/elasticsearch/pull/65958#discussion_r537714910", "createdAt": "2020-12-07T18:03:45Z", "author": {"login": "hendrikmuhs"}, "path": "x-pack/plugin/transform/src/test/java/org/elasticsearch/xpack/transform/transforms/TransformIndexerStateTests.java", "diffHunk": "@@ -236,9 +231,8 @@ public void setUpMocks() {\n         auditor = MockTransformAuditor.createMockAuditor();\n         transformConfigManager = new InMemoryTransformConfigManager();\n         client = new NoOpClient(getTestName());\n-        // we need \"generic\" as part of the name, because it is asserted\n-        executorName = ThreadPool.Names.GENERIC + \"-\" + getTestName();\n-        threadPool = new TestThreadPool(executorName, new ScalingExecutorBuilder(executorName, 4, 10, TimeValue.timeValueSeconds(30)));\n+        threadPool = new TestThreadPool(ThreadPool.Names.GENERIC,\n+            new ScalingExecutorBuilder(ThreadPool.Names.GENERIC, 4, 10, TimeValue.timeValueSeconds(30)));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b7dc2270c0d44a988319856c1f2c0ae1e89ce4e0"}, "originalPosition": 65}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9a151d9b5416a645c1e0e53899fabb9613535207", "author": {"user": {"login": "jimczi", "name": "Jim Ferenczi"}}, "url": "https://github.com/elastic/elasticsearch/commit/9a151d9b5416a645c1e0e53899fabb9613535207", "committedDate": "2020-12-16T08:00:54Z", "message": "Merge branch 'master' into rollup_thread_pool"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "46b568120f810b794ca1e9a32a1925e8b2410af4", "author": {"user": {"login": "jimczi", "name": "Jim Ferenczi"}}, "url": "https://github.com/elastic/elasticsearch/commit/46b568120f810b794ca1e9a32a1925e8b2410af4", "committedDate": "2020-12-16T08:56:49Z", "message": "line len"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "acc77d6ede292849b847d2e0c95ebf43d978b19e", "author": {"user": {"login": "jimczi", "name": "Jim Ferenczi"}}, "url": "https://github.com/elastic/elasticsearch/commit/acc77d6ede292849b847d2e0c95ebf43d978b19e", "committedDate": "2020-12-16T09:49:23Z", "message": "fix transform test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7e868ef142284bc5413d2ac1d7e5c664e277c173", "author": {"user": {"login": "jimczi", "name": "Jim Ferenczi"}}, "url": "https://github.com/elastic/elasticsearch/commit/7e868ef142284bc5413d2ac1d7e5c664e277c173", "committedDate": "2020-12-16T11:44:12Z", "message": "Merge branch 'master' into rollup_thread_pool"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4063, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}