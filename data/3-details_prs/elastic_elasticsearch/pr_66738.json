{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTQ0MDk2MTE0", "number": 66738, "title": "Port all task definitions to task avoidance api", "bodyText": "This finishes porting all tasks created in gradle build scripts and plugins to use the task avoidance api (see #56610)\n\nAs a next step I'll look into enforcing this api in favour of immediate task creation . At the moment this is not provided by gradle and requires a custom solution\nFixes #56610", "createdAt": "2020-12-22T12:36:19Z", "url": "https://github.com/elastic/elasticsearch/pull/66738", "merged": true, "mergeCommit": {"oid": "eee6e118837cfc540fa5384c262aaa9da5caf04b"}, "closed": true, "closedAt": "2021-01-04T11:32:20Z", "author": {"login": "breskeby"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdopy2FgH2gAyNTQ0MDk2MTE0OjhhNzU5Y2E0NGMzNmUwODMzNjVhZTM5NzcwNDgzYjgyZDQzZmExNmI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABds0H71AH2gAyNTQ0MDk2MTE0OjgxYzE0MGRmNWNkMGI4M2YwMWQ3MzExYzY4ZmZiOTU3ZjlmNjEwOTk=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "8a759ca44c36e083365ae39770483b82d43fa16b", "author": {"user": {"login": "breskeby", "name": "Rene Groeschke"}}, "url": "https://github.com/elastic/elasticsearch/commit/8a759ca44c36e083365ae39770483b82d43fa16b", "committedDate": "2020-12-22T12:35:51Z", "message": "Port all task definitions to task avoidance api"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b8c30d84de4c4644e1c1be33c0ecef61bb2bc8d5", "author": {"user": {"login": "breskeby", "name": "Rene Groeschke"}}, "url": "https://github.com/elastic/elasticsearch/commit/b8c30d84de4c4644e1c1be33c0ecef61bb2bc8d5", "committedDate": "2020-12-22T12:40:50Z", "message": "Fix last task created during configuration"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a4c5c530bcce6e66a6e8255bff0c1134ed5f0a88", "author": {"user": {"login": "breskeby", "name": "Rene Groeschke"}}, "url": "https://github.com/elastic/elasticsearch/commit/a4c5c530bcce6e66a6e8255bff0c1134ed5f0a88", "committedDate": "2020-12-22T14:32:48Z", "message": "Fix test setup in  :modules:reindex"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU5MjgzMTc5", "url": "https://github.com/elastic/elasticsearch/pull/66738#pullrequestreview-559283179", "createdAt": "2020-12-28T19:56:09Z", "commit": {"oid": "a4c5c530bcce6e66a6e8255bff0c1134ed5f0a88"}, "state": "APPROVED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yOFQxOTo1NjowOVrOIMA8tg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yOFQyMDowMzoyMlrOIMBDvQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTQ2OTM2Ng==", "bodyText": "Does this have different final semantics than an enhanced for loop? I've seen goofiness with stuff like this before where lazy evaluated configuration uses the last value of this variable in the enhanced-for scenario. If this solves that problem maybe we should standardize on it.", "url": "https://github.com/elastic/elasticsearch/pull/66738#discussion_r549469366", "createdAt": "2020-12-28T19:56:09Z", "author": {"login": "mark-vieira"}, "path": "modules/reindex/build.gradle", "diffHunk": "@@ -128,7 +129,7 @@ if (Os.isFamily(Os.FAMILY_WINDOWS)) {\n     // see: https://github.com/elastic/elasticsearch/issues/51202\n     versions = ['2', '1']\n   }\n-  for (String version : versions) {\n+  versions.each { version ->", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a4c5c530bcce6e66a6e8255bff0c1134ed5f0a88"}, "originalPosition": 28}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTQ3MDQ0MA==", "bodyText": "Looks like jar and runtimeClasspath should also be inputs here. In fact we should just do that and then rely on the implicit dependencies.", "url": "https://github.com/elastic/elasticsearch/pull/66738#discussion_r549470440", "createdAt": "2020-12-28T20:00:09Z", "author": {"login": "mark-vieira"}, "path": "test/fixtures/gcs-fixture/build.gradle", "diffHunk": "@@ -26,8 +26,8 @@ dependencies {\n   api project(':server')\n }\n \n-preProcessFixture {\n-  dependsOn jar, configurations.runtimeClasspath\n+tasks.named(\"preProcessFixture\").configure {\n+  dependsOn tasks.named(\"jar\"), configurations.runtimeClasspath", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a4c5c530bcce6e66a6e8255bff0c1134ed5f0a88"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTQ3MTE2NQ==", "bodyText": "Does this not require a useCluster?", "url": "https://github.com/elastic/elasticsearch/pull/66738#discussion_r549471165", "createdAt": "2020-12-28T20:03:22Z", "author": {"login": "mark-vieira"}, "path": "x-pack/plugin/ccr/qa/multi-cluster/build.gradle", "diffHunk": "@@ -9,51 +9,53 @@ dependencies {\n   testImplementation project(':x-pack:plugin:ccr:qa')\n }\n \n-task \"leader-cluster\"(type: RestIntegTestTask) {\n-  mustRunAfter(\"precommit\")\n-  systemProperty 'tests.target_cluster', 'leader'\n+testClusters {\n+  'leader-cluster' {\n+    testDistribution = 'DEFAULT'\n+    setting 'xpack.license.self_generated.type', 'trial'\n+  }\n+  'middle-cluster' {\n+    testDistribution = 'DEFAULT'\n+    setting 'xpack.license.self_generated.type', 'trial'\n+    setting 'cluster.remote.leader_cluster.seeds',\n+            { \"\\\"${testClusters.named('leader-cluster').get().getAllTransportPortURI().join(\",\")}\\\"\" }\n+  }\n }\n \n-testClusters.\"leader-cluster\" {\n-  testDistribution = 'DEFAULT'\n-  setting 'xpack.license.self_generated.type', 'trial'\n+tasks.register(\"leader-cluster\", RestIntegTestTask) {\n+  mustRunAfter(\"precommit\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a4c5c530bcce6e66a6e8255bff0c1134ed5f0a88"}, "originalPosition": 24}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "81c140df5cd0b83f01d7311c68ffb957f9f61099", "author": {"user": {"login": "breskeby", "name": "Rene Groeschke"}}, "url": "https://github.com/elastic/elasticsearch/commit/81c140df5cd0b83f01d7311c68ffb957f9f61099", "committedDate": "2021-01-04T10:53:38Z", "message": "Declare proper task inputs"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4304, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}