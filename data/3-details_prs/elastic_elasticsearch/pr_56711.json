{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE3NTUzMTk2", "number": 56711, "title": "[ML] relax throttling on expired data cleanup", "bodyText": "Throttling nightly cleanup as much as we do has been over cautious.\nNight cleanup should be more lenient in its throttling. We still\nkeep the same batch size, but now the requests per second scale\nwith the number of data nodes. If we have more than 5 data nodes,\nwe don't throttle at all.\nThese numbers do seem magical...maybe it is better to not throttle\nat all...", "createdAt": "2020-05-13T19:02:58Z", "url": "https://github.com/elastic/elasticsearch/pull/56711", "merged": true, "mergeCommit": {"oid": "8fed077b0aaa092c079fbecadf2f88a6aaeb1ad7"}, "closed": true, "closedAt": "2020-05-18T11:21:07Z", "author": {"login": "benwtrent"}, "timelineItems": {"totalCount": 14, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcg9bY3gH2gAyNDE3NTUzMTk2OjlkNDczZTAzM2IwMDZmOTFlMjk5YjhmN2IwZTA2ZmZkMWU4ZDQ3Mzg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABchn8x0AH2gAyNDE3NTUzMTk2OjE3YjNlOTc2NjQ3MWQ4ZDE2ZjA3Yjc5OWQzNWE4YWQ5NTJkM2U2YTI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "9d473e033b006f91e299b8f7b0e06ffd1e8d4738", "author": {"user": {"login": "benwtrent", "name": "Benjamin Trent"}}, "url": "https://github.com/elastic/elasticsearch/commit/9d473e033b006f91e299b8f7b0e06ffd1e8d4738", "committedDate": "2020-05-13T18:45:47Z", "message": "[ML] relax throttling on expired data cleanup"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9ad0cf7b156443aafb7f8730bfcc38117d41eb42", "author": {"user": {"login": "benwtrent", "name": "Benjamin Trent"}}, "url": "https://github.com/elastic/elasticsearch/commit/9ad0cf7b156443aafb7f8730bfcc38117d41eb42", "committedDate": "2020-05-14T14:55:56Z", "message": "addressing pr comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b8f4722423334d6bae85859c27cc598c999099d8", "author": {"user": {"login": "benwtrent", "name": "Benjamin Trent"}}, "url": "https://github.com/elastic/elasticsearch/commit/b8f4722423334d6bae85859c27cc598c999099d8", "committedDate": "2020-05-14T14:56:36Z", "message": "Merge branch 'master' into feature/ml-allow-faster-expired-data-cleanup"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6c31b0eda5eddb6626a1ea5c2f80b26b46c698d7", "author": {"user": {"login": "benwtrent", "name": "Benjamin Trent"}}, "url": "https://github.com/elastic/elasticsearch/commit/6c31b0eda5eddb6626a1ea5c2f80b26b46c698d7", "committedDate": "2020-05-14T18:45:17Z", "message": "adding parameters to expired data cleanup"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bfc44a5faa2674a377662abc0377d63bc48fc167", "author": {"user": {"login": "benwtrent", "name": "Benjamin Trent"}}, "url": "https://github.com/elastic/elasticsearch/commit/bfc44a5faa2674a377662abc0377d63bc48fc167", "committedDate": "2020-05-14T19:40:50Z", "message": "fixing and adding tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4fca004be5554611e81cd359385dd34fa6b84065", "author": {"user": {"login": "benwtrent", "name": "Benjamin Trent"}}, "url": "https://github.com/elastic/elasticsearch/commit/4fca004be5554611e81cd359385dd34fa6b84065", "committedDate": "2020-05-14T19:54:08Z", "message": "removing unused import"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEyNTAxOTkx", "url": "https://github.com/elastic/elasticsearch/pull/56711#pullrequestreview-412501991", "createdAt": "2020-05-15T09:45:38Z", "commit": {"oid": "4fca004be5554611e81cd359385dd34fa6b84065"}, "state": "APPROVED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNVQwOTo0Njo1OFrOGV-DQg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNVQxMTozNDoyNlrOGWBNCw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTY4OTkyMg==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                 * `1.0f` indicates the default behavior where throttling scales according too the number of data nodes\n          \n          \n            \n                 * `1.0f` indicates the default behavior where throttling scales according to the number of data nodes", "url": "https://github.com/elastic/elasticsearch/pull/56711#discussion_r425689922", "createdAt": "2020-05-15T09:46:58Z", "author": {"login": "davidkyle"}, "path": "client/rest-high-level/src/main/java/org/elasticsearch/client/ml/DeleteExpiredDataRequest.java", "diffHunk": "@@ -19,16 +19,77 @@\n package org.elasticsearch.client.ml;\n \n import org.elasticsearch.client.Validatable;\n+import org.elasticsearch.common.unit.TimeValue;\n+import org.elasticsearch.common.xcontent.ToXContentObject;\n+import org.elasticsearch.common.xcontent.XContentBuilder;\n+\n+import java.io.IOException;\n+import java.util.Objects;\n \n /**\n  * Request to delete expired model snapshots and forecasts\n  */\n-public class DeleteExpiredDataRequest implements Validatable {\n+public class DeleteExpiredDataRequest implements Validatable, ToXContentObject {\n \n+    static final String REQUESTS_PER_SECOND = \"requests_per_second\";\n+    static final String TIMEOUT = \"timeout\";\n+    private final Float requestsPerSecond;\n+    private final TimeValue timeout;\n    /**\n      * Create a new request to delete expired data\n      */\n     public DeleteExpiredDataRequest() {\n+        this(null, null);\n+    }\n+\n+    public DeleteExpiredDataRequest(Float requestsPerSecond, TimeValue timeout) {\n+        this.requestsPerSecond = requestsPerSecond;\n+        this.timeout = timeout;\n+    }\n+\n+    /**\n+     * The requests allowed per second in the underlying Delete by Query requests executed.\n+     *\n+     * `1.0f` indicates the default behavior where throttling scales according too the number of data nodes", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4fca004be5554611e81cd359385dd34fa6b84065"}, "originalPosition": 36}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTcwNTM4OA==", "bodyText": "Why not a plain Object.equals(requestsPerSecond, request.requestsPerSecond)\nI see there is a difference between compare and equals but only in terms of NANs and comparing +0 to -0\nhttps://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/Float.html#equals(java.lang.Object)", "url": "https://github.com/elastic/elasticsearch/pull/56711#discussion_r425705388", "createdAt": "2020-05-15T10:17:01Z", "author": {"login": "davidkyle"}, "path": "x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/ml/action/DeleteExpiredDataAction.java", "diffHunk": "@@ -31,20 +34,97 @@ private DeleteExpiredDataAction() {\n \n     public static class Request extends ActionRequest {\n \n+        public static final ParseField REQUESTS_PER_SECOND = new ParseField(\"requests_per_second\");\n+        public static final ParseField TIMEOUT = new ParseField(\"timeout\");\n+\n+        public static final ObjectParser<Request, Void> PARSER = new ObjectParser<>(\n+            \"delete_expired_data_request\",\n+            true,\n+            Request::new);\n+\n+        static {\n+            PARSER.declareFloat(Request::setRequestsPerSecond, REQUESTS_PER_SECOND);\n+            PARSER.declareString((obj, value) -> obj.setTimeout(TimeValue.parseTimeValue(value, TIMEOUT.getPreferredName())),\n+                TIMEOUT);\n+        }\n+\n+        private Float requestsPerSecond;\n+        private TimeValue timeout;\n+\n         public Request() {}\n \n+        public Request(Float requestsPerSecond, TimeValue timeValue) {\n+            this.requestsPerSecond = requestsPerSecond;\n+            this.timeout = timeValue;\n+        }\n+\n         public Request(StreamInput in) throws IOException {\n             super(in);\n+            if (in.getVersion().onOrAfter(Version.V_8_0_0)) {\n+                this.requestsPerSecond = in.readOptionalFloat();\n+                this.timeout = in.readOptionalTimeValue();\n+            } else {\n+                this.requestsPerSecond = null;\n+                this.timeout = null;\n+            }\n+        }\n+\n+        public Float getRequestsPerSecond() {\n+            return requestsPerSecond;\n+        }\n+\n+        public TimeValue getTimeout() {\n+            return timeout;\n+        }\n+\n+        public Request setRequestsPerSecond(Float requestsPerSecond) {\n+            this.requestsPerSecond = requestsPerSecond;\n+            return this;\n+        }\n+\n+        public Request setTimeout(TimeValue timeout) {\n+            this.timeout = timeout;\n+            return this;\n         }\n \n         @Override\n         public ActionRequestValidationException validate() {\n+            if (this.requestsPerSecond != null && this.requestsPerSecond != -1.0f && this.requestsPerSecond <= 0) {\n+                ActionRequestValidationException requestValidationException = new ActionRequestValidationException();\n+                requestValidationException.addValidationError(\"[requests_per_second] must either be -1 or greater than 0\");\n+                return requestValidationException;\n+            }\n             return null;\n         }\n+\n+        @Override\n+        public boolean equals(Object o) {\n+            if (this == o) return true;\n+            if (o == null || getClass() != o.getClass()) return false;\n+            Request request = (Request) o;\n+            return Float.compare(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4fca004be5554611e81cd359385dd34fa6b84065"}, "originalPosition": 89}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTcxOTY3OQ==", "bodyText": "Is there a way to deregister the update consumer?\nThe consumer is added when the node becomes a master node but when it goes off master mlDailyMaintenanceService is set to null in uninstallDailyMaintenanceService() but this consumer referencing  mlDailyMaintenanceService will prevent it being garbage collected.\nMaybe make this class the consumer the set method will directly set the value on mlDailyMaintenanceService if it is not null", "url": "https://github.com/elastic/elasticsearch/pull/56711#discussion_r425719679", "createdAt": "2020-05-15T10:46:08Z", "author": {"login": "davidkyle"}, "path": "x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/MlInitializationService.java", "diffHunk": "@@ -87,10 +87,24 @@ public String executorName() {\n \n     private synchronized void installDailyMaintenanceService() {\n         if (mlDailyMaintenanceService == null) {\n-            mlDailyMaintenanceService =\n-                new MlDailyMaintenanceService(clusterService.getClusterName(), threadPool, client, clusterService, mlAssignmentNotifier);\n+            mlDailyMaintenanceService = new MlDailyMaintenanceService(\n+                settings,\n+                clusterService.getClusterName(),\n+                threadPool,\n+                client,\n+                clusterService,\n+                mlAssignmentNotifier\n+            );\n             mlDailyMaintenanceService.start();\n             clusterService.addLifecycleListener(new LifecycleListener() {\n+                @Override\n+                public void afterStart() {\n+                    clusterService.getClusterSettings().addSettingsUpdateConsumer(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4fca004be5554611e81cd359385dd34fa6b84065"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTc0MTU3OQ==", "bodyText": "Good \ud83d\udc40 I stared at this for a long time before I saw the difference", "url": "https://github.com/elastic/elasticsearch/pull/56711#discussion_r425741579", "createdAt": "2020-05-15T11:34:26Z", "author": {"login": "davidkyle"}, "path": "x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/job/retention/UnusedStateRemover.java", "diffHunk": "@@ -98,12 +98,12 @@ public void remove(ActionListener<Boolean> listener, Supplier<Boolean> isTimedOu\n \n     private Set<String> getJobIds() {\n         Set<String> jobIds = new HashSet<>();\n-        jobIds.addAll(getAnamalyDetectionJobIds());\n+        jobIds.addAll(getAnomalyDetectionJobIds());\n         jobIds.addAll(getDataFrameAnalyticsJobIds());\n         return jobIds;\n     }\n \n-    private Set<String> getAnamalyDetectionJobIds() {\n+    private Set<String> getAnomalyDetectionJobIds() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4fca004be5554611e81cd359385dd34fa6b84065"}, "originalPosition": 28}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEyNTk4ODkx", "url": "https://github.com/elastic/elasticsearch/pull/56711#pullrequestreview-412598891", "createdAt": "2020-05-15T12:23:08Z", "commit": {"oid": "4fca004be5554611e81cd359385dd34fa6b84065"}, "state": "COMMENTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNVQxMjoyMzowOFrOGWCl9g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNVQxMjo0MzozMlrOGWDP9g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTc2NDM0Mg==", "bodyText": "We would usually error on unknown fields when parsing REST requests.  Should this be false on the server side?", "url": "https://github.com/elastic/elasticsearch/pull/56711#discussion_r425764342", "createdAt": "2020-05-15T12:23:08Z", "author": {"login": "droberts195"}, "path": "x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/ml/action/DeleteExpiredDataAction.java", "diffHunk": "@@ -31,20 +34,97 @@ private DeleteExpiredDataAction() {\n \n     public static class Request extends ActionRequest {\n \n+        public static final ParseField REQUESTS_PER_SECOND = new ParseField(\"requests_per_second\");\n+        public static final ParseField TIMEOUT = new ParseField(\"timeout\");\n+\n+        public static final ObjectParser<Request, Void> PARSER = new ObjectParser<>(\n+            \"delete_expired_data_request\",\n+            true,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4fca004be5554611e81cd359385dd34fa6b84065"}, "originalPosition": 26}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTc2NTkwMg==", "bodyText": "It looks like the magic value is -1.0f in the core code, not 1.0f.  Negative also makes more sense for the magic value.", "url": "https://github.com/elastic/elasticsearch/pull/56711#discussion_r425765902", "createdAt": "2020-05-15T12:26:05Z", "author": {"login": "droberts195"}, "path": "client/rest-high-level/src/main/java/org/elasticsearch/client/ml/DeleteExpiredDataRequest.java", "diffHunk": "@@ -19,16 +19,77 @@\n package org.elasticsearch.client.ml;\n \n import org.elasticsearch.client.Validatable;\n+import org.elasticsearch.common.unit.TimeValue;\n+import org.elasticsearch.common.xcontent.ToXContentObject;\n+import org.elasticsearch.common.xcontent.XContentBuilder;\n+\n+import java.io.IOException;\n+import java.util.Objects;\n \n /**\n  * Request to delete expired model snapshots and forecasts\n  */\n-public class DeleteExpiredDataRequest implements Validatable {\n+public class DeleteExpiredDataRequest implements Validatable, ToXContentObject {\n \n+    static final String REQUESTS_PER_SECOND = \"requests_per_second\";\n+    static final String TIMEOUT = \"timeout\";\n+    private final Float requestsPerSecond;\n+    private final TimeValue timeout;\n    /**\n      * Create a new request to delete expired data\n      */\n     public DeleteExpiredDataRequest() {\n+        this(null, null);\n+    }\n+\n+    public DeleteExpiredDataRequest(Float requestsPerSecond, TimeValue timeout) {\n+        this.requestsPerSecond = requestsPerSecond;\n+        this.timeout = timeout;\n+    }\n+\n+    /**\n+     * The requests allowed per second in the underlying Delete by Query requests executed.\n+     *\n+     * `1.0f` indicates the default behavior where throttling scales according too the number of data nodes", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTY4OTkyMg=="}, "originalCommit": {"oid": "4fca004be5554611e81cd359385dd34fa6b84065"}, "originalPosition": 36}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTc3Mzk1NA==", "bodyText": "Maybe rename MAX_DURATION to DEFAULT_MAX_DURATION now it's not always used.", "url": "https://github.com/elastic/elasticsearch/pull/56711#discussion_r425773954", "createdAt": "2020-05-15T12:41:33Z", "author": {"login": "droberts195"}, "path": "x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/action/TransportDeleteExpiredDataAction.java", "diffHunk": "@@ -73,12 +74,18 @@ public TransportDeleteExpiredDataAction(ThreadPool threadPool, TransportService\n     protected void doExecute(Task task, DeleteExpiredDataAction.Request request,\n                              ActionListener<DeleteExpiredDataAction.Response> listener) {\n         logger.info(\"Deleting expired data\");\n-        Instant timeoutTime = Instant.now(clock).plus(MAX_DURATION);\n+        Instant timeoutTime = Instant.now(clock).plus(\n+            request.getTimeout() == null ? MAX_DURATION : Duration.ofMillis(request.getTimeout().millis())", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4fca004be5554611e81cd359385dd34fa6b84065"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTc3NTA5NA==", "bodyText": "Might be better to test with values other than 1, as 1 is more likely to end up in the output due to the combination of a bug and a fluke.", "url": "https://github.com/elastic/elasticsearch/pull/56711#discussion_r425775094", "createdAt": "2020-05-15T12:43:32Z", "author": {"login": "droberts195"}, "path": "client/rest-high-level/src/test/java/org/elasticsearch/client/MLRequestConvertersTests.java", "diffHunk": "@@ -214,12 +214,13 @@ public void testCloseJob() throws Exception {\n             requestEntityToString(request));\n     }\n \n-    public void testDeleteExpiredData() {\n-        DeleteExpiredDataRequest deleteExpiredDataRequest = new DeleteExpiredDataRequest();\n+    public void testDeleteExpiredData() throws Exception {\n+        DeleteExpiredDataRequest deleteExpiredDataRequest = new DeleteExpiredDataRequest(1.0f, TimeValue.timeValueHours(1));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4fca004be5554611e81cd359385dd34fa6b84065"}, "originalPosition": 7}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2b92d090188caf5d14f0d666cc2b94a09e827324", "author": {"user": {"login": "benwtrent", "name": "Benjamin Trent"}}, "url": "https://github.com/elastic/elasticsearch/commit/2b92d090188caf5d14f0d666cc2b94a09e827324", "committedDate": "2020-05-15T13:31:30Z", "message": "addressing pr comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "941b288bc426d30abaf0c4117c8d92b1d9478f1c", "author": {"user": {"login": "benwtrent", "name": "Benjamin Trent"}}, "url": "https://github.com/elastic/elasticsearch/commit/941b288bc426d30abaf0c4117c8d92b1d9478f1c", "committedDate": "2020-05-15T14:03:42Z", "message": "addressing pr comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6cd2bb7d4adc5043815ef3719bfa33f95ee203e4", "author": {"user": {"login": "elasticmachine", "name": "Elastic Machine"}}, "url": "https://github.com/elastic/elasticsearch/commit/6cd2bb7d4adc5043815ef3719bfa33f95ee203e4", "committedDate": "2020-05-15T15:07:52Z", "message": "Merge branch 'master' into feature/ml-allow-faster-expired-data-cleanup"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEyODk5MTM5", "url": "https://github.com/elastic/elasticsearch/pull/56711#pullrequestreview-412899139", "createdAt": "2020-05-15T19:04:33Z", "commit": {"oid": "6cd2bb7d4adc5043815ef3719bfa33f95ee203e4"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNVQxOTowNDozM1rOGWQqBw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNVQxOTowNjoyNFrOGWQtWg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTk5NDc1OQ==", "bodyText": "It seems dodgy to test two error conditions together: a timeout and requests per second = 0.  Maybe the .0f was a typo?  I think this test should just test the timeout.", "url": "https://github.com/elastic/elasticsearch/pull/56711#discussion_r425994759", "createdAt": "2020-05-15T19:04:33Z", "author": {"login": "droberts195"}, "path": "x-pack/plugin/ml/src/test/java/org/elasticsearch/xpack/ml/action/TransportDeleteExpiredDataActionTests.java", "diffHunk": "@@ -93,7 +97,7 @@ public void testDeleteExpiredDataIterationWithTimeout() {\n \n         Supplier<Boolean> isTimedOutSupplier = () -> (removersRemaining.getAndDecrement() <= 0);\n \n-        transportDeleteExpiredDataAction.deleteExpiredData(removers.iterator(), finalListener, isTimedOutSupplier, true);\n+        transportDeleteExpiredDataAction.deleteExpiredData(removers.iterator(), .0f, finalListener, isTimedOutSupplier, true);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6cd2bb7d4adc5043815ef3719bfa33f95ee203e4"}, "originalPosition": 27}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTk5NTYxMA==", "bodyText": "\"default\" is probably the wrong word for this comment.  The other HLRC docs say the default is null, and that's what's implemented in the HLRC.\nSo maybe \"default\" to \"standard nightly maintenance behavior\" or something like that.", "url": "https://github.com/elastic/elasticsearch/pull/56711#discussion_r425995610", "createdAt": "2020-05-15T19:06:24Z", "author": {"login": "droberts195"}, "path": "client/rest-high-level/src/main/java/org/elasticsearch/client/ml/DeleteExpiredDataRequest.java", "diffHunk": "@@ -19,16 +19,77 @@\n package org.elasticsearch.client.ml;\n \n import org.elasticsearch.client.Validatable;\n+import org.elasticsearch.common.unit.TimeValue;\n+import org.elasticsearch.common.xcontent.ToXContentObject;\n+import org.elasticsearch.common.xcontent.XContentBuilder;\n+\n+import java.io.IOException;\n+import java.util.Objects;\n \n /**\n  * Request to delete expired model snapshots and forecasts\n  */\n-public class DeleteExpiredDataRequest implements Validatable {\n+public class DeleteExpiredDataRequest implements Validatable, ToXContentObject {\n \n+    static final String REQUESTS_PER_SECOND = \"requests_per_second\";\n+    static final String TIMEOUT = \"timeout\";\n+    private final Float requestsPerSecond;\n+    private final TimeValue timeout;\n    /**\n      * Create a new request to delete expired data\n      */\n     public DeleteExpiredDataRequest() {\n+        this(null, null);\n+    }\n+\n+    public DeleteExpiredDataRequest(Float requestsPerSecond, TimeValue timeout) {\n+        this.requestsPerSecond = requestsPerSecond;\n+        this.timeout = timeout;\n+    }\n+\n+    /**\n+     * The requests allowed per second in the underlying Delete by Query requests executed.\n+     *\n+     * `-1.0f` indicates the default behavior where throttling scales according to the number of data nodes.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6cd2bb7d4adc5043815ef3719bfa33f95ee203e4"}, "originalPosition": 36}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "790d30caf6485b4adb1acd979d99bfed629a40f4", "author": {"user": {"login": "benwtrent", "name": "Benjamin Trent"}}, "url": "https://github.com/elastic/elasticsearch/commit/790d30caf6485b4adb1acd979d99bfed629a40f4", "committedDate": "2020-05-15T20:18:01Z", "message": "addressing pr comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "17b3e9766471d8d16f07b799d35a8ad952d3e6a2", "author": {"user": {"login": "benwtrent", "name": "Benjamin Trent"}}, "url": "https://github.com/elastic/elasticsearch/commit/17b3e9766471d8d16f07b799d35a8ad952d3e6a2", "committedDate": "2020-05-15T20:18:16Z", "message": "Merge remote-tracking branch 'upstream/master' into feature/ml-allow-faster-expired-data-cleanup"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4925, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}