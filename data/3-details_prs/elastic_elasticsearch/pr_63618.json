{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTAyMzk5NzM5", "number": 63618, "title": "Move geometry indexer to FieldMapper", "bodyText": "Indexing and parsing of geometrical objects is handled by specialised\nGeoIndexer and GeoParser classes, which are currently set on the FieldTypes\nfor their respective field mappers.  Seeing as indexing is handled entirely\nby FieldMappers, we should move them there instead.  This allows us to\nremove the complex generics on AbstractGeometryFieldType, and simplify\nthem on the corresponding FieldMappers as well.", "createdAt": "2020-10-13T14:36:04Z", "url": "https://github.com/elastic/elasticsearch/pull/63618", "merged": true, "mergeCommit": {"oid": "f4adb2de3871d9b4952c245fb944300c50851f94"}, "closed": true, "closedAt": "2020-10-14T10:13:28Z", "author": {"login": "romseygeek"}, "timelineItems": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdQfbnvgH2gAyNTAyMzk5NzM5OmYxYjY1YjAxNmUwYWU5YmJmZmRlNDVmNzUwYWVmY2Y5MzQ3MjJiMzc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdSZOjuAH2gAyNTAyMzk5NzM5OjJmMzQ3MWZlYzYyZDM4ZjhiNDcxYjQ3NDExN2NiOWI5NWFhZTM0NzA=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "f1b65b016e0ae9bbffde45f750aefcf934722b37", "author": {"user": {"login": "romseygeek", "name": "Alan Woodward"}}, "url": "https://github.com/elastic/elasticsearch/commit/f1b65b016e0ae9bbffde45f750aefcf934722b37", "committedDate": "2020-10-08T10:57:15Z", "message": "Convert WildcardFieldMapper to parametrized form"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8a0721199dc68b96d6c2f3ab9ff4de73717d2f13", "author": {"user": {"login": "elasticmachine", "name": "Elastic Machine"}}, "url": "https://github.com/elastic/elasticsearch/commit/8a0721199dc68b96d6c2f3ab9ff4de73717d2f13", "committedDate": "2020-10-13T10:02:37Z", "message": "Merge branch 'master' into mapper/wildcard"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7c2190defd42a57fd2385f6cc5a85ff5f3138506", "author": {"user": {"login": "romseygeek", "name": "Alan Woodward"}}, "url": "https://github.com/elastic/elasticsearch/commit/7c2190defd42a57fd2385f6cc5a85ff5f3138506", "committedDate": "2020-10-13T12:46:00Z", "message": "Merge remote-tracking branch 'origin/master' into mapper/wildcard"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ec7517c10d0ed3babef383df130d3dd9293b475a", "author": {"user": {"login": "romseygeek", "name": "Alan Woodward"}}, "url": "https://github.com/elastic/elasticsearch/commit/ec7517c10d0ed3babef383df130d3dd9293b475a", "committedDate": "2020-10-13T12:46:16Z", "message": "Merge remote-tracking branch 'romseygeek/mapper/wildcard' into mapper/wildcard"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a8e3e8ebf8e9b599d213fc69063cb0f856653550", "author": {"user": {"login": "romseygeek", "name": "Alan Woodward"}}, "url": "https://github.com/elastic/elasticsearch/commit/a8e3e8ebf8e9b599d213fc69063cb0f856653550", "committedDate": "2020-10-13T14:10:41Z", "message": "Move indexer and parser to FieldMapper; clean up generics"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b7c9eb3bb058c19becaba7d310be6b9ccf9178df", "author": {"user": {"login": "romseygeek", "name": "Alan Woodward"}}, "url": "https://github.com/elastic/elasticsearch/commit/b7c9eb3bb058c19becaba7d310be6b9ccf9178df", "committedDate": "2020-10-13T14:31:16Z", "message": "Merge remote-tracking branch 'origin/master' into mapper/geometries"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "01a4555e3f235c2a47ed7b4382e2fb6bfd07e9c2", "author": {"user": {"login": "romseygeek", "name": "Alan Woodward"}}, "url": "https://github.com/elastic/elasticsearch/commit/01a4555e3f235c2a47ed7b4382e2fb6bfd07e9c2", "committedDate": "2020-10-13T15:03:53Z", "message": "oops"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ef422c3fae000840f2f2a12d51d4e1a9523fd0c5", "author": {"user": {"login": "romseygeek", "name": "Alan Woodward"}}, "url": "https://github.com/elastic/elasticsearch/commit/ef422c3fae000840f2f2a12d51d4e1a9523fd0c5", "committedDate": "2020-10-13T15:30:47Z", "message": "erk"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7ee10983c1c8fa550fefe8896957b3bbea1d1231", "author": {"user": {"login": "romseygeek", "name": "Alan Woodward"}}, "url": "https://github.com/elastic/elasticsearch/commit/7ee10983c1c8fa550fefe8896957b3bbea1d1231", "committedDate": "2020-10-13T16:33:28Z", "message": "Merge remote-tracking branch 'origin/master' into mapper/geometries"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA4MTA5ODc1", "url": "https://github.com/elastic/elasticsearch/pull/63618#pullrequestreview-508109875", "createdAt": "2020-10-14T08:27:18Z", "commit": {"oid": "7ee10983c1c8fa550fefe8896957b3bbea1d1231"}, "state": "APPROVED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNFQwODoyNzoxOFrOHhH6Pw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNFQwODozOToxMFrOHhIY6w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDQ5NDY1NQ==", "bodyText": "Can we share the same parser for the type and the mapper? I think we are doing that in other places.", "url": "https://github.com/elastic/elasticsearch/pull/63618#discussion_r504494655", "createdAt": "2020-10-14T08:27:18Z", "author": {"login": "iverase"}, "path": "server/src/main/java/org/elasticsearch/index/mapper/LegacyGeoShapeFieldMapper.java", "diffHunk": "@@ -257,11 +257,10 @@ private void setupPrefixTrees(GeoShapeFieldType ft) {\n         }\n \n         private GeoShapeFieldType buildFieldType(BuilderContext context) {\n-            GeoShapeFieldType ft = new GeoShapeFieldType(buildFullName(context), indexed, fieldType.stored(), false, meta);\n+            GeoShapeFieldType ft =\n+                new GeoShapeFieldType(buildFullName(context), indexed, fieldType.stored(), false, new LegacyGeoShapeParser(), meta);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7ee10983c1c8fa550fefe8896957b3bbea1d1231"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDQ5NTA1NA==", "bodyText": "Same as above, probably only used by the test.", "url": "https://github.com/elastic/elasticsearch/pull/63618#discussion_r504495054", "createdAt": "2020-10-14T08:27:54Z", "author": {"login": "iverase"}, "path": "server/src/main/java/org/elasticsearch/index/mapper/LegacyGeoShapeFieldMapper.java", "diffHunk": "@@ -326,13 +326,14 @@ public Object format(ShapeBuilder<?, ?, ?> value, String format) {\n \n         private final LegacyGeoShapeQueryProcessor queryProcessor;\n \n-        private GeoShapeFieldType(String name, boolean indexed, boolean stored, boolean hasDocValues, Map<String, String> meta) {\n-            super(name, indexed, stored, hasDocValues, false, meta);\n+        private GeoShapeFieldType(String name, boolean indexed, boolean stored, boolean hasDocValues,\n+                                  LegacyGeoShapeParser parser, Map<String, String> meta) {\n+            super(name, indexed, stored, hasDocValues, false, parser, meta);\n             this.queryProcessor = new LegacyGeoShapeQueryProcessor(this);\n         }\n \n         public GeoShapeFieldType(String name) {\n-            this(name, true, false, true, Collections.emptyMap());\n+            this(name, true, false, true, null, Collections.emptyMap());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7ee10983c1c8fa550fefe8896957b3bbea1d1231"}, "originalPosition": 52}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDUwMjUwNw==", "bodyText": "Note to myself: This constructor is public because it used by a test. It should probably be private but let address it in a follow up PR.", "url": "https://github.com/elastic/elasticsearch/pull/63618#discussion_r504502507", "createdAt": "2020-10-14T08:39:10Z", "author": {"login": "iverase"}, "path": "x-pack/plugin/spatial/src/main/java/org/elasticsearch/xpack/spatial/index/mapper/ShapeFieldMapper.java", "diffHunk": "@@ -76,13 +76,14 @@ public Builder newBuilder(String name, Map<String, Object> params) {\n         }\n     }\n \n-    public static final class ShapeFieldType extends AbstractShapeGeometryFieldType<Geometry, Geometry>\n+    public static final class ShapeFieldType extends AbstractShapeGeometryFieldType\n         implements ShapeQueryable {\n \n         private final ShapeQueryProcessor queryProcessor;\n \n-        public ShapeFieldType(String name, boolean indexed, boolean stored, boolean hasDocValues, Map<String, String> meta) {\n-            super(name, indexed, stored, hasDocValues, false, meta);\n+        public ShapeFieldType(String name, boolean indexed, boolean stored, boolean hasDocValues,\n+                              Parser<Geometry> parser, Map<String, String> meta) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7ee10983c1c8fa550fefe8896957b3bbea1d1231"}, "originalPosition": 32}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c68e4953cddc0bb34e4471a70881b2585afe02d3", "author": {"user": {"login": "romseygeek", "name": "Alan Woodward"}}, "url": "https://github.com/elastic/elasticsearch/commit/c68e4953cddc0bb34e4471a70881b2585afe02d3", "committedDate": "2020-10-14T08:50:53Z", "message": "Share parser between mapper and fieldtype"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2f3471fec62d38f8b471b474117cb9b95aae3470", "author": {"user": {"login": "romseygeek", "name": "Alan Woodward"}}, "url": "https://github.com/elastic/elasticsearch/commit/2f3471fec62d38f8b471b474117cb9b95aae3470", "committedDate": "2020-10-14T08:51:24Z", "message": "Merge remote-tracking branch 'origin/master' into mapper/geometries"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4111, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}