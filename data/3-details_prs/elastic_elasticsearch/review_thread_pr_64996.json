{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE5ODc1MzUx", "number": 64996, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNlQxMjoxMDowMFrOE5cr-Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNlQxOToyMTozOFrOE5o83A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI4Njc0Mjk3OnYy", "diffSide": "RIGHT", "path": "x-pack/plugin/src/test/resources/rest-api-spec/test/deprecation/10_basic.yml", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNlQxMjoxMDowMFrOHz6kaw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNlQxOToyNDoxNlrOH0N9Cg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDE5OTAxOQ==", "bodyText": "@rjernst can you can think of a better approach here?", "url": "https://github.com/elastic/elasticsearch/pull/64996#discussion_r524199019", "createdAt": "2020-11-16T12:10:00Z", "author": {"login": "pugnascotia"}, "path": "x-pack/plugin/src/test/resources/rest-api-spec/test/deprecation/10_basic.yml", "diffHunk": "@@ -10,7 +10,10 @@ setup:\n       migration.deprecations:\n         index: \"*\"\n   - length: { cluster_settings: 0 }\n-  - length: { node_settings: 0 }\n+  # We don't check this field because for ES <8.0 && Java < 11, a node-level deprecation warning is triggered\n+  # and it isn't easy to codify this in the REST tests without extra test infrastructure. `MigrationIT.java`\n+  # does check this, however.\n+  # - length: { node_settings: 0 }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7b10767a7a2028bd9012433d1518fe4f6f41c4d2"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDUxNjYxOA==", "bodyText": "I think this is fine. Thanks for the note point to MigrationIT", "url": "https://github.com/elastic/elasticsearch/pull/64996#discussion_r524516618", "createdAt": "2020-11-16T19:24:16Z", "author": {"login": "rjernst"}, "path": "x-pack/plugin/src/test/resources/rest-api-spec/test/deprecation/10_basic.yml", "diffHunk": "@@ -10,7 +10,10 @@ setup:\n       migration.deprecations:\n         index: \"*\"\n   - length: { cluster_settings: 0 }\n-  - length: { node_settings: 0 }\n+  # We don't check this field because for ES <8.0 && Java < 11, a node-level deprecation warning is triggered\n+  # and it isn't easy to codify this in the REST tests without extra test infrastructure. `MigrationIT.java`\n+  # does check this, however.\n+  # - length: { node_settings: 0 }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDE5OTAxOQ=="}, "originalCommit": {"oid": "7b10767a7a2028bd9012433d1518fe4f6f41c4d2"}, "originalPosition": 8}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI4ODc1MjI4OnYy", "diffSide": "RIGHT", "path": "x-pack/plugin/deprecation/src/main/java/org/elasticsearch/xpack/deprecation/NodeDeprecationChecks.java", "isResolved": false, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNlQxOToyMTozOFrOH0N3Lg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOFQxMDowMzoyOFrOH1mCnA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDUxNTExOA==", "bodyText": "I wonder if we should first suggest using the bundled jdk?", "url": "https://github.com/elastic/elasticsearch/pull/64996#discussion_r524515118", "createdAt": "2020-11-16T19:21:38Z", "author": {"login": "rjernst"}, "path": "x-pack/plugin/deprecation/src/main/java/org/elasticsearch/xpack/deprecation/NodeDeprecationChecks.java", "diffHunk": "@@ -255,4 +256,15 @@ static DeprecationIssue checkRemovedSetting(final Settings settings, final Setti\n         return new DeprecationIssue(DeprecationIssue.Level.CRITICAL, message, url, details);\n     }\n \n+    static DeprecationIssue javaVersionCheck(Settings nodeSettings, PluginsAndModules plugins) {\n+        if (JavaVersion.current().compareTo(JavaVersion.parse(\"11\")) < 0) {\n+            return new DeprecationIssue(DeprecationIssue.Level.CRITICAL,\n+                \"Java 11 is required\",\n+                \"https://www.elastic.co/guide/en/elasticsearch/reference/master/breaking-changes-8.0.html#_java_11_is_required\",\n+                \"Java 11 will be required for future versions of Elasticsearch, this node is running version \"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7b10767a7a2028bd9012433d1518fe4f6f41c4d2"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTA2NTg4NA==", "bodyText": "Good idea. I've added a note here, and in a couple other places too. What do you think?", "url": "https://github.com/elastic/elasticsearch/pull/64996#discussion_r525065884", "createdAt": "2020-11-17T10:59:22Z", "author": {"login": "pugnascotia"}, "path": "x-pack/plugin/deprecation/src/main/java/org/elasticsearch/xpack/deprecation/NodeDeprecationChecks.java", "diffHunk": "@@ -255,4 +256,15 @@ static DeprecationIssue checkRemovedSetting(final Settings settings, final Setti\n         return new DeprecationIssue(DeprecationIssue.Level.CRITICAL, message, url, details);\n     }\n \n+    static DeprecationIssue javaVersionCheck(Settings nodeSettings, PluginsAndModules plugins) {\n+        if (JavaVersion.current().compareTo(JavaVersion.parse(\"11\")) < 0) {\n+            return new DeprecationIssue(DeprecationIssue.Level.CRITICAL,\n+                \"Java 11 is required\",\n+                \"https://www.elastic.co/guide/en/elasticsearch/reference/master/breaking-changes-8.0.html#_java_11_is_required\",\n+                \"Java 11 will be required for future versions of Elasticsearch, this node is running version \"", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDUxNTExOA=="}, "originalCommit": {"oid": "7b10767a7a2028bd9012433d1518fe4f6f41c4d2"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTYyODQ3Mw==", "bodyText": "The new wording is better, but it may be confusing for some users since they may have the bundled jdk, but have JAVA_HOME set by their system, so what they need to do is unset JAVA_HOME.", "url": "https://github.com/elastic/elasticsearch/pull/64996#discussion_r525628473", "createdAt": "2020-11-18T01:07:31Z", "author": {"login": "rjernst"}, "path": "x-pack/plugin/deprecation/src/main/java/org/elasticsearch/xpack/deprecation/NodeDeprecationChecks.java", "diffHunk": "@@ -255,4 +256,15 @@ static DeprecationIssue checkRemovedSetting(final Settings settings, final Setti\n         return new DeprecationIssue(DeprecationIssue.Level.CRITICAL, message, url, details);\n     }\n \n+    static DeprecationIssue javaVersionCheck(Settings nodeSettings, PluginsAndModules plugins) {\n+        if (JavaVersion.current().compareTo(JavaVersion.parse(\"11\")) < 0) {\n+            return new DeprecationIssue(DeprecationIssue.Level.CRITICAL,\n+                \"Java 11 is required\",\n+                \"https://www.elastic.co/guide/en/elasticsearch/reference/master/breaking-changes-8.0.html#_java_11_is_required\",\n+                \"Java 11 will be required for future versions of Elasticsearch, this node is running version \"", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDUxNTExOA=="}, "originalCommit": {"oid": "7b10767a7a2028bd9012433d1518fe4f6f41c4d2"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTk1OTgzNg==", "bodyText": "I've expanded the message further.", "url": "https://github.com/elastic/elasticsearch/pull/64996#discussion_r525959836", "createdAt": "2020-11-18T10:03:28Z", "author": {"login": "pugnascotia"}, "path": "x-pack/plugin/deprecation/src/main/java/org/elasticsearch/xpack/deprecation/NodeDeprecationChecks.java", "diffHunk": "@@ -255,4 +256,15 @@ static DeprecationIssue checkRemovedSetting(final Settings settings, final Setti\n         return new DeprecationIssue(DeprecationIssue.Level.CRITICAL, message, url, details);\n     }\n \n+    static DeprecationIssue javaVersionCheck(Settings nodeSettings, PluginsAndModules plugins) {\n+        if (JavaVersion.current().compareTo(JavaVersion.parse(\"11\")) < 0) {\n+            return new DeprecationIssue(DeprecationIssue.Level.CRITICAL,\n+                \"Java 11 is required\",\n+                \"https://www.elastic.co/guide/en/elasticsearch/reference/master/breaking-changes-8.0.html#_java_11_is_required\",\n+                \"Java 11 will be required for future versions of Elasticsearch, this node is running version \"", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDUxNTExOA=="}, "originalCommit": {"oid": "7b10767a7a2028bd9012433d1518fe4f6f41c4d2"}, "originalPosition": 17}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2991, "cost": 1, "resetAt": "2021-11-12T13:16:51Z"}}}