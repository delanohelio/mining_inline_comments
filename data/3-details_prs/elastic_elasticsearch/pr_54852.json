{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk5OTc1ODEz", "number": 54852, "title": "Lazy test cluster module and plugins", "bodyText": "This change converts the module and plugin parameters\nfor testClusters to be lazy. Meaning that the values\nare not resolved until they are actually used. This\nremoves the requirement to use project.afterEvaluate to\nbe able to resolve the bundle artifact.\nNote - this does not completely remove the need for afterEvaluate\nsince it is still needed for the custom resource extension.", "createdAt": "2020-04-07T00:41:18Z", "url": "https://github.com/elastic/elasticsearch/pull/54852", "merged": true, "mergeCommit": {"oid": "abed62e24679b7055b30a15185d72c8f39a19cac"}, "closed": true, "closedAt": "2020-04-08T20:19:53Z", "author": {"login": "jakelandis"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcVH2yOAH2gAyMzk5OTc1ODEzOmRhZjNkMWE3YmEwNjVlMzU4ZmJkOTUzOWJkNTM2MzliMWJkYWQ0NzM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcVsUZyAH2gAyMzk5OTc1ODEzOjkwOWYwZjNlNWU5YWRmNWE2NGIwNTI4YWM3MGIzZDNkYTA5NGNiMjE=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "daf3d1a7ba065e358fbd9539bd53639b1bdad473", "author": {"user": {"login": "jakelandis", "name": "Jake Landis"}}, "url": "https://github.com/elastic/elasticsearch/commit/daf3d1a7ba065e358fbd9539bd53639b1bdad473", "committedDate": "2020-04-07T00:07:40Z", "message": "initial commit"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "95cff57223b256ed01ecc4e55757c782d4f6aaaf", "author": {"user": {"login": "jakelandis", "name": "Jake Landis"}}, "url": "https://github.com/elastic/elasticsearch/commit/95cff57223b256ed01ecc4e55757c782d4f6aaaf", "committedDate": "2020-04-07T00:37:09Z", "message": "clean up"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b3068d11c6975222ee200c2857c0a4ab96c9b126", "author": {"user": {"login": "jakelandis", "name": "Jake Landis"}}, "url": "https://github.com/elastic/elasticsearch/commit/b3068d11c6975222ee200c2857c0a4ab96c9b126", "committedDate": "2020-04-07T01:14:01Z", "message": "move plugin dependency back to afterEvaluate"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg5NDE5NzUz", "url": "https://github.com/elastic/elasticsearch/pull/54852#pullrequestreview-389419753", "createdAt": "2020-04-07T19:21:17Z", "commit": {"oid": "b3068d11c6975222ee200c2857c0a4ab96c9b126"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wN1QxOToyMToxN1rOGCSkug==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wN1QxOToyMToxN1rOGCSkug==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTA1NDY1MA==", "bodyText": "I think it could simplify some of the other code here if we just made this.modules a List<Provider<File>> and called module.getAsFile() here rather than having to do getAsFile() in a bunch of other places.", "url": "https://github.com/elastic/elasticsearch/pull/54852#discussion_r405054650", "createdAt": "2020-04-07T19:21:17Z", "author": {"login": "mark-vieira"}, "path": "buildSrc/src/main/java/org/elasticsearch/gradle/testclusters/ElasticsearchNode.java", "diffHunk": "@@ -267,13 +270,30 @@ public void plugin(URI plugin) {\n         this.plugins.add(plugin);\n     }\n \n+    @Override\n+    public void plugin(Provider<RegularFile> plugin) {\n+        this.plugin(() -> plugin.get().getAsFile().toURI());\n+    }\n+\n+    @Override\n+    public void plugin(URI plugin) {\n+        this.plugin(() -> plugin);\n+    }\n+\n     @Override\n     public void plugin(File plugin) {\n-        plugin(plugin.toURI());\n+        this.plugin(() -> plugin.toURI());\n     }\n \n     @Override\n     public void module(File module) {\n+        RegularFileProperty file = project.getObjects().fileProperty();\n+        file.fileValue(module);\n+        this.module(file);\n+    }\n+\n+    @Override\n+    public void module(Provider<RegularFile> module) {\n         this.modules.add(module);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b3068d11c6975222ee200c2857c0a4ab96c9b126"}, "originalPosition": 61}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg5NTQ2NTA4", "url": "https://github.com/elastic/elasticsearch/pull/54852#pullrequestreview-389546508", "createdAt": "2020-04-07T22:56:52Z", "commit": {"oid": "b3068d11c6975222ee200c2857c0a4ab96c9b126"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wN1QyMjo1Njo1M1rOGCZFvQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wN1QyMjo1Njo1M1rOGCZFvQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTE2MTQwNQ==", "bodyText": "Why do we also need this Supplier variant? Seems inconsistent to have it for plugin but not module.", "url": "https://github.com/elastic/elasticsearch/pull/54852#discussion_r405161405", "createdAt": "2020-04-07T22:56:53Z", "author": {"login": "rjernst"}, "path": "buildSrc/src/main/java/org/elasticsearch/gradle/testclusters/TestClusterConfiguration.java", "diffHunk": "@@ -46,8 +48,14 @@\n \n     void plugin(File plugin);\n \n+    void plugin(Supplier<URI> plugin);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b3068d11c6975222ee200c2857c0a4ab96c9b126"}, "originalPosition": 14}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "73427ab3692e08fd17b78d5a5c53490f2dc7b8cc", "author": {"user": {"login": "jakelandis", "name": "Jake Landis"}}, "url": "https://github.com/elastic/elasticsearch/commit/73427ab3692e08fd17b78d5a5c53490f2dc7b8cc", "committedDate": "2020-04-08T15:54:16Z", "message": "review changes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5527c98194c4b78e975791d65ca21cd977d3a44c", "author": {"user": {"login": "elasticmachine", "name": "Elastic Machine"}}, "url": "https://github.com/elastic/elasticsearch/commit/5527c98194c4b78e975791d65ca21cd977d3a44c", "committedDate": "2020-04-08T16:11:54Z", "message": "Merge branch 'master' into lazy_module_plugins"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkwMTQ2NDEx", "url": "https://github.com/elastic/elasticsearch/pull/54852#pullrequestreview-390146411", "createdAt": "2020-04-08T16:40:01Z", "commit": {"oid": "5527c98194c4b78e975791d65ca21cd977d3a44c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "909f0f3e5e9adf5a64b0528ac70b3d3da094cb21", "author": {"user": {"login": "jakelandis", "name": "Jake Landis"}}, "url": "https://github.com/elastic/elasticsearch/commit/909f0f3e5e9adf5a64b0528ac70b3d3da094cb21", "committedDate": "2020-04-08T18:36:36Z", "message": "add missing lazy File based plugin option"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3718, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}