{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE5NzQ5NTM0", "number": 64978, "title": "Better out-of-the-box mappings for logs, metrics and synthetics", "bodyText": "One of the problems we have today with the default templates is that ip addresses and message fields are not mapped correct. Auto detection of ip addresses would be great: #64400 But in the meantime, we could also match on the naming convention that all *.ip fields are of type ip address.\nDuring implementation I was not sure if I should use match: ip for path_match: *.ip. The main difference I would expect that the top level is not matched. Are there others?\nDo we have fields which are named ip or message which do not adhere to these rules?\nThis PR is not complete but is to share the idea, also it was not tested. If we decide to move forward, also the other base templates need updating and it might be useful to add the same logic to all datasets created by Kibana.", "createdAt": "2020-11-12T09:33:20Z", "url": "https://github.com/elastic/elasticsearch/pull/64978", "merged": true, "mergeCommit": {"oid": "2bd1b33d6a824721314ecd9e458b0e51294658b2"}, "closed": true, "closedAt": "2021-05-04T14:51:50Z", "author": {"login": "ruflin"}, "timelineItems": {"totalCount": 34, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdbvJsZgH2gAyNTE5NzQ5NTM0OjExMDBiOTViZjVkOTY4MzBmMTU1NjhkYmJhN2Q5MzA0MTI2NjllMzY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABeTdvOrgH2gAyNTE5NzQ5NTM0Ojg5ZWIwNmQzMjRhODFjMzlkOTljZjQzYjk3NmQ2MDM3ZTAzYzdhNzE=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "1100b95bf5d96830f15568dbba7d930412669e36", "author": {"user": {"login": "ruflin", "name": "Nicolas Ruflin"}}, "url": "https://github.com/elastic/elasticsearch/commit/1100b95bf5d96830f15568dbba7d930412669e36", "committedDate": "2020-11-12T09:29:19Z", "message": "Proposal: Default templates: Path match for ip and message\n\nOne of the problems we have today with the default templates is that ip addresses and message fields are not mapped correct. Auto detection of ip addresses would be great: https://github.com/elastic/elasticsearch/issues/64400 But in the meantime, we could also match on the naming convention that all `*.ip` fields are of type ip address.\n\nDuring implementation I was not sure if I should use `match: ip` for `path_match: *.ip`. The main difference I would expect that the top level is not matched. Are there others?\n\nDo we have fields which are named `ip` or `message` which do not adhere to these rules?\n\nThis PR is not complete but is to share the idea. If we decide to move forward, also the other base templates need updating and it might be useful to add the same logic to all datasets created by Kibana."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI4OTM2MDQx", "url": "https://github.com/elastic/elasticsearch/pull/64978#pullrequestreview-528936041", "createdAt": "2020-11-12T10:12:46Z", "commit": {"oid": "1100b95bf5d96830f15568dbba7d930412669e36"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMlQxMDoxMjo0NlrOHxztvA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMlQxMDoxMjo0NlrOHxztvA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTk4OTU2NA==", "bodyText": "Not that it would save lots of space, but given that scoring doesn't help, we could disable norms.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                          \"type\": \"text\"\n          \n          \n            \n                          \"type\": \"text\",\n          \n          \n            \n                          \"norms\": false", "url": "https://github.com/elastic/elasticsearch/pull/64978#discussion_r521989564", "createdAt": "2020-11-12T10:12:46Z", "author": {"login": "jpountz"}, "path": "x-pack/plugin/core/src/main/resources/logs-mappings.json", "diffHunk": "@@ -9,6 +9,20 @@\n               \"type\": \"keyword\"\n             },\n             \"match_mapping_type\": \"string\"\n+          },\n+          \"match_ip\": {\n+            \"match_mapping_type\": \"string\",\n+            \"path_match\":   \"*.ip\",\n+            \"mapping\": {\n+              \"type\": \"ip\"\n+            }\n+          },\n+          \"match_message\": {\n+            \"match_mapping_type\": \"string\",\n+            \"path_match\":   \"*.message\",\n+            \"mapping\": {\n+              \"type\": \"text\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1100b95bf5d96830f15568dbba7d930412669e36"}, "originalPosition": 16}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dae84d6f1e0345e129f42d5ac92b70762467755e", "author": {"user": {"login": "ruflin", "name": "Nicolas Ruflin"}}, "url": "https://github.com/elastic/elasticsearch/commit/dae84d6f1e0345e129f42d5ac92b70762467755e", "committedDate": "2020-11-12T11:55:36Z", "message": "Update x-pack/plugin/core/src/main/resources/logs-mappings.json\n\nCo-authored-by: Adrien Grand <jpountz@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "90ca4b1adfabc2a6578cb79e3093ce5594b6d9ee", "author": {"user": {"login": "ruflin", "name": "Nicolas Ruflin"}}, "url": "https://github.com/elastic/elasticsearch/commit/90ca4b1adfabc2a6578cb79e3093ce5594b6d9ee", "committedDate": "2020-11-20T11:52:52Z", "message": "update mapping with discussion"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM3NTIxODI5", "url": "https://github.com/elastic/elasticsearch/pull/64978#pullrequestreview-537521829", "createdAt": "2020-11-24T14:04:13Z", "commit": {"oid": "90ca4b1adfabc2a6578cb79e3093ce5594b6d9ee"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNFQxNDowNDoxM1rOH5CTgQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNFQxNDowNDoxNVrOH5CTpg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTU2ODY0MQ==", "bodyText": "keep a single space after the colon?", "url": "https://github.com/elastic/elasticsearch/pull/64978#discussion_r529568641", "createdAt": "2020-11-24T14:04:13Z", "author": {"login": "jpountz"}, "path": "x-pack/plugin/core/src/main/resources/logs-mappings.json", "diffHunk": "@@ -9,6 +9,21 @@\n               \"type\": \"keyword\"\n             },\n             \"match_mapping_type\": \"string\"\n+          },\n+          \"match_ip\": {\n+            \"match_mapping_type\": \"string\",\n+            \"match\":   \"ip\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "90ca4b1adfabc2a6578cb79e3093ce5594b6d9ee"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTU2ODY3OA==", "bodyText": "keep a single space after the colon?", "url": "https://github.com/elastic/elasticsearch/pull/64978#discussion_r529568678", "createdAt": "2020-11-24T14:04:15Z", "author": {"login": "jpountz"}, "path": "x-pack/plugin/core/src/main/resources/logs-mappings.json", "diffHunk": "@@ -9,6 +9,21 @@\n               \"type\": \"keyword\"\n             },\n             \"match_mapping_type\": \"string\"\n+          },\n+          \"match_ip\": {\n+            \"match_mapping_type\": \"string\",\n+            \"match\":   \"ip\",\n+            \"mapping\": {\n+              \"type\": \"ip\"\n+            }\n+          },\n+          \"match_message\": {\n+            \"match_mapping_type\": \"string\",\n+            \"match\":   \"message\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "90ca4b1adfabc2a6578cb79e3093ce5594b6d9ee"}, "originalPosition": 14}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM4NjIyMTQy", "url": "https://github.com/elastic/elasticsearch/pull/64978#pullrequestreview-538622142", "createdAt": "2020-11-25T15:38:38Z", "commit": {"oid": "90ca4b1adfabc2a6578cb79e3093ce5594b6d9ee"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNVQxNTozODozOFrOH55BKg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNVQxNTozODo1NVrOH55B2g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDQ2NTA2Ng==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                      },\n          \n          \n            \n                      }\n          \n          \n            \n                    },\n          \n          \n            \n                    {", "url": "https://github.com/elastic/elasticsearch/pull/64978#discussion_r530465066", "createdAt": "2020-11-25T15:38:38Z", "author": {"login": "jpountz"}, "path": "x-pack/plugin/core/src/main/resources/logs-mappings.json", "diffHunk": "@@ -9,6 +9,21 @@\n               \"type\": \"keyword\"\n             },\n             \"match_mapping_type\": \"string\"\n+          },", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "90ca4b1adfabc2a6578cb79e3093ce5594b6d9ee"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDQ2NTI0Mg==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                      },\n          \n          \n            \n                      }\n          \n          \n            \n                    },\n          \n          \n            \n                    {", "url": "https://github.com/elastic/elasticsearch/pull/64978#discussion_r530465242", "createdAt": "2020-11-25T15:38:55Z", "author": {"login": "jpountz"}, "path": "x-pack/plugin/core/src/main/resources/logs-mappings.json", "diffHunk": "@@ -9,6 +9,21 @@\n               \"type\": \"keyword\"\n             },\n             \"match_mapping_type\": \"string\"\n+          },\n+          \"match_ip\": {\n+            \"match_mapping_type\": \"string\",\n+            \"match\":   \"ip\",\n+            \"mapping\": {\n+              \"type\": \"ip\"\n+            }\n+          },", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "90ca4b1adfabc2a6578cb79e3093ce5594b6d9ee"}, "originalPosition": 11}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "35d072765e9e9f0c3b07074d4de9d2597b4d31d3", "author": {"user": {"login": "ruflin", "name": "Nicolas Ruflin"}}, "url": "https://github.com/elastic/elasticsearch/commit/35d072765e9e9f0c3b07074d4de9d2597b4d31d3", "committedDate": "2020-11-26T07:20:30Z", "message": "Update x-pack/plugin/core/src/main/resources/logs-mappings.json\n\nCo-authored-by: Adrien Grand <jpountz@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ce72eefb9f4c4b170cb421a61d38e64149a69785", "author": {"user": {"login": "ruflin", "name": "Nicolas Ruflin"}}, "url": "https://github.com/elastic/elasticsearch/commit/ce72eefb9f4c4b170cb421a61d38e64149a69785", "committedDate": "2020-11-26T07:20:36Z", "message": "Update x-pack/plugin/core/src/main/resources/logs-mappings.json\n\nCo-authored-by: Adrien Grand <jpountz@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2e130a55db31051731ebf643567edd551e6a76ed", "author": {"user": {"login": "jpountz", "name": "Adrien Grand"}}, "url": "https://github.com/elastic/elasticsearch/commit/2e130a55db31051731ebf643567edd551e6a76ed", "committedDate": "2020-11-26T10:22:05Z", "message": "Put the most specific dynamic templates first."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7497f294634d6440523addeded796edfd4a9ad09", "author": {"user": {"login": "jpountz", "name": "Adrien Grand"}}, "url": "https://github.com/elastic/elasticsearch/commit/7497f294634d6440523addeded796edfd4a9ad09", "committedDate": "2020-11-26T10:29:47Z", "message": "Add tests for dynamic templates."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM5MjM1NzQ2", "url": "https://github.com/elastic/elasticsearch/pull/64978#pullrequestreview-539235746", "createdAt": "2020-11-26T11:35:16Z", "commit": {"oid": "7497f294634d6440523addeded796edfd4a9ad09"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNlQxMTozNToxN1rOH6XpHA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNlQxMTozNToxN1rOH6XpHA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDk2NjgxMg==", "bodyText": "Nice, good to know this is possible!", "url": "https://github.com/elastic/elasticsearch/pull/64978#discussion_r530966812", "createdAt": "2020-11-26T11:35:17Z", "author": {"login": "ruflin"}, "path": "x-pack/plugin/stack/qa/rest/src/yamlRestTest/resources/rest-api-spec/test/stack/10_basic.yml", "diffHunk": "@@ -64,7 +66,9 @@ setup:\n   - is_true: \\.ds-logs-foo-bar-000001.settings\n   - is_true: \\.ds-logs-foo-bar-000001.mappings\n   - match: { \\.ds-logs-foo-bar-000001.settings.index.lifecycle.name: \"logs\" }\n-  - is_true: \\.ds-logs-foo-bar-000001.mappings.properties.message\n+  - match: { \\.ds-logs-foo-bar-000001.mappings.properties.message.type: \"text\" }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7497f294634d6440523addeded796edfd4a9ad09"}, "originalPosition": 14}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ce711a7cbe7e213d81b14e6299244169cf7cc5ff", "author": {"user": {"login": "ruflin", "name": "Nicolas Ruflin"}}, "url": "https://github.com/elastic/elasticsearch/commit/ce711a7cbe7e213d81b14e6299244169cf7cc5ff", "committedDate": "2020-12-22T09:45:42Z", "message": "add mappings to metrics and synthetics too"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "30e97b3d45469a1f52b51cf6d114b978e3d6ddbb", "author": {"user": {"login": "ruflin", "name": "Nicolas Ruflin"}}, "url": "https://github.com/elastic/elasticsearch/commit/30e97b3d45469a1f52b51cf6d114b978e3d6ddbb", "committedDate": "2020-12-22T09:48:05Z", "message": "Merge branch 'master' into path-match-ip-message"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "74cb397c912909af326fed9934e2742c1612ee34", "author": {"user": {"login": "ruflin", "name": "Nicolas Ruflin"}}, "url": "https://github.com/elastic/elasticsearch/commit/74cb397c912909af326fed9934e2742c1612ee34", "committedDate": "2020-12-22T09:49:20Z", "message": "add index renaming"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU3MDAzNjc5", "url": "https://github.com/elastic/elasticsearch/pull/64978#pullrequestreview-557003679", "createdAt": "2020-12-22T11:15:21Z", "commit": {"oid": "74cb397c912909af326fed9934e2742c1612ee34"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMlQxMToxNToyMVrOIJ3ljw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMlQxMToxNToyMVrOIJ3ljw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzIxODgzMQ==", "bodyText": "@jpountz With the recent development in ES, I started to ask myself if these should actually all be dynamic mapping for runtime fields? It would change the PR a bit as I think in this case we should bring back the global message field but everything else should match as runtime.", "url": "https://github.com/elastic/elasticsearch/pull/64978#discussion_r547218831", "createdAt": "2020-12-22T11:15:21Z", "author": {"login": "ruflin"}, "path": "x-pack/plugin/core/src/main/resources/logs-mappings.json", "diffHunk": "@@ -2,6 +2,25 @@\n   \"template\": {\n     \"mappings\": {\n       \"dynamic_templates\": [\n+        {\n+          \"match_ip\": {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "74cb397c912909af326fed9934e2742c1612ee34"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NjM0MzkyMjM2", "url": "https://github.com/elastic/elasticsearch/pull/64978#pullrequestreview-634392236", "createdAt": "2021-04-13T09:48:00Z", "commit": {"oid": "74cb397c912909af326fed9934e2742c1612ee34"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wNC0xM1QwOTo0ODowMFrOJH7vcQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wNC0xM1QwOTo1MjoxNlrOJH764g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxMjI5ODYwOQ==", "bodyText": "Do we really messages for metrics?", "url": "https://github.com/elastic/elasticsearch/pull/64978#discussion_r612298609", "createdAt": "2021-04-13T09:48:00Z", "author": {"login": "jpountz"}, "path": "x-pack/plugin/core/src/main/resources/metrics-mappings.json", "diffHunk": "@@ -2,6 +2,25 @@\n   \"template\": {\n     \"mappings\": {\n       \"dynamic_templates\": [\n+        {\n+          \"match_ip\": {\n+            \"match_mapping_type\": \"string\",\n+            \"match\": \"ip\",\n+            \"mapping\": {\n+              \"type\": \"ip\"\n+            }\n+          }\n+        },\n+        {\n+          \"match_message\": {\n+            \"match_mapping_type\": \"string\",\n+            \"match\": \"message\",\n+            \"mapping\": {\n+              \"type\": \"text\",\n+              \"norms\": false\n+            }\n+          }\n+        },", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "74cb397c912909af326fed9934e2742c1612ee34"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxMjI5ODczNw==", "bodyText": "do we really need messages for synthetics?", "url": "https://github.com/elastic/elasticsearch/pull/64978#discussion_r612298737", "createdAt": "2021-04-13T09:48:12Z", "author": {"login": "jpountz"}, "path": "x-pack/plugin/core/src/main/resources/synthetics-mappings.json", "diffHunk": "@@ -2,6 +2,25 @@\n   \"template\": {\n     \"mappings\": {\n       \"dynamic_templates\": [\n+        {\n+          \"match_ip\": {\n+            \"match_mapping_type\": \"string\",\n+            \"match\": \"ip\",\n+            \"mapping\": {\n+              \"type\": \"ip\"\n+            }\n+          }\n+        },\n+        {\n+          \"match_message\": {\n+            \"match_mapping_type\": \"string\",\n+            \"match\": \"message\",\n+            \"mapping\": {\n+              \"type\": \"text\",\n+              \"norms\": false\n+            }\n+          }\n+        },", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "74cb397c912909af326fed9934e2742c1612ee34"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxMjMwMTUzOA==", "bodyText": "@ruflin Can you dig a bit more into why you're thinking about using runtime fields?\nIf you are worried of failing to index some documents, then maybe we should add ignore_malformed:true to these ip mappings?\nIf you would like to allow users to change their minds, then either runtime fields or concrete fields is fine since we allow runtime fields to shadow the definition of concrete fields, so users would have the leisure of configuring their field differently via a runtime field on existing indices if they wanted to regardless of the decision we would make here.\n@scunningham There is no other way to do it. My understanding of the parallel thread on #68414 is that we would still allow dynamic mappings for trusted endpoints, so I believe that fine-tuning dynamic templates in these base templates still provides value.", "url": "https://github.com/elastic/elasticsearch/pull/64978#discussion_r612301538", "createdAt": "2021-04-13T09:52:16Z", "author": {"login": "jpountz"}, "path": "x-pack/plugin/core/src/main/resources/logs-mappings.json", "diffHunk": "@@ -2,6 +2,25 @@\n   \"template\": {\n     \"mappings\": {\n       \"dynamic_templates\": [\n+        {\n+          \"match_ip\": {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzIxODgzMQ=="}, "originalCommit": {"oid": "74cb397c912909af326fed9934e2742c1612ee34"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NjM4MzU5NjM2", "url": "https://github.com/elastic/elasticsearch/pull/64978#pullrequestreview-638359636", "createdAt": "2021-04-18T19:18:40Z", "commit": {"oid": "74cb397c912909af326fed9934e2742c1612ee34"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "67bed573b22318f2cc655c1337e688d059a1f140", "author": {"user": {"login": "jpountz", "name": "Adrien Grand"}}, "url": "https://github.com/elastic/elasticsearch/commit/67bed573b22318f2cc655c1337e688d059a1f140", "committedDate": "2021-04-21T12:41:26Z", "message": "Merge branch 'master' into path-match-ip-message"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "863bae7820b9b7587f6f4c3565927429a36b0e39", "author": {"user": {"login": "jpountz", "name": "Adrien Grand"}}, "url": "https://github.com/elastic/elasticsearch/commit/863bae7820b9b7587f6f4c3565927429a36b0e39", "committedDate": "2021-04-21T12:41:38Z", "message": "Increment registry version."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5dc16be0b1f4fd2008509553cd67ee46cff0b756", "author": {"user": {"login": "jpountz", "name": "Adrien Grand"}}, "url": "https://github.com/elastic/elasticsearch/commit/5dc16be0b1f4fd2008509553cd67ee46cff0b756", "committedDate": "2021-04-21T12:48:11Z", "message": "Trim message field from metrics and synthetics templates."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9ea0a35bdeb8e2a57734640713dc1bd25a155d76", "author": {"user": {"login": "jpountz", "name": "Adrien Grand"}}, "url": "https://github.com/elastic/elasticsearch/commit/9ea0a35bdeb8e2a57734640713dc1bd25a155d76", "committedDate": "2021-04-21T13:02:33Z", "message": "Fix tests."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4707606f09d81557b875fb7ccccaa61aee870f11", "author": {"user": {"login": "jpountz", "name": "Adrien Grand"}}, "url": "https://github.com/elastic/elasticsearch/commit/4707606f09d81557b875fb7ccccaa61aee870f11", "committedDate": "2021-04-21T13:26:34Z", "message": "Factor conventions that are the same for all types into a single file."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d6eb0afce630f332dc63b61094662de7afcd469a", "author": {"user": {"login": "jpountz", "name": "Adrien Grand"}}, "url": "https://github.com/elastic/elasticsearch/commit/d6eb0afce630f332dc63b61094662de7afcd469a", "committedDate": "2021-04-21T14:04:23Z", "message": "Merge branch 'master' into path-match-ip-message"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NjQxNTc5NzI2", "url": "https://github.com/elastic/elasticsearch/pull/64978#pullrequestreview-641579726", "createdAt": "2021-04-21T21:52:26Z", "commit": {"oid": "d6eb0afce630f332dc63b61094662de7afcd469a"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wNC0yMVQyMTo1MjoyNlrOJNSI0w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wNC0yMVQyMTo1MjoyNlrOJNSI0w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxNzkwODQzNQ==", "bodyText": "This template says it's for general mapping conventions, but this uses synthetics which means this can't be generalized for other types? I think we might need to remove this line since this is used by the logs and metrics templates which previously specified the value as a different value", "url": "https://github.com/elastic/elasticsearch/pull/64978#discussion_r617908435", "createdAt": "2021-04-21T21:52:26Z", "author": {"login": "dakrone"}, "path": "x-pack/plugin/core/src/main/resources/data-streams-mappings.json", "diffHunk": "@@ -0,0 +1,73 @@\n+{\n+  \"template\": {\n+    \"mappings\": {\n+      \"dynamic_templates\": [\n+        {\n+          \"match_ip\": {\n+            \"match_mapping_type\": \"string\",\n+            \"match\": \"ip\",\n+            \"mapping\": {\n+              \"type\": \"ip\"\n+            }\n+          }\n+        },\n+        {\n+          \"strings_as_keyword\": {\n+            \"mapping\": {\n+              \"ignore_above\": 1024,\n+              \"type\": \"keyword\"\n+            },\n+            \"match_mapping_type\": \"string\"\n+          }\n+        }\n+      ],\n+      \"date_detection\": false,\n+      \"properties\": {\n+        \"@timestamp\": {\n+          \"type\": \"date\"\n+        },\n+        \"data_stream\": {\n+          \"properties\": {\n+            \"type\": {\n+              \"type\": \"constant_keyword\",\n+              \"value\": \"synthetics\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d6eb0afce630f332dc63b61094662de7afcd469a"}, "originalPosition": 33}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4c04815ab12d57821189701ac87b47a2e58cd3fe", "author": {"user": {"login": "jpountz", "name": "Adrien Grand"}}, "url": "https://github.com/elastic/elasticsearch/commit/4c04815ab12d57821189701ac87b47a2e58cd3fe", "committedDate": "2021-04-22T07:10:56Z", "message": "Merge remote-tracking branch 'origin/master' into path-match-ip-message"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c9249b5d78d29bfb7f6e32ab214833e168fa392f", "author": {"user": {"login": "jpountz", "name": "Adrien Grand"}}, "url": "https://github.com/elastic/elasticsearch/commit/c9249b5d78d29bfb7f6e32ab214833e168fa392f", "committedDate": "2021-04-22T07:37:50Z", "message": "Fix data_stream type.\n\nAlso move from `text` to `match_only_text`."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "db58ab94f794aa4fa58b17128a951b499c1f8c0a", "author": {"user": {"login": "jpountz", "name": "Adrien Grand"}}, "url": "https://github.com/elastic/elasticsearch/commit/db58ab94f794aa4fa58b17128a951b499c1f8c0a", "committedDate": "2021-04-22T07:40:44Z", "message": "Simplify host and observer mappings."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9950d8b53f7794d75efcb02a13754a8771e73911", "author": {"user": {"login": "jpountz", "name": "Adrien Grand"}}, "url": "https://github.com/elastic/elasticsearch/commit/9950d8b53f7794d75efcb02a13754a8771e73911", "committedDate": "2021-04-22T07:43:30Z", "message": "Fix indentation."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c4cb7fd4137d46979a9256ffd3d18bc726cef04f", "author": {"user": {"login": "jpountz", "name": "Adrien Grand"}}, "url": "https://github.com/elastic/elasticsearch/commit/c4cb7fd4137d46979a9256ffd3d18bc726cef04f", "committedDate": "2021-04-22T16:31:55Z", "message": "Fix test failure."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NjQyNzQ0MjQ3", "url": "https://github.com/elastic/elasticsearch/pull/64978#pullrequestreview-642744247", "createdAt": "2021-04-22T22:31:30Z", "commit": {"oid": "c4cb7fd4137d46979a9256ffd3d18bc726cef04f"}, "state": "APPROVED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wNC0yMlQyMjozMTozMFrOJOHfQQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wNC0yMlQyMjozMjowNVrOJOHg9Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxODc4MjUyOQ==", "bodyText": "I think we should apply the data-streams-mappings settings first, so that any changes made to the logs-mappings component template always take precedence over the generic data stream mappings.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                \"logs-mappings\",\n          \n          \n            \n                \"data-streams-mappings\",\n          \n          \n            \n                \"logs-settings\"\n          \n          \n            \n                \"data-streams-mappings\",\n          \n          \n            \n                \"logs-mappings\",\n          \n          \n            \n                \"logs-settings\"\n          \n      \n    \n    \n  \n\nWhat do you think?", "url": "https://github.com/elastic/elasticsearch/pull/64978#discussion_r618782529", "createdAt": "2021-04-22T22:31:30Z", "author": {"login": "dakrone"}, "path": "x-pack/plugin/core/src/main/resources/logs-template.json", "diffHunk": "@@ -4,6 +4,7 @@\n   \"data_stream\": {},\n   \"composed_of\": [\n     \"logs-mappings\",\n+    \"data-streams-mappings\",\n     \"logs-settings\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c4cb7fd4137d46979a9256ffd3d18bc726cef04f"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxODc4Mjc4NQ==", "bodyText": "Same here with:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                \"metrics-mappings\",\n          \n          \n            \n                \"data-streams-mappings\",\n          \n          \n            \n                \"data-streams-mappings\",\n          \n          \n            \n                \"metrics-mappings\",", "url": "https://github.com/elastic/elasticsearch/pull/64978#discussion_r618782785", "createdAt": "2021-04-22T22:31:50Z", "author": {"login": "dakrone"}, "path": "x-pack/plugin/core/src/main/resources/metrics-template.json", "diffHunk": "@@ -4,6 +4,7 @@\n   \"data_stream\": {},\n   \"composed_of\": [\n     \"metrics-mappings\",\n+    \"data-streams-mappings\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c4cb7fd4137d46979a9256ffd3d18bc726cef04f"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxODc4Mjk2NQ==", "bodyText": "And same here with:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                \"synthetics-mappings\",\n          \n          \n            \n                \"data-streams-mappings\",\n          \n          \n            \n                \"data-streams-mappings\",\n          \n          \n            \n                \"synthetics-mappings\",", "url": "https://github.com/elastic/elasticsearch/pull/64978#discussion_r618782965", "createdAt": "2021-04-22T22:32:05Z", "author": {"login": "dakrone"}, "path": "x-pack/plugin/core/src/main/resources/synthetics-template.json", "diffHunk": "@@ -4,6 +4,7 @@\n   \"data_stream\": {},\n   \"composed_of\": [\n     \"synthetics-mappings\",\n+    \"data-streams-mappings\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c4cb7fd4137d46979a9256ffd3d18bc726cef04f"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NjQzMTk2MTEz", "url": "https://github.com/elastic/elasticsearch/pull/64978#pullrequestreview-643196113", "createdAt": "2021-04-23T11:26:39Z", "commit": {"oid": "c4cb7fd4137d46979a9256ffd3d18bc726cef04f"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wNC0yM1QxMToyNjozOVrOJOdqdQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wNC0yM1QxMToyNzoxMlrOJOdrnA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxOTE0NTg0NQ==", "bodyText": "I think we could leave this one out.", "url": "https://github.com/elastic/elasticsearch/pull/64978#discussion_r619145845", "createdAt": "2021-04-23T11:26:39Z", "author": {"login": "ruflin"}, "path": "x-pack/plugin/core/src/main/resources/data-streams-mappings.json", "diffHunk": "@@ -0,0 +1,61 @@\n+{\n+  \"template\": {\n+    \"mappings\": {\n+      \"dynamic_templates\": [\n+        {\n+          \"match_ip\": {\n+            \"match_mapping_type\": \"string\",\n+            \"match\": \"ip\",\n+            \"mapping\": {\n+              \"type\": \"ip\"\n+            }\n+          }\n+        },\n+        {\n+          \"strings_as_keyword\": {\n+            \"mapping\": {\n+              \"ignore_above\": 1024,\n+              \"type\": \"keyword\"\n+            },\n+            \"match_mapping_type\": \"string\"\n+          }\n+        }\n+      ],\n+      \"date_detection\": false,\n+      \"properties\": {\n+        \"@timestamp\": {\n+          \"type\": \"date\"\n+        },\n+        \"data_stream\": {\n+          \"properties\": {\n+            \"dataset\": {\n+              \"type\": \"constant_keyword\"\n+            },\n+            \"namespace\": {\n+              \"type\": \"constant_keyword\"\n+            }\n+          }\n+        },\n+        \"ecs\": {\n+          \"properties\": {\n+            \"version\": {\n+              \"ignore_above\": 1024,\n+              \"type\": \"keyword\"\n+            }\n+          }\n+        },\n+        \"host\": {\n+          \"type\": \"object\"\n+        },\n+        \"observer\": {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c4cb7fd4137d46979a9256ffd3d18bc726cef04f"}, "originalPosition": 50}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxOTE0NjE0MA==", "bodyText": "Is this a breaking change?", "url": "https://github.com/elastic/elasticsearch/pull/64978#discussion_r619146140", "createdAt": "2021-04-23T11:27:12Z", "author": {"login": "ruflin"}, "path": "x-pack/plugin/core/src/main/resources/logs-mappings.json", "diffHunk": "@@ -3,51 +3,23 @@\n     \"mappings\": {\n       \"dynamic_templates\": [\n         {\n-          \"strings_as_keyword\": {\n+          \"match_message\": {\n+            \"match_mapping_type\": \"string\",\n+            \"match\": \"message\",\n             \"mapping\": {\n-              \"ignore_above\": 1024,\n-              \"type\": \"keyword\"\n-            },\n-            \"match_mapping_type\": \"string\"\n+              \"type\": \"match_only_text\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c4cb7fd4137d46979a9256ffd3d18bc726cef04f"}, "originalPosition": 13}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f7376e504d8eeec4bcee2eb1f26faa5f99ae9852", "author": {"user": {"login": "jpountz", "name": "Adrien Grand"}}, "url": "https://github.com/elastic/elasticsearch/commit/f7376e504d8eeec4bcee2eb1f26faa5f99ae9852", "committedDate": "2021-05-03T09:34:20Z", "message": "Move `message` dynamic template to the shared mapping template."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "42c9f58cfe8bc02bf9d66383597bc54919a53245", "author": {"user": {"login": "jpountz", "name": "Adrien Grand"}}, "url": "https://github.com/elastic/elasticsearch/commit/42c9f58cfe8bc02bf9d66383597bc54919a53245", "committedDate": "2021-05-03T09:35:40Z", "message": "Remove `observer` field."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "89eb06d324a81c39d99cf43b976d6037e03c7a71", "author": {"user": {"login": "jpountz", "name": "Adrien Grand"}}, "url": "https://github.com/elastic/elasticsearch/commit/89eb06d324a81c39d99cf43b976d6037e03c7a71", "committedDate": "2021-05-04T12:51:47Z", "message": "Merge branch 'master' into path-match-ip-message"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1045, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}