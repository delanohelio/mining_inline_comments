{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQxNDg1MzM3", "number": 58679, "title": "[DOCS] Document delete/update by query for data streams", "bodyText": "Updates docs to indicate the delete/update by query APIs\nsupports data streams.\nRelates to #58590.", "createdAt": "2020-06-29T15:18:45Z", "url": "https://github.com/elastic/elasticsearch/pull/58679", "merged": true, "mergeCommit": {"oid": "55e2ec6248259d64beadaf1e205defa29be6153f"}, "closed": true, "closedAt": "2020-06-29T20:31:38Z", "author": {"login": "jrodewig"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcwCw3hAH2gAyNDQxNDg1MzM3OjliYmUzYWRmZDVjNWYxNzFhODgyZjA5NWVmODIyNTc4OWFjYzU2MGE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcwGx01AH2gAyNDQxNDg1MzM3OmUxMTFkZmEzMjJhMWRhNTc0MTRiNWY5N2ZiZGI0MmU1MjhlZGQ3NDE=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "9bbe3adfd5c5f171a882f095ef8225789acc560a", "author": {"user": {"login": "jrodewig", "name": "James Rodewig"}}, "url": "https://github.com/elastic/elasticsearch/commit/9bbe3adfd5c5f171a882f095ef8225789acc560a", "committedDate": "2020-06-29T15:27:38Z", "message": "[DOCS] Document delete/update by query for data streams"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "9e0850eee7e73b2797b7d5ac9f8d301d178a426b", "author": {"user": {"login": "jrodewig", "name": "James Rodewig"}}, "url": "https://github.com/elastic/elasticsearch/commit/9e0850eee7e73b2797b7d5ac9f8d301d178a426b", "committedDate": "2020-06-29T15:12:35Z", "message": "[DOCS] Document delete/update by query for data streams"}, "afterCommit": {"oid": "9bbe3adfd5c5f171a882f095ef8225789acc560a", "author": {"user": {"login": "jrodewig", "name": "James Rodewig"}}, "url": "https://github.com/elastic/elasticsearch/commit/9bbe3adfd5c5f171a882f095ef8225789acc560a", "committedDate": "2020-06-29T15:27:38Z", "message": "[DOCS] Document delete/update by query for data streams"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM5MjkzNTk2", "url": "https://github.com/elastic/elasticsearch/pull/58679#pullrequestreview-439293596", "createdAt": "2020-06-29T16:06:09Z", "commit": {"oid": "9bbe3adfd5c5f171a882f095ef8225789acc560a"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yOVQxNjowNjowOVrOGqX5QA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yOVQxNjowNjo1NlrOGqX7JA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzA4NDg2NA==", "bodyText": "Minor: I thought the \"Update by query API requests containing...\" sequence read a little oddly.", "url": "https://github.com/elastic/elasticsearch/pull/58679#discussion_r447084864", "createdAt": "2020-06-29T16:06:09Z", "author": {"login": "danhermann"}, "path": "docs/reference/data-streams/use-a-data-stream.asciidoc", "diffHunk": "@@ -426,12 +431,98 @@ POST /_reindex\n [[update-delete-docs-in-a-data-stream]]\n === Update or delete documents in a data stream\n \n-Data streams are designed to be <<data-streams-append-only,append-only>>. This\n-means you cannot send update or deletion requests for existing documents to a\n-data stream. However, you can send update or deletion requests to the backing\n-index containing the document.\n+You can use the following requests to update or delete documents in a data\n+stream:\n+\n+* <<docs-update-by-query,Update by query API>> requests containing a query", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9bbe3adfd5c5f171a882f095ef8225789acc560a"}, "originalPosition": 30}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzA4NTM0OA==", "bodyText": "Minor: Same as above, I thought the \"Delete by query API requests containing...\" sequence was a little odd.", "url": "https://github.com/elastic/elasticsearch/pull/58679#discussion_r447085348", "createdAt": "2020-06-29T16:06:56Z", "author": {"login": "danhermann"}, "path": "docs/reference/data-streams/use-a-data-stream.asciidoc", "diffHunk": "@@ -426,12 +431,98 @@ POST /_reindex\n [[update-delete-docs-in-a-data-stream]]\n === Update or delete documents in a data stream\n \n-Data streams are designed to be <<data-streams-append-only,append-only>>. This\n-means you cannot send update or deletion requests for existing documents to a\n-data stream. However, you can send update or deletion requests to the backing\n-index containing the document.\n+You can use the following requests to update or delete documents in a data\n+stream:\n+\n+* <<docs-update-by-query,Update by query API>> requests containing a query\n+that matches documents in the data stream you'd like to update.\n++\n+.*Example*\n+[%collapsible]\n+====\n+The following update by query API request updates documents in the `logs` data\n+stream with a `user.id` of `i96BP1mA`. The request uses a\n+<<modules-scripting-using,script>> to assign matching documents a new `user.id`\n+value of `XgdX0NoX`.\n+\n+////\n+[source,console]\n+----\n+PUT /logs/_create/2?refresh=wait_for\n+{\n+  \"@timestamp\": \"2020-12-07T11:06:07.000Z\",\n+  \"user\": {\n+    \"id\": \"i96BP1mA\"\n+  }\n+}\n+----\n+// TEST[continued]\n+////\n+\n+[source,console]\n+----\n+POST /logs/_update_by_query\n+{\n+  \"query\": {\n+    \"match\": {\n+      \"user.id\": \"i96BP1mA\"\n+    }\n+  },\n+  \"script\": {\n+    \"source\": \"ctx._source.user.id = params.new_id\",\n+    \"params\": {\n+      \"new_id\": \"XgdX0NoX\"\n+    }\n+  }\n+}\n+----\n+// TEST[continued]\n+====\n+\n+* <<docs-delete-by-query,Delete by query API>> requests containing a query", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9bbe3adfd5c5f171a882f095ef8225789acc560a"}, "originalPosition": 75}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e111dfa322a1da57414b5f97fbdb42e528edd741", "author": {"user": {"login": "jrodewig", "name": "James Rodewig"}}, "url": "https://github.com/elastic/elasticsearch/commit/e111dfa322a1da57414b5f97fbdb42e528edd741", "committedDate": "2020-06-29T20:08:18Z", "message": "reword"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2544, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}