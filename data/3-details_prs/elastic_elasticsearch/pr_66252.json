{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTM5NDUyNzE0", "number": 66252, "title": "SQL: Enable adding missing equals to bool fields as filters", "bodyText": "This PR adds QL's AnalyzerRules.AddMissingEqualsToBoolField to SQL's analyser as well.\nCloses #65579.", "createdAt": "2020-12-14T13:29:03Z", "url": "https://github.com/elastic/elasticsearch/pull/66252", "merged": true, "mergeCommit": {"oid": "ea137f96793568cc80c1e6763ce6b6efb400d506"}, "closed": true, "closedAt": "2020-12-15T14:27:45Z", "author": {"login": "bpintea"}, "timelineItems": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdmFs3IgH2gAyNTM5NDUyNzE0OmIzOTAxNmZkOWUxMGYzOTI2ZjdhOTYzZGM5YzNlYTU5ODA4OTdiOWE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdma56sgFqTU1MjQ5MzM0Mw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "b39016fd9e10f3926f7a963dc9c3ea5980897b9a", "author": {"user": {"login": "bpintea", "name": "Bogdan Pintea"}}, "url": "https://github.com/elastic/elasticsearch/commit/b39016fd9e10f3926f7a963dc9c3ea5980897b9a", "committedDate": "2020-12-14T13:24:53Z", "message": "Enable the AddMissingEqualsToBoolField rule in SQL\n\nThis will enable QL's AnalyzerRules.AddMissingEqualsToBoolField to SQL's\nanalyzer as well."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUxNTUwNjE1", "url": "https://github.com/elastic/elasticsearch/pull/66252#pullrequestreview-551550615", "createdAt": "2020-12-14T16:25:29Z", "commit": {"oid": "b39016fd9e10f3926f7a963dc9c3ea5980897b9a"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNFQxNjoyNTozMFrOIFYwvg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNFQxNjoyNTozMFrOIFYwvg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjUxOTQ4Ng==", "bodyText": "The rule could check whether the Filter is resolved before applying the equality.", "url": "https://github.com/elastic/elasticsearch/pull/66252#discussion_r542519486", "createdAt": "2020-12-14T16:25:30Z", "author": {"login": "costin"}, "path": "x-pack/plugin/ql/src/main/java/org/elasticsearch/xpack/ql/analyzer/AnalyzerRules.java", "diffHunk": "@@ -39,7 +40,7 @@ protected LogicalPlan rule(Filter filter) {\n         }\n \n         private Expression replaceRawBoolFieldWithEquals(Expression e) {\n-            if (e instanceof FieldAttribute) {\n+            if (e instanceof FieldAttribute && e.dataType() == BOOLEAN) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b39016fd9e10f3926f7a963dc9c3ea5980897b9a"}, "originalPosition": 13}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a5a6189a7702d8e7a43ed46de84c6ca4fe81a5dc", "author": {"user": {"login": "bpintea", "name": "Bogdan Pintea"}}, "url": "https://github.com/elastic/elasticsearch/commit/a5a6189a7702d8e7a43ed46de84c6ca4fe81a5dc", "committedDate": "2020-12-14T16:29:13Z", "message": "Fix: check type resolution before type's val\n\nMake sure a fields's type is available before checking it's value."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUxNTg3NDUy", "url": "https://github.com/elastic/elasticsearch/pull/66252#pullrequestreview-551587452", "createdAt": "2020-12-14T16:43:50Z", "commit": {"oid": "a5a6189a7702d8e7a43ed46de84c6ca4fe81a5dc"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6b2a6ee7ec45bf91d7b545610e9a7961265f2a06", "author": {"user": {"login": "bpintea", "name": "Bogdan Pintea"}}, "url": "https://github.com/elastic/elasticsearch/commit/6b2a6ee7ec45bf91d7b545610e9a7961265f2a06", "committedDate": "2020-12-14T18:20:59Z", "message": "Rework the way resolution is checked\n\nCheck on filter's resolution part of the rule() method, before any other\nchange is applied."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fcd726b93228a9a15f141b12268c3f9e56e8fac8", "author": {"user": {"login": "elasticmachine", "name": "Elastic Machine"}}, "url": "https://github.com/elastic/elasticsearch/commit/fcd726b93228a9a15f141b12268c3f9e56e8fac8", "committedDate": "2020-12-15T09:32:56Z", "message": "Merge branch 'master' into enh/add_missing_eq_to_bool"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUyMjc3OTEw", "url": "https://github.com/elastic/elasticsearch/pull/66252#pullrequestreview-552277910", "createdAt": "2020-12-15T09:52:41Z", "commit": {"oid": "fcd726b93228a9a15f141b12268c3f9e56e8fac8"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNVQwOTo1Mjo0MVrOIGCQIg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNVQwOTo1Mjo0MVrOIGCQIg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzE5OTI2Ng==", "bodyText": "Maybe I'm missing some context, but what happens to nested expressions like: WHERE a > 1 and (bool or b < 2) or (c = 3 and bool), could we have a test for that as well?", "url": "https://github.com/elastic/elasticsearch/pull/66252#discussion_r543199266", "createdAt": "2020-12-15T09:52:41Z", "author": {"login": "matriv"}, "path": "x-pack/plugin/sql/src/test/java/org/elasticsearch/xpack/sql/planner/QueryTranslatorTests.java", "diffHunk": "@@ -2459,4 +2461,33 @@ public void testReplaceSumWithStats() {\n             assertThat(eqe.queryContainer().toString().replaceAll(\"\\\\s+\", \"\"), containsString(\"{\\\"stats\\\":{\\\"field\\\":\\\"int\\\"}}\"));\n         }\n     }\n+\n+    public void testAddMissingEqualsToBoolField() {\n+        LogicalPlan p = plan(\"SELECT bool FROM test WHERE bool\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fcd726b93228a9a15f141b12268c3f9e56e8fac8"}, "originalPosition": 22}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5f24d3239095002e97b061f384f8db0490af8564", "author": {"user": {"login": "bpintea", "name": "Bogdan Pintea"}}, "url": "https://github.com/elastic/elasticsearch/commit/5f24d3239095002e97b061f384f8db0490af8564", "committedDate": "2020-12-15T13:28:21Z", "message": "Add test with nested bool\n\nAdd one SQL test with nested \"free-floating\" bool that got assigned a\ntrue literal."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "28f79e44bfd1dd2c0504c9c9ede846eb93619df9", "author": {"user": {"login": "bpintea", "name": "Bogdan Pintea"}}, "url": "https://github.com/elastic/elasticsearch/commit/28f79e44bfd1dd2c0504c9c9ede846eb93619df9", "committedDate": "2020-12-15T13:29:37Z", "message": "Merge branch 'enh/add_missing_eq_to_bool' of github.com:bpintea/elasticsearch into enh/add_missing_eq_to_bool"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1b4c6ddbf5628b3338839aa7c0a9d567c576e2b5", "author": {"user": {"login": "elasticmachine", "name": "Elastic Machine"}}, "url": "https://github.com/elastic/elasticsearch/commit/1b4c6ddbf5628b3338839aa7c0a9d567c576e2b5", "committedDate": "2020-12-15T13:31:22Z", "message": "Merge branch 'master' into enh/add_missing_eq_to_bool"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "076d526edca56c44ba1a95cf81e06424732a25f4", "author": {"user": {"login": "bpintea", "name": "Bogdan Pintea"}}, "url": "https://github.com/elastic/elasticsearch/commit/076d526edca56c44ba1a95cf81e06424732a25f4", "committedDate": "2020-12-15T13:43:25Z", "message": "Style fix\n\n- minor style fix."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUyNDkzMzQz", "url": "https://github.com/elastic/elasticsearch/pull/66252#pullrequestreview-552493343", "createdAt": "2020-12-15T14:07:09Z", "commit": {"oid": "076d526edca56c44ba1a95cf81e06424732a25f4"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4616, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}