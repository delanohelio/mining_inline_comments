{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTMxMjk0MDc0", "number": 65778, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wMlQyMjo0MDo0N1rOE_1x-g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOVQxNzoxMjozNlrOFDCe2g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM1Mzc2ODkwOnYy", "diffSide": "RIGHT", "path": "distribution/docker/src/docker/bin/docker-entrypoint.sh", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wMlQyMjo0MDo0N1rOH9xKvQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wM1QxMjowNTowNVrOH-YD_A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDUzMDc0OQ==", "bodyText": "I'm not in love with this name. It doesn't really mean anything from a user perspective. I'd be more inclined to call this file or disk.", "url": "https://github.com/elastic/elasticsearch/pull/65778#discussion_r534530749", "createdAt": "2020-12-02T22:40:47Z", "author": {"login": "mark-vieira"}, "path": "distribution/docker/src/docker/bin/docker-entrypoint.sh", "diffHunk": "@@ -57,6 +57,21 @@ if [[ -f bin/elasticsearch-users ]]; then\n   fi\n fi\n \n+if [[ -n \"$ES_LOG_STYLE\" ]]; then\n+  case \"$ES_LOG_STYLE\" in\n+    docker)\n+      # This is the default. Nothing to do.\n+      ;;\n+    stack)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a978be7a589bef7c98c7a77c681c7177dd18aafc"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTE2Nzk5Ng==", "bodyText": "Agreed, I've swapped to console and `file.", "url": "https://github.com/elastic/elasticsearch/pull/65778#discussion_r535167996", "createdAt": "2020-12-03T12:05:05Z", "author": {"login": "pugnascotia"}, "path": "distribution/docker/src/docker/bin/docker-entrypoint.sh", "diffHunk": "@@ -57,6 +57,21 @@ if [[ -f bin/elasticsearch-users ]]; then\n   fi\n fi\n \n+if [[ -n \"$ES_LOG_STYLE\" ]]; then\n+  case \"$ES_LOG_STYLE\" in\n+    docker)\n+      # This is the default. Nothing to do.\n+      ;;\n+    stack)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDUzMDc0OQ=="}, "originalCommit": {"oid": "a978be7a589bef7c98c7a77c681c7177dd18aafc"}, "originalPosition": 9}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM4NzI5ODA3OnYy", "diffSide": "RIGHT", "path": "distribution/docker/build.gradle", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOVQxNzoxMDo1MFrOICfzkA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOVQxNzoxMDo1MFrOICfzkA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTQ4OTE2OA==", "bodyText": "Can you elaborate what can't be cached here?", "url": "https://github.com/elastic/elasticsearch/pull/65778#discussion_r539489168", "createdAt": "2020-12-09T17:10:50Z", "author": {"login": "breskeby"}, "path": "distribution/docker/build.gradle", "diffHunk": "@@ -21,13 +21,33 @@ configurations {\n   dockerSource\n   aarch64OssDockerSource\n   ossDockerSource\n+  transformLog4jJar\n }\n \n dependencies {\n   aarch64DockerSource project(path: \":distribution:archives:linux-aarch64-tar\", configuration:\"default\")\n   dockerSource project(path: \":distribution:archives:linux-tar\", configuration:\"default\")\n   aarch64OssDockerSource project(path: \":distribution:archives:oss-linux-aarch64-tar\", configuration:\"default\")\n   ossDockerSource project(path: \":distribution:archives:oss-linux-tar\", configuration:\"default\")\n+  transformLog4jJar project(path: \":distribution:docker:transform-log4j-config\", configuration: \"default\")\n+}\n+\n+/**\n+ * Used in the Dockerfile template to wrap commands in a retry loop. It can't be\n+ * a closure because Gradle can't effectively cache those.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6cff1aaf6b8bebe321014bff1d7551ad8ff0a373"}, "originalPosition": 17}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM4NzMwNDM2OnYy", "diffSide": "RIGHT", "path": "distribution/docker/build.gradle", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOVQxNzoxMjowN1rOICf3YA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOVQxNzoxMjowN1rOICf3YA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTQ5MDE0NA==", "bodyText": "In general I'm in favour to have class definitions living in buildSrc somewhere no matter how small they are. To keep our build scripts a bit cleaner and smaller. Also these classes should change less often than the script itself.", "url": "https://github.com/elastic/elasticsearch/pull/65778#discussion_r539490144", "createdAt": "2020-12-09T17:12:07Z", "author": {"login": "breskeby"}, "path": "distribution/docker/build.gradle", "diffHunk": "@@ -21,13 +21,33 @@ configurations {\n   dockerSource\n   aarch64OssDockerSource\n   ossDockerSource\n+  transformLog4jJar\n }\n \n dependencies {\n   aarch64DockerSource project(path: \":distribution:archives:linux-aarch64-tar\", configuration:\"default\")\n   dockerSource project(path: \":distribution:archives:linux-tar\", configuration:\"default\")\n   aarch64OssDockerSource project(path: \":distribution:archives:oss-linux-aarch64-tar\", configuration:\"default\")\n   ossDockerSource project(path: \":distribution:archives:oss-linux-tar\", configuration:\"default\")\n+  transformLog4jJar project(path: \":distribution:docker:transform-log4j-config\", configuration: \"default\")\n+}\n+\n+/**\n+ * Used in the Dockerfile template to wrap commands in a retry loop. It can't be\n+ * a closure because Gradle can't effectively cache those.\n+ */\n+class Retry {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6cff1aaf6b8bebe321014bff1d7551ad8ff0a373"}, "originalPosition": 19}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM4NzMwNzE0OnYy", "diffSide": "RIGHT", "path": "distribution/docker/build.gradle", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOVQxNzoxMjozNlrOICf49w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOVQxNzoxMjozNlrOICf49w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTQ5MDU1MQ==", "bodyText": "I think the , is too much here", "url": "https://github.com/elastic/elasticsearch/pull/65778#discussion_r539490551", "createdAt": "2020-12-09T17:12:36Z", "author": {"login": "breskeby"}, "path": "distribution/docker/build.gradle", "diffHunk": "@@ -100,7 +108,7 @@ ${indent}${exitKeyword} \\$exit_code\"\"\"\n     'docker_base'         : base.name().toLowerCase(),\n     'version'             : VersionProperties.elasticsearch,\n     'major_minor_version' : \"${major}.${minor}\",\n-    'retry_loop'          : retry_loop\n+    'retry'               : Retry,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6cff1aaf6b8bebe321014bff1d7551ad8ff0a373"}, "originalPosition": 58}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1818, "cost": 1, "resetAt": "2021-11-12T11:57:46Z"}}}