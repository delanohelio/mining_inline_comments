{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDEzMDQ4Mjc4", "number": 56125, "reviewThreads": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNFQxODoyNDo1OVrOD5HC-Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNVQxMDozOTozMlrOD5WJgg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYxMjEwODczOnYy", "diffSide": "RIGHT", "path": "docs/reference/ml/ml-shared.asciidoc", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNFQxODoyNDo1OVrOGQMoMw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNFQxOTo0MDo0MlrOGQPVKw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTYzNzI5OQ==", "bodyText": "Docs should be updated for tag::model-snapshot-retention-days[] as it says the default value is 1.", "url": "https://github.com/elastic/elasticsearch/pull/56125#discussion_r419637299", "createdAt": "2020-05-04T18:24:59Z", "author": {"login": "benwtrent"}, "path": "docs/reference/ml/ml-shared.asciidoc", "diffHunk": "@@ -361,6 +361,19 @@ example, it can contain custom URL information as shown in\n {ml-docs}/ml-configuring-url.html[Adding custom URLs to {ml} results].\n end::custom-settings[]\n \n+tag::daily-model-snapshot-retention-after-days[]\n+Advanced configuration option. A number of days in between 0 and the value of\n+`model_snapshot_retention_days` after which only one model snapshot per day\n+is retained instead of all model snapshots. Age is calculated relative to the\n+timestamp of the newest model snapshot. The default value is `1` for newly\n+created jobs, which means that all snapshots are retained for one day but\n+older snapshots are thinned out such that only one per day is retained until\n+`model_snapshot_retention_days`. For jobs that were created before this\n+setting was available, the default is the same as that job's\n+`model_snapshot_retention_days` setting, to preserve the original behavior\n+that no thinning out of model snapshots is done.\n+end::daily-model-snapshot-retention-after-days[]", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8d03124ba36b247f0d7f8582469e4068d126db79"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTY4MTU3OQ==", "bodyText": "I've added that change in a commit.", "url": "https://github.com/elastic/elasticsearch/pull/56125#discussion_r419681579", "createdAt": "2020-05-04T19:40:42Z", "author": {"login": "lcawl"}, "path": "docs/reference/ml/ml-shared.asciidoc", "diffHunk": "@@ -361,6 +361,19 @@ example, it can contain custom URL information as shown in\n {ml-docs}/ml-configuring-url.html[Adding custom URLs to {ml} results].\n end::custom-settings[]\n \n+tag::daily-model-snapshot-retention-after-days[]\n+Advanced configuration option. A number of days in between 0 and the value of\n+`model_snapshot_retention_days` after which only one model snapshot per day\n+is retained instead of all model snapshots. Age is calculated relative to the\n+timestamp of the newest model snapshot. The default value is `1` for newly\n+created jobs, which means that all snapshots are retained for one day but\n+older snapshots are thinned out such that only one per day is retained until\n+`model_snapshot_retention_days`. For jobs that were created before this\n+setting was available, the default is the same as that job's\n+`model_snapshot_retention_days` setting, to preserve the original behavior\n+that no thinning out of model snapshots is done.\n+end::daily-model-snapshot-retention-after-days[]", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTYzNzI5OQ=="}, "originalCommit": {"oid": "8d03124ba36b247f0d7f8582469e4068d126db79"}, "originalPosition": 15}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYxMjEzNzY4OnYy", "diffSide": "RIGHT", "path": "x-pack/plugin/ml/qa/native-multi-node-tests/src/test/java/org/elasticsearch/xpack/ml/integration/ModelSnapshotRetentionIT.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNFQxODozMjoxM1rOGQM5sQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNVQwODozMTowMFrOGQfbgQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTY0MTc3Nw==", "bodyText": "#nit, do these tests NEED to be the native-multi-node-tests? These take a while to spin-up and run.", "url": "https://github.com/elastic/elasticsearch/pull/56125#discussion_r419641777", "createdAt": "2020-05-04T18:32:13Z", "author": {"login": "benwtrent"}, "path": "x-pack/plugin/ml/qa/native-multi-node-tests/src/test/java/org/elasticsearch/xpack/ml/integration/ModelSnapshotRetentionIT.java", "diffHunk": "@@ -0,0 +1,234 @@\n+/*\n+ * Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one\n+ * or more contributor license agreements. Licensed under the Elastic License;\n+ * you may not use this file except in compliance with the Elastic License.\n+ */\n+\n+package org.elasticsearch.xpack.ml.integration;\n+\n+import org.elasticsearch.action.DocWriteResponse;\n+import org.elasticsearch.action.bulk.BulkAction;\n+import org.elasticsearch.action.bulk.BulkRequest;\n+import org.elasticsearch.action.bulk.BulkResponse;\n+import org.elasticsearch.action.index.IndexAction;\n+import org.elasticsearch.action.index.IndexRequest;\n+import org.elasticsearch.action.index.IndexResponse;\n+import org.elasticsearch.action.search.SearchAction;\n+import org.elasticsearch.action.search.SearchRequest;\n+import org.elasticsearch.action.search.SearchResponse;\n+import org.elasticsearch.action.support.WriteRequest;\n+import org.elasticsearch.common.unit.TimeValue;\n+import org.elasticsearch.common.xcontent.ToXContent;\n+import org.elasticsearch.common.xcontent.XContentBuilder;\n+import org.elasticsearch.common.xcontent.json.JsonXContent;\n+import org.elasticsearch.index.query.QueryBuilder;\n+import org.elasticsearch.index.query.QueryBuilders;\n+import org.elasticsearch.search.SearchHit;\n+import org.elasticsearch.search.builder.SearchSourceBuilder;\n+import org.elasticsearch.xpack.core.ml.action.PutJobAction;\n+import org.elasticsearch.xpack.core.ml.action.UpdateJobAction;\n+import org.elasticsearch.xpack.core.ml.job.config.AnalysisConfig;\n+import org.elasticsearch.xpack.core.ml.job.config.DataDescription;\n+import org.elasticsearch.xpack.core.ml.job.config.Detector;\n+import org.elasticsearch.xpack.core.ml.job.config.Job;\n+import org.elasticsearch.xpack.core.ml.job.config.JobUpdate;\n+import org.elasticsearch.xpack.core.ml.job.persistence.AnomalyDetectorsIndex;\n+import org.elasticsearch.xpack.core.ml.job.process.autodetect.state.ModelSnapshot;\n+import org.elasticsearch.xpack.core.ml.job.process.autodetect.state.ModelState;\n+import org.junit.After;\n+\n+import java.io.IOException;\n+import java.util.ArrayList;\n+import java.util.Collections;\n+import java.util.Date;\n+import java.util.List;\n+\n+import static org.hamcrest.Matchers.greaterThan;\n+import static org.hamcrest.Matchers.is;\n+import static org.hamcrest.Matchers.notNullValue;\n+\n+public class ModelSnapshotRetentionIT extends MlNativeAutodetectIntegTestCase {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8d03124ba36b247f0d7f8582469e4068d126db79"}, "originalPosition": 50}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTk0NTM0NQ==", "bodyText": "They don't NEED to be multi-node tests, but I think they need to be external cluster tests.\nI initially tried adding the integration test as an internal cluster test, but that didn't work because delete-by-query didn't work in the internal cluster tests.\nWe have a single node external cluster test suite too but I am not sure there is a huge performance benefit in moving the test here.  Also, over the years we've found numerous bugs in our multi-node clusters caused by differences between requests getting sent directly to the master node and requests getting sent to a non-master node, so I don't think it hurts to have a bit more coverage of inter-node communications.", "url": "https://github.com/elastic/elasticsearch/pull/56125#discussion_r419945345", "createdAt": "2020-05-05T08:31:00Z", "author": {"login": "droberts195"}, "path": "x-pack/plugin/ml/qa/native-multi-node-tests/src/test/java/org/elasticsearch/xpack/ml/integration/ModelSnapshotRetentionIT.java", "diffHunk": "@@ -0,0 +1,234 @@\n+/*\n+ * Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one\n+ * or more contributor license agreements. Licensed under the Elastic License;\n+ * you may not use this file except in compliance with the Elastic License.\n+ */\n+\n+package org.elasticsearch.xpack.ml.integration;\n+\n+import org.elasticsearch.action.DocWriteResponse;\n+import org.elasticsearch.action.bulk.BulkAction;\n+import org.elasticsearch.action.bulk.BulkRequest;\n+import org.elasticsearch.action.bulk.BulkResponse;\n+import org.elasticsearch.action.index.IndexAction;\n+import org.elasticsearch.action.index.IndexRequest;\n+import org.elasticsearch.action.index.IndexResponse;\n+import org.elasticsearch.action.search.SearchAction;\n+import org.elasticsearch.action.search.SearchRequest;\n+import org.elasticsearch.action.search.SearchResponse;\n+import org.elasticsearch.action.support.WriteRequest;\n+import org.elasticsearch.common.unit.TimeValue;\n+import org.elasticsearch.common.xcontent.ToXContent;\n+import org.elasticsearch.common.xcontent.XContentBuilder;\n+import org.elasticsearch.common.xcontent.json.JsonXContent;\n+import org.elasticsearch.index.query.QueryBuilder;\n+import org.elasticsearch.index.query.QueryBuilders;\n+import org.elasticsearch.search.SearchHit;\n+import org.elasticsearch.search.builder.SearchSourceBuilder;\n+import org.elasticsearch.xpack.core.ml.action.PutJobAction;\n+import org.elasticsearch.xpack.core.ml.action.UpdateJobAction;\n+import org.elasticsearch.xpack.core.ml.job.config.AnalysisConfig;\n+import org.elasticsearch.xpack.core.ml.job.config.DataDescription;\n+import org.elasticsearch.xpack.core.ml.job.config.Detector;\n+import org.elasticsearch.xpack.core.ml.job.config.Job;\n+import org.elasticsearch.xpack.core.ml.job.config.JobUpdate;\n+import org.elasticsearch.xpack.core.ml.job.persistence.AnomalyDetectorsIndex;\n+import org.elasticsearch.xpack.core.ml.job.process.autodetect.state.ModelSnapshot;\n+import org.elasticsearch.xpack.core.ml.job.process.autodetect.state.ModelState;\n+import org.junit.After;\n+\n+import java.io.IOException;\n+import java.util.ArrayList;\n+import java.util.Collections;\n+import java.util.Date;\n+import java.util.List;\n+\n+import static org.hamcrest.Matchers.greaterThan;\n+import static org.hamcrest.Matchers.is;\n+import static org.hamcrest.Matchers.notNullValue;\n+\n+public class ModelSnapshotRetentionIT extends MlNativeAutodetectIntegTestCase {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTY0MTc3Nw=="}, "originalCommit": {"oid": "8d03124ba36b247f0d7f8582469e4068d126db79"}, "originalPosition": 50}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYxMjM5MjI1OnYy", "diffSide": "RIGHT", "path": "docs/reference/ml/ml-shared.asciidoc", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNFQxOTo0MjowMFrOGQPYLQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNFQxOTo0MjowMFrOGQPYLQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTY4MjM0OQ==", "bodyText": "Should we clarify which snapshot is retained?\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            value of `model_snapshot_retention_days`. After this period of time, only one\n          \n          \n            \n            value of `model_snapshot_retention_days`. After this period of time, only the first", "url": "https://github.com/elastic/elasticsearch/pull/56125#discussion_r419682349", "createdAt": "2020-05-04T19:42:00Z", "author": {"login": "lcawl"}, "path": "docs/reference/ml/ml-shared.asciidoc", "diffHunk": "@@ -361,6 +361,18 @@ example, it can contain custom URL information as shown in\n {ml-docs}/ml-configuring-url.html[Adding custom URLs to {ml} results].\n end::custom-settings[]\n \n+tag::daily-model-snapshot-retention-after-days[]\n+Advanced configuration option. Specifies a number of days between 0 and the\n+value of `model_snapshot_retention_days`. After this period of time, only one", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3e7bf0e0a6c26886920e968367795e41d1c0d52a"}, "originalPosition": 6}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYxMjM5Nzc3OnYy", "diffSide": "RIGHT", "path": "docs/reference/ml/ml-shared.asciidoc", "isResolved": false, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNFQxOTo0MzozMFrOGQPbsg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wN1QxMDozOToxM1rOGR4uHg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTY4MzI1MA==", "bodyText": "Age is calculated relative to the timestamp of the newest model snapshot...\n\nIs this sentence needed?  If yes, it's unclear to me what this age affects.", "url": "https://github.com/elastic/elasticsearch/pull/56125#discussion_r419683250", "createdAt": "2020-05-04T19:43:30Z", "author": {"login": "lcawl"}, "path": "docs/reference/ml/ml-shared.asciidoc", "diffHunk": "@@ -361,6 +361,18 @@ example, it can contain custom URL information as shown in\n {ml-docs}/ml-configuring-url.html[Adding custom URLs to {ml} results].\n end::custom-settings[]\n \n+tag::daily-model-snapshot-retention-after-days[]\n+Advanced configuration option. Specifies a number of days between 0 and the\n+value of `model_snapshot_retention_days`. After this period of time, only one\n+model snapshot per day is retained for this job. Age is calculated relative to", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3e7bf0e0a6c26886920e968367795e41d1c0d52a"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTk1Njk2NA==", "bodyText": "I think something is needed.  Not sure how best to phrase it though.\nSuppose you have the following model snapshots:\n\nTuesday 9:04 am\nMonday 10:39 am\nSunday 9:03 am\nSaturday 10:46 pm\nFriday 8:02 pm\nFriday 7:49 pm\nFriday 8:59 am\nThursday 9:04 am\n\nAnd suppose model_snapshot_retention_days is 4 and daily_model_snapshot_retention_after_days is 2.\nThen we will delete all snapshots older than Friday 9:04 am (= Tuesday 9:04 am - 4 days).  So we will delete snapshots 7 and 8 by this rule.  And for snapshots at or after Friday 9:04 am (= Tuesday 9:04 am - 4 days) but before Sunday 9:04 am (= Tuesday 9:04 am - 2 days) we will keep the first per 24 hour period.  So we will keep snapshots 6 and 4 by this rule and delete snapshots 5 and 3.\nYou can see that this is all highly dependent on the timestamp of the latest model snapshot, because everything is measured relative to its timestamp.  So this is what \"Age is calculated relative to the timestamp of the newest model snapshot\" was trying to say.  Can you recommend a good way to explain it?  I will probably do this docs change in a followup PR though if the PR build goes green soon as I need to get the main code change merged before the 7.8 branch is split.", "url": "https://github.com/elastic/elasticsearch/pull/56125#discussion_r419956964", "createdAt": "2020-05-05T08:51:46Z", "author": {"login": "droberts195"}, "path": "docs/reference/ml/ml-shared.asciidoc", "diffHunk": "@@ -361,6 +361,18 @@ example, it can contain custom URL information as shown in\n {ml-docs}/ml-configuring-url.html[Adding custom URLs to {ml} results].\n end::custom-settings[]\n \n+tag::daily-model-snapshot-retention-after-days[]\n+Advanced configuration option. Specifies a number of days between 0 and the\n+value of `model_snapshot_retention_days`. After this period of time, only one\n+model snapshot per day is retained for this job. Age is calculated relative to", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTY4MzI1MA=="}, "originalCommit": {"oid": "3e7bf0e0a6c26886920e968367795e41d1c0d52a"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTE2NTYzNg==", "bodyText": "I've created elastic/stack-docs#1047 to update the Model snapshots (https://www.elastic.co/guide/en/machine-learning/current/ml-model-snapshots.html) page and can revisit the API details thereafter.", "url": "https://github.com/elastic/elasticsearch/pull/56125#discussion_r421165636", "createdAt": "2020-05-07T00:18:07Z", "author": {"login": "lcawl"}, "path": "docs/reference/ml/ml-shared.asciidoc", "diffHunk": "@@ -361,6 +361,18 @@ example, it can contain custom URL information as shown in\n {ml-docs}/ml-configuring-url.html[Adding custom URLs to {ml} results].\n end::custom-settings[]\n \n+tag::daily-model-snapshot-retention-after-days[]\n+Advanced configuration option. Specifies a number of days between 0 and the\n+value of `model_snapshot_retention_days`. After this period of time, only one\n+model snapshot per day is retained for this job. Age is calculated relative to", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTY4MzI1MA=="}, "originalCommit": {"oid": "3e7bf0e0a6c26886920e968367795e41d1c0d52a"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTQwODI4Ng==", "bodyText": "Thanks Lisa!", "url": "https://github.com/elastic/elasticsearch/pull/56125#discussion_r421408286", "createdAt": "2020-05-07T10:39:13Z", "author": {"login": "droberts195"}, "path": "docs/reference/ml/ml-shared.asciidoc", "diffHunk": "@@ -361,6 +361,18 @@ example, it can contain custom URL information as shown in\n {ml-docs}/ml-configuring-url.html[Adding custom URLs to {ml} results].\n end::custom-settings[]\n \n+tag::daily-model-snapshot-retention-after-days[]\n+Advanced configuration option. Specifies a number of days between 0 and the\n+value of `model_snapshot_retention_days`. After this period of time, only one\n+model snapshot per day is retained for this job. Age is calculated relative to", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTY4MzI1MA=="}, "originalCommit": {"oid": "3e7bf0e0a6c26886920e968367795e41d1c0d52a"}, "originalPosition": 7}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYxNDM0OTk5OnYy", "diffSide": "RIGHT", "path": "x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/job/retention/AbstractExpiredJobDataRemover.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNVQwOTozMDozMVrOGQhdaA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNVQwOTozMDozMVrOGQhdaA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTk3ODYwMA==", "bodyText": "It might be worth replacing the tuple with a struct-like class that better explains what each value is.", "url": "https://github.com/elastic/elasticsearch/pull/56125#discussion_r419978600", "createdAt": "2020-05-05T09:30:31Z", "author": {"login": "dimitris-athanasiou"}, "path": "x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/job/retention/AbstractExpiredJobDataRemover.java", "diffHunk": "@@ -84,15 +87,15 @@ private WrappedBatchedJobsIterator newJobIterator() {\n         return new WrappedBatchedJobsIterator(jobsIterator);\n     }\n \n-    abstract void calcCutoffEpochMs(String jobId, long retentionDays, ActionListener<Long> listener);\n+    abstract void calcCutoffEpochMs(String jobId, long retentionDays, ActionListener<Tuple<Long, Long>> listener);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3e7bf0e0a6c26886920e968367795e41d1c0d52a"}, "originalPosition": 32}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYxNDU4MzA2OnYy", "diffSide": "RIGHT", "path": "x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/job/retention/AbstractExpiredJobDataRemover.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNVQxMDozOTozMlrOGQjrwg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNVQxMDozOTozMlrOGQjrwg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDAxNTA0Mg==", "bodyText": "Make those two members final?", "url": "https://github.com/elastic/elasticsearch/pull/56125#discussion_r420015042", "createdAt": "2020-05-05T10:39:32Z", "author": {"login": "dimitris-athanasiou"}, "path": "x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/job/retention/AbstractExpiredJobDataRemover.java", "diffHunk": "@@ -147,4 +145,39 @@ public Job next() {\n             return new VolatileCursorIterator<>(jobs);\n         }\n     }\n+\n+    /**\n+     * The latest time that cutoffs are measured from is not wall clock time,\n+     * but some other reference point that makes sense for the type of data\n+     * being removed.  This class groups the cutoff time with it's \"latest\"\n+     * reference point.\n+     */\n+    protected static final class CutoffDetails {\n+\n+        public long latestTimeMs;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3201549168e5524398a96b6db160a92419339403"}, "originalPosition": 58}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2473, "cost": 1, "resetAt": "2021-11-12T13:16:51Z"}}}