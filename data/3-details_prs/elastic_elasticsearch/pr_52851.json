{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzgwNTI0MjM4", "number": 52851, "title": "Prevent SigTerms/SigText from running on fields they do not support", "bodyText": "SigTerms cannot run on fields that are not searchable, and SigText cannot run on fields that do not have analyzers.  Both of these situations fail today with an esoteric exception, so this just formalizes\nthe constraint by throwing an IllegalArgumentException up front.\nIn practice, the only affected field seems to be the binary field, which is neither searchable or has a default analyzer (e.g. even numeric and keyword fields have a default analyzer despite not being tokenized).  Theoretically SigText should probably only run on text fields, but it technically works on anything with an analyzer today and changing that behavior is the purview of a different PR :)\nAdds supported-type tests, and makes some changes to the test itself to allow testing sigtext (indexing _source).\nAlso a few tweaks to the test to avoid bad randomization (negative numbers, etc).", "createdAt": "2020-02-26T21:48:39Z", "url": "https://github.com/elastic/elasticsearch/pull/52851", "merged": true, "mergeCommit": {"oid": "ec4c699defbdd5481346ad43f2e8a51728dd8b0a"}, "closed": true, "closedAt": "2020-03-23T19:33:18Z", "author": {"login": "polyfractal"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcIN3p_AH2gAyMzgwNTI0MjM4OjYzMjRkNDJlMmZjM2Y4MTMzNDQzMWE1YWVmYjcxMTVlZjg2YjZiYjA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcQiGWrgFqTM3OTY3ODU0NQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "6324d42e2fc3f81334431a5aefb7115ef86b6bb0", "author": {"user": {"login": "polyfractal", "name": "Zachary Tong"}}, "url": "https://github.com/elastic/elasticsearch/commit/6324d42e2fc3f81334431a5aefb7115ef86b6bb0", "committedDate": "2020-02-26T21:47:02Z", "message": "Prevent SigTerms/SigText from running on fields they do not support\n\nSigTerms cannot run on fields that are not searchable, and SigText\ncannot run on fields that do not have analyzers.  Both of these\nsituations fail today with an esoteric exception, so this just formalizes\nthe constraint by throwing an IllegalArgumentException up front.\n\nIn practice, the only affected field seems to be the `binary` field,\nwhich is neither searchable or has a default analyzer (e.g. even numeric\nand keyword fields have a default analyzer despite not being tokenized)\n\nAdds supported-type tests, and makes some changes to the test itself\nto allow testing sigtext (indexing _source).\n\nAlso a few tweaks to the test to avoid bad randomization (negative\nnumbers, etc)."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY1MjkwNjk3", "url": "https://github.com/elastic/elasticsearch/pull/52851#pullrequestreview-365290697", "createdAt": "2020-02-26T22:27:03Z", "commit": {"oid": "6324d42e2fc3f81334431a5aefb7115ef86b6bb0"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNlQyMjoyNzowM1rOFu-r0A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNlQyMjoyNzowM1rOFu-r0A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDgwNTg0MA==", "bodyText": "s/index analyzer/analyzer/? Most folks don't declare a different index and search analyzers so they'll probably be confused about this message.", "url": "https://github.com/elastic/elasticsearch/pull/52851#discussion_r384805840", "createdAt": "2020-02-26T22:27:03Z", "author": {"login": "nik9000"}, "path": "server/src/main/java/org/elasticsearch/search/aggregations/bucket/significant/SignificantTextAggregatorFactory.java", "diffHunk": "@@ -83,6 +83,10 @@ public SignificantTextAggregatorFactory(String name,\n         // Note that if the field is unmapped (its field type is null), we don't fail,\n         // and just use the given field name as a placeholder.\n         this.fieldType = queryShardContext.fieldMapper(fieldName);\n+        if (fieldType != null && fieldType.indexAnalyzer() == null) {\n+            throw new IllegalArgumentException(\"Field [\" + fieldType.name() + \"] has no index analyzer, but SignificantText \" +", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6324d42e2fc3f81334431a5aefb7115ef86b6bb0"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "173c56462dd157a93f1026ea8a1d614eb7bb8588", "author": {"user": {"login": "polyfractal", "name": "Zachary Tong"}}, "url": "https://github.com/elastic/elasticsearch/commit/173c56462dd157a93f1026ea8a1d614eb7bb8588", "committedDate": "2020-03-02T20:06:08Z", "message": "Tweak exception text"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a59d9c74d16d94ae79eb913e41617a3f864ce227", "author": {"user": {"login": "polyfractal", "name": "Zachary Tong"}}, "url": "https://github.com/elastic/elasticsearch/commit/a59d9c74d16d94ae79eb913e41617a3f864ce227", "committedDate": "2020-03-02T20:41:27Z", "message": "Merge remote-tracking branch 'origin/master' into fix_sigterm_sigtext_supported_types"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc5Njc4NTQ1", "url": "https://github.com/elastic/elasticsearch/pull/52851#pullrequestreview-379678545", "createdAt": "2020-03-23T17:52:35Z", "commit": {"oid": "a59d9c74d16d94ae79eb913e41617a3f864ce227"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1982, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}