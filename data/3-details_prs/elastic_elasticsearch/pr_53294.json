{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg1Njk3OTY2", "number": 53294, "title": "[ML][Inference] adds new default_field_map field to trained models", "bodyText": "Adds a new default_field_map field to trained model config objects.\nThis allows the model creator to supply field map if it knows that there should be some map for inference to work directly against the training data.\nThe use case internally is having analytics jobs supply a field mapping for multi-field fields. This allows us to use the model \"out of the box\" on data where we trained on foo.keyword but the _source only references foo.", "createdAt": "2020-03-09T16:46:42Z", "url": "https://github.com/elastic/elasticsearch/pull/53294", "merged": true, "mergeCommit": {"oid": "4e1f029b044f09a99b9dae6dde7e392b1e79d31e"}, "closed": true, "closedAt": "2020-03-11T16:23:57Z", "author": {"login": "benwtrent"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcMAxcpgH2gAyMzg1Njk3OTY2OjZlZGZlNGJjYmQ2OWM5NjQ2M2Q5OWNkODMwNzQzNGE3ZGRmYjkyMTI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcMotP8AH2gAyMzg1Njk3OTY2OjU2Y2NjNWNjNGJkYWY2ZTEwNDI3ZmJhYzI2ZTI5NTI5OTc2YmE4NzA=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "6edfe4bcbd69c96463d99cd8307434a7ddfb9212", "author": {"user": {"login": "benwtrent", "name": "Benjamin Trent"}}, "url": "https://github.com/elastic/elasticsearch/commit/6edfe4bcbd69c96463d99cd8307434a7ddfb9212", "committedDate": "2020-03-09T16:47:11Z", "message": "[ML][Inference] adds new default_field_mappings config field to trained models"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a8ecd592f4a9c42fd95959d182f9c13ba5801705", "author": {"user": {"login": "benwtrent", "name": "Benjamin Trent"}}, "url": "https://github.com/elastic/elasticsearch/commit/a8ecd592f4a9c42fd95959d182f9c13ba5801705", "committedDate": "2020-03-09T16:37:19Z", "message": "[ML][Inference] adds new default_field_mappings config field to trained models"}, "afterCommit": {"oid": "6edfe4bcbd69c96463d99cd8307434a7ddfb9212", "author": {"user": {"login": "benwtrent", "name": "Benjamin Trent"}}, "url": "https://github.com/elastic/elasticsearch/commit/6edfe4bcbd69c96463d99cd8307434a7ddfb9212", "committedDate": "2020-03-09T16:47:11Z", "message": "[ML][Inference] adds new default_field_mappings config field to trained models"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcxNDE4MTQx", "url": "https://github.com/elastic/elasticsearch/pull/53294#pullrequestreview-371418141", "createdAt": "2020-03-09T18:15:07Z", "commit": {"oid": "6edfe4bcbd69c96463d99cd8307434a7ddfb9212"}, "state": "APPROVED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wOVQxODoxNTowOFrOFzz-Tw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wOVQxODo0ODoxMFrOFz1ErQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTg3MzIzMQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    if (defaultFieldMappings != null) {\n          \n          \n            \n                    if (defaultFieldMappings != null && defaultFieldMappings.isEmpty() == false) {\n          \n      \n    \n    \n  \n\nI prefer not to write empty collections.", "url": "https://github.com/elastic/elasticsearch/pull/53294#discussion_r389873231", "createdAt": "2020-03-09T18:15:08Z", "author": {"login": "davidkyle"}, "path": "client/rest-high-level/src/main/java/org/elasticsearch/client/ml/inference/TrainedModelConfig.java", "diffHunk": "@@ -226,6 +235,9 @@ public XContentBuilder toXContent(XContentBuilder builder, Params params) throws\n         if (licenseLevel != null) {\n             builder.field(LICENSE_LEVEL.getPreferredName(), licenseLevel);\n         }\n+        if (defaultFieldMappings != null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6edfe4bcbd69c96463d99cd8307434a7ddfb9212"}, "originalPosition": 57}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTg3OTAzOA==", "bodyText": "\ud83d\udc4d neat I never thought of building a random map this way", "url": "https://github.com/elastic/elasticsearch/pull/53294#discussion_r389879038", "createdAt": "2020-03-09T18:25:53Z", "author": {"login": "davidkyle"}, "path": "client/rest-high-level/src/test/java/org/elasticsearch/client/ml/inference/TrainedModelConfigTests.java", "diffHunk": "@@ -52,7 +53,11 @@ public static TrainedModelConfig createTestTrainedModelConfig() {\n             randomBoolean() ? null : TrainedModelInputTests.createRandomInput(),\n             randomBoolean() ? null : randomNonNegativeLong(),\n             randomBoolean() ? null : randomNonNegativeLong(),\n-            randomBoolean() ? null : randomFrom(\"platinum\", \"basic\"));\n+            randomBoolean() ? null : randomFrom(\"platinum\", \"basic\"),\n+            randomBoolean() ? null :\n+                Stream.generate(() -> randomAlphaOfLength(10))\n+                    .limit(randomIntBetween(1, 10))\n+                    .collect(Collectors.toMap(Function.identity(), (k) -> randomAlphaOfLength(10))));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6edfe4bcbd69c96463d99cd8307434a7ddfb9212"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTg5MTI0NQ==", "bodyText": "Should we add a line here about multi fields which is the primary reason for this change?", "url": "https://github.com/elastic/elasticsearch/pull/53294#discussion_r389891245", "createdAt": "2020-03-09T18:48:10Z", "author": {"login": "davidkyle"}, "path": "docs/reference/ml/ml-shared.asciidoc", "diffHunk": "@@ -1506,6 +1506,13 @@ The estimated number of operations to use the trained model.\n `license_level`:::\n (string)\n The license level of the trained model.\n+\n+`default_field_mappings` :::\n+(object)\n+A string to string mapping that contains the default field mappings to use\n+when inferring against the model. Any field mapping described in the", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6edfe4bcbd69c96463d99cd8307434a7ddfb9212"}, "originalPosition": 8}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "96656afa0998e3bd16ba81cd078ce9fce9dfdeef", "author": {"user": {"login": "benwtrent", "name": "Benjamin Trent"}}, "url": "https://github.com/elastic/elasticsearch/commit/96656afa0998e3bd16ba81cd078ce9fce9dfdeef", "committedDate": "2020-03-10T11:50:49Z", "message": "renaming, addressing PR comments"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcxODg1NDkz", "url": "https://github.com/elastic/elasticsearch/pull/53294#pullrequestreview-371885493", "createdAt": "2020-03-10T11:53:28Z", "commit": {"oid": "96656afa0998e3bd16ba81cd078ce9fce9dfdeef"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "56ccc5cc4bdaf6e10427fbac26e29529976ba870", "author": {"user": {"login": "elasticmachine", "name": "Elastic Machine"}}, "url": "https://github.com/elastic/elasticsearch/commit/56ccc5cc4bdaf6e10427fbac26e29529976ba870", "committedDate": "2020-03-11T15:18:48Z", "message": "Merge branch 'master' into feature/ml-inference-fix-field-type-mapping-confusion"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1648, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}