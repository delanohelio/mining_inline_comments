{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg5OTc2Njkx", "number": 53685, "title": "Merge analyze and write phases in Painless \"user\" tree", "bodyText": "This is the next step in producing immutable state in the Painless \"user\" tree. This combines the analyze phase and the write phase so that both semantic checking and the ir tree are generated in the same phase. This allows the removal of the Input/Output objects created in the previous PRs from being mutable state on the nodes. Instead they are now local state for the analyze phase.\nRelates: #53561\nRelates: #49869", "createdAt": "2020-03-17T17:31:07Z", "url": "https://github.com/elastic/elasticsearch/pull/53685", "merged": true, "mergeCommit": {"oid": "83e82d39d3c9a8dbc1628acc3b89c2eaedc4a47e"}, "closed": true, "closedAt": "2020-03-23T23:18:53Z", "author": {"login": "jdconrad"}, "timelineItems": {"totalCount": 52, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcILU4BAH2gAyMzg5OTc2NjkxOjBiNzllZjZjY2UxZjEwNGRjYWUzNDgwNjRlMGY0ZTZhZTdjMDAyMDI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcQl4KRAH2gAyMzg5OTc2NjkxOmUwODRkZTk1YzljZmE2OTMwNzE1MmQwYjA5NThiZWJlMTYwZTJmMTM=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "0b79ef6cce1f104dcae348064e0f4e6ae7c00202", "author": {"user": {"login": "jdconrad", "name": "Jack Conradson"}}, "url": "https://github.com/elastic/elasticsearch/commit/0b79ef6cce1f104dcae348064e0f4e6ae7c00202", "committedDate": "2020-02-26T18:49:14Z", "message": "remove isNull from AExpression"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "73256422481516411cbb40a9b5b4c5adf3251bbd", "author": {"user": {"login": "jdconrad", "name": "Jack Conradson"}}, "url": "https://github.com/elastic/elasticsearch/commit/73256422481516411cbb40a9b5b4c5adf3251bbd", "committedDate": "2020-02-26T18:54:14Z", "message": "remove explicit cast optimization"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6e414972a159844347bc414fb1b124d5335b1f58", "author": {"user": {"login": "jdconrad", "name": "Jack Conradson"}}, "url": "https://github.com/elastic/elasticsearch/commit/6e414972a159844347bc414fb1b124d5335b1f58", "committedDate": "2020-02-26T19:51:51Z", "message": "remove modification of semantic tree for casting"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "247080b292a621c41b4c8c360f40378e2bff2ea4", "author": {"user": {"login": "jdconrad", "name": "Jack Conradson"}}, "url": "https://github.com/elastic/elasticsearch/commit/247080b292a621c41b4c8c360f40378e2bff2ea4", "committedDate": "2020-02-26T20:07:16Z", "message": "remove ECast node"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "63e904f6abf0a97b2269df137f8123d4d1094775", "author": {"user": {"login": "jdconrad", "name": "Jack Conradson"}}, "url": "https://github.com/elastic/elasticsearch/commit/63e904f6abf0a97b2269df137f8123d4d1094775", "committedDate": "2020-02-26T20:24:37Z", "message": "Merge branch 'master' into trees11"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0e126117911dfadc1f60c01540c225d4f913b9e8", "author": {"user": {"login": "jdconrad", "name": "Jack Conradson"}}, "url": "https://github.com/elastic/elasticsearch/commit/0e126117911dfadc1f60c01540c225d4f913b9e8", "committedDate": "2020-02-26T20:29:20Z", "message": "start of input/output in expressions"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f7ae0e7303c495099bec1a1e8e1318c1bd70e9e0", "author": {"user": {"login": "jdconrad", "name": "Jack Conradson"}}, "url": "https://github.com/elastic/elasticsearch/commit/f7ae0e7303c495099bec1a1e8e1318c1bd70e9e0", "committedDate": "2020-02-26T20:32:20Z", "message": "partial change for input and output in expression nodes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3a2b443237d5dc86a460ea842c9baa7efb7aacb7", "author": {"user": {"login": "jdconrad", "name": "Jack Conradson"}}, "url": "https://github.com/elastic/elasticsearch/commit/3a2b443237d5dc86a460ea842c9baa7efb7aacb7", "committedDate": "2020-02-26T21:05:07Z", "message": "add input/output objects for expressions"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8dfb933a3dd14f1224a2b1929604efd27a2c074b", "author": {"user": {"login": "jdconrad", "name": "Jack Conradson"}}, "url": "https://github.com/elastic/elasticsearch/commit/8dfb933a3dd14f1224a2b1929604efd27a2c074b", "committedDate": "2020-02-26T21:05:27Z", "message": "fix shift bug in EBinary"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6a811decb652cf458aa603da9d80b6b8e922bdd1", "author": {"user": {"login": "jdconrad", "name": "Jack Conradson"}}, "url": "https://github.com/elastic/elasticsearch/commit/6a811decb652cf458aa603da9d80b6b8e922bdd1", "committedDate": "2020-02-26T22:21:10Z", "message": "add input/output to statements"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "07180d922b792873c2c782e5173db2fea614a463", "author": {"user": {"login": "jdconrad", "name": "Jack Conradson"}}, "url": "https://github.com/elastic/elasticsearch/commit/07180d922b792873c2c782e5173db2fea614a463", "committedDate": "2020-03-02T16:28:13Z", "message": "Merge branch 'master' into trees11"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "02f7bb96bc10203e3c55228dfcb4bb711f0f3705", "author": {"user": {"login": "jdconrad", "name": "Jack Conradson"}}, "url": "https://github.com/elastic/elasticsearch/commit/02f7bb96bc10203e3c55228dfcb4bb711f0f3705", "committedDate": "2020-03-02T16:28:28Z", "message": "Merge branch 'trees11' into trees12"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ab9c2c7a5d151a402326e1e4e71058c5b9cee7cc", "author": {"user": {"login": "jdconrad", "name": "Jack Conradson"}}, "url": "https://github.com/elastic/elasticsearch/commit/ab9c2c7a5d151a402326e1e4e71058c5b9cee7cc", "committedDate": "2020-03-02T20:17:29Z", "message": "Merge branch 'trees12' into trees13"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "115c8e0dabfd8add0e5615c436543eeb6df8b876", "author": {"user": {"login": "jdconrad", "name": "Jack Conradson"}}, "url": "https://github.com/elastic/elasticsearch/commit/115c8e0dabfd8add0e5615c436543eeb6df8b876", "committedDate": "2020-03-02T23:51:02Z", "message": "response to pr comment"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9a96289a5b29bfe1eec5dd5e9a6cd7322b09c8ac", "author": {"user": {"login": "jdconrad", "name": "Jack Conradson"}}, "url": "https://github.com/elastic/elasticsearch/commit/9a96289a5b29bfe1eec5dd5e9a6cd7322b09c8ac", "committedDate": "2020-03-03T00:53:27Z", "message": "Merge branch 'master' into trees11"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d23d394638cbf67bd66b476327eb2eecd2c3da4e", "author": {"user": {"login": "jdconrad", "name": "Jack Conradson"}}, "url": "https://github.com/elastic/elasticsearch/commit/d23d394638cbf67bd66b476327eb2eecd2c3da4e", "committedDate": "2020-03-03T00:58:37Z", "message": "Merge branch 'trees11' into trees12"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3d6018ca222f19d9a96496cd71245bec3f515ab5", "author": {"user": {"login": "jdconrad", "name": "Jack Conradson"}}, "url": "https://github.com/elastic/elasticsearch/commit/3d6018ca222f19d9a96496cd71245bec3f515ab5", "committedDate": "2020-03-03T00:58:51Z", "message": "Merge branch 'trees12' into trees13"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "39a8806da415ba1691046c659f214a7300b34681", "author": {"user": {"login": "jdconrad", "name": "Jack Conradson"}}, "url": "https://github.com/elastic/elasticsearch/commit/39a8806da415ba1691046c659f214a7300b34681", "committedDate": "2020-03-03T19:36:31Z", "message": "Merge branch 'master' into trees12"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "55364296b579d118849ddac36c8fa1541a05b467", "author": {"user": {"login": "jdconrad", "name": "Jack Conradson"}}, "url": "https://github.com/elastic/elasticsearch/commit/55364296b579d118849ddac36c8fa1541a05b467", "committedDate": "2020-03-03T19:38:35Z", "message": "Merge branch 'trees12' into trees13"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ceb8967dc45e72e37cc22ac9e0dbcbbaacd8cd42", "author": {"user": {"login": "jdconrad", "name": "Jack Conradson"}}, "url": "https://github.com/elastic/elasticsearch/commit/ceb8967dc45e72e37cc22ac9e0dbcbbaacd8cd42", "committedDate": "2020-03-09T16:35:00Z", "message": "t Merge branch 'master' into trees12"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f65d4a76e9e40d4da236932fed508897efa16c84", "author": {"user": {"login": "jdconrad", "name": "Jack Conradson"}}, "url": "https://github.com/elastic/elasticsearch/commit/f65d4a76e9e40d4da236932fed508897efa16c84", "committedDate": "2020-03-09T16:35:19Z", "message": "Merge branch 'trees12' into trees13"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d9061478d29eb56148cda18350fc039fbceeaf4d", "author": {"user": {"login": "jdconrad", "name": "Jack Conradson"}}, "url": "https://github.com/elastic/elasticsearch/commit/d9061478d29eb56148cda18350fc039fbceeaf4d", "committedDate": "2020-03-09T20:52:46Z", "message": "Merge branch 'master' into trees12"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "08cf4768313147b745df85e77dff2f1bba8928cb", "author": {"user": {"login": "jdconrad", "name": "Jack Conradson"}}, "url": "https://github.com/elastic/elasticsearch/commit/08cf4768313147b745df85e77dff2f1bba8928cb", "committedDate": "2020-03-09T20:53:04Z", "message": "Merge branch 'trees12' into trees13"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "94891dc7731709a204b3cf3602b8d6301f549eb9", "author": {"user": {"login": "jdconrad", "name": "Jack Conradson"}}, "url": "https://github.com/elastic/elasticsearch/commit/94891dc7731709a204b3cf3602b8d6301f549eb9", "committedDate": "2020-03-09T20:53:48Z", "message": "Merge branch 'trees12' into trees15"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5ef8186149cc5f6c8f26609e7f2866b286b223c8", "author": {"user": {"login": "rjernst", "name": "Ryan Ernst"}}, "url": "https://github.com/elastic/elasticsearch/commit/5ef8186149cc5f6c8f26609e7f2866b286b223c8", "committedDate": "2020-03-09T22:02:34Z", "message": "Merge branch 'master' into trees13"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4e13cb3372146d86ba847341dabd84c8492a68a5", "author": {"user": {"login": "rjernst", "name": "Ryan Ernst"}}, "url": "https://github.com/elastic/elasticsearch/commit/4e13cb3372146d86ba847341dabd84c8492a68a5", "committedDate": "2020-03-09T22:02:59Z", "message": "Merge branch 'trees13' into trees15"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a92f642274a0784be6c0ee44f983c0a97969e3d9", "author": {"user": {"login": "rjernst", "name": "Ryan Ernst"}}, "url": "https://github.com/elastic/elasticsearch/commit/a92f642274a0784be6c0ee44f983c0a97969e3d9", "committedDate": "2020-03-10T15:57:19Z", "message": "Merge branch 'master' into trees13"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f140b25aad4eea1d7116f02db41cb831fa10c59a", "author": {"user": {"login": "rjernst", "name": "Ryan Ernst"}}, "url": "https://github.com/elastic/elasticsearch/commit/f140b25aad4eea1d7116f02db41cb831fa10c59a", "committedDate": "2020-03-10T15:57:34Z", "message": "Merge branch 'trees13' into trees15"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dd407758e5475104aed77ac40d41459853c24694", "author": {"user": {"login": "jdconrad", "name": "Jack Conradson"}}, "url": "https://github.com/elastic/elasticsearch/commit/dd407758e5475104aed77ac40d41459853c24694", "committedDate": "2020-03-10T19:58:24Z", "message": "updated expression nodes to remove member state"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7f6e5d679ec7af2beeb30ec48780b9276fa394f5", "author": {"user": {"login": "jdconrad", "name": "Jack Conradson"}}, "url": "https://github.com/elastic/elasticsearch/commit/7f6e5d679ec7af2beeb30ec48780b9276fa394f5", "committedDate": "2020-03-10T22:02:34Z", "message": "update statements to remove most mutable state"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "79a801b4a0d223b37f3b450c265bf234f33b2e94", "author": {"user": {"login": "jdconrad", "name": "Jack Conradson"}}, "url": "https://github.com/elastic/elasticsearch/commit/79a801b4a0d223b37f3b450c265bf234f33b2e94", "committedDate": "2020-03-10T22:39:21Z", "message": "fix def optimization"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b3f52b3bbab4bdae27da895b35d9608900463a8b", "author": {"user": {"login": "jdconrad", "name": "Jack Conradson"}}, "url": "https://github.com/elastic/elasticsearch/commit/b3f52b3bbab4bdae27da895b35d9608900463a8b", "committedDate": "2020-03-10T22:45:28Z", "message": "remove SField"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "074b7e52becdaaf1efc400f429a60b6ed68858d8", "author": {"user": {"login": "rjernst", "name": "Ryan Ernst"}}, "url": "https://github.com/elastic/elasticsearch/commit/074b7e52becdaaf1efc400f429a60b6ed68858d8", "committedDate": "2020-03-10T23:11:26Z", "message": "fix def optimization in assignment"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b79c54c1eb7fa0531e4d2f95b4bd5bb114870170", "author": {"user": {"login": "rjernst", "name": "Ryan Ernst"}}, "url": "https://github.com/elastic/elasticsearch/commit/b79c54c1eb7fa0531e4d2f95b4bd5bb114870170", "committedDate": "2020-03-13T20:11:08Z", "message": "response to pr comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e7cbaaa2a4c53f243ace54755bdf604a2e8d4cc5", "author": {"user": {"login": "rjernst", "name": "Ryan Ernst"}}, "url": "https://github.com/elastic/elasticsearch/commit/e7cbaaa2a4c53f243ace54755bdf604a2e8d4cc5", "committedDate": "2020-03-13T20:32:49Z", "message": "Merge branch 'master' into trees13"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5e16f35184bfa86b6cb35c791205dffc708104fa", "author": {"user": {"login": "rjernst", "name": "Ryan Ernst"}}, "url": "https://github.com/elastic/elasticsearch/commit/5e16f35184bfa86b6cb35c791205dffc708104fa", "committedDate": "2020-03-16T15:01:44Z", "message": "Merge branch 'master' into trees13"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a6a0b3be7c0e7f8d018c17a9a849127b16d119b0", "author": {"user": {"login": "rjernst", "name": "Ryan Ernst"}}, "url": "https://github.com/elastic/elasticsearch/commit/a6a0b3be7c0e7f8d018c17a9a849127b16d119b0", "committedDate": "2020-03-16T15:29:50Z", "message": "Merge branch 'trees13' into trees15"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "73f9d12fb7a242bec7f2587f9e89c227d3706021", "author": {"user": {"login": "rjernst", "name": "Ryan Ernst"}}, "url": "https://github.com/elastic/elasticsearch/commit/73f9d12fb7a242bec7f2587f9e89c227d3706021", "committedDate": "2020-03-17T15:57:35Z", "message": "Merge branch 'master' into trees15"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc4MTE4NzU2", "url": "https://github.com/elastic/elasticsearch/pull/53685#pullrequestreview-378118756", "createdAt": "2020-03-19T21:50:15Z", "commit": {"oid": "a6a0b3be7c0e7f8d018c17a9a849127b16d119b0"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOVQyMTo1MDoxNVrOF5BnCg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOVQyMTo1MDoxNVrOF5BnCg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTMzOTUzMA==", "bodyText": "Consider changing this to i.", "url": "https://github.com/elastic/elasticsearch/pull/53685#discussion_r395339530", "createdAt": "2020-03-19T21:50:15Z", "author": {"login": "stu-elastic"}, "path": "modules/lang-painless/src/main/java/org/elasticsearch/painless/node/EListInit.java", "diffHunk": "@@ -29,76 +29,75 @@\n import org.elasticsearch.painless.symbol.ScriptRoot;\n \n import java.util.ArrayList;\n+import java.util.Collections;\n import java.util.List;\n+import java.util.Objects;\n \n import static org.elasticsearch.painless.lookup.PainlessLookupUtility.typeToCanonicalTypeName;\n \n /**\n  * Represents a list initialization shortcut.\n  */\n-public final class EListInit extends AExpression {\n-    private final List<AExpression> values;\n+public class EListInit extends AExpression {\n \n-    private PainlessConstructor constructor = null;\n-    private PainlessMethod method = null;\n+    protected final List<AExpression> values;\n \n     public EListInit(Location location, List<AExpression> values) {\n         super(location);\n \n-        this.values = values;\n+        this.values = Collections.unmodifiableList(Objects.requireNonNull(values));\n     }\n \n     @Override\n-    Output analyze(ScriptRoot scriptRoot, Scope scope, Input input) {\n-        this.input = input;\n-        output = new Output();\n+    Output analyze(ClassNode classNode, ScriptRoot scriptRoot, Scope scope, Input input) {\n+        Output output = new Output();\n \n         if (input.read == false) {\n             throw createError(new IllegalArgumentException(\"Must read from list initializer.\"));\n         }\n \n         output.actual = ArrayList.class;\n \n-        constructor = scriptRoot.getPainlessLookup().lookupPainlessConstructor(output.actual, 0);\n+        PainlessConstructor constructor = scriptRoot.getPainlessLookup().lookupPainlessConstructor(output.actual, 0);\n \n         if (constructor == null) {\n             throw createError(new IllegalArgumentException(\n                     \"constructor [\" + typeToCanonicalTypeName(output.actual) + \", <init>/0] not found\"));\n         }\n \n-        method = scriptRoot.getPainlessLookup().lookupPainlessMethod(output.actual, false, \"add\", 1);\n+        PainlessMethod method = scriptRoot.getPainlessLookup().lookupPainlessMethod(output.actual, false, \"add\", 1);\n \n         if (method == null) {\n             throw createError(new IllegalArgumentException(\"method [\" + typeToCanonicalTypeName(output.actual) + \", add/1] not found\"));\n         }\n \n+        List<Output> valueOutputs = new ArrayList<>(values.size());\n+\n         for (int index = 0; index < values.size(); ++index) {\n             AExpression expression = values.get(index);\n \n             Input expressionInput = new Input();\n             expressionInput.expected = def.class;\n             expressionInput.internal = true;\n-            expression.analyze(scriptRoot, scope, expressionInput);\n-            expression.cast();\n+            Output expressionOutput = expression.analyze(classNode, scriptRoot, scope, expressionInput);\n+            expression.cast(expressionInput, expressionOutput);\n+            valueOutputs.add(expressionOutput);\n         }\n \n-        return output;\n-    }\n-\n-    @Override\n-    ListInitializationNode write(ClassNode classNode) {\n         ListInitializationNode listInitializationNode = new ListInitializationNode();\n \n-        for (AExpression value : values) {\n-            listInitializationNode.addArgumentNode(value.cast(value.write(classNode)));\n+        for (int value = 0; value < values.size(); ++value) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a6a0b3be7c0e7f8d018c17a9a849127b16d119b0"}, "originalPosition": 80}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc4MTIwMDg1", "url": "https://github.com/elastic/elasticsearch/pull/53685#pullrequestreview-378120085", "createdAt": "2020-03-19T21:53:01Z", "commit": {"oid": "a6a0b3be7c0e7f8d018c17a9a849127b16d119b0"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOVQyMTo1MzowMVrOF5BrdQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOVQyMTo1MzowMVrOF5BrdQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTM0MDY2MQ==", "bodyText": "i", "url": "https://github.com/elastic/elasticsearch/pull/53685#discussion_r395340661", "createdAt": "2020-03-19T21:53:01Z", "author": {"login": "stu-elastic"}, "path": "modules/lang-painless/src/main/java/org/elasticsearch/painless/node/ENewArray.java", "diffHunk": "@@ -60,34 +61,34 @@ Output analyze(ScriptRoot scriptRoot, Scope scope, Input input) {\n             throw createError(new IllegalArgumentException(\"Not a type [\" + this.type + \"].\"));\n         }\n \n+        List<Output> argumentOutputs = new ArrayList<>();\n+\n         for (int argument = 0; argument < arguments.size(); ++argument) {\n             AExpression expression = arguments.get(argument);\n \n             Input expressionInput = new Input();\n             expressionInput.expected = initialize ? clazz.getComponentType() : int.class;\n             expressionInput.internal = true;\n-            expression.analyze(scriptRoot, scope, expressionInput);\n-            expression.cast();\n+            Output expressionOutput = expression.analyze(classNode, scriptRoot, scope, expressionInput);\n+            expression.cast(expressionInput, expressionOutput);\n+            argumentOutputs.add(expressionOutput);\n         }\n \n         output.actual = clazz;\n \n-        return output;\n-    }\n-\n-    @Override\n-    NewArrayNode write(ClassNode classNode) {\n         NewArrayNode newArrayNode = new NewArrayNode();\n \n-        for (AExpression argument : arguments) {\n-            newArrayNode.addArgumentNode(argument.cast(argument.write(classNode)));\n+        for (int argument = 0; argument < arguments.size(); ++ argument) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a6a0b3be7c0e7f8d018c17a9a849127b16d119b0"}, "originalPosition": 70}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc4MTIwNzYz", "url": "https://github.com/elastic/elasticsearch/pull/53685#pullrequestreview-378120763", "createdAt": "2020-03-19T21:54:24Z", "commit": {"oid": "a6a0b3be7c0e7f8d018c17a9a849127b16d119b0"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOVQyMTo1NDoyNVrOF5BtgQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOVQyMTo1NDoyNVrOF5BtgQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTM0MTE4NQ==", "bodyText": "If this isn't gonna get fixed right away, consider cutting an issue to address this.", "url": "https://github.com/elastic/elasticsearch/pull/53685#discussion_r395341185", "createdAt": "2020-03-19T21:54:25Z", "author": {"login": "stu-elastic"}, "path": "modules/lang-painless/src/main/java/org/elasticsearch/painless/node/ENewArrayFunctionRef.java", "diffHunk": "@@ -34,11 +35,11 @@\n /**\n  * Represents a function reference.\n  */\n-public final class ENewArrayFunctionRef extends AExpression implements ILambda {\n-    private final String type;\n+public class ENewArrayFunctionRef extends AExpression implements ILambda {\n \n-    private SFunction function;\n-    private FunctionRef ref;\n+    protected final String type;\n+\n+    // TODO: make local", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a6a0b3be7c0e7f8d018c17a9a849127b16d119b0"}, "originalPosition": 20}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc4MTIxMzcy", "url": "https://github.com/elastic/elasticsearch/pull/53685#pullrequestreview-378121372", "createdAt": "2020-03-19T21:55:34Z", "commit": {"oid": "a6a0b3be7c0e7f8d018c17a9a849127b16d119b0"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOVQyMTo1NTozNVrOF5BveA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOVQyMTo1NTozNVrOF5BveA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTM0MTY4OA==", "bodyText": "Consider moving this closer to assignment.", "url": "https://github.com/elastic/elasticsearch/pull/53685#discussion_r395341688", "createdAt": "2020-03-19T21:55:35Z", "author": {"login": "stu-elastic"}, "path": "modules/lang-painless/src/main/java/org/elasticsearch/painless/node/ENewArrayFunctionRef.java", "diffHunk": "@@ -48,17 +49,18 @@ public ENewArrayFunctionRef(Location location, String type) {\n     }\n \n     @Override\n-    Output analyze(ScriptRoot scriptRoot, Scope scope, Input input) {\n-        this.input = input;\n-        output = new Output();\n+    Output analyze(ClassNode classNode, ScriptRoot scriptRoot, Scope scope, Input input) {\n+        FunctionRef ref;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a6a0b3be7c0e7f8d018c17a9a849127b16d119b0"}, "originalPosition": 32}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc4MTIyNjU1", "url": "https://github.com/elastic/elasticsearch/pull/53685#pullrequestreview-378122655", "createdAt": "2020-03-19T21:58:10Z", "commit": {"oid": "a6a0b3be7c0e7f8d018c17a9a849127b16d119b0"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOVQyMTo1ODoxMFrOF5BztQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOVQyMTo1ODoxMFrOF5BztQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTM0Mjc3Mw==", "bodyText": "If these aren't going to be the extension point, no need to change visibility.", "url": "https://github.com/elastic/elasticsearch/pull/53685#discussion_r395342773", "createdAt": "2020-03-19T21:58:10Z", "author": {"login": "stu-elastic"}, "path": "modules/lang-painless/src/main/java/org/elasticsearch/painless/node/ENumeric.java", "diffHunk": "@@ -23,20 +23,17 @@\n import org.elasticsearch.painless.Scope;\n import org.elasticsearch.painless.ir.ClassNode;\n import org.elasticsearch.painless.ir.ConstantNode;\n-import org.elasticsearch.painless.ir.ExpressionNode;\n import org.elasticsearch.painless.symbol.ScriptRoot;\n \n import java.util.Objects;\n \n /**\n  * Represents a non-decimal numeric constant.\n  */\n-public final class ENumeric extends AExpression {\n+public class ENumeric extends AExpression {\n \n-    private final String value;\n-    private int radix;\n-\n-    protected Object constant;\n+    protected final String value;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a6a0b3be7c0e7f8d018c17a9a849127b16d119b0"}, "originalPosition": 19}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc4MTI1MzQ2", "url": "https://github.com/elastic/elasticsearch/pull/53685#pullrequestreview-378125346", "createdAt": "2020-03-19T22:03:30Z", "commit": {"oid": "a6a0b3be7c0e7f8d018c17a9a849127b16d119b0"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOVQyMjowMzozMFrOF5B8Uw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOVQyMjowMzozMFrOF5B8Uw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTM0NDk3OQ==", "bodyText": "Punt to issue.", "url": "https://github.com/elastic/elasticsearch/pull/53685#discussion_r395344979", "createdAt": "2020-03-19T22:03:30Z", "author": {"login": "stu-elastic"}, "path": "modules/lang-painless/src/main/java/org/elasticsearch/painless/node/PBrace.java", "diffHunk": "@@ -34,11 +34,12 @@\n /**\n  * Represents an array load/store and defers to a child subnode.\n  */\n-public final class PBrace extends AStoreable {\n+public class PBrace extends AStoreable {\n \n-    private AExpression index;\n+    protected final AExpression index;\n \n-    private AStoreable sub = null;\n+    // TODO: make local", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a6a0b3be7c0e7f8d018c17a9a849127b16d119b0"}, "originalPosition": 11}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc4MTI5MTI4", "url": "https://github.com/elastic/elasticsearch/pull/53685#pullrequestreview-378129128", "createdAt": "2020-03-19T22:11:12Z", "commit": {"oid": "a6a0b3be7c0e7f8d018c17a9a849127b16d119b0"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOVQyMjoxMToxM1rOF5CITA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOVQyMjoxMToxM1rOF5CITA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTM0ODA0NA==", "bodyText": "Punt to issue.", "url": "https://github.com/elastic/elasticsearch/pull/53685#discussion_r395348044", "createdAt": "2020-03-19T22:11:13Z", "author": {"login": "stu-elastic"}, "path": "modules/lang-painless/src/main/java/org/elasticsearch/painless/node/SFunction.java", "diffHunk": "@@ -121,7 +118,8 @@ void generateSignature(PainlessLookup painlessLookup) {\n                 PainlessLookupUtility.typeToJavaType(returnType), paramClasses).toMethodDescriptorString());\n     }\n \n-    void analyze(ScriptRoot scriptRoot) {\n+    // TODO: decouple from ir", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a6a0b3be7c0e7f8d018c17a9a849127b16d119b0"}, "originalPosition": 60}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2086dcc7bd960b807cb73b67d16b8f3dd0b8520e", "author": {"user": {"login": "rjernst", "name": "Ryan Ernst"}}, "url": "https://github.com/elastic/elasticsearch/commit/2086dcc7bd960b807cb73b67d16b8f3dd0b8520e", "committedDate": "2020-03-23T18:23:38Z", "message": "Merge branch 'master' into trees13"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5b13acf186abc89455dec770be71f4f68bfb1ebf", "author": {"user": {"login": "rjernst", "name": "Ryan Ernst"}}, "url": "https://github.com/elastic/elasticsearch/commit/5b13acf186abc89455dec770be71f4f68bfb1ebf", "committedDate": "2020-03-23T18:23:51Z", "message": "Merge branch 'trees13' into trees15"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a6ed5d16496c1fa75b98a5b4b19c7010714c202a", "author": {"user": {"login": "rjernst", "name": "Ryan Ernst"}}, "url": "https://github.com/elastic/elasticsearch/commit/a6ed5d16496c1fa75b98a5b4b19c7010714c202a", "committedDate": "2020-03-23T19:51:09Z", "message": "response to PR comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f4fde396ea8b0ac20168a38ffccfdb8a885218ac", "author": {"user": null}, "url": "https://github.com/elastic/elasticsearch/commit/f4fde396ea8b0ac20168a38ffccfdb8a885218ac", "committedDate": "2020-03-23T21:49:27Z", "message": "Merge branch 'master' into trees15"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "31de473abafb275bcf9bad89bb5304aa96a75ff7", "author": {"user": {"login": "jdconrad", "name": "Jack Conradson"}}, "url": "https://github.com/elastic/elasticsearch/commit/31de473abafb275bcf9bad89bb5304aa96a75ff7", "committedDate": "2020-03-23T21:54:39Z", "message": "fix more todos"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc5ODU4NTM2", "url": "https://github.com/elastic/elasticsearch/pull/53685#pullrequestreview-379858536", "createdAt": "2020-03-23T22:08:46Z", "commit": {"oid": "31de473abafb275bcf9bad89bb5304aa96a75ff7"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e084de95c9cfa69307152d0b0958bebe160e2f13", "author": {"user": {"login": "jdconrad", "name": "Jack Conradson"}}, "url": "https://github.com/elastic/elasticsearch/commit/e084de95c9cfa69307152d0b0958bebe160e2f13", "committedDate": "2020-03-23T22:16:42Z", "message": "fix issue number"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1979, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}