{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzYxMzM3ODg0", "number": 50841, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xMFQwODo0NjozNFrODXFdRA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xMFQwOTo0MToyMFrODXGWxQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI1NTMzMjUyOnYy", "diffSide": "LEFT", "path": "x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/common/validation/SourceDestValidator.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xMFQwODo0NjozNFrOFcNdOg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xMFQwODo0NjozNFrOFcNdOg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTEyNDkyMg==", "bodyText": "This was unused.", "url": "https://github.com/elastic/elasticsearch/pull/50841#discussion_r365124922", "createdAt": "2020-01-10T08:46:34Z", "author": {"login": "dimitris-athanasiou"}, "path": "x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/common/validation/SourceDestValidator.java", "diffHunk": "@@ -46,7 +46,6 @@\n \n     // messages\n     public static final String SOURCE_INDEX_MISSING = \"Source index [{0}] does not exist\";\n-    public static final String SOURCE_LOWERCASE = \"Source index [{0}] must be lowercase\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "928d24bffbd40643b1d77ec4e3bf2ed5aa992f80"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI1NTQ0MzU3OnYy", "diffSide": "RIGHT", "path": "x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/common/validation/SourceDestValidator.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xMFQwOToyOTo0M1rOFcOfug==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xMFQwOToyOTo0M1rOFcOfug==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTE0MTk0Ng==", "bodyText": "nice spot!", "url": "https://github.com/elastic/elasticsearch/pull/50841#discussion_r365141946", "createdAt": "2020-01-10T09:29:43Z", "author": {"login": "hendrikmuhs"}, "path": "x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/common/validation/SourceDestValidator.java", "diffHunk": "@@ -427,13 +417,13 @@ public void validate(Context context, ActionListener<Context> listener) {\n                 return;\n             }\n \n-            if (context.resolvedSource.contains(destIndex)) {\n+            if (context.resolveSource().contains(destIndex)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d21d9f02688fb11e1d9ec6e3e31876abe075131a"}, "originalPosition": 64}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI1NTQ2MzY0OnYy", "diffSide": "RIGHT", "path": "x-pack/plugin/core/src/test/java/org/elasticsearch/xpack/core/common/validation/SourceDestValidatorTests.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xMFQwOTozNjozNlrOFcOr2g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xMFQxMDoyMzoyOVrOFcP-qA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTE0NTA1MA==", "bodyText": "^ needs re-activation or should be removed", "url": "https://github.com/elastic/elasticsearch/pull/50841#discussion_r365145050", "createdAt": "2020-01-10T09:36:36Z", "author": {"login": "hendrikmuhs"}, "path": "x-pack/plugin/core/src/test/java/org/elasticsearch/xpack/core/common/validation/SourceDestValidatorTests.java", "diffHunk": "@@ -260,17 +274,17 @@ public void testCheck_GivenMixedMissingAndExistingConcreteSourceIndex() throws I\n             }\n         );\n \n-        assertValidation(\n-            listener -> simpleNonRemoteValidator.validate(\n-                CLUSTER_STATE,\n-                new String[] { SOURCE_1, \"missing\" },\n-                \"dest\",\n-                SourceDestValidator.NON_DEFERABLE_VALIDATIONS,\n-                listener\n-            ),\n-            true,\n-            null\n-        );\n+//        assertValidation(\n+//            listener -> simpleNonRemoteValidator.validate(\n+//                CLUSTER_STATE,\n+//                new String[] { SOURCE_1, \"missing\" },\n+//                \"dest\",\n+//                Collections.emptyList(),\n+//                listener\n+//            ),\n+//            true,\n+//            null\n+//        );", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d21d9f02688fb11e1d9ec6e3e31876abe075131a"}, "originalPosition": 113}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTE2NjI0OA==", "bodyText": "Reactivated it. Good catch.", "url": "https://github.com/elastic/elasticsearch/pull/50841#discussion_r365166248", "createdAt": "2020-01-10T10:23:29Z", "author": {"login": "dimitris-athanasiou"}, "path": "x-pack/plugin/core/src/test/java/org/elasticsearch/xpack/core/common/validation/SourceDestValidatorTests.java", "diffHunk": "@@ -260,17 +274,17 @@ public void testCheck_GivenMixedMissingAndExistingConcreteSourceIndex() throws I\n             }\n         );\n \n-        assertValidation(\n-            listener -> simpleNonRemoteValidator.validate(\n-                CLUSTER_STATE,\n-                new String[] { SOURCE_1, \"missing\" },\n-                \"dest\",\n-                SourceDestValidator.NON_DEFERABLE_VALIDATIONS,\n-                listener\n-            ),\n-            true,\n-            null\n-        );\n+//        assertValidation(\n+//            listener -> simpleNonRemoteValidator.validate(\n+//                CLUSTER_STATE,\n+//                new String[] { SOURCE_1, \"missing\" },\n+//                \"dest\",\n+//                Collections.emptyList(),\n+//                listener\n+//            ),\n+//            true,\n+//            null\n+//        );", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTE0NTA1MA=="}, "originalCommit": {"oid": "d21d9f02688fb11e1d9ec6e3e31876abe075131a"}, "originalPosition": 113}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI1NTQ3OTczOnYy", "diffSide": "RIGHT", "path": "x-pack/plugin/core/src/test/java/org/elasticsearch/xpack/core/common/validation/SourceDestValidatorTests.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xMFQwOTo0MToyMFrOFcO1Ig==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xMFQxMDoyMjo0MlrOFcP9ew==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTE0NzQyNg==", "bodyText": "not getting this change, should the test be removed?", "url": "https://github.com/elastic/elasticsearch/pull/50841#discussion_r365147426", "createdAt": "2020-01-10T09:41:20Z", "author": {"login": "hendrikmuhs"}, "path": "x-pack/plugin/core/src/test/java/org/elasticsearch/xpack/core/common/validation/SourceDestValidatorTests.java", "diffHunk": "@@ -464,21 +478,11 @@ public void testCheck_GivenDestIndexIsAliasThatMatchesMultipleIndices() throws I\n                 CLUSTER_STATE,\n                 new String[] { SOURCE_1 },\n                 DEST_ALIAS,\n-                SourceDestValidator.NON_DEFERABLE_VALIDATIONS,\n+                Collections.emptyList(),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d21d9f02688fb11e1d9ec6e3e31876abe075131a"}, "originalPosition": 221}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTE2NTk0Nw==", "bodyText": "These second assertions in those tests seem to be testing that when the validation is not present then the error does not occur. Previously the NON_DEFERABLE_VALIDATIONS set was passed around but I could not see what the difference was compared to passing an empty list. Does this make sense?", "url": "https://github.com/elastic/elasticsearch/pull/50841#discussion_r365165947", "createdAt": "2020-01-10T10:22:42Z", "author": {"login": "dimitris-athanasiou"}, "path": "x-pack/plugin/core/src/test/java/org/elasticsearch/xpack/core/common/validation/SourceDestValidatorTests.java", "diffHunk": "@@ -464,21 +478,11 @@ public void testCheck_GivenDestIndexIsAliasThatMatchesMultipleIndices() throws I\n                 CLUSTER_STATE,\n                 new String[] { SOURCE_1 },\n                 DEST_ALIAS,\n-                SourceDestValidator.NON_DEFERABLE_VALIDATIONS,\n+                Collections.emptyList(),", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTE0NzQyNg=="}, "originalCommit": {"oid": "d21d9f02688fb11e1d9ec6e3e31876abe075131a"}, "originalPosition": 221}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4825, "cost": 1, "resetAt": "2021-11-12T19:05:54Z"}}}