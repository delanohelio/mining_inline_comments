{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzkyNjcxMTY1", "number": 54036, "title": "Add version guards around Transform hidden index settings", "bodyText": "This commit ensures that the hidden index settings are only applied to the\nTransform index templates when the cluster can support those settings.\nAlso unmutes the tests which were failing.\nFixes #53931\n\nI've run the tests several times locally and had no failures that I can attribute to the code in question here (though I have had a few that I believe are the fault of my environment, so I'll likely re-run BWC in CI a few times to be sure).", "createdAt": "2020-03-23T22:28:04Z", "url": "https://github.com/elastic/elasticsearch/pull/54036", "merged": true, "mergeCommit": {"oid": "82e041442e410c19ad90388073ecef9e345fe8ac"}, "closed": true, "closedAt": "2020-03-24T21:52:57Z", "author": {"login": "gwbrown"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcQgMjwgH2gAyMzkyNjcxMTY1OmVmM2Y3YmQ0MTRiM2JkN2NmYWY2MTlmNTAyOTg3ODZiZTM2ZDM0OTQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcQ5Fk4gH2gAyMzkyNjcxMTY1OjAyYTM5YTk4NGU3NDY4OGZiZGY4NTllM2E1NzA5NTgzYjc2Y2NhYWQ=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "ef3f7bd414b3bd7cfaf619f50298786be36d3494", "author": {"user": {"login": "gwbrown", "name": "Gordon Brown"}}, "url": "https://github.com/elastic/elasticsearch/commit/ef3f7bd414b3bd7cfaf619f50298786be36d3494", "committedDate": "2020-03-23T15:39:33Z", "message": "Revert \"[TEST] Mute transforms rolling upgrade tests (#53932)\"\n\nThis reverts commit 076ba02e9c41118d0c5615c59e7f3628363644b2."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "679e32618637e48b83b3c9f83e601a9ada28101d", "author": {"user": {"login": "gwbrown", "name": "Gordon Brown"}}, "url": "https://github.com/elastic/elasticsearch/commit/679e32618637e48b83b3c9f83e601a9ada28101d", "committedDate": "2020-03-23T18:05:03Z", "message": "Add version guards around Transform hidden index settings\n\nThis commit ensures that the hidden index settings are only applied to the\nTransform index templates when the cluster can support those settings."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9d79527e76256f39fbaf2f7db0ce5d2a9a604f8f", "author": {"user": {"login": "gwbrown", "name": "Gordon Brown"}}, "url": "https://github.com/elastic/elasticsearch/commit/9d79527e76256f39fbaf2f7db0ce5d2a9a604f8f", "committedDate": "2020-03-24T00:19:46Z", "message": "Merge branch '7.x' into 7x/hidden/fix-transforms"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8507327c8f6c57337dc9ddfe2d073884868ce02f", "author": {"user": {"login": "gwbrown", "name": "Gordon Brown"}}, "url": "https://github.com/elastic/elasticsearch/commit/8507327c8f6c57337dc9ddfe2d073884868ce02f", "committedDate": "2020-03-24T00:25:57Z", "message": "Revert \"Mute TransformSurvivesUpgradeIT.testTransformRollingUpgrade (#54037)\"\n\nThis reverts commit e225f08613a33afb75e4aa7e4b6aa550e14e5871."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgwMDUwNjI0", "url": "https://github.com/elastic/elasticsearch/pull/54036#pullrequestreview-380050624", "createdAt": "2020-03-24T07:23:46Z", "commit": {"oid": "8507327c8f6c57337dc9ddfe2d073884868ce02f"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQwNzoyMzo0NlrOF6jkZw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQwNzoyMzo0NlrOF6jkZw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Njk0NDQ4Nw==", "bodyText": "spelling nit: compatabilityVersion -> compatibilityVersion", "url": "https://github.com/elastic/elasticsearch/pull/54036#discussion_r396944487", "createdAt": "2020-03-24T07:23:46Z", "author": {"login": "hendrikmuhs"}, "path": "x-pack/plugin/transform/src/main/java/org/elasticsearch/xpack/transform/persistence/TransformInternalIndex.java", "diffHunk": "@@ -96,19 +99,22 @@ public static IndexTemplateMetaData getIndexTemplateMetaData() throws IOExceptio\n         return transformTemplate;\n     }\n \n-    public static IndexTemplateMetaData getAuditIndexTemplateMetaData() throws IOException {\n+    public static IndexTemplateMetaData getAuditIndexTemplateMetaData(Version compatabilityVersion) throws IOException {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8507327c8f6c57337dc9ddfe2d073884868ce02f"}, "originalPosition": 22}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgwMDk1NDQ1", "url": "https://github.com/elastic/elasticsearch/pull/54036#pullrequestreview-380095445", "createdAt": "2020-03-24T08:40:14Z", "commit": {"oid": "8507327c8f6c57337dc9ddfe2d073884868ce02f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQwODo0MDoxNFrOF6l0HA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQwODo0MDoxNFrOF6l0HA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Njk4MTI3Ng==", "bodyText": "FWIW, for later readers: I think this is the important change of this PR as this is the place where a (potentially new) non-master calls the (potentially old) master.", "url": "https://github.com/elastic/elasticsearch/pull/54036#discussion_r396981276", "createdAt": "2020-03-24T08:40:14Z", "author": {"login": "hendrikmuhs"}, "path": "x-pack/plugin/transform/src/main/java/org/elasticsearch/xpack/transform/persistence/TransformInternalIndex.java", "diffHunk": "@@ -399,7 +405,7 @@ protected static void installLatestAuditIndexTemplateIfRequired(\n \n         // Installing the template involves communication with the master node, so it's more expensive but much rarer\n         try {\n-            IndexTemplateMetaData indexTemplateMetaData = getAuditIndexTemplateMetaData();\n+            IndexTemplateMetaData indexTemplateMetaData = getAuditIndexTemplateMetaData(clusterService.state().nodes().getMinNodeVersion());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8507327c8f6c57337dc9ddfe2d073884868ce02f"}, "originalPosition": 54}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgwMTQ5OTkw", "url": "https://github.com/elastic/elasticsearch/pull/54036#pullrequestreview-380149990", "createdAt": "2020-03-24T09:52:24Z", "commit": {"oid": "8507327c8f6c57337dc9ddfe2d073884868ce02f"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "02a39a984e74688fbdf859e3a5709583b76ccaad", "author": {"user": {"login": "gwbrown", "name": "Gordon Brown"}}, "url": "https://github.com/elastic/elasticsearch/commit/02a39a984e74688fbdf859e3a5709583b76ccaad", "committedDate": "2020-03-24T20:39:33Z", "message": "Spelling fix per review"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1828, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}