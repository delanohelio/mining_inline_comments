{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM5NTgwNTAw", "number": 58521, "title": "Merge mappings for composable index templates", "bodyText": "This PR implements recursive mapping merging for composable index templates.\nWhen creating an index, we perform the following:\n\nAdd each component template mapping in order, merging each one in after the\nlast.\nMerge in the index template mappings (if present).\nMerge in the mappings on the index request itself (if present).\n\nSome principles:\n\nAll 'structural' changes are disallowed (but everything else is fine). An\nobject mapper can never be changed between type: object and type: nested. A\nfield mapper can never be changed to an object mapper, and vice versa.\nGenerally, each section is merged recursively. This includes object\nmappings, as well as root options like dynamic_templates and meta. Once we\nreach 'leaf components' like field definitions, they always overwrite an\nexisting one instead of being merged.\n\nThe PR is pretty large, but each commit can be reviewed individually.\nRelates to #53101.", "createdAt": "2020-06-25T00:04:02Z", "url": "https://github.com/elastic/elasticsearch/pull/58521", "merged": true, "mergeCommit": {"oid": "676893a2632fa922fe33f170ef7730062c3792da"}, "closed": true, "closedAt": "2020-06-29T22:00:41Z", "author": {"login": "jtibshirani"}, "timelineItems": {"totalCount": 18, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcugn-9AH2gAyNDM5NTgwNTAwOjVmYTBiN2QwOWE2ZDkxZGI3Njc3MTAzYmJlODQzYjM1MGYwYjFmYjY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcwHhoZgH2gAyNDM5NTgwNTAwOjE4OTljMjg5MDM5ZmJmYmJhMGRjNGQ3NTQzOTg0ODRjMDdlMTQwNjE=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "5fa0b7d09a6d91db7677103bbe843b350f0b1fb6", "author": {"user": {"login": "jtibshirani", "name": "Julie Tibshirani"}}, "url": "https://github.com/elastic/elasticsearch/commit/5fa0b7d09a6d91db7677103bbe843b350f0b1fb6", "committedDate": "2020-06-24T21:07:14Z", "message": "Pass merge reason to Mapping#merge."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c30d286aaed026e29aa80d2d5d3e41445e8549a2", "author": {"user": {"login": "jtibshirani", "name": "Julie Tibshirani"}}, "url": "https://github.com/elastic/elasticsearch/commit/c30d286aaed026e29aa80d2d5d3e41445e8549a2", "committedDate": "2020-06-25T00:02:26Z", "message": "Use new merge strategy for composable templates."}, "afterCommit": {"oid": "6f5e142d8838c7d9b461f78b7a51e58e101922ec", "author": {"user": {"login": "jtibshirani", "name": "Julie Tibshirani"}}, "url": "https://github.com/elastic/elasticsearch/commit/6f5e142d8838c7d9b461f78b7a51e58e101922ec", "committedDate": "2020-06-25T01:19:44Z", "message": "Use new merge strategy for composable templates."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2e7db9124fb2bc60f30bebffd3b355d68b84d831", "author": {"user": {"login": "jtibshirani", "name": "Julie Tibshirani"}}, "url": "https://github.com/elastic/elasticsearch/commit/2e7db9124fb2bc60f30bebffd3b355d68b84d831", "committedDate": "2020-06-25T01:37:00Z", "message": "Add an 'index template' merge reason."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "35a6856bd53fea198d0adb99e61f70923a0efaa7", "author": {"user": {"login": "jtibshirani", "name": "Julie Tibshirani"}}, "url": "https://github.com/elastic/elasticsearch/commit/35a6856bd53fea198d0adb99e61f70923a0efaa7", "committedDate": "2020-06-25T01:37:04Z", "message": "Add template merging logic for root-level mapper.\n\nThe differences from standard mapping merge:\n* For metadata fields like _source, the whole field definition is replaced\n  instead of merged.\n* Dynamic templates are appended to the end of the existing list. Any duplicate\n  definitions overwrite existing ones.\n* The _meta object is deep-merged, so any existing keys are replaced."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f44a5f948fbbd1030ae2aab1a7365c0674dc68ab", "author": {"user": {"login": "jtibshirani", "name": "Julie Tibshirani"}}, "url": "https://github.com/elastic/elasticsearch/commit/f44a5f948fbbd1030ae2aab1a7365c0674dc68ab", "committedDate": "2020-06-25T02:47:44Z", "message": "Replace leaf fields when merging objects."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "25ed9aa59956fe2065fbde3e3ca66c1410901540", "author": {"user": {"login": "jtibshirani", "name": "Julie Tibshirani"}}, "url": "https://github.com/elastic/elasticsearch/commit/25ed9aa59956fe2065fbde3e3ca66c1410901540", "committedDate": "2020-06-25T02:48:07Z", "message": "Overwrite enabled, include_in_parent, include_in_root."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5a379032f7451a2b9fb389c2d8bc43c645ecbc68", "author": {"user": {"login": "jtibshirani", "name": "Julie Tibshirani"}}, "url": "https://github.com/elastic/elasticsearch/commit/5a379032f7451a2b9fb389c2d8bc43c645ecbc68", "committedDate": "2020-06-25T03:05:17Z", "message": "Use new merge strategy for composable templates."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6f5e142d8838c7d9b461f78b7a51e58e101922ec", "author": {"user": {"login": "jtibshirani", "name": "Julie Tibshirani"}}, "url": "https://github.com/elastic/elasticsearch/commit/6f5e142d8838c7d9b461f78b7a51e58e101922ec", "committedDate": "2020-06-25T01:19:44Z", "message": "Use new merge strategy for composable templates."}, "afterCommit": {"oid": "5a379032f7451a2b9fb389c2d8bc43c645ecbc68", "author": {"user": {"login": "jtibshirani", "name": "Julie Tibshirani"}}, "url": "https://github.com/elastic/elasticsearch/commit/5a379032f7451a2b9fb389c2d8bc43c645ecbc68", "committedDate": "2020-06-25T03:05:17Z", "message": "Use new merge strategy for composable templates."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM3NzMwMTMx", "url": "https://github.com/elastic/elasticsearch/pull/58521#pullrequestreview-437730131", "createdAt": "2020-06-25T17:57:16Z", "commit": {"oid": "5a379032f7451a2b9fb389c2d8bc43c645ecbc68"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNVQxNzo1NzoxN1rOGpFrrQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNVQxNzo1NzoxN1rOGpFrrQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTczNzkwMQ==", "bodyText": "The fact that we fix redundant includes makes merging these options more tricky. Previously, mapping merges couldn't make any changes to the include_in_root or include_in_parent values. Now they can overwrite existing values, so we could have the following situation:\n\nA new mapper changes include_in_root and include_in_parent to true for some nested object.\nAfter merging it into the existing one, say the merged mapper now has redundant includes.\nWe never detect and fix the redundancy because we only call fixRedundantIncludes when building a mapper, not after merging mappers.\n\nI'm wondering if there's a lightweight way to fix this, or some way we can simplify?", "url": "https://github.com/elastic/elasticsearch/pull/58521#discussion_r445737901", "createdAt": "2020-06-25T17:57:17Z", "author": {"login": "jtibshirani"}, "path": "server/src/main/java/org/elasticsearch/index/mapper/RootObjectMapper.java", "diffHunk": "@@ -107,15 +109,15 @@ private static void fixRedundantIncludes(ObjectMapper.Builder omb, boolean paren\n                     boolean includeInRootViaParent = parentIncluded && isNested && nested.isIncludeInParent();\n                     boolean includedInRoot = isNested && nested.isIncludeInRoot();\n                     if (includeInRootViaParent && includedInRoot) {\n-                        child.nested = Nested.newNested(true, false);\n+                        child.nested = Nested.newNested(new Explicit<>(true, true), new Explicit<>(false, true));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5a379032f7451a2b9fb389c2d8bc43c645ecbc68"}, "originalPosition": 20}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM3ODE3MDg2", "url": "https://github.com/elastic/elasticsearch/pull/58521#pullrequestreview-437817086", "createdAt": "2020-06-25T20:02:14Z", "commit": {"oid": "5a379032f7451a2b9fb389c2d8bc43c645ecbc68"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 13, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNVQyMDowMjoxNVrOGpJ2UA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNVQyMDoyMDo0NVrOGpKaKw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTgwNjE2MA==", "bodyText": "I think this docstring is incorrect now", "url": "https://github.com/elastic/elasticsearch/pull/58521#discussion_r445806160", "createdAt": "2020-06-25T20:02:15Z", "author": {"login": "dakrone"}, "path": "server/src/main/java/org/elasticsearch/cluster/metadata/DataStream.java", "diffHunk": "@@ -247,12 +246,8 @@ public TimestampField(StreamInput in) throws IOException {\n          * Force fully inserts the timestamp field mapping into the provided mapping.\n          * Existing mapping definitions for the timestamp field will be completely overwritten.\n          * Takes into account if the name of the timestamp field is nested.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5a379032f7451a2b9fb389c2d8bc43c645ecbc68"}, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTgwNjMwMQ==", "bodyText": "It's a bit strange to call this \"changes\" since we're retrieving the mapping for a single field in this method?", "url": "https://github.com/elastic/elasticsearch/pull/58521#discussion_r445806301", "createdAt": "2020-06-25T20:02:34Z", "author": {"login": "dakrone"}, "path": "server/src/main/java/org/elasticsearch/cluster/metadata/DataStream.java", "diffHunk": "@@ -265,7 +260,7 @@ public void insertTimestampFieldMapping(Map<String, Object> mappings) {\n                 current = map;\n             }\n             current.put(leafFieldName, fieldMapping);\n-            XContentHelper.update(mappings, changes, false);\n+            return changes;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5a379032f7451a2b9fb389c2d8bc43c645ecbc68"}, "originalPosition": 27}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTgwODcwMg==", "bodyText": "I think I'd rather keep this guard than throw a null pointer exception a couple of lines down, is there a reason you removed it?", "url": "https://github.com/elastic/elasticsearch/pull/58521#discussion_r445808702", "createdAt": "2020-06-25T20:07:28Z", "author": {"login": "dakrone"}, "path": "server/src/main/java/org/elasticsearch/cluster/metadata/MetadataIndexTemplateService.java", "diffHunk": "@@ -871,15 +871,12 @@ public static String findV2Template(Metadata metadata, String indexName, boolean\n     }\n \n     /**\n-     * Resolve the given v2 template into an ordered list of mappings\n+     * Collect the given v2 template into an ordered list of mappings.\n      */\n-    public static List<CompressedXContent> resolveMappings(final ClusterState state, final String templateName) {\n+    public static List<CompressedXContent> collectMappings(final ClusterState state, final String templateName) {\n         final ComposableIndexTemplate template = state.metadata().templatesV2().get(templateName);\n         assert template != null : \"attempted to resolve mappings for a template [\" + templateName +\n             \"] that did not exist in the cluster state\";\n-        if (template == null) {\n-            return List.of();\n-        }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5a379032f7451a2b9fb389c2d8bc43c645ecbc68"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTgwOTM2OQ==", "bodyText": "or at the least, convert this to a real exception rather than an NPE if you want to get rid of it", "url": "https://github.com/elastic/elasticsearch/pull/58521#discussion_r445809369", "createdAt": "2020-06-25T20:08:39Z", "author": {"login": "dakrone"}, "path": "server/src/main/java/org/elasticsearch/cluster/metadata/MetadataIndexTemplateService.java", "diffHunk": "@@ -871,15 +871,12 @@ public static String findV2Template(Metadata metadata, String indexName, boolean\n     }\n \n     /**\n-     * Resolve the given v2 template into an ordered list of mappings\n+     * Collect the given v2 template into an ordered list of mappings.\n      */\n-    public static List<CompressedXContent> resolveMappings(final ClusterState state, final String templateName) {\n+    public static List<CompressedXContent> collectMappings(final ClusterState state, final String templateName) {\n         final ComposableIndexTemplate template = state.metadata().templatesV2().get(templateName);\n         assert template != null : \"attempted to resolve mappings for a template [\" + templateName +\n             \"] that did not exist in the cluster state\";\n-        if (template == null) {\n-            return List.of();\n-        }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTgwODcwMg=="}, "originalCommit": {"oid": "5a379032f7451a2b9fb389c2d8bc43c645ecbc68"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTgxMDUwNA==", "bodyText": "I think this block can be folded into the same check a few lines above rather than having two blocks using the same if statement", "url": "https://github.com/elastic/elasticsearch/pull/58521#discussion_r445810504", "createdAt": "2020-06-25T20:11:02Z", "author": {"login": "dakrone"}, "path": "server/src/main/java/org/elasticsearch/index/mapper/MapperService.java", "diffHunk": "@@ -372,24 +376,22 @@ private synchronized DocumentMapper internalMerge(DocumentMapper mapper, MergeRe\n \n         ContextMapping.validateContextPaths(indexSettings.getIndexVersionCreated(), fieldMappers, newFieldTypes::get);\n \n-        if (reason == MergeReason.MAPPING_UPDATE || reason == MergeReason.MAPPING_UPDATE_PREFLIGHT) {\n-            // this check will only be performed on the master node when there is\n-            // a call to the update mapping API. For all other cases like\n-            // the master node restoring mappings from disk or data nodes\n-            // deserializing cluster state that was sent by the master node,\n-            // this check will be skipped.\n+        if (reason != MergeReason.MAPPING_RECOVERY) {\n+            // this check will only be performed on the master node when an index is created, or\n+            // there is a call to the update mapping API. For all other cases like the master node\n+            // restoring mappings from disk or data nodes deserializing cluster state that was sent\n+            // by the master node, this check will be skipped.\n             // Also, don't take metadata mappers into account for the field limit check\n             checkTotalFieldsLimit(objectMappers.size() + fieldMappers.size() - metadataMappers.length\n                 + fieldAliasMappers.size() );\n             checkFieldNameSoftLimit(objectMappers, fieldMappers, fieldAliasMappers);\n         }\n \n-        if (reason == MergeReason.MAPPING_UPDATE || reason == MergeReason.MAPPING_UPDATE_PREFLIGHT) {\n-            // this check will only be performed on the master node when there is\n-            // a call to the update mapping API. For all other cases like\n-            // the master node restoring mappings from disk or data nodes\n-            // deserializing cluster state that was sent by the master node,\n-            // this check will be skipped.\n+        if (reason != MergeReason.MAPPING_RECOVERY) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5a379032f7451a2b9fb389c2d8bc43c645ecbc68"}, "originalPosition": 47}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTgxMTIyNg==", "bodyText": "Super minor nit, but most of our error messages are all lowercase and without ending punctuation and I think that's the precedent we want to stick with (applies to the errors below also)\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                                throw new IllegalArgumentException(\"Cannot change object mapping from nested to non-nested.\");\n          \n          \n            \n                                throw new IllegalArgumentException(\"cannot change object mapping from nested to non-nested\");", "url": "https://github.com/elastic/elasticsearch/pull/58521#discussion_r445811226", "createdAt": "2020-06-25T20:12:32Z", "author": {"login": "dakrone"}, "path": "server/src/main/java/org/elasticsearch/index/mapper/ObjectMapper.java", "diffHunk": "@@ -62,41 +64,71 @@\n \n     public static class Nested {\n \n-        public static final Nested NO = new Nested(false, false, false);\n+        public static final Nested NO = new Nested(false, new Explicit<>(false, false), new Explicit<>(false, false));\n \n-        public static Nested newNested(boolean includeInParent, boolean includeInRoot) {\n+        public static Nested newNested() {\n+            return new Nested(true, new Explicit<>(false, false), new Explicit<>(false, false));\n+        }\n+\n+        public static Nested newNested(Explicit<Boolean> includeInParent, Explicit<Boolean> includeInRoot) {\n             return new Nested(true, includeInParent, includeInRoot);\n         }\n \n         private final boolean nested;\n+        private Explicit<Boolean> includeInParent;\n+        private Explicit<Boolean> includeInRoot;\n \n-        private final boolean includeInParent;\n-\n-        private final boolean includeInRoot;\n-\n-        private Nested(boolean nested, boolean includeInParent, boolean includeInRoot) {\n+        private Nested(boolean nested, Explicit<Boolean> includeInParent, Explicit<Boolean> includeInRoot) {\n             this.nested = nested;\n             this.includeInParent = includeInParent;\n             this.includeInRoot = includeInRoot;\n         }\n \n+        public void merge(Nested mergeWith, MergeReason reason) {\n+            if (isNested()) {\n+                if (!mergeWith.isNested()) {\n+                    throw new IllegalArgumentException(\"Cannot change object mapping from nested to non-nested.\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5a379032f7451a2b9fb389c2d8bc43c645ecbc68"}, "originalPosition": 50}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTgxMTgyNw==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                                throw new IllegalArgumentException(\"Cannot change object mapping from non-nested to nested.\");\n          \n          \n            \n                                throw new IllegalArgumentException(\"cannot change object mapping from non-nested to nested\");", "url": "https://github.com/elastic/elasticsearch/pull/58521#discussion_r445811827", "createdAt": "2020-06-25T20:13:45Z", "author": {"login": "dakrone"}, "path": "server/src/main/java/org/elasticsearch/index/mapper/ObjectMapper.java", "diffHunk": "@@ -62,41 +64,71 @@\n \n     public static class Nested {\n \n-        public static final Nested NO = new Nested(false, false, false);\n+        public static final Nested NO = new Nested(false, new Explicit<>(false, false), new Explicit<>(false, false));\n \n-        public static Nested newNested(boolean includeInParent, boolean includeInRoot) {\n+        public static Nested newNested() {\n+            return new Nested(true, new Explicit<>(false, false), new Explicit<>(false, false));\n+        }\n+\n+        public static Nested newNested(Explicit<Boolean> includeInParent, Explicit<Boolean> includeInRoot) {\n             return new Nested(true, includeInParent, includeInRoot);\n         }\n \n         private final boolean nested;\n+        private Explicit<Boolean> includeInParent;\n+        private Explicit<Boolean> includeInRoot;\n \n-        private final boolean includeInParent;\n-\n-        private final boolean includeInRoot;\n-\n-        private Nested(boolean nested, boolean includeInParent, boolean includeInRoot) {\n+        private Nested(boolean nested, Explicit<Boolean> includeInParent, Explicit<Boolean> includeInRoot) {\n             this.nested = nested;\n             this.includeInParent = includeInParent;\n             this.includeInRoot = includeInRoot;\n         }\n \n+        public void merge(Nested mergeWith, MergeReason reason) {\n+            if (isNested()) {\n+                if (!mergeWith.isNested()) {\n+                    throw new IllegalArgumentException(\"Cannot change object mapping from nested to non-nested.\");\n+                }\n+            } else {\n+                if (mergeWith.isNested()) {\n+                    throw new IllegalArgumentException(\"Cannot change object mapping from non-nested to nested.\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5a379032f7451a2b9fb389c2d8bc43c645ecbc68"}, "originalPosition": 54}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTgxMTk1Ng==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                                throw new MapperException(\"The [include_in_parent] parameter can't be updated on a nested object mapping.\");\n          \n          \n            \n                                throw new MapperException(\"the [include_in_parent] parameter can't be updated on a nested object mapping\");", "url": "https://github.com/elastic/elasticsearch/pull/58521#discussion_r445811956", "createdAt": "2020-06-25T20:14:00Z", "author": {"login": "dakrone"}, "path": "server/src/main/java/org/elasticsearch/index/mapper/ObjectMapper.java", "diffHunk": "@@ -62,41 +64,71 @@\n \n     public static class Nested {\n \n-        public static final Nested NO = new Nested(false, false, false);\n+        public static final Nested NO = new Nested(false, new Explicit<>(false, false), new Explicit<>(false, false));\n \n-        public static Nested newNested(boolean includeInParent, boolean includeInRoot) {\n+        public static Nested newNested() {\n+            return new Nested(true, new Explicit<>(false, false), new Explicit<>(false, false));\n+        }\n+\n+        public static Nested newNested(Explicit<Boolean> includeInParent, Explicit<Boolean> includeInRoot) {\n             return new Nested(true, includeInParent, includeInRoot);\n         }\n \n         private final boolean nested;\n+        private Explicit<Boolean> includeInParent;\n+        private Explicit<Boolean> includeInRoot;\n \n-        private final boolean includeInParent;\n-\n-        private final boolean includeInRoot;\n-\n-        private Nested(boolean nested, boolean includeInParent, boolean includeInRoot) {\n+        private Nested(boolean nested, Explicit<Boolean> includeInParent, Explicit<Boolean> includeInRoot) {\n             this.nested = nested;\n             this.includeInParent = includeInParent;\n             this.includeInRoot = includeInRoot;\n         }\n \n+        public void merge(Nested mergeWith, MergeReason reason) {\n+            if (isNested()) {\n+                if (!mergeWith.isNested()) {\n+                    throw new IllegalArgumentException(\"Cannot change object mapping from nested to non-nested.\");\n+                }\n+            } else {\n+                if (mergeWith.isNested()) {\n+                    throw new IllegalArgumentException(\"Cannot change object mapping from non-nested to nested.\");\n+                }\n+            }\n+\n+            if (reason == MergeReason.INDEX_TEMPLATE) {\n+                if (mergeWith.includeInParent.explicit()) {\n+                    includeInParent = mergeWith.includeInParent;\n+                }\n+                if (mergeWith.includeInRoot.explicit()) {\n+                    includeInRoot = mergeWith.includeInRoot;\n+                }\n+            } else {\n+                if (includeInParent.value() != mergeWith.includeInParent.value()) {\n+                    throw new MapperException(\"The [include_in_parent] parameter can't be updated on a nested object mapping.\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5a379032f7451a2b9fb389c2d8bc43c645ecbc68"}, "originalPosition": 67}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTgxMjA1OQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                                throw new MapperException(\"The [include_in_root] parameter can't be updated on a nested object mapping.\");\n          \n          \n            \n                                throw new MapperException(\"the [include_in_root] parameter can't be updated on a nested object mapping\");", "url": "https://github.com/elastic/elasticsearch/pull/58521#discussion_r445812059", "createdAt": "2020-06-25T20:14:13Z", "author": {"login": "dakrone"}, "path": "server/src/main/java/org/elasticsearch/index/mapper/ObjectMapper.java", "diffHunk": "@@ -62,41 +64,71 @@\n \n     public static class Nested {\n \n-        public static final Nested NO = new Nested(false, false, false);\n+        public static final Nested NO = new Nested(false, new Explicit<>(false, false), new Explicit<>(false, false));\n \n-        public static Nested newNested(boolean includeInParent, boolean includeInRoot) {\n+        public static Nested newNested() {\n+            return new Nested(true, new Explicit<>(false, false), new Explicit<>(false, false));\n+        }\n+\n+        public static Nested newNested(Explicit<Boolean> includeInParent, Explicit<Boolean> includeInRoot) {\n             return new Nested(true, includeInParent, includeInRoot);\n         }\n \n         private final boolean nested;\n+        private Explicit<Boolean> includeInParent;\n+        private Explicit<Boolean> includeInRoot;\n \n-        private final boolean includeInParent;\n-\n-        private final boolean includeInRoot;\n-\n-        private Nested(boolean nested, boolean includeInParent, boolean includeInRoot) {\n+        private Nested(boolean nested, Explicit<Boolean> includeInParent, Explicit<Boolean> includeInRoot) {\n             this.nested = nested;\n             this.includeInParent = includeInParent;\n             this.includeInRoot = includeInRoot;\n         }\n \n+        public void merge(Nested mergeWith, MergeReason reason) {\n+            if (isNested()) {\n+                if (!mergeWith.isNested()) {\n+                    throw new IllegalArgumentException(\"Cannot change object mapping from nested to non-nested.\");\n+                }\n+            } else {\n+                if (mergeWith.isNested()) {\n+                    throw new IllegalArgumentException(\"Cannot change object mapping from non-nested to nested.\");\n+                }\n+            }\n+\n+            if (reason == MergeReason.INDEX_TEMPLATE) {\n+                if (mergeWith.includeInParent.explicit()) {\n+                    includeInParent = mergeWith.includeInParent;\n+                }\n+                if (mergeWith.includeInRoot.explicit()) {\n+                    includeInRoot = mergeWith.includeInRoot;\n+                }\n+            } else {\n+                if (includeInParent.value() != mergeWith.includeInParent.value()) {\n+                    throw new MapperException(\"The [include_in_parent] parameter can't be updated on a nested object mapping.\");\n+                }\n+                if (includeInRoot.value() != mergeWith.includeInRoot.value()) {\n+                    throw new MapperException(\"The [include_in_root] parameter can't be updated on a nested object mapping.\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5a379032f7451a2b9fb389c2d8bc43c645ecbc68"}, "originalPosition": 70}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTgxMjgyMA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        throw new IllegalArgumentException(\"Can't merge a non object mapping [\" + mergeWith.name() + \"] with an object mapping\");\n          \n          \n            \n                        throw new IllegalArgumentException(\"can't merge a non object mapping [\" + mergeWith.name() + \"] with an object mapping\");", "url": "https://github.com/elastic/elasticsearch/pull/58521#discussion_r445812820", "createdAt": "2020-06-25T20:15:45Z", "author": {"login": "dakrone"}, "path": "server/src/main/java/org/elasticsearch/index/mapper/ObjectMapper.java", "diffHunk": "@@ -440,64 +474,62 @@ public boolean parentObjectMapperAreNested(MapperService mapperService) {\n \n     @Override\n     public ObjectMapper merge(Mapper mergeWith) {\n+        return merge(mergeWith, MergeReason.MAPPING_UPDATE);\n+    }\n+\n+    public ObjectMapper merge(Mapper mergeWith, MergeReason reason) {\n         if (!(mergeWith instanceof ObjectMapper)) {\n-            throw new IllegalArgumentException(\"Can't merge a non object mapping [\" + mergeWith.name()\n-                + \"] with an object mapping [\" + name() + \"]\");\n+            throw new IllegalArgumentException(\"Can't merge a non object mapping [\" + mergeWith.name() + \"] with an object mapping\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5a379032f7451a2b9fb389c2d8bc43c645ecbc68"}, "originalPosition": 182}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTgxMjkzNQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        throw new MapperException(\"The [enabled] parameter can't be updated for the object mapping [\" + name() + \"].\");\n          \n          \n            \n                        throw new MapperException(\"the [enabled] parameter can't be updated for the object mapping [\" + name() + \"]\");", "url": "https://github.com/elastic/elasticsearch/pull/58521#discussion_r445812935", "createdAt": "2020-06-25T20:16:03Z", "author": {"login": "dakrone"}, "path": "server/src/main/java/org/elasticsearch/index/mapper/ObjectMapper.java", "diffHunk": "@@ -440,64 +474,62 @@ public boolean parentObjectMapperAreNested(MapperService mapperService) {\n \n     @Override\n     public ObjectMapper merge(Mapper mergeWith) {\n+        return merge(mergeWith, MergeReason.MAPPING_UPDATE);\n+    }\n+\n+    public ObjectMapper merge(Mapper mergeWith, MergeReason reason) {\n         if (!(mergeWith instanceof ObjectMapper)) {\n-            throw new IllegalArgumentException(\"Can't merge a non object mapping [\" + mergeWith.name()\n-                + \"] with an object mapping [\" + name() + \"]\");\n+            throw new IllegalArgumentException(\"Can't merge a non object mapping [\" + mergeWith.name() + \"] with an object mapping\");\n         }\n         ObjectMapper mergeWithObject = (ObjectMapper) mergeWith;\n         ObjectMapper merged = clone();\n-        merged.doMerge(mergeWithObject);\n+        merged.doMerge(mergeWithObject, reason);\n         return merged;\n     }\n \n-    protected void doMerge(final ObjectMapper mergeWith) {\n-        if (nested().isNested()) {\n-            if (!mergeWith.nested().isNested()) {\n-                throw new IllegalArgumentException(\"object mapping [\" + name() + \"] can't be changed from nested to non-nested\");\n-            }\n-        } else {\n-            if (mergeWith.nested().isNested()) {\n-                throw new IllegalArgumentException(\"object mapping [\" + name() + \"] can't be changed from non-nested to nested\");\n-            }\n-        }\n+    protected void doMerge(final ObjectMapper mergeWith, MergeReason reason) {\n+        nested().merge(mergeWith.nested(), reason);\n \n         if (mergeWith.dynamic != null) {\n             this.dynamic = mergeWith.dynamic;\n         }\n \n-        checkObjectMapperParameters(mergeWith);\n+        if (reason == MergeReason.INDEX_TEMPLATE) {\n+            if (mergeWith.enabled.explicit()) {\n+                this.enabled = mergeWith.enabled;\n+            }\n+        } else if (isEnabled() != mergeWith.isEnabled()) {\n+            throw new MapperException(\"The [enabled] parameter can't be updated for the object mapping [\" + name() + \"].\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5a379032f7451a2b9fb389c2d8bc43c645ecbc68"}, "originalPosition": 214}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTgxMzEwMA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                                throw new IllegalArgumentException(\"Can't merge a non object mapping [\" +\n          \n          \n            \n                                    mergeWithMapper.name() + \"] with an object mapping\");\n          \n          \n            \n                                throw new IllegalArgumentException(\"can't merge a non object mapping [\" +\n          \n          \n            \n                                    mergeWithMapper.name() + \"] with an object mapping\");", "url": "https://github.com/elastic/elasticsearch/pull/58521#discussion_r445813100", "createdAt": "2020-06-25T20:16:23Z", "author": {"login": "dakrone"}, "path": "server/src/main/java/org/elasticsearch/index/mapper/ObjectMapper.java", "diffHunk": "@@ -440,64 +474,62 @@ public boolean parentObjectMapperAreNested(MapperService mapperService) {\n \n     @Override\n     public ObjectMapper merge(Mapper mergeWith) {\n+        return merge(mergeWith, MergeReason.MAPPING_UPDATE);\n+    }\n+\n+    public ObjectMapper merge(Mapper mergeWith, MergeReason reason) {\n         if (!(mergeWith instanceof ObjectMapper)) {\n-            throw new IllegalArgumentException(\"Can't merge a non object mapping [\" + mergeWith.name()\n-                + \"] with an object mapping [\" + name() + \"]\");\n+            throw new IllegalArgumentException(\"Can't merge a non object mapping [\" + mergeWith.name() + \"] with an object mapping\");\n         }\n         ObjectMapper mergeWithObject = (ObjectMapper) mergeWith;\n         ObjectMapper merged = clone();\n-        merged.doMerge(mergeWithObject);\n+        merged.doMerge(mergeWithObject, reason);\n         return merged;\n     }\n \n-    protected void doMerge(final ObjectMapper mergeWith) {\n-        if (nested().isNested()) {\n-            if (!mergeWith.nested().isNested()) {\n-                throw new IllegalArgumentException(\"object mapping [\" + name() + \"] can't be changed from nested to non-nested\");\n-            }\n-        } else {\n-            if (mergeWith.nested().isNested()) {\n-                throw new IllegalArgumentException(\"object mapping [\" + name() + \"] can't be changed from non-nested to nested\");\n-            }\n-        }\n+    protected void doMerge(final ObjectMapper mergeWith, MergeReason reason) {\n+        nested().merge(mergeWith.nested(), reason);\n \n         if (mergeWith.dynamic != null) {\n             this.dynamic = mergeWith.dynamic;\n         }\n \n-        checkObjectMapperParameters(mergeWith);\n+        if (reason == MergeReason.INDEX_TEMPLATE) {\n+            if (mergeWith.enabled.explicit()) {\n+                this.enabled = mergeWith.enabled;\n+            }\n+        } else if (isEnabled() != mergeWith.isEnabled()) {\n+            throw new MapperException(\"The [enabled] parameter can't be updated for the object mapping [\" + name() + \"].\");\n+        }\n \n         for (Mapper mergeWithMapper : mergeWith) {\n             Mapper mergeIntoMapper = mappers.get(mergeWithMapper.simpleName());\n \n             Mapper merged;\n             if (mergeIntoMapper == null) {\n-                // no mapping, simply add it\n                 merged = mergeWithMapper;\n+            } else if (mergeIntoMapper instanceof ObjectMapper) {\n+                ObjectMapper objectMapper = (ObjectMapper) mergeIntoMapper;\n+                merged = objectMapper.merge(mergeWithMapper, reason);\n             } else {\n-                // root mappers can only exist here for backcompat, and are merged in Mapping\n-                merged = mergeIntoMapper.merge(mergeWithMapper);\n+                assert mergeIntoMapper instanceof FieldMapper || mergeIntoMapper instanceof FieldAliasMapper;\n+                if (mergeWithMapper instanceof ObjectMapper) {\n+                    throw new IllegalArgumentException(\"Can't merge a non object mapping [\" +\n+                        mergeWithMapper.name() + \"] with an object mapping\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5a379032f7451a2b9fb389c2d8bc43c645ecbc68"}, "originalPosition": 233}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTgxNTMzOQ==", "bodyText": "Yikes that we are doing regex matches on exception messages here :( it feels like there should be a better way, but totally out of scope for this PR", "url": "https://github.com/elastic/elasticsearch/pull/58521#discussion_r445815339", "createdAt": "2020-06-25T20:20:45Z", "author": {"login": "dakrone"}, "path": "x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/job/JobManager.java", "diffHunk": "@@ -275,8 +275,8 @@ public void onResponse(Boolean mappingsUpdated) {\n             public void onFailure(Exception e) {\n                 if (ExceptionsHelper.unwrapCause(e) instanceof IllegalArgumentException) {\n                     // the underlying error differs depending on which way around the clashing fields are seen\n-                    Matcher matcher = Pattern.compile(\"(?:mapper|Can't merge a non object mapping) \\\\[(.*)\\\\] (?:cannot be changed \" +\n-                            \"from type \\\\[.*\\\\] to|with an object mapping) \\\\[.*\\\\]\").matcher(e.getMessage());\n+                    Matcher matcher = Pattern.compile(\"Can't merge a non object mapping \\\\[(.*)\\\\] with an object mapping\")\n+                        .matcher(e.getMessage());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5a379032f7451a2b9fb389c2d8bc43c645ecbc68"}, "originalPosition": 7}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM4MzcyMjQy", "url": "https://github.com/elastic/elasticsearch/pull/58521#pullrequestreview-438372242", "createdAt": "2020-06-26T15:05:15Z", "commit": {"oid": "5a379032f7451a2b9fb389c2d8bc43c645ecbc68"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQxNTowNToxNVrOGpkXDA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQxNTowNToxNVrOGpkXDA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjI0MDUyNA==", "bodyText": "After chatting with the core-features team, I now realize that we should apply request.mappings() after this datastream mapping. I'll fix this.", "url": "https://github.com/elastic/elasticsearch/pull/58521#discussion_r446240524", "createdAt": "2020-06-26T15:05:15Z", "author": {"login": "jtibshirani"}, "path": "server/src/main/java/org/elasticsearch/cluster/metadata/MetadataCreateIndexService.java", "diffHunk": "@@ -491,12 +488,12 @@ private ClusterState applyCreateIndexRequestWithV2Template(final ClusterState cu\n                                                                                     throws Exception {\n         logger.debug(\"applying create index request using composable template [{}]\", templateName);\n \n-        final Map<String, Object> mappings = resolveV2Mappings(request.mappings(), currentState, templateName, xContentRegistry);\n+        final List<Map<String, Object>> mappings = collectV2Mappings(request.mappings(), currentState, templateName, xContentRegistry);\n \n         if (request.dataStreamName() != null) {\n             DataStream dataStream = currentState.metadata().dataStreams().get(request.dataStreamName());\n             if (dataStream != null) {\n-                dataStream.getTimeStampField().insertTimestampFieldMapping(mappings);\n+                mappings.add(dataStream.getTimeStampField().getTimestampFieldMapping());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5a379032f7451a2b9fb389c2d8bc43c645ecbc68"}, "originalPosition": 62}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2af0fb3dbe3a02d707bd082fe000de774962a479", "author": {"user": {"login": "jtibshirani", "name": "Julie Tibshirani"}}, "url": "https://github.com/elastic/elasticsearch/commit/2af0fb3dbe3a02d707bd082fe000de774962a479", "committedDate": "2020-06-26T18:24:07Z", "message": "Small fixes to DataStream#getTimestampFieldMapping."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f1422bd35d11ce966583f4566c5a87eab01bb5a4", "author": {"user": {"login": "jtibshirani", "name": "Julie Tibshirani"}}, "url": "https://github.com/elastic/elasticsearch/commit/f1422bd35d11ce966583f4566c5a87eab01bb5a4", "committedDate": "2020-06-26T18:39:28Z", "message": "Lowercase error messages and remove punctuation."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ae6c79db5c33cd2fda6e234446ab70cc47d2e7cf", "author": {"user": {"login": "jtibshirani", "name": "Julie Tibshirani"}}, "url": "https://github.com/elastic/elasticsearch/commit/ae6c79db5c33cd2fda6e234446ab70cc47d2e7cf", "committedDate": "2020-06-26T20:04:57Z", "message": "Move check for redundant nested includes to MapperService#merge."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM5MjExMDI2", "url": "https://github.com/elastic/elasticsearch/pull/58521#pullrequestreview-439211026", "createdAt": "2020-06-29T14:38:21Z", "commit": {"oid": "ae6c79db5c33cd2fda6e234446ab70cc47d2e7cf"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yOVQxNDozODoyMlrOGqUDFA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yOVQxNDo1NDowOVrOGqUxWg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzAyMTg0NA==", "bodyText": "Maybe add a small comment explaining the logic for meta and metadata fields ?", "url": "https://github.com/elastic/elasticsearch/pull/58521#discussion_r447021844", "createdAt": "2020-06-29T14:38:22Z", "author": {"login": "jimczi"}, "path": "server/src/main/java/org/elasticsearch/index/mapper/Mapping.java", "diffHunk": "@@ -86,21 +88,32 @@ public Mapping mappingUpdate(Mapper rootObjectMapper) {\n         return (T) metadataMappersMap.get(clazz);\n     }\n \n-    /** @see DocumentMapper#merge(Mapping) */\n-    public Mapping merge(Mapping mergeWith) {\n-        RootObjectMapper mergedRoot = root.merge(mergeWith.root);\n+    /** @see DocumentMapper#merge(Mapping, MergeReason) */\n+    public Mapping merge(Mapping mergeWith, MergeReason reason) {\n+        RootObjectMapper mergedRoot = root.merge(mergeWith.root, reason);\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ae6c79db5c33cd2fda6e234446ab70cc47d2e7cf"}, "originalPosition": 19}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzAzMzY5MA==", "bodyText": "I wonder if we should nullify the underlying mappers if enabled is false ? It's not related to this pr specifically but we don't need to keep children when the parent is disabled ?", "url": "https://github.com/elastic/elasticsearch/pull/58521#discussion_r447033690", "createdAt": "2020-06-29T14:54:09Z", "author": {"login": "jimczi"}, "path": "server/src/main/java/org/elasticsearch/index/mapper/ObjectMapper.java", "diffHunk": "@@ -440,64 +481,62 @@ public boolean parentObjectMapperAreNested(MapperService mapperService) {\n \n     @Override\n     public ObjectMapper merge(Mapper mergeWith) {\n+        return merge(mergeWith, MergeReason.MAPPING_UPDATE);\n+    }\n+\n+    public ObjectMapper merge(Mapper mergeWith, MergeReason reason) {\n         if (!(mergeWith instanceof ObjectMapper)) {\n-            throw new IllegalArgumentException(\"Can't merge a non object mapping [\" + mergeWith.name()\n-                + \"] with an object mapping [\" + name() + \"]\");\n+            throw new IllegalArgumentException(\"can't merge a non object mapping [\" + mergeWith.name() + \"] with an object mapping\");\n         }\n         ObjectMapper mergeWithObject = (ObjectMapper) mergeWith;\n         ObjectMapper merged = clone();\n-        merged.doMerge(mergeWithObject);\n+        merged.doMerge(mergeWithObject, reason);\n         return merged;\n     }\n \n-    protected void doMerge(final ObjectMapper mergeWith) {\n-        if (nested().isNested()) {\n-            if (!mergeWith.nested().isNested()) {\n-                throw new IllegalArgumentException(\"object mapping [\" + name() + \"] can't be changed from nested to non-nested\");\n-            }\n-        } else {\n-            if (mergeWith.nested().isNested()) {\n-                throw new IllegalArgumentException(\"object mapping [\" + name() + \"] can't be changed from non-nested to nested\");\n-            }\n-        }\n+    protected void doMerge(final ObjectMapper mergeWith, MergeReason reason) {\n+        nested().merge(mergeWith.nested(), reason);\n \n         if (mergeWith.dynamic != null) {\n             this.dynamic = mergeWith.dynamic;\n         }\n \n-        checkObjectMapperParameters(mergeWith);\n+        if (reason == MergeReason.INDEX_TEMPLATE) {\n+            if (mergeWith.enabled.explicit()) {\n+                this.enabled = mergeWith.enabled;\n+            }\n+        } else if (isEnabled() != mergeWith.isEnabled()) {\n+            throw new MapperException(\"the [enabled] parameter can't be updated for the object mapping [\" + name() + \"]\");\n+        }\n ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ae6c79db5c33cd2fda6e234446ab70cc47d2e7cf"}, "originalPosition": 230}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM5NDM4OTI2", "url": "https://github.com/elastic/elasticsearch/pull/58521#pullrequestreview-439438926", "createdAt": "2020-06-29T19:31:14Z", "commit": {"oid": "ae6c79db5c33cd2fda6e234446ab70cc47d2e7cf"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ff6833c92cfaed7da73eef50f0f64815192fad02", "author": {"user": {"login": "jtibshirani", "name": "Julie Tibshirani"}}, "url": "https://github.com/elastic/elasticsearch/commit/ff6833c92cfaed7da73eef50f0f64815192fad02", "committedDate": "2020-06-29T20:23:10Z", "message": "Add comments explaining how _meta and metadata fields are merged."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1899c289039fbfbba0dc4d754398484c07e14061", "author": {"user": {"login": "jtibshirani", "name": "Julie Tibshirani"}}, "url": "https://github.com/elastic/elasticsearch/commit/1899c289039fbfbba0dc4d754398484c07e14061", "committedDate": "2020-06-29T21:00:31Z", "message": "Merge remote-tracking branch 'upstream/master' into merge-template-mapping"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2611, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}