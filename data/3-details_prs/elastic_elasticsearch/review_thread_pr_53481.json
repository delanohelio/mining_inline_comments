{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg3MjU0NjMz", "number": 53481, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMlQxNTo1Nzo1NVrODnhk2A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMlQxNjo1NzoyNlrODnjCJA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQyNzcxMTYwOnYy", "diffSide": "RIGHT", "path": "server/src/main/java/org/elasticsearch/search/DocValueFormat.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMlQxNTo1Nzo1NVrOF1kwMA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMlQxNjowMDozMFrOF1k26w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTcyMTAwOA==", "bodyText": "I think this should be false", "url": "https://github.com/elastic/elasticsearch/pull/53481#discussion_r391721008", "createdAt": "2020-03-12T15:57:55Z", "author": {"login": "jaymode"}, "path": "server/src/main/java/org/elasticsearch/search/DocValueFormat.java", "diffHunk": "@@ -213,6 +221,13 @@ public void writeTo(StreamOutput out) throws IOException {\n             out.writeString(formatter.pattern());\n             out.writeString(timeZone.getId());\n             out.writeVInt(resolution.ordinal());\n+            if (out.getVersion().onOrAfter(Version.V_7_7_0) && out.getVersion().before(Version.V_8_0_0)) {\n+                /* when serializing to 7.7+  send out a flag indicating if a pattern is of joda style\n+                   This is only used to support joda style indices in 7.x, in 8 we no longer support this.\n+                   All indices in 8 should use java style pattern. Hence this flag is always true.\n+                */\n+                out.writeBoolean(true);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7bd055c4db5456d92f28c74f3b64dff14a543db0"}, "originalPosition": 31}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTcyMjczMQ==", "bodyText": "yes :)", "url": "https://github.com/elastic/elasticsearch/pull/53481#discussion_r391722731", "createdAt": "2020-03-12T16:00:30Z", "author": {"login": "pgomulka"}, "path": "server/src/main/java/org/elasticsearch/search/DocValueFormat.java", "diffHunk": "@@ -213,6 +221,13 @@ public void writeTo(StreamOutput out) throws IOException {\n             out.writeString(formatter.pattern());\n             out.writeString(timeZone.getId());\n             out.writeVInt(resolution.ordinal());\n+            if (out.getVersion().onOrAfter(Version.V_7_7_0) && out.getVersion().before(Version.V_8_0_0)) {\n+                /* when serializing to 7.7+  send out a flag indicating if a pattern is of joda style\n+                   This is only used to support joda style indices in 7.x, in 8 we no longer support this.\n+                   All indices in 8 should use java style pattern. Hence this flag is always true.\n+                */\n+                out.writeBoolean(true);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTcyMTAwOA=="}, "originalCommit": {"oid": "7bd055c4db5456d92f28c74f3b64dff14a543db0"}, "originalPosition": 31}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQyNzk0Nzg0OnYy", "diffSide": "RIGHT", "path": "server/src/main/java/org/elasticsearch/search/DocValueFormat.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMlQxNjo1Njo1MFrOF1nGpw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMlQxNzowNzoyMlrOF1ngIA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTc1OTUyNw==", "bodyText": "I think the in.getVersion().onOrAfter(Version.V_7_7_0) can be removed, but I can understand keeping it for clarity and safety.", "url": "https://github.com/elastic/elasticsearch/pull/53481#discussion_r391759527", "createdAt": "2020-03-12T16:56:50Z", "author": {"login": "benwtrent"}, "path": "server/src/main/java/org/elasticsearch/search/DocValueFormat.java", "diffHunk": "@@ -201,6 +202,13 @@ public DateTime(StreamInput in) throws IOException {\n             String zoneId = in.readString();\n             this.timeZone = ZoneId.of(zoneId);\n             this.resolution = DateFieldMapper.Resolution.ofOrdinal(in.readVInt());\n+            if (in.getVersion().onOrAfter(Version.V_7_7_0) && in.getVersion().before(Version.V_8_0_0)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "26ad3792fa22afaddbe414c012daa0a830128362"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTc2NjA0OA==", "bodyText": "you are right, we don't expect mix cluster to work with versions before 7.7. The intention feels cleaner with it to me. I will keep it", "url": "https://github.com/elastic/elasticsearch/pull/53481#discussion_r391766048", "createdAt": "2020-03-12T17:07:22Z", "author": {"login": "pgomulka"}, "path": "server/src/main/java/org/elasticsearch/search/DocValueFormat.java", "diffHunk": "@@ -201,6 +202,13 @@ public DateTime(StreamInput in) throws IOException {\n             String zoneId = in.readString();\n             this.timeZone = ZoneId.of(zoneId);\n             this.resolution = DateFieldMapper.Resolution.ofOrdinal(in.readVInt());\n+            if (in.getVersion().onOrAfter(Version.V_7_7_0) && in.getVersion().before(Version.V_8_0_0)) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTc1OTUyNw=="}, "originalCommit": {"oid": "26ad3792fa22afaddbe414c012daa0a830128362"}, "originalPosition": 12}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQyNzk1MDQ0OnYy", "diffSide": "RIGHT", "path": "server/src/main/java/org/elasticsearch/search/DocValueFormat.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMlQxNjo1NzoyNlrOF1nINA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMlQxNjo1NzoyNlrOF1nINA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTc1OTkyNA==", "bodyText": "similar comment as before out.getVersion().onOrAfter(Version.V_7_7_0) I don't think is strictly necessary. But nothing wrong with keeping it.", "url": "https://github.com/elastic/elasticsearch/pull/53481#discussion_r391759924", "createdAt": "2020-03-12T16:57:26Z", "author": {"login": "benwtrent"}, "path": "server/src/main/java/org/elasticsearch/search/DocValueFormat.java", "diffHunk": "@@ -213,6 +221,13 @@ public void writeTo(StreamOutput out) throws IOException {\n             out.writeString(formatter.pattern());\n             out.writeString(timeZone.getId());\n             out.writeVInt(resolution.ordinal());\n+            if (out.getVersion().onOrAfter(Version.V_7_7_0) && out.getVersion().before(Version.V_8_0_0)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "26ad3792fa22afaddbe414c012daa0a830128362"}, "originalPosition": 26}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3331, "cost": 1, "resetAt": "2021-11-12T11:57:46Z"}}}