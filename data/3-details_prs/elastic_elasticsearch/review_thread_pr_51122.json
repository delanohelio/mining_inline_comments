{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzYzNzk0MjE5", "number": 51122, "reviewThreads": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNlQxODo1ODowMlrODYm6mA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNlQxOTozMDoxMlrODYneMA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI3MTMwMDA4OnYy", "diffSide": "RIGHT", "path": "docs/reference/migration/migrate_8_0/indices.asciidoc", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNlQxODo1ODowMlrOFekF7g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xN1QwMjo1NjozNVrOFetmog==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzU5Mjk0Mg==", "bodyText": "Perhaps state the second sentence as \"The setting index.soft_deletes.enabled can no longer be set to false. As the setting defaults to true, simply leave the setting unset.\"", "url": "https://github.com/elastic/elasticsearch/pull/51122#discussion_r367592942", "createdAt": "2020-01-16T18:58:02Z", "author": {"login": "ywelsch"}, "path": "docs/reference/migration/migrate_8_0/indices.asciidoc", "diffHunk": "@@ -34,3 +34,11 @@ removed in 8.0.\n \n Synced flush was deprecated in 7.6 and is removed in 8.0. Use a regular flush\n instead as it has the same effect as a synced flush in 7.6 and later.\n+\n+\n+[float]\n+==== Indices with soft deletes disabled\n+\n+Creating indices with soft deletes disabled was deprecated in 7.6 and\n+is no longer supported in 8.0. Do not specify value for the setting\n+`[index.soft_deletes.enabled]`.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "42033d12c0da33401b5132d88d741d64a5496f57"}, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Nzc0ODc3MA==", "bodyText": "adjusted in 66c507d.", "url": "https://github.com/elastic/elasticsearch/pull/51122#discussion_r367748770", "createdAt": "2020-01-17T02:56:35Z", "author": {"login": "dnhatn"}, "path": "docs/reference/migration/migrate_8_0/indices.asciidoc", "diffHunk": "@@ -34,3 +34,11 @@ removed in 8.0.\n \n Synced flush was deprecated in 7.6 and is removed in 8.0. Use a regular flush\n instead as it has the same effect as a synced flush in 7.6 and later.\n+\n+\n+[float]\n+==== Indices with soft deletes disabled\n+\n+Creating indices with soft deletes disabled was deprecated in 7.6 and\n+is no longer supported in 8.0. Do not specify value for the setting\n+`[index.soft_deletes.enabled]`.", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzU5Mjk0Mg=="}, "originalCommit": {"oid": "42033d12c0da33401b5132d88d741d64a5496f57"}, "originalPosition": 11}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI3MTMzMjM5OnYy", "diffSide": "LEFT", "path": "server/src/main/java/org/elasticsearch/snapshots/RestoreService.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNlQxOTowOTo0OVrOFeka6w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xN1QwMjo1Njo0OFrOFetmvw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzU5ODMxNQ==", "bodyText": "why remove this? We still don't want people to be able to modify this on restore, do we? Otherwise they could just set this to false on restore.", "url": "https://github.com/elastic/elasticsearch/pull/51122#discussion_r367598315", "createdAt": "2020-01-16T19:09:49Z", "author": {"login": "ywelsch"}, "path": "server/src/main/java/org/elasticsearch/snapshots/RestoreService.java", "diffHunk": "@@ -124,8 +123,7 @@\n             SETTING_NUMBER_OF_SHARDS,\n             SETTING_VERSION_CREATED,\n             SETTING_INDEX_UUID,\n-            SETTING_CREATION_DATE,\n-            IndexSettings.INDEX_SOFT_DELETES_SETTING.getKey()));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "42033d12c0da33401b5132d88d741d64a5496f57"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Nzc0ODc5OQ==", "bodyText": "fixed in 9a992a9", "url": "https://github.com/elastic/elasticsearch/pull/51122#discussion_r367748799", "createdAt": "2020-01-17T02:56:48Z", "author": {"login": "dnhatn"}, "path": "server/src/main/java/org/elasticsearch/snapshots/RestoreService.java", "diffHunk": "@@ -124,8 +123,7 @@\n             SETTING_NUMBER_OF_SHARDS,\n             SETTING_VERSION_CREATED,\n             SETTING_INDEX_UUID,\n-            SETTING_CREATION_DATE,\n-            IndexSettings.INDEX_SOFT_DELETES_SETTING.getKey()));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzU5ODMxNQ=="}, "originalCommit": {"oid": "42033d12c0da33401b5132d88d741d64a5496f57"}, "originalPosition": 13}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI3MTM4NTM5OnYy", "diffSide": "RIGHT", "path": "server/src/main/java/org/elasticsearch/cluster/metadata/MetaDataCreateIndexService.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNlQxOToyODoxM1rOFek8Iw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xN1QwMjo1NzowM1rOFetm5Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzYwNjgxOQ==", "bodyText": "should we still allow IndexSettings.INDEX_SOFT_DELETES_SETTING to be set to false if SETTING_INDEX_VERSION_CREATED is before V_8_0_0. This will allow shrink/split of non-soft-deleted indices continue to work. Also, a test for this would be good", "url": "https://github.com/elastic/elasticsearch/pull/51122#discussion_r367606819", "createdAt": "2020-01-16T19:28:13Z", "author": {"login": "ywelsch"}, "path": "server/src/main/java/org/elasticsearch/cluster/metadata/MetaDataCreateIndexService.java", "diffHunk": "@@ -437,10 +435,9 @@ static Settings aggregateIndexSettings(ClusterState currentState, CreateIndexClu\n          * that will be used to create this index.\n          */\n         MetaDataCreateIndexService.checkShardLimit(indexSettings, currentState);\n-        if (indexSettings.getAsBoolean(IndexSettings.INDEX_SOFT_DELETES_SETTING.getKey(), true) == false) {\n-            DEPRECATION_LOGGER.deprecatedAndMaybeLog(\"soft_deletes_disabled\",\n-                \"Creating indices with soft-deletes disabled is deprecated and will be removed in future Elasticsearch versions. \" +\n-                \"Please do not specify value for setting [index.soft_deletes.enabled] of index [\" + request.index() + \"].\");\n+        if (IndexSettings.INDEX_SOFT_DELETES_SETTING.get(indexSettings) == false) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "42033d12c0da33401b5132d88d741d64a5496f57"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Nzc0ODgzNw==", "bodyText": "fixed and added a test in 0ecee87.", "url": "https://github.com/elastic/elasticsearch/pull/51122#discussion_r367748837", "createdAt": "2020-01-17T02:57:03Z", "author": {"login": "dnhatn"}, "path": "server/src/main/java/org/elasticsearch/cluster/metadata/MetaDataCreateIndexService.java", "diffHunk": "@@ -437,10 +435,9 @@ static Settings aggregateIndexSettings(ClusterState currentState, CreateIndexClu\n          * that will be used to create this index.\n          */\n         MetaDataCreateIndexService.checkShardLimit(indexSettings, currentState);\n-        if (indexSettings.getAsBoolean(IndexSettings.INDEX_SOFT_DELETES_SETTING.getKey(), true) == false) {\n-            DEPRECATION_LOGGER.deprecatedAndMaybeLog(\"soft_deletes_disabled\",\n-                \"Creating indices with soft-deletes disabled is deprecated and will be removed in future Elasticsearch versions. \" +\n-                \"Please do not specify value for setting [index.soft_deletes.enabled] of index [\" + request.index() + \"].\");\n+        if (IndexSettings.INDEX_SOFT_DELETES_SETTING.get(indexSettings) == false) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzYwNjgxOQ=="}, "originalCommit": {"oid": "42033d12c0da33401b5132d88d741d64a5496f57"}, "originalPosition": 24}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI3MTM4ODg1OnYy", "diffSide": "RIGHT", "path": "server/src/main/java/org/elasticsearch/cluster/metadata/MetaDataCreateIndexService.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNlQxOToyOToyM1rOFek-Mg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNlQxOToyOToyM1rOFek-Mg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzYwNzM0Ng==", "bodyText": "specify a value", "url": "https://github.com/elastic/elasticsearch/pull/51122#discussion_r367607346", "createdAt": "2020-01-16T19:29:23Z", "author": {"login": "ywelsch"}, "path": "server/src/main/java/org/elasticsearch/cluster/metadata/MetaDataCreateIndexService.java", "diffHunk": "@@ -437,10 +435,9 @@ static Settings aggregateIndexSettings(ClusterState currentState, CreateIndexClu\n          * that will be used to create this index.\n          */\n         MetaDataCreateIndexService.checkShardLimit(indexSettings, currentState);\n-        if (indexSettings.getAsBoolean(IndexSettings.INDEX_SOFT_DELETES_SETTING.getKey(), true) == false) {\n-            DEPRECATION_LOGGER.deprecatedAndMaybeLog(\"soft_deletes_disabled\",\n-                \"Creating indices with soft-deletes disabled is deprecated and will be removed in future Elasticsearch versions. \" +\n-                \"Please do not specify value for setting [index.soft_deletes.enabled] of index [\" + request.index() + \"].\");\n+        if (IndexSettings.INDEX_SOFT_DELETES_SETTING.get(indexSettings) == false) {\n+            throw new IllegalArgumentException(\"Creating indices with soft-deletes disabled is no longer supported. \" +\n+                \"Please do not specify value for setting [index.soft_deletes.enabled].\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "42033d12c0da33401b5132d88d741d64a5496f57"}, "originalPosition": 26}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI3MTM5MTIwOnYy", "diffSide": "RIGHT", "path": "server/src/main/java/org/elasticsearch/action/admin/indices/shrink/TransportResizeAction.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNlQxOTozMDoxMlrOFek_og==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNlQxOTozMDoxMlrOFek_og==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzYwNzcxNA==", "bodyText": "I think we should keep this condition in place (see my other comment)", "url": "https://github.com/elastic/elasticsearch/pull/51122#discussion_r367607714", "createdAt": "2020-01-16T19:30:12Z", "author": {"login": "ywelsch"}, "path": "server/src/main/java/org/elasticsearch/action/admin/indices/shrink/TransportResizeAction.java", "diffHunk": "@@ -175,9 +175,7 @@ static CreateIndexClusterStateUpdateRequest prepareCreateIndexRequest(final Resi\n                 throw new IllegalArgumentException(\"cannot provide index.number_of_routing_shards on resize\");\n             }\n         }\n-        if (IndexSettings.INDEX_SOFT_DELETES_SETTING.get(metaData.getSettings()) &&\n-            IndexSettings.INDEX_SOFT_DELETES_SETTING.exists(targetIndexSettings) &&\n-            IndexSettings.INDEX_SOFT_DELETES_SETTING.get(targetIndexSettings) == false) {\n+        if (IndexSettings.INDEX_SOFT_DELETES_SETTING.get(targetIndexSettings) == false) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "42033d12c0da33401b5132d88d741d64a5496f57"}, "originalPosition": 7}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4495, "cost": 1, "resetAt": "2021-11-12T13:16:51Z"}}}