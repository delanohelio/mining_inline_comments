{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDc0NjM0MDQ3", "number": 61629, "title": "Implement deprecation logging using log4j", "bodyText": "Backport of #61474.\nPart of #46106. Simplify the implementation of deprecation logging by\nrelying of log4j more completely, and implementing additional behaviour\nthrough custom appenders and filters.", "createdAt": "2020-08-27T11:25:13Z", "url": "https://github.com/elastic/elasticsearch/pull/61629", "merged": true, "mergeCommit": {"oid": "ff6c071275b1b973b817b88b41d9d43b0b2f1e41"}, "closed": true, "closedAt": "2020-08-31T11:42:05Z", "author": {"login": "pugnascotia"}, "timelineItems": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdC-nrMAH2gAyNDc0NjM0MDQ3OjlkNjk2ZGM1ZmI2NjI4M2RlN2ViNDliNzEzNjQ4ZjQ1OGI5ZWEwNDU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdENuMKgFqTQ3ODM4MTg5NQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "9d696dc5fb66283de7eb49b713648f458b9ea045", "author": {"user": {"login": "pugnascotia", "name": "Rory Hunter"}}, "url": "https://github.com/elastic/elasticsearch/commit/9d696dc5fb66283de7eb49b713648f458b9ea045", "committedDate": "2020-08-27T11:22:32Z", "message": "Implement deprecation logging using log4j (#61474)\n\nBackport of #61474.\n\nPart of #46106. Simplify the implementation of deprecation logging by\nrelying of log4j more completely, and implementing additional behaviour\nthrough custom appenders and filters."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc4MzgxODk1", "url": "https://github.com/elastic/elasticsearch/pull/61629#pullrequestreview-478381895", "createdAt": "2020-08-31T07:30:52Z", "commit": {"oid": "9d696dc5fb66283de7eb49b713648f458b9ea045"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0zMVQwNzozMDo1MlrOHJtsaA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0zMVQwNzozMDo1MlrOHJtsaA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTk0Nzg4MA==", "bodyText": "I wonder if we need this builder in 7.x - I removed this from my backport because there will be no compatible logger in 7.x\nHowever I am thinking now that it might cause problems for future backports and we should keep it?\nWDYT?", "url": "https://github.com/elastic/elasticsearch/pull/61629#discussion_r479947880", "createdAt": "2020-08-31T07:30:52Z", "author": {"login": "pgomulka"}, "path": "server/src/main/java/org/elasticsearch/common/logging/DeprecationLogger.java", "diffHunk": "@@ -72,23 +82,22 @@ private static String toLoggerName(final Class<?> cls) {\n         return canonicalName != null ? canonicalName : cls.getName();\n     }\n \n-    public static void setThreadContext(ThreadContext threadContext) {\n-        HeaderWarning.setThreadContext(threadContext);\n-    }\n-\n-    public static void removeThreadContext(ThreadContext threadContext) {\n-        HeaderWarning.removeThreadContext(threadContext);\n-    }\n-\n     /**\n-     * Logs a deprecation message, adding a formatted warning message as a response header on the thread context.\n-     * The deprecation message will be throttled to deprecation log.\n+     * Logs a message at the {@link #DEPRECATION} level. The message is also sent to the header warning logger,\n+     * so that it can be returned to the client.\n      */\n-    @SuppressLoggerChecks(reason = \"Safely delegates to a deprecated message\")\n-    public void deprecate(final String key, final String msg, final Object... params) {\n-        String opaqueId = HeaderWarning.getXOpaqueId();\n-        ESLogMessage deprecationMessage = new DeprecatedMessage(opaqueId, msg, params);\n-        deprecationLogger.throttleLogAndAddWarning(key, deprecationMessage);\n+    public DeprecationLoggerBuilder deprecate(final String key, final String msg, final Object... params) {\n+        return new DeprecationLoggerBuilder().withDeprecation(key, msg, params);\n     }\n \n+    public class DeprecationLoggerBuilder {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9d696dc5fb66283de7eb49b713648f458b9ea045"}, "originalPosition": 103}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4607, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}