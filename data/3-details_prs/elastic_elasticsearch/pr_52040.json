{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzcyMzg3MzE4", "number": 52040, "title": "Example for index multi-document support", "bodyText": "The previous docs provided instructions on how to create the _doc payload field. However, it's not trivial and an example can help to create it.", "createdAt": "2020-02-07T12:25:59Z", "url": "https://github.com/elastic/elasticsearch/pull/52040", "merged": true, "mergeCommit": {"oid": "eb9de19258b193d0b74baeb1732afe7f96c87ff9"}, "closed": true, "closedAt": "2020-05-20T20:01:13Z", "author": {"login": "luizgpsantos"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcB-cdEAH2gAyMzcyMzg3MzE4OjA2OThhOTk2OWQ0NTgzNTk2MGVhZDg5M2ViZmY4MmEzYzViMDRiOGU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcjN8fQAH2gAyMzcyMzg3MzE4OmZhMjI1NjI1ODEwMDIzYTgzNWViNGEzN2MzZjA1MDRhMDNhNjI4MzU=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "0698a9969d45835960ead893ebff82a3c5b04b8e", "author": {"user": {"login": "luizgpsantos", "name": "Luiz Guilherme Pais dos Santos"}}, "url": "https://github.com/elastic/elasticsearch/commit/0698a9969d45835960ead893ebff82a3c5b04b8e", "committedDate": "2020-02-07T12:25:12Z", "message": "Example for index multi-document support\n\nThe previous docs provided instructions on how to create the _doc payload field. However, it's not trivial and an example can help to create it."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6ba3118da00a46bfa2de211bc4bf80180837785d", "author": {"user": {"login": "elasticmachine", "name": "Elastic Machine"}}, "url": "https://github.com/elastic/elasticsearch/commit/6ba3118da00a46bfa2de211bc4bf80180837785d", "committedDate": "2020-05-20T13:13:00Z", "message": "Merge branch 'master' into luizgpsantos-patch-3"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE1NjI3ODMy", "url": "https://github.com/elastic/elasticsearch/pull/52040#pullrequestreview-415627832", "createdAt": "2020-05-20T18:56:50Z", "commit": {"oid": "6ba3118da00a46bfa2de211bc4bf80180837785d"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMFQxODo1Njo1MVrOGYZrwA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMFQxODo1Njo1MVrOGYZrwA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODIzOTgwOA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                  return [ '_doc' : documents]; <4>\n          \n          \n            \n                  return [ \"_doc\" : documents]; <4>", "url": "https://github.com/elastic/elasticsearch/pull/52040#discussion_r428239808", "createdAt": "2020-05-20T18:56:51Z", "author": {"login": "jrodewig"}, "path": "x-pack/docs/en/watcher/actions/index.asciidoc", "diffHunk": "@@ -73,5 +73,34 @@ When a `_doc` field exists, if the field holds an object, it is extracted and in\n as a single document. If the field holds an array of objects, each object is treated as\n a document and the index action indexes all of them in a bulk.\n \n-An `_index`, or `_id` value can be added per document to dynamically set the ID\n+An `_index`, or `_id` value can be added per document to dynamically set the index and ID\n of the indexed document.\n+\n+The following snippet shows a multi-document `index` action definition:\n+\n+[source,js]\n+--------------------------------------------------\n+\"actions\": {\n+  \"index_payload\": {\n+    \"transform\": {\n+      \"script\": \"\"\"\n+      def documents = ctx.payload.hits.hits.stream()\n+        .map(hit -> [\n+          \"_index\": \"my-index\", <1>\n+          \"_id\": hit._id, <2>\n+          \"severity\": \"Sev: \" + hit._source.severity <3>\n+        ])\n+        .collect(Collectors.toList());\n+      return [ '_doc' : documents]; <4>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6ba3118da00a46bfa2de211bc4bf80180837785d"}, "originalPosition": 23}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE1NjI5NzU0", "url": "https://github.com/elastic/elasticsearch/pull/52040#pullrequestreview-415629754", "createdAt": "2020-05-20T18:59:29Z", "commit": {"oid": "6ba3118da00a46bfa2de211bc4bf80180837785d"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fa225625810023a835eb4a37c3f0504a03a62835", "author": {"user": {"login": "luizgpsantos", "name": "Luiz Guilherme Pais dos Santos"}}, "url": "https://github.com/elastic/elasticsearch/commit/fa225625810023a835eb4a37c3f0504a03a62835", "committedDate": "2020-05-20T19:08:16Z", "message": "Update x-pack/docs/en/watcher/actions/index.asciidoc\n\nCo-authored-by: James Rodewig <james.rodewig@elastic.co>"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2652, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}