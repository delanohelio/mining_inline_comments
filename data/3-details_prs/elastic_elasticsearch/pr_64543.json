{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE0ODk0Mjg1", "number": 64543, "title": "Convert some object mapper testcases to use MapperServiceTestCase", "bodyText": "I'm looking at making some changes to ObjectMapper access from the\nMapperService, and they will be much easier to test if these test cases\nuse MapperServiceTestCase.", "createdAt": "2020-11-03T17:39:52Z", "url": "https://github.com/elastic/elasticsearch/pull/64543", "merged": true, "mergeCommit": {"oid": "63b96c0d7ce90d78eace02e507ca8b52321acb68"}, "closed": true, "closedAt": "2020-11-04T17:48:33Z", "author": {"login": "romseygeek"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdY8wG0AH2gAyNTE0ODk0Mjg1OjUyMjgzYWIwNzEyNTY3MDIzZDJlZTU3OTY4MGQzOTk0NTI2YzNiZjA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdZQwSdAH2gAyNTE0ODk0Mjg1OjExMmE1ZmMzNzAxZDZmZGRkYjIzZGRjYTg0NTI0ZGFjZTQ5NTk0ODM=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "52283ab0712567023d2ee579680d3994526c3bf0", "author": {"user": {"login": "romseygeek", "name": "Alan Woodward"}}, "url": "https://github.com/elastic/elasticsearch/commit/52283ab0712567023d2ee579680d3994526c3bf0", "committedDate": "2020-11-03T17:38:16Z", "message": "Convert some object mapper testcases to use MapperServiceTestCase"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIzNTI2MDA4", "url": "https://github.com/elastic/elasticsearch/pull/64543#pullrequestreview-523526008", "createdAt": "2020-11-04T16:25:09Z", "commit": {"oid": "52283ab0712567023d2ee579680d3994526c3bf0"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNFQxNjoyNTowOVrOHtfzHg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNFQxNjoyNTowOVrOHtfzHg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzQ2ODk1OA==", "bodyText": "Could you add the indenting back for this one?", "url": "https://github.com/elastic/elasticsearch/pull/64543#discussion_r517468958", "createdAt": "2020-11-04T16:25:09Z", "author": {"login": "nik9000"}, "path": "server/src/test/java/org/elasticsearch/index/mapper/NestedObjectMapperTests.java", "diffHunk": "@@ -436,61 +448,62 @@ public void testMultipleLevelsIncludeRoot2() throws Exception {\n \n         ParsedDocument doc = docMapper.parse(new SourceToParse(\"test\", \"1\",\n             BytesReference.bytes(XContentFactory.jsonBuilder()\n-                        .startObject().startArray(\"nested1\")\n-                        .startObject().startArray(\"nested2\")\n-                        .startObject().startArray(\"nested3\").startObject().field(\"foo\", \"bar\")\n-                        .endObject().endArray().endObject().endArray().endObject().endArray()\n-                        .endObject()),\n+                .startObject().startArray(\"nested1\")\n+                .startObject().startArray(\"nested2\")\n+                .startObject().startArray(\"nested3\").startObject().field(\"foo\", \"bar\")\n+                .endObject().endArray().endObject().endArray().endObject().endArray()\n+                .endObject()),\n             XContentType.JSON));\n \n         final Collection<IndexableField> fields = doc.rootDoc().getFields();\n         assertThat(fields.size(), equalTo(new HashSet<>(fields).size()));\n     }\n \n-   /**\n+    /**\n      * Same as {@link NestedObjectMapperTests#testMultipleLevelsIncludeRoot1()} but tests that\n      * the redundant includes are removed even if each individual mapping doesn't contain the\n      * redundancy, only the merged mapping does.\n      */\n     public void testMultipleLevelsIncludeRootWithMerge() throws Exception {\n-        MapperService mapperService = createIndex(\"test\").mapperService();\n+        MapperService mapperService = createMapperService(mapping(b -> {\n+        }));\n \n         String firstMapping = Strings.toString(XContentFactory.jsonBuilder().startObject()\n             .startObject(MapperService.SINGLE_MAPPING_NAME)\n-                .startObject(\"properties\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "52283ab0712567023d2ee579680d3994526c3bf0"}, "originalPosition": 259}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIzNTI2MTc5", "url": "https://github.com/elastic/elasticsearch/pull/64543#pullrequestreview-523526179", "createdAt": "2020-11-04T16:25:18Z", "commit": {"oid": "52283ab0712567023d2ee579680d3994526c3bf0"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e3479ba0885a58132efe2c18998875e30c8dbe04", "author": {"user": {"login": "romseygeek", "name": "Alan Woodward"}}, "url": "https://github.com/elastic/elasticsearch/commit/e3479ba0885a58132efe2c18998875e30c8dbe04", "committedDate": "2020-11-04T16:54:58Z", "message": "Merge remote-tracking branch 'origin/master' into mapper/object-tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "112a5fc3701d6fdddb23ddca84524dace4959483", "author": {"user": {"login": "romseygeek", "name": "Alan Woodward"}}, "url": "https://github.com/elastic/elasticsearch/commit/112a5fc3701d6fdddb23ddca84524dace4959483", "committedDate": "2020-11-04T16:56:34Z", "message": "indentation"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 791, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}