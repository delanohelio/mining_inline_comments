{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzcwOTk4MTUy", "number": 51882, "title": "Introduce jvm.options.d for customizing JVM options", "bodyText": "This commit introduces the ability to override JVM options by adding custom JVM options files to a jvm.options.d directory. This simplifies administration of Elasticsearch by not requiring administrators to keep the root jvm.options file in sync with changes that we make to the root jvm.options file. Instead, they are not expected to modify this file but instead supply their own in jvm.options.d. In Docker installations, this means they can bind mount this directory in. In future versions of Elasticsearch, we can consider removing the root jvm.options file (instead, providing all options there as system JVM options).\nRelates #51626", "createdAt": "2020-02-04T18:59:18Z", "url": "https://github.com/elastic/elasticsearch/pull/51882", "merged": true, "mergeCommit": {"oid": "749b623de01dfb01e55009b7178248f10298fb79"}, "closed": true, "closedAt": "2020-02-08T21:54:27Z", "author": {"login": "jasontedor"}, "timelineItems": {"totalCount": 42, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcBGRKbgH2gAyMzcwOTk4MTUyOjM4NmRlNjRiMjFkOTQ4MzBlNGNjNDc0MTFjMzE5MDQ1NWRkMmQwMzQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcCaIOngH2gAyMzcwOTk4MTUyOjlhMGJiMTZhYmVlNWMzZmM4NTUwN2NiZDJhNzM1ZGIyYzExNzVjM2Y=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "386de64b21d94830e4cc47411c3190455dd2d034", "author": {"user": {"login": "jasontedor", "name": "Jason Tedor"}}, "url": "https://github.com/elastic/elasticsearch/commit/386de64b21d94830e4cc47411c3190455dd2d034", "committedDate": "2020-02-04T18:58:11Z", "message": "Introduce jvm.options.d for customizing JVM options\n\nThis commit introduces the ability to override JVM options by adding\ncustom JVM options files to a jvm.options.d directory. This simplifies\nadministration of Elasticsearch by not requiring administrators to keep\nthe root jvm.options file in sync with changes that we make to the root\njvm.options file. Instead, they are not expected to modify this file but\ninstead supply their own in jvm.options.d. In Docker installations, this\nmeans they can bind mount this directory in. In future versions of\nElasticsearch, we can consider removing the root jvm.options file\n(instead, providing all options there as system JVM options)."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e8a16854d0727a589cce96b4fb1114adc5a0d3e1", "author": {"user": {"login": "jasontedor", "name": "Jason Tedor"}}, "url": "https://github.com/elastic/elasticsearch/commit/e8a16854d0727a589cce96b4fb1114adc5a0d3e1", "committedDate": "2020-02-04T19:00:37Z", "message": "Do not encourage editing root jvm.options file"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "98a315c97ee01a765d0880b1b9d7ea207d0bac91", "author": {"user": {"login": "jasontedor", "name": "Jason Tedor"}}, "url": "https://github.com/elastic/elasticsearch/commit/98a315c97ee01a765d0880b1b9d7ea207d0bac91", "committedDate": "2020-02-04T19:01:45Z", "message": "Remove unneeded method"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUzMjI2ODc1", "url": "https://github.com/elastic/elasticsearch/pull/51882#pullrequestreview-353226875", "createdAt": "2020-02-04T19:06:03Z", "commit": {"oid": "98a315c97ee01a765d0880b1b9d7ea207d0bac91"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNFQxOTowNjowM1rOFlf7nA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNFQxOToxMjoyNlrOFlgHsQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDg2NDc5Ng==", "bodyText": "Should we include an example/readme/etc in here to make this a little more self-documenting and so folks don't think this is some kind of mistake? I guess the way I see it is either a) we expect folks to read our documentation, at which point they'll just go ahead and create this folder or b) we don't, and we want to lead them towards this capability, at which point we should probably provide a bit more context. Thoughts?", "url": "https://github.com/elastic/elasticsearch/pull/51882#discussion_r374864796", "createdAt": "2020-02-04T19:06:03Z", "author": {"login": "mark-vieira"}, "path": "distribution/archives/build.gradle", "diffHunk": "@@ -44,6 +44,11 @@ task createPluginsDir(type: EmptyDirTask) {\n   dir = \"${pluginsDir}\"\n   dirMode = 0755\n }\n+ext.jvmOptionsDir = new File(buildDir, 'jvm-options-hack/jvm.options.d')", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "98a315c97ee01a765d0880b1b9d7ea207d0bac91"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDg2Njk3OA==", "bodyText": "This last sentence seems to be contradicting itself. Do we use lexicographic order, or is this non-deterministic? Lexicographic order is pretty strictly defined. If we are just iterating over a directory list (which it seems we are) then we shouldn't imply any kind of ordering guarantees. FWIW, it would be trivial for us to actually perform a sort here, which would allow folks to do stuff like 10_options and 00_options for layering overrides in a reliable way.", "url": "https://github.com/elastic/elasticsearch/pull/51882#discussion_r374866978", "createdAt": "2020-02-04T19:10:42Z", "author": {"login": "mark-vieira"}, "path": "docs/reference/setup/jvm-options.asciidoc", "diffHunk": "@@ -5,14 +5,21 @@ You should rarely need to change Java Virtual Machine (JVM) options. If you do,\n the most likely change is setting the <<heap-size,heap size>>. The remainder of\n this document explains in detail how to set JVM options.\n \n-The preferred method of setting JVM options (including system properties and JVM\n-flags) is via the `jvm.options` configuration file. The default location of this\n-file is `config/jvm.options` (when installing from the tar or zip distributions)\n-and `/etc/elasticsearch/jvm.options` (when installing from the Debian or RPM\n-packages).\n+The preferred method of setting or overriding JVM options (including system\n+properties and JVM flags) is via custom JVM options files. The root\n+`jvm.options` configuration file is `config/jvm.options` and custom JVM options\n+files can be added to `config/jvm.options.d/` (when installing from the tar or\n+zip distributions), and `/etc/elasticsearch/jvm.options` and custom JVM options\n+files can be added to `/etc/elasticsearch/jvm.options.d/` (when installing from\n+the Debian or RPM packages). When using the\n+<<docker, Docker distribution of {es}>> you can bind mount these files into\n+`/usr/share/elasticsearch/config/jvm.options.d/`. You should never need to\n+modify the root `jvm.options` file instead preferring to use custom JVM options\n+files. Custom JVM options files are processed in lexicographic order (although", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "98a315c97ee01a765d0880b1b9d7ea207d0bac91"}, "originalPosition": 19}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDg2Nzg4OQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            JVM options files contains line-delimited list of JVM arguments following a\n          \n          \n            \n            JVM options files contain a line-delimited list of JVM arguments following a", "url": "https://github.com/elastic/elasticsearch/pull/51882#discussion_r374867889", "createdAt": "2020-02-04T19:12:26Z", "author": {"login": "mark-vieira"}, "path": "docs/reference/setup/jvm-options.asciidoc", "diffHunk": "@@ -5,14 +5,21 @@ You should rarely need to change Java Virtual Machine (JVM) options. If you do,\n the most likely change is setting the <<heap-size,heap size>>. The remainder of\n this document explains in detail how to set JVM options.\n \n-The preferred method of setting JVM options (including system properties and JVM\n-flags) is via the `jvm.options` configuration file. The default location of this\n-file is `config/jvm.options` (when installing from the tar or zip distributions)\n-and `/etc/elasticsearch/jvm.options` (when installing from the Debian or RPM\n-packages).\n+The preferred method of setting or overriding JVM options (including system\n+properties and JVM flags) is via custom JVM options files. The root\n+`jvm.options` configuration file is `config/jvm.options` and custom JVM options\n+files can be added to `config/jvm.options.d/` (when installing from the tar or\n+zip distributions), and `/etc/elasticsearch/jvm.options` and custom JVM options\n+files can be added to `/etc/elasticsearch/jvm.options.d/` (when installing from\n+the Debian or RPM packages). When using the\n+<<docker, Docker distribution of {es}>> you can bind mount these files into\n+`/usr/share/elasticsearch/config/jvm.options.d/`. You should never need to\n+modify the root `jvm.options` file instead preferring to use custom JVM options\n+files. Custom JVM options files are processed in lexicographic order (although\n+the ordering is filesystem and platform specific).\n \n-This file contains a line-delimited list of JVM arguments following\n-a special syntax:\n+JVM options files contains line-delimited list of JVM arguments following a", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "98a315c97ee01a765d0880b1b9d7ea207d0bac91"}, "originalPosition": 24}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "50b7090ac13b2b2046f481710e9076b63502a8e5", "author": {"user": {"login": "jasontedor", "name": "Jason Tedor"}}, "url": "https://github.com/elastic/elasticsearch/commit/50b7090ac13b2b2046f481710e9076b63502a8e5", "committedDate": "2020-02-04T19:41:25Z", "message": "Fix javadoc"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ef7c11ceb982bb0e938dd8617db64fda50f29308", "author": {"user": {"login": "jasontedor", "name": "Jason Tedor"}}, "url": "https://github.com/elastic/elasticsearch/commit/ef7c11ceb982bb0e938dd8617db64fda50f29308", "committedDate": "2020-02-04T19:46:26Z", "message": "Update heap size docs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "72c2ceb0ecc43ed14ec7b6f1b052a796841b96c7", "author": {"user": {"login": "jasontedor", "name": "Jason Tedor"}}, "url": "https://github.com/elastic/elasticsearch/commit/72c2ceb0ecc43ed14ec7b6f1b052a796841b96c7", "committedDate": "2020-02-04T19:50:00Z", "message": "Update docs/reference/setup/jvm-options.asciidoc\n\nCo-Authored-By: Mark Vieira <portugee@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e609aaddb87bd3cfdfc0639e6a2fbff9f29ed9ce", "author": {"user": {"login": "jasontedor", "name": "Jason Tedor"}}, "url": "https://github.com/elastic/elasticsearch/commit/e609aaddb87bd3cfdfc0639e6a2fbff9f29ed9ce", "committedDate": "2020-02-04T20:03:54Z", "message": "Fix imports"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "57e29ecda23c12b907173394ef01ec113e35e07a", "author": {"user": {"login": "elasticmachine", "name": "Elastic Machine"}}, "url": "https://github.com/elastic/elasticsearch/commit/57e29ecda23c12b907173394ef01ec113e35e07a", "committedDate": "2020-02-04T20:18:14Z", "message": "Merge branch 'master' into jvm.options.d"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7c5da0a46a18cf65ce0a4ece2d711ae123a819c2", "author": {"user": {"login": "jasontedor", "name": "Jason Tedor"}}, "url": "https://github.com/elastic/elasticsearch/commit/7c5da0a46a18cf65ce0a4ece2d711ae123a819c2", "committedDate": "2020-02-05T00:20:39Z", "message": "Create jvm.options.d in Docker image"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7d4f1511b05f61cb5dc67e938544baaabb79caf7", "author": {"user": {"login": "jasontedor", "name": "Jason Tedor"}}, "url": "https://github.com/elastic/elasticsearch/commit/7d4f1511b05f61cb5dc67e938544baaabb79caf7", "committedDate": "2020-02-05T00:20:40Z", "message": "Do not require existence"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d388d85283d13c01108a749b035dd088f98b4f63", "author": {"user": {"login": "elasticmachine", "name": "Elastic Machine"}}, "url": "https://github.com/elastic/elasticsearch/commit/d388d85283d13c01108a749b035dd088f98b4f63", "committedDate": "2020-02-06T02:07:26Z", "message": "Merge branch 'master' into jvm.options.d"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU0MzQyMjMz", "url": "https://github.com/elastic/elasticsearch/pull/51882#pullrequestreview-354342233", "createdAt": "2020-02-06T10:25:26Z", "commit": {"oid": "d388d85283d13c01108a749b035dd088f98b4f63"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNlQxMDoyNToyN1rOFmWG7w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNlQxMDoyNToyN1rOFmWG7w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTc1MjQzMQ==", "bodyText": "I found this a little hard to grok, so I whipped up a non-stream version, just FYI.\nfinal List<Path> jvmOptionsFiles = new ArrayList<>();\njvmOptionsFiles.add(Paths.get(args[0], \"jvm.options\"));\n\nfinal File jvmOptionsDirectory = Paths.get(args[0], \"jvm.options.d\").toFile();\nif (jvmOptionsDirectory.isDirectory()) {\n    final File[] files = jvmOptionsDirectory.listFiles();\n    Arrays.sort(files, Comparator.comparing(File::getName));\n\n    for (File file : files) {\n        jvmOptionsFiles.add(file.toPath());\n    }\n}", "url": "https://github.com/elastic/elasticsearch/pull/51882#discussion_r375752431", "createdAt": "2020-02-06T10:25:27Z", "author": {"login": "pugnascotia"}, "path": "distribution/tools/launchers/src/main/java/org/elasticsearch/tools/launchers/JvmOptionsParser.java", "diffHunk": "@@ -53,82 +55,88 @@\n      * The main entry point. The exit code is 0 if the JVM options were successfully parsed, otherwise the exit code is 1. If an improperly\n      * formatted line is discovered, the line is output to standard error.\n      *\n-     * @param args the args to the program which should consist of a single option, the path to the JVM options\n+     * @param args the args to the program which should consist of a single option, the path to ES_PATH_CONF\n      */\n     public static void main(final String[] args) throws InterruptedException, IOException {\n         if (args.length != 1) {\n-            throw new IllegalArgumentException(\"expected one argument specifying path to jvm.options but was \" + Arrays.toString(args));\n+            throw new IllegalArgumentException(\"expected one argument specifying path to ES_PATH_CONF but was \" + Arrays.toString(args));\n         }\n+\n+        final Stream<Path> jvmOptionsFiles;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d388d85283d13c01108a749b035dd088f98b4f63"}, "originalPosition": 29}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU0MzQyNjg0", "url": "https://github.com/elastic/elasticsearch/pull/51882#pullrequestreview-354342684", "createdAt": "2020-02-06T10:26:05Z", "commit": {"oid": "d388d85283d13c01108a749b035dd088f98b4f63"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNlQxMDoyNjowNVrOFmWIgg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNlQxMDoyNjowNVrOFmWIgg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTc1MjgzNA==", "bodyText": "Should we files the files e.g. only include those ending with .options? Then we'd filter out any backup files, text files etc.", "url": "https://github.com/elastic/elasticsearch/pull/51882#discussion_r375752834", "createdAt": "2020-02-06T10:26:05Z", "author": {"login": "pugnascotia"}, "path": "distribution/tools/launchers/src/main/java/org/elasticsearch/tools/launchers/JvmOptionsParser.java", "diffHunk": "@@ -53,82 +55,88 @@\n      * The main entry point. The exit code is 0 if the JVM options were successfully parsed, otherwise the exit code is 1. If an improperly\n      * formatted line is discovered, the line is output to standard error.\n      *\n-     * @param args the args to the program which should consist of a single option, the path to the JVM options\n+     * @param args the args to the program which should consist of a single option, the path to ES_PATH_CONF\n      */\n     public static void main(final String[] args) throws InterruptedException, IOException {\n         if (args.length != 1) {\n-            throw new IllegalArgumentException(\"expected one argument specifying path to jvm.options but was \" + Arrays.toString(args));\n+            throw new IllegalArgumentException(\"expected one argument specifying path to ES_PATH_CONF but was \" + Arrays.toString(args));\n         }\n+\n+        final Stream<Path> jvmOptionsFiles;\n+        final Path rootJvmOptions = Paths.get(args[0], \"jvm.options\");\n+        final Path jvmOptionsDirectory = Paths.get(args[0], \"jvm.options.d\");\n+        if (Files.isDirectory(jvmOptionsDirectory)) {\n+            final Stream<Path> jvmOptionsDirectoryFiles = Files.list(Paths.get(args[0], \"jvm.options.d\"));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d388d85283d13c01108a749b035dd088f98b4f63"}, "originalPosition": 33}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU0MzQ0MDU2", "url": "https://github.com/elastic/elasticsearch/pull/51882#pullrequestreview-354344056", "createdAt": "2020-02-06T10:28:09Z", "commit": {"oid": "d388d85283d13c01108a749b035dd088f98b4f63"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNlQxMDoyODowOVrOFmWMdg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNlQxMDoyODowOVrOFmWMdg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTc1Mzg0Ng==", "bodyText": "Similar to the other discussion in this PR, maybe we should use a different name here so that users don't think that heap.options is a special name?", "url": "https://github.com/elastic/elasticsearch/pull/51882#discussion_r375753846", "createdAt": "2020-02-06T10:28:09Z", "author": {"login": "pugnascotia"}, "path": "docs/reference/setup/important-settings/heap-size.asciidoc", "diffHunk": "@@ -49,7 +49,8 @@ caches, but the less memory it leaves available for the operating system to use\n for the filesystem cache. Also, larger heaps can cause longer garbage\n collection pauses.\n \n-Here are examples of how to set the heap size via the jvm.options file:\n+Here are examples of how to set the heap size via a `jvm.options.d/heap.options`", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d388d85283d13c01108a749b035dd088f98b4f63"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU0MzQ1Nzg5", "url": "https://github.com/elastic/elasticsearch/pull/51882#pullrequestreview-354345789", "createdAt": "2020-02-06T10:30:47Z", "commit": {"oid": "d388d85283d13c01108a749b035dd088f98b4f63"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNlQxMDozMDo0OFrOFmWRjQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNlQxMDozMDo0OFrOFmWRjQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTc1NTE0OQ==", "bodyText": "The repetition of custom bothers me here...but I'm struggling to think of something better. Maybe the writers can help.", "url": "https://github.com/elastic/elasticsearch/pull/51882#discussion_r375755149", "createdAt": "2020-02-06T10:30:48Z", "author": {"login": "pugnascotia"}, "path": "docs/reference/setup/jvm-options.asciidoc", "diffHunk": "@@ -58,8 +65,8 @@ a special syntax:\n \n * all other lines are rejected\n \n-You can add custom JVM flags to this file and check this configuration into your\n-version control system.\n+You can add custom JVM flags to custom JVM options files and check these", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d388d85283d13c01108a749b035dd088f98b4f63"}, "originalPosition": 35}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU0MzQ3NTg5", "url": "https://github.com/elastic/elasticsearch/pull/51882#pullrequestreview-354347589", "createdAt": "2020-02-06T10:33:39Z", "commit": {"oid": "d388d85283d13c01108a749b035dd088f98b4f63"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNlQxMDozMzo0MFrOFmWXVA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNlQxMDozMzo0MFrOFmWXVA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTc1NjYyOA==", "bodyText": "Nit - I'd use a static import of Matchers, personally.", "url": "https://github.com/elastic/elasticsearch/pull/51882#discussion_r375756628", "createdAt": "2020-02-06T10:33:40Z", "author": {"login": "pugnascotia"}, "path": "qa/os/src/test/java/org/elasticsearch/packaging/test/PackageTests.java", "diffHunk": "@@ -298,7 +299,23 @@ public void test81CustomPathConfAndJvmOptions() throws Exception {\n         });\n     }\n \n-    public void test82SystemdMask() throws Exception {\n+    public void test82CustomJvmOptionsDirectoryFile() throws Exception {\n+        final Path heapOptions = installation.config(Paths.get(\"jvm.options.d\", \"heap.options\"));\n+        try {\n+            append(heapOptions, \"-Xms512m\\n-Xmx512m\\n\");\n+\n+            startElasticsearch();\n+\n+            final String nodesResponse = makeRequest(Request.Get(\"http://localhost:9200/_nodes\"));\n+            assertThat(nodesResponse, CoreMatchers.containsString(\"\\\"heap_init_in_bytes\\\":536870912\"));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d388d85283d13c01108a749b035dd088f98b4f63"}, "originalPosition": 21}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU0MzUwMDQ1", "url": "https://github.com/elastic/elasticsearch/pull/51882#pullrequestreview-354350045", "createdAt": "2020-02-06T10:37:47Z", "commit": {"oid": "d388d85283d13c01108a749b035dd088f98b4f63"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "454a8996a026e1cab908e832f3d457788e9fc4bd", "author": {"user": {"login": "jasontedor", "name": "Jason Tedor"}}, "url": "https://github.com/elastic/elasticsearch/commit/454a8996a026e1cab908e832f3d457788e9fc4bd", "committedDate": "2020-02-06T19:48:56Z", "message": "Merge branch 'master' into jvm.options.d"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5738f7187183830519c7c0a01dbc61b8f02e1104", "author": {"user": {"login": "jasontedor", "name": "Jason Tedor"}}, "url": "https://github.com/elastic/elasticsearch/commit/5738f7187183830519c7c0a01dbc61b8f02e1104", "committedDate": "2020-02-06T19:49:03Z", "message": "Update Docker docs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3a2bf7bb82895991d8cb0c66304938bcccc47b72", "author": {"user": {"login": "jasontedor", "name": "Jason Tedor"}}, "url": "https://github.com/elastic/elasticsearch/commit/3a2bf7bb82895991d8cb0c66304938bcccc47b72", "committedDate": "2020-02-06T19:49:07Z", "message": "Fix static import"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ccb522c395c85003b3d5cdce9682520e489bf4e7", "author": {"user": {"login": "jasontedor", "name": "Jason Tedor"}}, "url": "https://github.com/elastic/elasticsearch/commit/ccb522c395c85003b3d5cdce9682520e489bf4e7", "committedDate": "2020-02-06T19:56:31Z", "message": "Cleanup docs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e0b1f324be71ef61e97ed70a06a38bc0bfe6dd20", "author": {"user": {"login": "jasontedor", "name": "Jason Tedor"}}, "url": "https://github.com/elastic/elasticsearch/commit/e0b1f324be71ef61e97ed70a06a38bc0bfe6dd20", "committedDate": "2020-02-06T19:57:38Z", "message": "Remove filename"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fa13f953fda1b0f9f609af1133cae99cafdd8e10", "author": {"user": {"login": "jasontedor", "name": "Jason Tedor"}}, "url": "https://github.com/elastic/elasticsearch/commit/fa13f953fda1b0f9f609af1133cae99cafdd8e10", "committedDate": "2020-02-06T20:16:33Z", "message": "Simplify and require .options"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0bc68bd81d4c07f02425db61c03db92aeb9b03c9", "author": {"user": {"login": "jasontedor", "name": "Jason Tedor"}}, "url": "https://github.com/elastic/elasticsearch/commit/0bc68bd81d4c07f02425db61c03db92aeb9b03c9", "committedDate": "2020-02-06T20:16:53Z", "message": "Remove lexicographic processing"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6695f7563464f132984afb57266a0a23ea6d9bf6", "author": {"user": {"login": "jasontedor", "name": "Jason Tedor"}}, "url": "https://github.com/elastic/elasticsearch/commit/6695f7563464f132984afb57266a0a23ea6d9bf6", "committedDate": "2020-02-06T20:22:20Z", "message": "Unspecified processing order"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e5ea0c397edfa45b5d8486dc2eeecef1ae7ad4d8", "author": {"user": {"login": "jasontedor", "name": "Jason Tedor"}}, "url": "https://github.com/elastic/elasticsearch/commit/e5ea0c397edfa45b5d8486dc2eeecef1ae7ad4d8", "committedDate": "2020-02-06T20:26:59Z", "message": "Now sort"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5b2c725e009568b080c03b12248ff56d780313fb", "author": {"user": {"login": "jasontedor", "name": "Jason Tedor"}}, "url": "https://github.com/elastic/elasticsearch/commit/5b2c725e009568b080c03b12248ff56d780313fb", "committedDate": "2020-02-06T20:36:47Z", "message": "Cleanup"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "886b1a2fb3d1111c2e2e211e2b3c6c8cd6eaee9c", "author": {"user": {"login": "jasontedor", "name": "Jason Tedor"}}, "url": "https://github.com/elastic/elasticsearch/commit/886b1a2fb3d1111c2e2e211e2b3c6c8cd6eaee9c", "committedDate": "2020-02-06T21:20:20Z", "message": "Formatting"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU1MDM2Mzcy", "url": "https://github.com/elastic/elasticsearch/pull/51882#pullrequestreview-355036372", "createdAt": "2020-02-07T09:43:46Z", "commit": {"oid": "886b1a2fb3d1111c2e2e211e2b3c6c8cd6eaee9c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wN1QwOTo0Mzo0NlrOFm3d9Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wN1QwOTo0Mzo0NlrOFm3d9Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjI5ODk5Nw==", "bodyText": "What do you think about adding a third file, e.g. third.options.disabled, to prove that files have to end with .options? Up to you.", "url": "https://github.com/elastic/elasticsearch/pull/51882#discussion_r376298997", "createdAt": "2020-02-07T09:43:46Z", "author": {"login": "pugnascotia"}, "path": "qa/os/src/test/java/org/elasticsearch/packaging/test/ArchiveTests.java", "diffHunk": "@@ -251,6 +251,46 @@ public void test70CustomPathConfAndJvmOptions() throws Exception {\n         }\n     }\n \n+    public void test71CustomJvmOptionsDirectoryFile() throws Exception {\n+        final Path heapOptions = installation.config(Paths.get(\"jvm.options.d\", \"heap.options\"));\n+        try {\n+            append(heapOptions, \"-Xms512m\\n-Xmx512m\\n\");\n+\n+            startElasticsearch();\n+\n+            final String nodesResponse = makeRequest(Request.Get(\"http://localhost:9200/_nodes\"));\n+            assertThat(nodesResponse, containsString(\"\\\"heap_init_in_bytes\\\":536870912\"));\n+\n+            stopElasticsearch();\n+        } finally {\n+            rm(heapOptions);\n+        }\n+    }\n+\n+    public void test72CustomJvmOptionsDirectoryFilesAreProcessedInSortedOrder() throws Exception {\n+        final Path firstOptions = installation.config(Paths.get(\"jvm.options.d\", \"first.options\"));\n+        final Path secondOptions = installation.config(Paths.get(\"jvm.options.d\", \"second.options\"));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "886b1a2fb3d1111c2e2e211e2b3c6c8cd6eaee9c"}, "originalPosition": 22}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU1MDM2NDE3", "url": "https://github.com/elastic/elasticsearch/pull/51882#pullrequestreview-355036417", "createdAt": "2020-02-07T09:43:50Z", "commit": {"oid": "886b1a2fb3d1111c2e2e211e2b3c6c8cd6eaee9c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "53e7073c7154151c880a41a7e9f751f75feb5d04", "author": {"user": {"login": "elasticmachine", "name": "Elastic Machine"}}, "url": "https://github.com/elastic/elasticsearch/commit/53e7073c7154151c880a41a7e9f751f75feb5d04", "committedDate": "2020-02-07T12:35:08Z", "message": "Merge branch 'master' into jvm.options.d"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "34dc1d7b78bcdd7e33388687fa5d5307f0ae2910", "author": {"user": {"login": "jasontedor", "name": "Jason Tedor"}}, "url": "https://github.com/elastic/elasticsearch/commit/34dc1d7b78bcdd7e33388687fa5d5307f0ae2910", "committedDate": "2020-02-07T13:02:03Z", "message": "Add test, fix permissions?"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e2fe7fc645d8c292605062d9f6a004d3544e4463", "author": {"user": {"login": "jasontedor", "name": "Jason Tedor"}}, "url": "https://github.com/elastic/elasticsearch/commit/e2fe7fc645d8c292605062d9f6a004d3544e4463", "committedDate": "2020-02-07T13:07:05Z", "message": "Add permissions check"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU1MTk0MzUx", "url": "https://github.com/elastic/elasticsearch/pull/51882#pullrequestreview-355194351", "createdAt": "2020-02-07T14:31:36Z", "commit": {"oid": "e2fe7fc645d8c292605062d9f6a004d3544e4463"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "397727567ee1eedce6a70b7e4cdcd913cf972ff2", "author": {"user": {"login": "jasontedor", "name": "Jason Tedor"}}, "url": "https://github.com/elastic/elasticsearch/commit/397727567ee1eedce6a70b7e4cdcd913cf972ff2", "committedDate": "2020-02-07T15:41:49Z", "message": "Fix lintian"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c7e8cca1c8e47a0d019d433a541f552174ff467f", "author": {"user": {"login": "jasontedor", "name": "Jason Tedor"}}, "url": "https://github.com/elastic/elasticsearch/commit/c7e8cca1c8e47a0d019d433a541f552174ff467f", "committedDate": "2020-02-07T15:51:04Z", "message": "Fix ordering of test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "69d8c31657f02af1931e9b8e6675030309993472", "author": {"user": {"login": "jasontedor", "name": "Jason Tedor"}}, "url": "https://github.com/elastic/elasticsearch/commit/69d8c31657f02af1931e9b8e6675030309993472", "committedDate": "2020-02-07T17:04:55Z", "message": "Fix some tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "70a0e6c896ecb84c47492697b28f8ee884a5f87a", "author": {"user": {"login": "jasontedor", "name": "Jason Tedor"}}, "url": "https://github.com/elastic/elasticsearch/commit/70a0e6c896ecb84c47492697b28f8ee884a5f87a", "committedDate": "2020-02-08T02:48:33Z", "message": "Merge branch 'master' into jvm.options.d"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7fd24a3049ddf27307c211474ae33da2c9e05667", "author": {"user": {"login": "jasontedor", "name": "Jason Tedor"}}, "url": "https://github.com/elastic/elasticsearch/commit/7fd24a3049ddf27307c211474ae33da2c9e05667", "committedDate": "2020-02-08T17:13:20Z", "message": "Merge branch 'master' into jvm.options.d"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7f02018d0485c5675eacbe287545d131442ca329", "author": {"user": {"login": "jasontedor", "name": "Jason Tedor"}}, "url": "https://github.com/elastic/elasticsearch/commit/7f02018d0485c5675eacbe287545d131442ca329", "committedDate": "2020-02-08T19:27:06Z", "message": "Update jvm.options.d config file packaging"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9a0bb16abee5c3fc85507cbd2a735db2c1175c3f", "author": {"user": {"login": "jasontedor", "name": "Jason Tedor"}}, "url": "https://github.com/elastic/elasticsearch/commit/9a0bb16abee5c3fc85507cbd2a735db2c1175c3f", "committedDate": "2020-02-08T20:40:27Z", "message": "Properly purge on Debian"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2764, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}