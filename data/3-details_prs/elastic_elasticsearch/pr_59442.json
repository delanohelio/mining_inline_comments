{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ4Mzc0NDY3", "number": 59442, "title": "[ML] data frame analytics inference improvements", "bodyText": "this commit prevents the model from being cached unnecessarily.\nit also keeps the model bytes from being removed from the circuit breaker\nuntil inference is complete.", "createdAt": "2020-07-13T16:52:41Z", "url": "https://github.com/elastic/elasticsearch/pull/59442", "merged": true, "mergeCommit": {"oid": "f48d3838c0e09d1a6054af1d1b01a042bc63b698"}, "closed": true, "closedAt": "2020-07-15T12:04:15Z", "author": {"login": "benwtrent"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc0kXE-AH2gAyNDQ4Mzc0NDY3OjhjN2EyYWRjODZiZWFiMzBhNDllMDFiMWMyZGM4MjZkMWRhMzJmN2I=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc00kVvAH2gAyNDQ4Mzc0NDY3OmU4ZjNlZjQ4OWNjY2Y5NTg5MmIzMGMzNDIzOGQ2ZmIyZjExN2I3YzI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "8c7a2adc86beab30a49e01b1c2dc826d1da32f7b", "author": {"user": {"login": "benwtrent", "name": "Benjamin Trent"}}, "url": "https://github.com/elastic/elasticsearch/commit/8c7a2adc86beab30a49e01b1c2dc826d1da32f7b", "committedDate": "2020-07-13T16:51:56Z", "message": "[ML] data frame analytics inference improvements\nthis commit prevents the model from being cached unnecessarily.\nit also keeps the model bytes from being removed from the circuit breaker\nuntil inference is complete."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ3ODU0MDM1", "url": "https://github.com/elastic/elasticsearch/pull/59442#pullrequestreview-447854035", "createdAt": "2020-07-14T07:26:04Z", "commit": {"oid": "8c7a2adc86beab30a49e01b1c2dc826d1da32f7b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNFQwNzoyNjowNFrOGxHjaw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNFQwNzoyNjowNFrOGxHjaw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDE1NzE2Mw==", "bodyText": "Would it make sense to change this line to:\ntry (LocalModel localModel = modelLoadingService.getModelForPipeline(modelId, localModelPlainActionFuture).actionGet()) {\n\n?", "url": "https://github.com/elastic/elasticsearch/pull/59442#discussion_r454157163", "createdAt": "2020-07-14T07:26:04Z", "author": {"login": "przemekwitek"}, "path": "x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/dataframe/inference/InferenceRunner.java", "diffHunk": "@@ -73,10 +73,12 @@ public void run(String modelId) {\n         LOGGER.info(\"[{}] Started inference on test data against model [{}]\", config.getId(), modelId);\n         try {\n             PlainActionFuture<LocalModel> localModelPlainActionFuture = new PlainActionFuture<>();\n-            modelLoadingService.getModelForSearch(modelId, localModelPlainActionFuture);\n+            modelLoadingService.getModelForPipeline(modelId, localModelPlainActionFuture);\n             LocalModel localModel = localModelPlainActionFuture.actionGet();\n             TestDocsIterator testDocsIterator = new TestDocsIterator(new OriginSettingClient(client, ClientHelper.ML_ORIGIN), config);\n-            inferTestDocs(localModel, testDocsIterator);\n+            try (localModel) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8c7a2adc86beab30a49e01b1c2dc826d1da32f7b"}, "originalPosition": 9}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "def698c8184763cd8598324ea73cdb2ca3fd862c", "author": {"user": {"login": "benwtrent", "name": "Benjamin Trent"}}, "url": "https://github.com/elastic/elasticsearch/commit/def698c8184763cd8598324ea73cdb2ca3fd862c", "committedDate": "2020-07-14T11:23:39Z", "message": "slight refactor"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ4MDE5NjYy", "url": "https://github.com/elastic/elasticsearch/pull/59442#pullrequestreview-448019662", "createdAt": "2020-07-14T11:27:04Z", "commit": {"oid": "def698c8184763cd8598324ea73cdb2ca3fd862c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e8f3ef489cccf95892b30c34238d6fb2f117b7c2", "author": {"user": {"login": "elasticmachine", "name": "Elastic Machine"}}, "url": "https://github.com/elastic/elasticsearch/commit/e8f3ef489cccf95892b30c34238d6fb2f117b7c2", "committedDate": "2020-07-14T11:44:54Z", "message": "Merge branch 'master' into feature/ml-fixing-dataframe-inference-model-reference"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4424, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}