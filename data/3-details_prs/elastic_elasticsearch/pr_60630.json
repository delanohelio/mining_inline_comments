{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDYyNDE5MDAz", "number": 60630, "title": "Convert first 1/2 x-pack plugins from integTest to [yaml | java]RestTest or internalClusterTest", "bodyText": "For 1/2 the plugins in x-pack, the integTest\ntask is now a no-op and all of the tests are now executed via a test,\nyamlRestTest, javaRestTest, or internalClusterTest.\nThis includes the following projects:\nasync-search, autoscaling, ccr, enrich, eql, frozen-indicies,\ndata-streams, graph, ilm, mapper-constant-keyword, mapper-flattened, ml\nA few of the more specialized qa projects within these plugins\nhave not been changed with this PR due to additional complexity which should\nbe addressed separately.\nA follow up PR will address the remaining x-pack plugins (this PR is big enough as-is).\nrelated: #61802\nrelated: #56841\nrelated: #59939\nrelated: #55896", "createdAt": "2020-08-03T22:03:08Z", "url": "https://github.com/elastic/elasticsearch/pull/60630", "merged": true, "mergeCommit": {"oid": "51d0bcacdf0c2daf47ae1f17574e1884304a8271"}, "closed": true, "closedAt": "2020-09-02T14:22:49Z", "author": {"login": "jakelandis"}, "timelineItems": {"totalCount": 34, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc7XXsxgH2gAyNDYyNDE5MDAzOjkyODA5ZDZmZDJkMmU0NzEyNDczNmU1NmQ2NzA4NzA1NTFiMTNkNGY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdEsbtIgH2gAyNDYyNDE5MDAzOjY2NmFlODRkN2Q3NDFiMjk0OGJkNWQ3OWFjMTdmZGZiZmUyNjhjY2Y=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "92809d6fd2d2e47124736e56d670870551b13d4f", "author": {"user": {"login": "jakelandis", "name": "Jake Landis"}}, "url": "https://github.com/elastic/elasticsearch/commit/92809d6fd2d2e47124736e56d670870551b13d4f", "committedDate": "2020-08-03T19:41:19Z", "message": "async-search"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0dc6caa1fb47c542eab621499ebd9d0fd544437a", "author": {"user": {"login": "jakelandis", "name": "Jake Landis"}}, "url": "https://github.com/elastic/elasticsearch/commit/0dc6caa1fb47c542eab621499ebd9d0fd544437a", "committedDate": "2020-08-03T20:00:32Z", "message": "address java rest tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2b6ff9f51e3623eb79ee53efa9fec8a9e900c1f6", "author": {"user": {"login": "jakelandis", "name": "Jake Landis"}}, "url": "https://github.com/elastic/elasticsearch/commit/2b6ff9f51e3623eb79ee53efa9fec8a9e900c1f6", "committedDate": "2020-08-03T20:25:13Z", "message": "autoscaling"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "54446e22a76b5c08558debdaf6042f68d74bfd77", "author": {"user": {"login": "jakelandis", "name": "Jake Landis"}}, "url": "https://github.com/elastic/elasticsearch/commit/54446e22a76b5c08558debdaf6042f68d74bfd77", "committedDate": "2020-08-03T20:31:57Z", "message": "ccr:rest"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "537fe051e8986cd244308ac739b499e4d46aa3a0", "author": {"user": {"login": "jakelandis", "name": "Jake Landis"}}, "url": "https://github.com/elastic/elasticsearch/commit/537fe051e8986cd244308ac739b499e4d46aa3a0", "committedDate": "2020-08-03T21:11:58Z", "message": "enrich"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "06dcaf33351da499b750e525a9445de86a91b1b4", "author": {"user": {"login": "jakelandis", "name": "Jake Landis"}}, "url": "https://github.com/elastic/elasticsearch/commit/06dcaf33351da499b750e525a9445de86a91b1b4", "committedDate": "2020-08-03T21:29:55Z", "message": "eql"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4b823b6bb59b69c98de22d3687de41bc5b9b7d5c", "author": {"user": {"login": "jakelandis", "name": "Jake Landis"}}, "url": "https://github.com/elastic/elasticsearch/commit/4b823b6bb59b69c98de22d3687de41bc5b9b7d5c", "committedDate": "2020-08-03T21:32:56Z", "message": "enrich fixes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7f1dff166d2ed4f19b081747cdc1265c657263f2", "author": {"user": {"login": "jakelandis", "name": "Jake Landis"}}, "url": "https://github.com/elastic/elasticsearch/commit/7f1dff166d2ed4f19b081747cdc1265c657263f2", "committedDate": "2020-08-03T21:36:08Z", "message": "data stream fixes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9e8b72ece46d46a508d11e3e5eaf533955474f02", "author": {"user": {"login": "jakelandis", "name": "Jake Landis"}}, "url": "https://github.com/elastic/elasticsearch/commit/9e8b72ece46d46a508d11e3e5eaf533955474f02", "committedDate": "2020-08-03T21:40:06Z", "message": "ccr:rest fixes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3ff33167102cea4df3c570b74ede65358c751122", "author": {"user": {"login": "jakelandis", "name": "Jake Landis"}}, "url": "https://github.com/elastic/elasticsearch/commit/3ff33167102cea4df3c570b74ede65358c751122", "committedDate": "2020-08-03T21:41:43Z", "message": "autoscale fix"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "13c817667db32a203ed66541e68158ce15f1742a", "author": {"user": {"login": "jakelandis", "name": "Jake Landis"}}, "url": "https://github.com/elastic/elasticsearch/commit/13c817667db32a203ed66541e68158ce15f1742a", "committedDate": "2020-08-03T21:46:10Z", "message": "frozen-indices"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "27f34cef2e82a679e017852812ef77c4b91a0a5d", "author": {"user": {"login": "jakelandis", "name": "Jake Landis"}}, "url": "https://github.com/elastic/elasticsearch/commit/27f34cef2e82a679e017852812ef77c4b91a0a5d", "committedDate": "2020-08-03T21:55:25Z", "message": "graph"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d5509df96acb5e7f7dfbd02f497b792398f13c56", "author": {"user": {"login": "jakelandis", "name": "Jake Landis"}}, "url": "https://github.com/elastic/elasticsearch/commit/d5509df96acb5e7f7dfbd02f497b792398f13c56", "committedDate": "2020-08-05T15:14:19Z", "message": "fix autoscaling testing conventions"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0caf4b3c29514e40e1cc82628e460dd83f4b6f16", "author": {"user": {"login": "jakelandis", "name": "Jake Landis"}}, "url": "https://github.com/elastic/elasticsearch/commit/0caf4b3c29514e40e1cc82628e460dd83f4b6f16", "committedDate": "2020-08-05T16:54:36Z", "message": "identity-provider"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "48163d54d7453205b34e9ced050520b779553e7d", "author": {"user": {"login": "jakelandis", "name": "Jake Landis"}}, "url": "https://github.com/elastic/elasticsearch/commit/48163d54d7453205b34e9ced050520b779553e7d", "committedDate": "2020-08-05T17:29:54Z", "message": "ilm"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3f43102fd98b11514df7e30901584751839a2a0f", "author": {"user": {"login": "jakelandis", "name": "Jake Landis"}}, "url": "https://github.com/elastic/elasticsearch/commit/3f43102fd98b11514df7e30901584751839a2a0f", "committedDate": "2020-08-05T17:34:03Z", "message": "mapper-constant-keyword"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "78ae27d99333cf7ba8a15e3fdf0e4d0f4bb5c7ab", "author": {"user": {"login": "jakelandis", "name": "Jake Landis"}}, "url": "https://github.com/elastic/elasticsearch/commit/78ae27d99333cf7ba8a15e3fdf0e4d0f4bb5c7ab", "committedDate": "2020-08-05T17:49:57Z", "message": "mapper-flattened"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "61abbd28ce5ec950407633cbba2828123d3185ae", "author": {"user": {"login": "jakelandis", "name": "Jake Landis"}}, "url": "https://github.com/elastic/elasticsearch/commit/61abbd28ce5ec950407633cbba2828123d3185ae", "committedDate": "2020-08-05T20:04:30Z", "message": "ml - part 1 (not all working)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9cfb7cc971514747080daa4416fb483d1e80eb38", "author": {"user": {"login": "jakelandis", "name": "Jake Landis"}}, "url": "https://github.com/elastic/elasticsearch/commit/9cfb7cc971514747080daa4416fb483d1e80eb38", "committedDate": "2020-08-05T20:46:50Z", "message": "ml - part 2"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ed0186f3b1cdd8824a994188a9248c7f9999fa26", "author": {"user": {"login": "jakelandis", "name": "Jake Landis"}}, "url": "https://github.com/elastic/elasticsearch/commit/ed0186f3b1cdd8824a994188a9248c7f9999fa26", "committedDate": "2020-08-05T20:51:18Z", "message": "ml part 3"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bceb48c89d88601c7ed41cd3c0bb0e35d178a1e3", "author": {"user": {"login": "jakelandis", "name": "Jake Landis"}}, "url": "https://github.com/elastic/elasticsearch/commit/bceb48c89d88601c7ed41cd3c0bb0e35d178a1e3", "committedDate": "2020-08-05T21:16:08Z", "message": "fix ILM tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a19c8122cb1c06b27f1506d9985fae1d721741cb", "author": {"user": {"login": "jakelandis", "name": "Jake Landis"}}, "url": "https://github.com/elastic/elasticsearch/commit/a19c8122cb1c06b27f1506d9985fae1d721741cb", "committedDate": "2020-08-05T21:27:18Z", "message": "Merge remote-tracking branch 'upstream/master' into yamlRestTest_xpack_plugins"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYyMDY0NDk1", "url": "https://github.com/elastic/elasticsearch/pull/60630#pullrequestreview-462064495", "createdAt": "2020-08-05T22:22:58Z", "commit": {"oid": "a19c8122cb1c06b27f1506d9985fae1d721741cb"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNVQyMjoyMjo1OFrOG8cpug==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNVQyMjoyMjo1OFrOG8cpug==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjAzNzE3OA==", "bodyText": "I moved some test only dependencies out of the main source set and into the test source set and added expose it as a test artifact.", "url": "https://github.com/elastic/elasticsearch/pull/60630#discussion_r466037178", "createdAt": "2020-08-05T22:22:58Z", "author": {"login": "jakelandis"}, "path": "x-pack/plugin/eql/qa/common/build.gradle", "diffHunk": "@@ -9,3 +9,17 @@ dependencies {\n   // TOML parser for EqlActionIT tests\n   api 'io.ous:jtoml:2.0.0'\n }\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a19c8122cb1c06b27f1506d9985fae1d721741cb"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYyMDY1MDIy", "url": "https://github.com/elastic/elasticsearch/pull/60630#pullrequestreview-462065022", "createdAt": "2020-08-05T22:24:19Z", "commit": {"oid": "a19c8122cb1c06b27f1506d9985fae1d721741cb"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNVQyMjoyNDoxOVrOG8crpA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNVQyMjoyNDoxOVrOG8crpA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjAzNzY2OA==", "bodyText": "moved this to utility class (in the the test sourceset) so it can be shared easier.", "url": "https://github.com/elastic/elasticsearch/pull/60630#discussion_r466037668", "createdAt": "2020-08-05T22:24:19Z", "author": {"login": "jakelandis"}, "path": "x-pack/plugin/identity-provider/src/internalClusterTest/java/org/elasticsearch/xpack/idp/saml/sp/SamlServiceProviderIndexTests.java", "diffHunk": "@@ -242,59 +240,6 @@ private void refresh() {\n         future.actionGet();\n     }\n \n-    public static SamlServiceProviderDocument randomDocument() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a19c8122cb1c06b27f1506d9985fae1d721741cb"}, "originalPosition": 36}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYyMDY1MjY2", "url": "https://github.com/elastic/elasticsearch/pull/60630#pullrequestreview-462065266", "createdAt": "2020-08-05T22:24:58Z", "commit": {"oid": "a19c8122cb1c06b27f1506d9985fae1d721741cb"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNVQyMjoyNDo1OFrOG8csjg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNVQyMjoyNDo1OFrOG8csjg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjAzNzkwMg==", "bodyText": "no functional changes here ... just copy pasta to allow re-use across source sets.", "url": "https://github.com/elastic/elasticsearch/pull/60630#discussion_r466037902", "createdAt": "2020-08-05T22:24:58Z", "author": {"login": "jakelandis"}, "path": "x-pack/plugin/identity-provider/src/test/java/org/elasticsearch/xpack/idp/saml/sp/SamlServiceProviderTestUtils.java", "diffHunk": "@@ -0,0 +1,79 @@\n+/*\n+ * Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one\n+ * or more contributor license agreements. Licensed under the Elastic License;\n+ * you may not use this file except in compliance with the Elastic License.\n+ */\n+\n+package org.elasticsearch.xpack.idp.saml.sp;\n+\n+import org.elasticsearch.common.unit.TimeValue;\n+\n+import java.util.HashSet;\n+import java.util.Set;\n+\n+import static org.elasticsearch.test.ESTestCase.randomAlphaOfLengthBetween;\n+import static org.elasticsearch.test.ESTestCase.randomBoolean;\n+import static org.elasticsearch.test.ESTestCase.randomFrom;\n+import static org.elasticsearch.test.ESTestCase.randomIntBetween;\n+import static org.elasticsearch.test.ESTestCase.randomLong;\n+import static org.hamcrest.Matchers.nullValue;\n+import static org.junit.Assert.assertThat;\n+import static org.opensaml.saml.saml2.core.NameIDType.TRANSIENT;\n+\n+public class SamlServiceProviderTestUtils {\n+\n+    private SamlServiceProviderTestUtils(){} //utility class\n+\n+    public static SamlServiceProviderDocument randomDocument() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a19c8122cb1c06b27f1506d9985fae1d721741cb"}, "originalPosition": 27}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYyMDY2MjU5", "url": "https://github.com/elastic/elasticsearch/pull/60630#pullrequestreview-462066259", "createdAt": "2020-08-05T22:27:22Z", "commit": {"oid": "a19c8122cb1c06b27f1506d9985fae1d721741cb"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNVQyMjoyNzoyMlrOG8cv0g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNVQyMjoyNzoyMlrOG8cv0g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjAzODczOA==", "bodyText": "Quite a few of the ML REST tests had a dependency on the ML main code for ONLY this base path reference in the tests.  Adding to each test like here is a bit redundant, but allows us to break that class path dependency and the REST path for ml is unlikely to change.", "url": "https://github.com/elastic/elasticsearch/pull/60630#discussion_r466038738", "createdAt": "2020-08-05T22:27:22Z", "author": {"login": "jakelandis"}, "path": "x-pack/plugin/ml/qa/basic-multi-node/src/javaRestTest/java/org/elasticsearch/xpack/ml/integration/MlBasicMultiNodeIT.java", "diffHunk": "@@ -29,6 +28,8 @@\n \n public class MlBasicMultiNodeIT extends ESRestTestCase {\n \n+    private static final String BASE_PATH = \"/_ml/\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a19c8122cb1c06b27f1506d9985fae1d721741cb"}, "originalPosition": 12}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYyMDY3MDk5", "url": "https://github.com/elastic/elasticsearch/pull/60630#pullrequestreview-462067099", "createdAt": "2020-08-05T22:29:18Z", "commit": {"oid": "a19c8122cb1c06b27f1506d9985fae1d721741cb"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNVQyMjoyOToxOFrOG8cypA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNVQyMjoyOToxOFrOG8cypA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjAzOTQ2MA==", "bodyText": "here is an example where duplicating the BASE_PATH allows us to remove the dependency.", "url": "https://github.com/elastic/elasticsearch/pull/60630#discussion_r466039460", "createdAt": "2020-08-05T22:29:18Z", "author": {"login": "jakelandis"}, "path": "x-pack/plugin/ml/qa/single-node-tests/build.gradle", "diffHunk": "@@ -1,13 +1,6 @@\n-apply plugin: 'elasticsearch.testclusters'\n-apply plugin: 'elasticsearch.standalone-rest-test'\n-apply plugin: 'elasticsearch.rest-test'\n+apply plugin: 'elasticsearch.java-rest-test'\n \n-dependencies {\n-  testImplementation project(\":x-pack:plugin:core\")\n-  testImplementation project(path: xpackModule('ml'))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a19c8122cb1c06b27f1506d9985fae1d721741cb"}, "originalPosition": 8}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY0NDMwMDI1", "url": "https://github.com/elastic/elasticsearch/pull/60630#pullrequestreview-464430025", "createdAt": "2020-08-10T17:26:51Z", "commit": {"oid": "a19c8122cb1c06b27f1506d9985fae1d721741cb"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f8038428ba51c43b3ae6cecc4764cac3c620c6ab", "author": {"user": {"login": "jakelandis", "name": "Jake Landis"}}, "url": "https://github.com/elastic/elasticsearch/commit/f8038428ba51c43b3ae6cecc4764cac3c620c6ab", "committedDate": "2020-08-24T16:29:53Z", "message": "Merge remote-tracking branch 'upstream/master' into yamlRestTest_xpack_plugins"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "29bb22fdf3587214833b1c3486297179e473a933", "author": {"user": {"login": "jakelandis", "name": "Jake Landis"}}, "url": "https://github.com/elastic/elasticsearch/commit/29bb22fdf3587214833b1c3486297179e473a933", "committedDate": "2020-08-24T19:02:36Z", "message": "preserve main source set"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "43cbc3ef05e042a33f6a1ee90c8c380c803d38d9", "author": {"user": {"login": "jakelandis", "name": "Jake Landis"}}, "url": "https://github.com/elastic/elasticsearch/commit/43cbc3ef05e042a33f6a1ee90c8c380c803d38d9", "committedDate": "2020-09-01T15:58:28Z", "message": "Merge branch 'master' into yamlRestTest_xpack_plugins"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9ec969b4079e91d0b85cbbdb602c5fa017d32165", "author": {"user": {"login": "jakelandis", "name": "Jake Landis"}}, "url": "https://github.com/elastic/elasticsearch/commit/9ec969b4079e91d0b85cbbdb602c5fa017d32165", "committedDate": "2020-09-01T17:09:20Z", "message": "fix merge"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9f15419764e6079b62c15ff95d0ea19d228f1caf", "author": {"user": {"login": "jakelandis", "name": "Jake Landis"}}, "url": "https://github.com/elastic/elasticsearch/commit/9f15419764e6079b62c15ff95d0ea19d228f1caf", "committedDate": "2020-09-01T17:31:46Z", "message": "fix available processors"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "666ae84d7d741b2948bd5d79ac17fdfbfe268ccf", "author": {"user": {"login": "jakelandis", "name": "Jake Landis"}}, "url": "https://github.com/elastic/elasticsearch/commit/666ae84d7d741b2948bd5d79ac17fdfbfe268ccf", "committedDate": "2020-09-01T19:19:01Z", "message": "fix the merge fix"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3489, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}