{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY2NDk5MTQ0", "number": 51366, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yM1QyMDozNDowNFrODaTazA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yNFQxNTo0NzoyNFrODahx_A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI4OTA3NzI0OnYy", "diffSide": "RIGHT", "path": "qa/os/src/test/java/org/elasticsearch/packaging/test/PackageTests.java", "isResolved": false, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yM1QyMDozNDowNFrOFhLx7A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yNFQxNTo0NjowOVrOFhh2Bg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDM0MDMzMg==", "bodyText": "Could we just adjust the since time by 2 seconds instead of sleeping?", "url": "https://github.com/elastic/elasticsearch/pull/51366#discussion_r370340332", "createdAt": "2020-01-23T20:34:04Z", "author": {"login": "rjernst"}, "path": "qa/os/src/test/java/org/elasticsearch/packaging/test/PackageTests.java", "diffHunk": "@@ -342,10 +341,9 @@ public void test90DoNotCloseStderrWhenQuiet() throws Exception {\n             append(tempConf.resolve(\"elasticsearch.yml\"), \"discovery.zen.ping.unicast.hosts:15172.30.5.3416172.30.5.35, 172.30.5.17]\\n\");\n \n             // Make sure we don't pick up the journal entries for previous ES instances.\n-            clearJournal(sh);\n+            String elasticsearchStartTime = sh.run(\"sleep 2 && date +\\\"%Y-%m-%d %H:%M:%S\\\"\").stdout.trim();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "17a4324c3c2429456c16934a82258e0999300b6e"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDM1MzMyNA==", "bodyText": "I don't think that would guarantee a gap between Elasticsearch journal messages that's wider than the one-second granularity that the --since flag gives us.\nIf we have test A and test B and both check for the same error message, but test B is broken, we want to make sure that test A and test B's journal messages don't occur in the same second. I'm not sure how to guarantee that except by introducing a pause.\nAnother approach might be finding a way to tail journal messages to a test-specific file.", "url": "https://github.com/elastic/elasticsearch/pull/51366#discussion_r370353324", "createdAt": "2020-01-23T21:04:47Z", "author": {"login": "williamrandolph"}, "path": "qa/os/src/test/java/org/elasticsearch/packaging/test/PackageTests.java", "diffHunk": "@@ -342,10 +341,9 @@ public void test90DoNotCloseStderrWhenQuiet() throws Exception {\n             append(tempConf.resolve(\"elasticsearch.yml\"), \"discovery.zen.ping.unicast.hosts:15172.30.5.3416172.30.5.35, 172.30.5.17]\\n\");\n \n             // Make sure we don't pick up the journal entries for previous ES instances.\n-            clearJournal(sh);\n+            String elasticsearchStartTime = sh.run(\"sleep 2 && date +\\\"%Y-%m-%d %H:%M:%S\\\"\").stdout.trim();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDM0MDMzMg=="}, "originalCommit": {"oid": "17a4324c3c2429456c16934a82258e0999300b6e"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDM2NzkxNg==", "bodyText": "Some versions of journalctl provide for navigating output with a cursor; I'm going to see if that looks like something we'll have on all platforms.", "url": "https://github.com/elastic/elasticsearch/pull/51366#discussion_r370367916", "createdAt": "2020-01-23T21:37:04Z", "author": {"login": "williamrandolph"}, "path": "qa/os/src/test/java/org/elasticsearch/packaging/test/PackageTests.java", "diffHunk": "@@ -342,10 +341,9 @@ public void test90DoNotCloseStderrWhenQuiet() throws Exception {\n             append(tempConf.resolve(\"elasticsearch.yml\"), \"discovery.zen.ping.unicast.hosts:15172.30.5.3416172.30.5.35, 172.30.5.17]\\n\");\n \n             // Make sure we don't pick up the journal entries for previous ES instances.\n-            clearJournal(sh);\n+            String elasticsearchStartTime = sh.run(\"sleep 2 && date +\\\"%Y-%m-%d %H:%M:%S\\\"\").stdout.trim();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDM0MDMzMg=="}, "originalCommit": {"oid": "17a4324c3c2429456c16934a82258e0999300b6e"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDcwMTgzMA==", "bodyText": "I think I have a solution that avoids invoking sleep.", "url": "https://github.com/elastic/elasticsearch/pull/51366#discussion_r370701830", "createdAt": "2020-01-24T15:46:09Z", "author": {"login": "williamrandolph"}, "path": "qa/os/src/test/java/org/elasticsearch/packaging/test/PackageTests.java", "diffHunk": "@@ -342,10 +341,9 @@ public void test90DoNotCloseStderrWhenQuiet() throws Exception {\n             append(tempConf.resolve(\"elasticsearch.yml\"), \"discovery.zen.ping.unicast.hosts:15172.30.5.3416172.30.5.35, 172.30.5.17]\\n\");\n \n             // Make sure we don't pick up the journal entries for previous ES instances.\n-            clearJournal(sh);\n+            String elasticsearchStartTime = sh.run(\"sleep 2 && date +\\\"%Y-%m-%d %H:%M:%S\\\"\").stdout.trim();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDM0MDMzMg=="}, "originalCommit": {"oid": "17a4324c3c2429456c16934a82258e0999300b6e"}, "originalPosition": 13}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI5MTQzMDM2OnYy", "diffSide": "RIGHT", "path": "qa/os/src/test/java/org/elasticsearch/packaging/util/Packages.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yNFQxNTo0NzoyNFrOFhh5Aw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yNFQxNTo0NzoyNFrOFhh5Aw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDcwMjU5NQ==", "bodyText": "Note: even though this is only invoked in one test on the master branch, I'm going to need it for keystore tests on the feature branch, and it seems like something that could be generally useful later on.", "url": "https://github.com/elastic/elasticsearch/pull/51366#discussion_r370702595", "createdAt": "2020-01-24T15:47:24Z", "author": {"login": "williamrandolph"}, "path": "qa/os/src/test/java/org/elasticsearch/packaging/util/Packages.java", "diffHunk": "@@ -332,4 +306,41 @@ public static void restartElasticsearch(Shell sh, Installation installation) thr\n         }\n         assertElasticsearchStarted(sh, installation);\n     }\n+\n+    /**\n+     * A small wrapper for retrieving only recent journald logs for the\n+     * Elasticsearch service. It works by creating a cursor for the logs\n+     * when instantiated, and advancing that cursor when the {@code clear()}\n+     * method is called.\n+     */\n+    public static class JournaldWrapper {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "083a74eb3494e064817b4def69298debb97522ce"}, "originalPosition": 51}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4469, "cost": 1, "resetAt": "2021-11-12T13:16:51Z"}}}