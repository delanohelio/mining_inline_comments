{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE5MzYxOTQw", "number": 64955, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMVQyMTowMTozNFrOE332MQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMVQyMTowMTozNFrOE332MQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI3MDIyMTI5OnYy", "diffSide": "RIGHT", "path": "x-pack/plugin/core/src/test/java/org/elasticsearch/xpack/core/ilm/ReplaceDataStreamBackingIndexStepTests.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMVQyMTowMTozNFrOHxeI4w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMVQyMTowMTozNFrOHxeI4w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTYzNjA2Nw==", "bodyText": "A neat side effect of this cleanup is that it made it easier to catch this bug. We were calling the builder twice, but the second invocation would actually produce a broken result because it created an immutable open map with a null map inside that would NPE on every operation if used.", "url": "https://github.com/elastic/elasticsearch/pull/64955#discussion_r521636067", "createdAt": "2020-11-11T21:01:34Z", "author": {"login": "original-brownbear"}, "path": "x-pack/plugin/core/src/test/java/org/elasticsearch/xpack/core/ilm/ReplaceDataStreamBackingIndexStepTests.java", "diffHunk": "@@ -61,12 +61,13 @@ public void testPerformActionThrowsExceptionIfIndexIsNotPartOfDataStream() {\n             IndexMetadata.builder(indexName).settings(settings(Version.CURRENT).put(LifecycleSettings.LIFECYCLE_NAME, policyName))\n                 .numberOfShards(randomIntBetween(1, 5)).numberOfReplicas(randomIntBetween(0, 5));\n \n+        final IndexMetadata sourceIndexMetadata = sourceIndexMetadataBuilder.build();\n         ClusterState clusterState = ClusterState.builder(emptyClusterState()).metadata(\n-            Metadata.builder().put(sourceIndexMetadataBuilder).build()\n+            Metadata.builder().put(sourceIndexMetadata, false).build()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1307fbdd4bc4bf5898ce6a0b5ca438821c36ffc5"}, "originalPosition": 7}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2963, "cost": 1, "resetAt": "2021-11-12T13:16:51Z"}}}