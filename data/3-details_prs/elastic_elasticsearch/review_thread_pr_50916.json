{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzYyMTA4MzIx", "number": 50916, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xM1QxNTo1MDo1OFrODXkNqw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNFQxODoxOTo1OVrODX8YkA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI2MDM3MTYzOnYy", "diffSide": "RIGHT", "path": "rest-api-spec/src/main/resources/rest-api-spec/test/search.aggregation/310_date_agg_per_day_of_week.yml", "isResolved": false, "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xM1QxNTo1MDo1OFrOFc7aMA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xN1QwODowNzowMVrOFexWww==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTg3NzgwOA==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \"Date aggregartion per day of week\":\n          \n          \n            \n            \"Date aggregation per day of week\":", "url": "https://github.com/elastic/elasticsearch/pull/50916#discussion_r365877808", "createdAt": "2020-01-13T15:50:58Z", "author": {"login": "pugnascotia"}, "path": "rest-api-spec/src/main/resources/rest-api-spec/test/search.aggregation/310_date_agg_per_day_of_week.yml", "diffHunk": "@@ -0,0 +1,44 @@\n+\n+setup:\n+  - skip:\n+      version: \" - 7.5.99\" #todo this test failing on jdk8. has to be removed from 7.x\n+      reason:  \"Start of the week Monday was backported to 7.5\"\n+\n+\n+  - do:\n+      indices.create:\n+        index: test\n+        body:\n+          mappings:\n+            properties:\n+              date:\n+                type: date\n+  - do:\n+      index:\n+        index: test\n+        id:    1\n+        body:  { \"date\": \"2009-11-15T14:12:12\" }\n+  - do:\n+      indices.refresh:\n+        index: [test]\n+---\n+# The inserted document has a field date=2009-11-15T14:12:12 which is Sunday.\n+# When aggregating per day of the week this should be considered as last day of the week (7)\n+# and this value should be used in 'key_as_string'\n+\"Date aggregartion per day of week\":", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "53acc74c61c668697ff27bbf53ebedbf116e520a"}, "originalPosition": 28}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTg5MzI2OA==", "bodyText": "yes - as per todo this test is expected to fail in 1.8 https://github.com/elastic/elasticsearch/pull/50916/files#diff-a1dab819a2bedbcb781ecd85580cfbb5R4\nI am actually not sure how to work around this, the code for using IsoCalendarDataProvider is in 7.x but because we support JDK1.8 I won't be able to always pass the build.\nAny suggestions how to fix this?\nI am thinking of just removing the test for now..", "url": "https://github.com/elastic/elasticsearch/pull/50916#discussion_r365893268", "createdAt": "2020-01-13T16:18:35Z", "author": {"login": "pgomulka"}, "path": "rest-api-spec/src/main/resources/rest-api-spec/test/search.aggregation/310_date_agg_per_day_of_week.yml", "diffHunk": "@@ -0,0 +1,44 @@\n+\n+setup:\n+  - skip:\n+      version: \" - 7.5.99\" #todo this test failing on jdk8. has to be removed from 7.x\n+      reason:  \"Start of the week Monday was backported to 7.5\"\n+\n+\n+  - do:\n+      indices.create:\n+        index: test\n+        body:\n+          mappings:\n+            properties:\n+              date:\n+                type: date\n+  - do:\n+      index:\n+        index: test\n+        id:    1\n+        body:  { \"date\": \"2009-11-15T14:12:12\" }\n+  - do:\n+      indices.refresh:\n+        index: [test]\n+---\n+# The inserted document has a field date=2009-11-15T14:12:12 which is Sunday.\n+# When aggregating per day of the week this should be considered as last day of the week (7)\n+# and this value should be used in 'key_as_string'\n+\"Date aggregartion per day of week\":", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTg3NzgwOA=="}, "originalCommit": {"oid": "53acc74c61c668697ff27bbf53ebedbf116e520a"}, "originalPosition": 28}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Njc0NzEzMQ==", "bodyText": "@pugnascotia @rjernst what is your view on this? Maybe we should extend the testing framework to allow checking runtime jvm and skip basing on this?\nhow about we work around this with features ? see the latest changes", "url": "https://github.com/elastic/elasticsearch/pull/50916#discussion_r366747131", "createdAt": "2020-01-15T08:34:03Z", "author": {"login": "pgomulka"}, "path": "rest-api-spec/src/main/resources/rest-api-spec/test/search.aggregation/310_date_agg_per_day_of_week.yml", "diffHunk": "@@ -0,0 +1,44 @@\n+\n+setup:\n+  - skip:\n+      version: \" - 7.5.99\" #todo this test failing on jdk8. has to be removed from 7.x\n+      reason:  \"Start of the week Monday was backported to 7.5\"\n+\n+\n+  - do:\n+      indices.create:\n+        index: test\n+        body:\n+          mappings:\n+            properties:\n+              date:\n+                type: date\n+  - do:\n+      index:\n+        index: test\n+        id:    1\n+        body:  { \"date\": \"2009-11-15T14:12:12\" }\n+  - do:\n+      indices.refresh:\n+        index: [test]\n+---\n+# The inserted document has a field date=2009-11-15T14:12:12 which is Sunday.\n+# When aggregating per day of the week this should be considered as last day of the week (7)\n+# and this value should be used in 'key_as_string'\n+\"Date aggregartion per day of week\":", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTg3NzgwOA=="}, "originalCommit": {"oid": "53acc74c61c668697ff27bbf53ebedbf116e520a"}, "originalPosition": 28}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzQ0MTc5NQ==", "bodyText": "My feeling is that these changes are fine, but what I'm missing is some Javadoc to explain why they're necessary. Unless I have all the context around dates and JDK versions, I can't understand what the checks are for. The new feature name doesn't help here either. Can we add some more explanation into the code, to help other developers understand what is going on and why?", "url": "https://github.com/elastic/elasticsearch/pull/50916#discussion_r367441795", "createdAt": "2020-01-16T14:19:26Z", "author": {"login": "pugnascotia"}, "path": "rest-api-spec/src/main/resources/rest-api-spec/test/search.aggregation/310_date_agg_per_day_of_week.yml", "diffHunk": "@@ -0,0 +1,44 @@\n+\n+setup:\n+  - skip:\n+      version: \" - 7.5.99\" #todo this test failing on jdk8. has to be removed from 7.x\n+      reason:  \"Start of the week Monday was backported to 7.5\"\n+\n+\n+  - do:\n+      indices.create:\n+        index: test\n+        body:\n+          mappings:\n+            properties:\n+              date:\n+                type: date\n+  - do:\n+      index:\n+        index: test\n+        id:    1\n+        body:  { \"date\": \"2009-11-15T14:12:12\" }\n+  - do:\n+      indices.refresh:\n+        index: [test]\n+---\n+# The inserted document has a field date=2009-11-15T14:12:12 which is Sunday.\n+# When aggregating per day of the week this should be considered as last day of the week (7)\n+# and this value should be used in 'key_as_string'\n+\"Date aggregartion per day of week\":", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTg3NzgwOA=="}, "originalCommit": {"oid": "53acc74c61c668697ff27bbf53ebedbf116e520a"}, "originalPosition": 28}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzgxMDI0Mw==", "bodyText": "@pugnascotia good idea. will add some more javadocs as they are clearly missing", "url": "https://github.com/elastic/elasticsearch/pull/50916#discussion_r367810243", "createdAt": "2020-01-17T08:07:01Z", "author": {"login": "pgomulka"}, "path": "rest-api-spec/src/main/resources/rest-api-spec/test/search.aggregation/310_date_agg_per_day_of_week.yml", "diffHunk": "@@ -0,0 +1,44 @@\n+\n+setup:\n+  - skip:\n+      version: \" - 7.5.99\" #todo this test failing on jdk8. has to be removed from 7.x\n+      reason:  \"Start of the week Monday was backported to 7.5\"\n+\n+\n+  - do:\n+      indices.create:\n+        index: test\n+        body:\n+          mappings:\n+            properties:\n+              date:\n+                type: date\n+  - do:\n+      index:\n+        index: test\n+        id:    1\n+        body:  { \"date\": \"2009-11-15T14:12:12\" }\n+  - do:\n+      indices.refresh:\n+        index: [test]\n+---\n+# The inserted document has a field date=2009-11-15T14:12:12 which is Sunday.\n+# When aggregating per day of the week this should be considered as last day of the week (7)\n+# and this value should be used in 'key_as_string'\n+\"Date aggregartion per day of week\":", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTg3NzgwOA=="}, "originalCommit": {"oid": "53acc74c61c668697ff27bbf53ebedbf116e520a"}, "originalPosition": 28}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI2NDMyOTU1OnYy", "diffSide": "RIGHT", "path": "distribution/src/config/jvm.options", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNFQxODoxOToxNFrOFdhLmw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNVQwODozMDo0N1rOFdwZCA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjQ5NjY2Nw==", "bodyText": "Shouldn't this just be 8, not 8-?", "url": "https://github.com/elastic/elasticsearch/pull/50916#discussion_r366496667", "createdAt": "2020-01-14T18:19:14Z", "author": {"login": "rjernst"}, "path": "distribution/src/config/jvm.options", "diffHunk": "@@ -75,3 +75,8 @@ ${error.file}\n \n # JDK 9+ GC logging\n 9-:-Xlog:gc*,gc+age=trace,safepoint:file=${loggc}:utctime,pid,tags:filecount=32,filesize=64m\n+\n+# due to internationalization enhancements in JDK 9 Elasticsearch need to set the provider to COMPAT otherwise\n+# time/date parsing will break in an incompatible way for some date patterns and locals\n+8-:-Djava.locale.providers=SPI,JRE", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "53acc74c61c668697ff27bbf53ebedbf116e520a"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Njc0NTg2NA==", "bodyText": "true, this should just be 8 - removed in favour of conditional check in SystemJvmOptions", "url": "https://github.com/elastic/elasticsearch/pull/50916#discussion_r366745864", "createdAt": "2020-01-15T08:30:47Z", "author": {"login": "pgomulka"}, "path": "distribution/src/config/jvm.options", "diffHunk": "@@ -75,3 +75,8 @@ ${error.file}\n \n # JDK 9+ GC logging\n 9-:-Xlog:gc*,gc+age=trace,safepoint:file=${loggc}:utctime,pid,tags:filecount=32,filesize=64m\n+\n+# due to internationalization enhancements in JDK 9 Elasticsearch need to set the provider to COMPAT otherwise\n+# time/date parsing will break in an incompatible way for some date patterns and locals\n+8-:-Djava.locale.providers=SPI,JRE", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjQ5NjY2Nw=="}, "originalCommit": {"oid": "53acc74c61c668697ff27bbf53ebedbf116e520a"}, "originalPosition": 7}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI2NDMzMTY4OnYy", "diffSide": "LEFT", "path": "distribution/tools/launchers/src/main/java/org/elasticsearch/tools/launchers/SystemJvmOptions.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNFQxODoxOTo1OVrOFdhNAA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNVQwODozMDoyMlrOFdwYcA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjQ5NzAyNA==", "bodyText": "Why can't we keep this in system jvm options? Shouldn't this be something a user doesn't need to think about?", "url": "https://github.com/elastic/elasticsearch/pull/50916#discussion_r366497024", "createdAt": "2020-01-14T18:19:59Z", "author": {"login": "rjernst"}, "path": "distribution/tools/launchers/src/main/java/org/elasticsearch/tools/launchers/SystemJvmOptions.java", "diffHunk": "@@ -59,12 +59,7 @@\n             \"-Dio.netty.allocator.numDirectArenas=0\",\n             // log4j 2\n             \"-Dlog4j.shutdownHookEnabled=false\",\n-            \"-Dlog4j2.disable.jmx=true\",\n-            /*\n-             * Due to internationalization enhancements in JDK 9 Elasticsearch need to set the provider to COMPAT otherwise time/date\n-             * parsing will break in an incompatible way for some date patterns and locales.\n-             */\n-            \"-Djava.locale.providers=COMPAT\"));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "53acc74c61c668697ff27bbf53ebedbf116e520a"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Njc0NTcxMg==", "bodyText": "you are right, it is better to stay in SystemJvmOptions. We can always check the version running with JavaVersion.majorVersion(JavaVersion.CURRENT) == 8 to choose the right settings", "url": "https://github.com/elastic/elasticsearch/pull/50916#discussion_r366745712", "createdAt": "2020-01-15T08:30:22Z", "author": {"login": "pgomulka"}, "path": "distribution/tools/launchers/src/main/java/org/elasticsearch/tools/launchers/SystemJvmOptions.java", "diffHunk": "@@ -59,12 +59,7 @@\n             \"-Dio.netty.allocator.numDirectArenas=0\",\n             // log4j 2\n             \"-Dlog4j.shutdownHookEnabled=false\",\n-            \"-Dlog4j2.disable.jmx=true\",\n-            /*\n-             * Due to internationalization enhancements in JDK 9 Elasticsearch need to set the provider to COMPAT otherwise time/date\n-             * parsing will break in an incompatible way for some date patterns and locales.\n-             */\n-            \"-Djava.locale.providers=COMPAT\"));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjQ5NzAyNA=="}, "originalCommit": {"oid": "53acc74c61c668697ff27bbf53ebedbf116e520a"}, "originalPosition": 9}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4657, "cost": 1, "resetAt": "2021-11-12T13:16:51Z"}}}