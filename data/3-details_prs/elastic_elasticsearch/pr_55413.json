{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA1MjU2NDMx", "number": 55413, "title": "Enable decompression of response within LowLevelRestClient", "bodyText": "This pull request is to enable the RestHighLevelClient and LowLevelRestClient to automatically handle an Elasticsearch response which has compressed content. It was already possible to do this with the low level client manually, see here AsyncElasticsearchCompressedRequest. Compression can enabled within a node configuration with the following property: http.compression: true Compression can be triggered by a request from a client. Therefor you also need to provide additional information within the header of the request to Elasticsearch if a client really wants to enable it. That is possible with the following RequestOptions:\nRequestOptions.Builder requestOptions = RequestOptions.DEFAULT.toBuilder()\n    .addHeader(\"Accept-Encoding\", \"gzip\")\n\nWith these two properties Elasticsearch will return a gzip compressed response body. The RestHighLevelClient can send a request with the above request options but it couldn't handle the response yet. This feature request contains the option to handle a compressed response if it is compressed with gzip.\nInitial changes for the RestHighLevelClient have been made within this pull request: #53533\nOriginal feature requests: #53555 and #24349\nThis pull request is an improvement on the initial pull request. The LowLevelRestClient will get the responsibility to handle a compressed response and therefor this feature will also be supported within the RestHighLevelClient.", "createdAt": "2020-04-17T17:33:47Z", "url": "https://github.com/elastic/elasticsearch/pull/55413", "merged": true, "mergeCommit": {"oid": "2621452473e0c236aa28db749f782a24eca6c974"}, "closed": true, "closedAt": "2020-05-15T13:28:01Z", "author": {"login": "Hakky54"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcYkiJugH2gAyNDA1MjU2NDMxOjdmNzYwZDU4MGIwNzRiMzMwYTE3ZTQ2MzJjYjJjZDUxZDJhMjE3NTQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABchf5BBgH2gAyNDA1MjU2NDMxOjE1YjQ5ZGQxNzQ5ODQ4OGUwNmFiZWUwYjk3NzEwNjdjYjZhMzkxNmU=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "7f760d580b074b330a17e4632cb2cd51d2a21754", "author": {"user": {"login": "Hakky54", "name": "Hakan Alt\u0131nda\u011f"}}, "url": "https://github.com/elastic/elasticsearch/commit/7f760d580b074b330a17e4632cb2cd51d2a21754", "committedDate": "2020-04-17T17:14:09Z", "message": "Reverted initial changes for supporting decompression within the rhlc"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1fc1e4de915208cd72b34c1cf16a5f4777ac5268", "author": {"user": {"login": "Hakky54", "name": "Hakan Alt\u0131nda\u011f"}}, "url": "https://github.com/elastic/elasticsearch/commit/1fc1e4de915208cd72b34c1cf16a5f4777ac5268", "committedDate": "2020-04-17T17:18:22Z", "message": "Added support for decompression at llrc and added integration test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "15d120199ac27c4510a55e7805707433d5486621", "author": {"user": {"login": "Hakky54", "name": "Hakan Alt\u0131nda\u011f"}}, "url": "https://github.com/elastic/elasticsearch/commit/15d120199ac27c4510a55e7805707433d5486621", "committedDate": "2020-04-17T17:22:17Z", "message": "Merge branch 'master' into feature-enable-decompression-of-response-within-llrc"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9816d841e7c156db9a6478648c8b6d62c282e06f", "author": {"user": {"login": "Hakky54", "name": "Hakan Alt\u0131nda\u011f"}}, "url": "https://github.com/elastic/elasticsearch/commit/9816d841e7c156db9a6478648c8b6d62c282e06f", "committedDate": "2020-04-17T22:26:04Z", "message": "Refactored a bit"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDExNzEyMTM1", "url": "https://github.com/elastic/elasticsearch/pull/55413#pullrequestreview-411712135", "createdAt": "2020-05-14T11:29:30Z", "commit": {"oid": "9816d841e7c156db9a6478648c8b6d62c282e06f"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNFQxMToyOTozMFrOGVX-jg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNFQxMTozMDowNlrOGVX_8Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTA2NjEyNg==", "bodyText": "shall we rename this to the existing test name testCompressesResponseIfRequested and delete the old version? (as this is more thorough as it's reading the body)", "url": "https://github.com/elastic/elasticsearch/pull/55413#discussion_r425066126", "createdAt": "2020-05-14T11:29:30Z", "author": {"login": "andreidan"}, "path": "qa/smoke-test-http/src/test/java/org/elasticsearch/http/HttpCompressionIT.java", "diffHunk": "@@ -57,6 +64,30 @@ public void testUncompressedResponseByDefault() throws IOException {\n         response = client().performRequest(request);\n         assertEquals(201, response.getStatusLine().getStatusCode());\n         assertNull(response.getHeader(HttpHeaders.CONTENT_ENCODING));\n+        assertThat(response.getEntity(), is(not(instanceOf(GzipDecompressingEntity.class))));\n+    }\n+\n+    public void testCompressesGetDocumentResponseIfRequested() throws IOException {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9816d841e7c156db9a6478648c8b6d62c282e06f"}, "originalPosition": 48}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTA2NjQ4MQ==", "bodyText": "these high level rest client decompression tests are still valid right?", "url": "https://github.com/elastic/elasticsearch/pull/55413#discussion_r425066481", "createdAt": "2020-05-14T11:30:06Z", "author": {"login": "andreidan"}, "path": "client/rest-high-level/src/test/java/org/elasticsearch/client/RestHighLevelClientTests.java", "diffHunk": "@@ -326,59 +322,6 @@ public void testParseEntity() throws IOException {\n         }\n     }\n \n-    public void testParseCompressedEntity() throws IOException {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9816d841e7c156db9a6478648c8b6d62c282e06f"}, "originalPosition": 33}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "90242743fe7b53aec1a328112211f59c2154abfd", "author": {"user": {"login": "Hakky54", "name": "Hakan Alt\u0131nda\u011f"}}, "url": "https://github.com/elastic/elasticsearch/commit/90242743fe7b53aec1a328112211f59c2154abfd", "committedDate": "2020-05-15T01:01:35Z", "message": "Applied feedback"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEyNTA1Njk3", "url": "https://github.com/elastic/elasticsearch/pull/55413#pullrequestreview-412505697", "createdAt": "2020-05-15T09:51:06Z", "commit": {"oid": "90242743fe7b53aec1a328112211f59c2154abfd"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "15b49dd17498488e06abee0b9771067cb6a3916e", "author": {"user": {"login": "Hakky54", "name": "Hakan Alt\u0131nda\u011f"}}, "url": "https://github.com/elastic/elasticsearch/commit/15b49dd17498488e06abee0b9771067cb6a3916e", "committedDate": "2020-05-15T10:54:55Z", "message": "Merge branch 'master' into feature-enable-decompression-of-response-within-llrc"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3302, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}