{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE2ODgwODk1", "number": 56627, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNVQxNTo1NzoxM1rOD87XGw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOFQyMTo0MzowMVrOD9j_Vw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY1MjEzNzIzOnYy", "diffSide": "RIGHT", "path": "buildSrc/reaper/build.gradle", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNVQxNTo1NzoxM1rOGWKqkA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNVQxNTo1NzoxM1rOGWKqkA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTg5NjU5Mg==", "bodyText": "fix deprecation warning on the way", "url": "https://github.com/elastic/elasticsearch/pull/56627#discussion_r425896592", "createdAt": "2020-05-15T15:57:13Z", "author": {"login": "breskeby"}, "path": "buildSrc/reaper/build.gradle", "diffHunk": "@@ -1,5 +1,5 @@\n jar {\n-  archiveName = \"${project.name}.jar\"\n+  archiveFileName = \"${project.name}.jar\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "85ee4b9d230e98b05bc66f5e8dacbe89330814d0"}, "originalPosition": 3}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY1ODc4MTgwOnYy", "diffSide": "RIGHT", "path": "build.gradle", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOFQyMTozODozM1rOGXIWnA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOVQwNzo0ODowNFrOGXT7zg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjkwNzI5Mg==", "bodyText": "Is this strictly beneficial since this task rule should only run when it finds a task matching this naming convention, right? Granted, it doesn't hurt, just wondering.", "url": "https://github.com/elastic/elasticsearch/pull/56627#discussion_r426907292", "createdAt": "2020-05-18T21:38:33Z", "author": {"login": "mark-vieira"}, "path": "build.gradle", "diffHunk": "@@ -485,7 +485,7 @@ allprojects {\n     if (realTask == null) {\n       return\n     }\n-    project.tasks.create(taskName) {\n+    project.tasks.register(taskName) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0e9464182278e486e5aba4c41cfa461eade3e33c"}, "originalPosition": 54}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzA5NzAzOA==", "bodyText": "In general I think we just should use register over create where possible. In a later step we need to revisit the actual behaviour and when they got materialised anyhow, but more on a per case fashion I think as thinks get complex there.\nThere are use cases where tasks in a rule would not be created but registered. You can depend on tasks that are created by a rule, e.g. you could have `myTask.dependsOn tasks.named(\"cleanCompileJava\"). The rule would kick in so the task would be registered, but it doesn't need to be created.", "url": "https://github.com/elastic/elasticsearch/pull/56627#discussion_r427097038", "createdAt": "2020-05-19T07:48:04Z", "author": {"login": "breskeby"}, "path": "build.gradle", "diffHunk": "@@ -485,7 +485,7 @@ allprojects {\n     if (realTask == null) {\n       return\n     }\n-    project.tasks.create(taskName) {\n+    project.tasks.register(taskName) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjkwNzI5Mg=="}, "originalCommit": {"oid": "0e9464182278e486e5aba4c41cfa461eade3e33c"}, "originalPosition": 54}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY1ODc4NTU1OnYy", "diffSide": "RIGHT", "path": "buildSrc/src/main/groovy/org/elasticsearch/gradle/test/AntFixture.groovy", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOFQyMTo0MDowMlrOGXIZEA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOVQxMzo1MTo0MVrOGXhcSA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjkwNzkyMA==", "bodyText": "nit: missing space stop.configure {", "url": "https://github.com/elastic/elasticsearch/pull/56627#discussion_r426907920", "createdAt": "2020-05-18T21:40:02Z", "author": {"login": "mark-vieira"}, "path": "buildSrc/src/main/groovy/org/elasticsearch/gradle/test/AntFixture.groovy", "diffHunk": "@@ -222,24 +224,29 @@ class AntFixture extends AntTask implements Fixture {\n     }\n \n     /** Adds a task to kill an elasticsearch node with the given pidfile */\n-    private Task createStopTask() {\n+    private TaskProvider createStopTask() {\n         final AntFixture fixture = this\n         final Object pid = \"${ -> fixture.pid }\"\n-        Exec stop = project.tasks.create(name: \"${name}#stop\", type: LoggedExec)\n-        stop.onlyIf { fixture.pidFile.exists() }\n-        stop.doFirst {\n-            logger.info(\"Shutting down ${fixture.name} with pid ${pid}\")\n-        }\n-        if (Os.isFamily(Os.FAMILY_WINDOWS)) {\n-            stop.executable = 'Taskkill'\n-            stop.args('/PID', pid, '/F')\n-        } else {\n-            stop.executable = 'kill'\n-            stop.args('-9', pid)\n-        }\n-        stop.doLast {\n-            project.delete(fixture.pidFile)\n+        TaskProvider<Exec> stop = project.tasks.register(\"${name}#stop\", LoggedExec)\n+        stop.configure{", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0e9464182278e486e5aba4c41cfa461eade3e33c"}, "originalPosition": 50}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzMxODM0NA==", "bodyText": "fixed", "url": "https://github.com/elastic/elasticsearch/pull/56627#discussion_r427318344", "createdAt": "2020-05-19T13:51:41Z", "author": {"login": "breskeby"}, "path": "buildSrc/src/main/groovy/org/elasticsearch/gradle/test/AntFixture.groovy", "diffHunk": "@@ -222,24 +224,29 @@ class AntFixture extends AntTask implements Fixture {\n     }\n \n     /** Adds a task to kill an elasticsearch node with the given pidfile */\n-    private Task createStopTask() {\n+    private TaskProvider createStopTask() {\n         final AntFixture fixture = this\n         final Object pid = \"${ -> fixture.pid }\"\n-        Exec stop = project.tasks.create(name: \"${name}#stop\", type: LoggedExec)\n-        stop.onlyIf { fixture.pidFile.exists() }\n-        stop.doFirst {\n-            logger.info(\"Shutting down ${fixture.name} with pid ${pid}\")\n-        }\n-        if (Os.isFamily(Os.FAMILY_WINDOWS)) {\n-            stop.executable = 'Taskkill'\n-            stop.args('/PID', pid, '/F')\n-        } else {\n-            stop.executable = 'kill'\n-            stop.args('-9', pid)\n-        }\n-        stop.doLast {\n-            project.delete(fixture.pidFile)\n+        TaskProvider<Exec> stop = project.tasks.register(\"${name}#stop\", LoggedExec)\n+        stop.configure{", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjkwNzkyMA=="}, "originalCommit": {"oid": "0e9464182278e486e5aba4c41cfa461eade3e33c"}, "originalPosition": 50}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY1ODc5MzgzOnYy", "diffSide": "RIGHT", "path": "plugins/repository-hdfs/build.gradle", "isResolved": false, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOFQyMTo0MzowMVrOGXIeNg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOVQxNDozMzo0M1rOGXjcHQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjkwOTIzOA==", "bodyText": "Should we just use create() then? This seems even more confusing.", "url": "https://github.com/elastic/elasticsearch/pull/56627#discussion_r426909238", "createdAt": "2020-05-18T21:43:01Z", "author": {"login": "mark-vieira"}, "path": "plugins/repository-hdfs/build.gradle", "diffHunk": "@@ -134,6 +134,10 @@ for (String fixtureName : ['hdfsFixture', 'haHdfsFixture', 'secureHdfsFixture',\n \n     args miniHDFSArgs.toArray()\n   }\n+\n+  // TODO: The task configuration block has side effects that require it currently to be always executed.\n+  // Otherwise tests start failing. Therefore we enforce the task creation for now.\n+  tsk.get()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0e9464182278e486e5aba4c41cfa461eade3e33c"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzA5NDExOQ==", "bodyText": "keeping create() might look like an oversight. I think this way makes it more explicit that there is something wrong with the task setup.", "url": "https://github.com/elastic/elasticsearch/pull/56627#discussion_r427094119", "createdAt": "2020-05-19T07:42:59Z", "author": {"login": "breskeby"}, "path": "plugins/repository-hdfs/build.gradle", "diffHunk": "@@ -134,6 +134,10 @@ for (String fixtureName : ['hdfsFixture', 'haHdfsFixture', 'secureHdfsFixture',\n \n     args miniHDFSArgs.toArray()\n   }\n+\n+  // TODO: The task configuration block has side effects that require it currently to be always executed.\n+  // Otherwise tests start failing. Therefore we enforce the task creation for now.\n+  tsk.get()", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjkwOTIzOA=="}, "originalCommit": {"oid": "0e9464182278e486e5aba4c41cfa461eade3e33c"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzMwODYyMA==", "bodyText": "Cool, let's create an issue to look into what the task configuration block is doing that's required for test setup.", "url": "https://github.com/elastic/elasticsearch/pull/56627#discussion_r427308620", "createdAt": "2020-05-19T13:38:05Z", "author": {"login": "mark-vieira"}, "path": "plugins/repository-hdfs/build.gradle", "diffHunk": "@@ -134,6 +134,10 @@ for (String fixtureName : ['hdfsFixture', 'haHdfsFixture', 'secureHdfsFixture',\n \n     args miniHDFSArgs.toArray()\n   }\n+\n+  // TODO: The task configuration block has side effects that require it currently to be always executed.\n+  // Otherwise tests start failing. Therefore we enforce the task creation for now.\n+  tsk.get()", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjkwOTIzOA=="}, "originalCommit": {"oid": "0e9464182278e486e5aba4c41cfa461eade3e33c"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzM1MTA2OQ==", "bodyText": "done here: #56948", "url": "https://github.com/elastic/elasticsearch/pull/56627#discussion_r427351069", "createdAt": "2020-05-19T14:33:43Z", "author": {"login": "breskeby"}, "path": "plugins/repository-hdfs/build.gradle", "diffHunk": "@@ -134,6 +134,10 @@ for (String fixtureName : ['hdfsFixture', 'haHdfsFixture', 'secureHdfsFixture',\n \n     args miniHDFSArgs.toArray()\n   }\n+\n+  // TODO: The task configuration block has side effects that require it currently to be always executed.\n+  // Otherwise tests start failing. Therefore we enforce the task creation for now.\n+  tsk.get()", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjkwOTIzOA=="}, "originalCommit": {"oid": "0e9464182278e486e5aba4c41cfa461eade3e33c"}, "originalPosition": 16}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 468, "cost": 1, "resetAt": "2021-11-12T11:57:46Z"}}}