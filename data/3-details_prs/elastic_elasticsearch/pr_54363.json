{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk0OTIwOTc0", "number": 54363, "title": "Refactor nodes stats request builders to match requests", "bodyText": "In #53637 and #53410, we refactored NodesInfoRequest and NodesStatsRequest to have a general interface for adding metrics to the request. Here, we refactor the corresponding builders to match this interface. The change has been straightforward, so I'm handling NodesInfoRequestBuilder and NodesStatsRequestBuilder in a single PR.", "createdAt": "2020-03-27T18:58:40Z", "url": "https://github.com/elastic/elasticsearch/pull/54363", "merged": true, "mergeCommit": {"oid": "d6d664cc7dbcaaf7fd3867282ca9c176cc1319b4"}, "closed": true, "closedAt": "2020-04-01T17:02:41Z", "author": {"login": "williamrandolph"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcRy-ScgH2gAyMzk0OTIwOTc0OjQ3MjgyNzY4M2M3NWVlNWMyODk2NzMwYWVhODhhOGMzNjdlMjc4NTQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcTZi0VAH2gAyMzk0OTIwOTc0OjMxMTQ3ZTI1ZDg5ODYzZjUzMDE2ZjFkZWIxMWJlY2IzMDc3ZTJiMDE=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "472827683c75ee5c2896730aea88a8c367e27854", "author": {"user": {"login": "williamrandolph", "name": "William Brafford"}}, "url": "https://github.com/elastic/elasticsearch/commit/472827683c75ee5c2896730aea88a8c367e27854", "committedDate": "2020-03-27T16:06:05Z", "message": "Remove hard-coded setters from NodesInfoRequestBuilder"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4e065ae3437ab6f9b506e230db9d28ff26feed27", "author": {"user": {"login": "williamrandolph", "name": "William Brafford"}}, "url": "https://github.com/elastic/elasticsearch/commit/4e065ae3437ab6f9b506e230db9d28ff26feed27", "committedDate": "2020-03-27T17:58:54Z", "message": "Remove hard-coded setters from NodesStatsRequest"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "521a6abe931882bdfca639ecd8ef836c707990a4", "author": {"user": {"login": "williamrandolph", "name": "William Brafford"}}, "url": "https://github.com/elastic/elasticsearch/commit/521a6abe931882bdfca639ecd8ef836c707990a4", "committedDate": "2020-03-27T19:53:03Z", "message": "Merge branch 'master' into nodes-info-stats-request-builder-refactor"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgzNzM4MjIz", "url": "https://github.com/elastic/elasticsearch/pull/54363#pullrequestreview-383738223", "createdAt": "2020-03-30T10:51:36Z", "commit": {"oid": "521a6abe931882bdfca639ecd8ef836c707990a4"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMFQxMDo1MTozN1rOF9kGdA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMFQxMDo1MTozN1rOF9kGdA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDA5ODkzMg==", "bodyText": "Not that it would save a lot of bytes, but what do you think about adding an override that takes a NodesStatsRequest.Metric?\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        .addMetric(NodesStatsRequest.Metric.INGEST.metricName())\n          \n          \n            \n                        .addMetric(NodesStatsRequest.Metric.INGEST)\n          \n      \n    \n    \n  \n\nThis would be a bit more type-safe at least?", "url": "https://github.com/elastic/elasticsearch/pull/54363#discussion_r400098932", "createdAt": "2020-03-30T10:51:37Z", "author": {"login": "pugnascotia"}, "path": "modules/ingest-common/src/test/java/org/elasticsearch/ingest/common/IngestRestartIT.java", "diffHunk": "@@ -95,7 +96,9 @@ public void testFailureInConditionalProcessor() {\n         );\n         assertTrue(e.getMessage().contains(\"this script always fails\"));\n \n-        NodesStatsResponse r = client().admin().cluster().prepareNodesStats(internalCluster().getNodeNames()).setIngest(true).get();\n+        NodesStatsResponse r = client().admin().cluster().prepareNodesStats(internalCluster().getNodeNames())\n+            .addMetric(NodesStatsRequest.Metric.INGEST.metricName())", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "521a6abe931882bdfca639ecd8ef836c707990a4"}, "originalPosition": 14}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgzNzQxMjE2", "url": "https://github.com/elastic/elasticsearch/pull/54363#pullrequestreview-383741216", "createdAt": "2020-03-30T10:56:06Z", "commit": {"oid": "521a6abe931882bdfca639ecd8ef836c707990a4"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "226ba9b8c1b78b64afb46a40154c8b02584e5de8", "author": {"user": {"login": "williamrandolph", "name": "William Brafford"}}, "url": "https://github.com/elastic/elasticsearch/commit/226ba9b8c1b78b64afb46a40154c8b02584e5de8", "committedDate": "2020-03-30T15:37:41Z", "message": "Use static imports to reduce clutter"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "31147e25d89863f53016f1deb11becb3077e2b01", "author": {"user": {"login": "williamrandolph", "name": "William Brafford"}}, "url": "https://github.com/elastic/elasticsearch/commit/31147e25d89863f53016f1deb11becb3077e2b01", "committedDate": "2020-04-01T15:36:18Z", "message": "Merge branch 'master' into nodes-info-stats-request-builder-refactor"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1458, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}