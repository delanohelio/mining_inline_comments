{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTMwNTk2MzM3", "number": 65707, "title": "Fix sneaky date_histogram bug", "bodyText": "date_histogram has a bug with offset and extended_bounds when it\nneeds to create an \"empty\" aggregation result: it includes the bounds\ntwice! Wooops!\nI broke this a while back when I started trying to merge offset into\nRounding. I never finished that merge, sadly. Interestingly, we've\ndiscovered that the merge is required to properly handle daylight\nsavings time (#56305) but it isn't really something we're looking to\nsolve today. For now, this just stops counting the offset twice.\nCloses #65624", "createdAt": "2020-12-01T21:50:14Z", "url": "https://github.com/elastic/elasticsearch/pull/65707", "merged": true, "mergeCommit": {"oid": "ecb4e16d35606fce92247a14e631912973825337"}, "closed": true, "closedAt": "2020-12-07T20:39:53Z", "author": {"login": "nik9000"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdiBD6FAH2gAyNTMwNTk2MzM3OmJiMDBjOTFiMTM0MjMyZmRhZDcyMmE4MWZiOGE0ODI1YjNhNGQ2YmU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdj5J5ZgH2gAyNTMwNTk2MzM3OjZjZWU0YTE2Mzc0YjNiZmZiMjUzOWJjYjRlMDExZDlhM2U2NTQ2NGM=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "bb00c91b134232fdad722a81fb8a4825b3a4d6be", "author": {"user": {"login": "nik9000", "name": "Nik Everett"}}, "url": "https://github.com/elastic/elasticsearch/commit/bb00c91b134232fdad722a81fb8a4825b3a4d6be", "committedDate": "2020-12-01T21:44:50Z", "message": "Fix sneaky date_histogram bug\n\n`date_histogram` has a bug with `offset` and `extended_bounds` when it\nneeds to create an \"empty\" aggregation result: it includes the bounds\ntwice! Wooops!\n\nI broke this a while back when I started trying to merge `offset` into\n`Rounding`. I never finished that merge, sadly. Interestingly, we've\ndiscovered that the merge is required to properly handle daylight\nsavings time (#56305) but it isn't really something we're looking to\nsolve today. For now, this just stops counting the offset twice.\n\nCloses #65624"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQzOTgyMDk4", "url": "https://github.com/elastic/elasticsearch/pull/65707#pullrequestreview-543982098", "createdAt": "2020-12-03T14:03:06Z", "commit": {"oid": "bb00c91b134232fdad722a81fb8a4825b3a4d6be"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wM1QxNDowMzowN1rOH-dJ9Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wM1QxNDowMzowN1rOH-dJ9Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTI1MTQ0NQ==", "bodyText": "This test needs a comment; it's a subtle bug, and it's not super clear how this test catches it.", "url": "https://github.com/elastic/elasticsearch/pull/65707#discussion_r535251445", "createdAt": "2020-12-03T14:03:07Z", "author": {"login": "not-napoleon"}, "path": "server/src/test/java/org/elasticsearch/search/aggregations/bucket/histogram/DateHistogramAggregatorTests.java", "diffHunk": "@@ -1235,6 +1235,19 @@ public void testIllegalInterval() throws IOException {\n         assertWarnings(\"[interval] on [date_histogram] is deprecated, use [fixed_interval] or [calendar_interval] in the future.\");\n     }\n \n+    public void testBuildEmpty() throws IOException {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bb00c91b134232fdad722a81fb8a4825b3a4d6be"}, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7efcad9a5940f0018fc78509193ae0f802d69b9b", "author": {"user": {"login": "nik9000", "name": "Nik Everett"}}, "url": "https://github.com/elastic/elasticsearch/commit/7efcad9a5940f0018fc78509193ae0f802d69b9b", "committedDate": "2020-12-07T17:38:14Z", "message": "Merge branch 'master' into empty_date_histo"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6cee4a16374b3bffb2539bcb4e011d9a3e65464c", "author": {"user": {"login": "nik9000", "name": "Nik Everett"}}, "url": "https://github.com/elastic/elasticsearch/commit/6cee4a16374b3bffb2539bcb4e011d9a3e65464c", "committedDate": "2020-12-07T17:39:59Z", "message": "Test fixup"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4228, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}