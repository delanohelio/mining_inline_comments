{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQxMDQzNzYz", "number": 58639, "title": "Move MappedFieldType#getSearchAnalyzer and #getSearchQuoteAnalyzer to TextSearchInfo", "bodyText": "Analyzers are specific to text searching, and so should be in TextSearchInfo rather than on\nthe generic MappedFieldType.", "createdAt": "2020-06-28T11:35:50Z", "url": "https://github.com/elastic/elasticsearch/pull/58639", "merged": true, "mergeCommit": {"oid": "3944066e9926b26b3a5fe367651eb30d711e0caf"}, "closed": true, "closedAt": "2020-07-01T12:16:03Z", "author": {"login": "romseygeek"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcuxptJAH2gAyNDQxMDQzNzYzOjBlMzliZmI4ZDdkN2NjYTExM2QyZTlhNzIyNjk0Y2RkZjhkMmE1Y2M=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcwnXIygH2gAyNDQxMDQzNzYzOjgzNzc0MTlmMWVlM2IzYzMwMGI2MGJkYWYwNWNlNjcyMWJkZjM3ZTg=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "0e39bfb8d7d7cca113d2e9a722694cddf8d2a5cc", "author": {"user": {"login": "romseygeek", "name": "Alan Woodward"}}, "url": "https://github.com/elastic/elasticsearch/commit/0e39bfb8d7d7cca113d2e9a722694cddf8d2a5cc", "committedDate": "2020-06-25T16:57:30Z", "message": "Move search-time analyzers from MappedFieldType to TextSearchInfo"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "81284822cc07e7b0c21807eca7da4c79e0962da0", "author": {"user": {"login": "romseygeek", "name": "Alan Woodward"}}, "url": "https://github.com/elastic/elasticsearch/commit/81284822cc07e7b0c21807eca7da4c79e0962da0", "committedDate": "2020-06-28T11:23:42Z", "message": "Merge remote-tracking branch 'origin/master' into mapper/search-analyzers"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "92b416fbe2d21cc78886ee7e083693a02e9ed480", "author": {"user": {"login": "romseygeek", "name": "Alan Woodward"}}, "url": "https://github.com/elastic/elasticsearch/commit/92b416fbe2d21cc78886ee7e083693a02e9ed480", "committedDate": "2020-06-29T12:59:59Z", "message": "Merge remote-tracking branch 'origin/master' into mapper/search-analyzers"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "93ea4a26b34d5c743532d5ba8a501f00542c5597", "author": {"user": {"login": "romseygeek", "name": "Alan Woodward"}}, "url": "https://github.com/elastic/elasticsearch/commit/93ea4a26b34d5c743532d5ba8a501f00542c5597", "committedDate": "2020-06-29T13:53:19Z", "message": "tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ddfaeec9afdff0554db9158423d5d5336faca001", "author": {"user": {"login": "romseygeek", "name": "Alan Woodward"}}, "url": "https://github.com/elastic/elasticsearch/commit/ddfaeec9afdff0554db9158423d5d5336faca001", "committedDate": "2020-06-29T14:35:43Z", "message": "tests"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM5MjIzNTE0", "url": "https://github.com/elastic/elasticsearch/pull/58639#pullrequestreview-439223514", "createdAt": "2020-06-29T14:51:08Z", "commit": {"oid": "ddfaeec9afdff0554db9158423d5d5336faca001"}, "state": "COMMENTED", "comments": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yOVQxNDo1MTowOVrOGqUoOA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yOVQxNToxOTo1NFrOGqV6TQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzAzMTM1Mg==", "bodyText": "Could you comment on why you zapped these?", "url": "https://github.com/elastic/elasticsearch/pull/58639#discussion_r447031352", "createdAt": "2020-06-29T14:51:09Z", "author": {"login": "nik9000"}, "path": "modules/mapper-extras/src/test/java/org/elasticsearch/index/mapper/SearchAsYouTypeFieldMapperTests.java", "diffHunk": "@@ -669,21 +669,6 @@ public void testMatchPhrase() throws IOException {\n             assertThat(actual, equalTo(expected));\n         }\n \n-        // todo are these queries generated for the prefix field right?\n-        {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ddfaeec9afdff0554db9158423d5d5336faca001"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzAzNTc3Ng==", "bodyText": "If you are adding parameters like this you may as well run them through the formatter to save some diff when we apply it to everything one day.", "url": "https://github.com/elastic/elasticsearch/pull/58639#discussion_r447035776", "createdAt": "2020-06-29T14:56:57Z", "author": {"login": "nik9000"}, "path": "server/src/main/java/org/elasticsearch/index/mapper/CompletionFieldMapper.java", "diffHunk": "@@ -193,12 +194,17 @@ private NamedAnalyzer getNamedAnalyzer(ParserContext parserContext, String name)\n         private boolean preservePositionIncrements = Defaults.DEFAULT_POSITION_INCREMENTS;\n         private ContextMappings contextMappings = null;\n \n-        public CompletionFieldType(String name, FieldType luceneFieldType, Map<String, String> meta) {\n-            super(name, true, false, new TextSearchInfo(luceneFieldType, null), meta);\n+        public CompletionFieldType(String name, FieldType luceneFieldType,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ddfaeec9afdff0554db9158423d5d5336faca001"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzA0MTI1MQ==", "bodyText": "Will this change the behavior when includeDefaults is true and there isn't a search_analyzer? I'm not familiar enough with the default values of everything to know. I think it is a least worth a comment about it here.", "url": "https://github.com/elastic/elasticsearch/pull/58639#discussion_r447041251", "createdAt": "2020-06-29T15:04:32Z", "author": {"login": "nik9000"}, "path": "server/src/main/java/org/elasticsearch/index/mapper/FieldMapper.java", "diffHunk": "@@ -420,7 +420,7 @@ protected void doXContentBody(XContentBuilder builder, boolean includeDefaults,\n     }\n \n     protected final void doXContentAnalyzers(XContentBuilder builder, boolean includeDefaults) throws IOException {\n-        if (fieldType.tokenized() == false) {\n+        if (fieldType.tokenized() == false || fieldType().getTextSearchInfo().getSearchAnalyzer() == null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ddfaeec9afdff0554db9158423d5d5336faca001"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzA0MzU1Nw==", "bodyText": "Should TestSearchInfo be in equals and hashCode?", "url": "https://github.com/elastic/elasticsearch/pull/58639#discussion_r447043557", "createdAt": "2020-06-29T15:07:38Z", "author": {"login": "nik9000"}, "path": "server/src/main/java/org/elasticsearch/index/mapper/MappedFieldType.java", "diffHunk": "@@ -119,15 +115,13 @@ public boolean equals(Object o) {\n             docValues == fieldType.docValues &&\n             Objects.equals(name, fieldType.name) &&\n             Objects.equals(indexAnalyzer, fieldType.indexAnalyzer) &&\n-            Objects.equals(searchAnalyzer, fieldType.searchAnalyzer) &&\n-            Objects.equals(searchQuoteAnalyzer(), fieldType.searchQuoteAnalyzer()) &&\n             Objects.equals(eagerGlobalOrdinals, fieldType.eagerGlobalOrdinals) &&\n             Objects.equals(meta, fieldType.meta);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ddfaeec9afdff0554db9158423d5d5336faca001"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzA0NTgzMA==", "bodyText": "Should we be able to change the search_analyzer like this?", "url": "https://github.com/elastic/elasticsearch/pull/58639#discussion_r447045830", "createdAt": "2020-06-29T15:10:49Z", "author": {"login": "nik9000"}, "path": "server/src/main/java/org/elasticsearch/index/mapper/KeywordFieldMapper.java", "diffHunk": "@@ -439,7 +426,6 @@ protected void mergeOptions(FieldMapper other, List<String> conflicts) {\n         }\n         this.ignoreAbove = k.ignoreAbove;\n         this.splitQueriesOnWhitespace = k.splitQueriesOnWhitespace;\n-        this.fieldType().setSearchAnalyzer(k.fieldType().searchAnalyzer());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ddfaeec9afdff0554db9158423d5d5336faca001"}, "originalPosition": 80}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzA0NzQwMw==", "bodyText": "I generally feat protected mutable variables. What's up with this?", "url": "https://github.com/elastic/elasticsearch/pull/58639#discussion_r447047403", "createdAt": "2020-06-29T15:13:02Z", "author": {"login": "nik9000"}, "path": "server/src/main/java/org/elasticsearch/index/mapper/TextFieldMapper.java", "diffHunk": "@@ -129,7 +130,7 @@\n         private double fielddataMinFreq = Defaults.FIELDDATA_MIN_FREQUENCY;\n         private double fielddataMaxFreq = Defaults.FIELDDATA_MAX_FREQUENCY;\n         private int fielddataMinSegSize = Defaults.FIELDDATA_MIN_SEGMENT_SIZE;\n-        private SimilarityProvider similarity;\n+        protected SimilarityProvider similarity;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ddfaeec9afdff0554db9158423d5d5336faca001"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzA0ODExOA==", "bodyText": "I get that this is the builder, but do we plan to extend it or something? Everything else manages to be private which makes me less nervous.", "url": "https://github.com/elastic/elasticsearch/pull/58639#discussion_r447048118", "createdAt": "2020-06-29T15:14:04Z", "author": {"login": "nik9000"}, "path": "server/src/main/java/org/elasticsearch/index/mapper/TextFieldMapper.java", "diffHunk": "@@ -129,7 +130,7 @@\n         private double fielddataMinFreq = Defaults.FIELDDATA_MIN_FREQUENCY;\n         private double fielddataMaxFreq = Defaults.FIELDDATA_MAX_FREQUENCY;\n         private int fielddataMinSegSize = Defaults.FIELDDATA_MIN_SEGMENT_SIZE;\n-        private SimilarityProvider similarity;\n+        protected SimilarityProvider similarity;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzA0NzQwMw=="}, "originalCommit": {"oid": "ddfaeec9afdff0554db9158423d5d5336faca001"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzA0ODU4Mg==", "bodyText": "Probably worth javadoc on this one too.", "url": "https://github.com/elastic/elasticsearch/pull/58639#discussion_r447048582", "createdAt": "2020-06-29T15:14:43Z", "author": {"login": "nik9000"}, "path": "server/src/main/java/org/elasticsearch/index/mapper/TextSearchInfo.java", "diffHunk": "@@ -40,15 +42,22 @@\n      *\n      * Note that the results of {@link #isStored()} for this may not be accurate\n      */\n-    public static final TextSearchInfo SIMPLE_MATCH_ONLY = new TextSearchInfo(SIMPLE_MATCH_ONLY_FIELD_TYPE, null);\n+    public static final TextSearchInfo SIMPLE_MATCH_ONLY\n+        = new TextSearchInfo(SIMPLE_MATCH_ONLY_FIELD_TYPE, null, Lucene.KEYWORD_ANALYZER, Lucene.KEYWORD_ANALYZER);\n+\n+    public static final TextSearchInfo WHITESPACE_MATCH_ONLY", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ddfaeec9afdff0554db9158423d5d5336faca001"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzA1MDAwMQ==", "bodyText": "I think we used to be able to change these.", "url": "https://github.com/elastic/elasticsearch/pull/58639#discussion_r447050001", "createdAt": "2020-06-29T15:16:39Z", "author": {"login": "nik9000"}, "path": "server/src/test/java/org/elasticsearch/index/mapper/KeywordFieldTypeTests.java", "diffHunk": "@@ -55,28 +52,6 @@\n \n public class KeywordFieldTypeTests extends FieldTypeTestCase<KeywordFieldType> {\n \n-    @Before\n-    public void addModifiers() {\n-        addModifier(t -> {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ddfaeec9afdff0554db9158423d5d5336faca001"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzA1MTQ5OA==", "bodyText": "Nice to see that gone!", "url": "https://github.com/elastic/elasticsearch/pull/58639#discussion_r447051498", "createdAt": "2020-06-29T15:18:39Z", "author": {"login": "nik9000"}, "path": "server/src/test/java/org/elasticsearch/search/suggest/AbstractSuggestionBuilderTestCase.java", "diffHunk": "@@ -161,19 +162,10 @@ public void testBuild() throws IOException {\n                     indexSettings);\n             MapperService mapperService = mock(MapperService.class);\n             ScriptService scriptService = mock(ScriptService.class);\n-            MappedFieldType fieldType = mockFieldType(suggestionBuilder.field());\n             boolean fieldTypeSearchAnalyzerSet = randomBoolean();\n-            if (fieldTypeSearchAnalyzerSet) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ddfaeec9afdff0554db9158423d5d5336faca001"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzA1MjM2NQ==", "bodyText": "Should we still test these on string fields?", "url": "https://github.com/elastic/elasticsearch/pull/58639#discussion_r447052365", "createdAt": "2020-06-29T15:19:54Z", "author": {"login": "nik9000"}, "path": "test/framework/src/main/java/org/elasticsearch/index/mapper/FieldTypeTestCase.java", "diffHunk": "@@ -51,26 +48,6 @@\n             copy.setBoost(t.boost() + 1);\n             return (T) copy;\n         },\n-        t -> {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ddfaeec9afdff0554db9158423d5d5336faca001"}, "originalPosition": 14}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "496ab61b7d13677e43e87658ae034b8daf4ffe50", "author": {"user": {"login": "romseygeek", "name": "Alan Woodward"}}, "url": "https://github.com/elastic/elasticsearch/commit/496ab61b7d13677e43e87658ae034b8daf4ffe50", "committedDate": "2020-06-30T10:06:14Z", "message": "feedback"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ba5c9ea90f9bf026e17a1db01532f300a0204652", "author": {"user": {"login": "romseygeek", "name": "Alan Woodward"}}, "url": "https://github.com/elastic/elasticsearch/commit/ba5c9ea90f9bf026e17a1db01532f300a0204652", "committedDate": "2020-06-30T10:07:39Z", "message": "Merge remote-tracking branch 'origin/master' into mapper/search-analyzers"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f572c5f4e4aa90e6fe7409fd3e05030a20b2021f", "author": {"user": {"login": "romseygeek", "name": "Alan Woodward"}}, "url": "https://github.com/elastic/elasticsearch/commit/f572c5f4e4aa90e6fe7409fd3e05030a20b2021f", "committedDate": "2020-06-30T10:58:07Z", "message": "default searchanalyzer"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQwMzM5NjAx", "url": "https://github.com/elastic/elasticsearch/pull/58639#pullrequestreview-440339601", "createdAt": "2020-06-30T19:56:15Z", "commit": {"oid": "f572c5f4e4aa90e6fe7409fd3e05030a20b2021f"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8377419f1ee3b3c300b60bdaf05ce6721bdf37e8", "author": {"user": {"login": "elasticmachine", "name": "Elastic Machine"}}, "url": "https://github.com/elastic/elasticsearch/commit/8377419f1ee3b3c300b60bdaf05ce6721bdf37e8", "committedDate": "2020-07-01T10:06:01Z", "message": "Merge branch 'master' into mapper/search-analyzers"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2517, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}