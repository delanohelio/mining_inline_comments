{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA4NzU5NzY1", "number": 55753, "title": "Scripting: Deprecate general cache settings", "bodyText": "Deprecate settings:\n\nscript.cache.max_size in favor of script.context.$CONTEXT.cache_max_size\nscript.cache.expire in favor of script.context.$CONTEXT.cache_expire\nscript.max_compilations_rate in favor of script.context.$CONTEXT.max_compilations_rate\n\nDefault to context cache.\nAdd script.disable_max_compilations_rate, default false to totally disable compilation rates.  This setting is intended for integration tests.\nRefs: #50152\nBackport: bd64da0", "createdAt": "2020-04-24T20:51:45Z", "url": "https://github.com/elastic/elasticsearch/pull/55753", "merged": true, "mergeCommit": {"oid": "88e8b34fc2d672060a82979cb782b8cf491a3985"}, "closed": true, "closedAt": "2020-06-16T19:07:00Z", "author": {"login": "stu-elastic"}, "timelineItems": {"totalCount": 17, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcaiIongH2gAyNDA4NzU5NzY1OmVmNTQzYjAyNmU4ZWRlNjBmYWE3NTcwMTc5ZDBkZGY2OTkxMTM1OGI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcr47BxgH2gAyNDA4NzU5NzY1OjZlZWUzYmI5NjkwOGQ0NWJkMTVmMDZiMGNlY2I4YmQ1OTAzZTIwNmM=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "ef543b026e8ede60faa7570179d0ddf69911358b", "author": {"user": {"login": "stu-elastic", "name": "Stuart Tettemer"}}, "url": "https://github.com/elastic/elasticsearch/commit/ef543b026e8ede60faa7570179d0ddf69911358b", "committedDate": "2020-04-23T19:34:19Z", "message": "Scripting: Deprecate general cache settings (#55038)\n\n* Test: don't modify defaultConfig on upgrade"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cd28c33ec2f03bd4259033f57859b19dd4bfd92d", "author": {"user": {"login": "stu-elastic", "name": "Stuart Tettemer"}}, "url": "https://github.com/elastic/elasticsearch/commit/cd28c33ec2f03bd4259033f57859b19dd4bfd92d", "committedDate": "2020-04-24T20:37:19Z", "message": "Add deprecation api and docs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "35eed33c8b20469b2b7592c2a2ff366b54b37e78", "author": {"user": {"login": "stu-elastic", "name": "Stuart Tettemer"}}, "url": "https://github.com/elastic/elasticsearch/commit/35eed33c8b20469b2b7592c2a2ff366b54b37e78", "committedDate": "2020-04-24T20:49:02Z", "message": "Revert bad merge in docker-compose.yml"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e31eed3b0d25c61c64aa334e70f1a6761aa43180", "author": {"user": {"login": "stu-elastic", "name": "Stuart Tettemer"}}, "url": "https://github.com/elastic/elasticsearch/commit/e31eed3b0d25c61c64aa334e70f1a6761aa43180", "committedDate": "2020-04-24T20:50:48Z", "message": "Breaking changes formatting"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "261167370f493e8ebccb5ae925935dcbf6493779", "author": {"user": {"login": "stu-elastic", "name": "Stuart Tettemer"}}, "url": "https://github.com/elastic/elasticsearch/commit/261167370f493e8ebccb5ae925935dcbf6493779", "committedDate": "2020-04-30T16:27:22Z", "message": "Fix up deprecation tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "edcfdeb7fda1401446bcae1f2cfb98a4e35184b8", "author": {"user": {"login": "stu-elastic", "name": "Stuart Tettemer"}}, "url": "https://github.com/elastic/elasticsearch/commit/edcfdeb7fda1401446bcae1f2cfb98a4e35184b8", "committedDate": "2020-04-30T17:30:20Z", "message": "Remove unused import and edit long line in ScriptCacheTests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9760d5053a4aca5291bedb394e0cf25449c7ea4b", "author": {"user": {"login": "stu-elastic", "name": "Stuart Tettemer"}}, "url": "https://github.com/elastic/elasticsearch/commit/9760d5053a4aca5291bedb394e0cf25449c7ea4b", "committedDate": "2020-05-04T20:03:11Z", "message": "Merge branch '7.x' of github.com:elastic/elasticsearch into 7.x-fix/50152-painless-limit-per-context__05__deprecate"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2b3aa6b12fb1b38dbb7f0108de52994770606d0a", "author": {"user": {"login": "stu-elastic", "name": "Stuart Tettemer"}}, "url": "https://github.com/elastic/elasticsearch/commit/2b3aa6b12fb1b38dbb7f0108de52994770606d0a", "committedDate": "2020-05-04T20:28:21Z", "message": "[[ -> <<"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c6b5df20e59d75fba0c330e3437cb20cde87d5aa", "author": {"user": {"login": "stu-elastic", "name": "Stuart Tettemer"}}, "url": "https://github.com/elastic/elasticsearch/commit/c6b5df20e59d75fba0c330e3437cb20cde87d5aa", "committedDate": "2020-05-04T20:35:41Z", "message": "Painless contexts is in another book"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b9cb8597570b72f4d3ff0564f53aeee07eb0b129", "author": {"user": {"login": "stu-elastic", "name": "Stuart Tettemer"}}, "url": "https://github.com/elastic/elasticsearch/commit/b9cb8597570b72f4d3ff0564f53aeee07eb0b129", "committedDate": "2020-06-15T20:38:12Z", "message": "Merge branch '7.x' of github.com:elastic/elasticsearch into 7.x-fix/50152-painless-limit-per-context__05__deprecate"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "eab6df7ffae29ccaf4d14f73e92f54d683442b84", "author": {"user": {"login": "stu-elastic", "name": "Stuart Tettemer"}}, "url": "https://github.com/elastic/elasticsearch/commit/eab6df7ffae29ccaf4d14f73e92f54d683442b84", "committedDate": "2020-06-15T21:38:16Z", "message": "Change to 7.9 in docs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a5e1f4fd70e070c73c4c379bd1b344ac56711a55", "author": {"user": {"login": "stu-elastic", "name": "Stuart Tettemer"}}, "url": "https://github.com/elastic/elasticsearch/commit/a5e1f4fd70e070c73c4c379bd1b344ac56711a55", "committedDate": "2020-06-15T22:37:55Z", "message": "Issue typo in docs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8e587326f5791422151a58944f1504d964250171", "author": {"user": {"login": "stu-elastic", "name": "Stuart Tettemer"}}, "url": "https://github.com/elastic/elasticsearch/commit/8e587326f5791422151a58944f1504d964250171", "committedDate": "2020-06-15T23:05:38Z", "message": "Merge branch '7.x' of github.com:elastic/elasticsearch into 7.x-fix/50152-painless-limit-per-context__05__deprecate"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMxNTk0Nzcy", "url": "https://github.com/elastic/elasticsearch/pull/55753#pullrequestreview-431594772", "createdAt": "2020-06-16T14:57:53Z", "commit": {"oid": "8e587326f5791422151a58944f1504d964250171"}, "state": "APPROVED", "comments": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQxNDo1Nzo1M1rOGkfgBA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQxNToxMToyN1rOGkgIRQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDkxODAyMA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            For example, for the `update` context, use `script.context.update.context_max_size`.\n          \n          \n            \n            For example, for the `update` context, use `script.context.update.cache_expire`.", "url": "https://github.com/elastic/elasticsearch/pull/55753#discussion_r440918020", "createdAt": "2020-06-16T14:57:53Z", "author": {"login": "jrodewig"}, "path": "docs/reference/migration/migrate_7_9.asciidoc", "diffHunk": "@@ -0,0 +1,71 @@\n+[[breaking-changes-7.9]]\n+== Breaking changes in 7.9\n+++++\n+<titleabbrev>7.9</titleabbrev>\n+++++\n+\n+This section discusses the changes that you need to be aware of when migrating\n+your application to {es} 7.9.\n+\n+See also <<release-highlights>> and <<es-release-notes>>.\n+\n+* <<breaking_79_script_cache_changes>>\n+\n+//NOTE: The notable-breaking-changes tagged regions are re-used in the\n+//Installation and Upgrade Guide\n+\n+//tag::notable-breaking-changes[]\n+[discrete]\n+[[breaking_79_script_cache_changes]]\n+=== Script cache changes\n+[[deprecate_general_script_cache_size]]\n+.The `script.cache.max_size` setting is deprecated.\n+\n+[%collapsible]\n+====\n+*Details* +\n+The `script.cache.max_size` setting is deprecated. In {es} 8.0.0, this is\n+set per-context.\n+\n+*Impact* +\n+To avoid deprecation warnings, discontinue use of the `script.cache.max_size`\n+setting. You may use `script.context.$CONTEXT.context_max_size` for the particular context.\n+For example, for the `ingest` context, use `script.context.ingest.context_max_size`.\n+\n+====\n+\n+[discrete]\n+[[deprecate_general_script_expire]]\n+.The `script.cache.expire` setting is deprecated.\n+\n+[%collapsible]\n+====\n+*Details* +\n+The `script.cache.expire` setting is deprecated. In {es} 8.0.0, this is\n+set per-context.\n+\n+*Impact* +\n+To avoid deprecation warnings, discontinue use of the `script.cache.expire`\n+setting. You may use `script.context.$CONTEXT.cache_expire` for the particular context.\n+For example, for the `update` context, use `script.context.update.context_max_size`.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8e587326f5791422151a58944f1504d964250171"}, "originalPosition": 50}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDkyMDk4Mw==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            `script.context.processor_conditional.context_max_size`.\n          \n          \n            \n            `script.context.processor_conditional.max_compilations_rate`.", "url": "https://github.com/elastic/elasticsearch/pull/55753#discussion_r440920983", "createdAt": "2020-06-16T15:01:37Z", "author": {"login": "jrodewig"}, "path": "docs/reference/migration/migrate_7_9.asciidoc", "diffHunk": "@@ -0,0 +1,71 @@\n+[[breaking-changes-7.9]]\n+== Breaking changes in 7.9\n+++++\n+<titleabbrev>7.9</titleabbrev>\n+++++\n+\n+This section discusses the changes that you need to be aware of when migrating\n+your application to {es} 7.9.\n+\n+See also <<release-highlights>> and <<es-release-notes>>.\n+\n+* <<breaking_79_script_cache_changes>>\n+\n+//NOTE: The notable-breaking-changes tagged regions are re-used in the\n+//Installation and Upgrade Guide\n+\n+//tag::notable-breaking-changes[]\n+[discrete]\n+[[breaking_79_script_cache_changes]]\n+=== Script cache changes\n+[[deprecate_general_script_cache_size]]\n+.The `script.cache.max_size` setting is deprecated.\n+\n+[%collapsible]\n+====\n+*Details* +\n+The `script.cache.max_size` setting is deprecated. In {es} 8.0.0, this is\n+set per-context.\n+\n+*Impact* +\n+To avoid deprecation warnings, discontinue use of the `script.cache.max_size`\n+setting. You may use `script.context.$CONTEXT.context_max_size` for the particular context.\n+For example, for the `ingest` context, use `script.context.ingest.context_max_size`.\n+\n+====\n+\n+[discrete]\n+[[deprecate_general_script_expire]]\n+.The `script.cache.expire` setting is deprecated.\n+\n+[%collapsible]\n+====\n+*Details* +\n+The `script.cache.expire` setting is deprecated. In {es} 8.0.0, this is\n+set per-context.\n+\n+*Impact* +\n+To avoid deprecation warnings, discontinue use of the `script.cache.expire`\n+setting. You may use `script.context.$CONTEXT.cache_expire` for the particular context.\n+For example, for the `update` context, use `script.context.update.context_max_size`.\n+\n+====\n+\n+[discrete]\n+[[deprecate_general_script_compile_rate]]\n+.The `script.max_compilations_rate` setting is deprecated.\n+\n+[%collapsible]\n+====\n+*Details* +\n+The `script.max_compilations_rate` setting is deprecated. In {es} 8.0.0, this is\n+set per-context.\n+\n+*Impact* +\n+To avoid deprecation warnings, discontinue use of the `script.max_compilations_rate`\n+setting. You may use `script.context.$CONTEXT.max_compilations_rate` for the particular\n+context.  For example, for the `processor_conditional` context, use\n+`script.context.processor_conditional.context_max_size`.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8e587326f5791422151a58944f1504d964250171"}, "originalPosition": 68}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDkyNjAxNA==", "bodyText": "As this is empty, I don't think we need to add it. I believe the release-notes/highlights.asciidoc file is intended to now take the place of this file.\n@debadair may have more context.", "url": "https://github.com/elastic/elasticsearch/pull/55753#discussion_r440926014", "createdAt": "2020-06-16T15:08:26Z", "author": {"login": "jrodewig"}, "path": "docs/reference/release-notes/highlights-7.9.0.asciidoc", "diffHunk": "@@ -0,0 +1,13 @@\n+[[release-highlights-7.9.0]]\n+== 7.9.0 release highlights\n+++++\n+<titleabbrev>7.9.0</titleabbrev>\n+++++\n+\n+coming[7.9.0]\n+//NOTE: The notable-highlights tagged regions are re-used in the\n+//Installation and Upgrade Guide\n+\n+// tag::notable-highlights[]\n+\n+// end::notable-highlights[]", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8e587326f5791422151a58944f1504d964250171"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDkyNjIzMA==", "bodyText": "Extra space\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            <<release-notes-{elasticsearch_version}, Release notes >>  and\n          \n          \n            \n            <<release-notes-{elasticsearch_version}, Release notes >> and", "url": "https://github.com/elastic/elasticsearch/pull/55753#discussion_r440926230", "createdAt": "2020-06-16T15:08:43Z", "author": {"login": "jrodewig"}, "path": "docs/reference/release-notes/highlights.asciidoc", "diffHunk": "@@ -3,16 +3,16 @@\n \n coming[{minor-version}]\n \n-Here are the highlights of what's new and improved in {es} {minor-version}! \n+Here are the highlights of what's new and improved in {es} {minor-version}!\n ifeval::[\"{release-state}\"!=\"unreleased\"]\n-For detailed information about this release, see the \n-<<release-notes-{elasticsearch_version}, Release notes >>  and \n+For detailed information about this release, see the\n+<<release-notes-{elasticsearch_version}, Release notes >>  and", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8e587326f5791422151a58944f1504d964250171"}, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDkyNzc3Mw==", "bodyText": "Adds period and comma.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            `script.context.$CONTEXT.max_compilations_rate` eg.\n          \n          \n            \n            `script.context.field.max_compilations_rate=100/10m`.\n          \n          \n            \n            `script.context.$CONTEXT.max_compilations_rate` e.g.,\n          \n          \n            \n            `script.context.field.max_compilations_rate=100/10m`.", "url": "https://github.com/elastic/elasticsearch/pull/55753#discussion_r440927773", "createdAt": "2020-06-16T15:10:50Z", "author": {"login": "jrodewig"}, "path": "docs/reference/scripting/using.asciidoc", "diffHunk": "@@ -98,9 +98,11 @@ second version is only compiled once.\n \n If you compile too many unique scripts within a small amount of time,\n Elasticsearch will reject the new dynamic scripts with a\n-`circuit_breaking_exception` error. By default, up to 15 inline scripts per\n-minute will be compiled. You can change this setting dynamically by setting\n-`script.max_compilations_rate`.\n+`circuit_breaking_exception` error. By default, up to 75 scripts per\n+5 minutes will be compiled for most contexts and 375 scripts per 5 minutes\n+for ingest contexts. You can change these settings dynamically by setting\n+`script.context.$CONTEXT.max_compilations_rate` eg.\n+`script.context.field.max_compilations_rate=100/10m`.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8e587326f5791422151a58944f1504d964250171"}, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDkyNzk2Nw==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            you can configure the size of this cache by using the \n          \n          \n            \n            you can configure the size of this cache using the", "url": "https://github.com/elastic/elasticsearch/pull/55753#discussion_r440927967", "createdAt": "2020-06-16T15:11:05Z", "author": {"login": "jrodewig"}, "path": "docs/reference/scripting/using.asciidoc", "diffHunk": "@@ -241,9 +243,10 @@ templating language]. See <<search-template>> for more information and examples.\n \n All scripts are cached by default so that they only need to be recompiled\n when updates occur. By default, scripts do not have a time-based expiration, but\n-you can change this behavior by using the `script.cache.expire` setting.\n-You can configure the size of this cache by using the `script.cache.max_size` setting.\n-By default, the cache size is `100`.\n+you can configure the size of this cache by using the ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8e587326f5791422151a58944f1504d964250171"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDkyODMyNQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            for ingest contexts. You can change these settings dynamically by setting\n          \n          \n            \n            for `ingest` contexts. You can change these settings dynamically by setting", "url": "https://github.com/elastic/elasticsearch/pull/55753#discussion_r440928325", "createdAt": "2020-06-16T15:11:27Z", "author": {"login": "jrodewig"}, "path": "docs/reference/scripting/using.asciidoc", "diffHunk": "@@ -98,9 +98,11 @@ second version is only compiled once.\n \n If you compile too many unique scripts within a small amount of time,\n Elasticsearch will reject the new dynamic scripts with a\n-`circuit_breaking_exception` error. By default, up to 15 inline scripts per\n-minute will be compiled. You can change this setting dynamically by setting\n-`script.max_compilations_rate`.\n+`circuit_breaking_exception` error. By default, up to 75 scripts per\n+5 minutes will be compiled for most contexts and 375 scripts per 5 minutes\n+for ingest contexts. You can change these settings dynamically by setting", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8e587326f5791422151a58944f1504d964250171"}, "originalPosition": 9}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3bf377ebab469c891e669014c4b2f6e98ad81a63", "author": {"user": {"login": "stu-elastic", "name": "Stuart Tettemer"}}, "url": "https://github.com/elastic/elasticsearch/commit/3bf377ebab469c891e669014c4b2f6e98ad81a63", "committedDate": "2020-06-16T15:52:17Z", "message": "Correct settings names in migration, rm extra spaces and articles"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMxNjUzOTEx", "url": "https://github.com/elastic/elasticsearch/pull/55753#pullrequestreview-431653911", "createdAt": "2020-06-16T15:53:17Z", "commit": {"oid": "8e587326f5791422151a58944f1504d964250171"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQxNTo1MzoxN1rOGkiG3w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQxNTo1MzoxN1rOGkiG3w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDk2MDczNQ==", "bodyText": "Consider making this a table. It might be easier to see the immediate differences, especially if we customize more contexts.", "url": "https://github.com/elastic/elasticsearch/pull/55753#discussion_r440960735", "createdAt": "2020-06-16T15:53:17Z", "author": {"login": "jdconrad"}, "path": "docs/reference/scripting/using.asciidoc", "diffHunk": "@@ -241,9 +243,10 @@ templating language]. See <<search-template>> for more information and examples.\n \n All scripts are cached by default so that they only need to be recompiled\n when updates occur. By default, scripts do not have a time-based expiration, but\n-you can change this behavior by using the `script.cache.expire` setting.\n-You can configure the size of this cache by using the `script.cache.max_size` setting.\n-By default, the cache size is `100`.\n+you can configure the size of this cache by using the \n+`script.context.$CONTEXT.cache_expire` setting.\n+By default, the cache size is `100` for all contexts except the `ingest` and the", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8e587326f5791422151a58944f1504d964250171"}, "originalPosition": 24}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6eee3bb96908d45bd15f06b0cecb8bd5903e206c", "author": {"user": {"login": "stu-elastic", "name": "Stuart Tettemer"}}, "url": "https://github.com/elastic/elasticsearch/commit/6eee3bb96908d45bd15f06b0cecb8bd5903e206c", "committedDate": "2020-06-16T17:43:59Z", "message": "Use cache size table"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 360, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}