{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDc3NjQ2ODAw", "number": 61833, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMlQwODowNToyOFrOEfVIcw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMlQwODowNjowMFrOEfVJjA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAxMjg3NTM5OnYy", "diffSide": "RIGHT", "path": "x-pack/plugin/src/test/resources/rest-api-spec/test/runtime_fields/90_loops.yml", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMlQwODowNToyOFrOHLijMg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMlQxMjo1NToyNVrOHLtv7A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTg2MjQ1MA==", "bodyText": "I am aware that splitting tests like this will cause more setup / tear down, yet I think it makes the tests less descriptive and targeted each one at their own specific goal.", "url": "https://github.com/elastic/elasticsearch/pull/61833#discussion_r481862450", "createdAt": "2020-09-02T08:05:28Z", "author": {"login": "javanna"}, "path": "x-pack/plugin/src/test/resources/rest-api-spec/test/runtime_fields/90_loops.yml", "diffHunk": "@@ -77,6 +116,16 @@ setup:\n              terms:\n                field: loose_loop\n \n+---\n+\"loose loop - sort\":\n+  - do:\n+      catch: '/Cyclic dependency detected while resolving runtime fields: loose_loop -> lla -> llb -> llc -> loose_loop/'\n+      search:\n+        index: sensor\n+        body:\n+          sort: loose_loop\n+---\n+\"loose loop - docvalue_fields\":", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4ec181ac2db182507bb3914fcd52fcd987ed89f2"}, "originalPosition": 84}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjA0NTkzMg==", "bodyText": "Makes sense to me. \ud83d\udc4d", "url": "https://github.com/elastic/elasticsearch/pull/61833#discussion_r482045932", "createdAt": "2020-09-02T12:55:25Z", "author": {"login": "nik9000"}, "path": "x-pack/plugin/src/test/resources/rest-api-spec/test/runtime_fields/90_loops.yml", "diffHunk": "@@ -77,6 +116,16 @@ setup:\n              terms:\n                field: loose_loop\n \n+---\n+\"loose loop - sort\":\n+  - do:\n+      catch: '/Cyclic dependency detected while resolving runtime fields: loose_loop -> lla -> llb -> llc -> loose_loop/'\n+      search:\n+        index: sensor\n+        body:\n+          sort: loose_loop\n+---\n+\"loose loop - docvalue_fields\":", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTg2MjQ1MA=="}, "originalCommit": {"oid": "4ec181ac2db182507bb3914fcd52fcd987ed89f2"}, "originalPosition": 84}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAxMjg3ODIwOnYy", "diffSide": "RIGHT", "path": "x-pack/plugin/src/test/resources/rest-api-spec/test/runtime_fields/90_loops.yml", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMlQwODowNjowMFrOHLilCg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMlQxMjo1NTo0MlrOHLtwpw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTg2MjkyMg==", "bodyText": "Note that there are no tests for queries, on purpose. They need to be fixed :)", "url": "https://github.com/elastic/elasticsearch/pull/61833#discussion_r481862922", "createdAt": "2020-09-02T08:06:00Z", "author": {"login": "javanna"}, "path": "x-pack/plugin/src/test/resources/rest-api-spec/test/runtime_fields/90_loops.yml", "diffHunk": "@@ -96,10 +147,56 @@ setup:\n              terms:\n                field: lla\n \n+---\n+\"Max chain depth - 5 is allowed\":\n+  - do:\n+      search:\n+        index: sensor\n+        body:\n+          sort: timestamp\n+          docvalue_fields: [over_max_depth_1]\n+\n+  - match: {hits.total.value: 1}\n+  - match: {hits.hits.0.fields.over_max_depth_1.0: test}\n+\n+---\n+\"Max chain depth - direct references are not counted\":\n   - do:\n-      catch: '/Cyclic dependency detected while resolving runtime fields: lla -> llb -> llc -> loose_loop -> lla/'\n       search:\n         index: sensor\n         body:\n           sort: timestamp\n-          docvalue_fields: [lla]\n+          docvalue_fields: [refs]\n+\n+  - match: {hits.total.value: 1}\n+  - match: {hits.hits.0.fields.refs.0: testtesttesttesta}\n+\n+---\n+\"Max chain depth - aggs\":\n+  - do:\n+      catch: '/Field requires resolving too many dependent fields: over_max_depth -> over_max_depth_1 -> over_max_depth_2 -> over_max_depth_3 -> over_max_depth_4 -> over_max_depth_5/'\n+      search:\n+        index: sensor\n+        body:\n+          sort: timestamp\n+          aggs:\n+            loop:\n+             terms:\n+               field: over_max_depth\n+---\n+\"Max chain depth - sort\":\n+  - do:\n+      catch: '/Field requires resolving too many dependent fields: over_max_depth -> over_max_depth_1 -> over_max_depth_2 -> over_max_depth_3 -> over_max_depth_4 -> over_max_depth_5/'\n+      search:\n+        index: sensor\n+        body:\n+          sort: over_max_depth\n+---\n+\"Max chain depth - docvalue_fields\":\n+  - do:\n+      catch: '/Field requires resolving too many dependent fields: over_max_depth -> over_max_depth_1 -> over_max_depth_2 -> over_max_depth_3 -> over_max_depth_4 -> over_max_depth_5/'\n+      search:\n+        index: sensor\n+        body:\n+          sort: timestamp\n+          docvalue_fields: [over_max_depth]", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4ec181ac2db182507bb3914fcd52fcd987ed89f2"}, "originalPosition": 155}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjA0NjExOQ==", "bodyText": "Yeah, I have this on my list but I keep getting distracted by shiny objects.", "url": "https://github.com/elastic/elasticsearch/pull/61833#discussion_r482046119", "createdAt": "2020-09-02T12:55:42Z", "author": {"login": "nik9000"}, "path": "x-pack/plugin/src/test/resources/rest-api-spec/test/runtime_fields/90_loops.yml", "diffHunk": "@@ -96,10 +147,56 @@ setup:\n              terms:\n                field: lla\n \n+---\n+\"Max chain depth - 5 is allowed\":\n+  - do:\n+      search:\n+        index: sensor\n+        body:\n+          sort: timestamp\n+          docvalue_fields: [over_max_depth_1]\n+\n+  - match: {hits.total.value: 1}\n+  - match: {hits.hits.0.fields.over_max_depth_1.0: test}\n+\n+---\n+\"Max chain depth - direct references are not counted\":\n   - do:\n-      catch: '/Cyclic dependency detected while resolving runtime fields: lla -> llb -> llc -> loose_loop -> lla/'\n       search:\n         index: sensor\n         body:\n           sort: timestamp\n-          docvalue_fields: [lla]\n+          docvalue_fields: [refs]\n+\n+  - match: {hits.total.value: 1}\n+  - match: {hits.hits.0.fields.refs.0: testtesttesttesta}\n+\n+---\n+\"Max chain depth - aggs\":\n+  - do:\n+      catch: '/Field requires resolving too many dependent fields: over_max_depth -> over_max_depth_1 -> over_max_depth_2 -> over_max_depth_3 -> over_max_depth_4 -> over_max_depth_5/'\n+      search:\n+        index: sensor\n+        body:\n+          sort: timestamp\n+          aggs:\n+            loop:\n+             terms:\n+               field: over_max_depth\n+---\n+\"Max chain depth - sort\":\n+  - do:\n+      catch: '/Field requires resolving too many dependent fields: over_max_depth -> over_max_depth_1 -> over_max_depth_2 -> over_max_depth_3 -> over_max_depth_4 -> over_max_depth_5/'\n+      search:\n+        index: sensor\n+        body:\n+          sort: over_max_depth\n+---\n+\"Max chain depth - docvalue_fields\":\n+  - do:\n+      catch: '/Field requires resolving too many dependent fields: over_max_depth -> over_max_depth_1 -> over_max_depth_2 -> over_max_depth_3 -> over_max_depth_4 -> over_max_depth_5/'\n+      search:\n+        index: sensor\n+        body:\n+          sort: timestamp\n+          docvalue_fields: [over_max_depth]", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTg2MjkyMg=="}, "originalCommit": {"oid": "4ec181ac2db182507bb3914fcd52fcd987ed89f2"}, "originalPosition": 155}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1832, "cost": 1, "resetAt": "2021-11-12T13:16:51Z"}}}