{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzU5NDUwMzUy", "number": 50639, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wNlQwODo1NTowMlrODV6r-Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOFQxMjowMDowM1rODWhVIQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI0MzA4MjE3OnYy", "diffSide": "RIGHT", "path": "test/framework/src/main/java/org/elasticsearch/cluster/coordination/AbstractCoordinatorTestCase.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wNlQwODo1NTowMlrOFaYPxw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOFQxMjowNDo0MFrOFbU6bQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzIwNDU1MQ==", "bodyText": "while not strictly part of the logic in this PR, this fixes the testCannotJoinClusterWithDifferentUUID test that was occasionally failing without this being properly implemented.", "url": "https://github.com/elastic/elasticsearch/pull/50639#discussion_r363204551", "createdAt": "2020-01-06T08:55:02Z", "author": {"login": "ywelsch"}, "path": "test/framework/src/main/java/org/elasticsearch/cluster/coordination/AbstractCoordinatorTestCase.java", "diffHunk": "@@ -740,12 +742,14 @@ public void close() {\n                     if (oldState.nodeEnvironment != null) {\n                         nodeEnvironment = oldState.nodeEnvironment;\n                         final MetaData updatedMetaData = adaptGlobalMetaData.apply(oldState.getLastAcceptedState().metaData());\n-                        if (updatedMetaData != oldState.getLastAcceptedState().metaData()) {\n-                            throw new AssertionError(\"TODO adapting persistent metadata is not supported yet\");\n-                        }\n                         final long updatedTerm = adaptCurrentTerm.apply(oldState.getCurrentTerm());\n-                        if (updatedTerm != oldState.getCurrentTerm()) {\n-                            throw new AssertionError(\"TODO adapting persistent current term is not supported yet\");\n+                        if (updatedMetaData != oldState.getLastAcceptedState().metaData() || updatedTerm != oldState.getCurrentTerm()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f695669393f94056f9b79b4b7152a0fd6541fe83"}, "originalPosition": 26}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDE5ODUwOQ==", "bodyText": "\ud83d\udc4d", "url": "https://github.com/elastic/elasticsearch/pull/50639#discussion_r364198509", "createdAt": "2020-01-08T12:04:40Z", "author": {"login": "DaveCTurner"}, "path": "test/framework/src/main/java/org/elasticsearch/cluster/coordination/AbstractCoordinatorTestCase.java", "diffHunk": "@@ -740,12 +742,14 @@ public void close() {\n                     if (oldState.nodeEnvironment != null) {\n                         nodeEnvironment = oldState.nodeEnvironment;\n                         final MetaData updatedMetaData = adaptGlobalMetaData.apply(oldState.getLastAcceptedState().metaData());\n-                        if (updatedMetaData != oldState.getLastAcceptedState().metaData()) {\n-                            throw new AssertionError(\"TODO adapting persistent metadata is not supported yet\");\n-                        }\n                         final long updatedTerm = adaptCurrentTerm.apply(oldState.getCurrentTerm());\n-                        if (updatedTerm != oldState.getCurrentTerm()) {\n-                            throw new AssertionError(\"TODO adapting persistent current term is not supported yet\");\n+                        if (updatedMetaData != oldState.getLastAcceptedState().metaData() || updatedTerm != oldState.getCurrentTerm()) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzIwNDU1MQ=="}, "originalCommit": {"oid": "f695669393f94056f9b79b4b7152a0fd6541fe83"}, "originalPosition": 26}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI0OTQxMzQ1OnYy", "diffSide": "RIGHT", "path": "server/src/main/java/org/elasticsearch/gateway/PersistedClusterStateService.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOFQxMjowMDowM1rOFbU0sQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOFQxMjowMDowM1rOFbU0sQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDE5NzA0MQ==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                public static void deleteAll(Path[] dataPaths) throws IOException {\n          \n          \n            \n                /**\n          \n          \n            \n                 * Remove all persisted cluster states from the given data paths, for use in tests. Should only be called when there is no open\n          \n          \n            \n                 * {@link Writer} on these paths.\n          \n          \n            \n                 */\n          \n          \n            \n                public static void deleteAll(Path[] dataPaths) throws IOException {", "url": "https://github.com/elastic/elasticsearch/pull/50639#discussion_r364197041", "createdAt": "2020-01-08T12:00:03Z", "author": {"login": "DaveCTurner"}, "path": "server/src/main/java/org/elasticsearch/gateway/PersistedClusterStateService.java", "diffHunk": "@@ -177,6 +178,12 @@ public Writer createWriter() throws IOException {\n         return new Writer(metaDataIndexWriters, nodeId, bigArrays);\n     }\n \n+    public static void deleteAll(Path[] dataPaths) throws IOException {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f695669393f94056f9b79b4b7152a0fd6541fe83"}, "originalPosition": 21}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4868, "cost": 1, "resetAt": "2021-11-12T19:05:54Z"}}}