{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTM0MTI0OTk1", "number": 65996, "title": "Track in-progress indexing operations", "bodyText": "Currently, our indexing pressure metrics only track the number of  \"bytes\"\nrelated to in-progress indexing requests. This commit introduces tracking of\nthe number of operations. Building out this metrics will add more information\nfor future monitoring and back-pressure.", "createdAt": "2020-12-08T05:12:44Z", "url": "https://github.com/elastic/elasticsearch/pull/65996", "merged": true, "mergeCommit": {"oid": "c76058d0b3ca1e14ce4126ff6eb2a68b741b90f0"}, "closed": true, "closedAt": "2020-12-08T19:49:57Z", "author": {"login": "tbrooks8"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABddjiXPgH2gAyNTM0MTI0OTk1OmNhYTM2YzYxYWQ5ZGY2OWIxMjY0OTlhOWJiNzU1YmI3NmM2ODNiZTQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdkOuNPgH2gAyNTM0MTI0OTk1OjBjNjU5MGJlMmFiMTUxOThhMjY1MGNkM2VmZDdiOTBkYWJkZDEyZTE=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "caa36c61ad9df69b126499a9bb755bb76c683be4", "author": {"user": {"login": "tbrooks8", "name": "Tim Brooks"}}, "url": "https://github.com/elastic/elasticsearch/commit/caa36c61ad9df69b126499a9bb755bb76c683be4", "committedDate": "2020-11-18T01:05:15Z", "message": "Changes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e12489a6e9271177d1b604cbc00c791337e5309b", "author": {"user": {"login": "tbrooks8", "name": "Tim Brooks"}}, "url": "https://github.com/elastic/elasticsearch/commit/e12489a6e9271177d1b604cbc00c791337e5309b", "committedDate": "2020-11-23T22:07:43Z", "message": "Merge remote-tracking branch 'upstream/master' into indexing_queue_lag"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6ef19b84e1c6d26c1e334f3f2ddcc6f8c322bcb0", "author": {"user": {"login": "tbrooks8", "name": "Tim Brooks"}}, "url": "https://github.com/elastic/elasticsearch/commit/6ef19b84e1c6d26c1e334f3f2ddcc6f8c322bcb0", "committedDate": "2020-11-24T17:06:25Z", "message": "Add ops"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dd2e0039b3e4c52133269634b89161cf5f21bdf1", "author": {"user": {"login": "tbrooks8", "name": "Tim Brooks"}}, "url": "https://github.com/elastic/elasticsearch/commit/dd2e0039b3e4c52133269634b89161cf5f21bdf1", "committedDate": "2020-12-01T23:46:16Z", "message": "Merge remote-tracking branch 'upstream/master' into indexing_queue_lag"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6430e5f178d371ac035d8ec16e163eae7eaa67db", "author": {"user": {"login": "tbrooks8", "name": "Tim Brooks"}}, "url": "https://github.com/elastic/elasticsearch/commit/6430e5f178d371ac035d8ec16e163eae7eaa67db", "committedDate": "2020-12-02T01:13:32Z", "message": "Changes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "618de9c04894a1c2d43512569a0c1b6f543ebd74", "author": {"user": {"login": "tbrooks8", "name": "Tim Brooks"}}, "url": "https://github.com/elastic/elasticsearch/commit/618de9c04894a1c2d43512569a0c1b6f543ebd74", "committedDate": "2020-12-08T00:01:26Z", "message": "Merge remote-tracking branch 'upstream/master' into indexing_queue_lag"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5c2eb2bbba5c86c73e07a9962e7e789fcd947880", "author": {"user": {"login": "tbrooks8", "name": "Tim Brooks"}}, "url": "https://github.com/elastic/elasticsearch/commit/5c2eb2bbba5c86c73e07a9962e7e789fcd947880", "committedDate": "2020-12-08T01:01:44Z", "message": "Changes"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ3MjkzNDMw", "url": "https://github.com/elastic/elasticsearch/pull/65996#pullrequestreview-547293430", "createdAt": "2020-12-08T14:36:22Z", "commit": {"oid": "5c2eb2bbba5c86c73e07a9962e7e789fcd947880"}, "state": "APPROVED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOFQxNDozNjoyMlrOIBf1yA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOFQxNToxMTo0NVrOIBiPpQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODQ0MTE2MA==", "bodyText": "This and its counterpart below looks unused.", "url": "https://github.com/elastic/elasticsearch/pull/65996#discussion_r538441160", "createdAt": "2020-12-08T14:36:22Z", "author": {"login": "henningandersen"}, "path": "server/src/main/java/org/elasticsearch/action/support/replication/TransportWriteAction.java", "diffHunk": "@@ -172,9 +182,11 @@ public static Location locationToSync(Location current, Location next) {\n     @Override\n     protected void shardOperationOnPrimary(\n             Request request, IndexShard primary, ActionListener<PrimaryResult<ReplicaRequest, Response>> listener) {\n+        final long enqueueTime = System.nanoTime();\n         threadPool.executor(executorFunction.apply(primary)).execute(new ActionRunnable<>(listener) {\n             @Override\n             protected void doRun() {\n+                final long queuedNanos = System.nanoTime() - enqueueTime;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5c2eb2bbba5c86c73e07a9962e7e789fcd947880"}, "originalPosition": 62}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODQ3NzE4NA==", "bodyText": "Can we remove this overload? Looks unused.", "url": "https://github.com/elastic/elasticsearch/pull/65996#discussion_r538477184", "createdAt": "2020-12-08T15:08:45Z", "author": {"login": "henningandersen"}, "path": "server/src/main/java/org/elasticsearch/index/stats/IndexingPressureStats.java", "diffHunk": "@@ -84,6 +100,22 @@ public IndexingPressureStats(long totalCombinedCoordinatingAndPrimaryBytes, long\n         this.primaryRejections = primaryRejections;\n         this.replicaRejections = replicaRejections;\n         this.memoryLimit = memoryLimit;\n+\n+        this.totalCoordinatingOps = totalCoordinatingOps;\n+        this.totalPrimaryOps = totalPrimaryOps;\n+        this.totalReplicaOps = totalReplicaOps;\n+        this.currentCoordinatingOps = currentCoordinatingOps;\n+        this.currentPrimaryOps = currentPrimaryOps;\n+        this.currentReplicaOps = currentReplicaOps;\n+    }\n+\n+    public IndexingPressureStats(long totalCombinedCoordinatingAndPrimaryBytes, long totalCoordinatingBytes, long totalPrimaryBytes,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5c2eb2bbba5c86c73e07a9962e7e789fcd947880"}, "originalPosition": 50}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODQ4MDU0OQ==", "bodyText": "Perhaps add a comment on these that we intend to expose these or something similar in the future in the x-content after experimentation.", "url": "https://github.com/elastic/elasticsearch/pull/65996#discussion_r538480549", "createdAt": "2020-12-08T15:11:45Z", "author": {"login": "henningandersen"}, "path": "server/src/main/java/org/elasticsearch/index/stats/IndexingPressureStats.java", "diffHunk": "@@ -46,6 +46,13 @@\n     private final long replicaRejections;\n     private final long memoryLimit;\n \n+    private final long totalCoordinatingOps;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5c2eb2bbba5c86c73e07a9962e7e789fcd947880"}, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9ef80c139829afce165122c00899f7d516ac3548", "author": {"user": {"login": "tbrooks8", "name": "Tim Brooks"}}, "url": "https://github.com/elastic/elasticsearch/commit/9ef80c139829afce165122c00899f7d516ac3548", "committedDate": "2020-12-08T17:24:24Z", "message": "review"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0c6590be2ab15198a2650cd3efd7b90dabdd12e1", "author": {"user": {"login": "tbrooks8", "name": "Tim Brooks"}}, "url": "https://github.com/elastic/elasticsearch/commit/0c6590be2ab15198a2650cd3efd7b90dabdd12e1", "committedDate": "2020-12-08T18:47:39Z", "message": "Merge remote-tracking branch 'upstream/master' into indexing_queue_lag"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4731, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}