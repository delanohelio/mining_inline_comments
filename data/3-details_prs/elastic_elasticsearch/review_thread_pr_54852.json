{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk5OTc1ODEz", "number": 54852, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wN1QxOToyMToxN1rODvtOhw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wN1QyMjo1Njo1M1rODvxW-w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUxMzUwNjYzOnYy", "diffSide": "RIGHT", "path": "buildSrc/src/main/java/org/elasticsearch/gradle/testclusters/ElasticsearchNode.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wN1QxOToyMToxN1rOGCSkug==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQxNjoxMTozMlrOGC2gQA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTA1NDY1MA==", "bodyText": "I think it could simplify some of the other code here if we just made this.modules a List<Provider<File>> and called module.getAsFile() here rather than having to do getAsFile() in a bunch of other places.", "url": "https://github.com/elastic/elasticsearch/pull/54852#discussion_r405054650", "createdAt": "2020-04-07T19:21:17Z", "author": {"login": "mark-vieira"}, "path": "buildSrc/src/main/java/org/elasticsearch/gradle/testclusters/ElasticsearchNode.java", "diffHunk": "@@ -267,13 +270,30 @@ public void plugin(URI plugin) {\n         this.plugins.add(plugin);\n     }\n \n+    @Override\n+    public void plugin(Provider<RegularFile> plugin) {\n+        this.plugin(() -> plugin.get().getAsFile().toURI());\n+    }\n+\n+    @Override\n+    public void plugin(URI plugin) {\n+        this.plugin(() -> plugin);\n+    }\n+\n     @Override\n     public void plugin(File plugin) {\n-        plugin(plugin.toURI());\n+        this.plugin(() -> plugin.toURI());\n     }\n \n     @Override\n     public void module(File module) {\n+        RegularFileProperty file = project.getObjects().fileProperty();\n+        file.fileValue(module);\n+        this.module(file);\n+    }\n+\n+    @Override\n+    public void module(Provider<RegularFile> module) {\n         this.modules.add(module);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b3068d11c6975222ee200c2857c0a4ab96c9b126"}, "originalPosition": 61}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTY0MzMyOA==", "bodyText": "Done.  (not exactly as stated, but the backing list is now a Provider<File> and a module.map(RegularFile::getAsFile) is used to lazily convert the type.", "url": "https://github.com/elastic/elasticsearch/pull/54852#discussion_r405643328", "createdAt": "2020-04-08T16:11:32Z", "author": {"login": "jakelandis"}, "path": "buildSrc/src/main/java/org/elasticsearch/gradle/testclusters/ElasticsearchNode.java", "diffHunk": "@@ -267,13 +270,30 @@ public void plugin(URI plugin) {\n         this.plugins.add(plugin);\n     }\n \n+    @Override\n+    public void plugin(Provider<RegularFile> plugin) {\n+        this.plugin(() -> plugin.get().getAsFile().toURI());\n+    }\n+\n+    @Override\n+    public void plugin(URI plugin) {\n+        this.plugin(() -> plugin);\n+    }\n+\n     @Override\n     public void plugin(File plugin) {\n-        plugin(plugin.toURI());\n+        this.plugin(() -> plugin.toURI());\n     }\n \n     @Override\n     public void module(File module) {\n+        RegularFileProperty file = project.getObjects().fileProperty();\n+        file.fileValue(module);\n+        this.module(file);\n+    }\n+\n+    @Override\n+    public void module(Provider<RegularFile> module) {\n         this.modules.add(module);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTA1NDY1MA=="}, "originalCommit": {"oid": "b3068d11c6975222ee200c2857c0a4ab96c9b126"}, "originalPosition": 61}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUxNDE4MzYzOnYy", "diffSide": "RIGHT", "path": "buildSrc/src/main/java/org/elasticsearch/gradle/testclusters/TestClusterConfiguration.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wN1QyMjo1Njo1M1rOGCZFvQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQxNjowOTozMFrOGC2bCA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTE2MTQwNQ==", "bodyText": "Why do we also need this Supplier variant? Seems inconsistent to have it for plugin but not module.", "url": "https://github.com/elastic/elasticsearch/pull/54852#discussion_r405161405", "createdAt": "2020-04-07T22:56:53Z", "author": {"login": "rjernst"}, "path": "buildSrc/src/main/java/org/elasticsearch/gradle/testclusters/TestClusterConfiguration.java", "diffHunk": "@@ -46,8 +48,14 @@\n \n     void plugin(File plugin);\n \n+    void plugin(Supplier<URI> plugin);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b3068d11c6975222ee200c2857c0a4ab96c9b126"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTE4NDA3Nw==", "bodyText": "Seems we do this so we can internally keep this as a List<Supplier<URI>>. I think we can ditch this and use Provider<URI> for the internal collection. Just do plugin.map(File::toURI) before adding it to the backing collection.", "url": "https://github.com/elastic/elasticsearch/pull/54852#discussion_r405184077", "createdAt": "2020-04-08T00:06:40Z", "author": {"login": "mark-vieira"}, "path": "buildSrc/src/main/java/org/elasticsearch/gradle/testclusters/TestClusterConfiguration.java", "diffHunk": "@@ -46,8 +48,14 @@\n \n     void plugin(File plugin);\n \n+    void plugin(Supplier<URI> plugin);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTE2MTQwNQ=="}, "originalCommit": {"oid": "b3068d11c6975222ee200c2857c0a4ab96c9b126"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTY0MTk5Mg==", "bodyText": "@rjernst / @mark-vieira  thanks - I removed the Supplier variant in favor of just the Gradle Provider (I introduced the supplier because I didn't realize I could create a Provider<URI>)\nI didn't need to use the .map here, but did to implement the conversion from RegularFile to File via the other comment.", "url": "https://github.com/elastic/elasticsearch/pull/54852#discussion_r405641992", "createdAt": "2020-04-08T16:09:30Z", "author": {"login": "jakelandis"}, "path": "buildSrc/src/main/java/org/elasticsearch/gradle/testclusters/TestClusterConfiguration.java", "diffHunk": "@@ -46,8 +48,14 @@\n \n     void plugin(File plugin);\n \n+    void plugin(Supplier<URI> plugin);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTE2MTQwNQ=="}, "originalCommit": {"oid": "b3068d11c6975222ee200c2857c0a4ab96c9b126"}, "originalPosition": 14}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1269, "cost": 1, "resetAt": "2021-11-12T11:57:46Z"}}}