{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc0NjA3Njcy", "number": 52298, "title": "Continue realizing sorting by aggregations", "bodyText": "This drops more of the instanceofs from AggregationPath. There are\nstill a couple in AggregationPath. And I ended up moving two into\nBucketsAggregator, but I think this is still an improvement!", "createdAt": "2020-02-13T00:21:07Z", "url": "https://github.com/elastic/elasticsearch/pull/52298", "merged": true, "mergeCommit": {"oid": "5659e72307e924e0e9453c9b25921cc8a2732107"}, "closed": true, "closedAt": "2020-02-21T22:02:04Z", "author": {"login": "nik9000"}, "timelineItems": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcDuXdrgH2gAyMzc0NjA3NjcyOmY4MmE2YTUyNmJlZTY0NjljODQ5ZTRhNDE3YjhkMzdlNmQ3NWRjN2E=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcGmVgvgFqTM2MjkxNTY3NQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "f82a6a526bee6469c849e4a417b8d37e6d75dc7a", "author": {"user": {"login": "nik9000", "name": "Nik Everett"}}, "url": "https://github.com/elastic/elasticsearch/commit/f82a6a526bee6469c849e4a417b8d37e6d75dc7a", "committedDate": "2020-02-12T22:49:07Z", "message": "Continue realizing sorting by aggregations\n\nThis drops more of the `instanceof`s from `AggregationPath`. There are\nstill a couple in `AggregationPath`. And I ended up moving two into\n`BucketsAggregator`, but I think this is still an improvement!"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU3ODgxNDA3", "url": "https://github.com/elastic/elasticsearch/pull/52298#pullrequestreview-357881407", "createdAt": "2020-02-13T00:21:47Z", "commit": {"oid": "f82a6a526bee6469c849e4a417b8d37e6d75dc7a"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xM1QwMDoyMTo0N1rOFpDKhg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xM1QwMDoyNDowNlrOFpDNAw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODU4Nzc4Mg==", "bodyText": "I'm not super thrilled about this, but it is how it used to work and I wanted to keep this change fairly contained.", "url": "https://github.com/elastic/elasticsearch/pull/52298#discussion_r378587782", "createdAt": "2020-02-13T00:21:47Z", "author": {"login": "nik9000"}, "path": "server/src/main/java/org/elasticsearch/search/aggregations/bucket/BucketsAggregator.java", "diffHunk": "@@ -163,4 +165,24 @@ public final void close() {\n         }\n     }\n \n+    @Override\n+    public Aggregator resolveSortPath(AggregationPath.PathElement next, Iterator<AggregationPath.PathElement> path) {\n+        if (this instanceof SingleBucketAggregator) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f82a6a526bee6469c849e4a417b8d37e6d75dc7a"}, "originalPosition": 19}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODU4ODQxOQ==", "bodyText": "I'm not super comfortable with this name, but I think it'll fall away in a followup change. When I dig into that last instanceof in resolveTopmostAggregator.", "url": "https://github.com/elastic/elasticsearch/pull/52298#discussion_r378588419", "createdAt": "2020-02-13T00:24:06Z", "author": {"login": "nik9000"}, "path": "server/src/main/java/org/elasticsearch/search/aggregations/Aggregator.java", "diffHunk": "@@ -91,6 +93,53 @@ public static boolean descendsFromBucketAggregator(Aggregator parent) {\n      */\n     public abstract Aggregator subAggregator(String name);\n \n+    /**\n+     * Resolve the next step of the sort path as though this aggregation\n+     * supported sorting. This is usually the \"first step\" when resolving\n+     * a sort path because most aggs that support sorting their buckets\n+     * aren't valid in the middle of a sort path.\n+     * <p>\n+     * For example, the {@code terms} aggs supports sorting its buckets, but\n+     * that sort path itself can't contain a different {@code terms}\n+     * aggregation.\n+     */\n+    public final Aggregator resolveSortPathOnValidAgg(AggregationPath.PathElement next, Iterator<AggregationPath.PathElement> path) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f82a6a526bee6469c849e4a417b8d37e6d75dc7a"}, "originalPosition": 26}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYyOTE1Njc1", "url": "https://github.com/elastic/elasticsearch/pull/52298#pullrequestreview-362915675", "createdAt": "2020-02-21T21:04:17Z", "commit": {"oid": "f82a6a526bee6469c849e4a417b8d37e6d75dc7a"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMVQyMTowNDoxN1rOFtEj0Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMVQyMTowNDoxN1rOFtEj0Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjgwNDk0NQ==", "bodyText": "\ud83d\udc4d", "url": "https://github.com/elastic/elasticsearch/pull/52298#discussion_r382804945", "createdAt": "2020-02-21T21:04:17Z", "author": {"login": "polyfractal"}, "path": "server/src/main/java/org/elasticsearch/search/aggregations/bucket/BucketsAggregator.java", "diffHunk": "@@ -163,4 +165,24 @@ public final void close() {\n         }\n     }\n \n+    @Override\n+    public Aggregator resolveSortPath(AggregationPath.PathElement next, Iterator<AggregationPath.PathElement> path) {\n+        if (this instanceof SingleBucketAggregator) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODU4Nzc4Mg=="}, "originalCommit": {"oid": "f82a6a526bee6469c849e4a417b8d37e6d75dc7a"}, "originalPosition": 19}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2451, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}