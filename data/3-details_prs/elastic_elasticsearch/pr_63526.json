{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTAxMDA0ODA1", "number": 63526, "title": "Bugfix in InternalOrder.CompoundOrder", "bodyText": "If the constructor InternalOrder.CompoundOrder was called with an empty\ncompoundOrder, then comparator() returned a comparator that would crash.\n(An alternative fix could be to ensure that comparators is always\nnonempty. However, checks such as (orders.size() >= 1) on line 388 and\nthe lack of any comment to the contrary suggest that it might be better\nto have code that works in the empty case too.)", "createdAt": "2020-10-10T16:47:59Z", "url": "https://github.com/elastic/elasticsearch/pull/63526", "merged": true, "mergeCommit": {"oid": "2e89e5dc67a20ccc62b9a90af87c0db664a3b80a"}, "closed": true, "closedAt": "2020-10-21T20:47:28Z", "author": {"login": "rgrig"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdRNlAWAH2gAyNTAxMDA0ODA1Ojk0ZjUxNzk5OGNlNmUzZGEzNDE4MzQ3ZDNhZDg4ZDVhN2VjMjIyMjY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdUx2HvgH2gAyNTAxMDA0ODA1OjFhMjUyODRiMTJkYTg3ODc0ZDkxYTA0ZjViZTQxNzE0OTQyMTczNWM=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "94f517998ce6e3da3418347d3ad88d5a7ec22226", "author": {"user": {"login": "rgrig", "name": "Radu Grigore"}}, "url": "https://github.com/elastic/elasticsearch/commit/94f517998ce6e3da3418347d3ad88d5a7ec22226", "committedDate": "2020-10-10T16:43:08Z", "message": "Bugfix in InternalOrder.CompoundOrder\n\nIf the constructor InternalOrder.CompoundOrder was called with an empty\ncompoundOrder, then comparator() returned a comparator that would crash.\n(An alternative fix could be to ensure that `comparators` is always\nnonempty. However, checks such as (orders.size() >= 1) on line 388 and\nthe lack of any comment to the contrary suggest that it might be better\nto have code that works in the empty case too.)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "70818166d09f9eecf997f48b21198680dc9fbec2", "author": {"user": {"login": "rgrig", "name": "Radu Grigore"}}, "url": "https://github.com/elastic/elasticsearch/commit/70818166d09f9eecf997f48b21198680dc9fbec2", "committedDate": "2020-10-20T18:27:42Z", "message": "Added a check in the constructor of CompoundOrder"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTEzMDI0NDg3", "url": "https://github.com/elastic/elasticsearch/pull/63526#pullrequestreview-513024487", "createdAt": "2020-10-20T18:36:30Z", "commit": {"oid": "70818166d09f9eecf997f48b21198680dc9fbec2"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMFQxODozNjozMFrOHlLzLA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMFQxODozNjozMFrOHlLzLA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODc1MjY4NA==", "bodyText": "Now that we're sure comparators will never be empty, do you think it is worth making these two changes?", "url": "https://github.com/elastic/elasticsearch/pull/63526#discussion_r508752684", "createdAt": "2020-10-20T18:36:30Z", "author": {"login": "nik9000"}, "path": "server/src/main/java/org/elasticsearch/search/aggregations/InternalOrder.java", "diffHunk": "@@ -185,25 +188,27 @@ public XContentBuilder toXContent(XContentBuilder builder, Params params) throws\n                     .map(oe -> oe.partiallyBuiltBucketComparator(ordinalReader, aggregator))\n                     .collect(toList());\n             return (lhs, rhs) -> {\n-                Iterator<Comparator<T>> itr = comparators.iterator();\n-                int result;\n-                do {\n-                    result = itr.next().compare(lhs, rhs);\n-                } while (result == 0 && itr.hasNext());\n-                return result;\n+                for (Comparator<T> c : comparators) {\n+                    int result = c.compare(lhs, rhs);\n+                    if (result != 0) {\n+                        return result;\n+                    }\n+                }\n+                return 0;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "70818166d09f9eecf997f48b21198680dc9fbec2"}, "originalPosition": 26}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTEzMDc4OTUx", "url": "https://github.com/elastic/elasticsearch/pull/63526#pullrequestreview-513078951", "createdAt": "2020-10-20T19:50:14Z", "commit": {"oid": "70818166d09f9eecf997f48b21198680dc9fbec2"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMFQxOTo1MDoxNFrOHlOeFA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMFQxOTo1MDoxNFrOHlOeFA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODc5NjQzNg==", "bodyText": "Yeah, I think this fine, sure. I'll keep it!", "url": "https://github.com/elastic/elasticsearch/pull/63526#discussion_r508796436", "createdAt": "2020-10-20T19:50:14Z", "author": {"login": "nik9000"}, "path": "server/src/main/java/org/elasticsearch/search/aggregations/InternalOrder.java", "diffHunk": "@@ -185,25 +188,27 @@ public XContentBuilder toXContent(XContentBuilder builder, Params params) throws\n                     .map(oe -> oe.partiallyBuiltBucketComparator(ordinalReader, aggregator))\n                     .collect(toList());\n             return (lhs, rhs) -> {\n-                Iterator<Comparator<T>> itr = comparators.iterator();\n-                int result;\n-                do {\n-                    result = itr.next().compare(lhs, rhs);\n-                } while (result == 0 && itr.hasNext());\n-                return result;\n+                for (Comparator<T> c : comparators) {\n+                    int result = c.compare(lhs, rhs);\n+                    if (result != 0) {\n+                        return result;\n+                    }\n+                }\n+                return 0;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODc1MjY4NA=="}, "originalCommit": {"oid": "70818166d09f9eecf997f48b21198680dc9fbec2"}, "originalPosition": 26}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b2987a7fdcfd76bfecf26b1a5a4932334d96ad03", "author": {"user": {"login": "elasticmachine", "name": "Elastic Machine"}}, "url": "https://github.com/elastic/elasticsearch/commit/b2987a7fdcfd76bfecf26b1a5a4932334d96ad03", "committedDate": "2020-10-21T13:05:39Z", "message": "Merge branch 'master' into master"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1be2800f8870eaec9434dde365955058d08566f0", "author": {"user": {"login": "rgrig", "name": "Radu Grigore"}}, "url": "https://github.com/elastic/elasticsearch/commit/1be2800f8870eaec9434dde365955058d08566f0", "committedDate": "2020-10-21T17:29:11Z", "message": "Removed unused import."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e2138675e2b8d0249670668785128691e0b4ebdc", "author": {"user": {"login": "rgrig", "name": "Radu Grigore"}}, "url": "https://github.com/elastic/elasticsearch/commit/e2138675e2b8d0249670668785128691e0b4ebdc", "committedDate": "2020-10-21T17:29:23Z", "message": "Merge branch 'master' of github.com:rgrig/elasticsearch"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1a25284b12da87874d91a04f5be417149421735c", "author": {"user": {"login": "elasticmachine", "name": "Elastic Machine"}}, "url": "https://github.com/elastic/elasticsearch/commit/1a25284b12da87874d91a04f5be417149421735c", "committedDate": "2020-10-21T18:40:11Z", "message": "Merge branch 'master' into master"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4285, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}