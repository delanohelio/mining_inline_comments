{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDc4NjgwMzEw", "number": 61922, "title": "[ML] Add new include flag to GET inference/<model_id> API for model training metadata", "bodyText": "Adds new flag include to the get trained models API\nThe flag initially has two valid values: definition, total_feature_importance.\nConsequently, the old include_model_definition flag is now deprecated.\nWhen total_feature_importance is included, the total_feature_importance field\nis included in the model metadata object.\nIncluding definition is the same as previously setting include_model_definition=true.", "createdAt": "2020-09-03T14:38:36Z", "url": "https://github.com/elastic/elasticsearch/pull/61922", "merged": true, "mergeCommit": {"oid": "fdb7b6d3b5e12dde8ddfd244204ca7026235f0cd"}, "closed": true, "closedAt": "2020-09-18T11:11:39Z", "author": {"login": "benwtrent"}, "timelineItems": {"totalCount": 22, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdFTHNwABqjM3MjU1NjQ0MjU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdJ5KgUgFqTQ5MTA0Mzk2OA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ece8df8f7da3a5f59aec188f9aa917ade683dbb9", "author": {"user": {"login": "benwtrent", "name": "Benjamin Trent"}}, "url": "https://github.com/elastic/elasticsearch/commit/ece8df8f7da3a5f59aec188f9aa917ade683dbb9", "committedDate": "2020-09-03T14:06:16Z", "message": "[ML] Add new inference/<model_id>/_metadata API for model training metadata"}, "afterCommit": {"oid": "eacc213f188a3290ae74768b43a8a190f647780d", "author": {"user": {"login": "benwtrent", "name": "Benjamin Trent"}}, "url": "https://github.com/elastic/elasticsearch/commit/eacc213f188a3290ae74768b43a8a190f647780d", "committedDate": "2020-09-03T16:22:46Z", "message": "[ML] Add new inference/<model_id>/_metadata API for model training metadata"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "eacc213f188a3290ae74768b43a8a190f647780d", "author": {"user": {"login": "benwtrent", "name": "Benjamin Trent"}}, "url": "https://github.com/elastic/elasticsearch/commit/eacc213f188a3290ae74768b43a8a190f647780d", "committedDate": "2020-09-03T16:22:46Z", "message": "[ML] Add new inference/<model_id>/_metadata API for model training metadata"}, "afterCommit": {"oid": "082aff666a315204940f5948110af398068b79f6", "author": {"user": {"login": "benwtrent", "name": "Benjamin Trent"}}, "url": "https://github.com/elastic/elasticsearch/commit/082aff666a315204940f5948110af398068b79f6", "committedDate": "2020-09-04T13:37:21Z", "message": "[ML] Add new inference/<model_id>/_metadata API for model training metadata"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "082aff666a315204940f5948110af398068b79f6", "author": {"user": {"login": "benwtrent", "name": "Benjamin Trent"}}, "url": "https://github.com/elastic/elasticsearch/commit/082aff666a315204940f5948110af398068b79f6", "committedDate": "2020-09-04T13:37:21Z", "message": "[ML] Add new inference/<model_id>/_metadata API for model training metadata"}, "afterCommit": {"oid": "19b0eb6056b0114fb5601049e186f4ab3497eeaf", "author": {"user": {"login": "benwtrent", "name": "Benjamin Trent"}}, "url": "https://github.com/elastic/elasticsearch/commit/19b0eb6056b0114fb5601049e186f4ab3497eeaf", "committedDate": "2020-09-04T13:50:24Z", "message": "[ML] Add new inference/<model_id>/_metadata API for model training metadata"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bfb390e4e4257c2337c5df0d820f70a50620bbb9", "author": {"user": {"login": "benwtrent", "name": "Benjamin Trent"}}, "url": "https://github.com/elastic/elasticsearch/commit/bfb390e4e4257c2337c5df0d820f70a50620bbb9", "committedDate": "2020-09-04T17:21:31Z", "message": "[ML] Add new inference/<model_id>/_metadata API for model training metadata"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "19b0eb6056b0114fb5601049e186f4ab3497eeaf", "author": {"user": {"login": "benwtrent", "name": "Benjamin Trent"}}, "url": "https://github.com/elastic/elasticsearch/commit/19b0eb6056b0114fb5601049e186f4ab3497eeaf", "committedDate": "2020-09-04T13:50:24Z", "message": "[ML] Add new inference/<model_id>/_metadata API for model training metadata"}, "afterCommit": {"oid": "bfb390e4e4257c2337c5df0d820f70a50620bbb9", "author": {"user": {"login": "benwtrent", "name": "Benjamin Trent"}}, "url": "https://github.com/elastic/elasticsearch/commit/bfb390e4e4257c2337c5df0d820f70a50620bbb9", "committedDate": "2020-09-04T17:21:31Z", "message": "[ML] Add new inference/<model_id>/_metadata API for model training metadata"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgyODczMDEw", "url": "https://github.com/elastic/elasticsearch/pull/61922#pullrequestreview-482873010", "createdAt": "2020-09-04T18:41:01Z", "commit": {"oid": "bfb390e4e4257c2337c5df0d820f70a50620bbb9"}, "state": "COMMENTED", "comments": {"totalCount": 15, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wNFQxODo0MTowMVrOHNYQhQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wNFQxOToyMzowOFrOHNZRIQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Mzc5MDk4MQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            A +{request}+ requires either a Trained Model ID, a comma-separated list of\n          \n          \n            \n            A +{request}+ requires either a trained model ID, a comma-separated list of", "url": "https://github.com/elastic/elasticsearch/pull/61922#discussion_r483790981", "createdAt": "2020-09-04T18:41:01Z", "author": {"login": "lcawl"}, "path": "docs/java-rest/high-level/ml/get-trained-models-metadata.asciidoc", "diffHunk": "@@ -0,0 +1,45 @@\n+--\n+:api: get-trained-models-metadata\n+:request: GetTrainedModelsMetadataRequest\n+:response: GetTrainedModelsMetadataResponse\n+--\n+[role=\"xpack\"]\n+[id=\"{upid}-{api}\"]\n+=== Get Trained Models Metadata API\n+\n+experimental[]\n+\n+Retrieves training metadata for one or more trained models.\n+The API accepts a +{request}+ object and returns a +{response}+.\n+\n+[id=\"{upid}-{api}-request\"]\n+==== Get Trained Models Metadata request\n+\n+A +{request}+ requires either a Trained Model ID, a comma-separated list of", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bfb390e4e4257c2337c5df0d820f70a50620bbb9"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Mzc5MTEyMQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            === Get Trained Models Metadata API\n          \n          \n            \n            === Get trained models metadata API", "url": "https://github.com/elastic/elasticsearch/pull/61922#discussion_r483791121", "createdAt": "2020-09-04T18:41:23Z", "author": {"login": "lcawl"}, "path": "docs/java-rest/high-level/ml/get-trained-models-metadata.asciidoc", "diffHunk": "@@ -0,0 +1,45 @@\n+--\n+:api: get-trained-models-metadata\n+:request: GetTrainedModelsMetadataRequest\n+:response: GetTrainedModelsMetadataResponse\n+--\n+[role=\"xpack\"]\n+[id=\"{upid}-{api}\"]\n+=== Get Trained Models Metadata API", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bfb390e4e4257c2337c5df0d820f70a50620bbb9"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Mzc5MTI0OA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            ==== Get Trained Models Metadata request\n          \n          \n            \n            ==== Get trained models metadata request", "url": "https://github.com/elastic/elasticsearch/pull/61922#discussion_r483791248", "createdAt": "2020-09-04T18:41:45Z", "author": {"login": "lcawl"}, "path": "docs/java-rest/high-level/ml/get-trained-models-metadata.asciidoc", "diffHunk": "@@ -0,0 +1,45 @@\n+--\n+:api: get-trained-models-metadata\n+:request: GetTrainedModelsMetadataRequest\n+:response: GetTrainedModelsMetadataResponse\n+--\n+[role=\"xpack\"]\n+[id=\"{upid}-{api}\"]\n+=== Get Trained Models Metadata API\n+\n+experimental[]\n+\n+Retrieves training metadata for one or more trained models.\n+The API accepts a +{request}+ object and returns a +{response}+.\n+\n+[id=\"{upid}-{api}-request\"]\n+==== Get Trained Models Metadata request", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bfb390e4e4257c2337c5df0d820f70a50620bbb9"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Mzc5MTc3Mw==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            IDs, or the special wildcard `_all` to get metadata for all Trained Models.\n          \n          \n            \n            IDs, or the special wildcard `_all` to get metadata for all trained models.", "url": "https://github.com/elastic/elasticsearch/pull/61922#discussion_r483791773", "createdAt": "2020-09-04T18:43:00Z", "author": {"login": "lcawl"}, "path": "docs/java-rest/high-level/ml/get-trained-models-metadata.asciidoc", "diffHunk": "@@ -0,0 +1,45 @@\n+--\n+:api: get-trained-models-metadata\n+:request: GetTrainedModelsMetadataRequest\n+:response: GetTrainedModelsMetadataResponse\n+--\n+[role=\"xpack\"]\n+[id=\"{upid}-{api}\"]\n+=== Get Trained Models Metadata API\n+\n+experimental[]\n+\n+Retrieves training metadata for one or more trained models.\n+The API accepts a +{request}+ object and returns a +{response}+.\n+\n+[id=\"{upid}-{api}-request\"]\n+==== Get Trained Models Metadata request\n+\n+A +{request}+ requires either a Trained Model ID, a comma-separated list of\n+IDs, or the special wildcard `_all` to get metadata for all Trained Models.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bfb390e4e4257c2337c5df0d820f70a50620bbb9"}, "originalPosition": 19}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Mzc5MjUwOA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            <1> Constructing a new GET request referencing an existing Trained Model\n          \n          \n            \n            <1> Constructing a new GET request referencing an existing trained model", "url": "https://github.com/elastic/elasticsearch/pull/61922#discussion_r483792508", "createdAt": "2020-09-04T18:44:52Z", "author": {"login": "lcawl"}, "path": "docs/java-rest/high-level/ml/get-trained-models-metadata.asciidoc", "diffHunk": "@@ -0,0 +1,45 @@\n+--\n+:api: get-trained-models-metadata\n+:request: GetTrainedModelsMetadataRequest\n+:response: GetTrainedModelsMetadataResponse\n+--\n+[role=\"xpack\"]\n+[id=\"{upid}-{api}\"]\n+=== Get Trained Models Metadata API\n+\n+experimental[]\n+\n+Retrieves training metadata for one or more trained models.\n+The API accepts a +{request}+ object and returns a +{response}+.\n+\n+[id=\"{upid}-{api}-request\"]\n+==== Get Trained Models Metadata request\n+\n+A +{request}+ requires either a Trained Model ID, a comma-separated list of\n+IDs, or the special wildcard `_all` to get metadata for all Trained Models.\n+\n+[\"source\",\"java\",subs=\"attributes,callouts,macros\"]\n+--------------------------------------------------\n+include-tagged::{doc-tests-file}[{api}-request]\n+--------------------------------------------------\n+<1> Constructing a new GET request referencing an existing Trained Model", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bfb390e4e4257c2337c5df0d820f70a50620bbb9"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Mzc5MjYyNQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            <3> Allow empty response if no Trained Models match the provided ID patterns.\n          \n          \n            \n            <3> Allow empty response if no trained models match the provided ID patterns.", "url": "https://github.com/elastic/elasticsearch/pull/61922#discussion_r483792625", "createdAt": "2020-09-04T18:45:10Z", "author": {"login": "lcawl"}, "path": "docs/java-rest/high-level/ml/get-trained-models-metadata.asciidoc", "diffHunk": "@@ -0,0 +1,45 @@\n+--\n+:api: get-trained-models-metadata\n+:request: GetTrainedModelsMetadataRequest\n+:response: GetTrainedModelsMetadataResponse\n+--\n+[role=\"xpack\"]\n+[id=\"{upid}-{api}\"]\n+=== Get Trained Models Metadata API\n+\n+experimental[]\n+\n+Retrieves training metadata for one or more trained models.\n+The API accepts a +{request}+ object and returns a +{response}+.\n+\n+[id=\"{upid}-{api}-request\"]\n+==== Get Trained Models Metadata request\n+\n+A +{request}+ requires either a Trained Model ID, a comma-separated list of\n+IDs, or the special wildcard `_all` to get metadata for all Trained Models.\n+\n+[\"source\",\"java\",subs=\"attributes,callouts,macros\"]\n+--------------------------------------------------\n+include-tagged::{doc-tests-file}[{api}-request]\n+--------------------------------------------------\n+<1> Constructing a new GET request referencing an existing Trained Model\n+<2> Set the paging parameters\n+<3> Allow empty response if no Trained Models match the provided ID patterns.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bfb390e4e4257c2337c5df0d820f70a50620bbb9"}, "originalPosition": 27}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Mzc5MjgzNA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                If false, an error will be thrown if no Trained Models match the\n          \n          \n            \n                If false, an error will be thrown if no trained models match the", "url": "https://github.com/elastic/elasticsearch/pull/61922#discussion_r483792834", "createdAt": "2020-09-04T18:45:41Z", "author": {"login": "lcawl"}, "path": "docs/java-rest/high-level/ml/get-trained-models-metadata.asciidoc", "diffHunk": "@@ -0,0 +1,45 @@\n+--\n+:api: get-trained-models-metadata\n+:request: GetTrainedModelsMetadataRequest\n+:response: GetTrainedModelsMetadataResponse\n+--\n+[role=\"xpack\"]\n+[id=\"{upid}-{api}\"]\n+=== Get Trained Models Metadata API\n+\n+experimental[]\n+\n+Retrieves training metadata for one or more trained models.\n+The API accepts a +{request}+ object and returns a +{response}+.\n+\n+[id=\"{upid}-{api}-request\"]\n+==== Get Trained Models Metadata request\n+\n+A +{request}+ requires either a Trained Model ID, a comma-separated list of\n+IDs, or the special wildcard `_all` to get metadata for all Trained Models.\n+\n+[\"source\",\"java\",subs=\"attributes,callouts,macros\"]\n+--------------------------------------------------\n+include-tagged::{doc-tests-file}[{api}-request]\n+--------------------------------------------------\n+<1> Constructing a new GET request referencing an existing Trained Model\n+<2> Set the paging parameters\n+<3> Allow empty response if no Trained Models match the provided ID patterns.\n+    If false, an error will be thrown if no Trained Models match the", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bfb390e4e4257c2337c5df0d820f70a50620bbb9"}, "originalPosition": 28}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Mzc5MzQ5NQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            for the requested Trained Model.\n          \n          \n            \n            for the requested trained model.", "url": "https://github.com/elastic/elasticsearch/pull/61922#discussion_r483793495", "createdAt": "2020-09-04T18:47:24Z", "author": {"login": "lcawl"}, "path": "docs/java-rest/high-level/ml/get-trained-models-metadata.asciidoc", "diffHunk": "@@ -0,0 +1,45 @@\n+--\n+:api: get-trained-models-metadata\n+:request: GetTrainedModelsMetadataRequest\n+:response: GetTrainedModelsMetadataResponse\n+--\n+[role=\"xpack\"]\n+[id=\"{upid}-{api}\"]\n+=== Get Trained Models Metadata API\n+\n+experimental[]\n+\n+Retrieves training metadata for one or more trained models.\n+The API accepts a +{request}+ object and returns a +{response}+.\n+\n+[id=\"{upid}-{api}-request\"]\n+==== Get Trained Models Metadata request\n+\n+A +{request}+ requires either a Trained Model ID, a comma-separated list of\n+IDs, or the special wildcard `_all` to get metadata for all Trained Models.\n+\n+[\"source\",\"java\",subs=\"attributes,callouts,macros\"]\n+--------------------------------------------------\n+include-tagged::{doc-tests-file}[{api}-request]\n+--------------------------------------------------\n+<1> Constructing a new GET request referencing an existing Trained Model\n+<2> Set the paging parameters\n+<3> Allow empty response if no Trained Models match the provided ID patterns.\n+    If false, an error will be thrown if no Trained Models match the\n+    ID patterns.\n+\n+include::../execution.asciidoc[]\n+\n+[id=\"{upid}-{api}-response\"]\n+==== Response\n+\n+The returned +{response}+ contains the metadata\n+for the requested Trained Model.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bfb390e4e4257c2337c5df0d820f70a50620bbb9"}, "originalPosition": 37}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Mzc5NDQzNw==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            NOTE: the Trained Model will only have training metadata if\n          \n          \n            \n            NOTE: The trained model has training metadata only if", "url": "https://github.com/elastic/elasticsearch/pull/61922#discussion_r483794437", "createdAt": "2020-09-04T18:49:47Z", "author": {"login": "lcawl"}, "path": "docs/java-rest/high-level/ml/get-trained-models-metadata.asciidoc", "diffHunk": "@@ -0,0 +1,45 @@\n+--\n+:api: get-trained-models-metadata\n+:request: GetTrainedModelsMetadataRequest\n+:response: GetTrainedModelsMetadataResponse\n+--\n+[role=\"xpack\"]\n+[id=\"{upid}-{api}\"]\n+=== Get Trained Models Metadata API\n+\n+experimental[]\n+\n+Retrieves training metadata for one or more trained models.\n+The API accepts a +{request}+ object and returns a +{response}+.\n+\n+[id=\"{upid}-{api}-request\"]\n+==== Get Trained Models Metadata request\n+\n+A +{request}+ requires either a Trained Model ID, a comma-separated list of\n+IDs, or the special wildcard `_all` to get metadata for all Trained Models.\n+\n+[\"source\",\"java\",subs=\"attributes,callouts,macros\"]\n+--------------------------------------------------\n+include-tagged::{doc-tests-file}[{api}-request]\n+--------------------------------------------------\n+<1> Constructing a new GET request referencing an existing Trained Model\n+<2> Set the paging parameters\n+<3> Allow empty response if no Trained Models match the provided ID patterns.\n+    If false, an error will be thrown if no Trained Models match the\n+    ID patterns.\n+\n+include::../execution.asciidoc[]\n+\n+[id=\"{upid}-{api}-response\"]\n+==== Response\n+\n+The returned +{response}+ contains the metadata\n+for the requested Trained Model.\n+\n+NOTE: the Trained Model will only have training metadata if", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bfb390e4e4257c2337c5df0d820f70a50620bbb9"}, "originalPosition": 39}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Mzc5NTczMQ==", "bodyText": "in the current cluster by data frame analytics.\n\nIs the point here that (a) the training must have occurred in the same cluster, or/and (b) the training must have been done by us? I think there's a clearer way of saying this, depending on the intention.", "url": "https://github.com/elastic/elasticsearch/pull/61922#discussion_r483795731", "createdAt": "2020-09-04T18:52:56Z", "author": {"login": "lcawl"}, "path": "docs/java-rest/high-level/ml/get-trained-models-metadata.asciidoc", "diffHunk": "@@ -0,0 +1,45 @@\n+--\n+:api: get-trained-models-metadata\n+:request: GetTrainedModelsMetadataRequest\n+:response: GetTrainedModelsMetadataResponse\n+--\n+[role=\"xpack\"]\n+[id=\"{upid}-{api}\"]\n+=== Get Trained Models Metadata API\n+\n+experimental[]\n+\n+Retrieves training metadata for one or more trained models.\n+The API accepts a +{request}+ object and returns a +{response}+.\n+\n+[id=\"{upid}-{api}-request\"]\n+==== Get Trained Models Metadata request\n+\n+A +{request}+ requires either a Trained Model ID, a comma-separated list of\n+IDs, or the special wildcard `_all` to get metadata for all Trained Models.\n+\n+[\"source\",\"java\",subs=\"attributes,callouts,macros\"]\n+--------------------------------------------------\n+include-tagged::{doc-tests-file}[{api}-request]\n+--------------------------------------------------\n+<1> Constructing a new GET request referencing an existing Trained Model\n+<2> Set the paging parameters\n+<3> Allow empty response if no Trained Models match the provided ID patterns.\n+    If false, an error will be thrown if no Trained Models match the\n+    ID patterns.\n+\n+include::../execution.asciidoc[]\n+\n+[id=\"{upid}-{api}-response\"]\n+==== Response\n+\n+The returned +{response}+ contains the metadata\n+for the requested Trained Model.\n+\n+NOTE: the Trained Model will only have training metadata if\n+it was trained in the current cluster by data frame analytics.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bfb390e4e4257c2337c5df0d820f70a50620bbb9"}, "originalPosition": 40}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Mzc5ODMxOA==", "bodyText": "I don't know the history of why \"inference\" is used here but not in the client doc, but unless there's a strong reason for keeping it here, I'd vote for removing it:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            = Get {infer} trained model metadata API\n          \n          \n            \n            = Get trained model metadata API", "url": "https://github.com/elastic/elasticsearch/pull/61922#discussion_r483798318", "createdAt": "2020-09-04T18:59:27Z", "author": {"login": "lcawl"}, "path": "docs/reference/ml/df-analytics/apis/get-inference-trained-model-metadata.asciidoc", "diffHunk": "@@ -0,0 +1,736 @@\n+[role=\"xpack\"]\n+[testenv=\"basic\"]\n+[[get-inference-metadata]]\n+= Get {infer} trained model metadata API", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bfb390e4e4257c2337c5df0d820f70a50620bbb9"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzgwMjUzNA==", "bodyText": "This is another case where I'm not sure why we need \"inference\".\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            Retrieves training metadata information for trained {infer} models.\n          \n          \n            \n            Retrieves training metadata information for trained models.", "url": "https://github.com/elastic/elasticsearch/pull/61922#discussion_r483802534", "createdAt": "2020-09-04T19:10:15Z", "author": {"login": "lcawl"}, "path": "docs/reference/ml/df-analytics/apis/get-inference-trained-model-metadata.asciidoc", "diffHunk": "@@ -0,0 +1,736 @@\n+[role=\"xpack\"]\n+[testenv=\"basic\"]\n+[[get-inference-metadata]]\n+= Get {infer} trained model metadata API\n+[subs=\"attributes\"]\n+++++\n+<titleabbrev>Get {infer} trained model metadata</titleabbrev>\n+++++\n+\n+Retrieves training metadata information for trained {infer} models.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bfb390e4e4257c2337c5df0d820f70a50620bbb9"}, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzgwNDUxNQ==", "bodyText": "I think this can be shortened:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            You can get training metadata information for multiple trained models in a single API\n          \n          \n            \n            You can get metadata for multiple trained models in a single API", "url": "https://github.com/elastic/elasticsearch/pull/61922#discussion_r483804515", "createdAt": "2020-09-04T19:15:41Z", "author": {"login": "lcawl"}, "path": "docs/reference/ml/df-analytics/apis/get-inference-trained-model-metadata.asciidoc", "diffHunk": "@@ -0,0 +1,736 @@\n+[role=\"xpack\"]\n+[testenv=\"basic\"]\n+[[get-inference-metadata]]\n+= Get {infer} trained model metadata API\n+[subs=\"attributes\"]\n+++++\n+<titleabbrev>Get {infer} trained model metadata</titleabbrev>\n+++++\n+\n+Retrieves training metadata information for trained {infer} models.\n+\n+experimental[]\n+\n+\n+[[ml-get-inference-metadata-request]]\n+== {api-request-title}\n+\n+`GET _ml/inference/_metadata` +\n+\n+`GET _ml/inference/_all/_metadata` +\n+\n+`GET _ml/inference/<model_id>/_metadata` +\n+\n+`GET _ml/inference/<model_id>,<model_id_2>/_metadata` +\n+\n+`GET _ml/inference/<model_id_pattern*>,<model_id_2>/_metadata`\n+\n+\n+[[ml-get-inference-metadata-prereq]]\n+== {api-prereq-title}\n+\n+If the {es} {security-features} are enabled, you must have the following\n+privileges:\n+\n+* cluster: `monitor_ml`\n+\n+For more information, see <<security-privileges>> and {ml-docs-setup-privileges}.\n+\n+[[ml-get-inference-metadata-desc]]\n+== {api-description-title}\n+\n+You can get training metadata information for multiple trained models in a single API", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bfb390e4e4257c2337c5df0d820f70a50620bbb9"}, "originalPosition": 42}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzgwNjE5MQ==", "bodyText": "allow_no_match ...\n\nI don't think you can use this shared definition, since it's referring to jobs, not models. I notice the same problem in other APIs, so I'll create that missing definition in a separate PR.", "url": "https://github.com/elastic/elasticsearch/pull/61922#discussion_r483806191", "createdAt": "2020-09-04T19:19:55Z", "author": {"login": "lcawl"}, "path": "docs/reference/ml/df-analytics/apis/get-inference-trained-model-metadata.asciidoc", "diffHunk": "@@ -0,0 +1,736 @@\n+[role=\"xpack\"]\n+[testenv=\"basic\"]\n+[[get-inference-metadata]]\n+= Get {infer} trained model metadata API\n+[subs=\"attributes\"]\n+++++\n+<titleabbrev>Get {infer} trained model metadata</titleabbrev>\n+++++\n+\n+Retrieves training metadata information for trained {infer} models.\n+\n+experimental[]\n+\n+\n+[[ml-get-inference-metadata-request]]\n+== {api-request-title}\n+\n+`GET _ml/inference/_metadata` +\n+\n+`GET _ml/inference/_all/_metadata` +\n+\n+`GET _ml/inference/<model_id>/_metadata` +\n+\n+`GET _ml/inference/<model_id>,<model_id_2>/_metadata` +\n+\n+`GET _ml/inference/<model_id_pattern*>,<model_id_2>/_metadata`\n+\n+\n+[[ml-get-inference-metadata-prereq]]\n+== {api-prereq-title}\n+\n+If the {es} {security-features} are enabled, you must have the following\n+privileges:\n+\n+* cluster: `monitor_ml`\n+\n+For more information, see <<security-privileges>> and {ml-docs-setup-privileges}.\n+\n+[[ml-get-inference-metadata-desc]]\n+== {api-description-title}\n+\n+You can get training metadata information for multiple trained models in a single API\n+request by using a comma-separated list of model IDs or a wildcard expression.\n+\n+\n+[[ml-get-inference-metadata-path-params]]\n+== {api-path-parms-title}\n+\n+`<model_id>`::\n+(Optional, string)\n+include::{es-repo-dir}/ml/ml-shared.asciidoc[tag=model-id]\n+\n+\n+[[ml-get-inference-metadata-query-params]]\n+== {api-query-parms-title}\n+\n+`allow_no_match`::\n+(Optional, boolean)\n+include::{es-repo-dir}/ml/ml-shared.asciidoc[tag=allow-no-match]", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bfb390e4e4257c2337c5df0d820f70a50620bbb9"}, "originalPosition": 59}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzgwNzUyMQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            If the trained model is a classification model, feature importance stastics are gathered\n          \n          \n            \n            If the trained model is a classification model, feature importance statistics are gathered", "url": "https://github.com/elastic/elasticsearch/pull/61922#discussion_r483807521", "createdAt": "2020-09-04T19:23:08Z", "author": {"login": "lcawl"}, "path": "docs/reference/ml/df-analytics/apis/get-inference-trained-model-metadata.asciidoc", "diffHunk": "@@ -0,0 +1,736 @@\n+[role=\"xpack\"]\n+[testenv=\"basic\"]\n+[[get-inference-metadata]]\n+= Get {infer} trained model metadata API\n+[subs=\"attributes\"]\n+++++\n+<titleabbrev>Get {infer} trained model metadata</titleabbrev>\n+++++\n+\n+Retrieves training metadata information for trained {infer} models.\n+\n+experimental[]\n+\n+\n+[[ml-get-inference-metadata-request]]\n+== {api-request-title}\n+\n+`GET _ml/inference/_metadata` +\n+\n+`GET _ml/inference/_all/_metadata` +\n+\n+`GET _ml/inference/<model_id>/_metadata` +\n+\n+`GET _ml/inference/<model_id>,<model_id_2>/_metadata` +\n+\n+`GET _ml/inference/<model_id_pattern*>,<model_id_2>/_metadata`\n+\n+\n+[[ml-get-inference-metadata-prereq]]\n+== {api-prereq-title}\n+\n+If the {es} {security-features} are enabled, you must have the following\n+privileges:\n+\n+* cluster: `monitor_ml`\n+\n+For more information, see <<security-privileges>> and {ml-docs-setup-privileges}.\n+\n+[[ml-get-inference-metadata-desc]]\n+== {api-description-title}\n+\n+You can get training metadata information for multiple trained models in a single API\n+request by using a comma-separated list of model IDs or a wildcard expression.\n+\n+\n+[[ml-get-inference-metadata-path-params]]\n+== {api-path-parms-title}\n+\n+`<model_id>`::\n+(Optional, string)\n+include::{es-repo-dir}/ml/ml-shared.asciidoc[tag=model-id]\n+\n+\n+[[ml-get-inference-metadata-query-params]]\n+== {api-query-parms-title}\n+\n+`allow_no_match`::\n+(Optional, boolean)\n+include::{es-repo-dir}/ml/ml-shared.asciidoc[tag=allow-no-match]\n+\n+`from`::\n+(Optional, integer)\n+include::{es-repo-dir}/ml/ml-shared.asciidoc[tag=from]\n+\n+`size`::\n+(Optional, integer)\n+include::{es-repo-dir}/ml/ml-shared.asciidoc[tag=size]\n+\n+[role=\"child_attributes\"]\n+[[ml-get-inference-metadata-results]]\n+== {api-response-body-title}\n+\n+`count`::\n+(integer)\n+The total number of trained model metadata objects that matched the requested ID patterns.\n+Could be higher than the number of items in the `trained_models_metadata` array as the\n+size of the array is restricted by the supplied `size` parameter.\n+\n+`trained_models_metadata`::\n+(array)\n+An array of trained model metadata objects, which are sorted by the `model_id` value in\n+ascending order.\n++\n+.Properties of trained model metadata\n+[%collapsible%open]\n+====\n+`model_id`:::\n+(string)\n+include::{es-repo-dir}/ml/ml-shared.asciidoc[tag=model-id]\n+\n+`total_feature_importance`:::\n+(array)\n+An array of the total feature importance for each training feature used from\n+the training data set.\n++\n+.Properties of total feature importance\n+[%collapsible%open]\n+=====\n+\n+`feature_name`:::\n+(string)\n+include::{es-repo-dir}/ml/ml-shared.asciidoc[tag=inference-metadata-feature-importance-feature-name]\n+\n+`importance`:::\n+(object)\n+A collection of feature importance statistics related to the training data set for this particular feature.\n++\n+.Properties of feature importance\n+[%collapsible%open]\n+======\n+`mean_magnitude`:::\n+(double)\n+include::{es-repo-dir}/ml/ml-shared.asciidoc[tag=inference-metadata-feature-importance-magnitude]\n+\n+`max`:::\n+(int)\n+include::{es-repo-dir}/ml/ml-shared.asciidoc[tag=inference-metadata-feature-importance-max]\n+\n+`min`:::\n+(int)\n+include::{es-repo-dir}/ml/ml-shared.asciidoc[tag=inference-metadata-feature-importance-min]\n+\n+======\n+\n+`classes`:::\n+(array)\n+If the trained model is a classification model, feature importance stastics are gathered", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bfb390e4e4257c2337c5df0d820f70a50620bbb9"}, "originalPosition": 127}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "90547d3233668a212eeb1a19d0c4090777716843", "author": {"user": {"login": "benwtrent", "name": "Benjamin Trent"}}, "url": "https://github.com/elastic/elasticsearch/commit/90547d3233668a212eeb1a19d0c4090777716843", "committedDate": "2020-09-08T14:32:45Z", "message": "Apply suggestions from code review\n\nCo-authored-by: Lisa Cawley <lcawley@elastic.co>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8b962b523c54a68eeaa7daaa7f7152ca55e806bf", "author": {"user": {"login": "elasticmachine", "name": "Elastic Machine"}}, "url": "https://github.com/elastic/elasticsearch/commit/8b962b523c54a68eeaa7daaa7f7152ca55e806bf", "committedDate": "2020-09-08T15:39:43Z", "message": "Merge branch 'master' into feature/ml-inference-add-description-api"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg0NDMwODIz", "url": "https://github.com/elastic/elasticsearch/pull/61922#pullrequestreview-484430823", "createdAt": "2020-09-08T19:26:45Z", "commit": {"oid": "8b962b523c54a68eeaa7daaa7f7152ca55e806bf"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOFQxOToyNjo0NlrOHOq_rg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOFQxOToyOTozN1rOHOrFag==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTE0NjU0Mg==", "bodyText": "Sorry I didn't notice this sooner, but these descriptions have the same problem--they're job-specific.  I've created model-specific descriptions in #62128\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            include::{es-repo-dir}/ml/ml-shared.asciidoc[tag=from]\n          \n          \n            \n            include::{es-repo-dir}/ml/ml-shared.asciidoc[tag=from-models]", "url": "https://github.com/elastic/elasticsearch/pull/61922#discussion_r485146542", "createdAt": "2020-09-08T19:26:46Z", "author": {"login": "lcawl"}, "path": "docs/reference/ml/df-analytics/apis/get-inference-trained-model-metadata.asciidoc", "diffHunk": "@@ -0,0 +1,736 @@\n+[role=\"xpack\"]\n+[testenv=\"basic\"]\n+[[get-inference-metadata]]\n+= Get trained model metadata API\n+[subs=\"attributes\"]\n+++++\n+<titleabbrev>Get {infer} trained model metadata</titleabbrev>\n+++++\n+\n+Retrieves training metadata information for trained models.\n+\n+experimental[]\n+\n+\n+[[ml-get-inference-metadata-request]]\n+== {api-request-title}\n+\n+`GET _ml/inference/_metadata` +\n+\n+`GET _ml/inference/_all/_metadata` +\n+\n+`GET _ml/inference/<model_id>/_metadata` +\n+\n+`GET _ml/inference/<model_id>,<model_id_2>/_metadata` +\n+\n+`GET _ml/inference/<model_id_pattern*>,<model_id_2>/_metadata`\n+\n+\n+[[ml-get-inference-metadata-prereq]]\n+== {api-prereq-title}\n+\n+If the {es} {security-features} are enabled, you must have the following\n+privileges:\n+\n+* cluster: `monitor_ml`\n+\n+For more information, see <<security-privileges>> and {ml-docs-setup-privileges}.\n+\n+[[ml-get-inference-metadata-desc]]\n+== {api-description-title}\n+\n+You can get metadata for multiple trained models in a single API\n+request by using a comma-separated list of model IDs or a wildcard expression.\n+\n+\n+[[ml-get-inference-metadata-path-params]]\n+== {api-path-parms-title}\n+\n+`<model_id>`::\n+(Optional, string)\n+include::{es-repo-dir}/ml/ml-shared.asciidoc[tag=model-id]\n+\n+\n+[[ml-get-inference-metadata-query-params]]\n+== {api-query-parms-title}\n+\n+`allow_no_match`::\n+(Optional, boolean)\n+include::{es-repo-dir}/ml/ml-shared.asciidoc[tag=allow-no-match-models]\n+\n+`from`::\n+(Optional, integer)\n+include::{es-repo-dir}/ml/ml-shared.asciidoc[tag=from]", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8b962b523c54a68eeaa7daaa7f7152ca55e806bf"}, "originalPosition": 63}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTE0Njc5Nw==", "bodyText": "Ditto re needing a model-specific description:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            include::{es-repo-dir}/ml/ml-shared.asciidoc[tag=size]\n          \n          \n            \n            include::{es-repo-dir}/ml/ml-shared.asciidoc[tag=size-models]", "url": "https://github.com/elastic/elasticsearch/pull/61922#discussion_r485146797", "createdAt": "2020-09-08T19:27:17Z", "author": {"login": "lcawl"}, "path": "docs/reference/ml/df-analytics/apis/get-inference-trained-model-metadata.asciidoc", "diffHunk": "@@ -0,0 +1,736 @@\n+[role=\"xpack\"]\n+[testenv=\"basic\"]\n+[[get-inference-metadata]]\n+= Get trained model metadata API\n+[subs=\"attributes\"]\n+++++\n+<titleabbrev>Get {infer} trained model metadata</titleabbrev>\n+++++\n+\n+Retrieves training metadata information for trained models.\n+\n+experimental[]\n+\n+\n+[[ml-get-inference-metadata-request]]\n+== {api-request-title}\n+\n+`GET _ml/inference/_metadata` +\n+\n+`GET _ml/inference/_all/_metadata` +\n+\n+`GET _ml/inference/<model_id>/_metadata` +\n+\n+`GET _ml/inference/<model_id>,<model_id_2>/_metadata` +\n+\n+`GET _ml/inference/<model_id_pattern*>,<model_id_2>/_metadata`\n+\n+\n+[[ml-get-inference-metadata-prereq]]\n+== {api-prereq-title}\n+\n+If the {es} {security-features} are enabled, you must have the following\n+privileges:\n+\n+* cluster: `monitor_ml`\n+\n+For more information, see <<security-privileges>> and {ml-docs-setup-privileges}.\n+\n+[[ml-get-inference-metadata-desc]]\n+== {api-description-title}\n+\n+You can get metadata for multiple trained models in a single API\n+request by using a comma-separated list of model IDs or a wildcard expression.\n+\n+\n+[[ml-get-inference-metadata-path-params]]\n+== {api-path-parms-title}\n+\n+`<model_id>`::\n+(Optional, string)\n+include::{es-repo-dir}/ml/ml-shared.asciidoc[tag=model-id]\n+\n+\n+[[ml-get-inference-metadata-query-params]]\n+== {api-query-parms-title}\n+\n+`allow_no_match`::\n+(Optional, boolean)\n+include::{es-repo-dir}/ml/ml-shared.asciidoc[tag=allow-no-match-models]\n+\n+`from`::\n+(Optional, integer)\n+include::{es-repo-dir}/ml/ml-shared.asciidoc[tag=from]\n+\n+`size`::\n+(Optional, integer)\n+include::{es-repo-dir}/ml/ml-shared.asciidoc[tag=size]", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8b962b523c54a68eeaa7daaa7f7152ca55e806bf"}, "originalPosition": 67}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTE0ODAxMA==", "bodyText": "This is a very long example, so it's worth considering putting \"...\" in a couple of places where the info is redundant.", "url": "https://github.com/elastic/elasticsearch/pull/61922#discussion_r485148010", "createdAt": "2020-09-08T19:29:37Z", "author": {"login": "lcawl"}, "path": "docs/reference/ml/df-analytics/apis/get-inference-trained-model-metadata.asciidoc", "diffHunk": "@@ -0,0 +1,736 @@\n+[role=\"xpack\"]\n+[testenv=\"basic\"]\n+[[get-inference-metadata]]\n+= Get trained model metadata API\n+[subs=\"attributes\"]\n+++++\n+<titleabbrev>Get {infer} trained model metadata</titleabbrev>\n+++++\n+\n+Retrieves training metadata information for trained models.\n+\n+experimental[]\n+\n+\n+[[ml-get-inference-metadata-request]]\n+== {api-request-title}\n+\n+`GET _ml/inference/_metadata` +\n+\n+`GET _ml/inference/_all/_metadata` +\n+\n+`GET _ml/inference/<model_id>/_metadata` +\n+\n+`GET _ml/inference/<model_id>,<model_id_2>/_metadata` +\n+\n+`GET _ml/inference/<model_id_pattern*>,<model_id_2>/_metadata`\n+\n+\n+[[ml-get-inference-metadata-prereq]]\n+== {api-prereq-title}\n+\n+If the {es} {security-features} are enabled, you must have the following\n+privileges:\n+\n+* cluster: `monitor_ml`\n+\n+For more information, see <<security-privileges>> and {ml-docs-setup-privileges}.\n+\n+[[ml-get-inference-metadata-desc]]\n+== {api-description-title}\n+\n+You can get metadata for multiple trained models in a single API\n+request by using a comma-separated list of model IDs or a wildcard expression.\n+\n+\n+[[ml-get-inference-metadata-path-params]]\n+== {api-path-parms-title}\n+\n+`<model_id>`::\n+(Optional, string)\n+include::{es-repo-dir}/ml/ml-shared.asciidoc[tag=model-id]\n+\n+\n+[[ml-get-inference-metadata-query-params]]\n+== {api-query-parms-title}\n+\n+`allow_no_match`::\n+(Optional, boolean)\n+include::{es-repo-dir}/ml/ml-shared.asciidoc[tag=allow-no-match-models]\n+\n+`from`::\n+(Optional, integer)\n+include::{es-repo-dir}/ml/ml-shared.asciidoc[tag=from]\n+\n+`size`::\n+(Optional, integer)\n+include::{es-repo-dir}/ml/ml-shared.asciidoc[tag=size]\n+\n+[role=\"child_attributes\"]\n+[[ml-get-inference-metadata-results]]\n+== {api-response-body-title}\n+\n+`count`::\n+(integer)\n+The total number of trained model metadata objects that matched the requested ID patterns.\n+Could be higher than the number of items in the `trained_models_metadata` array as the\n+size of the array is restricted by the supplied `size` parameter.\n+\n+`trained_models_metadata`::\n+(array)\n+An array of trained model metadata objects, which are sorted by the `model_id` value in\n+ascending order.\n++\n+.Properties of trained model metadata\n+[%collapsible%open]\n+====\n+`model_id`:::\n+(string)\n+include::{es-repo-dir}/ml/ml-shared.asciidoc[tag=model-id]\n+\n+`total_feature_importance`:::\n+(array)\n+An array of the total feature importance for each training feature used from\n+the training data set.\n++\n+.Properties of total feature importance\n+[%collapsible%open]\n+=====\n+\n+`feature_name`:::\n+(string)\n+include::{es-repo-dir}/ml/ml-shared.asciidoc[tag=inference-metadata-feature-importance-feature-name]\n+\n+`importance`:::\n+(object)\n+A collection of feature importance statistics related to the training data set for this particular feature.\n++\n+.Properties of feature importance\n+[%collapsible%open]\n+======\n+`mean_magnitude`:::\n+(double)\n+include::{es-repo-dir}/ml/ml-shared.asciidoc[tag=inference-metadata-feature-importance-magnitude]\n+\n+`max`:::\n+(int)\n+include::{es-repo-dir}/ml/ml-shared.asciidoc[tag=inference-metadata-feature-importance-max]\n+\n+`min`:::\n+(int)\n+include::{es-repo-dir}/ml/ml-shared.asciidoc[tag=inference-metadata-feature-importance-min]\n+\n+======\n+\n+`classes`:::\n+(array)\n+If the trained model is a classification model, feature importance statistics are gathered\n+per target class value.\n++\n+.Properties of class feature importance\n+[%collapsible%open]\n+\n+======\n+\n+`class_name`:::\n+(string)\n+The target class value. Could be a string, boolean, or number.\n+\n+`importance`:::\n+(object)\n+A collection of feature importance statistics related to the training data set for this particular feature.\n++\n+.Properties of feature importance\n+[%collapsible%open]\n+=======\n+`mean_magnitude`:::\n+(double)\n+include::{es-repo-dir}/ml/ml-shared.asciidoc[tag=inference-metadata-feature-importance-magnitude]\n+\n+`max`:::\n+(int)\n+include::{es-repo-dir}/ml/ml-shared.asciidoc[tag=inference-metadata-feature-importance-max]\n+\n+`min`:::\n+(int)\n+include::{es-repo-dir}/ml/ml-shared.asciidoc[tag=inference-metadata-feature-importance-min]\n+\n+=======\n+\n+======\n+\n+=====\n+\n+====\n+\n+[[ml-get-inference-metadata-response-codes]]\n+== {api-response-codes-title}\n+\n+`404` (Missing resources)::\n+  If `allow_no_match` is `false`, this code indicates that there are no\n+  resources that match the request or only partial matches for the request.\n+\n+[[ml-get-inference-metadata-example]]\n+== {api-examples-title}\n+\n+The following example gets training metadata for all the trained models:\n+\n+[source,console]\n+--------------------------------------------------\n+GET _ml/inference/_metadata\n+--------------------------------------------------\n+// TEST[skip:TBD]\n+\n+\n+The API returns the following results:\n+\n+[source,console-result]\n+----\n+{\n+  \"count\" : 2,\n+  \"trained_models_metadata\" : [\n+    {\n+      \"model_id\" : \"avg_price_prediction-1599149443166\",\n+      \"total_feature_importance\" : [\n+        {\n+          \"feature_name\" : \"Origin\",\n+          \"importance\" : {\n+            \"mean_magnitude\" : 25.862683737654795,\n+            \"min\" : -188.93284143727874,\n+            \"max\" : 162.8783518094679\n+          }\n+        },\n+        {\n+          \"feature_name\" : \"FlightTimeMin\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8b962b523c54a68eeaa7daaa7f7152ca55e806bf"}, "originalPosition": 204}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4e9147ba11b2304affa5931a1e1b4a3af5046eb5", "author": {"user": {"login": "benwtrent", "name": "Benjamin Trent"}}, "url": "https://github.com/elastic/elasticsearch/commit/4e9147ba11b2304affa5931a1e1b4a3af5046eb5", "committedDate": "2020-09-09T12:02:49Z", "message": "addressing pr comments"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg1MjYyNDcx", "url": "https://github.com/elastic/elasticsearch/pull/61922#pullrequestreview-485262471", "createdAt": "2020-09-09T17:51:55Z", "commit": {"oid": "4e9147ba11b2304affa5931a1e1b4a3af5046eb5"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "29a35a94bb70bd85870cb746555efdc8a718d888", "author": {"user": {"login": "benwtrent", "name": "Benjamin Trent"}}, "url": "https://github.com/elastic/elasticsearch/commit/29a35a94bb70bd85870cb746555efdc8a718d888", "committedDate": "2020-09-09T18:15:23Z", "message": "Merge branch 'master' into feature/ml-inference-add-description-api"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4e4a198d4b769e46a7b4695925ce99680b740ad4", "author": {"user": {"login": "benwtrent", "name": "Benjamin Trent"}}, "url": "https://github.com/elastic/elasticsearch/commit/4e4a198d4b769e46a7b4695925ce99680b740ad4", "committedDate": "2020-09-16T14:11:34Z", "message": "Merge branch 'master' into feature/ml-inference-add-description-api"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "18f2a1654e5ec163c6584a54b376e51fc52137e2", "author": {"user": {"login": "benwtrent", "name": "Benjamin Trent"}}, "url": "https://github.com/elastic/elasticsearch/commit/18f2a1654e5ec163c6584a54b376e51fc52137e2", "committedDate": "2020-09-14T12:40:49Z", "message": "Merge branch 'master' into feature/ml-inference-add-description-api"}, "afterCommit": {"oid": "4e4a198d4b769e46a7b4695925ce99680b740ad4", "author": {"user": {"login": "benwtrent", "name": "Benjamin Trent"}}, "url": "https://github.com/elastic/elasticsearch/commit/4e4a198d4b769e46a7b4695925ce99680b740ad4", "committedDate": "2020-09-16T14:11:34Z", "message": "Merge branch 'master' into feature/ml-inference-add-description-api"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "02abb2bd8bcaf2d369860fe7dc927d66646cfbd8", "author": {"user": {"login": "benwtrent", "name": "Benjamin Trent"}}, "url": "https://github.com/elastic/elasticsearch/commit/02abb2bd8bcaf2d369860fe7dc927d66646cfbd8", "committedDate": "2020-09-16T17:18:41Z", "message": "adjusting api changes to include feature importance via flag"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "181200279350579e5a8f892faaa25b02f71452d6", "author": {"user": {"login": "benwtrent", "name": "Benjamin Trent"}}, "url": "https://github.com/elastic/elasticsearch/commit/181200279350579e5a8f892faaa25b02f71452d6", "committedDate": "2020-09-16T17:26:39Z", "message": "fixing test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ed50912feb97d444f9ac153c1f26b2dbc425191c", "author": {"user": {"login": "benwtrent", "name": "Benjamin Trent"}}, "url": "https://github.com/elastic/elasticsearch/commit/ed50912feb97d444f9ac153c1f26b2dbc425191c", "committedDate": "2020-09-16T17:53:22Z", "message": "test fix"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg5OTQyNTUw", "url": "https://github.com/elastic/elasticsearch/pull/61922#pullrequestreview-489942550", "createdAt": "2020-09-16T19:07:44Z", "commit": {"oid": "ed50912feb97d444f9ac153c1f26b2dbc425191c"}, "state": "COMMENTED", "comments": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQxOTowNzo0NFrOHS_7zA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQxOToxNToxM1rOHTAdbg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTY4MzkxNg==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            <6> Allow empty response if no Trained Models match the provided ID patterns.\n          \n          \n            \n            <6> Allow empty response if no trained models match the provided ID patterns.", "url": "https://github.com/elastic/elasticsearch/pull/61922#discussion_r489683916", "createdAt": "2020-09-16T19:07:44Z", "author": {"login": "lcawl"}, "path": "docs/java-rest/high-level/ml/get-trained-models.asciidoc", "diffHunk": "@@ -25,14 +25,16 @@ include-tagged::{doc-tests-file}[{api}-request]\n <1> Constructing a new GET request referencing an existing Trained Model\n <2> Set the paging parameters\n <3> Indicate if the complete model definition should be included\n-<4> Should the definition be fully decompressed on GET\n-<5> Allow empty response if no Trained Models match the provided ID patterns.\n+<4> Indicate if the total feature importance for the features used in training\n+    should be included in the model `metadata` field.\n+<5> Should the definition be fully decompressed on GET\n+<6> Allow empty response if no Trained Models match the provided ID patterns.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ed50912feb97d444f9ac153c1f26b2dbc425191c"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTY4NDE3NQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            <7> An optional list of tags used to narrow the model search. A Trained Model\n          \n          \n            \n            <7> An optional list of tags used to narrow the model search. A trained model", "url": "https://github.com/elastic/elasticsearch/pull/61922#discussion_r489684175", "createdAt": "2020-09-16T19:07:58Z", "author": {"login": "lcawl"}, "path": "docs/java-rest/high-level/ml/get-trained-models.asciidoc", "diffHunk": "@@ -25,14 +25,16 @@ include-tagged::{doc-tests-file}[{api}-request]\n <1> Constructing a new GET request referencing an existing Trained Model\n <2> Set the paging parameters\n <3> Indicate if the complete model definition should be included\n-<4> Should the definition be fully decompressed on GET\n-<5> Allow empty response if no Trained Models match the provided ID patterns.\n+<4> Indicate if the total feature importance for the features used in training\n+    should be included in the model `metadata` field.\n+<5> Should the definition be fully decompressed on GET\n+<6> Allow empty response if no Trained Models match the provided ID patterns.\n     If false, an error will be thrown if no Trained Models match the\n     ID patterns.\n-<6> An optional list of tags used to narrow the model search. A Trained Model\n+<7> An optional list of tags used to narrow the model search. A Trained Model", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ed50912feb97d444f9ac153c1f26b2dbc425191c"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTY4NjYxNA==", "bodyText": "An array of the total feature importance for each training feature used from\n\nAFAIK we've never defined a \"training feature\".  Can we just say feature? If not, this term needs to be explained.", "url": "https://github.com/elastic/elasticsearch/pull/61922#discussion_r489686614", "createdAt": "2020-09-16T19:10:03Z", "author": {"login": "lcawl"}, "path": "docs/reference/ml/df-analytics/apis/get-inference-trained-model.asciidoc", "diffHunk": "@@ -133,8 +136,86 @@ The license level of the trained model.\n \n `metadata`:::\n (object)\n-An object containing metadata about the trained model. For example, models \n+An object containing metadata about the trained model. For example, models\n created by {dfanalytics} contain `analysis_config` and `input` objects.\n+.Properties of metadata\n+[%collapsible%open]\n+=====\n+`total_feature_importance`:::\n+(array)\n+An array of the total feature importance for each training feature used from", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ed50912feb97d444f9ac153c1f26b2dbc425191c"}, "originalPosition": 97}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTY4ODI0Mw==", "bodyText": "training feature name\n\nDitto earlier comment about \"training feature\".\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            The training feature name for which this importance was calculated.\n          \n          \n            \n            The feature for which this importance was calculated.", "url": "https://github.com/elastic/elasticsearch/pull/61922#discussion_r489688243", "createdAt": "2020-09-16T19:11:26Z", "author": {"login": "lcawl"}, "path": "docs/reference/ml/ml-shared.asciidoc", "diffHunk": "@@ -785,6 +785,23 @@ prediction. Defaults to the `results_field` value of the {dfanalytics-job} that\n used to train the model, which defaults to `<dependent_variable>_prediction`.\n end::inference-config-results-field-processor[]\n \n+tag::inference-metadata-feature-importance-feature-name[]\n+The training feature name for which this importance was calculated.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ed50912feb97d444f9ac153c1f26b2dbc425191c"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTY5MTY3Nw==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n             - definition: to include the model definition\n          \n          \n            \n             - `definition`: Includes the model definition", "url": "https://github.com/elastic/elasticsearch/pull/61922#discussion_r489691677", "createdAt": "2020-09-16T19:14:29Z", "author": {"login": "lcawl"}, "path": "docs/reference/ml/df-analytics/apis/get-inference-trained-model.asciidoc", "diffHunk": "@@ -72,17 +72,20 @@ retrieval. This allows the model to be in an acceptable format to be retrieved\n and then added to another cluster. Default is false.\n \n `from`::\n-(Optional, integer) \n+(Optional, integer)\n include::{es-repo-dir}/ml/ml-shared.asciidoc[tag=from-models]\n \n-`include_model_definition`::\n-(Optional, boolean)\n-Specifies whether the model definition is returned in the response. Defaults to \n-`false`. When `true`, only a single model must match the ID patterns provided. \n-Otherwise, a bad request is returned.\n+`include`::\n+(Optional, string)\n+A comma delimited string of optional fields to include in the response body.\n+Valid options are:\n+ - definition: to include the model definition", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ed50912feb97d444f9ac153c1f26b2dbc425191c"}, "originalPosition": 65}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTY5MjIwNw==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n             - total_feature_importance: to include the total feature importance for the\n          \n          \n            \n             - `total_feature_importance`: Includes the total feature importance for the", "url": "https://github.com/elastic/elasticsearch/pull/61922#discussion_r489692207", "createdAt": "2020-09-16T19:14:53Z", "author": {"login": "lcawl"}, "path": "docs/reference/ml/df-analytics/apis/get-inference-trained-model.asciidoc", "diffHunk": "@@ -72,17 +72,20 @@ retrieval. This allows the model to be in an acceptable format to be retrieved\n and then added to another cluster. Default is false.\n \n `from`::\n-(Optional, integer) \n+(Optional, integer)\n include::{es-repo-dir}/ml/ml-shared.asciidoc[tag=from-models]\n \n-`include_model_definition`::\n-(Optional, boolean)\n-Specifies whether the model definition is returned in the response. Defaults to \n-`false`. When `true`, only a single model must match the ID patterns provided. \n-Otherwise, a bad request is returned.\n+`include`::\n+(Optional, string)\n+A comma delimited string of optional fields to include in the response body.\n+Valid options are:\n+ - definition: to include the model definition\n+ - total_feature_importance: to include the total feature importance for the", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ed50912feb97d444f9ac153c1f26b2dbc425191c"}, "originalPosition": 66}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTY5MjUyNg==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n               training feature sets. This field will be available in the `metadata` field.\n          \n          \n            \n               training data sets. This field is available in the `metadata` field in the response body.", "url": "https://github.com/elastic/elasticsearch/pull/61922#discussion_r489692526", "createdAt": "2020-09-16T19:15:13Z", "author": {"login": "lcawl"}, "path": "docs/reference/ml/df-analytics/apis/get-inference-trained-model.asciidoc", "diffHunk": "@@ -72,17 +72,20 @@ retrieval. This allows the model to be in an acceptable format to be retrieved\n and then added to another cluster. Default is false.\n \n `from`::\n-(Optional, integer) \n+(Optional, integer)\n include::{es-repo-dir}/ml/ml-shared.asciidoc[tag=from-models]\n \n-`include_model_definition`::\n-(Optional, boolean)\n-Specifies whether the model definition is returned in the response. Defaults to \n-`false`. When `true`, only a single model must match the ID patterns provided. \n-Otherwise, a bad request is returned.\n+`include`::\n+(Optional, string)\n+A comma delimited string of optional fields to include in the response body.\n+Valid options are:\n+ - definition: to include the model definition\n+ - total_feature_importance: to include the total feature importance for the\n+   training feature sets. This field will be available in the `metadata` field.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ed50912feb97d444f9ac153c1f26b2dbc425191c"}, "originalPosition": 67}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkwMzc1NTk3", "url": "https://github.com/elastic/elasticsearch/pull/61922#pullrequestreview-490375597", "createdAt": "2020-09-17T08:47:06Z", "commit": {"oid": "ed50912feb97d444f9ac153c1f26b2dbc425191c"}, "state": "APPROVED", "comments": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xN1QwODo0NzowNlrOHTX5jw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xN1QwOTozNjoxNVrOHTZ0fA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDA3NjU1OQ==", "bodyText": "Swap these 2 sentences around, the fact that certain fields are removed is the detail\n<8> Optional boolean value for requesting the trained model in a format that can then be put into another cluster. Certain fields that can only be set when the model is imported are removed.", "url": "https://github.com/elastic/elasticsearch/pull/61922#discussion_r490076559", "createdAt": "2020-09-17T08:47:06Z", "author": {"login": "davidkyle"}, "path": "docs/java-rest/high-level/ml/get-trained-models.asciidoc", "diffHunk": "@@ -25,14 +25,16 @@ include-tagged::{doc-tests-file}[{api}-request]\n <1> Constructing a new GET request referencing an existing Trained Model\n <2> Set the paging parameters\n <3> Indicate if the complete model definition should be included\n-<4> Should the definition be fully decompressed on GET\n-<5> Allow empty response if no Trained Models match the provided ID patterns.\n+<4> Indicate if the total feature importance for the features used in training\n+    should be included in the model `metadata` field.\n+<5> Should the definition be fully decompressed on GET\n+<6> Allow empty response if no Trained Models match the provided ID patterns.\n     If false, an error will be thrown if no Trained Models match the\n     ID patterns.\n-<6> An optional list of tags used to narrow the model search. A Trained Model\n+<7> An optional list of tags used to narrow the model search. A Trained Model\n     can have many tags or none. The trained models in the response will\n     contain all the provided tags.\n-<7> Optional boolean value indicating if certain fields should be removed on\n+<8> Optional boolean value indicating if certain fields should be removed on", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ed50912feb97d444f9ac153c1f26b2dbc425191c"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDA4NTc4Mg==", "bodyText": "The package private ctor also wraps this map in line 151\nthis.metadata = metadata == null ? null : Collections.unmodifiableMap(metadata);\nMake the ctor argument a UnmodifiableMap and getMetadata() return an UnmodifiableMap and I think that simplifies these maps being wrapped in a map in a map etc", "url": "https://github.com/elastic/elasticsearch/pull/61922#discussion_r490085782", "createdAt": "2020-09-17T09:00:46Z", "author": {"login": "davidkyle"}, "path": "x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/ml/inference/TrainedModelConfig.java", "diffHunk": "@@ -408,7 +412,7 @@ public Builder(TrainedModelConfig config) {\n             this.definition = config.definition == null ? null : new LazyModelDefinition(config.definition);\n             this.description = config.getDescription();\n             this.tags = config.getTags();\n-            this.metadata = config.getMetadata();\n+            this.metadata = config.getMetadata() == null ? null : new HashMap<>(config.getMetadata());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ed50912feb97d444f9ac153c1f26b2dbc425191c"}, "originalPosition": 30}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDA4OTA2NQ==", "bodyText": "Make a copy of the unmodifiable map here", "url": "https://github.com/elastic/elasticsearch/pull/61922#discussion_r490089065", "createdAt": "2020-09-17T09:06:00Z", "author": {"login": "davidkyle"}, "path": "x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/ml/inference/TrainedModelConfig.java", "diffHunk": "@@ -460,6 +464,18 @@ public Builder setMetadata(Map<String, Object> metadata) {\n             return this;\n         }\n \n+        public Builder setFeatureImportance(List<TotalFeatureImportance> totalFeatureImportance) {\n+            if (totalFeatureImportance == null) {\n+                return this;\n+            }\n+            if (this.metadata == null) {\n+                this.metadata = new HashMap<>();\n+            }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ed50912feb97d444f9ac153c1f26b2dbc425191c"}, "originalPosition": 44}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDA5OTIwNg==", "bodyText": "nit: It is clearer if finalListener is used for these onFailure calls.", "url": "https://github.com/elastic/elasticsearch/pull/61922#discussion_r490099206", "createdAt": "2020-09-17T09:22:08Z", "author": {"login": "davidkyle"}, "path": "x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/inference/persistence/TrainedModelProvider.java", "diffHunk": "@@ -482,11 +518,11 @@ public void getTrainedModel(final String modelId, final boolean includeDefinitio\n                 try {\n                     builder = handleSearchItem(multiSearchResponse.getResponses()[0], modelId, this::parseInferenceDocLenientlyFromSource);\n                 } catch (ResourceNotFoundException ex) {\n-                    listener.onFailure(new ResourceNotFoundException(\n+                    getTrainedModelListener.onFailure(new ResourceNotFoundException(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ed50912feb97d444f9ac153c1f26b2dbc425191c"}, "originalPosition": 125}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDEwMjUxNw==", "bodyText": "Configs are still sorted by the search aren't they? Sorting here shouldn't be necessary", "url": "https://github.com/elastic/elasticsearch/pull/61922#discussion_r490102517", "createdAt": "2020-09-17T09:27:08Z", "author": {"login": "davidkyle"}, "path": "x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/inference/persistence/TrainedModelProvider.java", "diffHunk": "@@ -540,23 +579,65 @@ public void getTrainedModels(Set<String> modelIds, boolean allowNoResources, fin\n             .setQuery(queryBuilder)\n             .setSize(modelIds.size())\n             .request();\n-        List<TrainedModelConfig> configs = new ArrayList<>(modelIds.size());\n+        List<TrainedModelConfig.Builder> configs = new ArrayList<>(modelIds.size());\n         Set<String> modelsInIndex = Sets.difference(modelIds, MODELS_STORED_AS_RESOURCE);\n         Set<String> modelsAsResource = Sets.intersection(MODELS_STORED_AS_RESOURCE, modelIds);\n         for(String modelId : modelsAsResource) {\n             try {\n                 configs.add(loadModelFromResource(modelId, true));\n             } catch (ElasticsearchException ex) {\n-                listener.onFailure(ex);\n+                finalListener.onFailure(ex);\n                 return;\n             }\n         }\n         if (modelsInIndex.isEmpty()) {\n-            configs.sort(Comparator.comparing(TrainedModelConfig::getModelId));\n-            listener.onResponse(configs);\n+            finalListener.onResponse(configs.stream()\n+                .map(TrainedModelConfig.Builder::build)\n+                .sorted(Comparator.comparing(TrainedModelConfig::getModelId))\n+                .collect(Collectors.toList()));\n             return;\n         }\n \n+        ActionListener<List<TrainedModelConfig.Builder>> getTrainedModelListener = ActionListener.wrap(\n+            modelBuilders -> {\n+                if (includeTotalFeatureImportance == false) {\n+                    finalListener.onResponse(modelBuilders.stream()\n+                        .map(TrainedModelConfig.Builder::build)\n+                        .sorted(Comparator.comparing(TrainedModelConfig::getModelId))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ed50912feb97d444f9ac153c1f26b2dbc425191c"}, "originalPosition": 206}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDEwMzQ1Ng==", "bodyText": "nit: delete extra blank line", "url": "https://github.com/elastic/elasticsearch/pull/61922#discussion_r490103456", "createdAt": "2020-09-17T09:28:40Z", "author": {"login": "davidkyle"}, "path": "x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/inference/persistence/TrainedModelProvider.java", "diffHunk": "@@ -540,23 +579,65 @@ public void getTrainedModels(Set<String> modelIds, boolean allowNoResources, fin\n             .setQuery(queryBuilder)\n             .setSize(modelIds.size())\n             .request();\n-        List<TrainedModelConfig> configs = new ArrayList<>(modelIds.size());\n+        List<TrainedModelConfig.Builder> configs = new ArrayList<>(modelIds.size());\n         Set<String> modelsInIndex = Sets.difference(modelIds, MODELS_STORED_AS_RESOURCE);\n         Set<String> modelsAsResource = Sets.intersection(MODELS_STORED_AS_RESOURCE, modelIds);\n         for(String modelId : modelsAsResource) {\n             try {\n                 configs.add(loadModelFromResource(modelId, true));\n             } catch (ElasticsearchException ex) {\n-                listener.onFailure(ex);\n+                finalListener.onFailure(ex);\n                 return;\n             }\n         }\n         if (modelsInIndex.isEmpty()) {\n-            configs.sort(Comparator.comparing(TrainedModelConfig::getModelId));\n-            listener.onResponse(configs);\n+            finalListener.onResponse(configs.stream()\n+                .map(TrainedModelConfig.Builder::build)\n+                .sorted(Comparator.comparing(TrainedModelConfig::getModelId))\n+                .collect(Collectors.toList()));\n             return;\n         }\n \n+        ActionListener<List<TrainedModelConfig.Builder>> getTrainedModelListener = ActionListener.wrap(\n+            modelBuilders -> {\n+                if (includeTotalFeatureImportance == false) {\n+                    finalListener.onResponse(modelBuilders.stream()\n+                        .map(TrainedModelConfig.Builder::build)\n+                        .sorted(Comparator.comparing(TrainedModelConfig::getModelId))\n+                        .collect(Collectors.toList()));\n+                    return;\n+                }\n+                this.getTrainedModelMetadata(modelIds, ActionListener.wrap(\n+                    metadata ->\n+                        finalListener.onResponse(modelBuilders.stream()\n+                            .map(builder -> {\n+                                TrainedModelMetadata modelMetadata = metadata.get(builder.getModelId());\n+                                if (modelMetadata != null) {\n+                                    builder.setFeatureImportance(modelMetadata.getTotalFeatureImportances());\n+                                }\n+                                return builder.build();\n+                            })\n+                            .sorted(Comparator.comparing(TrainedModelConfig::getModelId))\n+                            .collect(Collectors.toList())),\n+                    failure -> {\n+                        // total feature importance is not necessary for a model to be valid\n+                        // we shouldn't fail if it is not found\n+                        if (ExceptionsHelper.unwrapCause(failure) instanceof ResourceNotFoundException) {\n+                            finalListener.onResponse(modelBuilders.stream()\n+                                .map(TrainedModelConfig.Builder::build)\n+                                .sorted(Comparator.comparing(TrainedModelConfig::getModelId))\n+                                .collect(Collectors.toList()));\n+                            return;\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ed50912feb97d444f9ac153c1f26b2dbc425191c"}, "originalPosition": 231}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDEwNDczNw==", "bodyText": "\ud83d\udc4d  makes sense\nIs it the case that newer models after version 7.10 will always have the total feature importance?", "url": "https://github.com/elastic/elasticsearch/pull/61922#discussion_r490104737", "createdAt": "2020-09-17T09:30:41Z", "author": {"login": "davidkyle"}, "path": "x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/inference/persistence/TrainedModelProvider.java", "diffHunk": "@@ -540,23 +579,65 @@ public void getTrainedModels(Set<String> modelIds, boolean allowNoResources, fin\n             .setQuery(queryBuilder)\n             .setSize(modelIds.size())\n             .request();\n-        List<TrainedModelConfig> configs = new ArrayList<>(modelIds.size());\n+        List<TrainedModelConfig.Builder> configs = new ArrayList<>(modelIds.size());\n         Set<String> modelsInIndex = Sets.difference(modelIds, MODELS_STORED_AS_RESOURCE);\n         Set<String> modelsAsResource = Sets.intersection(MODELS_STORED_AS_RESOURCE, modelIds);\n         for(String modelId : modelsAsResource) {\n             try {\n                 configs.add(loadModelFromResource(modelId, true));\n             } catch (ElasticsearchException ex) {\n-                listener.onFailure(ex);\n+                finalListener.onFailure(ex);\n                 return;\n             }\n         }\n         if (modelsInIndex.isEmpty()) {\n-            configs.sort(Comparator.comparing(TrainedModelConfig::getModelId));\n-            listener.onResponse(configs);\n+            finalListener.onResponse(configs.stream()\n+                .map(TrainedModelConfig.Builder::build)\n+                .sorted(Comparator.comparing(TrainedModelConfig::getModelId))\n+                .collect(Collectors.toList()));\n             return;\n         }\n \n+        ActionListener<List<TrainedModelConfig.Builder>> getTrainedModelListener = ActionListener.wrap(\n+            modelBuilders -> {\n+                if (includeTotalFeatureImportance == false) {\n+                    finalListener.onResponse(modelBuilders.stream()\n+                        .map(TrainedModelConfig.Builder::build)\n+                        .sorted(Comparator.comparing(TrainedModelConfig::getModelId))\n+                        .collect(Collectors.toList()));\n+                    return;\n+                }\n+                this.getTrainedModelMetadata(modelIds, ActionListener.wrap(\n+                    metadata ->\n+                        finalListener.onResponse(modelBuilders.stream()\n+                            .map(builder -> {\n+                                TrainedModelMetadata modelMetadata = metadata.get(builder.getModelId());\n+                                if (modelMetadata != null) {\n+                                    builder.setFeatureImportance(modelMetadata.getTotalFeatureImportances());\n+                                }\n+                                return builder.build();\n+                            })\n+                            .sorted(Comparator.comparing(TrainedModelConfig::getModelId))\n+                            .collect(Collectors.toList())),\n+                    failure -> {\n+                        // total feature importance is not necessary for a model to be valid\n+                        // we shouldn't fail if it is not found", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ed50912feb97d444f9ac153c1f26b2dbc425191c"}, "originalPosition": 224}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDEwODAyOA==", "bodyText": "I can't find a inference_metadata.yml did you forget to add it?", "url": "https://github.com/elastic/elasticsearch/pull/61922#discussion_r490108028", "createdAt": "2020-09-17T09:36:15Z", "author": {"login": "davidkyle"}, "path": "x-pack/plugin/ml/qa/ml-with-security/build.gradle", "diffHunk": "@@ -142,6 +142,8 @@ yamlRestTest {\n     'ml/inference_crud/Test put ensemble with tree where tree has out of bounds feature_names index',\n     'ml/inference_crud/Test put model with empty input.field_names',\n     'ml/inference_crud/Test PUT model where target type and inference config mismatch',\n+    'ml/inference_metadata/Test get given missing trained model metadata',", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ed50912feb97d444f9ac153c1f26b2dbc425191c"}, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7ec181355914a17dc8b3cf5dcf248bff8323ae66", "author": {"user": {"login": "benwtrent", "name": "Benjamin Trent"}}, "url": "https://github.com/elastic/elasticsearch/commit/7ec181355914a17dc8b3cf5dcf248bff8323ae66", "committedDate": "2020-09-17T11:45:52Z", "message": "addressing pr comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "21bdf09054d7c80b5807f1ceec375cf7ca14beee", "author": {"user": {"login": "benwtrent", "name": "Benjamin Trent"}}, "url": "https://github.com/elastic/elasticsearch/commit/21bdf09054d7c80b5807f1ceec375cf7ca14beee", "committedDate": "2020-09-17T11:45:57Z", "message": "Merge branch 'master' into feature/ml-inference-add-description-api"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkxMDQzOTY4", "url": "https://github.com/elastic/elasticsearch/pull/61922#pullrequestreview-491043968", "createdAt": "2020-09-17T22:58:37Z", "commit": {"oid": "21bdf09054d7c80b5807f1ceec375cf7ca14beee"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xN1QyMjo1ODozN1rOHT4SwA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xN1QyMjo1ODozN1rOHT4SwA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDYwNzI5Ng==", "bodyText": "This isn't formatting properly, so I think a continuation character is required.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            .Properties of metadata\n          \n          \n            \n            +\n          \n          \n            \n            .Properties of metadata", "url": "https://github.com/elastic/elasticsearch/pull/61922#discussion_r490607296", "createdAt": "2020-09-17T22:58:37Z", "author": {"login": "lcawl"}, "path": "docs/reference/ml/df-analytics/apis/get-inference-trained-model.asciidoc", "diffHunk": "@@ -133,8 +137,86 @@ The license level of the trained model.\n \n `metadata`:::\n (object)\n-An object containing metadata about the trained model. For example, models \n+An object containing metadata about the trained model. For example, models\n created by {dfanalytics} contain `analysis_config` and `input` objects.\n+.Properties of metadata", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "21bdf09054d7c80b5807f1ceec375cf7ca14beee"}, "originalPosition": 93}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4825, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}