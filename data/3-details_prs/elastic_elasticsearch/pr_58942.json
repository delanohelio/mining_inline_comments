{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQzNjM0MjE1", "number": 58942, "title": "Submit async search to not require read privilege", "bodyText": "When we execute search against remote indices, the remote indices are authorized on the remote cluster and not on the CCS cluster. When we introduced submit async search we added a check that requires that the user running it has the privilege to execute it on some index. That prevents users from executing async searches against remote indices unless they also have read access on the CCS cluster, which is common when the CCS cluster holds no data.\nThe solution is to let the submit async search go through as we already do for get and delete async search. Note that the inner search action will still check that the user can access local indices, and remote indices on the remote cluster, like search always does.", "createdAt": "2020-07-02T16:47:05Z", "url": "https://github.com/elastic/elasticsearch/pull/58942", "merged": true, "mergeCommit": {"oid": "25ba4799ad8467d45c4e818c5acc15a9c97bd706"}, "closed": true, "closedAt": "2020-07-03T10:16:45Z", "author": {"login": "javanna"}, "timelineItems": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcxBq9cAH2gAyNDQzNjM0MjE1OjJkMDExM2VkYzFhOWJhNTZhOTIwMDAyMGVjZTVmZDI3MDQ2N2VjY2E=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcxDuK5gH2gAyNDQzNjM0MjE1OmRiYWU1Yjk4MzJkMzNjOTAxNjBjZjcxZGEzNGVhNzdmMGIzMzM3ZWQ=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "2d0113edc1a9ba56a9200020ece5fd270467ecca", "author": {"user": {"login": "javanna", "name": "Luca Cavanna"}}, "url": "https://github.com/elastic/elasticsearch/commit/2d0113edc1a9ba56a9200020ece5fd270467ecca", "committedDate": "2020-07-02T16:45:12Z", "message": "Submit async search to not require read privilege\n\nWhen we execute search against remote indices, the remote indices are authorized on the remote cluster and not on the CCS cluster. When we introduced submit async search we added a check that requires that the user running it has the privilege to execute it on some index. That prevents users from executing async searches against remote indices unless they also have read access on the CCS cluster, which is common when the CCS cluster holds no data."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQxODY2Mjky", "url": "https://github.com/elastic/elasticsearch/pull/58942#pullrequestreview-441866292", "createdAt": "2020-07-02T16:49:45Z", "commit": {"oid": "2d0113edc1a9ba56a9200020ece5fd270467ecca"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMlQxNjo0OTo0NVrOGsVxJQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMlQxNjo0OTo0NVrOGsVxJQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTE0NzE3Mw==", "bodyText": "Can you add a test for delete too ?", "url": "https://github.com/elastic/elasticsearch/pull/58942#discussion_r449147173", "createdAt": "2020-07-02T16:49:45Z", "author": {"login": "jimczi"}, "path": "x-pack/qa/multi-cluster-search-security/src/test/resources/rest-api-spec/test/multi_cluster/10_basic.yml", "diffHunk": "@@ -246,3 +306,34 @@ teardown:\n   - is_true: hits.hits.0._source.secure\n   - match: { hits.hits.0._index: \"my_remote_cluster:secured_via_alias\" }\n \n+---\n+\"Async search against filtered alias on the remote cluster\":\n+\n+  - do:\n+      headers: { Authorization: \"Basic cmVtb3RlOnMza3JpdA==\" }\n+      async_search.submit:\n+        index: my_remote_cluster:aliased_test_index\n+        wait_for_completion_timeout: 10s\n+        keep_on_completion: true\n+\n+  - set:  { id: id }\n+  - match: { is_partial: false }\n+  - match: { response._clusters.total: 1}\n+  - match: { response._clusters.successful: 1}\n+  - match: { response._shards.total: 3 }\n+  - length: { response.hits.hits: 2 }\n+  - match: { response.hits.hits.0._source.filter_field: 1 }\n+  - match: { response.hits.hits.0._index: \"my_remote_cluster:test_index\" }\n+\n+  - do:\n+      headers: { Authorization: \"Basic cmVtb3RlOnMza3JpdA==\" }\n+      async_search.get:\n+        id: \"$id\"\n+\n+  - match: { is_partial: false }\n+  - is_true: response._clusters\n+  - match: { response._shards.total: 3 }\n+  - length: { response.hits.hits: 2 }\n+  - match: { response.hits.hits.0._source.filter_field: 1 }\n+  - match: { response.hits.hits.0._index: \"my_remote_cluster:test_index\" }\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2d0113edc1a9ba56a9200020ece5fd270467ecca"}, "originalPosition": 150}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dbae5b9832d33c90160cf71da34ea77f0b3337ed", "author": {"user": {"login": "javanna", "name": "Luca Cavanna"}}, "url": "https://github.com/elastic/elasticsearch/commit/dbae5b9832d33c90160cf71da34ea77f0b3337ed", "committedDate": "2020-07-02T19:08:31Z", "message": "add delete async search tests"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2414, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}