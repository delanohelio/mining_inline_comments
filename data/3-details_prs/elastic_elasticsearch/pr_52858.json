{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzgwNTc2NDQ2", "number": 52858, "title": "Fix cacheability of repository-hdfs integ tests", "bodyText": "Several of the :plugins:repository-hdfs integration test tasks are not being pulled from the cache due to changes in test fixture data directories. These directories really shouldn't be on the classpath as the only thing we need is the ports file. Due to some particularities in classpath input filtering, we can't just add the ports file itself and subsequently ignore it for the purposes if input snapshotting. So instead we copy the file to its own directory, and add the directory to the classpath. This allows us to ignore the ports file so changes won't affect the cache key.", "createdAt": "2020-02-27T00:32:35Z", "url": "https://github.com/elastic/elasticsearch/pull/52858", "merged": true, "mergeCommit": {"oid": "8bb5a11e7626d41af85661cbeeb669d3f1328314"}, "closed": true, "closedAt": "2020-02-27T17:53:35Z", "author": {"login": "mark-vieira"}, "timelineItems": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcIQDJuAH2gAyMzgwNTc2NDQ2OmE0ZGY2NGIzYjUxZjY1NzdiOGQ3MDJhMDY1NGQ5MmQ2YjVjMGExNzY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcIdow_gH2gAyMzgwNTc2NDQ2OmYxMzhiNzc1OTNkNjg2ODc4YTY4MzExMzE5Mzc4ZDQ4M2JjZjhkOTE=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "a4df64b3b51f6577b8d702a0654d92d6b5c0a176", "author": {"user": {"login": "mark-vieira", "name": "Mark Vieira"}}, "url": "https://github.com/elastic/elasticsearch/commit/a4df64b3b51f6577b8d702a0654d92d6b5c0a176", "committedDate": "2020-02-27T00:19:24Z", "message": "Fix cacheability of repository-hdfs integ tests\n\nSigned-off-by: Mark Vieira <portugee@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY1MzcxMDY4", "url": "https://github.com/elastic/elasticsearch/pull/52858#pullrequestreview-365371068", "createdAt": "2020-02-27T02:05:07Z", "commit": {"oid": "a4df64b3b51f6577b8d702a0654d92d6b5c0a176"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yN1QwMjowNTowN1rOFvC7IA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yN1QwMjowNTowN1rOFvC7IA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDg3NTI5Ng==", "bodyText": "not hugely important, but the path here will be \"${workingDir}/ports/ports\" right? Maybe name the file \"hdfsPorts\" or something like that", "url": "https://github.com/elastic/elasticsearch/pull/52858#discussion_r384875296", "createdAt": "2020-02-27T02:05:07Z", "author": {"login": "rjernst"}, "path": "plugins/repository-hdfs/build.gradle", "diffHunk": "@@ -152,20 +152,29 @@ for (String integTestTaskName : ['integTestHa', 'integTestSecure', 'integTestSec\n     runner {\n       onlyIf { BuildParams.inFipsJvm == false }\n       if (integTestTaskName.contains(\"Ha\")) {\n+        Path portsFile\n+        File portsFileDir = file(\"${workingDir}/ports\")\n         if (integTestTaskName.contains(\"Secure\")) {\n-          Path path = buildDir.toPath()\n+          portsFile = buildDir.toPath()\n             .resolve(\"fixtures\")\n             .resolve(\"secureHaHdfsFixture\")\n             .resolve(\"ports\")\n-          nonInputProperties.systemProperty \"test.hdfs-fixture.ports\", path\n         } else {\n-          Path path = buildDir.toPath()\n+          portsFile = buildDir.toPath()\n             .resolve(\"fixtures\")\n             .resolve(\"haHdfsFixture\")\n             .resolve(\"ports\")\n-          nonInputProperties.systemProperty \"test.hdfs-fixture.ports\", path\n         }\n-        classpath += files(\"$buildDir/fixtures\")\n+        nonInputProperties.systemProperty \"test.hdfs-fixture.ports\", file(\"$portsFileDir/ports\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a4df64b3b51f6577b8d702a0654d92d6b5c0a176"}, "originalPosition": 31}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f138b77593d686878a68311319378d483bcf8d91", "author": {"user": {"login": "mark-vieira", "name": "Mark Vieira"}}, "url": "https://github.com/elastic/elasticsearch/commit/f138b77593d686878a68311319378d483bcf8d91", "committedDate": "2020-02-27T16:09:15Z", "message": "Use better name for fixture resources dir\n\nSigned-off-by: Mark Vieira <portugee@gmail.com>"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1989, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}