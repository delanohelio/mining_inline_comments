{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ4Mzg0NTkx", "number": 59444, "reviewThreads": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xM1QxNzoxNDozOVrOEN6Wzg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMlQyMTo1MToxMlrOERO2Pg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgzMDIzMDU0OnYy", "diffSide": "RIGHT", "path": "plugins/analysis-icu/build.gradle", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xM1QxNzoxNDozOVrOGwx-VA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQyMzoxMjo0OFrOG1NClw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzgwMzYwNA==", "bodyText": "this is needed since the yamlRestRest does not have access to that class", "url": "https://github.com/elastic/elasticsearch/pull/59444#discussion_r453803604", "createdAt": "2020-07-13T17:14:39Z", "author": {"login": "jakelandis"}, "path": "plugins/analysis-icu/build.gradle", "diffHunk": "@@ -18,17 +18,19 @@ import de.thetaphi.forbiddenapis.gradle.CheckForbiddenApis\n  * specific language governing permissions and limitations\n  * under the License.\n  */\n-apply plugin: 'elasticsearch.rest-resources'\n+apply plugin: 'elasticsearch.yaml-rest-test'\n \n esplugin {\n   description 'The ICU Analysis plugin integrates the Lucene ICU module into Elasticsearch, adding ICU-related analysis components.'\n   classname 'org.elasticsearch.plugin.analysis.icu.AnalysisICUPlugin'\n }\n \n-tasks.withType(CheckForbiddenApis).configureEach {\n-  signatures += [\n-    \"com.ibm.icu.text.Collator#getInstance() @ Don't use default locale, use getInstance(ULocale) instead\"\n-  ]\n+tasks.withType(CheckForbiddenApis).configureEach { task ->\n+  if(task.name.contains(\"YamlRestTest\") == false) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dfebc85902546bcc643cffb3979ac4541e14c2ed"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDQ3NTEwMA==", "bodyText": "Maybe this should be explicit, applying the signature to forbiddanApisMain and forbiddenApisTest, rather than all CheckForbiddenApis tasks? We are likely to continue adding more source sets in the future, so having configuration apply to all source sets would be problematic.", "url": "https://github.com/elastic/elasticsearch/pull/59444#discussion_r454475100", "createdAt": "2020-07-14T16:14:22Z", "author": {"login": "rjernst"}, "path": "plugins/analysis-icu/build.gradle", "diffHunk": "@@ -18,17 +18,19 @@ import de.thetaphi.forbiddenapis.gradle.CheckForbiddenApis\n  * specific language governing permissions and limitations\n  * under the License.\n  */\n-apply plugin: 'elasticsearch.rest-resources'\n+apply plugin: 'elasticsearch.yaml-rest-test'\n \n esplugin {\n   description 'The ICU Analysis plugin integrates the Lucene ICU module into Elasticsearch, adding ICU-related analysis components.'\n   classname 'org.elasticsearch.plugin.analysis.icu.AnalysisICUPlugin'\n }\n \n-tasks.withType(CheckForbiddenApis).configureEach {\n-  signatures += [\n-    \"com.ibm.icu.text.Collator#getInstance() @ Don't use default locale, use getInstance(ULocale) instead\"\n-  ]\n+tasks.withType(CheckForbiddenApis).configureEach { task ->\n+  if(task.name.contains(\"YamlRestTest\") == false) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzgwMzYwNA=="}, "originalCommit": {"oid": "dfebc85902546bcc643cffb3979ac4541e14c2ed"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODQ0MTM2Nw==", "bodyText": "\ud83d\udc4d done 5c75412 (#59444) for the main source set (probably not the extra config noise for the test and internalTestCluster source sets)", "url": "https://github.com/elastic/elasticsearch/pull/59444#discussion_r458441367", "createdAt": "2020-07-21T23:12:48Z", "author": {"login": "jakelandis"}, "path": "plugins/analysis-icu/build.gradle", "diffHunk": "@@ -18,17 +18,19 @@ import de.thetaphi.forbiddenapis.gradle.CheckForbiddenApis\n  * specific language governing permissions and limitations\n  * under the License.\n  */\n-apply plugin: 'elasticsearch.rest-resources'\n+apply plugin: 'elasticsearch.yaml-rest-test'\n \n esplugin {\n   description 'The ICU Analysis plugin integrates the Lucene ICU module into Elasticsearch, adding ICU-related analysis components.'\n   classname 'org.elasticsearch.plugin.analysis.icu.AnalysisICUPlugin'\n }\n \n-tasks.withType(CheckForbiddenApis).configureEach {\n-  signatures += [\n-    \"com.ibm.icu.text.Collator#getInstance() @ Don't use default locale, use getInstance(ULocale) instead\"\n-  ]\n+tasks.withType(CheckForbiddenApis).configureEach { task ->\n+  if(task.name.contains(\"YamlRestTest\") == false) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzgwMzYwNA=="}, "originalCommit": {"oid": "dfebc85902546bcc643cffb3979ac4541e14c2ed"}, "originalPosition": 17}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgzNDYxMjExOnYy", "diffSide": "RIGHT", "path": "plugins/analysis-kuromoji/build.gradle", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNFQxNjoxNDo0NlrOGxa-YA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNFQyMDo0NToxOVrOGxkpXw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDQ3NTM2MA==", "bodyText": "Why is this being disabled?", "url": "https://github.com/elastic/elasticsearch/pull/59444#discussion_r454475360", "createdAt": "2020-07-14T16:14:46Z", "author": {"login": "rjernst"}, "path": "plugins/analysis-kuromoji/build.gradle", "diffHunk": "@@ -33,6 +33,8 @@ restResources {\n   }\n }\n \n+integTest.enabled = false", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dfebc85902546bcc643cffb3979ac4541e14c2ed"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDQ4MDIxOA==", "bodyText": "We need a plan for ripping the creation of the integTest task out from the PluginBuildPlugin. Otherwise this is going to be necessary for any plugin project that uses only yaml tests. Or tweak our test conventions logic so it doesn't complain about this scenario.", "url": "https://github.com/elastic/elasticsearch/pull/59444#discussion_r454480218", "createdAt": "2020-07-14T16:21:55Z", "author": {"login": "mark-vieira"}, "path": "plugins/analysis-kuromoji/build.gradle", "diffHunk": "@@ -33,6 +33,8 @@ restResources {\n   }\n }\n \n+integTest.enabled = false", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDQ3NTM2MA=="}, "originalCommit": {"oid": "dfebc85902546bcc643cffb3979ac4541e14c2ed"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDYzMzgyMw==", "bodyText": "I found a need to implement a javaRestTest as part of converting these plugins, so (without hacks) can't finish my conversion to yamlRestTest .. Between javaRestTest, yamlRestTest, and internalClusterTest there is no need for integTest to exist anymore.  I plan to rip out integTest once all of these are implemented.  It won't take long (but my attention is split among a few things at the moment).", "url": "https://github.com/elastic/elasticsearch/pull/59444#discussion_r454633823", "createdAt": "2020-07-14T20:45:19Z", "author": {"login": "jakelandis"}, "path": "plugins/analysis-kuromoji/build.gradle", "diffHunk": "@@ -33,6 +33,8 @@ restResources {\n   }\n }\n \n+integTest.enabled = false", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDQ3NTM2MA=="}, "originalCommit": {"oid": "dfebc85902546bcc643cffb3979ac4541e14c2ed"}, "originalPosition": 13}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgzNDYxNTIzOnYy", "diffSide": "RIGHT", "path": "plugins/analysis-nori/build.gradle", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNFQxNjoxNToyOFrOGxbARQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNFQyMDo0Nzo1N1rOGxku3g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDQ3NTg0NQ==", "bodyText": "Ditto. If we need to disable a test, can we have a comment explaining why it is disabled? Someone coming along in the future will have no reason whether this can/should be re-enabled.", "url": "https://github.com/elastic/elasticsearch/pull/59444#discussion_r454475845", "createdAt": "2020-07-14T16:15:28Z", "author": {"login": "rjernst"}, "path": "plugins/analysis-nori/build.gradle", "diffHunk": "@@ -32,6 +32,9 @@ restResources {\n     includeCore '_common', 'indices', 'index', 'search'\n   }\n }\n+\n+integTest.enabled = false", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dfebc85902546bcc643cffb3979ac4541e14c2ed"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDYzNTIzMA==", "bodyText": "This isn't really disabling a test ... it is to avoid the testing conventions from complaining.  I would prefer to tweak the testing conventions instead of a lot of redunant comments. I can do that in a separate PR (and remove these in this PR)", "url": "https://github.com/elastic/elasticsearch/pull/59444#discussion_r454635230", "createdAt": "2020-07-14T20:47:57Z", "author": {"login": "jakelandis"}, "path": "plugins/analysis-nori/build.gradle", "diffHunk": "@@ -32,6 +32,9 @@ restResources {\n     includeCore '_common', 'indices', 'index', 'search'\n   }\n }\n+\n+integTest.enabled = false", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDQ3NTg0NQ=="}, "originalCommit": {"oid": "dfebc85902546bcc643cffb3979ac4541e14c2ed"}, "originalPosition": 14}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg2NTAzMDk1OnYy", "diffSide": "RIGHT", "path": "plugins/analysis-icu/build.gradle", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMlQyMTo0NjoyOFrOG11ZTg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yM1QxOToyMzoxOVrOG2YY-A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTEwMjU0Mg==", "bodyText": "What's the purpose of this of this intermediary variable?", "url": "https://github.com/elastic/elasticsearch/pull/59444#discussion_r459102542", "createdAt": "2020-07-22T21:46:28Z", "author": {"login": "mark-vieira"}, "path": "plugins/analysis-icu/build.gradle", "diffHunk": "@@ -18,17 +18,20 @@ import de.thetaphi.forbiddenapis.gradle.CheckForbiddenApis\n  * specific language governing permissions and limitations\n  * under the License.\n  */\n-apply plugin: 'elasticsearch.rest-resources'\n+apply plugin: 'elasticsearch.yaml-rest-test'\n+apply plugin: 'elasticsearch.internal-cluster-test'\n \n esplugin {\n   description 'The ICU Analysis plugin integrates the Lucene ICU module into Elasticsearch, adding ICU-related analysis components.'\n   classname 'org.elasticsearch.plugin.analysis.icu.AnalysisICUPlugin'\n }\n \n-tasks.withType(CheckForbiddenApis).configureEach {\n-  signatures += [\n-    \"com.ibm.icu.text.Collator#getInstance() @ Don't use default locale, use getInstance(ULocale) instead\"\n-  ]\n+List<String> forbidden_signatures = new ArrayList<>([", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c89b5de16f777a00a7be76280565debd6014728f"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTExMjYxOA==", "bodyText": "it made sense when i was configuring multiple forbidden[name] ... but now not so much...will fix.", "url": "https://github.com/elastic/elasticsearch/pull/59444#discussion_r459112618", "createdAt": "2020-07-22T22:11:01Z", "author": {"login": "jakelandis"}, "path": "plugins/analysis-icu/build.gradle", "diffHunk": "@@ -18,17 +18,20 @@ import de.thetaphi.forbiddenapis.gradle.CheckForbiddenApis\n  * specific language governing permissions and limitations\n  * under the License.\n  */\n-apply plugin: 'elasticsearch.rest-resources'\n+apply plugin: 'elasticsearch.yaml-rest-test'\n+apply plugin: 'elasticsearch.internal-cluster-test'\n \n esplugin {\n   description 'The ICU Analysis plugin integrates the Lucene ICU module into Elasticsearch, adding ICU-related analysis components.'\n   classname 'org.elasticsearch.plugin.analysis.icu.AnalysisICUPlugin'\n }\n \n-tasks.withType(CheckForbiddenApis).configureEach {\n-  signatures += [\n-    \"com.ibm.icu.text.Collator#getInstance() @ Don't use default locale, use getInstance(ULocale) instead\"\n-  ]\n+List<String> forbidden_signatures = new ArrayList<>([", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTEwMjU0Mg=="}, "originalCommit": {"oid": "c89b5de16f777a00a7be76280565debd6014728f"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTY3NTg5Ng==", "bodyText": "done 849d19d", "url": "https://github.com/elastic/elasticsearch/pull/59444#discussion_r459675896", "createdAt": "2020-07-23T19:23:19Z", "author": {"login": "jakelandis"}, "path": "plugins/analysis-icu/build.gradle", "diffHunk": "@@ -18,17 +18,20 @@ import de.thetaphi.forbiddenapis.gradle.CheckForbiddenApis\n  * specific language governing permissions and limitations\n  * under the License.\n  */\n-apply plugin: 'elasticsearch.rest-resources'\n+apply plugin: 'elasticsearch.yaml-rest-test'\n+apply plugin: 'elasticsearch.internal-cluster-test'\n \n esplugin {\n   description 'The ICU Analysis plugin integrates the Lucene ICU module into Elasticsearch, adding ICU-related analysis components.'\n   classname 'org.elasticsearch.plugin.analysis.icu.AnalysisICUPlugin'\n }\n \n-tasks.withType(CheckForbiddenApis).configureEach {\n-  signatures += [\n-    \"com.ibm.icu.text.Collator#getInstance() @ Don't use default locale, use getInstance(ULocale) instead\"\n-  ]\n+List<String> forbidden_signatures = new ArrayList<>([", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTEwMjU0Mg=="}, "originalCommit": {"oid": "c89b5de16f777a00a7be76280565debd6014728f"}, "originalPosition": 17}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg2NTAzMzQ4OnYy", "diffSide": "RIGHT", "path": "plugins/examples/custom-settings/build.gradle", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMlQyMTo0NzoyM1rOG11a7A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMlQyMjowOToyOFrOG11-gQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTEwMjk1Ng==", "bodyText": "Is there a reason this needs to be all and not just yamlRestTest? Isn't there just one test cluster in play here?", "url": "https://github.com/elastic/elasticsearch/pull/59444#discussion_r459102956", "createdAt": "2020-07-22T21:47:23Z", "author": {"login": "mark-vieira"}, "path": "plugins/examples/custom-settings/build.gradle", "diffHunk": "@@ -28,7 +27,8 @@ esplugin {\n   noticeFile rootProject.file('NOTICE.txt')\n }\n \n-testClusters.integTest {\n+testClusters.all {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c89b5de16f777a00a7be76280565debd6014728f"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTExMjA2NQ==", "bodyText": "I figured the best example would be to use all , I think that should be the go-to configuration unless you need task specific config. (given the ease and cache behavior). Not a strong opinion however.", "url": "https://github.com/elastic/elasticsearch/pull/59444#discussion_r459112065", "createdAt": "2020-07-22T22:09:28Z", "author": {"login": "jakelandis"}, "path": "plugins/examples/custom-settings/build.gradle", "diffHunk": "@@ -28,7 +27,8 @@ esplugin {\n   noticeFile rootProject.file('NOTICE.txt')\n }\n \n-testClusters.integTest {\n+testClusters.all {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTEwMjk1Ng=="}, "originalCommit": {"oid": "c89b5de16f777a00a7be76280565debd6014728f"}, "originalPosition": 16}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg2NTAzNTQ4OnYy", "diffSide": "RIGHT", "path": "plugins/examples/rest-handler/build.gradle", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMlQyMTo0ODowMlrOG11cHQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yM1QxOToyMzoxMVrOG2YYoA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTEwMzI2MQ==", "bodyText": "Should be dependsOn sourceSets.javaRestTest.runtimeClasspath.", "url": "https://github.com/elastic/elasticsearch/pull/59444#discussion_r459103261", "createdAt": "2020-07-22T21:48:02Z", "author": {"login": "mark-vieira"}, "path": "plugins/examples/rest-handler/build.gradle", "diffHunk": "@@ -34,21 +34,16 @@ esplugin {\n test.enabled = false\n \n tasks.register(\"exampleFixture\", org.elasticsearch.gradle.test.AntFixture) {\n-  dependsOn testClasses\n-  env 'CLASSPATH', \"${-> project.sourceSets.test.runtimeClasspath.asPath}\"\n+  dependsOn javaRestTestClasses", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c89b5de16f777a00a7be76280565debd6014728f"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTY3NTgwOA==", "bodyText": "done 849d19d", "url": "https://github.com/elastic/elasticsearch/pull/59444#discussion_r459675808", "createdAt": "2020-07-23T19:23:11Z", "author": {"login": "jakelandis"}, "path": "plugins/examples/rest-handler/build.gradle", "diffHunk": "@@ -34,21 +34,16 @@ esplugin {\n test.enabled = false\n \n tasks.register(\"exampleFixture\", org.elasticsearch.gradle.test.AntFixture) {\n-  dependsOn testClasses\n-  env 'CLASSPATH', \"${-> project.sourceSets.test.runtimeClasspath.asPath}\"\n+  dependsOn javaRestTestClasses", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTEwMzI2MQ=="}, "originalCommit": {"oid": "c89b5de16f777a00a7be76280565debd6014728f"}, "originalPosition": 18}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg2NTA0MjYzOnYy", "diffSide": "RIGHT", "path": "plugins/examples/security-authorization-engine/build.gradle", "isResolved": false, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMlQyMTo1MDoyN1rOG11gbg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yM1QxOToyMjozMVrOG2YXTQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTEwNDM2Ng==", "bodyText": "Why is this necessary here but not done by default in the java rest test plugin?\nSince this is an example project we should use idiomatic patterns as much as possible. If this is required because of some kind of nasty test implementation we should refactor this.\n@rjernst thoughts? As I understand it a Java REST test should be no different than a YAML one in that the only interactions should be via the REST API, therefore there should be no need for plugin code itself to be on the test classpath.", "url": "https://github.com/elastic/elasticsearch/pull/59444#discussion_r459104366", "createdAt": "2020-07-22T21:50:27Z", "author": {"login": "mark-vieira"}, "path": "plugins/examples/security-authorization-engine/build.gradle", "diffHunk": "@@ -11,19 +12,24 @@ esplugin {\n   noticeFile rootProject.file('NOTICE.txt')\n }\n \n+// let the javaRestTest see the classpath of main\n+GradleUtils.extendSourceSet(project, \"main\", \"javaRestTest\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c89b5de16f777a00a7be76280565debd6014728f"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTExNTk4NQ==", "bodyText": "The examples are not exactly idomatic to start with, they could use some updating. In this case the test really does need to see the main classes, which should probably be converted to a ESSingleNodeTestCase or the tests written as pure black box ?  I can log an issue, but probably outside the scope of this change.", "url": "https://github.com/elastic/elasticsearch/pull/59444#discussion_r459115985", "createdAt": "2020-07-22T22:19:33Z", "author": {"login": "jakelandis"}, "path": "plugins/examples/security-authorization-engine/build.gradle", "diffHunk": "@@ -11,19 +12,24 @@ esplugin {\n   noticeFile rootProject.file('NOTICE.txt')\n }\n \n+// let the javaRestTest see the classpath of main\n+GradleUtils.extendSourceSet(project, \"main\", \"javaRestTest\")", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTEwNDM2Ng=="}, "originalCommit": {"oid": "c89b5de16f777a00a7be76280565debd6014728f"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTEyMTc1Ng==", "bodyText": "Yeah, I don't like the idea of GradleUtils being used in a plugin example. That's not intended to be \"public\". Worst case if the tests are structure such that they strictly need those classes, we should just extend the source set in the build script explicilty rather than leverage this utility method.", "url": "https://github.com/elastic/elasticsearch/pull/59444#discussion_r459121756", "createdAt": "2020-07-22T22:34:37Z", "author": {"login": "mark-vieira"}, "path": "plugins/examples/security-authorization-engine/build.gradle", "diffHunk": "@@ -11,19 +12,24 @@ esplugin {\n   noticeFile rootProject.file('NOTICE.txt')\n }\n \n+// let the javaRestTest see the classpath of main\n+GradleUtils.extendSourceSet(project, \"main\", \"javaRestTest\")", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTEwNDM2Ng=="}, "originalCommit": {"oid": "c89b5de16f777a00a7be76280565debd6014728f"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTY3NTQ2OQ==", "bodyText": "For this case I am able to simply add the dependency to the main runtimeClasspath. ef34668\njavaRestTestImplementation project.sourceSets.main.runtimeClasspath", "url": "https://github.com/elastic/elasticsearch/pull/59444#discussion_r459675469", "createdAt": "2020-07-23T19:22:31Z", "author": {"login": "jakelandis"}, "path": "plugins/examples/security-authorization-engine/build.gradle", "diffHunk": "@@ -11,19 +12,24 @@ esplugin {\n   noticeFile rootProject.file('NOTICE.txt')\n }\n \n+// let the javaRestTest see the classpath of main\n+GradleUtils.extendSourceSet(project, \"main\", \"javaRestTest\")", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTEwNDM2Ng=="}, "originalCommit": {"oid": "c89b5de16f777a00a7be76280565debd6014728f"}, "originalPosition": 15}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg2NTA0NTEwOnYy", "diffSide": "RIGHT", "path": "plugins/transport-nio/build.gradle", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMlQyMTo1MToxMlrOG11h1g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMlQyMjoxMzo0MFrOG12EZg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTEwNDcyNg==", "bodyText": "I thought we ditched the need for this?", "url": "https://github.com/elastic/elasticsearch/pull/59444#discussion_r459104726", "createdAt": "2020-07-22T21:51:12Z", "author": {"login": "mark-vieira"}, "path": "plugins/transport-nio/build.gradle", "diffHunk": "@@ -19,12 +19,15 @@ import org.elasticsearch.gradle.info.BuildParams\n  * under the License.\n  */\n apply plugin: \"elasticsearch.publish\"\n+apply plugin: 'elasticsearch.internal-cluster-test'\n \n esplugin {\n   description 'The nio transport.'\n   classname 'org.elasticsearch.transport.nio.NioTransportPlugin'\n }\n \n+// integTest have been converted to internalClusterTest \n+integTest.enabled = false", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c89b5de16f777a00a7be76280565debd6014728f"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTExMzU3NA==", "bodyText": "This one is special such neither javaRestTest or yamlRestTest is applied here (only internalClusterTest). The auto-disable only works from the java/yamlRestTest application since there are some other projects with existing internalClusterTest and don't want to auto disable integTest for those. These should be pretty rare, and can be deleted once integTest is gone.", "url": "https://github.com/elastic/elasticsearch/pull/59444#discussion_r459113574", "createdAt": "2020-07-22T22:13:40Z", "author": {"login": "jakelandis"}, "path": "plugins/transport-nio/build.gradle", "diffHunk": "@@ -19,12 +19,15 @@ import org.elasticsearch.gradle.info.BuildParams\n  * under the License.\n  */\n apply plugin: \"elasticsearch.publish\"\n+apply plugin: 'elasticsearch.internal-cluster-test'\n \n esplugin {\n   description 'The nio transport.'\n   classname 'org.elasticsearch.transport.nio.NioTransportPlugin'\n }\n \n+// integTest have been converted to internalClusterTest \n+integTest.enabled = false", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTEwNDcyNg=="}, "originalCommit": {"oid": "c89b5de16f777a00a7be76280565debd6014728f"}, "originalPosition": 12}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2350, "cost": 1, "resetAt": "2021-11-12T11:57:46Z"}}}