{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE4MzE5MTg0", "number": 64845, "title": "SQL:Fix the return type problem in the sign function", "bodyText": "Signed-off-by: mantuliu 240951888@qq.com\nIn the Class Sign, DataType is DataTypes.INTEGER. The source code is as follows\uff1a\n    @Override\n    public DataType dataType() {\n        return DataTypes.INTEGER;\n    }\n\nBut In the Class MathProcessor, the source code of SIGN((Object l),  Parameter and return value types are the same.Therefore, when using double or float parameters to test, there is a little problem, the test method is like the following curl :\ncurl -XPOST 127.0.0.1:9200/_sql -d \"{\\\"query\\\":\\\"select  SIGN(1.0) \\\"}\" -H 'Content-Type: application/json'\n\n\nThe result is:\n{\"columns\":[{\"name\":\"SIGN(1.0)\",\"type\":\"integer\"}],\"rows\":[[1.0]]}\n\nThe result value is \"1.0\", but the type is \"integer\".  The above test is based on the master branch", "createdAt": "2020-11-10T08:38:08Z", "url": "https://github.com/elastic/elasticsearch/pull/64845", "merged": true, "mergeCommit": {"oid": "aa78301e71f3ff6372e41b9849650488d27d9a22"}, "closed": true, "closedAt": "2020-11-11T15:17:51Z", "author": {"login": "sourcelliu"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdbD1ZpAH2gAyNTE4MzE5MTg0OmJmMTY2NTlhYzkwYjcyYzcwNTU3NzM5MGVhZmZhMzI3YzY0MTQzMWE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdbeZ2vgFqTUyODE5NDIyOA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "bf16659ac90b72c705577390eaffa327c641431a", "author": {"user": {"login": "sourcelliu", "name": null}}, "url": "https://github.com/elastic/elasticsearch/commit/bf16659ac90b72c705577390eaffa327c641431a", "committedDate": "2020-11-10T07:01:14Z", "message": "SQL:Fix the return type problem in the sign function\n\nSigned-off-by: mantuliu <240951888@qq.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "bbad81a5faddd60d8072cffc225c5ecc9d3cd96d", "author": {"user": {"login": "sourcelliu", "name": null}}, "url": "https://github.com/elastic/elasticsearch/commit/bbad81a5faddd60d8072cffc225c5ecc9d3cd96d", "committedDate": "2020-11-10T15:25:14Z", "message": "SQL:Fix the return type problem in the sign function\n\nSigned-off-by: mantuliu <240951888@qq.com>"}, "afterCommit": {"oid": "bf16659ac90b72c705577390eaffa327c641431a", "author": {"user": {"login": "sourcelliu", "name": null}}, "url": "https://github.com/elastic/elasticsearch/commit/bf16659ac90b72c705577390eaffa327c641431a", "committedDate": "2020-11-10T07:01:14Z", "message": "SQL:Fix the return type problem in the sign function\n\nSigned-off-by: mantuliu <240951888@qq.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI4MDQ3NTY1", "url": "https://github.com/elastic/elasticsearch/pull/64845#pullrequestreview-528047565", "createdAt": "2020-11-11T10:28:29Z", "commit": {"oid": "bf16659ac90b72c705577390eaffa327c641431a"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMVQxMDoyODoyOVrOHxHRwQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMVQxMDoyODoyOVrOHxHRwQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTI2MTUwNQ==", "bodyText": "Since the assertion values are the same, please put the values in an array and iterate over them:\nList<Number> negative = asList(-42, Long.value(-42), etc...)\nfor (Number number : negative) {\n\tNumber result = MathOperations.SIGN.apply(number);\n    assertEquals(Integer.class, result.getClass());\n    assertEquals(-1, result);\n}\n...", "url": "https://github.com/elastic/elasticsearch/pull/64845#discussion_r521261505", "createdAt": "2020-11-11T10:28:29Z", "author": {"login": "costin"}, "path": "x-pack/plugin/sql/src/test/java/org/elasticsearch/xpack/sql/expression/function/scalar/math/MathOperationTests.java", "diffHunk": "@@ -35,4 +35,25 @@ public void testAbsPreservesType() {\n         assertEquals(42f, MathOperation.ABS.apply(-42f));\n         assertEquals(42d, MathOperation.ABS.apply(-42d));\n     }\n+\n+    public void testSignIntegerType() {\n+        assertEquals(-1, MathOperation.SIGN.apply((byte) -42));\n+        assertEquals( -1, MathOperation.SIGN.apply((short) -42));\n+        assertEquals(-1, MathOperation.SIGN.apply(-42));\n+        assertEquals( -1, MathOperation.SIGN.apply((long) -42));\n+        assertEquals(-1, MathOperation.SIGN.apply(-42.0f));\n+        assertEquals(-1, MathOperation.SIGN.apply(-42.0d));\n+        assertEquals( 1, MathOperation.SIGN.apply((byte) 42));\n+        assertEquals( 1, MathOperation.SIGN.apply((short) 42));\n+        assertEquals(1, MathOperation.SIGN.apply(42));\n+        assertEquals( 1, MathOperation.SIGN.apply((long) 42));\n+        assertEquals(1, MathOperation.SIGN.apply(42.0f));\n+        assertEquals(1, MathOperation.SIGN.apply(42.0d));\n+        assertEquals(0, MathOperation.SIGN.apply((byte) 0));\n+        assertEquals( 0, MathOperation.SIGN.apply((short) 0));\n+        assertEquals(0, MathOperation.SIGN.apply(0));\n+        assertEquals( 0, MathOperation.SIGN.apply((long) 0));\n+        assertEquals(0, MathOperation.SIGN.apply(-0.0f));\n+        assertEquals(0, MathOperation.SIGN.apply(-0.0d));\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bf16659ac90b72c705577390eaffa327c641431a"}, "originalPosition": 24}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "893b9ab8123f5f4954989408ef85afebfdd16399", "author": {"user": {"login": "sourcelliu", "name": null}}, "url": "https://github.com/elastic/elasticsearch/commit/893b9ab8123f5f4954989408ef85afebfdd16399", "committedDate": "2020-11-11T12:41:39Z", "message": "Use iterative method to optimize test\n\nSigned-off-by: mantuliu <240951888@qq.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI4MTU3MDIz", "url": "https://github.com/elastic/elasticsearch/pull/64845#pullrequestreview-528157023", "createdAt": "2020-11-11T13:10:10Z", "commit": {"oid": "893b9ab8123f5f4954989408ef85afebfdd16399"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMVQxMzoxMDoxMVrOHxMfNA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMVQxMzoxMDoyMlrOHxMfkw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTM0Njg2OA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                            return (int)Math.signum((Double) l);\n          \n          \n            \n                            return (int) Math.signum((Double) l);", "url": "https://github.com/elastic/elasticsearch/pull/64845#discussion_r521346868", "createdAt": "2020-11-11T13:10:11Z", "author": {"login": "matriv"}, "path": "x-pack/plugin/sql/src/main/java/org/elasticsearch/xpack/sql/expression/function/scalar/math/MathProcessor.java", "diffHunk": "@@ -77,26 +77,13 @@\n                 Randomness.get().nextDouble(), true),\n         SIGN((Object l) -> {\n             if (l instanceof Double) {\n-                return Math.signum((Double) l);\n+                return (int)Math.signum((Double) l);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "893b9ab8123f5f4954989408ef85afebfdd16399"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTM0Njk2Mw==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                            return (int)Math.signum((Float) l);\n          \n          \n            \n                            return (int) Math.signum((Float) l);", "url": "https://github.com/elastic/elasticsearch/pull/64845#discussion_r521346963", "createdAt": "2020-11-11T13:10:22Z", "author": {"login": "matriv"}, "path": "x-pack/plugin/sql/src/main/java/org/elasticsearch/xpack/sql/expression/function/scalar/math/MathProcessor.java", "diffHunk": "@@ -77,26 +77,13 @@\n                 Randomness.get().nextDouble(), true),\n         SIGN((Object l) -> {\n             if (l instanceof Double) {\n-                return Math.signum((Double) l);\n+                return (int)Math.signum((Double) l);\n             }\n             if (l instanceof Float) {\n-                return Math.signum((Float) l);\n+                return (int)Math.signum((Float) l);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "893b9ab8123f5f4954989408ef85afebfdd16399"}, "originalPosition": 9}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3a80ad5a39ba83f0d7b1f4c8caa6d5cfbe29713c", "author": {"user": {"login": "sourcelliu", "name": null}}, "url": "https://github.com/elastic/elasticsearch/commit/3a80ad5a39ba83f0d7b1f4c8caa6d5cfbe29713c", "committedDate": "2020-11-11T13:16:06Z", "message": "formatting fix.\n\nCo-authored-by: Marios Trivyzas <matriv@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1419c7c4fea28592c5d3ed0f10997543934bfa71", "author": {"user": {"login": "sourcelliu", "name": null}}, "url": "https://github.com/elastic/elasticsearch/commit/1419c7c4fea28592c5d3ed0f10997543934bfa71", "committedDate": "2020-11-11T13:16:37Z", "message": "formatting fix.\n\nCo-authored-by: Marios Trivyzas <matriv@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e7cbc5848fbc39682563cd00936ebb847794c7ae", "author": {"user": {"login": "sourcelliu", "name": null}}, "url": "https://github.com/elastic/elasticsearch/commit/e7cbc5848fbc39682563cd00936ebb847794c7ae", "committedDate": "2020-11-11T13:20:27Z", "message": "formatting fix.\n\nSigned-off-by: mantuliu <240951888@qq.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI4MTk0MjI4", "url": "https://github.com/elastic/elasticsearch/pull/64845#pullrequestreview-528194228", "createdAt": "2020-11-11T13:58:35Z", "commit": {"oid": "e7cbc5848fbc39682563cd00936ebb847794c7ae"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1126, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}