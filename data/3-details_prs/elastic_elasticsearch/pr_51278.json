{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY1NjA3OTU5", "number": 51278, "title": "Split Painless AST into a \"user\" tree and an \"ir\" tree", "bodyText": "Background:\n\nPainless has accumulated literal years of technical debt. The current AST handles all semantic checking and code generation. This AST contains a great deal of mutable state behaving as local input and output. The semantic phase changes the current AST tree structure for type and method resolution along with implicit casting and constant folding. The culmination of this is a great deal of mutable state with numerous edge cases making the current AST difficult to change/improve and particularly fragile to manage moving forward.\n\nGoals:\n\nBy splitting the AST into two separate trees we can eventually make the \"user\" tree an immutable representation of the code the user actually typed in. The \"user\" tree then runs through a semantic phase from which an \"ir\" tree is generated. The \"ir\" tree is mutable for additional external phases that can either add additional state/features or optimization through \"ir\" tree manipulation.\nPhases manipulating the \"ir\" tree are much easier to reason about since we will guarantee that the \"ir\" tree generated from the \"user\" tree is semantically correct. Each additional phase will run under the assumption that the \"ir\" tree remains semantically correct. In turn, we can then decouple customized logic from the \"ir\" tree such as additional exceptions to encapsulate a script's execute method, so the \"ir\" tree nodes are relatively generic. Instead, an additional phase would add exception nodes to wrap the execute method. Each of these phases has the potential to be per script context allowing for further optimization phases such as possibly using read only variables to reduce has lookups from Maps, or method folding for SQL, etc.\nWhile it is possible to update the existing AST to accommodate for some optimizations, for the reasons outlined above it is at best incredibly difficult as maintaining correctness becomes even harder with each additional change.\n\nWhat this PR does:\n\nThis PR takes the existing Painless AST responsible for both semantic checking and writing Java ASM and splits it into two separate trees. The first tree, termed the \"user\" tree, is now responsible for semantic checking and generation of a second \"ir\" tree. The second tree, termed the \"ir\" tree, is responsible for generating the Java ASM bytecode. This change takes the nodes in nearly a 1:1 ratio with the exception of some improved super classes for the \"ir\" nodes to help with reduction of boilerplate getters/setters. The Painless AST remains mutable for this PR. This change simply takes the existing AST nodes, splits them into a \"user\" node and an equivalent \"ir\" node. Each \"user\" node will generate it's equivalent \"ir\" node during a separate phase, but eventually this will be combined into a single phase.\n\nThis PR is excessively large, what's going on?:\n\nThis is the minimum (or very close to it) required to effectively split the trees, and have them actually wired together. There is a huge amount of boilerplate accounting for the large increase in number of lines mostly due to making the \"ir\" nodes in a builder-style format, and then wiring each \"user\" node to generate an equivalent \"ir\" node. Each piece of tree structure and data in the \"ir\" nodes is available for manipulation to allow for maximum flexibility during external phases. This also allows the \"user\" tree to easily generate \"ir\" nodes as it gathers each piece of data necessary for code generation.\nThe code here is a bit raw, but this is an important first step to achieve the goals outlined above. The code in this PR generates scripts that are identical to scripts generated by the current code.\nGiven that this really is giant, one alternative strategy to break this up would be to check in 10-20 \"ir\" nodes at a time through 5-10 PRs leaving them isolated and inactive, then have a PR to wire the two trees together.", "createdAt": "2020-01-22T00:47:10Z", "url": "https://github.com/elastic/elasticsearch/pull/51278", "merged": true, "mergeCommit": {"oid": "70729f37d47e62c404c965d61da2ddbcaf29f18e"}, "closed": true, "closedAt": "2020-01-24T16:14:01Z", "author": {"login": "jdconrad"}, "timelineItems": {"totalCount": 33, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb837c3AH2gAyMzY1NjA3OTU5OmNlYWZkN2MxMDA5ZmI1MGEwMTZhOTc1MzhkZDc2YzI1YTI4OWQxOTE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABb9RhzWgFqTM0NzYzMTY0MQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "ceafd7c1009fb50a016a97538dd76c25a289d191", "author": {"user": {"login": "jdconrad", "name": "Jack Conradson"}}, "url": "https://github.com/elastic/elasticsearch/commit/ceafd7c1009fb50a016a97538dd76c25a289d191", "committedDate": "2020-01-22T16:00:06Z", "message": "copy nodes to split ir and ast"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bf21ab1fbb16317e02304d5103f474e5e211fb6a", "author": {"user": {"login": "jdconrad", "name": "Jack Conradson"}}, "url": "https://github.com/elastic/elasticsearch/commit/bf21ab1fbb16317e02304d5103f474e5e211fb6a", "committedDate": "2020-01-22T16:00:06Z", "message": "converted some ast nodes to ir nodes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "71add6c14c61d8635ff062306b535f5c73368239", "author": {"user": {"login": "jdconrad", "name": "Jack Conradson"}}, "url": "https://github.com/elastic/elasticsearch/commit/71add6c14c61d8635ff062306b535f5c73368239", "committedDate": "2020-01-22T16:00:06Z", "message": "converted more nodes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b6ccc7821c74112b5531526a5b684f19d95502a9", "author": {"user": {"login": "jdconrad", "name": "Jack Conradson"}}, "url": "https://github.com/elastic/elasticsearch/commit/b6ccc7821c74112b5531526a5b684f19d95502a9", "committedDate": "2020-01-22T16:00:06Z", "message": "checkpoint"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "754d2d9ca1748f2bf6e2fda35dda6d61b2e3550c", "author": {"user": {"login": "jdconrad", "name": "Jack Conradson"}}, "url": "https://github.com/elastic/elasticsearch/commit/754d2d9ca1748f2bf6e2fda35dda6d61b2e3550c", "committedDate": "2020-01-22T16:00:06Z", "message": "converted more nodes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fd966149d3fb1a15ffe18086e5e8dbe420e6766c", "author": {"user": {"login": "jdconrad", "name": "Jack Conradson"}}, "url": "https://github.com/elastic/elasticsearch/commit/fd966149d3fb1a15ffe18086e5e8dbe420e6766c", "committedDate": "2020-01-22T16:00:06Z", "message": "completion of expression node conversion"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b6c7d8ea2a065473abbdb11904adf10fad1f7e62", "author": {"user": {"login": "jdconrad", "name": "Jack Conradson"}}, "url": "https://github.com/elastic/elasticsearch/commit/b6c7d8ea2a065473abbdb11904adf10fad1f7e62", "committedDate": "2020-01-22T16:00:06Z", "message": "convert all prefix nodes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f68872a5a542c0ea88bba8c2d6f2f98cb1e4fca1", "author": {"user": {"login": "jdconrad", "name": "Jack Conradson"}}, "url": "https://github.com/elastic/elasticsearch/commit/f68872a5a542c0ea88bba8c2d6f2f98cb1e4fca1", "committedDate": "2020-01-22T16:00:06Z", "message": "partially changed node data to user getters/setters"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c18a18248003c20086b6452e37f6d43e8751cf46", "author": {"user": {"login": "jdconrad", "name": "Jack Conradson"}}, "url": "https://github.com/elastic/elasticsearch/commit/c18a18248003c20086b6452e37f6d43e8751cf46", "committedDate": "2020-01-22T16:00:06Z", "message": "partially changed data to be mutable"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0bcc0c7cdecd12f268295b4f23af673195dea673", "author": {"user": {"login": "jdconrad", "name": "Jack Conradson"}}, "url": "https://github.com/elastic/elasticsearch/commit/0bcc0c7cdecd12f268295b4f23af673195dea673", "committedDate": "2020-01-22T16:00:06Z", "message": "converted more nodes to ir"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "58f8e6ddb64ee74a404c8ef9ea1f7fb841973622", "author": {"user": {"login": "jdconrad", "name": "Jack Conradson"}}, "url": "https://github.com/elastic/elasticsearch/commit/58f8e6ddb64ee74a404c8ef9ea1f7fb841973622", "committedDate": "2020-01-22T16:00:06Z", "message": "completeion of first pass of splitting nodes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6349c67d8916660f509da820133bf7e458281872", "author": {"user": {"login": "jdconrad", "name": "Jack Conradson"}}, "url": "https://github.com/elastic/elasticsearch/commit/6349c67d8916660f509da820133bf7e458281872", "committedDate": "2020-01-22T16:00:06Z", "message": "fixes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ab969e4c82b68c76c4dc37285a5fc4f6ea9ac5b8", "author": {"user": {"login": "jdconrad", "name": "Jack Conradson"}}, "url": "https://github.com/elastic/elasticsearch/commit/ab969e4c82b68c76c4dc37285a5fc4f6ea9ac5b8", "committedDate": "2020-01-22T16:00:07Z", "message": "fix subtle issue with unboxing def"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "86dc9a7bcb7b0daecdc91c8580767b0ce9df8286", "author": {"user": {"login": "jdconrad", "name": "Jack Conradson"}}, "url": "https://github.com/elastic/elasticsearch/commit/86dc9a7bcb7b0daecdc91c8580767b0ce9df8286", "committedDate": "2020-01-22T16:00:07Z", "message": "move script root"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6149e43955a88ee7a397fb64fd3cb5539dd72498", "author": {"user": {"login": "jdconrad", "name": "Jack Conradson"}}, "url": "https://github.com/elastic/elasticsearch/commit/6149e43955a88ee7a397fb64fd3cb5539dd72498", "committedDate": "2020-01-22T16:00:07Z", "message": "remove class"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "32b8b8bc78197b7d3fa2d313b3a46a3b02fd849b", "author": {"user": {"login": "jdconrad", "name": "Jack Conradson"}}, "url": "https://github.com/elastic/elasticsearch/commit/32b8b8bc78197b7d3fa2d313b3a46a3b02fd849b", "committedDate": "2020-01-22T16:00:07Z", "message": "add setters with covariant return types for all nodes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a9118e7068bfa5713fdaebf46799b62d60ac02fe", "author": {"user": {"login": "jdconrad", "name": "Jack Conradson"}}, "url": "https://github.com/elastic/elasticsearch/commit/a9118e7068bfa5713fdaebf46799b62d60ac02fe", "committedDate": "2020-01-22T16:00:07Z", "message": "build ir tree from ast"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "058c416ac501ba6ec386cdeab5d998413ae46ca4", "author": {"user": {"login": "jdconrad", "name": "Jack Conradson"}}, "url": "https://github.com/elastic/elasticsearch/commit/058c416ac501ba6ec386cdeab5d998413ae46ca4", "committedDate": "2020-01-22T16:00:07Z", "message": "fix bugs/tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e4fcce22db3dc2b05199978846c4eb0bd03d0e2c", "author": {"user": {"login": "jdconrad", "name": "Jack Conradson"}}, "url": "https://github.com/elastic/elasticsearch/commit/e4fcce22db3dc2b05199978846c4eb0bd03d0e2c", "committedDate": "2020-01-22T16:00:07Z", "message": "remove bad refactor of initializer to initializerNode"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "5439c0c05a8df5ecef971c97ace0fbb1066e4781", "author": {"user": {"login": "jdconrad", "name": "Jack Conradson"}}, "url": "https://github.com/elastic/elasticsearch/commit/5439c0c05a8df5ecef971c97ace0fbb1066e4781", "committedDate": "2020-01-21T21:03:41Z", "message": "remove bad refactor of initializer to initializerNode"}, "afterCommit": {"oid": "e4fcce22db3dc2b05199978846c4eb0bd03d0e2c", "author": {"user": {"login": "jdconrad", "name": "Jack Conradson"}}, "url": "https://github.com/elastic/elasticsearch/commit/e4fcce22db3dc2b05199978846c4eb0bd03d0e2c", "committedDate": "2020-01-22T16:00:07Z", "message": "remove bad refactor of initializer to initializerNode"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ2ODAyNjI4", "url": "https://github.com/elastic/elasticsearch/pull/51278#pullrequestreview-346802628", "createdAt": "2020-01-22T18:22:15Z", "commit": {"oid": "e4fcce22db3dc2b05199978846c4eb0bd03d0e2c"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0222ff546ce5105fdf3fc03d364ab6e8c9b8f39a", "author": {"user": {"login": "jdconrad", "name": "Jack Conradson"}}, "url": "https://github.com/elastic/elasticsearch/commit/0222ff546ce5105fdf3fc03d364ab6e8c9b8f39a", "committedDate": "2020-01-22T22:53:00Z", "message": "remove pseudo builder setters from ir nodes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fbe2745277016a3aa683fc6e60ed602970670f98", "author": {"user": {"login": "jdconrad", "name": "Jack Conradson"}}, "url": "https://github.com/elastic/elasticsearch/commit/fbe2745277016a3aa683fc6e60ed602970670f98", "committedDate": "2020-01-23T00:30:17Z", "message": "modify user nodes to work with ir setters"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8a0a65ce0645ff786cf882d605fe16ba99d93d56", "author": {"user": {"login": "jdconrad", "name": "Jack Conradson"}}, "url": "https://github.com/elastic/elasticsearch/commit/8a0a65ce0645ff786cf882d605fe16ba99d93d56", "committedDate": "2020-01-23T00:36:56Z", "message": "fix instanceof missing node"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ3NTI0MjQw", "url": "https://github.com/elastic/elasticsearch/pull/51278#pullrequestreview-347524240", "createdAt": "2020-01-23T18:44:29Z", "commit": {"oid": "8a0a65ce0645ff786cf882d605fe16ba99d93d56"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yM1QxODo0NDoyOVrOFhIvlg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yM1QxODo0NDoyOVrOFhIvlg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDI5MDU4Mg==", "bodyText": "What's happening here?", "url": "https://github.com/elastic/elasticsearch/pull/51278#discussion_r370290582", "createdAt": "2020-01-23T18:44:29Z", "author": {"login": "stu-elastic"}, "path": "modules/lang-painless/src/main/java/org/elasticsearch/painless/PainlessScriptEngine.java", "diffHunk": "@@ -340,7 +341,7 @@ public Loader run() {\n         GeneratorAdapter deterAdapter = new GeneratorAdapter(Opcodes.ASM5, isResultDeterministic,\n             writer.visitMethod(Opcodes.ACC_PUBLIC, methodName, isResultDeterministic.getDescriptor(), null, null));\n         deterAdapter.visitCode();\n-        deterAdapter.push(scriptRoot.deterministic);\n+        deterAdapter.push(scriptRoot.isDeterministic());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8a0a65ce0645ff786cf882d605fe16ba99d93d56"}, "originalPosition": 13}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ3NTI2MTEy", "url": "https://github.com/elastic/elasticsearch/pull/51278#pullrequestreview-347526112", "createdAt": "2020-01-23T18:47:32Z", "commit": {"oid": "8a0a65ce0645ff786cf882d605fe16ba99d93d56"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yM1QxODo0NzozM1rOFhI1Zw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yM1QxODo0NzozM1rOFhI1Zw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDI5MjA3MQ==", "bodyText": "These are the actual arguments, correct? If so, consider renaming to arguments.  It's a bit confusing to have an ArgumentsNode type with field argumentNodes.", "url": "https://github.com/elastic/elasticsearch/pull/51278#discussion_r370292071", "createdAt": "2020-01-23T18:47:33Z", "author": {"login": "stu-elastic"}, "path": "modules/lang-painless/src/main/java/org/elasticsearch/painless/ir/ArgumentsNode.java", "diffHunk": "@@ -0,0 +1,44 @@\n+/*\n+ * Licensed to Elasticsearch under one or more contributor\n+ * license agreements. See the NOTICE file distributed with\n+ * this work for additional information regarding copyright\n+ * ownership. Elasticsearch licenses this file to you under\n+ * the Apache License, Version 2.0 (the \"License\"); you may\n+ * not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *    http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.elasticsearch.painless.ir;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+\n+public abstract class ArgumentsNode extends ExpressionNode {\n+\n+    /* ---- begin tree structure ---- */\n+\n+    private final List<ExpressionNode> argumentNodes = new ArrayList<>();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8a0a65ce0645ff786cf882d605fe16ba99d93d56"}, "originalPosition": 29}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ3NTI4ODk3", "url": "https://github.com/elastic/elasticsearch/pull/51278#pullrequestreview-347528897", "createdAt": "2020-01-23T18:51:56Z", "commit": {"oid": "8a0a65ce0645ff786cf882d605fe16ba99d93d56"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yM1QxODo1MTo1NlrOFhI9ng==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yM1QxODo1MTo1NlrOFhI9ng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDI5NDE3NA==", "bodyText": "What is a cat here?", "url": "https://github.com/elastic/elasticsearch/pull/51278#discussion_r370294174", "createdAt": "2020-01-23T18:51:56Z", "author": {"login": "stu-elastic"}, "path": "modules/lang-painless/src/main/java/org/elasticsearch/painless/ir/AssignmentNode.java", "diffHunk": "@@ -0,0 +1,217 @@\n+/*\n+ * Licensed to Elasticsearch under one or more contributor\n+ * license agreements. See the NOTICE file distributed with\n+ * this work for additional information regarding copyright\n+ * ownership. Elasticsearch licenses this file to you under\n+ * the Apache License, Version 2.0 (the \"License\"); you may\n+ * not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *    http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.elasticsearch.painless.ir;\n+\n+\n+import org.elasticsearch.painless.ClassWriter;\n+import org.elasticsearch.painless.DefBootstrap;\n+import org.elasticsearch.painless.Globals;\n+import org.elasticsearch.painless.MethodWriter;\n+import org.elasticsearch.painless.Operation;\n+import org.elasticsearch.painless.lookup.PainlessCast;\n+import org.elasticsearch.painless.lookup.PainlessLookupUtility;\n+import org.elasticsearch.painless.lookup.def;\n+\n+public class AssignmentNode extends BinaryNode {\n+\n+    /* ---- begin node data ---- */\n+\n+    private boolean pre;\n+    private boolean post;\n+    private Operation operation;\n+    private boolean read;\n+    private boolean cat;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8a0a65ce0645ff786cf882d605fe16ba99d93d56"}, "originalPosition": 40}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ3NTM3MTA3", "url": "https://github.com/elastic/elasticsearch/pull/51278#pullrequestreview-347537107", "createdAt": "2020-01-23T19:05:09Z", "commit": {"oid": "8a0a65ce0645ff786cf882d605fe16ba99d93d56"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yM1QxOTowNTowOVrOFhJVfg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yM1QxOTowNTowOVrOFhJVfg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDMwMDI4Ng==", "bodyText": "Why is a default constructor insufficient?", "url": "https://github.com/elastic/elasticsearch/pull/51278#discussion_r370300286", "createdAt": "2020-01-23T19:05:09Z", "author": {"login": "stu-elastic"}, "path": "modules/lang-painless/src/main/java/org/elasticsearch/painless/ir/ArgumentsNode.java", "diffHunk": "@@ -0,0 +1,44 @@\n+/*\n+ * Licensed to Elasticsearch under one or more contributor\n+ * license agreements. See the NOTICE file distributed with\n+ * this work for additional information regarding copyright\n+ * ownership. Elasticsearch licenses this file to you under\n+ * the Apache License, Version 2.0 (the \"License\"); you may\n+ * not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *    http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.elasticsearch.painless.ir;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+\n+public abstract class ArgumentsNode extends ExpressionNode {\n+\n+    /* ---- begin tree structure ---- */\n+\n+    private final List<ExpressionNode> argumentNodes = new ArrayList<>();\n+\n+    public void addArgumentNode(ExpressionNode argumentNode) {\n+        argumentNodes.add(argumentNode);\n+    }\n+\n+    public List<ExpressionNode> getArgumentNodes() {\n+        return argumentNodes;\n+    }\n+\n+    /* ---- end tree structure */\n+\n+    public ArgumentsNode() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8a0a65ce0645ff786cf882d605fe16ba99d93d56"}, "originalPosition": 41}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7f123a4d80a8c444592c65c8934630273f9d11f1", "author": {"user": {"login": "jdconrad", "name": "Jack Conradson"}}, "url": "https://github.com/elastic/elasticsearch/commit/7f123a4d80a8c444592c65c8934630273f9d11f1", "committedDate": "2020-01-23T20:14:56Z", "message": "Merge branch 'master' into trees1"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1c03a51379c896b0f0c5897901f1635c2b43dc12", "author": {"user": {"login": "jdconrad", "name": "Jack Conradson"}}, "url": "https://github.com/elastic/elasticsearch/commit/1c03a51379c896b0f0c5897901f1635c2b43dc12", "committedDate": "2020-01-23T20:22:39Z", "message": "remove all default constructors from ir nodes"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ3NjA1NTc5", "url": "https://github.com/elastic/elasticsearch/pull/51278#pullrequestreview-347605579", "createdAt": "2020-01-23T21:04:21Z", "commit": {"oid": "1c03a51379c896b0f0c5897901f1635c2b43dc12"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yM1QyMTowNDoyMVrOFhMj9w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yM1QyMTowNDoyMVrOFhMj9w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDM1MzE0Mw==", "bodyText": "Can ya comment on this?", "url": "https://github.com/elastic/elasticsearch/pull/51278#discussion_r370353143", "createdAt": "2020-01-23T21:04:21Z", "author": {"login": "stu-elastic"}, "path": "modules/lang-painless/src/main/java/org/elasticsearch/painless/ir/BraceSubNode.java", "diffHunk": "@@ -0,0 +1,66 @@\n+/*\n+ * Licensed to Elasticsearch under one or more contributor\n+ * license agreements. See the NOTICE file distributed with\n+ * this work for additional information regarding copyright\n+ * ownership. Elasticsearch licenses this file to you under\n+ * the Apache License, Version 2.0 (the \"License\"); you may\n+ * not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *    http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.elasticsearch.painless.ir;\n+\n+import org.elasticsearch.painless.ClassWriter;\n+import org.elasticsearch.painless.Globals;\n+import org.elasticsearch.painless.MethodWriter;\n+import org.objectweb.asm.Label;\n+import org.objectweb.asm.Opcodes;\n+\n+public class BraceSubNode extends UnaryNode {\n+\n+    @Override\n+    protected void write(ClassWriter classWriter, MethodWriter methodWriter, Globals globals) {\n+        setup(classWriter, methodWriter, globals);\n+        load(classWriter, methodWriter, globals);\n+    }\n+\n+    @Override\n+    protected int accessElementCount() {\n+        return 2;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1c03a51379c896b0f0c5897901f1635c2b43dc12"}, "originalPosition": 38}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "56a366ad2beac268810914237d99b084ccad1d7d", "author": {"user": {"login": "jdconrad", "name": "Jack Conradson"}}, "url": "https://github.com/elastic/elasticsearch/commit/56a366ad2beac268810914237d99b084ccad1d7d", "committedDate": "2020-01-23T21:41:00Z", "message": "added some comments for cat"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ3NjMxNjQx", "url": "https://github.com/elastic/elasticsearch/pull/51278#pullrequestreview-347631641", "createdAt": "2020-01-23T21:49:37Z", "commit": {"oid": "1c03a51379c896b0f0c5897901f1635c2b43dc12"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2817, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}