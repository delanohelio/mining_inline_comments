{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDg0Mzc0NDky", "number": 62259, "title": "Support the 'fields' option in inner_hits and top_hits.", "bodyText": "This PR adds support for the 'fields' option in the following places:\n\nAnytime inner_hits is used, for both fetching nested/ child docs and field collapsing\nThe top_hits aggregation\n\nAddresses #61949.", "createdAt": "2020-09-10T22:01:29Z", "url": "https://github.com/elastic/elasticsearch/pull/62259", "merged": true, "mergeCommit": {"oid": "f29c743a4789d3aa82cf0a677defeefd5bea6dfd"}, "closed": true, "closedAt": "2020-09-14T17:08:59Z", "author": {"login": "jtibshirani"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdHomuEABqjM3NTM0MzkxNjA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdI1qQOgH2gAyNDg0Mzc0NDkyOmUwZTI2NmEzMzExZTRlYjJkN2NkMDE3MWRkMDNiYzI3M2I2MDA5ZGM=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "21aff6880dbbde538f029ede634e3736bbced97e", "author": {"user": {"login": "jtibshirani", "name": "Julie Tibshirani"}}, "url": "https://github.com/elastic/elasticsearch/commit/21aff6880dbbde538f029ede634e3736bbced97e", "committedDate": "2020-09-10T21:22:43Z", "message": "Support the 'fields' option in inner_hits."}, "afterCommit": {"oid": "3e49a00536950e94bde001999b9452d3f3576bf3", "author": {"user": {"login": "jtibshirani", "name": "Julie Tibshirani"}}, "url": "https://github.com/elastic/elasticsearch/commit/3e49a00536950e94bde001999b9452d3f3576bf3", "committedDate": "2020-09-10T22:32:39Z", "message": "Support the 'fields' option in top_hits."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3e49a00536950e94bde001999b9452d3f3576bf3", "author": {"user": {"login": "jtibshirani", "name": "Julie Tibshirani"}}, "url": "https://github.com/elastic/elasticsearch/commit/3e49a00536950e94bde001999b9452d3f3576bf3", "committedDate": "2020-09-10T22:32:39Z", "message": "Support the 'fields' option in top_hits."}, "afterCommit": {"oid": "ce161fb9cf7bf55bfba23955a4bea702e9d18089", "author": {"user": {"login": "jtibshirani", "name": "Julie Tibshirani"}}, "url": "https://github.com/elastic/elasticsearch/commit/ce161fb9cf7bf55bfba23955a4bea702e9d18089", "committedDate": "2020-09-10T22:42:31Z", "message": "Support the 'fields' option in top_hits."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c62e7d883b705d7191dc5c27fa505cfd18bff724", "author": {"user": {"login": "jtibshirani", "name": "Julie Tibshirani"}}, "url": "https://github.com/elastic/elasticsearch/commit/c62e7d883b705d7191dc5c27fa505cfd18bff724", "committedDate": "2020-09-10T23:45:19Z", "message": "Add field collapsing test to runtime fields blacklist."}, "afterCommit": {"oid": "1b9db99212747f75355b44ee216b8c541069af26", "author": {"user": {"login": "jtibshirani", "name": "Julie Tibshirani"}}, "url": "https://github.com/elastic/elasticsearch/commit/1b9db99212747f75355b44ee216b8c541069af26", "committedDate": "2020-09-11T00:15:13Z", "message": "Support the 'fields' option in top_hits."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "391f7f9337d57bb819e5772fdc4f9ab79eb017a6", "author": {"user": {"login": "jtibshirani", "name": "Julie Tibshirani"}}, "url": "https://github.com/elastic/elasticsearch/commit/391f7f9337d57bb819e5772fdc4f9ab79eb017a6", "committedDate": "2020-09-11T01:08:50Z", "message": "Support the 'fields' option in inner_hits."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "53d6c58b52e439dcd017da61f9e15ba3bf734061", "author": {"user": {"login": "jtibshirani", "name": "Julie Tibshirani"}}, "url": "https://github.com/elastic/elasticsearch/commit/53d6c58b52e439dcd017da61f9e15ba3bf734061", "committedDate": "2020-09-11T01:08:52Z", "message": "Support the 'fields' option in top_hits."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "1b9db99212747f75355b44ee216b8c541069af26", "author": {"user": {"login": "jtibshirani", "name": "Julie Tibshirani"}}, "url": "https://github.com/elastic/elasticsearch/commit/1b9db99212747f75355b44ee216b8c541069af26", "committedDate": "2020-09-11T00:15:13Z", "message": "Support the 'fields' option in top_hits."}, "afterCommit": {"oid": "53d6c58b52e439dcd017da61f9e15ba3bf734061", "author": {"user": {"login": "jtibshirani", "name": "Julie Tibshirani"}}, "url": "https://github.com/elastic/elasticsearch/commit/53d6c58b52e439dcd017da61f9e15ba3bf734061", "committedDate": "2020-09-11T01:08:52Z", "message": "Support the 'fields' option in top_hits."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg3NTIwMzM4", "url": "https://github.com/elastic/elasticsearch/pull/62259#pullrequestreview-487520338", "createdAt": "2020-09-14T08:16:56Z", "commit": {"oid": "53d6c58b52e439dcd017da61f9e15ba3bf734061"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNFQwODoxNjo1NlrOHRIyig==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNFQwODoyMDoyOVrOHRI6ZQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzczMTg1MA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                 * Sets the stored fields to load from the docvalue and return.\n          \n          \n            \n                 * Sets the stored fields to load and return as part of the search request.", "url": "https://github.com/elastic/elasticsearch/pull/62259#discussion_r487731850", "createdAt": "2020-09-14T08:16:56Z", "author": {"login": "jimczi"}, "path": "server/src/main/java/org/elasticsearch/index/query/InnerHitBuilder.java", "diffHunk": "@@ -349,6 +367,41 @@ public InnerHitBuilder addDocValueField(String field) {\n         return addDocValueField(field, null);\n     }\n \n+    /**\n+     * Gets the fields to load and return as part of the search request.\n+     */\n+    public List<FieldAndFormat> getFetchFields() {\n+        return fetchFields;\n+    }\n+\n+    /**\n+     * Sets the stored fields to load from the docvalue and return.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "53d6c58b52e439dcd017da61f9e15ba3bf734061"}, "originalPosition": 65}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzczMzg2MQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        throw new IllegalArgumentException(\"[docValueField] must not be null: [\" + name + \"]\");\n          \n          \n            \n                        throw new IllegalArgumentException(\"[fetch_field] must not be null: [\" + name + \"]\");", "url": "https://github.com/elastic/elasticsearch/pull/62259#discussion_r487733861", "createdAt": "2020-09-14T08:20:29Z", "author": {"login": "jimczi"}, "path": "server/src/main/java/org/elasticsearch/search/aggregations/metrics/TopHitsAggregationBuilder.java", "diffHunk": "@@ -425,10 +439,38 @@ public TopHitsAggregationBuilder docValueField(String docValueField) {\n     /**\n      * Gets the field-data fields.\n      */\n-    public List<FieldAndFormat> fieldDataFields() {\n+    public List<FieldAndFormat> docValueFields() {\n         return docValueFields;\n     }\n \n+    /**\n+     * Adds a field to load and return as part of the search request.\n+     */\n+    public TopHitsAggregationBuilder fetchField(String field, String format) {\n+        if (field == null) {\n+            throw new IllegalArgumentException(\"[docValueField] must not be null: [\" + name + \"]\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "53d6c58b52e439dcd017da61f9e15ba3bf734061"}, "originalPosition": 63}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e0e266a3311e4eb2d7cd0171dd03bc273b6009dc", "author": {"user": {"login": "jtibshirani", "name": "Julie Tibshirani"}}, "url": "https://github.com/elastic/elasticsearch/commit/e0e266a3311e4eb2d7cd0171dd03bc273b6009dc", "committedDate": "2020-09-14T16:19:45Z", "message": "Fix some references to 'fields' in comments + messages."}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4710, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}