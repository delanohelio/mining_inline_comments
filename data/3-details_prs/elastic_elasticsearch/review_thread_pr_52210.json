{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzczNzAyNTc1", "number": 52210, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMVQxNjozNjoyMVrODe4A7A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMlQxMDo1MzowM1rODfIb_w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMzNzAxNjEyOnYy", "diffSide": "RIGHT", "path": "docs/reference/sql/limitations.asciidoc", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMVQxNjozNjoyMVrOFoQO4w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMVQxNjozNjoyMVrOFoQO4w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Nzc1MzMxNQ==", "bodyText": "\"they must be the exact the same exact aggregation\"", "url": "https://github.com/elastic/elasticsearch/pull/52210#discussion_r377753315", "createdAt": "2020-02-11T16:36:21Z", "author": {"login": "bpintea"}, "path": "docs/reference/sql/limitations.asciidoc", "diffHunk": "@@ -118,6 +118,22 @@ SELECT * FROM test GROUP BY age ORDER BY COUNT(*) LIMIT 100;\n It is possible to run the same queries without a `LIMIT` however in that case if the maximum size (*10000*) is passed,\n an exception will be returned as {es-sql} is unable to track (and sort) all the results returned.\n \n+Moreover, if there are aggregation(s) in the `ORDER BY`, they must be the exact the same exact aggregation", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0509c6675e6e323b7798c681cf6396cca46905a8"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMzNzAxOTY5OnYy", "diffSide": "RIGHT", "path": "docs/reference/sql/limitations.asciidoc", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMVQxNjozNzoxNlrOFoQRNg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMVQxNjozNzoxNlrOFoQRNg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Nzc1MzkxMA==", "bodyText": "\"that are defined in the GROUP BY\"", "url": "https://github.com/elastic/elasticsearch/pull/52210#discussion_r377753910", "createdAt": "2020-02-11T16:37:16Z", "author": {"login": "bpintea"}, "path": "docs/reference/sql/limitations.asciidoc", "diffHunk": "@@ -118,6 +118,22 @@ SELECT * FROM test GROUP BY age ORDER BY COUNT(*) LIMIT 100;\n It is possible to run the same queries without a `LIMIT` however in that case if the maximum size (*10000*) is passed,\n an exception will be returned as {es-sql} is unable to track (and sort) all the results returned.\n \n+Moreover, if there are aggregation(s) in the `ORDER BY`, they must be the exact the same exact aggregation\n+expressions(s), as used in the `SELECT` clause. The same applies for the fields that are defined the `GROUP BY` clause:", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0509c6675e6e323b7798c681cf6396cca46905a8"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMzNzAzNDUzOnYy", "diffSide": "RIGHT", "path": "docs/reference/sql/limitations.asciidoc", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMVQxNjo0MDo1MVrOFoQaaQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMVQxNjo0MDo1MVrOFoQaaQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Nzc1NjI2NQ==", "bodyText": "Might be useful to add one-two examples on how to change the statement, so that it works. Up to you.", "url": "https://github.com/elastic/elasticsearch/pull/52210#discussion_r377756265", "createdAt": "2020-02-11T16:40:51Z", "author": {"login": "bpintea"}, "path": "docs/reference/sql/limitations.asciidoc", "diffHunk": "@@ -118,6 +118,22 @@ SELECT * FROM test GROUP BY age ORDER BY COUNT(*) LIMIT 100;\n It is possible to run the same queries without a `LIMIT` however in that case if the maximum size (*10000*) is passed,\n an exception will be returned as {es-sql} is unable to track (and sort) all the results returned.\n \n+Moreover, if there are aggregation(s) in the `ORDER BY`, they must be the exact the same exact aggregation\n+expressions(s), as used in the `SELECT` clause. The same applies for the fields that are defined the `GROUP BY` clause:\n+they must be the exact same expressions in the `ORDER BY` as in the `GROUP BY`. No operators or scalar functions can be\n+used on top or removed from those expressions. Here are some examples of queries that are not allowed:\n+\n+[source, sql]\n+--------------------------------------------------\n+SELECT age, MAX(salary) FROM test GROUP BY gender ORDER BY age % 10, MAX(salary);\n+\n+SELECT age, MAX(salary) FROM test GROUP BY gender ORDER BY age, CAST(MAX(salary) AS FLOAT);\n+\n+SELECT age % 10, MAX(salary) FROM test GROUP BY gender ORDER BY age, MAX(salary);\n+\n+SELECT age, MAX(salary) / 12 AS max_salary FROM test GROUP BY ORDER BY age, MAX(salary);\n+--------------------------------------------------", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0509c6675e6e323b7798c681cf6396cca46905a8"}, "originalPosition": 18}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMzOTcwNjg3OnYy", "diffSide": "RIGHT", "path": "docs/reference/sql/limitations.asciidoc", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMlQxMDo1MzowM1rOFoqDYw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMlQxMDo1MzowM1rOFoqDYw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODE3NjM1NQ==", "bodyText": "\"must be only plain aggregate functions\" could be rephrased to \"can only be ...\"", "url": "https://github.com/elastic/elasticsearch/pull/52210#discussion_r378176355", "createdAt": "2020-02-12T10:53:03Z", "author": {"login": "bpintea"}, "path": "docs/reference/sql/limitations.asciidoc", "diffHunk": "@@ -118,6 +118,17 @@ SELECT * FROM test GROUP BY age ORDER BY COUNT(*) LIMIT 100;\n It is possible to run the same queries without a `LIMIT` however in that case if the maximum size (*10000*) is passed,\n an exception will be returned as {es-sql} is unable to track (and sort) all the results returned.\n \n+Moreover, the aggregation(s) used in the `ORDER BY`, must be only plain aggregate functions. No scalar", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "94b28283844b020101f073c72c9775ec811ce06c"}, "originalPosition": 4}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4759, "cost": 1, "resetAt": "2021-11-12T13:16:51Z"}}}