{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDkxMjEyMTQ3", "number": 62794, "title": "Grok: Handle utf-8 natively", "bodyText": "This adds a method to Grok that matches against sections offset from\nutf-8 byte arrays:\nMap<String, Object> captures(byte[] utf8Bytes, int offset, int length)\n\nThis'll be useful for the grok-flavored runtime fields because they\nwant to match against utf-8 encoded strings stored in a big array. And\njoni already supports this.", "createdAt": "2020-09-22T21:46:11Z", "url": "https://github.com/elastic/elasticsearch/pull/62794", "merged": true, "mergeCommit": {"oid": "59eac2262e21ca48720e0cd515999bed912abf72"}, "closed": true, "closedAt": "2020-09-23T12:42:44Z", "author": {"login": "nik9000"}, "timelineItems": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdLfBr3AH2gAyNDkxMjEyMTQ3OjI4ZjMxYThiNzViZjI1ZWQ5OGYxMjc5YzMyNTU4NmI1MWIxZGNkYzg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdLrFCEgFqTQ5NDU2NzgxNQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "28f31a8b75bf25ed98f1279c325586b51b1dcdc8", "author": {"user": {"login": "nik9000", "name": "Nik Everett"}}, "url": "https://github.com/elastic/elasticsearch/commit/28f31a8b75bf25ed98f1279c325586b51b1dcdc8", "committedDate": "2020-09-22T21:39:18Z", "message": "Grok: Handle utf-8 natively\n\nThis adds a method to `Grok` that matches against sections offset from\nutf-8 byte arrays:\n```\nMap<String, Object> captures(byte[] utf8Bytes, int offset, int length)\n```\n\nThis'll be useful for the grok-flavored runtime fields because they\nwant to match against utf-8 encoded strings stored in a big array. And\njoni already supports this."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk0NTY3ODE1", "url": "https://github.com/elastic/elasticsearch/pull/62794#pullrequestreview-494567815", "createdAt": "2020-09-23T11:41:28Z", "commit": {"oid": "28f31a8b75bf25ed98f1279c325586b51b1dcdc8"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yM1QxMTo0MToyOFrOHWoEWg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yM1QxMTo0MToyOFrOHWoEWg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzQ4NzE5NA==", "bodyText": "Ah, I was thrown off by this initially.\nThe region starts at index 0 and we have to offset it just like we did the initial match because we are extracting from the original utf8Bytes.\nBut the question is...if region.beg[number] is 0, how does region.end[number] - region.beg[number] work? Doesn't it have to take the offset into account too?", "url": "https://github.com/elastic/elasticsearch/pull/62794#discussion_r493487194", "createdAt": "2020-09-23T11:41:28Z", "author": {"login": "benwtrent"}, "path": "libs/grok/src/main/java/org/elasticsearch/grok/GrokCaptureConfig.java", "diffHunk": "@@ -54,10 +54,10 @@ public GrokCaptureType type() {\n         return type;\n     }\n \n-    Object extract(byte[] textAsBytes, Region region) {\n+    Object extract(byte[] utf8Bytes, int offset, Region region) {\n         for (int number : backRefs) {\n             if (region.beg[number] >= 0) {\n-                String matchValue = new String(textAsBytes, region.beg[number], region.end[number] - region.beg[number],\n+                String matchValue = new String(utf8Bytes, offset + region.beg[number], region.end[number] - region.beg[number],", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "28f31a8b75bf25ed98f1279c325586b51b1dcdc8"}, "originalPosition": 9}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4732, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}