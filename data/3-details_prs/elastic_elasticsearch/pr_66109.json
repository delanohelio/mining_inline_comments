{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTM1MjA3NTEz", "number": 66109, "title": "Generate an IDE-compatible checkstyle configuration", "bodyText": "With a few changes, our checkstyle config can be used by e.g. IntelliJ's Checkstyle plugin. Add a task to generate this file automatically, and create the necessary IntelliJ config to use it. Update CONTRIBUTING to describe how to use it.\nAlso add a line-length setting to .editorconfig.\nI did try to configure Eclipse with this config too - the configuration was accepted...but I couldn't get it to report any errors. Honestly, I struggle to get Eclipse to do anything useful anyway, so I can't tell if I set up something incorrectly, if it's just Eclipse.", "createdAt": "2020-12-09T14:10:08Z", "url": "https://github.com/elastic/elasticsearch/pull/66109", "merged": true, "mergeCommit": {"oid": "a67a5f9216377fec46bc35457ba2712fe2e408ef"}, "closed": true, "closedAt": "2020-12-14T13:47:28Z", "author": {"login": "pugnascotia"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdkfTzoAH2gAyNTM1MjA3NTEzOmM2ZWUzZDQwNTczMDJkMDYxNWNiNTY1NDg3OWE2NTk3MzM3MGNlNWM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABds0G7YAFqTU2MDkzODY3MA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "c6ee3d4057302d0615cb5654879a65973370ce5c", "author": {"user": {"login": "pugnascotia", "name": "Rory Hunter"}}, "url": "https://github.com/elastic/elasticsearch/commit/c6ee3d4057302d0615cb5654879a65973370ce5c", "committedDate": "2020-12-09T14:07:12Z", "message": "Generate an IDE-compatible checkstyle configuration\n\nWith a few changes, our checkstyle config can be used by e.g. IntelliJ's\nCheckstyle plugin. Add a task to generate this file automatically, and\ncreate the necessary IntelliJ config to use it.\n\nAlso add a line-length setting to .editorconfig."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUwNTA1MTky", "url": "https://github.com/elastic/elasticsearch/pull/66109#pullrequestreview-550505192", "createdAt": "2020-12-11T19:09:24Z", "commit": {"oid": "c6ee3d4057302d0615cb5654879a65973370ce5c"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMVQxOTowOToyNFrOIEGrJw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMVQxOTozMzoxNVrOIEIQOA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MTE3NDU2Nw==", "bodyText": "can we have proper up-to-date checking for this in case nothing changed?", "url": "https://github.com/elastic/elasticsearch/pull/66109#discussion_r541174567", "createdAt": "2020-12-11T19:09:24Z", "author": {"login": "breskeby"}, "path": "gradle/ide.gradle", "diffHunk": "@@ -21,6 +24,38 @@ allprojects {\n   }\n }\n \n+tasks.register('configureIdeCheckstyle') {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c6ee3d4057302d0615cb5654879a65973370ce5c"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MTE5MTEwMQ==", "bodyText": "generated files should live in the build folder in general. any particular reason its not", "url": "https://github.com/elastic/elasticsearch/pull/66109#discussion_r541191101", "createdAt": "2020-12-11T19:23:23Z", "author": {"login": "breskeby"}, "path": "gradle/ide.gradle", "diffHunk": "@@ -21,6 +24,38 @@ allprojects {\n   }\n }\n \n+tasks.register('configureIdeCheckstyle') {\n+  group = 'ide'\n+  description = 'Generated a suitable checkstyle config for IDEs'\n+\n+  doLast {\n+    // Create an IDE-specific checkstyle config by first copying the standard config\n+    Files.copy(\n+      Paths.get(project.file(\"buildSrc/src/main/resources/checkstyle.xml\").getPath()),\n+      Paths.get(project.file(\"buildSrc/src/main/resources/checkstyle_ide.xml\").getPath()),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c6ee3d4057302d0615cb5654879a65973370ce5c"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MTE5OTQ2Ng==", "bodyText": "the settings path is '... Other Settings > Eclipse Code Formatter'", "url": "https://github.com/elastic/elasticsearch/pull/66109#discussion_r541199466", "createdAt": "2020-12-11T19:32:06Z", "author": {"login": "breskeby"}, "path": "CONTRIBUTING.md", "diffHunk": "@@ -164,6 +164,47 @@ You can import the Elasticsearch project into IntelliJ IDEA via:\n  - In the subsequent dialog navigate to the root `build.gradle` file\n  - In the subsequent dialog select **Open as Project**\n \n+#### Checkstyle\n+\n+If you have the [Checkstyle] plugin installed, you can configure IntelliJ to\n+check the Elasticsearch code. However, the Checkstyle configuration file does\n+not work by default with the IntelliJ plugin, so instead a IDE-specific config\n+file is generated automatically after IntelliJ finishes syncing.\n+\n+   - Open **Preferences > Tools > Checkstyle**\n+   - Change the \"Scan Scope\" to \"Only Java sources (including tests)\"\n+   - Check the \"+\" under \"Configuration file\"\n+   - Set \"Description\" to \"Elasticsearch\" (or whatever you want)\n+   - Select \"Use a local Checkstyle file\"\n+   - For the \"File\", navigate to `buildSrc/src/main/resources/checkstyle_ide.xml`\n+   - Tick \"Store relative to project location\"\n+   - Click \"Next\"\n+   - The Checkstyle config file contains the variable `config_loc`, and\n+     IntelliJ will ask for a value. Fill in `buildSrc/src/main/resources`\n+   - Click \"Next\", then \"Finish\".\n+   - Click the box next to the new configuration to make it \"Active\". Without doing this,\n+     you'll have to explicitly choose the \"Elasticsearch\" configuration in the Checkstyle\n+     tool window and run the check manually. You can still do this with an active config,\n+     of course.\n+   - Click \"OK\" to apply the new preferences\n+\n+#### Formatting\n+\n+We are in the process of migrating towards automatic formatting Java file\n+using [spotless], backed by the Eclipse formatter. If you have the [Eclipse\n+Code Formatter] installed, you can apply formatting directly in IntelliJ.\n+\n+   - Open **Preferences > Other Settings > Checkstyle**", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c6ee3d4057302d0615cb5654879a65973370ce5c"}, "originalPosition": 34}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MTIwMDQ0MA==", "bodyText": "as said I think generated files should live in buildSrc/build instead. then we can remove this line again", "url": "https://github.com/elastic/elasticsearch/pull/66109#discussion_r541200440", "createdAt": "2020-12-11T19:33:15Z", "author": {"login": "breskeby"}, "path": ".gitignore", "diffHunk": "@@ -56,3 +56,6 @@ testfixtures_shared/\n \n # These are generated from .ci/jobs.t\n .ci/jobs/\n+\n+# Generated file\n+buildSrc/src/main/resources/checkstyle_ide.xml", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c6ee3d4057302d0615cb5654879a65973370ce5c"}, "originalPosition": 6}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "11912c291e21fd97f349f4eb8650db46b48ae72c", "author": {"user": {"login": "pugnascotia", "name": "Rory Hunter"}}, "url": "https://github.com/elastic/elasticsearch/commit/11912c291e21fd97f349f4eb8650db46b48ae72c", "committedDate": "2020-12-14T10:03:27Z", "message": "Apply review feedback"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8857706d0797eb497fa90dc5cb1fdc039eabd663", "author": {"user": {"login": "pugnascotia", "name": "Rory Hunter"}}, "url": "https://github.com/elastic/elasticsearch/commit/8857706d0797eb497fa90dc5cb1fdc039eabd663", "committedDate": "2020-12-14T10:03:34Z", "message": "Merge remote-tracking branch 'upstream/master' into checkstyle-ide"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUxMjg0MDk1", "url": "https://github.com/elastic/elasticsearch/pull/66109#pullrequestreview-551284095", "createdAt": "2020-12-14T11:33:57Z", "commit": {"oid": "8857706d0797eb497fa90dc5cb1fdc039eabd663"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNFQxMTozMzo1OFrOIFMU5w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNFQxMTozMzo1OFrOIFMU5w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjMxNTc1MQ==", "bodyText": "yes. thx", "url": "https://github.com/elastic/elasticsearch/pull/66109#discussion_r542315751", "createdAt": "2020-12-14T11:33:58Z", "author": {"login": "breskeby"}, "path": "gradle/ide.gradle", "diffHunk": "@@ -21,6 +24,38 @@ allprojects {\n   }\n }\n \n+tasks.register('configureIdeCheckstyle') {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MTE3NDU2Nw=="}, "originalCommit": {"oid": "c6ee3d4057302d0615cb5654879a65973370ce5c"}, "originalPosition": 14}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6f058f07323cdc43103a4cfd422387d4cc0dd525", "author": {"user": {"login": "elasticmachine", "name": "Elastic Machine"}}, "url": "https://github.com/elastic/elasticsearch/commit/6f058f07323cdc43103a4cfd422387d4cc0dd525", "committedDate": "2020-12-14T11:50:20Z", "message": "Merge branch 'master' into checkstyle-ide"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTYwOTM4Njcw", "url": "https://github.com/elastic/elasticsearch/pull/66109#pullrequestreview-560938670", "createdAt": "2021-01-04T10:52:31Z", "commit": {"oid": "6f058f07323cdc43103a4cfd422387d4cc0dd525"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wNFQxMDo1MjozMVrOINtVlQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wNFQxMDo1MjozMVrOINtVlQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTI0NTIwNQ==", "bodyText": "I wonder what this means in practice: if we configure the formatter, formatting will be applied everywhere which will cause noise within projects that are not yet automatically formatted? Been seeing this with imports order and I am wondering if this is what's causing it.", "url": "https://github.com/elastic/elasticsearch/pull/66109#discussion_r551245205", "createdAt": "2021-01-04T10:52:31Z", "author": {"login": "javanna"}, "path": "CONTRIBUTING.md", "diffHunk": "@@ -164,6 +164,47 @@ You can import the Elasticsearch project into IntelliJ IDEA via:\n  - In the subsequent dialog navigate to the root `build.gradle` file\n  - In the subsequent dialog select **Open as Project**\n \n+#### Checkstyle\n+\n+If you have the [Checkstyle] plugin installed, you can configure IntelliJ to\n+check the Elasticsearch code. However, the Checkstyle configuration file does\n+not work by default with the IntelliJ plugin, so instead an IDE-specific config\n+file is generated automatically after IntelliJ finishes syncing.\n+\n+   1. Open **Preferences > Tools > Checkstyle**\n+   2. Change the \"Scan Scope\" to \"Only Java sources (including tests)\"\n+   3. Check the \"+\" under \"Configuration file\"\n+   4. Set \"Description\" to \"Elasticsearch\" (or whatever you want)\n+   5. Select \"Use a local Checkstyle file\"\n+   6. For the \"File\", navigate to `build/checkstyle_ide.xml`\n+   7. Tick \"Store relative to project location\"\n+   8. Click \"Next\"\n+   9. The Checkstyle config file contains the variable `config_loc`, and\n+      IntelliJ will ask for a value. Fill in `buildSrc/src/main/resources`.\n+      This allows the config file to reference the exclusions file in that directory.\n+   10. Click \"Next\", then \"Finish\".\n+   11. Click the box next to the new configuration to make it \"Active\". Without doing this,\n+       you'll have to explicitly choose the \"Elasticsearch\" configuration in the Checkstyle\n+       tool window and run the check manually. You can still do this with an active config.\n+   12. Click \"OK\" to apply the new preferences\n+\n+#### Formatting\n+\n+We are in the process of migrating towards automatic formatting Java file\n+using [spotless], backed by the Eclipse formatter. If you have the [Eclipse\n+Code Formatter] installed, you can apply formatting directly in IntelliJ.\n+\n+   1. Open **Preferences > Other Settings > Eclipse Code Formatter**\n+   2. Click \"Use the Eclipse Code Formatter\"\n+   3. Under \"Eclipse formatter config\", select \"Eclipse workspace/project\n+      folder or config file\"\n+   4. Click \"Browse\", and navigate to the file `buildSrc/formatterConfig.xml`\n+   5. Click \"OK\"\n+\n+Note that only some sub-projects in the Elasticsearch project are currently\n+fully-formatted. You can see a list of project that **are not**\n+automatically formatted in [gradle/formatting.gradle](gradle/formatting.gradle).", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6f058f07323cdc43103a4cfd422387d4cc0dd525"}, "originalPosition": 43}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4674, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}