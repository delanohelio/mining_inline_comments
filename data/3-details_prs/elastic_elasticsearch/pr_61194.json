{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY4NzcxNjMz", "number": 61194, "title": "Allow running the Docker image with a non-default group", "bodyText": "Closes #60864. Tweak the JDK directories' permissions in the ES Docker image so that ES can run under a different user and group.\nThese changes assume that the image is being run with bind-mounted config, data and logs directories, and reads and writes to these locations will still fail when both the UID and GID are not the default. Everything should be OK when running with the default GID of zero, however.", "createdAt": "2020-08-17T11:29:10Z", "url": "https://github.com/elastic/elasticsearch/pull/61194", "merged": true, "mergeCommit": {"oid": "95b8218d5186059b1347e9728e7ee61d10729fb1"}, "closed": true, "closedAt": "2020-08-24T10:04:39Z", "author": {"login": "pugnascotia"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc_wWXZgH2gAyNDY4NzcxNjMzOjlmZThjMmFjMTRlOGY1ZDFhYjY3NjE4OTAzZWJlYWFkNzM2OGNjYzM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdBJ0wqAFqTQ3Mjc2MzI2Mw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "9fe8c2ac14e8f5d1ab67618903ebeaad7368ccc3", "author": {"user": {"login": "pugnascotia", "name": "Rory Hunter"}}, "url": "https://github.com/elastic/elasticsearch/commit/9fe8c2ac14e8f5d1ab67618903ebeaad7368ccc3", "committedDate": "2020-08-17T11:03:11Z", "message": "Allow running the Docker image with a non-default group"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e98aa56633768858f26d050b09c720ab27bd6cc5", "author": {"user": {"login": "pugnascotia", "name": "Rory Hunter"}}, "url": "https://github.com/elastic/elasticsearch/commit/e98aa56633768858f26d050b09c720ab27bd6cc5", "committedDate": "2020-08-18T10:50:31Z", "message": "Docker tests fixes on Linux in CI and Vagrant"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "26cdbf010970cc6a1ca3247890456c095075c0c6", "author": {"user": {"login": "pugnascotia", "name": "Rory Hunter"}}, "url": "https://github.com/elastic/elasticsearch/commit/26cdbf010970cc6a1ca3247890456c095075c0c6", "committedDate": "2020-08-18T13:25:44Z", "message": "More fixes"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDcyNzYzMjYz", "url": "https://github.com/elastic/elasticsearch/pull/61194#pullrequestreview-472763263", "createdAt": "2020-08-21T19:17:30Z", "commit": {"oid": "26cdbf010970cc6a1ca3247890456c095075c0c6"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMVQxOToxNzozMFrOHE4mUw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMVQxOToxNzozMFrOHE4mUw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDg4MzY2Nw==", "bodyText": "Should we enforce this in running the image itself?", "url": "https://github.com/elastic/elasticsearch/pull/61194#discussion_r474883667", "createdAt": "2020-08-21T19:17:30Z", "author": {"login": "rjernst"}, "path": "qa/os/src/test/java/org/elasticsearch/packaging/util/Docker.java", "diffHunk": "@@ -158,15 +183,31 @@ private static void executeDockerRun(Distribution distribution, Map<Path, Path>\n             volumes.forEach((localPath, containerPath) -> {\n                 assertThat(localPath, fileExists());\n \n-                if (Platforms.WINDOWS == false && System.getProperty(\"user.name\").equals(\"root\")) {\n+                if (Platforms.WINDOWS == false && System.getProperty(\"user.name\").equals(\"root\") && uid == null) {\n                     // The tests are running as root, but the process in the Docker container runs as `elasticsearch` (UID 1000),\n                     // so we need to ensure that the container process is able to read the bind-mounted files.\n+                    //\n+                    // NOTE that we don't do this if a UID is specified - in that case, we assume that the caller knows\n+                    // what they're doing!\n                     sh.run(\"chown -R 1000:0 \" + localPath);\n                 }\n                 args.add(\"--volume \\\"\" + localPath + \":\" + containerPath + \"\\\"\");\n             });\n         }\n \n+        if (uid == null) {\n+            if (gid != null) {\n+                throw new IllegalArgumentException(\"Cannot override GID without also overriding UID\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "26cdbf010970cc6a1ca3247890456c095075c0c6"}, "originalPosition": 70}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4866, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}