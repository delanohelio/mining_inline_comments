{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTQ1ODMzMzE4", "number": 66827, "title": "Add a deprecation message if a REST wrapper implementing plugin presents", "bodyText": "Adding deprecation message if a REST wrapper implementing plugin presents.", "createdAt": "2020-12-27T17:09:00Z", "url": "https://github.com/elastic/elasticsearch/pull/66827", "merged": true, "mergeCommit": {"oid": "7f3197718d747107197f85b6d151c17edf4d0c3b"}, "closed": true, "closedAt": "2021-03-17T19:59:40Z", "author": {"login": "BigPandaToo"}, "timelineItems": {"totalCount": 22, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdqUV6_AH2gAyNTQ1ODMzMzE4OmJjNmI5NjI2YzRkNmFjZGY4ZTdlNDNmMWFiN2FmYmZmZDYzZmQ0YWY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABeDxryMAFqTYxMzYyMzg4Mg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "bc6b9626c4d6acdf8e7e43f1ab7afbffd63fd4af", "author": {"user": {"login": "BigPandaToo", "name": "Lyudmila Fokina"}}, "url": "https://github.com/elastic/elasticsearch/commit/bc6b9626c4d6acdf8e7e43f1ab7afbffd63fd4af", "committedDate": "2020-12-27T16:44:06Z", "message": "Warn user if security is disabled\n\nAdding warnings if credentials are provided to a cluster that does not\nhave security enabled."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTY4ODI4MzQy", "url": "https://github.com/elastic/elasticsearch/pull/66827#pullrequestreview-568828342", "createdAt": "2021-01-15T05:35:15Z", "commit": {"oid": "bc6b9626c4d6acdf8e7e43f1ab7afbffd63fd4af"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xNVQwNTozNToxNlrOIUB0SQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xNVQwNTozOTo1OVrOIUB5JA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1Nzg3MjIwMQ==", "bodyText": "I am not aware of anything that would replace this string with an autodetected version number.\nI think you'll need to use Version.CURRENT.major + \".\" + Version.CURRENT.minor", "url": "https://github.com/elastic/elasticsearch/pull/66827#discussion_r557872201", "createdAt": "2021-01-15T05:35:16Z", "author": {"login": "tvernum"}, "path": "x-pack/plugin/security/src/main/java/org/elasticsearch/xpack/security/rest/SecurityRestFilter.java", "diffHunk": "@@ -89,6 +95,11 @@ public void handleRequest(RestRequest request, RestChannel channel, NodeClient c\n                         e -> handleException(\"Secondary authentication\", request, channel, e)));\n                 }, e -> handleException(\"Authentication\", request, channel, e)));\n         } else {\n+            if (request.getHeaders() != null && request.getHeaders().containsKey(\"Authorization\")) {\n+                HeaderWarning.addWarning(\"Elasticsearch security features are not enabled, anyone can access your cluster without \" +\n+                    \"authentication. Read https://www.elastic.co/guide/en/elasticsearch/reference/<autodetected version number>/\" +\n+                    \"get-started-enable-security.html for more information.\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bc6b9626c4d6acdf8e7e43f1ab7afbffd63fd4af"}, "originalPosition": 30}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1Nzg3MzI1OQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        assertThat (warningHeaders.isEmpty(), equalTo(true));\n          \n          \n            \n                        assertThat(warningHeaders, Matchers.empty());\n          \n      \n    \n    \n  \n\nUsing the more explicit matchers means we get more meaningful error messages when they fail.\nInstead of a simple\n\nexpected true but was false\n\n(which tells us almost nothing), we'd get\n\nExpected: an empty collection\nbut: <[foo]>", "url": "https://github.com/elastic/elasticsearch/pull/66827#discussion_r557873259", "createdAt": "2021-01-15T05:39:10Z", "author": {"login": "tvernum"}, "path": "x-pack/plugin/security/qa/basic-enable-security/src/javaRestTest/java/org/elasticsearch/xpack/security/EnableSecurityOnBasicLicenseIT.java", "diffHunk": "@@ -85,6 +97,21 @@ public void testSecuritySetup() throws Exception {\n         }\n     }\n \n+    public void testSecurityDisabledWarning() throws Exception {\n+        final Request request = new Request(\"GET\", \"/_cat/indices\");\n+        Response response = client().performRequest(request);\n+        List<String> warningHeaders = response.getWarnings();\n+        if (securityEnabled) {\n+            assertThat (warningHeaders.isEmpty(), equalTo(true));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bc6b9626c4d6acdf8e7e43f1ab7afbffd63fd4af"}, "originalPosition": 46}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1Nzg3MzQ0NA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        assertThat (warningHeaders.size(), equalTo(1));\n          \n          \n            \n                        assertThat(warningHeaders, hasSize(1));", "url": "https://github.com/elastic/elasticsearch/pull/66827#discussion_r557873444", "createdAt": "2021-01-15T05:39:59Z", "author": {"login": "tvernum"}, "path": "x-pack/plugin/security/qa/basic-enable-security/src/javaRestTest/java/org/elasticsearch/xpack/security/EnableSecurityOnBasicLicenseIT.java", "diffHunk": "@@ -85,6 +97,21 @@ public void testSecuritySetup() throws Exception {\n         }\n     }\n \n+    public void testSecurityDisabledWarning() throws Exception {\n+        final Request request = new Request(\"GET\", \"/_cat/indices\");\n+        Response response = client().performRequest(request);\n+        List<String> warningHeaders = response.getWarnings();\n+        if (securityEnabled) {\n+            assertThat (warningHeaders.isEmpty(), equalTo(true));\n+        } else {\n+            assertThat (warningHeaders.size(), equalTo(1));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bc6b9626c4d6acdf8e7e43f1ab7afbffd63fd4af"}, "originalPosition": 48}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d8442aac5157fd318570601951289813e0782419", "author": {"user": {"login": "elasticmachine", "name": "Elastic Machine"}}, "url": "https://github.com/elastic/elasticsearch/commit/d8442aac5157fd318570601951289813e0782419", "committedDate": "2021-01-20T14:12:08Z", "message": "Merge branch 'master' into No_sec_warning"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cccce3a01f841149187c7a295a12b23ff747e903", "author": {"user": {"login": "BigPandaToo", "name": "Lyudmila Fokina"}}, "url": "https://github.com/elastic/elasticsearch/commit/cccce3a01f841149187c7a295a12b23ff747e903", "committedDate": "2021-01-20T19:26:35Z", "message": "- Using explicit matchers in test asserts\n- Fixing version number placeholder"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7adb14a72e0ff1701b5195c3fdb434c2d9f820cf", "author": {"user": {"login": "elasticmachine", "name": "Elastic Machine"}}, "url": "https://github.com/elastic/elasticsearch/commit/7adb14a72e0ff1701b5195c3fdb434c2d9f820cf", "committedDate": "2021-01-20T20:05:34Z", "message": "Merge branch 'master' into No_sec_warning"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bb4667ba0e0762041cedd5f02ad841706d579b37", "author": {"user": {"login": "BigPandaToo", "name": "Lyudmila Fokina"}}, "url": "https://github.com/elastic/elasticsearch/commit/bb4667ba0e0762041cedd5f02ad841706d579b37", "committedDate": "2021-01-21T19:13:15Z", "message": "- Fixing the problem with non deterministic test execution order causing\n sporadic failures"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c9609b3e718bd9fef7e0dd486495c61ba76b7b9a", "author": {"user": {"login": "elasticmachine", "name": "Elastic Machine"}}, "url": "https://github.com/elastic/elasticsearch/commit/c9609b3e718bd9fef7e0dd486495c61ba76b7b9a", "committedDate": "2021-01-22T18:12:03Z", "message": "Merge branch 'master' into No_sec_warning"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3d8bfaff7e01956f5a0fa381dc6a0f21af2c3893", "author": {"user": {"login": "BigPandaToo", "name": "Lyudmila Fokina"}}, "url": "https://github.com/elastic/elasticsearch/commit/3d8bfaff7e01956f5a0fa381dc6a0f21af2c3893", "committedDate": "2021-02-10T19:29:04Z", "message": "Merge branch 'master' into No_sec_warning"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6b2f231a38aab3526290601af9bee5cdb2c63e96", "author": {"user": {"login": "elasticmachine", "name": "Elastic Machine"}}, "url": "https://github.com/elastic/elasticsearch/commit/6b2f231a38aab3526290601af9bee5cdb2c63e96", "committedDate": "2021-02-10T19:29:36Z", "message": "Merge branch 'master' into No_sec_warning"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "16e6af7ddbf91f7802529e1f977fd47175aaf475", "author": {"user": {"login": "BigPandaToo", "name": "Lyudmila Fokina"}}, "url": "https://github.com/elastic/elasticsearch/commit/16e6af7ddbf91f7802529e1f977fd47175aaf475", "committedDate": "2021-03-10T20:28:50Z", "message": "Merge branch 'master' into No_sec_warning"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "47f1cc73b017df927794f5e5c877ac494587351e", "author": {"user": {"login": "BigPandaToo", "name": "Lyudmila Fokina"}}, "url": "https://github.com/elastic/elasticsearch/commit/47f1cc73b017df927794f5e5c877ac494587351e", "committedDate": "2021-03-10T21:09:17Z", "message": "Addressing review comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e346cabfb44074ad880642a98a7cbacc268e3b31", "author": {"user": {"login": "BigPandaToo", "name": "Lyudmila Fokina"}}, "url": "https://github.com/elastic/elasticsearch/commit/e346cabfb44074ad880642a98a7cbacc268e3b31", "committedDate": "2021-03-10T21:22:14Z", "message": "Addressing review comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9e282484483daee49d84974edcbf1b91f0ec97d4", "author": {"user": {"login": "BigPandaToo", "name": "Lyudmila Fokina"}}, "url": "https://github.com/elastic/elasticsearch/commit/9e282484483daee49d84974edcbf1b91f0ec97d4", "committedDate": "2021-03-11T20:22:24Z", "message": "Fixing potential NullPointerException"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NjExNzc5MDUw", "url": "https://github.com/elastic/elasticsearch/pull/66827#pullrequestreview-611779050", "createdAt": "2021-03-15T02:06:18Z", "commit": {"oid": "9e282484483daee49d84974edcbf1b91f0ec97d4"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMy0xNVQwMjowNjoxOFrOI2fSOQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMy0xNVQwMjowNjoxOFrOI2fSOQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5NDAwNjU4NQ==", "bodyText": "I am concerned that the message is exclusively about \"third party security\" when it's only detecting a rest wrapper.\nI think we need to be more clear than that. Anyone who is using the plugin API to install a rest wrapper is going to be affected, and we need to be clear about that.\nI would propose a message like:\n\nThe {plugin-name} plugin installs a custom REST wrapper. This functionality is deprecated and will not be possible in Elasticsearch 8.0. If this plugin is intended to provide security features for Elasticsearch then you should switch to using the built-in Elasticsearch features instead.", "url": "https://github.com/elastic/elasticsearch/pull/66827#discussion_r594006585", "createdAt": "2021-03-15T02:06:18Z", "author": {"login": "tvernum"}, "path": "server/src/main/java/org/elasticsearch/action/ActionModule.java", "diffHunk": "@@ -436,6 +440,13 @@ public ActionModule(Settings settings, IndexNameExpressionResolver indexNameExpr\n                     throw new IllegalArgumentException(\"Cannot have more than one plugin implementing a REST wrapper\");\n                 }\n                 restWrapper = newRestWrapper;\n+                if (restWrapper.getClass().getCanonicalName() == null ||\n+                    restWrapper.getClass().getCanonicalName().startsWith(\"org.elasticsearch\") == false) {\n+                    deprecationLogger.deprecate(DeprecationCategory.SECURITY, \"3rd_party_sec_deprecation\", \"Use of third-party \" +\n+                        \"security plugins is deprecated and will not be possible in 8.0. You can use built-in Elasticsearch features \" +", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9e282484483daee49d84974edcbf1b91f0ec97d4"}, "originalPosition": 32}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7496d14629d224c42052e3bbd32ee6e329f1007c", "author": {"user": {"login": "BigPandaToo", "name": "Lyudmila Fokina"}}, "url": "https://github.com/elastic/elasticsearch/commit/7496d14629d224c42052e3bbd32ee6e329f1007c", "committedDate": "2021-03-15T16:50:56Z", "message": "Fixing potential the message phrasing"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e488d11ebe5e7f37b4ded27dd98e09192f2479ab", "author": {"user": {"login": "elasticmachine", "name": "Elastic Machine"}}, "url": "https://github.com/elastic/elasticsearch/commit/e488d11ebe5e7f37b4ded27dd98e09192f2479ab", "committedDate": "2021-03-15T18:02:46Z", "message": "Merge branch 'master' into No_sec_warning"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NjEyNzU4NTgx", "url": "https://github.com/elastic/elasticsearch/pull/66827#pullrequestreview-612758581", "createdAt": "2021-03-16T00:25:32Z", "commit": {"oid": "e488d11ebe5e7f37b4ded27dd98e09192f2479ab"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMy0xNlQwMDoyNTozMlrOI3OaPg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMy0xNlQwMDoyNjo0M1rOI3Obvw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5NDc3ODY4Ng==", "bodyText": "I think DeprecationCategory.PLUGINS is more appropriate than DeprecationCategory.SECURITY, since as Tim pointed out, this isn't a security feature directly.", "url": "https://github.com/elastic/elasticsearch/pull/66827#discussion_r594778686", "createdAt": "2021-03-16T00:25:32Z", "author": {"login": "rjernst"}, "path": "server/src/main/java/org/elasticsearch/action/ActionModule.java", "diffHunk": "@@ -436,6 +440,15 @@ public ActionModule(Settings settings, IndexNameExpressionResolver indexNameExpr\n                     throw new IllegalArgumentException(\"Cannot have more than one plugin implementing a REST wrapper\");\n                 }\n                 restWrapper = newRestWrapper;\n+                if (restWrapper.getClass().getCanonicalName() == null ||\n+                    restWrapper.getClass().getCanonicalName().startsWith(\"org.elasticsearch\") == false) {\n+                    deprecationLogger.deprecate(DeprecationCategory.SECURITY, \"3rd_party_rest_deprecation\", \"The \" +", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e488d11ebe5e7f37b4ded27dd98e09192f2479ab"}, "originalPosition": 31}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5NDc3OTA3MQ==", "bodyText": "We have avoided putting URLs in deprecation messages as they break too easily. In fact, I cannot find any other occurrence of one. Can we remove this?", "url": "https://github.com/elastic/elasticsearch/pull/66827#discussion_r594779071", "createdAt": "2021-03-16T00:26:43Z", "author": {"login": "rjernst"}, "path": "server/src/main/java/org/elasticsearch/action/ActionModule.java", "diffHunk": "@@ -436,6 +440,15 @@ public ActionModule(Settings settings, IndexNameExpressionResolver indexNameExpr\n                     throw new IllegalArgumentException(\"Cannot have more than one plugin implementing a REST wrapper\");\n                 }\n                 restWrapper = newRestWrapper;\n+                if (restWrapper.getClass().getCanonicalName() == null ||\n+                    restWrapper.getClass().getCanonicalName().startsWith(\"org.elasticsearch\") == false) {\n+                    deprecationLogger.deprecate(DeprecationCategory.SECURITY, \"3rd_party_rest_deprecation\", \"The \" +\n+                        plugin.getClass().getName() + \"plugin installs a custom REST wrapper. This functionality is deprecated and will \" +\n+                        \"not be possible in Elasticsearch 8.0. If this plugin is intended to provide security features for Elasticsearch \" +\n+                        \"then you should switch to using the built-in Elasticsearch features instead. \" +\n+                        \"Read https://www.elastic.co/guide/en/elasticsearch/reference/\" + Version.CURRENT.major + \".\" +", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e488d11ebe5e7f37b4ded27dd98e09192f2479ab"}, "originalPosition": 35}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4f3de7cf7f635d7059348ce766fbb64802ae5f59", "author": {"user": {"login": "BigPandaToo", "name": "Lyudmila Fokina"}}, "url": "https://github.com/elastic/elasticsearch/commit/4f3de7cf7f635d7059348ce766fbb64802ae5f59", "committedDate": "2021-03-16T11:58:52Z", "message": "Add a deprecation message\n\nif a REST wrapper\nimplementing plugin presents"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2a0fa28aad2dbc9fefacdc4cfc6bac36fe0b4274", "author": {"user": {"login": "BigPandaToo", "name": "Lyudmila Fokina"}}, "url": "https://github.com/elastic/elasticsearch/commit/2a0fa28aad2dbc9fefacdc4cfc6bac36fe0b4274", "committedDate": "2021-03-16T15:32:43Z", "message": "Add a deprecation message if a REST wrapper implementing plugin presents"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bee1b3760a1167442d49d1af65eb2201e5d37f17", "author": {"user": {"login": "elasticmachine", "name": "Elastic Machine"}}, "url": "https://github.com/elastic/elasticsearch/commit/bee1b3760a1167442d49d1af65eb2201e5d37f17", "committedDate": "2021-03-16T15:42:14Z", "message": "Merge branch 'master' into No_sec_warning"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7aff68523e0a80b4d0414a4fb5550efa6061cf6c", "author": {"user": {"login": "elasticmachine", "name": "Elastic Machine"}}, "url": "https://github.com/elastic/elasticsearch/commit/7aff68523e0a80b4d0414a4fb5550efa6061cf6c", "committedDate": "2021-03-16T16:07:13Z", "message": "Merge branch 'master' into No_sec_warning"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NjEzNjIzODgy", "url": "https://github.com/elastic/elasticsearch/pull/66827#pullrequestreview-613623882", "createdAt": "2021-03-16T19:03:20Z", "commit": {"oid": "7aff68523e0a80b4d0414a4fb5550efa6061cf6c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4245, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}