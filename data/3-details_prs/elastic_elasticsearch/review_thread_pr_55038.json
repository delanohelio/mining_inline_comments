{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDAxNjk3MjMw", "number": 55038, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xN1QxNzoyMzoyOVrODy-8yA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMVQxNzoxMTozN1rOD0VxAA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU0Nzg2NzYwOnYy", "diffSide": "RIGHT", "path": "server/src/main/java/org/elasticsearch/script/ScriptService.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xN1QxNzoyMzoyOVrOGHWphA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xN1QxNzoyMzoyOVrOGHWphA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDM2NDI5Mg==", "bodyText": "Rename to cache", "url": "https://github.com/elastic/elasticsearch/pull/55038#discussion_r410364292", "createdAt": "2020-04-17T17:23:29Z", "author": {"login": "stu-elastic"}, "path": "server/src/main/java/org/elasticsearch/script/ScriptService.java", "diffHunk": "@@ -688,25 +691,25 @@ ScriptCacheStats cacheStats() {\n                 return new ScriptCacheStats(general.stats());\n             }\n             Map<String, ScriptStats> context = new HashMap<>(contextCache.size());\n-            for (ScriptContext<?> ctx: contexts) {\n-                context.put(ctx.name, contextCache.get(ctx.name).get().stats());\n+            for (String name: contextCache.keySet()) {\n+                context.put(name, contextCache.get(name).get().stats());\n             }\n             return new ScriptCacheStats(context);\n         }\n \n         /**\n-         * Update settings for the context cache, if we're in the context cache mode otherwise no-op.\n+         * Update a single context cache if we're in the context cache mode otherwise no-op.\n          */\n-        void updateContextSettings(Settings settings, ScriptContext<?> context) {\n+        void set(String name, ScriptCache context) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b61dd0647de95bc8f67044ce92bb0cb89655e40c"}, "originalPosition": 326}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU1NzY5NjMxOnYy", "diffSide": "RIGHT", "path": "server/src/main/java/org/elasticsearch/script/ScriptService.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMFQyMDo1OToyOVrOGIndCA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMFQyMDo1OToyOVrOGIndCA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTY4ODIwMA==", "bodyText": "Make this package protected.", "url": "https://github.com/elastic/elasticsearch/pull/55038#discussion_r411688200", "createdAt": "2020-04-20T20:59:29Z", "author": {"login": "stu-elastic"}, "path": "server/src/main/java/org/elasticsearch/script/ScriptService.java", "diffHunk": "@@ -576,89 +583,85 @@ public void applyClusterState(ClusterChangedEvent event) {\n         clusterState = event.state();\n     }\n \n-    /**\n-     * Container for the ScriptCache(s).  This class operates in two modes:\n-     * 1) general mode, if the general script cache is configured.  There are no context caches in this case.\n-     * 2) context mode, if the context script cache is configured.  There is no general cache in this case.\n-     */\n-    static class CacheHolder {\n-        final ScriptCache general;\n-        final Map<String, AtomicReference<ScriptCache>> contextCache;\n+    void setCacheHolder(Settings settings, AtomicReference<CacheHolder> cacheHolder) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b61dd0647de95bc8f67044ce92bb0cb89655e40c"}, "originalPosition": 163}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU2MjA4NDM5OnYy", "diffSide": "RIGHT", "path": "docs/reference/modules/indices/circuit_breaker.asciidoc", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMVQxNzoxMDowOVrOGJPEwg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMVQxNzozODoyNlrOGJQT-g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjMzNzM0Ng==", "bodyText": "We typically monospace input text.\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                that are allowed to be compiled for a given context. Defaults to 75/5m,\n          \n          \n            \n                that are allowed to be compiled for a given context. Defaults to `75/5m`,", "url": "https://github.com/elastic/elasticsearch/pull/55038#discussion_r412337346", "createdAt": "2020-04-21T17:10:09Z", "author": {"login": "jrodewig"}, "path": "docs/reference/modules/indices/circuit_breaker.asciidoc", "diffHunk": "@@ -111,8 +111,8 @@ within a period of time.\n See the \"prefer-parameters\" section of the <<modules-scripting-using,scripting>>\n documentation for more information.\n \n-`script.max_compilations_rate`::\n+`script.context.$CONTEXT.max_compilations_rate`::\n \n     Limit for the number of unique dynamic scripts within a certain interval\n-    that are allowed to be compiled. Defaults to 75/5m, meaning 75 every 5 \n-    minutes.\n+    that are allowed to be compiled for a given context. Defaults to 75/5m,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b61dd0647de95bc8f67044ce92bb0cb89655e40c"}, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjM1NzYyNg==", "bodyText": "mono'd", "url": "https://github.com/elastic/elasticsearch/pull/55038#discussion_r412357626", "createdAt": "2020-04-21T17:38:26Z", "author": {"login": "stu-elastic"}, "path": "docs/reference/modules/indices/circuit_breaker.asciidoc", "diffHunk": "@@ -111,8 +111,8 @@ within a period of time.\n See the \"prefer-parameters\" section of the <<modules-scripting-using,scripting>>\n documentation for more information.\n \n-`script.max_compilations_rate`::\n+`script.context.$CONTEXT.max_compilations_rate`::\n \n     Limit for the number of unique dynamic scripts within a certain interval\n-    that are allowed to be compiled. Defaults to 75/5m, meaning 75 every 5 \n-    minutes.\n+    that are allowed to be compiled for a given context. Defaults to 75/5m,", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjMzNzM0Ng=="}, "originalCommit": {"oid": "b61dd0647de95bc8f67044ce92bb0cb89655e40c"}, "originalPosition": 10}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU2MjA5MTUyOnYy", "diffSide": "RIGHT", "path": "docs/reference/scripting/using.asciidoc", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMVQxNzoxMTozN1rOGJPI0A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMVQxNzozODozNVrOGJQUiw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjMzODM4NA==", "bodyText": "We do single space between sentences.\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            for ingest contexts.  You can change these settings dynamically by setting\n          \n          \n            \n            for ingest contexts. You can change these settings dynamically by setting", "url": "https://github.com/elastic/elasticsearch/pull/55038#discussion_r412338384", "createdAt": "2020-04-21T17:11:37Z", "author": {"login": "jrodewig"}, "path": "docs/reference/scripting/using.asciidoc", "diffHunk": "@@ -98,9 +98,11 @@ second version is only compiled once.\n \n If you compile too many unique scripts within a small amount of time,\n Elasticsearch will reject the new dynamic scripts with a\n-`circuit_breaking_exception` error. By default, up to 15 inline scripts per\n-minute will be compiled. You can change this setting dynamically by setting\n-`script.max_compilations_rate`.\n+`circuit_breaking_exception` error. By default, up to 75 scripts per\n+5 minutes will be compiled for most contexts and 375 scripts per 5 minutes\n+for ingest contexts.  You can change these settings dynamically by setting", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b61dd0647de95bc8f67044ce92bb0cb89655e40c"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjM1Nzc3MQ==", "bodyText": "single spaced.", "url": "https://github.com/elastic/elasticsearch/pull/55038#discussion_r412357771", "createdAt": "2020-04-21T17:38:35Z", "author": {"login": "stu-elastic"}, "path": "docs/reference/scripting/using.asciidoc", "diffHunk": "@@ -98,9 +98,11 @@ second version is only compiled once.\n \n If you compile too many unique scripts within a small amount of time,\n Elasticsearch will reject the new dynamic scripts with a\n-`circuit_breaking_exception` error. By default, up to 15 inline scripts per\n-minute will be compiled. You can change this setting dynamically by setting\n-`script.max_compilations_rate`.\n+`circuit_breaking_exception` error. By default, up to 75 scripts per\n+5 minutes will be compiled for most contexts and 375 scripts per 5 minutes\n+for ingest contexts.  You can change these settings dynamically by setting", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjMzODM4NA=="}, "originalCommit": {"oid": "b61dd0647de95bc8f67044ce92bb0cb89655e40c"}, "originalPosition": 9}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1089, "cost": 1, "resetAt": "2021-11-12T11:57:46Z"}}}