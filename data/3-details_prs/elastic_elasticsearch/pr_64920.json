{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE5MTg3Mzc5", "number": 64920, "title": "[ML] adds persistent task state reason for anomaly and analytics jobs failing to start", "bodyText": "When a job fails to start and is set to the FAILED state, we also usually populate the reason for that failure.\nBut, this reason is not provided to the API caller directly.\nThis commit provides the reason if it is populated in the persisted task state.", "createdAt": "2020-11-11T13:08:56Z", "url": "https://github.com/elastic/elasticsearch/pull/64920", "merged": true, "mergeCommit": {"oid": "a4aa3f8893df7f0a1acbb7ed8af958da0fb720d0"}, "closed": true, "closedAt": "2020-11-12T12:18:43Z", "author": {"login": "benwtrent"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdbdbhfAH2gAyNTE5MTg3Mzc5Ojg0MmM3Njc2YjY2MzU4ZDQxOGNjOTgzZDlkNDk5ZThmYjkwMWM2YWQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdbubdagFqTUyODg1NzkzMQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "842c7676b66358d418cc983d9d499e8fb901c6ad", "author": {"user": {"login": "benwtrent", "name": "Benjamin Trent"}}, "url": "https://github.com/elastic/elasticsearch/commit/842c7676b66358d418cc983d9d499e8fb901c6ad", "committedDate": "2020-11-11T12:50:30Z", "message": "[ML] adds persistent task state reason for anomaly and analytics jobs if job fails while waiting to start"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ecf36636c1ce54936687311eadff4210071e2422", "author": {"user": {"login": "elasticmachine", "name": "Elastic Machine"}}, "url": "https://github.com/elastic/elasticsearch/commit/ecf36636c1ce54936687311eadff4210071e2422", "committedDate": "2020-11-11T15:19:42Z", "message": "Merge branch 'master' into feature/ml-better-job-failure-messaging"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI4Mjc5MDEx", "url": "https://github.com/elastic/elasticsearch/pull/64920#pullrequestreview-528279011", "createdAt": "2020-11-11T15:31:29Z", "commit": {"oid": "ecf36636c1ce54936687311eadff4210071e2422"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMVQxNTozMTozMFrOHxSKQg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMVQxNTozMTozMFrOHxSKQg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTQzOTgxMA==", "bodyText": "Can you change the message to include reason only if it is known please.\n\"Unexpected job state [XX] with reason [UNKNOWN]... \" is a message that can only frustrate", "url": "https://github.com/elastic/elasticsearch/pull/64920#discussion_r521439810", "createdAt": "2020-11-11T15:31:30Z", "author": {"login": "davidkyle"}, "path": "x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/action/TransportOpenJobAction.java", "diffHunk": "@@ -309,13 +317,20 @@ public boolean test(PersistentTasksCustomMetadata.PersistentTask<?> persistentTa\n                     node = persistentTask.getExecutorNode();\n                     return true;\n                 case CLOSING:\n-                    exception = ExceptionsHelper.conflictStatusException(\"The job has been \" + JobState.CLOSED + \" while waiting to be \"\n-                            + JobState.OPENED);\n+                    exception = ExceptionsHelper.conflictStatusException(\n+                        \"The job has been {} while waiting to be {}\",\n+                        JobState.CLOSED,\n+                        JobState.OPENED);\n                     return true;\n                 case FAILED:\n                 default:\n-                    exception = ExceptionsHelper.serverError(\"Unexpected job state [\" + jobState\n-                            + \"] while waiting for job to be \" + JobState.OPENED);\n+                    // Default http status is SERVER ERROR\n+                    exception = ExceptionsHelper.serverError(\n+                        \"Unexpected job state [{}] with reason [{}] while waiting for job to be {}\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ecf36636c1ce54936687311eadff4210071e2422"}, "originalPosition": 68}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3a7a02ca1477d3f623a2379349696cfa36923b84", "author": {"user": {"login": "benwtrent", "name": "Benjamin Trent"}}, "url": "https://github.com/elastic/elasticsearch/commit/3a7a02ca1477d3f623a2379349696cfa36923b84", "committedDate": "2020-11-11T16:55:59Z", "message": "addresing pr comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "26d4caa397dffaa7542964cee2da89f3acf567ea", "author": {"user": {"login": "benwtrent", "name": "Benjamin Trent"}}, "url": "https://github.com/elastic/elasticsearch/commit/26d4caa397dffaa7542964cee2da89f3acf567ea", "committedDate": "2020-11-11T16:56:06Z", "message": "Merge remote-tracking branch 'upstream/master' into feature/ml-better-job-failure-messaging"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ea6faee7ab4132f72c2c0f372b2fc984e3096764", "author": {"user": {"login": "benwtrent", "name": "Benjamin Trent"}}, "url": "https://github.com/elastic/elasticsearch/commit/ea6faee7ab4132f72c2c0f372b2fc984e3096764", "committedDate": "2020-11-11T16:56:18Z", "message": "Merge branch 'feature/ml-better-job-failure-messaging' of github.com:benwtrent/elasticsearch into feature/ml-better-job-failure-messaging"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI4ODU3OTMx", "url": "https://github.com/elastic/elasticsearch/pull/64920#pullrequestreview-528857931", "createdAt": "2020-11-12T08:38:49Z", "commit": {"oid": "ea6faee7ab4132f72c2c0f372b2fc984e3096764"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1194, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}