{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDAxNDY1MDU5", "number": 55014, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOVQxNTozNTozNlrODwdSDQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOVQxNjoxNzoyN1rODweRqQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUyMTM3OTk3OnYy", "diffSide": "RIGHT", "path": "server/src/main/java/org/elasticsearch/rest/action/admin/indices/RestGetFieldMappingAction.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOVQxNTozNTozNlrOGDeLWA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOVQxNTo0OToxNFrOGDevVw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjI5MzMzNg==", "bodyText": "Maybe add a space between the two sentences?", "url": "https://github.com/elastic/elasticsearch/pull/55014#discussion_r406293336", "createdAt": "2020-04-09T15:35:36Z", "author": {"login": "martijnvg"}, "path": "server/src/main/java/org/elasticsearch/rest/action/admin/indices/RestGetFieldMappingAction.java", "diffHunk": "@@ -63,6 +70,12 @@ public RestChannelConsumer prepareRequest(final RestRequest request, final NodeC\n         GetFieldMappingsRequest getMappingsRequest = new GetFieldMappingsRequest();\n         getMappingsRequest.indices(indices).fields(fields).includeDefaults(request.paramAsBoolean(\"include_defaults\", false));\n         getMappingsRequest.indicesOptions(IndicesOptions.fromRequest(request, getMappingsRequest.indicesOptions()));\n+\n+        if (request.hasParam(\"local\")) {\n+            deprecationLogger.deprecatedAndMaybeLog(\"get_field_mapping_local\",\n+                \"Use [local] in get field mapping requests is deprecated.\"\n+                    + \"The parameter will be removed in the next major version\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f6b598e71a3ef7a44741ceef227214c603f6dd89"}, "originalPosition": 35}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjMwMjU1MQ==", "bodyText": "Yep, added.", "url": "https://github.com/elastic/elasticsearch/pull/55014#discussion_r406302551", "createdAt": "2020-04-09T15:49:14Z", "author": {"login": "ywangd"}, "path": "server/src/main/java/org/elasticsearch/rest/action/admin/indices/RestGetFieldMappingAction.java", "diffHunk": "@@ -63,6 +70,12 @@ public RestChannelConsumer prepareRequest(final RestRequest request, final NodeC\n         GetFieldMappingsRequest getMappingsRequest = new GetFieldMappingsRequest();\n         getMappingsRequest.indices(indices).fields(fields).includeDefaults(request.paramAsBoolean(\"include_defaults\", false));\n         getMappingsRequest.indicesOptions(IndicesOptions.fromRequest(request, getMappingsRequest.indicesOptions()));\n+\n+        if (request.hasParam(\"local\")) {\n+            deprecationLogger.deprecatedAndMaybeLog(\"get_field_mapping_local\",\n+                \"Use [local] in get field mapping requests is deprecated.\"\n+                    + \"The parameter will be removed in the next major version\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjI5MzMzNg=="}, "originalCommit": {"oid": "f6b598e71a3ef7a44741ceef227214c603f6dd89"}, "originalPosition": 35}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUyMTUzODcyOnYy", "diffSide": "RIGHT", "path": "docs/reference/indices/get-field-mapping.asciidoc", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOVQxNjoxNjoyNVrOGDfxpg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xMFQwNDoyMzoxNlrOGDwqIQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjMxOTUyNg==", "bodyText": "I would add that the parameter currently is just a noop.\nCan you also update the migrate_7_8.asciidoc file when backporting this change to the 7.x branch?", "url": "https://github.com/elastic/elasticsearch/pull/55014#discussion_r406319526", "createdAt": "2020-04-09T16:16:25Z", "author": {"login": "martijnvg"}, "path": "docs/reference/indices/get-field-mapping.asciidoc", "diffHunk": "@@ -48,7 +48,11 @@ include::{docdir}/rest-api/common-parms.asciidoc[tag=index-ignore-unavailable]\n (Optional, boolean) If `true`, the response includes default mapping values.\n Defaults to `false`.\n \n-include::{docdir}/rest-api/common-parms.asciidoc[tag=local]\n+`local`::\n+deprecated:[7.8.0, Field mappings are always retrieved locally]\n+(Optional, boolean) If `true`, the request retrieves information from the local\n+node only. Defaults to `false`, which means information is retrieved from\n+the master node.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d9f69069063e08bb6d9f1de0b90b067109b79cc1"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjU5NjEyOQ==", "bodyText": "Added.  Thanks for the heads up about the migrate doc. Will do for 7.x.", "url": "https://github.com/elastic/elasticsearch/pull/55014#discussion_r406596129", "createdAt": "2020-04-10T04:23:16Z", "author": {"login": "ywangd"}, "path": "docs/reference/indices/get-field-mapping.asciidoc", "diffHunk": "@@ -48,7 +48,11 @@ include::{docdir}/rest-api/common-parms.asciidoc[tag=index-ignore-unavailable]\n (Optional, boolean) If `true`, the response includes default mapping values.\n Defaults to `false`.\n \n-include::{docdir}/rest-api/common-parms.asciidoc[tag=local]\n+`local`::\n+deprecated:[7.8.0, Field mappings are always retrieved locally]\n+(Optional, boolean) If `true`, the request retrieves information from the local\n+node only. Defaults to `false`, which means information is retrieved from\n+the master node.", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjMxOTUyNg=="}, "originalCommit": {"oid": "d9f69069063e08bb6d9f1de0b90b067109b79cc1"}, "originalPosition": 9}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUyMTU0MTUyOnYy", "diffSide": "RIGHT", "path": "client/rest-high-level/src/test/java/org/elasticsearch/client/documentation/IndicesClientDocumentationIT.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOVQxNjoxNzowNFrOGDfzVw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xMFQwNDoyNzowOFrOGDwsoA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjMxOTk1OQ==", "bodyText": "\ud83d\udc4d", "url": "https://github.com/elastic/elasticsearch/pull/55014#discussion_r406319959", "createdAt": "2020-04-09T16:17:04Z", "author": {"login": "martijnvg"}, "path": "client/rest-high-level/src/test/java/org/elasticsearch/client/documentation/IndicesClientDocumentationIT.java", "diffHunk": "@@ -705,11 +707,12 @@ public void testGetFieldMapping() throws IOException, InterruptedException {\n         request.local(true); // <1>\n         // end::get-field-mappings-request-local\n \n-        {\n+        final RequestOptions requestOptions = RequestOptions.DEFAULT.toBuilder().setWarningsHandler(WarningsHandler.PERMISSIVE).build();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d9f69069063e08bb6d9f1de0b90b067109b79cc1"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjU5Njc2OA==", "bodyText": "Followed your suggestion to add deprecated annotation to GetFieldMappingsRequest#local(..) methods and removed it from the conversion.  It works better and this change to RequestOptions is no longer necessary.", "url": "https://github.com/elastic/elasticsearch/pull/55014#discussion_r406596768", "createdAt": "2020-04-10T04:27:08Z", "author": {"login": "ywangd"}, "path": "client/rest-high-level/src/test/java/org/elasticsearch/client/documentation/IndicesClientDocumentationIT.java", "diffHunk": "@@ -705,11 +707,12 @@ public void testGetFieldMapping() throws IOException, InterruptedException {\n         request.local(true); // <1>\n         // end::get-field-mappings-request-local\n \n-        {\n+        final RequestOptions requestOptions = RequestOptions.DEFAULT.toBuilder().setWarningsHandler(WarningsHandler.PERMISSIVE).build();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjMxOTk1OQ=="}, "originalCommit": {"oid": "d9f69069063e08bb6d9f1de0b90b067109b79cc1"}, "originalPosition": 16}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUyMTU0MjgxOnYy", "diffSide": "RIGHT", "path": "rest-api-spec/src/main/resources/rest-api-spec/test/indices.get_field_mapping/10_basic.yml", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOVQxNjoxNzoyN1rOGDf0Jg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xMFQwNDoyMzo1MVrOGDwqnQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjMyMDE2Ng==", "bodyText": "I think a space would need to be added here, otherwise this test will fail.", "url": "https://github.com/elastic/elasticsearch/pull/55014#discussion_r406320166", "createdAt": "2020-04-09T16:17:27Z", "author": {"login": "martijnvg"}, "path": "rest-api-spec/src/main/resources/rest-api-spec/test/indices.get_field_mapping/10_basic.yml", "diffHunk": "@@ -50,3 +50,20 @@ setup:\n \n   - match: {test_index.mappings.text.mapping.text.type:     text}\n   - match: {test_index.mappings.text.mapping.text.analyzer: default}\n+\n+---\n+\"Get field mapping with local is deprecated\":\n+\n+  - skip:\n+      features: [\"warnings\", \"node_selector\"]\n+\n+  - do:\n+      node_selector:\n+        version: \"7.8.0 - \"\n+      warnings:\n+        - \"Use [local] in get field mapping requests is deprecated.The parameter will be removed in the next major version\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d9f69069063e08bb6d9f1de0b90b067109b79cc1"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjU5NjI1Mw==", "bodyText": "Good catch. It indeed failed for many of the CI tests ...", "url": "https://github.com/elastic/elasticsearch/pull/55014#discussion_r406596253", "createdAt": "2020-04-10T04:23:51Z", "author": {"login": "ywangd"}, "path": "rest-api-spec/src/main/resources/rest-api-spec/test/indices.get_field_mapping/10_basic.yml", "diffHunk": "@@ -50,3 +50,20 @@ setup:\n \n   - match: {test_index.mappings.text.mapping.text.type:     text}\n   - match: {test_index.mappings.text.mapping.text.analyzer: default}\n+\n+---\n+\"Get field mapping with local is deprecated\":\n+\n+  - skip:\n+      features: [\"warnings\", \"node_selector\"]\n+\n+  - do:\n+      node_selector:\n+        version: \"7.8.0 - \"\n+      warnings:\n+        - \"Use [local] in get field mapping requests is deprecated.The parameter will be removed in the next major version\"", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjMyMDE2Ng=="}, "originalCommit": {"oid": "d9f69069063e08bb6d9f1de0b90b067109b79cc1"}, "originalPosition": 15}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1222, "cost": 1, "resetAt": "2021-11-12T11:57:46Z"}}}