{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTQyNTQ4ODEw", "number": 66593, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wNFQxMjo0Njo0OVrOFK4W9A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wNFQxMjo0Njo0OVrOFK4W9A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQ2OTUzNDYwOnYy", "diffSide": "RIGHT", "path": "plugins/mapper-annotated-text/src/main/java/org/elasticsearch/index/mapper/annotatedtext/AnnotatedTextFieldMapper.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wNFQxMjo0Njo0OVrOINwf0Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wNFQxNDoyMzowNlrOINzcYA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTI5Njk3Nw==", "bodyText": "Might be worth changing this to javadoc, and stressing that you must create new instances per search because it's not thread-safe.", "url": "https://github.com/elastic/elasticsearch/pull/66593#discussion_r551296977", "createdAt": "2021-01-04T12:46:49Z", "author": {"login": "romseygeek"}, "path": "plugins/mapper-annotated-text/src/main/java/org/elasticsearch/index/mapper/annotatedtext/AnnotatedTextFieldMapper.java", "diffHunk": "@@ -272,9 +271,16 @@ public AnnotationToken getAnnotation(int index) {\n     // The class takes markedup format field values and returns plain text versions.\n     // When asked to tokenize plain-text versions by the highlighter it tokenizes the\n     // original markup form in order to inject annotations.\n+    // Unlike other Analyzers, which tend to be single-instance, this class has\n+    // instances created per search request and field being highlighted. This allows us to keep\n+    // state about the annotations being processed and pass them into token streams\n+    // being highlighted.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "87ef7aef17a6a9e1be279d10c16150656ae608dc"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTM0NTI0OA==", "bodyText": "Will do. Thanks for the review!", "url": "https://github.com/elastic/elasticsearch/pull/66593#discussion_r551345248", "createdAt": "2021-01-04T14:23:06Z", "author": {"login": "markharwood"}, "path": "plugins/mapper-annotated-text/src/main/java/org/elasticsearch/index/mapper/annotatedtext/AnnotatedTextFieldMapper.java", "diffHunk": "@@ -272,9 +271,16 @@ public AnnotationToken getAnnotation(int index) {\n     // The class takes markedup format field values and returns plain text versions.\n     // When asked to tokenize plain-text versions by the highlighter it tokenizes the\n     // original markup form in order to inject annotations.\n+    // Unlike other Analyzers, which tend to be single-instance, this class has\n+    // instances created per search request and field being highlighted. This allows us to keep\n+    // state about the annotations being processed and pass them into token streams\n+    // being highlighted.", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTI5Njk3Nw=="}, "originalCommit": {"oid": "87ef7aef17a6a9e1be279d10c16150656ae608dc"}, "originalPosition": 15}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4474, "cost": 1, "resetAt": "2021-11-12T19:05:54Z"}}}