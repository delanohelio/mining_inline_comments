{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY3MDU3MjI1", "number": 51456, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNVQyMzo1OTozOVrODdhfaw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNVQyMzo1OTozOVrODdhfaw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMyMjg0MDExOnYy", "diffSide": "RIGHT", "path": "x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/template/TemplateUtils.java", "isResolved": false, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNVQyMzo1OTozOVrOFmLUTw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNlQwMToxNDo1OVrOFmMjuw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTU3NTYzMQ==", "bodyText": "I'm curious about this change, why the change to validation post-filter? Was it causing an issue?", "url": "https://github.com/elastic/elasticsearch/pull/51456#discussion_r375575631", "createdAt": "2020-02-05T23:59:39Z", "author": {"login": "dakrone"}, "path": "x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/template/TemplateUtils.java", "diffHunk": "@@ -59,9 +59,10 @@ public static void loadTemplateIntoMap(String resource, Map<String, IndexTemplat\n     public static String loadTemplate(String resource, String version, String versionProperty) {\n         try {\n             BytesReference source = load(resource);\n-            validate(source);\n+            final String filteredJson = filter(source, version, versionProperty);\n+            validate(new BytesArray(filteredJson));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0f7fedc548d72c736293697aa3bbf508037df8ea"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTU3Njk5Nw==", "bodyText": "Yes, bare placeholders (e.g. \"version\": ${my.variable}) didn't work with the validation before the variable replacement because that's not valid JSON, and version must be a bare integer, not a string. Previously, all variables were strings (e.g. \"field\": \"${my.variable}\", note the quotes around the variable).\nBesides, it's more important that the JSON is valid after we do the variable replacement, rather than before, isn't it?", "url": "https://github.com/elastic/elasticsearch/pull/51456#discussion_r375576997", "createdAt": "2020-02-06T00:04:36Z", "author": {"login": "gwbrown"}, "path": "x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/template/TemplateUtils.java", "diffHunk": "@@ -59,9 +59,10 @@ public static void loadTemplateIntoMap(String resource, Map<String, IndexTemplat\n     public static String loadTemplate(String resource, String version, String versionProperty) {\n         try {\n             BytesReference source = load(resource);\n-            validate(source);\n+            final String filteredJson = filter(source, version, versionProperty);\n+            validate(new BytesArray(filteredJson));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTU3NTYzMQ=="}, "originalCommit": {"oid": "0f7fedc548d72c736293697aa3bbf508037df8ea"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTU4MDA1Nw==", "bodyText": "The name \"filter\" makes it seem like the filteredJson is a subset of the original, in which case I would think it makes sense to validate the entire JSON instead of a subset. With your explanation it definitely makes sense (the name is just misleading).", "url": "https://github.com/elastic/elasticsearch/pull/51456#discussion_r375580057", "createdAt": "2020-02-06T00:15:17Z", "author": {"login": "dakrone"}, "path": "x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/template/TemplateUtils.java", "diffHunk": "@@ -59,9 +59,10 @@ public static void loadTemplateIntoMap(String resource, Map<String, IndexTemplat\n     public static String loadTemplate(String resource, String version, String versionProperty) {\n         try {\n             BytesReference source = load(resource);\n-            validate(source);\n+            final String filteredJson = filter(source, version, versionProperty);\n+            validate(new BytesArray(filteredJson));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTU3NTYzMQ=="}, "originalCommit": {"oid": "0f7fedc548d72c736293697aa3bbf508037df8ea"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTU5NTk2Mw==", "bodyText": "It is a misleading name - I would have taken the opportunity to change it, but Dimitris is going to do so in #51765, as part of modifying IndexTemplateRegistry (and associated classes) to allow other variable substitutions in addition to the version.", "url": "https://github.com/elastic/elasticsearch/pull/51456#discussion_r375595963", "createdAt": "2020-02-06T01:14:59Z", "author": {"login": "gwbrown"}, "path": "x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/template/TemplateUtils.java", "diffHunk": "@@ -59,9 +59,10 @@ public static void loadTemplateIntoMap(String resource, Map<String, IndexTemplat\n     public static String loadTemplate(String resource, String version, String versionProperty) {\n         try {\n             BytesReference source = load(resource);\n-            validate(source);\n+            final String filteredJson = filter(source, version, versionProperty);\n+            validate(new BytesArray(filteredJson));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTU3NTYzMQ=="}, "originalCommit": {"oid": "0f7fedc548d72c736293697aa3bbf508037df8ea"}, "originalPosition": 6}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4374, "cost": 1, "resetAt": "2021-11-12T13:16:51Z"}}}