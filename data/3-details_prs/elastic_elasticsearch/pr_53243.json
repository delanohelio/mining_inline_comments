{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg1MDA4Nzcx", "number": 53243, "title": "Save a little space on empty BitArrays", "bodyText": "It doesn't make a whole lot of sense for BitArray#clear to grow the\nunderlying storage array just to clear the bit. We already treat\nindices outside of the storage array as unset. This turns such\noperations into a noop.", "createdAt": "2020-03-06T20:31:12Z", "url": "https://github.com/elastic/elasticsearch/pull/53243", "merged": true, "mergeCommit": {"oid": "aea7aecb3a2c5d95f1993f525844ff0f6b90057d"}, "closed": true, "closedAt": "2020-03-09T21:31:54Z", "author": {"login": "nik9000"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcLGJZygH2gAyMzg1MDA4NzcxOmM3ZGVlNjk5YzE3MzQ5YmQ5YTJhNzEzY2FjMDY0MWFlMGFjZDRmMmQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcMBYPEgH2gAyMzg1MDA4NzcxOjQ0MDBjYzA3ODg4MWU3OGEzMjFkZTQyMjUwYjJhMGU5MmYxNGJmZjM=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "c7dee699c17349bd9a2a713cac0641ae0acd4f2d", "author": {"user": {"login": "nik9000", "name": "Nik Everett"}}, "url": "https://github.com/elastic/elasticsearch/commit/c7dee699c17349bd9a2a713cac0641ae0acd4f2d", "committedDate": "2020-03-06T20:28:57Z", "message": "Save a little space on empty BitArrays\n\nIt doesn't make a whole lot of sense for `BitArray#clear` to grow the\nunderlying storage array just to clear the bit. We *already* treat\nindices outside of the storage array as unset. This turns such\noperations into a noop."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcwNjUyOTA1", "url": "https://github.com/elastic/elasticsearch/pull/53243#pullrequestreview-370652905", "createdAt": "2020-03-06T21:59:58Z", "commit": {"oid": "c7dee699c17349bd9a2a713cac0641ae0acd4f2d"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNlQyMTo1OTo1OFrOFzIvSw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNlQyMTo1OTo1OFrOFzIvSw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTE2NDg3NQ==", "bodyText": "nit:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                         * No need resize the array to just to clear bit because we'll\n          \n          \n            \n                         * No need to resize the array to just clear bit because we'll", "url": "https://github.com/elastic/elasticsearch/pull/53243#discussion_r389164875", "createdAt": "2020-03-06T21:59:58Z", "author": {"login": "jimczi"}, "path": "server/src/main/java/org/elasticsearch/common/util/BitArray.java", "diffHunk": "@@ -41,21 +45,31 @@ public BitArray(int initialSize, BigArrays bigArrays) {\n      * Set the {@code index}th bit.\n      */\n     public void set(int index) {\n-        fill(index, true);\n+        int wordNum = wordNum(index);\n+        bits = bigArrays.grow(bits, wordNum + 1);\n+        bits.set(wordNum, bits.get(wordNum) | bitmask(index));\n     }\n \n     /**\n      * Clear the {@code index}th bit.\n      */\n     public void clear(int index) {\n-        fill(index, false);\n+        int wordNum = wordNum(index);\n+        if (wordNum >= bits.size()) {\n+            /*\n+             * No need resize the array to just to clear bit because we'll", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c7dee699c17349bd9a2a713cac0641ae0acd4f2d"}, "originalPosition": 29}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e032c0833ab04a99f89e84c98f47af70ec3163da", "author": {"user": {"login": "nik9000", "name": "Nik Everett"}}, "url": "https://github.com/elastic/elasticsearch/commit/e032c0833ab04a99f89e84c98f47af70ec3163da", "committedDate": "2020-03-09T17:28:25Z", "message": "Merge branch 'master' into bit_array_no_grow_clear"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "8d0c2e771229a79871afa58a6b1a183469c8e80e", "author": {"user": {"login": "nik9000", "name": "Nik Everett"}}, "url": "https://github.com/elastic/elasticsearch/commit/8d0c2e771229a79871afa58a6b1a183469c8e80e", "committedDate": "2020-03-09T14:58:04Z", "message": "Update server/src/main/java/org/elasticsearch/common/util/BitArray.java\n\nCo-Authored-By: Jim Ferenczi <jim.ferenczi@elastic.co>"}, "afterCommit": {"oid": "e032c0833ab04a99f89e84c98f47af70ec3163da", "author": {"user": {"login": "nik9000", "name": "Nik Everett"}}, "url": "https://github.com/elastic/elasticsearch/commit/e032c0833ab04a99f89e84c98f47af70ec3163da", "committedDate": "2020-03-09T17:28:25Z", "message": "Merge branch 'master' into bit_array_no_grow_clear"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4400cc078881e78a321de42250b2a0e92f14bff3", "author": {"user": {"login": "nik9000", "name": "Nik Everett"}}, "url": "https://github.com/elastic/elasticsearch/commit/4400cc078881e78a321de42250b2a0e92f14bff3", "committedDate": "2020-03-09T17:29:33Z", "message": "Man, words are hard"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1588, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}