{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg0MTk5NjA2", "number": 53160, "title": "Make ML index aliases hidden", "bodyText": "This PR makes the following aliases (pointing at ML hidden indices) hidden:\n\n.ml-annotations-read, .ml-annotations-write\n.ml-anomalies-JOB_ID, .ml-anomalies-.write-JOB_ID\n.ml-state-write\n.ml-stats-write\n\nRelates #52877", "createdAt": "2020-03-05T10:44:01Z", "url": "https://github.com/elastic/elasticsearch/pull/53160", "merged": true, "mergeCommit": {"oid": "221b005a45bf4b3d30987fb982844b818b157c05"}, "closed": true, "closedAt": "2020-03-18T08:28:00Z", "author": {"login": "przemekwitek"}, "timelineItems": {"totalCount": 18, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcKs2sIgBqjMxMDE1NjY4NTc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcOyG63ABqjMxNDAyNDI2ODY=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "98819c94d2883490388e6bbfbd739d20287b0e0b", "author": {"user": {"login": "przemekwitek", "name": "Przemys\u0142aw Witek"}}, "url": "https://github.com/elastic/elasticsearch/commit/98819c94d2883490388e6bbfbd739d20287b0e0b", "committedDate": "2020-03-05T10:41:51Z", "message": "Make ml index aliases hidden"}, "afterCommit": {"oid": "5e1138055b2d797be03ed564a0e23a4d26273ab6", "author": {"user": {"login": "przemekwitek", "name": "Przemys\u0142aw Witek"}}, "url": "https://github.com/elastic/elasticsearch/commit/5e1138055b2d797be03ed564a0e23a4d26273ab6", "committedDate": "2020-03-05T15:00:44Z", "message": "Make ml index aliases hidden"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "5e1138055b2d797be03ed564a0e23a4d26273ab6", "author": {"user": {"login": "przemekwitek", "name": "Przemys\u0142aw Witek"}}, "url": "https://github.com/elastic/elasticsearch/commit/5e1138055b2d797be03ed564a0e23a4d26273ab6", "committedDate": "2020-03-05T15:00:44Z", "message": "Make ml index aliases hidden"}, "afterCommit": {"oid": "f61308a9021236df326650657e05f18e1085cd49", "author": {"user": {"login": "przemekwitek", "name": "Przemys\u0142aw Witek"}}, "url": "https://github.com/elastic/elasticsearch/commit/f61308a9021236df326650657e05f18e1085cd49", "committedDate": "2020-03-05T15:04:34Z", "message": "Make ml index aliases hidden"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f61308a9021236df326650657e05f18e1085cd49", "author": {"user": {"login": "przemekwitek", "name": "Przemys\u0142aw Witek"}}, "url": "https://github.com/elastic/elasticsearch/commit/f61308a9021236df326650657e05f18e1085cd49", "committedDate": "2020-03-05T15:04:34Z", "message": "Make ml index aliases hidden"}, "afterCommit": {"oid": "c7fa5fa4f6a2e6e6891eb505882acbe36a3b9da4", "author": {"user": {"login": "przemekwitek", "name": "Przemys\u0142aw Witek"}}, "url": "https://github.com/elastic/elasticsearch/commit/c7fa5fa4f6a2e6e6891eb505882acbe36a3b9da4", "committedDate": "2020-03-05T17:17:57Z", "message": "Make ml index aliases hidden"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c7fa5fa4f6a2e6e6891eb505882acbe36a3b9da4", "author": {"user": {"login": "przemekwitek", "name": "Przemys\u0142aw Witek"}}, "url": "https://github.com/elastic/elasticsearch/commit/c7fa5fa4f6a2e6e6891eb505882acbe36a3b9da4", "committedDate": "2020-03-05T17:17:57Z", "message": "Make ml index aliases hidden"}, "afterCommit": {"oid": "583ed0f4f759f1487284dabeda16c665fce66091", "author": {"user": {"login": "przemekwitek", "name": "Przemys\u0142aw Witek"}}, "url": "https://github.com/elastic/elasticsearch/commit/583ed0f4f759f1487284dabeda16c665fce66091", "committedDate": "2020-03-09T09:38:47Z", "message": "Fix tests"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "583ed0f4f759f1487284dabeda16c665fce66091", "author": {"user": {"login": "przemekwitek", "name": "Przemys\u0142aw Witek"}}, "url": "https://github.com/elastic/elasticsearch/commit/583ed0f4f759f1487284dabeda16c665fce66091", "committedDate": "2020-03-09T09:38:47Z", "message": "Fix tests"}, "afterCommit": {"oid": "c5c64bde8073090dd8c2e1d3f3eef4c4b874344f", "author": {"user": {"login": "przemekwitek", "name": "Przemys\u0142aw Witek"}}, "url": "https://github.com/elastic/elasticsearch/commit/c5c64bde8073090dd8c2e1d3f3eef4c4b874344f", "committedDate": "2020-03-11T09:15:31Z", "message": "Fix tests"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c5c64bde8073090dd8c2e1d3f3eef4c4b874344f", "author": {"user": {"login": "przemekwitek", "name": "Przemys\u0142aw Witek"}}, "url": "https://github.com/elastic/elasticsearch/commit/c5c64bde8073090dd8c2e1d3f3eef4c4b874344f", "committedDate": "2020-03-11T09:15:31Z", "message": "Fix tests"}, "afterCommit": {"oid": "598e8f22a5bf46ebd9ed72c18acc900dab0d889f", "author": {"user": {"login": "przemekwitek", "name": "Przemys\u0142aw Witek"}}, "url": "https://github.com/elastic/elasticsearch/commit/598e8f22a5bf46ebd9ed72c18acc900dab0d889f", "committedDate": "2020-03-12T10:13:14Z", "message": "Make ml index aliases hidden"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzczNTk3MDU1", "url": "https://github.com/elastic/elasticsearch/pull/53160#pullrequestreview-373597055", "createdAt": "2020-03-12T14:19:45Z", "commit": {"oid": "a6ac5bc5723121f5763746b7248130015628d9fd"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMlQxNDoxOTo0NVrOF1gnMw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMlQxNDoxOTo0NVrOF1gnMw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTY1MzE3MQ==", "bodyText": "If the cluster has been upgraded then this might be adding a hidden alias on a non-hidden index. Is that a problem? (Maybe not - as long as you\u2019re sure I\u2019m good to merge this.)\nFor example, suppose a user runs ML in 7.6.1 and so has a non-hidden .ml-anomalies-shared index. Then they upgrade to 7.7 and create another job that uses the shared results index.\n(This also makes me realise that before 7.last we\u2019ll need another PR that makes pre-existing indices and aliases hidden. But that\u2019s not critical for 7.7.)", "url": "https://github.com/elastic/elasticsearch/pull/53160#discussion_r391653171", "createdAt": "2020-03-12T14:19:45Z", "author": {"login": "droberts195"}, "path": "x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/job/persistence/JobResultsProvider.java", "diffHunk": "@@ -282,9 +282,16 @@ public void createJobResultIndex(Job job, ClusterState state, final ActionListen\n         final String indexName = tempIndexName;\n \n         ActionListener<Boolean> indexAndMappingsListener = ActionListener.wrap(success -> {\n-            final IndicesAliasesRequest request = client.admin().indices().prepareAliases()\n-                    .addAlias(indexName, readAliasName, QueryBuilders.termQuery(Job.ID.getPreferredName(), job.getId()))\n-                    .addAlias(indexName, writeAliasName).request();\n+            final IndicesAliasesRequest request =\n+                client.admin().indices().prepareAliases()\n+                    .addAliasAction(\n+                        IndicesAliasesRequest.AliasActions.add()\n+                            .index(indexName)\n+                            .alias(readAliasName)\n+                            .isHidden(true)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a6ac5bc5723121f5763746b7248130015628d9fd"}, "originalPosition": 13}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a6ac5bc5723121f5763746b7248130015628d9fd", "author": {"user": {"login": "przemekwitek", "name": "Przemys\u0142aw Witek"}}, "url": "https://github.com/elastic/elasticsearch/commit/a6ac5bc5723121f5763746b7248130015628d9fd", "committedDate": "2020-03-12T12:50:43Z", "message": "Get rid of unnecessary `expand_aliases` parameter"}, "afterCommit": {"oid": "c6dab22354955b75013ccc69e2685dec838f0c8b", "author": {"user": {"login": "przemekwitek", "name": "Przemys\u0142aw Witek"}}, "url": "https://github.com/elastic/elasticsearch/commit/c6dab22354955b75013ccc69e2685dec838f0c8b", "committedDate": "2020-03-16T07:59:26Z", "message": "Uncomment assertions as /_cat/aliases API now accepts expand_wildcards parameter"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "742bbfc20964a0dfd67cb11a1617f25d7becf6d3", "author": {"user": {"login": "przemekwitek", "name": "Przemys\u0142aw Witek"}}, "url": "https://github.com/elastic/elasticsearch/commit/742bbfc20964a0dfd67cb11a1617f25d7becf6d3", "committedDate": "2020-03-16T08:40:33Z", "message": "Fix unit tests"}, "afterCommit": {"oid": "70812e3ba6b47be66d886b636ebaddffa89deb01", "author": {"user": {"login": "przemekwitek", "name": "Przemys\u0142aw Witek"}}, "url": "https://github.com/elastic/elasticsearch/commit/70812e3ba6b47be66d886b636ebaddffa89deb01", "committedDate": "2020-03-17T12:37:39Z", "message": "Add assertions verifying that aliases are hidden"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "70812e3ba6b47be66d886b636ebaddffa89deb01", "author": {"user": {"login": "przemekwitek", "name": "Przemys\u0142aw Witek"}}, "url": "https://github.com/elastic/elasticsearch/commit/70812e3ba6b47be66d886b636ebaddffa89deb01", "committedDate": "2020-03-17T12:37:39Z", "message": "Add assertions verifying that aliases are hidden"}, "afterCommit": {"oid": "bdd75ae30c92b337be41107d6681c39dd7740681", "author": {"user": {"login": "przemekwitek", "name": "Przemys\u0142aw Witek"}}, "url": "https://github.com/elastic/elasticsearch/commit/bdd75ae30c92b337be41107d6681c39dd7740681", "committedDate": "2020-03-17T12:45:06Z", "message": "Add assertions verifying that aliases are hidden"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc2MjAwMjE4", "url": "https://github.com/elastic/elasticsearch/pull/53160#pullrequestreview-376200218", "createdAt": "2020-03-17T16:27:36Z", "commit": {"oid": "bdd75ae30c92b337be41107d6681c39dd7740681"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e90692017b5888ac7dbe9d5b79b030267c285808", "author": {"user": {"login": "przemekwitek", "name": "Przemys\u0142aw Witek"}}, "url": "https://github.com/elastic/elasticsearch/commit/e90692017b5888ac7dbe9d5b79b030267c285808", "committedDate": "2020-03-18T07:23:32Z", "message": "Make ml index aliases hidden"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "709d4a76b72a59de9179fa634c098d88e5656afa", "author": {"user": {"login": "przemekwitek", "name": "Przemys\u0142aw Witek"}}, "url": "https://github.com/elastic/elasticsearch/commit/709d4a76b72a59de9179fa634c098d88e5656afa", "committedDate": "2020-03-18T07:23:32Z", "message": "Fix compile errors in tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7eb0a099069c4cf5bf07eee9c140a8f6d4a99e4a", "author": {"user": {"login": "przemekwitek", "name": "Przemys\u0142aw Witek"}}, "url": "https://github.com/elastic/elasticsearch/commit/7eb0a099069c4cf5bf07eee9c140a8f6d4a99e4a", "committedDate": "2020-03-18T07:23:32Z", "message": "Get rid of unnecessary `expand_aliases` parameter"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "99f280ee8a9d8bce41fbdf464d00164dbb7ab271", "author": {"user": {"login": "przemekwitek", "name": "Przemys\u0142aw Witek"}}, "url": "https://github.com/elastic/elasticsearch/commit/99f280ee8a9d8bce41fbdf464d00164dbb7ab271", "committedDate": "2020-03-18T07:23:32Z", "message": "Uncomment assertions as /_cat/aliases API now accepts expand_wildcards parameter"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b68885ced6b58c98e0a6add6ff2f8fc86a8af94a", "author": {"user": {"login": "przemekwitek", "name": "Przemys\u0142aw Witek"}}, "url": "https://github.com/elastic/elasticsearch/commit/b68885ced6b58c98e0a6add6ff2f8fc86a8af94a", "committedDate": "2020-03-18T07:23:32Z", "message": "Fix unit tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "52479521583c5233153846127e8b12ebc3d69128", "author": {"user": {"login": "przemekwitek", "name": "Przemys\u0142aw Witek"}}, "url": "https://github.com/elastic/elasticsearch/commit/52479521583c5233153846127e8b12ebc3d69128", "committedDate": "2020-03-18T07:23:32Z", "message": "Add assertions verifying that aliases are hidden"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "bdd75ae30c92b337be41107d6681c39dd7740681", "author": {"user": {"login": "przemekwitek", "name": "Przemys\u0142aw Witek"}}, "url": "https://github.com/elastic/elasticsearch/commit/bdd75ae30c92b337be41107d6681c39dd7740681", "committedDate": "2020-03-17T12:45:06Z", "message": "Add assertions verifying that aliases are hidden"}, "afterCommit": {"oid": "52479521583c5233153846127e8b12ebc3d69128", "author": {"user": {"login": "przemekwitek", "name": "Przemys\u0142aw Witek"}}, "url": "https://github.com/elastic/elasticsearch/commit/52479521583c5233153846127e8b12ebc3d69128", "committedDate": "2020-03-18T07:23:32Z", "message": "Add assertions verifying that aliases are hidden"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1789, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}