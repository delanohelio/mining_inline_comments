{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQzOTE5MDE5", "number": 58996, "title": "Simplify parser declarations when specialist types are stored in strings", "bodyText": "This PR:\n\nimplements AbstractObjectParser.declareStringField method\nmakes use of it in ml code\n\nThis saves some LoC as the new way of declaring parsed fields is more concise.", "createdAt": "2020-07-03T08:13:29Z", "url": "https://github.com/elastic/elasticsearch/pull/58996", "merged": true, "mergeCommit": {"oid": "d39bde9c95ff7a1e37181da09094bf6d69dd22eb"}, "closed": true, "closedAt": "2020-07-06T10:15:43Z", "author": {"login": "przemekwitek"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcwnbYRgH2gAyNDQzOTE5MDE5Ojc0MzY4YzMyYzM2NzU3YzlkNzljY2M1OWI2N2Q4NzU2ZGE2YTYyYzg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcxT7N_gH2gAyNDQzOTE5MDE5OmU5ZWM2MTIxNmE2MGIxMWY1OWVhM2E2Y2FkNjc5NzgwOWVlYjcyNDc=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "74368c32c36757c9d79ccc59b67d8756da6a62c8", "author": {"user": {"login": "przemekwitek", "name": "Przemys\u0142aw Witek"}}, "url": "https://github.com/elastic/elasticsearch/commit/74368c32c36757c9d79ccc59b67d8756da6a62c8", "committedDate": "2020-07-01T10:10:39Z", "message": "Mute failing test DataFrameAnalyticsConfigProviderIT.testUpdate_UpdateCannotBeAppliedWhenTaskIsRunning"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5c1345a0d051188f2957bcc5c20ed4fc57c6ed6a", "author": {"user": {"login": "przemekwitek", "name": "Przemys\u0142aw Witek"}}, "url": "https://github.com/elastic/elasticsearch/commit/5c1345a0d051188f2957bcc5c20ed4fc57c6ed6a", "committedDate": "2020-07-01T10:29:53Z", "message": "Merge branch 'master' of github.com:elastic/elasticsearch"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9f7feb0a434ee2b619468455799006f50cec710c", "author": {"user": {"login": "przemekwitek", "name": "Przemys\u0142aw Witek"}}, "url": "https://github.com/elastic/elasticsearch/commit/9f7feb0a434ee2b619468455799006f50cec710c", "committedDate": "2020-07-01T11:30:36Z", "message": "Merge branch 'master' of github.com:elastic/elasticsearch"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f6f56abea6bdd4c8f8de1e1f8df7efbc7eb74ff7", "author": {"user": {"login": "przemekwitek", "name": "Przemys\u0142aw Witek"}}, "url": "https://github.com/elastic/elasticsearch/commit/f6f56abea6bdd4c8f8de1e1f8df7efbc7eb74ff7", "committedDate": "2020-07-02T07:09:52Z", "message": "Merge branch 'master' of github.com:elastic/elasticsearch"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "38ef4fb524a74d2f02e2ee8a3358221d65f84ea7", "author": {"user": {"login": "przemekwitek", "name": "Przemys\u0142aw Witek"}}, "url": "https://github.com/elastic/elasticsearch/commit/38ef4fb524a74d2f02e2ee8a3358221d65f84ea7", "committedDate": "2020-07-03T08:05:33Z", "message": "Merge branch 'master' of github.com:elastic/elasticsearch"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "965ef9752b1eaec445dc2656bc38aa5605517453", "author": {"user": {"login": "przemekwitek", "name": "Przemys\u0142aw Witek"}}, "url": "https://github.com/elastic/elasticsearch/commit/965ef9752b1eaec445dc2656bc38aa5605517453", "committedDate": "2020-07-03T08:44:08Z", "message": "Implement \"declareStringField\" method and use it to simplify ml parsing code"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3a31a7df53e7c9b229e45e034f7f20fffe337c45", "author": {"user": {"login": "przemekwitek", "name": "Przemys\u0142aw Witek"}}, "url": "https://github.com/elastic/elasticsearch/commit/3a31a7df53e7c9b229e45e034f7f20fffe337c45", "committedDate": "2020-07-03T08:07:32Z", "message": "Implement \"declareStringField\" method and use it to simplify ml parsing code"}, "afterCommit": {"oid": "965ef9752b1eaec445dc2656bc38aa5605517453", "author": {"user": {"login": "przemekwitek", "name": "Przemys\u0142aw Witek"}}, "url": "https://github.com/elastic/elasticsearch/commit/965ef9752b1eaec445dc2656bc38aa5605517453", "committedDate": "2020-07-03T08:44:08Z", "message": "Implement \"declareStringField\" method and use it to simplify ml parsing code"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQyMzEwMDky", "url": "https://github.com/elastic/elasticsearch/pull/58996#pullrequestreview-442310092", "createdAt": "2020-07-03T10:16:43Z", "commit": {"oid": "965ef9752b1eaec445dc2656bc38aa5605517453"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQyMzg5OTA0", "url": "https://github.com/elastic/elasticsearch/pull/58996#pullrequestreview-442389904", "createdAt": "2020-07-03T12:47:22Z", "commit": {"oid": "965ef9752b1eaec445dc2656bc38aa5605517453"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wM1QxMjo0NzoyMlrOGsvUlA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wM1QxMjo1MTowOFrOGsvavQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTU2NTg0NA==", "bodyText": "I thought that this wouldn't get called unless it is on a string because of the ValueType.STRING.", "url": "https://github.com/elastic/elasticsearch/pull/58996#discussion_r449565844", "createdAt": "2020-07-03T12:47:22Z", "author": {"login": "nik9000"}, "path": "libs/x-content/src/main/java/org/elasticsearch/common/xcontent/AbstractObjectParser.java", "diffHunk": "@@ -222,6 +223,22 @@ public void declareIntOrNull(BiConsumer<Value, Integer> consumer, int nullValue,\n                 field, ValueType.INT_OR_NULL);\n     }\n \n+    /**\n+     * Declare a field of type {@code T} parsed from string and converted to {@code T} using provided function.\n+     * Throws if the next token is not a string.\n+     */\n+    public <T> void declareStringField(BiConsumer<Value, T> consumer, Function<String, T> fromStringFunction, ParseField field) {\n+        declareField(\n+            consumer,\n+            p -> {\n+                if (p.currentToken() == XContentParser.Token.VALUE_STRING) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "965ef9752b1eaec445dc2656bc38aa5605517453"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTU2NzEyOA==", "bodyText": "Would you be ok renaming to declareString?", "url": "https://github.com/elastic/elasticsearch/pull/58996#discussion_r449567128", "createdAt": "2020-07-03T12:50:30Z", "author": {"login": "nik9000"}, "path": "libs/x-content/src/main/java/org/elasticsearch/common/xcontent/AbstractObjectParser.java", "diffHunk": "@@ -222,6 +223,22 @@ public void declareIntOrNull(BiConsumer<Value, Integer> consumer, int nullValue,\n                 field, ValueType.INT_OR_NULL);\n     }\n \n+    /**\n+     * Declare a field of type {@code T} parsed from string and converted to {@code T} using provided function.\n+     * Throws if the next token is not a string.\n+     */\n+    public <T> void declareStringField(BiConsumer<Value, T> consumer, Function<String, T> fromStringFunction, ParseField field) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "965ef9752b1eaec445dc2656bc38aa5605517453"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTU2NzQyMQ==", "bodyText": "I'd prefer not to have an _ in the method name.", "url": "https://github.com/elastic/elasticsearch/pull/58996#discussion_r449567421", "createdAt": "2020-07-03T12:51:08Z", "author": {"login": "nik9000"}, "path": "libs/x-content/src/test/java/org/elasticsearch/common/xcontent/ObjectParserTests.java", "diffHunk": "@@ -338,6 +338,21 @@ public void set(TestEnum value) {\n         assertEquals(s.test, TestEnum.FOO);\n     }\n \n+    public void testDeclareStringField_ParseEnumFromString() throws IOException {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "965ef9752b1eaec445dc2656bc38aa5605517453"}, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e9ec61216a60b11f59ea3a6cad6797809eeb7247", "author": {"user": {"login": "przemekwitek", "name": "Przemys\u0142aw Witek"}}, "url": "https://github.com/elastic/elasticsearch/commit/e9ec61216a60b11f59ea3a6cad6797809eeb7247", "committedDate": "2020-07-03T14:01:15Z", "message": "Apply review comments"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2230, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}