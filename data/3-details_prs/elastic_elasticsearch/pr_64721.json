{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE2Nzk2Nzc3", "number": 64721, "title": "Ignore media ranges when parsing", "bodyText": "Browsers are sending media ranges with quality factors on Accept header.\nWe should ignore the value and respond with applicaiton/json\ncloses #64689\nrelates #51816\n\n\nHave you signed the contributor license agreement?\nHave you followed the contributor guidelines?\nIf submitting code, have you built your formula locally prior to submission with gradle check?\nIf submitting code, is your pull request against master? Unless there is a good reason otherwise, we prefer pull requests against master and will backport as needed.\nIf submitting code, have you checked that your submission is for an OS and architecture that we support?\nIf you are submitting this code for a class then read our policy for that.", "createdAt": "2020-11-06T14:56:50Z", "url": "https://github.com/elastic/elasticsearch/pull/64721", "merged": true, "mergeCommit": {"oid": "dd5bcd4093aec918bc11dc8a7ad2bc1dfb97e15d"}, "closed": true, "closedAt": "2020-11-09T08:03:19Z", "author": {"login": "pgomulka"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdZ4NsbgH2gAyNTE2Nzk2Nzc3OjE1ODk4NjMwNzg1ZmM1NjU0YzUwYzJmYmZmNmVkZTVkZmRiYzFhMjQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdZ6T-LgFqTUyNTM0OTA2OA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "15898630785fc5654c50c2fbff6ede5dfdbc1a24", "author": {"user": {"login": "pgomulka", "name": "Przemyslaw Gomulka"}}, "url": "https://github.com/elastic/elasticsearch/commit/15898630785fc5654c50c2fbff6ede5dfdbc1a24", "committedDate": "2020-11-06T14:54:59Z", "message": "Ignore media ranges when parsing\n\nBrowsers are sending media ranges with quality factors on Accept header.\nWe should ignore the value and responde with applicaiton/json\n\ncloses #64689\nrelates #51816"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6e0a96217632f4a21cbf72d863b603a5ad0edf99", "author": {"user": {"login": "pgomulka", "name": "Przemyslaw Gomulka"}}, "url": "https://github.com/elastic/elasticsearch/commit/6e0a96217632f4a21cbf72d863b603a5ad0edf99", "committedDate": "2020-11-06T14:58:46Z", "message": "Merge remote-tracking branch 'upstream/master' into compat/ignore_media_ranges"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d3dba4790078ebe0aa53ef0e40442dcac357980c", "author": {"user": {"login": "pgomulka", "name": "Przemyslaw Gomulka"}}, "url": "https://github.com/elastic/elasticsearch/commit/d3dba4790078ebe0aa53ef0e40442dcac357980c", "committedDate": "2020-11-06T15:14:57Z", "message": "remove unused const"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "86fa70dd48aebc57cc2136d2474ad9109b888986", "author": {"user": {"login": "pgomulka", "name": "Przemyslaw Gomulka"}}, "url": "https://github.com/elastic/elasticsearch/commit/86fa70dd48aebc57cc2136d2474ad9109b888986", "committedDate": "2020-11-06T16:02:54Z", "message": "nullcheck"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI1MzIzMTEw", "url": "https://github.com/elastic/elasticsearch/pull/64721#pullrequestreview-525323110", "createdAt": "2020-11-06T16:47:37Z", "commit": {"oid": "86fa70dd48aebc57cc2136d2474ad9109b888986"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI1MzQ4MzU4", "url": "https://github.com/elastic/elasticsearch/pull/64721#pullrequestreview-525348358", "createdAt": "2020-11-06T17:20:41Z", "commit": {"oid": "86fa70dd48aebc57cc2136d2474ad9109b888986"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNlQxNzoyMDo0MlrOHu2vkg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNlQxNzoyMDo0MlrOHu2vkg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODg5MzQ1OA==", "bodyText": "I think this should be moved down to and checked against elements[0] instead of the whole headerValue. A parameter could have a comma. Probably not..but slightly more correct.", "url": "https://github.com/elastic/elasticsearch/pull/64721#discussion_r518893458", "createdAt": "2020-11-06T17:20:42Z", "author": {"login": "jakelandis"}, "path": "libs/x-content/src/main/java/org/elasticsearch/common/xcontent/ParsedMediaType.java", "diffHunk": "@@ -63,18 +58,19 @@ public String mediaTypeWithoutParameters() {\n \n     /**\n      * Parses a header value into it's parts.\n-     * follows https://tools.ietf.org/html/rfc7231#section-3.1.1.1 but allows only single media type and do not support quality factors\n+     * follows https://tools.ietf.org/html/rfc7231#section-3.1.1.1\n+     * but allows only single media type. Media ranges will be ignored (treated as not provided)\n      * Note: parsing can return null, but it will throw exceptions once https://github.com/elastic/elasticsearch/issues/63080 is done\n-     * Do not rely on nulls\n+     * TODO Do not rely on nulls\n      *\n      * @return a {@link ParsedMediaType} if the header could be parsed.\n      * @throws IllegalArgumentException if the header is malformed\n      */\n     public static ParsedMediaType parseMediaType(String headerValue) {\n-        if (DEFAULT_ACCEPT_STRING.equals(headerValue) || \"*/*\".equals(headerValue)) {\n-            return null;\n-        }\n         if (headerValue != null) {\n+            if (isMediaRange(headerValue) || \"*/*\".equals(headerValue)) {\n+                return null;\n+            }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "86fa70dd48aebc57cc2136d2474ad9109b888986"}, "originalPosition": 33}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI1MzQ5MDY4", "url": "https://github.com/elastic/elasticsearch/pull/64721#pullrequestreview-525349068", "createdAt": "2020-11-06T17:21:39Z", "commit": {"oid": "86fa70dd48aebc57cc2136d2474ad9109b888986"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1229, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}