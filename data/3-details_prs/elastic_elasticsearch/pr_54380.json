{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk1MTM5NjIw", "number": 54380, "title": "EQL: implement stringContains function", "bodyText": "Related to #54136", "createdAt": "2020-03-28T19:04:45Z", "url": "https://github.com/elastic/elasticsearch/pull/54380", "merged": true, "mergeCommit": {"oid": "3cd858c8dfc77f1c68b2dd2a0f5a8f4b6fffe393"}, "closed": true, "closedAt": "2020-04-07T20:34:08Z", "author": {"login": "aleksmaus"}, "timelineItems": {"totalCount": 16, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcSKGhzAH2gAyMzk1MTM5NjIwOmMwMWMwOTNmOGRjNDdiYjI4NzFlOGI5MWMyY2Y3ZDE4ODZkMTZkNjk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcVYeEBgH2gAyMzk1MTM5NjIwOjY1NzY1Y2MxMzE2NDg5Nzc2Yzc1ZDZkODMxNmI4NjRlMzk1YWVhOWM=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "c01c093f8dc47bb2871e8b91c2cf7d1886d16d69", "author": {"user": {"login": "aleksmaus", "name": "Aleksandr Maus"}}, "url": "https://github.com/elastic/elasticsearch/commit/c01c093f8dc47bb2871e8b91c2cf7d1886d16d69", "committedDate": "2020-03-28T19:02:54Z", "message": "EQL: implement stringContains function"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgzOTg3ODE4", "url": "https://github.com/elastic/elasticsearch/pull/54380#pullrequestreview-383987818", "createdAt": "2020-03-30T15:44:32Z", "commit": {"oid": "c01c093f8dc47bb2871e8b91c2cf7d1886d16d69"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMFQxNTo0NDozM1rOF9wJRQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMFQxNTo0NDozM1rOF9wJRQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDI5NjI2MQ==", "bodyText": "I think (per a slack conversation) that we'll handle case-sensitivity separately, so no need for the argument?", "url": "https://github.com/elastic/elasticsearch/pull/54380#discussion_r400296261", "createdAt": "2020-03-30T15:44:33Z", "author": {"login": "rw-access"}, "path": "x-pack/plugin/eql/src/main/java/org/elasticsearch/xpack/eql/expression/function/scalar/stringcontains/StringContains.java", "diffHunk": "@@ -0,0 +1,135 @@\n+/*\n+ * Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one\n+ * or more contributor license agreements. Licensed under the Elastic License;\n+ * you may not use this file except in compliance with the Elastic License.\n+ */\n+\n+package org.elasticsearch.xpack.eql.expression.function.scalar.stringcontains;\n+\n+import org.elasticsearch.xpack.ql.expression.Expression;\n+import org.elasticsearch.xpack.ql.expression.Expressions;\n+import org.elasticsearch.xpack.ql.expression.FieldAttribute;\n+import org.elasticsearch.xpack.ql.expression.Literal;\n+import org.elasticsearch.xpack.ql.expression.function.OptionalArgument;\n+import org.elasticsearch.xpack.ql.expression.function.scalar.ScalarFunction;\n+import org.elasticsearch.xpack.ql.expression.gen.pipeline.Pipe;\n+import org.elasticsearch.xpack.ql.expression.gen.script.ScriptTemplate;\n+import org.elasticsearch.xpack.ql.expression.gen.script.Scripts;\n+import org.elasticsearch.xpack.ql.tree.NodeInfo;\n+import org.elasticsearch.xpack.ql.tree.Source;\n+import org.elasticsearch.xpack.ql.type.DataType;\n+import org.elasticsearch.xpack.ql.type.DataTypes;\n+\n+import java.util.Arrays;\n+import java.util.List;\n+import java.util.Locale;\n+\n+import static java.lang.String.format;\n+import static org.elasticsearch.xpack.eql.expression.function.scalar.stringcontains.StringContainsFunctionProcessor.doProcess;\n+import static org.elasticsearch.xpack.ql.expression.TypeResolutions.isBoolean;\n+import static org.elasticsearch.xpack.ql.expression.TypeResolutions.isStringAndExact;\n+import static org.elasticsearch.xpack.ql.expression.gen.script.ParamsBuilder.paramsBuilder;\n+\n+/**\n+ * EQL specific stringContains function.\n+ * https://eql.readthedocs.io/en/latest/query-guide/functions.html#stringContains\n+ * stringContains(a, b)\n+ * Returns true if b is a substring of a\n+ */\n+public class StringContains extends ScalarFunction implements OptionalArgument {\n+\n+    private final Expression haystack, needle, caseSensitive;\n+\n+    public StringContains(Source source, Expression haystack, Expression needle, Expression caseSensitive) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c01c093f8dc47bb2871e8b91c2cf7d1886d16d69"}, "originalPosition": 43}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg0MDg1NDg2", "url": "https://github.com/elastic/elasticsearch/pull/54380#pullrequestreview-384085486", "createdAt": "2020-03-30T17:41:34Z", "commit": {"oid": "c01c093f8dc47bb2871e8b91c2cf7d1886d16d69"}, "state": "COMMENTED", "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMFQxNzo0MTozNFrOF90-UA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMFQxNzo1MjozNVrOF91Ziw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDM3NTM3Ng==", "bodyText": "Package I think should be org.elasticsearch.xpack.eql.expression.function.scalar.string.", "url": "https://github.com/elastic/elasticsearch/pull/54380#discussion_r400375376", "createdAt": "2020-03-30T17:41:34Z", "author": {"login": "astefan"}, "path": "x-pack/plugin/eql/src/main/java/org/elasticsearch/xpack/eql/expression/function/scalar/stringcontains/StringContains.java", "diffHunk": "@@ -0,0 +1,135 @@\n+/*\n+ * Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one\n+ * or more contributor license agreements. Licensed under the Elastic License;\n+ * you may not use this file except in compliance with the Elastic License.\n+ */\n+\n+package org.elasticsearch.xpack.eql.expression.function.scalar.stringcontains;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c01c093f8dc47bb2871e8b91c2cf7d1886d16d69"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDM3NzQyOQ==", "bodyText": "Personally, I find haystack and needle inappropriate here. I know that it fits with the purpose of the function :-), but I prefer string and pattern  or substring.", "url": "https://github.com/elastic/elasticsearch/pull/54380#discussion_r400377429", "createdAt": "2020-03-30T17:44:49Z", "author": {"login": "astefan"}, "path": "x-pack/plugin/eql/src/main/java/org/elasticsearch/xpack/eql/expression/function/scalar/stringcontains/StringContains.java", "diffHunk": "@@ -0,0 +1,135 @@\n+/*\n+ * Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one\n+ * or more contributor license agreements. Licensed under the Elastic License;\n+ * you may not use this file except in compliance with the Elastic License.\n+ */\n+\n+package org.elasticsearch.xpack.eql.expression.function.scalar.stringcontains;\n+\n+import org.elasticsearch.xpack.ql.expression.Expression;\n+import org.elasticsearch.xpack.ql.expression.Expressions;\n+import org.elasticsearch.xpack.ql.expression.FieldAttribute;\n+import org.elasticsearch.xpack.ql.expression.Literal;\n+import org.elasticsearch.xpack.ql.expression.function.OptionalArgument;\n+import org.elasticsearch.xpack.ql.expression.function.scalar.ScalarFunction;\n+import org.elasticsearch.xpack.ql.expression.gen.pipeline.Pipe;\n+import org.elasticsearch.xpack.ql.expression.gen.script.ScriptTemplate;\n+import org.elasticsearch.xpack.ql.expression.gen.script.Scripts;\n+import org.elasticsearch.xpack.ql.tree.NodeInfo;\n+import org.elasticsearch.xpack.ql.tree.Source;\n+import org.elasticsearch.xpack.ql.type.DataType;\n+import org.elasticsearch.xpack.ql.type.DataTypes;\n+\n+import java.util.Arrays;\n+import java.util.List;\n+import java.util.Locale;\n+\n+import static java.lang.String.format;\n+import static org.elasticsearch.xpack.eql.expression.function.scalar.stringcontains.StringContainsFunctionProcessor.doProcess;\n+import static org.elasticsearch.xpack.ql.expression.TypeResolutions.isBoolean;\n+import static org.elasticsearch.xpack.ql.expression.TypeResolutions.isStringAndExact;\n+import static org.elasticsearch.xpack.ql.expression.gen.script.ParamsBuilder.paramsBuilder;\n+\n+/**\n+ * EQL specific stringContains function.\n+ * https://eql.readthedocs.io/en/latest/query-guide/functions.html#stringContains\n+ * stringContains(a, b)\n+ * Returns true if b is a substring of a\n+ */\n+public class StringContains extends ScalarFunction implements OptionalArgument {\n+\n+    private final Expression haystack, needle, caseSensitive;\n+\n+    public StringContains(Source source, Expression haystack, Expression needle, Expression caseSensitive) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c01c093f8dc47bb2871e8b91c2cf7d1886d16d69"}, "originalPosition": 43}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDM3OTU1Nw==", "bodyText": "I'm not convinced this method is really needed. It's just a short one-liner... Maybe other reviewers thing otherwise, but I would keep using the ternary operator inline.", "url": "https://github.com/elastic/elasticsearch/pull/54380#discussion_r400379557", "createdAt": "2020-03-30T17:48:08Z", "author": {"login": "astefan"}, "path": "x-pack/plugin/eql/src/main/java/org/elasticsearch/xpack/eql/expression/function/scalar/stringcontains/StringContains.java", "diffHunk": "@@ -0,0 +1,135 @@\n+/*\n+ * Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one\n+ * or more contributor license agreements. Licensed under the Elastic License;\n+ * you may not use this file except in compliance with the Elastic License.\n+ */\n+\n+package org.elasticsearch.xpack.eql.expression.function.scalar.stringcontains;\n+\n+import org.elasticsearch.xpack.ql.expression.Expression;\n+import org.elasticsearch.xpack.ql.expression.Expressions;\n+import org.elasticsearch.xpack.ql.expression.FieldAttribute;\n+import org.elasticsearch.xpack.ql.expression.Literal;\n+import org.elasticsearch.xpack.ql.expression.function.OptionalArgument;\n+import org.elasticsearch.xpack.ql.expression.function.scalar.ScalarFunction;\n+import org.elasticsearch.xpack.ql.expression.gen.pipeline.Pipe;\n+import org.elasticsearch.xpack.ql.expression.gen.script.ScriptTemplate;\n+import org.elasticsearch.xpack.ql.expression.gen.script.Scripts;\n+import org.elasticsearch.xpack.ql.tree.NodeInfo;\n+import org.elasticsearch.xpack.ql.tree.Source;\n+import org.elasticsearch.xpack.ql.type.DataType;\n+import org.elasticsearch.xpack.ql.type.DataTypes;\n+\n+import java.util.Arrays;\n+import java.util.List;\n+import java.util.Locale;\n+\n+import static java.lang.String.format;\n+import static org.elasticsearch.xpack.eql.expression.function.scalar.stringcontains.StringContainsFunctionProcessor.doProcess;\n+import static org.elasticsearch.xpack.ql.expression.TypeResolutions.isBoolean;\n+import static org.elasticsearch.xpack.ql.expression.TypeResolutions.isStringAndExact;\n+import static org.elasticsearch.xpack.ql.expression.gen.script.ParamsBuilder.paramsBuilder;\n+\n+/**\n+ * EQL specific stringContains function.\n+ * https://eql.readthedocs.io/en/latest/query-guide/functions.html#stringContains\n+ * stringContains(a, b)\n+ * Returns true if b is a substring of a\n+ */\n+public class StringContains extends ScalarFunction implements OptionalArgument {\n+\n+    private final Expression haystack, needle, caseSensitive;\n+\n+    public StringContains(Source source, Expression haystack, Expression needle, Expression caseSensitive) {\n+        super(source, Arrays.asList(haystack, needle, toDefault(caseSensitive)));\n+        this.haystack = haystack;\n+        this.needle = needle;\n+        this.caseSensitive = arguments().get(2);\n+    }\n+\n+    private static Expression toDefault(Expression exp) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c01c093f8dc47bb2871e8b91c2cf7d1886d16d69"}, "originalPosition": 50}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDM4MDY4MQ==", "bodyText": "No caseSensitive?", "url": "https://github.com/elastic/elasticsearch/pull/54380#discussion_r400380681", "createdAt": "2020-03-30T17:49:50Z", "author": {"login": "astefan"}, "path": "x-pack/plugin/eql/src/main/java/org/elasticsearch/xpack/eql/expression/function/scalar/stringcontains/StringContainsFunctionPipe.java", "diffHunk": "@@ -0,0 +1,113 @@\n+/*\n+ * Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one\n+ * or more contributor license agreements. Licensed under the Elastic License;\n+ * you may not use this file except in compliance with the Elastic License.\n+ */\n+\n+package org.elasticsearch.xpack.eql.expression.function.scalar.stringcontains;\n+\n+import org.elasticsearch.xpack.ql.execution.search.QlSourceBuilder;\n+import org.elasticsearch.xpack.ql.expression.Expression;\n+import org.elasticsearch.xpack.ql.expression.gen.pipeline.Pipe;\n+import org.elasticsearch.xpack.ql.tree.NodeInfo;\n+import org.elasticsearch.xpack.ql.tree.Source;\n+\n+import java.util.Arrays;\n+import java.util.List;\n+import java.util.Objects;\n+\n+public class StringContainsFunctionPipe extends Pipe {\n+\n+    private final Pipe haystack, needle, caseSensitive;\n+\n+    public StringContainsFunctionPipe(Source source, Expression expression, Pipe haystack, Pipe needle, Pipe caseSensitive) {\n+        super(source, expression, Arrays.asList(haystack, needle));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c01c093f8dc47bb2871e8b91c2cf7d1886d16d69"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDM4MTI3Ng==", "bodyText": "sstc maybe?", "url": "https://github.com/elastic/elasticsearch/pull/54380#discussion_r400381276", "createdAt": "2020-03-30T17:50:48Z", "author": {"login": "astefan"}, "path": "x-pack/plugin/eql/src/main/java/org/elasticsearch/xpack/eql/expression/function/scalar/stringcontains/StringContainsFunctionProcessor.java", "diffHunk": "@@ -0,0 +1,113 @@\n+/*\n+ * Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one\n+ * or more contributor license agreements. Licensed under the Elastic License;\n+ * you may not use this file except in compliance with the Elastic License.\n+ */\n+\n+package org.elasticsearch.xpack.eql.expression.function.scalar.stringcontains;\n+\n+import org.elasticsearch.common.io.stream.StreamInput;\n+import org.elasticsearch.common.io.stream.StreamOutput;\n+import org.elasticsearch.xpack.eql.EqlIllegalArgumentException;\n+import org.elasticsearch.xpack.ql.expression.gen.processor.Processor;\n+\n+import java.io.IOException;\n+import java.util.Objects;\n+\n+public class StringContainsFunctionProcessor implements Processor {\n+\n+    public static final String NAME = \"sstringcontains\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c01c093f8dc47bb2871e8b91c2cf7d1886d16d69"}, "originalPosition": 19}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDM4MjM0Nw==", "bodyText": "Why this class? Shouldn't this method belong to a class that has other String utility method like this one here? And is this really needed to be placed in a separate class?", "url": "https://github.com/elastic/elasticsearch/pull/54380#discussion_r400382347", "createdAt": "2020-03-30T17:52:35Z", "author": {"login": "astefan"}, "path": "x-pack/plugin/eql/src/main/java/org/elasticsearch/xpack/eql/expression/function/scalar/stringcontains/StringContainsUtils.java", "diffHunk": "@@ -0,0 +1,40 @@\n+/*\n+ * Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one\n+ * or more contributor license agreements. Licensed under the Elastic License;\n+ * you may not use this file except in compliance with the Elastic License.\n+ */\n+\n+package org.elasticsearch.xpack.eql.expression.function.scalar.stringcontains;\n+\n+import java.util.Locale;\n+\n+import static org.elasticsearch.common.Strings.hasLength;\n+\n+final class StringContainsUtils {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c01c093f8dc47bb2871e8b91c2cf7d1886d16d69"}, "originalPosition": 13}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg0MjcyODg5", "url": "https://github.com/elastic/elasticsearch/pull/54380#pullrequestreview-384272889", "createdAt": "2020-03-30T22:19:11Z", "commit": {"oid": "c01c093f8dc47bb2871e8b91c2cf7d1886d16d69"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMFQyMjoxOToxMVrOF9-VXQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMFQyMjoxOToxMVrOF9-VXQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDUyODczMw==", "bodyText": "same convention as the existing? I believe function names are looked up case insensitive anyway\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                            def(StringContains.class, StringContains::new, \"stringcontains\"),\n          \n          \n            \n                            def(StringContains.class, StringContains::new, \"stringContains\"),", "url": "https://github.com/elastic/elasticsearch/pull/54380#discussion_r400528733", "createdAt": "2020-03-30T22:19:11Z", "author": {"login": "rw-access"}, "path": "x-pack/plugin/eql/src/main/java/org/elasticsearch/xpack/eql/expression/function/EqlFunctionRegistry.java", "diffHunk": "@@ -23,6 +24,7 @@ public EqlFunctionRegistry() {\n         // Scalar functions\n         // String\n             new FunctionDefinition[] {\n+                def(StringContains.class, StringContains::new, \"stringcontains\"),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c01c093f8dc47bb2871e8b91c2cf7d1886d16d69"}, "originalPosition": 12}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ed9f799e8ae9348c5a6a0ee31faf13aa3436f9a5", "author": {"user": {"login": "aleksmaus", "name": "Aleksandr Maus"}}, "url": "https://github.com/elastic/elasticsearch/commit/ed9f799e8ae9348c5a6a0ee31faf13aa3436f9a5", "committedDate": "2020-04-04T13:37:15Z", "message": "Merge branch 'master' into feature/stringContains"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8472a00078de62d3402eef0790cfbeb1716ad5eb", "author": {"user": {"login": "aleksmaus", "name": "Aleksandr Maus"}}, "url": "https://github.com/elastic/elasticsearch/commit/8472a00078de62d3402eef0790cfbeb1716ad5eb", "committedDate": "2020-04-04T14:49:53Z", "message": "Address code review comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4e6adef70e5a82270a9b281dc25e3e54717b99c2", "author": {"user": {"login": "aleksmaus", "name": "Aleksandr Maus"}}, "url": "https://github.com/elastic/elasticsearch/commit/4e6adef70e5a82270a9b281dc25e3e54717b99c2", "committedDate": "2020-04-04T14:53:23Z", "message": "Fix javadoc comment for stringContains function"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg4NDI3MDMw", "url": "https://github.com/elastic/elasticsearch/pull/54380#pullrequestreview-388427030", "createdAt": "2020-04-06T16:38:58Z", "commit": {"oid": "4e6adef70e5a82270a9b281dc25e3e54717b99c2"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wNlQxNjozODo1OVrOGBgagg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wNlQxNjozODo1OVrOGBgagg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDIzMjgzNA==", "bodyText": "we can probably remove this link since Elasticsearch will eventually be the authoritative documentation", "url": "https://github.com/elastic/elasticsearch/pull/54380#discussion_r404232834", "createdAt": "2020-04-06T16:38:59Z", "author": {"login": "rw-access"}, "path": "x-pack/plugin/eql/src/main/java/org/elasticsearch/xpack/eql/expression/function/scalar/string/StringContains.java", "diffHunk": "@@ -0,0 +1,117 @@\n+/*\n+ * Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one\n+ * or more contributor license agreements. Licensed under the Elastic License;\n+ * you may not use this file except in compliance with the Elastic License.\n+ */\n+\n+package org.elasticsearch.xpack.eql.expression.function.scalar.string;\n+\n+import org.elasticsearch.xpack.ql.expression.Expression;\n+import org.elasticsearch.xpack.ql.expression.Expressions;\n+import org.elasticsearch.xpack.ql.expression.FieldAttribute;\n+import org.elasticsearch.xpack.ql.expression.function.scalar.ScalarFunction;\n+import org.elasticsearch.xpack.ql.expression.gen.pipeline.Pipe;\n+import org.elasticsearch.xpack.ql.expression.gen.script.ScriptTemplate;\n+import org.elasticsearch.xpack.ql.expression.gen.script.Scripts;\n+import org.elasticsearch.xpack.ql.tree.NodeInfo;\n+import org.elasticsearch.xpack.ql.tree.Source;\n+import org.elasticsearch.xpack.ql.type.DataType;\n+import org.elasticsearch.xpack.ql.type.DataTypes;\n+\n+import java.util.Arrays;\n+import java.util.List;\n+import java.util.Locale;\n+\n+import static java.lang.String.format;\n+import static org.elasticsearch.xpack.eql.expression.function.scalar.string.StringContainsFunctionProcessor.doProcess;\n+import static org.elasticsearch.xpack.ql.expression.TypeResolutions.isStringAndExact;\n+import static org.elasticsearch.xpack.ql.expression.gen.script.ParamsBuilder.paramsBuilder;\n+\n+/**\n+ * EQL specific stringContains function.\n+ * https://eql.readthedocs.io/en/latest/query-guide/functions.html#stringContains", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4e6adef70e5a82270a9b281dc25e3e54717b99c2"}, "originalPosition": 32}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg4NDI3NTUz", "url": "https://github.com/elastic/elasticsearch/pull/54380#pullrequestreview-388427553", "createdAt": "2020-04-06T16:39:35Z", "commit": {"oid": "4e6adef70e5a82270a9b281dc25e3e54717b99c2"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wNlQxNjozOTozNVrOGBgcPg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wNlQxNjozOTozNVrOGBgcPg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDIzMzI3OA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    if (string == null) {\n          \n          \n            \n                    if (string == null || substring == null) {", "url": "https://github.com/elastic/elasticsearch/pull/54380#discussion_r404233278", "createdAt": "2020-04-06T16:39:35Z", "author": {"login": "rw-access"}, "path": "x-pack/plugin/eql/src/main/java/org/elasticsearch/xpack/eql/expression/function/scalar/string/StringContainsFunctionProcessor.java", "diffHunk": "@@ -0,0 +1,96 @@\n+/*\n+ * Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one\n+ * or more contributor license agreements. Licensed under the Elastic License;\n+ * you may not use this file except in compliance with the Elastic License.\n+ */\n+\n+package org.elasticsearch.xpack.eql.expression.function.scalar.string;\n+\n+import org.elasticsearch.common.io.stream.StreamInput;\n+import org.elasticsearch.common.io.stream.StreamOutput;\n+import org.elasticsearch.xpack.eql.EqlIllegalArgumentException;\n+import org.elasticsearch.xpack.ql.expression.gen.processor.Processor;\n+\n+import java.io.IOException;\n+import java.util.Objects;\n+\n+public class StringContainsFunctionProcessor implements Processor {\n+\n+    public static final String NAME = \"sstc\";\n+\n+    private final Processor string, substring;\n+\n+    public StringContainsFunctionProcessor(Processor string, Processor substring) {\n+        this.string = string;\n+        this.substring = substring;\n+    }\n+\n+    public StringContainsFunctionProcessor(StreamInput in) throws IOException {\n+        string = in.readNamedWriteable(Processor.class);\n+        substring = in.readNamedWriteable(Processor.class);\n+    }\n+\n+    @Override\n+    public final void writeTo(StreamOutput out) throws IOException {\n+        out.writeNamedWriteable(string);\n+        out.writeNamedWriteable(substring);\n+    }\n+\n+    @Override\n+    public Object process(Object input) {\n+        return doProcess(string.process(input), substring.process(input));\n+    }\n+\n+    public static Object doProcess(Object string, Object substring) {\n+        if (string == null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4e6adef70e5a82270a9b281dc25e3e54717b99c2"}, "originalPosition": 45}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg4NDI4NTcx", "url": "https://github.com/elastic/elasticsearch/pull/54380#pullrequestreview-388428571", "createdAt": "2020-04-06T16:40:47Z", "commit": {"oid": "4e6adef70e5a82270a9b281dc25e3e54717b99c2"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wNlQxNjo0MDo0N1rOGBgfWg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wNlQxNjo0MDo0N1rOGBgfWg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDIzNDA3NA==", "bodyText": "before substring for alphabetical order", "url": "https://github.com/elastic/elasticsearch/pull/54380#discussion_r404234074", "createdAt": "2020-04-06T16:40:47Z", "author": {"login": "rw-access"}, "path": "x-pack/plugin/eql/src/main/java/org/elasticsearch/xpack/eql/expression/function/scalar/whitelist/InternalEqlScriptUtils.java", "diffHunk": "@@ -36,4 +37,9 @@ public static Boolean startsWith(String s, String pattern) {\n     public static String substring(String s, Number start, Number end) {\n         return (String) SubstringFunctionProcessor.doProcess(s, start, end);\n     }\n+\n+    public static Boolean stringContains(String string, String substring) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4e6adef70e5a82270a9b281dc25e3e54717b99c2"}, "originalPosition": 13}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg4NDI5NDcw", "url": "https://github.com/elastic/elasticsearch/pull/54380#pullrequestreview-388429470", "createdAt": "2020-04-06T16:41:50Z", "commit": {"oid": "4e6adef70e5a82270a9b281dc25e3e54717b99c2"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wNlQxNjo0MTo1MFrOGBgiGw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wNlQxNjo0MTo1MFrOGBgiGw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDIzNDc3OQ==", "bodyText": "between startswith and substring?", "url": "https://github.com/elastic/elasticsearch/pull/54380#discussion_r404234779", "createdAt": "2020-04-06T16:41:50Z", "author": {"login": "rw-access"}, "path": "x-pack/plugin/eql/src/test/resources/queryfolder_tests.txt", "diffHunk": "@@ -103,6 +103,13 @@ InternalEqlScriptUtils.substring(InternalQlScriptUtils.docValue(doc,params.v0),p\n \"params\":{\"v0\":\"file_name.keyword\",\"v1\":-4,\"v2\":null,\"v3\":\".exe\"}\n \n \n+stringContains", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4e6adef70e5a82270a9b281dc25e3e54717b99c2"}, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e19ba6736a86e1e42be059fd2e9747f87734ac00", "author": {"user": {"login": "aleksmaus", "name": "Aleksandr Maus"}}, "url": "https://github.com/elastic/elasticsearch/commit/e19ba6736a86e1e42be059fd2e9747f87734ac00", "committedDate": "2020-04-06T17:42:48Z", "message": "Address code review comments"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg4Njc2NzY3", "url": "https://github.com/elastic/elasticsearch/pull/54380#pullrequestreview-388676767", "createdAt": "2020-04-06T23:01:21Z", "commit": {"oid": "e19ba6736a86e1e42be059fd2e9747f87734ac00"}, "state": "APPROVED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wNlQyMzowMToyMVrOGBs_8Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wNlQyMzowNTozMlrOGBtFhg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDQzOTAyNQ==", "bodyText": "string == null ? null : true", "url": "https://github.com/elastic/elasticsearch/pull/54380#discussion_r404439025", "createdAt": "2020-04-06T23:01:21Z", "author": {"login": "astefan"}, "path": "x-pack/plugin/eql/src/test/java/org/elasticsearch/xpack/eql/expression/function/scalar/string/StringContainsFunctionProcessorTests.java", "diffHunk": "@@ -0,0 +1,50 @@\n+/*\n+ * Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one\n+ * or more contributor license agreements. Licensed under the Elastic License;\n+ * you may not use this file except in compliance with the Elastic License.\n+ */\n+\n+package org.elasticsearch.xpack.eql.expression.function.scalar.string;\n+\n+import org.elasticsearch.test.ESTestCase;\n+import org.elasticsearch.xpack.eql.EqlIllegalArgumentException;\n+import org.elasticsearch.xpack.eql.expression.function.scalar.string.StringContainsFunctionProcessor;\n+\n+import java.util.concurrent.Callable;\n+\n+import static org.hamcrest.Matchers.equalTo;\n+\n+public class StringContainsFunctionProcessorTests extends ESTestCase {\n+\n+    // TODO (AM): consolidate with other functions tests in previous PRs where I already used this pattern once they are merged\n+    protected static final int NUMBER_OF_TEST_RUNS = 20;\n+\n+    protected static void run(Callable<Void> callable) throws Exception {\n+        for (int runs = 0; runs < NUMBER_OF_TEST_RUNS; runs++) {\n+            callable.call();\n+        }\n+    }\n+\n+    public void testNullOrEmptyParameters() throws Exception {\n+        run(() -> {\n+            String substring = randomBoolean() ? null : randomAlphaOfLength(10);\n+            String str = randomBoolean() ? null : randomAlphaOfLength(10);\n+            if (str != null && substring != null) {\n+                str += substring;\n+                str += randomAlphaOfLength(10);\n+            }\n+            final String string = str;\n+\n+            // The string parameter can be null. Expect exception if any of other parameters is null.\n+            if ((string != null) && (substring == null)) {\n+                EqlIllegalArgumentException e = expectThrows(EqlIllegalArgumentException.class,\n+                        () -> StringContainsFunctionProcessor.doProcess(string, substring));\n+                    assertThat(e.getMessage(), equalTo(\"A string/char is required; received [null]\"));\n+            } else {\n+                assertThat(StringContainsFunctionProcessor.doProcess(string, substring),\n+                        equalTo(string == null? null : true));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e19ba6736a86e1e42be059fd2e9747f87734ac00"}, "originalPosition": 45}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDQ0MDMxNQ==", "bodyText": "Imo, I don't think we need this high degree of unit tests for this particular functionality, but wait for @costin's take on this before modifying this or leaving it as is.", "url": "https://github.com/elastic/elasticsearch/pull/54380#discussion_r404440315", "createdAt": "2020-04-06T23:05:04Z", "author": {"login": "astefan"}, "path": "x-pack/plugin/eql/src/test/java/org/elasticsearch/xpack/eql/expression/function/scalar/string/StringUtilsTests.java", "diffHunk": "@@ -8,10 +8,21 @@\n \n import org.elasticsearch.test.ESTestCase;\n \n+import java.util.concurrent.Callable;\n+\n+import static org.elasticsearch.xpack.eql.expression.function.scalar.string.StringUtils.stringContains;\n import static org.elasticsearch.xpack.eql.expression.function.scalar.string.StringUtils.substringSlice;\n \n public class StringUtilsTests extends ESTestCase {\n \n+    protected static final int NUMBER_OF_TEST_RUNS = 20;\n+\n+    private static void run(Callable<Void> callable) throws Exception {\n+        for (int runs = 0; runs < NUMBER_OF_TEST_RUNS; runs++) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e19ba6736a86e1e42be059fd2e9747f87734ac00"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDQ0MDQ1NA==", "bodyText": "I think this line fits inside the previous one.", "url": "https://github.com/elastic/elasticsearch/pull/54380#discussion_r404440454", "createdAt": "2020-04-06T23:05:32Z", "author": {"login": "astefan"}, "path": "x-pack/plugin/eql/src/test/java/org/elasticsearch/xpack/eql/planner/QueryFolderFailTests.java", "diffHunk": "@@ -11,6 +11,23 @@\n import org.elasticsearch.xpack.ql.QlIllegalArgumentException;\n \n public class QueryFolderFailTests extends AbstractQueryFolderTestCase {\n+\n+    private String error(String query) {\n+        VerificationException e = expectThrows(VerificationException.class,\n+                () -> plan(query));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e19ba6736a86e1e42be059fd2e9747f87734ac00"}, "originalPosition": 7}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6d259675c3ceb0effecfce7a6ecb847b85162a1a", "author": {"user": {"login": "aleksmaus", "name": "Aleksandr Maus"}}, "url": "https://github.com/elastic/elasticsearch/commit/6d259675c3ceb0effecfce7a6ecb847b85162a1a", "committedDate": "2020-04-07T17:05:16Z", "message": "Merge branch 'master' into feature/stringContains"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dd075560122d02da3a1aaa0543cb8096845ad872", "author": {"user": {"login": "aleksmaus", "name": "Aleksandr Maus"}}, "url": "https://github.com/elastic/elasticsearch/commit/dd075560122d02da3a1aaa0543cb8096845ad872", "committedDate": "2020-04-07T19:23:09Z", "message": "Merge branch 'master' into feature/stringContains"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "65765cc1316489776c75d6d8316b864e395aea9c", "author": {"user": {"login": "aleksmaus", "name": "Aleksandr Maus"}}, "url": "https://github.com/elastic/elasticsearch/commit/65765cc1316489776c75d6d8316b864e395aea9c", "committedDate": "2020-04-07T19:29:03Z", "message": "Adjust queryfolder_tests.txt to the new format"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1473, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}