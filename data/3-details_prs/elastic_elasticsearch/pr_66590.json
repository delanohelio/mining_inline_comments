{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTQyNTI2MDk3", "number": 66590, "title": "Ensure we verify versioned dir for es bwc builds", "bodyText": "A follow up on https://github.com/elastic/elasticsearch/pull/66342/files#r545455977", "createdAt": "2020-12-18T12:52:59Z", "url": "https://github.com/elastic/elasticsearch/pull/66590", "merged": true, "mergeCommit": {"oid": "d0c7c65dd9a37d98745504d3378af48a9e28b67a"}, "closed": true, "closedAt": "2020-12-21T08:05:40Z", "author": {"login": "breskeby"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdnbnkIAH2gAyNTQyNTI2MDk3OmRlZTNlMGFjM2U2YjM3NmIyNWY4YzIzOWM4M2RkYWE5NmEyNTgxZTY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdnfmP7gH2gAyNTQyNTI2MDk3Ojg2M2NhZGFkNzg2OGQyYWFkMGEyM2Y3NzNlYTZkZjUzNDMzYzQxMTc=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "dee3e0ac3e6b376b25f8c239c83ddaa96a2581e6", "author": {"user": {"login": "breskeby", "name": "Rene Groeschke"}}, "url": "https://github.com/elastic/elasticsearch/commit/dee3e0ac3e6b376b25f8c239c83ddaa96a2581e6", "committedDate": "2020-12-18T17:30:56Z", "message": "Ensure we verify versioned dir for es bwc builds"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ca73eec891c539badccb748281417936a00a4cda", "author": {"user": {"login": "breskeby", "name": "Rene Groeschke"}}, "url": "https://github.com/elastic/elasticsearch/commit/ca73eec891c539badccb748281417936a00a4cda", "committedDate": "2020-12-18T12:50:59Z", "message": "Ensure we verify versioned dir for es bwc builds"}, "afterCommit": {"oid": "dee3e0ac3e6b376b25f8c239c83ddaa96a2581e6", "author": {"user": {"login": "breskeby", "name": "Rene Groeschke"}}, "url": "https://github.com/elastic/elasticsearch/commit/dee3e0ac3e6b376b25f8c239c83ddaa96a2581e6", "committedDate": "2020-12-18T17:30:56Z", "message": "Ensure we verify versioned dir for es bwc builds"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "18c2297b87f06da4b23a70fd178aaa1f635a29e3", "author": {"user": {"login": "breskeby", "name": "Rene Groeschke"}}, "url": "https://github.com/elastic/elasticsearch/commit/18c2297b87f06da4b23a70fd178aaa1f635a29e3", "committedDate": "2020-12-18T19:20:37Z", "message": "Fix checking versioned folder"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU1NzY2NzUz", "url": "https://github.com/elastic/elasticsearch/pull/66590#pullrequestreview-555766753", "createdAt": "2020-12-18T19:39:41Z", "commit": {"oid": "dee3e0ac3e6b376b25f8c239c83ddaa96a2581e6"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xOFQxOTozOTo0MlrOIIwcug==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xOFQxOTo0MDoyMVrOIIwd_A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjA1MzMwNg==", "bodyText": "We need to include the distribution type in the path as well (i.e. -oss for the OSS distro). That's what's causing these errors:\nCaused by: java.nio.file.NoSuchFileException: /dev/shm/elastic+elasticsearch+pull-request-bwc/distribution/bwc/minor/build/bwc/checkout-7.x/distribution/archives/oss-linux-tar/build/install/elasticsearch-7.12.0-SNAPSHOT/plugins/config", "url": "https://github.com/elastic/elasticsearch/pull/66590#discussion_r546053306", "createdAt": "2020-12-18T19:39:42Z", "author": {"login": "mark-vieira"}, "path": "buildSrc/src/main/java/org/elasticsearch/gradle/internal/InternalDistributionBwcSetupPlugin.java", "diffHunk": "@@ -279,7 +279,9 @@ static void createBuildBwcTask(\n                         + \".\"\n                         + extension\n                 ),\n-                expandedDistDirSupport ? new File(checkoutDir, baseDir + \"/\" + name + \"/build/install/\") : null\n+                expandedDistDirSupport\n+                    ? new File(checkoutDir, baseDir + \"/\" + name + \"/build/install/elasticsearch-\" + version + \"-SNAPSHOT\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dee3e0ac3e6b376b25f8c239c83ddaa96a2581e6"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjA1MzYyOA==", "bodyText": "And posibly architecture too? Essentially, we need to use the same logic for building that dir name as we do for the file name as I \"think\" we add all those qualifiers there as well.", "url": "https://github.com/elastic/elasticsearch/pull/66590#discussion_r546053628", "createdAt": "2020-12-18T19:40:21Z", "author": {"login": "mark-vieira"}, "path": "buildSrc/src/main/java/org/elasticsearch/gradle/internal/InternalDistributionBwcSetupPlugin.java", "diffHunk": "@@ -279,7 +279,9 @@ static void createBuildBwcTask(\n                         + \".\"\n                         + extension\n                 ),\n-                expandedDistDirSupport ? new File(checkoutDir, baseDir + \"/\" + name + \"/build/install/\") : null\n+                expandedDistDirSupport\n+                    ? new File(checkoutDir, baseDir + \"/\" + name + \"/build/install/elasticsearch-\" + version + \"-SNAPSHOT\")", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjA1MzMwNg=="}, "originalCommit": {"oid": "dee3e0ac3e6b376b25f8c239c83ddaa96a2581e6"}, "originalPosition": 6}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "48168357b5d6e77c16456cdefba4b160fba3ffb0", "author": {"user": {"login": "breskeby", "name": "Rene Groeschke"}}, "url": "https://github.com/elastic/elasticsearch/commit/48168357b5d6e77c16456cdefba4b160fba3ffb0", "committedDate": "2020-12-18T19:59:23Z", "message": "Make spotless happy"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "863cadad7868d2aad0a23f773ea6df53433c4117", "author": {"user": {"login": "breskeby", "name": "Rene Groeschke"}}, "url": "https://github.com/elastic/elasticsearch/commit/863cadad7868d2aad0a23f773ea6df53433c4117", "committedDate": "2020-12-18T22:09:07Z", "message": "Update integ test"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4364, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}