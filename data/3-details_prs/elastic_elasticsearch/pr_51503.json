{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY3NzI5NDM3", "number": 51503, "title": "Put values source types on fields", "bodyText": "This PR makes the mapping from MappedFieldType to ValuesSourceType a function of and on the MappedFieldType.  This eliminates redundant mappings from the aggregator registration steps, and makes it explicit how fields with aggregation support will behave in aggregations.", "createdAt": "2020-01-27T22:10:47Z", "url": "https://github.com/elastic/elasticsearch/pull/51503", "merged": true, "mergeCommit": {"oid": "64ba8a96de2be87fd7e7af4fe9f0d326bd06b56d"}, "closed": true, "closedAt": "2020-01-28T17:26:47Z", "author": {"login": "not-napoleon"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb9gSAEAH2gAyMzY3NzI5NDM3OjhjNzNlZGI2NzAxYTUzNTJhNjNkODhhNTliZGY3NjVkNDI3OWZjOWY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABb-zgYvAFqTM0OTQ2MTI0MQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "8c73edb6701a5352a63d88a59bdf765d4279fc9f", "author": {"user": {"login": "not-napoleon", "name": "Mark Tozzi"}}, "url": "https://github.com/elastic/elasticsearch/commit/8c73edb6701a5352a63d88a59bdf765d4279fc9f", "committedDate": "2020-01-24T15:00:56Z", "message": "Initial tinkering around"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f425932552301ed71e33933d2f01dc771179ef1c", "author": {"user": {"login": "not-napoleon", "name": "Mark Tozzi"}}, "url": "https://github.com/elastic/elasticsearch/commit/f425932552301ed71e33933d2f01dc771179ef1c", "committedDate": "2020-01-27T19:21:23Z", "message": "added the rest of the field -> vst mappings"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "72ea0b8f28704dd1a354daf5ddb9f0d1e1cc531b", "author": {"user": {"login": "not-napoleon", "name": "Mark Tozzi"}}, "url": "https://github.com/elastic/elasticsearch/commit/72ea0b8f28704dd1a354daf5ddb9f0d1e1cc531b", "committedDate": "2020-01-27T22:06:31Z", "message": "Clean up registration"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c7cc9babccd4dc59323b5e0c8bdd897046c18f3e", "author": {"user": {"login": "not-napoleon", "name": "Mark Tozzi"}}, "url": "https://github.com/elastic/elasticsearch/commit/c7cc9babccd4dc59323b5e0c8bdd897046c18f3e", "committedDate": "2020-01-28T14:35:49Z", "message": "fix checkstyle"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ5NDQ5MzQ4", "url": "https://github.com/elastic/elasticsearch/pull/51503#pullrequestreview-349449348", "createdAt": "2020-01-28T15:08:27Z", "commit": {"oid": "c7cc9babccd4dc59323b5e0c8bdd897046c18f3e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQxNTowODoyOFrOFioiYg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQxNTowODoyOFrOFioiYg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTg2MDA2Ng==", "bodyText": "Oops, I forgot to include Booleans.  I'll push an update shortly.", "url": "https://github.com/elastic/elasticsearch/pull/51503#discussion_r371860066", "createdAt": "2020-01-28T15:08:28Z", "author": {"login": "not-napoleon"}, "path": "server/src/main/java/org/elasticsearch/search/aggregations/bucket/histogram/HistogramAggregatorFactory.java", "diffHunk": "@@ -72,11 +70,11 @@ public Aggregator build(String name, AggregatorFactories factories, double inter\n                     return new RangeHistogramAggregator(name, factories, interval, offset, order, keyed, minDocCount, minBound,\n                         maxBound, rangeValueSource, formatter, context, parent, pipelineAggregators, metaData);\n                 }\n-            },\n-            (fieldType, indexFieldData) -> fieldType instanceof RangeFieldMapper.RangeFieldType\n+            }\n         );\n \n-        valuesSourceRegistry.register(HistogramAggregationBuilder.NAME, CoreValuesSourceType.NUMERIC,\n+        valuesSourceRegistry.register(HistogramAggregationBuilder.NAME,\n+            List.of(CoreValuesSourceType.NUMERIC, CoreValuesSourceType.DATE),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c7cc9babccd4dc59323b5e0c8bdd897046c18f3e"}, "originalPosition": 20}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4e976b6ba0f074f888121326500dd6c17d4acbe8", "author": {"user": {"login": "not-napoleon", "name": "Mark Tozzi"}}, "url": "https://github.com/elastic/elasticsearch/commit/4e976b6ba0f074f888121326500dd6c17d4acbe8", "committedDate": "2020-01-28T15:20:05Z", "message": "allow histograms of boolean fields"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ5NDYxMjQx", "url": "https://github.com/elastic/elasticsearch/pull/51503#pullrequestreview-349461241", "createdAt": "2020-01-28T15:22:28Z", "commit": {"oid": "4e976b6ba0f074f888121326500dd6c17d4acbe8"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQxNToyMjoyOFrOFipEyg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQxNTo1Mzo0MFrOFiqXKw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTg2ODg3NA==", "bodyText": "Possible yes, encouraged not necessarily.  See warning on: https://www.elastic.co/guide/en/elasticsearch/reference/current/mapping-id-field.html\n\nThe value of the _id field is also accessible in aggregations or for sorting, but doing so is discouraged as it requires to load a lot of data in memory. In case sorting or aggregating on the _id field is required, it is advised to duplicate the content of the _id field in another field that has doc_values enabled.", "url": "https://github.com/elastic/elasticsearch/pull/51503#discussion_r371868874", "createdAt": "2020-01-28T15:22:28Z", "author": {"login": "polyfractal"}, "path": "server/src/main/java/org/elasticsearch/index/mapper/IdFieldMapper.java", "diffHunk": "@@ -153,6 +155,12 @@ public Query termsQuery(List<?> values, QueryShardContext context) {\n             return new TermInSetQuery(name(), bytesRefs);\n         }\n \n+        @Override\n+        public ValuesSourceType getValuesSourceType() {\n+            // TODO: should this even exist? Is aggregating on the ID field valid?", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4e976b6ba0f074f888121326500dd6c17d4acbe8"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTg4OTk2Mw==", "bodyText": "It's an _index sorta-metadata field that we add to the doc, mainly for use with querying to differentiate between different indices.  But I've seen it used in aggs before, like Terms, to partition based on index\nhttps://www.elastic.co/guide/en/elasticsearch/reference/current/mapping-index-field.html", "url": "https://github.com/elastic/elasticsearch/pull/51503#discussion_r371889963", "createdAt": "2020-01-28T15:53:40Z", "author": {"login": "polyfractal"}, "path": "server/src/main/java/org/elasticsearch/index/mapper/IndexFieldMapper.java", "diffHunk": "@@ -189,6 +191,12 @@ public Query wildcardQuery(String value,\n         public IndexFieldData.Builder fielddataBuilder(String fullyQualifiedIndexName) {\n             return new ConstantIndexFieldData.Builder(mapperService -> fullyQualifiedIndexName);\n         }\n+\n+        @Override\n+        public ValuesSourceType getValuesSourceType() {\n+            // TODO: Should Index fields be aggregatable?  What even is an IndexField?", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4e976b6ba0f074f888121326500dd6c17d4acbe8"}, "originalPosition": 16}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2757, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}