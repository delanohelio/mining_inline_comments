{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM1NDU5ODky", "number": 58200, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOFQwNTowNjo1N1rOEGmY_A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOFQwNTowNjo1N1rOEGmY_A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc1MzU1OTAwOnYy", "diffSide": "LEFT", "path": "qa/os/src/test/java/org/elasticsearch/packaging/util/Archives.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOFQwNTowNjo1N1rOGlfwKA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNFQyMTozMjo0OFrOGoj4VA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTk3MDcyOA==", "bodyText": "I'm not sure we should be removing daemonize here, since the method still takes in the flag. Wouldn't this cause any tests using tty but not expecting failure to fail?", "url": "https://github.com/elastic/elasticsearch/pull/58200#discussion_r441970728", "createdAt": "2020-06-18T05:06:57Z", "author": {"login": "rjernst"}, "path": "qa/os/src/test/java/org/elasticsearch/packaging/util/Archives.java", "diffHunk": "@@ -244,9 +244,10 @@ private static void verifyDefaultInstallation(Installation es, Distribution dist\n         // requires the \"expect\" utility to be installed\n         List<String> command = new ArrayList<>();\n         command.add(\"sudo -E -u %s %s -p %s\");\n-        if (daemonize) {\n-            command.add(\"-d\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6f30abf1e08f56165b6c3067227c8e5d35e514ab"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjI0NzM0MA==", "bodyText": "What's going on here is that I want spawn -ignore HUP  to let the process keep running in the background after the expect program ends. This is how it works on centos 7, and that's why the tests are passing after this change: it's as if a keyboard user is running without daemonization.\nOn centos 6, it seems that when expect terminates, it's terminating Elasticsearch too when the -d flag is added.\nBut I agree that the code shouldn't be merged in this state. I think I can improve it in a couple of ways, including not taking and disregarding a boolean flag in this method.", "url": "https://github.com/elastic/elasticsearch/pull/58200#discussion_r442247340", "createdAt": "2020-06-18T13:58:32Z", "author": {"login": "williamrandolph"}, "path": "qa/os/src/test/java/org/elasticsearch/packaging/util/Archives.java", "diffHunk": "@@ -244,9 +244,10 @@ private static void verifyDefaultInstallation(Installation es, Distribution dist\n         // requires the \"expect\" utility to be installed\n         List<String> command = new ArrayList<>();\n         command.add(\"sudo -E -u %s %s -p %s\");\n-        if (daemonize) {\n-            command.add(\"-d\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTk3MDcyOA=="}, "originalCommit": {"oid": "6f30abf1e08f56165b6c3067227c8e5d35e514ab"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTE4NDA4NA==", "bodyText": "I've restored the \"daemonize\" block, but put a TODO/ignore on the test that would cause the problem. Hopefully the specific issue will be clear to anyone who works on the code. I'm hoping to find a different workaround after more investigation.", "url": "https://github.com/elastic/elasticsearch/pull/58200#discussion_r445184084", "createdAt": "2020-06-24T21:32:48Z", "author": {"login": "williamrandolph"}, "path": "qa/os/src/test/java/org/elasticsearch/packaging/util/Archives.java", "diffHunk": "@@ -244,9 +244,10 @@ private static void verifyDefaultInstallation(Installation es, Distribution dist\n         // requires the \"expect\" utility to be installed\n         List<String> command = new ArrayList<>();\n         command.add(\"sudo -E -u %s %s -p %s\");\n-        if (daemonize) {\n-            command.add(\"-d\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTk3MDcyOA=="}, "originalCommit": {"oid": "6f30abf1e08f56165b6c3067227c8e5d35e514ab"}, "originalPosition": 5}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1525, "cost": 1, "resetAt": "2021-11-12T11:57:46Z"}}}