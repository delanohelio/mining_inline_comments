{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDAwODM2OTM3", "number": 54953, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQxNzo1MTo1MVrODwGc-Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQxOTo1MjowNFrODwJCpw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUxNzYzOTYxOnYy", "diffSide": "RIGHT", "path": "rest-api-spec/src/main/resources/rest-api-spec/test/search/30_limits.yml", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQxNzo1MTo1MVrOGC6Wkg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOVQxMTozNDoxM1rOGDU50A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTcwNjM4Ng==", "bodyText": "Can we try to address this ? For instance we could set the default value directly rather than delaying this to the creation of the search context ?", "url": "https://github.com/elastic/elasticsearch/pull/54953#discussion_r405706386", "createdAt": "2020-04-08T17:51:51Z", "author": {"login": "jimczi"}, "path": "rest-api-spec/src/main/resources/rest-api-spec/test/search/30_limits.yml", "diffHunk": "@@ -26,14 +26,49 @@ setup:\n         from: 10000\n \n ---\n-\"Request with negative from value\":\n+\"Request with negative from value url parameter\":\n+\n+  - skip:\n+      version: \" - 7.9.99\"\n+      reason: waiting for backport\n+\n   - do:\n-      catch:      /\\[from\\] parameter cannot be negative/\n+      search:\n+        rest_total_hits_as_int: true\n+        index: test_1\n+        # value of -1 should be accepted as unset value\n+        from: -1\n+\n+  - do:\n+      catch:      /\\[from\\] parameter cannot be negative but was \\[-2\\]/\n       search:\n         rest_total_hits_as_int: true\n         index: test_1\n         from: -2\n \n+---\n+\"Request with negative from value in body\":\n+\n+  - skip:\n+      version: \" - 7.9.99\"\n+      reason: waiting for backport\n+\n+  - do:\n+      search:\n+        rest_total_hits_as_int: true\n+        index: test_1\n+        # value of -1 should be accepted as unset value", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9e631cb2713da3448f65bf33f2a52c23774727b3"}, "originalPosition": 37}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjExNzc3MA==", "bodyText": "I'd be open to forbid users setting from to  \"-1\" entirely on 8.0 but since we currently accept it in the request body (and treat it as 0 later) I think we should allow it at least on 7.x to not break existing queries there. Every other negative value should alread throw a different exception, so thats fine I think. We can log a warning on 7.x when using \"-1\" to prepare for the change in 8.0 if thats okay?", "url": "https://github.com/elastic/elasticsearch/pull/54953#discussion_r406117770", "createdAt": "2020-04-09T10:44:22Z", "author": {"login": "cbuescher"}, "path": "rest-api-spec/src/main/resources/rest-api-spec/test/search/30_limits.yml", "diffHunk": "@@ -26,14 +26,49 @@ setup:\n         from: 10000\n \n ---\n-\"Request with negative from value\":\n+\"Request with negative from value url parameter\":\n+\n+  - skip:\n+      version: \" - 7.9.99\"\n+      reason: waiting for backport\n+\n   - do:\n-      catch:      /\\[from\\] parameter cannot be negative/\n+      search:\n+        rest_total_hits_as_int: true\n+        index: test_1\n+        # value of -1 should be accepted as unset value\n+        from: -1\n+\n+  - do:\n+      catch:      /\\[from\\] parameter cannot be negative but was \\[-2\\]/\n       search:\n         rest_total_hits_as_int: true\n         index: test_1\n         from: -2\n \n+---\n+\"Request with negative from value in body\":\n+\n+  - skip:\n+      version: \" - 7.9.99\"\n+      reason: waiting for backport\n+\n+  - do:\n+      search:\n+        rest_total_hits_as_int: true\n+        index: test_1\n+        # value of -1 should be accepted as unset value", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTcwNjM4Ng=="}, "originalCommit": {"oid": "9e631cb2713da3448f65bf33f2a52c23774727b3"}, "originalPosition": 37}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjE0MTM5Mg==", "bodyText": "The rest spec states that the default value for from is 0 and size is 10 so I don't think users rely on us accepting -1 as a valid value. As you said we never output the value if it's unset so we imo we should forbid in 7.x.", "url": "https://github.com/elastic/elasticsearch/pull/54953#discussion_r406141392", "createdAt": "2020-04-09T11:34:13Z", "author": {"login": "jimczi"}, "path": "rest-api-spec/src/main/resources/rest-api-spec/test/search/30_limits.yml", "diffHunk": "@@ -26,14 +26,49 @@ setup:\n         from: 10000\n \n ---\n-\"Request with negative from value\":\n+\"Request with negative from value url parameter\":\n+\n+  - skip:\n+      version: \" - 7.9.99\"\n+      reason: waiting for backport\n+\n   - do:\n-      catch:      /\\[from\\] parameter cannot be negative/\n+      search:\n+        rest_total_hits_as_int: true\n+        index: test_1\n+        # value of -1 should be accepted as unset value\n+        from: -1\n+\n+  - do:\n+      catch:      /\\[from\\] parameter cannot be negative but was \\[-2\\]/\n       search:\n         rest_total_hits_as_int: true\n         index: test_1\n         from: -2\n \n+---\n+\"Request with negative from value in body\":\n+\n+  - skip:\n+      version: \" - 7.9.99\"\n+      reason: waiting for backport\n+\n+  - do:\n+      search:\n+        rest_total_hits_as_int: true\n+        index: test_1\n+        # value of -1 should be accepted as unset value", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTcwNjM4Ng=="}, "originalCommit": {"oid": "9e631cb2713da3448f65bf33f2a52c23774727b3"}, "originalPosition": 37}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUxNzY0MDY4OnYy", "diffSide": "RIGHT", "path": "server/src/main/java/org/elasticsearch/search/builder/SearchSourceBuilder.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQxNzo1MjoxNlrOGC6XVQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOVQxMTozNjo1NFrOGDU-0Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTcwNjU4MQ==", "bodyText": "Can we set the default early so that we can refuse any negative values ?", "url": "https://github.com/elastic/elasticsearch/pull/54953#discussion_r405706581", "createdAt": "2020-04-08T17:52:16Z", "author": {"login": "jimczi"}, "path": "server/src/main/java/org/elasticsearch/search/builder/SearchSourceBuilder.java", "diffHunk": "@@ -336,10 +336,13 @@ public QueryBuilder postFilter() {\n \n     /**\n      * From index to start the search from. Defaults to {@code 0}.\n+     * A value of -1 is interpreted as an unset value equivalent to 0.\n+     * Any other negative value is forbidden.\n      */\n     public SearchSourceBuilder from(int from) {\n-        if (from < 0) {\n-            throw new IllegalArgumentException(\"[from] parameter cannot be negative\");\n+        // accept -1 as the default unset value without error", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9e631cb2713da3448f65bf33f2a52c23774727b3"}, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjExNzYxNw==", "bodyText": "I think for SearchSourceBuilder I would prefer to keep the notion of an \"unset\" value and interpret that in any way necessary later. I think this class should represent the user request body, e.g. in innerToXContent we only output values that are explicitely set by the user. Maybe @javanna has some preferences there as well?", "url": "https://github.com/elastic/elasticsearch/pull/54953#discussion_r406117617", "createdAt": "2020-04-09T10:44:04Z", "author": {"login": "cbuescher"}, "path": "server/src/main/java/org/elasticsearch/search/builder/SearchSourceBuilder.java", "diffHunk": "@@ -336,10 +336,13 @@ public QueryBuilder postFilter() {\n \n     /**\n      * From index to start the search from. Defaults to {@code 0}.\n+     * A value of -1 is interpreted as an unset value equivalent to 0.\n+     * Any other negative value is forbidden.\n      */\n     public SearchSourceBuilder from(int from) {\n-        if (from < 0) {\n-            throw new IllegalArgumentException(\"[from] parameter cannot be negative\");\n+        // accept -1 as the default unset value without error", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTcwNjU4MQ=="}, "originalCommit": {"oid": "9e631cb2713da3448f65bf33f2a52c23774727b3"}, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjE0MjY3Mw==", "bodyText": "I'd agree if \"unset\" had different semantics depending on the context but we always set it to the default value.\nWe could forbid setting negative value but keep the initial value to -1 ?", "url": "https://github.com/elastic/elasticsearch/pull/54953#discussion_r406142673", "createdAt": "2020-04-09T11:36:54Z", "author": {"login": "jimczi"}, "path": "server/src/main/java/org/elasticsearch/search/builder/SearchSourceBuilder.java", "diffHunk": "@@ -336,10 +336,13 @@ public QueryBuilder postFilter() {\n \n     /**\n      * From index to start the search from. Defaults to {@code 0}.\n+     * A value of -1 is interpreted as an unset value equivalent to 0.\n+     * Any other negative value is forbidden.\n      */\n     public SearchSourceBuilder from(int from) {\n-        if (from < 0) {\n-            throw new IllegalArgumentException(\"[from] parameter cannot be negative\");\n+        // accept -1 as the default unset value without error", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTcwNjU4MQ=="}, "originalCommit": {"oid": "9e631cb2713da3448f65bf33f2a52c23774727b3"}, "originalPosition": 10}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUxODA2Mzc1OnYy", "diffSide": "RIGHT", "path": "docs/reference/search/request/from-size.asciidoc", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQxOTo1MjowNFrOGC-f-g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQxOTo1MjowNFrOGC-f-g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTc3NDMzMA==", "bodyText": "Small comment, I think 'Neither value can be negative.' would be clearer.", "url": "https://github.com/elastic/elasticsearch/pull/54953#discussion_r405774330", "createdAt": "2020-04-08T19:52:04Z", "author": {"login": "jtibshirani"}, "path": "docs/reference/search/request/from-size.asciidoc", "diffHunk": "@@ -6,9 +6,9 @@ parameters. The `from` parameter defines the offset from the first\n result you want to fetch. The `size` parameter allows you to configure\n the maximum amount of hits to be returned.\n \n-Though `from` and `size` can be set as request parameters, they can also\n-be set within the search body. `from` defaults to `0`, and `size`\n-defaults to `10`.\n+Though `from` and `size` can be set as request parameters, they can also be set\n+within the search body. `from` defaults to `0`, and `size` defaults to `10`.\n+Both values cannot be negative.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9e631cb2713da3448f65bf33f2a52c23774727b3"}, "originalPosition": 9}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1179, "cost": 1, "resetAt": "2021-11-12T11:57:46Z"}}}