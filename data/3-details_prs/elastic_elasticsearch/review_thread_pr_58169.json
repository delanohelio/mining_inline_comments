{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM1MjMwOTQ2", "number": 58169, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQxNDozMDoxMVrOEF9xNQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQxNDozMDo0MFrOEF9yBw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc0NjkwMzU3OnYy", "diffSide": "RIGHT", "path": "x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/action/TransportDeleteJobAction.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQxNDozMDoxMVrOGkeK5g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xN1QwNToxNTowOFrOGk15lg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDg5NjIzMA==", "bodyText": "I know you've just copied it from above, but this comment is no longer correct - we are only deleting the most recent ID format.  So please delete this comment.", "url": "https://github.com/elastic/elasticsearch/pull/58169#discussion_r440896230", "createdAt": "2020-06-16T14:30:11Z", "author": {"login": "droberts195"}, "path": "x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/action/TransportDeleteJobAction.java", "diffHunk": "@@ -444,25 +451,18 @@ private void deleteJobDocuments(ParentTaskAssigningClient parentTaskClient, Stri\n     }\n \n     private void deleteQuantiles(ParentTaskAssigningClient parentTaskClient, String jobId, ActionListener<Boolean> finishedHandler) {\n-        // The quantiles type and doc ID changed in v5.5 so delete both the old and new format\n-        DeleteByQueryRequest request = new DeleteByQueryRequest(AnomalyDetectorsIndex.jobStateIndexPattern());\n         // Just use ID here, not type, as trying to delete different types spams the logs with an exception stack trace\n         IdsQueryBuilder query = new IdsQueryBuilder().addIds(Quantiles.documentId(jobId));\n-        request.setQuery(query);\n-        request.setIndicesOptions(MlIndicesUtils.addIgnoreUnavailable(IndicesOptions.lenientExpandOpen()));\n-        request.setAbortOnVersionConflict(false);\n-        request.setRefresh(true);\n+        // The quantiles type and doc ID changed in v5.5 so delete both the old and new format", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4375cb412eadca08ae886725cdd78a3ad5a6a2ba"}, "originalPosition": 85}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTI4NTAxNA==", "bodyText": "Done.", "url": "https://github.com/elastic/elasticsearch/pull/58169#discussion_r441285014", "createdAt": "2020-06-17T05:15:08Z", "author": {"login": "przemekwitek"}, "path": "x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/action/TransportDeleteJobAction.java", "diffHunk": "@@ -444,25 +451,18 @@ private void deleteJobDocuments(ParentTaskAssigningClient parentTaskClient, Stri\n     }\n \n     private void deleteQuantiles(ParentTaskAssigningClient parentTaskClient, String jobId, ActionListener<Boolean> finishedHandler) {\n-        // The quantiles type and doc ID changed in v5.5 so delete both the old and new format\n-        DeleteByQueryRequest request = new DeleteByQueryRequest(AnomalyDetectorsIndex.jobStateIndexPattern());\n         // Just use ID here, not type, as trying to delete different types spams the logs with an exception stack trace\n         IdsQueryBuilder query = new IdsQueryBuilder().addIds(Quantiles.documentId(jobId));\n-        request.setQuery(query);\n-        request.setIndicesOptions(MlIndicesUtils.addIgnoreUnavailable(IndicesOptions.lenientExpandOpen()));\n-        request.setAbortOnVersionConflict(false);\n-        request.setRefresh(true);\n+        // The quantiles type and doc ID changed in v5.5 so delete both the old and new format", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDg5NjIzMA=="}, "originalCommit": {"oid": "4375cb412eadca08ae886725cdd78a3ad5a6a2ba"}, "originalPosition": 85}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc0NjkwNTY3OnYy", "diffSide": "RIGHT", "path": "x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/action/TransportDeleteJobAction.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQxNDozMDo0MFrOGkeMYQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xN1QwNToxNToxM1rOGk15sQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDg5NjYwOQ==", "bodyText": "As above, it's no longer true that we're deleting the 5.4 ID format, so please delete this comment.", "url": "https://github.com/elastic/elasticsearch/pull/58169#discussion_r440896609", "createdAt": "2020-06-16T14:30:40Z", "author": {"login": "droberts195"}, "path": "x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/action/TransportDeleteJobAction.java", "diffHunk": "@@ -479,14 +479,14 @@ private void deleteModelState(ParentTaskAssigningClient parentTaskClient, String\n \n     private void deleteCategorizerState(ParentTaskAssigningClient parentTaskClient, String jobId, int docNum,\n                                         ActionListener<Boolean> finishedHandler) {\n-        // The categorizer state type and doc ID changed in v5.5 so delete both the old and new format\n-        DeleteByQueryRequest request = new DeleteByQueryRequest(AnomalyDetectorsIndex.jobStateIndexPattern());\n         // Just use ID here, not type, as trying to delete different types spams the logs with an exception stack trace\n         IdsQueryBuilder query = new IdsQueryBuilder().addIds(CategorizerState.documentId(jobId, docNum));\n-        request.setQuery(query);\n-        request.setIndicesOptions(MlIndicesUtils.addIgnoreUnavailable(IndicesOptions.lenientExpandOpen()));\n-        request.setAbortOnVersionConflict(false);\n-        request.setRefresh(true);\n+        // The categorizer state type and doc ID changed in v5.5 so delete both the old and new format", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4375cb412eadca08ae886725cdd78a3ad5a6a2ba"}, "originalPosition": 118}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTI4NTA0MQ==", "bodyText": "Done.", "url": "https://github.com/elastic/elasticsearch/pull/58169#discussion_r441285041", "createdAt": "2020-06-17T05:15:13Z", "author": {"login": "przemekwitek"}, "path": "x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/action/TransportDeleteJobAction.java", "diffHunk": "@@ -479,14 +479,14 @@ private void deleteModelState(ParentTaskAssigningClient parentTaskClient, String\n \n     private void deleteCategorizerState(ParentTaskAssigningClient parentTaskClient, String jobId, int docNum,\n                                         ActionListener<Boolean> finishedHandler) {\n-        // The categorizer state type and doc ID changed in v5.5 so delete both the old and new format\n-        DeleteByQueryRequest request = new DeleteByQueryRequest(AnomalyDetectorsIndex.jobStateIndexPattern());\n         // Just use ID here, not type, as trying to delete different types spams the logs with an exception stack trace\n         IdsQueryBuilder query = new IdsQueryBuilder().addIds(CategorizerState.documentId(jobId, docNum));\n-        request.setQuery(query);\n-        request.setIndicesOptions(MlIndicesUtils.addIgnoreUnavailable(IndicesOptions.lenientExpandOpen()));\n-        request.setAbortOnVersionConflict(false);\n-        request.setRefresh(true);\n+        // The categorizer state type and doc ID changed in v5.5 so delete both the old and new format", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDg5NjYwOQ=="}, "originalCommit": {"oid": "4375cb412eadca08ae886725cdd78a3ad5a6a2ba"}, "originalPosition": 118}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1502, "cost": 1, "resetAt": "2021-11-12T11:57:46Z"}}}