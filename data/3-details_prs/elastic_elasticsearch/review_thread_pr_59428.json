{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ4MzE1MjQy", "number": 59428, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xM1QxNToxNDozNFrOEN3S_Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xM1QxNToxNDozNFrOEN3S_Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgyOTcyOTI1OnYy", "diffSide": "RIGHT", "path": "server/src/main/java/org/elasticsearch/snapshots/SnapshotsService.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xM1QxNToxNDozNFrOGwtIdw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xM1QxNToxNDozNFrOGwtIdw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzcyNDI3OQ==", "bodyText": "Also fixes yet another spot where we'd produce a snapshot with all shards in a final state but not a final state for the overall snapshot. I'll try to track down any remaining cases (I think this should've been the last one) if there are any and add an assertion to prevent this kind of bug going forward.", "url": "https://github.com/elastic/elasticsearch/pull/59428#discussion_r453724279", "createdAt": "2020-07-13T15:14:34Z", "author": {"login": "original-brownbear"}, "path": "server/src/main/java/org/elasticsearch/snapshots/SnapshotsService.java", "diffHunk": "@@ -294,8 +294,8 @@ public ClusterState execute(ClusterState currentState) {\n                 }\n                 newEntry = new SnapshotsInProgress.Entry(\n                         new Snapshot(repositoryName, snapshotId), request.includeGlobalState(), request.partial(),\n-                        State.STARTED, indexIds, dataStreams, threadPool.absoluteTimeInMillis(), repositoryData.getGenId(), shards,\n-                        null, userMeta, version);\n+                        completed(shards.values()) ? State.SUCCESS : State.STARTED, indexIds, dataStreams,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "48acf9694d7d238030e92f3f12f4975c0e550adf"}, "originalPosition": 6}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2337, "cost": 1, "resetAt": "2021-11-12T11:57:46Z"}}}