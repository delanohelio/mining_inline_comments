{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDg1MTczNjIw", "number": 62274, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNFQwOTozNjowMlrOEjCvaA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNFQwOTozNjowMlrOEjCvaA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA1MTgwNTIwOnYy", "diffSide": "RIGHT", "path": "server/src/test/java/org/elasticsearch/cluster/metadata/MetadataDeleteIndexServiceTests.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNFQwOTozNjowMlrOHRLtKw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNFQwOTozNjowMlrOHRLtKw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Nzc3OTYyNw==", "bodyText": "I think numBackingIndices needs to be changed into numBackingIndices - 1, otherwise the test tries to delete the write index which would fail.", "url": "https://github.com/elastic/elasticsearch/pull/62274#discussion_r487779627", "createdAt": "2020-09-14T09:36:02Z", "author": {"login": "martijnvg"}, "path": "server/src/test/java/org/elasticsearch/cluster/metadata/MetadataDeleteIndexServiceTests.java", "diffHunk": "@@ -129,6 +132,29 @@ public void testDeleteBackingIndexForDataStream() {\n             DataStream.getDefaultBackingIndexName(dataStreamName, numIndexToDelete)), IsNull.nullValue());\n     }\n \n+    public void testDeleteMultipleBackingIndexForDataStream() {\n+        int numBackingIndices = randomIntBetween(3, 5);\n+        int numBackingIndicesToDelete = randomIntBetween(2, numBackingIndices - 1);\n+        String dataStreamName = randomAlphaOfLength(6).toLowerCase(Locale.ROOT);\n+        ClusterState before = DataStreamTestHelper.getClusterStateWithDataStreams(\n+            List.of(new Tuple<>(dataStreamName, numBackingIndices)), List.of());\n+\n+        List<Integer> indexNumbersToDelete =\n+            randomSubsetOf(numBackingIndicesToDelete, IntStream.rangeClosed(1, numBackingIndices).boxed().collect(Collectors.toList()));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "80de32071ea54a5448f48bb6e7a61d16a3e2a950"}, "originalPosition": 25}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1515, "cost": 1, "resetAt": "2021-11-12T13:16:51Z"}}}