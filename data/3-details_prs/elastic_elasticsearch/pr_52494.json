{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc2ODUyNjEz", "number": 52494, "title": "Make DeleteStep retryable", "bodyText": "This change marks DeleteStep as retryable and adds test to make sure we really can invoke it again.", "createdAt": "2020-02-18T21:47:50Z", "url": "https://github.com/elastic/elasticsearch/pull/52494", "merged": true, "mergeCommit": {"oid": "bf8586e4293f6d99d34d85d7424c1624bfeabc98"}, "closed": true, "closedAt": "2020-02-19T18:55:35Z", "author": {"login": "probakowski"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcFpCUwgH2gAyMzc2ODUyNjEzOmQ4MTliMGUyNmFmNGQ0ZTBiYTRhMDY1ZDQ0N2RjNzg0M2Q3YmI3NGU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcF5Zz0gFqTM2MTI1NzMwMQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "d819b0e26af4d4e0ba4a065d447dc7843d7bb74e", "author": {"user": {"login": "probakowski", "name": "Przemko Robakowski"}}, "url": "https://github.com/elastic/elasticsearch/commit/d819b0e26af4d4e0ba4a065d447dc7843d7bb74e", "committedDate": "2020-02-18T21:44:21Z", "message": "Make DeleteStep retryable\n\nThis change marks `DeleteStep` as retryable and adds test to make sure we really can invoke it again."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "34dfafdae1f7ef572d7738abd00b426d342e5079", "author": {"user": {"login": "probakowski", "name": "Przemko Robakowski"}}, "url": "https://github.com/elastic/elasticsearch/commit/34dfafdae1f7ef572d7738abd00b426d342e5079", "committedDate": "2020-02-18T21:53:38Z", "message": "Fix unused import"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c3b765f8aebe1427aa6d12c8ad0ad9cec4fb5de8", "author": {"user": {"login": "probakowski", "name": "Przemko Robakowski"}}, "url": "https://github.com/elastic/elasticsearch/commit/c3b765f8aebe1427aa6d12c8ad0ad9cec4fb5de8", "committedDate": "2020-02-18T22:35:06Z", "message": "revert unneeded changes"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYwOTc2MjEz", "url": "https://github.com/elastic/elasticsearch/pull/52494#pullrequestreview-360976213", "createdAt": "2020-02-19T09:57:00Z", "commit": {"oid": "c3b765f8aebe1427aa6d12c8ad0ad9cec4fb5de8"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOVQwOTo1NzowMFrOFrhySw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOVQwOTo1NzowMFrOFrhySw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTE4NjYzNQ==", "bodyText": "as this scenario would be fairly straightforward to create in an integration test I propose we convert this to one. What do you think?", "url": "https://github.com/elastic/elasticsearch/pull/52494#discussion_r381186635", "createdAt": "2020-02-19T09:57:00Z", "author": {"login": "andreidan"}, "path": "x-pack/plugin/ilm/src/test/java/org/elasticsearch/xpack/ilm/DeleteStepTests.java", "diffHunk": "@@ -0,0 +1,72 @@\n+/*\n+ * Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one\n+ * or more contributor license agreements. Licensed under the Elastic License;\n+ * you may not use this file except in compliance with the Elastic License.\n+ */\n+package org.elasticsearch.xpack.ilm;\n+\n+import org.elasticsearch.cluster.ClusterState;\n+import org.elasticsearch.cluster.ClusterStateObserver;\n+import org.elasticsearch.cluster.metadata.IndexMetaData;\n+import org.elasticsearch.cluster.service.ClusterService;\n+import org.elasticsearch.common.settings.Settings;\n+import org.elasticsearch.test.ESSingleNodeTestCase;\n+import org.elasticsearch.threadpool.ThreadPool;\n+import org.elasticsearch.xpack.core.ilm.AsyncActionStep;\n+import org.elasticsearch.xpack.core.ilm.DeleteStep;\n+import org.elasticsearch.xpack.core.ilm.Step.StepKey;\n+\n+import java.util.concurrent.atomic.AtomicBoolean;\n+\n+import static org.elasticsearch.cluster.metadata.IndexMetaData.SETTING_READ_ONLY;\n+import static org.elasticsearch.cluster.metadata.IndexMetaData.SETTING_READ_ONLY_ALLOW_DELETE;\n+import static org.elasticsearch.test.hamcrest.ElasticsearchAssertions.assertAcked;\n+import static org.hamcrest.Matchers.is;\n+\n+public class DeleteStepTests extends ESSingleNodeTestCase {\n+\n+    public void testDeleteStepRetriesOnError() throws Exception {\n+        assertAcked(client().admin().indices().prepareCreate(\"test\")\n+            .setSettings(Settings.builder().put(SETTING_READ_ONLY_ALLOW_DELETE, false).put(SETTING_READ_ONLY, true))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c3b765f8aebe1427aa6d12c8ad0ad9cec4fb5de8"}, "originalPosition": 30}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7fda67b3528484da7e24548db5b02043d807cd09", "author": {"user": {"login": "probakowski", "name": "Przemko Robakowski"}}, "url": "https://github.com/elastic/elasticsearch/commit/7fda67b3528484da7e24548db5b02043d807cd09", "committedDate": "2020-02-19T13:16:00Z", "message": "test reworked"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYxMjQ3NDMw", "url": "https://github.com/elastic/elasticsearch/pull/52494#pullrequestreview-361247430", "createdAt": "2020-02-19T16:37:17Z", "commit": {"oid": "7fda67b3528484da7e24548db5b02043d807cd09"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYxMjU3MzAx", "url": "https://github.com/elastic/elasticsearch/pull/52494#pullrequestreview-361257301", "createdAt": "2020-02-19T16:48:29Z", "commit": {"oid": "7fda67b3528484da7e24548db5b02043d807cd09"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2410, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}