{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk1ODY0NTc4", "number": 54463, "title": "Disallow changing 'enabled' on the root mapper.", "bodyText": "In #33933 we disallowed changing the enabled parameter in object mappings.\nHowever, the fix didn't cover the root object mapper. This PR adjusts the change\nto also include the root mapper and clarifies the error message.", "createdAt": "2020-03-30T19:55:06Z", "url": "https://github.com/elastic/elasticsearch/pull/54463", "merged": true, "mergeCommit": {"oid": "150065182ebc02e62ce81cbf7a7886ab1bcf89af"}, "closed": true, "closedAt": "2020-04-02T19:49:54Z", "author": {"login": "jtibshirani"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcS0EFxgBqjMxODAyNDMxMjc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcTqSgOAFqTM4NjMyMjU2OQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4982bd69d2615e2cba2026407177f1f1adc7ae76", "author": {"user": {"login": "jtibshirani", "name": "Julie Tibshirani"}}, "url": "https://github.com/elastic/elasticsearch/commit/4982bd69d2615e2cba2026407177f1f1adc7ae76", "committedDate": "2020-03-30T19:53:13Z", "message": "Disallow changing 'enabled' on the root mapper."}, "afterCommit": {"oid": "ea9433aa7bf54e425a0ef6fe4d05e22c6d48562c", "author": {"user": {"login": "jtibshirani", "name": "Julie Tibshirani"}}, "url": "https://github.com/elastic/elasticsearch/commit/ea9433aa7bf54e425a0ef6fe4d05e22c6d48562c", "committedDate": "2020-03-30T19:55:53Z", "message": "Disallow changing 'enabled' on the root mapper."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg0MTgzNzYy", "url": "https://github.com/elastic/elasticsearch/pull/54463#pullrequestreview-384183762", "createdAt": "2020-03-30T19:58:08Z", "commit": {"oid": "ea9433aa7bf54e425a0ef6fe4d05e22c6d48562c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMFQxOTo1ODowOVrOF9577w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMFQxOTo1ODowOVrOF9577w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDQ1NjY4Nw==", "bodyText": "It's pretty confusing that this error message will contain the singleton type name: \"The [enabled] parameter can't be updated for the object mapping [_doc].\" I think we should address this in a separate, more general change to not pass in the type as the root object mapper's name.", "url": "https://github.com/elastic/elasticsearch/pull/54463#discussion_r400456687", "createdAt": "2020-03-30T19:58:09Z", "author": {"login": "jtibshirani"}, "path": "server/src/test/java/org/elasticsearch/index/mapper/ObjectMapperMergeTests.java", "diffHunk": "@@ -93,7 +93,16 @@ public void testMergeWhenEnablingField() {\n         // WHEN merging mappings\n         // THEN a MapperException is thrown with an excepted message\n         MapperException e = expectThrows(MapperException.class, () -> rootObjectMapper.merge(mergeWith));\n-        assertEquals(\"Can't update attribute for type [type1.disabled.enabled] in index mapping\", e.getMessage());\n+        assertEquals(\"The [enabled] parameter can't be updated for the object mapping [disabled].\", e.getMessage());\n+    }\n+\n+    public void testDisableRootMapper() {\n+        String type = MapperService.SINGLE_MAPPING_NAME;\n+        ObjectMapper firstMapper = createRootObjectMapper(type, true, Collections.emptyMap());\n+        ObjectMapper secondMapper = createRootObjectMapper(type, false, Collections.emptyMap());\n+\n+        MapperException e = expectThrows(MapperException.class, () -> firstMapper.merge(secondMapper));\n+        assertEquals(\"The [enabled] parameter can't be updated for the object mapping [\" + type + \"].\", e.getMessage());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ea9433aa7bf54e425a0ef6fe4d05e22c6d48562c"}, "originalPosition": 23}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b1590bce0ae9eb6e7993923097c0feca171f4c07", "author": {"user": {"login": "jtibshirani", "name": "Julie Tibshirani"}}, "url": "https://github.com/elastic/elasticsearch/commit/b1590bce0ae9eb6e7993923097c0feca171f4c07", "committedDate": "2020-04-01T21:23:01Z", "message": "Disallow changing 'enabled' on the root mapper."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "625a31274970ed23d2890ca826c8ece389284322", "author": {"user": {"login": "jtibshirani", "name": "Julie Tibshirani"}}, "url": "https://github.com/elastic/elasticsearch/commit/625a31274970ed23d2890ca826c8ece389284322", "committedDate": "2020-04-01T21:19:53Z", "message": "Fix SourceOnlySnapshotShardTests."}, "afterCommit": {"oid": "16ddeb9ed63d5074423ca245090231f200c24d53", "author": {"user": {"login": "jtibshirani", "name": "Julie Tibshirani"}}, "url": "https://github.com/elastic/elasticsearch/commit/16ddeb9ed63d5074423ca245090231f200c24d53", "committedDate": "2020-04-01T21:23:53Z", "message": "Fix SourceOnlySnapshotShardTests."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "df69ea75287591ed7279eb2c677afdf0a25c6935", "author": {"user": {"login": "jtibshirani", "name": "Julie Tibshirani"}}, "url": "https://github.com/elastic/elasticsearch/commit/df69ea75287591ed7279eb2c677afdf0a25c6935", "committedDate": "2020-04-01T21:37:33Z", "message": "Fix SourceOnlySnapshotShardTests."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "16ddeb9ed63d5074423ca245090231f200c24d53", "author": {"user": {"login": "jtibshirani", "name": "Julie Tibshirani"}}, "url": "https://github.com/elastic/elasticsearch/commit/16ddeb9ed63d5074423ca245090231f200c24d53", "committedDate": "2020-04-01T21:23:53Z", "message": "Fix SourceOnlySnapshotShardTests."}, "afterCommit": {"oid": "df69ea75287591ed7279eb2c677afdf0a25c6935", "author": {"user": {"login": "jtibshirani", "name": "Julie Tibshirani"}}, "url": "https://github.com/elastic/elasticsearch/commit/df69ea75287591ed7279eb2c677afdf0a25c6935", "committedDate": "2020-04-01T21:37:33Z", "message": "Fix SourceOnlySnapshotShardTests."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg1OTkwNjQz", "url": "https://github.com/elastic/elasticsearch/pull/54463#pullrequestreview-385990643", "createdAt": "2020-04-01T22:22:26Z", "commit": {"oid": "df69ea75287591ed7279eb2c677afdf0a25c6935"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMVQyMjoyMjoyNlrOF_UwbQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMVQyMjoyMjoyNlrOF_UwbQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTk0NDY4NQ==", "bodyText": "I'll double check with someone from the distributed team that this change is okay.", "url": "https://github.com/elastic/elasticsearch/pull/54463#discussion_r401944685", "createdAt": "2020-04-01T22:22:26Z", "author": {"login": "jtibshirani"}, "path": "x-pack/plugin/core/src/test/java/org/elasticsearch/snapshots/SourceOnlySnapshotShardTests.java", "diffHunk": "@@ -236,7 +235,6 @@ public void testRestoreMinmal() throws IOException {\n         IndexMetadata metadata = runAsSnapshot(threadPool, () -> repository.getSnapshotIndexMetadata(snapshotId, indexId));\n         IndexShard restoredShard = newShard(\n             shardRouting, metadata, null, SourceOnlySnapshotRepository.getEngineFactory(), () -> {}, RetentionLeaseSyncer.EMPTY);\n-        restoredShard.mapperService().merge(shard.indexSettings().getIndexMetadata(), MapperService.MergeReason.MAPPING_RECOVERY);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "df69ea75287591ed7279eb2c677afdf0a25c6935"}, "originalPosition": 12}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg2MzIyNTY5", "url": "https://github.com/elastic/elasticsearch/pull/54463#pullrequestreview-386322569", "createdAt": "2020-04-02T11:06:52Z", "commit": {"oid": "df69ea75287591ed7279eb2c677afdf0a25c6935"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1361, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}