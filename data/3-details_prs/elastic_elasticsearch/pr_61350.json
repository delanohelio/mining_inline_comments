{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDcwNDY2MzI1", "number": 61350, "title": "Scripting: Converts casting and def support", "bodyText": "Painless will cast returned values to a converter\nargument type, if necessary.\nPainless will also look for a special convertFromDef\nconverter which is called to explicitly handle def\nconversions.\nconvertFromDef must handle all valid def conversions.\nRefs: #59647", "createdAt": "2020-08-19T21:25:21Z", "url": "https://github.com/elastic/elasticsearch/pull/61350", "merged": true, "mergeCommit": {"oid": "bb48a6d5d2585d8b84269b7a04a4ae8cd1d08a2f"}, "closed": true, "closedAt": "2020-08-20T19:32:30Z", "author": {"login": "stu-elastic"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdAicjsAH2gAyNDcwNDY2MzI1OmM4NThhNWFlOWNkN2VlYTdiMjRjOTI3OTQwZmM1MDAxZjVjMmJhMTM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdA0AgTgH2gAyNDcwNDY2MzI1OjQxNGNkYzcyZGE2Nzk2NGNiMWM0NmJlYzFlYWQ4OGExNzQyNTYwNTg=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "c858a5ae9cd7eea7b24c927940fc5001f5c2ba13", "author": {"user": {"login": "stu-elastic", "name": "Stuart Tettemer"}}, "url": "https://github.com/elastic/elasticsearch/commit/c858a5ae9cd7eea7b24c927940fc5001f5c2ba13", "committedDate": "2020-08-19T21:25:12Z", "message": "Scripting: Converts casting and def support\n\nPainless will cast returned values to a converter\nargument type, if necessary.\n\nPainless will also look for a special `convertFromDef`\nconverter which is called to explicitly handle `def`\nconversions.\n\n`convertFromDef` must handle all valid def conversions.\n\nRefs: #59647"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDcwOTc2NTkz", "url": "https://github.com/elastic/elasticsearch/pull/61350#pullrequestreview-470976593", "createdAt": "2020-08-19T21:25:57Z", "commit": {"oid": "c858a5ae9cd7eea7b24c927940fc5001f5c2ba13"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOVQyMToyNTo1OFrOHDaN_g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOVQyMToyNTo1OFrOHDaN_g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzMzNzM0Mg==", "bodyText": "TODO: test these failures", "url": "https://github.com/elastic/elasticsearch/pull/61350#discussion_r473337342", "createdAt": "2020-08-19T21:25:58Z", "author": {"login": "stu-elastic"}, "path": "modules/lang-painless/src/main/java/org/elasticsearch/painless/ScriptClassInfo.java", "diffHunk": "@@ -92,17 +94,33 @@ public ScriptClassInfo(PainlessLookup painlessLookup, Class<?> baseClass) {\n         if (executeMethod == null) {\n             throw new IllegalStateException(\"no execute method found\");\n         }\n-        ArrayList<ConverterSignature> converterSignatures = new ArrayList<>();\n+        ArrayList<FunctionTable.LocalFunction> converters = new ArrayList<>();\n+        FunctionTable.LocalFunction defConverter = null;\n         for (java.lang.reflect.Method m : baseClass.getMethods()) {\n             if (m.getName().startsWith(\"convertFrom\") &&\n                 m.getParameterTypes().length == 1 &&\n                 m.getReturnType() == returnType &&\n                 Modifier.isStatic(m.getModifiers())) {\n \n-                converterSignatures.add(new ConverterSignature(m));\n+                if (m.getName().equals(\"convertFromDef\")) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c858a5ae9cd7eea7b24c927940fc5001f5c2ba13"}, "originalPosition": 39}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDcxNzgxOTE5", "url": "https://github.com/elastic/elasticsearch/pull/61350#pullrequestreview-471781919", "createdAt": "2020-08-20T16:23:38Z", "commit": {"oid": "c858a5ae9cd7eea7b24c927940fc5001f5c2ba13"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5c8801331ea592cc95290dfb4850883f32506448", "author": {"user": {"login": "stu-elastic", "name": "Stuart Tettemer"}}, "url": "https://github.com/elastic/elasticsearch/commit/5c8801331ea592cc95290dfb4850883f32506448", "committedDate": "2020-08-20T17:04:42Z", "message": "Remove unreachable branch, test convertFromDef arg guard"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "414cdc72da67964cb1c46bec1ead88a174256058", "author": {"user": {"login": "stu-elastic", "name": "Stuart Tettemer"}}, "url": "https://github.com/elastic/elasticsearch/commit/414cdc72da67964cb1c46bec1ead88a174256058", "committedDate": "2020-08-20T17:52:51Z", "message": "Merge branch 'master' of github.com:elastic/elasticsearch into scripting/59647-def-casting"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4784, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}