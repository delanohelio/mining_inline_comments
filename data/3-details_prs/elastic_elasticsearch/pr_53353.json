{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg2MjgyNDk4", "number": 53353, "title": "Make lucene snapshot repository exclusive to lucene packages", "bodyText": "When depending on lucene snapshots we point maven at our own s3 backed\nrepository. However, in this case lucene packages should only be\nretrieved from this location, and no other packages should ever be found\nin that repo. This commit makes the maven repository exclusive to lucene\npackages.", "createdAt": "2020-03-10T17:59:00Z", "url": "https://github.com/elastic/elasticsearch/pull/53353", "merged": true, "mergeCommit": {"oid": "b873d8eaa3a4469b3c179eacfcd37224d7e81e05"}, "closed": true, "closedAt": "2020-03-19T22:03:48Z", "author": {"login": "rjernst"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcMWW9pAH2gAyMzg2MjgyNDk4OjA3NjJmYWQ4Y2RhZWY4NGFmNDU1ZGI3OThiOWQ5NzgwNWEyOTk5YTc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcO_UymgH2gAyMzg2MjgyNDk4OjE0ZThkNWYwMzE2NGFjNjlhOWVmODYxMDExZjRmYzg4YmEyOTFhOTk=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "0762fad8cdaef84af455db798b9d97805a2999a7", "author": {"user": {"login": "rjernst", "name": "Ryan Ernst"}}, "url": "https://github.com/elastic/elasticsearch/commit/0762fad8cdaef84af455db798b9d97805a2999a7", "committedDate": "2020-03-10T17:56:10Z", "message": "Make lucene snapshot repository exclusive to lucene packages\n\nWhen depending on lucene snapshots we point maven at our own s3 backed\nrepository. However, in this case lucene packages should only be\nretrieved from this location, and no other packages should ever be found\nin that repo. This commit makes the maven repository exclusive to lucene\npackages."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "68ebb526c0ade035493dce16ba3d88a8cb37555e", "author": {"user": {"login": "rjernst", "name": "Ryan Ernst"}}, "url": "https://github.com/elastic/elasticsearch/commit/68ebb526c0ade035493dce16ba3d88a8cb37555e", "committedDate": "2020-03-10T18:00:33Z", "message": "Merge branch 'master' into lucene_snapshot_filter"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c77429c0bf28d0daa0fb88cc51fcdedfde6d528e", "author": {"user": {"login": "rjernst", "name": "Ryan Ernst"}}, "url": "https://github.com/elastic/elasticsearch/commit/c77429c0bf28d0daa0fb88cc51fcdedfde6d528e", "committedDate": "2020-03-10T18:04:35Z", "message": "sync with master"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bcbcd72939b722f978acbeae1107d3e447279b94", "author": {"user": {"login": "rjernst", "name": "Ryan Ernst"}}, "url": "https://github.com/elastic/elasticsearch/commit/bcbcd72939b722f978acbeae1107d3e447279b94", "committedDate": "2020-03-10T18:23:02Z", "message": "add type"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc3MTkwMzMw", "url": "https://github.com/elastic/elasticsearch/pull/53353#pullrequestreview-377190330", "createdAt": "2020-03-18T19:56:55Z", "commit": {"oid": "bcbcd72939b722f978acbeae1107d3e447279b94"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOFQxOTo1Njo1NVrOF4Usyw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOFQxOTo1Njo1NVrOF4Usyw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDYwMzcyMw==", "bodyText": "Is this also specific only to snapshots? Do we ever use GA releases? And in that case, I assume we'd get those just from jcenter or maven central. If so, should we use a version regex filter here as well?", "url": "https://github.com/elastic/elasticsearch/pull/53353#discussion_r394603723", "createdAt": "2020-03-18T19:56:55Z", "author": {"login": "mark-vieira"}, "path": "buildSrc/src/main/groovy/org/elasticsearch/gradle/BuildPlugin.groovy", "diffHunk": "@@ -327,10 +328,14 @@ class BuildPlugin implements Plugin<Project> {\n             // extract the revision number from the version with a regex matcher\n             List<String> matches = (luceneVersion =~ /\\w+-snapshot-([a-z0-9]+)/).getAt(0) as List<String>\n             String revision = matches.get(1)\n-            repos.maven { MavenArtifactRepository repo ->\n+            MavenArtifactRepository luceneRepo = repos.maven { MavenArtifactRepository repo ->\n                 repo.name = 'lucene-snapshots'\n                 repo.url = \"https://s3.amazonaws.com/download.elasticsearch.org/lucenesnapshots/${revision}\"\n             }\n+            repos.exclusiveContent { ExclusiveContentRepository exclusiveRepo ->\n+                exclusiveRepo.filter { it.includeGroup('org.apache.lucene') }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bcbcd72939b722f978acbeae1107d3e447279b94"}, "originalPosition": 18}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4a09aa84928bb82b56d52b4fc8e1a524b8956810", "author": {"user": {"login": "rjernst", "name": "Ryan Ernst"}}, "url": "https://github.com/elastic/elasticsearch/commit/4a09aa84928bb82b56d52b4fc8e1a524b8956810", "committedDate": "2020-03-18T20:19:52Z", "message": "Merge branch 'master' into lucene_snapshot_filter"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4b7cbe5c1d4cdf9d0e25fc3c4bb0eb6abdcb34d8", "author": {"user": {"login": "rjernst", "name": "Ryan Ernst"}}, "url": "https://github.com/elastic/elasticsearch/commit/4b7cbe5c1d4cdf9d0e25fc3c4bb0eb6abdcb34d8", "committedDate": "2020-03-18T20:31:17Z", "message": "use version filter too"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc3MjIwNTQ5", "url": "https://github.com/elastic/elasticsearch/pull/53353#pullrequestreview-377220549", "createdAt": "2020-03-18T20:43:32Z", "commit": {"oid": "4b7cbe5c1d4cdf9d0e25fc3c4bb0eb6abdcb34d8"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOFQyMDo0MzozMlrOF4WLDQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOFQyMDo0MzozMlrOF4WLDQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDYyNzg1Mw==", "bodyText": "FYI, since this is Groovy we can use regex literal notation to avoid all the nasty string escaping so this could be /org\\.apache\\.lucene/ instead avoiding the redundant escape character.", "url": "https://github.com/elastic/elasticsearch/pull/53353#discussion_r394627853", "createdAt": "2020-03-18T20:43:32Z", "author": {"login": "mark-vieira"}, "path": "buildSrc/src/main/groovy/org/elasticsearch/gradle/BuildPlugin.groovy", "diffHunk": "@@ -327,10 +328,16 @@ class BuildPlugin implements Plugin<Project> {\n             // extract the revision number from the version with a regex matcher\n             List<String> matches = (luceneVersion =~ /\\w+-snapshot-([a-z0-9]+)/).getAt(0) as List<String>\n             String revision = matches.get(1)\n-            repos.maven { MavenArtifactRepository repo ->\n+            MavenArtifactRepository luceneRepo = repos.maven { MavenArtifactRepository repo ->\n                 repo.name = 'lucene-snapshots'\n                 repo.url = \"https://s3.amazonaws.com/download.elasticsearch.org/lucenesnapshots/${revision}\"\n             }\n+            repos.exclusiveContent { ExclusiveContentRepository exclusiveRepo ->\n+                exclusiveRepo.filter {\n+                    it.includeVersionByRegex('org\\\\.apache\\\\.lucene', '.*', \".*-snapshot-${revision}\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4b7cbe5c1d4cdf9d0e25fc3c4bb0eb6abdcb34d8"}, "originalPosition": 19}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "14e8d5f03164ac69a9ef861011f4fc88ba291a99", "author": {"user": {"login": "rjernst", "name": "Ryan Ernst"}}, "url": "https://github.com/elastic/elasticsearch/commit/14e8d5f03164ac69a9ef861011f4fc88ba291a99", "committedDate": "2020-03-18T22:47:45Z", "message": "use groovy regex string"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1710, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}