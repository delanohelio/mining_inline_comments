{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA0Nzc2NDMy", "number": 55359, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNlQyMzo0OTozNFrODytwiA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNlQyMzo0OTozNFrODytwiA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU0NTA1MDk2OnYy", "diffSide": "RIGHT", "path": "buildSrc/src/main/groovy/org/elasticsearch/gradle/precommit/PrecommitTasks.groovy", "isResolved": false, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNlQyMzo0OTozNFrOGG7GEA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xN1QxNzoyMzoyM1rOGHWpWw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTkxMjg0OA==", "bodyText": "Now that I look at this, why are we basing this on runtime java version? This should simply be hard-coded to be minimumRuntimeVersion since that's what we pass to java -release so it's effectively impossible to use APIs from a newer JDK anyhow as it'd fail at compile time. The fact that we might be configuring the build with a later runtime JVM is irrelevant. That only affects runtime behavior (i.e. tests) nothing about how our code is compiled and which JDK APIs are available to it.\nWe'll need to of course deal with the fallout of forbiddenapi compatibility when we bump the minimum runtime version but I don't see that happening anytime soon.", "url": "https://github.com/elastic/elasticsearch/pull/55359#discussion_r409912848", "createdAt": "2020-04-16T23:49:34Z", "author": {"login": "mark-vieira"}, "path": "buildSrc/src/main/groovy/org/elasticsearch/gradle/precommit/PrecommitTasks.groovy", "diffHunk": "@@ -161,10 +161,7 @@ class PrecommitTasks {\n \n             targetCompatibility = BuildParams.runtimeJavaVersion.majorVersion\n             if (BuildParams.runtimeJavaVersion > JavaVersion.VERSION_13) {\n-                project.logger.warn(\n-                        \"Forbidden APIs does not support Java versions past 13. Will use the signatures from 13 for {}.\",\n-                        BuildParams.runtimeJavaVersion\n-                )\n+                // forbidden apis does not yet support java 14 (it will in version 3.0), so we must use java 13 target", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "20908ed0cd6a95b54a25c4db41d8f586192b328a"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTkyNDU4Mw==", "bodyText": "That's certainly something we should look at, but will likely require more investigation (I recall we tried something like this before and ran into issues, likely with multi release jars). I'm happy to do that as a followup, but this PR still will reduce unnecessary noise that is plaguing all local builds now that we require JDK 14 to run the build.", "url": "https://github.com/elastic/elasticsearch/pull/55359#discussion_r409924583", "createdAt": "2020-04-17T00:29:09Z", "author": {"login": "rjernst"}, "path": "buildSrc/src/main/groovy/org/elasticsearch/gradle/precommit/PrecommitTasks.groovy", "diffHunk": "@@ -161,10 +161,7 @@ class PrecommitTasks {\n \n             targetCompatibility = BuildParams.runtimeJavaVersion.majorVersion\n             if (BuildParams.runtimeJavaVersion > JavaVersion.VERSION_13) {\n-                project.logger.warn(\n-                        \"Forbidden APIs does not support Java versions past 13. Will use the signatures from 13 for {}.\",\n-                        BuildParams.runtimeJavaVersion\n-                )\n+                // forbidden apis does not yet support java 14 (it will in version 3.0), so we must use java 13 target", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTkxMjg0OA=="}, "originalCommit": {"oid": "20908ed0cd6a95b54a25c4db41d8f586192b328a"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDI2NzExNQ==", "bodyText": "Yeah, the difficulty was exactly multi-release JARs.", "url": "https://github.com/elastic/elasticsearch/pull/55359#discussion_r410267115", "createdAt": "2020-04-17T14:38:30Z", "author": {"login": "jasontedor"}, "path": "buildSrc/src/main/groovy/org/elasticsearch/gradle/precommit/PrecommitTasks.groovy", "diffHunk": "@@ -161,10 +161,7 @@ class PrecommitTasks {\n \n             targetCompatibility = BuildParams.runtimeJavaVersion.majorVersion\n             if (BuildParams.runtimeJavaVersion > JavaVersion.VERSION_13) {\n-                project.logger.warn(\n-                        \"Forbidden APIs does not support Java versions past 13. Will use the signatures from 13 for {}.\",\n-                        BuildParams.runtimeJavaVersion\n-                )\n+                // forbidden apis does not yet support java 14 (it will in version 3.0), so we must use java 13 target", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTkxMjg0OA=="}, "originalCommit": {"oid": "20908ed0cd6a95b54a25c4db41d8f586192b328a"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDM2NDI1MQ==", "bodyText": "Cool. I'm good with deferring that for now.", "url": "https://github.com/elastic/elasticsearch/pull/55359#discussion_r410364251", "createdAt": "2020-04-17T17:23:23Z", "author": {"login": "mark-vieira"}, "path": "buildSrc/src/main/groovy/org/elasticsearch/gradle/precommit/PrecommitTasks.groovy", "diffHunk": "@@ -161,10 +161,7 @@ class PrecommitTasks {\n \n             targetCompatibility = BuildParams.runtimeJavaVersion.majorVersion\n             if (BuildParams.runtimeJavaVersion > JavaVersion.VERSION_13) {\n-                project.logger.warn(\n-                        \"Forbidden APIs does not support Java versions past 13. Will use the signatures from 13 for {}.\",\n-                        BuildParams.runtimeJavaVersion\n-                )\n+                // forbidden apis does not yet support java 14 (it will in version 3.0), so we must use java 13 target", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTkxMjg0OA=="}, "originalCommit": {"oid": "20908ed0cd6a95b54a25c4db41d8f586192b328a"}, "originalPosition": 8}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 981, "cost": 1, "resetAt": "2021-11-12T11:57:46Z"}}}