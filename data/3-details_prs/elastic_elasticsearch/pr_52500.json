{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc2OTQ0NjEx", "number": 52500, "title": "Fix geo_shape centroid calculation for downgraded shapes", "bodyText": "This commit modifies the centroid-calculator/dimensional-shape-type\nto properly support the instances of polygons that have no area\nand lines that have no length. Beforehand N/A were returned for the\ncentroid values, but it is best to downcast the shape type to\nthe appropriate type.\nCloses #52303.", "createdAt": "2020-02-19T03:29:28Z", "url": "https://github.com/elastic/elasticsearch/pull/52500", "merged": true, "mergeCommit": {"oid": "cc289f1c6ad72825bc03c2eda9d4ff8709006023"}, "closed": true, "closedAt": "2020-02-24T17:32:37Z", "author": {"login": "talevy"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcFt7JRAH2gAyMzc2OTQ0NjExOjRmMGQ2NDA0ZTFmY2FiNjRlYWViZjBhMmFlYzlhZTExYjg2YjEwNGQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcHgJbqgH2gAyMzc2OTQ0NjExOjU5MjcyYTEyM2I2NWEwNTNjZTcyMzQ1M2EzNTkyNTk3NjkwNzFlNmM=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "4f0d6404e1fcab64eaebf0a2aec9ae11b86b104d", "author": {"user": {"login": "talevy", "name": "Tal Levy"}}, "url": "https://github.com/elastic/elasticsearch/commit/4f0d6404e1fcab64eaebf0a2aec9ae11b86b104d", "committedDate": "2020-02-19T03:26:02Z", "message": "Fix geo_shape centroid calculation for downgraded shapes\n\nThis commit modifies the centroid-calculator/dimensional-shape-type\nto properly support the instances of polygons that have no area\nand lines that have no length. Beforehand N/A were returned for the\ncentroid values, but it is best to downcast the shape type to\nthe appropriate type.\n\nCloses #52303."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3ad5ce73750bf724e186ec0e53c2794eaec52e88", "author": {"user": {"login": "talevy", "name": "Tal Levy"}}, "url": "https://github.com/elastic/elasticsearch/commit/3ad5ce73750bf724e186ec0e53c2794eaec52e88", "committedDate": "2020-02-19T04:03:19Z", "message": "fix test bug"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYxMDk0NDUz", "url": "https://github.com/elastic/elasticsearch/pull/52500#pullrequestreview-361094453", "createdAt": "2020-02-19T13:09:00Z", "commit": {"oid": "3ad5ce73750bf724e186ec0e53c2794eaec52e88"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOVQxMzowOTowMVrOFrnZpA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOVQxMzowOTowMVrOFrnZpA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTI3ODYyOA==", "bodyText": "Shouldn't we make these private as we have getters for them?", "url": "https://github.com/elastic/elasticsearch/pull/52500#discussion_r381278628", "createdAt": "2020-02-19T13:09:01Z", "author": {"login": "iverase"}, "path": "server/src/main/java/org/elasticsearch/common/geo/CentroidCalculator.java", "diffHunk": "@@ -31,29 +31,45 @@\n import org.elasticsearch.geometry.Point;\n import org.elasticsearch.geometry.Polygon;\n import org.elasticsearch.geometry.Rectangle;\n+import org.elasticsearch.search.aggregations.metrics.CompensatedSum;\n+\n+import static org.elasticsearch.common.geo.DimensionalShapeType.LINE;\n+import static org.elasticsearch.common.geo.DimensionalShapeType.POINT;\n+import static org.elasticsearch.common.geo.DimensionalShapeType.POLYGON;\n \n /**\n  * This class keeps a running Kahan-sum of coordinates\n  * that are to be averaged in {@link TriangleTreeWriter} for use\n  * as the centroid of a shape.\n  */\n public class CentroidCalculator {\n-    private double compX;\n-    private double compY;\n-    private double sumX;\n-    private double sumY;\n-    private double sumWeight;\n+    CompensatedSum compSumX;\n+    CompensatedSum compSumY;\n+    CompensatedSum compSumWeight;\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3ad5ce73750bf724e186ec0e53c2794eaec52e88"}, "originalPosition": 24}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7779dfb5fffbe7d59d444661daa13cd1827e27d1", "author": {"user": {"login": "talevy", "name": "Tal Levy"}}, "url": "https://github.com/elastic/elasticsearch/commit/7779dfb5fffbe7d59d444661daa13cd1827e27d1", "committedDate": "2020-02-19T15:46:54Z", "message": "remove gettings for compsums in centroidcalculator"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "394c163be8a9208add7ba87d7d9103e761d0abe5", "author": {"user": {"login": "talevy", "name": "Tal Levy"}}, "url": "https://github.com/elastic/elasticsearch/commit/394c163be8a9208add7ba87d7d9103e761d0abe5", "committedDate": "2020-02-20T00:25:38Z", "message": "Merge remote-tracking branch 'elastic/geoshape-doc-values' into gdv-fix-centroid"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8bcf81a41863d5786c63f5e7eba0584d5149d3ee", "author": {"user": {"login": "talevy", "name": "Tal Levy"}}, "url": "https://github.com/elastic/elasticsearch/commit/8bcf81a41863d5786c63f5e7eba0584d5149d3ee", "committedDate": "2020-02-20T15:52:25Z", "message": "Merge remote-tracking branch 'elastic/geoshape-doc-values' into gdv-fix-centroid"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "59272a123b65a053ce723453a359259769071e6c", "author": {"user": {"login": "talevy", "name": "Tal Levy"}}, "url": "https://github.com/elastic/elasticsearch/commit/59272a123b65a053ce723453a359259769071e6c", "committedDate": "2020-02-24T16:30:49Z", "message": "Merge remote-tracking branch 'elastic/geoshape-doc-values' into gdv-fix-centroid"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2421, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}