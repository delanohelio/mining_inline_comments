{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDU1MzUyOTcx", "number": 60092, "title": "Add runtime_script date field", "bodyText": "Adds support for runtime_script fields with runtime_type: date.\nDoesn't add support for the format parameter to the mapper but does\nsupport it on aggregations and the like. Its a start!", "createdAt": "2020-07-22T21:00:28Z", "url": "https://github.com/elastic/elasticsearch/pull/60092", "merged": true, "mergeCommit": {"oid": "35ca3804e7ac353729bb553a7feddbe3479ea1d3"}, "closed": true, "closedAt": "2020-07-29T20:03:30Z", "author": {"login": "nik9000"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc3hRm6gH2gAyNDU1MzUyOTcxOmMwMzI5ZDg3NDczOGZkN2JiM2YxZmI5ODVkYzk0NDU5NTRkMDlmMWM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc5wPkkgH2gAyNDU1MzUyOTcxOmE1M2RmY2NlNzMxMzU2OWE0NWE4NmMzYWE1MWVhZGQ2MzJlYmEzOGM=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "c0329d874738fd7bb3f1fb985dc9445954d09f1c", "author": {"user": {"login": "nik9000", "name": "Nik Everett"}}, "url": "https://github.com/elastic/elasticsearch/commit/c0329d874738fd7bb3f1fb985dc9445954d09f1c", "committedDate": "2020-07-22T20:58:01Z", "message": "Add runtime_script date field\n\nAdds support for `runtime_script` fields with `runtime_type: date`.\nDoesn't add support for the `format` parameter to the mapper but *does*\nsupport it on aggregations and the like. Its a start!"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "578818c45e2e20eb9f8bbdece336fd722c46b608", "author": {"user": {"login": "nik9000", "name": "Nik Everett"}}, "url": "https://github.com/elastic/elasticsearch/commit/578818c45e2e20eb9f8bbdece336fd722c46b608", "committedDate": "2020-07-23T13:18:08Z", "message": "Merge branch 'feature/runtime_fields' into script_field_date"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU3NTcyMTg5", "url": "https://github.com/elastic/elasticsearch/pull/60092#pullrequestreview-457572189", "createdAt": "2020-07-29T14:21:52Z", "commit": {"oid": "578818c45e2e20eb9f8bbdece336fd722c46b608"}, "state": "APPROVED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOVQxNDoyMTo1MlrOG462xQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOVQxNDo1NToxNVrOG48cXQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjMzNzczMw==", "bodyText": "interesting scenario that I never though about: scoring based on runtime fields. You already added this to the runtime fields meta issue right?", "url": "https://github.com/elastic/elasticsearch/pull/60092#discussion_r462337733", "createdAt": "2020-07-29T14:21:52Z", "author": {"login": "javanna"}, "path": "server/src/main/java/org/elasticsearch/index/query/functionscore/DecayFunctionBuilder.java", "diffHunk": "@@ -210,6 +210,7 @@ private AbstractDistanceScoreFunction parseVariable(String fieldName, XContentPa\n \n         // dates and time and geo need special handling\n         parser.nextToken();\n+        // TODO these ain't gonna work with runtime fields", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "578818c45e2e20eb9f8bbdece336fd722c46b608"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjMzOTc0MA==", "bodyText": "interesting too, at least both of these are around parsing values, which you are making public so that we can reuse for runtime fields?", "url": "https://github.com/elastic/elasticsearch/pull/60092#discussion_r462339740", "createdAt": "2020-07-29T14:24:30Z", "author": {"login": "javanna"}, "path": "server/src/main/java/org/elasticsearch/index/query/DistanceFeatureQueryBuilder.java", "diffHunk": "@@ -120,6 +120,7 @@ protected Query doToQuery(QueryShardContext context) throws IOException {\n             return Queries.newMatchNoDocsQuery(\"Can't run [\" + NAME + \"] query on unmapped fields!\");\n         }\n         Object originObj = origin.origin();\n+        // TODO these ain't gonna work with runtime fields", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "578818c45e2e20eb9f8bbdece336fd722c46b608"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjM2Mzc0MQ==", "bodyText": "I get confused here on what has changed. why can't we return the long field script. given that we are in the long mapped field type?", "url": "https://github.com/elastic/elasticsearch/pull/60092#discussion_r462363741", "createdAt": "2020-07-29T14:55:15Z", "author": {"login": "javanna"}, "path": "x-pack/plugin/runtime-fields/src/main/java/org/elasticsearch/xpack/runtimefields/mapper/ScriptLongMappedFieldType.java", "diffHunk": "@@ -51,8 +52,9 @@ public Object valueForDisplay(Object value) {\n         return new ScriptLongFieldData.Builder(name(), script, scriptFactory);\n     }\n \n-    private LongScriptFieldScript.LeafFactory leafFactory(QueryShardContext context) {\n-        return scriptFactory.newFactory(script.getParams(), context.lookup());\n+    private AbstractLongScriptFieldScript.LeafFactory leafFactory(QueryShardContext context) {\n+        LongScriptFieldScript.LeafFactory delegate = scriptFactory.newFactory(script.getParams(), context.lookup());\n+        return ctx -> delegate.newInstance(ctx);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "578818c45e2e20eb9f8bbdece336fd722c46b608"}, "originalPosition": 16}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a53dfcce7313569a45a86c3aa51eadd632eba38c", "author": {"user": {"login": "nik9000", "name": "Nik Everett"}}, "url": "https://github.com/elastic/elasticsearch/commit/a53dfcce7313569a45a86c3aa51eadd632eba38c", "committedDate": "2020-07-29T19:32:13Z", "message": "Merge branch 'feature/runtime_fields' into script_field_date"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4081, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}