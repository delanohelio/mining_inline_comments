{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY0MDEwMjc4", "number": 60823, "title": "Fix AOOBE when setting min_doc_count to 0 in significant_terms", "bodyText": "This commit fixes the computation of the subset size on empty buckets (doc count of 0).\nThe aggregator test refactoring in #60683 revealed this bug.\nCloses #60824", "createdAt": "2020-08-06T12:57:07Z", "url": "https://github.com/elastic/elasticsearch/pull/60823", "merged": true, "mergeCommit": {"oid": "91c82e76fb65445f84269eed72db09d396593703"}, "closed": true, "closedAt": "2020-08-06T16:01:55Z", "author": {"login": "jimczi"}, "timelineItems": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc8PYMAAH2gAyNDY0MDEwMjc4OmE3ZmE1MDlmMzlkNzBlMDBhYWJiYjQ1MDlmOTAyYjQ2YjhjODRiNDg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc8QArzAH2gAyNDY0MDEwMjc4OjNkZGZkYTM3OWU4MWU5ZmI2NTVjZDg3MmMwY2Y1NzdmZTg3Zjg5Zjg=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "a7fa509f39d70e00aabbb4509f902b46b8c84b48", "author": {"user": {"login": "jimczi", "name": "Jim Ferenczi"}}, "url": "https://github.com/elastic/elasticsearch/commit/a7fa509f39d70e00aabbb4509f902b46b8c84b48", "committedDate": "2020-08-06T12:56:32Z", "message": "Fix AOOBE when setting min_doc_count to 0 in significant_terms\n\nThis commit fixes the computation of the subset size on empty buckets (doc count of 0).\nThe aggregator test refactoring in #60683 revealed this bug."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYyNTE2Mzgz", "url": "https://github.com/elastic/elasticsearch/pull/60823#pullrequestreview-462516383", "createdAt": "2020-08-06T13:27:11Z", "commit": {"oid": "a7fa509f39d70e00aabbb4509f902b46b8c84b48"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQxMzoyNzoxMVrOG8zdTw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQxMzoyNzoxMVrOG8zdTw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjQxMDgzMQ==", "bodyText": "Maybe if the owningBucketOrd is not in the array that means the bucket is empty so the size has to be 0?", "url": "https://github.com/elastic/elasticsearch/pull/60823#discussion_r466410831", "createdAt": "2020-08-06T13:27:11Z", "author": {"login": "nik9000"}, "path": "server/src/main/java/org/elasticsearch/search/aggregations/bucket/terms/GlobalOrdinalsStringTermsAggregator.java", "diffHunk": "@@ -833,13 +834,15 @@ void buildSubAggs(SignificantStringTerms.Bucket[][] topBucketsPreOrd) throws IOE\n \n         @Override\n         SignificantStringTerms buildResult(long owningBucketOrd, long otherDocCount, SignificantStringTerms.Bucket[] topBuckets) {\n+            // the subset size is missing for empty buckets (doc count of 0)\n+            long subsetSize = owningBucketOrd < subsetSizes.size() ? subsetSizes.get(owningBucketOrd) : 0;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a7fa509f39d70e00aabbb4509f902b46b8c84b48"}, "originalPosition": 33}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3ddfda379e81e9fb655cd872c0cf577fe87f89f8", "author": {"user": {"login": "jimczi", "name": "Jim Ferenczi"}}, "url": "https://github.com/elastic/elasticsearch/commit/3ddfda379e81e9fb655cd872c0cf577fe87f89f8", "committedDate": "2020-08-06T13:40:46Z", "message": "address feedback"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3435, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}