{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg2MTcxNDQx", "number": 53343, "title": "Support array for all string ingest processors", "bodyText": "Relates to #51087.\nThis work comes from the enhancement that lowercase and uppercase processors can support field with multi values, but lowercase and uppercase processors are AbstractStringProcessor,so maybe we can support array for all the string ingest processors below:\n\nBytes Processors\nHTML Strip Processors\nGsub Processors\nLowercase Processors\nUppercase Processors\nTrim Processors\nURL Decode Processors", "createdAt": "2020-03-10T14:36:17Z", "url": "https://github.com/elastic/elasticsearch/pull/53343", "merged": true, "mergeCommit": {"oid": "8ffe5d1f9499f751bc173d6965a2c2c136308eda"}, "closed": true, "closedAt": "2020-03-17T20:22:31Z", "author": {"login": "gaobinlong"}, "timelineItems": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcMQufVAH2gAyMzg2MTcxNDQxOjMwODBjYThhZTg3N2E1ODZkYmQ5ZWMyODNjMWZhYTY3YTIxNTQ3YWU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcOeDjHgH2gAyMzg2MTcxNDQxOmZlMDBiZjBhZWE3NWUwYjk2ZGUwYTYxODk2ZjBiNzlmNzE1ZDY5OTk=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "3080ca8ae877a586dbd9ec283c1faa67a21547ae", "author": {"user": {"login": "gaobinlong", "name": "bellengao"}}, "url": "https://github.com/elastic/elasticsearch/commit/3080ca8ae877a586dbd9ec283c1faa67a21547ae", "committedDate": "2020-03-10T11:22:26Z", "message": "Support array for string ingest processors"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc1NDM1NDY1", "url": "https://github.com/elastic/elasticsearch/pull/53343#pullrequestreview-375435465", "createdAt": "2020-03-16T17:30:00Z", "commit": {"oid": "3080ca8ae877a586dbd9ec283c1faa67a21547ae"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNlQxNzozMDowMFrOF2-raQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNlQxNzozNToyOVrOF2-4QQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzE5NDM0NQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            Converts a human readable byte value (e.g. 1kb) to its value in bytes (e.g. 1024). If the field value is an array, all members will be converted.\n          \n          \n            \n            Converts a human readable byte value (e.g. 1kb) to its value in bytes (e.g. 1024). If the field is an array of strings, all members of the array will be converted.", "url": "https://github.com/elastic/elasticsearch/pull/53343#discussion_r393194345", "createdAt": "2020-03-16T17:30:00Z", "author": {"login": "danhermann"}, "path": "docs/reference/ingest/processors/bytes.asciidoc", "diffHunk": "@@ -1,6 +1,6 @@\n [[bytes-processor]]\n === Bytes Processor\n-Converts a human readable byte value (e.g. 1kb) to its value in bytes (e.g. 1024).\n+Converts a human readable byte value (e.g. 1kb) to its value in bytes (e.g. 1024). If the field value is an array, all members will be converted.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3080ca8ae877a586dbd9ec283c1faa67a21547ae"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzE5NTE4MQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            If the field is not a string, the processor will throw an exception. If the field value is an array, all members will be converted.\n          \n          \n            \n            If the field is an array of string, all members of the array will be converted. If any non-string values are encountered, the processor will throw an exception.", "url": "https://github.com/elastic/elasticsearch/pull/53343#discussion_r393195181", "createdAt": "2020-03-16T17:31:23Z", "author": {"login": "danhermann"}, "path": "docs/reference/ingest/processors/gsub.asciidoc", "diffHunk": "@@ -1,7 +1,7 @@\n [[gsub-processor]]\n === Gsub Processor\n Converts a string field by applying a regular expression and a replacement.\n-If the field is not a string, the processor will throw an exception.\n+If the field is not a string, the processor will throw an exception. If the field value is an array, all members will be converted.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3080ca8ae877a586dbd9ec283c1faa67a21547ae"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzE5NjE4OQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            Removes HTML from field. If the field value is an array, all members will be converted.\n          \n          \n            \n            Removes HTML tags from the field. If the field is an array of strings, HTML tags will be removed from all members of the array.", "url": "https://github.com/elastic/elasticsearch/pull/53343#discussion_r393196189", "createdAt": "2020-03-16T17:33:10Z", "author": {"login": "danhermann"}, "path": "docs/reference/ingest/processors/html_strip.asciidoc", "diffHunk": "@@ -1,6 +1,6 @@\n [[htmlstrip-processor]]\n === HTML Strip Processor\n-Removes HTML from field.\n+Removes HTML from field. If the field value is an array, all members will be converted.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3080ca8ae877a586dbd9ec283c1faa67a21547ae"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzE5NjUyOQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            Converts a string to its lowercase equivalent. If the field value is an array, all members will be converted.\n          \n          \n            \n            Converts a string to its lowercase equivalent. If the field is an array of strings, all members of the array will be converted.", "url": "https://github.com/elastic/elasticsearch/pull/53343#discussion_r393196529", "createdAt": "2020-03-16T17:33:44Z", "author": {"login": "danhermann"}, "path": "docs/reference/ingest/processors/lowercase.asciidoc", "diffHunk": "@@ -1,6 +1,6 @@\n [[lowercase-processor]]\n === Lowercase Processor\n-Converts a string to its lowercase equivalent.\n+Converts a string to its lowercase equivalent. If the field value is an array, all members will be converted.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3080ca8ae877a586dbd9ec283c1faa67a21547ae"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzE5Njc2NA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            Trims whitespace from field. If the field value is an array, all members will be trimmed.\n          \n          \n            \n            Trims whitespace from field. If the field is an array of strings, all members of the array will be trimmed.", "url": "https://github.com/elastic/elasticsearch/pull/53343#discussion_r393196764", "createdAt": "2020-03-16T17:34:08Z", "author": {"login": "danhermann"}, "path": "docs/reference/ingest/processors/trim.asciidoc", "diffHunk": "@@ -1,6 +1,6 @@\n [[trim-processor]]\n === Trim Processor\n-Trims whitespace from field.\n+Trims whitespace from field. If the field value is an array, all members will be trimmed.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3080ca8ae877a586dbd9ec283c1faa67a21547ae"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzE5Njk4Mw==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            Converts a string to its uppercase equivalent. If the field value is an array, all members will be converted.\n          \n          \n            \n            Converts a string to its uppercase equivalent. If the field is an array of strings, all members of the array will be converted.", "url": "https://github.com/elastic/elasticsearch/pull/53343#discussion_r393196983", "createdAt": "2020-03-16T17:34:28Z", "author": {"login": "danhermann"}, "path": "docs/reference/ingest/processors/uppercase.asciidoc", "diffHunk": "@@ -1,6 +1,6 @@\n [[uppercase-processor]]\n === Uppercase Processor\n-Converts a string to its uppercase equivalent.\n+Converts a string to its uppercase equivalent. If the field value is an array, all members will be converted.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3080ca8ae877a586dbd9ec283c1faa67a21547ae"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzE5NzI1MQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            URL-decodes a string. If the field value is an array, all members will be decoded.\n          \n          \n            \n            URL-decodes a string. If the field is an array of strings, all members of the array will be decoded.", "url": "https://github.com/elastic/elasticsearch/pull/53343#discussion_r393197251", "createdAt": "2020-03-16T17:34:51Z", "author": {"login": "danhermann"}, "path": "docs/reference/ingest/processors/url-decode.asciidoc", "diffHunk": "@@ -1,6 +1,6 @@\n [[urldecode-processor]]\n === URL Decode Processor\n-URL-decodes a string\n+URL-decodes a string. If the field value is an array, all members will be decoded.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3080ca8ae877a586dbd9ec283c1faa67a21547ae"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzE5NzYzMw==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                                throw new IllegalArgumentException(\"field [\" + field + \"] of type [\" + value.getClass().getName() +\n          \n          \n            \n                                    \"] cannot be cast to [\" + String.class.getName() + \"]\");\n          \n          \n            \n                                throw new IllegalArgumentException(\"value [\" + value + \"] of type [\" + value.getClass().getName() +\n          \n          \n            \n                                    \"] in list field [\" + field + \"] cannot be cast to [\" + String.class.getName() + \"]\");", "url": "https://github.com/elastic/elasticsearch/pull/53343#discussion_r393197633", "createdAt": "2020-03-16T17:35:29Z", "author": {"login": "danhermann"}, "path": "modules/ingest-common/src/main/java/org/elasticsearch/ingest/common/AbstractStringProcessor.java", "diffHunk": "@@ -58,15 +60,38 @@ String getTargetField() {\n \n     @Override\n     public final IngestDocument execute(IngestDocument document) {\n-        String val = document.getFieldValue(field, String.class, ignoreMissing);\n+        Object val = document.getFieldValue(field, Object.class, ignoreMissing);\n+        Object newValue;\n \n         if (val == null && ignoreMissing) {\n             return document;\n         } else if (val == null) {\n             throw new IllegalArgumentException(\"field [\" + field + \"] is null, cannot process it.\");\n         }\n \n-        document.setFieldValue(targetField, process(val));\n+        if (val instanceof List) {\n+            List<?> list = (List<?>) val;\n+            List<Object> newList = new ArrayList<>(list.size());\n+            for (Object value : list) {\n+                if (value instanceof String) {\n+                    newList.add(process((String) value));\n+                } else {\n+                    throw new IllegalArgumentException(\"field [\" + field + \"] of type [\" + value.getClass().getName() +\n+                        \"] cannot be cast to [\" + String.class.getName() + \"]\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3080ca8ae877a586dbd9ec283c1faa67a21547ae"}, "originalPosition": 32}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e35d1f274b7c620548ac3513e3332333c58b3532", "author": {"user": {"login": "gaobinlong", "name": "bellengao"}}, "url": "https://github.com/elastic/elasticsearch/commit/e35d1f274b7c620548ac3513e3332333c58b3532", "committedDate": "2020-03-17T02:26:58Z", "message": "Update docs/reference/ingest/processors/bytes.asciidoc\n\nCo-Authored-By: Dan Hermann <danhermann@users.noreply.github.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ec399aaa268f0ece411d690489061495f471aba2", "author": {"user": {"login": "gaobinlong", "name": "bellengao"}}, "url": "https://github.com/elastic/elasticsearch/commit/ec399aaa268f0ece411d690489061495f471aba2", "committedDate": "2020-03-17T02:27:26Z", "message": "Update docs/reference/ingest/processors/gsub.asciidoc\n\nCo-Authored-By: Dan Hermann <danhermann@users.noreply.github.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "10bc702c1e54c2b6e8773ad88023446b35ca90c7", "author": {"user": {"login": "gaobinlong", "name": "bellengao"}}, "url": "https://github.com/elastic/elasticsearch/commit/10bc702c1e54c2b6e8773ad88023446b35ca90c7", "committedDate": "2020-03-17T02:28:07Z", "message": "Update docs/reference/ingest/processors/html_strip.asciidoc\n\nCo-Authored-By: Dan Hermann <danhermann@users.noreply.github.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3770c3863ddcb3928e04fa160635860c4c44b107", "author": {"user": {"login": "gaobinlong", "name": "bellengao"}}, "url": "https://github.com/elastic/elasticsearch/commit/3770c3863ddcb3928e04fa160635860c4c44b107", "committedDate": "2020-03-17T02:28:45Z", "message": "Update docs/reference/ingest/processors/lowercase.asciidoc\n\nCo-Authored-By: Dan Hermann <danhermann@users.noreply.github.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "097add095bbdd778e50dffb8fca264733732d6b4", "author": {"user": {"login": "gaobinlong", "name": "bellengao"}}, "url": "https://github.com/elastic/elasticsearch/commit/097add095bbdd778e50dffb8fca264733732d6b4", "committedDate": "2020-03-17T02:29:01Z", "message": "Update docs/reference/ingest/processors/trim.asciidoc\n\nCo-Authored-By: Dan Hermann <danhermann@users.noreply.github.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "60568b9c6157c4a02655dc203ed34bab9367aa8a", "author": {"user": {"login": "gaobinlong", "name": "bellengao"}}, "url": "https://github.com/elastic/elasticsearch/commit/60568b9c6157c4a02655dc203ed34bab9367aa8a", "committedDate": "2020-03-17T02:29:23Z", "message": "Update docs/reference/ingest/processors/uppercase.asciidoc\n\nCo-Authored-By: Dan Hermann <danhermann@users.noreply.github.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f93eef5d2f714540e1faa2a71a6c4ebfc6143360", "author": {"user": {"login": "gaobinlong", "name": "bellengao"}}, "url": "https://github.com/elastic/elasticsearch/commit/f93eef5d2f714540e1faa2a71a6c4ebfc6143360", "committedDate": "2020-03-17T02:29:37Z", "message": "Update docs/reference/ingest/processors/url-decode.asciidoc\n\nCo-Authored-By: Dan Hermann <danhermann@users.noreply.github.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cf6256d8b71a5cd0b025cc622dd6a0572a23cea8", "author": {"user": {"login": "gaobinlong", "name": "bellengao"}}, "url": "https://github.com/elastic/elasticsearch/commit/cf6256d8b71a5cd0b025cc622dd6a0572a23cea8", "committedDate": "2020-03-17T02:30:28Z", "message": "Update modules/ingest-common/src/main/java/org/elasticsearch/ingest/common/AbstractStringProcessor.java\n\nCo-Authored-By: Dan Hermann <danhermann@users.noreply.github.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7bc26cdf72fa011d0432790165c7ff4219a8f6d9", "author": {"user": {"login": "gaobinlong", "name": "bellengao"}}, "url": "https://github.com/elastic/elasticsearch/commit/7bc26cdf72fa011d0432790165c7ff4219a8f6d9", "committedDate": "2020-03-17T07:58:33Z", "message": "modify error message of the test code"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fe00bf0aea75e0b96de0a61896f0b79f715d6999", "author": {"user": {"login": "gaobinlong", "name": "bellengao"}}, "url": "https://github.com/elastic/elasticsearch/commit/fe00bf0aea75e0b96de0a61896f0b79f715d6999", "committedDate": "2020-03-17T08:02:03Z", "message": "Merge remote-tracking branch 'origin/master' into patch#51087"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1687, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}