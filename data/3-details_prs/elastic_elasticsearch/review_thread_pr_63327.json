{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDk4NTY3NDA2", "number": 63327, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNlQxNDowMToyM1rOEqv3AA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNlQxNDowMToyM1rOEqv3AA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEzMjU5Nzc2OnYy", "diffSide": "LEFT", "path": "server/src/main/java/org/elasticsearch/ingest/TrackingResultProcessor.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNlQxNDowMToyM1rOHdITFA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNlQxNjo0OTozM1rOHdQ9nA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDMwNjcwOA==", "bodyText": "This combination of if statements allowed cases of ElasticsearchException with causes other than those of type IllegalStateException to fall through with invoking the failure handler. I believe the original intention was to catch cyclical pipelines so I believe the correct behavior is to check for both conditions at once and allow any other exception scenarios to fall through to the \"now that we know there are no cycles\" condition.", "url": "https://github.com/elastic/elasticsearch/pull/63327#discussion_r500306708", "createdAt": "2020-10-06T14:01:23Z", "author": {"login": "danhermann"}, "path": "server/src/main/java/org/elasticsearch/ingest/TrackingResultProcessor.java", "diffHunk": "@@ -74,19 +74,15 @@ public void execute(IngestDocument ingestDocument, BiConsumer<IngestDocument, Ex\n             }\n             ingestDocumentCopy.executePipeline(pipelineToCall, (result, e) -> {\n                 // do nothing, let the tracking processors throw the exception while recording the path up to the failure\n-                if (e instanceof ElasticsearchException) {\n-                    ElasticsearchException elasticsearchException = (ElasticsearchException) e;\n-                    //else do nothing, let the tracking processors throw the exception while recording the path up to the failure\n-                    if (elasticsearchException.getCause() instanceof IllegalStateException) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2b7c651e8dc02dd0e06004e2ad9996309ccea9a2"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDMyNzE0Mg==", "bodyText": "Additionally, it seems brittle to check for pipeline cycles based only on the class of the inner exception when there's nothing that would prevent other processors from throwing exceptions of type IllegalStateException that have nothing to do with pipeline cycles.", "url": "https://github.com/elastic/elasticsearch/pull/63327#discussion_r500327142", "createdAt": "2020-10-06T14:22:27Z", "author": {"login": "danhermann"}, "path": "server/src/main/java/org/elasticsearch/ingest/TrackingResultProcessor.java", "diffHunk": "@@ -74,19 +74,15 @@ public void execute(IngestDocument ingestDocument, BiConsumer<IngestDocument, Ex\n             }\n             ingestDocumentCopy.executePipeline(pipelineToCall, (result, e) -> {\n                 // do nothing, let the tracking processors throw the exception while recording the path up to the failure\n-                if (e instanceof ElasticsearchException) {\n-                    ElasticsearchException elasticsearchException = (ElasticsearchException) e;\n-                    //else do nothing, let the tracking processors throw the exception while recording the path up to the failure\n-                    if (elasticsearchException.getCause() instanceof IllegalStateException) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDMwNjcwOA=="}, "originalCommit": {"oid": "2b7c651e8dc02dd0e06004e2ad9996309ccea9a2"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDQ0ODY2OA==", "bodyText": "This was briefly discussed a while back #34155 (comment) ..IIRC it had to do with amount of overhead to introduce a custom exception for an edge case.", "url": "https://github.com/elastic/elasticsearch/pull/63327#discussion_r500448668", "createdAt": "2020-10-06T16:49:33Z", "author": {"login": "jakelandis"}, "path": "server/src/main/java/org/elasticsearch/ingest/TrackingResultProcessor.java", "diffHunk": "@@ -74,19 +74,15 @@ public void execute(IngestDocument ingestDocument, BiConsumer<IngestDocument, Ex\n             }\n             ingestDocumentCopy.executePipeline(pipelineToCall, (result, e) -> {\n                 // do nothing, let the tracking processors throw the exception while recording the path up to the failure\n-                if (e instanceof ElasticsearchException) {\n-                    ElasticsearchException elasticsearchException = (ElasticsearchException) e;\n-                    //else do nothing, let the tracking processors throw the exception while recording the path up to the failure\n-                    if (elasticsearchException.getCause() instanceof IllegalStateException) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDMwNjcwOA=="}, "originalCommit": {"oid": "2b7c651e8dc02dd0e06004e2ad9996309ccea9a2"}, "originalPosition": 7}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3131, "cost": 1, "resetAt": "2021-11-12T11:57:46Z"}}}