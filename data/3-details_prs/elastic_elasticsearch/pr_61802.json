{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDc3MTgwNzA4", "number": 61802, "title": "Convert second 1/2 x-pack plugins from integTest to [yaml | java]RestTest or internalClusterTest", "bodyText": "For 1/2 the plugins in x-pack, the integTest\ntask is now a no-op and all of the tests are now executed via a test,\nyamlRestTest, javaRestTest, or internalClusterTest.\nThis includes the following projects:\nsecurity, spatial, stack, transform, vecotrs, voting-only-node, and watcher.\nA few of the more specialized qa projects within these plugins\nhave not been changed with this PR due to additional complexity which should\nbe addressed separately.\nrelated: #60630\nrelated: #56841\nrelated: #59939\nrelated: #55896", "createdAt": "2020-09-01T15:56:09Z", "url": "https://github.com/elastic/elasticsearch/pull/61802", "merged": true, "mergeCommit": {"oid": "3049e55f093487bb582a7e49ad624961415ba31c"}, "closed": true, "closedAt": "2020-09-02T14:23:27Z", "author": {"login": "jakelandis"}, "timelineItems": {"totalCount": 24, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdEXeMsAH2gAyNDc3MTgwNzA4OmM2MWRiYjE5MzkwMDg5NDYxNzljNGEwYjM5ZTgwMGRkN2I2NWE3MjM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdEvBrNAH2gAyNDc3MTgwNzA4OjFmNGNhOWEwZWEwMjc2YTljMjNiOWVjNjliNGFkMGUxZjZhMDFiZjc=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "c61dbb1939008946179c4a0b39e800dd7b65a723", "author": {"user": {"login": "jakelandis", "name": "Jake Landis"}}, "url": "https://github.com/elastic/elasticsearch/commit/c61dbb1939008946179c4a0b39e800dd7b65a723", "committedDate": "2020-08-31T18:53:44Z", "message": "most of security"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ec7a4f6b74b6a072475e4e8d86becc7fc6c2715b", "author": {"user": {"login": "jakelandis", "name": "Jake Landis"}}, "url": "https://github.com/elastic/elasticsearch/commit/ec7a4f6b74b6a072475e4e8d86becc7fc6c2715b", "committedDate": "2020-08-31T19:24:56Z", "message": "security internalCluster"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ef58dfb799aeb5e59c3f11bf1918c59515f76683", "author": {"user": {"login": "jakelandis", "name": "Jake Landis"}}, "url": "https://github.com/elastic/elasticsearch/commit/ef58dfb799aeb5e59c3f11bf1918c59515f76683", "committedDate": "2020-08-31T19:51:32Z", "message": "finish up security"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "92519db4e715ab47dd8b10252a5bca796c42a115", "author": {"user": {"login": "jakelandis", "name": "Jake Landis"}}, "url": "https://github.com/elastic/elasticsearch/commit/92519db4e715ab47dd8b10252a5bca796c42a115", "committedDate": "2020-08-31T20:51:02Z", "message": "security:qa"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "505153810946c01995380cdb7c927a6942c30429", "author": {"user": {"login": "jakelandis", "name": "Jake Landis"}}, "url": "https://github.com/elastic/elasticsearch/commit/505153810946c01995380cdb7c927a6942c30429", "committedDate": "2020-08-31T21:49:02Z", "message": "spatial"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3660ab0e5ad7070d7d28930cc171aff2e4ac4ae6", "author": {"user": {"login": "jakelandis", "name": "Jake Landis"}}, "url": "https://github.com/elastic/elasticsearch/commit/3660ab0e5ad7070d7d28930cc171aff2e4ac4ae6", "committedDate": "2020-08-31T22:05:15Z", "message": "stack"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "351cb2698012f2c696e5ae7666ce380f09e8b373", "author": {"user": {"login": "jakelandis", "name": "Jake Landis"}}, "url": "https://github.com/elastic/elasticsearch/commit/351cb2698012f2c696e5ae7666ce380f09e8b373", "committedDate": "2020-08-31T22:21:06Z", "message": "transform"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c4d39ddbf11eefb20967e280502c65f90085fe49", "author": {"user": {"login": "jakelandis", "name": "Jake Landis"}}, "url": "https://github.com/elastic/elasticsearch/commit/c4d39ddbf11eefb20967e280502c65f90085fe49", "committedDate": "2020-08-31T22:25:14Z", "message": "vectors"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e62708c82eafae20661c9eded4239a187772828b", "author": {"user": {"login": "jakelandis", "name": "Jake Landis"}}, "url": "https://github.com/elastic/elasticsearch/commit/e62708c82eafae20661c9eded4239a187772828b", "committedDate": "2020-08-31T22:32:47Z", "message": "voting-only-node"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5c325e5942f7fd63ca0e6f2b36085945d5daa76b", "author": {"user": {"login": "jakelandis", "name": "Jake Landis"}}, "url": "https://github.com/elastic/elasticsearch/commit/5c325e5942f7fd63ca0e6f2b36085945d5daa76b", "committedDate": "2020-09-01T14:49:56Z", "message": "watcher - internalClusterTest"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5a657067897e4e5db0ab3a184fec1382c1632452", "author": {"user": {"login": "jakelandis", "name": "Jake Landis"}}, "url": "https://github.com/elastic/elasticsearch/commit/5a657067897e4e5db0ab3a184fec1382c1632452", "committedDate": "2020-09-01T15:51:45Z", "message": "watcher qa"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0a94232fefa885b4cd196a6a2c409839babdff64", "author": {"user": {"login": "jakelandis", "name": "Jake Landis"}}, "url": "https://github.com/elastic/elasticsearch/commit/0a94232fefa885b4cd196a6a2c409839babdff64", "committedDate": "2020-09-01T15:56:45Z", "message": "Merge remote-tracking branch 'upstream/master' into yamlRestTest_xpack_plugins_part2"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "93135280c8951717e7b31f09d2ead97b2b96df5c", "author": {"user": {"login": "jakelandis", "name": "Jake Landis"}}, "url": "https://github.com/elastic/elasticsearch/commit/93135280c8951717e7b31f09d2ead97b2b96df5c", "committedDate": "2020-09-01T17:03:00Z", "message": "Merge branch 'master' of github.com:elastic/elasticsearch into yamlRestTest_xpack_plugins_part2"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "745f76288609ea0f43109d5156dccec38ccabbc5", "author": {"user": {"login": "jakelandis", "name": "Jake Landis"}}, "url": "https://github.com/elastic/elasticsearch/commit/745f76288609ea0f43109d5156dccec38ccabbc5", "committedDate": "2020-09-01T17:33:05Z", "message": "remove commented out line"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "254b20dd3c6da8fa144cfb739677e976dda65204", "author": {"user": {"login": "jakelandis", "name": "Jake Landis"}}, "url": "https://github.com/elastic/elasticsearch/commit/254b20dd3c6da8fa144cfb739677e976dda65204", "committedDate": "2020-09-01T18:11:37Z", "message": "spotless"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3faa914e2434e4aa5ce33bd926c1cdda3c407dc1", "author": {"user": {"login": "jakelandis", "name": "Jake Landis"}}, "url": "https://github.com/elastic/elasticsearch/commit/3faa914e2434e4aa5ce33bd926c1cdda3c407dc1", "committedDate": "2020-09-01T19:11:18Z", "message": "fix precommit"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgwMDgxMTEz", "url": "https://github.com/elastic/elasticsearch/pull/61802#pullrequestreview-480081113", "createdAt": "2020-09-01T20:13:24Z", "commit": {"oid": "3faa914e2434e4aa5ce33bd926c1cdda3c407dc1"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMVQyMDoxMzoyNVrOHLGj3w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMVQyMDoxMzoyNVrOHLGj3w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTQwMzg3MQ==", "bodyText": "I introduced a qa/common project to better match how the other projects have this configured.", "url": "https://github.com/elastic/elasticsearch/pull/61802#discussion_r481403871", "createdAt": "2020-09-01T20:13:25Z", "author": {"login": "jakelandis"}, "path": "x-pack/plugin/watcher/qa/common/build.gradle", "diffHunk": "@@ -0,0 +1,20 @@\n+apply plugin: 'elasticsearch.build'", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3faa914e2434e4aa5ce33bd926c1cdda3c407dc1"}, "originalPosition": 1}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgwMDgyMTc1", "url": "https://github.com/elastic/elasticsearch/pull/61802#pullrequestreview-480082175", "createdAt": "2020-09-01T20:15:00Z", "commit": {"oid": "3faa914e2434e4aa5ce33bd926c1cdda3c407dc1"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMVQyMDoxNTowMFrOHLGnKg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMVQyMDoxNTowMFrOHLGnKg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTQwNDcxNA==", "bodyText": "minor duplication here to avoid sharing classpath's between test and javaRestTests", "url": "https://github.com/elastic/elasticsearch/pull/61802#discussion_r481404714", "createdAt": "2020-09-01T20:15:00Z", "author": {"login": "jakelandis"}, "path": "x-pack/plugin/watcher/src/test/java/org/elasticsearch/xpack/watcher/actions/email/EmailActionTests.java", "diffHunk": "@@ -605,4 +607,18 @@ private EmailAttachments randomEmailAttachments() throws IOException {\n \n         return new EmailAttachments(attachments);\n     }\n+\n+    public static class NoopEmailService extends EmailService {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3faa914e2434e4aa5ce33bd926c1cdda3c407dc1"}, "originalPosition": 64}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgwMDgyNjIy", "url": "https://github.com/elastic/elasticsearch/pull/61802#pullrequestreview-480082622", "createdAt": "2020-09-01T20:15:32Z", "commit": {"oid": "3faa914e2434e4aa5ce33bd926c1cdda3c407dc1"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMVQyMDoxNTozMlrOHLGorA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMVQyMDoxNTozMlrOHLGorA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTQwNTEwMA==", "bodyText": "didn't mean to change the package ... fixing now ..", "url": "https://github.com/elastic/elasticsearch/pull/61802#discussion_r481405100", "createdAt": "2020-09-01T20:15:32Z", "author": {"login": "jakelandis"}, "path": "x-pack/plugin/security/src/internalClusterTest/java/org/elasticsearch/transport/filter/IpFilteringIntegrationTests.java", "diffHunk": "@@ -3,7 +3,7 @@\n  * or more contributor license agreements. Licensed under the Elastic License;\n  * you may not use this file except in compliance with the Elastic License.\n  */\n-package org.elasticsearch.xpack.security.transport.filter;\n+package org.elasticsearch.transport.filter;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3faa914e2434e4aa5ce33bd926c1cdda3c407dc1"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f3dee8bc3c3ad453e603e52efca1d5ccdf0bf52e", "author": {"user": {"login": "jakelandis", "name": "Jake Landis"}}, "url": "https://github.com/elastic/elasticsearch/commit/f3dee8bc3c3ad453e603e52efca1d5ccdf0bf52e", "committedDate": "2020-09-01T20:20:25Z", "message": "fix package location"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f84d203b92622a2d5e794a6a03199daabb15e071", "author": {"user": {"login": "jakelandis", "name": "Jake Landis"}}, "url": "https://github.com/elastic/elasticsearch/commit/f84d203b92622a2d5e794a6a03199daabb15e071", "committedDate": "2020-09-01T20:22:30Z", "message": "fix package location"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgwMTA5MzM3", "url": "https://github.com/elastic/elasticsearch/pull/61802#pullrequestreview-480109337", "createdAt": "2020-09-01T20:56:53Z", "commit": {"oid": "f84d203b92622a2d5e794a6a03199daabb15e071"}, "state": "APPROVED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMVQyMDo1Njo1M1rOHLH8Rw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMVQyMTowMzowOFrOHLII6g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTQyNjUwMw==", "bodyText": "This whole thing looks gnarly. Why don't we use two different clusters for this?", "url": "https://github.com/elastic/elasticsearch/pull/61802#discussion_r481426503", "createdAt": "2020-09-01T20:56:53Z", "author": {"login": "mark-vieira"}, "path": "x-pack/plugin/security/qa/basic-enable-security/build.gradle", "diffHunk": "@@ -1,36 +1,36 @@\n import org.elasticsearch.gradle.testclusters.StandaloneRestIntegTestTask\n+import org.elasticsearch.gradle.test.rest.JavaRestTestPlugin\n \n-apply plugin: 'elasticsearch.testclusters'\n-apply plugin: 'elasticsearch.standalone-rest-test'\n-apply plugin: 'elasticsearch.rest-test'\n+apply plugin: 'elasticsearch.java-rest-test'\n \n dependencies {\n-  testImplementation project(path: xpackModule('core'), configuration: 'default')\n-  testImplementation project(path: xpackModule('security'), configuration: 'testArtifacts')\n-  testImplementation project(path: xpackModule('core'), configuration: 'testArtifacts')\n+  javaRestTestImplementation project(path: xpackModule('core'), configuration: 'default')\n+  javaRestTestImplementation project(path: xpackModule('security'), configuration: 'testArtifacts')\n+  javaRestTestImplementation project(path: xpackModule('core'), configuration: 'testArtifacts')\n }\n \n-integTest {\n+javaRestTest {\n   description = \"Run tests against a cluster that doesn't have security\"\n   systemProperty 'tests.has_security', 'false'\n }\n \n-testClusters.integTest {\n+testClusters.javaRestTest {\n   testDistribution = 'DEFAULT'\n   numberOfNodes = 2\n   setting 'xpack.ml.enabled', 'false'\n   setting 'xpack.license.self_generated.type', 'basic'\n   setting 'xpack.security.enabled', 'false'\n }\n \n-task integTestSecurity(type: StandaloneRestIntegTestTask) {\n-  description = \"Run tests against a cluster that has security\"\n-  useCluster testClusters.integTest\n-  dependsOn integTest\n+task javaRestTestWithSecurity(type: StandaloneRestIntegTestTask) {\n+  description = \"Run tests against a cluster that has security enabled\"\n+  useCluster testClusters.javaRestTest\n+  dependsOn javaRestTest", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f84d203b92622a2d5e794a6a03199daabb15e071"}, "originalPosition": 40}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTQyODM3NQ==", "bodyText": "I suspect this probably isn't needed for unit tests. Can we ditch the block above?", "url": "https://github.com/elastic/elasticsearch/pull/61802#discussion_r481428375", "createdAt": "2020-09-01T21:00:28Z", "author": {"login": "mark-vieira"}, "path": "x-pack/plugin/security/build.gradle", "diffHunk": "@@ -476,6 +484,11 @@ test {\n   systemProperty 'es.transport.buffer.size', '256k'\n }\n \n+internalClusterTest {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f84d203b92622a2d5e794a6a03199daabb15e071"}, "originalPosition": 37}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTQyOTczOA==", "bodyText": "Same, I suspect this is only needed for integration tests.", "url": "https://github.com/elastic/elasticsearch/pull/61802#discussion_r481429738", "createdAt": "2020-09-01T21:03:08Z", "author": {"login": "mark-vieira"}, "path": "x-pack/plugin/watcher/build.gradle", "diffHunk": "@@ -86,6 +87,10 @@ test {\n   systemProperty 'es.set.netty.runtime.available.processors', 'false'\n }\n \n+internalClusterTest {\n+  systemProperty 'es.set.netty.runtime.available.processors', 'false'", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f84d203b92622a2d5e794a6a03199daabb15e071"}, "originalPosition": 11}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "667ea2abd20fc50c91e8ac16f5066ed44aad0d9d", "author": {"user": {"login": "jakelandis", "name": "Jake Landis"}}, "url": "https://github.com/elastic/elasticsearch/commit/667ea2abd20fc50c91e8ac16f5066ed44aad0d9d", "committedDate": "2020-09-01T22:12:23Z", "message": "remove unecessary watcher test artifact"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1f4ca9a0ea0276a9c23b9ec69b4ad0e1f6a01bf7", "author": {"user": {"login": "jakelandis", "name": "Jake Landis"}}, "url": "https://github.com/elastic/elasticsearch/commit/1f4ca9a0ea0276a9c23b9ec69b4ad0e1f6a01bf7", "committedDate": "2020-09-01T22:20:18Z", "message": "remove unnecessary config"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4958, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}