{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzgxNTM0NTYy", "number": 52967, "title": "SQL: use a proper error message for queries directed at empty mapping indices", "bodyText": "Until now, when a query was executed against an index that had no mapping a misleading \"index not found\" error message was issued. This PR fixes this error message by pointing out the columns not being found instead.\nFixes #52865.", "createdAt": "2020-02-28T18:36:22Z", "url": "https://github.com/elastic/elasticsearch/pull/52967", "merged": true, "mergeCommit": {"oid": "a0bd83a0579cf196a1d727de2a46b3b101d5a73b"}, "closed": true, "closedAt": "2020-03-02T10:53:51Z", "author": {"login": "astefan"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcI0RGWgH2gAyMzgxNTM0NTYyOmI5ZjdiMjY5YmY3Y2ExOWFiNzFjNTc5NjRkNjJkMDJkOTVjZjNjOWE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcJJOowAFqTM2NjgxMzkwNw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "b9f7b269bf7ca19ab71c57964d62d02d95cf3c9a", "author": {"user": {"login": "astefan", "name": "Andrei Stefan"}}, "url": "https://github.com/elastic/elasticsearch/commit/b9f7b269bf7ca19ab71c57964d62d02d95cf3c9a", "committedDate": "2020-02-28T18:31:13Z", "message": "Issue a different error message in case an index doesn't have a mapping"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4ca64926f81e6a55f90c8207a973b2c1737b3824", "author": {"user": {"login": "astefan", "name": "Andrei Stefan"}}, "url": "https://github.com/elastic/elasticsearch/commit/4ca64926f81e6a55f90c8207a973b2c1737b3824", "committedDate": "2020-02-28T18:32:47Z", "message": "Merge branch 'master' of https://github.com/elastic/elasticsearch into 52865_fix"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY2ODEzNzI2", "url": "https://github.com/elastic/elasticsearch/pull/52967#pullrequestreview-366813726", "createdAt": "2020-02-29T18:53:11Z", "commit": {"oid": "4ca64926f81e6a55f90c8207a973b2c1737b3824"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY2ODEzODI4", "url": "https://github.com/elastic/elasticsearch/pull/52967#pullrequestreview-366813828", "createdAt": "2020-02-29T18:55:08Z", "commit": {"oid": "4ca64926f81e6a55f90c8207a973b2c1737b3824"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY2ODEzOTA3", "url": "https://github.com/elastic/elasticsearch/pull/52967#pullrequestreview-366813907", "createdAt": "2020-02-29T18:56:32Z", "commit": {"oid": "4ca64926f81e6a55f90c8207a973b2c1737b3824"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yOVQxODo1NjozMlrOFwKgCg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yOVQxODo1NjozMlrOFwKgCg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjA0ODAxMA==", "bodyText": "I think this is incorrect - if we know the index is empty, we should return no columns since we can determine them and know there are none.", "url": "https://github.com/elastic/elasticsearch/pull/52967#discussion_r386048010", "createdAt": "2020-02-29T18:56:32Z", "author": {"login": "costin"}, "path": "x-pack/plugin/sql/qa/src/main/java/org/elasticsearch/xpack/sql/qa/cli/ErrorsTestCase.java", "diffHunk": "@@ -37,15 +37,30 @@ public void testSelectFromMissingIndex() throws IOException {\n     }\n \n     @Override\n-    public void testSelectFromIndexWithoutTypes() throws Exception {\n+    public void testSelectColumnFromMissingIndex() throws Exception {\n+        assertFoundOneProblem(command(\"SELECT abc FROM test\"));\n+        assertEquals(\"line 1:17: Unknown index [test]\" + END, readLine());\n+    }\n+\n+    @Override\n+    public void testSelectFromEmptyIndex() throws Exception {\n         // Create an index without any types\n         Request request = new Request(\"PUT\", \"/test\");\n         request.setJsonEntity(\"{}\");\n         client().performRequest(request);\n \n         assertFoundOneProblem(command(\"SELECT * FROM test\"));\n-        //assertEquals(\"line 1:15: [test] doesn't have any types so it is incompatible with sql\" + END, readLine());\n-        assertEquals(\"line 1:15: Unknown index [test]\" + END, readLine());\n+        assertEquals(\"line 1:8: Cannot determine columns for [*]\" + END, readLine());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4ca64926f81e6a55f90c8207a973b2c1737b3824"}, "originalPosition": 20}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1873, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}