{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzkyMzk0NTg4", "number": 53977, "title": "[ML] No refresh on indexing DFA stats", "bodyText": "When we index data frame analytics stats docs we do not\nneed to refresh immediately.", "createdAt": "2020-03-23T13:44:44Z", "url": "https://github.com/elastic/elasticsearch/pull/53977", "merged": true, "mergeCommit": {"oid": "4cf1d1ad059eeffbe3d7bf9d9782fbaeec0e3880"}, "closed": true, "closedAt": "2020-03-24T10:09:26Z", "author": {"login": "dimitris-athanasiou"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcQfkrBgFqTM3OTUwOTAwNA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcQvFymAFqTM4MDExMDE0OQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc5NTA5MDA0", "url": "https://github.com/elastic/elasticsearch/pull/53977#pullrequestreview-379509004", "createdAt": "2020-03-23T14:55:52Z", "commit": {"oid": "13e601082329aa5e6166161e09e983d332e4819c"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QxNDo1NTo1MlrOF6JOUA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QxNDo1NTo1MlrOF6JOUA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjUxMjg0OA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    LOGGER.debug(\"[{}] Refreshing indices {}\", jobId, Arrays.toString(refreshRequest.indices()));\n          \n          \n            \n                    LOGGER.debug(() -> new ParameterizedMessage(\"[{}] Refreshing indices {}\", jobId, Arrays.toString(refreshRequest.indices())));\n          \n      \n    \n    \n  \n\nI think the string is created eagerly. This is not strictly necessary unless the logging level is debug.\nThis is a minor thing as most of our logging does not take this into account.", "url": "https://github.com/elastic/elasticsearch/pull/53977#discussion_r396512848", "createdAt": "2020-03-23T14:55:52Z", "author": {"login": "benwtrent"}, "path": "x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/dataframe/process/AnalyticsProcessManager.java", "diffHunk": "@@ -301,12 +303,15 @@ private void refreshDest(DataFrameAnalyticsConfig config) {\n             () -> client.execute(RefreshAction.INSTANCE, new RefreshRequest(config.getDest().getIndex())).actionGet());\n     }\n \n-    private void refreshStateIndex(String jobId) {\n-        String indexName = AnomalyDetectorsIndex.jobStateIndexPattern();\n-        LOGGER.debug(\"[{}] Refresh index {}\", jobId, indexName);\n-\n-        RefreshRequest refreshRequest = new RefreshRequest(indexName);\n+    private void refreshIndices(String jobId) {\n+        RefreshRequest refreshRequest = new RefreshRequest(\n+            AnomalyDetectorsIndex.jobStateIndexPattern(),\n+            MlStatsIndex.indexPattern()\n+        );\n         refreshRequest.indicesOptions(IndicesOptions.lenientExpandOpen());\n+\n+        LOGGER.debug(\"[{}] Refreshing indices {}\", jobId, Arrays.toString(refreshRequest.indices()));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "13e601082329aa5e6166161e09e983d332e4819c"}, "originalPosition": 41}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgwMDkwODgy", "url": "https://github.com/elastic/elasticsearch/pull/53977#pullrequestreview-380090882", "createdAt": "2020-03-24T08:33:20Z", "commit": {"oid": "13e601082329aa5e6166161e09e983d332e4819c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQwODozMzoyMFrOF6ll4A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQwODozMzoyMFrOF6ll4A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Njk3NzYzMg==", "bodyText": "Would it make sense to also refresh dest index in this method?", "url": "https://github.com/elastic/elasticsearch/pull/53977#discussion_r396977632", "createdAt": "2020-03-24T08:33:20Z", "author": {"login": "przemekwitek"}, "path": "x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/dataframe/process/AnalyticsProcessManager.java", "diffHunk": "@@ -301,12 +303,15 @@ private void refreshDest(DataFrameAnalyticsConfig config) {\n             () -> client.execute(RefreshAction.INSTANCE, new RefreshRequest(config.getDest().getIndex())).actionGet());\n     }\n \n-    private void refreshStateIndex(String jobId) {\n-        String indexName = AnomalyDetectorsIndex.jobStateIndexPattern();\n-        LOGGER.debug(\"[{}] Refresh index {}\", jobId, indexName);\n-\n-        RefreshRequest refreshRequest = new RefreshRequest(indexName);\n+    private void refreshIndices(String jobId) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "13e601082329aa5e6166161e09e983d332e4819c"}, "originalPosition": 34}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5ea3e2d003bfebe3678912b32602210900e2ec8d", "author": {"user": {"login": "dimitris-athanasiou", "name": "Dimitris Athanasiou"}}, "url": "https://github.com/elastic/elasticsearch/commit/5ea3e2d003bfebe3678912b32602210900e2ec8d", "committedDate": "2020-03-24T08:53:47Z", "message": "[ML] No refresh on indexing DFA stats\n\nWhen we index data frame analytics stats docs we do not\nneed to refresh immediately."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "13e601082329aa5e6166161e09e983d332e4819c", "author": {"user": {"login": "dimitris-athanasiou", "name": "Dimitris Athanasiou"}}, "url": "https://github.com/elastic/elasticsearch/commit/13e601082329aa5e6166161e09e983d332e4819c", "committedDate": "2020-03-23T13:40:32Z", "message": "[ML] No refresh on indexing DFA stats\n\nWhen we index data frame analytics stats docs we do not\nneed to refresh immediately.\n\nThis commit also increases the timeout for DFA tests from\n30 seconds to 40 seconds as some of the native integ tests\nare very close to timing out."}, "afterCommit": {"oid": "5ea3e2d003bfebe3678912b32602210900e2ec8d", "author": {"user": {"login": "dimitris-athanasiou", "name": "Dimitris Athanasiou"}}, "url": "https://github.com/elastic/elasticsearch/commit/5ea3e2d003bfebe3678912b32602210900e2ec8d", "committedDate": "2020-03-24T08:53:47Z", "message": "[ML] No refresh on indexing DFA stats\n\nWhen we index data frame analytics stats docs we do not\nneed to refresh immediately."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgwMTEwMTQ5", "url": "https://github.com/elastic/elasticsearch/pull/53977#pullrequestreview-380110149", "createdAt": "2020-03-24T09:00:32Z", "commit": {"oid": "5ea3e2d003bfebe3678912b32602210900e2ec8d"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQwOTowMDozM1rOF6mjEQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQwOTowMDozM1rOF6mjEQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Njk5MzI5Nw==", "bodyText": "Right, thanks for explanation.", "url": "https://github.com/elastic/elasticsearch/pull/53977#discussion_r396993297", "createdAt": "2020-03-24T09:00:33Z", "author": {"login": "przemekwitek"}, "path": "x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/dataframe/process/AnalyticsProcessManager.java", "diffHunk": "@@ -301,12 +303,15 @@ private void refreshDest(DataFrameAnalyticsConfig config) {\n             () -> client.execute(RefreshAction.INSTANCE, new RefreshRequest(config.getDest().getIndex())).actionGet());\n     }\n \n-    private void refreshStateIndex(String jobId) {\n-        String indexName = AnomalyDetectorsIndex.jobStateIndexPattern();\n-        LOGGER.debug(\"[{}] Refresh index {}\", jobId, indexName);\n-\n-        RefreshRequest refreshRequest = new RefreshRequest(indexName);\n+    private void refreshIndices(String jobId) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Njk3NzYzMg=="}, "originalCommit": {"oid": "13e601082329aa5e6166161e09e983d332e4819c"}, "originalPosition": 34}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1782, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}