{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg0NTE0MDYz", "number": 53192, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNlQxNTo1OTowNlrODl2QNQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNlQxNTo1OTowNlrODl2QNQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQxMDEyNzg5OnYy", "diffSide": "RIGHT", "path": "x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/action/TransportStartDataFrameAnalyticsAction.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNlQxNTo1OTowNlrOFy936g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNlQxNjo1MjozN1rOFy_21Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODk4Njg1OA==", "bodyText": "The risk of mistakes in future maintenance would be reduced if the string \"], because not all primary shards are active for the following indices [\" from old line 587 was put in a constant and that same constant was used here too.", "url": "https://github.com/elastic/elasticsearch/pull/53192#discussion_r388986858", "createdAt": "2020-03-06T15:59:06Z", "author": {"login": "droberts195"}, "path": "x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/action/TransportStartDataFrameAnalyticsAction.java", "diffHunk": "@@ -450,9 +470,15 @@ public boolean test(PersistentTasksCustomMetaData.PersistentTask<?> persistentTa\n                 return true;\n             }\n \n-            if (assignment != null && assignment.equals(PersistentTasksCustomMetaData.INITIAL_ASSIGNMENT) == false &&\n-                assignment.isAssigned() == false) {\n-                // Assignment has failed despite passing our \"fast fail\" validation\n+            if (assignment != null\n+                && assignment.equals(PersistentTasksCustomMetaData.INITIAL_ASSIGNMENT) == false\n+                && assignment.isAssigned() == false) {\n+                assignmentExplanation = assignment.getExplanation();\n+                // Assignment failed due to primary shard check.\n+                // This is hopefully intermittent and we should allow another assignment attempt.\n+                if (assignmentExplanation.contains(\"not all primary shards are active\")) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "150a5211809cbd04c6c6eb135fab2ce45f7058b0"}, "originalPosition": 58}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTAxOTM0OQ==", "bodyText": "For sure!", "url": "https://github.com/elastic/elasticsearch/pull/53192#discussion_r389019349", "createdAt": "2020-03-06T16:52:37Z", "author": {"login": "benwtrent"}, "path": "x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/action/TransportStartDataFrameAnalyticsAction.java", "diffHunk": "@@ -450,9 +470,15 @@ public boolean test(PersistentTasksCustomMetaData.PersistentTask<?> persistentTa\n                 return true;\n             }\n \n-            if (assignment != null && assignment.equals(PersistentTasksCustomMetaData.INITIAL_ASSIGNMENT) == false &&\n-                assignment.isAssigned() == false) {\n-                // Assignment has failed despite passing our \"fast fail\" validation\n+            if (assignment != null\n+                && assignment.equals(PersistentTasksCustomMetaData.INITIAL_ASSIGNMENT) == false\n+                && assignment.isAssigned() == false) {\n+                assignmentExplanation = assignment.getExplanation();\n+                // Assignment failed due to primary shard check.\n+                // This is hopefully intermittent and we should allow another assignment attempt.\n+                if (assignmentExplanation.contains(\"not all primary shards are active\")) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODk4Njg1OA=="}, "originalCommit": {"oid": "150a5211809cbd04c6c6eb135fab2ce45f7058b0"}, "originalPosition": 58}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3442, "cost": 1, "resetAt": "2021-11-12T11:57:46Z"}}}