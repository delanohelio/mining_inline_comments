{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDcyNzQ5NDI1", "number": 61505, "title": "[ML] write warning if configured memory limit is too low for analytics job", "bodyText": "Having _start fail when the configured memory limit is too low can be frustrating.\nWe should instead warn the user that their job might not run properly if their configured limit is too low.\nIt might be that our estimate is too high, and their configured limit works just fine.", "createdAt": "2020-08-24T20:30:46Z", "url": "https://github.com/elastic/elasticsearch/pull/61505", "merged": true, "mergeCommit": {"oid": "44d667b33faf28fdc6a8be0e6b617403d9dc1855"}, "closed": true, "closedAt": "2020-08-25T14:12:54Z", "author": {"login": "benwtrent"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdCIo3xAH2gAyNDcyNzQ5NDI1OjA0OTRhMmZiNjMyNjkxYWE0YTljOGYyNWM5MjBlMTM3NzllMjgxODE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdCXwGHAFqTQ3NDUxNTU5MQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "0494a2fb632691aa4a9c8f25c920e13779e28181", "author": {"user": {"login": "benwtrent", "name": "Benjamin Trent"}}, "url": "https://github.com/elastic/elasticsearch/commit/0494a2fb632691aa4a9c8f25c920e13779e28181", "committedDate": "2020-08-24T20:28:58Z", "message": "[ML] write warning if configured memory limit is too low for analytics job"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc0MzE3ODcz", "url": "https://github.com/elastic/elasticsearch/pull/61505#pullrequestreview-474317873", "createdAt": "2020-08-25T09:48:46Z", "commit": {"oid": "0494a2fb632691aa4a9c8f25c920e13779e28181"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNVQwOTo0ODo0N1rOHGQeZw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNVQwOTo0OToyMFrOHGQfnA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjMyMzQzMQ==", "bodyText": "Let's also update the comment here to say we're just warning when limit is lower than estimate", "url": "https://github.com/elastic/elasticsearch/pull/61505#discussion_r476323431", "createdAt": "2020-08-25T09:48:47Z", "author": {"login": "dimitris-athanasiou"}, "path": "x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/action/TransportStartDataFrameAnalyticsAction.java", "diffHunk": "@@ -218,12 +219,13 @@ private void estimateMemoryUsageAndUpdateMemoryTracker(StartContext startContext\n                 // Validate that model memory limit is sufficient to run the analysis", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0494a2fb632691aa4a9c8f25c920e13779e28181"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjMyMzc0MA==", "bodyText": "Should we change \"may not run\" to \"may fail\" ?", "url": "https://github.com/elastic/elasticsearch/pull/61505#discussion_r476323740", "createdAt": "2020-08-25T09:49:20Z", "author": {"login": "dimitris-athanasiou"}, "path": "x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/ml/job/messages/Messages.java", "diffHunk": "@@ -66,6 +66,9 @@\n     public static final String DATA_FRAME_ANALYTICS_AUDIT_UPDATED_STATE_WITH_REASON =\n             \"Updated analytics task state to [{0}] with reason [{1}]\";\n     public static final String DATA_FRAME_ANALYTICS_AUDIT_ESTIMATED_MEMORY_USAGE = \"Estimated memory usage for this analytics to be [{0}]\";\n+    public static final String DATA_FRAME_ANALYTICS_AUDIT_ESTIMATED_MEMORY_USAGE_HIGHER_THAN_CONFIGURED =\n+        \"Configured model memory limit [{0}] is lower than the expected memory usage [{1}]. \" +\n+            \"The analytics job may not run due to configured memory constraints.\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0494a2fb632691aa4a9c8f25c920e13779e28181"}, "originalPosition": 6}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc0Mzg2Mjk5", "url": "https://github.com/elastic/elasticsearch/pull/61505#pullrequestreview-474386299", "createdAt": "2020-08-25T11:30:56Z", "commit": {"oid": "0494a2fb632691aa4a9c8f25c920e13779e28181"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNVQxMTozMDo1N1rOHGTsxg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNVQxMTozMTozOFrOHGTt-w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjM3NjI2Mg==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        \"The analytics job may not run due to configured memory constraints.\";\n          \n          \n            \n                        \"The analytics job may fail due to configured memory constraints.\";", "url": "https://github.com/elastic/elasticsearch/pull/61505#discussion_r476376262", "createdAt": "2020-08-25T11:30:57Z", "author": {"login": "benwtrent"}, "path": "x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/ml/job/messages/Messages.java", "diffHunk": "@@ -66,6 +66,9 @@\n     public static final String DATA_FRAME_ANALYTICS_AUDIT_UPDATED_STATE_WITH_REASON =\n             \"Updated analytics task state to [{0}] with reason [{1}]\";\n     public static final String DATA_FRAME_ANALYTICS_AUDIT_ESTIMATED_MEMORY_USAGE = \"Estimated memory usage for this analytics to be [{0}]\";\n+    public static final String DATA_FRAME_ANALYTICS_AUDIT_ESTIMATED_MEMORY_USAGE_HIGHER_THAN_CONFIGURED =\n+        \"Configured model memory limit [{0}] is lower than the expected memory usage [{1}]. \" +\n+            \"The analytics job may not run due to configured memory constraints.\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0494a2fb632691aa4a9c8f25c920e13779e28181"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjM3NjU3MQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                            // Validate that model memory limit is sufficient to run the analysis\n          \n          \n            \n                            // Validate that model memory limit is sufficient to run the analysis\n          \n          \n            \n                            // We will only warn the caller if the configured limit is too low.", "url": "https://github.com/elastic/elasticsearch/pull/61505#discussion_r476376571", "createdAt": "2020-08-25T11:31:38Z", "author": {"login": "benwtrent"}, "path": "x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/action/TransportStartDataFrameAnalyticsAction.java", "diffHunk": "@@ -218,12 +219,13 @@ private void estimateMemoryUsageAndUpdateMemoryTracker(StartContext startContext\n                 // Validate that model memory limit is sufficient to run the analysis", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0494a2fb632691aa4a9c8f25c920e13779e28181"}, "originalPosition": 9}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d9a0381de00f036618a4fa99415792599c249b39", "author": {"user": {"login": "benwtrent", "name": "Benjamin Trent"}}, "url": "https://github.com/elastic/elasticsearch/commit/d9a0381de00f036618a4fa99415792599c249b39", "committedDate": "2020-08-25T11:31:56Z", "message": "Update x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/action/TransportStartDataFrameAnalyticsAction.java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3d83b48893757f6168e6355dd4424ae7c94130db", "author": {"user": {"login": "benwtrent", "name": "Benjamin Trent"}}, "url": "https://github.com/elastic/elasticsearch/commit/3d83b48893757f6168e6355dd4424ae7c94130db", "committedDate": "2020-08-25T11:32:01Z", "message": "Update x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/ml/job/messages/Messages.java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "683b777410dce8469018f189b6161faef021bfd2", "author": {"user": {"login": "benwtrent", "name": "Benjamin Trent"}}, "url": "https://github.com/elastic/elasticsearch/commit/683b777410dce8469018f189b6161faef021bfd2", "committedDate": "2020-08-25T13:09:12Z", "message": "fixing integration test"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc0NTE1NTkx", "url": "https://github.com/elastic/elasticsearch/pull/61505#pullrequestreview-474515591", "createdAt": "2020-08-25T14:05:26Z", "commit": {"oid": "683b777410dce8469018f189b6161faef021bfd2"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4699, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}