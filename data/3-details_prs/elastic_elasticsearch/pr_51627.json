{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY4NjQzNzI5", "number": 51627, "title": "[Transform] HLRC tests: dump audit index to logs for better debugging", "bodyText": "The audit index is re-created for every testrun and therefore potential useful debug information gets\nlost. This change reads out the audit index and logs the results, which makes them available for\ndebugging CI issues.\nrelates #51549\nNotes: I tried to only dump the audit index on a failure(e.g. using a TestWatcher), however that's not possible as the code always runs after the audit index has been deleted. Creating this extra logs does not seem too heavy, therefore it dumps the audit index for every test now.", "createdAt": "2020-01-29T16:14:50Z", "url": "https://github.com/elastic/elasticsearch/pull/51627", "merged": true, "mergeCommit": {"oid": "5d0d36266574c923bf9f486ea368e667683cfe8e"}, "closed": true, "closedAt": "2020-01-30T09:08:56Z", "author": {"login": "hendrikmuhs"}, "timelineItems": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb_ILI_AH2gAyMzY4NjQzNzI5OmI5MzA5NGEzMDQ0NDQ5OGNhODgyMjg3YWQ0YTRmYzczOTY2OTAyN2E=", "endCursor": "Y3Vyc29yOnYyOpPPAAABb_JFTpAFqTM1MDI3MDg0OQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "b93094a30444498ca882287ad4a4fc739669027a", "author": {"user": {"login": "hendrikmuhs", "name": "Hendrik Muhs"}}, "url": "https://github.com/elastic/elasticsearch/commit/b93094a30444498ca882287ad4a4fc739669027a", "committedDate": "2020-01-29T16:03:34Z", "message": "dump audit index to logs for better debugging"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUwMjcwODQ5", "url": "https://github.com/elastic/elasticsearch/pull/51627#pullrequestreview-350270849", "createdAt": "2020-01-29T17:00:53Z", "commit": {"oid": "b93094a30444498ca882287ad4a4fc739669027a"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOVQxNzowMDo1NFrOFjQL5A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOVQxNzowMDo1NFrOFjQL5A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjUwOTY2OA==", "bodyText": "The same can be achieved with new searchRequest.indicesOptions(IndicesOptions.LENIENT_EXPAND_OPEN)", "url": "https://github.com/elastic/elasticsearch/pull/51627#discussion_r372509668", "createdAt": "2020-01-29T17:00:54Z", "author": {"login": "davidkyle"}, "path": "client/rest-high-level/src/test/java/org/elasticsearch/client/TransformIT.java", "diffHunk": "@@ -144,19 +151,36 @@ private void indexData(String indexName) throws IOException {\n     }\n \n     @After\n-    public void cleanUpTransforms() throws Exception {\n+    public void cleanUpTransformsAndLogAudits() throws Exception {\n         for (String transformId : transformsToClean) {\n-            highLevelClient().transform().stopTransform(\n-                    new StopTransformRequest(transformId, Boolean.TRUE, null, false), RequestOptions.DEFAULT);\n+            highLevelClient().transform()\n+                .stopTransform(new StopTransformRequest(transformId, Boolean.TRUE, null, false), RequestOptions.DEFAULT);\n         }\n \n         for (String transformId : transformsToClean) {\n-            highLevelClient().transform().deleteTransform(\n-                    new DeleteTransformRequest(transformId), RequestOptions.DEFAULT);\n+            highLevelClient().transform().deleteTransform(new DeleteTransformRequest(transformId), RequestOptions.DEFAULT);\n         }\n \n         transformsToClean = new ArrayList<>();\n         waitForPendingTasks(adminClient());\n+\n+        // using '*' to make this lenient and do not fail if the audit index does not exist", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b93094a30444498ca882287ad4a4fc739669027a"}, "originalPosition": 73}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3047, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}