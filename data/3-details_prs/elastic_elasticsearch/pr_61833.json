{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDc3NjQ2ODAw", "number": 61833, "title": "Expand max chain depth testing", "bodyText": "This commit extends the coverage around max chain depth in runtime fields. We test that direct references are not counted, that 5 references are allowed while 6 are not, and we test that the same error is returned no matter where the runtime field is used.", "createdAt": "2020-09-02T08:04:44Z", "url": "https://github.com/elastic/elasticsearch/pull/61833", "merged": true, "mergeCommit": {"oid": "8ffa4d99d705268df3af38b9efbc07bd05d08e05"}, "closed": true, "closedAt": "2020-09-02T12:58:04Z", "author": {"login": "javanna"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdE3RbkgH2gAyNDc3NjQ2ODAwOjRlYzE4MWFjMmRiMTgyNTA3YmIzOTE0ZmNkNTJmY2Q5ODdlZDg5ZjI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdE7jOCAFqTQ4MDc4OTQ5Mg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "4ec181ac2db182507bb3914fcd52fcd987ed89f2", "author": {"user": {"login": "javanna", "name": "Luca Cavanna"}}, "url": "https://github.com/elastic/elasticsearch/commit/4ec181ac2db182507bb3914fcd52fcd987ed89f2", "committedDate": "2020-09-02T07:56:45Z", "message": "Expand max chain depth testing\n\nThis commit extends the coverage around max chain depth in runtime fields. We test that direct references are not counted, that 5 references are allowed while 6 are not, and we test that the same error is returned no matter where the runtime field is used."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgwNTc5MjUy", "url": "https://github.com/elastic/elasticsearch/pull/61833#pullrequestreview-480579252", "createdAt": "2020-09-02T08:05:28Z", "commit": {"oid": "4ec181ac2db182507bb3914fcd52fcd987ed89f2"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMlQwODowNToyOFrOHLijMg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMlQwODowNToyOFrOHLijMg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTg2MjQ1MA==", "bodyText": "I am aware that splitting tests like this will cause more setup / tear down, yet I think it makes the tests less descriptive and targeted each one at their own specific goal.", "url": "https://github.com/elastic/elasticsearch/pull/61833#discussion_r481862450", "createdAt": "2020-09-02T08:05:28Z", "author": {"login": "javanna"}, "path": "x-pack/plugin/src/test/resources/rest-api-spec/test/runtime_fields/90_loops.yml", "diffHunk": "@@ -77,6 +116,16 @@ setup:\n              terms:\n                field: loose_loop\n \n+---\n+\"loose loop - sort\":\n+  - do:\n+      catch: '/Cyclic dependency detected while resolving runtime fields: loose_loop -> lla -> llb -> llc -> loose_loop/'\n+      search:\n+        index: sensor\n+        body:\n+          sort: loose_loop\n+---\n+\"loose loop - docvalue_fields\":", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4ec181ac2db182507bb3914fcd52fcd987ed89f2"}, "originalPosition": 84}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgwNTc5NjMy", "url": "https://github.com/elastic/elasticsearch/pull/61833#pullrequestreview-480579632", "createdAt": "2020-09-02T08:06:00Z", "commit": {"oid": "4ec181ac2db182507bb3914fcd52fcd987ed89f2"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMlQwODowNjowMFrOHLilCg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMlQwODowNjowMFrOHLilCg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTg2MjkyMg==", "bodyText": "Note that there are no tests for queries, on purpose. They need to be fixed :)", "url": "https://github.com/elastic/elasticsearch/pull/61833#discussion_r481862922", "createdAt": "2020-09-02T08:06:00Z", "author": {"login": "javanna"}, "path": "x-pack/plugin/src/test/resources/rest-api-spec/test/runtime_fields/90_loops.yml", "diffHunk": "@@ -96,10 +147,56 @@ setup:\n              terms:\n                field: lla\n \n+---\n+\"Max chain depth - 5 is allowed\":\n+  - do:\n+      search:\n+        index: sensor\n+        body:\n+          sort: timestamp\n+          docvalue_fields: [over_max_depth_1]\n+\n+  - match: {hits.total.value: 1}\n+  - match: {hits.hits.0.fields.over_max_depth_1.0: test}\n+\n+---\n+\"Max chain depth - direct references are not counted\":\n   - do:\n-      catch: '/Cyclic dependency detected while resolving runtime fields: lla -> llb -> llc -> loose_loop -> lla/'\n       search:\n         index: sensor\n         body:\n           sort: timestamp\n-          docvalue_fields: [lla]\n+          docvalue_fields: [refs]\n+\n+  - match: {hits.total.value: 1}\n+  - match: {hits.hits.0.fields.refs.0: testtesttesttesta}\n+\n+---\n+\"Max chain depth - aggs\":\n+  - do:\n+      catch: '/Field requires resolving too many dependent fields: over_max_depth -> over_max_depth_1 -> over_max_depth_2 -> over_max_depth_3 -> over_max_depth_4 -> over_max_depth_5/'\n+      search:\n+        index: sensor\n+        body:\n+          sort: timestamp\n+          aggs:\n+            loop:\n+             terms:\n+               field: over_max_depth\n+---\n+\"Max chain depth - sort\":\n+  - do:\n+      catch: '/Field requires resolving too many dependent fields: over_max_depth -> over_max_depth_1 -> over_max_depth_2 -> over_max_depth_3 -> over_max_depth_4 -> over_max_depth_5/'\n+      search:\n+        index: sensor\n+        body:\n+          sort: over_max_depth\n+---\n+\"Max chain depth - docvalue_fields\":\n+  - do:\n+      catch: '/Field requires resolving too many dependent fields: over_max_depth -> over_max_depth_1 -> over_max_depth_2 -> over_max_depth_3 -> over_max_depth_4 -> over_max_depth_5/'\n+      search:\n+        index: sensor\n+        body:\n+          sort: timestamp\n+          docvalue_fields: [over_max_depth]", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4ec181ac2db182507bb3914fcd52fcd987ed89f2"}, "originalPosition": 155}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgwNzg5NDky", "url": "https://github.com/elastic/elasticsearch/pull/61833#pullrequestreview-480789492", "createdAt": "2020-09-02T12:55:48Z", "commit": {"oid": "4ec181ac2db182507bb3914fcd52fcd987ed89f2"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4985, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}