{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ5MzMzMDkz", "number": 59591, "title": "[Transform] add support for missing bucket", "bodyText": "add support for \"missing_bucket\" in group_by\nfixes #42941\nfixes #55102", "createdAt": "2020-07-15T08:36:56Z", "url": "https://github.com/elastic/elasticsearch/pull/59591", "merged": true, "mergeCommit": {"oid": "004388f0f0387a9a988d29459937f3b03e5c46db"}, "closed": true, "closedAt": "2020-07-29T12:00:19Z", "author": {"login": "hendrikmuhs"}, "timelineItems": {"totalCount": 16, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc3sq-mgFqTQ1Mzk5MjUzOA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABc5mprggBqjM1OTc4NzUwMzQ=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUzOTkyNTM4", "url": "https://github.com/elastic/elasticsearch/pull/59591#pullrequestreview-453992538", "createdAt": "2020-07-23T10:04:06Z", "commit": {"oid": "fc3d3f9920409666e8b4d28b679c7788726c1c07"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yM1QxMDowNDowNlrOG2EDbg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yM1QxMDowNDowNlrOG2EDbg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTM0MjcwMg==", "bodyText": "Is this enforced anywhere in the config parsing?\nAnd do the randomTransformConfig methods in the tests enforce this?  I guess if they choose completely random field names for each section of the config then it's highly unlikely the time field in the sync config would randomly be the same as the time field for the date histogram.  So maybe this problem can be ignored.", "url": "https://github.com/elastic/elasticsearch/pull/59591#discussion_r459342702", "createdAt": "2020-07-23T10:04:06Z", "author": {"login": "droberts195"}, "path": "x-pack/plugin/transform/src/main/java/org/elasticsearch/xpack/transform/transforms/pivot/CompositeBucketsChangeCollector.java", "diffHunk": "@@ -175,7 +227,10 @@ public boolean collectChanges(Collection<? extends Bucket> buckets) {\n \n         @Override\n         public QueryBuilder filterByChanges(long lastCheckpointTimestamp, long nextcheckpointTimestamp) {\n+\n             if (isSynchronizationField && lastCheckpointTimestamp > 0) {\n+                // missing bucket can't be enabled as it would be an illegal combination", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fc3d3f9920409666e8b4d28b679c7788726c1c07"}, "originalPosition": 125}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU2NTY2MzI3", "url": "https://github.com/elastic/elasticsearch/pull/59591#pullrequestreview-456566327", "createdAt": "2020-07-28T12:08:10Z", "commit": {"oid": "2d71db41306a660215b4fec9e661ac648c7d84d8"}, "state": "APPROVED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOFQxMjowODoxMFrOG4JgXA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOFQxMjowOToxNlrOG4JijA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTUyOTE4MA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                                        + \"this transform might run slow, please check your configuration.\",\n          \n          \n            \n                                        + \"this transform might run slowly, please check your configuration.\",", "url": "https://github.com/elastic/elasticsearch/pull/59591#discussion_r461529180", "createdAt": "2020-07-28T12:08:10Z", "author": {"login": "benwtrent"}, "path": "x-pack/plugin/transform/src/main/java/org/elasticsearch/xpack/transform/transforms/TransformIndexer.java", "diffHunk": "@@ -347,6 +347,21 @@ protected void initializeFunction() {\n \n         if (isContinuous()) {\n             changeCollector = function.buildChangeCollector(getConfig().getSyncConfig().getField());\n+\n+            if (changeCollector.isOptimized() == false) {\n+                logger.warn(\n+                    new ParameterizedMessage(\n+                        \"[{}] could not find any optimizations for continuous execution, \"\n+                            + \"this transform might run slow, please check your configuration.\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2d71db41306a660215b4fec9e661ac648c7d84d8"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTUyOTMwNw==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                                    + \"this transform might run slow, please check your configuration.\"\n          \n          \n            \n                                    + \"this transform might run slowly, please check your configuration.\"", "url": "https://github.com/elastic/elasticsearch/pull/59591#discussion_r461529307", "createdAt": "2020-07-28T12:08:22Z", "author": {"login": "benwtrent"}, "path": "x-pack/plugin/transform/src/main/java/org/elasticsearch/xpack/transform/transforms/TransformIndexer.java", "diffHunk": "@@ -347,6 +347,21 @@ protected void initializeFunction() {\n \n         if (isContinuous()) {\n             changeCollector = function.buildChangeCollector(getConfig().getSyncConfig().getField());\n+\n+            if (changeCollector.isOptimized() == false) {\n+                logger.warn(\n+                    new ParameterizedMessage(\n+                        \"[{}] could not find any optimizations for continuous execution, \"\n+                            + \"this transform might run slow, please check your configuration.\",\n+                        getJobId()\n+                    )\n+                );\n+                auditor.warning(\n+                    getJobId(),\n+                    \"could not find any optimizations for continuous execution, \"\n+                        + \"this transform might run slow, please check your configuration.\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2d71db41306a660215b4fec9e661ac648c7d84d8"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTUyOTc0MA==", "bodyText": "It would be nice to say which pivot values are causing the the optimization to be false. Each collector could respond with a reason.", "url": "https://github.com/elastic/elasticsearch/pull/59591#discussion_r461529740", "createdAt": "2020-07-28T12:09:16Z", "author": {"login": "benwtrent"}, "path": "x-pack/plugin/transform/src/main/java/org/elasticsearch/xpack/transform/transforms/TransformIndexer.java", "diffHunk": "@@ -347,6 +347,21 @@ protected void initializeFunction() {\n \n         if (isContinuous()) {\n             changeCollector = function.buildChangeCollector(getConfig().getSyncConfig().getField());\n+\n+            if (changeCollector.isOptimized() == false) {\n+                logger.warn(\n+                    new ParameterizedMessage(\n+                        \"[{}] could not find any optimizations for continuous execution, \"\n+                            + \"this transform might run slow, please check your configuration.\",\n+                        getJobId()\n+                    )\n+                );\n+                auditor.warning(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2d71db41306a660215b4fec9e661ac648c7d84d8"}, "originalPosition": 13}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU2NTc0MzQ2", "url": "https://github.com/elastic/elasticsearch/pull/59591#pullrequestreview-456574346", "createdAt": "2020-07-28T12:20:02Z", "commit": {"oid": "2d71db41306a660215b4fec9e661ac648c7d84d8"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "224728b4529d9b2224f393c11ead8c9d4a813af9", "author": {"user": {"login": "hendrikmuhs", "name": "Hendrik Muhs"}}, "url": "https://github.com/elastic/elasticsearch/commit/224728b4529d9b2224f393c11ead8c9d4a813af9", "committedDate": "2020-07-29T08:20:47Z", "message": "add parser support for missing bucket"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "76d91ebf9a2981bb691c83a46a36e464bb04b10d", "author": {"user": {"login": "hendrikmuhs", "name": "Hendrik Muhs"}}, "url": "https://github.com/elastic/elasticsearch/commit/76d91ebf9a2981bb691c83a46a36e464bb04b10d", "committedDate": "2020-07-29T08:20:47Z", "message": "checkstyle"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f5f87c9af11e7907d29d315f0ebfb6967018c9ca", "author": {"user": {"login": "hendrikmuhs", "name": "Hendrik Muhs"}}, "url": "https://github.com/elastic/elasticsearch/commit/f5f87c9af11e7907d29d315f0ebfb6967018c9ca", "committedDate": "2020-07-29T08:20:47Z", "message": "fix tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "23e9f1ed997b2e89189752651c8b99f949ac36dd", "author": {"user": {"login": "hendrikmuhs", "name": "Hendrik Muhs"}}, "url": "https://github.com/elastic/elasticsearch/commit/23e9f1ed997b2e89189752651c8b99f949ac36dd", "committedDate": "2020-07-29T08:20:47Z", "message": "add a test for missing_bucket + progress"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "12b6728f6b00348972c19c09bf608c8e15351623", "author": {"user": {"login": "hendrikmuhs", "name": "Hendrik Muhs"}}, "url": "https://github.com/elastic/elasticsearch/commit/12b6728f6b00348972c19c09bf608c8e15351623", "committedDate": "2020-07-29T08:20:47Z", "message": "rename variable"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a06e41383da475d14e430b718ca5ef0cd5339d4d", "author": {"user": {"login": "hendrikmuhs", "name": "Hendrik Muhs"}}, "url": "https://github.com/elastic/elasticsearch/commit/a06e41383da475d14e430b718ca5ef0cd5339d4d", "committedDate": "2020-07-29T08:20:47Z", "message": "test explicit value in continuous transform test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "eda805b0820ef109b12456ad566aa8bfab76156c", "author": {"user": {"login": "hendrikmuhs", "name": "Hendrik Muhs"}}, "url": "https://github.com/elastic/elasticsearch/commit/eda805b0820ef109b12456ad566aa8bfab76156c", "committedDate": "2020-07-29T08:20:47Z", "message": "expand tests for missing bucket"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "67489cd6fd56113e0030957646dae0e2871d20fe", "author": {"user": {"login": "hendrikmuhs", "name": "Hendrik Muhs"}}, "url": "https://github.com/elastic/elasticsearch/commit/67489cd6fd56113e0030957646dae0e2871d20fe", "committedDate": "2020-07-29T08:20:47Z", "message": "re-factor createReviewsIndex"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7a4b5315a89888014f0ac5ee044fe3aee9fbfb57", "author": {"user": {"login": "hendrikmuhs", "name": "Hendrik Muhs"}}, "url": "https://github.com/elastic/elasticsearch/commit/7a4b5315a89888014f0ac5ee044fe3aee9fbfb57", "committedDate": "2020-07-29T08:21:20Z", "message": "add a performance warning if transform in continuous mode could not be optimized"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a3475127fb4ef6af66a85b0ff3948927b8d38514", "author": {"user": {"login": "hendrikmuhs", "name": "Hendrik Muhs"}}, "url": "https://github.com/elastic/elasticsearch/commit/a3475127fb4ef6af66a85b0ff3948927b8d38514", "committedDate": "2020-07-29T08:21:20Z", "message": "checkstyle"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "95c7ac2322438e0f5dc22fe3396b44d95b97f2ac", "author": {"user": {"login": "hendrikmuhs", "name": "Hendrik Muhs"}}, "url": "https://github.com/elastic/elasticsearch/commit/95c7ac2322438e0f5dc22fe3396b44d95b97f2ac", "committedDate": "2020-07-29T08:21:20Z", "message": "Update x-pack/plugin/transform/src/main/java/org/elasticsearch/xpack/transform/transforms/TransformIndexer.java\n\nCo-authored-by: Benjamin Trent <ben.w.trent@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c288bb72bfab33dde149717da435b3c05ba75c01", "author": {"user": {"login": "hendrikmuhs", "name": "Hendrik Muhs"}}, "url": "https://github.com/elastic/elasticsearch/commit/c288bb72bfab33dde149717da435b3c05ba75c01", "committedDate": "2020-07-29T08:21:20Z", "message": "Update x-pack/plugin/transform/src/main/java/org/elasticsearch/xpack/transform/transforms/TransformIndexer.java\n\nCo-authored-by: Benjamin Trent <ben.w.trent@gmail.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "fff28d5cb4a775e26fd4e2186f4f10a7502a52a7", "author": {"user": {"login": "hendrikmuhs", "name": "Hendrik Muhs"}}, "url": "https://github.com/elastic/elasticsearch/commit/fff28d5cb4a775e26fd4e2186f4f10a7502a52a7", "committedDate": "2020-07-28T12:38:58Z", "message": "Update x-pack/plugin/transform/src/main/java/org/elasticsearch/xpack/transform/transforms/TransformIndexer.java\n\nCo-authored-by: Benjamin Trent <ben.w.trent@gmail.com>"}, "afterCommit": {"oid": "c288bb72bfab33dde149717da435b3c05ba75c01", "author": {"user": {"login": "hendrikmuhs", "name": "Hendrik Muhs"}}, "url": "https://github.com/elastic/elasticsearch/commit/c288bb72bfab33dde149717da435b3c05ba75c01", "committedDate": "2020-07-29T08:21:20Z", "message": "Update x-pack/plugin/transform/src/main/java/org/elasticsearch/xpack/transform/transforms/TransformIndexer.java\n\nCo-authored-by: Benjamin Trent <ben.w.trent@gmail.com>"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4367, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}