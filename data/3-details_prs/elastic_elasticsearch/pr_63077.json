{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDk1NTE0OTQ1", "number": 63077, "title": "Remove dependency of Geometry queries with mapped type names", "bodyText": "Currently GeoShape/Shape queries relies on the field type name to determine if the query can be executed. In addition, the query processing capabilities are buried inside the abstract class AbstractGeometryFieldType, therefore for a field to be able to support those kind of queries, it needs to extend that class.\nThis is problematic for run time fields as they don't need to (and cannot) extend the class, so it makes impossible to create a run time field that generates geo / cartesian data to use standard queries.\nThis PR is an attempt to remove that dependency. It extract the query capabilities from AbstractGeometryFieldType into two new interfaces, GeoshapeQueryable and ShapeQueryable. Those interfaces are implemented by the final mappers.", "createdAt": "2020-09-30T13:35:37Z", "url": "https://github.com/elastic/elasticsearch/pull/63077", "merged": true, "mergeCommit": {"oid": "31a77869f11538874bf15da3134d1a5658249cc6"}, "closed": true, "closedAt": "2020-10-01T07:27:57Z", "author": {"login": "iverase"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdN8tooAH2gAyNDk1NTE0OTQ1OmYwZjRkZWU5NTlmYzg2MGJiMWEyZDNiZjYwZTNhOWJjNDFjZWI5Y2Q=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdOLO-KgH2gAyNDk1NTE0OTQ1OjRiYzA1NDVhZDViMjBkYzQyZDI4YjM3MTAzOWMyZmJiOTM4ZWRiZDI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "f0f4dee959fc860bb1a2d3bf60e3a9bc41ceb9cd", "author": {"user": {"login": "iverase", "name": "Ignacio Vera"}}, "url": "https://github.com/elastic/elasticsearch/commit/f0f4dee959fc860bb1a2d3bf60e3a9bc41ceb9cd", "committedDate": "2020-09-30T13:22:24Z", "message": "Remove dependency of Geometry queries with mapped types"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk5NDk4MDAz", "url": "https://github.com/elastic/elasticsearch/pull/63077#pullrequestreview-499498003", "createdAt": "2020-09-30T14:33:12Z", "commit": {"oid": "f0f4dee959fc860bb1a2d3bf60e3a9bc41ceb9cd"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk5NTAzODI1", "url": "https://github.com/elastic/elasticsearch/pull/63077#pullrequestreview-499503825", "createdAt": "2020-09-30T14:38:50Z", "commit": {"oid": "f0f4dee959fc860bb1a2d3bf60e3a9bc41ceb9cd"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0zMFQxNDozODo1MFrOHag3qg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0zMFQxNDo0MTo0NVrOHahBBg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzU2MzU2Mg==", "bodyText": "Do we need this double indirection, or would it make more sense to collapse QueryProcessor into GeoShapeQueryable directly?", "url": "https://github.com/elastic/elasticsearch/pull/63077#discussion_r497563562", "createdAt": "2020-09-30T14:38:50Z", "author": {"login": "romseygeek"}, "path": "server/src/main/java/org/elasticsearch/index/mapper/GeoShapeQueryable.java", "diffHunk": "@@ -0,0 +1,49 @@\n+/*\n+ * Licensed to Elasticsearch under one or more contributor\n+ * license agreements. See the NOTICE file distributed with\n+ * this work for additional information regarding copyright\n+ * ownership. Elasticsearch licenses this file to you under\n+ * the Apache License, Version 2.0 (the \"License\"); you may\n+ * not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.elasticsearch.index.mapper;\n+\n+import org.apache.lucene.search.Query;\n+import org.elasticsearch.common.geo.ShapeRelation;\n+import org.elasticsearch.common.geo.SpatialStrategy;\n+import org.elasticsearch.geometry.Geometry;\n+import org.elasticsearch.index.query.QueryShardContext;\n+\n+/**\n+ * Implemented by {@link org.elasticsearch.index.mapper.MappedFieldType} that support\n+ * GeoShape queries.\n+ */\n+public interface GeoShapeQueryable {\n+\n+    QueryProcessor geometryQueryBuilder();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f0f4dee959fc860bb1a2d3bf60e3a9bc41ceb9cd"}, "originalPosition": 34}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzU2NTk1OA==", "bodyText": "And maybe call this shapeQuery rather than process, to match up with termQuery etc on other field types?", "url": "https://github.com/elastic/elasticsearch/pull/63077#discussion_r497565958", "createdAt": "2020-09-30T14:41:45Z", "author": {"login": "romseygeek"}, "path": "server/src/main/java/org/elasticsearch/index/mapper/GeoShapeQueryable.java", "diffHunk": "@@ -0,0 +1,49 @@\n+/*\n+ * Licensed to Elasticsearch under one or more contributor\n+ * license agreements. See the NOTICE file distributed with\n+ * this work for additional information regarding copyright\n+ * ownership. Elasticsearch licenses this file to you under\n+ * the Apache License, Version 2.0 (the \"License\"); you may\n+ * not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.elasticsearch.index.mapper;\n+\n+import org.apache.lucene.search.Query;\n+import org.elasticsearch.common.geo.ShapeRelation;\n+import org.elasticsearch.common.geo.SpatialStrategy;\n+import org.elasticsearch.geometry.Geometry;\n+import org.elasticsearch.index.query.QueryShardContext;\n+\n+/**\n+ * Implemented by {@link org.elasticsearch.index.mapper.MappedFieldType} that support\n+ * GeoShape queries.\n+ */\n+public interface GeoShapeQueryable {\n+\n+    QueryProcessor geometryQueryBuilder();\n+\n+    /**\n+     * interface representing a query builder that generates a query from the given geometry\n+     */\n+    interface QueryProcessor {\n+        Query process(Geometry shape, String fieldName, ShapeRelation relation, QueryShardContext context);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f0f4dee959fc860bb1a2d3bf60e3a9bc41ceb9cd"}, "originalPosition": 40}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk5NjgwNjg4", "url": "https://github.com/elastic/elasticsearch/pull/63077#pullrequestreview-499680688", "createdAt": "2020-09-30T17:57:32Z", "commit": {"oid": "f0f4dee959fc860bb1a2d3bf60e3a9bc41ceb9cd"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4bc0545ad5b20dc42d28b371039c2fbb938edbd2", "author": {"user": {"login": "iverase", "name": "Ignacio Vera"}}, "url": "https://github.com/elastic/elasticsearch/commit/4bc0545ad5b20dc42d28b371039c2fbb938edbd2", "committedDate": "2020-10-01T06:17:29Z", "message": "remove indirection"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4565, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}