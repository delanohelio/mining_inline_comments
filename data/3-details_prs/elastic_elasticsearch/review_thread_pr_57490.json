{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDI2MjI4NzA5", "number": 57490, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMVQyMjozMTo0NVrOEBiO9w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMVQyMjozMTo0NVrOEBiO9w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcwMDQ0OTE5OnYy", "diffSide": "RIGHT", "path": "modules/parent-join/src/main/java/org/elasticsearch/join/aggregations/ParentJoinAggregator.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMVQyMjozMTo0NVrOGdcODQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMVQyMjozMTo0NVrOGdcODQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzUyNDIzNw==", "bodyText": "needs updating?", "url": "https://github.com/elastic/elasticsearch/pull/57490#discussion_r433524237", "createdAt": "2020-06-01T22:31:45Z", "author": {"login": "talevy"}, "path": "modules/parent-join/src/main/java/org/elasticsearch/join/aggregations/ParentJoinAggregator.java", "diffHunk": "@@ -165,6 +150,81 @@ public int docID() {\n \n     @Override\n     protected void doClose() {\n-        Releasables.close(ordsBit, ordsHash);\n+        Releasables.close(collectionStrategy);\n+    }\n+\n+    /**\n+     * Strategy for collecting the global ordinals of the join field in for all\n+     * docs that match the {@code ParentJoinAggregator#inFilter} and then\n+     * checking if which of the docs in the\n+     * {@code ParentJoinAggregator#outFilter} also have the ordinal.\n+     */\n+    protected interface CollectionStrategy extends Releasable {\n+        void addGlobalOrdinal(int globalOrdinal);\n+        boolean existsGlobalOrdinal(int globalOrdinal);\n+    }\n+\n+    /**\n+     * Uses a dense, bit per ordinal representation of the join field in the\n+     * docs that match {@code ParentJoinAggregator#inFilter}. Its memory usage\n+     * is proportional to the maximum ordinal so it is only a good choice if\n+     * most docs match.\n+     */\n+    protected class DenseCollectionStrategy implements CollectionStrategy {\n+        /**\n+         * Otherwise we use a dense bit array to record the global ordinals.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b795df644d1d4bf93b38df01ee7c650afb9ed8e4"}, "originalPosition": 100}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3712, "cost": 1, "resetAt": "2021-11-12T13:16:51Z"}}}