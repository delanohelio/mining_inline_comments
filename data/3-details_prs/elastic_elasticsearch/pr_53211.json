{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg0NjE1MjMw", "number": 53211, "title": "Resolve real (indexed) SPs from IdentityProvider", "bodyText": "This change hooks the SamlIdentityProvider class up to the\nSamlServiceProviderResolver so that we return real registered\nservice providers during SSO handling", "createdAt": "2020-03-06T03:27:09Z", "url": "https://github.com/elastic/elasticsearch/pull/53211", "merged": true, "mergeCommit": {"oid": "1874fc6fd3d9a78d976553464d4867e1daa7cd93"}, "closed": true, "closedAt": "2020-03-09T13:06:49Z", "author": {"login": "tvernum"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcK3d8ygH2gAyMzg0NjE1MjMwOjliYjZkY2Q2YjIxMTczNGMzYmRhNWI3YmU4MTI2OGI5NWZkNjI0YzM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcL7r-kgH2gAyMzg0NjE1MjMwOjg5YWY5ZTM0NjA1MTM3NDIzNzI0NDEwNGNmMWUwYTk4MjI5MmZmYWY=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "9bb6dcd6b211734c3bda5b7be81268b95fd624c3", "author": {"user": {"login": "tvernum", "name": "Tim Vernum"}}, "url": "https://github.com/elastic/elasticsearch/commit/9bb6dcd6b211734c3bda5b7be81268b95fd624c3", "committedDate": "2020-03-06T03:22:49Z", "message": "Resolve real (indexed) SPs from IdentityProvider\n\nThis change hooks the SamlIdentityProvider class up to the\nSamlServiceProviderResolver so that we return real registered\nservice providers during SSO handling"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7a35fb91250ce4be498c155e9046ffd09d994ccb", "author": {"user": {"login": "tvernum", "name": "Tim Vernum"}}, "url": "https://github.com/elastic/elasticsearch/commit/7a35fb91250ce4be498c155e9046ffd09d994ccb", "committedDate": "2020-03-06T03:28:48Z", "message": "Fix variable name"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcwODA4OTQ4", "url": "https://github.com/elastic/elasticsearch/pull/53211#pullrequestreview-370808948", "createdAt": "2020-03-08T07:02:46Z", "commit": {"oid": "7a35fb91250ce4be498c155e9046ffd09d994ccb"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wOFQwNzowMjo0NlrOFzTiSg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wOFQwNzowODoxMlrOFzTjXw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTM0MTc3MA==", "bodyText": "is this TODO about possibly exposing sp defaults in IDP settings?", "url": "https://github.com/elastic/elasticsearch/pull/53211#discussion_r389341770", "createdAt": "2020-03-08T07:02:46Z", "author": {"login": "jkakavas"}, "path": "x-pack/plugin/identity-provider/src/main/java/org/elasticsearch/xpack/idp/IdentityProviderPlugin.java", "diffHunk": "@@ -80,12 +84,22 @@\n         }\n \n         SamlInit.initialize();\n-        final SamlIdentityProvider idp = SamlIdentityProvider.builder().fromSettings(environment).build();\n         final SamlServiceProviderIndex index = new SamlServiceProviderIndex(client, clusterService);\n+\n+        // TODO", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7a35fb91250ce4be498c155e9046ffd09d994ccb"}, "originalPosition": 36}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTM0MjA0Nw==", "bodyText": "Do we need a name ?", "url": "https://github.com/elastic/elasticsearch/pull/53211#discussion_r389342047", "createdAt": "2020-03-08T07:08:12Z", "author": {"login": "jkakavas"}, "path": "x-pack/plugin/identity-provider/src/main/java/org/elasticsearch/xpack/idp/saml/sp/CloudServiceProvider.java", "diffHunk": "@@ -27,13 +29,16 @@\n     private final boolean signAuthnRequests;\n     private final boolean signLogoutRequests;\n \n-    public CloudServiceProvider(String entityId, URL assertionConsumerService, Set<String> allowedNameIdFormats,\n-                                ReadableDuration authnExpiry, ServiceProviderPrivileges privileges, AttributeNames attributeNames,\n+    public CloudServiceProvider(String entityId, String name, boolean enabled, URL assertionConsumerService,\n+                                Set<String> allowedNameIdFormats, ReadableDuration authnExpiry,\n+                                ServiceProviderPrivileges privileges, AttributeNames attributeNames,\n                                 Set<X509Credential> spSigningCredentials, boolean signAuthnRequests, boolean signLogoutRequests) {\n         if (Strings.isNullOrEmpty(entityId)) {\n             throw new IllegalArgumentException(\"Service Provider Entity ID cannot be null or empty\");\n         }\n         this.entityId = entityId;\n+        this.name = name;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7a35fb91250ce4be498c155e9046ffd09d994ccb"}, "originalPosition": 23}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcwOTI4OTAx", "url": "https://github.com/elastic/elasticsearch/pull/53211#pullrequestreview-370928901", "createdAt": "2020-03-09T05:52:10Z", "commit": {"oid": "7a35fb91250ce4be498c155e9046ffd09d994ccb"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wOVQwNTo1MjoxMVrOFzbjqg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wOVQwNTo1MjoxMVrOFzbjqg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTQ3MzE5NA==", "bodyText": "However, I think this one is old, and shouldn't be here.", "url": "https://github.com/elastic/elasticsearch/pull/53211#discussion_r389473194", "createdAt": "2020-03-09T05:52:11Z", "author": {"login": "tvernum"}, "path": "x-pack/plugin/identity-provider/src/main/java/org/elasticsearch/xpack/idp/saml/idp/SamlIdentityProviderBuilder.java", "diffHunk": "@@ -70,17 +71,22 @@\n         Setting.Property.NodeScope);\n     public static final Setting<String> IDP_CONTACT_EMAIL = Setting.simpleString(\"xpack.idp.contact.email\", Setting.Property.NodeScope);\n \n+    private final SamlServiceProviderResolver serviceProviderResolver;\n+\n     private String entityId;\n     private Map<String, URL> ssoEndpoints;\n     private Map<String, URL> sloEndpoints;\n     private X509Credential signingCredential;\n     private X509Credential metadataSigningCredential;\n     private SamlIdentityProvider.ContactInfo technicalContact;\n     private SamlIdentityProvider.OrganizationInfo organization;\n+    private SamlIdentityProvider.ServiceProviderDefaults serviceProviderDefaults;\n \n-    SamlIdentityProviderBuilder() {\n+    SamlIdentityProviderBuilder(SamlServiceProviderResolver serviceProviderResolver) {\n+        this.serviceProviderResolver = serviceProviderResolver;\n         this.ssoEndpoints = new HashMap<>();\n         this.sloEndpoints = new HashMap<>();\n+        // TODO", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7a35fb91250ce4be498c155e9046ffd09d994ccb"}, "originalPosition": 28}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "86d69d0ca6dbbcbeb51b36cf1c1ed7c3bd0e3f1c", "author": {"user": {"login": "tvernum", "name": "Tim Vernum"}}, "url": "https://github.com/elastic/elasticsearch/commit/86d69d0ca6dbbcbeb51b36cf1c1ed7c3bd0e3f1c", "committedDate": "2020-03-09T06:10:36Z", "message": "Minor fixes: TODO and validation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8b9ed15a00825319de9374bfac84cd24974800a9", "author": {"user": {"login": "tvernum", "name": "Tim Vernum"}}, "url": "https://github.com/elastic/elasticsearch/commit/8b9ed15a00825319de9374bfac84cd24974800a9", "committedDate": "2020-03-09T06:14:23Z", "message": "Merge branch 'feature-internal-idp' into idp/real-sp\n\n# Conflicts:\n#\tx-pack/plugin/identity-provider/src/main/java/org/elasticsearch/xpack/idp/saml/idp/SamlIdentityProvider.java\n#\tx-pack/plugin/identity-provider/src/main/java/org/elasticsearch/xpack/idp/saml/sp/SamlServiceProviderResolver.java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "89af9e346051374237244104cf1e0a982292ffaf", "author": {"user": {"login": "elasticmachine", "name": "Elastic Machine"}}, "url": "https://github.com/elastic/elasticsearch/commit/89af9e346051374237244104cf1e0a982292ffaf", "committedDate": "2020-03-09T10:51:41Z", "message": "Merge branch 'feature-internal-idp' into idp/real-sp"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1827, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}