{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTQyMDk3MjY2", "number": 66559, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yM1QxMTo0MDoxN1rOFIjLyg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yM1QxMTo0MDoxN1rOFIjLyg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQ0NTA5Mzg2OnYy", "diffSide": "RIGHT", "path": "test/framework/src/main/java/org/elasticsearch/test/rest/ESRestTestCase.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yM1QxMTo0MDoxN1rOIKiL-A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yM1QxNToyOTozOFrOIKoGNA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzkxNjc5Mg==", "bodyText": "Do we need to cater for the use case of mulitple certificates from the single PEM file?", "url": "https://github.com/elastic/elasticsearch/pull/66559#discussion_r547916792", "createdAt": "2020-12-23T11:40:17Z", "author": {"login": "ywangd"}, "path": "test/framework/src/main/java/org/elasticsearch/test/rest/ESRestTestCase.java", "diffHunk": "@@ -1020,7 +1034,24 @@ protected static void configureClient(RestClientBuilder builder, Settings settin\n                 SSLContext sslcontext = SSLContexts.custom().loadTrustMaterial(keyStore, null).build();\n                 SSLIOSessionStrategy sessionStrategy = new SSLIOSessionStrategy(sslcontext);\n                 builder.setHttpClientConfigCallback(httpClientBuilder -> httpClientBuilder.setSSLStrategy(sessionStrategy));\n-            } catch (KeyStoreException |NoSuchAlgorithmException |KeyManagementException |CertificateException e) {\n+            } catch (KeyStoreException | NoSuchAlgorithmException | KeyManagementException | CertificateException e) {\n+                throw new RuntimeException(\"Error setting up ssl\", e);\n+            }\n+        }\n+        if (certificateAuthorities != null) {\n+            Path path = PathUtils.get(certificateAuthorities);\n+            if (!Files.exists(path)) {\n+                throw new IllegalStateException(CERTIFICATE_AUTHORITIES + \" is set but points to a non-existing file\");\n+            }\n+            try {\n+                KeyStore keyStore = KeyStore.getInstance(KeyStore.getDefaultType());\n+                keyStore.load(null, null);\n+                Certificate cert = PemUtils.readCertificates(List.of(path)).get(0);\n+                keyStore.setCertificateEntry(cert.toString(), cert);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7cd032642eeab1d5b92acaf407112a74af0100c2"}, "originalPosition": 62}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODAxMzYyMA==", "bodyText": "There's no use right now, we can tackle this in a follow up if the need arises", "url": "https://github.com/elastic/elasticsearch/pull/66559#discussion_r548013620", "createdAt": "2020-12-23T15:29:38Z", "author": {"login": "jkakavas"}, "path": "test/framework/src/main/java/org/elasticsearch/test/rest/ESRestTestCase.java", "diffHunk": "@@ -1020,7 +1034,24 @@ protected static void configureClient(RestClientBuilder builder, Settings settin\n                 SSLContext sslcontext = SSLContexts.custom().loadTrustMaterial(keyStore, null).build();\n                 SSLIOSessionStrategy sessionStrategy = new SSLIOSessionStrategy(sslcontext);\n                 builder.setHttpClientConfigCallback(httpClientBuilder -> httpClientBuilder.setSSLStrategy(sessionStrategy));\n-            } catch (KeyStoreException |NoSuchAlgorithmException |KeyManagementException |CertificateException e) {\n+            } catch (KeyStoreException | NoSuchAlgorithmException | KeyManagementException | CertificateException e) {\n+                throw new RuntimeException(\"Error setting up ssl\", e);\n+            }\n+        }\n+        if (certificateAuthorities != null) {\n+            Path path = PathUtils.get(certificateAuthorities);\n+            if (!Files.exists(path)) {\n+                throw new IllegalStateException(CERTIFICATE_AUTHORITIES + \" is set but points to a non-existing file\");\n+            }\n+            try {\n+                KeyStore keyStore = KeyStore.getInstance(KeyStore.getDefaultType());\n+                keyStore.load(null, null);\n+                Certificate cert = PemUtils.readCertificates(List.of(path)).get(0);\n+                keyStore.setCertificateEntry(cert.toString(), cert);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzkxNjc5Mg=="}, "originalCommit": {"oid": "7cd032642eeab1d5b92acaf407112a74af0100c2"}, "originalPosition": 62}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4448, "cost": 1, "resetAt": "2021-11-12T19:05:54Z"}}}