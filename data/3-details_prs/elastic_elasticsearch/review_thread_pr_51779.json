{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY5Nzk1Nzc3", "number": 51779, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0zMVQyMjozMjoxOFrODcYBPQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0zMVQyMjozMjoxOFrODcYBPQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMxMDgwMjUzOnYy", "diffSide": "RIGHT", "path": "server/src/main/java/org/elasticsearch/common/logging/LoggingOutputStream.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0zMVQyMjozMjoxOFrOFkZuzg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wMVQwMDoxOTowMlrOFkbLTA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzcxNDYzOA==", "bodyText": "Wouldn't this throw a ArrayIndexOutOfBounds exception for instances where we attempt to write a line which is simply a single \\n character? I think we need to add a bounds check here.", "url": "https://github.com/elastic/elasticsearch/pull/51779#discussion_r373714638", "createdAt": "2020-01-31T22:32:18Z", "author": {"login": "mark-vieira"}, "path": "server/src/main/java/org/elasticsearch/common/logging/LoggingOutputStream.java", "diffHunk": "@@ -91,7 +91,12 @@ public void write(int b) throws IOException {\n     public void flush() {\n         Buffer buffer = threadLocal.get();\n         if (buffer.used == 0) return;\n-        log(new String(buffer.bytes, 0, buffer.used, StandardCharsets.UTF_8));\n+        int used = buffer.used;\n+        if (buffer.bytes[used - 1] == '\\r') {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1f7f01696cf93540cd7079db8c9ce02d9f7cc134"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzcxNTQzOQ==", "bodyText": "used - 1 is the last character of the buffer, and we know the buffer size is at least 1 because of the check on line 93.", "url": "https://github.com/elastic/elasticsearch/pull/51779#discussion_r373715439", "createdAt": "2020-01-31T22:35:11Z", "author": {"login": "rjernst"}, "path": "server/src/main/java/org/elasticsearch/common/logging/LoggingOutputStream.java", "diffHunk": "@@ -91,7 +91,12 @@ public void write(int b) throws IOException {\n     public void flush() {\n         Buffer buffer = threadLocal.get();\n         if (buffer.used == 0) return;\n-        log(new String(buffer.bytes, 0, buffer.used, StandardCharsets.UTF_8));\n+        int used = buffer.used;\n+        if (buffer.bytes[used - 1] == '\\r') {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzcxNDYzOA=="}, "originalCommit": {"oid": "1f7f01696cf93540cd7079db8c9ce02d9f7cc134"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzczODMxNg==", "bodyText": "I see what's happening now. I misunderstood the \\n character itself to be part of this buffer but it's not. Nevermind.", "url": "https://github.com/elastic/elasticsearch/pull/51779#discussion_r373738316", "createdAt": "2020-02-01T00:19:02Z", "author": {"login": "mark-vieira"}, "path": "server/src/main/java/org/elasticsearch/common/logging/LoggingOutputStream.java", "diffHunk": "@@ -91,7 +91,12 @@ public void write(int b) throws IOException {\n     public void flush() {\n         Buffer buffer = threadLocal.get();\n         if (buffer.used == 0) return;\n-        log(new String(buffer.bytes, 0, buffer.used, StandardCharsets.UTF_8));\n+        int used = buffer.used;\n+        if (buffer.bytes[used - 1] == '\\r') {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzcxNDYzOA=="}, "originalCommit": {"oid": "1f7f01696cf93540cd7079db8c9ce02d9f7cc134"}, "originalPosition": 6}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 30, "cost": 1, "resetAt": "2021-11-12T11:57:46Z"}}}