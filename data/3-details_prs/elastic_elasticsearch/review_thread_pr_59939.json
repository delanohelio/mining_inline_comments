{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDUzOTQwMTM5", "number": 59939, "reviewThreads": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQxNDowMjoxNVrOEQo1pQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQyMDo0NjowMVrOEQyiJQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg1ODgxNzY1OnYy", "diffSide": "RIGHT", "path": "buildSrc/src/main/java/org/elasticsearch/gradle/test/rest/AbstractRestTestPlugin.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQxNDowMjoxNVrOG05fHA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQyMDo0NDoyNVrOG1JEpg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODEyMDk4OA==", "bodyText": "this was pulled from YamlRestTestPlugin so it can be reused with JavaRestTestPlugin. There are no substantive changes introduced here ... just copy/pasted.", "url": "https://github.com/elastic/elasticsearch/pull/59939#discussion_r458120988", "createdAt": "2020-07-21T14:02:15Z", "author": {"login": "jakelandis"}, "path": "buildSrc/src/main/java/org/elasticsearch/gradle/test/rest/AbstractRestTestPlugin.java", "diffHunk": "@@ -0,0 +1,104 @@\n+/*\n+ * Licensed to Elasticsearch under one or more contributor\n+ * license agreements. See the NOTICE file distributed with\n+ * this work for additional information regarding copyright\n+ * ownership. Elasticsearch licenses this file to you under\n+ * the Apache License, Version 2.0 (the \"License\"); you may\n+ * not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.elasticsearch.gradle.test.rest;\n+\n+import org.elasticsearch.gradle.VersionProperties;\n+import org.elasticsearch.gradle.info.BuildParams;\n+import org.elasticsearch.gradle.plugin.PluginPropertiesExtension;\n+import org.elasticsearch.gradle.test.RestIntegTestTask;\n+import org.elasticsearch.gradle.testclusters.RestTestRunnerTask;\n+import org.gradle.api.Plugin;\n+import org.gradle.api.Project;\n+import org.gradle.api.plugins.JavaBasePlugin;\n+import org.gradle.api.tasks.SourceSet;\n+import org.gradle.api.tasks.bundling.Zip;\n+\n+/**\n+ * Helper parent to configure the necessary tasks and dependencies.\n+ */\n+public abstract class AbstractRestTestPlugin implements Plugin<Project> {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "319d6fac4b71d76dccd37fa44e73f0176f7aa70f"}, "originalPosition": 36}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODM3NjM1OA==", "bodyText": "All these methods can be static and therefore live in a utility class rather than an abstract class that must be extended.", "url": "https://github.com/elastic/elasticsearch/pull/59939#discussion_r458376358", "createdAt": "2020-07-21T20:44:25Z", "author": {"login": "mark-vieira"}, "path": "buildSrc/src/main/java/org/elasticsearch/gradle/test/rest/AbstractRestTestPlugin.java", "diffHunk": "@@ -0,0 +1,104 @@\n+/*\n+ * Licensed to Elasticsearch under one or more contributor\n+ * license agreements. See the NOTICE file distributed with\n+ * this work for additional information regarding copyright\n+ * ownership. Elasticsearch licenses this file to you under\n+ * the Apache License, Version 2.0 (the \"License\"); you may\n+ * not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.elasticsearch.gradle.test.rest;\n+\n+import org.elasticsearch.gradle.VersionProperties;\n+import org.elasticsearch.gradle.info.BuildParams;\n+import org.elasticsearch.gradle.plugin.PluginPropertiesExtension;\n+import org.elasticsearch.gradle.test.RestIntegTestTask;\n+import org.elasticsearch.gradle.testclusters.RestTestRunnerTask;\n+import org.gradle.api.Plugin;\n+import org.gradle.api.Project;\n+import org.gradle.api.plugins.JavaBasePlugin;\n+import org.gradle.api.tasks.SourceSet;\n+import org.gradle.api.tasks.bundling.Zip;\n+\n+/**\n+ * Helper parent to configure the necessary tasks and dependencies.\n+ */\n+public abstract class AbstractRestTestPlugin implements Plugin<Project> {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODEyMDk4OA=="}, "originalCommit": {"oid": "319d6fac4b71d76dccd37fa44e73f0176f7aa70f"}, "originalPosition": 36}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg1OTk4ODI1OnYy", "diffSide": "RIGHT", "path": "buildSrc/src/main/groovy/org/elasticsearch/gradle/plugin/PluginBuildPlugin.groovy", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQxODozOTozN1rOG1FBgw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQxOTowNzo1MVrOG1F-8Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODMxMDAxOQ==", "bodyText": "nit: space after if\nHowever, should the integTest task be disabled through onlyIf? There is no guarantee the plugins checked for here will be applied before esplugin.", "url": "https://github.com/elastic/elasticsearch/pull/59939#discussion_r458310019", "createdAt": "2020-07-21T18:39:37Z", "author": {"login": "rjernst"}, "path": "buildSrc/src/main/groovy/org/elasticsearch/gradle/plugin/PluginBuildPlugin.groovy", "diffHunk": "@@ -115,6 +115,11 @@ class PluginBuildPlugin implements Plugin<Project> {\n             if (isModule == false || isXPackModule) {\n                 addNoticeGeneration(project, extension1)\n             }\n+            if(project.pluginManager.hasPlugin(\"elasticsearch.yaml-rest-test\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "319d6fac4b71d76dccd37fa44e73f0176f7aa70f"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODMyNTc0NQ==", "bodyText": "fixed nit.\n\nThere is no guarantee the plugins checked for here will be applied before esplugin.\n\nThis is part of an project.afterEvaluate block, so I think it is guaranteed to be applied.", "url": "https://github.com/elastic/elasticsearch/pull/59939#discussion_r458325745", "createdAt": "2020-07-21T19:07:51Z", "author": {"login": "jakelandis"}, "path": "buildSrc/src/main/groovy/org/elasticsearch/gradle/plugin/PluginBuildPlugin.groovy", "diffHunk": "@@ -115,6 +115,11 @@ class PluginBuildPlugin implements Plugin<Project> {\n             if (isModule == false || isXPackModule) {\n                 addNoticeGeneration(project, extension1)\n             }\n+            if(project.pluginManager.hasPlugin(\"elasticsearch.yaml-rest-test\")", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODMxMDAxOQ=="}, "originalCommit": {"oid": "319d6fac4b71d76dccd37fa44e73f0176f7aa70f"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg2MDAxMTQ4OnYy", "diffSide": "RIGHT", "path": "modules/transport-netty4/build.gradle", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQxODo0NjoyNVrOG1FQVg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQxOTowODo0OFrOG1GAzA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODMxMzgxNA==", "bodyText": "Dont' we still need this system property for test?", "url": "https://github.com/elastic/elasticsearch/pull/59939#discussion_r458313814", "createdAt": "2020-07-21T18:46:25Z", "author": {"login": "rjernst"}, "path": "modules/transport-netty4/build.gradle", "diffHunk": "@@ -55,15 +59,15 @@ tasks.named(\"dependencyLicenses\").configure {\n   mapping from: /netty-.*/, to: 'netty'\n }\n \n-test {\n+internalClusterTest {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "319d6fac4b71d76dccd37fa44e73f0176f7aa70f"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODMyNjIyMA==", "bodyText": "indeed. d5e4572 thanks!", "url": "https://github.com/elastic/elasticsearch/pull/59939#discussion_r458326220", "createdAt": "2020-07-21T19:08:48Z", "author": {"login": "jakelandis"}, "path": "modules/transport-netty4/build.gradle", "diffHunk": "@@ -55,15 +59,15 @@ tasks.named(\"dependencyLicenses\").configure {\n   mapping from: /netty-.*/, to: 'netty'\n }\n \n-test {\n+internalClusterTest {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODMxMzgxNA=="}, "originalCommit": {"oid": "319d6fac4b71d76dccd37fa44e73f0176f7aa70f"}, "originalPosition": 18}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg2MDM5NDk4OnYy", "diffSide": "RIGHT", "path": "buildSrc/src/main/groovy/org/elasticsearch/gradle/plugin/PluginBuildPlugin.groovy", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQyMDo0MjoyMlrOG1JAsg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQyMDo0MjoyMlrOG1JAsg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODM3NTM0Ng==", "bodyText": "Let's not use afterEvaluate + hasPlugin. This is subject to configuration ordering. Let's instead move this outside of afterEvaluate and just use withPlugin to disable that integTest task whenever either of these plugins is applied.", "url": "https://github.com/elastic/elasticsearch/pull/59939#discussion_r458375346", "createdAt": "2020-07-21T20:42:22Z", "author": {"login": "mark-vieira"}, "path": "buildSrc/src/main/groovy/org/elasticsearch/gradle/plugin/PluginBuildPlugin.groovy", "diffHunk": "@@ -115,6 +115,11 @@ class PluginBuildPlugin implements Plugin<Project> {\n             if (isModule == false || isXPackModule) {\n                 addNoticeGeneration(project, extension1)\n             }\n+            if (project.pluginManager.hasPlugin(\"elasticsearch.yaml-rest-test\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d5e45728ec18fa707685582cc0db065d45591f59"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg2MDQwNjEzOnYy", "diffSide": "RIGHT", "path": "buildSrc/src/main/groovy/org/elasticsearch/gradle/plugin/PluginBuildPlugin.groovy", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQyMDo0NjowMVrOG1JH8Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQyMDo1Mzo1MFrOG1JXlw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODM3NzIwMQ==", "bodyText": "So this doesn't actually remove this task, we simply disable it in a central location to remove noise from build scripts. What's keeping us from actually getting rid of this altogether?", "url": "https://github.com/elastic/elasticsearch/pull/59939#discussion_r458377201", "createdAt": "2020-07-21T20:46:01Z", "author": {"login": "mark-vieira"}, "path": "buildSrc/src/main/groovy/org/elasticsearch/gradle/plugin/PluginBuildPlugin.groovy", "diffHunk": "@@ -115,6 +115,11 @@ class PluginBuildPlugin implements Plugin<Project> {\n             if (isModule == false || isXPackModule) {\n                 addNoticeGeneration(project, extension1)\n             }\n+            if (project.pluginManager.hasPlugin(\"elasticsearch.yaml-rest-test\")\n+                || project.pluginManager.hasPlugin(\"elasticsearch.java-rest-test\")) {\n+                //disable integTest task if project has been converted to use yaml or java rest test plugin\n+                project.tasks.integTest.enabled = false", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d5e45728ec18fa707685582cc0db065d45591f59"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODM4MTIwNw==", "bodyText": "So this doesn't actually remove this task, we simply disable it in a central location to remove noise from build scripts.\n\ncorrect.\n\nWhat's keeping us from actually getting rid of this altogether?\n\nThis PR only covers modules.  I am in the process of converting all of the projects to this pattern. Once that is done, I can (and will) remove integTest from here.", "url": "https://github.com/elastic/elasticsearch/pull/59939#discussion_r458381207", "createdAt": "2020-07-21T20:53:50Z", "author": {"login": "jakelandis"}, "path": "buildSrc/src/main/groovy/org/elasticsearch/gradle/plugin/PluginBuildPlugin.groovy", "diffHunk": "@@ -115,6 +115,11 @@ class PluginBuildPlugin implements Plugin<Project> {\n             if (isModule == false || isXPackModule) {\n                 addNoticeGeneration(project, extension1)\n             }\n+            if (project.pluginManager.hasPlugin(\"elasticsearch.yaml-rest-test\")\n+                || project.pluginManager.hasPlugin(\"elasticsearch.java-rest-test\")) {\n+                //disable integTest task if project has been converted to use yaml or java rest test plugin\n+                project.tasks.integTest.enabled = false", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODM3NzIwMQ=="}, "originalCommit": {"oid": "d5e45728ec18fa707685582cc0db065d45591f59"}, "originalPosition": 7}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2174, "cost": 1, "resetAt": "2021-11-12T11:57:46Z"}}}