{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDExODIzNzU0", "number": 56060, "title": "[Geo] Refactor Point Field Mappers", "bodyText": "This PR refactors the following:\n\nGeoPointFieldMapper and PointFieldMapper to AbstractPointGeometryFieldMapper derived from AbstractGeometryFieldMapper.\n.setupFieldType moved up to AbstractGeometryFieldMapper\nlucene indexing moved up to AbstractGeometryFieldMapper.parse\nnew addStoredFields, addDocValuesFields abstract methods for implementing stored field and doc values field indexing in the concrete field mappers\n\nThis refactor is the next phase for setting up a framework for extending spatial field mapper functionality in x-pack.", "createdAt": "2020-04-30T20:39:30Z", "url": "https://github.com/elastic/elasticsearch/pull/56060", "merged": true, "mergeCommit": {"oid": "a01d2bd24b0e849af034b88b563897a692a87bd8"}, "closed": true, "closedAt": "2020-05-11T18:14:17Z", "author": {"login": "nknize"}, "timelineItems": {"totalCount": 14, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcfVKlTAH2gAyNDExODIzNzU0OmUwYmU5MGZiMjQxM2E3NDQzYTkzNmI1NWU1MzUxYzJhM2FiNjZhZDA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcgSO7FgH2gAyNDExODIzNzU0OjYxNjBiODNkOWIzNWU3N2YwMDZiZDgyMGEzZTUxN2M3MGZiZmFlM2I=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "e0be90fb2413a7443a936b55e5351c2a3ab66ad0", "author": {"user": {"login": "nknize", "name": "Nick Knize"}}, "url": "https://github.com/elastic/elasticsearch/commit/e0be90fb2413a7443a936b55e5351c2a3ab66ad0", "committedDate": "2020-05-08T17:17:18Z", "message": "[Geo] Refactor Point Field Mappers\n\nThis commit refactors the following:\n  * GeoPointFieldMapper and PointFieldMapper to\n    AbstractPointGeometryFieldMapper derived from AbstractGeometryFieldMapper.\n  * .setupFieldType moved up to AbstractGeometryFieldMapper\n  * lucene indexing moved up to AbstractGeometryFieldMapper.parse\n  * new addStoredFields, addDocValuesFields abstract methods for implementing\n    stored field and doc values field indexing in the concrete field mappers\n\nThis refactor is the next phase for setting up a framework for extending\nspatial field mapper functionality in x-pack."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5d46c24181d63fae8bc4c410333639d7e79709f4", "author": {"user": {"login": "nknize", "name": "Nick Knize"}}, "url": "https://github.com/elastic/elasticsearch/commit/5d46c24181d63fae8bc4c410333639d7e79709f4", "committedDate": "2020-05-08T17:17:18Z", "message": "refactor PointParser to return an array of points; fix GeoPointFieldMapperTests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f21b212cf9fbbb1af04c4a990142c2ca748eaf1b", "author": {"user": {"login": "nknize", "name": "Nick Knize"}}, "url": "https://github.com/elastic/elasticsearch/commit/f21b212cf9fbbb1af04c4a990142c2ca748eaf1b", "committedDate": "2020-05-08T17:17:18Z", "message": "add hashCode to ParsedGeoPoint"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "002268d067e210318bdb836eb17caddf50396fe1", "author": {"user": {"login": "nknize", "name": "Nick Knize"}}, "url": "https://github.com/elastic/elasticsearch/commit/002268d067e210318bdb836eb17caddf50396fe1", "committedDate": "2020-05-08T17:17:18Z", "message": "fix line length"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4ed83e198b934270431c469d478423f9a176eafd", "author": {"user": {"login": "nknize", "name": "Nick Knize"}}, "url": "https://github.com/elastic/elasticsearch/commit/4ed83e198b934270431c469d478423f9a176eafd", "committedDate": "2020-05-08T17:17:18Z", "message": "fix CartesianPoint parsing and PointFieldMapper"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9d79a1d98c75001a934f4c6a3a85e1378efe0517", "author": {"user": {"login": "nknize", "name": "Nick Knize"}}, "url": "https://github.com/elastic/elasticsearch/commit/9d79a1d98c75001a934f4c6a3a85e1378efe0517", "committedDate": "2020-05-08T17:17:19Z", "message": "suppress unchecked cast"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e61cc6b55b75e937880382d49a25aa56863d32f6", "author": {"user": {"login": "nknize", "name": "Nick Knize"}}, "url": "https://github.com/elastic/elasticsearch/commit/e61cc6b55b75e937880382d49a25aa56863d32f6", "committedDate": "2020-05-08T17:17:19Z", "message": "fix failing tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d19380e7e72fa19daeaf4d34aaa91a5398ba58b5", "author": {"user": {"login": "nknize", "name": "Nick Knize"}}, "url": "https://github.com/elastic/elasticsearch/commit/d19380e7e72fa19daeaf4d34aaa91a5398ba58b5", "committedDate": "2020-05-08T17:17:19Z", "message": "fix parsePointIgnoringMalformed logic"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b8d7b5be774c9e7fcb7c26c7ab4914bee1375eb1", "author": {"user": {"login": "nknize", "name": "Nick Knize"}}, "url": "https://github.com/elastic/elasticsearch/commit/b8d7b5be774c9e7fcb7c26c7ab4914bee1375eb1", "committedDate": "2020-05-08T17:17:19Z", "message": "fix forbidden field access"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "357b7f11ba617a0811c29e8cb1979c4b49bec536", "author": {"user": {"login": "nknize", "name": "Nick Knize"}}, "url": "https://github.com/elastic/elasticsearch/commit/357b7f11ba617a0811c29e8cb1979c4b49bec536", "committedDate": "2020-05-08T16:08:38Z", "message": "fix forbidden field access"}, "afterCommit": {"oid": "b8d7b5be774c9e7fcb7c26c7ab4914bee1375eb1", "author": {"user": {"login": "nknize", "name": "Nick Knize"}}, "url": "https://github.com/elastic/elasticsearch/commit/b8d7b5be774c9e7fcb7c26c7ab4914bee1375eb1", "committedDate": "2020-05-08T17:17:19Z", "message": "fix forbidden field access"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA5MTI0NTg1", "url": "https://github.com/elastic/elasticsearch/pull/56060#pullrequestreview-409124585", "createdAt": "2020-05-11T12:28:19Z", "commit": {"oid": "b8d7b5be774c9e7fcb7c26c7ab4914bee1375eb1"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMVQxMjoyODoyMFrOGTaERA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMVQxMjoyODoyMFrOGTaERA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzAwMzIwNA==", "bodyText": "nit:\ns/geo-shape/geometry", "url": "https://github.com/elastic/elasticsearch/pull/56060#discussion_r423003204", "createdAt": "2020-05-11T12:28:20Z", "author": {"login": "iverase"}, "path": "server/src/main/java/org/elasticsearch/index/mapper/AbstractGeometryFieldMapper.java", "diffHunk": "@@ -54,7 +60,23 @@\n         public static final Explicit<Boolean> IGNORE_Z_VALUE = new Explicit<>(true, false);\n     }\n \n-    public abstract static class Builder<T extends Builder, Y extends AbstractGeometryFieldMapper>\n+    /**\n+     * Interface representing an preprocessor in geo-shape indexing pipeline\n+     */", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b8d7b5be774c9e7fcb7c26c7ab4914bee1375eb1"}, "originalPosition": 43}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA5MTI0ODQ0", "url": "https://github.com/elastic/elasticsearch/pull/56060#pullrequestreview-409124844", "createdAt": "2020-05-11T12:28:41Z", "commit": {"oid": "b8d7b5be774c9e7fcb7c26c7ab4914bee1375eb1"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMVQxMjoyODo0MVrOGTaFCw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMVQxMjoyODo0MVrOGTaFCw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzAwMzQwMw==", "bodyText": "nit:\ns/geo-shape/geometry", "url": "https://github.com/elastic/elasticsearch/pull/56060#discussion_r423003403", "createdAt": "2020-05-11T12:28:41Z", "author": {"login": "iverase"}, "path": "server/src/main/java/org/elasticsearch/index/mapper/AbstractGeometryFieldMapper.java", "diffHunk": "@@ -54,7 +60,23 @@\n         public static final Explicit<Boolean> IGNORE_Z_VALUE = new Explicit<>(true, false);\n     }\n \n-    public abstract static class Builder<T extends Builder, Y extends AbstractGeometryFieldMapper>\n+    /**\n+     * Interface representing an preprocessor in geo-shape indexing pipeline\n+     */\n+    public interface Indexer<Parsed, Processed> {\n+        Processed prepareForIndexing(Parsed geometry);\n+        Class<Processed> processedClass();\n+        List<IndexableField> indexShape(ParseContext context, Processed shape);\n+    }\n+\n+    /**\n+     * interface representing parser in geo shape indexing pipeline\n+     */", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b8d7b5be774c9e7fcb7c26c7ab4914bee1375eb1"}, "originalPosition": 52}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA5MTI1OTM3", "url": "https://github.com/elastic/elasticsearch/pull/56060#pullrequestreview-409125937", "createdAt": "2020-05-11T12:30:15Z", "commit": {"oid": "b8d7b5be774c9e7fcb7c26c7ab4914bee1375eb1"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMVQxMjozMDoxNVrOGTaIXQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMVQxMjozMDoxNVrOGTaIXQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzAwNDI1Mw==", "bodyText": "nit: javadoc is too generic? maybe:\n/** Base class for for spatial fields that only support indexing points */", "url": "https://github.com/elastic/elasticsearch/pull/56060#discussion_r423004253", "createdAt": "2020-05-11T12:30:15Z", "author": {"login": "iverase"}, "path": "server/src/main/java/org/elasticsearch/index/mapper/AbstractPointGeometryFieldMapper.java", "diffHunk": "@@ -0,0 +1,262 @@\n+/*\n+ * Licensed to Elasticsearch under one or more contributor\n+ * license agreements. See the NOTICE file distributed with\n+ * this work for additional information regarding copyright\n+ * ownership. Elasticsearch licenses this file to you under\n+ * the Apache License, Version 2.0 (the \"License\"); you may\n+ * not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+package org.elasticsearch.index.mapper;\n+\n+import org.elasticsearch.ElasticsearchParseException;\n+import org.elasticsearch.common.Explicit;\n+import org.elasticsearch.common.ParseField;\n+import org.elasticsearch.common.geo.GeoPoint;\n+import org.elasticsearch.common.geo.GeometryFormat;\n+import org.elasticsearch.common.settings.Settings;\n+import org.elasticsearch.common.xcontent.LoggingDeprecationHandler;\n+import org.elasticsearch.common.xcontent.XContentBuilder;\n+import org.elasticsearch.common.xcontent.XContentParser;\n+\n+import java.io.IOException;\n+import java.text.ParseException;\n+import java.util.ArrayList;\n+import java.util.Iterator;\n+import java.util.List;\n+import java.util.Map;\n+\n+/** Base class for GeoPointFieldMappers */\n+import static org.elasticsearch.index.mapper.TypeParsers.parseField;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b8d7b5be774c9e7fcb7c26c7ab4914bee1375eb1"}, "originalPosition": 39}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6160b83d9b35e77f006bd820a3e517c70fbfae3b", "author": {"user": {"login": "nknize", "name": "Nick Knize"}}, "url": "https://github.com/elastic/elasticsearch/commit/6160b83d9b35e77f006bd820a3e517c70fbfae3b", "committedDate": "2020-05-11T16:26:15Z", "message": "feedback from PR"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 177, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}