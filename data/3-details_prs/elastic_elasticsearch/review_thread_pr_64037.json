{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTA4MTA4Mjk2", "number": 64037, "reviewThreads": {"totalCount": 15, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNFQwNjozODo1MlrOE1FruA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQwNDowMDo1MlrOE63byw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI0MTAzMDk2OnYy", "diffSide": "RIGHT", "path": "docs/reference/commands/certutil.asciidoc", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNFQwNjozODo1MlrOHtKv3w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNlQxMTozMjo1NVrOHz4KKA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzEyNDA2Mw==", "bodyText": "I have a concern, which might not be a big deal, that some people will see this option and use it in places where they shouldn't.\nFor all TLS scenarios, we recommend having a separation between the CA and the node cert, and I think we want to keep recommending that.\nSo, are there words we can put here that discourage people from using it for TLS?", "url": "https://github.com/elastic/elasticsearch/pull/64037#discussion_r517124063", "createdAt": "2020-11-04T06:38:52Z", "author": {"login": "tvernum"}, "path": "docs/reference/commands/certutil.asciidoc", "diffHunk": "@@ -211,6 +217,9 @@ wish to password-protect your PEM keys, then do not specify\n `--pem`:: Generates certificates and keys in PEM format instead of PKCS#12. This\n parameter cannot be used with the `csr` parameter.\n \n+`--self-signed`:: Generates self-signed certificates. This parameter is only\n+applicable to the `cert` parameter.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "efa9232965eca9e4e10d5d65806d576d6a8b3c2d"}, "originalPosition": 27}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDE1OTUyOA==", "bodyText": "I added a note to state this option should be used with care.", "url": "https://github.com/elastic/elasticsearch/pull/64037#discussion_r524159528", "createdAt": "2020-11-16T11:32:55Z", "author": {"login": "ywangd"}, "path": "docs/reference/commands/certutil.asciidoc", "diffHunk": "@@ -211,6 +217,9 @@ wish to password-protect your PEM keys, then do not specify\n `--pem`:: Generates certificates and keys in PEM format instead of PKCS#12. This\n parameter cannot be used with the `csr` parameter.\n \n+`--self-signed`:: Generates self-signed certificates. This parameter is only\n+applicable to the `cert` parameter.", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzEyNDA2Mw=="}, "originalCommit": {"oid": "efa9232965eca9e4e10d5d65806d576d6a8b3c2d"}, "originalPosition": 27}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI0MTAzMjQ4OnYy", "diffSide": "RIGHT", "path": "x-pack/docs/en/security/authentication/saml-guide.asciidoc", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNFQwNjozOTozM1rOHtKwqw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNlQxMTozMzoxOFrOHz4Lqw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzEyNDI2Nw==", "bodyText": "I don't think this should change. It is a signing certificate, it just happens to also be self-signed.", "url": "https://github.com/elastic/elasticsearch/pull/64037#discussion_r517124267", "createdAt": "2020-11-04T06:39:33Z", "author": {"login": "tvernum"}, "path": "x-pack/docs/en/security/authentication/saml-guide.asciidoc", "diffHunk": "@@ -505,11 +505,11 @@ support. Since PEM format is the most commonly supported format, the examples\n below will generate certificates in that format.\n \n Using the <<certutil,`elasticsearch-certutil` tool>>, you can generate a\n-signing certificate with the following command:\n+self-signed certificate with the following command:", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "efa9232965eca9e4e10d5d65806d576d6a8b3c2d"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDE1OTkxNQ==", "bodyText": "You are right. Ioannis said the same. It's reverted. Thanks.", "url": "https://github.com/elastic/elasticsearch/pull/64037#discussion_r524159915", "createdAt": "2020-11-16T11:33:18Z", "author": {"login": "ywangd"}, "path": "x-pack/docs/en/security/authentication/saml-guide.asciidoc", "diffHunk": "@@ -505,11 +505,11 @@ support. Since PEM format is the most commonly supported format, the examples\n below will generate certificates in that format.\n \n Using the <<certutil,`elasticsearch-certutil` tool>>, you can generate a\n-signing certificate with the following command:\n+self-signed certificate with the following command:", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzEyNDI2Nw=="}, "originalCommit": {"oid": "efa9232965eca9e4e10d5d65806d576d6a8b3c2d"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI0MTAzNDY0OnYy", "diffSide": "RIGHT", "path": "x-pack/plugin/security/cli/src/main/java/org/elasticsearch/xpack/security/cli/CertificateTool.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNFQwNjo0MDoyMlrOHtKx0A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNlQxMTozMzo1N1rOHz4OkA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzEyNDU2MA==", "bodyText": "This isn't strictly true anymore. Do we care?", "url": "https://github.com/elastic/elasticsearch/pull/64037#discussion_r517124560", "createdAt": "2020-11-04T06:40:22Z", "author": {"login": "tvernum"}, "path": "x-pack/plugin/security/cli/src/main/java/org/elasticsearch/xpack/security/cli/CertificateTool.java", "diffHunk": "@@ -167,8 +167,9 @@ public static void main(String[] args) throws Exception {\n \n     static final String CA_EXPLANATION =\n         \"    * All certificates generated by this tool will be signed by a certificate authority (CA).\\n\" +", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "efa9232965eca9e4e10d5d65806d576d6a8b3c2d"}, "originalPosition": 3}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDE2MDY1Ng==", "bodyText": "Ioannis has kindly offered suggestion and it should be accurate now.", "url": "https://github.com/elastic/elasticsearch/pull/64037#discussion_r524160656", "createdAt": "2020-11-16T11:33:57Z", "author": {"login": "ywangd"}, "path": "x-pack/plugin/security/cli/src/main/java/org/elasticsearch/xpack/security/cli/CertificateTool.java", "diffHunk": "@@ -167,8 +167,9 @@ public static void main(String[] args) throws Exception {\n \n     static final String CA_EXPLANATION =\n         \"    * All certificates generated by this tool will be signed by a certificate authority (CA).\\n\" +", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzEyNDU2MA=="}, "originalCommit": {"oid": "efa9232965eca9e4e10d5d65806d576d6a8b3c2d"}, "originalPosition": 3}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI3ODM0NDA1OnYy", "diffSide": "RIGHT", "path": "docs/reference/commands/certutil.asciidoc", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xM1QxMjozMDowOFrOHyshiQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xM1QxMjozMDowOFrOHyshiQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjkyMDMyOQ==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            You can also generate self-signed certificates with the `--self-signed` parameters.\n          \n          \n            \n            You can also generate self-signed certificates with the `--self-signed` parameter.", "url": "https://github.com/elastic/elasticsearch/pull/64037#discussion_r522920329", "createdAt": "2020-11-13T12:30:08Z", "author": {"login": "jkakavas"}, "path": "docs/reference/commands/certutil.asciidoc", "diffHunk": "@@ -82,6 +82,12 @@ All certificates that are generated by this command are signed by a CA. You can\n provide your own CA with the `--ca` or `--ca-cert` parameters. Otherwise, the\n command automatically generates a new CA for you. For more information about\n generating a CA, see the <<certutil-ca,CA mode of this command>>.\n+You can also generate self-signed certificates with the `--self-signed` parameters.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3558a2c98a22de37459b2c5b158bb1397abb00fd"}, "originalPosition": 13}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI3OTAwNTIxOnYy", "diffSide": "RIGHT", "path": "docs/reference/commands/certutil.asciidoc", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xM1QxNToyODowNFrOHyyzvQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xM1QxNToyODowNFrOHyyzvQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzAyMzI5Mw==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            Generating certificates without specifying a CA certificate is deprecated.\n          \n          \n            \n            Generating certificates without specifying a CA certificate and key is deprecated.", "url": "https://github.com/elastic/elasticsearch/pull/64037#discussion_r523023293", "createdAt": "2020-11-13T15:28:04Z", "author": {"login": "jkakavas"}, "path": "docs/reference/commands/certutil.asciidoc", "diffHunk": "@@ -82,6 +82,12 @@ All certificates that are generated by this command are signed by a CA. You can\n provide your own CA with the `--ca` or `--ca-cert` parameters. Otherwise, the\n command automatically generates a new CA for you. For more information about\n generating a CA, see the <<certutil-ca,CA mode of this command>>.\n+You can also generate self-signed certificates with the `--self-signed` parameters.\n+\n+deprecated:[7.11.0]\n+Generating certificates without specifying a CA certificate is deprecated.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3558a2c98a22de37459b2c5b158bb1397abb00fd"}, "originalPosition": 16}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI3OTAwNjMwOnYy", "diffSide": "RIGHT", "path": "docs/reference/commands/certutil.asciidoc", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xM1QxNToyODoyNFrOHyy0dg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xM1QxNToyODoyNFrOHyy0dg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzAyMzQ3OA==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            `--ca` or `--ca-cert` parameters, unless the `--self-signed` option is specified.\n          \n          \n            \n            `--ca` or `--ca-cert` and `--ca-key` parameters, unless the `--self-signed` option is specified.", "url": "https://github.com/elastic/elasticsearch/pull/64037#discussion_r523023478", "createdAt": "2020-11-13T15:28:24Z", "author": {"login": "jkakavas"}, "path": "docs/reference/commands/certutil.asciidoc", "diffHunk": "@@ -82,6 +82,12 @@ All certificates that are generated by this command are signed by a CA. You can\n provide your own CA with the `--ca` or `--ca-cert` parameters. Otherwise, the\n command automatically generates a new CA for you. For more information about\n generating a CA, see the <<certutil-ca,CA mode of this command>>.\n+You can also generate self-signed certificates with the `--self-signed` parameters.\n+\n+deprecated:[7.11.0]\n+Generating certificates without specifying a CA certificate is deprecated.\n+Next major version will mandate a CA certificate to be provided with the\n+`--ca` or `--ca-cert` parameters, unless the `--self-signed` option is specified.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3558a2c98a22de37459b2c5b158bb1397abb00fd"}, "originalPosition": 18}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI3OTAxNTE2OnYy", "diffSide": "RIGHT", "path": "x-pack/docs/en/security/authentication/saml-guide.asciidoc", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xM1QxNTozMDoyOVrOHyy50w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNlQxMToyNjo1OFrOHz3xFw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzAyNDg1MQ==", "bodyText": "The most important characteristic is that this is a signing certificate (used to sign SAML messages), not that it is a self-signed one. I'd suggest we revert this change", "url": "https://github.com/elastic/elasticsearch/pull/64037#discussion_r523024851", "createdAt": "2020-11-13T15:30:29Z", "author": {"login": "jkakavas"}, "path": "x-pack/docs/en/security/authentication/saml-guide.asciidoc", "diffHunk": "@@ -505,11 +505,11 @@ support. Since PEM format is the most commonly supported format, the examples\n below will generate certificates in that format.\n \n Using the <<certutil,`elasticsearch-certutil` tool>>, you can generate a\n-signing certificate with the following command:\n+self-signed certificate with the following command:", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3558a2c98a22de37459b2c5b158bb1397abb00fd"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDE1MzExMQ==", "bodyText": "You are right. Reverted.", "url": "https://github.com/elastic/elasticsearch/pull/64037#discussion_r524153111", "createdAt": "2020-11-16T11:26:58Z", "author": {"login": "ywangd"}, "path": "x-pack/docs/en/security/authentication/saml-guide.asciidoc", "diffHunk": "@@ -505,11 +505,11 @@ support. Since PEM format is the most commonly supported format, the examples\n below will generate certificates in that format.\n \n Using the <<certutil,`elasticsearch-certutil` tool>>, you can generate a\n-signing certificate with the following command:\n+self-signed certificate with the following command:", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzAyNDg1MQ=="}, "originalCommit": {"oid": "3558a2c98a22de37459b2c5b158bb1397abb00fd"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI3OTAyMzM5OnYy", "diffSide": "RIGHT", "path": "x-pack/docs/en/security/authentication/saml-guide.asciidoc", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xM1QxNTozMjoyOFrOHyy-1w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xM1QxNTozMjoyOFrOHyy-1w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzAyNjEzNQ==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            bin/elasticsearch-certutil cert -self-signed -pem -days 1100 -name saml-sign -out saml-sign.zip\n          \n          \n            \n            bin/elasticsearch-certutil cert --self-signed --pem --days 1100 --name saml-sign --out saml-sign.zip", "url": "https://github.com/elastic/elasticsearch/pull/64037#discussion_r523026135", "createdAt": "2020-11-13T15:32:28Z", "author": {"login": "jkakavas"}, "path": "x-pack/docs/en/security/authentication/saml-guide.asciidoc", "diffHunk": "@@ -505,11 +505,11 @@ support. Since PEM format is the most commonly supported format, the examples\n below will generate certificates in that format.\n \n Using the <<certutil,`elasticsearch-certutil` tool>>, you can generate a\n-signing certificate with the following command:\n+self-signed certificate with the following command:\n \n [source, sh]\n --------------------------------------------------\n-bin/elasticsearch-certutil cert -pem -days 1100 -name saml-sign -out saml-sign.zip\n+bin/elasticsearch-certutil cert -self-signed -pem -days 1100 -name saml-sign -out saml-sign.zip", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3558a2c98a22de37459b2c5b158bb1397abb00fd"}, "originalPosition": 10}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI3OTA0MjM5OnYy", "diffSide": "RIGHT", "path": "x-pack/plugin/security/cli/src/main/java/org/elasticsearch/xpack/security/cli/CertificateTool.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xM1QxNTozNzoxM1rOHyzK5Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xM1QxNTozNzoxM1rOHyzK5Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzAyOTIyMQ==", "bodyText": "How about something like:\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        \"    * The certificates can be self signed using the -self-signed command line option.\\n\" +\n          \n          \n            \n                        \"         Alternatively the tool can automatically generate a new CA for you, or you can \" +\n          \n          \n            \n                        \"         provide your own with the -ca or -ca-cert command line options.\";\n          \n          \n            \n            \"    * All certificates generated by this tool will be signed by a certificate authority (CA), unless\" +\n          \n          \n            \n                        \"    the --self-signed command line option is specified.\\n\" +\n          \n          \n            \n                        \"         The tool can automatically generate a new CA for you, or you can \" +\n          \n          \n            \n                        \"         provide your own with the -ca or -ca-cert command line options.\";\n          \n      \n    \n    \n  \n\nI think it reads better but I'll let Lisa tell us :)", "url": "https://github.com/elastic/elasticsearch/pull/64037#discussion_r523029221", "createdAt": "2020-11-13T15:37:13Z", "author": {"login": "jkakavas"}, "path": "x-pack/plugin/security/cli/src/main/java/org/elasticsearch/xpack/security/cli/CertificateTool.java", "diffHunk": "@@ -167,8 +167,9 @@ public static void main(String[] args) throws Exception {\n \n     static final String CA_EXPLANATION =\n         \"    * All certificates generated by this tool will be signed by a certificate authority (CA).\\n\" +\n-            \"    * The tool can automatically generate a new CA for you, or you can provide your own with the\\n\" +\n-            \"         -ca or -ca-cert command line options.\";\n+            \"    * The certificates can be self signed using the -self-signed command line option.\\n\" +\n+            \"         Alternatively the tool can automatically generate a new CA for you, or you can \" +\n+            \"         provide your own with the -ca or -ca-cert command line options.\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3558a2c98a22de37459b2c5b158bb1397abb00fd"}, "originalPosition": 8}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI3OTA5MTI5OnYy", "diffSide": "RIGHT", "path": "x-pack/plugin/security/cli/src/main/java/org/elasticsearch/xpack/security/cli/CertificateTool.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xM1QxNTo0OToyNlrOHyzpLg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xN1QwODo1MjoyOFrOH0qYHQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzAzNjk3NA==", "bodyText": "I also think we don't need to add a certificate entry too when we create a self-signed PKCS12, but did we check?", "url": "https://github.com/elastic/elasticsearch/pull/64037#discussion_r523036974", "createdAt": "2020-11-13T15:49:26Z", "author": {"login": "jkakavas"}, "path": "x-pack/plugin/security/cli/src/main/java/org/elasticsearch/xpack/security/cli/CertificateTool.java", "diffHunk": "@@ -807,7 +819,8 @@ void generateAndWriteSignedCertificates(Path output, boolean writeZipFile, Optio\n                         } else {\n                             final String fileName = entryBase + \".p12\";\n                             outputStream.putNextEntry(new ZipEntry(fileName));\n-                            writePkcs12(fileName, outputStream, certificateInformation.name.originalName, pair, caInfo.certAndKey.cert,\n+                            writePkcs12(fileName, outputStream, certificateInformation.name.originalName, pair,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3558a2c98a22de37459b2c5b158bb1397abb00fd"}, "originalPosition": 77}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDE1ODc4NQ==", "bodyText": "This is a good point and it turns out the check is missing ...\nI now augumented testCreateCaAndMultipleInstances to test p12 generation for self-signed cert.", "url": "https://github.com/elastic/elasticsearch/pull/64037#discussion_r524158785", "createdAt": "2020-11-16T11:32:12Z", "author": {"login": "ywangd"}, "path": "x-pack/plugin/security/cli/src/main/java/org/elasticsearch/xpack/security/cli/CertificateTool.java", "diffHunk": "@@ -807,7 +819,8 @@ void generateAndWriteSignedCertificates(Path output, boolean writeZipFile, Optio\n                         } else {\n                             final String fileName = entryBase + \".p12\";\n                             outputStream.putNextEntry(new ZipEntry(fileName));\n-                            writePkcs12(fileName, outputStream, certificateInformation.name.originalName, pair, caInfo.certAndKey.cert,\n+                            writePkcs12(fileName, outputStream, certificateInformation.name.originalName, pair,", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzAzNjk3NA=="}, "originalCommit": {"oid": "3558a2c98a22de37459b2c5b158bb1397abb00fd"}, "originalPosition": 77}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDk4MjMwMQ==", "bodyText": "My point was actually about the construction of the PKCS#12 bundle and whether or not it suffices to add a private key entry with the key and certificate, or if we also need to add a trusted certificate entry with the certificate too. I believe we don't and other tooling ( keytool, openssl ) seem to agree too :)", "url": "https://github.com/elastic/elasticsearch/pull/64037#discussion_r524982301", "createdAt": "2020-11-17T08:52:28Z", "author": {"login": "jkakavas"}, "path": "x-pack/plugin/security/cli/src/main/java/org/elasticsearch/xpack/security/cli/CertificateTool.java", "diffHunk": "@@ -807,7 +819,8 @@ void generateAndWriteSignedCertificates(Path output, boolean writeZipFile, Optio\n                         } else {\n                             final String fileName = entryBase + \".p12\";\n                             outputStream.putNextEntry(new ZipEntry(fileName));\n-                            writePkcs12(fileName, outputStream, certificateInformation.name.originalName, pair, caInfo.certAndKey.cert,\n+                            writePkcs12(fileName, outputStream, certificateInformation.name.originalName, pair,", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzAzNjk3NA=="}, "originalCommit": {"oid": "3558a2c98a22de37459b2c5b158bb1397abb00fd"}, "originalPosition": 77}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI5MTU5NDI2OnYy", "diffSide": "RIGHT", "path": "x-pack/plugin/security/cli/src/main/java/org/elasticsearch/xpack/security/cli/CertificateTool.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xN1QwODo1MDoxMlrOH0qRvw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xN1QwODo1MDoxMlrOH0qRvw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDk4MDY3MQ==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                            terminal.println(\"      A CA certificate will become mandatory in next major release.\");\n          \n          \n            \n                            terminal.println(\"      A CA certificate will become mandatory in the next major release.\");", "url": "https://github.com/elastic/elasticsearch/pull/64037#discussion_r524980671", "createdAt": "2020-11-17T08:50:12Z", "author": {"login": "jkakavas"}, "path": "x-pack/plugin/security/cli/src/main/java/org/elasticsearch/xpack/security/cli/CertificateTool.java", "diffHunk": "@@ -330,6 +331,9 @@ CAInfo getCAInfo(Terminal terminal, OptionSet options, Environment env) throws E\n             } else if (options.has(caCertPathSpec)) {\n                 return loadPemCA(terminal, options, env);\n             } else {\n+                terminal.println(\"Note: Generating certificates without providing a CA certificate is deprecated.\");\n+                terminal.println(\"      A CA certificate will become mandatory in next major release.\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f4121b56e2d557a448deb866d09a962a5da9f6c5"}, "originalPosition": 19}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI5NzgyNTY5OnYy", "diffSide": "RIGHT", "path": "x-pack/plugin/security/cli/src/main/java/org/elasticsearch/xpack/security/cli/CertificateTool.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOFQxMDo0Mjo1MVrOH1noNA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yMFQxMjozNDoyNVrOH3N79A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTk4NTg0NA==", "bodyText": "Why would this take precedence rather than being an error?\nIf a user enters\ncertutil cert --ca foo.p12 --self-signed\n\nthat's contradictory, and I would expect it to be an error, but it actually would generate a self signed cert, and ignore the CA. That seems wrong to me.", "url": "https://github.com/elastic/elasticsearch/pull/64037#discussion_r525985844", "createdAt": "2020-11-18T10:42:51Z", "author": {"login": "tvernum"}, "path": "x-pack/plugin/security/cli/src/main/java/org/elasticsearch/xpack/security/cli/CertificateTool.java", "diffHunk": "@@ -645,9 +649,12 @@ void generateAndWriteCsrs(Path output, int keySize, Collection<CertificateInform\n \n     static class GenerateCertificateCommand extends CertificateCommand {\n \n+        OptionSpec<Void> selfSigned;\n+\n         GenerateCertificateCommand() {\n             super(\"generate X.509 certificates and keys\");\n             acceptCertificateGenerationOptions();\n+            selfSigned = parser.accepts(\"self-signed\", \"generate self signed certificates (takes precedence over the ca options)\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ae6ec18eabcce4252eb0b574674a6071b81e819b"}, "originalPosition": 33}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzY2MjA2OA==", "bodyText": "Good catch, Thanks. I misunderstood the existing behaviour of --ca and --ca-cert. The two plus the new --self-signed should be mutually exclusive. It is now fixed.", "url": "https://github.com/elastic/elasticsearch/pull/64037#discussion_r527662068", "createdAt": "2020-11-20T12:34:25Z", "author": {"login": "ywangd"}, "path": "x-pack/plugin/security/cli/src/main/java/org/elasticsearch/xpack/security/cli/CertificateTool.java", "diffHunk": "@@ -645,9 +649,12 @@ void generateAndWriteCsrs(Path output, int keySize, Collection<CertificateInform\n \n     static class GenerateCertificateCommand extends CertificateCommand {\n \n+        OptionSpec<Void> selfSigned;\n+\n         GenerateCertificateCommand() {\n             super(\"generate X.509 certificates and keys\");\n             acceptCertificateGenerationOptions();\n+            selfSigned = parser.accepts(\"self-signed\", \"generate self signed certificates (takes precedence over the ca options)\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTk4NTg0NA=="}, "originalCommit": {"oid": "ae6ec18eabcce4252eb0b574674a6071b81e819b"}, "originalPosition": 33}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI5OTI5Njc0OnYy", "diffSide": "RIGHT", "path": "x-pack/plugin/security/cli/src/main/java/org/elasticsearch/xpack/security/cli/CertificateTool.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOFQxNjoxODowMlrOH110CQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQwMDowNzo0NFrOH2HVow==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjIxODI0OQ==", "bodyText": "Should these have two dashes?\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        \"      the -ca or -ca-cert command line options.\";\n          \n          \n            \n                        \"      the --ca or --ca-cert command line options.\";", "url": "https://github.com/elastic/elasticsearch/pull/64037#discussion_r526218249", "createdAt": "2020-11-18T16:18:02Z", "author": {"login": "lcawl"}, "path": "x-pack/plugin/security/cli/src/main/java/org/elasticsearch/xpack/security/cli/CertificateTool.java", "diffHunk": "@@ -166,9 +166,10 @@ public static void main(String[] args) throws Exception {\n             \"      disable hostname verification in your SSL configuration.\";\n \n     static final String CA_EXPLANATION =\n-        \"    * All certificates generated by this tool will be signed by a certificate authority (CA).\\n\" +\n-            \"    * The tool can automatically generate a new CA for you, or you can provide your own with the\\n\" +\n-            \"         -ca or -ca-cert command line options.\";\n+        \"    * All certificates generated by this tool will be signed by a certificate authority (CA)\\n\" +\n+            \"      unless the --self-signed command line option is specified.\\n\" +\n+            \"      The tool can automatically generate a new CA for you, or you can provide your own with \" +\n+            \"      the -ca or -ca-cert command line options.\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ae6ec18eabcce4252eb0b574674a6071b81e819b"}, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjUwNTM3OQ==", "bodyText": "We haven't really been very consistent on the usage of single dash and double dashes. There are still many other places that use single dash. For this particular paragraph, I am ok to make it all double dashes.", "url": "https://github.com/elastic/elasticsearch/pull/64037#discussion_r526505379", "createdAt": "2020-11-19T00:07:44Z", "author": {"login": "ywangd"}, "path": "x-pack/plugin/security/cli/src/main/java/org/elasticsearch/xpack/security/cli/CertificateTool.java", "diffHunk": "@@ -166,9 +166,10 @@ public static void main(String[] args) throws Exception {\n             \"      disable hostname verification in your SSL configuration.\";\n \n     static final String CA_EXPLANATION =\n-        \"    * All certificates generated by this tool will be signed by a certificate authority (CA).\\n\" +\n-            \"    * The tool can automatically generate a new CA for you, or you can provide your own with the\\n\" +\n-            \"         -ca or -ca-cert command line options.\";\n+        \"    * All certificates generated by this tool will be signed by a certificate authority (CA)\\n\" +\n+            \"      unless the --self-signed command line option is specified.\\n\" +\n+            \"      The tool can automatically generate a new CA for you, or you can provide your own with \" +\n+            \"      the -ca or -ca-cert command line options.\";", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjIxODI0OQ=="}, "originalCommit": {"oid": "ae6ec18eabcce4252eb0b574674a6071b81e819b"}, "originalPosition": 10}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI5OTMyMTEwOnYy", "diffSide": "RIGHT", "path": "docs/reference/commands/certutil.asciidoc", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOFQxNjoyMzowNlrOH12DNQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOFQxNjoyMzowNlrOH12DNQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjIyMjEzMw==", "bodyText": "deprecated:[7.11.0,\"Generating certificates without specifying a CA certificate and key is deprecated. In the next major version you must provide a CA certificate unless the --self-signed option is specified.\"]\n\nI've combined this information into a single paragraph so that it's (hopefully) clearer what's deprecated.", "url": "https://github.com/elastic/elasticsearch/pull/64037#discussion_r526222133", "createdAt": "2020-11-18T16:23:06Z", "author": {"login": "lcawl"}, "path": "docs/reference/commands/certutil.asciidoc", "diffHunk": "@@ -73,15 +73,18 @@ directory name, you must also specify a file name in the `--name` command\n parameter or in the `filename` field in an input YAML file.\n \n You can optionally provide IP addresses or DNS names for each instance. If\n-neither IP addresses nor DNS names are specified, the Elastic stack products\n+neither IP addresses nor DNS names are specified, the Elastic Stack products\n cannot perform hostname verification and you might need to configure the\n `verification_mode` security setting to `certificate` only. For more information\n about this setting, see <<security-settings>>.\n \n-All certificates that are generated by this command are signed by a CA. You can\n-provide your own CA with the `--ca` or `--ca-cert` parameters. Otherwise, the\n-command automatically generates a new CA for you. For more information about\n-generating a CA, see the <<certutil-ca,CA mode of this command>>.\n+All certificates that are generated by this command are signed by a CA unless\n+the `--self-signed` parameter is specified. You can provide your own CA with the\n+`--ca` or `--ca-cert` and `--ca-key` parameters. Otherwise, the command automatically generates a new CA for you.\n+deprecated:[7.11.0,\"Generating certificates without specifying a CA certificate and key is deprecated. In the next major version you must provide a CA certificate unless the `--self-signed` option is specified.\"]", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "09694d360468ae84f9cf2a26bc6ba4680348a5fa"}, "originalPosition": 26}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMwMTYxMDk5OnYy", "diffSide": "RIGHT", "path": "x-pack/plugin/security/cli/src/main/java/org/elasticsearch/xpack/security/cli/CertificateTool.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQwNDowMDo1MlrOH2L4Cg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQwNDowMDo1MlrOH2L4Cg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjU3OTcyMg==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                                keyPair, null, null, true, days, null);\n          \n          \n            \n                                keyPair, null, null, false, days, null);\n          \n      \n    \n    \n  \n\nThe true means that this is a CA, but then --self-signed is just doing the same thing as certutil ca, but it should be generating a non ca, self-signed cert,", "url": "https://github.com/elastic/elasticsearch/pull/64037#discussion_r526579722", "createdAt": "2020-11-19T04:00:52Z", "author": {"login": "tvernum"}, "path": "x-pack/plugin/security/cli/src/main/java/org/elasticsearch/xpack/security/cli/CertificateTool.java", "diffHunk": "@@ -818,17 +831,26 @@ void generateAndWriteSignedCertificates(Path output, boolean writeZipFile, Optio\n                 CertificateInformation certificateInformation = certs.iterator().next();\n                 CertificateAndKey pair = generateCertificateAndKey(certificateInformation, caInfo, keySize, days);\n                 fullyWriteFile(output, stream -> writePkcs12(output.getFileName().toString(), stream,\n-                    certificateInformation.name.originalName, pair, caInfo.certAndKey.cert, outputPassword, terminal));\n+                    certificateInformation.name.originalName, pair,\n+                    caInfo == null ? null : caInfo.certAndKey.cert, outputPassword, terminal));\n             }\n         }\n \n         private CertificateAndKey generateCertificateAndKey(CertificateInformation certificateInformation, CAInfo caInfo,\n                                                             int keySize, int days) throws Exception {\n             KeyPair keyPair = CertGenUtils.generateKeyPair(keySize);\n-            Certificate certificate = CertGenUtils.generateSignedCertificate(certificateInformation.name.x500Principal,\n-                getSubjectAlternativeNamesValue(certificateInformation.ipAddresses, certificateInformation.dnsNames,\n-                    certificateInformation.commonNames),\n-                keyPair, caInfo.certAndKey.cert, caInfo.certAndKey.key, days);\n+            Certificate certificate;\n+            if (caInfo != null) {\n+                certificate = CertGenUtils.generateSignedCertificate(certificateInformation.name.x500Principal,\n+                    getSubjectAlternativeNamesValue(certificateInformation.ipAddresses, certificateInformation.dnsNames,\n+                        certificateInformation.commonNames),\n+                    keyPair, caInfo.certAndKey.cert, caInfo.certAndKey.key, days);\n+            } else {\n+                certificate = CertGenUtils.generateSignedCertificate(certificateInformation.name.x500Principal,\n+                    getSubjectAlternativeNamesValue(certificateInformation.ipAddresses, certificateInformation.dnsNames,\n+                        certificateInformation.commonNames),\n+                    keyPair, null, null, true, days, null);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ae6ec18eabcce4252eb0b574674a6071b81e819b"}, "originalPosition": 111}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4275, "cost": 1, "resetAt": "2021-11-12T19:05:54Z"}}}