{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE5Mzg1Njkz", "number": 56888, "reviewThreads": {"totalCount": 14, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMFQwODo0MTowMFrOD-Hc7g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNlQxOTowNjo0OFrOD_zxuQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY2NDYwMzk4OnYy", "diffSide": "RIGHT", "path": "server/src/main/java/org/elasticsearch/cluster/metadata/MetadataCreateDataStreamService.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMFQwODo0MTowMFrOGYBP2A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMFQwOTo0OTo1NlrOGYD54A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzgzOTQ0OA==", "bodyText": "Should we enforce that the timestamp field on the create data stream request is the same as the timestamp field in the data stream template? This can be different if a user provided a different timestamp field via the create data stream api.\nIf we do enforce this then I think that we should remove the timestamp field from the create data stream request and always use the timestamp field provided in the data stream template inside a itv2.", "url": "https://github.com/elastic/elasticsearch/pull/56888#discussion_r427839448", "createdAt": "2020-05-20T08:41:00Z", "author": {"login": "martijnvg"}, "path": "server/src/main/java/org/elasticsearch/cluster/metadata/MetadataCreateDataStreamService.java", "diffHunk": "@@ -145,4 +147,16 @@ static ClusterState createDataStream(MetadataCreateIndexService metadataCreateIn\n         return ClusterState.builder(currentState).metadata(builder).build();\n     }\n \n+    public static void validateTemplateForDataStream(String dataStreamName, Metadata metadata) {\n+        final String v2Template = MetadataIndexTemplateService.findV2Template(metadata, dataStreamName, false);\n+        if (v2Template == null) {\n+            throw new IllegalArgumentException(\"no matching index template found for data stream [\" + dataStreamName + \"]\");\n+        }\n+        IndexTemplateV2 indexTemplateV2 = metadata.templatesV2().get(v2Template);\n+        if (indexTemplateV2.getDataStreamTemplate() == null) {\n+            throw new IllegalArgumentException(\"matching index template [\" + v2Template + \"] for data stream [\" + dataStreamName  +\n+                \"] has no data stream template\");\n+        }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "04341ac5e4afe4f0da0acbddf66575ad24cf7b4e"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzg1MDI3MQ==", "bodyText": "We should at least make specifying the timestamp field non-mandatory. In the future, it should only be necessary to specify if there is no matching template.\nAlso, the requirement to have the template have a valid mapping for the timestamp field makes it questionable if specifying a timestamp field on the data stream has any real value. Once/if we add the ability to also specify settings and mappings when creating data streams (i.e., create a data stream without any template requirement), it makes more sense to also be able to specify the timestamp field.\nI would opt to remove the ability to specify the timestamp field for the first iteration of data streams.", "url": "https://github.com/elastic/elasticsearch/pull/56888#discussion_r427850271", "createdAt": "2020-05-20T08:57:19Z", "author": {"login": "henningandersen"}, "path": "server/src/main/java/org/elasticsearch/cluster/metadata/MetadataCreateDataStreamService.java", "diffHunk": "@@ -145,4 +147,16 @@ static ClusterState createDataStream(MetadataCreateIndexService metadataCreateIn\n         return ClusterState.builder(currentState).metadata(builder).build();\n     }\n \n+    public static void validateTemplateForDataStream(String dataStreamName, Metadata metadata) {\n+        final String v2Template = MetadataIndexTemplateService.findV2Template(metadata, dataStreamName, false);\n+        if (v2Template == null) {\n+            throw new IllegalArgumentException(\"no matching index template found for data stream [\" + dataStreamName + \"]\");\n+        }\n+        IndexTemplateV2 indexTemplateV2 = metadata.templatesV2().get(v2Template);\n+        if (indexTemplateV2.getDataStreamTemplate() == null) {\n+            throw new IllegalArgumentException(\"matching index template [\" + v2Template + \"] for data stream [\" + dataStreamName  +\n+                \"] has no data stream template\");\n+        }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzgzOTQ0OA=="}, "originalCommit": {"oid": "04341ac5e4afe4f0da0acbddf66575ad24cf7b4e"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzg4Mjk3Ng==", "bodyText": "Thanks Henning, I will remove the timestamp_field parameter from the create data stream request as part of this PR.", "url": "https://github.com/elastic/elasticsearch/pull/56888#discussion_r427882976", "createdAt": "2020-05-20T09:49:56Z", "author": {"login": "martijnvg"}, "path": "server/src/main/java/org/elasticsearch/cluster/metadata/MetadataCreateDataStreamService.java", "diffHunk": "@@ -145,4 +147,16 @@ static ClusterState createDataStream(MetadataCreateIndexService metadataCreateIn\n         return ClusterState.builder(currentState).metadata(builder).build();\n     }\n \n+    public static void validateTemplateForDataStream(String dataStreamName, Metadata metadata) {\n+        final String v2Template = MetadataIndexTemplateService.findV2Template(metadata, dataStreamName, false);\n+        if (v2Template == null) {\n+            throw new IllegalArgumentException(\"no matching index template found for data stream [\" + dataStreamName + \"]\");\n+        }\n+        IndexTemplateV2 indexTemplateV2 = metadata.templatesV2().get(v2Template);\n+        if (indexTemplateV2.getDataStreamTemplate() == null) {\n+            throw new IllegalArgumentException(\"matching index template [\" + v2Template + \"] for data stream [\" + dataStreamName  +\n+                \"] has no data stream template\");\n+        }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzgzOTQ0OA=="}, "originalCommit": {"oid": "04341ac5e4afe4f0da0acbddf66575ad24cf7b4e"}, "originalPosition": 22}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY3OTg4OTI0OnYy", "diffSide": "RIGHT", "path": "docs/reference/indices/create-data-stream.asciidoc", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNlQwODozMDowM1rOGaT9FA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNlQwODozMDowM1rOGaT9FA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDI0MzA5Mg==", "bodyText": "I would prefer to just delete the specific template?", "url": "https://github.com/elastic/elasticsearch/pull/56888#discussion_r430243092", "createdAt": "2020-05-26T08:30:03Z", "author": {"login": "henningandersen"}, "path": "docs/reference/indices/create-data-stream.asciidoc", "diffHunk": "@@ -23,18 +23,31 @@ addressed directly, data streams are integrated with the\n <<index-lifecycle-management, index lifecycle management (ILM)>> to facilitate\n the management of the time series data contained in their backing indices.\n \n+////\n [source,console]\n---------------------------------------------------\n-PUT _data_stream/my-data-stream\n+-----------------------------------\n+PUT _index_template/template\n {\n-  \"timestamp_field\": \"@timestamp\"\n+  \"index_patterns\": [\"my-data-stream*\"],\n+  \"data_stream\": {\n+    \"timestamp_field\": \"@timestamp\"\n+  }\n }\n+-----------------------------------\n+// TEST\n+////\n+\n+[source,console]\n --------------------------------------------------\n+PUT _data_stream/my-data-stream\n+--------------------------------------------------\n+// TEST[continued]\n \n ////\n [source,console]\n -----------------------------------\n DELETE /_data_stream/my-data-stream\n+DELETE /_index_template/*", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "825c787af936f1399dd7180c326f6fd2e31b2d70"}, "originalPosition": 31}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY3OTg5OTI3OnYy", "diffSide": "RIGHT", "path": "docs/reference/indices/create-data-stream.asciidoc", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNlQwODozMjo0N1rOGaUDag==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNlQwODozMjo0N1rOGaUDag==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDI0NDcxNA==", "bodyText": "The text further down explains that there is a timestamp field in the body, I think that should be removed now?\nMaybe we also need a short description stating that you can only create data-streams into namespaces where a template exists with a data_stream declaration on it? Maybe this is special enough that we should include creating the template into the text too, in order to ensure that the first thing users try out with data-streams works?", "url": "https://github.com/elastic/elasticsearch/pull/56888#discussion_r430244714", "createdAt": "2020-05-26T08:32:47Z", "author": {"login": "henningandersen"}, "path": "docs/reference/indices/create-data-stream.asciidoc", "diffHunk": "@@ -23,18 +23,31 @@ addressed directly, data streams are integrated with the\n <<index-lifecycle-management, index lifecycle management (ILM)>> to facilitate\n the management of the time series data contained in their backing indices.\n \n+////\n [source,console]\n---------------------------------------------------\n-PUT _data_stream/my-data-stream\n+-----------------------------------\n+PUT _index_template/template\n {\n-  \"timestamp_field\": \"@timestamp\"\n+  \"index_patterns\": [\"my-data-stream*\"],\n+  \"data_stream\": {\n+    \"timestamp_field\": \"@timestamp\"\n+  }\n }\n+-----------------------------------\n+// TEST\n+////\n+\n+[source,console]\n --------------------------------------------------\n+PUT _data_stream/my-data-stream", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "825c787af936f1399dd7180c326f6fd2e31b2d70"}, "originalPosition": 23}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY3OTkwMTkyOnYy", "diffSide": "RIGHT", "path": "docs/reference/indices/delete-data-stream.asciidoc", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNlQwODozMzozNVrOGaUFLA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNlQwODozMzozNVrOGaUFLA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDI0NTE2NA==", "bodyText": "I would prefer to just delete the specific template.", "url": "https://github.com/elastic/elasticsearch/pull/56888#discussion_r430245164", "createdAt": "2020-05-26T08:33:35Z", "author": {"login": "henningandersen"}, "path": "docs/reference/indices/delete-data-stream.asciidoc", "diffHunk": "@@ -22,6 +27,13 @@ PUT /_data_stream/my-data-stream\n DELETE _data_stream/my-data-stream\n --------------------------------------------------\n \n+////\n+[source,console]\n+-----------------------------------\n+DELETE /_index_template/*", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "825c787af936f1399dd7180c326f6fd2e31b2d70"}, "originalPosition": 25}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY3OTkwNzg2OnYy", "diffSide": "RIGHT", "path": "docs/reference/indices/get-data-stream.asciidoc", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNlQwODozNToxNVrOGaUJCQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNlQwODozNToxNVrOGaUJCQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDI0NjE1Mw==", "bodyText": "One more...", "url": "https://github.com/elastic/elasticsearch/pull/56888#discussion_r430246153", "createdAt": "2020-05-26T08:35:15Z", "author": {"login": "henningandersen"}, "path": "docs/reference/indices/get-data-stream.asciidoc", "diffHunk": "@@ -21,6 +26,7 @@ PUT /_data_stream/my-data-stream\n [source,console]\n -----------------------------------\n DELETE /_data_stream/my-data-stream\n+DELETE /_index_template/*", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "825c787af936f1399dd7180c326f6fd2e31b2d70"}, "originalPosition": 22}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY3OTkyNjQwOnYy", "diffSide": "RIGHT", "path": "docs/reference/indices/rollover-index.asciidoc", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNlQwODozOTo1OFrOGaUUVA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNlQwODozOTo1OFrOGaUUVA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDI0OTA0NA==", "bodyText": "I wonder if we should include creating the template into the text in order to make the example more complete?", "url": "https://github.com/elastic/elasticsearch/pull/56888#discussion_r430249044", "createdAt": "2020-05-26T08:39:58Z", "author": {"login": "henningandersen"}, "path": "docs/reference/indices/rollover-index.asciidoc", "diffHunk": "@@ -225,12 +225,23 @@ The API returns the following response:\n [[rollover-data-stream-ex]]\n ===== Roll over a data stream\n \n+////", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "825c787af936f1399dd7180c326f6fd2e31b2d70"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY3OTkyODA1OnYy", "diffSide": "RIGHT", "path": "docs/reference/indices/rollover-index.asciidoc", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNlQwODo0MDoxOVrOGaUVNg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNlQwODo0MDoxOVrOGaUVNg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDI0OTI3MA==", "bodyText": "Prefer specific name here too.", "url": "https://github.com/elastic/elasticsearch/pull/56888#discussion_r430249270", "createdAt": "2020-05-26T08:40:19Z", "author": {"login": "henningandersen"}, "path": "docs/reference/indices/rollover-index.asciidoc", "diffHunk": "@@ -286,6 +298,7 @@ The API returns the following response:\n [source,console]\n -----------------------------------\n DELETE /_data_stream/my-data-stream\n+DELETE /_index_template/*", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "825c787af936f1399dd7180c326f6fd2e31b2d70"}, "originalPosition": 39}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY3OTk0NDM2OnYy", "diffSide": "RIGHT", "path": "rest-api-spec/src/main/resources/rest-api-spec/test/indices.data_stream/10_basic.yml", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNlQwODo0NDo0NlrOGaUfug==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNlQwODo0NDo0NlrOGaUfug==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDI1MTk2Mg==", "bodyText": "I think we need a test verifying the behavior when attempting to create a data-stream into a name where there is no template and also into a name where the template is not a data-stream?", "url": "https://github.com/elastic/elasticsearch/pull/56888#discussion_r430251962", "createdAt": "2020-05-26T08:44:46Z", "author": {"login": "henningandersen"}, "path": "rest-api-spec/src/main/resources/rest-api-spec/test/indices.data_stream/10_basic.yml", "diffHunk": "@@ -1,21 +1,39 @@\n+setup:\n+  - skip:\n+      features: allowed_warnings\n+  - do:\n+      allowed_warnings:\n+        - \"index template [my-template1] has index patterns [simple-data-stream1*] matching patterns from existing older templates [global] with patterns (global => [*]); this template [my-template1] will take precedence during new index creation\"\n+      indices.put_index_template:\n+        name: my-template1\n+        body:\n+          index_patterns: [simple-data-stream1]\n+          data_stream:\n+            timestamp_field: '@timestamp'\n+  - do:\n+      allowed_warnings:\n+        - \"index template [my-template2] has index patterns [simple-data-stream2*] matching patterns from existing older templates [global] with patterns (global => [*]); this template [my-template2] will take precedence during new index creation\"\n+      indices.put_index_template:\n+        name: my-template2", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "825c787af936f1399dd7180c326f6fd2e31b2d70"}, "originalPosition": 17}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY3OTk0OTU3OnYy", "diffSide": "RIGHT", "path": "rest-api-spec/src/main/resources/rest-api-spec/test/indices.data_stream/10_basic.yml", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNlQwODo0NjoxMFrOGaUjGA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNlQxMjowMTo1MlrOGabEJA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDI1MjgyNA==", "bodyText": "I wonder if this should use a name that matches one of the templates (but is still illegal) to ensure that the error is really due to the name check and not the template/data-stream check?", "url": "https://github.com/elastic/elasticsearch/pull/56888#discussion_r430252824", "createdAt": "2020-05-26T08:46:10Z", "author": {"login": "henningandersen"}, "path": "rest-api-spec/src/main/resources/rest-api-spec/test/indices.data_stream/10_basic.yml", "diffHunk": "@@ -62,62 +80,56 @@\n ---\n \"Create data stream with invalid name\":\n   - skip:\n-      version: \" - 7.8.99\"\n-      reason: \"data streams only supported in 7.9+\"\n+      version: \" - 7.99.99\"\n+      reason:  \"mute bwc until backported\"\n \n   - do:\n       catch: bad_request\n       indices.create_data_stream:\n         name: invalid-data-stream#-name", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "825c787af936f1399dd7180c326f6fd2e31b2d70"}, "originalPosition": 58}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDM1OTU4OA==", "bodyText": "The check whether a template with the same exists happens before validating the name of the template. I can check the error description, so that we ensure that this request fails because of an invalid name.", "url": "https://github.com/elastic/elasticsearch/pull/56888#discussion_r430359588", "createdAt": "2020-05-26T12:01:52Z", "author": {"login": "martijnvg"}, "path": "rest-api-spec/src/main/resources/rest-api-spec/test/indices.data_stream/10_basic.yml", "diffHunk": "@@ -62,62 +80,56 @@\n ---\n \"Create data stream with invalid name\":\n   - skip:\n-      version: \" - 7.8.99\"\n-      reason: \"data streams only supported in 7.9+\"\n+      version: \" - 7.99.99\"\n+      reason:  \"mute bwc until backported\"\n \n   - do:\n       catch: bad_request\n       indices.create_data_stream:\n         name: invalid-data-stream#-name", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDI1MjgyNA=="}, "originalCommit": {"oid": "825c787af936f1399dd7180c326f6fd2e31b2d70"}, "originalPosition": 58}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY4MDAxNDIwOnYy", "diffSide": "RIGHT", "path": "server/src/internalClusterTest/java/org/elasticsearch/action/bulk/BulkIntegrationIT.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNlQwOTowMzowOFrOGaVL3A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNlQxMjoxMTo0MlrOGabYOQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDI2MzI2MA==", "bodyText": "I think this makes settings unused? But I am also uncertain of why this change was made? Just cleanup or a necessity. If the latter, I would like to understand why.", "url": "https://github.com/elastic/elasticsearch/pull/56888#discussion_r430263260", "createdAt": "2020-05-26T09:03:08Z", "author": {"login": "henningandersen"}, "path": "server/src/internalClusterTest/java/org/elasticsearch/action/bulk/BulkIntegrationIT.java", "diffHunk": "@@ -218,14 +217,14 @@ public void testDeleteIndexWhileIndexing() throws Exception {\n         }\n     }\n \n-    public void testMixedAutoCreate() {\n+    public void testMixedAutoCreate() throws Exception {\n         Settings settings = Settings.builder().put(IndexMetadata.SETTING_NUMBER_OF_REPLICAS, 0).build();\n \n         PutIndexTemplateV2Action.Request createTemplateRequest = new PutIndexTemplateV2Action.Request(\"logs-foo\");\n         createTemplateRequest.indexTemplate(\n             new IndexTemplateV2(\n                 List.of(\"logs-foo*\"),\n-                new Template(settings, null, null),\n+                null,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "825c787af936f1399dd7180c326f6fd2e31b2d70"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDM2NDcyOQ==", "bodyText": "This was just a cleanup. I will remove the settings variable.\n(copy paste from testAutoCreateV1TemplateNoDataStream() which ensures that a template applied, but that is not needed here, because if the data stream is created then the template has been applied)", "url": "https://github.com/elastic/elasticsearch/pull/56888#discussion_r430364729", "createdAt": "2020-05-26T12:11:42Z", "author": {"login": "martijnvg"}, "path": "server/src/internalClusterTest/java/org/elasticsearch/action/bulk/BulkIntegrationIT.java", "diffHunk": "@@ -218,14 +217,14 @@ public void testDeleteIndexWhileIndexing() throws Exception {\n         }\n     }\n \n-    public void testMixedAutoCreate() {\n+    public void testMixedAutoCreate() throws Exception {\n         Settings settings = Settings.builder().put(IndexMetadata.SETTING_NUMBER_OF_REPLICAS, 0).build();\n \n         PutIndexTemplateV2Action.Request createTemplateRequest = new PutIndexTemplateV2Action.Request(\"logs-foo\");\n         createTemplateRequest.indexTemplate(\n             new IndexTemplateV2(\n                 List.of(\"logs-foo*\"),\n-                new Template(settings, null, null),\n+                null,", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDI2MzI2MA=="}, "originalCommit": {"oid": "825c787af936f1399dd7180c326f6fd2e31b2d70"}, "originalPosition": 21}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY4MDAyNDE2OnYy", "diffSide": "RIGHT", "path": "server/src/internalClusterTest/java/org/elasticsearch/indices/DataStreamIT.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNlQwOTowNTo1NFrOGaVSXA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNlQxMTo1ODo1NFrOGaa9og==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDI2NDkyNA==", "bodyText": "This is fine, but I wonder if we should follow-up with generically removing all v2 templates like we do for regular templates?", "url": "https://github.com/elastic/elasticsearch/pull/56888#discussion_r430264924", "createdAt": "2020-05-26T09:05:54Z", "author": {"login": "henningandersen"}, "path": "server/src/internalClusterTest/java/org/elasticsearch/indices/DataStreamIT.java", "diffHunk": "@@ -72,13 +77,19 @@\n \n public class DataStreamIT extends ESIntegTestCase {\n \n+    @After", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "825c787af936f1399dd7180c326f6fd2e31b2d70"}, "originalPosition": 27}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDM1NzkyMg==", "bodyText": "Yes, I noticed that component templates were not automatically removed after each test. I don't know why. @dakrone Is there a reason why component templates are automatically removed after each test?", "url": "https://github.com/elastic/elasticsearch/pull/56888#discussion_r430357922", "createdAt": "2020-05-26T11:58:54Z", "author": {"login": "martijnvg"}, "path": "server/src/internalClusterTest/java/org/elasticsearch/indices/DataStreamIT.java", "diffHunk": "@@ -72,13 +77,19 @@\n \n public class DataStreamIT extends ESIntegTestCase {\n \n+    @After", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDI2NDkyNA=="}, "originalCommit": {"oid": "825c787af936f1399dd7180c326f6fd2e31b2d70"}, "originalPosition": 27}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY4MDA0NjM4OnYy", "diffSide": "RIGHT", "path": "server/src/test/java/org/elasticsearch/action/admin/indices/rollover/MetadataRolloverServiceTests.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNlQwOToxMjowNlrOGaVgww==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNlQwOToxMjowNlrOGaVgww==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDI2ODYxMQ==", "bodyText": "nit: seems like a strange secret choice of _id, maybe just use template?", "url": "https://github.com/elastic/elasticsearch/pull/56888#discussion_r430268611", "createdAt": "2020-05-26T09:12:06Z", "author": {"login": "henningandersen"}, "path": "server/src/test/java/org/elasticsearch/action/admin/indices/rollover/MetadataRolloverServiceTests.java", "diffHunk": "@@ -515,7 +515,10 @@ public void testRolloverClusterState() throws Exception {\n \n     public void testRolloverClusterStateForDataStream() throws Exception {\n         final DataStream dataStream = DataStreamTests.randomInstance();\n+        IndexTemplateV2 template = new IndexTemplateV2(List.of(dataStream.getName() + \"*\"), null, null, null, null, null,\n+            new IndexTemplateV2.DataStreamTemplate(\"@timestamp\"));\n         Metadata.Builder builder = Metadata.builder();\n+        builder.put(\"_id\", template);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "825c787af936f1399dd7180c326f6fd2e31b2d70"}, "originalPosition": 7}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY4MjMwNjU0OnYy", "diffSide": "RIGHT", "path": "docs/reference/indices/create-data-stream.asciidoc", "isResolved": false, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNlQxODo1Mzo0OFrOGar4Bw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yN1QwNzoxODo1MFrOGa8aMg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDYzNTAxNQ==", "bodyText": "Nit: ...has a component template that exists... or ...has an existing component template...", "url": "https://github.com/elastic/elasticsearch/pull/56888#discussion_r430635015", "createdAt": "2020-05-26T18:53:48Z", "author": {"login": "danhermann"}, "path": "docs/reference/indices/create-data-stream.asciidoc", "diffHunk": "@@ -23,18 +23,32 @@ addressed directly, data streams are integrated with the\n <<index-lifecycle-management, index lifecycle management (ILM)>> to facilitate\n the management of the time series data contained in their backing indices.\n \n+A data stream can only be created if the namespace it targets has a component\n+template exists with a `data_stream` definition.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "491a9c545bd19739a7cde2fce32a6ff7fca0fcd9"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDYzOTkwOA==", "bodyText": "Also, are we calling these composable templates now?", "url": "https://github.com/elastic/elasticsearch/pull/56888#discussion_r430639908", "createdAt": "2020-05-26T19:02:08Z", "author": {"login": "danhermann"}, "path": "docs/reference/indices/create-data-stream.asciidoc", "diffHunk": "@@ -23,18 +23,32 @@ addressed directly, data streams are integrated with the\n <<index-lifecycle-management, index lifecycle management (ILM)>> to facilitate\n the management of the time series data contained in their backing indices.\n \n+A data stream can only be created if the namespace it targets has a component\n+template exists with a `data_stream` definition.", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDYzNTAxNQ=="}, "originalCommit": {"oid": "491a9c545bd19739a7cde2fce32a6ff7fca0fcd9"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDY2MDE5OQ==", "bodyText": "A component template cannot have a data_stream definition, only an index template can, I would recommend changing it to:\n\"if the namespace it targets has a composable index template with a data_stream definition.\"", "url": "https://github.com/elastic/elasticsearch/pull/56888#discussion_r430660199", "createdAt": "2020-05-26T19:37:34Z", "author": {"login": "dakrone"}, "path": "docs/reference/indices/create-data-stream.asciidoc", "diffHunk": "@@ -23,18 +23,32 @@ addressed directly, data streams are integrated with the\n <<index-lifecycle-management, index lifecycle management (ILM)>> to facilitate\n the management of the time series data contained in their backing indices.\n \n+A data stream can only be created if the namespace it targets has a component\n+template exists with a `data_stream` definition.", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDYzNTAxNQ=="}, "originalCommit": {"oid": "491a9c545bd19739a7cde2fce32a6ff7fca0fcd9"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDkwNTkwNg==", "bodyText": "whoops, I mixed the terms composable and component up in my head... I meant composable.", "url": "https://github.com/elastic/elasticsearch/pull/56888#discussion_r430905906", "createdAt": "2020-05-27T07:18:50Z", "author": {"login": "martijnvg"}, "path": "docs/reference/indices/create-data-stream.asciidoc", "diffHunk": "@@ -23,18 +23,32 @@ addressed directly, data streams are integrated with the\n <<index-lifecycle-management, index lifecycle management (ILM)>> to facilitate\n the management of the time series data contained in their backing indices.\n \n+A data stream can only be created if the namespace it targets has a component\n+template exists with a `data_stream` definition.", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDYzNTAxNQ=="}, "originalCommit": {"oid": "491a9c545bd19739a7cde2fce32a6ff7fca0fcd9"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY4MjM1MTkzOnYy", "diffSide": "LEFT", "path": "docs/reference/indices/create-data-stream.asciidoc", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNlQxOTowNjo0OFrOGasU_Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNlQxOTowNjo0OFrOGasU_Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDY0MjQyOQ==", "bodyText": "I think that this documentation on timestamp_field should be preserved somewhere else, perhaps in the documentation on creating composable templates.", "url": "https://github.com/elastic/elasticsearch/pull/56888#discussion_r430642429", "createdAt": "2020-05-26T19:06:48Z", "author": {"login": "danhermann"}, "path": "docs/reference/indices/create-data-stream.asciidoc", "diffHunk": "@@ -71,11 +85,3 @@ Data stream names must meet the following criteria:\n will count towards the 255 limit faster)\n --\n \n-[[indices-create-data-stream-api-request-body]]\n-==== {api-request-body-title}\n-\n-`timestamp_field`::\n-(Required, string) The name of the timestamp field. This field must be present\n-in all documents indexed into the data stream and must be of type\n-<<date, `date`>> or <<date_nanos, `date_nanos`>>.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "491a9c545bd19739a7cde2fce32a6ff7fca0fcd9"}, "originalPosition": 46}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 331, "cost": 1, "resetAt": "2021-11-12T11:57:46Z"}}}