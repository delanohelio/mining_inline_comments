{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY4NzY4NzQ4", "number": 51648, "title": "[ML][Inference] Fix weighted mode definition", "bodyText": "Weighted mode inaccurately assumed that the \"max value\" of the input values would be the maximum class value. This does not make sense.\nWeighted Mode should know how many classes there are. Hence the new parameter num_classes. This indicates what the maximum class value to be expected.", "createdAt": "2020-01-29T21:15:10Z", "url": "https://github.com/elastic/elasticsearch/pull/51648", "merged": true, "mergeCommit": {"oid": "6db893335b2a5a248512d0230ec5ef8524ce7d94"}, "closed": true, "closedAt": "2020-01-30T19:00:13Z", "author": {"login": "benwtrent"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb_MmqfgH2gAyMzY4NzY4NzQ4OjU4MTRmN2I0NzAwYzJmM2ZjZTQwZmJiZWI3OTMxNzM1NTcxNDFjMDQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABb_d95ogH2gAyMzY4NzY4NzQ4OjY2ODZkMzY5YmY4MmYxZmE3ZjRiOWQ2YzgyMWVmMTY0YWQ4YjAyODY=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "5814f7b4700c2f3fce40fbbeb793173557141c04", "author": {"user": {"login": "benwtrent", "name": "Benjamin Trent"}}, "url": "https://github.com/elastic/elasticsearch/commit/5814f7b4700c2f3fce40fbbeb793173557141c04", "committedDate": "2020-01-29T21:13:15Z", "message": "[ML][Inference] Fix weighted mode definition"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "60dd7163853302c33f64aadfa45c65ecb2e0ca2b", "author": {"user": {"login": "benwtrent", "name": "Benjamin Trent"}}, "url": "https://github.com/elastic/elasticsearch/commit/60dd7163853302c33f64aadfa45c65ecb2e0ca2b", "committedDate": "2020-01-29T22:45:53Z", "message": "fixing frequency calculation for weighted_mode"}, "afterCommit": {"oid": "5814f7b4700c2f3fce40fbbeb793173557141c04", "author": {"user": {"login": "benwtrent", "name": "Benjamin Trent"}}, "url": "https://github.com/elastic/elasticsearch/commit/5814f7b4700c2f3fce40fbbeb793173557141c04", "committedDate": "2020-01-29T21:13:15Z", "message": "[ML][Inference] Fix weighted mode definition"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUwNjQyNjYz", "url": "https://github.com/elastic/elasticsearch/pull/51648#pullrequestreview-350642663", "createdAt": "2020-01-30T08:18:22Z", "commit": {"oid": "5814f7b4700c2f3fce40fbbeb793173557141c04"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0zMFQwODoxODoyMlrOFjidzA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0zMFQwODoxOTozN1rOFjiflg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjgwOTE2NA==", "bodyText": "Probably it's ok here but I'd reverse the order so that the constant is first (useful if we suspect null argument):\nreturn TargetType.CLASSIFICATION.equals(targetType);", "url": "https://github.com/elastic/elasticsearch/pull/51648#discussion_r372809164", "createdAt": "2020-01-30T08:18:22Z", "author": {"login": "przemekwitek"}, "path": "x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/ml/inference/trainedmodel/ensemble/WeightedMode.java", "diffHunk": "@@ -133,7 +146,7 @@ public String getName() {\n \n     @Override\n     public boolean compatibleWith(TargetType targetType) {\n-        return true;\n+        return targetType.equals(TargetType.CLASSIFICATION);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5814f7b4700c2f3fce40fbbeb793173557141c04"}, "originalPosition": 80}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjgwOTYyMg==", "bodyText": "Where does this string come from? Could we have a resource file with plain text instead?", "url": "https://github.com/elastic/elasticsearch/pull/51648#discussion_r372809622", "createdAt": "2020-01-30T08:19:37Z", "author": {"login": "przemekwitek"}, "path": "x-pack/plugin/core/src/test/java/org/elasticsearch/xpack/core/ml/inference/TrainedModelDefinitionTests.java", "diffHunk": "@@ -302,4 +306,67 @@ public void testRamUsageEstimation() {\n         assertThat(test.ramBytesUsed(), greaterThan(0L));\n     }\n \n+    public void testMultiClassIrisInference() throws IOException {\n+        // Fairly simple, random forest classification model built to fit in our format\n+        // Trained on the well known Iris dataset\n+        String compressedDef = \"H4sIAMHqMV4C/+1b7Y6bOhB9lVV+b5HHX9h9g/sMVYVo4iRIbBIBaXtV9d0vJr23uzGKJwwsu\" +", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5814f7b4700c2f3fce40fbbeb793173557141c04"}, "originalPosition": 26}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "eee0cf3a0a15ea9cb483edc618119859b53b67a4", "author": {"user": {"login": "benwtrent", "name": "Benjamin Trent"}}, "url": "https://github.com/elastic/elasticsearch/commit/eee0cf3a0a15ea9cb483edc618119859b53b67a4", "committedDate": "2020-01-30T14:17:32Z", "message": "changing param to classes_num"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUwODU5OTk1", "url": "https://github.com/elastic/elasticsearch/pull/51648#pullrequestreview-350859995", "createdAt": "2020-01-30T14:24:22Z", "commit": {"oid": "eee0cf3a0a15ea9cb483edc618119859b53b67a4"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6686d369bf82f1fa7f4b9d6c821ef164ad8b0286", "author": {"user": {"login": "benwtrent", "name": "Benjamin Trent"}}, "url": "https://github.com/elastic/elasticsearch/commit/6686d369bf82f1fa7f4b9d6c821ef164ad8b0286", "committedDate": "2020-01-30T17:27:01Z", "message": "fixing integration test"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3077, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}