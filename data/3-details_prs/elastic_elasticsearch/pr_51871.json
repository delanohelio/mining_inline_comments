{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzcwOTEyOTQx", "number": 51871, "title": "Percentiles aggregation validation checks for range", "bodyText": "disallow to specify percentile out of range [0,100]. This also fixes a problem in transform by failing validation if an invalid percentile configuration is used.\nNote: The duplication check is a breaking change if you are picky (question is, if it can be found in the wild). -> duplication moved out to PR: TBD\nFor release notes: Please list it under aggs (percentiles in transforms is a new feature for 7.7.0)\nrelates to #51808", "createdAt": "2020-02-04T15:53:17Z", "url": "https://github.com/elastic/elasticsearch/pull/51871", "merged": true, "mergeCommit": {"oid": "8b9e18ed1b502f5787c3751e8937d8e649ff45ed"}, "closed": true, "closedAt": "2020-02-11T16:24:16Z", "author": {"login": "hendrikmuhs"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcBb8nTgH2gAyMzcwOTEyOTQxOjhlMThlNjYyZWNmMjY1ODczZmY1ZDZjYzE1NmI4N2IyM2RmYmZmYWQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcDTjrIgFqTM1Njc1NzIzMw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "8e18e662ecf265873ff5d6cc156b87b23dfbffad", "author": {"user": {"login": "hendrikmuhs", "name": "Hendrik Muhs"}}, "url": "https://github.com/elastic/elasticsearch/commit/8e18e662ecf265873ff5d6cc156b87b23dfbffad", "committedDate": "2020-02-05T20:13:39Z", "message": "disallow duplicate percentile definitions and out of range"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "442fb226130c1f6f1eecc11611de2d1dfa6e237f", "author": {"user": {"login": "hendrikmuhs", "name": "Hendrik Muhs"}}, "url": "https://github.com/elastic/elasticsearch/commit/442fb226130c1f6f1eecc11611de2d1dfa6e237f", "committedDate": "2020-02-05T20:13:39Z", "message": "adapt tests to avoid duplicates for percentiles"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "41fe6b8a5025c4ceba3e649aae69653812556f4a", "author": {"user": {"login": "hendrikmuhs", "name": "Hendrik Muhs"}}, "url": "https://github.com/elastic/elasticsearch/commit/41fe6b8a5025c4ceba3e649aae69653812556f4a", "committedDate": "2020-02-05T11:03:42Z", "message": "adapt tests to avoid duplicates for percentiles"}, "afterCommit": {"oid": "442fb226130c1f6f1eecc11611de2d1dfa6e237f", "author": {"user": {"login": "hendrikmuhs", "name": "Hendrik Muhs"}}, "url": "https://github.com/elastic/elasticsearch/commit/442fb226130c1f6f1eecc11611de2d1dfa6e237f", "committedDate": "2020-02-05T20:13:39Z", "message": "adapt tests to avoid duplicates for percentiles"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5f0cc8fc513e43b3b8401532033097f52dd290e9", "author": {"user": {"login": "hendrikmuhs", "name": "Hendrik Muhs"}}, "url": "https://github.com/elastic/elasticsearch/commit/5f0cc8fc513e43b3b8401532033097f52dd290e9", "committedDate": "2020-02-06T08:15:34Z", "message": "fix one more wrong percentile test"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU0NjE5ODQx", "url": "https://github.com/elastic/elasticsearch/pull/51871#pullrequestreview-354619841", "createdAt": "2020-02-06T17:05:01Z", "commit": {"oid": "5f0cc8fc513e43b3b8401532033097f52dd290e9"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNlQxNzowNTowMlrOFmjAUA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNlQxNzowNjoxMlrOFmjDCg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTk2MzcyOA==", "bodyText": "while uniquePercentails.size() < length?", "url": "https://github.com/elastic/elasticsearch/pull/51871#discussion_r375963728", "createdAt": "2020-02-06T17:05:02Z", "author": {"login": "nik9000"}, "path": "server/src/test/java/org/elasticsearch/search/aggregations/metrics/HDRPercentilesIT.java", "diffHunk": "@@ -67,21 +69,21 @@\n \n     private static double[] randomPercentiles() {\n         final int length = randomIntBetween(1, 20);\n-        final double[] percentiles = new double[length];\n-        for (int i = 0; i < percentiles.length; ++i) {\n+        final Set<Double> uniquedPercentiles = new HashSet<>();\n+        for (int i = 0; i < length; ++i) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5f0cc8fc513e43b3b8401532033097f52dd290e9"}, "originalPosition": 30}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTk2NDQyNg==", "bodyText": "I think this should have an extra space after if and before (.", "url": "https://github.com/elastic/elasticsearch/pull/51871#discussion_r375964426", "createdAt": "2020-02-06T17:06:12Z", "author": {"login": "nik9000"}, "path": "server/src/main/java/org/elasticsearch/search/aggregations/metrics/PercentilesAggregationBuilder.java", "diffHunk": "@@ -181,6 +181,18 @@ public PercentilesAggregationBuilder percentiles(double... percents) {\n         }\n         double[] sortedPercents = Arrays.copyOf(percents, percents.length);\n         Arrays.sort(sortedPercents);\n+        double previousPercent = -1.0;\n+        for (double percent : sortedPercents) {\n+            if (percent < 0.0 || percent > 100.0) {\n+                throw new IllegalArgumentException(\"percent must be in [0,100], got [\" + percent + \"]: [\" + name + \"]\");\n+            }\n+\n+            if(percent == previousPercent) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5f0cc8fc513e43b3b8401532033097f52dd290e9"}, "originalPosition": 10}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "43dcf62a4fc4a64217d5351a5cecba250c07a06d", "author": {"user": {"login": "hendrikmuhs", "name": "Hendrik Muhs"}}, "url": "https://github.com/elastic/elasticsearch/commit/43dcf62a4fc4a64217d5351a5cecba250c07a06d", "committedDate": "2020-02-07T09:49:12Z", "message": "remove the duplication check, tbd for a separate 8.0 only PR"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3726ea8dfc1c0cecb9522207c0fa9334fcd38b2b", "author": {"user": {"login": "hendrikmuhs", "name": "Hendrik Muhs"}}, "url": "https://github.com/elastic/elasticsearch/commit/3726ea8dfc1c0cecb9522207c0fa9334fcd38b2b", "committedDate": "2020-02-07T09:49:34Z", "message": "apply review suggestion"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b3fe9a1dfe879c654fd4e7f926b64235c0a4486b", "author": {"user": {"login": "hendrikmuhs", "name": "Hendrik Muhs"}}, "url": "https://github.com/elastic/elasticsearch/commit/b3fe9a1dfe879c654fd4e7f926b64235c0a4486b", "committedDate": "2020-02-07T09:53:12Z", "message": "remove unit test for dups"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU2NzU3MjMz", "url": "https://github.com/elastic/elasticsearch/pull/51871#pullrequestreview-356757233", "createdAt": "2020-02-11T15:35:02Z", "commit": {"oid": "b3fe9a1dfe879c654fd4e7f926b64235c0a4486b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3015, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}