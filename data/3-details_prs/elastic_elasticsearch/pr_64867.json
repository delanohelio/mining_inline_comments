{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE4NTAzNDc3", "number": 64867, "title": "Remove the deprecated local parameter for _cat/shards", "bodyText": "The cat shards API performs a ClusterStateAction and then an IndicesStatsAction. Today it accepts the ?local parameter and passes this to the ClusterStateAction but this parameter has no effect on the IndicesStatsAction. This can be surprising because GET _cat/shards?local looks like it might be a completely local call but in fact it still depends on every node in the cluster.\nThe local parameter was deprecated in 7.x (#62197) and this commit removes it for 8.x.", "createdAt": "2020-11-10T13:51:48Z", "url": "https://github.com/elastic/elasticsearch/pull/64867", "merged": true, "mergeCommit": {"oid": "f63a3b5cdca3e6ecb05fbcc5c7ce9127924d36d3"}, "closed": true, "closedAt": "2020-11-13T13:34:16Z", "author": {"login": "danhermann"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdbJoFRgH2gAyNTE4NTAzNDc3OmE4MDllNGFkN2I3Zjg5ODU2ODU5ZWI1MmNkZjMyZTUyZGVjMjUwMzc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdbiKTagFqTUyODQyNTc0OA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "a809e4ad7b7f89856859eb52cdf32e52dec25037", "author": {"user": {"login": "danhermann", "name": "Dan Hermann"}}, "url": "https://github.com/elastic/elasticsearch/commit/a809e4ad7b7f89856859eb52cdf32e52dec25037", "committedDate": "2020-11-10T13:46:07Z", "message": "Remove the deprecated local parameter for _cat/shards"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI3MzkwMzQy", "url": "https://github.com/elastic/elasticsearch/pull/64867#pullrequestreview-527390342", "createdAt": "2020-11-10T16:36:16Z", "commit": {"oid": "a809e4ad7b7f89856859eb52cdf32e52dec25037"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQxNjozNjoxN1rOHwlPFQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQxNjozNjoxN1rOHwlPFQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDcwMzc2NQ==", "bodyText": "You don't need to add this I believe, we automatically throw exceptions on unrecognized parameters:\n{\n  \"error\" : {\n    \"root_cause\" : [\n      {\n        \"type\" : \"illegal_argument_exception\",\n        \"reason\" : \"request [/_cat/shards] contains unrecognized parameter: [aoeu]\"\n      }\n    ],\n    \"type\" : \"illegal_argument_exception\",\n    \"reason\" : \"request [/_cat/shards] contains unrecognized parameter: [aoeu]\"\n  },\n  \"status\" : 400\n}", "url": "https://github.com/elastic/elasticsearch/pull/64867#discussion_r520703765", "createdAt": "2020-11-10T16:36:17Z", "author": {"login": "dakrone"}, "path": "server/src/main/java/org/elasticsearch/rest/action/cat/RestShardsAction.java", "diffHunk": "@@ -90,10 +88,10 @@ protected void documentation(StringBuilder sb) {\n     public RestChannelConsumer doCatRequest(final RestRequest request, final NodeClient client) {\n         final String[] indices = Strings.splitStringByCommaToArray(request.param(\"index\"));\n         final ClusterStateRequest clusterStateRequest = new ClusterStateRequest();\n-        if (request.hasParam(\"local\")) {\n-            DEPRECATION_LOGGER.deprecate(\"local\", LOCAL_DEPRECATED_MESSAGE);\n+        // needed only in v8 to catch breaking usages and can be removed in v9\n+        if (request.hasParam(\"local\")  && Version.CURRENT.major == Version.V_7_0_0.major + 1) {\n+            throw new IllegalArgumentException(\"parameter [local] is not supported\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a809e4ad7b7f89856859eb52cdf32e52dec25037"}, "originalPosition": 33}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "26384068e89f06a84183e98d5e9ead4cf5628a18", "author": {"user": {"login": "danhermann", "name": "Dan Hermann"}}, "url": "https://github.com/elastic/elasticsearch/commit/26384068e89f06a84183e98d5e9ead4cf5628a18", "committedDate": "2020-11-11T17:04:26Z", "message": "remove redundant check"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "490011895ad0da61cc049ac901150cebc06d129e", "author": {"user": {"login": "elasticmachine", "name": "Elastic Machine"}}, "url": "https://github.com/elastic/elasticsearch/commit/490011895ad0da61cc049ac901150cebc06d129e", "committedDate": "2020-11-11T17:25:07Z", "message": "Merge branch 'master' into remove_local_for_cat_shards"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI4NDI1NzQ4", "url": "https://github.com/elastic/elasticsearch/pull/64867#pullrequestreview-528425748", "createdAt": "2020-11-11T18:21:13Z", "commit": {"oid": "490011895ad0da61cc049ac901150cebc06d129e"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1142, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}