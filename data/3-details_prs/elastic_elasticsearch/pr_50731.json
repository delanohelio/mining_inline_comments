{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzYwMzgxNDI3", "number": 50731, "title": "Work around JVM Bug in LongGCDisruptionTests", "bodyText": "There is a JVM bug causing Thread#suspend calls to randomly take\nmultiple seconds breaking these tests that call the method numerous times\nin a loop. Increasing the timeout would will not work since we may call\nsuspend tens if not hundreds of times and even a small number of them\nexperiencing the blocking will lead to multiple minutes of waiting.\nThis PR detects the specific issue by timing the Thread#suspend calls and\nskips the remainder of the test if it timed out because of the JVM bug.\nCloses #50047", "createdAt": "2020-01-08T10:17:27Z", "url": "https://github.com/elastic/elasticsearch/pull/50731", "merged": true, "mergeCommit": {"oid": "375c1405027fe482b4214e8f0525605666ec4b62"}, "closed": true, "closedAt": "2020-01-14T13:38:34Z", "author": {"login": "original-brownbear"}, "timelineItems": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb4SeoNAH2gAyMzYwMzgxNDI3OjUwNjdmNmQyYTFjODVjZDMwMTQ2OGE0MTkwNTc1NzIyMWJlODRkOTA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABb6Q_5ygFqTM0MjUzMDg5MQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "5067f6d2a1c85cd301468a41905757221be84d90", "author": {"user": {"login": "original-brownbear", "name": "Armin Braun"}}, "url": "https://github.com/elastic/elasticsearch/commit/5067f6d2a1c85cd301468a41905757221be84d90", "committedDate": "2020-01-08T10:06:26Z", "message": "Work around JVM Bug in LongGCDisruptionTests\n\nThere is a JVM bug causing `Thread#suspend` calls to randomly take\nmultiple seconds breaking these tests that call the method numerous times\nin a loop. Increasing the timeout would will not work since we may call\n`suspend` tens if not hundreds of times and even a small number of them\nexperiencing the blocking will lead to multiple minutes of waiting.\n\nThis PR detects the specific issue by timing the `Thread#suspend` calls and\nskips the remainder of the test if it timed out because of the JVM bug.\n\nCloses #50047"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzM5ODgzNTk4", "url": "https://github.com/elastic/elasticsearch/pull/50731#pullrequestreview-339883598", "createdAt": "2020-01-08T14:04:52Z", "commit": {"oid": "5067f6d2a1c85cd301468a41905757221be84d90"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOFQxNDowNDo1MlrOFbX1aQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOFQxNDowNDo1MlrOFbX1aQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDI0NjM3Nw==", "bodyText": "Could we make this conditional on the JVM version so that we are sure to keep tracking that JVM bug and to drop this fix when it's no longer needed?", "url": "https://github.com/elastic/elasticsearch/pull/50731#discussion_r364246377", "createdAt": "2020-01-08T14:04:52Z", "author": {"login": "DaveCTurner"}, "path": "test/framework/src/main/java/org/elasticsearch/test/disruption/LongGCDisruption.java", "diffHunk": "@@ -251,7 +265,11 @@ protected boolean suspendThreads(Set<Thread> nodeThreads) {\n                          * assuming that it is safe.\n                          */\n                         boolean definitelySafe = true;\n+                        final long startTime = System.nanoTime();\n                         thread.suspend();\n+                        if (System.nanoTime() - startTime > TimeUnit.SECONDS.toNanos(3L)) {\n+                            sawSlowSuspendBug.set(true);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5067f6d2a1c85cd301468a41905757221be84d90"}, "originalPosition": 40}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQyNTMwODkx", "url": "https://github.com/elastic/elasticsearch/pull/50731#pullrequestreview-342530891", "createdAt": "2020-01-14T13:30:49Z", "commit": {"oid": "5067f6d2a1c85cd301468a41905757221be84d90"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3907, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}