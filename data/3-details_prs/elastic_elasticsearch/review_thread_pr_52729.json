{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc5MjE2MjU1", "number": 52729, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNFQyMDo0NzoyNFrODieM3A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNFQyMDo1MDowM1rODieQHQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM3NDcyOTg4OnYy", "diffSide": "RIGHT", "path": "server/src/main/java/org/elasticsearch/search/aggregations/support/ValuesSourceConfig.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNFQyMDo0NzoyNFrOFtvSjw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNFQyMDo0NzozM1rOFtvS7g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzUwNTAzOQ==", "bodyText": "Maybe a static method would be better for these two?", "url": "https://github.com/elastic/elasticsearch/pull/52729#discussion_r383505039", "createdAt": "2020-02-24T20:47:24Z", "author": {"login": "nik9000"}, "path": "server/src/main/java/org/elasticsearch/search/aggregations/support/ValuesSourceConfig.java", "diffHunk": "@@ -152,21 +137,55 @@ private static DocValueFormat resolveFormat(@Nullable String format, @Nullable V\n         return valuesSourceType.getFormatter(format, tz);\n     }\n \n-    private final ValuesSourceType valueSourceType;\n+    private final ValuesSourceType valuesSourceType;\n     private FieldContext fieldContext;\n     private AggregationScript.LeafFactory script;\n     private ValueType scriptValueType;\n-    private boolean unmapped = false;\n+    private boolean unmapped;\n     private DocValueFormat format = DocValueFormat.RAW;\n     private Object missing;\n     private ZoneId timeZone;\n+    private LongSupplier now;\n+\n+\n+    /**\n+     * Config instances which only need to specify a field should use this constructor\n+     */\n+    public ValuesSourceConfig(ValuesSourceType valuesSourceType,\n+                              MappedFieldType fieldType,\n+                              QueryShardContext queryShardContext) {\n+        this(valuesSourceType, fieldType, false, null, null, queryShardContext);\n+    }\n+\n+    /**\n+     * Convenience method for creating unmapped configs\n+     */\n+    public ValuesSourceConfig(ValuesSourceType valuesSourceType, QueryShardContext queryShardContext) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0ecc7d9f26bf8c64df7f4a38f9b44acf5bbf1960"}, "originalPosition": 141}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzUwNTEzNA==", "bodyText": "They'd have names, at least.", "url": "https://github.com/elastic/elasticsearch/pull/52729#discussion_r383505134", "createdAt": "2020-02-24T20:47:33Z", "author": {"login": "nik9000"}, "path": "server/src/main/java/org/elasticsearch/search/aggregations/support/ValuesSourceConfig.java", "diffHunk": "@@ -152,21 +137,55 @@ private static DocValueFormat resolveFormat(@Nullable String format, @Nullable V\n         return valuesSourceType.getFormatter(format, tz);\n     }\n \n-    private final ValuesSourceType valueSourceType;\n+    private final ValuesSourceType valuesSourceType;\n     private FieldContext fieldContext;\n     private AggregationScript.LeafFactory script;\n     private ValueType scriptValueType;\n-    private boolean unmapped = false;\n+    private boolean unmapped;\n     private DocValueFormat format = DocValueFormat.RAW;\n     private Object missing;\n     private ZoneId timeZone;\n+    private LongSupplier now;\n+\n+\n+    /**\n+     * Config instances which only need to specify a field should use this constructor\n+     */\n+    public ValuesSourceConfig(ValuesSourceType valuesSourceType,\n+                              MappedFieldType fieldType,\n+                              QueryShardContext queryShardContext) {\n+        this(valuesSourceType, fieldType, false, null, null, queryShardContext);\n+    }\n+\n+    /**\n+     * Convenience method for creating unmapped configs\n+     */\n+    public ValuesSourceConfig(ValuesSourceType valuesSourceType, QueryShardContext queryShardContext) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzUwNTAzOQ=="}, "originalCommit": {"oid": "0ecc7d9f26bf8c64df7f4a38f9b44acf5bbf1960"}, "originalPosition": 141}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM3NDczODIxOnYy", "diffSide": "RIGHT", "path": "server/src/main/java/org/elasticsearch/search/aggregations/support/ValuesSourceConfig.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNFQyMDo1MDowM1rOFtvXjQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNFQyMDo1MDowM1rOFtvXjQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzUwNjMxNw==", "bodyText": "nowSupplier?", "url": "https://github.com/elastic/elasticsearch/pull/52729#discussion_r383506317", "createdAt": "2020-02-24T20:50:03Z", "author": {"login": "nik9000"}, "path": "server/src/main/java/org/elasticsearch/search/aggregations/support/ValuesSourceConfig.java", "diffHunk": "@@ -152,21 +137,55 @@ private static DocValueFormat resolveFormat(@Nullable String format, @Nullable V\n         return valuesSourceType.getFormatter(format, tz);\n     }\n \n-    private final ValuesSourceType valueSourceType;\n+    private final ValuesSourceType valuesSourceType;\n     private FieldContext fieldContext;\n     private AggregationScript.LeafFactory script;\n     private ValueType scriptValueType;\n-    private boolean unmapped = false;\n+    private boolean unmapped;\n     private DocValueFormat format = DocValueFormat.RAW;\n     private Object missing;\n     private ZoneId timeZone;\n+    private LongSupplier now;\n+\n+\n+    /**\n+     * Config instances which only need to specify a field should use this constructor\n+     */\n+    public ValuesSourceConfig(ValuesSourceType valuesSourceType,\n+                              MappedFieldType fieldType,\n+                              QueryShardContext queryShardContext) {\n+        this(valuesSourceType, fieldType, false, null, null, queryShardContext);\n+    }\n+\n+    /**\n+     * Convenience method for creating unmapped configs\n+     */\n+    public ValuesSourceConfig(ValuesSourceType valuesSourceType, QueryShardContext queryShardContext) {\n+        this(valuesSourceType, null, true, null, null, queryShardContext);\n+    }\n+\n+    public ValuesSourceConfig(ValuesSourceType valuesSourceType,\n+                              MappedFieldType fieldType,\n+                              boolean unmapped,\n+                              AggregationScript.LeafFactory script,\n+                              ValueType scriptValueType,\n+                              QueryShardContext queryShardContext) {\n+        if (unmapped && fieldType != null) {\n+            throw new IllegalStateException(\"value source config is invalid; marked as unmapped but specified a mapped field\");\n+        }\n+        this.valuesSourceType = valuesSourceType;\n+        if (fieldType != null) {\n+            this.fieldContext = new FieldContext(fieldType.name(), queryShardContext.getForField(fieldType), fieldType);\n+        }\n+        this.unmapped = unmapped;\n+        this.script = script;\n+        this.scriptValueType = scriptValueType;\n+        this.now = queryShardContext::nowInMillis;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0ecc7d9f26bf8c64df7f4a38f9b44acf5bbf1960"}, "originalPosition": 161}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3766, "cost": 1, "resetAt": "2021-11-12T19:05:54Z"}}}