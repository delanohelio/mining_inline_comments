{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ5MzM4NjQ3", "number": 59592, "title": "Decrease restore rate limit value to enforce its usage on SearchableSnapshotsIntegTests#testMaxRestoreBytesPerSecIsUsed", "bodyText": "It seems like the rate limit value for max_restore_bytes_per_sec is\ntoo close to the size of some of the generated shards, so in certain\nscenarios the rate limiter isn't triggered.\nFixes #59287", "createdAt": "2020-07-15T08:47:15Z", "url": "https://github.com/elastic/elasticsearch/pull/59592", "merged": true, "mergeCommit": {"oid": "bb5313b24595871c72ba9dd3d87b952b9b5ead8b"}, "closed": true, "closedAt": "2020-07-16T08:52:28Z", "author": {"login": "fcofdez"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc1GiIpgH2gAyNDQ5MzM4NjQ3OmQ3NTM5MDhjYmY3MjA5NWIwNzE4OGU4ZGRlZTA0NjRmZjgyY2YwNGM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc1ID-XgFqTQ0ODgyNjA4Nw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "d753908cbf72095b07188e8ddee0464ff82cf04c", "author": {"user": {"login": "fcofdez", "name": "Francisco Fern\u00e1ndez Casta\u00f1o"}}, "url": "https://github.com/elastic/elasticsearch/commit/d753908cbf72095b07188e8ddee0464ff82cf04c", "committedDate": "2020-07-15T08:40:47Z", "message": "Decrease restore rate limit value to enforce its usage on SearchableSnapshotsIntegTests#testMaxRestoreBytesPerSecIsUsed"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ4NzgwOTMx", "url": "https://github.com/elastic/elasticsearch/pull/59592#pullrequestreview-448780931", "createdAt": "2020-07-15T09:25:13Z", "commit": {"oid": "d753908cbf72095b07188e8ddee0464ff82cf04c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNVQwOToyNToxM1rOGx121Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNVQwOToyNToxM1rOGx121Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDkxNTc5Nw==", "bodyText": "Do you think that we could find the \"best\" value here if we don't randomize anything when indexing documents later in this test so that we have more predictable shard file sizes?", "url": "https://github.com/elastic/elasticsearch/pull/59592#discussion_r454915797", "createdAt": "2020-07-15T09:25:13Z", "author": {"login": "tlrx"}, "path": "x-pack/plugin/searchable-snapshots/src/test/java/org/elasticsearch/xpack/searchablesnapshots/SearchableSnapshotsIntegTests.java", "diffHunk": "@@ -350,13 +350,12 @@ public void testCanMountSnapshotTakenWhileConcurrentlyIndexing() throws Exceptio\n         ensureGreen(restoredIndexName);\n     }\n \n-    @AwaitsFix(bugUrl = \"https://github.com/elastic/elasticsearch/issues/59287\")\n     public void testMaxRestoreBytesPerSecIsUsed() throws Exception {\n         final String repositoryName = randomAlphaOfLength(10).toLowerCase(Locale.ROOT);\n         final Settings.Builder repositorySettings = Settings.builder().put(\"location\", randomRepoPath());\n         final boolean useRateLimits = randomBoolean();\n         if (useRateLimits) {\n-            repositorySettings.put(\"max_restore_bytes_per_sec\", new ByteSizeValue(10, ByteSizeUnit.KB));\n+            repositorySettings.put(\"max_restore_bytes_per_sec\", new ByteSizeValue(5, ByteSizeUnit.KB));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d753908cbf72095b07188e8ddee0464ff82cf04c"}, "originalPosition": 11}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b0c17d1843926cfc28005c896dfba7e7d722f317", "author": {"user": {"login": "fcofdez", "name": "Francisco Fern\u00e1ndez Casta\u00f1o"}}, "url": "https://github.com/elastic/elasticsearch/commit/b0c17d1843926cfc28005c896dfba7e7d722f317", "committedDate": "2020-07-15T10:12:32Z", "message": "Use the actual shard sizes instead of an arbitrary value to set the rate\nlimiter value."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ4ODI2MDg3", "url": "https://github.com/elastic/elasticsearch/pull/59592#pullrequestreview-448826087", "createdAt": "2020-07-15T10:27:39Z", "commit": {"oid": "b0c17d1843926cfc28005c896dfba7e7d722f317"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4371, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}