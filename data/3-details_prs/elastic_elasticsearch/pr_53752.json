{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzkwNTYzMzYz", "number": 53752, "title": "Report parser name and location in XContent deprecation warnings", "bodyText": "It's simple to deprecate a field used in an ObjectParser just by adding deprecation\nmarkers to the relevant ParseField objects.  The warnings themselves don't currently\nhave any context - they simply say that a deprecated field has been used, but not\nwhere in the input xcontent it appears.  This commit adds the parent object parser\nname and XContentLocation to these deprecation messages.", "createdAt": "2020-03-18T17:15:15Z", "url": "https://github.com/elastic/elasticsearch/pull/53752", "merged": true, "mergeCommit": {"oid": "7636930ceb0c20ea34f2b9db42094a0a2af75f03"}, "closed": true, "closedAt": "2020-03-19T11:26:05Z", "author": {"login": "romseygeek"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcO6h_1gH2gAyMzkwNTYzMzYzOjg4ZjZhZDEwMGFjODg3ZGJlYTkxZTI4MDNlMDMwMzA4N2E5OGRiMmU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcPJcLOAFqTM3NzU5NzUyOQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "88f6ad100ac887dbea91e2803e0303087a98db2e", "author": {"user": {"login": "romseygeek", "name": "Alan Woodward"}}, "url": "https://github.com/elastic/elasticsearch/commit/88f6ad100ac887dbea91e2803e0303087a98db2e", "committedDate": "2020-03-18T17:12:39Z", "message": "Report parser name and location in XContent deprecation warnings"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b716af4292661b6bf0dffc0b3720f849d2fc0ca7", "author": {"user": {"login": "romseygeek", "name": "Alan Woodward"}}, "url": "https://github.com/elastic/elasticsearch/commit/b716af4292661b6bf0dffc0b3720f849d2fc0ca7", "committedDate": "2020-03-18T17:46:52Z", "message": "test fix"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d070a61ea17af1f86948efab2fb5e8c4e424ad95", "author": {"user": {"login": "romseygeek", "name": "Alan Woodward"}}, "url": "https://github.com/elastic/elasticsearch/commit/d070a61ea17af1f86948efab2fb5e8c4e424ad95", "committedDate": "2020-03-18T17:56:52Z", "message": "warnings context for ml"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc3NTQ3NzU1", "url": "https://github.com/elastic/elasticsearch/pull/53752#pullrequestreview-377547755", "createdAt": "2020-03-19T09:26:27Z", "commit": {"oid": "d070a61ea17af1f86948efab2fb5e8c4e424ad95"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOVQwOToyNjoyN1rOF4mM5w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOVQwOToyNjoyN1rOF4mM5w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDg5MDQ3MQ==", "bodyText": "The only suggestion I'd make is about whether it's possible to consolidate the log messages. For example:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    if (parserName != null) {\n          \n          \n            \n                        deprecationLogger.deprecated(\"[{}][{}] Deprecated field [{}] used, expected [{}] instead\",\n          \n          \n            \n                            parserName, location.get(), usedName, modernName);\n          \n          \n            \n                    } else {\n          \n          \n            \n                        deprecationLogger.deprecated(\"Deprecated field [{}] used, expected [{}] instead\", usedName, modernName);\n          \n          \n            \n                    }\n          \n          \n            \n                    String prefix = parserName == null ? \"\" :\n          \n          \n            \n                        \"[\" + parserName + \"][\" + location.get() + \"] \";\n          \n          \n            \n                    deprecationLogger.deprecated(\"{}Deprecated field [{}] used, expected [{}] instead\", prefix, usedName, modernName);", "url": "https://github.com/elastic/elasticsearch/pull/53752#discussion_r394890471", "createdAt": "2020-03-19T09:26:27Z", "author": {"login": "pugnascotia"}, "path": "server/src/main/java/org/elasticsearch/common/xcontent/LoggingDeprecationHandler.java", "diffHunk": "@@ -49,17 +51,33 @@ private LoggingDeprecationHandler() {\n     }\n \n     @Override\n-    public void usedDeprecatedName(String usedName, String modernName) {\n-        deprecationLogger.deprecated(\"Deprecated field [{}] used, expected [{}] instead\", usedName, modernName);\n+    public void usedDeprecatedName(String parserName, Supplier<XContentLocation> location, String usedName, String modernName) {\n+        if (parserName != null) {\n+            deprecationLogger.deprecated(\"[{}][{}] Deprecated field [{}] used, expected [{}] instead\",\n+                parserName, location.get(), usedName, modernName);\n+        } else {\n+            deprecationLogger.deprecated(\"Deprecated field [{}] used, expected [{}] instead\", usedName, modernName);\n+        }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d070a61ea17af1f86948efab2fb5e8c4e424ad95"}, "originalPosition": 21}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc3NTQ3ODAw", "url": "https://github.com/elastic/elasticsearch/pull/53752#pullrequestreview-377547800", "createdAt": "2020-03-19T09:26:31Z", "commit": {"oid": "d070a61ea17af1f86948efab2fb5e8c4e424ad95"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e0a74921aaa3390ffc8039b786f90e8d3dc88400", "author": {"user": {"login": "romseygeek", "name": "Alan Woodward"}}, "url": "https://github.com/elastic/elasticsearch/commit/e0a74921aaa3390ffc8039b786f90e8d3dc88400", "committedDate": "2020-03-19T09:44:21Z", "message": "feedback, tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "95b20db90e896ab637a57a3aec3f6e6ef958edbc", "author": {"user": {"login": "romseygeek", "name": "Alan Woodward"}}, "url": "https://github.com/elastic/elasticsearch/commit/95b20db90e896ab637a57a3aec3f6e6ef958edbc", "committedDate": "2020-03-19T09:59:41Z", "message": "no really"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc3NTkzMzI0", "url": "https://github.com/elastic/elasticsearch/pull/53752#pullrequestreview-377593324", "createdAt": "2020-03-19T10:28:48Z", "commit": {"oid": "e0a74921aaa3390ffc8039b786f90e8d3dc88400"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOVQxMDoyODo0OVrOF4ob2w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOVQxMDoyODo0OVrOF4ob2w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDkyNzA2Nw==", "bodyText": "This doesn't look right \ud83e\udd14", "url": "https://github.com/elastic/elasticsearch/pull/53752#discussion_r394927067", "createdAt": "2020-03-19T10:28:49Z", "author": {"login": "pugnascotia"}, "path": "server/src/main/java/org/elasticsearch/common/xcontent/LoggingDeprecationHandler.java", "diffHunk": "@@ -52,30 +52,24 @@ private LoggingDeprecationHandler() {\n \n     @Override\n     public void usedDeprecatedName(String parserName, Supplier<XContentLocation> location, String usedName, String modernName) {\n-        if (parserName != null) {\n-            deprecationLogger.deprecated(\"[{}][{}] Deprecated field [{}] used, expected [{}] instead\",\n-                parserName, location.get(), usedName, modernName);\n-        } else {\n-            deprecationLogger.deprecated(\"Deprecated field [{}] used, expected [{}] instead\", usedName, modernName);\n-        }\n+        String prefix = parserName == null ? \"\" : \"[\" + parserName + \"][\" + location.get() + \"] \";\n+        deprecationLogger.deprecated(\"{}Deprecated field [{}] used, expected [{}] instead\",\n+            prefix, usedName, modernName);\n     }\n \n     @Override\n     public void usedDeprecatedField(String parserName, Supplier<XContentLocation> location, String usedName, String replacedWith) {\n-        if (parserName != null) {\n-            deprecationLogger.deprecated(\"[{}][{}] Deprecated field [{}] used, replaced by [{}]\",\n-                parserName, location.get(), usedName, replacedWith);\n-        }\n-        else {\n-            deprecationLogger.deprecated(\"Deprecated field [{}] used, replaced by [{}]\", usedName, replacedWith);\n-        }\n+        String prefix = parserName == null ? \"\" : \"[\" + parserName + \"][\" + location.get() + \"] \";\n+        deprecationLogger.deprecated(\"{} Deprecated field [{}] used, replaced by [{}]\",\n+            prefix, usedName, replacedWith);\n     }\n \n     @Override\n     public void usedDeprecatedField(String parserName, Supplier<XContentLocation> location, String usedName) {\n-        if (parserName != null) {\n-            deprecationLogger.deprecated(\"[{}][{}] Deprecated field [{}] used, this field is unused and will be removed entirely\",\n-                parserName, location.get(), usedName);\n+        String prefix = parserName == null ? \"\" : \"[\" + parserName + \"][\" + location.get() + \"] \";\n+        if (true) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e0a74921aaa3390ffc8039b786f90e8d3dc88400"}, "originalPosition": 35}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc3NTk3NTI5", "url": "https://github.com/elastic/elasticsearch/pull/53752#pullrequestreview-377597529", "createdAt": "2020-03-19T10:34:52Z", "commit": {"oid": "95b20db90e896ab637a57a3aec3f6e6ef958edbc"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2022, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}