{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDEyNjg5Mzkz", "number": 56090, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNFQxNDo1OTozMVrOD5B0uA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNFQxNTowNTowMFrOD5B-hQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYxMTI1MzA0OnYy", "diffSide": "RIGHT", "path": "x-pack/plugin/watcher/src/main/java/org/elasticsearch/xpack/watcher/notification/email/Account.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNFQxNDo1OTozMVrOGQEW7A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNFQxNDo1OTozMVrOGQEW7A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTUwMTgwNA==", "bodyText": "The word \"explicit\" is a bit vague to me. Both \"mail.smtp.ssl\" and \"xpack.notification.email.ssl\" feel explicit to me. Also isExplicitlyConfigured means  \"xpack.notification.email.ssl\" is not empty, which is opposite to what it means here.\nMaybe change it to something like:\nSpecific smtp SSL settings [{}] of account [{}] will be ignored due to notification SSL settings [{}].\nOr we could even drop the word \"Specific\" and just say \"smtp ...\", since it feels odds for specific settings to be overridden by more general settings.", "url": "https://github.com/elastic/elasticsearch/pull/56090#discussion_r419501804", "createdAt": "2020-05-04T14:59:31Z", "author": {"login": "ywangd"}, "path": "x-pack/plugin/watcher/src/main/java/org/elasticsearch/xpack/watcher/notification/email/Account.java", "diffHunk": "@@ -197,6 +200,15 @@ private void setContextClassLoader(final ClassLoader classLoader) {\n                 throw new SettingsException(msg);\n             }\n             if (sslSocketFactory != null) {\n+                String sslKeys = smtp.properties.keySet().stream()\n+                    .map(String::valueOf)\n+                    .filter(key -> key.startsWith(\"mail.smtp.ssl.\"))\n+                    .collect(Collectors.joining(\",\"));\n+                if (sslKeys.isEmpty() == false) {\n+                    logger.warn(\"Account [{}] has explicit SSL settings [{}] which will be ignored\" +\n+                            \" due to notification SSL settings in [{}]\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "21e6cc8aa0aa95eb5e72ef0c1f65bac76f1d4ed3"}, "originalPosition": 29}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYxMTI3ODEzOnYy", "diffSide": "RIGHT", "path": "x-pack/plugin/watcher/src/test/java/org/elasticsearch/xpack/watcher/actions/email/EmailSslTests.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNFQxNTowNTowMFrOGQEmog==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNFQxNTowNTowMFrOGQEmog==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTUwNTgyNg==", "bodyText": "Is this accurate? The verfication_mode should be set to full in the below code since ssl.trust gets overridden?", "url": "https://github.com/elastic/elasticsearch/pull/56090#discussion_r419505826", "createdAt": "2020-05-04T15:05:00Z", "author": {"login": "ywangd"}, "path": "x-pack/plugin/watcher/src/test/java/org/elasticsearch/xpack/watcher/actions/email/EmailSslTests.java", "diffHunk": "@@ -125,6 +125,52 @@ public void testCanSendMessageToSmtpServerByDisablingVerification() throws Excep\n         }\n     }\n \n+    public void testCanSendMessageToSmtpServerUsingSmtpSslTrust() throws Exception {\n+        assumeFalse(\"Can't run in a FIPS JVM with verification mode None\", inFipsJvm());\n+        List<MimeMessage> messages = new ArrayList<>();\n+        server.addListener(messages::add);\n+        try {\n+            final Settings.Builder settings = Settings.builder()\n+                .put(\"xpack.notification.email.account.test.smtp.ssl.trust\", \"localhost\");\n+            final MockSecureSettings secureSettings = new MockSecureSettings();\n+            ExecutableEmailAction emailAction = buildEmailAction(settings, secureSettings);\n+\n+            WatchExecutionContext ctx = WatcherTestUtils.createWatchExecutionContext();\n+            emailAction.execute(\"my_action_id\", ctx, Payload.EMPTY);\n+\n+            assertThat(messages, hasSize(1));\n+        } finally {\n+            server.clearListeners();\n+        }\n+    }\n+\n+    /**\n+     * This orderining could be considered to be backwards (the global \"notification\" settings take precedence\n+     * over the account level \"smtp.ssl.trust\" setting) but smtp.ssl.trust was ignored for a period of time (see #52153)\n+     * so this is the least breaking way to resolve that.\n+     */\n+    public void testNotificationSslSettingsOverrideSmtpSslTrust() throws Exception {\n+        assumeFalse(\"Can't run in a FIPS JVM with verification mode None\", inFipsJvm());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "21e6cc8aa0aa95eb5e72ef0c1f65bac76f1d4ed3"}, "originalPosition": 29}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2448, "cost": 1, "resetAt": "2021-11-12T13:16:51Z"}}}