{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE0OTE1ODgw", "number": 64550, "title": "[DOCS] Document upgrade process for concurrency control", "bodyText": "Documents how to upgrade concurrency control from internal versioning to sequence numbers.\nAdds the docs to the 7.0 breaking changes.\nCloses #63747\nPreview\nhttps://elasticsearch_64550.docs-preview.app.elstc.co/guide/en/elasticsearch/reference/7.x/breaking-changes-7.0.html#_internal_versioning_is_no_longer_supported_for_optimistic_concurrency_control", "createdAt": "2020-11-03T18:22:40Z", "url": "https://github.com/elastic/elasticsearch/pull/64550", "merged": true, "mergeCommit": {"oid": "0f759a994eba63f92da738036d3ff220ed686eac"}, "closed": true, "closedAt": "2020-11-06T13:57:14Z", "author": {"login": "jrodewig"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdY9V-pAH2gAyNTE0OTE1ODgwOjRlYTI5YmU0ODM2YzEzZTU3ZTE2YWE0Y2YxY2FkOWM3MDg1OGVkNTA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdZ3BxDgH2gAyNTE0OTE1ODgwOjVhZDM2NDZiNjY1MGI2NzgwZTEzZDY4NTk2Nzc1Mzc3NTk4ZGViNmQ=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "4ea29be4836c13e57e16aa4cf1cad9c70858ed50", "author": {"user": {"login": "jrodewig", "name": "James Rodewig"}}, "url": "https://github.com/elastic/elasticsearch/commit/4ea29be4836c13e57e16aa4cf1cad9c70858ed50", "committedDate": "2020-11-03T18:19:38Z", "message": "[DOCS] Document upgrade process for concurrency control"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bb0d7bfd03090c73915108852c81d16730f02cd1", "author": {"user": {"login": "jrodewig", "name": "James Rodewig"}}, "url": "https://github.com/elastic/elasticsearch/commit/bb0d7bfd03090c73915108852c81d16730f02cd1", "committedDate": "2020-11-03T18:42:45Z", "message": "reword"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI1MTM0OTQ0", "url": "https://github.com/elastic/elasticsearch/pull/64550#pullrequestreview-525134944", "createdAt": "2020-11-06T13:10:49Z", "commit": {"oid": "bb0d7bfd03090c73915108852c81d16730f02cd1"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNlQxMzoxMDo0OVrOHutcEw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNlQxMzoxMDo0OVrOHutcEw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODc0MTAxMQ==", "bodyText": "nit: I wonder if it was a bit clearer what to look for if the response stated that the index was created in a 5.x version?", "url": "https://github.com/elastic/elasticsearch/pull/64550#discussion_r518741011", "createdAt": "2020-11-06T13:10:49Z", "author": {"login": "henningandersen"}, "path": "docs/reference/migration/migrate_7_0/api.asciidoc", "diffHunk": "@@ -22,9 +22,76 @@ while handling a write operation, it may expose a version that will then be reus\n new primary.\n \n Due to that issue, internal versioning can no longer be used and is replaced by a new\n-method based on sequence numbers. See <<optimistic-concurrency-control>> for more details.\n-\n-Note that the `external` versioning type is still fully supported.\n+method based on <<optimistic-concurrency-control,sequence numbers>>. To switch\n+to the new method, follow these steps:\n+\n+. Perform a <<rolling-upgrades,rolling upgrade>> to 6.8.\n+\n+. <<reindex-upgrade,Reindex>> any indices created before 6.0. This ensures\n+documents in those indices have sequence numbers.\n++\n+To get the {es} version in which an index was created, use the\n+<<indices-get-index,get index API>> with the `human` parameter:\n++\n+--\n+.*API Example*\n+[%collapsible]\n+====\n+[source,console]\n+----\n+GET /*?human\n+----\n+// TEST[setup:my_index]\n+\n+The response returns a `settings.index.version.created_string` property for\n+each index:\n+\n+[source,console-response]\n+----\n+{\n+  \"my-index-000001\": {\n+    ...\n+    \"settings\": {\n+      \"index\": {\n+        \"creation_date_string\": \"2099-01-01T00:00:00.000Z\",\n+        \"routing\": {\n+          \"allocation\": {\n+            \"include\": {\n+              \"_tier_preference\": \"data_content\"\n+            }\n+          }\n+        },\n+        \"number_of_shards\": \"1\",\n+        \"provided_name\": \"my-index-000001\",\n+        \"creation_date\": \"4070908800\",\n+        \"number_of_replicas\": \"1\",\n+        \"uuid\": \"c89-MHh8RwKwS1r7Turg2g\",\n+        \"version\": {\n+          \"created_string\": \"6.0.0\",           <1>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bb0d7bfd03090c73915108852c81d16730f02cd1"}, "originalPosition": 52}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5ad3646b6650b6780e13d68596775377598deb6d", "author": {"user": {"login": "jrodewig", "name": "James Rodewig"}}, "url": "https://github.com/elastic/elasticsearch/commit/5ad3646b6650b6780e13d68596775377598deb6d", "committedDate": "2020-11-06T13:32:03Z", "message": "Fix ES version"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 798, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}