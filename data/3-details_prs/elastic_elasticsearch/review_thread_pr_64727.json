{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE2ODE5OTIy", "number": 64727, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNlQxNTo0OToxMlrOE2I4xg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNlQxNTo0OToxMlrOE2I4xg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI1MjA0MTY2OnYy", "diffSide": "RIGHT", "path": "x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/dataframe/extractor/DataFrameDataExtractorFactory.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNlQxNTo0OToxMlrOHuzZqQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wOVQxNzowMjowN1rOHv4kSQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODgzODY5Nw==", "bodyText": "I wonder if it would make sense for this and extractProcessedFeatureNames to become member methods of ExtractedFields and get them unit tested too.", "url": "https://github.com/elastic/elasticsearch/pull/64727#discussion_r518838697", "createdAt": "2020-11-06T15:49:12Z", "author": {"login": "dimitris-athanasiou"}, "path": "x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/dataframe/extractor/DataFrameDataExtractorFactory.java", "diffHunk": "@@ -94,8 +97,30 @@ public static DataFrameDataExtractorFactory createForSourceIndices(Client client\n \n     private static TrainTestSplitterFactory createTrainTestSplitterFactory(Client client, DataFrameAnalyticsConfig config,\n                                                                            ExtractedFields extractedFields) {\n-        return new TrainTestSplitterFactory(client, config,\n-            extractedFields.getAllFields().stream().map(ExtractedField::getName).collect(Collectors.toList()));\n+        return new TrainTestSplitterFactory(\n+            client,\n+            config,\n+            Stream.concat(Arrays.stream(\n+                extractOrganicFeatureNames(extractedFields)),\n+                Arrays.stream(extractProcessedFeatureNames(extractedFields))\n+            ).collect(Collectors.toList()));\n+    }\n+\n+    static String[] extractOrganicFeatureNames(ExtractedFields extractedFields) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "247ce03f3824857cf9ea464f8821404526c8e82a"}, "originalPosition": 32}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTk3MTkxMw==", "bodyText": "Yeah, member methods make sense as they only touch internal data", "url": "https://github.com/elastic/elasticsearch/pull/64727#discussion_r519971913", "createdAt": "2020-11-09T17:02:07Z", "author": {"login": "benwtrent"}, "path": "x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/dataframe/extractor/DataFrameDataExtractorFactory.java", "diffHunk": "@@ -94,8 +97,30 @@ public static DataFrameDataExtractorFactory createForSourceIndices(Client client\n \n     private static TrainTestSplitterFactory createTrainTestSplitterFactory(Client client, DataFrameAnalyticsConfig config,\n                                                                            ExtractedFields extractedFields) {\n-        return new TrainTestSplitterFactory(client, config,\n-            extractedFields.getAllFields().stream().map(ExtractedField::getName).collect(Collectors.toList()));\n+        return new TrainTestSplitterFactory(\n+            client,\n+            config,\n+            Stream.concat(Arrays.stream(\n+                extractOrganicFeatureNames(extractedFields)),\n+                Arrays.stream(extractProcessedFeatureNames(extractedFields))\n+            ).collect(Collectors.toList()));\n+    }\n+\n+    static String[] extractOrganicFeatureNames(ExtractedFields extractedFields) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODgzODY5Nw=="}, "originalCommit": {"oid": "247ce03f3824857cf9ea464f8821404526c8e82a"}, "originalPosition": 32}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3119, "cost": 1, "resetAt": "2021-11-12T13:16:51Z"}}}