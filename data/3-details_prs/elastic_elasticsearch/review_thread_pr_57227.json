{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDIzOTMyODQ2", "number": 57227, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yN1QxNTo0MzoyMlrOEAKLYQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yN1QxNTo0MzoyMlrOEAKLYQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY4NjAyMjA5OnYy", "diffSide": "RIGHT", "path": "server/src/main/java/org/elasticsearch/repositories/blobstore/BlobStoreRepository.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yN1QxNTo0MzoyMlrOGbRAWQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yN1QxNTo0MzoyMlrOGbRAWQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTI0MzM1Mw==", "bodyText": "I thought about whether this is ok or not quite a bit. I think we're not introducing any new risk qualitatively really. If we can't read what is in this directory it's broken, period.\nFor snapshot creation:\nWe can have some freak concurrency issues here if we aren't yet using shard generations and two data nodes try to write to the same path at the same time. But those we resolve either (on S3) by using the 3 minute wait or by not allowing overwrites for index-N on other types of repos. With shard generations being used, this is a non-issue anyway.\nFor deletions we are in the clear also, because everything runs on the master.", "url": "https://github.com/elastic/elasticsearch/pull/57227#discussion_r431243353", "createdAt": "2020-05-27T15:43:22Z", "author": {"login": "original-brownbear"}, "path": "server/src/main/java/org/elasticsearch/repositories/blobstore/BlobStoreRepository.java", "diffHunk": "@@ -2128,8 +2128,7 @@ public BlobStoreIndexShardSnapshot loadShardSnapshot(BlobContainer shardContaine\n             return new Tuple<>(shardSnapshots, latest);\n         } else if (blobs.stream().anyMatch(b -> b.startsWith(SNAPSHOT_PREFIX) || b.startsWith(INDEX_FILE_PREFIX)\n                                                                               || b.startsWith(UPLOADED_DATA_BLOB_PREFIX))) {\n-            throw new IllegalStateException(\n-                \"Could not find a readable index-N file in a non-empty shard snapshot directory [\" + shardContainer.path() + \"]\");\n+            logger.warn(\"Could not find a readable index-N file in a non-empty shard snapshot directory [\" + shardContainer.path() + \"]\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dc4bbb11e7dbfce3f544e21018aa47a4c787d893"}, "originalPosition": 6}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3923, "cost": 1, "resetAt": "2021-11-12T13:16:51Z"}}}