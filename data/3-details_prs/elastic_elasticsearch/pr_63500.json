{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTAwMDM4ODEy", "number": 63500, "title": "Add deprecation warning for removed strict_duplicate_detection setting", "bodyText": "The setting es.xcontent.strict_duplicate_detection was removed in 7.0 (see #34588). It was an undocumented setting, but enough users relied on it that its absence is causing problems during upgrades. This commit adds a message to the deprecation log if this setting is present at startup.\nI looked at putting the warning in the Java options parser, but it was hard to be sure that a check there was catching all the possible ways that a java setting could be passed to the runtime ES JVM. By putting the check in the bootstrap class, we can check the setting in the same way that it was originally used.\nThe original ticket requested that Elasticsearch fail to start if the es.xcontent.strict_duplicate_detection setting is present. This PR does not do that. It seems to me that at least one release should have a deprecation warning before moving to failure to start.\nRelates #60222.", "createdAt": "2020-10-08T16:16:41Z", "url": "https://github.com/elastic/elasticsearch/pull/63500", "merged": true, "mergeCommit": {"oid": "445c850648437c6b7cb8aad381de2e9bf0ab1126"}, "closed": true, "closedAt": "2020-12-18T22:33:10Z", "author": {"login": "williamrandolph"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdQi39TgH2gAyNTAwMDM4ODEyOmU4OGU1YWVkOGJlOGFmNjE4ZTQ0NDJiNGU3YzI3YTc5YmU0ZDk3NDU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdnan56AH2gAyNTAwMDM4ODEyOjI4ZWY3YzkwYmFmZjQxMDA5MTg0NTc1YzNmY2I0N2E1MzAyYzg4Mzg=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "e88e5aed8be8af618e4442b4e7c27a79be4d9745", "author": {"user": {"login": "williamrandolph", "name": "William Brafford"}}, "url": "https://github.com/elastic/elasticsearch/commit/e88e5aed8be8af618e4442b4e7c27a79be4d9745", "committedDate": "2020-10-08T14:57:55Z", "message": "Add deprecation warning for removed setting\n\nThe setting es.xcontent.strict_duplicate_detection was removed in 7.0\n(see #34588). It was an undocumented setting, but enough users relied\non it that its absence is causing problems during upgrades. This commit\nadds a message to the deprecation log if this setting is present at\nstartup."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bffeb3d34b4f48064257b3d966095ee7e4d86161", "author": {"user": {"login": "williamrandolph", "name": "William Brafford"}}, "url": "https://github.com/elastic/elasticsearch/commit/bffeb3d34b4f48064257b3d966095ee7e4d86161", "committedDate": "2020-10-08T17:04:32Z", "message": "Spotless formatting"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7f077298bcb7c2ef51e4d3d9338fbacb2acb9636", "author": {"user": {"login": "williamrandolph", "name": "William Brafford"}}, "url": "https://github.com/elastic/elasticsearch/commit/7f077298bcb7c2ef51e4d3d9338fbacb2acb9636", "committedDate": "2020-10-08T17:42:22Z", "message": "Avoid forbidden API"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7b85113806d611249ada3ba0e2fcc953b9e6306c", "author": {"user": {"login": "williamrandolph", "name": "William Brafford"}}, "url": "https://github.com/elastic/elasticsearch/commit/7b85113806d611249ada3ba0e2fcc953b9e6306c", "committedDate": "2020-10-08T21:12:13Z", "message": "Reset between custom config tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "263dc7c01571640a85216912713629aee1fc7552", "author": {"user": {"login": "williamrandolph", "name": "William Brafford"}}, "url": "https://github.com/elastic/elasticsearch/commit/263dc7c01571640a85216912713629aee1fc7552", "committedDate": "2020-10-08T21:17:43Z", "message": "Spotless apply"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA1MTk0NTI4", "url": "https://github.com/elastic/elasticsearch/pull/63500#pullrequestreview-505194528", "createdAt": "2020-10-08T21:57:00Z", "commit": {"oid": "263dc7c01571640a85216912713629aee1fc7552"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOFQyMTo1NzowMFrOHexzkw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOFQyMTo1Nzo0NFrOHex0qA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjAzNTM0Nw==", "bodyText": "I don't think install should be in a Before. This means we would reinstall before each test, which is costly. The packaging tests are generally written to cleanup after themselves, so deleting the installation should not be necessary?", "url": "https://github.com/elastic/elasticsearch/pull/63500#discussion_r502035347", "createdAt": "2020-10-08T21:57:00Z", "author": {"login": "rjernst"}, "path": "qa/os/src/test/java/org/elasticsearch/packaging/test/ConfigurationTests.java", "diffHunk": "@@ -22,22 +22,44 @@\n import org.apache.http.client.fluent.Request;\n import org.elasticsearch.packaging.util.FileUtils;\n import org.elasticsearch.packaging.util.Platforms;\n+import org.junit.After;\n import org.junit.Before;\n \n+import java.nio.file.Files;\n+import java.util.List;\n+\n+import static java.nio.file.StandardOpenOption.APPEND;\n+import static java.nio.file.StandardOpenOption.CREATE;\n import static org.elasticsearch.packaging.util.FileUtils.append;\n import static org.elasticsearch.packaging.util.ServerUtils.makeRequest;\n+import static org.hamcrest.CoreMatchers.containsString;\n import static org.hamcrest.Matchers.equalTo;\n import static org.junit.Assume.assumeFalse;\n \n public class ConfigurationTests extends PackagingTestCase {\n \n     @Before\n-    public void filterDistros() {\n+    public void filterDistrosAndInstall() throws Exception {\n         assumeFalse(\"no docker\", distribution.isDocker());\n+        install();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "263dc7c01571640a85216912713629aee1fc7552"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjAzNTYyNA==", "bodyText": "Why using System.getProperty here, but BootstrapInfo above?", "url": "https://github.com/elastic/elasticsearch/pull/63500#discussion_r502035624", "createdAt": "2020-10-08T21:57:44Z", "author": {"login": "rjernst"}, "path": "server/src/main/java/org/elasticsearch/bootstrap/Bootstrap.java", "diffHunk": "@@ -363,6 +363,14 @@ static void init(\n                             System.getProperty(\"java.home\"));\n             DeprecationLogger.getLogger(Bootstrap.class).deprecate(\"java_version_11_required\", message);\n         }\n+        if (BootstrapInfo.getSystemProperties().get(\"es.xcontent.strict_duplicate_detection\") != null) {\n+            final String message = String.format(\n+                Locale.ROOT,\n+                \"The Java option es.xcontent.strict_duplicate_detection is set to [%s]; \" +\n+                    \"this option is deprecated and non-functional and should be removed from Java configuration.\",\n+                System.getProperty(\"es.xcontent.strict_duplicate_detection\"));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "263dc7c01571640a85216912713629aee1fc7552"}, "originalPosition": 9}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4eb31d92c75b955bd8b05aa50a11396901f085b9", "author": {"user": {"login": "williamrandolph", "name": "William Brafford"}}, "url": "https://github.com/elastic/elasticsearch/commit/4eb31d92c75b955bd8b05aa50a11396901f085b9", "committedDate": "2020-10-13T13:10:40Z", "message": "Access system properties consistently"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e582ba33f23f69a6daabdc5a7bf09b4812ffe50a", "author": {"user": {"login": "williamrandolph", "name": "William Brafford"}}, "url": "https://github.com/elastic/elasticsearch/commit/e582ba33f23f69a6daabdc5a7bf09b4812ffe50a", "committedDate": "2020-10-13T16:05:54Z", "message": "Revert changes to ConfigurationTests setup"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a5919e8bbb7f6e0e610ab96d6f14a067316efb33", "author": {"user": {"login": "williamrandolph", "name": "William Brafford"}}, "url": "https://github.com/elastic/elasticsearch/commit/a5919e8bbb7f6e0e610ab96d6f14a067316efb33", "committedDate": "2020-10-14T15:13:48Z", "message": "Merge branch '7.x' into duplicate-detection-deprecation"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA4NzYyODY1", "url": "https://github.com/elastic/elasticsearch/pull/63500#pullrequestreview-508762865", "createdAt": "2020-10-14T21:29:30Z", "commit": {"oid": "a5919e8bbb7f6e0e610ab96d6f14a067316efb33"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "28ef7c90baff41009184575c3fcb47a5302c8838", "author": {"user": {"login": "elasticmachine", "name": "Elastic Machine"}}, "url": "https://github.com/elastic/elasticsearch/commit/28ef7c90baff41009184575c3fcb47a5302c8838", "committedDate": "2020-12-18T16:21:24Z", "message": "Merge branch '7.x' into duplicate-detection-deprecation"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4239, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}