{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDAxMDQ1MzEw", "number": 54980, "title": "Add support for filters to T-Test aggregation", "bodyText": "Adds support for filters to T-Test aggregation. The filters can be used to\nselect populations based on some criteria and use values from the same or\ndifferent fields.\nCloses #53692", "createdAt": "2020-04-08T19:48:13Z", "url": "https://github.com/elastic/elasticsearch/pull/54980", "merged": true, "mergeCommit": {"oid": "6d28596ead7f95182b8bd112c3a314d540728126"}, "closed": true, "closedAt": "2020-04-10T14:19:08Z", "author": {"login": "imotov"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcVtJ_eAH2gAyNDAxMDQ1MzEwOjgxOWUzNWRjNWQ4M2ZkMDcwNzkwZDgzYWMyNjcyNTFhNzJiZDE3MzA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcWRQHIAH2gAyNDAxMDQ1MzEwOjEwMjAwOTFhYWJiNmZjZWU0OWI5ZDNhMjQwZDk4YTU1ZjJhZmIxYWQ=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "819e35dc5d83fd070790d83ac267251a72bd1730", "author": {"user": {"login": "imotov", "name": "Igor Motov"}}, "url": "https://github.com/elastic/elasticsearch/commit/819e35dc5d83fd070790d83ac267251a72bd1730", "committedDate": "2020-04-08T19:35:08Z", "message": "Add support for filters to T-Test aggregation\n\nAdds support for filters to T-Test aggregation. The filters can be used to\nselect populations based on some criteria and use values from the same or\ndifferent fields.\n\nCloses #53692"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "77827818667df99ac5266c990977d349bc3cfd80", "author": {"user": {"login": "imotov", "name": "Igor Motov"}}, "url": "https://github.com/elastic/elasticsearch/commit/77827818667df99ac5266c990977d349bc3cfd80", "committedDate": "2020-04-08T20:14:09Z", "message": "Fix BWC tests until we can backport"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0bb9ee2f1f6ceb4040eec260ab35d6e2da4bdbea", "author": {"user": {"login": "elasticmachine", "name": "Elastic Machine"}}, "url": "https://github.com/elastic/elasticsearch/commit/0bb9ee2f1f6ceb4040eec260ab35d6e2da4bdbea", "committedDate": "2020-04-08T20:43:35Z", "message": "Merge branch 'master' into issue-53692-add-filtes-to-t-test"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkwODU4MDk3", "url": "https://github.com/elastic/elasticsearch/pull/54980#pullrequestreview-390858097", "createdAt": "2020-04-09T14:42:57Z", "commit": {"oid": "0bb9ee2f1f6ceb4040eec260ab35d6e2da4bdbea"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOVQxNDo0Mjo1N1rOGDb5lw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOVQxNDo0Mjo1N1rOGDb5lw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjI1NjAyMw==", "bodyText": "Should we validate/throw an exception/something if people specify an unpaired type, but don't provide filters?  Not sure where to put that validation logic but it seems we should disallow folks from basically running an unpaired test on two match-all's?", "url": "https://github.com/elastic/elasticsearch/pull/54980#discussion_r406256023", "createdAt": "2020-04-09T14:42:57Z", "author": {"login": "polyfractal"}, "path": "x-pack/plugin/analytics/src/main/java/org/elasticsearch/xpack/analytics/ttest/TTestAggregatorFactory.java", "diffHunk": "@@ -63,13 +76,46 @@ protected Aggregator doCreateInternal(SearchContext searchContext,\n         }\n         switch (testType) {\n             case PAIRED:\n+                if (filterA != null || filterB != null) {\n+                    throw new IllegalArgumentException(\"Paired t-test doesn't support filters\");\n+                }\n                 return new PairedTTestAggregator(name, numericMultiVS, tails, format, searchContext, parent, metadata);\n             case HOMOSCEDASTIC:\n-                return new UnpairedTTestAggregator(name, numericMultiVS, tails, true, format, searchContext, parent, metadata);\n+                return new UnpairedTTestAggregator(name, numericMultiVS, tails, true, this::getWeights, format, searchContext, parent,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0bb9ee2f1f6ceb4040eec260ab35d6e2da4bdbea"}, "originalPosition": 59}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkxMDExNDMy", "url": "https://github.com/elastic/elasticsearch/pull/54980#pullrequestreview-391011432", "createdAt": "2020-04-09T17:57:49Z", "commit": {"oid": "0bb9ee2f1f6ceb4040eec260ab35d6e2da4bdbea"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "47836d267c8f37b95fb087eea1fffb8a5174cdba", "author": {"user": {"login": "imotov", "name": "Igor Motov"}}, "url": "https://github.com/elastic/elasticsearch/commit/47836d267c8f37b95fb087eea1fffb8a5174cdba", "committedDate": "2020-04-09T19:27:08Z", "message": "Add check for duplicate fields"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5ceebd16257ebd26de21f8302c44f22fbb67950c", "author": {"user": {"login": "imotov", "name": "Igor Motov"}}, "url": "https://github.com/elastic/elasticsearch/commit/5ceebd16257ebd26de21f8302c44f22fbb67950c", "committedDate": "2020-04-09T19:27:28Z", "message": "Merge remote-tracking branch 'elastic/master' into issue-53692-add-filtes-to-t-test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1020091aabb6fcee49b9d3a240d98a55f2afb1ad", "author": {"user": {"login": "elasticmachine", "name": "Elastic Machine"}}, "url": "https://github.com/elastic/elasticsearch/commit/1020091aabb6fcee49b9d3a240d98a55f2afb1ad", "committedDate": "2020-04-10T13:38:24Z", "message": "Merge branch 'master' into issue-53692-add-filtes-to-t-test"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3618, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}