{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ2NTU0NTc0", "number": 59265, "title": "Scripting: Move script_cache into _nodes/stats", "bodyText": "Pending: #59262\nUpdated _nodes/stats:\n\nRemove script_cache\nUpdate script in _node/stats to include stats per context:\n\n      \"script\": {\n        \"compilations\": 1,\n        \"cache_evictions\": 0,\n        \"compilation_limit_triggered\": 0,\n        \"contexts\":[\n          {\n            \"context\": \"aggregation_selector\",\n            \"compilations\": 0,\n            \"cache_evictions\": 0,\n            \"compilation_limit_triggered\": 0\n          },\n\n\nRefs: #50152", "createdAt": "2020-07-09T00:46:06Z", "url": "https://github.com/elastic/elasticsearch/pull/59265", "merged": true, "mergeCommit": {"oid": "8d8bd3df7c9f56995a13d8c27b515b4a45decaba"}, "closed": true, "closedAt": "2020-07-09T19:30:11Z", "author": {"login": "stu-elastic"}, "timelineItems": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABczDiYGgH2gAyNDQ2NTU0NTc0OjlhZTY5NDFhY2Q2Njg4MWE1YzFmZWRiYjEwNDNkN2Y4YzBmYWQzOGU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABczTeJugH2gAyNDQ2NTU0NTc0OmU0NzU0MWI1NTUwMTI5OGEwOWQ5NzYwYzU0ZDc3NzFhMWIyOGYxMzc=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "9ae6941acd66881a5c1fedbb1043d7f8c0fad38e", "author": {"user": {"login": "stu-elastic", "name": "Stuart Tettemer"}}, "url": "https://github.com/elastic/elasticsearch/commit/9ae6941acd66881a5c1fedbb1043d7f8c0fad38e", "committedDate": "2020-07-09T00:03:29Z", "message": "Scripting: Remove general cache settings\n\nRemoved settings:\n * `script.cache.max_size`\n * `script.cache.expire`\n * `script.max_compilations_rate`\n\nRefs: #50152"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "47f04b9d528be62445baae8bf244ac6b26d6bd3e", "author": {"user": {"login": "stu-elastic", "name": "Stuart Tettemer"}}, "url": "https://github.com/elastic/elasticsearch/commit/47f04b9d528be62445baae8bf244ac6b26d6bd3e", "committedDate": "2020-07-09T00:34:34Z", "message": "Scripting: Move script_cache into _nodes/stats\n\nUpdated `_nodes/stats`:\n * Remove `script_cache`\n * Update `script` in `_node/stats` to include stats per context:\n\n```\n      \"script\": {\n        \"compilations\": 1,\n        \"cache_evictions\": 0,\n        \"compilation_limit_triggered\": 0,\n        \"contexts\":[\n          {\n            \"context\": \"aggregation_selector\",\n            \"compilations\": 0,\n            \"cache_evictions\": 0,\n            \"compilation_limit_triggered\": 0\n          },\n\n```\n\nRefs: #50152"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "632ad72d25c456d096169be18441c04addff9993", "author": {"user": {"login": "stu-elastic", "name": "Stuart Tettemer"}}, "url": "https://github.com/elastic/elasticsearch/commit/632ad72d25c456d096169be18441c04addff9993", "committedDate": "2020-07-09T00:52:43Z", "message": "Add new ContextStats and StatsTests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2257f3b1226328df271de161d2f8fe1a84efb241", "author": {"user": {"login": "stu-elastic", "name": "Stuart Tettemer"}}, "url": "https://github.com/elastic/elasticsearch/commit/2257f3b1226328df271de161d2f8fe1a84efb241", "committedDate": "2020-07-09T12:51:28Z", "message": "Merge branch 'master' of github.com:elastic/elasticsearch into fix/50152-painless-limit-per-context__07__node-stats"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "390332d8e2a129487785fc282f3c6b102d1a73a8", "author": {"user": {"login": "stu-elastic", "name": "Stuart Tettemer"}}, "url": "https://github.com/elastic/elasticsearch/commit/390332d8e2a129487785fc282f3c6b102d1a73a8", "committedDate": "2020-07-09T13:18:51Z", "message": "Merge branch 'master' of github.com:elastic/elasticsearch into fix/50152-painless-limit-per-context__07__node-stats"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ1ODM2MTQw", "url": "https://github.com/elastic/elasticsearch/pull/59265#pullrequestreview-445836140", "createdAt": "2020-07-09T17:44:46Z", "commit": {"oid": "390332d8e2a129487785fc282f3c6b102d1a73a8"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOVQxNzo0NDo0NlrOGvbfKQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOVQxNzo0NDo0NlrOGvbfKQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjM4NjYwMQ==", "bodyText": "deserializedScriptCacheStats -> deserializedScriptStats", "url": "https://github.com/elastic/elasticsearch/pull/59265#discussion_r452386601", "createdAt": "2020-07-09T17:44:46Z", "author": {"login": "stu-elastic"}, "path": "server/src/test/java/org/elasticsearch/action/admin/cluster/node/stats/NodeStatsTests.java", "diffHunk": "@@ -241,11 +243,35 @@ public void testSerialization() throws IOException {\n                     }\n                 }\n                 ScriptStats scriptStats = nodeStats.getScriptStats();\n+                ScriptStats deserializedScriptCacheStats = deserializedNodeStats.getScriptStats();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "390332d8e2a129487785fc282f3c6b102d1a73a8"}, "originalPosition": 25}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ1ODM2NTU0", "url": "https://github.com/elastic/elasticsearch/pull/59265#pullrequestreview-445836554", "createdAt": "2020-07-09T17:45:22Z", "commit": {"oid": "390332d8e2a129487785fc282f3c6b102d1a73a8"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ1ODM3MDQw", "url": "https://github.com/elastic/elasticsearch/pull/59265#pullrequestreview-445837040", "createdAt": "2020-07-09T17:46:07Z", "commit": {"oid": "390332d8e2a129487785fc282f3c6b102d1a73a8"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ1ODM3Mzcw", "url": "https://github.com/elastic/elasticsearch/pull/59265#pullrequestreview-445837370", "createdAt": "2020-07-09T17:46:34Z", "commit": {"oid": "390332d8e2a129487785fc282f3c6b102d1a73a8"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOVQxNzo0NjozNFrOGvbjCg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOVQxNzo0NjozNFrOGvbjCg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjM4NzU5NA==", "bodyText": "Add indent back.", "url": "https://github.com/elastic/elasticsearch/pull/59265#discussion_r452387594", "createdAt": "2020-07-09T17:46:34Z", "author": {"login": "stu-elastic"}, "path": "server/src/test/java/org/elasticsearch/action/admin/cluster/node/stats/NodeStatsTests.java", "diffHunk": "@@ -514,20 +525,10 @@ public static NodeStats createNodeStats() {\n             }\n             adaptiveSelectionStats = new AdaptiveSelectionStats(nodeConnections, nodeStats);\n         }\n-        ScriptCacheStats scriptCacheStats = null;\n-        if (frequently()) {\n-            int numContents = randomIntBetween(0, 20);\n-            Map<String,ScriptStats> stats = new HashMap<>(numContents);\n-            for (int i = 0; i < numContents; i++) {\n-                String context = randomValueOtherThanMany(stats::containsKey, () -> randomAlphaOfLength(12));\n-                stats.put(context, new ScriptStats(randomLongBetween(0, 1024), randomLongBetween(0, 1024), randomLongBetween(0, 1024)));\n-            }\n-            scriptCacheStats = new ScriptCacheStats(stats);\n-        }\n         //TODO NodeIndicesStats are not tested here, way too complicated to create, also they need to be migrated to Writeable yet\n         return new NodeStats(node, randomNonNegativeLong(), null, osStats, processStats, jvmStats, threadPoolStats,\n-                fsInfo, transportStats, httpStats, allCircuitBreakerStats, scriptStats, discoveryStats,\n-                ingestStats, adaptiveSelectionStats, scriptCacheStats);\n+            fsInfo, transportStats, httpStats, allCircuitBreakerStats, scriptStats, discoveryStats,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "390332d8e2a129487785fc282f3c6b102d1a73a8"}, "originalPosition": 137}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0d79d707026fe6579e0f67800df61b0e19f76b24", "author": {"user": {"login": "stu-elastic", "name": "Stuart Tettemer"}}, "url": "https://github.com/elastic/elasticsearch/commit/0d79d707026fe6579e0f67800df61b0e19f76b24", "committedDate": "2020-07-09T18:26:11Z", "message": "Merge branch 'master' of github.com:elastic/elasticsearch into fix/50152-painless-limit-per-context__07__node-stats"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ec3558619a883f9bf5f295bdfa2ac8116d4d12ae", "author": {"user": {"login": "stu-elastic", "name": "Stuart Tettemer"}}, "url": "https://github.com/elastic/elasticsearch/commit/ec3558619a883f9bf5f295bdfa2ac8116d4d12ae", "committedDate": "2020-07-09T18:35:19Z", "message": "rename deserializedScriptStats, remove dedent"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e47541b55501298a09d9760c54d7771a1b28f137", "author": {"user": {"login": "stu-elastic", "name": "Stuart Tettemer"}}, "url": "https://github.com/elastic/elasticsearch/commit/e47541b55501298a09d9760c54d7771a1b28f137", "committedDate": "2020-07-09T18:37:21Z", "message": "indent ScriptServiceTests"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2083, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}