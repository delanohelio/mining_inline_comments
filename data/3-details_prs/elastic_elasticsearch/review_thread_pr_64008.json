{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTA3NjUxNDA4", "number": 64008, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOVQxNzowMzoyMlrOEzZTvQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOVQxNzowNzowMVrOEzZZmA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIyMzI3NDg1OnYy", "diffSide": "RIGHT", "path": "x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/ilm/TimeseriesLifecycleType.java", "isResolved": false, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOVQxNzowMzoyMlrOHql0sA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOVQxODo1MDoyOFrOHqqABQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDQyMTkzNg==", "bodyText": "This will not compile on backport (which is fine, just wanted to let you know since you asked about this previously)", "url": "https://github.com/elastic/elasticsearch/pull/64008#discussion_r514421936", "createdAt": "2020-10-29T17:03:22Z", "author": {"login": "dakrone"}, "path": "x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/ilm/TimeseriesLifecycleType.java", "diffHunk": "@@ -50,14 +50,13 @@\n     static final Set<String> VALID_WARM_ACTIONS = Sets.newHashSet(ORDERED_VALID_WARM_ACTIONS);\n     static final Set<String> VALID_COLD_ACTIONS = Sets.newHashSet(ORDERED_VALID_COLD_ACTIONS);\n     static final Set<String> VALID_DELETE_ACTIONS = Sets.newHashSet(ORDERED_VALID_DELETE_ACTIONS);\n-    private static final Map<String, Set<String>> ALLOWED_ACTIONS = new HashMap<>();\n+    private static final Map<String, Set<String>> ALLOWED_ACTIONS = Map.of(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2d9c307e63a94c4eaca1a9e8996459e1b591b869"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDQzNDA3Ng==", "bodyText": "+1, I've pregamed that and I'm ready to do the backport dance.", "url": "https://github.com/elastic/elasticsearch/pull/64008#discussion_r514434076", "createdAt": "2020-10-29T17:20:55Z", "author": {"login": "joegallo"}, "path": "x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/ilm/TimeseriesLifecycleType.java", "diffHunk": "@@ -50,14 +50,13 @@\n     static final Set<String> VALID_WARM_ACTIONS = Sets.newHashSet(ORDERED_VALID_WARM_ACTIONS);\n     static final Set<String> VALID_COLD_ACTIONS = Sets.newHashSet(ORDERED_VALID_COLD_ACTIONS);\n     static final Set<String> VALID_DELETE_ACTIONS = Sets.newHashSet(ORDERED_VALID_DELETE_ACTIONS);\n-    private static final Map<String, Set<String>> ALLOWED_ACTIONS = new HashMap<>();\n+    private static final Map<String, Set<String>> ALLOWED_ACTIONS = Map.of(", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDQyMTkzNg=="}, "originalCommit": {"oid": "2d9c307e63a94c4eaca1a9e8996459e1b591b869"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDQ4MTYyNg==", "bodyText": "We do have these utility classes in the 7.x branch that provide these functions in a Java8-compatible way so that backports are easier. They're also packaged as a multi-release JAR so that in JVMs that are 9 or later, they use the Java libraries instead, so there's no downside to using them when running with later JVMs.", "url": "https://github.com/elastic/elasticsearch/pull/64008#discussion_r514481626", "createdAt": "2020-10-29T18:34:45Z", "author": {"login": "danhermann"}, "path": "x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/ilm/TimeseriesLifecycleType.java", "diffHunk": "@@ -50,14 +50,13 @@\n     static final Set<String> VALID_WARM_ACTIONS = Sets.newHashSet(ORDERED_VALID_WARM_ACTIONS);\n     static final Set<String> VALID_COLD_ACTIONS = Sets.newHashSet(ORDERED_VALID_COLD_ACTIONS);\n     static final Set<String> VALID_DELETE_ACTIONS = Sets.newHashSet(ORDERED_VALID_DELETE_ACTIONS);\n-    private static final Map<String, Set<String>> ALLOWED_ACTIONS = new HashMap<>();\n+    private static final Map<String, Set<String>> ALLOWED_ACTIONS = Map.of(", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDQyMTkzNg=="}, "originalCommit": {"oid": "2d9c307e63a94c4eaca1a9e8996459e1b591b869"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDQ5MDM3Mw==", "bodyText": "@danhermann the utility classes are unfortunately not that helpful, since to use they the Map.of needs to be fully qualified, or java.util.Map<String, Set<String>> has to be specified to fully qualify the jdk classes, which I think is more awkward than just changing on backport.", "url": "https://github.com/elastic/elasticsearch/pull/64008#discussion_r514490373", "createdAt": "2020-10-29T18:50:28Z", "author": {"login": "dakrone"}, "path": "x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/ilm/TimeseriesLifecycleType.java", "diffHunk": "@@ -50,14 +50,13 @@\n     static final Set<String> VALID_WARM_ACTIONS = Sets.newHashSet(ORDERED_VALID_WARM_ACTIONS);\n     static final Set<String> VALID_COLD_ACTIONS = Sets.newHashSet(ORDERED_VALID_COLD_ACTIONS);\n     static final Set<String> VALID_DELETE_ACTIONS = Sets.newHashSet(ORDERED_VALID_DELETE_ACTIONS);\n-    private static final Map<String, Set<String>> ALLOWED_ACTIONS = new HashMap<>();\n+    private static final Map<String, Set<String>> ALLOWED_ACTIONS = Map.of(", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDQyMTkzNg=="}, "originalCommit": {"oid": "2d9c307e63a94c4eaca1a9e8996459e1b591b869"}, "originalPosition": 14}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIyMzI4OTg0OnYy", "diffSide": "LEFT", "path": "x-pack/plugin/ilm/qa/multi-node/src/javaRestTest/java/org/elasticsearch/xpack/ilm/TimeSeriesLifecycleActionsIT.java", "isResolved": true, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOVQxNzowNzowMVrOHql-Jg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOVQxOTo0MToyNVrOHqrvsw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDQyNDM1OA==", "bodyText": "This change is a little out of the scope of this PR, you did discover that we're missing a method below this one that has\npublic void testForceMergeActionWithCompressionCodec() throws Exception {\n    forceMergeActionWithCodec(\"best_compression\");\n}\nSo I think we should not apply this change in this PR", "url": "https://github.com/elastic/elasticsearch/pull/64008#discussion_r514424358", "createdAt": "2020-10-29T17:07:01Z", "author": {"login": "dakrone"}, "path": "x-pack/plugin/ilm/qa/multi-node/src/javaRestTest/java/org/elasticsearch/xpack/ilm/TimeSeriesLifecycleActionsIT.java", "diffHunk": "@@ -467,10 +467,6 @@ public void forceMergeActionWithCodec(String codec) throws Exception {\n         expectThrows(ResponseException.class, () -> indexDocument(client(), index));\n     }\n \n-    public void testForceMergeAction() throws Exception {\n-        forceMergeActionWithCodec(null);\n-    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2d9c307e63a94c4eaca1a9e8996459e1b591b869"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDQzMzY4OQ==", "bodyText": "+1, I'll back that out on this PR, and then open a new PR that adds the missing test.", "url": "https://github.com/elastic/elasticsearch/pull/64008#discussion_r514433689", "createdAt": "2020-10-29T17:20:18Z", "author": {"login": "joegallo"}, "path": "x-pack/plugin/ilm/qa/multi-node/src/javaRestTest/java/org/elasticsearch/xpack/ilm/TimeSeriesLifecycleActionsIT.java", "diffHunk": "@@ -467,10 +467,6 @@ public void forceMergeActionWithCodec(String codec) throws Exception {\n         expectThrows(ResponseException.class, () -> indexDocument(client(), index));\n     }\n \n-    public void testForceMergeAction() throws Exception {\n-        forceMergeActionWithCodec(null);\n-    }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDQyNDM1OA=="}, "originalCommit": {"oid": "2d9c307e63a94c4eaca1a9e8996459e1b591b869"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDQzNzUxMA==", "bodyText": "563720a for the revert", "url": "https://github.com/elastic/elasticsearch/pull/64008#discussion_r514437510", "createdAt": "2020-10-29T17:26:00Z", "author": {"login": "joegallo"}, "path": "x-pack/plugin/ilm/qa/multi-node/src/javaRestTest/java/org/elasticsearch/xpack/ilm/TimeSeriesLifecycleActionsIT.java", "diffHunk": "@@ -467,10 +467,6 @@ public void forceMergeActionWithCodec(String codec) throws Exception {\n         expectThrows(ResponseException.class, () -> indexDocument(client(), index));\n     }\n \n-    public void testForceMergeAction() throws Exception {\n-        forceMergeActionWithCodec(null);\n-    }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDQyNDM1OA=="}, "originalCommit": {"oid": "2d9c307e63a94c4eaca1a9e8996459e1b591b869"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDUxODk2Mw==", "bodyText": "#64377 for the new test", "url": "https://github.com/elastic/elasticsearch/pull/64008#discussion_r514518963", "createdAt": "2020-10-29T19:41:25Z", "author": {"login": "joegallo"}, "path": "x-pack/plugin/ilm/qa/multi-node/src/javaRestTest/java/org/elasticsearch/xpack/ilm/TimeSeriesLifecycleActionsIT.java", "diffHunk": "@@ -467,10 +467,6 @@ public void forceMergeActionWithCodec(String codec) throws Exception {\n         expectThrows(ResponseException.class, () -> indexDocument(client(), index));\n     }\n \n-    public void testForceMergeAction() throws Exception {\n-        forceMergeActionWithCodec(null);\n-    }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDQyNDM1OA=="}, "originalCommit": {"oid": "2d9c307e63a94c4eaca1a9e8996459e1b591b869"}, "originalPosition": 24}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4245, "cost": 1, "resetAt": "2021-11-12T19:05:54Z"}}}