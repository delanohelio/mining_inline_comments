{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTA5OTE0MzI3", "number": 64145, "title": "Expose the list of completed ranges in SparseFileTracker", "bodyText": "This PR adds a new method getCompletedRanges() to the SparseFileTracker class. This will be useful for the persistent cache that will need to retrieve the list of completed ranges before fsyncing a cache file.", "createdAt": "2020-10-26T10:02:14Z", "url": "https://github.com/elastic/elasticsearch/pull/64145", "merged": true, "mergeCommit": {"oid": "f1930ae3a7e674d0980bf11b417be4d3b3fe77ec"}, "closed": true, "closedAt": "2020-10-26T13:43:55Z", "author": {"login": "tlrx"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdWRZcmgH2gAyNTA5OTE0MzI3OjNiYTQ3N2Q4ZTY0ZmZjMzQ2MWYyNzEzYTI3ZDEzYTU2MmE2MzI1ZmE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdWTsX7AH2gAyNTA5OTE0MzI3OmZmOTA2NjZkZjE4MmY2NDYwZDI0ZDFiNGMxYzFlMWZiMDg5Y2Y4YjE=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "3ba477d8e64ffc3461f2713a27d13a562a6325fa", "author": {"user": {"login": "tlrx", "name": "Tanguy Leroux"}}, "url": "https://github.com/elastic/elasticsearch/commit/3ba477d8e64ffc3461f2713a27d13a562a6325fa", "committedDate": "2020-10-26T09:59:45Z", "message": "Expose the list of completed ranges in SparseFileTracker"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE2NjYxNDA2", "url": "https://github.com/elastic/elasticsearch/pull/64145#pullrequestreview-516661406", "createdAt": "2020-10-26T10:54:19Z", "commit": {"oid": "3ba477d8e64ffc3461f2713a27d13a562a6325fa"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yNlQxMDo1NDoxOVrOHoKQfg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yNlQxMDo1NDoxOVrOHoKQfg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTg3MzE1MA==", "bodyText": "Random NIT/Question: why use a LinkedList for this, seems if we're actually worried about this running so often that it'll be tricky on the GC ArrayList would perform more predictably and is what we generally use for this type of spot?", "url": "https://github.com/elastic/elasticsearch/pull/64145#discussion_r511873150", "createdAt": "2020-10-26T10:54:19Z", "author": {"login": "original-brownbear"}, "path": "x-pack/plugin/searchable-snapshots/src/main/java/org/elasticsearch/index/store/cache/SparseFileTracker.java", "diffHunk": "@@ -49,6 +50,23 @@ public long getLength() {\n         return length;\n     }\n \n+    public List<Tuple<Long, Long>> getCompletedRanges() {\n+        List<Tuple<Long, Long>> completedRanges = null;\n+        synchronized (mutex) {\n+            assert invariant();\n+            for (Range range : ranges) {\n+                if (range.isPending()) {\n+                    continue;\n+                }\n+                if (completedRanges == null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3ba477d8e64ffc3461f2713a27d13a562a6325fa"}, "originalPosition": 20}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "231f3b70981e11ec70962812e82c634ddc97e763", "author": {"user": {"login": "tlrx", "name": "Tanguy Leroux"}}, "url": "https://github.com/elastic/elasticsearch/commit/231f3b70981e11ec70962812e82c634ddc97e763", "committedDate": "2020-10-26T12:39:52Z", "message": "ArrayList"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ff90666df182f6460d24d1b4c1c1e1fb089cf8b1", "author": {"user": {"login": "tlrx", "name": "Tanguy Leroux"}}, "url": "https://github.com/elastic/elasticsearch/commit/ff90666df182f6460d24d1b4c1c1e1fb089cf8b1", "committedDate": "2020-10-26T12:40:14Z", "message": "Merge branch 'master' into expose-completed-ranges"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 968, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}