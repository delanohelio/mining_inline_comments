{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTM2NzAzMzA4", "number": 66198, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNFQxMDozNTo0OVrOFE6ipQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNFQxMDozNTo0OVrOFE6ipQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQwNjk3NzY1OnYy", "diffSide": "RIGHT", "path": "x-pack/plugin/searchable-snapshots/src/main/java/org/elasticsearch/xpack/searchablesnapshots/cache/CacheService.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNFQxMDozNTo0OVrOIFKH2A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNFQxMDozNTo0OVrOIFKH2A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjI3OTY0MA==", "bodyText": "Suggest a comment so we remember why we are doing this:\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                public static final Setting<ByteSizeValue> SNAPSHOT_CACHE_RECOVERY_RANGE_SIZE_SETTING = Setting.byteSizeSetting(\n          \n          \n            \n                /**\n          \n          \n            \n                 * Starting up a shard involves reading small parts of some files from the repository, independently of the pre-warming process. If we\n          \n          \n            \n                 * expand those ranges using {@link CacheService#SNAPSHOT_CACHE_RANGE_SIZE_SETTING} then we end up reading quite a few 32MB ranges. If\n          \n          \n            \n                 * we read enough of these ranges for the restore throttling rate limiter to kick in then all the read threads will end up waiting on\n          \n          \n            \n                 * the throttle, blocking subsequent reads. By using a smaller read size during restore we avoid clogging up the rate limiter so much.\n          \n          \n            \n                 */\n          \n          \n            \n                public static final Setting<ByteSizeValue> SNAPSHOT_CACHE_RECOVERY_RANGE_SIZE_SETTING = Setting.byteSizeSetting(\n          \n      \n    \n    \n  \n\nAlso suggest a similar comment on the other setting since this came up as a question in the investigation that led to this PR.\n    /**\n     * If a search needs data from the repository then we expand it to a larger contiguous range whose size is determined by this setting,\n     * in anticipation of needing nearby data in subsequent reads. Repository reads typically have quite high latency (think ~100ms) and\n     * the default of 32MB for this setting represents the approximate point at which size starts to matter. In other words, reads of\n     * ranges smaller than 32MB don't usually happen much quicker, so we may as well expand all the way to 32MB ranges.\n     */\n    public static final Setting<ByteSizeValue> SNAPSHOT_CACHE_RANGE_SIZE_SETTING = Setting.byteSizeSetting(", "url": "https://github.com/elastic/elasticsearch/pull/66198#discussion_r542279640", "createdAt": "2020-12-14T10:35:49Z", "author": {"login": "DaveCTurner"}, "path": "x-pack/plugin/searchable-snapshots/src/main/java/org/elasticsearch/xpack/searchablesnapshots/cache/CacheService.java", "diffHunk": "@@ -71,6 +71,13 @@\n         MAX_SNAPSHOT_CACHE_RANGE_SIZE,                          // max\n         Setting.Property.NodeScope\n     );\n+    public static final Setting<ByteSizeValue> SNAPSHOT_CACHE_RECOVERY_RANGE_SIZE_SETTING = Setting.byteSizeSetting(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "df3e8a010d9aa89ecbecc14453667371d7da8780"}, "originalPosition": 4}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4644, "cost": 1, "resetAt": "2021-11-12T19:05:54Z"}}}