{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg1NzAxODU5", "number": 53295, "title": "Perform evaluation in multiple steps when necessary", "bodyText": "This PR performs evaluation aggregations in batches when performing a single request would cause too_many_buckets_exception.\nIt takes into account the search.max_buckets setting. The setting is passed to all the metrics using Settings object so the interface of EvaluationMetric::aggs method had to be extended.\nFor the default value of search.max_buckets setting (10000) there will be more than 100 sequential steps making the _evaluate request somewhat slow. But for now I think it's better to provide slow response rather than no response at all.", "createdAt": "2020-03-09T16:54:22Z", "url": "https://github.com/elastic/elasticsearch/pull/53295", "merged": true, "mergeCommit": {"oid": "fd030dc4c03eab9a4a7d84589f20b5e5f702a54b"}, "closed": true, "closedAt": "2020-03-11T13:25:45Z", "author": {"login": "przemekwitek"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcMTwt_gBqjMxMTUwNzMwMzQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcMm2NxgFqTM3MjczOTczOA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "5188a499aa9804bf7da8b43c7009975625c1b495", "author": {"user": {"login": "przemekwitek", "name": "Przemys\u0142aw Witek"}}, "url": "https://github.com/elastic/elasticsearch/commit/5188a499aa9804bf7da8b43c7009975625c1b495", "committedDate": "2020-03-09T16:51:22Z", "message": "Perform evaluation in multiple steps when necessary"}, "afterCommit": {"oid": "367be5e6b09108f8fa735b80b39667e914635078", "author": {"user": {"login": "przemekwitek", "name": "Przemys\u0142aw Witek"}}, "url": "https://github.com/elastic/elasticsearch/commit/367be5e6b09108f8fa735b80b39667e914635078", "committedDate": "2020-03-10T14:54:20Z", "message": "Perform evaluation in multiple steps when necessary"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "367be5e6b09108f8fa735b80b39667e914635078", "author": {"user": {"login": "przemekwitek", "name": "Przemys\u0142aw Witek"}}, "url": "https://github.com/elastic/elasticsearch/commit/367be5e6b09108f8fa735b80b39667e914635078", "committedDate": "2020-03-10T14:54:20Z", "message": "Perform evaluation in multiple steps when necessary"}, "afterCommit": {"oid": "77da3a1fdf7c09bed361f5df2e2ade0d5f6d5604", "author": {"user": {"login": "przemekwitek", "name": "Przemys\u0142aw Witek"}}, "url": "https://github.com/elastic/elasticsearch/commit/77da3a1fdf7c09bed361f5df2e2ade0d5f6d5604", "committedDate": "2020-03-11T06:37:57Z", "message": "Perform evaluation in multiple steps when necessary"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "77da3a1fdf7c09bed361f5df2e2ade0d5f6d5604", "author": {"user": {"login": "przemekwitek", "name": "Przemys\u0142aw Witek"}}, "url": "https://github.com/elastic/elasticsearch/commit/77da3a1fdf7c09bed361f5df2e2ade0d5f6d5604", "committedDate": "2020-03-11T06:37:57Z", "message": "Perform evaluation in multiple steps when necessary"}, "afterCommit": {"oid": "1ab682cc5648487ff5628c83ced61ef7d7d0c3ee", "author": {"user": {"login": "przemekwitek", "name": "Przemys\u0142aw Witek"}}, "url": "https://github.com/elastic/elasticsearch/commit/1ab682cc5648487ff5628c83ced61ef7d7d0c3ee", "committedDate": "2020-03-11T06:52:45Z", "message": "Perform evaluation in multiple steps when necessary"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "1ab682cc5648487ff5628c83ced61ef7d7d0c3ee", "author": {"user": {"login": "przemekwitek", "name": "Przemys\u0142aw Witek"}}, "url": "https://github.com/elastic/elasticsearch/commit/1ab682cc5648487ff5628c83ced61ef7d7d0c3ee", "committedDate": "2020-03-11T06:52:45Z", "message": "Perform evaluation in multiple steps when necessary"}, "afterCommit": {"oid": "baff92b35539844df5bfe987f04b5cd9675540c8", "author": {"user": {"login": "przemekwitek", "name": "Przemys\u0142aw Witek"}}, "url": "https://github.com/elastic/elasticsearch/commit/baff92b35539844df5bfe987f04b5cd9675540c8", "committedDate": "2020-03-11T07:05:25Z", "message": "Perform evaluation in multiple steps when necessary"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcyNjI4ODMz", "url": "https://github.com/elastic/elasticsearch/pull/53295#pullrequestreview-372628833", "createdAt": "2020-03-11T10:19:25Z", "commit": {"oid": "baff92b35539844df5bfe987f04b5cd9675540c8"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMVQxMDoxOToyNVrOF0wz4g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMVQxMDoxOToyNVrOF0wz4g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDg2OTk4Ng==", "bodyText": "I think it's unusual to build a new Settings object that contains just one setting and pass that around in the production code.  It is passed through three layers of other objects, so in the future this could create confusion for maintainers of the innermost classes about what settings are available.  It makes me wonder if to avoid risk of future mistakes you should introduce a new class, say EvaluationParameters that has a member for each required parameter, so it will start off with just maxBuckets.  (Alternatively maxBuckets could just be passed through the three layers as an int, but I guess you were trying to future proof this so that fewer changes are needed when a second dynamic setting needs to be passed.  A bespoke class solves this while avoiding confusion about exactly which settings are included.)", "url": "https://github.com/elastic/elasticsearch/pull/53295#discussion_r390869986", "createdAt": "2020-03-11T10:19:25Z", "author": {"login": "droberts195"}, "path": "x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/action/TransportEvaluateDataFrameAction.java", "diffHunk": "@@ -48,7 +66,9 @@ protected void doExecute(Task task, EvaluateDataFrameAction.Request request,\n             listener::onFailure\n         );\n \n-        EvaluationExecutor evaluationExecutor = new EvaluationExecutor(threadPool, client, request);\n+        // Create a collection of settings to be used by evaluation metrics. Once passed to {@link EvaluationExecutor}, it is immutable.\n+        Settings settings = Settings.builder().put(MAX_BUCKET_SETTING.getKey(), maxBuckets.get()).build();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "baff92b35539844df5bfe987f04b5cd9675540c8"}, "originalPosition": 59}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f2d0f669d7016ece8031e0c13656062e08c66656", "author": {"user": {"login": "przemekwitek", "name": "Przemys\u0142aw Witek"}}, "url": "https://github.com/elastic/elasticsearch/commit/f2d0f669d7016ece8031e0c13656062e08c66656", "committedDate": "2020-03-11T11:21:31Z", "message": "Introduce EvaluationParameters class and its unit tests"}, "afterCommit": {"oid": "d8576046b03efc5925195b680fa407a17c88b5a2", "author": {"user": {"login": "przemekwitek", "name": "Przemys\u0142aw Witek"}}, "url": "https://github.com/elastic/elasticsearch/commit/d8576046b03efc5925195b680fa407a17c88b5a2", "committedDate": "2020-03-11T11:22:28Z", "message": "Introduce EvaluationParameters class and its unit tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "778e54067195d498e4c80053deade00145e2d4aa", "author": {"user": {"login": "przemekwitek", "name": "Przemys\u0142aw Witek"}}, "url": "https://github.com/elastic/elasticsearch/commit/778e54067195d498e4c80053deade00145e2d4aa", "committedDate": "2020-03-11T12:23:24Z", "message": "Perform evaluation in multiple steps when necessary"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5b2b8b9c14e3cde6652a1d363c5796b267decb56", "author": {"user": {"login": "przemekwitek", "name": "Przemys\u0142aw Witek"}}, "url": "https://github.com/elastic/elasticsearch/commit/5b2b8b9c14e3cde6652a1d363c5796b267decb56", "committedDate": "2020-03-11T12:23:24Z", "message": "Introduce EvaluationParameters class and its unit tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0e13a82665b6e732ce170b8ed31f648fb1f1e2a5", "author": {"user": {"login": "przemekwitek", "name": "Przemys\u0142aw Witek"}}, "url": "https://github.com/elastic/elasticsearch/commit/0e13a82665b6e732ce170b8ed31f648fb1f1e2a5", "committedDate": "2020-03-11T12:23:24Z", "message": "Add field comment"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c43ba383898c3b1c06622a5b4f4a1047dc44e644", "author": {"user": {"login": "przemekwitek", "name": "Przemys\u0142aw Witek"}}, "url": "https://github.com/elastic/elasticsearch/commit/c43ba383898c3b1c06622a5b4f4a1047dc44e644", "committedDate": "2020-03-11T11:31:20Z", "message": "Add field comment"}, "afterCommit": {"oid": "0e13a82665b6e732ce170b8ed31f648fb1f1e2a5", "author": {"user": {"login": "przemekwitek", "name": "Przemys\u0142aw Witek"}}, "url": "https://github.com/elastic/elasticsearch/commit/0e13a82665b6e732ce170b8ed31f648fb1f1e2a5", "committedDate": "2020-03-11T12:23:24Z", "message": "Add field comment"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcyNzM5NzM4", "url": "https://github.com/elastic/elasticsearch/pull/53295#pullrequestreview-372739738", "createdAt": "2020-03-11T13:08:47Z", "commit": {"oid": "0e13a82665b6e732ce170b8ed31f648fb1f1e2a5"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1651, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}