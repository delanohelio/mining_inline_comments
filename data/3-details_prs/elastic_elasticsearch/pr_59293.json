{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ2ODE1MTMw", "number": 59293, "title": "Make data streams a basic licensed feature.", "bodyText": "Create new data-stream xpack module.\nMove TimestampFieldMapper to the new module,\nthis results in storing a composable index template\nwith data stream definition only to work with default\ndistribution. This way data streams can only be used\nwith default distribution, since a data stream can\ncurrently only be created if a matching composable index\ntemplate exists with a data stream definition.\nAdd validate() method to MetadataFieldMapper so that\nin core the validation that exists in TimestampFieldMapper\ncan be invoked.\nMove data stream integration tests to xpack module.\n\nIn a follow up the data stream transport and rest actions can be moved to the xpack data-stream module.", "createdAt": "2020-07-09T12:01:31Z", "url": "https://github.com/elastic/elasticsearch/pull/59293", "merged": true, "mergeCommit": {"oid": "40b9fd49e0218b44fe628d3124664949dd06bee8"}, "closed": true, "closedAt": "2020-07-13T09:43:43Z", "author": {"login": "martijnvg"}, "timelineItems": {"totalCount": 42, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABczLwSTgH2gAyNDQ2ODE1MTMwOmRhM2U2NzhmZjJkNDdhYTIyNTY0ZmIzZDNjNDE0MmU2ZWE2OWJiYzg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc0b_Q-gH2gAyNDQ2ODE1MTMwOjFhMTQ4NTAzMmIzNWYyZmU3YWUxNjc2ZTZjMzlhMTlhZjg1YWIwYzY=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "da3e678ff2d47aa22564fb3d3c4142e6ea69bbc8", "author": {"user": {"login": "martijnvg", "name": "Martijn van Groningen"}}, "url": "https://github.com/elastic/elasticsearch/commit/da3e678ff2d47aa22564fb3d3c4142e6ea69bbc8", "committedDate": "2020-07-09T09:37:55Z", "message": "Make data streams a basic licensed feature.\n\n* Create new data-stream xpack module.\n* Move TimestampFieldMapper to the new module,\n  this results in storing a composable index template\n  with data stream definition only to work with default\n  distribution. This way data streams can only be used\n  with default distribution, since a data stream can\n  currently only be created if a matching composable index\n  template exists with a data stream definition.\n\nIn a follow up the data stream transport and\nrest actions can be moved to the xpack data-stream module."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "336b11e57715e8e67637c55d08a4e357a0f1c76e", "author": {"user": {"login": "martijnvg", "name": "Martijn van Groningen"}}, "url": "https://github.com/elastic/elasticsearch/commit/336b11e57715e8e67637c55d08a4e357a0f1c76e", "committedDate": "2020-07-09T10:14:56Z", "message": "move more data stream yaml tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e9868a3b3c6ac115adae0f465ba8ddb6f96abf48", "author": {"user": {"login": "martijnvg", "name": "Martijn van Groningen"}}, "url": "https://github.com/elastic/elasticsearch/commit/e9868a3b3c6ac115adae0f465ba8ddb6f96abf48", "committedDate": "2020-07-09T10:21:53Z", "message": "copied resolve index yaml to data stream module and modify the existing to not use data streams"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "36f132909177a46e6502599ab8063bd7882095eb", "author": {"user": {"login": "martijnvg", "name": "Martijn van Groningen"}}, "url": "https://github.com/elastic/elasticsearch/commit/36f132909177a46e6502599ab8063bd7882095eb", "committedDate": "2020-07-09T10:36:44Z", "message": "moved more integ tests to xpack module"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7daa879adb94433877dc1b19ce0fd9ec5b87a35a", "author": {"user": {"login": "martijnvg", "name": "Martijn van Groningen"}}, "url": "https://github.com/elastic/elasticsearch/commit/7daa879adb94433877dc1b19ce0fd9ec5b87a35a", "committedDate": "2020-07-09T11:21:53Z", "message": "Added test that verifies behaviour if composable index template is used with data steam definition and it isn't supported."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e23ae67c6bdbae68a03eac6e88ddb85a0f0969b3", "author": {"user": {"login": "martijnvg", "name": "Martijn van Groningen"}}, "url": "https://github.com/elastic/elasticsearch/commit/e23ae67c6bdbae68a03eac6e88ddb85a0f0969b3", "committedDate": "2020-07-09T11:32:32Z", "message": "fixed checkstyle issues"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8eeb789b0629468f3a12e41c8372742656e40f6a", "author": {"user": {"login": "martijnvg", "name": "Martijn van Groningen"}}, "url": "https://github.com/elastic/elasticsearch/commit/8eeb789b0629468f3a12e41c8372742656e40f6a", "committedDate": "2020-07-09T11:38:52Z", "message": "Remove interface and move validate() method to MetadataFieldMapper class"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3f5754d708ab7e0579dc3227546a23cbd4b39cc1", "author": {"user": {"login": "martijnvg", "name": "Martijn van Groningen"}}, "url": "https://github.com/elastic/elasticsearch/commit/3f5754d708ab7e0579dc3227546a23cbd4b39cc1", "committedDate": "2020-07-09T11:42:39Z", "message": "fixed test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c2f64a4a51b293ee40092bb9752949d383b61fc3", "author": {"user": {"login": "martijnvg", "name": "Martijn van Groningen"}}, "url": "https://github.com/elastic/elasticsearch/commit/c2f64a4a51b293ee40092bb9752949d383b61fc3", "committedDate": "2020-07-09T11:45:13Z", "message": "added jdocs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7d230965f27ea203a9d8b9719f81549f1e685b9d", "author": {"user": {"login": "martijnvg", "name": "Martijn van Groningen"}}, "url": "https://github.com/elastic/elasticsearch/commit/7d230965f27ea203a9d8b9719f81549f1e685b9d", "committedDate": "2020-07-09T11:57:44Z", "message": "include mock repo plugin"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "001a9a433c9cc8f82c786198a9c5cdd5c32d6102", "author": {"user": {"login": "martijnvg", "name": "Martijn van Groningen"}}, "url": "https://github.com/elastic/elasticsearch/commit/001a9a433c9cc8f82c786198a9c5cdd5c32d6102", "committedDate": "2020-07-09T12:03:00Z", "message": "removed apache license headers"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fbcf34e8e7151ea300256ad77423fbc14fc42481", "author": {"user": {"login": "martijnvg", "name": "Martijn van Groningen"}}, "url": "https://github.com/elastic/elasticsearch/commit/fbcf34e8e7151ea300256ad77423fbc14fc42481", "committedDate": "2020-07-09T12:16:22Z", "message": "moved test to its own class. (setup logic got in the way)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1dec7181610b78758da230a684f5410ca00b2c0a", "author": {"user": {"login": "martijnvg", "name": "Martijn van Groningen"}}, "url": "https://github.com/elastic/elasticsearch/commit/1dec7181610b78758da230a684f5410ca00b2c0a", "committedDate": "2020-07-09T13:04:46Z", "message": "Merge remote-tracking branch 'es/master' into move_data_streams_to_xpack"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "203e0aef38973211dbdb6569b80c24087cc32c26", "author": {"user": {"login": "martijnvg", "name": "Martijn van Groningen"}}, "url": "https://github.com/elastic/elasticsearch/commit/203e0aef38973211dbdb6569b80c24087cc32c26", "committedDate": "2020-07-09T13:38:08Z", "message": "move forgotten data stream tests to xpack module"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6b2a7e2867835e149d9a205ce4e61eb2633b93d4", "author": {"user": {"login": "martijnvg", "name": "Martijn van Groningen"}}, "url": "https://github.com/elastic/elasticsearch/commit/6b2a7e2867835e149d9a205ce4e61eb2633b93d4", "committedDate": "2020-07-09T15:00:25Z", "message": "checkstyle!"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ1NzA0OTcx", "url": "https://github.com/elastic/elasticsearch/pull/59293#pullrequestreview-445704971", "createdAt": "2020-07-09T15:02:21Z", "commit": {"oid": "6b2a7e2867835e149d9a205ce4e61eb2633b93d4"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOVQxNTowMjoyMVrOGvVTRA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOVQxNTowNTozOFrOGvVcXg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjI4NTI1Mg==", "bodyText": "Does this need to be removed?", "url": "https://github.com/elastic/elasticsearch/pull/59293#discussion_r452285252", "createdAt": "2020-07-09T15:02:21Z", "author": {"login": "dakrone"}, "path": "gradle/formatting.gradle", "diffHunk": "@@ -127,6 +127,8 @@ def projectPathsToExclude = [\n   ':x-pack:plugin:ccr',\n   ':x-pack:plugin:ccr:qa',\n   ':x-pack:plugin:core',\n+  // TODO: REMOVE BEFORE MAKING PR REVIEWABLE:\n+  ':x-pack:plugin:data-streams',", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6b2a7e2867835e149d9a205ce4e61eb2633b93d4"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjI4NzU4Mg==", "bodyText": "I think we should fail with a parsing error like \"[index_template] unknown field [data_stream]\" to make it clearer that the entire data stream configuration is unsupported, rather than just the @timestamp part", "url": "https://github.com/elastic/elasticsearch/pull/59293#discussion_r452287582", "createdAt": "2020-07-09T15:05:38Z", "author": {"login": "dakrone"}, "path": "server/src/main/java/org/elasticsearch/cluster/metadata/MetadataIndexTemplateService.java", "diffHunk": "@@ -1136,7 +1137,15 @@ private static void validateCompositeTemplate(final ClusterState state,\n                         validateTimestampFieldMapping(tsFieldName, mapperService);\n                     }\n                 } catch (Exception e) {\n-                    throw new IllegalArgumentException(\"invalid composite mappings for [\" + templateName + \"]\", e);\n+                    final String expectedMessageIfDataStreamsIsUsedAndNotSupported =\n+                        \"Failed to parse mapping: Root mapping definition has unsupported parameters:  [_timestamp : {path=@timestamp}]\";\n+                    if (expectedMessageIfDataStreamsIsUsedAndNotSupported.equals(e.getMessage())) {\n+                        // Fail like a parsing expection, since we will be moving data_stream template out of server module and\n+                        // then we would fail with the same error message, like we do here.\n+                        throw new XContentParseException(\"[index_template] unknown field [@timestamp]\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6b2a7e2867835e149d9a205ce4e61eb2633b93d4"}, "originalPosition": 18}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ1NzEzNzg2", "url": "https://github.com/elastic/elasticsearch/pull/59293#pullrequestreview-445713786", "createdAt": "2020-07-09T15:11:47Z", "commit": {"oid": "6b2a7e2867835e149d9a205ce4e61eb2633b93d4"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOVQxNToxMTo0OFrOGvVttw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOVQxNToxMTo0OFrOGvVttw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjI5MjAyMw==", "bodyText": "I will remove this before merging, this to make potential merge conflicts easier to resolve.", "url": "https://github.com/elastic/elasticsearch/pull/59293#discussion_r452292023", "createdAt": "2020-07-09T15:11:48Z", "author": {"login": "martijnvg"}, "path": "gradle/formatting.gradle", "diffHunk": "@@ -127,6 +127,8 @@ def projectPathsToExclude = [\n   ':x-pack:plugin:ccr',\n   ':x-pack:plugin:ccr:qa',\n   ':x-pack:plugin:core',\n+  // TODO: REMOVE BEFORE MAKING PR REVIEWABLE:", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6b2a7e2867835e149d9a205ce4e61eb2633b93d4"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ1NzE1NDkw", "url": "https://github.com/elastic/elasticsearch/pull/59293#pullrequestreview-445715490", "createdAt": "2020-07-09T15:13:39Z", "commit": {"oid": "6b2a7e2867835e149d9a205ce4e61eb2633b93d4"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOVQxNToxMzozOVrOGvVysQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOVQxNToxMzozOVrOGvVysQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjI5MzI5Nw==", "bodyText": "This is a supported API. Can move in a follow-up PR if easier.", "url": "https://github.com/elastic/elasticsearch/pull/59293#discussion_r452293297", "createdAt": "2020-07-09T15:13:39Z", "author": {"login": "danhermann"}, "path": "x-pack/plugin/data-streams/qa/rest/src/test/resources/rest-api-spec/test/data-streams/20_unsupported_apis.yml", "diffHunk": "@@ -0,0 +1,301 @@\n+---\n+\"Test apis that do not supported data streams\":\n+  - skip:\n+      version: \" - 7.8.99\"\n+      reason: \"data streams only supported in 7.9+\"\n+      features: allowed_warnings\n+\n+  - do:\n+      allowed_warnings:\n+        - \"index template [my-template] has index patterns [logs-*] matching patterns from existing older templates [global] with patterns (global => [*]); this template [my-template] will take precedence during new index creation\"\n+      indices.put_index_template:\n+        name: my-template\n+        body:\n+          index_patterns: [logs-*]\n+          template:\n+            mappings:\n+              properties:\n+                '@timestamp':\n+                  type: date\n+          data_stream:\n+            timestamp_field: '@timestamp'\n+\n+  - do:\n+      indices.create_data_stream:\n+        name: logs-foobar\n+  - is_true: acknowledged\n+\n+  - do:\n+      index:\n+        index:  logs-foobar\n+        refresh: true\n+        body:\n+          '@timestamp': '2020-12-12'\n+          foo: bar\n+  - match: {_index: .ds-logs-foobar-000001}\n+\n+  - do:\n+      search:\n+        index: logs-foobar\n+        body: { query: { match_all: {} } }\n+  - length:   { hits.hits: 1  }\n+  - match: { hits.hits.0._index: .ds-logs-foobar-000001 }\n+  - match: { hits.hits.0._source.foo: 'bar' }\n+\n+  - do:\n+      catch: missing\n+      indices.delete:\n+        index: logs-foobar\n+\n+  - do:\n+      indices.delete_data_stream:\n+        name: logs-foobar\n+  - is_true: acknowledged\n+\n+---\n+\"Prohibit clone on data stream's write index\":\n+  - skip:\n+      version: \" - 7.8.99\"\n+      reason: \"data streams only supported in 7.9+\"\n+      features: allowed_warnings\n+\n+  - do:\n+      allowed_warnings:\n+        - \"index template [my-template1] has index patterns [simple-data-stream1] matching patterns from existing older templates [global] with patterns (global => [*]); this template [my-template1] will take precedence during new index creation\"\n+      indices.put_index_template:\n+        name: my-template1\n+        body:\n+          index_patterns: [simple-data-stream1]\n+          template:\n+            mappings:\n+              properties:\n+                '@timestamp':\n+                  type: date\n+          data_stream:\n+            timestamp_field: '@timestamp'\n+\n+  - do:\n+      indices.create_data_stream:\n+        name: simple-data-stream1\n+  - is_true: acknowledged\n+\n+  - do:\n+      catch: bad_request\n+      indices.clone:\n+        index: \".ds-simple-data-stream1-000001\"\n+        target: \"target\"\n+        wait_for_active_shards: 1\n+        master_timeout: 10s\n+        body:\n+          settings:\n+            index.number_of_replicas: 0\n+            index.number_of_shards: 2\n+\n+  - do:\n+      indices.delete_data_stream:\n+        name: simple-data-stream1\n+  - is_true: acknowledged\n+\n+---\n+\"APIs temporarily muted\":\n+  - skip:\n+      version: \"all\"\n+      reason: \"restore to above test after data stream resolution PRs have been merged\"\n+\n+  - do:\n+      catch: bad_request\n+      indices.close:\n+        index: logs-*\n+\n+---\n+\"Prohibit shrink on data stream's write index\":\n+  - skip:\n+      version: \" - 7.8.99\"\n+      reason: \"data streams only supported in 7.9+\"\n+      features: allowed_warnings\n+\n+  - do:\n+      allowed_warnings:\n+        - \"index template [my-template1] has index patterns [simple-data-stream1] matching patterns from existing older templates [global] with patterns (global => [*]); this template [my-template1] will take precedence during new index creation\"\n+      indices.put_index_template:\n+        name: my-template1\n+        body:\n+          index_patterns: [simple-data-stream1]\n+          template:\n+            mappings:\n+              properties:\n+                '@timestamp':\n+                  type: date\n+          data_stream:\n+            timestamp_field: '@timestamp'\n+\n+  - do:\n+      indices.create_data_stream:\n+        name: simple-data-stream1\n+  - is_true: acknowledged\n+\n+  - do:\n+      catch: bad_request\n+      indices.shrink:\n+        index: \".ds-simple-data-stream1-000001\"\n+        target: \"target\"\n+        wait_for_active_shards: 1\n+        master_timeout: 10s\n+        body:\n+          settings:\n+            index.number_of_replicas: 0\n+\n+  - do:\n+      indices.delete_data_stream:\n+        name: simple-data-stream1\n+  - is_true: acknowledged\n+\n+---\n+\"Open write index for data stream opens all backing indices\":", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6b2a7e2867835e149d9a205ce4e61eb2633b93d4"}, "originalPosition": 154}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "59dc7a95f6f06b9ae8601b2f48168660face7e01", "author": {"user": {"login": "martijnvg", "name": "Martijn van Groningen"}}, "url": "https://github.com/elastic/elasticsearch/commit/59dc7a95f6f06b9ae8601b2f48168660face7e01", "committedDate": "2020-07-09T21:14:37Z", "message": "moved more rest tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ded46a997a6c9b06b15981578beefe272fd06dd5", "author": {"user": {"login": "martijnvg", "name": "Martijn van Groningen"}}, "url": "https://github.com/elastic/elasticsearch/commit/ded46a997a6c9b06b15981578beefe272fd06dd5", "committedDate": "2020-07-09T21:28:43Z", "message": "fixed a test and moved unit tests to data stream module, because these relied on _timestamp field mapper."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1278568ba6cb5acd7781482290be6a3b8bc90c0d", "author": {"user": {"login": "martijnvg", "name": "Martijn van Groningen"}}, "url": "https://github.com/elastic/elasticsearch/commit/1278568ba6cb5acd7781482290be6a3b8bc90c0d", "committedDate": "2020-07-09T21:34:09Z", "message": "fixed error message"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e556c5a6652c42cd9fa17b1d91f045b4c00b7ed0", "author": {"user": {"login": "martijnvg", "name": "Martijn van Groningen"}}, "url": "https://github.com/elastic/elasticsearch/commit/e556c5a6652c42cd9fa17b1d91f045b4c00b7ed0", "committedDate": "2020-07-09T21:53:04Z", "message": "Merge remote-tracking branch 'es/master' into move_data_streams_to_xpack"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ2MDQxMjMx", "url": "https://github.com/elastic/elasticsearch/pull/59293#pullrequestreview-446041231", "createdAt": "2020-07-09T23:54:07Z", "commit": {"oid": "e556c5a6652c42cd9fa17b1d91f045b4c00b7ed0"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ2MDU0NTMx", "url": "https://github.com/elastic/elasticsearch/pull/59293#pullrequestreview-446054531", "createdAt": "2020-07-10T00:40:04Z", "commit": {"oid": "e556c5a6652c42cd9fa17b1d91f045b4c00b7ed0"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f24b019cb8c3ddd7f662c9ff7e531a2b436f4f51", "author": {"user": {"login": "martijnvg", "name": "Martijn van Groningen"}}, "url": "https://github.com/elastic/elasticsearch/commit/f24b019cb8c3ddd7f662c9ff7e531a2b436f4f51", "committedDate": "2020-07-10T09:32:15Z", "message": "removed unused imports"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7357635954bebd0f5c5b2272cecdf619ef54f282", "author": {"user": {"login": "martijnvg", "name": "Martijn van Groningen"}}, "url": "https://github.com/elastic/elasticsearch/commit/7357635954bebd0f5c5b2272cecdf619ef54f282", "committedDate": "2020-07-10T09:32:39Z", "message": "Merge remote-tracking branch 'es/master' into move_data_streams_to_xpack"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5355a2f61b9444563decd2a1d725afe666fbeede", "author": {"user": {"login": "martijnvg", "name": "Martijn van Groningen"}}, "url": "https://github.com/elastic/elasticsearch/commit/5355a2f61b9444563decd2a1d725afe666fbeede", "committedDate": "2020-07-10T13:14:41Z", "message": "fixed unit tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9ef96c835c2ede0b7334d2abe74255e1adb100de", "author": {"user": {"login": "martijnvg", "name": "Martijn van Groningen"}}, "url": "https://github.com/elastic/elasticsearch/commit/9ef96c835c2ede0b7334d2abe74255e1adb100de", "committedDate": "2020-07-10T13:23:51Z", "message": "moved full restart test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2d117b2ea0994aecf980c3329a2e80c41cc0977d", "author": {"user": {"login": "martijnvg", "name": "Martijn van Groningen"}}, "url": "https://github.com/elastic/elasticsearch/commit/2d117b2ea0994aecf980c3329a2e80c41cc0977d", "committedDate": "2020-07-10T16:43:52Z", "message": "moved data stream rolling upgrade test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d3913f5d3370dcbbb7a5c60f91dec731af812f44", "author": {"user": {"login": "martijnvg", "name": "Martijn van Groningen"}}, "url": "https://github.com/elastic/elasticsearch/commit/d3913f5d3370dcbbb7a5c60f91dec731af812f44", "committedDate": "2020-07-10T17:26:48Z", "message": "moved data stream css tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c00ae23e82f6decb3ff8f40e288cb55d3be99d96", "author": {"user": {"login": "martijnvg", "name": "Martijn van Groningen"}}, "url": "https://github.com/elastic/elasticsearch/commit/c00ae23e82f6decb3ff8f40e288cb55d3be99d96", "committedDate": "2020-07-10T17:59:53Z", "message": "Merge remote-tracking branch 'es/master' into move_data_streams_to_xpack"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "249979ec220df6d9d6e5a7c40851cf37138e408c", "author": {"user": {"login": "martijnvg", "name": "Martijn van Groningen"}}, "url": "https://github.com/elastic/elasticsearch/commit/249979ec220df6d9d6e5a7c40851cf37138e408c", "committedDate": "2020-07-10T18:08:09Z", "message": "fixed issues after merge"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9f037a391b6d641751b72826aa0cbcc2ce4a3773", "author": {"user": {"login": "martijnvg", "name": "Martijn van Groningen"}}, "url": "https://github.com/elastic/elasticsearch/commit/9f037a391b6d641751b72826aa0cbcc2ce4a3773", "committedDate": "2020-07-10T18:12:30Z", "message": "removed unneeded stuff"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ2OTE3NzM4", "url": "https://github.com/elastic/elasticsearch/pull/59293#pullrequestreview-446917738", "createdAt": "2020-07-12T23:14:44Z", "commit": {"oid": "9f037a391b6d641751b72826aa0cbcc2ce4a3773"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMlQyMzoxNDo0NFrOGwX0Wg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMlQyMzo1NzozNFrOGwYF4A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzM3NTA2Ng==", "bodyText": "Instead of relying on an exception with a specific message, what if we proactively checked if the timestamp mapper existed? We could do something like\nboolean timestampMapperExists = tempIndexService.mapperService().isMetadataField(\"_timestamp\");\n\nand then throw if there's a data_stream definition but no _timestamp metadata mapper.", "url": "https://github.com/elastic/elasticsearch/pull/59293#discussion_r453375066", "createdAt": "2020-07-12T23:14:44Z", "author": {"login": "jtibshirani"}, "path": "server/src/main/java/org/elasticsearch/cluster/metadata/MetadataIndexTemplateService.java", "diffHunk": "@@ -1136,7 +1137,15 @@ private static void validateCompositeTemplate(final ClusterState state,\n                         validateTimestampFieldMapping(tsFieldName, mapperService);\n                     }\n                 } catch (Exception e) {\n-                    throw new IllegalArgumentException(\"invalid composite mappings for [\" + templateName + \"]\", e);\n+                    final String expectedMessageIfDataStreamsIsUsedAndNotSupported =", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9f037a391b6d641751b72826aa0cbcc2ce4a3773"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzM3OTU1Mg==", "bodyText": "Now that we're moving this to the data streams plugin, should we update the naming to be specific to data streams? Calling it something like _data_stream_timestamp could also avoid confusion with the _timestamp metadata mapper we used to provide.", "url": "https://github.com/elastic/elasticsearch/pull/59293#discussion_r453379552", "createdAt": "2020-07-12T23:57:34Z", "author": {"login": "jtibshirani"}, "path": "x-pack/plugin/data-streams/src/main/java/org/elasticsearch/xpack/datastreams/mapper/TimestampFieldMapper.java", "diffHunk": "@@ -1,23 +1,10 @@\n /*\n- * Licensed to Elasticsearch under one or more contributor\n- * license agreements. See the NOTICE file distributed with\n- * this work for additional information regarding copyright\n- * ownership. Elasticsearch licenses this file to you under\n- * the Apache License, Version 2.0 (the \"License\"); you may\n- * not use this file except in compliance with the License.\n- * You may obtain a copy of the License at\n- *\n- *     http://www.apache.org/licenses/LICENSE-2.0\n- *\n- * Unless required by applicable law or agreed to in writing,\n- * software distributed under the License is distributed on an\n- * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n- * KIND, either express or implied.  See the License for the\n- * specific language governing permissions and limitations\n- * under the License.\n+ * Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one\n+ * or more contributor license agreements. Licensed under the Elastic License;\n+ * you may not use this file except in compliance with the Elastic License.\n  */\n \n-package org.elasticsearch.index.mapper;\n+package org.elasticsearch.xpack.datastreams.mapper;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9f037a391b6d641751b72826aa0cbcc2ce4a3773"}, "originalPosition": 24}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "aac9ba93af0e460a280b06c99692afa971a194cb", "author": {"user": {"login": "martijnvg", "name": "Martijn van Groningen"}}, "url": "https://github.com/elastic/elasticsearch/commit/aac9ba93af0e460a280b06c99692afa971a194cb", "committedDate": "2020-07-13T04:55:30Z", "message": "Merge remote-tracking branch 'es/master' into move_data_streams_to_xpack"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b4b7501020eb9000ea1b32aa490321fd338958e5", "author": {"user": {"login": "martijnvg", "name": "Martijn van Groningen"}}, "url": "https://github.com/elastic/elasticsearch/commit/b4b7501020eb9000ea1b32aa490321fd338958e5", "committedDate": "2020-07-13T05:33:49Z", "message": "renamed timestamp field mapper"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8f3cb5c4741add60b0ab84330738a59ec64af54b", "author": {"user": {"login": "martijnvg", "name": "Martijn van Groningen"}}, "url": "https://github.com/elastic/elasticsearch/commit/8f3cb5c4741add60b0ab84330738a59ec64af54b", "committedDate": "2020-07-13T05:47:40Z", "message": "more robust check"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "21cb1c998b77546545fb8334fe471ac426b11a81", "author": {"user": {"login": "martijnvg", "name": "Martijn van Groningen"}}, "url": "https://github.com/elastic/elasticsearch/commit/21cb1c998b77546545fb8334fe471ac426b11a81", "committedDate": "2020-07-13T06:02:08Z", "message": "fixed tests and use feature flag"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "718bdcb9c6f10eea1fec1c3d80bd38320c670eb7", "author": {"user": {"login": "martijnvg", "name": "Martijn van Groningen"}}, "url": "https://github.com/elastic/elasticsearch/commit/718bdcb9c6f10eea1fec1c3d80bd38320c670eb7", "committedDate": "2020-07-13T06:08:23Z", "message": "spotless formatting"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "aa727bfa9048312ff1b917843b7f44d466e43c7c", "author": {"user": {"login": "martijnvg", "name": "Martijn van Groningen"}}, "url": "https://github.com/elastic/elasticsearch/commit/aa727bfa9048312ff1b917843b7f44d466e43c7c", "committedDate": "2020-07-13T06:40:30Z", "message": "fixed tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "355c99a71da3a24a52b29368d098263fa1847159", "author": {"user": {"login": "martijnvg", "name": "Martijn van Groningen"}}, "url": "https://github.com/elastic/elasticsearch/commit/355c99a71da3a24a52b29368d098263fa1847159", "committedDate": "2020-07-13T06:57:16Z", "message": "fixed rename"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1a1485032b35f2fe7ae1676e6c39a19af85ab0c6", "author": {"user": {"login": "martijnvg", "name": "Martijn van Groningen"}}, "url": "https://github.com/elastic/elasticsearch/commit/1a1485032b35f2fe7ae1676e6c39a19af85ab0c6", "committedDate": "2020-07-13T07:06:41Z", "message": "mute bwc tests,\nthe timestamp meta field mapper is renamed from `_timestamp` to `_data_streams_timestamp`"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2116, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}