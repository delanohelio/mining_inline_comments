{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzgxMDQ5NDky", "number": 52918, "title": "Vs refactor wire up ranges and date ranges", "bodyText": "Pretty straightforward wiring up.  Since both RangeAggregatorFactory and DateRangeAggregatorFactory are thin wrappers over the base AbstractRangeFactory, I put the registration logic there.  I did have to fix two exception messages in the tests, but didn't have to change any exception types.", "createdAt": "2020-02-27T20:10:49Z", "url": "https://github.com/elastic/elasticsearch/pull/52918", "merged": true, "mergeCommit": {"oid": "29463c43a23b830beee1c8c31df1f57a8626270e"}, "closed": true, "closedAt": "2020-03-04T22:05:35Z", "author": {"login": "not-napoleon"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcIfWO2gH2gAyMzgxMDQ5NDkyOjNiNDg0NjUyMjg0NzRkNzY5MzVkOTkxYmY4NTlhM2UwY2UwNTZmM2I=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcKdSSmgH2gAyMzgxMDQ5NDkyOjYwZGNhN2MxZDQyYWRkMDg5MjY2Njg5NzgzZGY0ZTUwOTBkMjQ2OGY=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "3b48465228474d76935d991bf859a3e0ce056f3b", "author": {"user": {"login": "not-napoleon", "name": "Mark Tozzi"}}, "url": "https://github.com/elastic/elasticsearch/commit/3b48465228474d76935d991bf859a3e0ce056f3b", "committedDate": "2020-02-27T18:08:49Z", "message": "Initial wire up - tests still failing"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8098ec5058f9e1bd2ca9a93e6cf5ddcacedc3dc7", "author": {"user": {"login": "not-napoleon", "name": "Mark Tozzi"}}, "url": "https://github.com/elastic/elasticsearch/commit/8098ec5058f9e1bd2ca9a93e6cf5ddcacedc3dc7", "committedDate": "2020-02-27T20:08:14Z", "message": "Fix exception messages in tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c67b57e7e99f8249c99f5aa6e3c640f99a862d73", "author": {"user": {"login": "not-napoleon", "name": "Mark Tozzi"}}, "url": "https://github.com/elastic/elasticsearch/commit/c67b57e7e99f8249c99f5aa6e3c640f99a862d73", "committedDate": "2020-03-02T17:15:07Z", "message": "Merge branch 'feature/extensible-values-source' into vs-refactor-wire-up-ranges-and-date-ranges"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ae2a4b1bfc1fcdf15e4fd08519a19b743bc6d43a", "author": {"user": {"login": "not-napoleon", "name": "Mark Tozzi"}}, "url": "https://github.com/elastic/elasticsearch/commit/ae2a4b1bfc1fcdf15e4fd08519a19b743bc6d43a", "committedDate": "2020-03-02T23:07:39Z", "message": "Merge branch 'feature/extensible-values-source' into vs-refactor-wire-up-ranges-and-date-ranges"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1efc5e68d96bfd91fb92c7633465120e9a792701", "author": {"user": {"login": "not-napoleon", "name": "Mark Tozzi"}}, "url": "https://github.com/elastic/elasticsearch/commit/1efc5e68d96bfd91fb92c7633465120e9a792701", "committedDate": "2020-03-03T19:53:03Z", "message": "Merge branch 'feature/extensible-values-source' into vs-refactor-wire-up-ranges-and-date-ranges"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY4ODY4MDQ4", "url": "https://github.com/elastic/elasticsearch/pull/52918#pullrequestreview-368868048", "createdAt": "2020-03-04T15:20:41Z", "commit": {"oid": "1efc5e68d96bfd91fb92c7633465120e9a792701"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQxNToyMDo0MVrOFxxgkQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQxNToyNTo1OFrOFxxu-A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzczNTY5Nw==", "bodyText": "Is Boolean range a valid concept?", "url": "https://github.com/elastic/elasticsearch/pull/52918#discussion_r387735697", "createdAt": "2020-03-04T15:20:41Z", "author": {"login": "csoulios"}, "path": "server/src/main/java/org/elasticsearch/search/aggregations/bucket/range/AbstractRangeAggregatorFactory.java", "diffHunk": "@@ -42,20 +46,44 @@\n     private final InternalRange.Factory<?, ?> rangeFactory;\n     private final R[] ranges;\n     private final boolean keyed;\n+    private final String aggregationTypeName;\n \n+    public static void registerAggregators(ValuesSourceRegistry valuesSourceRegistry, String aggregationName) {\n+        valuesSourceRegistry.register(aggregationName,\n+            List.of(CoreValuesSourceType.NUMERIC, CoreValuesSourceType.DATE, CoreValuesSourceType.BOOLEAN),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1efc5e68d96bfd91fb92c7633465120e9a792701"}, "originalPosition": 30}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzczOTM4NA==", "bodyText": "Copy-paste nit: Exception message should read RangeAggregationSupplier, not HistogramAggregatorSupplier.", "url": "https://github.com/elastic/elasticsearch/pull/52918#discussion_r387739384", "createdAt": "2020-03-04T15:25:58Z", "author": {"login": "csoulios"}, "path": "server/src/main/java/org/elasticsearch/search/aggregations/bucket/range/AbstractRangeAggregatorFactory.java", "diffHunk": "@@ -73,13 +101,14 @@ protected Aggregator doCreateInternal(ValuesSource valuesSource,\n                                             boolean collectsFromSingleBucket,\n                                             List<PipelineAggregator> pipelineAggregators,\n                                             Map<String, Object> metaData) throws IOException {\n-        if (valuesSource instanceof Numeric == false) {\n-            throw new AggregationExecutionException(\"ValuesSource type \" + valuesSource.toString() + \"is not supported for aggregation \" +\n-            this.name());\n+\n+        AggregatorSupplier aggregatorSupplier = queryShardContext.getValuesSourceRegistry().getAggregator(config.valueSourceType(),\n+            aggregationTypeName);\n+        if (aggregatorSupplier instanceof RangeAggregationSupplier == false) {\n+            throw new AggregationExecutionException(\"Registry miss-match - expected HistogramAggregatorSupplier, found [\" +", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1efc5e68d96bfd91fb92c7633465120e9a792701"}, "originalPosition": 86}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "60dca7c1d42add089266689783df4e5090d2468f", "author": {"user": {"login": "not-napoleon", "name": "Mark Tozzi"}}, "url": "https://github.com/elastic/elasticsearch/commit/60dca7c1d42add089266689783df4e5090d2468f", "committedDate": "2020-03-04T20:52:33Z", "message": "fixed error message, supplier name"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2060, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}