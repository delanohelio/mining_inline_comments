{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDMyMzA2NTI0", "number": 57921, "reviewThreads": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMVQyMjoyMTo0NlrOEE3llQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMVQyMjoyOTozN1rOEE3sWQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjczNTQwNTAxOnYy", "diffSide": "RIGHT", "path": "buildSrc/src/main/java/org/elasticsearch/gradle/ElasticsearchJavaPlugin.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMVQyMjoyMTo0NlrOGiwvSQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMVQyMjoyMTo0NlrOGiwvSQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTEwMzMwNQ==", "bodyText": "Nice \ud83d\udc4d", "url": "https://github.com/elastic/elasticsearch/pull/57921#discussion_r439103305", "createdAt": "2020-06-11T22:21:46Z", "author": {"login": "mark-vieira"}, "path": "buildSrc/src/main/java/org/elasticsearch/gradle/ElasticsearchJavaPlugin.java", "diffHunk": "@@ -114,9 +114,24 @@ public void apply(Project project) {\n     public static void configureConfigurations(Project project) {\n         // we want to test compileOnly deps!\n         Configuration compileOnlyConfig = project.getConfigurations().getByName(JavaPlugin.COMPILE_ONLY_CONFIGURATION_NAME);\n-        Configuration testCompileConfig = project.getConfigurations().getByName(JavaPlugin.TEST_COMPILE_CONFIGURATION_NAME);\n-        testCompileConfig.extendsFrom(compileOnlyConfig);\n-\n+        Configuration testImplementationConfig = project.getConfigurations().getByName(JavaPlugin.TEST_IMPLEMENTATION_CONFIGURATION_NAME);\n+        testImplementationConfig.extendsFrom(compileOnlyConfig);\n+\n+        // fail on using deprecated testCompile\n+        project.getConfigurations()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2b161b28badb7739bb59bedde24ba13ebafb7172"}, "originalPosition": 11}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjczNTQwNjIxOnYy", "diffSide": "RIGHT", "path": "buildSrc/src/main/java/org/elasticsearch/gradle/ElasticsearchJavaPlugin.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMVQyMjoyMjoyMlrOGiwwDg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMVQyMjoyMjoyMlrOGiwwDg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTEwMzUwMg==", "bodyText": "We can probably remove this now since we fail if you add any dependencies to this configuration.", "url": "https://github.com/elastic/elasticsearch/pull/57921#discussion_r439103502", "createdAt": "2020-06-11T22:22:22Z", "author": {"login": "mark-vieira"}, "path": "buildSrc/src/main/java/org/elasticsearch/gradle/ElasticsearchJavaPlugin.java", "diffHunk": "@@ -145,6 +160,7 @@ public static void configureConfigurations(Project project) {\n         disableTransitiveDeps.accept(JavaPlugin.TEST_COMPILE_CONFIGURATION_NAME);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2b161b28badb7739bb59bedde24ba13ebafb7172"}, "originalPosition": 38}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjczNTQxMzI2OnYy", "diffSide": "RIGHT", "path": "buildSrc/src/main/java/org/elasticsearch/gradle/precommit/ThirdPartyAuditTask.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMVQyMjoyNToyOVrOGiw0GQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMVQyMjo1OTozMFrOGixf3A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTEwNDUzNw==", "bodyText": "I assume this is to deal with standalone test projects, that don't have a \"main\" sourceset. If so, should we be using testRuntimeClasspath here? I dunno, @rjernst, what do you think? Should we even be auditing third party libraries for qa projects? I think we were discussion what all precommit checks should apply to those recently.", "url": "https://github.com/elastic/elasticsearch/pull/57921#discussion_r439104537", "createdAt": "2020-06-11T22:25:29Z", "author": {"login": "mark-vieira"}, "path": "buildSrc/src/main/java/org/elasticsearch/gradle/precommit/ThirdPartyAuditTask.java", "diffHunk": "@@ -391,7 +391,7 @@ private String runForbiddenAPIsCli() throws IOException {\n     private Configuration getRuntimeConfiguration() {\n         Configuration runtime = getProject().getConfigurations().findByName(\"runtimeClasspath\");\n         if (runtime == null) {\n-            return getProject().getConfigurations().getByName(\"testCompile\");\n+            return getProject().getConfigurations().getByName(\"testCompileClasspath\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2b161b28badb7739bb59bedde24ba13ebafb7172"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTExNDM4MQ==", "bodyText": "I don't think we need third part audit for any tests, just our production code.", "url": "https://github.com/elastic/elasticsearch/pull/57921#discussion_r439114381", "createdAt": "2020-06-11T22:55:10Z", "author": {"login": "rjernst"}, "path": "buildSrc/src/main/java/org/elasticsearch/gradle/precommit/ThirdPartyAuditTask.java", "diffHunk": "@@ -391,7 +391,7 @@ private String runForbiddenAPIsCli() throws IOException {\n     private Configuration getRuntimeConfiguration() {\n         Configuration runtime = getProject().getConfigurations().findByName(\"runtimeClasspath\");\n         if (runtime == null) {\n-            return getProject().getConfigurations().getByName(\"testCompile\");\n+            return getProject().getConfigurations().getByName(\"testCompileClasspath\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTEwNDUzNw=="}, "originalCommit": {"oid": "2b161b28badb7739bb59bedde24ba13ebafb7172"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTExNTc0MA==", "bodyText": "Ok, let's leave this as-is for now, and we can rip this out when we refactor the standalone test plugin.", "url": "https://github.com/elastic/elasticsearch/pull/57921#discussion_r439115740", "createdAt": "2020-06-11T22:59:30Z", "author": {"login": "mark-vieira"}, "path": "buildSrc/src/main/java/org/elasticsearch/gradle/precommit/ThirdPartyAuditTask.java", "diffHunk": "@@ -391,7 +391,7 @@ private String runForbiddenAPIsCli() throws IOException {\n     private Configuration getRuntimeConfiguration() {\n         Configuration runtime = getProject().getConfigurations().findByName(\"runtimeClasspath\");\n         if (runtime == null) {\n-            return getProject().getConfigurations().getByName(\"testCompile\");\n+            return getProject().getConfigurations().getByName(\"testCompileClasspath\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTEwNDUzNw=="}, "originalCommit": {"oid": "2b161b28badb7739bb59bedde24ba13ebafb7172"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjczNTQxNjk1OnYy", "diffSide": "RIGHT", "path": "qa/full-cluster-restart/build.gradle", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMVQyMjoyNzoxMFrOGiw2Ug==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMlQwNjo1NDozN1rOGi5GcA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTEwNTEwNg==", "bodyText": "If we just used testRuntimeClasspath wouldn't that work as well?", "url": "https://github.com/elastic/elasticsearch/pull/57921#discussion_r439105106", "createdAt": "2020-06-11T22:27:10Z", "author": {"login": "mark-vieira"}, "path": "qa/full-cluster-restart/build.gradle", "diffHunk": "@@ -74,6 +74,7 @@ for (Version bwcVersion : BuildParams.bwcVersions.indexCompatible) {\n \n configurations {\n   testArtifacts.extendsFrom testRuntime\n+  testArtifacts.extendsFrom testImplementation", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2b161b28badb7739bb59bedde24ba13ebafb7172"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTIzNTM2MQ==", "bodyText": "That was my initial thought too. but that drags in runtimeOnly which is too much and causes.", "url": "https://github.com/elastic/elasticsearch/pull/57921#discussion_r439235361", "createdAt": "2020-06-12T06:40:58Z", "author": {"login": "breskeby"}, "path": "qa/full-cluster-restart/build.gradle", "diffHunk": "@@ -74,6 +74,7 @@ for (Version bwcVersion : BuildParams.bwcVersions.indexCompatible) {\n \n configurations {\n   testArtifacts.extendsFrom testRuntime\n+  testArtifacts.extendsFrom testImplementation", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTEwNTEwNg=="}, "originalCommit": {"oid": "2b161b28badb7739bb59bedde24ba13ebafb7172"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTI0MDMwNA==", "bodyText": "we probably do not need / want testRuntime at all.", "url": "https://github.com/elastic/elasticsearch/pull/57921#discussion_r439240304", "createdAt": "2020-06-12T06:54:37Z", "author": {"login": "breskeby"}, "path": "qa/full-cluster-restart/build.gradle", "diffHunk": "@@ -74,6 +74,7 @@ for (Version bwcVersion : BuildParams.bwcVersions.indexCompatible) {\n \n configurations {\n   testArtifacts.extendsFrom testRuntime\n+  testArtifacts.extendsFrom testImplementation", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTEwNTEwNg=="}, "originalCommit": {"oid": "2b161b28badb7739bb59bedde24ba13ebafb7172"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjczNTQyMjMzOnYy", "diffSide": "RIGHT", "path": "x-pack/plugin/security/build.gradle", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMVQyMjoyOTozOFrOGiw5rw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMlQxMTozMzoyNVrOGjAxfw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTEwNTk2Nw==", "bodyText": "Can we just remove this?", "url": "https://github.com/elastic/elasticsearch/pull/57921#discussion_r439105967", "createdAt": "2020-06-11T22:29:38Z", "author": {"login": "mark-vieira"}, "path": "x-pack/plugin/security/build.gradle", "diffHunk": "@@ -65,71 +65,71 @@ dependencies {\n   compile \"net.minidev:accessors-smart:1.2\"\n   compile \"org.ow2.asm:asm:7.1\"\n \n-  testCompile 'org.elasticsearch:securemock:1.2'\n-  testCompile \"org.elasticsearch:mocksocket:${versions.mocksocket}\"\n-  //testCompile \"org.yaml:snakeyaml:${versions.snakeyaml}\"\n+  testImplementation 'org.elasticsearch:securemock:1.2'\n+  testImplementation \"org.elasticsearch:mocksocket:${versions.mocksocket}\"\n+  //testImplementation \"org.yaml:snakeyaml:${versions.snakeyaml}\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2b161b28badb7739bb59bedde24ba13ebafb7172"}, "originalPosition": 87}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTM2NjAxNQ==", "bodyText": "done", "url": "https://github.com/elastic/elasticsearch/pull/57921#discussion_r439366015", "createdAt": "2020-06-12T11:33:25Z", "author": {"login": "breskeby"}, "path": "x-pack/plugin/security/build.gradle", "diffHunk": "@@ -65,71 +65,71 @@ dependencies {\n   compile \"net.minidev:accessors-smart:1.2\"\n   compile \"org.ow2.asm:asm:7.1\"\n \n-  testCompile 'org.elasticsearch:securemock:1.2'\n-  testCompile \"org.elasticsearch:mocksocket:${versions.mocksocket}\"\n-  //testCompile \"org.yaml:snakeyaml:${versions.snakeyaml}\"\n+  testImplementation 'org.elasticsearch:securemock:1.2'\n+  testImplementation \"org.elasticsearch:mocksocket:${versions.mocksocket}\"\n+  //testImplementation \"org.yaml:snakeyaml:${versions.snakeyaml}\"", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTEwNTk2Nw=="}, "originalCommit": {"oid": "2b161b28badb7739bb59bedde24ba13ebafb7172"}, "originalPosition": 87}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1661, "cost": 1, "resetAt": "2021-11-12T11:57:46Z"}}}