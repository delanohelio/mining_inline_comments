{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc2NzU0MzM2", "number": 52487, "title": "Use actual current commit id for build scan custom value", "bodyText": "When using runbld with --last-good-commit the commit id reported by Jenkins via build environment variables is not guaranteed to be correct, and in most cases, it isn't. This is because runbld performs a second checkout during the build execution of the \"last good commit\".\nThis pull request changes the commit id reported in build scans to the real commit, and not what Jenkins is incorrectly reporting.", "createdAt": "2020-02-18T17:52:27Z", "url": "https://github.com/elastic/elasticsearch/pull/52487", "merged": true, "mergeCommit": {"oid": "e84eaa75fc2ff9f21b08dd7f25139e5cafa78d4a"}, "closed": true, "closedAt": "2020-02-19T00:24:06Z", "author": {"login": "mark-vieira"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcFlsJugH2gAyMzc2NzU0MzM2OmRkNTYwM2Y0Yjg4YzY4YmFiZGM2OWNkMTg4NzU2YmE2ZTkyMGIxMTE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcFrOUuAFqTM2MDc2NTU2MQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "dd5603f4b88c68babdc69cd188756ba6e920b111", "author": {"user": {"login": "mark-vieira", "name": "Mark Vieira"}}, "url": "https://github.com/elastic/elasticsearch/commit/dd5603f4b88c68babdc69cd188756ba6e920b111", "committedDate": "2020-02-18T17:50:25Z", "message": "Use actual current commit id for build scan custom value\n\nSigned-off-by: Mark Vieira <portugee@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYwNTU5OTUz", "url": "https://github.com/elastic/elasticsearch/pull/52487#pullrequestreview-360559953", "createdAt": "2020-02-18T18:10:48Z", "commit": {"oid": "dd5603f4b88c68babdc69cd188756ba6e920b111"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOFQxODoxMDo0OVrOFrM_pQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOFQxODoxMDo0OVrOFrM_pQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDg0NTk4OQ==", "bodyText": "Should the use of GIT_COMMIT here also be replaced with BuildParams.gitRevision?", "url": "https://github.com/elastic/elasticsearch/pull/52487#discussion_r380845989", "createdAt": "2020-02-18T18:10:49Z", "author": {"login": "rjernst"}, "path": "gradle/build-scan.gradle", "diffHunk": "@@ -76,9 +77,9 @@ buildScan {\n         value 'Git Branch', branch\n         tag branch\n       }\n-      if (System.getenv('GIT_COMMIT')) {\n-        value 'Git Commit ID', System.getenv('GIT_COMMIT')\n-        link 'Source', \"https://github.com/elastic/elasticsearch/tree/${System.getenv('GIT_COMMIT')}\"\n+      value 'Git Commit ID', BuildParams.gitRevision\n+      link 'Source', \"https://github.com/elastic/elasticsearch/tree/${BuildParams.gitRevision}\"\n+      if (System.getenv('GIT_PREVIOUS_COMMIT')) {\n         background {\n           def changes = \"git diff --name-only ${System.getenv('GIT_PREVIOUS_COMMIT')}..${System.getenv('GIT_COMMIT')}\".execute().text.trim()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dd5603f4b88c68babdc69cd188756ba6e920b111"}, "originalPosition": 17}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "45992f7c5e790ad5ff41315fef9549ff614f3995", "author": {"user": {"login": "mark-vieira", "name": "Mark Vieira"}}, "url": "https://github.com/elastic/elasticsearch/commit/45992f7c5e790ad5ff41315fef9549ff614f3995", "committedDate": "2020-02-18T20:08:11Z", "message": "Remove usages on unreliable GIT_PREVIOUS_COMMIT env variable\n\nSigned-off-by: Mark Vieira <portugee@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYwNzY1NTYx", "url": "https://github.com/elastic/elasticsearch/pull/52487#pullrequestreview-360765561", "createdAt": "2020-02-19T00:17:16Z", "commit": {"oid": "45992f7c5e790ad5ff41315fef9549ff614f3995"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2396, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}