{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE3MDM1Mzcy", "number": 56653, "title": "[DOCS] Add throttling based on configuration parameter", "bodyText": "Related to #54862\nThis PR adds throttling to the transform performance considerations in the transform overview  (https://www.elastic.co/guide/en/elasticsearch/reference/master/transform-overview.html#transform-performance). Since there were similar performance tips in \"How transforms work\" (https://www.elastic.co/guide/en/elasticsearch/reference/master/transform-checkpoints.html), I've merged the two and linked them.\nThis PR also edits the API parameter description for docs_per_second, which was added in #56178. It also sorts the order of the parameters in the create and update transform APIs.\nPreview:\n\nhttp://elasticsearch_56653.docs-preview.app.elstc.co/guide/en/elasticsearch/reference/master/transform-overview.html#transform-performance\nhttp://elasticsearch_56653.docs-preview.app.elstc.co/guide/en/elasticsearch/reference/master/transform-checkpoints.html\nhttp://elasticsearch_56653.docs-preview.app.elstc.co/guide/en/elasticsearch/reference/master/update-transform.html\nhttp://elasticsearch_56653.docs-preview.app.elstc.co/guide/en/elasticsearch/reference/master/put-transform.html\nhttp://elasticsearch_56653.docs-preview.app.elstc.co/guide/en/elasticsearch/reference/master/preview-transform.html", "createdAt": "2020-05-12T23:58:20Z", "url": "https://github.com/elastic/elasticsearch/pull/56653", "merged": true, "mergeCommit": {"oid": "d7735d9ef2cf94c1c8867fc29b11c5848eb85613"}, "closed": true, "closedAt": "2020-05-14T15:38:58Z", "author": {"login": "lcawl"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcgrJueAH2gAyNDE3MDM1MzcyOmQ0MGM3ZTdiMjBlZDhmNjRiOTUwMWJhMGRjOGU4NmYzOTJlYWU3YzA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcg9kIcAH2gAyNDE3MDM1MzcyOjZjZmJhMjQ0YTI4MGFhMzMwYWU3ZDRiNWYxMTY0ZTYwZTdmN2NiODE=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "d40c7e7b20ed8f64b9501ba0dc8e86f392eae7c0", "author": {"user": {"login": "lcawl", "name": "Lisa Cawley"}}, "url": "https://github.com/elastic/elasticsearch/commit/d40c7e7b20ed8f64b9501ba0dc8e86f392eae7c0", "committedDate": "2020-05-12T21:28:12Z", "message": "[DOCS] Adds throttling to transform performance tips"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ee74c5516a68bee8a80b01bf142f5a24a6ea653a", "author": {"user": {"login": "lcawl", "name": "Lisa Cawley"}}, "url": "https://github.com/elastic/elasticsearch/commit/ee74c5516a68bee8a80b01bf142f5a24a6ea653a", "committedDate": "2020-05-12T23:52:52Z", "message": "[DOCS] Edits docs_per_second description"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEwNTAyNDk1", "url": "https://github.com/elastic/elasticsearch/pull/56653#pullrequestreview-410502495", "createdAt": "2020-05-13T00:00:47Z", "commit": {"oid": "ee74c5516a68bee8a80b01bf142f5a24a6ea653a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QwMDowMDo0N1rOGUdB1w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QwMDowMDo0N1rOGUdB1w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDEwMDMxMQ==", "bodyText": "and index requests\n\nIs this correct that indexing is also affected by this setting?", "url": "https://github.com/elastic/elasticsearch/pull/56653#discussion_r424100311", "createdAt": "2020-05-13T00:00:47Z", "author": {"login": "lcawl"}, "path": "docs/reference/transform/overview.asciidoc", "diffHunk": "@@ -72,4 +72,10 @@ If your {transform} must process a lot of historic data, it has high resource\n usage initially--particularly during the first checkpoint.\n \n For better performance, make sure that your search aggregations and queries are \n-optimized and that your {transform} is processing only necessary data.\n+optimized and that your {transform} is processing only necessary data. Consider \n+whether you can apply a source query to the {transform} to reduce the scope of \n+data it processes. Also consider whether the cluster has sufficient resources in \n+place to support both the composite aggregation search and the indexing of its\n+results. You can also throttle the rate at which {transforms} perform search and \n+index requests by setting `docs_per_second` when you <<put-transform,create>> or", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ee74c5516a68bee8a80b01bf142f5a24a6ea653a"}, "originalPosition": 10}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEwNjI2Mzk5", "url": "https://github.com/elastic/elasticsearch/pull/56653#pullrequestreview-410626399", "createdAt": "2020-05-13T06:39:15Z", "commit": {"oid": "ee74c5516a68bee8a80b01bf142f5a24a6ea653a"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QwNjozOToxNVrOGUjXzA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QwNjo0MzozNFrOGUje4w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDIwNDIzNg==", "bodyText": "yes, by slowing down the searches, you slow down indexing, too.\nMaybe add a sentence that the transform will take longer if throttling is used, although this seems obvious?\nand maybe something like:\nTo know the current docs_per_second transform is operating you can take a look into stats (-> link to stats) and calculate the rate with:\ndocs_per_second = documents_processed / search_time_in_ms * 1000\n\n(^ I plan to add this to the stats endpoint, however not for 7.8)", "url": "https://github.com/elastic/elasticsearch/pull/56653#discussion_r424204236", "createdAt": "2020-05-13T06:39:15Z", "author": {"login": "hendrikmuhs"}, "path": "docs/reference/transform/overview.asciidoc", "diffHunk": "@@ -72,4 +72,10 @@ If your {transform} must process a lot of historic data, it has high resource\n usage initially--particularly during the first checkpoint.\n \n For better performance, make sure that your search aggregations and queries are \n-optimized and that your {transform} is processing only necessary data.\n+optimized and that your {transform} is processing only necessary data. Consider \n+whether you can apply a source query to the {transform} to reduce the scope of \n+data it processes. Also consider whether the cluster has sufficient resources in \n+place to support both the composite aggregation search and the indexing of its\n+results. You can also throttle the rate at which {transforms} perform search and \n+index requests by setting `docs_per_second` when you <<put-transform,create>> or", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDEwMDMxMQ=="}, "originalCommit": {"oid": "ee74c5516a68bee8a80b01bf142f5a24a6ea653a"}, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDIwNjA1MQ==", "bodyText": "\ud83d\udc4d  sorry for the bad placement! I see, it should be ordered, will do better next time!", "url": "https://github.com/elastic/elasticsearch/pull/56653#discussion_r424206051", "createdAt": "2020-05-13T06:43:34Z", "author": {"login": "hendrikmuhs"}, "path": "docs/reference/transform/apis/put-transform.asciidoc", "diffHunk": "@@ -128,6 +128,23 @@ include::{docdir}/rest-api/common-parms.asciidoc[tag=pivot-group-by]\n ====\n //End pivot\n \n+//Begin settings", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ee74c5516a68bee8a80b01bf142f5a24a6ea653a"}, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6cfba244a280aa330ae7d4b5f1164e60e7f7cb81", "author": {"user": {"login": "lcawl", "name": "Lisa Cawley"}}, "url": "https://github.com/elastic/elasticsearch/commit/6cfba244a280aa330ae7d4b5f1164e60e7f7cb81", "committedDate": "2020-05-13T18:55:20Z", "message": "[DOCS] Adds formula for docs_per_second"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 58, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}