{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc3NTA3MDUw", "number": 52549, "title": "reduce bytes used when serializing Extent", "bodyText": "This commit reflects comments made by Adrien in #50834 surrounding the Extent serialization.\nit re-orders and negates a few values in order to save more space", "createdAt": "2020-02-20T01:45:18Z", "url": "https://github.com/elastic/elasticsearch/pull/52549", "merged": true, "mergeCommit": {"oid": "54483c908ffd2e796093d97c78686affd0744163"}, "closed": true, "closedAt": "2020-02-24T17:31:49Z", "author": {"login": "talevy"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcGBDtVgH2gAyMzc3NTA3MDUwOjM4ODFjN2QzMzk5NTNjNmEyOGJhMmQwYzg0M2RhMTQ3M2Y4MjMwMzE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcHgJFNAH2gAyMzc3NTA3MDUwOjRmNGNjODQzY2U1OWQyMWViOTllMzRmZDI1MDgxMjVkYzUwZjQ2NTc=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "3881c7d339953c6a28ba2d0c843da1473f823031", "author": {"user": {"login": "talevy", "name": "Tal Levy"}}, "url": "https://github.com/elastic/elasticsearch/commit/3881c7d339953c6a28ba2d0c843da1473f823031", "committedDate": "2020-02-20T01:43:35Z", "message": "reduce bytes used when serializing Extent"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYyMTI5NzIx", "url": "https://github.com/elastic/elasticsearch/pull/52549#pullrequestreview-362129721", "createdAt": "2020-02-20T18:23:38Z", "commit": {"oid": "3881c7d339953c6a28ba2d0c843da1473f823031"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMFQxODoyMzozOFrOFseNbw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMFQxODoyMzozOFrOFseNbw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjE3NjYyMw==", "bodyText": "should we encode negLeft directly instead of its delta with posRight, i.e. output.writeVInt(-this.negLeft);", "url": "https://github.com/elastic/elasticsearch/pull/52549#discussion_r382176623", "createdAt": "2020-02-20T18:23:38Z", "author": {"login": "jpountz"}, "path": "server/src/main/java/org/elasticsearch/common/geo/Extent.java", "diffHunk": "@@ -165,15 +167,15 @@ void writeCompressed(ByteBuffersDataOutput output) throws IOException {\n         switch (type) {\n             case NONE_SET : break;\n             case POSITIVE_SET:\n-                output.writeVInt(this.posRight);\n+                output.writeVInt(this.posLeft);\n                 output.writeVLong((long) this.posRight - this.posLeft);\n                 break;\n             case NEGATIVE_SET:\n-                output.writeInt(this.negRight);\n+                output.writeVInt(-this.negRight);\n                 output.writeVLong((long) this.negRight - this.negLeft);\n                 break;\n             case CROSSES_LAT_AXIS:\n-                output.writeInt(this.posRight);\n+                output.writeVInt(this.posRight);\n                 output.writeVLong((long) this.posRight - this.negLeft);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3881c7d339953c6a28ba2d0c843da1473f823031"}, "originalPosition": 53}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYyMTYwODI2", "url": "https://github.com/elastic/elasticsearch/pull/52549#pullrequestreview-362160826", "createdAt": "2020-02-20T19:10:29Z", "commit": {"oid": "3881c7d339953c6a28ba2d0c843da1473f823031"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMFQxOToxMDozMFrOFsfsag==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMFQxOToxMDozMFrOFsfsag==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjIwMDkzOA==", "bodyText": "we should probably update ALL_SET to have the same logic as POSITIVE_SET and NEGATIVE_SET combined?", "url": "https://github.com/elastic/elasticsearch/pull/52549#discussion_r382200938", "createdAt": "2020-02-20T19:10:30Z", "author": {"login": "jpountz"}, "path": "server/src/main/java/org/elasticsearch/common/geo/Extent.java", "diffHunk": "@@ -115,29 +115,31 @@ static void readFromCompressed(ByteArrayDataInput input, Extent extent) {\n                 posRight = Integer.MIN_VALUE;\n                 break;\n             case POSITIVE_SET:\n-                posRight = input.readVInt();\n-                posLeft =  Math.toIntExact(posRight - input.readVLong());\n+                posLeft = input.readVInt();\n+                posRight =  Math.toIntExact(input.readVLong() + posLeft);\n                 negLeft = Integer.MAX_VALUE;\n                 negRight = Integer.MIN_VALUE;\n                 break;\n             case NEGATIVE_SET:\n-                negRight = input.readInt();\n+                negRight = -input.readVInt();\n                 negLeft = Math.toIntExact(negRight - input.readVLong());\n                 posLeft = Integer.MAX_VALUE;\n                 posRight = Integer.MIN_VALUE;\n                 break;\n             case CROSSES_LAT_AXIS:\n-                posRight = input.readInt();\n+                posRight = input.readVInt();\n                 negLeft = Math.toIntExact(posRight - input.readVLong());\n                 posLeft = 0;\n                 negRight = 0;\n                 break;\n-            default:\n+            case ALL_SET:\n                 posRight = input.readVInt();\n                 posLeft =  Math.toIntExact(posRight - input.readVLong());\n                 negRight = input.readInt();\n                 negLeft = Math.toIntExact(negRight - input.readVLong());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3881c7d339953c6a28ba2d0c843da1473f823031"}, "originalPosition": 30}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e2a63595ebbcf6f02bd7ca3ba06cbf13246fe06f", "author": {"user": {"login": "talevy", "name": "Tal Levy"}}, "url": "https://github.com/elastic/elasticsearch/commit/e2a63595ebbcf6f02bd7ca3ba06cbf13246fe06f", "committedDate": "2020-02-20T22:35:21Z", "message": "update more"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4ae6128341dae33f3f5f44bb261730aed8da7236", "author": {"user": {"login": "talevy", "name": "Tal Levy"}}, "url": "https://github.com/elastic/elasticsearch/commit/4ae6128341dae33f3f5f44bb261730aed8da7236", "committedDate": "2020-02-20T22:36:16Z", "message": "remove whitespace"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f0e81e37248f21c5cd89c3185dffe4b349c0b65b", "author": {"user": {"login": "talevy", "name": "Tal Levy"}}, "url": "https://github.com/elastic/elasticsearch/commit/f0e81e37248f21c5cd89c3185dffe4b349c0b65b", "committedDate": "2020-02-21T20:18:00Z", "message": "more cleanup"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYzMjQ1Mzcz", "url": "https://github.com/elastic/elasticsearch/pull/52549#pullrequestreview-363245373", "createdAt": "2020-02-24T09:16:53Z", "commit": {"oid": "f0e81e37248f21c5cd89c3185dffe4b349c0b65b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4f4cc843ce59d21eb99e34fd2508125dc50f4657", "author": {"user": {"login": "talevy", "name": "Tal Levy"}}, "url": "https://github.com/elastic/elasticsearch/commit/4f4cc843ce59d21eb99e34fd2508125dc50f4657", "committedDate": "2020-02-24T16:30:26Z", "message": "Merge remote-tracking branch 'elastic/geoshape-doc-values' into gdv-adrien1"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2208, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}