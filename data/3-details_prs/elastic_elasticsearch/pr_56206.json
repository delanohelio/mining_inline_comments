{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDEzNTQ3Njc4", "number": 56206, "title": "Move bwcVersions extension property to BuildParams", "bodyText": "resolve bwcVersions in GlobalBuildInfoPlugin\nrelated / prerequisite for #56003\nTODO: probably more bwc related work can be moved from build scripts into\ncertain plugins.", "createdAt": "2020-05-05T14:21:20Z", "url": "https://github.com/elastic/elasticsearch/pull/56206", "merged": true, "mergeCommit": {"oid": "fb86184dbb1d09088a2b65ff86a632f263006280"}, "closed": true, "closedAt": "2020-05-07T10:08:17Z", "author": {"login": "breskeby"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABceW_FzAFqTQwNTk3NDE3Nw==", "endCursor": "Y3Vyc29yOnYyOpPPAAABce5A7ogH2gAyNDEzNTQ3Njc4OmE4MGU3ZTk1MmZlOWEzZTI4ZTk3NDRiOGEwMjdkODc4ZGE3MDBhMTQ=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA1OTc0MTc3", "url": "https://github.com/elastic/elasticsearch/pull/56206#pullrequestreview-405974177", "createdAt": "2020-05-05T16:50:08Z", "commit": {"oid": "db91d30680b88abf878c063f34b1133f599e5f0f"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNVQxNjo1MDowOFrOGQyeSg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNVQxNjo1MDowOFrOGQyeSg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDI1NzM1NA==", "bodyText": "I think we should rethrow as an UncheckedIOException. If we aren't able to determine BWC versions this is likely to cause all sorts of build issues so we should treat this as a fatal error. I believe this might already be the case as BuildParams will validate we aren't setting the value to null, but then we end up losing the original exception cause which is not ideal.", "url": "https://github.com/elastic/elasticsearch/pull/56206#discussion_r420257354", "createdAt": "2020-05-05T16:50:08Z", "author": {"login": "mark-vieira"}, "path": "buildSrc/src/main/java/org/elasticsearch/gradle/info/GlobalBuildInfoPlugin.java", "diffHunk": "@@ -92,12 +97,26 @@ public void apply(Project project) {\n             params.setDefaultParallel(findDefaultParallel(project));\n             params.setInFipsJvm(Util.getBooleanProperty(\"tests.fips.enabled\", false));\n             params.setIsSnapshotBuild(Util.getBooleanProperty(\"build.snapshot\", true));\n+            params.setBwcVersions(resolveBwcVersions(rootDir));\n         });\n \n         // Print global build info header just before task execution\n         project.getGradle().getTaskGraph().whenReady(graph -> logGlobalBuildInfo());\n     }\n \n+    /* Introspect all versions of ES that may be tested against for backwards\n+     * compatibility. It is *super* important that this logic is the same as the\n+     * logic in VersionUtils.java. */\n+    private static BwcVersions resolveBwcVersions(File root) {\n+        File versionsFile = new File(root, DEFAULT_VERSION_JAVA_FILE_PATH);\n+        try {\n+            List<String> versionLines = IOUtils.readLines(new FileInputStream(versionsFile), \"UTF-8\");\n+            return new BwcVersions(versionLines);\n+        } catch (IOException e) {\n+            return null;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "db91d30680b88abf878c063f34b1133f599e5f0f"}, "originalPosition": 54}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA2ODI4NzE2", "url": "https://github.com/elastic/elasticsearch/pull/56206#pullrequestreview-406828716", "createdAt": "2020-05-06T17:23:27Z", "commit": {"oid": "5825ac6a5892fb10e7b76027147f2bf512efb7aa"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNlQxNzoyMzoyOFrOGRdeWA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNlQxNzoyMzoyOFrOGRdeWA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDk2MTg4MA==", "bodyText": "nit: I would name this isInternal since that is the property we are setting", "url": "https://github.com/elastic/elasticsearch/pull/56206#discussion_r420961880", "createdAt": "2020-05-06T17:23:28Z", "author": {"login": "rjernst"}, "path": "buildSrc/src/main/java/org/elasticsearch/gradle/info/GlobalBuildInfoPlugin.java", "diffHunk": "@@ -69,10 +73,13 @@ public void apply(Project project) {\n         File compilerJavaHome = findCompilerJavaHome();\n         File runtimeJavaHome = findRuntimeJavaHome(compilerJavaHome);\n \n-        GitInfo gitInfo = gitInfo(project.getRootProject().getRootDir());\n+        File rootDir = project.getRootDir();\n+        GitInfo gitInfo = gitInfo(rootDir);\n \n-        // Initialize global build parameters\n         BuildParams.init(params -> {\n+            // Initialize global build parameters\n+            boolean internalUse = GlobalBuildInfoPlugin.class.getResource(\"/buildSrc.marker\") != null;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5825ac6a5892fb10e7b76027147f2bf512efb7aa"}, "originalPosition": 35}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ece4c76457681207aa7bb183374c1f2d597a9c15", "author": {"user": {"login": "breskeby", "name": "Rene Groeschke"}}, "url": "https://github.com/elastic/elasticsearch/commit/ece4c76457681207aa7bb183374c1f2d597a9c15", "committedDate": "2020-05-07T07:15:44Z", "message": "Move bwcVersions extension property to BuildParams\n\n- resolved in GlobalBuildInfoPlugin\n- TODO: probably more bwc related work can be moved from build scripts into\ncertain plugins."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f50d1b07071f4186ee4ec15e0304902b24c1b55d", "author": {"user": {"login": "breskeby", "name": "Rene Groeschke"}}, "url": "https://github.com/elastic/elasticsearch/commit/f50d1b07071f4186ee4ec15e0304902b24c1b55d", "committedDate": "2020-05-07T07:15:44Z", "message": "Resolve bwcVersions only for internal usage of GlobalBuildInfoPlugin\n\n- propagate exception if version file cannot be resolved\n- add null check when setting bwcVersions"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1a37af430e6c0505706e070a2d5e55ae4e1989cf", "author": {"user": {"login": "breskeby", "name": "Rene Groeschke"}}, "url": "https://github.com/elastic/elasticsearch/commit/1a37af430e6c0505706e070a2d5e55ae4e1989cf", "committedDate": "2020-05-07T07:15:44Z", "message": "Apply small review feedback on variable name"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6ec45809aecbe78e807695e9e8306b7cccafe54b", "author": {"user": {"login": "breskeby", "name": "Rene Groeschke"}}, "url": "https://github.com/elastic/elasticsearch/commit/6ec45809aecbe78e807695e9e8306b7cccafe54b", "committedDate": "2020-05-07T07:11:35Z", "message": "Apply small review feedback on variable name"}, "afterCommit": {"oid": "1a37af430e6c0505706e070a2d5e55ae4e1989cf", "author": {"user": {"login": "breskeby", "name": "Rene Groeschke"}}, "url": "https://github.com/elastic/elasticsearch/commit/1a37af430e6c0505706e070a2d5e55ae4e1989cf", "committedDate": "2020-05-07T07:15:44Z", "message": "Apply small review feedback on variable name"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a80e7e952fe9a3e28e9744b8a027d878da700a14", "author": {"user": {"login": "breskeby", "name": "Rene Groeschke"}}, "url": "https://github.com/elastic/elasticsearch/commit/a80e7e952fe9a3e28e9744b8a027d878da700a14", "committedDate": "2020-05-07T08:29:25Z", "message": "Fix BwcVersions java8 compatibility after merge"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 108, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}