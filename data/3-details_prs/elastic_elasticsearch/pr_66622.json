{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTQyNjk2MjEy", "number": 66622, "title": "QL: handle IP type fields extraction with ignore_malformed property", "bodyText": "Fixes a bug where the field value extraction for an ip field that has ignore_malformed=true still happens from _source even though the value might be ignored because it's not a valid IP.\nFixes also #66675.", "createdAt": "2020-12-18T18:07:42Z", "url": "https://github.com/elastic/elasticsearch/pull/66622", "merged": true, "mergeCommit": {"oid": "106719f6af1eb2f06396161143a5f0185c5d1b54"}, "closed": true, "closedAt": "2020-12-21T12:14:21Z", "author": {"login": "astefan"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdncFLogH2gAyNTQyNjk2MjEyOmVhNDFkOTUzY2M2Zjg5ZDgyZmJiN2ZjMjFjOTVkOTFiZDY5YjM4MDY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdoTaNnAH2gAyNTQyNjk2MjEyOmNjMzM0ZDA0NTE2OGE0MjRhOTEyMWUyMDBiOWU4NzRjOTA5M2EyZTE=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "ea41d953cc6f89d82fbb7fc21c95d91bd69b3806", "author": {"user": {"login": "astefan", "name": "Andrei Stefan"}}, "url": "https://github.com/elastic/elasticsearch/commit/ea41d953cc6f89d82fbb7fc21c95d91bd69b3806", "committedDate": "2020-12-18T18:03:17Z", "message": "Handle ignore_malformed mapping property for IP field types as well."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "aeb3dbce49b5a50b755206393ec71333f16d2015", "author": {"user": {"login": "astefan", "name": "Andrei Stefan"}}, "url": "https://github.com/elastic/elasticsearch/commit/aeb3dbce49b5a50b755206393ec71333f16d2015", "committedDate": "2020-12-18T18:03:40Z", "message": "Merge branch 'master' of https://github.com/elastic/elasticsearch into ip_field_hit_extractor"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU1NzU2OTIw", "url": "https://github.com/elastic/elasticsearch/pull/66622#pullrequestreview-555756920", "createdAt": "2020-12-18T19:23:17Z", "commit": {"oid": "aeb3dbce49b5a50b755206393ec71333f16d2015"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xOFQxOToyMzoxN1rOIIv7zw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xOFQxOToyMzoxN1rOIIv7zw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjA0NDg3OQ==", "bodyText": "Are there any cases where the type is relevant for ignore malformed is set and the return value should not be null?\nIt is currently available for numeric, date , geo-points and IP (https://www.elastic.co/guide/en/elasticsearch/reference/current/ignore-malformed.html).\nI would argue that if it is set, null should be returned regardless of the data type.", "url": "https://github.com/elastic/elasticsearch/pull/66622#discussion_r546044879", "createdAt": "2020-12-18T19:23:17Z", "author": {"login": "costin"}, "path": "x-pack/plugin/ql/src/main/java/org/elasticsearch/xpack/ql/execution/search/extractor/AbstractFieldHitExtractor.java", "diffHunk": "@@ -129,10 +129,10 @@ public Object extract(SearchHit hit) {\n             if (fullFieldName != null\n                     && hit.getFields().containsKey(IgnoredFieldMapper.NAME)\n                     && isFromDocValuesOnly(dataType) == false\n-                    && dataType.isNumeric()) {\n+                    && (dataType.isNumeric() || dataType == DataTypes.IP)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "aeb3dbce49b5a50b755206393ec71333f16d2015"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "75f90b4050b9c165239f9b5fc3d5b2d9c9825dbb", "author": {"user": {"login": "astefan", "name": "Andrei Stefan"}}, "url": "https://github.com/elastic/elasticsearch/commit/75f90b4050b9c165239f9b5fc3d5b2d9c9825dbb", "committedDate": "2020-12-21T10:27:31Z", "message": "Return null for any field that is present in the _ignored section of the\nresponse, not only numerics and IPs.\nAdd more tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cc334d045168a424a9121e200b9e874c9093a2e1", "author": {"user": {"login": "astefan", "name": "Andrei Stefan"}}, "url": "https://github.com/elastic/elasticsearch/commit/cc334d045168a424a9121e200b9e874c9093a2e1", "committedDate": "2020-12-21T10:31:02Z", "message": "Merge branch 'master' of https://github.com/elastic/elasticsearch into ip_field_hit_extractor"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4389, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}