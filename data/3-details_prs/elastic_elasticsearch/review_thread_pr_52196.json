{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzczNjI1MzMw", "number": 52196, "reviewThreads": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMVQxMjoyMDoxMFrODeyEaw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNFQwNjowNDoxMVrOEIOqGg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMzNjA0MjAzOnYy", "diffSide": "RIGHT", "path": "server/src/main/java/org/elasticsearch/action/support/nodes/TransportNodesAction.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMVQxMjoyMDoxMFrOFoG5qw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMVQxMjoyMDoxMFrOFoG5qw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzYwMDQyNw==", "bodyText": "Add a new method to opt-in for using an old action name.", "url": "https://github.com/elastic/elasticsearch/pull/52196#discussion_r377600427", "createdAt": "2020-02-11T12:20:10Z", "author": {"login": "ywangd"}, "path": "server/src/main/java/org/elasticsearch/action/support/nodes/TransportNodesAction.java", "diffHunk": "@@ -138,6 +138,12 @@ protected void resolveRequest(NodesRequest request, ClusterState clusterState) {\n         request.setConcreteNodes(Arrays.stream(nodesIds).map(clusterState.nodes()::get).toArray(DiscoveryNode[]::new));\n     }\n \n+    /**\n+     * Get a backwards compatible transport action name\n+     */\n+    protected String getBwcTransportNodeAction(DiscoveryNode node) {\n+        return transportNodeAction;\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7f3e54a403e406e94dea27660d933d97171d5ba9"}, "originalPosition": 18}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMzNjA0NjQ1OnYy", "diffSide": "RIGHT", "path": "x-pack/plugin/enrich/src/main/java/org/elasticsearch/xpack/enrich/action/TransportEnrichStatsAction.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMVQxMjoyMTozNlrOFoG8Sg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMVQxMjoyMTozNlrOFoG8Sg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzYwMTA5OA==", "bodyText": "Override existing methods for opt-in bwc action name.", "url": "https://github.com/elastic/elasticsearch/pull/52196#discussion_r377601098", "createdAt": "2020-02-11T12:21:36Z", "author": {"login": "ywangd"}, "path": "x-pack/plugin/enrich/src/main/java/org/elasticsearch/xpack/enrich/action/TransportEnrichStatsAction.java", "diffHunk": "@@ -108,4 +110,9 @@ protected void masterOperation(\n     protected ClusterBlockException checkBlock(EnrichStatsAction.Request request, ClusterState state) {\n         return state.blocks().globalBlockedException(ClusterBlockLevel.METADATA_READ);\n     }\n+\n+    @Override\n+    protected String getMasterActionName(DiscoveryNode node) {\n+        return node.getVersion().before(Version.V_7_7_0) ? EnrichStatsAction.OLD_NAME : actionName;\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "325ad3cdcc1f35a47d46dca6ba9c73243b1cfa57"}, "originalPosition": 24}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU5NTQ1ODYzOnYy", "diffSide": "RIGHT", "path": "server/src/main/java/org/elasticsearch/action/support/nodes/TransportNodesAction.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOVQwODoxNDozOVrOGN0SGw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOVQwODoxNjo0MlrOGN0WHg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzE0MTI3NQ==", "bodyText": "I think this just should be\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                protected String getBwcTransportNodeAction(DiscoveryNode node) {\n          \n          \n            \n                protected String getTransportNodeAction(DiscoveryNode node) {\n          \n      \n    \n    \n  \n\nI don't think the \"BWC\" helps with the method name - it assumes that this is only relevant for BWC, but really it's \"what is the right action for this node\" ?", "url": "https://github.com/elastic/elasticsearch/pull/52196#discussion_r417141275", "createdAt": "2020-04-29T08:14:39Z", "author": {"login": "tvernum"}, "path": "server/src/main/java/org/elasticsearch/action/support/nodes/TransportNodesAction.java", "diffHunk": "@@ -138,6 +138,12 @@ protected void resolveRequest(NodesRequest request, ClusterState clusterState) {\n         request.setConcreteNodes(Arrays.stream(nodesIds).map(clusterState.nodes()::get).toArray(DiscoveryNode[]::new));\n     }\n \n+    /**\n+     * Get a backwards compatible transport action name\n+     */\n+    protected String getBwcTransportNodeAction(DiscoveryNode node) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c8a0b4499ee8f27f0a1c6e923b6f96572a57f181"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzE0MjMwMg==", "bodyText": "Also, I think this part of the change should go to master - I know you don't need it for BWC purposes there, but we shouldn't make core API changes on 7.x only.", "url": "https://github.com/elastic/elasticsearch/pull/52196#discussion_r417142302", "createdAt": "2020-04-29T08:16:42Z", "author": {"login": "tvernum"}, "path": "server/src/main/java/org/elasticsearch/action/support/nodes/TransportNodesAction.java", "diffHunk": "@@ -138,6 +138,12 @@ protected void resolveRequest(NodesRequest request, ClusterState clusterState) {\n         request.setConcreteNodes(Arrays.stream(nodesIds).map(clusterState.nodes()::get).toArray(DiscoveryNode[]::new));\n     }\n \n+    /**\n+     * Get a backwards compatible transport action name\n+     */\n+    protected String getBwcTransportNodeAction(DiscoveryNode node) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzE0MTI3NQ=="}, "originalCommit": {"oid": "c8a0b4499ee8f27f0a1c6e923b6f96572a57f181"}, "originalPosition": 16}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU5NTQ2NjI5OnYy", "diffSide": "RIGHT", "path": "x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/enrich/action/EnrichStatsAction.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOVQwODoxNzoxNVrOGN0XNw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wN1QwNDozMzo1NVrOGRuC7g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzE0MjU4Mw==", "bodyText": "Can you add a javadoc here that it had this name in pre 7.8 versions", "url": "https://github.com/elastic/elasticsearch/pull/52196#discussion_r417142583", "createdAt": "2020-04-29T08:17:15Z", "author": {"login": "tvernum"}, "path": "x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/enrich/action/EnrichStatsAction.java", "diffHunk": "@@ -24,7 +24,8 @@\n public class EnrichStatsAction extends ActionType<EnrichStatsAction.Response> {\n \n     public static final EnrichStatsAction INSTANCE = new EnrichStatsAction();\n-    public static final String NAME = \"cluster:admin/xpack/enrich/stats\";\n+    public static final String NAME = \"cluster:monitor/xpack/enrich/stats\";\n+    public static final String BWC_NAME = \"cluster:admin/xpack/enrich/stats\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c8a0b4499ee8f27f0a1c6e923b6f96572a57f181"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTIzMzM5MA==", "bodyText": "Done", "url": "https://github.com/elastic/elasticsearch/pull/52196#discussion_r421233390", "createdAt": "2020-05-07T04:33:55Z", "author": {"login": "ywangd"}, "path": "x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/enrich/action/EnrichStatsAction.java", "diffHunk": "@@ -24,7 +24,8 @@\n public class EnrichStatsAction extends ActionType<EnrichStatsAction.Response> {\n \n     public static final EnrichStatsAction INSTANCE = new EnrichStatsAction();\n-    public static final String NAME = \"cluster:admin/xpack/enrich/stats\";\n+    public static final String NAME = \"cluster:monitor/xpack/enrich/stats\";\n+    public static final String BWC_NAME = \"cluster:admin/xpack/enrich/stats\";", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzE0MjU4Mw=="}, "originalCommit": {"oid": "c8a0b4499ee8f27f0a1c6e923b6f96572a57f181"}, "originalPosition": 6}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU5NTQ3NjczOnYy", "diffSide": "RIGHT", "path": "x-pack/plugin/enrich/src/main/java/org/elasticsearch/xpack/enrich/action/EnrichCoordinatorStatsAction.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOVQwODoyMDoyN1rOGN0d3w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wN1QwNDozNDoyMVrOGRuDYw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzE0NDI4Nw==", "bodyText": "This needs to update now that it's slipped.", "url": "https://github.com/elastic/elasticsearch/pull/52196#discussion_r417144287", "createdAt": "2020-04-29T08:20:27Z", "author": {"login": "tvernum"}, "path": "x-pack/plugin/enrich/src/main/java/org/elasticsearch/xpack/enrich/action/EnrichCoordinatorStatsAction.java", "diffHunk": "@@ -161,6 +184,11 @@ protected NodeResponse nodeOperation(NodeRequest request) {\n             DiscoveryNode node = clusterService.localNode();\n             return new NodeResponse(node, coordinator.getStats(node.getId()));\n         }\n+\n+        @Override\n+        protected String getBwcTransportNodeAction(DiscoveryNode node) {\n+            return node.getVersion().before(Version.V_7_7_0) ? BWC_NAME + \"[n]\" : transportNodeAction;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c8a0b4499ee8f27f0a1c6e923b6f96572a57f181"}, "originalPosition": 64}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTIzMzUwNw==", "bodyText": "Updated to V_7_9_0", "url": "https://github.com/elastic/elasticsearch/pull/52196#discussion_r421233507", "createdAt": "2020-05-07T04:34:21Z", "author": {"login": "ywangd"}, "path": "x-pack/plugin/enrich/src/main/java/org/elasticsearch/xpack/enrich/action/EnrichCoordinatorStatsAction.java", "diffHunk": "@@ -161,6 +184,11 @@ protected NodeResponse nodeOperation(NodeRequest request) {\n             DiscoveryNode node = clusterService.localNode();\n             return new NodeResponse(node, coordinator.getStats(node.getId()));\n         }\n+\n+        @Override\n+        protected String getBwcTransportNodeAction(DiscoveryNode node) {\n+            return node.getVersion().before(Version.V_7_7_0) ? BWC_NAME + \"[n]\" : transportNodeAction;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzE0NDI4Nw=="}, "originalCommit": {"oid": "c8a0b4499ee8f27f0a1c6e923b6f96572a57f181"}, "originalPosition": 64}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc3MDY0MjE4OnYy", "diffSide": "RIGHT", "path": "x-pack/qa/rolling-upgrade/src/test/resources/rest-api-spec/test/mixed_cluster/110_enrich.yml", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNFQwNjowNDoxMVrOGoEFbw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNFQwNjo1NzozN1rOGoFVqg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDY2MzE1MQ==", "bodyText": "Actually, is this right? This is the 7.9 backport.", "url": "https://github.com/elastic/elasticsearch/pull/52196#discussion_r444663151", "createdAt": "2020-06-24T06:04:11Z", "author": {"login": "tvernum"}, "path": "x-pack/qa/rolling-upgrade/src/test/resources/rest-api-spec/test/mixed_cluster/110_enrich.yml", "diffHunk": "@@ -0,0 +1,13 @@\n+---\n+\"Enrich stats query smoke test for mixed cluster\":\n+  - skip:\n+      version: \" - 7.99.99\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2e55e883eecbb0c1f5acc031abe425e47a1619e0"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDY4MzY5MA==", "bodyText": "A silly error of cherry pick and merge... This file (110_enrich.yml) is redundant and the correct one is 120_enrich.yml. I replaced it with the content of 120_enrich.yml.", "url": "https://github.com/elastic/elasticsearch/pull/52196#discussion_r444683690", "createdAt": "2020-06-24T06:57:37Z", "author": {"login": "ywangd"}, "path": "x-pack/qa/rolling-upgrade/src/test/resources/rest-api-spec/test/mixed_cluster/110_enrich.yml", "diffHunk": "@@ -0,0 +1,13 @@\n+---\n+\"Enrich stats query smoke test for mixed cluster\":\n+  - skip:\n+      version: \" - 7.99.99\"", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDY2MzE1MQ=="}, "originalCommit": {"oid": "2e55e883eecbb0c1f5acc031abe425e47a1619e0"}, "originalPosition": 4}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4748, "cost": 1, "resetAt": "2021-11-12T13:16:51Z"}}}