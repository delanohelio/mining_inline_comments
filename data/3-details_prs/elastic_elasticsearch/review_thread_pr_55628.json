{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA3NTI0MDc0", "number": 55628, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yM1QwMjoyODozMVrOD1Dybg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yM1QwMjoyODozMVrOD1Dybg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU2OTYzMTgyOnYy", "diffSide": "RIGHT", "path": "x-pack/plugin/security/src/main/java/org/elasticsearch/xpack/security/authc/file/tool/UsersTool.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yM1QwMjoyODozMVrOGKTxEg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yNFQwNToxOToxNVrOGLG4iQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzQ2MjgwMg==", "bodyText": "#55544 makes sure our default is sane for FIPS mode. But user can still explicit set the password hashing algorithm to something that is not FIPS compliant.\nSince PASSWORD_HASHING_ALGORITHM.get(...) is used in a few other places, rather than checking it at caller side, would it better to have this validation done in its own validator?", "url": "https://github.com/elastic/elasticsearch/pull/55628#discussion_r413462802", "createdAt": "2020-04-23T02:28:31Z", "author": {"login": "ywangd"}, "path": "x-pack/plugin/security/src/main/java/org/elasticsearch/xpack/security/authc/file/tool/UsersTool.java", "diffHunk": "@@ -439,6 +439,10 @@ static String parseUsername(List<String> args, Settings settings) throws UserExc\n \n     private static char[] getPasswordHash(Terminal terminal, Environment env, String cliPasswordValue) throws UserException {\n         final Hasher hasher = Hasher.resolve(XPackSettings.PASSWORD_HASHING_ALGORITHM.get(env.settings()));\n+        if (XPackSettings.FIPS_MODE_ENABLED.get(env.settings()) && hasher.name().toLowerCase(Locale.ROOT).startsWith(\"pbkdf2\") == false) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "068b667a68e7d1113e3f03152aafb82a964805fd"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzg5NTI3MA==", "bodyText": "yes, good point! I though about this too when raising the PR and decided against this based on the following:\n\nIt felt like we would be doing too much in the validator. My idea about the Validator interface for Setting is that it is used for simple validation checks.\nBut mostly that this is the only place where we call get() on it before the node is started ( where or.elasticsearch.xpack.Security#validateForFips would kick in. If we add this in the validator of the setting, then we could as well remove this validation from validateForFips and if we do that , we could as well move other validations from that method to the respective settings Validator. While this is not something I am very strongly opiniated about, I like that we have the checks together in validateForFips and feel like this change is adding a non crucial validation that helps with the user experience", "url": "https://github.com/elastic/elasticsearch/pull/55628#discussion_r413895270", "createdAt": "2020-04-23T15:27:02Z", "author": {"login": "jkakavas"}, "path": "x-pack/plugin/security/src/main/java/org/elasticsearch/xpack/security/authc/file/tool/UsersTool.java", "diffHunk": "@@ -439,6 +439,10 @@ static String parseUsername(List<String> args, Settings settings) throws UserExc\n \n     private static char[] getPasswordHash(Terminal terminal, Environment env, String cliPasswordValue) throws UserException {\n         final Hasher hasher = Hasher.resolve(XPackSettings.PASSWORD_HASHING_ALGORITHM.get(env.settings()));\n+        if (XPackSettings.FIPS_MODE_ENABLED.get(env.settings()) && hasher.name().toLowerCase(Locale.ROOT).startsWith(\"pbkdf2\") == false) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzQ2MjgwMg=="}, "originalCommit": {"oid": "068b667a68e7d1113e3f03152aafb82a964805fd"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDMwMDI5Nw==", "bodyText": "I see your point. Having FIPS validation in one place is preferable. All good. Thanks", "url": "https://github.com/elastic/elasticsearch/pull/55628#discussion_r414300297", "createdAt": "2020-04-24T05:19:15Z", "author": {"login": "ywangd"}, "path": "x-pack/plugin/security/src/main/java/org/elasticsearch/xpack/security/authc/file/tool/UsersTool.java", "diffHunk": "@@ -439,6 +439,10 @@ static String parseUsername(List<String> args, Settings settings) throws UserExc\n \n     private static char[] getPasswordHash(Terminal terminal, Environment env, String cliPasswordValue) throws UserException {\n         final Hasher hasher = Hasher.resolve(XPackSettings.PASSWORD_HASHING_ALGORITHM.get(env.settings()));\n+        if (XPackSettings.FIPS_MODE_ENABLED.get(env.settings()) && hasher.name().toLowerCase(Locale.ROOT).startsWith(\"pbkdf2\") == false) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzQ2MjgwMg=="}, "originalCommit": {"oid": "068b667a68e7d1113e3f03152aafb82a964805fd"}, "originalPosition": 4}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2667, "cost": 1, "resetAt": "2021-11-12T13:16:51Z"}}}