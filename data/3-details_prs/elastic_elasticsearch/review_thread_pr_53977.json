{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzkyMzk0NTg4", "number": 53977, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QxNDo1NTo1MlrODqafIw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQwODozMzoyMFrODqsDvQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ1ODAwNzM5OnYy", "diffSide": "RIGHT", "path": "x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/dataframe/process/AnalyticsProcessManager.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QxNDo1NTo1MlrOF6JOUA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QxNDo1NTo1MlrOF6JOUA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjUxMjg0OA==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    LOGGER.debug(\"[{}] Refreshing indices {}\", jobId, Arrays.toString(refreshRequest.indices()));\n          \n          \n            \n                    LOGGER.debug(() -> new ParameterizedMessage(\"[{}] Refreshing indices {}\", jobId, Arrays.toString(refreshRequest.indices())));\n          \n      \n    \n    \n  \n\nI think the string is created eagerly. This is not strictly necessary unless the logging level is debug.\nThis is a minor thing as most of our logging does not take this into account.", "url": "https://github.com/elastic/elasticsearch/pull/53977#discussion_r396512848", "createdAt": "2020-03-23T14:55:52Z", "author": {"login": "benwtrent"}, "path": "x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/dataframe/process/AnalyticsProcessManager.java", "diffHunk": "@@ -301,12 +303,15 @@ private void refreshDest(DataFrameAnalyticsConfig config) {\n             () -> client.execute(RefreshAction.INSTANCE, new RefreshRequest(config.getDest().getIndex())).actionGet());\n     }\n \n-    private void refreshStateIndex(String jobId) {\n-        String indexName = AnomalyDetectorsIndex.jobStateIndexPattern();\n-        LOGGER.debug(\"[{}] Refresh index {}\", jobId, indexName);\n-\n-        RefreshRequest refreshRequest = new RefreshRequest(indexName);\n+    private void refreshIndices(String jobId) {\n+        RefreshRequest refreshRequest = new RefreshRequest(\n+            AnomalyDetectorsIndex.jobStateIndexPattern(),\n+            MlStatsIndex.indexPattern()\n+        );\n         refreshRequest.indicesOptions(IndicesOptions.lenientExpandOpen());\n+\n+        LOGGER.debug(\"[{}] Refreshing indices {}\", jobId, Arrays.toString(refreshRequest.indices()));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "13e601082329aa5e6166161e09e983d332e4819c"}, "originalPosition": 41}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ2MDg4NjM3OnYy", "diffSide": "RIGHT", "path": "x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/dataframe/process/AnalyticsProcessManager.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQwODozMzoyMFrOF6ll4A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQwOTowMDozM1rOF6mjEQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Njk3NzYzMg==", "bodyText": "Would it make sense to also refresh dest index in this method?", "url": "https://github.com/elastic/elasticsearch/pull/53977#discussion_r396977632", "createdAt": "2020-03-24T08:33:20Z", "author": {"login": "przemekwitek"}, "path": "x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/dataframe/process/AnalyticsProcessManager.java", "diffHunk": "@@ -301,12 +303,15 @@ private void refreshDest(DataFrameAnalyticsConfig config) {\n             () -> client.execute(RefreshAction.INSTANCE, new RefreshRequest(config.getDest().getIndex())).actionGet());\n     }\n \n-    private void refreshStateIndex(String jobId) {\n-        String indexName = AnomalyDetectorsIndex.jobStateIndexPattern();\n-        LOGGER.debug(\"[{}] Refresh index {}\", jobId, indexName);\n-\n-        RefreshRequest refreshRequest = new RefreshRequest(indexName);\n+    private void refreshIndices(String jobId) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "13e601082329aa5e6166161e09e983d332e4819c"}, "originalPosition": 34}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Njk4OTQxMw==", "bodyText": "We need to use the config's headers to refresh the dest index which is why I kept it separate.", "url": "https://github.com/elastic/elasticsearch/pull/53977#discussion_r396989413", "createdAt": "2020-03-24T08:54:25Z", "author": {"login": "dimitris-athanasiou"}, "path": "x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/dataframe/process/AnalyticsProcessManager.java", "diffHunk": "@@ -301,12 +303,15 @@ private void refreshDest(DataFrameAnalyticsConfig config) {\n             () -> client.execute(RefreshAction.INSTANCE, new RefreshRequest(config.getDest().getIndex())).actionGet());\n     }\n \n-    private void refreshStateIndex(String jobId) {\n-        String indexName = AnomalyDetectorsIndex.jobStateIndexPattern();\n-        LOGGER.debug(\"[{}] Refresh index {}\", jobId, indexName);\n-\n-        RefreshRequest refreshRequest = new RefreshRequest(indexName);\n+    private void refreshIndices(String jobId) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Njk3NzYzMg=="}, "originalCommit": {"oid": "13e601082329aa5e6166161e09e983d332e4819c"}, "originalPosition": 34}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Njk5MzI5Nw==", "bodyText": "Right, thanks for explanation.", "url": "https://github.com/elastic/elasticsearch/pull/53977#discussion_r396993297", "createdAt": "2020-03-24T09:00:33Z", "author": {"login": "przemekwitek"}, "path": "x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/dataframe/process/AnalyticsProcessManager.java", "diffHunk": "@@ -301,12 +303,15 @@ private void refreshDest(DataFrameAnalyticsConfig config) {\n             () -> client.execute(RefreshAction.INSTANCE, new RefreshRequest(config.getDest().getIndex())).actionGet());\n     }\n \n-    private void refreshStateIndex(String jobId) {\n-        String indexName = AnomalyDetectorsIndex.jobStateIndexPattern();\n-        LOGGER.debug(\"[{}] Refresh index {}\", jobId, indexName);\n-\n-        RefreshRequest refreshRequest = new RefreshRequest(indexName);\n+    private void refreshIndices(String jobId) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Njk3NzYzMg=="}, "originalCommit": {"oid": "13e601082329aa5e6166161e09e983d332e4819c"}, "originalPosition": 34}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4208, "cost": 1, "resetAt": "2021-11-12T13:16:51Z"}}}