{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDMxODE0Nzcx", "number": 57879, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOVQxNDowNDoyOVrOED5Z7w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOVQxNDowNDoyOVrOED5Z7w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcyNTIxNzExOnYy", "diffSide": "RIGHT", "path": "x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/ssl/SSLService.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOVQxNDowNDoyOVrOGhLvww==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQwNToyMTozOFrOGkLoLQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzQ0ODY0Mw==", "bodyText": "@tvernum I asked for your review since this is changing this default behavior in a patch release ( 7.7.2 ):\n\nBefore the change, if a user configured a JDK8 JVM using the SunJSSE provider in fips mode we would allow them to explicitly enable the diagnostic trust manager on startup and we would fail in runtime\nAfter the change, we do not allow the user to explicitly enable the diagnostic trust manager in this scenario at all and we print a message on INFO level.\n\nI think this is fine, because the new behavior is much more sane and I could argue is a bugfix over the old one, but I wanted to get a +1", "url": "https://github.com/elastic/elasticsearch/pull/57879#discussion_r437448643", "createdAt": "2020-06-09T14:04:29Z", "author": {"login": "jkakavas"}, "path": "x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/ssl/SSLService.java", "diffHunk": "@@ -826,11 +828,21 @@ private static String sslContextAlgorithm(List<String> supportedProtocols) {\n     }\n \n     private boolean shouldEnableDiagnoseTrust() {\n-        if (XPackSettings.FIPS_MODE_ENABLED.get(settings) && DIAGNOSE_TRUST_EXCEPTIONS_SETTING.exists(settings) == false ) {\n+        // We disable the DiagnosticTrustManager in Java 8 when SunJSSE is set in FIPS 140 mode, as it doesn't allow X509TrustManager to be\n+        // wrapped\n+        if (inSunJsseInFipsMode()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "409128398886768af17c706130f5aa90bb1e2c77"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODc3OTIzNA==", "bodyText": "ping @tvernum for a quick +1/-1", "url": "https://github.com/elastic/elasticsearch/pull/57879#discussion_r438779234", "createdAt": "2020-06-11T13:27:06Z", "author": {"login": "jkakavas"}, "path": "x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/ssl/SSLService.java", "diffHunk": "@@ -826,11 +828,21 @@ private static String sslContextAlgorithm(List<String> supportedProtocols) {\n     }\n \n     private boolean shouldEnableDiagnoseTrust() {\n-        if (XPackSettings.FIPS_MODE_ENABLED.get(settings) && DIAGNOSE_TRUST_EXCEPTIONS_SETTING.exists(settings) == false ) {\n+        // We disable the DiagnosticTrustManager in Java 8 when SunJSSE is set in FIPS 140 mode, as it doesn't allow X509TrustManager to be\n+        // wrapped\n+        if (inSunJsseInFipsMode()) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzQ0ODY0Mw=="}, "originalCommit": {"oid": "409128398886768af17c706130f5aa90bb1e2c77"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDU5MjQyOQ==", "bodyText": "+1", "url": "https://github.com/elastic/elasticsearch/pull/57879#discussion_r440592429", "createdAt": "2020-06-16T05:21:38Z", "author": {"login": "tvernum"}, "path": "x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/ssl/SSLService.java", "diffHunk": "@@ -826,11 +828,21 @@ private static String sslContextAlgorithm(List<String> supportedProtocols) {\n     }\n \n     private boolean shouldEnableDiagnoseTrust() {\n-        if (XPackSettings.FIPS_MODE_ENABLED.get(settings) && DIAGNOSE_TRUST_EXCEPTIONS_SETTING.exists(settings) == false ) {\n+        // We disable the DiagnosticTrustManager in Java 8 when SunJSSE is set in FIPS 140 mode, as it doesn't allow X509TrustManager to be\n+        // wrapped\n+        if (inSunJsseInFipsMode()) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzQ0ODY0Mw=="}, "originalCommit": {"oid": "409128398886768af17c706130f5aa90bb1e2c77"}, "originalPosition": 23}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1735, "cost": 1, "resetAt": "2021-11-12T11:57:46Z"}}}