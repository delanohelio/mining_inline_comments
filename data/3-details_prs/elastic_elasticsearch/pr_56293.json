{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE0MjMzNDMx", "number": 56293, "title": "Remove the lexer hack in Painless", "bodyText": "Background:\nThe lexer-hack (https://en.wikipedia.org/wiki/Lexer_hack) was used in Painless to add contextual information around types during lexing. This made the the lexer/grammar much simpler, and allowed us to build a user tree with full typing information at creation.\nLimitations:\nForcing the lexer to know about type information up front requires  that we know all types when building the user tree, so this limits us from a number of things including the following:\n\ngood, consistent error messages as types fail during lexing which gives very poor error messaging since this should be purely syntax errors\ncompiling against different contexts as a possible use case for ensuring a stored script is valid for at least one context\npursuing new front ends such as a possible template language based on Painless\nusing the existing grammar to introduce an auto-completion API\nthe potential of adding new features with specialized types.\n\nResults:\nThis change removes the lexer hack by doing all type checking as part of the semantic pass against the user tree. The lexer now keywords on the primitives and def types while the user tree will use a symbol node instead of a variable node that can potentially be either a type, a piece of a package name, or a variable. One important change is that the dot operator is now overridden. This means that a dot operator may indicate a piece of a package name or a field (a.b could be access field b from variable a or could be the static type a.b). Logic has been introduced to account for this overloaded operator including checks in the expression nodes to ensure they aren't mistakenly using an unexpected static type or an unknown partial type.\nNote this PR appears to be huge, but about 3/4 of it is changes to the auto-generated antlr lexer/parser and additional test cases.", "createdAt": "2020-05-06T17:29:59Z", "url": "https://github.com/elastic/elasticsearch/pull/56293", "merged": true, "mergeCommit": {"oid": "53ea60836198c4924c29e2416b9c4a6d23e0406c"}, "closed": true, "closedAt": "2020-05-14T17:24:32Z", "author": {"login": "jdconrad"}, "timelineItems": {"totalCount": 91, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcR5r_bAH2gAyNDE0MjMzNDMxOmVhYzFkNjFlNDE3MTdkZjUxYjQyZWRmNjVjYmQxNTcwYTJhNDY2NjM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABchQjLIgFqTQxMjAwODQ2Ng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "eac1d61e41717df51b42edf65cbd1570a2a46663", "author": {"user": {"login": "jdconrad", "name": "Jack Conradson"}}, "url": "https://github.com/elastic/elasticsearch/commit/eac1d61e41717df51b42edf65cbd1570a2a46663", "committedDate": "2020-03-27T23:55:26Z", "message": "remove statement, use read instead"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "082e94b4a590591196625bad85750d2fcbc4f551", "author": {"user": {"login": "jdconrad", "name": "Jack Conradson"}}, "url": "https://github.com/elastic/elasticsearch/commit/082e94b4a590591196625bad85750d2fcbc4f551", "committedDate": "2020-03-30T16:27:34Z", "message": "add tests for not a statement"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d6ca6a35cfeb2f5b8689b7258bb19eda858c03bf", "author": {"user": {"login": "jdconrad", "name": "Jack Conradson"}}, "url": "https://github.com/elastic/elasticsearch/commit/d6ca6a35cfeb2f5b8689b7258bb19eda858c03bf", "committedDate": "2020-03-30T16:51:01Z", "message": "Merge branch 'master' into nodes0"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4459ee9a8029edd7c995865bd3202830def8097c", "author": {"user": {"login": "jdconrad", "name": "Jack Conradson"}}, "url": "https://github.com/elastic/elasticsearch/commit/4459ee9a8029edd7c995865bd3202830def8097c", "committedDate": "2020-03-30T19:02:43Z", "message": "move isDefOptimized to output instead of as mutable state on the nodes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1eb0a513f54a2abc3a4d90877d43297a246e7dac", "author": {"user": {"login": "jdconrad", "name": "Jack Conradson"}}, "url": "https://github.com/elastic/elasticsearch/commit/1eb0a513f54a2abc3a4d90877d43297a246e7dac", "committedDate": "2020-03-30T19:05:32Z", "message": "Merge branch 'master' into nodes0"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "372ec631791fceda73c22bb1dfbba176aeba7c1f", "author": {"user": {"login": "jdconrad", "name": "Jack Conradson"}}, "url": "https://github.com/elastic/elasticsearch/commit/372ec631791fceda73c22bb1dfbba176aeba7c1f", "committedDate": "2020-03-30T19:05:58Z", "message": "Merge branch 'nodes0' into nodes1"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "99c54f190497586547ab073b41a0c5d39d89b5fd", "author": {"user": {"login": "jdconrad", "name": "Jack Conradson"}}, "url": "https://github.com/elastic/elasticsearch/commit/99c54f190497586547ab073b41a0c5d39d89b5fd", "committedDate": "2020-03-30T20:18:46Z", "message": "remove AStoreable and give individual nodes responsibility to check\nwrite"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2eceff4ba180840b185ae834b963c9b7ae1f58bc", "author": {"user": {"login": "jdconrad", "name": "Jack Conradson"}}, "url": "https://github.com/elastic/elasticsearch/commit/2eceff4ba180840b185ae834b963c9b7ae1f58bc", "committedDate": "2020-03-30T22:18:14Z", "message": "clean up write messages and add tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "78961f80bef311dfa557dd0288dec8a7a1564be6", "author": {"user": {"login": "jdconrad", "name": "Jack Conradson"}}, "url": "https://github.com/elastic/elasticsearch/commit/78961f80bef311dfa557dd0288dec8a7a1564be6", "committedDate": "2020-03-30T22:57:27Z", "message": "elimate extraneous new array function reference ir node"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7a3a3870e6443c2cfa2cdf9a3e0920977daaaf82", "author": {"user": {"login": "jdconrad", "name": "Jack Conradson"}}, "url": "https://github.com/elastic/elasticsearch/commit/7a3a3870e6443c2cfa2cdf9a3e0920977daaaf82", "committedDate": "2020-03-31T20:07:52Z", "message": "switch ir function ref nodes to different types"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "791eca3b0d29f37c9d84fd196fb03618d33b8606", "author": {"user": {"login": "jdconrad", "name": "Jack Conradson"}}, "url": "https://github.com/elastic/elasticsearch/commit/791eca3b0d29f37c9d84fd196fb03618d33b8606", "committedDate": "2020-03-31T20:45:25Z", "message": "remove ILambda in favor of ir tree calculating def method call recipe"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e77796275a7bf20572efb4dd1610e26ad0adefe1", "author": {"user": {"login": "jdconrad", "name": "Jack Conradson"}}, "url": "https://github.com/elastic/elasticsearch/commit/e77796275a7bf20572efb4dd1610e26ad0adefe1", "committedDate": "2020-03-31T22:52:45Z", "message": "remove sub nodes from user tree"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0eba55c612cfbc1b967b0cd1e2e99fa01b53ec6e", "author": {"user": {"login": "jdconrad", "name": "Jack Conradson"}}, "url": "https://github.com/elastic/elasticsearch/commit/0eba55c612cfbc1b967b0cd1e2e99fa01b53ec6e", "committedDate": "2020-04-01T22:20:46Z", "message": "remove PainlessCast from output as it's completely local"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8d0ac605207b4fd8fb38942de0e7831dd2dfce9e", "author": {"user": {"login": "jdconrad", "name": "Jack Conradson"}}, "url": "https://github.com/elastic/elasticsearch/commit/8d0ac605207b4fd8fb38942de0e7831dd2dfce9e", "committedDate": "2020-04-02T23:59:28Z", "message": "partially removed type from lexer"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "38c15bc41853f468504d1e6517aa78f8d528e4a6", "author": {"user": {"login": "jdconrad", "name": "Jack Conradson"}}, "url": "https://github.com/elastic/elasticsearch/commit/38c15bc41853f468504d1e6517aa78f8d528e4a6", "committedDate": "2020-04-03T23:19:27Z", "message": "removed ambiguity in parsing related to casting versus binary"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3bfed8d6631a604e3da06aa734be4a50ee7c078b", "author": {"user": {"login": "jdconrad", "name": "Jack Conradson"}}, "url": "https://github.com/elastic/elasticsearch/commit/3bfed8d6631a604e3da06aa734be4a50ee7c078b", "committedDate": "2020-04-04T00:42:02Z", "message": "handle negation in the user tree instead of relying on the walker"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f8235dfa22a5e02193bc45b12f35b18eb08df896", "author": {"user": {"login": "jdconrad", "name": "Jack Conradson"}}, "url": "https://github.com/elastic/elasticsearch/commit/f8235dfa22a5e02193bc45b12f35b18eb08df896", "committedDate": "2020-04-06T20:57:57Z", "message": "lexer hack completely removed"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "94b6c80f963c042dae95604d3c6b469fff10d9ac", "author": {"user": {"login": "jdconrad", "name": "Jack Conradson"}}, "url": "https://github.com/elastic/elasticsearch/commit/94b6c80f963c042dae95604d3c6b469fff10d9ac", "committedDate": "2020-04-08T17:03:44Z", "message": "Merge branch 'master' into nodes0"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e7af841e35bcd8d4f845f54ffb082d3d201a51b4", "author": {"user": {"login": "jdconrad", "name": "Jack Conradson"}}, "url": "https://github.com/elastic/elasticsearch/commit/e7af841e35bcd8d4f845f54ffb082d3d201a51b4", "committedDate": "2020-04-08T17:03:54Z", "message": "Merge branch 'nodes0' into nodes1"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "97549c8d5b65a1c97a361a9fb8fa30bdab0ea6db", "author": {"user": {"login": "jdconrad", "name": "Jack Conradson"}}, "url": "https://github.com/elastic/elasticsearch/commit/97549c8d5b65a1c97a361a9fb8fa30bdab0ea6db", "committedDate": "2020-04-08T17:24:14Z", "message": "Merge branch 'nodes1' into nodes2"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "68cd9273b01b4d9a5b27546c3a61862dd7c424b4", "author": {"user": {"login": "jdconrad", "name": "Jack Conradson"}}, "url": "https://github.com/elastic/elasticsearch/commit/68cd9273b01b4d9a5b27546c3a61862dd7c424b4", "committedDate": "2020-04-08T17:26:09Z", "message": "Merge branch 'nodes2' into nodes3"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "112048c228d27db7920c45d54c504965bf273be5", "author": {"user": {"login": "jdconrad", "name": "Jack Conradson"}}, "url": "https://github.com/elastic/elasticsearch/commit/112048c228d27db7920c45d54c504965bf273be5", "committedDate": "2020-04-08T17:29:05Z", "message": "Merge branch 'nodes3' into nodes4"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5669498608729c5633e15b53142b0126e9d2e2c7", "author": {"user": {"login": "jdconrad", "name": "Jack Conradson"}}, "url": "https://github.com/elastic/elasticsearch/commit/5669498608729c5633e15b53142b0126e9d2e2c7", "committedDate": "2020-04-08T17:30:40Z", "message": "Merge branch 'nodes4' into nodes5"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "56b43370baaac38d98593a92fe96fb063c5b0585", "author": {"user": {"login": "jdconrad", "name": "Jack Conradson"}}, "url": "https://github.com/elastic/elasticsearch/commit/56b43370baaac38d98593a92fe96fb063c5b0585", "committedDate": "2020-04-08T19:23:30Z", "message": "add javadocs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1f6bf2f30cb90de1e386f96326ea146435e73921", "author": {"user": {"login": "jdconrad", "name": "Jack Conradson"}}, "url": "https://github.com/elastic/elasticsearch/commit/1f6bf2f30cb90de1e386f96326ea146435e73921", "committedDate": "2020-04-08T22:16:30Z", "message": "add guards for invalid static values"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "50fc23b95ff6254430cbe5b1fe3382ebed451752", "author": {"user": {"login": "jdconrad", "name": "Jack Conradson"}}, "url": "https://github.com/elastic/elasticsearch/commit/50fc23b95ff6254430cbe5b1fe3382ebed451752", "committedDate": "2020-04-09T20:56:43Z", "message": "add partial types tests and not a symbol tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1b61f58c3a9fbbd924eaa7647d96b9541d4e9919", "author": {"user": {"login": "jdconrad", "name": "Jack Conradson"}}, "url": "https://github.com/elastic/elasticsearch/commit/1b61f58c3a9fbbd924eaa7647d96b9541d4e9919", "committedDate": "2020-04-09T21:50:23Z", "message": "add tests for valid static types"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "07b1efe9f647668e41a4121ab987968d1ba7b425", "author": {"user": {"login": "jdconrad", "name": "Jack Conradson"}}, "url": "https://github.com/elastic/elasticsearch/commit/07b1efe9f647668e41a4121ab987968d1ba7b425", "committedDate": "2020-04-09T23:33:29Z", "message": "add precedence node to handle final lexer hack removal path"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "251ff50fcac2ded70f1026560cf7cb67d1e86c28", "author": {"user": {"login": "jdconrad", "name": "Jack Conradson"}}, "url": "https://github.com/elastic/elasticsearch/commit/251ff50fcac2ded70f1026560cf7cb67d1e86c28", "committedDate": "2020-04-10T15:30:43Z", "message": "Merge branch 'master' into nodes1"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "198fa475e180a169ca1911734d49096dbaf4a1f3", "author": {"user": {"login": "jdconrad", "name": "Jack Conradson"}}, "url": "https://github.com/elastic/elasticsearch/commit/198fa475e180a169ca1911734d49096dbaf4a1f3", "committedDate": "2020-04-10T15:36:40Z", "message": "Merge branch 'nodes1' into nodes2"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dd82b5f86711cb8d99c686d9fa21ddb035e84880", "author": {"user": {"login": "jdconrad", "name": "Jack Conradson"}}, "url": "https://github.com/elastic/elasticsearch/commit/dd82b5f86711cb8d99c686d9fa21ddb035e84880", "committedDate": "2020-04-10T15:40:21Z", "message": "Merge branch 'nodes2' into nodes3"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "87cafb387bc0f8096d3b7929b1d5186c481fdb39", "author": {"user": {"login": "jdconrad", "name": "Jack Conradson"}}, "url": "https://github.com/elastic/elasticsearch/commit/87cafb387bc0f8096d3b7929b1d5186c481fdb39", "committedDate": "2020-04-10T15:42:14Z", "message": "Merge branch 'nodes3' into nodes4"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c466828680319beea3cc0087cfbf0ba73e5010eb", "author": {"user": {"login": "jdconrad", "name": "Jack Conradson"}}, "url": "https://github.com/elastic/elasticsearch/commit/c466828680319beea3cc0087cfbf0ba73e5010eb", "committedDate": "2020-04-10T15:44:06Z", "message": "Merge branch 'nodes4' into nodes5"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e60482addcf51170606e74a6c0870481b705f14e", "author": {"user": {"login": "jdconrad", "name": "Jack Conradson"}}, "url": "https://github.com/elastic/elasticsearch/commit/e60482addcf51170606e74a6c0870481b705f14e", "committedDate": "2020-04-10T18:35:21Z", "message": "move prefix into nodes its actually used in"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8c902dad68b1317b13097a4818d45f9fc1bed7a5", "author": {"user": {"login": "jdconrad", "name": "Jack Conradson"}}, "url": "https://github.com/elastic/elasticsearch/commit/8c902dad68b1317b13097a4818d45f9fc1bed7a5", "committedDate": "2020-04-14T20:28:16Z", "message": "Use block instead of list of statements for Lambda"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a79f9b33ca1b8333d0e0b471c8c337674ca6f3f4", "author": {"user": {"login": "jdconrad", "name": "Jack Conradson"}}, "url": "https://github.com/elastic/elasticsearch/commit/a79f9b33ca1b8333d0e0b471c8c337674ca6f3f4", "committedDate": "2020-04-14T23:12:20Z", "message": "Merge branch 'master' into nodes1"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4c93293c2ada3933550f1b64fa303a8785b7b328", "author": {"user": {"login": "jdconrad", "name": "Jack Conradson"}}, "url": "https://github.com/elastic/elasticsearch/commit/4c93293c2ada3933550f1b64fa303a8785b7b328", "committedDate": "2020-04-14T23:12:46Z", "message": "Merge branch 'nodes1' into nodes2"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "14079081e7c0e4fb365a4a48abef0aa16f0a9692", "author": {"user": {"login": "jdconrad", "name": "Jack Conradson"}}, "url": "https://github.com/elastic/elasticsearch/commit/14079081e7c0e4fb365a4a48abef0aa16f0a9692", "committedDate": "2020-04-15T20:18:06Z", "message": "add primitive types to remove binary recognition of cast"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7a349b32470df4fa11b472acae915c8a5a63b5a2", "author": {"user": {"login": "jdconrad", "name": "Jack Conradson"}}, "url": "https://github.com/elastic/elasticsearch/commit/7a349b32470df4fa11b472acae915c8a5a63b5a2", "committedDate": "2020-04-15T20:39:54Z", "message": "remove unnecessary nodes from EDot"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "68679c8c4249bc8af9b28b449b5695fa8816b0cf", "author": {"user": {"login": "jdconrad", "name": "Jack Conradson"}}, "url": "https://github.com/elastic/elasticsearch/commit/68679c8c4249bc8af9b28b449b5695fa8816b0cf", "committedDate": "2020-04-15T20:58:15Z", "message": "remove precedence"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bb55509d9540c641e5f50e184bd4790153fbedea", "author": {"user": {"login": "jdconrad", "name": "Jack Conradson"}}, "url": "https://github.com/elastic/elasticsearch/commit/bb55509d9540c641e5f50e184bd4790153fbedea", "committedDate": "2020-04-16T22:03:44Z", "message": "remove node creation in EUnary"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1de2751d9913ab8ebca868c727b759cbbb1c7b2a", "author": {"user": {"login": "jdconrad", "name": "Jack Conradson"}}, "url": "https://github.com/elastic/elasticsearch/commit/1de2751d9913ab8ebca868c727b759cbbb1c7b2a", "committedDate": "2020-04-16T22:31:34Z", "message": "remove remaining node instantiations within the semantic pass"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c8076bfa4366e371aaba802a038db3c56ce43074", "author": {"user": {"login": "jdconrad", "name": "Jack Conradson"}}, "url": "https://github.com/elastic/elasticsearch/commit/c8076bfa4366e371aaba802a038db3c56ce43074", "committedDate": "2020-04-21T14:51:10Z", "message": "Merge branch 'master' into nodes2"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a4d34169a4724a4111cb30c9671e79798b64f3ef", "author": {"user": {"login": "jdconrad", "name": "Jack Conradson"}}, "url": "https://github.com/elastic/elasticsearch/commit/a4d34169a4724a4111cb30c9671e79798b64f3ef", "committedDate": "2020-04-21T16:38:42Z", "message": "response to pr comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dafeaeb13af618684c04f0f5d38d509d4af92533", "author": {"user": {"login": "jdconrad", "name": "Jack Conradson"}}, "url": "https://github.com/elastic/elasticsearch/commit/dafeaeb13af618684c04f0f5d38d509d4af92533", "committedDate": "2020-04-21T17:31:42Z", "message": "Merge branch 'master' into nodes2"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ee2e19f11c6d3781eb420fc9c94d8bb1342d76a4", "author": {"user": {"login": "jdconrad", "name": "Jack Conradson"}}, "url": "https://github.com/elastic/elasticsearch/commit/ee2e19f11c6d3781eb420fc9c94d8bb1342d76a4", "committedDate": "2020-04-21T17:32:33Z", "message": "Merge branch 'nodes2' into nodes3"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9f2cdd1d6db22e474db4a1664b28942f32b6e8d6", "author": {"user": {"login": "jdconrad", "name": "Jack Conradson"}}, "url": "https://github.com/elastic/elasticsearch/commit/9f2cdd1d6db22e474db4a1664b28942f32b6e8d6", "committedDate": "2020-04-21T17:38:07Z", "message": "Merge branch 'nodes3' into nodes4"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3250d9eeb0a9c1532353d79fb3daceb74f941686", "author": {"user": {"login": "jdconrad", "name": "Jack Conradson"}}, "url": "https://github.com/elastic/elasticsearch/commit/3250d9eeb0a9c1532353d79fb3daceb74f941686", "committedDate": "2020-04-21T17:44:40Z", "message": "Merge branch 'nodes4' into nodes5"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d965f14ba797d115a5e499178807bbc288e7136b", "author": {"user": {"login": "jdconrad", "name": "Jack Conradson"}}, "url": "https://github.com/elastic/elasticsearch/commit/d965f14ba797d115a5e499178807bbc288e7136b", "committedDate": "2020-04-21T17:47:09Z", "message": "Merge branch 'nodes5' into nodes6"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "229f99c28164fe814514b26a412c191eae39de4c", "author": {"user": {"login": "jdconrad", "name": "Jack Conradson"}}, "url": "https://github.com/elastic/elasticsearch/commit/229f99c28164fe814514b26a412c191eae39de4c", "committedDate": "2020-04-21T17:51:01Z", "message": "Merge branch 'nodes6' into semantic0"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a1ff4a0a9d2141722bffeb4d8b6fef3fc5e7addb", "author": {"user": {"login": "jdconrad", "name": "Jack Conradson"}}, "url": "https://github.com/elastic/elasticsearch/commit/a1ff4a0a9d2141722bffeb4d8b6fef3fc5e7addb", "committedDate": "2020-04-24T14:26:04Z", "message": "Merge branch 'master' into nodes3"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1531a1e5ae9574fe54a26a63651c26c64391d733", "author": {"user": {"login": "jdconrad", "name": "Jack Conradson"}}, "url": "https://github.com/elastic/elasticsearch/commit/1531a1e5ae9574fe54a26a63651c26c64391d733", "committedDate": "2020-04-24T14:34:07Z", "message": "Merge branch 'nodes3' into nodes4"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b16f828448b6416194d7bbbe4bb7f77808b9b62f", "author": {"user": {"login": "jdconrad", "name": "Jack Conradson"}}, "url": "https://github.com/elastic/elasticsearch/commit/b16f828448b6416194d7bbbe4bb7f77808b9b62f", "committedDate": "2020-04-24T14:34:42Z", "message": "Merge branch 'nodes4' into nodes5"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cd139e2bf3de1f018a0659466066d7f2744a3f33", "author": {"user": {"login": "jdconrad", "name": "Jack Conradson"}}, "url": "https://github.com/elastic/elasticsearch/commit/cd139e2bf3de1f018a0659466066d7f2744a3f33", "committedDate": "2020-04-24T14:34:59Z", "message": "Merge branch 'nodes5' into nodes6"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ca1febb58a3fb9b59d904a85ba27cef7b4ffb58a", "author": {"user": {"login": "jdconrad", "name": "Jack Conradson"}}, "url": "https://github.com/elastic/elasticsearch/commit/ca1febb58a3fb9b59d904a85ba27cef7b4ffb58a", "committedDate": "2020-04-24T14:35:15Z", "message": "Merge branch 'nodes6' into semantic0"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "64796ba9432bd5240d7bd1a9190503622d0af0ba", "author": {"user": {"login": "jdconrad", "name": "Jack Conradson"}}, "url": "https://github.com/elastic/elasticsearch/commit/64796ba9432bd5240d7bd1a9190503622d0af0ba", "committedDate": "2020-04-29T20:36:52Z", "message": "Merge branch 'master' into nodes3"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "35a029e05a0b237f0de461efc33cb94992739614", "author": {"user": {"login": "jdconrad", "name": "Jack Conradson"}}, "url": "https://github.com/elastic/elasticsearch/commit/35a029e05a0b237f0de461efc33cb94992739614", "committedDate": "2020-04-29T20:57:49Z", "message": "response to pr comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "948d6ecef2a5b02f15c90a96b35cbbaec9971720", "author": {"user": {"login": "jdconrad", "name": "Jack Conradson"}}, "url": "https://github.com/elastic/elasticsearch/commit/948d6ecef2a5b02f15c90a96b35cbbaec9971720", "committedDate": "2020-04-29T21:49:47Z", "message": "Merge branch 'master' into nodes3"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5542b0f9fd649660bc36198b7d45161a8954794e", "author": {"user": {"login": "jdconrad", "name": "Jack Conradson"}}, "url": "https://github.com/elastic/elasticsearch/commit/5542b0f9fd649660bc36198b7d45161a8954794e", "committedDate": "2020-04-29T21:49:54Z", "message": "Merge branch 'nodes3' into nodes4"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4c80224cbb7c20e50837862eafc0f8bc41f84cff", "author": {"user": {"login": "jdconrad", "name": "Jack Conradson"}}, "url": "https://github.com/elastic/elasticsearch/commit/4c80224cbb7c20e50837862eafc0f8bc41f84cff", "committedDate": "2020-05-04T15:56:39Z", "message": "Merge branch 'master' into nodes4"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5cdb321bc0432297d5579d1029f165b5ef35d6d0", "author": {"user": {"login": "jdconrad", "name": "Jack Conradson"}}, "url": "https://github.com/elastic/elasticsearch/commit/5cdb321bc0432297d5579d1029f165b5ef35d6d0", "committedDate": "2020-05-04T21:52:47Z", "message": "Merge branch 'master' into nodes4"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f3298b3c94c730f91247bb0f9a58a7123423f24b", "author": {"user": {"login": "jdconrad", "name": "Jack Conradson"}}, "url": "https://github.com/elastic/elasticsearch/commit/f3298b3c94c730f91247bb0f9a58a7123423f24b", "committedDate": "2020-05-04T22:12:50Z", "message": "Merge branch 'nodes4' into nodes5"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c5153953dc331280025c2bfc5b8c145c140b5d0a", "author": {"user": {"login": "jdconrad", "name": "Jack Conradson"}}, "url": "https://github.com/elastic/elasticsearch/commit/c5153953dc331280025c2bfc5b8c145c140b5d0a", "committedDate": "2020-05-04T22:14:50Z", "message": "remove unnecessary read/write checks"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c74a5c91176b02104639b491960ea9436c9fef0f", "author": {"user": {"login": "jdconrad", "name": "Jack Conradson"}}, "url": "https://github.com/elastic/elasticsearch/commit/c74a5c91176b02104639b491960ea9436c9fef0f", "committedDate": "2020-05-04T23:42:15Z", "message": "Merge branch 'nodes5' into nodes6"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "26f1d5cc262b982ea697077af5c13c40702c0c37", "author": {"user": {"login": "jdconrad", "name": "Jack Conradson"}}, "url": "https://github.com/elastic/elasticsearch/commit/26f1d5cc262b982ea697077af5c13c40702c0c37", "committedDate": "2020-05-04T23:50:38Z", "message": "Merge branch 'nodes6' into semantic0"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cf023817db9f7b1e8d313a65dfb940f9fbd0e541", "author": {"user": {"login": "jdconrad", "name": "Jack Conradson"}}, "url": "https://github.com/elastic/elasticsearch/commit/cf023817db9f7b1e8d313a65dfb940f9fbd0e541", "committedDate": "2020-05-05T16:35:17Z", "message": "Merge branch 'master' into nodes5"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4a70d3fb81f22666dbb013aa8ed07604f999d2fe", "author": {"user": {"login": "jdconrad", "name": "Jack Conradson"}}, "url": "https://github.com/elastic/elasticsearch/commit/4a70d3fb81f22666dbb013aa8ed07604f999d2fe", "committedDate": "2020-05-05T16:35:23Z", "message": "Merge branch 'nodes5' into nodes6"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3201a274cba9ecb9a3752162ad5e2b5a72b360e6", "author": {"user": {"login": "jdconrad", "name": "Jack Conradson"}}, "url": "https://github.com/elastic/elasticsearch/commit/3201a274cba9ecb9a3752162ad5e2b5a72b360e6", "committedDate": "2020-05-05T16:35:31Z", "message": "Merge branch 'nodes6' into semantic0"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "729c1dbe82bd49f9058761d57a548f6a622bd14e", "author": {"user": {"login": "jdconrad", "name": "Jack Conradson"}}, "url": "https://github.com/elastic/elasticsearch/commit/729c1dbe82bd49f9058761d57a548f6a622bd14e", "committedDate": "2020-05-06T16:53:29Z", "message": "Merge branch 'master' into nodes5"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c50c2ce955a2742df50d7522510f51e8855f42ed", "author": {"user": {"login": "jdconrad", "name": "Jack Conradson"}}, "url": "https://github.com/elastic/elasticsearch/commit/c50c2ce955a2742df50d7522510f51e8855f42ed", "committedDate": "2020-05-06T16:53:47Z", "message": "Merge branch 'nodes5' into nodes6"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4c25b66fba923701651e21ceaeac08834e90b5d5", "author": {"user": {"login": "jdconrad", "name": "Jack Conradson"}}, "url": "https://github.com/elastic/elasticsearch/commit/4c25b66fba923701651e21ceaeac08834e90b5d5", "committedDate": "2020-05-06T16:54:07Z", "message": "Merge branch 'nodes6' into semantic0"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "680a8b32d49ee9d9e8c349b6b98bf440ca0c0d07", "author": {"user": {"login": "jdconrad", "name": "Jack Conradson"}}, "url": "https://github.com/elastic/elasticsearch/commit/680a8b32d49ee9d9e8c349b6b98bf440ca0c0d07", "committedDate": "2020-05-06T17:31:55Z", "message": "remove unnecessary test code from Walker"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "394cf2fa4386f5443a9c1a2e75434dd03063117a", "author": {"user": {"login": "jdconrad", "name": "Jack Conradson"}}, "url": "https://github.com/elastic/elasticsearch/commit/394cf2fa4386f5443a9c1a2e75434dd03063117a", "committedDate": "2020-05-06T17:59:43Z", "message": "fix imports"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6b429c66512befbd1fadb82285679b19378a8e84", "author": {"user": {"login": "jdconrad", "name": "Jack Conradson"}}, "url": "https://github.com/elastic/elasticsearch/commit/6b429c66512befbd1fadb82285679b19378a8e84", "committedDate": "2020-05-06T22:12:46Z", "message": "remove more dead code"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a9753af0cbc6f6b52295afc4e5ba5e17e4c9799a", "author": {"user": {"login": "jdconrad", "name": "Jack Conradson"}}, "url": "https://github.com/elastic/elasticsearch/commit/a9753af0cbc6f6b52295afc4e5ba5e17e4c9799a", "committedDate": "2020-05-07T15:37:21Z", "message": "Merge branch 'master' into nodes5"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "77bb1df417baf81f2673d54fd28e89581152d4c8", "author": {"user": {"login": "jdconrad", "name": "Jack Conradson"}}, "url": "https://github.com/elastic/elasticsearch/commit/77bb1df417baf81f2673d54fd28e89581152d4c8", "committedDate": "2020-05-07T15:37:27Z", "message": "Merge branch 'nodes5' into nodes6"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9106ae5756e688351f69a96ba2b53f0c71d88b09", "author": {"user": {"login": "jdconrad", "name": "Jack Conradson"}}, "url": "https://github.com/elastic/elasticsearch/commit/9106ae5756e688351f69a96ba2b53f0c71d88b09", "committedDate": "2020-05-07T15:37:37Z", "message": "Merge branch 'nodes6' into semantic0"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9791782411ec75c7236a92a642cee803847f8bb5", "author": {"user": {"login": "jdconrad", "name": "Jack Conradson"}}, "url": "https://github.com/elastic/elasticsearch/commit/9791782411ec75c7236a92a642cee803847f8bb5", "committedDate": "2020-05-11T17:33:14Z", "message": "Merge branch 'master' into nodes5"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a2bbf6bec4530d4bd680a45c602647ab3514ca55", "author": {"user": {"login": "jdconrad", "name": "Jack Conradson"}}, "url": "https://github.com/elastic/elasticsearch/commit/a2bbf6bec4530d4bd680a45c602647ab3514ca55", "committedDate": "2020-05-11T17:33:31Z", "message": "Merge branch 'nodes5' into nodes6"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "86fe756fc1f4760b336e42ffa922e9de1d9c61fe", "author": {"user": {"login": "jdconrad", "name": "Jack Conradson"}}, "url": "https://github.com/elastic/elasticsearch/commit/86fe756fc1f4760b336e42ffa922e9de1d9c61fe", "committedDate": "2020-05-11T17:33:47Z", "message": "Merge branch 'nodes6' into semantic0"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEwMzI1MTQ0", "url": "https://github.com/elastic/elasticsearch/pull/56293#pullrequestreview-410325144", "createdAt": "2020-05-12T18:45:47Z", "commit": {"oid": "86fe756fc1f4760b336e42ffa922e9de1d9c61fe"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQxODo0NTo0N1rOGUUMiQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQxODo0NTo0N1rOGUUMiQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzk1NTU5Mw==", "bodyText": "Why is this indented                                                             so far?", "url": "https://github.com/elastic/elasticsearch/pull/56293#discussion_r423955593", "createdAt": "2020-05-12T18:45:47Z", "author": {"login": "stu-elastic"}, "path": "modules/lang-painless/src/main/antlr/PainlessLexer.g4", "diffHunk": "@@ -120,23 +109,19 @@ INTEGER: ( '0' | [1-9] [0-9]* ) [lLfFdD]?;\n DECIMAL: ( '0' | [1-9] [0-9]* ) (DOT [0-9]+)? ( [eE] [+\\-]? [0-9]+ )? [fFdD]?;\n \n STRING: ( '\"' ( '\\\\\"' | '\\\\\\\\' | ~[\\\\\"] )*? '\"' ) | ( '\\'' ( '\\\\\\'' | '\\\\\\\\' | ~[\\\\'] )*? '\\'' );\n-REGEX: '/' ( '\\\\' ~'\\n' | ~('/' | '\\n') )+? '/' [cilmsUux]* { slashIsRegex() }?;\n+REGEX: '/' ( '\\\\' ~'\\n' | ~('/' | '\\n') )+? '/' [cilmsUux]* { isSlashRegex() }?;\n \n TRUE:  'true';\n FALSE: 'false';\n \n NULL: 'null';\n \n-// The predicate here allows us to remove ambiguities when\n-// dealing with types versus identifiers.  We check against\n-// the current whitelist to determine whether a token is a type\n-// or not.  Note this works by processing one character at a time\n-// and the rule is added or removed as this happens.  This is also known\n-// as \"the lexer hack.\"  See (https://en.wikipedia.org/wiki/The_lexer_hack).\n-TYPE: ID ( DOT ID )* { isType(getText()) }?;\n+PRIMITIVE: 'boolean' | 'byte' | 'short' | 'char' | 'int' | 'long' | 'float' | 'double';\n+DEF: 'def';\n+\n ID: [_a-zA-Z] [_a-zA-Z0-9]*;\n \n mode AFTER_DOT;\n \n-DOTINTEGER: ( '0' | [1-9] [0-9]* )                        -> mode(DEFAULT_MODE);\n-DOTID: [_a-zA-Z] [_a-zA-Z0-9]*                            -> mode(DEFAULT_MODE);\n+DOTINTEGER: ( '0' | [1-9] [0-9]* )                                            -> mode(DEFAULT_MODE);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "86fe756fc1f4760b336e42ffa922e9de1d9c61fe"}, "originalPosition": 59}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEwMzM4OTM0", "url": "https://github.com/elastic/elasticsearch/pull/56293#pullrequestreview-410338934", "createdAt": "2020-05-12T19:04:28Z", "commit": {"oid": "86fe756fc1f4760b336e42ffa922e9de1d9c61fe"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQxOTowNDoyOFrOGUU38A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQxOTowNDoyOFrOGUU38A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzk2NjcwNA==", "bodyText": "spaces?", "url": "https://github.com/elastic/elasticsearch/pull/56293#discussion_r423966704", "createdAt": "2020-05-12T19:04:28Z", "author": {"login": "stu-elastic"}, "path": "modules/lang-painless/src/main/antlr/PainlessParser.g4", "diffHunk": "@@ -87,32 +87,38 @@ declaration\n     ;\n \n decltype\n-    : TYPE (LBRACE RBRACE)*\n+    : type (LBRACE RBRACE)*\n+    ;\n+\n+type\n+    : DEF\n+    | PRIMITIVE\n+    | ID (DOT DOTID)*\n     ;\n \n declvar\n     : ID ( ASSIGN expression )?\n     ;\n \n trap\n-    : CATCH LP TYPE ID RP block\n+    : CATCH LP type ID RP block\n     ;\n \n noncondexpression\n-    :               unary                                                               # single", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "86fe756fc1f4760b336e42ffa922e9de1d9c61fe"}, "originalPosition": 24}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEwMzY2MTE4", "url": "https://github.com/elastic/elasticsearch/pull/56293#pullrequestreview-410366118", "createdAt": "2020-05-12T19:42:26Z", "commit": {"oid": "86fe756fc1f4760b336e42ffa922e9de1d9c61fe"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQxOTo0MjoyNlrOGUWM5A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQxOTo0MjoyNlrOGUWM5A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzk4ODQ1Mg==", "bodyText": "Why is INCR and DECR removed here?", "url": "https://github.com/elastic/elasticsearch/pull/56293#discussion_r423988452", "createdAt": "2020-05-12T19:42:26Z", "author": {"login": "stu-elastic"}, "path": "modules/lang-painless/src/main/java/org/elasticsearch/painless/Operation.java", "diffHunk": "@@ -51,9 +51,7 @@\n     EQ      ( \"==\"  , \"equals\"                 ),\n     EQR     ( \"===\" , \"reference equals\"       ),\n     NE      ( \"!=\"  , \"not equals\"             ),\n-    NER     ( \"!==\" , \"reference not equals\"   ),\n-    INCR    ( \"++\"  , \"increment\"              ),\n-    DECR    ( \"--\"  , \"decrement\"              );\n+    NER     ( \"!==\" , \"reference not equals\"   );", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "86fe756fc1f4760b336e42ffa922e9de1d9c61fe"}, "originalPosition": 7}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEwMzY4MTQ4", "url": "https://github.com/elastic/elasticsearch/pull/56293#pullrequestreview-410368148", "createdAt": "2020-05-12T19:45:36Z", "commit": {"oid": "86fe756fc1f4760b336e42ffa922e9de1d9c61fe"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQxOTo0NTozNlrOGUWS_Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQxOTo0NTozNlrOGUWS_Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzk5MDAxMw==", "bodyText": "Why was this moved?", "url": "https://github.com/elastic/elasticsearch/pull/56293#discussion_r423990013", "createdAt": "2020-05-12T19:45:36Z", "author": {"login": "stu-elastic"}, "path": "modules/lang-painless/src/main/java/org/elasticsearch/painless/antlr/Walker.java", "diffHunk": "@@ -627,12 +629,25 @@ public ANode visitBool(BoolContext ctx) {\n         } else if (ctx.BOOLOR() != null) {\n             operation = Operation.OR;\n         } else {\n-            throw location(ctx).createError(new IllegalStateException(\"Illegal tree structure.\"));\n+            throw location(ctx).createError(new IllegalStateException(\"illegal tree structure\"));\n         }\n \n         return new EBool(location(ctx), operation, left, right);\n     }\n \n+    @Override\n+    public ANode visitElvis(ElvisContext ctx) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "86fe756fc1f4760b336e42ffa922e9de1d9c61fe"}, "originalPosition": 244}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEwMzc3MTI1", "url": "https://github.com/elastic/elasticsearch/pull/56293#pullrequestreview-410377125", "createdAt": "2020-05-12T19:58:54Z", "commit": {"oid": "86fe756fc1f4760b336e42ffa922e9de1d9c61fe"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQxOTo1ODo1NFrOGUWvSw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQxOTo1ODo1NFrOGUWvSw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzk5NzI1OQ==", "bodyText": "Say you have a variable with same as package name, eg java, what happens?", "url": "https://github.com/elastic/elasticsearch/pull/56293#discussion_r423997259", "createdAt": "2020-05-12T19:58:54Z", "author": {"login": "stu-elastic"}, "path": "modules/lang-painless/src/main/java/org/elasticsearch/painless/node/EVariable.java", "diffHunk": "@@ -43,27 +45,52 @@ public EVariable(Location location, String name) {\n \n     @Override\n     Output analyze(ClassNode classNode, ScriptRoot scriptRoot, Scope scope, Input input) {\n-        if (input.read == false && input.write == false) {\n-            throw createError(new IllegalArgumentException(\"not a statement: variable [\" + name + \"] not used\"));\n-        }\n-\n         Output output = new Output();\n+        Class<?> type = scriptRoot.getPainlessLookup().canonicalTypeNameToType(name);\n \n-        Variable variable = scope.getVariable(location, name);\n+        if (type != null)  {\n+            if (input.write) {\n+                throw createError(new IllegalArgumentException(\"invalid assignment: \" +\n+                        \"cannot write a value to a static type [\" + PainlessLookupUtility.typeToCanonicalTypeName(type) + \"]\"));\n+            }\n \n-        if (input.write && variable.isFinal()) {\n-            throw createError(new IllegalArgumentException(\"Variable [\" + variable.getName() + \"] is read-only.\"));\n-        }\n+            if (input.read == false) {\n+                throw createError(new IllegalArgumentException(\"not a statement: \" +\n+                        \"static type [\" + PainlessLookupUtility.typeToCanonicalTypeName(type) + \"] not used\"));\n+            }\n+\n+            output.actual = type;\n+            output.isStaticType = true;\n+\n+            StaticNode staticNode = new StaticNode();\n \n-        output.actual = variable.getType();\n+            staticNode.setLocation(location);\n+            staticNode.setExpressionType(output.actual);\n \n-        VariableNode variableNode = new VariableNode();\n+            output.expressionNode = staticNode;\n+        } else if (scope.isVariableDefined(name)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "86fe756fc1f4760b336e42ffa922e9de1d9c61fe"}, "originalPosition": 47}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEwMzc4Njg4", "url": "https://github.com/elastic/elasticsearch/pull/56293#pullrequestreview-410378688", "createdAt": "2020-05-12T20:01:17Z", "commit": {"oid": "86fe756fc1f4760b336e42ffa922e9de1d9c61fe"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQyMDowMToxN1rOGUW0tA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQyMDowMToxN1rOGUW0tA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzk5ODY0NA==", "bodyText": "Is there any possibility of a partial name triggering type != null? eg. java.util.HashMap.abc123.", "url": "https://github.com/elastic/elasticsearch/pull/56293#discussion_r423998644", "createdAt": "2020-05-12T20:01:17Z", "author": {"login": "stu-elastic"}, "path": "modules/lang-painless/src/main/java/org/elasticsearch/painless/node/EVariable.java", "diffHunk": "@@ -43,27 +45,52 @@ public EVariable(Location location, String name) {\n \n     @Override\n     Output analyze(ClassNode classNode, ScriptRoot scriptRoot, Scope scope, Input input) {\n-        if (input.read == false && input.write == false) {\n-            throw createError(new IllegalArgumentException(\"not a statement: variable [\" + name + \"] not used\"));\n-        }\n-\n         Output output = new Output();\n+        Class<?> type = scriptRoot.getPainlessLookup().canonicalTypeNameToType(name);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "86fe756fc1f4760b336e42ffa922e9de1d9c61fe"}, "originalPosition": 19}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9c67ee16ac9d5d8cb20be5ff5680e4c4472f4311", "author": {"user": {"login": "jdconrad", "name": "Jack Conradson"}}, "url": "https://github.com/elastic/elasticsearch/commit/9c67ee16ac9d5d8cb20be5ff5680e4c4472f4311", "committedDate": "2020-05-13T18:48:20Z", "message": "fixed lexer spacing"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "941d762d2da55dce4add0a69cb58791c11c54650", "author": {"user": {"login": "jdconrad", "name": "Jack Conradson"}}, "url": "https://github.com/elastic/elasticsearch/commit/941d762d2da55dce4add0a69cb58791c11c54650", "committedDate": "2020-05-13T20:09:01Z", "message": "Merge branch 'master' into nodes5"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a378ad56d918b1d1bd40354d08423193008f7313", "author": {"user": {"login": "jdconrad", "name": "Jack Conradson"}}, "url": "https://github.com/elastic/elasticsearch/commit/a378ad56d918b1d1bd40354d08423193008f7313", "committedDate": "2020-05-13T20:09:06Z", "message": "Merge branch 'nodes5' into nodes6"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1c2c1851fdd5d48b3a06b304f703364041c01e9a", "author": {"user": {"login": "jdconrad", "name": "Jack Conradson"}}, "url": "https://github.com/elastic/elasticsearch/commit/1c2c1851fdd5d48b3a06b304f703364041c01e9a", "committedDate": "2020-05-13T20:09:13Z", "message": "Merge branch 'nodes6' into semantic0"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEyMDA4NDY2", "url": "https://github.com/elastic/elasticsearch/pull/56293#pullrequestreview-412008466", "createdAt": "2020-05-14T17:02:29Z", "commit": {"oid": "1c2c1851fdd5d48b3a06b304f703364041c01e9a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 306, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}