{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM0NTAzMzAy", "number": 58103, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNVQxMjoyNDoxOVrOEFg4YA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNVQxMjoyNDoxOVrOEFg4YA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc0MjE3MDU2OnYy", "diffSide": "RIGHT", "path": "x-pack/plugin/ccr/src/main/java/org/elasticsearch/xpack/ccr/action/TransportPutFollowAction.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNVQxMjoyNDoxOVrOGjv3hQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNVQxMjoyNDoxOVrOGjv3hQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDEzNzYwNQ==", "bodyText": "This is the crux of the change, where the request settings are propagated to the follower index. The rest of this change is just ceremony around this, parsing the settings from the request, validating that they are not including any settings that must be propagated from the leader index, and tests around this.", "url": "https://github.com/elastic/elasticsearch/pull/58103#discussion_r440137605", "createdAt": "2020-06-15T12:24:19Z", "author": {"login": "jasontedor"}, "path": "x-pack/plugin/ccr/src/main/java/org/elasticsearch/xpack/ccr/action/TransportPutFollowAction.java", "diffHunk": "@@ -124,14 +125,28 @@ private void createFollowerIndex(\n             return;\n         }\n \n-        final Settings.Builder settingsBuilder = Settings.builder()\n+        final Settings replicatedRequestSettings = TransportResumeFollowAction.filter(request.getSettings());\n+        if (replicatedRequestSettings.isEmpty() == false) {\n+            final String message = String.format(\n+                Locale.ROOT,\n+                \"can not put follower index that could override leader settings %s\",\n+                replicatedRequestSettings\n+            );\n+            listener.onFailure(new IllegalArgumentException(message));\n+            return;\n+        }\n+\n+        final Settings overrideSettings = Settings.builder()\n             .put(IndexMetadata.SETTING_INDEX_PROVIDED_NAME, request.getFollowerIndex())\n-            .put(CcrSettings.CCR_FOLLOWING_INDEX_SETTING.getKey(), true);\n+            .put(CcrSettings.CCR_FOLLOWING_INDEX_SETTING.getKey(), true)\n+            .put(request.getSettings())", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fbd5e2354dc651a791f92c6d93573a3f9bac131a"}, "originalPosition": 28}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1627, "cost": 1, "resetAt": "2021-11-12T11:57:46Z"}}}