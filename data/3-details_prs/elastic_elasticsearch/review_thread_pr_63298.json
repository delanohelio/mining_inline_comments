{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDk4MjMzODA4", "number": 63298, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNlQwOToxMTo0MVrOEqo0Qg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNlQwOTozNTo1NlrOEqpYFw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEzMTQ0Mzg2OnYy", "diffSide": "RIGHT", "path": "server/src/main/java/org/elasticsearch/index/translog/TranslogWriter.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNlQwOToxMTo0MVrOHc9KnQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNlQwOToxMTo0MVrOHc9KnQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDEyNDMxNw==", "bodyText": "I struggle to see how this can do anything, given that we assert that buffer is null a few lines above and we retain synchronized(this) throughout?", "url": "https://github.com/elastic/elasticsearch/pull/63298#discussion_r500124317", "createdAt": "2020-10-06T09:11:41Z", "author": {"login": "henningandersen"}, "path": "server/src/main/java/org/elasticsearch/index/translog/TranslogWriter.java", "diffHunk": "@@ -335,11 +339,13 @@ public TranslogReader closeIntoReader() throws IOException {\n                         throw ex;\n                     }\n                     // If we reached this point, all of the buffered ops should have been flushed successfully.\n-                    assert bufferedOps.size() == 0;\n+                    assert buffer == null;\n                     assert checkChannelPositionWhileHandlingException(totalOffset);\n                     assert totalOffset == lastSyncedCheckpoint.offset;\n                     if (closed.compareAndSet(false, true)) {\n                         try {\n+                            Releasables.closeWhileHandlingException(buffer);\n+                            buffer = null;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "43200b58f119a70e04bed55941d8f22a96ad9857"}, "originalPosition": 113}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEzMTUzNTU5OnYy", "diffSide": "RIGHT", "path": "server/src/main/java/org/elasticsearch/index/translog/TranslogWriter.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNlQwOTozNTo1NlrOHc-FEg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNlQwOTozNTo1NlrOHc-FEg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDEzOTI4Mg==", "bodyText": "I think we should also revert the signature change of add, allowing us to revert Translog.add to its previous slightly simpler form?", "url": "https://github.com/elastic/elasticsearch/pull/63298#discussion_r500139282", "createdAt": "2020-10-06T09:35:56Z", "author": {"login": "henningandersen"}, "path": "server/src/main/java/org/elasticsearch/index/translog/TranslogWriter.java", "diffHunk": "@@ -187,10 +189,12 @@ private synchronized void closeWithTragicEvent(final Exception ex) {\n         final long bytesBufferedAfterAdd;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "43200b58f119a70e04bed55941d8f22a96ad9857"}, "originalPosition": 79}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3105, "cost": 1, "resetAt": "2021-11-12T11:57:46Z"}}}