{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDUwNDcxNTg1", "number": 59729, "title": "[CI][Transform] add debug logs to help debugging #52931", "bodyText": "add debug logs to help debugging #52931\nMotivation: The problem is a off-by-one in a counter, probably caused by 2 parallel threads: one is finishing the worker, one is triggering a new run (likely while the other one is saving state). When _stats is called its either answered from the still running task or from the persisted state. The added logs should tell us which path was taken (the task based one contains node information, the persisted one not).\n(The CI failure rarely happens, probably it takes some time until we hit it again and can inspect the logs)\nIt seems sufficient to only merge this to master.", "createdAt": "2020-07-16T20:00:50Z", "url": "https://github.com/elastic/elasticsearch/pull/59729", "merged": true, "mergeCommit": {"oid": "77f442f0572d9b28391f3bda9839bd6dcc1784eb"}, "closed": true, "closedAt": "2020-07-17T08:39:14Z", "author": {"login": "hendrikmuhs"}, "timelineItems": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc1lPEggH2gAyNDUwNDcxNTg1OjM4ZmFiOGMwMWJiYzMwZTg3YTZlMDgzOTI4YTUwMDM4ZDgxYTM0N2M=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc1vIwLAFqTQ1MDQ1MDU0OQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "38fab8c01bbc30e87a6e083928a50038d81a347c", "author": {"user": {"login": "hendrikmuhs", "name": "Hendrik Muhs"}}, "url": "https://github.com/elastic/elasticsearch/commit/38fab8c01bbc30e87a6e083928a50038d81a347c", "committedDate": "2020-07-16T20:27:01Z", "message": "add debug logs to help debugging #52931"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "88dcf0f82e05d605ba820b039e88223974068c92", "author": {"user": {"login": "hendrikmuhs", "name": "Hendrik Muhs"}}, "url": "https://github.com/elastic/elasticsearch/commit/88dcf0f82e05d605ba820b039e88223974068c92", "committedDate": "2020-07-16T19:50:15Z", "message": "add debug logs to help debugging #52931"}, "afterCommit": {"oid": "38fab8c01bbc30e87a6e083928a50038d81a347c", "author": {"user": {"login": "hendrikmuhs", "name": "Hendrik Muhs"}}, "url": "https://github.com/elastic/elasticsearch/commit/38fab8c01bbc30e87a6e083928a50038d81a347c", "committedDate": "2020-07-16T20:27:01Z", "message": "add debug logs to help debugging #52931"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUwNDUwNTQ5", "url": "https://github.com/elastic/elasticsearch/pull/59729#pullrequestreview-450450549", "createdAt": "2020-07-17T07:58:38Z", "commit": {"oid": "38fab8c01bbc30e87a6e083928a50038d81a347c"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xN1QwNzo1ODozOFrOGzJRgQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xN1QwNzo1ODozOFrOGzJRgQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjI4MjQ5Nw==", "bodyText": "Just double-checking: is stats object of type Map actually going to be printed as map by the logger?", "url": "https://github.com/elastic/elasticsearch/pull/59729#discussion_r456282497", "createdAt": "2020-07-17T07:58:38Z", "author": {"login": "przemekwitek"}, "path": "x-pack/plugin/transform/qa/single-node-tests/src/test/java/org/elasticsearch/xpack/transform/integration/TransformUsageIT.java", "diffHunk": "@@ -72,6 +72,8 @@ public void testUsage() throws Exception {\n \n         Request getRequest = new Request(\"GET\", getTransformEndpoint() + \"test_usage/_stats\");\n         Map<String, Object> stats = entityAsMap(client().performRequest(getRequest));\n+        // temporary debug logs for https://github.com/elastic/elasticsearch/issues/52931\n+        logger.info(\"test_usage/_stats response: [{}]\", stats);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "38fab8c01bbc30e87a6e083928a50038d81a347c"}, "originalPosition": 5}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4302, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}