{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDg4MzU0NTgy", "number": 62515, "title": "Make yamlRestTest and javaRestTest tasks lazy", "bodyText": "This commit changes the yamlRestTest and javaRestTest tasks to be lazily created.\nThis change requires pro-actively creating the testClusters container so that the\nconfiguration can be applied without any changes to the build.gradle files.\nrelated: #60261\n=========\nHere are some scans\nbefore change:\nhttps://gradle.com/s/bevt6ug46ohjw\nafter change:\nhttps://gradle.com/s/4t6riz7m34ur2\nI think this is indeed lazily created (as evident by the scans) ... however, I am second guessing myself since I was a bit surprised that I did not have also have to change project specific task configuration from yamlRestTest { ...  to  tasks.named(\"yamlRestTest\").configure {  in the build.gradle files.\nAlso, I tried to register instead of create the testClusters container...but it did not work. Any suggestions for how to not pro-actively create the testClusters container ?", "createdAt": "2020-09-17T02:00:38Z", "url": "https://github.com/elastic/elasticsearch/pull/62515", "merged": true, "mergeCommit": {"oid": "0369defc0e1f57261ceaf13240724bed03cbd3c7"}, "closed": true, "closedAt": "2020-09-18T13:56:34Z", "author": {"login": "jakelandis"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdJxa-dAH2gAyNDg4MzU0NTgyOjcwOWU0ZjlkMzBlNTUxY2Q2OTNkMGNiNjA3MDA2NDMwMGFhOGQ2NjA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdJ5JCkgFqTQ5MTA0MzMwNg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "709e4f9d30e551cd693d0cb6070064300aa8d660", "author": {"user": {"login": "jakelandis", "name": "Jake Landis"}}, "url": "https://github.com/elastic/elasticsearch/commit/709e4f9d30e551cd693d0cb6070064300aa8d660", "committedDate": "2020-09-17T13:57:22Z", "message": "initial commit"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d3c053d1ccf75e0c76632056e2f270a82f02f5b5", "author": {"user": {"login": "jakelandis", "name": "Jake Landis"}}, "url": "https://github.com/elastic/elasticsearch/commit/d3c053d1ccf75e0c76632056e2f270a82f02f5b5", "committedDate": "2020-09-17T13:57:23Z", "message": "break up the method"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3af181dc67710f8fb3b5b31f125d93ff1962770b", "author": {"user": {"login": "jakelandis", "name": "Jake Landis"}}, "url": "https://github.com/elastic/elasticsearch/commit/3af181dc67710f8fb3b5b31f125d93ff1962770b", "committedDate": "2020-09-17T13:57:23Z", "message": "spotless"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "76cb679adff4c06e376c31a08db4f5da26076f42", "author": {"user": {"login": "jakelandis", "name": "Jake Landis"}}, "url": "https://github.com/elastic/elasticsearch/commit/76cb679adff4c06e376c31a08db4f5da26076f42", "committedDate": "2020-09-17T13:57:23Z", "message": "register, not create the testCluster container"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "84d117f4013b78a75a880f99bb13568a99e4f098", "author": {"user": {"login": "elasticmachine", "name": "Elastic Machine"}}, "url": "https://github.com/elastic/elasticsearch/commit/84d117f4013b78a75a880f99bb13568a99e4f098", "committedDate": "2020-09-17T13:29:20Z", "message": "Merge branch 'master' into lazy_yaml_java_rest_test"}, "afterCommit": {"oid": "76cb679adff4c06e376c31a08db4f5da26076f42", "author": {"user": {"login": "jakelandis", "name": "Jake Landis"}}, "url": "https://github.com/elastic/elasticsearch/commit/76cb679adff4c06e376c31a08db4f5da26076f42", "committedDate": "2020-09-17T13:57:23Z", "message": "register, not create the testCluster container"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "01a094d25925a17aaa4a7f7cb4ef7d61b03f58f1", "author": {"user": {"login": "jakelandis", "name": "Jake Landis"}}, "url": "https://github.com/elastic/elasticsearch/commit/01a094d25925a17aaa4a7f7cb4ef7d61b03f58f1", "committedDate": "2020-09-17T14:16:53Z", "message": "Revert \"register, not create the testCluster container\"\n\nThis reverts commit 76cb679adff4c06e376c31a08db4f5da26076f42."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkxMDQzMzA2", "url": "https://github.com/elastic/elasticsearch/pull/62515#pullrequestreview-491043306", "createdAt": "2020-09-17T22:56:53Z", "commit": {"oid": "01a094d25925a17aaa4a7f7cb4ef7d61b03f58f1"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xN1QyMjo1Njo1M1rOHT4QrQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xN1QyMjo1Njo1M1rOHT4QrQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDYwNjc2NQ==", "bodyText": "When will this have not already been created? Shouldn't the java/yaml plugins have already created it?", "url": "https://github.com/elastic/elasticsearch/pull/62515#discussion_r490606765", "createdAt": "2020-09-17T22:56:53Z", "author": {"login": "rjernst"}, "path": "buildSrc/src/main/java/org/elasticsearch/gradle/test/RestTestBasePlugin.java", "diffHunk": "@@ -41,7 +41,7 @@ public void apply(Project project) {\n             NamedDomainObjectContainer<ElasticsearchCluster> testClusters = (NamedDomainObjectContainer<ElasticsearchCluster>) project\n                 .getExtensions()\n                 .getByName(TestClustersPlugin.EXTENSION_NAME);\n-            ElasticsearchCluster cluster = testClusters.create(restIntegTestTask.getName());\n+            ElasticsearchCluster cluster = testClusters.maybeCreate(restIntegTestTask.getName());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "01a094d25925a17aaa4a7f7cb4ef7d61b03f58f1"}, "originalPosition": 5}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3616, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}