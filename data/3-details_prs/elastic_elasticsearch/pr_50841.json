{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzYxMzM3ODg0", "number": 50841, "title": "[ML] Reuse SourceDestValidator for data frame analytics", "bodyText": "This commit removes validation logic of source and dest indices\nfor data frame analytics and replaces it with using the common\nSourceDestValidator class which is already used by transforms.\nThis way the validations and their messages become consistent\nwhile we reduce code.\nThis means that where these validations fail the error messages\nwill be slightly different for data frame analytics.", "createdAt": "2020-01-10T08:46:10Z", "url": "https://github.com/elastic/elasticsearch/pull/50841", "merged": true, "mergeCommit": {"oid": "2d59c84f3fae81fe46a1518359baae4571059b8b"}, "closed": true, "closedAt": "2020-01-10T11:17:39Z", "author": {"login": "dimitris-athanasiou"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb46e0vgH2gAyMzYxMzM3ODg0OjkyOGQyNGJmZmJkNDA2NDNiMWQ3N2VjNGUzYmYyZWQ1YWE5OTJmODA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABb477gYgH2gAyMzYxMzM3ODg0OjJmMmZiY2NlZjA5MmQ2NTkyNzBlNmUzYzcwOTAxNmU3YzgxNjA0MGE=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "928d24bffbd40643b1d77ec4e3bf2ed5aa992f80", "author": {"user": {"login": "dimitris-athanasiou", "name": "Dimitris Athanasiou"}}, "url": "https://github.com/elastic/elasticsearch/commit/928d24bffbd40643b1d77ec4e3bf2ed5aa992f80", "committedDate": "2020-01-10T08:42:51Z", "message": "[ML] Reuse SourceDestValidator for data frame analytics\n\nThis commit removes validation logic of source and dest indices\nfor data frame analytics and replaces it with using the common\n`SourceDestValidator` class which is already used by transforms.\nThis way the validations and their messages become consistent\nwhile we reduce code.\n\nThis means that where these validations fail the error messages\nwill be slightly different for data frame analytics."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQxMDIwMjI5", "url": "https://github.com/elastic/elasticsearch/pull/50841#pullrequestreview-341020229", "createdAt": "2020-01-10T08:46:34Z", "commit": {"oid": "928d24bffbd40643b1d77ec4e3bf2ed5aa992f80"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xMFQwODo0NjozNFrOFcNdOg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xMFQwODo0NjozNFrOFcNdOg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTEyNDkyMg==", "bodyText": "This was unused.", "url": "https://github.com/elastic/elasticsearch/pull/50841#discussion_r365124922", "createdAt": "2020-01-10T08:46:34Z", "author": {"login": "dimitris-athanasiou"}, "path": "x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/common/validation/SourceDestValidator.java", "diffHunk": "@@ -46,7 +46,6 @@\n \n     // messages\n     public static final String SOURCE_INDEX_MISSING = \"Source index [{0}] does not exist\";\n-    public static final String SOURCE_LOWERCASE = \"Source index [{0}] must be lowercase\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "928d24bffbd40643b1d77ec4e3bf2ed5aa992f80"}, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d21d9f02688fb11e1d9ec6e3e31876abe075131a", "author": {"user": {"login": "dimitris-athanasiou", "name": "Dimitris Athanasiou"}}, "url": "https://github.com/elastic/elasticsearch/commit/d21d9f02688fb11e1d9ec6e3e31876abe075131a", "committedDate": "2020-01-10T08:49:50Z", "message": "Add missing file and extract message into constant"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQxMDQxOTY3", "url": "https://github.com/elastic/elasticsearch/pull/50841#pullrequestreview-341041967", "createdAt": "2020-01-10T09:29:43Z", "commit": {"oid": "d21d9f02688fb11e1d9ec6e3e31876abe075131a"}, "state": "APPROVED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xMFQwOToyOTo0M1rOFcOfug==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xMFQwOTo0MToyMFrOFcO1Ig==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTE0MTk0Ng==", "bodyText": "nice spot!", "url": "https://github.com/elastic/elasticsearch/pull/50841#discussion_r365141946", "createdAt": "2020-01-10T09:29:43Z", "author": {"login": "hendrikmuhs"}, "path": "x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/common/validation/SourceDestValidator.java", "diffHunk": "@@ -427,13 +417,13 @@ public void validate(Context context, ActionListener<Context> listener) {\n                 return;\n             }\n \n-            if (context.resolvedSource.contains(destIndex)) {\n+            if (context.resolveSource().contains(destIndex)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d21d9f02688fb11e1d9ec6e3e31876abe075131a"}, "originalPosition": 64}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTE0NTA1MA==", "bodyText": "^ needs re-activation or should be removed", "url": "https://github.com/elastic/elasticsearch/pull/50841#discussion_r365145050", "createdAt": "2020-01-10T09:36:36Z", "author": {"login": "hendrikmuhs"}, "path": "x-pack/plugin/core/src/test/java/org/elasticsearch/xpack/core/common/validation/SourceDestValidatorTests.java", "diffHunk": "@@ -260,17 +274,17 @@ public void testCheck_GivenMixedMissingAndExistingConcreteSourceIndex() throws I\n             }\n         );\n \n-        assertValidation(\n-            listener -> simpleNonRemoteValidator.validate(\n-                CLUSTER_STATE,\n-                new String[] { SOURCE_1, \"missing\" },\n-                \"dest\",\n-                SourceDestValidator.NON_DEFERABLE_VALIDATIONS,\n-                listener\n-            ),\n-            true,\n-            null\n-        );\n+//        assertValidation(\n+//            listener -> simpleNonRemoteValidator.validate(\n+//                CLUSTER_STATE,\n+//                new String[] { SOURCE_1, \"missing\" },\n+//                \"dest\",\n+//                Collections.emptyList(),\n+//                listener\n+//            ),\n+//            true,\n+//            null\n+//        );", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d21d9f02688fb11e1d9ec6e3e31876abe075131a"}, "originalPosition": 113}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTE0NzQyNg==", "bodyText": "not getting this change, should the test be removed?", "url": "https://github.com/elastic/elasticsearch/pull/50841#discussion_r365147426", "createdAt": "2020-01-10T09:41:20Z", "author": {"login": "hendrikmuhs"}, "path": "x-pack/plugin/core/src/test/java/org/elasticsearch/xpack/core/common/validation/SourceDestValidatorTests.java", "diffHunk": "@@ -464,21 +478,11 @@ public void testCheck_GivenDestIndexIsAliasThatMatchesMultipleIndices() throws I\n                 CLUSTER_STATE,\n                 new String[] { SOURCE_1 },\n                 DEST_ALIAS,\n-                SourceDestValidator.NON_DEFERABLE_VALIDATIONS,\n+                Collections.emptyList(),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d21d9f02688fb11e1d9ec6e3e31876abe075131a"}, "originalPosition": 221}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2f2fbccef092d659270e6e3c709016e7c816040a", "author": {"user": {"login": "dimitris-athanasiou", "name": "Dimitris Athanasiou"}}, "url": "https://github.com/elastic/elasticsearch/commit/2f2fbccef092d659270e6e3c709016e7c816040a", "committedDate": "2020-01-10T10:24:05Z", "message": "Reactivate commented out part of test"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3750, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}