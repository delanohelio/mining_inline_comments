{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE2MDgzNDk4", "number": 64650, "title": "Do not allow spaces within MediaType's parameters", "bodyText": "Per https://tools.ietf.org/html/rfc7231#section-3.1.1.1 MediaType can\nhave spaces around parameters pair, but do not allow spaces within\nparameter. That means that parameter pair forbids spaces around =\nfollow up after\n#64406 (comment)\nrelates #51816", "createdAt": "2020-11-05T14:04:05Z", "url": "https://github.com/elastic/elasticsearch/pull/64650", "merged": true, "mergeCommit": {"oid": "710500a50afc7aeb1a0887cdb0b9d24ecb3ec417"}, "closed": true, "closedAt": "2020-11-06T08:25:22Z", "author": {"login": "pgomulka"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdZi1JhAH2gAyNTE2MDgzNDk4OjUyYjUzYWY3YzYwOTlhNDEwMTFkM2RlODlmYzZmZWNiNGIyMjQyMmQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdZxT0KAH2gAyNTE2MDgzNDk4OmFlM2EzMzNiM2FmOTgzZDRkYzkxY2Q4Mjg3MzMyYTg4YzYwNjM3MzQ=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "52b53af7c6099a41011d3de89fc6fecb4b22422d", "author": {"user": {"login": "pgomulka", "name": "Przemyslaw Gomulka"}}, "url": "https://github.com/elastic/elasticsearch/commit/52b53af7c6099a41011d3de89fc6fecb4b22422d", "committedDate": "2020-11-05T14:00:10Z", "message": "Do not allow spaces within MediaType's parameters\n\nPer https://tools.ietf.org/html/rfc7231#section-3.1.1.1 MediaType can\nhave spaces around parameters pair, but do not allow spaces within\nparameter. That means that parameter pair forbids spaces around `=`\n\nfollow up after\nhttps://github.com/elastic/elasticsearch/pull/64406#discussion_r517533475\nrelates #51816"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "80b3944f52728bd739fd4ad3f82f52bb014dbffa", "author": {"user": {"login": "pgomulka", "name": "Przemyslaw Gomulka"}}, "url": "https://github.com/elastic/elasticsearch/commit/80b3944f52728bd739fd4ad3f82f52bb014dbffa", "committedDate": "2020-11-05T14:50:07Z", "message": "unnecessary if"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI0MzUzMzgw", "url": "https://github.com/elastic/elasticsearch/pull/64650#pullrequestreview-524353380", "createdAt": "2020-11-05T15:04:49Z", "commit": {"oid": "80b3944f52728bd739fd4ad3f82f52bb014dbffa"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNVQxNTowNDo0OVrOHuHi1Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNVQxNTowNDo0OVrOHuHi1Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODEyMDE0OQ==", "bodyText": "I think for keyValueParam[0] you only want to check trailing whitespace, and for keyValueParam[1] you only want to check for leading whitespace. trim() checks for both.", "url": "https://github.com/elastic/elasticsearch/pull/64650#discussion_r518120149", "createdAt": "2020-11-05T15:04:49Z", "author": {"login": "jakelandis"}, "path": "libs/x-content/src/main/java/org/elasticsearch/common/xcontent/ParsedMediaType.java", "diffHunk": "@@ -90,16 +91,14 @@ public static ParsedMediaType parseMediaType(String headerValue) {\n                     if (paramsAsString.isEmpty()) {\n                         continue;\n                     }\n-                    // intentionally allowing to have spaces around `=`\n-                    // https://tools.ietf.org/html/rfc7231#section-3.1.1.1 disallows this\n-                    String[] keyValueParam = elements[i].trim().split(\"=\");\n-                    if (keyValueParam.length == 2) {\n-                        String parameterName = keyValueParam[0].toLowerCase(Locale.ROOT).trim();\n-                        String parameterValue = keyValueParam[1].toLowerCase(Locale.ROOT).trim();\n-                        parameters.put(parameterName, parameterValue);\n-                    } else {\n+                    //spaces are allowed between parameters, but not between '=' sign\n+                    String[] keyValueParam = paramsAsString.split(\"=\");\n+                    if (keyValueParam.length != 2 || hasSpaces(keyValueParam[0]) || hasSpaces(keyValueParam[1])) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "80b3944f52728bd739fd4ad3f82f52bb014dbffa"}, "originalPosition": 22}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "529869637bd02660aed4d00872078917ef248794", "author": {"user": {"login": "pgomulka", "name": "Przemyslaw Gomulka"}}, "url": "https://github.com/elastic/elasticsearch/commit/529869637bd02660aed4d00872078917ef248794", "committedDate": "2020-11-05T15:36:55Z", "message": "remove trimp approach"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fc62ad4fead9f42bc542291380dc1a77091fef93", "author": {"user": {"login": "pgomulka", "name": "Przemyslaw Gomulka"}}, "url": "https://github.com/elastic/elasticsearch/commit/fc62ad4fead9f42bc542291380dc1a77091fef93", "committedDate": "2020-11-05T15:40:38Z", "message": "line formatting"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI0Mzk3Mzk1", "url": "https://github.com/elastic/elasticsearch/pull/64650#pullrequestreview-524397395", "createdAt": "2020-11-05T15:45:36Z", "commit": {"oid": "fc62ad4fead9f42bc542291380dc1a77091fef93"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bdaeacd85b0e0faf71613894c125e994b53778e7", "author": {"user": {"login": "pgomulka", "name": "Przemyslaw Gomulka"}}, "url": "https://github.com/elastic/elasticsearch/commit/bdaeacd85b0e0faf71613894c125e994b53778e7", "committedDate": "2020-11-05T15:57:13Z", "message": "Merge branch 'master' into compat/allign_paramter_parsing_to_rfc"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ae3a333b3af983d4dc91cd8287332a88c6063734", "author": {"user": {"login": "pgomulka", "name": "Przemyslaw Gomulka"}}, "url": "https://github.com/elastic/elasticsearch/commit/ae3a333b3af983d4dc91cd8287332a88c6063734", "committedDate": "2020-11-06T06:52:20Z", "message": "Merge branch 'master' into compat/allign_paramter_parsing_to_rfc"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1298, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}