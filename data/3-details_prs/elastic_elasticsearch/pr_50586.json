{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzU4OTI0MzEx", "number": 50586, "title": "Remove type parameter from `CreateIndexRequest.mapping(type, XContentBuilder)`", "bodyText": "This continues the removal of type parameters from CreateIndexRequest.mapping\nmethods started in #50419.  Here the removed methods are almost entirely in test\ncode, with the exception of a change to TransformIndex in the transform plugin.\nRelates to #41059", "createdAt": "2020-01-03T09:30:20Z", "url": "https://github.com/elastic/elasticsearch/pull/50586", "merged": true, "mergeCommit": {"oid": "a59b065091a0bec7b9e66ed3ae0e878562947cf8"}, "closed": true, "closedAt": "2020-01-08T09:18:32Z", "author": {"login": "romseygeek"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABbx7yZkAH2gAyMzU4OTI0MzExOmM3YTMwMzk0OTZmZDI1NTA3M2JhMzA3YTdiOTJiODhkOTgxYjcxZTE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABb4EdbTgFqTMzOTM5ODcwNg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "c7a3039496fd255073ba307a7b92b88d981b71e1", "author": {"user": {"login": "romseygeek", "name": "Alan Woodward"}}, "url": "https://github.com/elastic/elasticsearch/commit/c7a3039496fd255073ba307a7b92b88d981b71e1", "committedDate": "2019-12-19T16:16:40Z", "message": "Remove CreateIndexRequest.addMapping(type, string, xcontenttype)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3336f14215e9ec50cc3dd6b34ba0899daa0e9533", "author": {"user": {"login": "romseygeek", "name": "Alan Woodward"}}, "url": "https://github.com/elastic/elasticsearch/commit/3336f14215e9ec50cc3dd6b34ba0899daa0e9533", "committedDate": "2019-12-20T12:33:07Z", "message": "Remove type from CIR.mapping(xcontentbuilder)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0f33ff7392e1bee52335b90f110cd8609767d6f0", "author": {"user": {"login": "romseygeek", "name": "Alan Woodward"}}, "url": "https://github.com/elastic/elasticsearch/commit/0f33ff7392e1bee52335b90f110cd8609767d6f0", "committedDate": "2019-12-20T14:58:31Z", "message": "Remove type from CIR.mapping(map)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9f999b108450a3dc74550ed942030dd2acea141d", "author": {"user": {"login": "romseygeek", "name": "Alan Woodward"}}, "url": "https://github.com/elastic/elasticsearch/commit/9f999b108450a3dc74550ed942030dd2acea141d", "committedDate": "2020-01-02T13:04:37Z", "message": "Merge remote-tracking branch 'origin/master' into types-removal/cir/xcontentbuilder"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a46c50c6ab09435f850a923bad04ca2458650302", "author": {"user": {"login": "romseygeek", "name": "Alan Woodward"}}, "url": "https://github.com/elastic/elasticsearch/commit/a46c50c6ab09435f850a923bad04ca2458650302", "committedDate": "2020-01-03T09:19:00Z", "message": "tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "15152978284f2a79ef348b9ac56be865aa1b5368", "author": {"user": {"login": "romseygeek", "name": "Alan Woodward"}}, "url": "https://github.com/elastic/elasticsearch/commit/15152978284f2a79ef348b9ac56be865aa1b5368", "committedDate": "2020-01-03T09:54:20Z", "message": "imports"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzM4ODU4ODc0", "url": "https://github.com/elastic/elasticsearch/pull/50586#pullrequestreview-338858874", "createdAt": "2020-01-06T19:53:37Z", "commit": {"oid": "15152978284f2a79ef348b9ac56be865aa1b5368"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wNlQxOTo1MzozN1rOFanktQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wNlQyMDoyMjozMVrOFaoPAA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzQ1NTY2OQ==", "bodyText": "To double-check I understand -- we could already remove the mentions to _doc in mapping definitions, but we'll postpone that for another PR? This approach makes sense to me, as it helps keep the current PR focused.", "url": "https://github.com/elastic/elasticsearch/pull/50586#discussion_r363455669", "createdAt": "2020-01-06T19:53:37Z", "author": {"login": "jtibshirani"}, "path": "modules/analysis-common/src/test/java/org/elasticsearch/analysis/common/HighlighterWithAnalyzersTests.java", "diffHunk": "@@ -57,9 +57,9 @@\n \n     public void testNgramHighlightingWithBrokenPositions() throws IOException {\n         assertAcked(prepareCreate(\"test\")\n-                .addMapping(\"test\", jsonBuilder()\n+                .setMapping(jsonBuilder()\n                         .startObject()\n-                            .startObject(\"test\")\n+                            .startObject(\"_doc\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "15152978284f2a79ef348b9ac56be865aa1b5368"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzQ2NDkwNA==", "bodyText": "For consistency with the changes in CreateIndexRequestBuilder, it would be great if we also removed the type parameter from public CreateIndexRequest mapping(String type, Map<String, ?> source), and converted as many callers as possible to use the new signature. Here's a suggestion for how to do it:\n\n    public CreateIndexRequest mapping(Map<String, ?> source) {\n        return mapping(MapperService.SINGLE_MAPPING_NAME, source);\n    }\n\n    private CreateIndexRequest mapping(String type, Map<String, ?> source) {\n        // wrap it in a type map if its not\n        if (source.size() != 1 || !source.containsKey(type)) {\n            source = Map.of(MapperService.SINGLE_MAPPING_NAME, source);\n        }\n        ...\n    }\n\nThe private method is still needed to support CreateIndexRequest#source.", "url": "https://github.com/elastic/elasticsearch/pull/50586#discussion_r363464904", "createdAt": "2020-01-06T20:17:59Z", "author": {"login": "jtibshirani"}, "path": "server/src/main/java/org/elasticsearch/action/admin/indices/create/CreateIndexRequest.java", "diffHunk": "@@ -255,11 +248,10 @@ public CreateIndexRequest cause(String cause) {\n     /**\n      * Adds mapping that will be added when the index gets created.\n      *\n-     * @param type   The mapping type\n      * @param source The mapping source\n      */\n-    public CreateIndexRequest mapping(String type, XContentBuilder source) {\n-        return mapping(type, BytesReference.bytes(source), source.contentType());\n+    public CreateIndexRequest mapping(XContentBuilder source) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "15152978284f2a79ef348b9ac56be865aa1b5368"}, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzQ2NjQ5Ng==", "bodyText": "For context, what's the plan to remove these remaining methods that accept Object... source?", "url": "https://github.com/elastic/elasticsearch/pull/50586#discussion_r363466496", "createdAt": "2020-01-06T20:22:31Z", "author": {"login": "jtibshirani"}, "path": "server/src/main/java/org/elasticsearch/action/admin/indices/create/CreateIndexRequest.java", "diffHunk": "@@ -291,7 +283,7 @@ else if (MapperService.SINGLE_MAPPING_NAME.equals(type) == false) {\n      * (\"field1\", \"type=string,store=true\").\n      */\n     public CreateIndexRequest mapping(String type, Object... source) {\n-        mapping(type, PutMappingRequest.buildFromSimplifiedDef(type, source));\n+        mapping(PutMappingRequest.buildFromSimplifiedDef(MapperService.SINGLE_MAPPING_NAME, source));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "15152978284f2a79ef348b9ac56be865aa1b5368"}, "originalPosition": 39}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cd9dff6342e99548865704f62f375340eeef7edb", "author": {"user": {"login": "romseygeek", "name": "Alan Woodward"}}, "url": "https://github.com/elastic/elasticsearch/commit/cd9dff6342e99548865704f62f375340eeef7edb", "committedDate": "2020-01-07T13:26:49Z", "message": "Merge remote-tracking branch 'origin/master' into types-removal/cir/xcontentbuilder"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e37d0864fd856db56bb19a4638cbcf9582c95190", "author": {"user": {"login": "romseygeek", "name": "Alan Woodward"}}, "url": "https://github.com/elastic/elasticsearch/commit/e37d0864fd856db56bb19a4638cbcf9582c95190", "committedDate": "2020-01-07T13:54:23Z", "message": "Remove type from  as well"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzM5Mzk4NzA2", "url": "https://github.com/elastic/elasticsearch/pull/50586#pullrequestreview-339398706", "createdAt": "2020-01-07T17:46:27Z", "commit": {"oid": "e37d0864fd856db56bb19a4638cbcf9582c95190"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3958, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}