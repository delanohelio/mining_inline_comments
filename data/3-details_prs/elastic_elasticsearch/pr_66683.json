{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTQzMzk5NzYy", "number": 66683, "title": "Add Ability to Write a BytesReference to Azure BlobContainer", "bodyText": "This pull request adds the ability to write a BytesReference to Azure and GCP BlobContainers.\nThis is a continuation of #66501", "createdAt": "2020-12-21T10:43:40Z", "url": "https://github.com/elastic/elasticsearch/pull/66683", "merged": true, "mergeCommit": {"oid": "9950cd24bee208bbcc72c376d6c9b9e3f74a2e73"}, "closed": true, "closedAt": "2021-01-06T11:01:12Z", "author": {"login": "fcofdez"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdoUKK8gBqjQxMzU1NDc5MDM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdtPufZgFqTU2MjA1MzIxMg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d4e2ff9ef5e930f6d07c8ae603adcd8828fb7ef7", "author": {"user": {"login": "fcofdez", "name": "Francisco Fern\u00e1ndez Casta\u00f1o"}}, "url": "https://github.com/elastic/elasticsearch/commit/d4e2ff9ef5e930f6d07c8ae603adcd8828fb7ef7", "committedDate": "2020-12-21T10:42:27Z", "message": "Add Ability to Write a BytesReference to Azure and GCP BlobContainer"}, "afterCommit": {"oid": "753d841e5da2f1d78d08a7c20bb0d301063b2f32", "author": {"user": {"login": "fcofdez", "name": "Francisco Fern\u00e1ndez Casta\u00f1o"}}, "url": "https://github.com/elastic/elasticsearch/commit/753d841e5da2f1d78d08a7c20bb0d301063b2f32", "committedDate": "2020-12-21T11:22:54Z", "message": "Add Ability to Write a BytesReference to Azure and GCP BlobContainer"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTYxNzEyMDk0", "url": "https://github.com/elastic/elasticsearch/pull/66683#pullrequestreview-561712094", "createdAt": "2021-01-05T11:23:45Z", "commit": {"oid": "753d841e5da2f1d78d08a7c20bb0d301063b2f32"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wNVQxMToyMzo0NlrOIOTn_Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wNVQxMToyMzo0NlrOIOTn_Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTg3MjUwOQ==", "bodyText": "BytesReference.toBytes(bytes) just copies all the bytes in most cases when working from anything that I'm afraid. Maybe we could use com.google.cloud.storage.Storage#createFrom(com.google.cloud.storage.BlobInfo, java.io.InputStream, int, com.google.cloud.storage.Storage.BlobWriteOption...) instead and use the stream we can get out of the BytesReference which won't do any copying?", "url": "https://github.com/elastic/elasticsearch/pull/66683#discussion_r551872509", "createdAt": "2021-01-05T11:23:46Z", "author": {"login": "original-brownbear"}, "path": "plugins/repository-gcs/src/main/java/org/elasticsearch/repositories/gcs/GoogleCloudStorageBlobStore.java", "diffHunk": "@@ -226,6 +227,11 @@ InputStream readBlob(String blobName, long position, long length) throws IOExcep\n         }\n     }\n \n+    public void writeBlob(String blobName, BytesReference bytes, boolean failIfAlreadyExists) throws IOException {\n+        final BlobInfo blobInfo = BlobInfo.newBuilder(bucketName, blobName).build();\n+        executePutMultipartBlob(blobInfo, failIfAlreadyExists, BytesReference.toBytes(bytes));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "753d841e5da2f1d78d08a7c20bb0d301063b2f32"}, "originalPosition": 14}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b499644bc2f7701703bf7856c84e7dd3fab0e81f", "author": {"user": {"login": "fcofdez", "name": "Francisco Fern\u00e1ndez Casta\u00f1o"}}, "url": "https://github.com/elastic/elasticsearch/commit/b499644bc2f7701703bf7856c84e7dd3fab0e81f", "committedDate": "2021-01-05T18:23:10Z", "message": "Add Ability to Write a BytesReference to Azure BlobContainer"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "753d841e5da2f1d78d08a7c20bb0d301063b2f32", "author": {"user": {"login": "fcofdez", "name": "Francisco Fern\u00e1ndez Casta\u00f1o"}}, "url": "https://github.com/elastic/elasticsearch/commit/753d841e5da2f1d78d08a7c20bb0d301063b2f32", "committedDate": "2020-12-21T11:22:54Z", "message": "Add Ability to Write a BytesReference to Azure and GCP BlobContainer"}, "afterCommit": {"oid": "b499644bc2f7701703bf7856c84e7dd3fab0e81f", "author": {"user": {"login": "fcofdez", "name": "Francisco Fern\u00e1ndez Casta\u00f1o"}}, "url": "https://github.com/elastic/elasticsearch/commit/b499644bc2f7701703bf7856c84e7dd3fab0e81f", "committedDate": "2021-01-05T18:23:10Z", "message": "Add Ability to Write a BytesReference to Azure BlobContainer"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTYyMDUzMjEy", "url": "https://github.com/elastic/elasticsearch/pull/66683#pullrequestreview-562053212", "createdAt": "2021-01-05T19:03:11Z", "commit": {"oid": "b499644bc2f7701703bf7856c84e7dd3fab0e81f"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4414, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}