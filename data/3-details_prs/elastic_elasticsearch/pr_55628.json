{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA3NTI0MDc0", "number": 55628, "title": "Validate hashing algorithm in users tool", "bodyText": "This change adds validation when running the users tool so that\nif Elasticsearch is expected to run in a JVM that is configured to\nbe in FIPS 140 mode and the password hashing algorithm is not\ncompliant, we would throw an error.\nUsers tool uses the configuration from the node and this validation\nwould also happen upon node startup but users might be added in the\nfile realm before the node is started and we would have the\nopportunity to notify the user of this misconfiguration.\nThe changes in #55544 make this much less probable to happen in 8\nsince the default algorithm will be compliant but this change can\nact as a fallback in anycase and makes for a better user experience.", "createdAt": "2020-04-22T20:17:41Z", "url": "https://github.com/elastic/elasticsearch/pull/55628", "merged": true, "mergeCommit": {"oid": "4afb360cb3d88cdcea245c242d19cab5c2cc8a20"}, "closed": true, "closedAt": "2020-04-24T15:38:22Z", "author": {"login": "jkakavas"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcaOHXpAH2gAyNDA3NTI0MDc0Ojg2MDBiY2QzZWEwZjNmYzIzMWVjYWNkZDA1ZDUwNWJjNDg1NDU4OTQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcaqgaqAFqTM5OTY0NjUyMA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "8600bcd3ea0f3fc231ecacdd05d505bc48545894", "author": {"user": {"login": "jkakavas", "name": "Ioannis Kakavas"}}, "url": "https://github.com/elastic/elasticsearch/commit/8600bcd3ea0f3fc231ecacdd05d505bc48545894", "committedDate": "2020-04-22T20:14:50Z", "message": "Validate hashing algorithm in users tool\n\nThis change adds validation when running the users tool so that\nif Elasticsearch is expected to run in a JVM that is configured to\nbe in FIPS 140 mode and the password hashing algorithm is not\ncompliant, we would throw an error.\nUsers tool uses the configuration from the node and this validation\nwould also happen upon node startup but users might be added in the\nfile realm before the node is started and we would have the\nopportunity to notify the user of this misconfiguration.\nThe changes in #55544 make this much less probable to happen in 8\nsince the default algorithm will be compliant but this change can\nact as a fallback in anycase and makes for a better user experience."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "068b667a68e7d1113e3f03152aafb82a964805fd", "author": {"user": {"login": "jkakavas", "name": "Ioannis Kakavas"}}, "url": "https://github.com/elastic/elasticsearch/commit/068b667a68e7d1113e3f03152aafb82a964805fd", "committedDate": "2020-04-22T20:15:28Z", "message": "Merge remote-tracking branch 'origin/master' into usertool-algo-fips"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk4NzE2Nzky", "url": "https://github.com/elastic/elasticsearch/pull/55628#pullrequestreview-398716792", "createdAt": "2020-04-23T02:28:30Z", "commit": {"oid": "068b667a68e7d1113e3f03152aafb82a964805fd"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yM1QwMjoyODozMVrOGKTxEg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yM1QwMjoyODozMVrOGKTxEg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzQ2MjgwMg==", "bodyText": "#55544 makes sure our default is sane for FIPS mode. But user can still explicit set the password hashing algorithm to something that is not FIPS compliant.\nSince PASSWORD_HASHING_ALGORITHM.get(...) is used in a few other places, rather than checking it at caller side, would it better to have this validation done in its own validator?", "url": "https://github.com/elastic/elasticsearch/pull/55628#discussion_r413462802", "createdAt": "2020-04-23T02:28:31Z", "author": {"login": "ywangd"}, "path": "x-pack/plugin/security/src/main/java/org/elasticsearch/xpack/security/authc/file/tool/UsersTool.java", "diffHunk": "@@ -439,6 +439,10 @@ static String parseUsername(List<String> args, Settings settings) throws UserExc\n \n     private static char[] getPasswordHash(Terminal terminal, Environment env, String cliPasswordValue) throws UserException {\n         final Hasher hasher = Hasher.resolve(XPackSettings.PASSWORD_HASHING_ALGORITHM.get(env.settings()));\n+        if (XPackSettings.FIPS_MODE_ENABLED.get(env.settings()) && hasher.name().toLowerCase(Locale.ROOT).startsWith(\"pbkdf2\") == false) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "068b667a68e7d1113e3f03152aafb82a964805fd"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk5NjQ2NTIw", "url": "https://github.com/elastic/elasticsearch/pull/55628#pullrequestreview-399646520", "createdAt": "2020-04-24T05:19:32Z", "commit": {"oid": "068b667a68e7d1113e3f03152aafb82a964805fd"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 493, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}