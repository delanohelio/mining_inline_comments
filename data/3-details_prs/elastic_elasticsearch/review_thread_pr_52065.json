{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzcyNTA2ODE4", "number": 52065, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wN1QxNzowMjozOFrODeFrLg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wOVQxNzo1Mzo0MFrODeSZEg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMyODc2ODQ2OnYy", "diffSide": "RIGHT", "path": "x-pack/plugin/eql/src/main/java/org/elasticsearch/xpack/eql/plan/physical/FilterExec.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wN1QxNzowMjozOFrOFnD23Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wN1QxODowMzowOFrOFnFc_w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjUwMTk4MQ==", "bodyText": "is it alright that hashCode() and equals check different things?", "url": "https://github.com/elastic/elasticsearch/pull/52065#discussion_r376501981", "createdAt": "2020-02-07T17:02:38Z", "author": {"login": "rw-access"}, "path": "x-pack/plugin/eql/src/main/java/org/elasticsearch/xpack/eql/plan/physical/FilterExec.java", "diffHunk": "@@ -0,0 +1,73 @@\n+/*\n+ * Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one\n+ * or more contributor license agreements. Licensed under the Elastic License;\n+ * you may not use this file except in compliance with the Elastic License.\n+ */\n+package org.elasticsearch.xpack.eql.plan.physical;\n+\n+import org.elasticsearch.xpack.ql.expression.Attribute;\n+import org.elasticsearch.xpack.ql.expression.Expression;\n+import org.elasticsearch.xpack.ql.tree.NodeInfo;\n+import org.elasticsearch.xpack.ql.tree.Source;\n+\n+import java.util.List;\n+import java.util.Objects;\n+\n+public class FilterExec extends UnaryExec implements Unexecutable {\n+\n+    private final Expression condition;\n+    private final boolean onAggs;\n+\n+    public FilterExec(Source source, PhysicalPlan child, Expression condition) {\n+        this(source, child, condition, false);\n+    }\n+\n+    public FilterExec(Source source, PhysicalPlan child, Expression condition, boolean onAggs) {\n+        super(source, child);\n+        this.condition = condition;\n+        this.onAggs = onAggs;\n+    }\n+\n+    @Override\n+    protected NodeInfo<FilterExec> info() {\n+        return NodeInfo.create(this, FilterExec::new, child(), condition, onAggs);\n+    }\n+\n+    @Override\n+    protected FilterExec replaceChild(PhysicalPlan newChild) {\n+        return new FilterExec(source(), newChild, condition, onAggs);\n+    }\n+\n+    public Expression condition() {\n+        return condition;\n+    }\n+\n+    public boolean onAggs() {\n+        return onAggs;\n+    }\n+\n+    @Override\n+    public List<Attribute> output() {\n+        return child().output();\n+    }\n+\n+    @Override\n+    public int hashCode() {\n+        return Objects.hash(condition, onAggs, child());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1ee9a61c3181110c0216fc17feb05abb3d2d2e0c"}, "originalPosition": 56}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjUyODEyNw==", "bodyText": "No, included onAggs.", "url": "https://github.com/elastic/elasticsearch/pull/52065#discussion_r376528127", "createdAt": "2020-02-07T18:03:08Z", "author": {"login": "costin"}, "path": "x-pack/plugin/eql/src/main/java/org/elasticsearch/xpack/eql/plan/physical/FilterExec.java", "diffHunk": "@@ -0,0 +1,73 @@\n+/*\n+ * Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one\n+ * or more contributor license agreements. Licensed under the Elastic License;\n+ * you may not use this file except in compliance with the Elastic License.\n+ */\n+package org.elasticsearch.xpack.eql.plan.physical;\n+\n+import org.elasticsearch.xpack.ql.expression.Attribute;\n+import org.elasticsearch.xpack.ql.expression.Expression;\n+import org.elasticsearch.xpack.ql.tree.NodeInfo;\n+import org.elasticsearch.xpack.ql.tree.Source;\n+\n+import java.util.List;\n+import java.util.Objects;\n+\n+public class FilterExec extends UnaryExec implements Unexecutable {\n+\n+    private final Expression condition;\n+    private final boolean onAggs;\n+\n+    public FilterExec(Source source, PhysicalPlan child, Expression condition) {\n+        this(source, child, condition, false);\n+    }\n+\n+    public FilterExec(Source source, PhysicalPlan child, Expression condition, boolean onAggs) {\n+        super(source, child);\n+        this.condition = condition;\n+        this.onAggs = onAggs;\n+    }\n+\n+    @Override\n+    protected NodeInfo<FilterExec> info() {\n+        return NodeInfo.create(this, FilterExec::new, child(), condition, onAggs);\n+    }\n+\n+    @Override\n+    protected FilterExec replaceChild(PhysicalPlan newChild) {\n+        return new FilterExec(source(), newChild, condition, onAggs);\n+    }\n+\n+    public Expression condition() {\n+        return condition;\n+    }\n+\n+    public boolean onAggs() {\n+        return onAggs;\n+    }\n+\n+    @Override\n+    public List<Attribute> output() {\n+        return child().output();\n+    }\n+\n+    @Override\n+    public int hashCode() {\n+        return Objects.hash(condition, onAggs, child());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjUwMTk4MQ=="}, "originalCommit": {"oid": "1ee9a61c3181110c0216fc17feb05abb3d2d2e0c"}, "originalPosition": 56}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMyOTE3OTMxOnYy", "diffSide": "RIGHT", "path": "x-pack/plugin/eql/src/main/java/org/elasticsearch/xpack/eql/plan/physical/LocalRelation.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wN1QxOTozMzozMVrOFnH8Lg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMFQwMjo0NDozMVrOFnZB8g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjU2ODg3OA==", "bodyText": "this would NPE if executable is null", "url": "https://github.com/elastic/elasticsearch/pull/52065#discussion_r376568878", "createdAt": "2020-02-07T19:33:31Z", "author": {"login": "aleksmaus"}, "path": "x-pack/plugin/eql/src/main/java/org/elasticsearch/xpack/eql/plan/physical/LocalRelation.java", "diffHunk": "@@ -0,0 +1,78 @@\n+/*\n+ * Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one\n+ * or more contributor license agreements. Licensed under the Elastic License;\n+ * you may not use this file except in compliance with the Elastic License.\n+ */\n+package org.elasticsearch.xpack.eql.plan.physical;\n+\n+import org.elasticsearch.action.ActionListener;\n+import org.elasticsearch.xpack.eql.session.EqlSession;\n+import org.elasticsearch.xpack.eql.session.Executable;\n+import org.elasticsearch.xpack.eql.session.Results;\n+import org.elasticsearch.xpack.ql.expression.Attribute;\n+import org.elasticsearch.xpack.ql.plan.logical.LogicalPlan;\n+import org.elasticsearch.xpack.ql.tree.NodeInfo;\n+import org.elasticsearch.xpack.ql.tree.Source;\n+\n+import java.util.List;\n+import java.util.Objects;\n+\n+import static java.util.Collections.emptyList;\n+\n+public class LocalRelation extends LogicalPlan implements Executable {\n+\n+    private final Executable executable;\n+\n+    public LocalRelation(Source source, Executable executable) {\n+        super(source, emptyList());\n+        this.executable = executable;\n+    }\n+\n+    @Override\n+    protected NodeInfo<LocalRelation> info() {\n+        return NodeInfo.create(this, LocalRelation::new, executable);\n+    }\n+\n+    @Override\n+    public LogicalPlan replaceChildren(List<LogicalPlan> newChildren) {\n+        throw new UnsupportedOperationException(\"this type of node doesn't have any children to replace\");\n+    }\n+\n+    public Executable executable() {\n+        return executable;\n+    }\n+\n+    @Override\n+    public boolean expressionsResolved() {\n+        return true;\n+    }\n+\n+    @Override\n+    public List<Attribute> output() {\n+        return executable.output();\n+    }\n+\n+    @Override\n+    public void execute(EqlSession session, ActionListener<Results> listener) {\n+        executable.execute(session, listener);\n+    }\n+\n+    @Override\n+    public int hashCode() {\n+        return executable.hashCode();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fb514c4aa8f075987e176e7f17153c07fd3eea4c"}, "originalPosition": 62}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjczNDc3OQ==", "bodyText": "The NPE cannot occur since:\n\nall children are non null as the plan is constructed.\nif by accident a null child is passed, the base class Node checks and throws a proper exception.", "url": "https://github.com/elastic/elasticsearch/pull/52065#discussion_r376734779", "createdAt": "2020-02-08T21:13:11Z", "author": {"login": "costin"}, "path": "x-pack/plugin/eql/src/main/java/org/elasticsearch/xpack/eql/plan/physical/LocalRelation.java", "diffHunk": "@@ -0,0 +1,78 @@\n+/*\n+ * Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one\n+ * or more contributor license agreements. Licensed under the Elastic License;\n+ * you may not use this file except in compliance with the Elastic License.\n+ */\n+package org.elasticsearch.xpack.eql.plan.physical;\n+\n+import org.elasticsearch.action.ActionListener;\n+import org.elasticsearch.xpack.eql.session.EqlSession;\n+import org.elasticsearch.xpack.eql.session.Executable;\n+import org.elasticsearch.xpack.eql.session.Results;\n+import org.elasticsearch.xpack.ql.expression.Attribute;\n+import org.elasticsearch.xpack.ql.plan.logical.LogicalPlan;\n+import org.elasticsearch.xpack.ql.tree.NodeInfo;\n+import org.elasticsearch.xpack.ql.tree.Source;\n+\n+import java.util.List;\n+import java.util.Objects;\n+\n+import static java.util.Collections.emptyList;\n+\n+public class LocalRelation extends LogicalPlan implements Executable {\n+\n+    private final Executable executable;\n+\n+    public LocalRelation(Source source, Executable executable) {\n+        super(source, emptyList());\n+        this.executable = executable;\n+    }\n+\n+    @Override\n+    protected NodeInfo<LocalRelation> info() {\n+        return NodeInfo.create(this, LocalRelation::new, executable);\n+    }\n+\n+    @Override\n+    public LogicalPlan replaceChildren(List<LogicalPlan> newChildren) {\n+        throw new UnsupportedOperationException(\"this type of node doesn't have any children to replace\");\n+    }\n+\n+    public Executable executable() {\n+        return executable;\n+    }\n+\n+    @Override\n+    public boolean expressionsResolved() {\n+        return true;\n+    }\n+\n+    @Override\n+    public List<Attribute> output() {\n+        return executable.output();\n+    }\n+\n+    @Override\n+    public void execute(EqlSession session, ActionListener<Results> listener) {\n+        executable.execute(session, listener);\n+    }\n+\n+    @Override\n+    public int hashCode() {\n+        return executable.hashCode();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjU2ODg3OA=="}, "originalCommit": {"oid": "fb514c4aa8f075987e176e7f17153c07fd3eea4c"}, "originalPosition": 62}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Njg0ODg4Mg==", "bodyText": "Thanks for the explanation!", "url": "https://github.com/elastic/elasticsearch/pull/52065#discussion_r376848882", "createdAt": "2020-02-10T02:44:31Z", "author": {"login": "aleksmaus"}, "path": "x-pack/plugin/eql/src/main/java/org/elasticsearch/xpack/eql/plan/physical/LocalRelation.java", "diffHunk": "@@ -0,0 +1,78 @@\n+/*\n+ * Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one\n+ * or more contributor license agreements. Licensed under the Elastic License;\n+ * you may not use this file except in compliance with the Elastic License.\n+ */\n+package org.elasticsearch.xpack.eql.plan.physical;\n+\n+import org.elasticsearch.action.ActionListener;\n+import org.elasticsearch.xpack.eql.session.EqlSession;\n+import org.elasticsearch.xpack.eql.session.Executable;\n+import org.elasticsearch.xpack.eql.session.Results;\n+import org.elasticsearch.xpack.ql.expression.Attribute;\n+import org.elasticsearch.xpack.ql.plan.logical.LogicalPlan;\n+import org.elasticsearch.xpack.ql.tree.NodeInfo;\n+import org.elasticsearch.xpack.ql.tree.Source;\n+\n+import java.util.List;\n+import java.util.Objects;\n+\n+import static java.util.Collections.emptyList;\n+\n+public class LocalRelation extends LogicalPlan implements Executable {\n+\n+    private final Executable executable;\n+\n+    public LocalRelation(Source source, Executable executable) {\n+        super(source, emptyList());\n+        this.executable = executable;\n+    }\n+\n+    @Override\n+    protected NodeInfo<LocalRelation> info() {\n+        return NodeInfo.create(this, LocalRelation::new, executable);\n+    }\n+\n+    @Override\n+    public LogicalPlan replaceChildren(List<LogicalPlan> newChildren) {\n+        throw new UnsupportedOperationException(\"this type of node doesn't have any children to replace\");\n+    }\n+\n+    public Executable executable() {\n+        return executable;\n+    }\n+\n+    @Override\n+    public boolean expressionsResolved() {\n+        return true;\n+    }\n+\n+    @Override\n+    public List<Attribute> output() {\n+        return executable.output();\n+    }\n+\n+    @Override\n+    public void execute(EqlSession session, ActionListener<Results> listener) {\n+        executable.execute(session, listener);\n+    }\n+\n+    @Override\n+    public int hashCode() {\n+        return executable.hashCode();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjU2ODg3OA=="}, "originalCommit": {"oid": "fb514c4aa8f075987e176e7f17153c07fd3eea4c"}, "originalPosition": 62}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMzMDg1MjAyOnYy", "diffSide": "RIGHT", "path": "x-pack/plugin/eql/src/main/java/org/elasticsearch/xpack/eql/common/Failure.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wOVQxNzo1Mzo0MFrOFnWKxQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wOVQxNzo1Mzo0MFrOFnWKxQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjgwMTk4OQ==", "bodyText": "I know it's code that already existed and you just moved it from one place to another, but I think we can do slightly better with the error message. Why not doing \"Found \" + failures.size() + \" problem\" + (failures.size() > 1 ? \"s\\n\" : \"\\n\")?", "url": "https://github.com/elastic/elasticsearch/pull/52065#discussion_r376801989", "createdAt": "2020-02-09T17:53:40Z", "author": {"login": "astefan"}, "path": "x-pack/plugin/eql/src/main/java/org/elasticsearch/xpack/eql/common/Failure.java", "diffHunk": "@@ -54,7 +58,14 @@ public String toString() {\n         return message;\n     }\n \n-    static Failure fail(Node<?> source, String message, Object... args) {\n+    public static Failure fail(Node<?> source, String message, Object... args) {\n         return new Failure(source, format(message, args));\n     }\n+\n+    public static String failMessage(Collection<Failure> failures) {\n+        return failures.stream().map(f -> {\n+            Location l = f.node().source().source();\n+            return \"line \" + l.getLineNumber() + \":\" + l.getColumnNumber() + \": \" + f.message();\n+        }).collect(Collectors.joining(StringUtils.NEW_LINE, \"Found \" + failures.size() + \" problem(s)\\n\", StringUtils.EMPTY));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fb514c4aa8f075987e176e7f17153c07fd3eea4c"}, "originalPosition": 52}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4830, "cost": 1, "resetAt": "2021-11-12T13:16:51Z"}}}