{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk3MjYwNzgy", "number": 54617, "title": "Add validation to the usage service", "bodyText": "Today the usage service can let in some issues, such as handlers that do not have a name, where the errors do not manifest until later (calling the usage API), or conflicting handlers with the same name. This commit addresses this by adding some validation to the usage service.", "createdAt": "2020-04-01T22:21:15Z", "url": "https://github.com/elastic/elasticsearch/pull/54617", "merged": true, "mergeCommit": {"oid": "cdd07c5927312c8d7a08d8bd79cc8fb31041505c"}, "closed": true, "closedAt": "2020-04-02T12:55:57Z", "author": {"login": "jasontedor"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcTfTm3gH2gAyMzk3MjYwNzgyOjlkMzc0NzBkZWM2MmMwNDVkZjAyNzJhNzM0MGVlYzk3MGNlNDgwOWQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcTrihUAFqTM4NjM4MDM0OQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "9d37470dec62c045df0272a7340eec970ce4809d", "author": {"user": {"login": "jasontedor", "name": "Jason Tedor"}}, "url": "https://github.com/elastic/elasticsearch/commit/9d37470dec62c045df0272a7340eec970ce4809d", "committedDate": "2020-04-01T22:19:07Z", "message": "Add validation to the usage service\n\nToday the usage service can let in some issues, such as handlers that do\nnot have a name, where the errors do not manifest until later (calling\nthe usage API), or conflicting handlers with the same name. This commit\naddresses this by adding some validation to the usage service."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0dca4551d47d416db5ed55025bc872500fd68346", "author": {"user": {"login": "jasontedor", "name": "Jason Tedor"}}, "url": "https://github.com/elastic/elasticsearch/commit/0dca4551d47d416db5ed55025bc872500fd68346", "committedDate": "2020-04-02T00:17:10Z", "message": "Fix test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "62a0b79f7023c2ff900d190668146e2b83a72a96", "author": {"user": {"login": "jasontedor", "name": "Jason Tedor"}}, "url": "https://github.com/elastic/elasticsearch/commit/62a0b79f7023c2ff900d190668146e2b83a72a96", "committedDate": "2020-04-02T01:43:02Z", "message": "Fix typo in comment"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg2MjE0MjYw", "url": "https://github.com/elastic/elasticsearch/pull/54617#pullrequestreview-386214260", "createdAt": "2020-04-02T08:35:43Z", "commit": {"oid": "62a0b79f7023c2ff900d190668146e2b83a72a96"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMlQwODozNTo0M1rOF_g2nQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMlQwODozNTo0M1rOF_g2nQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjE0Mjg3Nw==", "bodyText": "How do you feel about adding JavaDoc for these new test cases? We added something to the contribution guidelines about this, and I personally find it enormously useful to check that the stated purpose of the test matches the implementation.", "url": "https://github.com/elastic/elasticsearch/pull/54617#discussion_r402142877", "createdAt": "2020-04-02T08:35:43Z", "author": {"login": "pugnascotia"}, "path": "server/src/test/java/org/elasticsearch/usage/UsageServiceTests.java", "diffHunk": "@@ -41,6 +42,45 @@\n \n public class UsageServiceTests extends ESTestCase {\n \n+    public void testNullHandler() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "62a0b79f7023c2ff900d190668146e2b83a72a96"}, "originalPosition": 12}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg2MjE0NzU5", "url": "https://github.com/elastic/elasticsearch/pull/54617#pullrequestreview-386214759", "createdAt": "2020-04-02T08:36:22Z", "commit": {"oid": "62a0b79f7023c2ff900d190668146e2b83a72a96"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMlQwODozNjoyMlrOF_g4Iw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMlQwODozNjoyMlrOF_g4Iw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjE0MzI2Nw==", "bodyText": "Quality variable name! \ud83d\udc4d\ud83d\udc34", "url": "https://github.com/elastic/elasticsearch/pull/54617#discussion_r402143267", "createdAt": "2020-04-02T08:36:22Z", "author": {"login": "pugnascotia"}, "path": "server/src/test/java/org/elasticsearch/usage/UsageServiceTests.java", "diffHunk": "@@ -41,6 +42,45 @@\n \n public class UsageServiceTests extends ESTestCase {\n \n+    public void testNullHandler() {\n+        final UsageService service = new UsageService();\n+        expectThrows(NullPointerException.class, () -> service.addRestHandler(null));\n+    }\n+\n+    public void testAHandlerWithNoName() {\n+        final UsageService service = new UsageService();\n+        final BaseRestHandler horse = new MockRestHandler(null);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "62a0b79f7023c2ff900d190668146e2b83a72a96"}, "originalPosition": 19}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg2MjI1NDY5", "url": "https://github.com/elastic/elasticsearch/pull/54617#pullrequestreview-386225469", "createdAt": "2020-04-02T08:50:32Z", "commit": {"oid": "62a0b79f7023c2ff900d190668146e2b83a72a96"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bcbf0015482023731a8d0b53a9c48962432767f9", "author": {"user": {"login": "jasontedor", "name": "Jason Tedor"}}, "url": "https://github.com/elastic/elasticsearch/commit/bcbf0015482023731a8d0b53a9c48962432767f9", "committedDate": "2020-04-02T12:07:15Z", "message": "Add Javadocs"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg2MzgwMzQ5", "url": "https://github.com/elastic/elasticsearch/pull/54617#pullrequestreview-386380349", "createdAt": "2020-04-02T12:34:16Z", "commit": {"oid": "bcbf0015482023731a8d0b53a9c48962432767f9"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMlQxMjozNDoxNlrOF_pEZQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMlQxMjozNDoxNlrOF_pEZQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjI3NzQ3Nw==", "bodyText": "\ud83e\udd23", "url": "https://github.com/elastic/elasticsearch/pull/54617#discussion_r402277477", "createdAt": "2020-04-02T12:34:16Z", "author": {"login": "pugnascotia"}, "path": "server/src/test/java/org/elasticsearch/usage/UsageServiceTests.java", "diffHunk": "@@ -56,15 +62,22 @@ public void testAHandlerWithNoName() {\n             equalTo(\"handler of type [org.elasticsearch.usage.UsageServiceTests$MockRestHandler] does not have a name\"));\n     }\n \n+    /**\n+     * Test that we can add the same instance of a {@link org.elasticsearch.rest.RestHandler} to the {@link UsageService} multiple times.\n+     */\n     public void testHandlerWithConflictingNamesButSameInstance() {\n         final UsageService service = new UsageService();\n         final String name = randomAlphaOfLength(8);\n         final BaseRestHandler first = new MockRestHandler(name);\n         service.addRestHandler(first);\n-        // nothing bad should happen\n+        // nothing bad ever happens to me", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bcbf0015482023731a8d0b53a9c48962432767f9"}, "originalPosition": 32}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1270, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}