{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA2NzExMTc5", "number": 55537, "title": "[ML] explicitly disallow partial results in datafeed extractors", "bodyText": "Instead of doing our own checks against REST status, shard counts, and shard failures, this commit changes all our extractor search requests to set .setAllowPartialSearchResults(false).\n\nScrolls are automatically cleared when a search failure occurs with .setAllowPartialSearchResults(false) set.\nCode error handling is simplified\n\ncloses #40793", "createdAt": "2020-04-21T14:27:47Z", "url": "https://github.com/elastic/elasticsearch/pull/55537", "merged": true, "mergeCommit": {"oid": "5074f2c4c702665e814c49b061993a462c58fa93"}, "closed": true, "closedAt": "2020-04-22T12:19:06Z", "author": {"login": "benwtrent"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcZ0fmVAH2gAyNDA2NzExMTc5OjY0YzQ2YzVjNjJhY2UwY2M0MWZkMzRjMWE5MzRjNzUwMThlNWZlZjU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcaGn0PAH2gAyNDA2NzExMTc5OjZiZDMzMzRmOTRjMmY0Zjg5YTIyMWNiYzBlMGYxOThhYzU2M2EwMzc=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "64c46c5c62ace0cc41fd34c1a934c75018e5fef5", "author": {"user": {"login": "benwtrent", "name": "Benjamin Trent"}}, "url": "https://github.com/elastic/elasticsearch/commit/64c46c5c62ace0cc41fd34c1a934c75018e5fef5", "committedDate": "2020-04-21T14:23:46Z", "message": "[ML] explicitly disallow partial results in datafeed extractors"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f402b3151290ee67e7fbc54906ef812a5b69b947", "author": {"user": {"login": "elasticmachine", "name": "Elastic Machine"}}, "url": "https://github.com/elastic/elasticsearch/commit/f402b3151290ee67e7fbc54906ef812a5b69b947", "committedDate": "2020-04-21T17:19:57Z", "message": "Merge branch 'master' into feature/ml-df-explicitly-disallow-partial-results-in-datafeeds"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk3ODYyMDA3", "url": "https://github.com/elastic/elasticsearch/pull/55537#pullrequestreview-397862007", "createdAt": "2020-04-22T05:52:28Z", "commit": {"oid": "f402b3151290ee67e7fbc54906ef812a5b69b947"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk3ODkxMDc0", "url": "https://github.com/elastic/elasticsearch/pull/55537#pullrequestreview-397891074", "createdAt": "2020-04-22T06:52:42Z", "commit": {"oid": "f402b3151290ee67e7fbc54906ef812a5b69b947"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMlQwNjo1Mjo0MlrOGJmPwA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMlQwNjo1Mjo0MlrOGJmPwA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjcxNjk5Mg==", "bodyText": "what about adding .setAllowPartialSearchResults(false) on the output of buildSearchRequest(...) instead of doing it per sub-class? Seems cleaner to me.", "url": "https://github.com/elastic/elasticsearch/pull/55537#discussion_r412716992", "createdAt": "2020-04-22T06:52:42Z", "author": {"login": "hendrikmuhs"}, "path": "x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/datafeed/extractor/aggregation/AbstractAggregationDataExtractor.java", "diffHunk": "@@ -107,12 +107,11 @@ public long getEndTime() {\n         return Optional.ofNullable(processNextBatch());\n     }\n \n-    private Aggregations search() throws IOException {\n+    private Aggregations search() {\n         LOGGER.debug(\"[{}] Executing aggregated search\", context.jobId);\n         SearchResponse searchResponse = executeSearchRequest(buildSearchRequest(buildBaseSearchSource()));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f402b3151290ee67e7fbc54906ef812a5b69b947"}, "originalPosition": 7}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk3OTY5MTMz", "url": "https://github.com/elastic/elasticsearch/pull/55537#pullrequestreview-397969133", "createdAt": "2020-04-22T08:39:47Z", "commit": {"oid": "f402b3151290ee67e7fbc54906ef812a5b69b947"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "283f9e01cd0323e56f41eef2463492cec95a7d90", "author": {"user": {"login": "benwtrent", "name": "Benjamin Trent"}}, "url": "https://github.com/elastic/elasticsearch/commit/283f9e01cd0323e56f41eef2463492cec95a7d90", "committedDate": "2020-04-22T11:30:48Z", "message": "adding assert"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6bd3334f94c2f4f89a221cbc0e0f198ac563a037", "author": {"user": {"login": "benwtrent", "name": "Benjamin Trent"}}, "url": "https://github.com/elastic/elasticsearch/commit/6bd3334f94c2f4f89a221cbc0e0f198ac563a037", "committedDate": "2020-04-22T11:31:02Z", "message": "Merge remote-tracking branch 'upstream/master' into feature/ml-df-explicitly-disallow-partial-results-in-datafeeds"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 631, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}