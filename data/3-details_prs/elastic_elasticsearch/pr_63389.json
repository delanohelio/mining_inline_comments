{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDk5MDg4MDEz", "number": 63389, "title": "Remove some more QueryShardContext#getMapperService usages", "bodyText": "Some callers of getMapperService only call getIndexAnalyzers on it, which is already available on QueryShardContext. This commit moves these callers to call QueryShardContext#getIndexAnalyzers directly.\nAlso, the remaining getMapperService usages in tests can now be removed or replaced.", "createdAt": "2020-10-07T08:50:19Z", "url": "https://github.com/elastic/elasticsearch/pull/63389", "merged": true, "mergeCommit": {"oid": "ff92494716f4a99427fd4a7e948c8fe0a444dfee"}, "closed": true, "closedAt": "2020-10-07T11:42:04Z", "author": {"login": "javanna"}, "timelineItems": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdQI3rogH2gAyNDk5MDg4MDEzOmNhYzI2N2Q1M2M1MTYyZmJmMDVlYTBjMmRlMzYxNzJiMDI3NjZiODg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdQKP7GAH2gAyNDk5MDg4MDEzOjZkNGQ3YWU3Y2NmMzdkNWQ0NjI3MzVkZTRjNjkyZWQzNDAyMmZkMzU=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "cac267d53c5162fbf05ea0c2de36172b02766b88", "author": {"user": {"login": "javanna", "name": "Luca Cavanna"}}, "url": "https://github.com/elastic/elasticsearch/commit/cac267d53c5162fbf05ea0c2de36172b02766b88", "committedDate": "2020-10-07T08:40:05Z", "message": "Remove some more QueryShardContext#getMapperService usages\n\nSome callers of `getMapperService` only call `getIndexAnalyzers` on it, which is already available on `QueryShardContext`. This commit moves these callers to call `QueryShardContext#getIndexAnalyzers` directly.\n\nAlso, the remaining getMapperService usages in tests can now be removed or replaced."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAzNjY2ODc5", "url": "https://github.com/elastic/elasticsearch/pull/63389#pullrequestreview-503666879", "createdAt": "2020-10-07T08:59:43Z", "commit": {"oid": "cac267d53c5162fbf05ea0c2de36172b02766b88"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wN1QwODo1OTo0M1rOHdpgEw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wN1QwODo1OTo0M1rOHdpgEw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDg1MDcwNw==", "bodyText": "nit: indentation", "url": "https://github.com/elastic/elasticsearch/pull/63389#discussion_r500850707", "createdAt": "2020-10-07T08:59:43Z", "author": {"login": "romseygeek"}, "path": "server/src/main/java/org/elasticsearch/search/suggest/SuggestionBuilder.java", "diffHunk": "@@ -298,22 +297,18 @@ public XContentBuilder toXContent(XContentBuilder builder, Params params) throws\n      * Transfers the text, prefix, regex, analyzer, field, size and shard size settings from the\n      * original {@link SuggestionBuilder} to the target {@link SuggestionContext}\n      */\n-    protected void populateCommonFields(MapperService mapperService, SuggestionSearchContext.SuggestionContext suggestionContext) {\n+    protected void populateCommonFields(QueryShardContext context, SuggestionSearchContext.SuggestionContext suggestionContext) {\n \n         Objects.requireNonNull(field, \"field must not be null\");\n-\n-        MappedFieldType fieldType = mapperService.fieldType(field);\n-        if (fieldType == null) {\n+        if (context.isFieldMapped(field) == false) {\n             throw new IllegalArgumentException(\"no mapping found for field [\" + field + \"]\");\n-        } else if (analyzer == null) {\n-            // no analyzer name passed in, so try the field's analyzer, or the default analyzer\n-            if (fieldType.getTextSearchInfo().getSearchAnalyzer() == null) {\n-                suggestionContext.setAnalyzer(mapperService.searchAnalyzer());\n-            } else {\n-                suggestionContext.setAnalyzer(fieldType.getTextSearchInfo().getSearchAnalyzer());\n-            }\n+        }\n+\n+        MappedFieldType fieldType = context.fieldMapper(field);\n+         if (analyzer == null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cac267d53c5162fbf05ea0c2de36172b02766b88"}, "originalPosition": 31}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6d4d7ae7ccf37d5d462735de4c692ed34022fd35", "author": {"user": {"login": "javanna", "name": "Luca Cavanna"}}, "url": "https://github.com/elastic/elasticsearch/commit/6d4d7ae7ccf37d5d462735de4c692ed34022fd35", "committedDate": "2020-10-07T10:16:28Z", "message": "iter"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4350, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}