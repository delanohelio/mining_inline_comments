{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg3MzUzMjkz", "number": 53495, "title": "SQL: Fix issue with LIKE/RLIKE as painless script", "bodyText": "Add missing asScript() implementation for LIKE/RLIKE expressions.\nWhen LIKE/RLIKE are used for example in GROUP BY or are wrapped with\nscalar functions in a WHERE clause, the translation must produce a\npainless script which will be executed to implement the correct\nbehaviour and previously this was completely missing, and as a\nconsquence wrong results were silently (no error) returned.\nFixes: #53486", "createdAt": "2020-03-12T16:50:38Z", "url": "https://github.com/elastic/elasticsearch/pull/53495", "merged": true, "mergeCommit": {"oid": "eaa8ead6742a8e7dcf343bcbaff8de031550fd77"}, "closed": true, "closedAt": "2020-03-16T10:55:09Z", "author": {"login": "matriv"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcM-rYIABqjMxMjM2NzcyMzU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcOK22ZgFqTM3NTA0NDE5Mw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "84d743678194a432962f04484e82f6192fa4912f", "author": {"user": {"login": "matriv", "name": "Marios Trivyzas"}}, "url": "https://github.com/elastic/elasticsearch/commit/84d743678194a432962f04484e82f6192fa4912f", "committedDate": "2020-03-12T16:43:41Z", "message": "SQL: Fix issue with LIKE/RLIKE as painless script\n\nAdd missing asScript() implementation for LIKE/RLIKE expressions.\n\nWhen LIKE/RLIKE are used for example in GROUP BY or are wrapped with\nscalar functions in a WHERE clause, the translation must produce a\npainless script which will be executed to implement the correct\nbehaviour and previously this was completely missing, and as a\nconsquence wrong results were silently (no error) returned.\n\nFixes: #53486"}, "afterCommit": {"oid": "a47b5bd1eb2bb924554f14d136c6c6bffbda0d4a", "author": {"user": {"login": "matriv", "name": "Marios Trivyzas"}}, "url": "https://github.com/elastic/elasticsearch/commit/a47b5bd1eb2bb924554f14d136c6c6bffbda0d4a", "committedDate": "2020-03-12T16:53:57Z", "message": "SQL: Fix issue with LIKE/RLIKE as painless script\n\nAdd missing asScript() implementation for LIKE/RLIKE expressions.\n\nWhen LIKE/RLIKE are used for example in GROUP BY or are wrapped with\nscalar functions in a WHERE clause, the translation must produce a\npainless script which will be executed to implement the correct\nbehaviour and previously this was completely missing, and as a\nconsquence wrong results were silently (no error) returned.\n\nFixes: #53486"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7e8f4feb3df08f7d0e22554531b4d426e14fc02c", "author": {"user": {"login": "matriv", "name": "Marios Trivyzas"}}, "url": "https://github.com/elastic/elasticsearch/commit/7e8f4feb3df08f7d0e22554531b4d426e14fc02c", "committedDate": "2020-03-12T16:55:43Z", "message": "SQL: Fix issue with LIKE/RLIKE as painless script\n\nAdd missing asScript() implementation for LIKE/RLIKE expressions.\n\nWhen LIKE/RLIKE are used for example in GROUP BY or are wrapped with\nscalar functions in a WHERE clause, the translation must produce a\npainless script which will be executed to implement the correct\nbehaviour and previously this was completely missing, and as a\nconsquence wrong results were silently (no error) returned.\n\nFixes: #53486"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a47b5bd1eb2bb924554f14d136c6c6bffbda0d4a", "author": {"user": {"login": "matriv", "name": "Marios Trivyzas"}}, "url": "https://github.com/elastic/elasticsearch/commit/a47b5bd1eb2bb924554f14d136c6c6bffbda0d4a", "committedDate": "2020-03-12T16:53:57Z", "message": "SQL: Fix issue with LIKE/RLIKE as painless script\n\nAdd missing asScript() implementation for LIKE/RLIKE expressions.\n\nWhen LIKE/RLIKE are used for example in GROUP BY or are wrapped with\nscalar functions in a WHERE clause, the translation must produce a\npainless script which will be executed to implement the correct\nbehaviour and previously this was completely missing, and as a\nconsquence wrong results were silently (no error) returned.\n\nFixes: #53486"}, "afterCommit": {"oid": "7e8f4feb3df08f7d0e22554531b4d426e14fc02c", "author": {"user": {"login": "matriv", "name": "Marios Trivyzas"}}, "url": "https://github.com/elastic/elasticsearch/commit/7e8f4feb3df08f7d0e22554531b4d426e14fc02c", "committedDate": "2020-03-12T16:55:43Z", "message": "SQL: Fix issue with LIKE/RLIKE as painless script\n\nAdd missing asScript() implementation for LIKE/RLIKE expressions.\n\nWhen LIKE/RLIKE are used for example in GROUP BY or are wrapped with\nscalar functions in a WHERE clause, the translation must produce a\npainless script which will be executed to implement the correct\nbehaviour and previously this was completely missing, and as a\nconsquence wrong results were silently (no error) returned.\n\nFixes: #53486"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "68503774af987746eb6945165b5417931f793a12", "author": {"user": {"login": "matriv", "name": "Marios Trivyzas"}}, "url": "https://github.com/elastic/elasticsearch/commit/68503774af987746eb6945165b5417931f793a12", "committedDate": "2020-03-12T18:08:29Z", "message": "Merge remote-tracking branch 'upstream/master' into fix-53486"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc0MjQ2ODAz", "url": "https://github.com/elastic/elasticsearch/pull/53495#pullrequestreview-374246803", "createdAt": "2020-03-13T12:03:37Z", "commit": {"oid": "68503774af987746eb6945165b5417931f793a12"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xM1QxMjowMzozN1rOF2BOCQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xM1QxMjowNDozMlrOF2BPeA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjE4NzQwMQ==", "bodyText": "Maybe RegexPattern", "url": "https://github.com/elastic/elasticsearch/pull/53495#discussion_r392187401", "createdAt": "2020-03-13T12:03:37Z", "author": {"login": "costin"}, "path": "x-pack/plugin/ql/src/main/java/org/elasticsearch/xpack/ql/expression/predicate/regex/Pattern.java", "diffHunk": "@@ -0,0 +1,13 @@\n+/*\n+ * Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one\n+ * or more contributor license agreements. Licensed under the Elastic License;\n+ * you may not use this file except in compliance with the Elastic License.\n+ */\n+package org.elasticsearch.xpack.ql.expression.predicate.regex;\n+\n+interface Pattern {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "68503774af987746eb6945165b5417931f793a12"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjE4Nzc2OA==", "bodyText": "\ud83d\udc4d", "url": "https://github.com/elastic/elasticsearch/pull/53495#discussion_r392187768", "createdAt": "2020-03-13T12:04:32Z", "author": {"login": "costin"}, "path": "x-pack/plugin/ql/src/main/java/org/elasticsearch/xpack/ql/expression/predicate/regex/RegexMatch.java", "diffHunk": "@@ -54,8 +58,30 @@ public boolean foldable() {\n         // right() is not directly foldable in any context but Like can fold it.\n         return field().foldable();\n     }\n-    \n+\n+    @Override\n+    public Boolean fold() {\n+        Object val = field().fold();\n+        return RegexProcessor.RegexOperation.match(val, pattern().asJavaRegex());\n+    }\n+\n     @Override\n+    protected Processor makeProcessor() {\n+        return new RegexProcessor(pattern().asJavaRegex());\n+    }\n+\n+    @Override\n+    public ScriptTemplate asScript() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "68503774af987746eb6945165b5417931f793a12"}, "originalPosition": 39}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "987c4b758cc68fff244985ff9b61f79b157b3ef0", "author": {"user": {"login": "matriv", "name": "Marios Trivyzas"}}, "url": "https://github.com/elastic/elasticsearch/commit/987c4b758cc68fff244985ff9b61f79b157b3ef0", "committedDate": "2020-03-13T13:48:49Z", "message": "rename iface"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bd81d25e35dc360e8e073150be50a43a1dcf7d8c", "author": {"user": {"login": "matriv", "name": "Marios Trivyzas"}}, "url": "https://github.com/elastic/elasticsearch/commit/bd81d25e35dc360e8e073150be50a43a1dcf7d8c", "committedDate": "2020-03-13T14:04:34Z", "message": "Merge remote-tracking branch 'upstream/master' into fix-53486"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc0OTg3NjAw", "url": "https://github.com/elastic/elasticsearch/pull/53495#pullrequestreview-374987600", "createdAt": "2020-03-16T08:11:17Z", "commit": {"oid": "bd81d25e35dc360e8e073150be50a43a1dcf7d8c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc1MDQ0MTkz", "url": "https://github.com/elastic/elasticsearch/pull/53495#pullrequestreview-375044193", "createdAt": "2020-03-16T09:39:59Z", "commit": {"oid": "bd81d25e35dc360e8e073150be50a43a1dcf7d8c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1572, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}