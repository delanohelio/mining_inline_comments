{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTQzNzQxMjEx", "number": 66718, "title": "[Transform] report last search time in transform stats", "bodyText": "transforms reports the the last time changes where detected with changes_last_detected_at, however that doesn't tell a user it searched for changes, this PR adds a field last_search_time to report when transform searched for changes the last time.\nfixes #66410\nrelates #66367\nNotes\n\nshould be super useful for support cases\ncat transforms should report last_search_time (#66367)\nmakes testing more reliable (#66410)\nnot reported for stopped transforms\n\nReview\nthe main changes are part of bd59629 (#66718), the rest are style and test fixes", "createdAt": "2020-12-21T21:44:44Z", "url": "https://github.com/elastic/elasticsearch/pull/66718", "merged": true, "mergeCommit": {"oid": "951d82260479fd1c5b6222a64caf9ba46cc89463"}, "closed": true, "closedAt": "2021-01-20T14:00:12Z", "author": {"login": "hendrikmuhs"}, "timelineItems": {"totalCount": 16, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdom2EDgBqjQxMzkyNjI5MTg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdx9jcjgBqjQyMjcyMTk5MzE=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b90e6978ddcba21714aaf7ac5ac599383f52793b", "author": {"user": {"login": "hendrikmuhs", "name": "Hendrik Muhs"}}, "url": "https://github.com/elastic/elasticsearch/commit/b90e6978ddcba21714aaf7ac5ac599383f52793b", "committedDate": "2020-12-22T08:40:22Z", "message": "report last searched at for stopped transform"}, "afterCommit": {"oid": "a3da0364e2fca0d9c373d7c3c01771592b2716ce", "author": {"user": {"login": "hendrikmuhs", "name": "Hendrik Muhs"}}, "url": "https://github.com/elastic/elasticsearch/commit/a3da0364e2fca0d9c373d7c3c01771592b2716ce", "committedDate": "2020-12-22T09:09:24Z", "message": "report last searched at for stopped transform"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a3da0364e2fca0d9c373d7c3c01771592b2716ce", "author": {"user": {"login": "hendrikmuhs", "name": "Hendrik Muhs"}}, "url": "https://github.com/elastic/elasticsearch/commit/a3da0364e2fca0d9c373d7c3c01771592b2716ce", "committedDate": "2020-12-22T09:09:24Z", "message": "report last searched at for stopped transform"}, "afterCommit": {"oid": "b1bd39a96fb55e800a4d9bc4253643d136a88da5", "author": {"user": {"login": "hendrikmuhs", "name": "Hendrik Muhs"}}, "url": "https://github.com/elastic/elasticsearch/commit/b1bd39a96fb55e800a4d9bc4253643d136a88da5", "committedDate": "2020-12-22T09:21:53Z", "message": "fix tests and unmute HistogramGroupByIT"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU2OTU1MjE0", "url": "https://github.com/elastic/elasticsearch/pull/66718#pullrequestreview-556955214", "createdAt": "2020-12-22T09:55:14Z", "commit": {"oid": "bd596295acaec91ab4d66e0ab484b2a9cddbad0a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMlQwOTo1NToxNFrOIJ1NJA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMlQwOTo1NToxNFrOIJ1NJA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzE3OTgxMg==", "bodyText": "This changes behaviour for changed_last_detected_at. The change seems correct but is it fixing another issue with that not getting updated properly?", "url": "https://github.com/elastic/elasticsearch/pull/66718#discussion_r547179812", "createdAt": "2020-12-22T09:55:14Z", "author": {"login": "dimitris-athanasiou"}, "path": "x-pack/plugin/transform/src/main/java/org/elasticsearch/xpack/transform/transforms/TransformIndexer.java", "diffHunk": "@@ -355,6 +357,8 @@ protected void onStart(long now, ActionListener<Boolean> listener) {\n             }));\n         } else {\n             hasSourceChanged = true;\n+            context.setChangesLastSearchedAt(instantOfTrigger);\n+            context.setChangesLastDetectedAt(instantOfTrigger);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bd596295acaec91ab4d66e0ab484b2a9cddbad0a"}, "originalPosition": 22}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU2OTcxNjEy", "url": "https://github.com/elastic/elasticsearch/pull/66718#pullrequestreview-556971612", "createdAt": "2020-12-22T10:20:34Z", "commit": {"oid": "b1bd39a96fb55e800a4d9bc4253643d136a88da5"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b1bd39a96fb55e800a4d9bc4253643d136a88da5", "author": {"user": {"login": "hendrikmuhs", "name": "Hendrik Muhs"}}, "url": "https://github.com/elastic/elasticsearch/commit/b1bd39a96fb55e800a4d9bc4253643d136a88da5", "committedDate": "2020-12-22T09:21:53Z", "message": "fix tests and unmute HistogramGroupByIT"}, "afterCommit": {"oid": "7d9510f0f111d8401fe96f8eba7dae9a2c75ed46", "author": {"user": {"login": "hendrikmuhs", "name": "Hendrik Muhs"}}, "url": "https://github.com/elastic/elasticsearch/commit/7d9510f0f111d8401fe96f8eba7dae9a2c75ed46", "committedDate": "2021-01-11T09:29:42Z", "message": "fix tests and unmute HistogramGroupByIT"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7d9510f0f111d8401fe96f8eba7dae9a2c75ed46", "author": {"user": {"login": "hendrikmuhs", "name": "Hendrik Muhs"}}, "url": "https://github.com/elastic/elasticsearch/commit/7d9510f0f111d8401fe96f8eba7dae9a2c75ed46", "committedDate": "2021-01-11T09:29:42Z", "message": "fix tests and unmute HistogramGroupByIT"}, "afterCommit": {"oid": "db46fe0a64ced2f4c2c5f36493382c29c05fb8bd", "author": {"user": {"login": "hendrikmuhs", "name": "Hendrik Muhs"}}, "url": "https://github.com/elastic/elasticsearch/commit/db46fe0a64ced2f4c2c5f36493382c29c05fb8bd", "committedDate": "2021-01-19T10:43:31Z", "message": "change naming to last_search_time"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTcxMTkxNDQ3", "url": "https://github.com/elastic/elasticsearch/pull/66718#pullrequestreview-571191447", "createdAt": "2021-01-19T12:23:04Z", "commit": {"oid": "fe8ee20a5474071b3fc6efa8792413f8759bb19d"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xOVQxMjoyMzowNVrOIWMIvA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xOVQxMjoyMzowNVrOIWMIvA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MDEzODQyOA==", "bodyText": "lastSearchTime or lastSearchedTime?\nPlease use the same variable name in both TransformCheckpointingInfo classes.", "url": "https://github.com/elastic/elasticsearch/pull/66718#discussion_r560138428", "createdAt": "2021-01-19T12:23:05Z", "author": {"login": "przemekwitek"}, "path": "client/rest-high-level/src/main/java/org/elasticsearch/client/transform/transforms/TransformCheckpointingInfo.java", "diffHunk": "@@ -49,13 +49,13 @@\n         a -> {\n             long behind = a[2] == null ? 0L : (Long) a[2];\n             Instant changesLastDetectedAt = (Instant) a[3];\n-            Instant changesLastSearchedAt = (Instant) a[4];\n+            Instant lastSearchTime = (Instant) a[4];", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fe8ee20a5474071b3fc6efa8792413f8759bb19d"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTcxOTczODI2", "url": "https://github.com/elastic/elasticsearch/pull/66718#pullrequestreview-571973826", "createdAt": "2021-01-20T08:33:07Z", "commit": {"oid": "8015bcc9ef9da676471a184736dfc9d36085d1f4"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0yMFQwODozMzowN1rOIWyWpA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0yMFQwODozMzowN1rOIWyWpA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MDc2NDU4MA==", "bodyText": "Just double-checking: Is \"+1\" no longer needed here?", "url": "https://github.com/elastic/elasticsearch/pull/66718#discussion_r560764580", "createdAt": "2021-01-20T08:33:07Z", "author": {"login": "przemekwitek"}, "path": "x-pack/plugin/transform/qa/multi-node-tests/src/javaRestTest/java/org/elasticsearch/xpack/transform/integration/continuous/TransformContinuousIT.java", "diffHunk": "@@ -276,7 +275,7 @@ public void testContinousEvents() throws Exception {\n \n             // at random we added between 0 and 999_999ns == (1ms - 1ns) to every data point, so we add 1ms, so every data point is before\n             // the checkpoint\n-            waitUntilTransformsReachedUpperBound(runDate.toEpochMilli() + 1, run);\n+            waitUntilTransformsProcessedNewData(ContinuousTestCase.SYNC_DELAY, run);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8015bcc9ef9da676471a184736dfc9d36085d1f4"}, "originalPosition": 13}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bb28ef9229feee9cdd0f98f462b810c25845b909", "author": {"user": {"login": "hendrikmuhs", "name": "Hendrik Muhs"}}, "url": "https://github.com/elastic/elasticsearch/commit/bb28ef9229feee9cdd0f98f462b810c25845b909", "committedDate": "2021-01-20T10:42:07Z", "message": "add last_searched_at field"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "28c0fffd8513e65d89564b9e53e85c6415419134", "author": {"user": {"login": "hendrikmuhs", "name": "Hendrik Muhs"}}, "url": "https://github.com/elastic/elasticsearch/commit/28c0fffd8513e65d89564b9e53e85c6415419134", "committedDate": "2021-01-20T10:42:07Z", "message": "spotless"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2c82086ebde7456bea86043e42015702724a5fb6", "author": {"user": {"login": "hendrikmuhs", "name": "Hendrik Muhs"}}, "url": "https://github.com/elastic/elasticsearch/commit/2c82086ebde7456bea86043e42015702724a5fb6", "committedDate": "2021-01-20T10:42:07Z", "message": "fix tests and unmute HistogramGroupByIT"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cd71929aec0929df22a3ef2d15a0e98bd2212dc3", "author": {"user": {"login": "hendrikmuhs", "name": "Hendrik Muhs"}}, "url": "https://github.com/elastic/elasticsearch/commit/cd71929aec0929df22a3ef2d15a0e98bd2212dc3", "committedDate": "2021-01-20T10:42:08Z", "message": "change naming to last_search_time"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b2bd358dbdb7bebc8eac9ea15b13ba69a4d9b061", "author": {"user": {"login": "hendrikmuhs", "name": "Hendrik Muhs"}}, "url": "https://github.com/elastic/elasticsearch/commit/b2bd358dbdb7bebc8eac9ea15b13ba69a4d9b061", "committedDate": "2021-01-20T10:42:08Z", "message": "fix some more namings"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a2a11acc2d22c73bfafe859b3a584ce92d2d62cb", "author": {"user": {"login": "hendrikmuhs", "name": "Hendrik Muhs"}}, "url": "https://github.com/elastic/elasticsearch/commit/a2a11acc2d22c73bfafe859b3a584ce92d2d62cb", "committedDate": "2021-01-20T10:42:08Z", "message": "fix namings again"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "17854c8c33161d6f6e9760a68a5ad6ce776c8ce3", "author": {"user": {"login": "hendrikmuhs", "name": "Hendrik Muhs"}}, "url": "https://github.com/elastic/elasticsearch/commit/17854c8c33161d6f6e9760a68a5ad6ce776c8ce3", "committedDate": "2021-01-20T10:42:08Z", "message": "remove outdated comment"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b456f2371a32af4a5edb9a1590fdc39fb5d4f023", "author": {"user": {"login": "hendrikmuhs", "name": "Hendrik Muhs"}}, "url": "https://github.com/elastic/elasticsearch/commit/b456f2371a32af4a5edb9a1590fdc39fb5d4f023", "committedDate": "2021-01-20T10:09:02Z", "message": "remove outdated comment"}, "afterCommit": {"oid": "17854c8c33161d6f6e9760a68a5ad6ce776c8ce3", "author": {"user": {"login": "hendrikmuhs", "name": "Hendrik Muhs"}}, "url": "https://github.com/elastic/elasticsearch/commit/17854c8c33161d6f6e9760a68a5ad6ce776c8ce3", "committedDate": "2021-01-20T10:42:08Z", "message": "remove outdated comment"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4290, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}