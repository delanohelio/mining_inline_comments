{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk2OTIzMDQ2", "number": 54572, "reviewThreads": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMlQxODozNjoyMVrODuFKfw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMFQwOToyOTowNlrODzom0g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ5NjQ1Njk1OnYy", "diffSide": "RIGHT", "path": "modules/rest-compatibility/src/main/java/org/elasticsearch/rest/action/document/RestMultiTermVectorsActionV7.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMlQxODozNjoyMVrOF_4bfg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wM1QwNjo1NToxMlrOGAHN3A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjUyOTE1MA==", "bodyText": "should the the above non-typed endpoints be here ?  Shouldn't the this error trying to register the route ?", "url": "https://github.com/elastic/elasticsearch/pull/54572#discussion_r402529150", "createdAt": "2020-04-02T18:36:21Z", "author": {"login": "jakelandis"}, "path": "modules/rest-compatibility/src/main/java/org/elasticsearch/rest/action/document/RestMultiTermVectorsActionV7.java", "diffHunk": "@@ -0,0 +1,76 @@\n+/*\n+ * Licensed to Elasticsearch under one or more contributor\n+ * license agreements. See the NOTICE file distributed with\n+ * this work for additional information regarding copyright\n+ * ownership. Elasticsearch licenses this file to you under\n+ * the Apache License, Version 2.0 (the \"License\"); you may\n+ * not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.elasticsearch.rest.action.document;\n+\n+import org.apache.logging.log4j.LogManager;\n+import org.elasticsearch.Version;\n+import org.elasticsearch.action.termvectors.MultiTermVectorsRequest;\n+import org.elasticsearch.action.termvectors.TermVectorsRequest;\n+import org.elasticsearch.client.node.NodeClient;\n+import org.elasticsearch.common.Strings;\n+import org.elasticsearch.common.logging.DeprecationLogger;\n+import org.elasticsearch.compat.TypeConsumer;\n+import org.elasticsearch.rest.RestRequest;\n+import org.elasticsearch.rest.action.RestToXContentListener;\n+\n+import java.io.IOException;\n+import java.util.List;\n+\n+import static org.elasticsearch.rest.RestRequest.Method.GET;\n+import static org.elasticsearch.rest.RestRequest.Method.POST;\n+\n+public class RestMultiTermVectorsActionV7 extends RestMultiTermVectorsAction {\n+    private static final DeprecationLogger deprecationLogger = new DeprecationLogger(LogManager.getLogger(RestTermVectorsAction.class));\n+    static final String TYPES_DEPRECATION_MESSAGE = \"[types removal] \" + \"Specifying types in multi term vector requests is deprecated.\";\n+\n+    @Override\n+    public List<Route> routes() {\n+        return List.of(new Route(GET, \"/_mtermvectors\"),\n+            new Route(POST, \"/_mtermvectors\"),\n+            new Route(GET, \"/{index}/_mtermvectors\"),\n+            new Route(POST, \"/{index}/_mtermvectors\"),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6184a9d07d97fb884601af6c0bb05b910b2e04c5"}, "originalPosition": 48}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjc3MTQyMA==", "bodyText": "we allow registering same method and path but under different version. (if someone tried to register same method and path and version twice - it would end with error)\nWe need this because multi term vectors (and most multi-* api) can have a type in a body. So a typed request can be send via non-typed endpoint.", "url": "https://github.com/elastic/elasticsearch/pull/54572#discussion_r402771420", "createdAt": "2020-04-03T06:55:12Z", "author": {"login": "pgomulka"}, "path": "modules/rest-compatibility/src/main/java/org/elasticsearch/rest/action/document/RestMultiTermVectorsActionV7.java", "diffHunk": "@@ -0,0 +1,76 @@\n+/*\n+ * Licensed to Elasticsearch under one or more contributor\n+ * license agreements. See the NOTICE file distributed with\n+ * this work for additional information regarding copyright\n+ * ownership. Elasticsearch licenses this file to you under\n+ * the Apache License, Version 2.0 (the \"License\"); you may\n+ * not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.elasticsearch.rest.action.document;\n+\n+import org.apache.logging.log4j.LogManager;\n+import org.elasticsearch.Version;\n+import org.elasticsearch.action.termvectors.MultiTermVectorsRequest;\n+import org.elasticsearch.action.termvectors.TermVectorsRequest;\n+import org.elasticsearch.client.node.NodeClient;\n+import org.elasticsearch.common.Strings;\n+import org.elasticsearch.common.logging.DeprecationLogger;\n+import org.elasticsearch.compat.TypeConsumer;\n+import org.elasticsearch.rest.RestRequest;\n+import org.elasticsearch.rest.action.RestToXContentListener;\n+\n+import java.io.IOException;\n+import java.util.List;\n+\n+import static org.elasticsearch.rest.RestRequest.Method.GET;\n+import static org.elasticsearch.rest.RestRequest.Method.POST;\n+\n+public class RestMultiTermVectorsActionV7 extends RestMultiTermVectorsAction {\n+    private static final DeprecationLogger deprecationLogger = new DeprecationLogger(LogManager.getLogger(RestTermVectorsAction.class));\n+    static final String TYPES_DEPRECATION_MESSAGE = \"[types removal] \" + \"Specifying types in multi term vector requests is deprecated.\";\n+\n+    @Override\n+    public List<Route> routes() {\n+        return List.of(new Route(GET, \"/_mtermvectors\"),\n+            new Route(POST, \"/_mtermvectors\"),\n+            new Route(GET, \"/{index}/_mtermvectors\"),\n+            new Route(POST, \"/{index}/_mtermvectors\"),", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjUyOTE1MA=="}, "originalCommit": {"oid": "6184a9d07d97fb884601af6c0bb05b910b2e04c5"}, "originalPosition": 48}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ5NjQ3ODYxOnYy", "diffSide": "RIGHT", "path": "modules/lang-mustache/src/main/java/org/elasticsearch/script/mustache/RestMultiSearchTemplateAction.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMlQxODo0MjoyOVrOF_4pTw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wM1QwNjo1NzoxN1rOGAHRLQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjUzMjY4Nw==", "bodyText": "can this be re-named keyAllowed ? (or the like)\nA function used to validate if a provided xContent key is allowed. This is useful for xContent compatibility to determine if a key is allowed to be present in version agnostic manner. The provided function should return false if the key is not allowed. \n\n(it is does not use the Consumer interface, and I believe it more general purpose then the just for types)", "url": "https://github.com/elastic/elasticsearch/pull/54572#discussion_r402532687", "createdAt": "2020-04-02T18:42:29Z", "author": {"login": "jakelandis"}, "path": "modules/lang-mustache/src/main/java/org/elasticsearch/script/mustache/RestMultiSearchTemplateAction.java", "diffHunk": "@@ -79,6 +80,18 @@ public RestChannelConsumer prepareRequest(RestRequest request, NodeClient client\n      * Parses a {@link RestRequest} body and returns a {@link MultiSearchTemplateRequest}\n      */\n     public static MultiSearchTemplateRequest parseRequest(RestRequest restRequest, boolean allowExplicitIndex) throws IOException {\n+        return parseRequest(restRequest,allowExplicitIndex, k->false);\n+    }\n+\n+    /**\n+     * Parses a {@link RestRequest} body and returns a {@link MultiSearchTemplateRequest}\n+     * @param typeConsumer - is a function used when parsing a request body. if it contains a types field it will consume it,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6184a9d07d97fb884601af6c0bb05b910b2e04c5"}, "originalPosition": 26}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjc3MjI2OQ==", "bodyText": "good idea, I wasn't sure typeConsumer was right as it was just too specific for type removal eample.\nWill rename and update javadoc", "url": "https://github.com/elastic/elasticsearch/pull/54572#discussion_r402772269", "createdAt": "2020-04-03T06:57:17Z", "author": {"login": "pgomulka"}, "path": "modules/lang-mustache/src/main/java/org/elasticsearch/script/mustache/RestMultiSearchTemplateAction.java", "diffHunk": "@@ -79,6 +80,18 @@ public RestChannelConsumer prepareRequest(RestRequest request, NodeClient client\n      * Parses a {@link RestRequest} body and returns a {@link MultiSearchTemplateRequest}\n      */\n     public static MultiSearchTemplateRequest parseRequest(RestRequest restRequest, boolean allowExplicitIndex) throws IOException {\n+        return parseRequest(restRequest,allowExplicitIndex, k->false);\n+    }\n+\n+    /**\n+     * Parses a {@link RestRequest} body and returns a {@link MultiSearchTemplateRequest}\n+     * @param typeConsumer - is a function used when parsing a request body. if it contains a types field it will consume it,", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjUzMjY4Nw=="}, "originalCommit": {"oid": "6184a9d07d97fb884601af6c0bb05b910b2e04c5"}, "originalPosition": 26}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ5NjU4MzE1OnYy", "diffSide": "RIGHT", "path": "modules/rest-compatibility/src/main/java/org/elasticsearch/compat/TypeConsumer.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMlQxOToxMTo1MVrOF_5sxA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNVQxMTozNjoxOVrOGWBQUg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjU0OTk1Ng==", "bodyText": "I think this class has a couple problems...\nit is named Consumer, but actually a Function with a side effect\nit requires an ordering between methods. (e.g. if you call hasTypes can yield different results then calling apply then hasTypes)\nhasTypes() method feels utility like, and apply is a pure function (which shouldn't have side effects even local to it's own class).\nCan we separate this into two classes , a utility class and pure function class. If you need to hold to the state returned by the function, whoever calls that function can take that responsibility.\nAlso, in tangent with my other comment on renaming the variable, I think the function class be be generalized as well KeyAllowed ?", "url": "https://github.com/elastic/elasticsearch/pull/54572#discussion_r402549956", "createdAt": "2020-04-02T19:11:51Z", "author": {"login": "jakelandis"}, "path": "modules/rest-compatibility/src/main/java/org/elasticsearch/compat/TypeConsumer.java", "diffHunk": "@@ -0,0 +1,53 @@\n+/*\n+ * Licensed to Elasticsearch under one or more contributor\n+ * license agreements. See the NOTICE file distributed with\n+ * this work for additional information regarding copyright\n+ * ownership. Elasticsearch licenses this file to you under\n+ * the Apache License, Version 2.0 (the \"License\"); you may\n+ * not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.elasticsearch.compat;\n+\n+import org.elasticsearch.common.Strings;\n+import org.elasticsearch.rest.RestRequest;\n+\n+import java.util.HashSet;\n+import java.util.Set;\n+import java.util.function.Function;\n+\n+public class TypeConsumer implements Function<String, Boolean> {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6184a9d07d97fb884601af6c0bb05b910b2e04c5"}, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjc5MDI4Nw==", "bodyText": "Agree - the name is not right. The consumer was an initial idea but it ended up a function and I didn't change it accordingly. The KeyAllowed also feels right to me.\nI am not sure I understand how to refactor this. My idea was that the typeConsumer object being created at the V7 layer and passed down to v8 code can bubble up the state (information if type was found) back to v7 layer. Allowing the code to take action (most of the time just deprecation warning) to be present in v7 layer.\nThe apply() method was meant to serve two functions. Retrieve and store the information for v7 layer if the type was found. And to tell v8 code that the key was allowed and exception when parsing is not necessary.\nI also agree that side effect is probably unexpected. The TypeConsumer is visible as just a Function in v8 layer, so noone looking just at code which uses it would expect side effects.\nIf we have two classes, that would mean we would need to pass down two objects down to v8 layer?", "url": "https://github.com/elastic/elasticsearch/pull/54572#discussion_r402790287", "createdAt": "2020-04-03T07:36:07Z", "author": {"login": "pgomulka"}, "path": "modules/rest-compatibility/src/main/java/org/elasticsearch/compat/TypeConsumer.java", "diffHunk": "@@ -0,0 +1,53 @@\n+/*\n+ * Licensed to Elasticsearch under one or more contributor\n+ * license agreements. See the NOTICE file distributed with\n+ * this work for additional information regarding copyright\n+ * ownership. Elasticsearch licenses this file to you under\n+ * the Apache License, Version 2.0 (the \"License\"); you may\n+ * not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.elasticsearch.compat;\n+\n+import org.elasticsearch.common.Strings;\n+import org.elasticsearch.rest.RestRequest;\n+\n+import java.util.HashSet;\n+import java.util.Set;\n+import java.util.function.Function;\n+\n+public class TypeConsumer implements Function<String, Boolean> {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjU0OTk1Ng=="}, "originalCommit": {"oid": "6184a9d07d97fb884601af6c0bb05b910b2e04c5"}, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTc0MjQxOA==", "bodyText": "@jakelandis I think this is the main issue on that PR.\nWe can split this in two functions\n\nKeyAllowed<String,Boolean> - a function returning true if a string is of allowed value (_type, types etc) false otherwise. This will then be pass down into a Request parsing logic - i.e. https://github.com/elastic/elasticsearch/blob/master/server/src/main/java/org/elasticsearch/action/termvectors/TermVectorsRequest.java#L588\nsecond class - not sure about this one.. we need to go down from v7 rest layer to the same place where a request is parsed (v8 code).\nI understand that it is not obvious that a function would has a state. But from the parsing point of view it wouldn't matter. All it care in TermVectorsRequest.java#L588 is if the field is allowed. The state if the field occurred (type for that example) is only relevant in v7 code where a class can be used directly (not by the Function interface)\n\nIf we were to have a utility class it would have live within some common to all modules utility module. That would not be ideal I guess.\nWe could refactor hasTypes to be a utility that is consuming the function that was passed down. But I am not sure this would benefit much (except from solving the ordering)\nAnyways I think I might be missing something in your idea of splitting this class into two. Can you please give more details?", "url": "https://github.com/elastic/elasticsearch/pull/54572#discussion_r425742418", "createdAt": "2020-05-15T11:36:19Z", "author": {"login": "pgomulka"}, "path": "modules/rest-compatibility/src/main/java/org/elasticsearch/compat/TypeConsumer.java", "diffHunk": "@@ -0,0 +1,53 @@\n+/*\n+ * Licensed to Elasticsearch under one or more contributor\n+ * license agreements. See the NOTICE file distributed with\n+ * this work for additional information regarding copyright\n+ * ownership. Elasticsearch licenses this file to you under\n+ * the Apache License, Version 2.0 (the \"License\"); you may\n+ * not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.elasticsearch.compat;\n+\n+import org.elasticsearch.common.Strings;\n+import org.elasticsearch.rest.RestRequest;\n+\n+import java.util.HashSet;\n+import java.util.Set;\n+import java.util.function.Function;\n+\n+public class TypeConsumer implements Function<String, Boolean> {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjU0OTk1Ng=="}, "originalCommit": {"oid": "6184a9d07d97fb884601af6c0bb05b910b2e04c5"}, "originalPosition": 29}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ5NjU5NTY3OnYy", "diffSide": "RIGHT", "path": "modules/rest-compatibility/src/main/java/org/elasticsearch/index/reindex/RestDeleteByQueryActionV7.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMlQxOToxNToyMVrOF_504g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wM1QwNjo1ODo0NlrOGAHT0A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjU1MjAzNA==", "bodyText": "Do you plan another round of PRs to issue deprecation and compatibility warnings ?", "url": "https://github.com/elastic/elasticsearch/pull/54572#discussion_r402552034", "createdAt": "2020-04-02T19:15:21Z", "author": {"login": "jakelandis"}, "path": "modules/rest-compatibility/src/main/java/org/elasticsearch/index/reindex/RestDeleteByQueryActionV7.java", "diffHunk": "@@ -0,0 +1,47 @@\n+/*\n+ * Licensed to Elasticsearch under one or more contributor\n+ * license agreements. See the NOTICE file distributed with\n+ * this work for additional information regarding copyright\n+ * ownership. Elasticsearch licenses this file to you under\n+ * the Apache License, Version 2.0 (the \"License\"); you may\n+ * not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.elasticsearch.index.reindex;\n+\n+import org.elasticsearch.Version;\n+import org.elasticsearch.client.node.NodeClient;\n+import org.elasticsearch.rest.RestRequest;\n+\n+import java.io.IOException;\n+import java.util.List;\n+\n+import static org.elasticsearch.rest.RestRequest.Method.POST;\n+\n+public class RestDeleteByQueryActionV7 extends RestDeleteByQueryAction {\n+    @Override\n+    public List<Route> routes() {\n+        return List.of(new Route(POST, \"/{index}/{type}/_delete_by_query\"));\n+    }\n+\n+    @Override\n+    public String compatibleWithVersion() {\n+        return String.valueOf(Version.V_7_0_0.major);\n+    }\n+\n+    @Override\n+    public RestChannelConsumer prepareRequest(RestRequest request, NodeClient client) throws IOException {\n+        request.param(\"type\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6184a9d07d97fb884601af6c0bb05b910b2e04c5"}, "originalPosition": 44}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjc3Mjk0NA==", "bodyText": "I think it would be good to include this in this PR too, so we could consider these API complete. Will revisit.", "url": "https://github.com/elastic/elasticsearch/pull/54572#discussion_r402772944", "createdAt": "2020-04-03T06:58:46Z", "author": {"login": "pgomulka"}, "path": "modules/rest-compatibility/src/main/java/org/elasticsearch/index/reindex/RestDeleteByQueryActionV7.java", "diffHunk": "@@ -0,0 +1,47 @@\n+/*\n+ * Licensed to Elasticsearch under one or more contributor\n+ * license agreements. See the NOTICE file distributed with\n+ * this work for additional information regarding copyright\n+ * ownership. Elasticsearch licenses this file to you under\n+ * the Apache License, Version 2.0 (the \"License\"); you may\n+ * not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.elasticsearch.index.reindex;\n+\n+import org.elasticsearch.Version;\n+import org.elasticsearch.client.node.NodeClient;\n+import org.elasticsearch.rest.RestRequest;\n+\n+import java.io.IOException;\n+import java.util.List;\n+\n+import static org.elasticsearch.rest.RestRequest.Method.POST;\n+\n+public class RestDeleteByQueryActionV7 extends RestDeleteByQueryAction {\n+    @Override\n+    public List<Route> routes() {\n+        return List.of(new Route(POST, \"/{index}/{type}/_delete_by_query\"));\n+    }\n+\n+    @Override\n+    public String compatibleWithVersion() {\n+        return String.valueOf(Version.V_7_0_0.major);\n+    }\n+\n+    @Override\n+    public RestChannelConsumer prepareRequest(RestRequest request, NodeClient client) throws IOException {\n+        request.param(\"type\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjU1MjAzNA=="}, "originalCommit": {"oid": "6184a9d07d97fb884601af6c0bb05b910b2e04c5"}, "originalPosition": 44}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ5NjU5OTA2OnYy", "diffSide": "RIGHT", "path": "modules/rest-compatibility/src/main/java/org/elasticsearch/rest/action/document/RestTermVectorsActionV7.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMlQxOToxNjoyMlrOF_53GA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wM1QwNzowMDoyNlrOGAHWtA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjU1MjYwMA==", "bodyText": "are the non-typed endpoints needed ?", "url": "https://github.com/elastic/elasticsearch/pull/54572#discussion_r402552600", "createdAt": "2020-04-02T19:16:22Z", "author": {"login": "jakelandis"}, "path": "modules/rest-compatibility/src/main/java/org/elasticsearch/rest/action/document/RestTermVectorsActionV7.java", "diffHunk": "@@ -0,0 +1,84 @@\n+/*\n+ * Licensed to Elasticsearch under one or more contributor\n+ * license agreements. See the NOTICE file distributed with\n+ * this work for additional information regarding copyright\n+ * ownership. Elasticsearch licenses this file to you under\n+ * the Apache License, Version 2.0 (the \"License\"); you may\n+ * not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.elasticsearch.rest.action.document;\n+\n+import org.apache.logging.log4j.LogManager;\n+import org.elasticsearch.Version;\n+import org.elasticsearch.action.termvectors.TermVectorsRequest;\n+import org.elasticsearch.client.node.NodeClient;\n+import org.elasticsearch.common.logging.DeprecationLogger;\n+import org.elasticsearch.common.xcontent.XContentParser;\n+import org.elasticsearch.compat.TypeConsumer;\n+import org.elasticsearch.rest.RestRequest;\n+import org.elasticsearch.rest.action.RestToXContentListener;\n+\n+import java.io.IOException;\n+import java.util.List;\n+\n+import static org.elasticsearch.rest.RestRequest.Method.GET;\n+import static org.elasticsearch.rest.RestRequest.Method.POST;\n+\n+public class RestTermVectorsActionV7 extends RestTermVectorsAction {\n+    private static final DeprecationLogger deprecationLogger = new DeprecationLogger(LogManager.getLogger(RestTermVectorsAction.class));\n+    public static final String TYPES_DEPRECATION_MESSAGE = \"[types removal] \" + \"Specifying types in term vector requests is deprecated.\";\n+\n+    @Override\n+    public List<Route> routes() {\n+        return List.of(\n+            new Route(GET, \"/{index}/_termvectors\"),\n+            new Route(POST, \"/{index}/_termvectors\"),\n+            new Route(GET, \"/{index}/_termvectors/{id}\"),\n+            new Route(POST, \"/{index}/_termvectors/{id}\"),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6184a9d07d97fb884601af6c0bb05b910b2e04c5"}, "originalPosition": 48}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjc3MzY4NA==", "bodyText": "this one also can expect a type in a body for all these paths (even non-typed) - hence it is using TypeConsumer (to be renamed).", "url": "https://github.com/elastic/elasticsearch/pull/54572#discussion_r402773684", "createdAt": "2020-04-03T07:00:26Z", "author": {"login": "pgomulka"}, "path": "modules/rest-compatibility/src/main/java/org/elasticsearch/rest/action/document/RestTermVectorsActionV7.java", "diffHunk": "@@ -0,0 +1,84 @@\n+/*\n+ * Licensed to Elasticsearch under one or more contributor\n+ * license agreements. See the NOTICE file distributed with\n+ * this work for additional information regarding copyright\n+ * ownership. Elasticsearch licenses this file to you under\n+ * the Apache License, Version 2.0 (the \"License\"); you may\n+ * not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.elasticsearch.rest.action.document;\n+\n+import org.apache.logging.log4j.LogManager;\n+import org.elasticsearch.Version;\n+import org.elasticsearch.action.termvectors.TermVectorsRequest;\n+import org.elasticsearch.client.node.NodeClient;\n+import org.elasticsearch.common.logging.DeprecationLogger;\n+import org.elasticsearch.common.xcontent.XContentParser;\n+import org.elasticsearch.compat.TypeConsumer;\n+import org.elasticsearch.rest.RestRequest;\n+import org.elasticsearch.rest.action.RestToXContentListener;\n+\n+import java.io.IOException;\n+import java.util.List;\n+\n+import static org.elasticsearch.rest.RestRequest.Method.GET;\n+import static org.elasticsearch.rest.RestRequest.Method.POST;\n+\n+public class RestTermVectorsActionV7 extends RestTermVectorsAction {\n+    private static final DeprecationLogger deprecationLogger = new DeprecationLogger(LogManager.getLogger(RestTermVectorsAction.class));\n+    public static final String TYPES_DEPRECATION_MESSAGE = \"[types removal] \" + \"Specifying types in term vector requests is deprecated.\";\n+\n+    @Override\n+    public List<Route> routes() {\n+        return List.of(\n+            new Route(GET, \"/{index}/_termvectors\"),\n+            new Route(POST, \"/{index}/_termvectors\"),\n+            new Route(GET, \"/{index}/_termvectors/{id}\"),\n+            new Route(POST, \"/{index}/_termvectors/{id}\"),", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjU1MjYwMA=="}, "originalCommit": {"oid": "6184a9d07d97fb884601af6c0bb05b910b2e04c5"}, "originalPosition": 48}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ5NjYwMzgzOnYy", "diffSide": "RIGHT", "path": "modules/rest-compatibility/src/main/java/org/elasticsearch/rest/action/document/RestTermVectorsActionV7.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMlQxOToxNzo0OVrOF_56IA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMlQxOToxNzo0OVrOF_56IA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjU1MzM3Ng==", "bodyText": "If you move hasTypes a static method in a utility class, maybe we can push this logic (consume the type and log) there ?", "url": "https://github.com/elastic/elasticsearch/pull/54572#discussion_r402553376", "createdAt": "2020-04-02T19:17:49Z", "author": {"login": "jakelandis"}, "path": "modules/rest-compatibility/src/main/java/org/elasticsearch/rest/action/document/RestTermVectorsActionV7.java", "diffHunk": "@@ -0,0 +1,84 @@\n+/*\n+ * Licensed to Elasticsearch under one or more contributor\n+ * license agreements. See the NOTICE file distributed with\n+ * this work for additional information regarding copyright\n+ * ownership. Elasticsearch licenses this file to you under\n+ * the Apache License, Version 2.0 (the \"License\"); you may\n+ * not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.elasticsearch.rest.action.document;\n+\n+import org.apache.logging.log4j.LogManager;\n+import org.elasticsearch.Version;\n+import org.elasticsearch.action.termvectors.TermVectorsRequest;\n+import org.elasticsearch.client.node.NodeClient;\n+import org.elasticsearch.common.logging.DeprecationLogger;\n+import org.elasticsearch.common.xcontent.XContentParser;\n+import org.elasticsearch.compat.TypeConsumer;\n+import org.elasticsearch.rest.RestRequest;\n+import org.elasticsearch.rest.action.RestToXContentListener;\n+\n+import java.io.IOException;\n+import java.util.List;\n+\n+import static org.elasticsearch.rest.RestRequest.Method.GET;\n+import static org.elasticsearch.rest.RestRequest.Method.POST;\n+\n+public class RestTermVectorsActionV7 extends RestTermVectorsAction {\n+    private static final DeprecationLogger deprecationLogger = new DeprecationLogger(LogManager.getLogger(RestTermVectorsAction.class));\n+    public static final String TYPES_DEPRECATION_MESSAGE = \"[types removal] \" + \"Specifying types in term vector requests is deprecated.\";\n+\n+    @Override\n+    public List<Route> routes() {\n+        return List.of(\n+            new Route(GET, \"/{index}/_termvectors\"),\n+            new Route(POST, \"/{index}/_termvectors\"),\n+            new Route(GET, \"/{index}/_termvectors/{id}\"),\n+            new Route(POST, \"/{index}/_termvectors/{id}\"),\n+            // Deprecated typed endpoints.\n+            new Route(GET, \"/{index}/{type}/_termvectors\"),\n+            new Route(POST, \"/{index}/{type}/_termvectors\"),\n+            new Route(GET, \"/{index}/{type}/{id}/_termvectors\"),\n+            new Route(POST, \"/{index}/{type}/{id}/_termvectors\")\n+        );\n+    }\n+\n+    @Override\n+    public String compatibleWithVersion() {\n+        return String.valueOf(Version.V_7_0_0.major);\n+    }\n+\n+    @Override\n+    public RestChannelConsumer prepareRequest(final RestRequest request, final NodeClient client) throws IOException {\n+        TypeConsumer typeConsumer = new TypeConsumer(request,\"_type\");\n+\n+        TermVectorsRequest termVectorsRequest = new TermVectorsRequest(request.param(\"index\"), request.param(\"id\"));\n+\n+        if (request.hasContentOrSourceParam()) {\n+            try (XContentParser parser = request.contentOrSourceParamParser()) {\n+                TermVectorsRequest.parseRequest(termVectorsRequest, parser, typeConsumer);\n+            }\n+        }\n+        readURIParameters(termVectorsRequest, request);\n+\n+        if (typeConsumer.hasTypes()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6184a9d07d97fb884601af6c0bb05b910b2e04c5"}, "originalPosition": 75}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ5NjYwNDc3OnYy", "diffSide": "RIGHT", "path": "modules/rest-compatibility/src/main/java/org/elasticsearch/rest/action/search/RestMultiSearchActionV7.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMlQxOToxODowOVrOF_56wQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wM1QwNzowMTowOFrOGAHXuA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjU1MzUzNw==", "bodyText": "are the non-typed end points needed ?", "url": "https://github.com/elastic/elasticsearch/pull/54572#discussion_r402553537", "createdAt": "2020-04-02T19:18:09Z", "author": {"login": "jakelandis"}, "path": "modules/rest-compatibility/src/main/java/org/elasticsearch/rest/action/search/RestMultiSearchActionV7.java", "diffHunk": "@@ -0,0 +1,76 @@\n+/*\n+ * Licensed to Elasticsearch under one or more contributor\n+ * license agreements. See the NOTICE file distributed with\n+ * this work for additional information regarding copyright\n+ * ownership. Elasticsearch licenses this file to you under\n+ * the Apache License, Version 2.0 (the \"License\"); you may\n+ * not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.elasticsearch.rest.action.search;\n+\n+import org.apache.logging.log4j.LogManager;\n+import org.elasticsearch.compat.TypeConsumer;\n+import org.elasticsearch.Version;\n+import org.elasticsearch.action.search.MultiSearchRequest;\n+import org.elasticsearch.client.node.NodeClient;\n+import org.elasticsearch.common.logging.DeprecationLogger;\n+import org.elasticsearch.common.settings.Settings;\n+import org.elasticsearch.rest.RestRequest;\n+import org.elasticsearch.rest.action.RestToXContentListener;\n+\n+import java.io.IOException;\n+import java.util.List;\n+\n+import static org.elasticsearch.rest.RestRequest.Method.GET;\n+import static org.elasticsearch.rest.RestRequest.Method.POST;\n+\n+public class RestMultiSearchActionV7 extends RestMultiSearchAction {\n+    private static final DeprecationLogger deprecationLogger = new DeprecationLogger(LogManager.getLogger(RestMultiSearchAction.class));\n+    static final String TYPES_DEPRECATION_MESSAGE = \"[types removal]\" + \" Specifying types in multi search requests is deprecated.\";\n+\n+    public RestMultiSearchActionV7(Settings settings) {\n+        super(settings);\n+    }\n+\n+    @Override\n+    public String compatibleWithVersion() {\n+        return String.valueOf(Version.V_7_0_0.major);\n+    }\n+\n+    @Override\n+    public List<Route> routes() {\n+        return List.of(\n+            new Route(GET, \"/_msearch\"),\n+            new Route(POST, \"/_msearch\"),\n+            new Route(GET, \"/{index}/_msearch\"),\n+            new Route(POST, \"/{index}/_msearch\"),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6184a9d07d97fb884601af6c0bb05b910b2e04c5"}, "originalPosition": 57}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjc3Mzk0NA==", "bodyText": "as per previous comments - type is present in a body", "url": "https://github.com/elastic/elasticsearch/pull/54572#discussion_r402773944", "createdAt": "2020-04-03T07:01:08Z", "author": {"login": "pgomulka"}, "path": "modules/rest-compatibility/src/main/java/org/elasticsearch/rest/action/search/RestMultiSearchActionV7.java", "diffHunk": "@@ -0,0 +1,76 @@\n+/*\n+ * Licensed to Elasticsearch under one or more contributor\n+ * license agreements. See the NOTICE file distributed with\n+ * this work for additional information regarding copyright\n+ * ownership. Elasticsearch licenses this file to you under\n+ * the Apache License, Version 2.0 (the \"License\"); you may\n+ * not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.elasticsearch.rest.action.search;\n+\n+import org.apache.logging.log4j.LogManager;\n+import org.elasticsearch.compat.TypeConsumer;\n+import org.elasticsearch.Version;\n+import org.elasticsearch.action.search.MultiSearchRequest;\n+import org.elasticsearch.client.node.NodeClient;\n+import org.elasticsearch.common.logging.DeprecationLogger;\n+import org.elasticsearch.common.settings.Settings;\n+import org.elasticsearch.rest.RestRequest;\n+import org.elasticsearch.rest.action.RestToXContentListener;\n+\n+import java.io.IOException;\n+import java.util.List;\n+\n+import static org.elasticsearch.rest.RestRequest.Method.GET;\n+import static org.elasticsearch.rest.RestRequest.Method.POST;\n+\n+public class RestMultiSearchActionV7 extends RestMultiSearchAction {\n+    private static final DeprecationLogger deprecationLogger = new DeprecationLogger(LogManager.getLogger(RestMultiSearchAction.class));\n+    static final String TYPES_DEPRECATION_MESSAGE = \"[types removal]\" + \" Specifying types in multi search requests is deprecated.\";\n+\n+    public RestMultiSearchActionV7(Settings settings) {\n+        super(settings);\n+    }\n+\n+    @Override\n+    public String compatibleWithVersion() {\n+        return String.valueOf(Version.V_7_0_0.major);\n+    }\n+\n+    @Override\n+    public List<Route> routes() {\n+        return List.of(\n+            new Route(GET, \"/_msearch\"),\n+            new Route(POST, \"/_msearch\"),\n+            new Route(GET, \"/{index}/_msearch\"),\n+            new Route(POST, \"/{index}/_msearch\"),", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjU1MzUzNw=="}, "originalCommit": {"oid": "6184a9d07d97fb884601af6c0bb05b910b2e04c5"}, "originalPosition": 57}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ5NjYwNjExOnYy", "diffSide": "RIGHT", "path": "modules/rest-compatibility/src/main/java/org/elasticsearch/rest/action/search/RestSearchActionV7.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMlQxOToxODoyN1rOF_57gQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wM1QwNzowNToyNVrOGAHeag==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjU1MzcyOQ==", "bodyText": "non-typed endpoints ?", "url": "https://github.com/elastic/elasticsearch/pull/54572#discussion_r402553729", "createdAt": "2020-04-02T19:18:27Z", "author": {"login": "jakelandis"}, "path": "modules/rest-compatibility/src/main/java/org/elasticsearch/rest/action/search/RestSearchActionV7.java", "diffHunk": "@@ -0,0 +1,65 @@\n+/*\n+ * Licensed to Elasticsearch under one or more contributor\n+ * license agreements. See the NOTICE file distributed with\n+ * this work for additional information regarding copyright\n+ * ownership. Elasticsearch licenses this file to you under\n+ * the Apache License, Version 2.0 (the \"License\"); you may\n+ * not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.elasticsearch.rest.action.search;\n+\n+import org.apache.logging.log4j.LogManager;\n+import org.elasticsearch.Version;\n+import org.elasticsearch.client.node.NodeClient;\n+import org.elasticsearch.common.logging.DeprecationLogger;\n+import org.elasticsearch.rest.RestRequest;\n+\n+import java.io.IOException;\n+import java.util.List;\n+\n+import static org.elasticsearch.rest.RestRequest.Method.GET;\n+import static org.elasticsearch.rest.RestRequest.Method.POST;\n+\n+public class RestSearchActionV7 extends RestSearchAction {\n+    public static final String INCLUDE_TYPE_NAME_PARAMETER = \"include_type_name\";\n+    public static final String TYPES_DEPRECATION_MESSAGE = \"[types removal]\" + \" Specifying types in search requests is deprecated.\";\n+\n+    private static final DeprecationLogger deprecationLogger = new DeprecationLogger(LogManager.getLogger(RestSearchAction.class));\n+\n+    @Override\n+    public List<Route> routes() {\n+        return List.of(\n+            new Route(GET, \"/_search\"),\n+            new Route(POST, \"/_search\"),\n+            new Route(GET, \"/{index}/_search\"),\n+            new Route(POST, \"/{index}/_search\"),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6184a9d07d97fb884601af6c0bb05b910b2e04c5"}, "originalPosition": 46}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjc3NTQ2OA==", "bodyText": "type can be present as a parameter in v7 (as well as in a path for typed endpoints)", "url": "https://github.com/elastic/elasticsearch/pull/54572#discussion_r402775468", "createdAt": "2020-04-03T07:04:57Z", "author": {"login": "pgomulka"}, "path": "modules/rest-compatibility/src/main/java/org/elasticsearch/rest/action/search/RestSearchActionV7.java", "diffHunk": "@@ -0,0 +1,65 @@\n+/*\n+ * Licensed to Elasticsearch under one or more contributor\n+ * license agreements. See the NOTICE file distributed with\n+ * this work for additional information regarding copyright\n+ * ownership. Elasticsearch licenses this file to you under\n+ * the Apache License, Version 2.0 (the \"License\"); you may\n+ * not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.elasticsearch.rest.action.search;\n+\n+import org.apache.logging.log4j.LogManager;\n+import org.elasticsearch.Version;\n+import org.elasticsearch.client.node.NodeClient;\n+import org.elasticsearch.common.logging.DeprecationLogger;\n+import org.elasticsearch.rest.RestRequest;\n+\n+import java.io.IOException;\n+import java.util.List;\n+\n+import static org.elasticsearch.rest.RestRequest.Method.GET;\n+import static org.elasticsearch.rest.RestRequest.Method.POST;\n+\n+public class RestSearchActionV7 extends RestSearchAction {\n+    public static final String INCLUDE_TYPE_NAME_PARAMETER = \"include_type_name\";\n+    public static final String TYPES_DEPRECATION_MESSAGE = \"[types removal]\" + \" Specifying types in search requests is deprecated.\";\n+\n+    private static final DeprecationLogger deprecationLogger = new DeprecationLogger(LogManager.getLogger(RestSearchAction.class));\n+\n+    @Override\n+    public List<Route> routes() {\n+        return List.of(\n+            new Route(GET, \"/_search\"),\n+            new Route(POST, \"/_search\"),\n+            new Route(GET, \"/{index}/_search\"),\n+            new Route(POST, \"/{index}/_search\"),", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjU1MzcyOQ=="}, "originalCommit": {"oid": "6184a9d07d97fb884601af6c0bb05b910b2e04c5"}, "originalPosition": 46}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjc3NTY1OA==", "bodyText": "although I am now not sure about INCLUDE_TYPE_NAME_PARAMETER\nwill revisit", "url": "https://github.com/elastic/elasticsearch/pull/54572#discussion_r402775658", "createdAt": "2020-04-03T07:05:25Z", "author": {"login": "pgomulka"}, "path": "modules/rest-compatibility/src/main/java/org/elasticsearch/rest/action/search/RestSearchActionV7.java", "diffHunk": "@@ -0,0 +1,65 @@\n+/*\n+ * Licensed to Elasticsearch under one or more contributor\n+ * license agreements. See the NOTICE file distributed with\n+ * this work for additional information regarding copyright\n+ * ownership. Elasticsearch licenses this file to you under\n+ * the Apache License, Version 2.0 (the \"License\"); you may\n+ * not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.elasticsearch.rest.action.search;\n+\n+import org.apache.logging.log4j.LogManager;\n+import org.elasticsearch.Version;\n+import org.elasticsearch.client.node.NodeClient;\n+import org.elasticsearch.common.logging.DeprecationLogger;\n+import org.elasticsearch.rest.RestRequest;\n+\n+import java.io.IOException;\n+import java.util.List;\n+\n+import static org.elasticsearch.rest.RestRequest.Method.GET;\n+import static org.elasticsearch.rest.RestRequest.Method.POST;\n+\n+public class RestSearchActionV7 extends RestSearchAction {\n+    public static final String INCLUDE_TYPE_NAME_PARAMETER = \"include_type_name\";\n+    public static final String TYPES_DEPRECATION_MESSAGE = \"[types removal]\" + \" Specifying types in search requests is deprecated.\";\n+\n+    private static final DeprecationLogger deprecationLogger = new DeprecationLogger(LogManager.getLogger(RestSearchAction.class));\n+\n+    @Override\n+    public List<Route> routes() {\n+        return List.of(\n+            new Route(GET, \"/_search\"),\n+            new Route(POST, \"/_search\"),\n+            new Route(GET, \"/{index}/_search\"),\n+            new Route(POST, \"/{index}/_search\"),", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjU1MzcyOQ=="}, "originalCommit": {"oid": "6184a9d07d97fb884601af6c0bb05b910b2e04c5"}, "originalPosition": 46}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ5NjYxMDM5OnYy", "diffSide": "RIGHT", "path": "modules/rest-compatibility/src/main/java/org/elasticsearch/script/mustache/RestMultiSearchTemplateActionV7.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMlQxOToxOTo0MFrOF_5-NQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wM1QwNzowNTo1MFrOGAHfDA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjU1NDQyMQ==", "bodyText": "non-typed endpoints ?", "url": "https://github.com/elastic/elasticsearch/pull/54572#discussion_r402554421", "createdAt": "2020-04-02T19:19:40Z", "author": {"login": "jakelandis"}, "path": "modules/rest-compatibility/src/main/java/org/elasticsearch/script/mustache/RestMultiSearchTemplateActionV7.java", "diffHunk": "@@ -0,0 +1,113 @@\n+/*\n+ * Licensed to Elasticsearch under one or more contributor\n+ * license agreements. See the NOTICE file distributed with\n+ * this work for additional information regarding copyright\n+ * ownership. Elasticsearch licenses this file to you under\n+ * the Apache License, Version 2.0 (the \"License\"); you may\n+ * not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.elasticsearch.script.mustache;\n+\n+import org.apache.logging.log4j.LogManager;\n+import org.elasticsearch.compat.TypeConsumer;\n+import org.elasticsearch.Version;\n+import org.elasticsearch.client.node.NodeClient;\n+import org.elasticsearch.common.logging.DeprecationLogger;\n+import org.elasticsearch.common.settings.Settings;\n+import org.elasticsearch.rest.RestRequest;\n+import org.elasticsearch.rest.action.RestToXContentListener;\n+import org.elasticsearch.rest.action.search.RestMultiSearchAction;\n+import org.elasticsearch.rest.action.search.RestSearchAction;\n+\n+import java.io.IOException;\n+import java.util.List;\n+\n+import static org.elasticsearch.rest.RestRequest.Method.GET;\n+import static org.elasticsearch.rest.RestRequest.Method.POST;\n+\n+public class RestMultiSearchTemplateActionV7 extends RestMultiSearchTemplateAction {\n+    private static final DeprecationLogger deprecationLogger = new DeprecationLogger(\n+        LogManager.getLogger(RestMultiSearchTemplateAction.class)\n+    );\n+    static final String TYPES_DEPRECATION_MESSAGE = \"[types removal]\"\n+        + \" Specifying types in multi search template requests is deprecated.\";\n+\n+    public RestMultiSearchTemplateActionV7(Settings settings) {\n+        super(settings);\n+    }\n+\n+    @Override\n+    public String compatibleWithVersion() {\n+        return String.valueOf(Version.V_7_0_0.major);\n+    }\n+\n+    @Override\n+    public List<Route> routes() {\n+        return List.of(\n+            new Route(GET, \"/_msearch/template\"),\n+            new Route(POST, \"/_msearch/template\"),\n+            new Route(GET, \"/{index}/_msearch/template\"),\n+            new Route(POST, \"/{index}/_msearch/template\"),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6184a9d07d97fb884601af6c0bb05b910b2e04c5"}, "originalPosition": 61}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjc3NTgyMA==", "bodyText": "again - type can be present in a body.", "url": "https://github.com/elastic/elasticsearch/pull/54572#discussion_r402775820", "createdAt": "2020-04-03T07:05:50Z", "author": {"login": "pgomulka"}, "path": "modules/rest-compatibility/src/main/java/org/elasticsearch/script/mustache/RestMultiSearchTemplateActionV7.java", "diffHunk": "@@ -0,0 +1,113 @@\n+/*\n+ * Licensed to Elasticsearch under one or more contributor\n+ * license agreements. See the NOTICE file distributed with\n+ * this work for additional information regarding copyright\n+ * ownership. Elasticsearch licenses this file to you under\n+ * the Apache License, Version 2.0 (the \"License\"); you may\n+ * not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.elasticsearch.script.mustache;\n+\n+import org.apache.logging.log4j.LogManager;\n+import org.elasticsearch.compat.TypeConsumer;\n+import org.elasticsearch.Version;\n+import org.elasticsearch.client.node.NodeClient;\n+import org.elasticsearch.common.logging.DeprecationLogger;\n+import org.elasticsearch.common.settings.Settings;\n+import org.elasticsearch.rest.RestRequest;\n+import org.elasticsearch.rest.action.RestToXContentListener;\n+import org.elasticsearch.rest.action.search.RestMultiSearchAction;\n+import org.elasticsearch.rest.action.search.RestSearchAction;\n+\n+import java.io.IOException;\n+import java.util.List;\n+\n+import static org.elasticsearch.rest.RestRequest.Method.GET;\n+import static org.elasticsearch.rest.RestRequest.Method.POST;\n+\n+public class RestMultiSearchTemplateActionV7 extends RestMultiSearchTemplateAction {\n+    private static final DeprecationLogger deprecationLogger = new DeprecationLogger(\n+        LogManager.getLogger(RestMultiSearchTemplateAction.class)\n+    );\n+    static final String TYPES_DEPRECATION_MESSAGE = \"[types removal]\"\n+        + \" Specifying types in multi search template requests is deprecated.\";\n+\n+    public RestMultiSearchTemplateActionV7(Settings settings) {\n+        super(settings);\n+    }\n+\n+    @Override\n+    public String compatibleWithVersion() {\n+        return String.valueOf(Version.V_7_0_0.major);\n+    }\n+\n+    @Override\n+    public List<Route> routes() {\n+        return List.of(\n+            new Route(GET, \"/_msearch/template\"),\n+            new Route(POST, \"/_msearch/template\"),\n+            new Route(GET, \"/{index}/_msearch/template\"),\n+            new Route(POST, \"/{index}/_msearch/template\"),", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjU1NDQyMQ=="}, "originalCommit": {"oid": "6184a9d07d97fb884601af6c0bb05b910b2e04c5"}, "originalPosition": 61}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU1NDY5MjY2OnYy", "diffSide": "RIGHT", "path": "modules/rest-compatibility/build.gradle", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMFQwOToyOTowNlrOGILixw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMFQwOToyOTowNlrOGILixw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTIzMDkxOQ==", "bodyText": "these two dependencies are to allow making compatible versions of Actions from these modules", "url": "https://github.com/elastic/elasticsearch/pull/54572#discussion_r411230919", "createdAt": "2020-04-20T09:29:06Z", "author": {"login": "pgomulka"}, "path": "modules/rest-compatibility/build.gradle", "diffHunk": "@@ -19,7 +19,12 @@\n \n esplugin {\n   description 'Adds a compatiblity layer for the prior major versions REST API'\n-  classname 'org.elasticsearch.rest.compat.RestCompatPlugin'\n+  classname 'org.elasticsearch.compat.RestCompatPlugin'\n+}\n+\n+dependencies {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d998555f99189f305bce708946f0a72dcff9c1d0"}, "originalPosition": 8}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3932, "cost": 1, "resetAt": "2021-11-12T13:16:51Z"}}}