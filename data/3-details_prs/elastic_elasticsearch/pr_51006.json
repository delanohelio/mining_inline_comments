{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzYyODQ3NTAz", "number": 51006, "title": "Fix MultiVersionRepository BwC Tests", "bodyText": "The HLRC doesn't like what its getting back from some older 6.x versions for the restore status\nso I moved that request to the low level client.\nCloses #50819\nI manually confirmed that this runs fine for all BwC test versions:\n\nBUILD SUCCESSFUL in 51m 1s\n414 actionable tasks: 322 executed, 92 up-to-date", "createdAt": "2020-01-14T21:28:26Z", "url": "https://github.com/elastic/elasticsearch/pull/51006", "merged": true, "mergeCommit": {"oid": "dd09dc7af6296cb4c698ebc02afafb70442d242b"}, "closed": true, "closedAt": "2020-01-15T14:19:09Z", "author": {"login": "original-brownbear"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb6XxTGAH2gAyMzYyODQ3NTAzOjE0ZGViZGY1OTFjZjdiZjU3OTE5MGZkMWZiYTZkNDE4YjVmMGEzODM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABb6lnXGgH2gAyMzYyODQ3NTAzOjUyYTUyNzMyODY2MmJjYzg5MmVjZGEyOGI2YjJiZDAyN2QyYTJlODA=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "14debdf591cf7bf579190fd1fba6d418b5f0a383", "author": {"user": {"login": "original-brownbear", "name": "Armin Braun"}}, "url": "https://github.com/elastic/elasticsearch/commit/14debdf591cf7bf579190fd1fba6d418b5f0a383", "committedDate": "2020-01-14T21:24:12Z", "message": "Fix MultiVersionRepository BwC Tests\n\nThe HLRC doesn't like what its getting back from some older 6.x versions for the restore status\nso I moved that request to the low level client.\nCloses #50819"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQzMjA4MDEx", "url": "https://github.com/elastic/elasticsearch/pull/51006#pullrequestreview-343208011", "createdAt": "2020-01-15T13:14:04Z", "commit": {"oid": "14debdf591cf7bf579190fd1fba6d418b5f0a383"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNVQxMzoxNDowNVrOFd31NQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNVQxMzoxNDowNVrOFd31NQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Njg2Nzc2NQ==", "bodyText": "remove this?", "url": "https://github.com/elastic/elasticsearch/pull/51006#discussion_r366867765", "createdAt": "2020-01-15T13:14:05Z", "author": {"login": "ywelsch"}, "path": "qa/repository-multi-version/src/test/java/org/elasticsearch/upgrades/MultiVersionRepositoryAccessIT.java", "diffHunk": "@@ -269,14 +266,20 @@ private void deleteSnapshot(RestHighLevelClient client, String repoName, String\n         }\n     }\n \n-    private static void ensureSnapshotRestoreWorks(RestHighLevelClient client, String repoName, String name,\n-                                                   int shards) throws IOException {\n+    @SuppressWarnings(\"unchecked\")\n+    private void ensureSnapshotRestoreWorks(String repoName, String name, int shards) throws IOException {\n         wipeAllIndices();\n-        final RestoreInfo restoreInfo =\n-            client.snapshot().restore(new RestoreSnapshotRequest().repository(repoName).snapshot(name).waitForCompletion(true),\n-                RequestOptions.DEFAULT).getRestoreInfo();\n-        assertThat(restoreInfo.failedShards(), is(0));\n-        assertThat(restoreInfo.successfulShards(), equalTo(shards));\n+        try (InputStream entity = client().performRequest(\n+            new Request(\"POST\", \"/_snapshot/\" + repoName + \"/\" + name + \"/_restore?wait_for_completion=true\")).getEntity().getContent();\n+            XContentParser parser = JsonXContent.jsonXContent.createParser(\n+            xContentRegistry(), DeprecationHandler.THROW_UNSUPPORTED_OPERATION, entity)) {\n+            final Map<String, Object> raw = parser.map();\n+            logger.error(raw);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "14debdf591cf7bf579190fd1fba6d418b5f0a383"}, "originalPosition": 101}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "01de4012250c5c5151dea1d8710b00648e5b69c3", "author": {"user": {"login": "original-brownbear", "name": "Armin Braun"}}, "url": "https://github.com/elastic/elasticsearch/commit/01de4012250c5c5151dea1d8710b00648e5b69c3", "committedDate": "2020-01-15T13:31:40Z", "message": "Merge remote-tracking branch 'elastic/7.x' into 50819"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "52a527328662bcc892ecda28b6b2bd027d2a2e80", "author": {"user": {"login": "original-brownbear", "name": "Armin Braun"}}, "url": "https://github.com/elastic/elasticsearch/commit/52a527328662bcc892ecda28b6b2bd027d2a2e80", "committedDate": "2020-01-15T13:32:01Z", "message": "remove debug logging"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3073, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}