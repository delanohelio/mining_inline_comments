{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDk2ODU1ODcz", "number": 63173, "title": "Checkout dir should be available as artifact from bwc projects", "bodyText": "Related to #62985 as a step forward on improving resolving test resources\nfrom older elasticsearch branches / versions", "createdAt": "2020-10-02T11:44:19Z", "url": "https://github.com/elastic/elasticsearch/pull/63173", "merged": true, "mergeCommit": {"oid": "b8dabce9dea3284cc13601da31792d740cd10cf8"}, "closed": true, "closedAt": "2020-10-12T06:23:22Z", "author": {"login": "breskeby"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdQg4EvAH2gAyNDk2ODU1ODczOmI2MGE0NzhlNDQ4YWU0NjU4MTI5ZTllNWExMmMwMDZiYTFiMmE3YjU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdQhvU3gFqTUwNDc5MTkyNg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "b60a478e448ae4658129e9e5a12c006ba1b2a7b5", "author": {"user": {"login": "breskeby", "name": "Rene Groeschke"}}, "url": "https://github.com/elastic/elasticsearch/commit/b60a478e448ae4658129e9e5a12c006ba1b2a7b5", "committedDate": "2020-10-08T12:38:14Z", "message": "Checkout dir should be available as artifact from bwc projects"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0858a65f0c55c001e1605e5c475303be1f9562e1", "author": {"user": {"login": "breskeby", "name": "Rene Groeschke"}}, "url": "https://github.com/elastic/elasticsearch/commit/0858a65f0c55c001e1605e5c475303be1f9562e1", "committedDate": "2020-10-02T11:39:45Z", "message": "Checkout dir should be available as artifact from bwc projects"}, "afterCommit": {"oid": "b60a478e448ae4658129e9e5a12c006ba1b2a7b5", "author": {"user": {"login": "breskeby", "name": "Rene Groeschke"}}, "url": "https://github.com/elastic/elasticsearch/commit/b60a478e448ae4658129e9e5a12c006ba1b2a7b5", "committedDate": "2020-10-08T12:38:14Z", "message": "Checkout dir should be available as artifact from bwc projects"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1807ec0436d6a7faac86eb68f11f2eb256a97e37", "author": {"user": {"login": "breskeby", "name": "Rene Groeschke"}}, "url": "https://github.com/elastic/elasticsearch/commit/1807ec0436d6a7faac86eb68f11f2eb256a97e37", "committedDate": "2020-10-08T13:33:36Z", "message": "Fix merge issue"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA0NzkxOTI2", "url": "https://github.com/elastic/elasticsearch/pull/63173#pullrequestreview-504791926", "createdAt": "2020-10-08T13:38:34Z", "commit": {"oid": "1807ec0436d6a7faac86eb68f11f2eb256a97e37"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOFQxMzozODozNFrOHefBeQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOFQxMzozODozNFrOHefBeQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTcyNzYwOQ==", "bodyText": "@jakelandis this functional test basically shows an example on how to resolve the checkoutDir as artifact. you can declare a dependency in the es build by declaring\ndependencies {\n    myConfig project(path:':distribution:bwc:minor', configuration:'checkoutDir')\n}", "url": "https://github.com/elastic/elasticsearch/pull/63173#discussion_r501727609", "createdAt": "2020-10-08T13:38:34Z", "author": {"login": "breskeby"}, "path": "buildSrc/src/integTest/groovy/org/elasticsearch/gradle/internal/InternalBwcGitPluginFuncTest.groovy", "diffHunk": "@@ -19,33 +19,60 @@\n \n package org.elasticsearch.gradle.internal\n \n-import org.elasticsearch.gradle.fixtures.AbstractGradleFuncTest\n+import org.elasticsearch.gradle.fixtures.AbstractGitAwareGradleFuncTest\n import org.gradle.testkit.runner.TaskOutcome\n \n-class InternalBwcGitPluginFuncTest extends AbstractGradleFuncTest {\n+class InternalBwcGitPluginFuncTest extends AbstractGitAwareGradleFuncTest {\n \n     def setup() {\n-        setupLocalGitRepo()\n-    }\n-\n-    def \"current repository can be cloned\"() {\n-        given:\n-        internalBuild();\n+        internalBuild()\n         buildFile << \"\"\"\n             import org.elasticsearch.gradle.Version;\n             apply plugin: org.elasticsearch.gradle.internal.InternalBwcGitPlugin  \n             \n             bwcGitConfig {\n-                 bwcVersion = project.provider { Version.fromString(\"7.10.0\") }\n-                 bwcBranch = project.provider { \"7.x\" }\n+                 bwcVersion = project.provider { Version.fromString(\"8.1.0\") }\n+                 bwcBranch = project.provider { \"8.0\" }\n                  checkoutDir = project.provider{file(\"build/checkout\")}\n             }\n         \"\"\"\n+    }\n+\n+    def \"current repository can be cloned\"() {\n         when:\n         def result = gradleRunner(\"createClone\", '--stacktrace').build()\n         then:\n         result.task(\":createClone\").outcome == TaskOutcome.SUCCESS\n-        file(\"build/checkout/build.gradle\").exists()\n-        file(\"build/checkout/settings.gradle\").exists()\n+        file(\"cloned/build/checkout/build.gradle\").exists()\n+        file(\"cloned/build/checkout/settings.gradle\").exists()\n+    }\n+\n+    def \"can resolve checkout folder as project artifact\"() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1807ec0436d6a7faac86eb68f11f2eb256a97e37"}, "originalPosition": 44}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4484, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}