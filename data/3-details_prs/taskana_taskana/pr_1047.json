{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDEyOTQ4NzIw", "number": 1047, "title": "TSK-1197: readded test case for testing the ordering of the databases\u2026", "bodyText": "TSK-1197: readded test case for testing the ordering of the databases H2, Postgress and DB2; remove Db2 10.5 travis job\nTSK-1197: build Postgres image with german collation", "createdAt": "2020-05-04T13:22:37Z", "url": "https://github.com/Taskana/taskana/pull/1047", "merged": true, "mergeCommit": {"oid": "697cc2b3f5351cd519cb7b351fbfecfa061c00c4"}, "closed": true, "closedAt": "2020-05-06T06:54:39Z", "author": {"login": "sfrevel"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcd_U6kgH2gAyNDEyOTQ4NzIwOmNiNDQ1MGM4N2M3NWU2YmRlZTI5M2M1MDJhYzIwM2Y4ZmRjYjM4NjI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcehUskgFqTQwNjMwMjkxMw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "cb4450c87c75e6bdee293c502ac203f8fdcb3862", "author": {"user": {"login": "sfrevel", "name": null}}, "url": "https://github.com/Taskana/taskana/commit/cb4450c87c75e6bdee293c502ac203f8fdcb3862", "committedDate": "2020-05-04T13:16:45Z", "message": "TSK-1197: readded test case for testing the ordering of the databases H2, Postgress and DB2; remove Db2 10.5 travis job\nTSK-1197: build Postgres image with german collation"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA1MDc3MDY2", "url": "https://github.com/Taskana/taskana/pull/1047#pullrequestreview-405077066", "createdAt": "2020-05-04T15:06:17Z", "commit": {"oid": "cb4450c87c75e6bdee293c502ac203f8fdcb3862"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNFQxNTowNjoxN1rOGQEqBQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNFQxNjowNjo0OVrOGQHRDg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTUwNjY5Mw==", "bodyText": "FROM postgres:10 ;)", "url": "https://github.com/Taskana/taskana/pull/1047#discussion_r419506693", "createdAt": "2020-05-04T15:06:17Z", "author": {"login": "mustaphazorgati"}, "path": "ci/Dockerfile", "diffHunk": "@@ -0,0 +1,3 @@\n+FROM postgres:10.4", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cb4450c87c75e6bdee293c502ac203f8fdcb3862"}, "originalPosition": 1}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTUwNjkwMQ==", "bodyText": "taskana-postgres_10 please ;)", "url": "https://github.com/Taskana/taskana/pull/1047#discussion_r419506901", "createdAt": "2020-05-04T15:06:32Z", "author": {"login": "mustaphazorgati"}, "path": "ci/docker-compose.yml", "diffHunk": "@@ -0,0 +1,9 @@\n+version: '3'\n+services:\n+  taskana-postgres_10_4:", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cb4450c87c75e6bdee293c502ac203f8fdcb3862"}, "originalPosition": 3}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTUwNzU0NA==", "bodyText": "please move this to\nenv.global", "url": "https://github.com/Taskana/taskana/pull/1047#discussion_r419507544", "createdAt": "2020-05-04T15:07:27Z", "author": {"login": "mustaphazorgati"}, "path": ".travis.yml", "diffHunk": "@@ -53,9 +52,17 @@ jobs:\n       language: node_js\n       node_js: $NODE_VERSION\n       install: skip\n-      env: DB=WEB\n+      env: \n+        - DB=WEB\n+        - DOCKER_COMPOSE_VERSION=1.4.2", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cb4450c87c75e6bdee293c502ac203f8fdcb3862"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTUwOTM1OA==", "bodyText": "I think this is wrong.\nPlease insert this in the install phase of the Test-matrix phase (replace install: skip from line 45 with this.`)", "url": "https://github.com/Taskana/taskana/pull/1047#discussion_r419509358", "createdAt": "2020-05-04T15:10:01Z", "author": {"login": "mustaphazorgati"}, "path": ".travis.yml", "diffHunk": "@@ -53,9 +52,17 @@ jobs:\n       language: node_js\n       node_js: $NODE_VERSION\n       install: skip\n-      env: DB=WEB\n+      env: \n+        - DB=WEB\n+        - DOCKER_COMPOSE_VERSION=1.4.2\n       script: ci/test.sh \"$DB\"\n       before_cache: rm -rf \"$HOME/.m2/repository/pro/taskana\"\n+      before_install:", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cb4450c87c75e6bdee293c502ac203f8fdcb3862"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTUwOTc3NA==", "bodyText": "Please concat these statements with && to implement lazy evaluation. (so that the step will not be executed when the previous one exits with != 0)", "url": "https://github.com/Taskana/taskana/pull/1047#discussion_r419509774", "createdAt": "2020-05-04T15:10:39Z", "author": {"login": "mustaphazorgati"}, "path": ".travis.yml", "diffHunk": "@@ -53,9 +52,17 @@ jobs:\n       language: node_js\n       node_js: $NODE_VERSION\n       install: skip\n-      env: DB=WEB\n+      env: \n+        - DB=WEB\n+        - DOCKER_COMPOSE_VERSION=1.4.2\n       script: ci/test.sh \"$DB\"\n       before_cache: rm -rf \"$HOME/.m2/repository/pro/taskana\"\n+      before_install:\n+        - sudo rm /usr/local/bin/docker-compose\n+        - curl -L https://github.com/docker/compose/releases/download/${DOCKER_COMPOSE_VERSION}/docker-compose-`uname -s`-`uname -m` > docker-compose\n+        - chmod +x docker-compose\n+        - sudo mv docker-compose /usr/local/bin", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cb4450c87c75e6bdee293c502ac203f8fdcb3862"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTU0NjkxNw==", "bodyText": "there is no need for this seperation anymore. docker-compose up -d recreates the container if already existing.", "url": "https://github.com/Taskana/taskana/pull/1047#discussion_r419546917", "createdAt": "2020-05-04T16:03:07Z", "author": {"login": "mustaphazorgati"}, "path": "ci/prepare_db.bat", "diffHunk": "@@ -107,13 +107,17 @@ SET PROP_FILE=%HOMEPATH%\\taskanaUnitTest.properties\n     del %TEMP%\\temp\n \n     IF DEFINED CONTAINER_EXISTS (\n-        ECHO docker start taskana-postgres_10_4\n-        docker start taskana-postgres_10_4\n+        REM ECHO docker start taskana-postgres_10_4\n+        REM docker start taskana-postgres_10_4\n+        ECHO docker-compose -f %~dp0/docker-compose.yml start taskana-postgres_10_4\n+        docker-compose -f %~dp0/docker-compose.yml start taskana-postgres_10_4\n     )\n \n     IF NOT DEFINED CONTAINER_EXISTS (\n-        ECHO docker run -d -p 50102:5432 --name taskana-postgres_10_4 -e POSTGRES_PASSWORD=postgres postgres:10.4\n-        docker run -d -p 50102:5432 --name taskana-postgres_10_4 -e POSTGRES_PASSWORD=postgres postgres:10.4\n+        REM ECHO docker run -d -p 50102:5432 --name taskana-postgres_10_4 -e POSTGRES_PASSWORD=postgres postgres:10.4\n+        REM docker run -d -p 50102:5432 --name taskana-postgres_10_4 -e POSTGRES_PASSWORD=postgres postgres:10.4\n+        ECHO docker-compose -f %~dp0/docker-compose.yml up -d\n+        docker-compose -f %~dp0/docker-compose.yml up -d", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cb4450c87c75e6bdee293c502ac203f8fdcb3862"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTU0NzEzMg==", "bodyText": "I just started a polly.. Maybe this file is not needed anymore. Let's wait for the feedback in #taskana.", "url": "https://github.com/Taskana/taskana/pull/1047#discussion_r419547132", "createdAt": "2020-05-04T16:03:28Z", "author": {"login": "mustaphazorgati"}, "path": "ci/prepare_db.bat", "diffHunk": "@@ -107,13 +107,17 @@ SET PROP_FILE=%HOMEPATH%\\taskanaUnitTest.properties\n     del %TEMP%\\temp\n \n     IF DEFINED CONTAINER_EXISTS (\n-        ECHO docker start taskana-postgres_10_4\n-        docker start taskana-postgres_10_4\n+        REM ECHO docker start taskana-postgres_10_4\n+        REM docker start taskana-postgres_10_4\n+        ECHO docker-compose -f %~dp0/docker-compose.yml start taskana-postgres_10_4\n+        docker-compose -f %~dp0/docker-compose.yml start taskana-postgres_10_4\n     )\n \n     IF NOT DEFINED CONTAINER_EXISTS (\n-        ECHO docker run -d -p 50102:5432 --name taskana-postgres_10_4 -e POSTGRES_PASSWORD=postgres postgres:10.4\n-        docker run -d -p 50102:5432 --name taskana-postgres_10_4 -e POSTGRES_PASSWORD=postgres postgres:10.4\n+        REM ECHO docker run -d -p 50102:5432 --name taskana-postgres_10_4 -e POSTGRES_PASSWORD=postgres postgres:10.4\n+        REM docker run -d -p 50102:5432 --name taskana-postgres_10_4 -e POSTGRES_PASSWORD=postgres postgres:10.4\n+        ECHO docker-compose -f %~dp0/docker-compose.yml up -d\n+        docker-compose -f %~dp0/docker-compose.yml up -d\n     )\n \n     ECHO jdbcDriver=org.postgresql.Driver> %PROP_FILE%", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cb4450c87c75e6bdee293c502ac203f8fdcb3862"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTU0Nzc5OQ==", "bodyText": "please rename this to POSTGRES_10", "url": "https://github.com/Taskana/taskana/pull/1047#discussion_r419547799", "createdAt": "2020-05-04T16:04:25Z", "author": {"login": "mustaphazorgati"}, "path": "ci/prepare_db.sh", "diffHunk": "@@ -63,9 +63,9 @@ function main() {\n   POSTGRES_10_4)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cb4450c87c75e6bdee293c502ac203f8fdcb3862"}, "originalPosition": 1}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTU0ODE5OA==", "bodyText": "no need to differentiate anymore. docker-compose up -d is enough. See comment above", "url": "https://github.com/Taskana/taskana/pull/1047#discussion_r419548198", "createdAt": "2020-05-04T16:04:59Z", "author": {"login": "mustaphazorgati"}, "path": "ci/prepare_db.sh", "diffHunk": "@@ -63,9 +63,9 @@ function main() {\n   POSTGRES_10_4)\n     if [[ -z $(docker ps -aq -f name=^/taskana-postgres_10_4$ -f status=running) ]]; then\n       if [[ -z $(docker ps -aq -f name=^/taskana-postgres_10_4$) ]]; then\n-        docker run -d -p 50102:5432 --name taskana-postgres_10_4 -e POSTGRES_PASSWORD=postgres postgres:10.4\n+\t\t docker-compose -f `dirname $0`/docker-compose.yml up -d\n       else\n-        docker start taskana-postgres_10_4\n+\t\tdocker-compose -f `dirname $0`/docker-compose.yml start taskana-postgres_10_4\n       fi\n     fi", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cb4450c87c75e6bdee293c502ac203f8fdcb3862"}, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTU0ODgyNA==", "bodyText": "I am a big fan of making an extra variable for dirname $0. But you don't have to ;)", "url": "https://github.com/Taskana/taskana/pull/1047#discussion_r419548824", "createdAt": "2020-05-04T16:05:58Z", "author": {"login": "mustaphazorgati"}, "path": "ci/prepare_db.sh", "diffHunk": "@@ -63,9 +63,9 @@ function main() {\n   POSTGRES_10_4)\n     if [[ -z $(docker ps -aq -f name=^/taskana-postgres_10_4$ -f status=running) ]]; then\n       if [[ -z $(docker ps -aq -f name=^/taskana-postgres_10_4$) ]]; then\n-        docker run -d -p 50102:5432 --name taskana-postgres_10_4 -e POSTGRES_PASSWORD=postgres postgres:10.4\n+\t\t docker-compose -f `dirname $0`/docker-compose.yml up -d\n       else\n-        docker start taskana-postgres_10_4", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cb4450c87c75e6bdee293c502ac203f8fdcb3862"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTU0OTQ1NA==", "bodyText": "This looks like a big code smell due to the dependency to the database locale.\nTicket?", "url": "https://github.com/Taskana/taskana/pull/1047#discussion_r419549454", "createdAt": "2020-05-04T16:06:49Z", "author": {"login": "mustaphazorgati"}, "path": "lib/taskana-core/src/main/java/pro/taskana/task/internal/TaskServiceImpl.java", "diffHunk": "@@ -261,7 +261,7 @@ public Task createTask(Task taskToCreate)\n         // primary key violation: \"UC_EXTERNAL_ID_INDEX_2 ON TASKANA.TASK(EXTERNAL_ID) ...\n         String msg = e.getMessage() != null ? e.getMessage().toLowerCase() : null;\n         if (msg != null\n-            && (msg.contains(\"violation\") || msg.contains(\"violates\"))\n+            && (msg.contains(\"violation\") || msg.contains(\"violates\") || msg.contains(\"verletzt\"))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cb4450c87c75e6bdee293c502ac203f8fdcb3862"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA1NzE4MTYx", "url": "https://github.com/Taskana/taskana/pull/1047#pullrequestreview-405718161", "createdAt": "2020-05-05T11:58:02Z", "commit": {"oid": "793ebd985448a3760b0bc6bc8b32026941285c63"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fb1182370436c9ee20af28dd162cd58c57172d8c", "author": {"user": {"login": "sfrevel", "name": null}}, "url": "https://github.com/Taskana/taskana/commit/fb1182370436c9ee20af28dd162cd58c57172d8c", "committedDate": "2020-05-05T13:04:16Z", "message": "TSK-1197: use only postgres:10 tag; use only docker compose up; clean up docker compose installation for travis\n\nTSK-1197: moved docker-compose install to the right place; fixed variable definition\n\nTSK-1197: remove docker-compose installation, use preinstalled travis version\n\nTSK-1197: harmonize postgres db version parameter in scripts preparedb and test.sh\n\nTSK-1197: removed DB2_10_5 handling from scripts"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d3df2f13f6ee46dc47285d400bfd87b214ccb551", "author": {"user": {"login": "sfrevel", "name": null}}, "url": "https://github.com/Taskana/taskana/commit/d3df2f13f6ee46dc47285d400bfd87b214ccb551", "committedDate": "2020-05-05T12:25:45Z", "message": "TSK-1197: removed DB2_10_5 handling from scripts"}, "afterCommit": {"oid": "fb1182370436c9ee20af28dd162cd58c57172d8c", "author": {"user": {"login": "sfrevel", "name": null}}, "url": "https://github.com/Taskana/taskana/commit/fb1182370436c9ee20af28dd162cd58c57172d8c", "committedDate": "2020-05-05T13:04:16Z", "message": "TSK-1197: use only postgres:10 tag; use only docker compose up; clean up docker compose installation for travis\n\nTSK-1197: moved docker-compose install to the right place; fixed variable definition\n\nTSK-1197: remove docker-compose installation, use preinstalled travis version\n\nTSK-1197: harmonize postgres db version parameter in scripts preparedb and test.sh\n\nTSK-1197: removed DB2_10_5 handling from scripts"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA2MzAyOTEz", "url": "https://github.com/Taskana/taskana/pull/1047#pullrequestreview-406302913", "createdAt": "2020-05-06T04:53:17Z", "commit": {"oid": "fb1182370436c9ee20af28dd162cd58c57172d8c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4540, "cost": 1, "resetAt": "2021-11-02T12:20:56Z"}}}