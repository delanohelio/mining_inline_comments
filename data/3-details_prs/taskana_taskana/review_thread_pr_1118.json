{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDMyNTQyNzI3", "number": 1118, "reviewThreads": {"totalCount": 34, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xM1QxNDo0Nzo0MVrOEFQgcQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xM1QxNTo1NDo1MFrOEFQtsg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjczOTQ4Nzg1OnYy", "diffSide": "RIGHT", "path": "history/taskana-simplehistory-provider/src/main/java/pro/taskana/simplehistory/impl/SimpleHistoryServiceImpl.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xM1QxNDo0Nzo0MVrOGjX4MA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xM1QxNDo0Nzo0MVrOGjX4MA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTc0NDU2MA==", "bodyText": "Do this before you open the connection", "url": "https://github.com/Taskana/taskana/pull/1118#discussion_r439744560", "createdAt": "2020-06-13T14:47:41Z", "author": {"login": "mustaphazorgati"}, "path": "history/taskana-simplehistory-provider/src/main/java/pro/taskana/simplehistory/impl/SimpleHistoryServiceImpl.java", "diffHunk": "@@ -54,6 +58,32 @@ public void create(TaskanaHistoryEvent event) {\n     }\n   }\n \n+  @Override\n+  public void deleteHistoryEventsByTaskIds(List<String> taskIds)\n+      throws InvalidArgumentException, NotAuthorizedException {\n+\n+    if (LOGGER.isDebugEnabled()) {\n+      LOGGER.debug(\"entry to deleteHistoryEventsByTaskIds(taskIds = {})\", taskIds);\n+    }\n+\n+    taskanaHistoryEngine.checkRoleMembership(TaskanaRole.ADMIN);\n+\n+    try {\n+      taskanaHistoryEngine.openConnection();\n+      if (taskIds == null) {\n+        throw new InvalidArgumentException(\"List of taskIds must not be null.\");\n+      }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c60d23b03bef2ed18d6854a69ea315a34a6e0981"}, "originalPosition": 33}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjczOTQ4ODE0OnYy", "diffSide": "RIGHT", "path": "history/taskana-simplehistory-provider/src/main/java/pro/taskana/simplehistory/impl/SimpleHistoryServiceImpl.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xM1QxNDo0ODoxMVrOGjX4VQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xM1QxNDo0ODoxMVrOGjX4VQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTc0NDU5Nw==", "bodyText": "Is there a reason why we deviate from our BulkOperation api in taskana-core and thus not return a BulkOperationResults?", "url": "https://github.com/Taskana/taskana/pull/1118#discussion_r439744597", "createdAt": "2020-06-13T14:48:11Z", "author": {"login": "mustaphazorgati"}, "path": "history/taskana-simplehistory-provider/src/main/java/pro/taskana/simplehistory/impl/SimpleHistoryServiceImpl.java", "diffHunk": "@@ -54,6 +58,32 @@ public void create(TaskanaHistoryEvent event) {\n     }\n   }\n \n+  @Override\n+  public void deleteHistoryEventsByTaskIds(List<String> taskIds)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c60d23b03bef2ed18d6854a69ea315a34a6e0981"}, "originalPosition": 20}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjczOTQ4OTQxOnYy", "diffSide": "RIGHT", "path": "history/taskana-simplehistory-provider/src/main/java/pro/taskana/simplehistory/impl/TaskanaHistoryEngineImpl.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xM1QxNDo1MDowOVrOGjX48w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xM1QxNDo1MDowOVrOGjX48w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTc0NDc1NQ==", "bodyText": "This exists in TaskanaEngineImpl => move to configuration?", "url": "https://github.com/Taskana/taskana/pull/1118#discussion_r439744755", "createdAt": "2020-06-13T14:50:09Z", "author": {"login": "mustaphazorgati"}, "path": "history/taskana-simplehistory-provider/src/main/java/pro/taskana/simplehistory/impl/TaskanaHistoryEngineImpl.java", "diffHunk": "@@ -52,6 +60,38 @@ public TaskanaHistory getTaskanaHistoryService() {\n     return this.taskanaHistoryService;\n   }\n \n+  public boolean isUserInRole(TaskanaRole... roles) {\n+    if (!getConfiguration().isSecurityEnabled()) {\n+      return true;\n+    }\n+\n+    Set<String> rolesMembers =\n+        Arrays.stream(roles)\n+            .map(role -> getConfiguration().getRoleMap().get(role))\n+            .collect(HashSet::new, Set::addAll, Set::addAll);\n+\n+    return CurrentUserContext.getAccessIds().stream()\n+        .anyMatch(rolesMembers::contains);\n+  }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c60d23b03bef2ed18d6854a69ea315a34a6e0981"}, "originalPosition": 50}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjczOTQ4OTUzOnYy", "diffSide": "RIGHT", "path": "history/taskana-simplehistory-provider/src/main/java/pro/taskana/simplehistory/impl/TaskanaHistoryEngineImpl.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xM1QxNDo1MDoyNlrOGjX5Aw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xM1QxNDo1MDoyNlrOGjX5Aw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTc0NDc3MQ==", "bodyText": "Is there a reason why we don't extend tha TaskanaEngine? This would resolve the comments below.", "url": "https://github.com/Taskana/taskana/pull/1118#discussion_r439744771", "createdAt": "2020-06-13T14:50:26Z", "author": {"login": "mustaphazorgati"}, "path": "history/taskana-simplehistory-provider/src/main/java/pro/taskana/simplehistory/impl/TaskanaHistoryEngineImpl.java", "diffHunk": "@@ -23,7 +31,7 @@\n public class TaskanaHistoryEngineImpl implements TaskanaHistoryEngine {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c60d23b03bef2ed18d6854a69ea315a34a6e0981"}, "originalPosition": 26}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjczOTQ5MDAxOnYy", "diffSide": "RIGHT", "path": "history/taskana-simplehistory-provider/src/main/java/pro/taskana/simplehistory/impl/TaskanaHistoryEngineImpl.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xM1QxNDo1MTowNlrOGjX5Qg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xM1QxNDo1MTowNlrOGjX5Qg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTc0NDgzNA==", "bodyText": "This exists in TaskanaEngineImpl => move to configuration?", "url": "https://github.com/Taskana/taskana/pull/1118#discussion_r439744834", "createdAt": "2020-06-13T14:51:06Z", "author": {"login": "mustaphazorgati"}, "path": "history/taskana-simplehistory-provider/src/main/java/pro/taskana/simplehistory/impl/TaskanaHistoryEngineImpl.java", "diffHunk": "@@ -52,6 +60,38 @@ public TaskanaHistory getTaskanaHistoryService() {\n     return this.taskanaHistoryService;\n   }\n \n+  public boolean isUserInRole(TaskanaRole... roles) {\n+    if (!getConfiguration().isSecurityEnabled()) {\n+      return true;\n+    }\n+\n+    Set<String> rolesMembers =\n+        Arrays.stream(roles)\n+            .map(role -> getConfiguration().getRoleMap().get(role))\n+            .collect(HashSet::new, Set::addAll, Set::addAll);\n+\n+    return CurrentUserContext.getAccessIds().stream()\n+        .anyMatch(rolesMembers::contains);\n+  }\n+\n+  public void checkRoleMembership(TaskanaRole... roles) throws NotAuthorizedException {\n+    if (!isUserInRole(roles)) {\n+      if (LOGGER.isDebugEnabled()) {\n+        LOGGER.debug(\n+            \"Throwing NotAuthorizedException because accessIds {} are not member of roles {}\",\n+            CurrentUserContext.getAccessIds(),\n+            Arrays.toString(roles));\n+      }\n+      throw new NotAuthorizedException(\n+          \"current user is not member of role(s) \" + Arrays.toString(roles),\n+          CurrentUserContext.getUserid());\n+    }\n+  }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c60d23b03bef2ed18d6854a69ea315a34a6e0981"}, "originalPosition": 64}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjczOTQ5NDQ1OnYy", "diffSide": "RIGHT", "path": "history/taskana-simplehistory-provider/src/test/java/acceptance/AbstractAccTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xM1QxNTowMDoyOVrOGjX7bg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xM1QxNTowMDoyOVrOGjX7bg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTc0NTM5MA==", "bodyText": "generate the id and then manually set it? Why's that?", "url": "https://github.com/Taskana/taskana/pull/1118#discussion_r439745390", "createdAt": "2020-06-13T15:00:29Z", "author": {"login": "mustaphazorgati"}, "path": "history/taskana-simplehistory-provider/src/test/java/acceptance/AbstractAccTest.java", "diffHunk": "@@ -109,13 +125,17 @@ public static String getSchemaName() {\n    * @return History event object created.\n    */\n   public static HistoryEventImpl createHistoryEvent(\n+      String id,\n       String workbasketKey,\n       String taskId,\n       String type,\n       String previousWorkbasketId,\n       String userid,\n       String details) {\n-    HistoryEventImpl historyEvent = new HistoryEventImpl(userid, details);\n+    HistoryEventImpl historyEvent =\n+        new HistoryEventImpl(\n+            IdGenerator.generateWithPrefix(ID_PREFIX_HISTORY_EVENT), userid, details);\n+    historyEvent.setId(id);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c60d23b03bef2ed18d6854a69ea315a34a6e0981"}, "originalPosition": 91}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjczOTQ5NjA5OnYy", "diffSide": "RIGHT", "path": "history/taskana-simplehistory-provider/src/test/java/acceptance/events/CreateHistoryEventOnCancelClaimAccTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xM1QxNTowMzowOVrOGjX8Tg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xM1QxNTowMzowOVrOGjX8Tg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTc0NTYxNA==", "bodyText": "why do we do this before each test? => initalize fields directly", "url": "https://github.com/Taskana/taskana/pull/1118#discussion_r439745614", "createdAt": "2020-06-13T15:03:09Z", "author": {"login": "mustaphazorgati"}, "path": "history/taskana-simplehistory-provider/src/test/java/acceptance/events/CreateHistoryEventOnCancelClaimAccTest.java", "diffHunk": "@@ -0,0 +1,60 @@\n+package acceptance.events;\n+\n+import static org.assertj.core.api.Assertions.assertThat;\n+\n+import acceptance.AbstractAccTest;\n+import acceptance.security.JaasExtension;\n+import acceptance.security.WithAccessId;\n+import java.util.List;\n+import org.junit.jupiter.api.BeforeEach;\n+import org.junit.jupiter.api.Test;\n+import org.junit.jupiter.api.extension.ExtendWith;\n+\n+import pro.taskana.simplehistory.impl.HistoryEventImpl;\n+import pro.taskana.simplehistory.impl.HistoryQueryImpl;\n+import pro.taskana.simplehistory.impl.SimpleHistoryServiceImpl;\n+import pro.taskana.simplehistory.impl.mappings.HistoryQueryMapper;\n+import pro.taskana.task.api.TaskService;\n+import pro.taskana.task.api.TaskState;\n+import pro.taskana.task.api.models.Task;\n+\n+@ExtendWith(JaasExtension.class)\n+class CreateHistoryEventOnCancelClaimAccTest extends AbstractAccTest {\n+\n+  private TaskService taskService;\n+  private SimpleHistoryServiceImpl historyService;\n+\n+  @BeforeEach\n+  public void setUp() {\n+\n+    taskService = taskanaEngine.getTaskService();\n+    historyService = getHistoryService();\n+  }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c60d23b03bef2ed18d6854a69ea315a34a6e0981"}, "originalPosition": 32}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjczOTQ5NjM2OnYy", "diffSide": "RIGHT", "path": "history/taskana-simplehistory-provider/src/test/java/acceptance/events/CreateHistoryEventOnClaimAccTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xM1QxNTowNDoxN1rOGjX8gQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xM1QxNTowNDoxN1rOGjX8gQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTc0NTY2NQ==", "bodyText": "initalize fields directly", "url": "https://github.com/Taskana/taskana/pull/1118#discussion_r439745665", "createdAt": "2020-06-13T15:04:17Z", "author": {"login": "mustaphazorgati"}, "path": "history/taskana-simplehistory-provider/src/test/java/acceptance/events/CreateHistoryEventOnClaimAccTest.java", "diffHunk": "@@ -0,0 +1,60 @@\n+package acceptance.events;\n+\n+import static org.assertj.core.api.Assertions.assertThat;\n+\n+import acceptance.AbstractAccTest;\n+import acceptance.security.JaasExtension;\n+import acceptance.security.WithAccessId;\n+import java.util.List;\n+import org.junit.jupiter.api.BeforeEach;\n+import org.junit.jupiter.api.Test;\n+import org.junit.jupiter.api.extension.ExtendWith;\n+\n+import pro.taskana.simplehistory.impl.HistoryEventImpl;\n+import pro.taskana.simplehistory.impl.HistoryQueryImpl;\n+import pro.taskana.simplehistory.impl.SimpleHistoryServiceImpl;\n+import pro.taskana.simplehistory.impl.mappings.HistoryQueryMapper;\n+import pro.taskana.task.api.TaskService;\n+import pro.taskana.task.api.TaskState;\n+import pro.taskana.task.api.models.Task;\n+\n+@ExtendWith(JaasExtension.class)\n+class CreateHistoryEventOnClaimAccTest extends AbstractAccTest {\n+\n+  private TaskService taskService;\n+  private SimpleHistoryServiceImpl historyService;\n+\n+  @BeforeEach\n+  public void setUp() {\n+\n+    taskService = taskanaEngine.getTaskService();\n+    historyService = getHistoryService();\n+  }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c60d23b03bef2ed18d6854a69ea315a34a6e0981"}, "originalPosition": 32}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjczOTQ5Njk2OnYy", "diffSide": "RIGHT", "path": "history/taskana-simplehistory-provider/src/test/java/acceptance/events/CreateHistoryEventOnCompletionAccTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xM1QxNTowNToyNlrOGjX8zQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xM1QxNTowNToyNlrOGjX8zQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTc0NTc0MQ==", "bodyText": "initialize field directly", "url": "https://github.com/Taskana/taskana/pull/1118#discussion_r439745741", "createdAt": "2020-06-13T15:05:26Z", "author": {"login": "mustaphazorgati"}, "path": "history/taskana-simplehistory-provider/src/test/java/acceptance/events/CreateHistoryEventOnCompletionAccTest.java", "diffHunk": "@@ -0,0 +1,58 @@\n+package acceptance.events;\n+\n+import static org.assertj.core.api.Assertions.assertThat;\n+\n+import acceptance.AbstractAccTest;\n+import acceptance.security.JaasExtension;\n+import acceptance.security.WithAccessId;\n+import java.util.List;\n+import org.junit.jupiter.api.BeforeEach;\n+import org.junit.jupiter.api.Test;\n+import org.junit.jupiter.api.extension.ExtendWith;\n+\n+import pro.taskana.simplehistory.impl.HistoryEventImpl;\n+import pro.taskana.simplehistory.impl.HistoryQueryImpl;\n+import pro.taskana.simplehistory.impl.SimpleHistoryServiceImpl;\n+import pro.taskana.simplehistory.impl.mappings.HistoryQueryMapper;\n+import pro.taskana.task.api.TaskService;\n+import pro.taskana.task.api.TaskState;\n+\n+@ExtendWith(JaasExtension.class)\n+class CreateHistoryEventOnCompletionAccTest extends AbstractAccTest {\n+\n+  private TaskService taskService;\n+  private SimpleHistoryServiceImpl historyService;\n+\n+  @BeforeEach\n+  public void setUp() {\n+\n+    taskService = taskanaEngine.getTaskService();\n+    historyService = getHistoryService();\n+  }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c60d23b03bef2ed18d6854a69ea315a34a6e0981"}, "originalPosition": 31}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjczOTQ5NzQ3OnYy", "diffSide": "RIGHT", "path": "history/taskana-simplehistory-provider/src/test/java/acceptance/events/CreateHistoryEventOnCompletionAccTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xM1QxNTowNjoxOVrOGjX9DQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xM1QxNTowNjoxOVrOGjX9DQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTc0NTgwNQ==", "bodyText": "like the other tests please verify that the task is completed.", "url": "https://github.com/Taskana/taskana/pull/1118#discussion_r439745805", "createdAt": "2020-06-13T15:06:19Z", "author": {"login": "mustaphazorgati"}, "path": "history/taskana-simplehistory-provider/src/test/java/acceptance/events/CreateHistoryEventOnCompletionAccTest.java", "diffHunk": "@@ -0,0 +1,58 @@\n+package acceptance.events;\n+\n+import static org.assertj.core.api.Assertions.assertThat;\n+\n+import acceptance.AbstractAccTest;\n+import acceptance.security.JaasExtension;\n+import acceptance.security.WithAccessId;\n+import java.util.List;\n+import org.junit.jupiter.api.BeforeEach;\n+import org.junit.jupiter.api.Test;\n+import org.junit.jupiter.api.extension.ExtendWith;\n+\n+import pro.taskana.simplehistory.impl.HistoryEventImpl;\n+import pro.taskana.simplehistory.impl.HistoryQueryImpl;\n+import pro.taskana.simplehistory.impl.SimpleHistoryServiceImpl;\n+import pro.taskana.simplehistory.impl.mappings.HistoryQueryMapper;\n+import pro.taskana.task.api.TaskService;\n+import pro.taskana.task.api.TaskState;\n+\n+@ExtendWith(JaasExtension.class)\n+class CreateHistoryEventOnCompletionAccTest extends AbstractAccTest {\n+\n+  private TaskService taskService;\n+  private SimpleHistoryServiceImpl historyService;\n+\n+  @BeforeEach\n+  public void setUp() {\n+\n+    taskService = taskanaEngine.getTaskService();\n+    historyService = getHistoryService();\n+  }\n+\n+  @WithAccessId(user = \"admin\")\n+  @Test\n+  void should_CreateCompletedHistoryEvent_When_TaskIsCompleted() throws Exception {\n+\n+    final String taskId = \"TKI:000000000000000000000000000000000001\";\n+\n+    HistoryQueryMapper historyQueryMapper = getHistoryQueryMapper();\n+\n+    List<HistoryEventImpl> listEvents =\n+        historyQueryMapper.queryHistoryEvent(\n+            (HistoryQueryImpl) historyService.createHistoryQuery().taskIdIn(taskId));\n+\n+    assertThat(listEvents).hasSize(0);\n+\n+    assertThat(taskService.getTask(taskId).getState()).isEqualTo(TaskState.CLAIMED);\n+    taskService.forceCompleteTask(taskId);\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c60d23b03bef2ed18d6854a69ea315a34a6e0981"}, "originalPosition": 49}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjczOTQ5NzUzOnYy", "diffSide": "RIGHT", "path": "history/taskana-simplehistory-provider/src/test/java/acceptance/events/CreateHistoryEventOnTaskCreationAccTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xM1QxNTowNjozM1rOGjX9Fw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xM1QxNTowNjozM1rOGjX9Fw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTc0NTgxNQ==", "bodyText": "Initialize fields directly :)", "url": "https://github.com/Taskana/taskana/pull/1118#discussion_r439745815", "createdAt": "2020-06-13T15:06:33Z", "author": {"login": "mustaphazorgati"}, "path": "history/taskana-simplehistory-provider/src/test/java/acceptance/events/CreateHistoryEventOnTaskCreationAccTest.java", "diffHunk": "@@ -0,0 +1,65 @@\n+package acceptance.events;\n+\n+import static org.assertj.core.api.Assertions.assertThat;\n+\n+import acceptance.AbstractAccTest;\n+import acceptance.security.JaasExtension;\n+import acceptance.security.WithAccessId;\n+import java.util.List;\n+import org.junit.jupiter.api.BeforeEach;\n+import org.junit.jupiter.api.Test;\n+import org.junit.jupiter.api.extension.ExtendWith;\n+\n+import pro.taskana.simplehistory.impl.HistoryEventImpl;\n+import pro.taskana.simplehistory.impl.HistoryQueryImpl;\n+import pro.taskana.simplehistory.impl.SimpleHistoryServiceImpl;\n+import pro.taskana.simplehistory.impl.mappings.HistoryQueryMapper;\n+import pro.taskana.task.api.TaskService;\n+import pro.taskana.task.api.models.ObjectReference;\n+import pro.taskana.task.internal.models.TaskImpl;\n+\n+@ExtendWith(JaasExtension.class)\n+class CreateHistoryEventOnTaskCreationAccTest extends AbstractAccTest {\n+\n+  private TaskService taskService;\n+  private SimpleHistoryServiceImpl historyService;\n+\n+  @BeforeEach\n+  public void setUp() {\n+\n+    taskService = taskanaEngine.getTaskService();\n+    historyService = getHistoryService();\n+  }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c60d23b03bef2ed18d6854a69ea315a34a6e0981"}, "originalPosition": 32}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjczOTQ5ODIyOnYy", "diffSide": "RIGHT", "path": "history/taskana-simplehistory-provider/src/test/java/acceptance/events/CreateHistoryEventOnTaskCreationAccTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xM1QxNTowNzo0OVrOGjX9Zw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xM1QxNTowNzo0OVrOGjX9Zw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTc0NTg5NQ==", "bodyText": "please move to AbstractAccTest", "url": "https://github.com/Taskana/taskana/pull/1118#discussion_r439745895", "createdAt": "2020-06-13T15:07:49Z", "author": {"login": "mustaphazorgati"}, "path": "history/taskana-simplehistory-provider/src/test/java/acceptance/events/CreateHistoryEventOnTaskCreationAccTest.java", "diffHunk": "@@ -0,0 +1,65 @@\n+package acceptance.events;\n+\n+import static org.assertj.core.api.Assertions.assertThat;\n+\n+import acceptance.AbstractAccTest;\n+import acceptance.security.JaasExtension;\n+import acceptance.security.WithAccessId;\n+import java.util.List;\n+import org.junit.jupiter.api.BeforeEach;\n+import org.junit.jupiter.api.Test;\n+import org.junit.jupiter.api.extension.ExtendWith;\n+\n+import pro.taskana.simplehistory.impl.HistoryEventImpl;\n+import pro.taskana.simplehistory.impl.HistoryQueryImpl;\n+import pro.taskana.simplehistory.impl.SimpleHistoryServiceImpl;\n+import pro.taskana.simplehistory.impl.mappings.HistoryQueryMapper;\n+import pro.taskana.task.api.TaskService;\n+import pro.taskana.task.api.models.ObjectReference;\n+import pro.taskana.task.internal.models.TaskImpl;\n+\n+@ExtendWith(JaasExtension.class)\n+class CreateHistoryEventOnTaskCreationAccTest extends AbstractAccTest {\n+\n+  private TaskService taskService;\n+  private SimpleHistoryServiceImpl historyService;\n+\n+  @BeforeEach\n+  public void setUp() {\n+\n+    taskService = taskanaEngine.getTaskService();\n+    historyService = getHistoryService();\n+  }\n+\n+  protected ObjectReference createObjectRef(\n+      String company, String system, String systemInstance, String type, String value) {\n+    ObjectReference objectRef = new ObjectReference();\n+    objectRef.setCompany(company);\n+    objectRef.setSystem(system);\n+    objectRef.setSystemInstance(systemInstance);\n+    objectRef.setType(type);\n+    objectRef.setValue(value);\n+    return objectRef;\n+  }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c60d23b03bef2ed18d6854a69ea315a34a6e0981"}, "originalPosition": 43}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjczOTQ5ODgzOnYy", "diffSide": "RIGHT", "path": "history/taskana-simplehistory-provider/src/test/java/acceptance/events/CreateHistoryEventOnTaskCreationAccTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xM1QxNTowODo1N1rOGjX9uA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xM1QxNTowODo1N1rOGjX9uA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTc0NTk3Ng==", "bodyText": "Why do you have to cast here? Is this the regular usage for the user aswell?", "url": "https://github.com/Taskana/taskana/pull/1118#discussion_r439745976", "createdAt": "2020-06-13T15:08:57Z", "author": {"login": "mustaphazorgati"}, "path": "history/taskana-simplehistory-provider/src/test/java/acceptance/events/CreateHistoryEventOnTaskCreationAccTest.java", "diffHunk": "@@ -0,0 +1,65 @@\n+package acceptance.events;\n+\n+import static org.assertj.core.api.Assertions.assertThat;\n+\n+import acceptance.AbstractAccTest;\n+import acceptance.security.JaasExtension;\n+import acceptance.security.WithAccessId;\n+import java.util.List;\n+import org.junit.jupiter.api.BeforeEach;\n+import org.junit.jupiter.api.Test;\n+import org.junit.jupiter.api.extension.ExtendWith;\n+\n+import pro.taskana.simplehistory.impl.HistoryEventImpl;\n+import pro.taskana.simplehistory.impl.HistoryQueryImpl;\n+import pro.taskana.simplehistory.impl.SimpleHistoryServiceImpl;\n+import pro.taskana.simplehistory.impl.mappings.HistoryQueryMapper;\n+import pro.taskana.task.api.TaskService;\n+import pro.taskana.task.api.models.ObjectReference;\n+import pro.taskana.task.internal.models.TaskImpl;\n+\n+@ExtendWith(JaasExtension.class)\n+class CreateHistoryEventOnTaskCreationAccTest extends AbstractAccTest {\n+\n+  private TaskService taskService;\n+  private SimpleHistoryServiceImpl historyService;\n+\n+  @BeforeEach\n+  public void setUp() {\n+\n+    taskService = taskanaEngine.getTaskService();\n+    historyService = getHistoryService();\n+  }\n+\n+  protected ObjectReference createObjectRef(\n+      String company, String system, String systemInstance, String type, String value) {\n+    ObjectReference objectRef = new ObjectReference();\n+    objectRef.setCompany(company);\n+    objectRef.setSystem(system);\n+    objectRef.setSystemInstance(systemInstance);\n+    objectRef.setType(type);\n+    objectRef.setValue(value);\n+    return objectRef;\n+  }\n+\n+  @Test\n+  @WithAccessId(user = \"admin\")\n+  void should_CreateCreatedHistoryEvent_When_TaskIsCreated() throws Exception {\n+\n+    TaskImpl newTask = (TaskImpl) taskService.newTask(\"WBI:100000000000000000000000000000000006\");\n+    newTask.setClassificationKey(\"T2100\");\n+    ObjectReference objectReference =\n+        createObjectRef(\"COMPANY_A\", \"SYSTEM_A\", \"INSTANCE_A\", \"VNR\", \"1234567\");\n+    newTask.setPrimaryObjRef(objectReference);\n+    taskService.createTask(newTask);\n+\n+    HistoryQueryMapper historyQueryMapper = getHistoryQueryMapper();\n+\n+    List<HistoryEventImpl> listEvents =\n+        historyQueryMapper.queryHistoryEvent(\n+            (HistoryQueryImpl) historyService.createHistoryQuery().taskIdIn(newTask.getId()));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c60d23b03bef2ed18d6854a69ea315a34a6e0981"}, "originalPosition": 60}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjczOTQ5ODkxOnYy", "diffSide": "RIGHT", "path": "history/taskana-simplehistory-provider/src/test/java/acceptance/events/CreateHistoryEventOnTaskUpdateAccTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xM1QxNTowOToxN1rOGjX9xw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xM1QxNTowOToxN1rOGjX9xw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTc0NTk5MQ==", "bodyText": "Initialize fields directly", "url": "https://github.com/Taskana/taskana/pull/1118#discussion_r439745991", "createdAt": "2020-06-13T15:09:17Z", "author": {"login": "mustaphazorgati"}, "path": "history/taskana-simplehistory-provider/src/test/java/acceptance/events/CreateHistoryEventOnTaskUpdateAccTest.java", "diffHunk": "@@ -0,0 +1,60 @@\n+package acceptance.events;\n+\n+import static org.assertj.core.api.Assertions.assertThat;\n+\n+import acceptance.AbstractAccTest;\n+import acceptance.security.JaasExtension;\n+import acceptance.security.WithAccessId;\n+import java.util.List;\n+import org.junit.jupiter.api.BeforeEach;\n+import org.junit.jupiter.api.Test;\n+import org.junit.jupiter.api.extension.ExtendWith;\n+\n+import pro.taskana.simplehistory.impl.HistoryEventImpl;\n+import pro.taskana.simplehistory.impl.HistoryQueryImpl;\n+import pro.taskana.simplehistory.impl.SimpleHistoryServiceImpl;\n+import pro.taskana.simplehistory.impl.mappings.HistoryQueryMapper;\n+import pro.taskana.task.api.TaskService;\n+import pro.taskana.task.api.models.Task;\n+\n+@ExtendWith(JaasExtension.class)\n+class CreateHistoryEventOnTaskUpdateAccTest extends AbstractAccTest {\n+\n+  private TaskService taskService;\n+  private SimpleHistoryServiceImpl historyService;\n+\n+  @BeforeEach\n+  public void setUp() {\n+\n+    taskService = taskanaEngine.getTaskService();\n+    historyService = getHistoryService();\n+  }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c60d23b03bef2ed18d6854a69ea315a34a6e0981"}, "originalPosition": 31}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjczOTQ5OTE2OnYy", "diffSide": "RIGHT", "path": "history/taskana-simplehistory-provider/src/test/java/acceptance/events/CreateHistoryEventOnTaskUpdateAccTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xM1QxNToxMDowMlrOGjX97Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xM1QxNToxMDowMlrOGjX97Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTc0NjAyOQ==", "bodyText": "should we (in general) specify the asserts a little more?", "url": "https://github.com/Taskana/taskana/pull/1118#discussion_r439746029", "createdAt": "2020-06-13T15:10:02Z", "author": {"login": "mustaphazorgati"}, "path": "history/taskana-simplehistory-provider/src/test/java/acceptance/events/CreateHistoryEventOnTaskUpdateAccTest.java", "diffHunk": "@@ -0,0 +1,60 @@\n+package acceptance.events;\n+\n+import static org.assertj.core.api.Assertions.assertThat;\n+\n+import acceptance.AbstractAccTest;\n+import acceptance.security.JaasExtension;\n+import acceptance.security.WithAccessId;\n+import java.util.List;\n+import org.junit.jupiter.api.BeforeEach;\n+import org.junit.jupiter.api.Test;\n+import org.junit.jupiter.api.extension.ExtendWith;\n+\n+import pro.taskana.simplehistory.impl.HistoryEventImpl;\n+import pro.taskana.simplehistory.impl.HistoryQueryImpl;\n+import pro.taskana.simplehistory.impl.SimpleHistoryServiceImpl;\n+import pro.taskana.simplehistory.impl.mappings.HistoryQueryMapper;\n+import pro.taskana.task.api.TaskService;\n+import pro.taskana.task.api.models.Task;\n+\n+@ExtendWith(JaasExtension.class)\n+class CreateHistoryEventOnTaskUpdateAccTest extends AbstractAccTest {\n+\n+  private TaskService taskService;\n+  private SimpleHistoryServiceImpl historyService;\n+\n+  @BeforeEach\n+  public void setUp() {\n+\n+    taskService = taskanaEngine.getTaskService();\n+    historyService = getHistoryService();\n+  }\n+\n+  @Test\n+  @WithAccessId(user = \"admin\")\n+  void should_CreateUpdatedHistoryEvent_When_TaskIsCreated() throws Exception {\n+\n+    final String taskId = \"TKI:000000000000000000000000000000000000\";\n+    HistoryQueryMapper historyQueryMapper = getHistoryQueryMapper();\n+\n+    List<HistoryEventImpl> listEvents =\n+        historyQueryMapper.queryHistoryEvent(\n+            (HistoryQueryImpl) historyService.createHistoryQuery().taskIdIn(taskId));\n+\n+    assertThat(listEvents).hasSize(2);\n+\n+    Task task = taskService.getTask(taskId);\n+    task.setName(\"someUpdatedName\");\n+    taskService.updateTask(task);\n+\n+    listEvents =\n+        historyQueryMapper.queryHistoryEvent(\n+            (HistoryQueryImpl) historyService.createHistoryQuery().taskIdIn(taskId));\n+\n+    assertThat(listEvents).hasSize(3);\n+    assertThat(listEvents.get(2).getEventType()).isEqualTo(\"TASK_UPDATED\");\n+\n+    assertThat(historyService.getHistoryEvent(listEvents.get(2).getId()).getDetails())\n+        .contains(\"someUpdatedName\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c60d23b03bef2ed18d6854a69ea315a34a6e0981"}, "originalPosition": 58}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjczOTQ5OTMzOnYy", "diffSide": "RIGHT", "path": "history/taskana-simplehistory-provider/src/test/java/acceptance/events/CreateHistoryEventOnTransferAccTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xM1QxNToxMDoxOVrOGjX9_g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xM1QxNToxMDoxOVrOGjX9_g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTc0NjA0Ng==", "bodyText": "Initialize fields directly", "url": "https://github.com/Taskana/taskana/pull/1118#discussion_r439746046", "createdAt": "2020-06-13T15:10:19Z", "author": {"login": "mustaphazorgati"}, "path": "history/taskana-simplehistory-provider/src/test/java/acceptance/events/CreateHistoryEventOnTransferAccTest.java", "diffHunk": "@@ -0,0 +1,56 @@\n+package acceptance.events;\n+\n+import static org.assertj.core.api.Assertions.assertThat;\n+\n+import acceptance.AbstractAccTest;\n+import acceptance.security.JaasExtension;\n+import acceptance.security.WithAccessId;\n+import java.util.List;\n+import org.junit.jupiter.api.BeforeEach;\n+import org.junit.jupiter.api.Test;\n+import org.junit.jupiter.api.extension.ExtendWith;\n+\n+import pro.taskana.simplehistory.impl.HistoryEventImpl;\n+import pro.taskana.simplehistory.impl.HistoryQueryImpl;\n+import pro.taskana.simplehistory.impl.SimpleHistoryServiceImpl;\n+import pro.taskana.simplehistory.impl.mappings.HistoryQueryMapper;\n+import pro.taskana.task.api.TaskService;\n+\n+@ExtendWith(JaasExtension.class)\n+class CreateHistoryEventOnTransferAccTest extends AbstractAccTest {\n+\n+  private TaskService taskService;\n+  private SimpleHistoryServiceImpl historyService;\n+\n+  @BeforeEach\n+  public void setUp() {\n+\n+    taskService = taskanaEngine.getTaskService();\n+    historyService = getHistoryService();\n+  }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c60d23b03bef2ed18d6854a69ea315a34a6e0981"}, "originalPosition": 30}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjczOTQ5OTkyOnYy", "diffSide": "RIGHT", "path": "history/taskana-simplehistory-provider/src/test/java/acceptance/events/DeleteHistoryEventsOnTaskDeletionAccTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xM1QxNToxMToxM1rOGjX-Sg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xM1QxNToxMToxM1rOGjX-Sg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTc0NjEyMg==", "bodyText": "Initialize fields directly", "url": "https://github.com/Taskana/taskana/pull/1118#discussion_r439746122", "createdAt": "2020-06-13T15:11:13Z", "author": {"login": "mustaphazorgati"}, "path": "history/taskana-simplehistory-provider/src/test/java/acceptance/events/DeleteHistoryEventsOnTaskDeletionAccTest.java", "diffHunk": "@@ -0,0 +1,173 @@\n+package acceptance.events;\n+\n+import static org.assertj.core.api.Assertions.assertThat;\n+import static org.assertj.core.api.Assertions.assertThatThrownBy;\n+\n+import acceptance.AbstractAccTest;\n+import acceptance.security.JaasExtension;\n+import acceptance.security.WithAccessId;\n+import java.util.Arrays;\n+import java.util.List;\n+import org.assertj.core.api.ThrowableAssert.ThrowingCallable;\n+import org.junit.jupiter.api.BeforeEach;\n+import org.junit.jupiter.api.Test;\n+import org.junit.jupiter.api.extension.ExtendWith;\n+\n+import pro.taskana.simplehistory.impl.HistoryEventImpl;\n+import pro.taskana.simplehistory.impl.HistoryQueryImpl;\n+import pro.taskana.simplehistory.impl.SimpleHistoryServiceImpl;\n+import pro.taskana.simplehistory.impl.mappings.HistoryQueryMapper;\n+import pro.taskana.task.api.TaskService;\n+import pro.taskana.task.api.exceptions.TaskNotFoundException;\n+\n+@ExtendWith(JaasExtension.class)\n+class DeleteHistoryEventsOnTaskDeletionAccTest extends AbstractAccTest {\n+\n+  private TaskService taskService;\n+  private SimpleHistoryServiceImpl historyService;\n+\n+  @BeforeEach\n+  public void setUp() {\n+\n+    taskService = taskanaEngine.getTaskService();\n+    historyService = getHistoryService();\n+  }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c60d23b03bef2ed18d6854a69ea315a34a6e0981"}, "originalPosition": 34}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjczOTUwMDY2OnYy", "diffSide": "RIGHT", "path": "history/taskana-simplehistory-provider/src/test/java/acceptance/events/DeleteHistoryEventsOnTaskDeletionAccTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xM1QxNToxMjoyNFrOGjX-pw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xM1QxNToxMjoyNFrOGjX-pw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTc0NjIxNQ==", "bodyText": "why are you testing that delete works?", "url": "https://github.com/Taskana/taskana/pull/1118#discussion_r439746215", "createdAt": "2020-06-13T15:12:24Z", "author": {"login": "mustaphazorgati"}, "path": "history/taskana-simplehistory-provider/src/test/java/acceptance/events/DeleteHistoryEventsOnTaskDeletionAccTest.java", "diffHunk": "@@ -0,0 +1,173 @@\n+package acceptance.events;\n+\n+import static org.assertj.core.api.Assertions.assertThat;\n+import static org.assertj.core.api.Assertions.assertThatThrownBy;\n+\n+import acceptance.AbstractAccTest;\n+import acceptance.security.JaasExtension;\n+import acceptance.security.WithAccessId;\n+import java.util.Arrays;\n+import java.util.List;\n+import org.assertj.core.api.ThrowableAssert.ThrowingCallable;\n+import org.junit.jupiter.api.BeforeEach;\n+import org.junit.jupiter.api.Test;\n+import org.junit.jupiter.api.extension.ExtendWith;\n+\n+import pro.taskana.simplehistory.impl.HistoryEventImpl;\n+import pro.taskana.simplehistory.impl.HistoryQueryImpl;\n+import pro.taskana.simplehistory.impl.SimpleHistoryServiceImpl;\n+import pro.taskana.simplehistory.impl.mappings.HistoryQueryMapper;\n+import pro.taskana.task.api.TaskService;\n+import pro.taskana.task.api.exceptions.TaskNotFoundException;\n+\n+@ExtendWith(JaasExtension.class)\n+class DeleteHistoryEventsOnTaskDeletionAccTest extends AbstractAccTest {\n+\n+  private TaskService taskService;\n+  private SimpleHistoryServiceImpl historyService;\n+\n+  @BeforeEach\n+  public void setUp() {\n+\n+    taskService = taskanaEngine.getTaskService();\n+    historyService = getHistoryService();\n+  }\n+\n+  @Test\n+  @WithAccessId(user = \"admin\")\n+  void should_deleteHistoryEvents_When_TaskIsDeleted_With_HistoryDeletionEnabled()\n+      throws Exception {\n+\n+    final String taskid = \"TKI:000000000000000000000000000000000036\";\n+    taskanaEngineConfiguration.setDeleteHistoryOnTaskDeletionEnabled(true);\n+\n+    HistoryQueryMapper historyQueryMapper = getHistoryQueryMapper();\n+\n+    List<HistoryEventImpl> listEvents =\n+        historyQueryMapper.queryHistoryEvent(\n+            (HistoryQueryImpl) historyService.createHistoryQuery().taskIdIn(taskid));\n+    assertThat(listEvents).hasSize(2);\n+\n+    taskService.deleteTask(taskid);\n+\n+    // make sure the task got deleted\n+    ThrowingCallable getDeletedTaskCall =\n+        () -> {\n+          taskService.getTask(taskid);\n+        };\n+\n+    assertThatThrownBy(getDeletedTaskCall).isInstanceOf(TaskNotFoundException.class);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c60d23b03bef2ed18d6854a69ea315a34a6e0981"}, "originalPosition": 59}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjczOTUwMTM1OnYy", "diffSide": "RIGHT", "path": "history/taskana-simplehistory-provider/src/test/java/acceptance/events/DeleteHistoryEventsOnTaskDeletionAccTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xM1QxNToxMzo0MVrOGjX-_A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xM1QxNToxMzo0MVrOGjX-_A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTc0NjMwMA==", "bodyText": "why are you testing that the task got deleted?", "url": "https://github.com/Taskana/taskana/pull/1118#discussion_r439746300", "createdAt": "2020-06-13T15:13:41Z", "author": {"login": "mustaphazorgati"}, "path": "history/taskana-simplehistory-provider/src/test/java/acceptance/events/DeleteHistoryEventsOnTaskDeletionAccTest.java", "diffHunk": "@@ -0,0 +1,173 @@\n+package acceptance.events;\n+\n+import static org.assertj.core.api.Assertions.assertThat;\n+import static org.assertj.core.api.Assertions.assertThatThrownBy;\n+\n+import acceptance.AbstractAccTest;\n+import acceptance.security.JaasExtension;\n+import acceptance.security.WithAccessId;\n+import java.util.Arrays;\n+import java.util.List;\n+import org.assertj.core.api.ThrowableAssert.ThrowingCallable;\n+import org.junit.jupiter.api.BeforeEach;\n+import org.junit.jupiter.api.Test;\n+import org.junit.jupiter.api.extension.ExtendWith;\n+\n+import pro.taskana.simplehistory.impl.HistoryEventImpl;\n+import pro.taskana.simplehistory.impl.HistoryQueryImpl;\n+import pro.taskana.simplehistory.impl.SimpleHistoryServiceImpl;\n+import pro.taskana.simplehistory.impl.mappings.HistoryQueryMapper;\n+import pro.taskana.task.api.TaskService;\n+import pro.taskana.task.api.exceptions.TaskNotFoundException;\n+\n+@ExtendWith(JaasExtension.class)\n+class DeleteHistoryEventsOnTaskDeletionAccTest extends AbstractAccTest {\n+\n+  private TaskService taskService;\n+  private SimpleHistoryServiceImpl historyService;\n+\n+  @BeforeEach\n+  public void setUp() {\n+\n+    taskService = taskanaEngine.getTaskService();\n+    historyService = getHistoryService();\n+  }\n+\n+  @Test\n+  @WithAccessId(user = \"admin\")\n+  void should_deleteHistoryEvents_When_TaskIsDeleted_With_HistoryDeletionEnabled()\n+      throws Exception {\n+\n+    final String taskid = \"TKI:000000000000000000000000000000000036\";\n+    taskanaEngineConfiguration.setDeleteHistoryOnTaskDeletionEnabled(true);\n+\n+    HistoryQueryMapper historyQueryMapper = getHistoryQueryMapper();\n+\n+    List<HistoryEventImpl> listEvents =\n+        historyQueryMapper.queryHistoryEvent(\n+            (HistoryQueryImpl) historyService.createHistoryQuery().taskIdIn(taskid));\n+    assertThat(listEvents).hasSize(2);\n+\n+    taskService.deleteTask(taskid);\n+\n+    // make sure the task got deleted\n+    ThrowingCallable getDeletedTaskCall =\n+        () -> {\n+          taskService.getTask(taskid);\n+        };\n+\n+    assertThatThrownBy(getDeletedTaskCall).isInstanceOf(TaskNotFoundException.class);\n+\n+    listEvents =\n+        historyQueryMapper.queryHistoryEvent(\n+            (HistoryQueryImpl) historyService.createHistoryQuery().taskIdIn(taskid));\n+    assertThat(listEvents).hasSize(0);\n+  }\n+\n+  @Test\n+  @WithAccessId(user = \"admin\")\n+  void should_deleteHistoryEvents_When_TasksAreDeleted_With_HistoryDeletionEnabled()\n+      throws Exception {\n+\n+    final String taskId_1 = \"TKI:000000000000000000000000000000000037\";\n+    final String taskId_2 = \"TKI:000000000000000000000000000000000038\";\n+\n+    taskanaEngineConfiguration.setDeleteHistoryOnTaskDeletionEnabled(true);\n+\n+    HistoryQueryMapper historyQueryMapper = getHistoryQueryMapper();\n+\n+    List<HistoryEventImpl> listEvents =\n+        historyQueryMapper.queryHistoryEvent(\n+            (HistoryQueryImpl) historyService.createHistoryQuery().taskIdIn(taskId_1, taskId_2));\n+    assertThat(listEvents).hasSize(3);\n+\n+    taskService.deleteTasks(Arrays.asList(taskId_1, taskId_2));\n+\n+    // make sure the tasks got deleted\n+    ThrowingCallable getDeletedTaskCall =\n+        () -> {\n+          taskService.getTask(taskId_1);\n+        };\n+    ThrowingCallable getDeletedTaskCall2 =\n+        () -> {\n+          taskService.getTask(taskId_2);\n+        };\n+\n+    assertThatThrownBy(getDeletedTaskCall).isInstanceOf(TaskNotFoundException.class);\n+    assertThatThrownBy(getDeletedTaskCall2).isInstanceOf(TaskNotFoundException.class);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c60d23b03bef2ed18d6854a69ea315a34a6e0981"}, "originalPosition": 97}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjczOTUwMTg5OnYy", "diffSide": "RIGHT", "path": "history/taskana-simplehistory-provider/src/test/java/acceptance/events/DeleteHistoryEventsOnTaskDeletionAccTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xM1QxNToxNTowNlrOGjX_Sw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xM1QxNToxNTowNlrOGjX_Sw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTc0NjM3OQ==", "bodyText": "why are you doing this here? this belongs to should_deleteHistoryEvents_When_TasksAreDeleted_With_HistoryDeletionEnabled and should be disabled after that test (in order to not make the tests dependent from each other)", "url": "https://github.com/Taskana/taskana/pull/1118#discussion_r439746379", "createdAt": "2020-06-13T15:15:06Z", "author": {"login": "mustaphazorgati"}, "path": "history/taskana-simplehistory-provider/src/test/java/acceptance/events/DeleteHistoryEventsOnTaskDeletionAccTest.java", "diffHunk": "@@ -0,0 +1,173 @@\n+package acceptance.events;\n+\n+import static org.assertj.core.api.Assertions.assertThat;\n+import static org.assertj.core.api.Assertions.assertThatThrownBy;\n+\n+import acceptance.AbstractAccTest;\n+import acceptance.security.JaasExtension;\n+import acceptance.security.WithAccessId;\n+import java.util.Arrays;\n+import java.util.List;\n+import org.assertj.core.api.ThrowableAssert.ThrowingCallable;\n+import org.junit.jupiter.api.BeforeEach;\n+import org.junit.jupiter.api.Test;\n+import org.junit.jupiter.api.extension.ExtendWith;\n+\n+import pro.taskana.simplehistory.impl.HistoryEventImpl;\n+import pro.taskana.simplehistory.impl.HistoryQueryImpl;\n+import pro.taskana.simplehistory.impl.SimpleHistoryServiceImpl;\n+import pro.taskana.simplehistory.impl.mappings.HistoryQueryMapper;\n+import pro.taskana.task.api.TaskService;\n+import pro.taskana.task.api.exceptions.TaskNotFoundException;\n+\n+@ExtendWith(JaasExtension.class)\n+class DeleteHistoryEventsOnTaskDeletionAccTest extends AbstractAccTest {\n+\n+  private TaskService taskService;\n+  private SimpleHistoryServiceImpl historyService;\n+\n+  @BeforeEach\n+  public void setUp() {\n+\n+    taskService = taskanaEngine.getTaskService();\n+    historyService = getHistoryService();\n+  }\n+\n+  @Test\n+  @WithAccessId(user = \"admin\")\n+  void should_deleteHistoryEvents_When_TaskIsDeleted_With_HistoryDeletionEnabled()\n+      throws Exception {\n+\n+    final String taskid = \"TKI:000000000000000000000000000000000036\";\n+    taskanaEngineConfiguration.setDeleteHistoryOnTaskDeletionEnabled(true);\n+\n+    HistoryQueryMapper historyQueryMapper = getHistoryQueryMapper();\n+\n+    List<HistoryEventImpl> listEvents =\n+        historyQueryMapper.queryHistoryEvent(\n+            (HistoryQueryImpl) historyService.createHistoryQuery().taskIdIn(taskid));\n+    assertThat(listEvents).hasSize(2);\n+\n+    taskService.deleteTask(taskid);\n+\n+    // make sure the task got deleted\n+    ThrowingCallable getDeletedTaskCall =\n+        () -> {\n+          taskService.getTask(taskid);\n+        };\n+\n+    assertThatThrownBy(getDeletedTaskCall).isInstanceOf(TaskNotFoundException.class);\n+\n+    listEvents =\n+        historyQueryMapper.queryHistoryEvent(\n+            (HistoryQueryImpl) historyService.createHistoryQuery().taskIdIn(taskid));\n+    assertThat(listEvents).hasSize(0);\n+  }\n+\n+  @Test\n+  @WithAccessId(user = \"admin\")\n+  void should_deleteHistoryEvents_When_TasksAreDeleted_With_HistoryDeletionEnabled()\n+      throws Exception {\n+\n+    final String taskId_1 = \"TKI:000000000000000000000000000000000037\";\n+    final String taskId_2 = \"TKI:000000000000000000000000000000000038\";\n+\n+    taskanaEngineConfiguration.setDeleteHistoryOnTaskDeletionEnabled(true);\n+\n+    HistoryQueryMapper historyQueryMapper = getHistoryQueryMapper();\n+\n+    List<HistoryEventImpl> listEvents =\n+        historyQueryMapper.queryHistoryEvent(\n+            (HistoryQueryImpl) historyService.createHistoryQuery().taskIdIn(taskId_1, taskId_2));\n+    assertThat(listEvents).hasSize(3);\n+\n+    taskService.deleteTasks(Arrays.asList(taskId_1, taskId_2));\n+\n+    // make sure the tasks got deleted\n+    ThrowingCallable getDeletedTaskCall =\n+        () -> {\n+          taskService.getTask(taskId_1);\n+        };\n+    ThrowingCallable getDeletedTaskCall2 =\n+        () -> {\n+          taskService.getTask(taskId_2);\n+        };\n+\n+    assertThatThrownBy(getDeletedTaskCall).isInstanceOf(TaskNotFoundException.class);\n+    assertThatThrownBy(getDeletedTaskCall2).isInstanceOf(TaskNotFoundException.class);\n+\n+    listEvents =\n+        historyQueryMapper.queryHistoryEvent(\n+            (HistoryQueryImpl) historyService.createHistoryQuery().taskIdIn(taskId_1, taskId_2));\n+    assertThat(listEvents).hasSize(0);\n+  }\n+\n+  @Test\n+  @WithAccessId(user = \"admin\")\n+  void should_notDeleteHistoryEvents_When_TaskIsDeleted_With_HistoryDeletionDisabled()\n+      throws Exception {\n+\n+    final String taskId = \"TKI:000000000000000000000000000000000039\";\n+\n+    taskanaEngineConfiguration.setDeleteHistoryOnTaskDeletionEnabled(false);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c60d23b03bef2ed18d6854a69ea315a34a6e0981"}, "originalPosition": 112}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjczOTUwMjA0OnYy", "diffSide": "RIGHT", "path": "history/taskana-simplehistory-provider/src/test/java/acceptance/events/DeleteHistoryEventsOnTaskDeletionAccTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xM1QxNToxNToxOVrOGjX_Xw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xM1QxNToxNToxOVrOGjX_Xw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTc0NjM5OQ==", "bodyText": "why are you testing that delete works?", "url": "https://github.com/Taskana/taskana/pull/1118#discussion_r439746399", "createdAt": "2020-06-13T15:15:19Z", "author": {"login": "mustaphazorgati"}, "path": "history/taskana-simplehistory-provider/src/test/java/acceptance/events/DeleteHistoryEventsOnTaskDeletionAccTest.java", "diffHunk": "@@ -0,0 +1,173 @@\n+package acceptance.events;\n+\n+import static org.assertj.core.api.Assertions.assertThat;\n+import static org.assertj.core.api.Assertions.assertThatThrownBy;\n+\n+import acceptance.AbstractAccTest;\n+import acceptance.security.JaasExtension;\n+import acceptance.security.WithAccessId;\n+import java.util.Arrays;\n+import java.util.List;\n+import org.assertj.core.api.ThrowableAssert.ThrowingCallable;\n+import org.junit.jupiter.api.BeforeEach;\n+import org.junit.jupiter.api.Test;\n+import org.junit.jupiter.api.extension.ExtendWith;\n+\n+import pro.taskana.simplehistory.impl.HistoryEventImpl;\n+import pro.taskana.simplehistory.impl.HistoryQueryImpl;\n+import pro.taskana.simplehistory.impl.SimpleHistoryServiceImpl;\n+import pro.taskana.simplehistory.impl.mappings.HistoryQueryMapper;\n+import pro.taskana.task.api.TaskService;\n+import pro.taskana.task.api.exceptions.TaskNotFoundException;\n+\n+@ExtendWith(JaasExtension.class)\n+class DeleteHistoryEventsOnTaskDeletionAccTest extends AbstractAccTest {\n+\n+  private TaskService taskService;\n+  private SimpleHistoryServiceImpl historyService;\n+\n+  @BeforeEach\n+  public void setUp() {\n+\n+    taskService = taskanaEngine.getTaskService();\n+    historyService = getHistoryService();\n+  }\n+\n+  @Test\n+  @WithAccessId(user = \"admin\")\n+  void should_deleteHistoryEvents_When_TaskIsDeleted_With_HistoryDeletionEnabled()\n+      throws Exception {\n+\n+    final String taskid = \"TKI:000000000000000000000000000000000036\";\n+    taskanaEngineConfiguration.setDeleteHistoryOnTaskDeletionEnabled(true);\n+\n+    HistoryQueryMapper historyQueryMapper = getHistoryQueryMapper();\n+\n+    List<HistoryEventImpl> listEvents =\n+        historyQueryMapper.queryHistoryEvent(\n+            (HistoryQueryImpl) historyService.createHistoryQuery().taskIdIn(taskid));\n+    assertThat(listEvents).hasSize(2);\n+\n+    taskService.deleteTask(taskid);\n+\n+    // make sure the task got deleted\n+    ThrowingCallable getDeletedTaskCall =\n+        () -> {\n+          taskService.getTask(taskid);\n+        };\n+\n+    assertThatThrownBy(getDeletedTaskCall).isInstanceOf(TaskNotFoundException.class);\n+\n+    listEvents =\n+        historyQueryMapper.queryHistoryEvent(\n+            (HistoryQueryImpl) historyService.createHistoryQuery().taskIdIn(taskid));\n+    assertThat(listEvents).hasSize(0);\n+  }\n+\n+  @Test\n+  @WithAccessId(user = \"admin\")\n+  void should_deleteHistoryEvents_When_TasksAreDeleted_With_HistoryDeletionEnabled()\n+      throws Exception {\n+\n+    final String taskId_1 = \"TKI:000000000000000000000000000000000037\";\n+    final String taskId_2 = \"TKI:000000000000000000000000000000000038\";\n+\n+    taskanaEngineConfiguration.setDeleteHistoryOnTaskDeletionEnabled(true);\n+\n+    HistoryQueryMapper historyQueryMapper = getHistoryQueryMapper();\n+\n+    List<HistoryEventImpl> listEvents =\n+        historyQueryMapper.queryHistoryEvent(\n+            (HistoryQueryImpl) historyService.createHistoryQuery().taskIdIn(taskId_1, taskId_2));\n+    assertThat(listEvents).hasSize(3);\n+\n+    taskService.deleteTasks(Arrays.asList(taskId_1, taskId_2));\n+\n+    // make sure the tasks got deleted\n+    ThrowingCallable getDeletedTaskCall =\n+        () -> {\n+          taskService.getTask(taskId_1);\n+        };\n+    ThrowingCallable getDeletedTaskCall2 =\n+        () -> {\n+          taskService.getTask(taskId_2);\n+        };\n+\n+    assertThatThrownBy(getDeletedTaskCall).isInstanceOf(TaskNotFoundException.class);\n+    assertThatThrownBy(getDeletedTaskCall2).isInstanceOf(TaskNotFoundException.class);\n+\n+    listEvents =\n+        historyQueryMapper.queryHistoryEvent(\n+            (HistoryQueryImpl) historyService.createHistoryQuery().taskIdIn(taskId_1, taskId_2));\n+    assertThat(listEvents).hasSize(0);\n+  }\n+\n+  @Test\n+  @WithAccessId(user = \"admin\")\n+  void should_notDeleteHistoryEvents_When_TaskIsDeleted_With_HistoryDeletionDisabled()\n+      throws Exception {\n+\n+    final String taskId = \"TKI:000000000000000000000000000000000039\";\n+\n+    taskanaEngineConfiguration.setDeleteHistoryOnTaskDeletionEnabled(false);\n+\n+    HistoryQueryMapper historyQueryMapper = getHistoryQueryMapper();\n+\n+    List<HistoryEventImpl> listEvents =\n+        historyQueryMapper.queryHistoryEvent(\n+            (HistoryQueryImpl) historyService.createHistoryQuery().taskIdIn(taskId));\n+    assertThat(listEvents).hasSize(2);\n+\n+    taskService.deleteTask(taskId);\n+\n+    // make sure the task got deleted\n+    ThrowingCallable getDeletedTaskCall =\n+        () -> {\n+          taskService.getTask(taskId);\n+        };\n+\n+    assertThatThrownBy(getDeletedTaskCall).isInstanceOf(TaskNotFoundException.class);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c60d23b03bef2ed18d6854a69ea315a34a6e0981"}, "originalPosition": 129}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjczOTUwMjEyOnYy", "diffSide": "RIGHT", "path": "history/taskana-simplehistory-provider/src/test/java/acceptance/events/DeleteHistoryEventsOnTaskDeletionAccTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xM1QxNToxNTozNFrOGjX_bA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xM1QxNToxNTozNFrOGjX_bA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTc0NjQxMg==", "bodyText": "remove this.", "url": "https://github.com/Taskana/taskana/pull/1118#discussion_r439746412", "createdAt": "2020-06-13T15:15:34Z", "author": {"login": "mustaphazorgati"}, "path": "history/taskana-simplehistory-provider/src/test/java/acceptance/events/DeleteHistoryEventsOnTaskDeletionAccTest.java", "diffHunk": "@@ -0,0 +1,173 @@\n+package acceptance.events;\n+\n+import static org.assertj.core.api.Assertions.assertThat;\n+import static org.assertj.core.api.Assertions.assertThatThrownBy;\n+\n+import acceptance.AbstractAccTest;\n+import acceptance.security.JaasExtension;\n+import acceptance.security.WithAccessId;\n+import java.util.Arrays;\n+import java.util.List;\n+import org.assertj.core.api.ThrowableAssert.ThrowingCallable;\n+import org.junit.jupiter.api.BeforeEach;\n+import org.junit.jupiter.api.Test;\n+import org.junit.jupiter.api.extension.ExtendWith;\n+\n+import pro.taskana.simplehistory.impl.HistoryEventImpl;\n+import pro.taskana.simplehistory.impl.HistoryQueryImpl;\n+import pro.taskana.simplehistory.impl.SimpleHistoryServiceImpl;\n+import pro.taskana.simplehistory.impl.mappings.HistoryQueryMapper;\n+import pro.taskana.task.api.TaskService;\n+import pro.taskana.task.api.exceptions.TaskNotFoundException;\n+\n+@ExtendWith(JaasExtension.class)\n+class DeleteHistoryEventsOnTaskDeletionAccTest extends AbstractAccTest {\n+\n+  private TaskService taskService;\n+  private SimpleHistoryServiceImpl historyService;\n+\n+  @BeforeEach\n+  public void setUp() {\n+\n+    taskService = taskanaEngine.getTaskService();\n+    historyService = getHistoryService();\n+  }\n+\n+  @Test\n+  @WithAccessId(user = \"admin\")\n+  void should_deleteHistoryEvents_When_TaskIsDeleted_With_HistoryDeletionEnabled()\n+      throws Exception {\n+\n+    final String taskid = \"TKI:000000000000000000000000000000000036\";\n+    taskanaEngineConfiguration.setDeleteHistoryOnTaskDeletionEnabled(true);\n+\n+    HistoryQueryMapper historyQueryMapper = getHistoryQueryMapper();\n+\n+    List<HistoryEventImpl> listEvents =\n+        historyQueryMapper.queryHistoryEvent(\n+            (HistoryQueryImpl) historyService.createHistoryQuery().taskIdIn(taskid));\n+    assertThat(listEvents).hasSize(2);\n+\n+    taskService.deleteTask(taskid);\n+\n+    // make sure the task got deleted\n+    ThrowingCallable getDeletedTaskCall =\n+        () -> {\n+          taskService.getTask(taskid);\n+        };\n+\n+    assertThatThrownBy(getDeletedTaskCall).isInstanceOf(TaskNotFoundException.class);\n+\n+    listEvents =\n+        historyQueryMapper.queryHistoryEvent(\n+            (HistoryQueryImpl) historyService.createHistoryQuery().taskIdIn(taskid));\n+    assertThat(listEvents).hasSize(0);\n+  }\n+\n+  @Test\n+  @WithAccessId(user = \"admin\")\n+  void should_deleteHistoryEvents_When_TasksAreDeleted_With_HistoryDeletionEnabled()\n+      throws Exception {\n+\n+    final String taskId_1 = \"TKI:000000000000000000000000000000000037\";\n+    final String taskId_2 = \"TKI:000000000000000000000000000000000038\";\n+\n+    taskanaEngineConfiguration.setDeleteHistoryOnTaskDeletionEnabled(true);\n+\n+    HistoryQueryMapper historyQueryMapper = getHistoryQueryMapper();\n+\n+    List<HistoryEventImpl> listEvents =\n+        historyQueryMapper.queryHistoryEvent(\n+            (HistoryQueryImpl) historyService.createHistoryQuery().taskIdIn(taskId_1, taskId_2));\n+    assertThat(listEvents).hasSize(3);\n+\n+    taskService.deleteTasks(Arrays.asList(taskId_1, taskId_2));\n+\n+    // make sure the tasks got deleted\n+    ThrowingCallable getDeletedTaskCall =\n+        () -> {\n+          taskService.getTask(taskId_1);\n+        };\n+    ThrowingCallable getDeletedTaskCall2 =\n+        () -> {\n+          taskService.getTask(taskId_2);\n+        };\n+\n+    assertThatThrownBy(getDeletedTaskCall).isInstanceOf(TaskNotFoundException.class);\n+    assertThatThrownBy(getDeletedTaskCall2).isInstanceOf(TaskNotFoundException.class);\n+\n+    listEvents =\n+        historyQueryMapper.queryHistoryEvent(\n+            (HistoryQueryImpl) historyService.createHistoryQuery().taskIdIn(taskId_1, taskId_2));\n+    assertThat(listEvents).hasSize(0);\n+  }\n+\n+  @Test\n+  @WithAccessId(user = \"admin\")\n+  void should_notDeleteHistoryEvents_When_TaskIsDeleted_With_HistoryDeletionDisabled()\n+      throws Exception {\n+\n+    final String taskId = \"TKI:000000000000000000000000000000000039\";\n+\n+    taskanaEngineConfiguration.setDeleteHistoryOnTaskDeletionEnabled(false);\n+\n+    HistoryQueryMapper historyQueryMapper = getHistoryQueryMapper();\n+\n+    List<HistoryEventImpl> listEvents =\n+        historyQueryMapper.queryHistoryEvent(\n+            (HistoryQueryImpl) historyService.createHistoryQuery().taskIdIn(taskId));\n+    assertThat(listEvents).hasSize(2);\n+\n+    taskService.deleteTask(taskId);\n+\n+    // make sure the task got deleted\n+    ThrowingCallable getDeletedTaskCall =\n+        () -> {\n+          taskService.getTask(taskId);\n+        };\n+\n+    assertThatThrownBy(getDeletedTaskCall).isInstanceOf(TaskNotFoundException.class);\n+\n+    listEvents =\n+        historyQueryMapper.queryHistoryEvent(\n+            (HistoryQueryImpl) historyService.createHistoryQuery().taskIdIn(taskId));\n+    assertThat(listEvents).hasSize(2);\n+  }\n+\n+  @Test\n+  @WithAccessId(user = \"admin\")\n+  void should_notDeleteHistoryEvents_When_TasksAreDeleted_With_HistoryDeletionDisabled()\n+      throws Exception {\n+    final String taskId_1 = \"TKI:000000000000000000000000000000000040\";\n+    final String taskId_2 = \"TKI:000000000000000000000000000000000068\";\n+\n+    taskanaEngineConfiguration.setDeleteHistoryOnTaskDeletionEnabled(false);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c60d23b03bef2ed18d6854a69ea315a34a6e0981"}, "originalPosition": 144}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjczOTUwMjM5OnYy", "diffSide": "RIGHT", "path": "history/taskana-simplehistory-provider/src/test/java/acceptance/events/DeleteHistoryEventsOnTaskDeletionAccTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xM1QxNToxNjowM1rOGjX_lQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xM1QxNToxNjowM1rOGjX_lQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTc0NjQ1Mw==", "bodyText": "why are you testing that the deletion works?", "url": "https://github.com/Taskana/taskana/pull/1118#discussion_r439746453", "createdAt": "2020-06-13T15:16:03Z", "author": {"login": "mustaphazorgati"}, "path": "history/taskana-simplehistory-provider/src/test/java/acceptance/events/DeleteHistoryEventsOnTaskDeletionAccTest.java", "diffHunk": "@@ -0,0 +1,173 @@\n+package acceptance.events;\n+\n+import static org.assertj.core.api.Assertions.assertThat;\n+import static org.assertj.core.api.Assertions.assertThatThrownBy;\n+\n+import acceptance.AbstractAccTest;\n+import acceptance.security.JaasExtension;\n+import acceptance.security.WithAccessId;\n+import java.util.Arrays;\n+import java.util.List;\n+import org.assertj.core.api.ThrowableAssert.ThrowingCallable;\n+import org.junit.jupiter.api.BeforeEach;\n+import org.junit.jupiter.api.Test;\n+import org.junit.jupiter.api.extension.ExtendWith;\n+\n+import pro.taskana.simplehistory.impl.HistoryEventImpl;\n+import pro.taskana.simplehistory.impl.HistoryQueryImpl;\n+import pro.taskana.simplehistory.impl.SimpleHistoryServiceImpl;\n+import pro.taskana.simplehistory.impl.mappings.HistoryQueryMapper;\n+import pro.taskana.task.api.TaskService;\n+import pro.taskana.task.api.exceptions.TaskNotFoundException;\n+\n+@ExtendWith(JaasExtension.class)\n+class DeleteHistoryEventsOnTaskDeletionAccTest extends AbstractAccTest {\n+\n+  private TaskService taskService;\n+  private SimpleHistoryServiceImpl historyService;\n+\n+  @BeforeEach\n+  public void setUp() {\n+\n+    taskService = taskanaEngine.getTaskService();\n+    historyService = getHistoryService();\n+  }\n+\n+  @Test\n+  @WithAccessId(user = \"admin\")\n+  void should_deleteHistoryEvents_When_TaskIsDeleted_With_HistoryDeletionEnabled()\n+      throws Exception {\n+\n+    final String taskid = \"TKI:000000000000000000000000000000000036\";\n+    taskanaEngineConfiguration.setDeleteHistoryOnTaskDeletionEnabled(true);\n+\n+    HistoryQueryMapper historyQueryMapper = getHistoryQueryMapper();\n+\n+    List<HistoryEventImpl> listEvents =\n+        historyQueryMapper.queryHistoryEvent(\n+            (HistoryQueryImpl) historyService.createHistoryQuery().taskIdIn(taskid));\n+    assertThat(listEvents).hasSize(2);\n+\n+    taskService.deleteTask(taskid);\n+\n+    // make sure the task got deleted\n+    ThrowingCallable getDeletedTaskCall =\n+        () -> {\n+          taskService.getTask(taskid);\n+        };\n+\n+    assertThatThrownBy(getDeletedTaskCall).isInstanceOf(TaskNotFoundException.class);\n+\n+    listEvents =\n+        historyQueryMapper.queryHistoryEvent(\n+            (HistoryQueryImpl) historyService.createHistoryQuery().taskIdIn(taskid));\n+    assertThat(listEvents).hasSize(0);\n+  }\n+\n+  @Test\n+  @WithAccessId(user = \"admin\")\n+  void should_deleteHistoryEvents_When_TasksAreDeleted_With_HistoryDeletionEnabled()\n+      throws Exception {\n+\n+    final String taskId_1 = \"TKI:000000000000000000000000000000000037\";\n+    final String taskId_2 = \"TKI:000000000000000000000000000000000038\";\n+\n+    taskanaEngineConfiguration.setDeleteHistoryOnTaskDeletionEnabled(true);\n+\n+    HistoryQueryMapper historyQueryMapper = getHistoryQueryMapper();\n+\n+    List<HistoryEventImpl> listEvents =\n+        historyQueryMapper.queryHistoryEvent(\n+            (HistoryQueryImpl) historyService.createHistoryQuery().taskIdIn(taskId_1, taskId_2));\n+    assertThat(listEvents).hasSize(3);\n+\n+    taskService.deleteTasks(Arrays.asList(taskId_1, taskId_2));\n+\n+    // make sure the tasks got deleted\n+    ThrowingCallable getDeletedTaskCall =\n+        () -> {\n+          taskService.getTask(taskId_1);\n+        };\n+    ThrowingCallable getDeletedTaskCall2 =\n+        () -> {\n+          taskService.getTask(taskId_2);\n+        };\n+\n+    assertThatThrownBy(getDeletedTaskCall).isInstanceOf(TaskNotFoundException.class);\n+    assertThatThrownBy(getDeletedTaskCall2).isInstanceOf(TaskNotFoundException.class);\n+\n+    listEvents =\n+        historyQueryMapper.queryHistoryEvent(\n+            (HistoryQueryImpl) historyService.createHistoryQuery().taskIdIn(taskId_1, taskId_2));\n+    assertThat(listEvents).hasSize(0);\n+  }\n+\n+  @Test\n+  @WithAccessId(user = \"admin\")\n+  void should_notDeleteHistoryEvents_When_TaskIsDeleted_With_HistoryDeletionDisabled()\n+      throws Exception {\n+\n+    final String taskId = \"TKI:000000000000000000000000000000000039\";\n+\n+    taskanaEngineConfiguration.setDeleteHistoryOnTaskDeletionEnabled(false);\n+\n+    HistoryQueryMapper historyQueryMapper = getHistoryQueryMapper();\n+\n+    List<HistoryEventImpl> listEvents =\n+        historyQueryMapper.queryHistoryEvent(\n+            (HistoryQueryImpl) historyService.createHistoryQuery().taskIdIn(taskId));\n+    assertThat(listEvents).hasSize(2);\n+\n+    taskService.deleteTask(taskId);\n+\n+    // make sure the task got deleted\n+    ThrowingCallable getDeletedTaskCall =\n+        () -> {\n+          taskService.getTask(taskId);\n+        };\n+\n+    assertThatThrownBy(getDeletedTaskCall).isInstanceOf(TaskNotFoundException.class);\n+\n+    listEvents =\n+        historyQueryMapper.queryHistoryEvent(\n+            (HistoryQueryImpl) historyService.createHistoryQuery().taskIdIn(taskId));\n+    assertThat(listEvents).hasSize(2);\n+  }\n+\n+  @Test\n+  @WithAccessId(user = \"admin\")\n+  void should_notDeleteHistoryEvents_When_TasksAreDeleted_With_HistoryDeletionDisabled()\n+      throws Exception {\n+    final String taskId_1 = \"TKI:000000000000000000000000000000000040\";\n+    final String taskId_2 = \"TKI:000000000000000000000000000000000068\";\n+\n+    taskanaEngineConfiguration.setDeleteHistoryOnTaskDeletionEnabled(false);\n+\n+    HistoryQueryMapper historyQueryMapper = getHistoryQueryMapper();\n+\n+    List<HistoryEventImpl> listEvents =\n+        historyQueryMapper.queryHistoryEvent(\n+            (HistoryQueryImpl) historyService.createHistoryQuery().taskIdIn(taskId_1, taskId_2));\n+    assertThat(listEvents).hasSize(2);\n+\n+    taskService.deleteTasks(Arrays.asList(taskId_1, taskId_2));\n+\n+    // make sure the tasks got deleted\n+    ThrowingCallable getDeletedTaskCall =\n+        () -> {\n+          taskService.getTask(taskId_1);\n+        };\n+    ThrowingCallable getDeletedTaskCall2 =\n+        () -> {\n+          taskService.getTask(taskId_2);\n+        };\n+\n+    assertThatThrownBy(getDeletedTaskCall).isInstanceOf(TaskNotFoundException.class);\n+    assertThatThrownBy(getDeletedTaskCall2).isInstanceOf(TaskNotFoundException.class);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c60d23b03bef2ed18d6854a69ea315a34a6e0981"}, "originalPosition": 166}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjczOTUxMDI2OnYy", "diffSide": "RIGHT", "path": "history/taskana-simplehistory-rest-spring/src/main/resources/sql.sample-data/history-event.sql", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xM1QxNTozMzoxNVrOGjYDfA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xM1QxNTozMzoxNVrOGjYDfA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTc0NzQ1Mg==", "bodyText": "I didn't look over this diff. I am trusting you on this file ;)", "url": "https://github.com/Taskana/taskana/pull/1118#discussion_r439747452", "createdAt": "2020-06-13T15:33:15Z", "author": {"login": "mustaphazorgati"}, "path": "history/taskana-simplehistory-rest-spring/src/main/resources/sql.sample-data/history-event.sql", "diffHunk": "@@ -1,47 +1,47 @@\n-INSERT INTO HISTORY_EVENTS (BUSINESS_PROCESS_ID, PARENT_BUSINESS_PROCESS_ID, TASK_ID, EVENT_TYPE, CREATED, USER_ID, DOMAIN, WORKBASKET_KEY, POR_COMPANY, POR_SYSTEM, POR_INSTANCE, POR_TYPE, POR_VALUE, TASK_CLASSIFICATION_KEY, TASK_CLASSIFICATION_CATEGORY, ATTACHMENT_CLASSIFICATION_KEY, OLD_VALUE, NEW_VALUE, CUSTOM_1, CUSTOM_2, CUSTOM_3, CUSTOM_4, DETAILS) VALUES\n+INSERT INTO HISTORY_EVENTS (ID, BUSINESS_PROCESS_ID, PARENT_BUSINESS_PROCESS_ID, TASK_ID, EVENT_TYPE, CREATED, USER_ID, DOMAIN, WORKBASKET_KEY, POR_COMPANY, POR_SYSTEM, POR_INSTANCE, POR_TYPE, POR_VALUE, TASK_CLASSIFICATION_KEY, TASK_CLASSIFICATION_CATEGORY, ATTACHMENT_CLASSIFICATION_KEY, OLD_VALUE, NEW_VALUE, CUSTOM_1, CUSTOM_2, CUSTOM_3, CUSTOM_4, DETAILS) VALUES", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c60d23b03bef2ed18d6854a69ea315a34a6e0981"}, "originalPosition": 2}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjczOTUxMDY5OnYy", "diffSide": "RIGHT", "path": "lib/taskana-core/src/main/java/pro/taskana/TaskanaEngineConfiguration.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xM1QxNTozNDoyNlrOGjYDsA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xM1QxNTozNDoyNlrOGjYDsA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTc0NzUwNA==", "bodyText": "I like this method a lot :)\nThanks for this!", "url": "https://github.com/Taskana/taskana/pull/1118#discussion_r439747504", "createdAt": "2020-06-13T15:34:26Z", "author": {"login": "mustaphazorgati"}, "path": "lib/taskana-core/src/main/java/pro/taskana/TaskanaEngineConfiguration.java", "diffHunk": "@@ -362,24 +374,21 @@ public static boolean shouldUseLowerCaseForAccessIds() {\n     return true;\n   }\n \n-  private void initGermanHolidaysEnabled(Properties props) {\n-    String enabled = props.getProperty(TASKANA_GERMAN_HOLIDAYS_ENABLED);\n+  private void initBooleanFlag(Properties props, String propName) {\n+    String enabled = props.getProperty(propName);\n     if (enabled != null && !enabled.isEmpty()) {\n-      germanPublicHolidaysEnabled = Boolean.parseBoolean(enabled);\n-    } else {\n-      germanPublicHolidaysEnabled = false;\n+      boolean isEnabled = Boolean.parseBoolean(enabled);\n+      if (propName.equals(TASKANA_GERMAN_HOLIDAYS_ENABLED)) {\n+        germanPublicHolidaysEnabled = isEnabled;\n+      } else if (propName.equals(TASKANA_GERMAN_HOLIDAYS_CORPUS_CHRISTI_ENABLED)) {\n+        corpusChristiEnabled = isEnabled;\n+      } else if (propName.equals(TASKANA_HISTORY_DELETION_ON_TASK_DELETION_ENABLED)) {\n+        deleteHistoryOnTaskDeletionEnabled = isEnabled;\n+      }\n     }\n-    LOGGER.debug(\"GermanPublicHolidaysEnabled = {}\", germanPublicHolidaysEnabled);\n-  }\n-\n-  private void initCorpusChristiEnabled(Properties props) {\n-    String enabled = props.getProperty(TASKANA_GERMAN_HOLIDAYS_CORPUS_CHRISTI_ENABLED);\n-    if (enabled != null && !enabled.isEmpty()) {\n-      corpusChristiEnabled = Boolean.parseBoolean(enabled);\n-    } else {\n-      corpusChristiEnabled = false;\n+    if (LOGGER.isDebugEnabled()) {\n+      LOGGER.debug(String.format(\"%s = %b\", propName, Boolean.parseBoolean(enabled)));\n     }\n-    LOGGER.debug(\"CorpusChristiEnabled = {}\", corpusChristiEnabled);\n   }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c60d23b03bef2ed18d6854a69ea315a34a6e0981"}, "originalPosition": 78}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjczOTUxMjM0OnYy", "diffSide": "RIGHT", "path": "lib/taskana-core/src/main/java/pro/taskana/spi/history/internal/HistoryEventManager.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xM1QxNTozNjozNlrOGjYEdw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xM1QxNTozNjozNlrOGjYEdw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTc0NzcwMw==", "bodyText": "should't we throw this error?", "url": "https://github.com/Taskana/taskana/pull/1118#discussion_r439747703", "createdAt": "2020-06-13T15:36:36Z", "author": {"login": "mustaphazorgati"}, "path": "lib/taskana-core/src/main/java/pro/taskana/spi/history/internal/HistoryEventManager.java", "diffHunk": "@@ -45,4 +50,15 @@ public void createEvent(TaskanaHistoryEvent event) {\n     LOGGER.debug(\"Sending event to history service providers: {}\", event);\n     serviceLoader.forEach(historyProvider -> historyProvider.create(event));\n   }\n+\n+  public void deleteEvents(List<String> taskIds) {\n+    LOGGER.debug(\"Sending taskIds to history service providers: {}\", taskIds);\n+    serviceLoader.forEach(historyProvider -> {\n+      try {\n+        historyProvider.deleteHistoryEventsByTaskIds(taskIds);\n+      } catch (InvalidArgumentException | NotAuthorizedException e) {\n+        LOGGER.warn(\"Caught an exception while trying to delete HistoryEvents\", e);\n+      }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c60d23b03bef2ed18d6854a69ea315a34a6e0981"}, "originalPosition": 59}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjczOTUxMjkyOnYy", "diffSide": "RIGHT", "path": "lib/taskana-core/src/main/java/pro/taskana/task/internal/TaskServiceImpl.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xM1QxNTozNzo1MFrOGjYExA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xM1QxNTozNzo1MFrOGjYExA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTc0Nzc4MA==", "bodyText": "Collections.singletonList() ;)", "url": "https://github.com/Taskana/taskana/pull/1118#discussion_r439747780", "createdAt": "2020-06-13T15:37:50Z", "author": {"login": "mustaphazorgati"}, "path": "lib/taskana-core/src/main/java/pro/taskana/task/internal/TaskServiceImpl.java", "diffHunk": "@@ -1328,7 +1358,14 @@ private void deleteTask(String taskId, boolean forceDelete)\n         throw new InvalidStateException(String.format(TASK_WITH_ID_CALLBACK_NOT_PROCESSED, taskId));\n       }\n \n+      attachmentMapper.deleteMultipleByTaskIds(Arrays.asList(taskId));\n       taskMapper.delete(taskId);\n+\n+      if (taskanaEngine.getEngine().isHistoryEnabled()\n+          && taskanaEngine.getEngine().getConfiguration().isDeleteHistoryOnTaskDeletionEnabled()) {\n+        historyEventManager.deleteEvents(Arrays.asList(taskId));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c60d23b03bef2ed18d6854a69ea315a34a6e0981"}, "originalPosition": 154}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjczOTUxMzIyOnYy", "diffSide": "LEFT", "path": "lib/taskana-core/src/main/resources/sql/h2/taskana-schema-h2.sql", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xM1QxNTozODozM1rOGjYE7A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xM1QxNTozODozM1rOGjYE7A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTc0NzgyMA==", "bodyText": "Reminder: update script", "url": "https://github.com/Taskana/taskana/pull/1118#discussion_r439747820", "createdAt": "2020-06-13T15:38:33Z", "author": {"login": "mustaphazorgati"}, "path": "lib/taskana-core/src/main/resources/sql/h2/taskana-schema-h2.sql", "diffHunk": "@@ -211,7 +211,7 @@ CREATE TABLE SCHEDULED_JOB(\n \n CREATE TABLE HISTORY_EVENTS\n (\n-    ID                            INT      NOT NULL GENERATED ALWAYS AS IDENTITY (START WITH 1 INCREMENT BY 1),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c60d23b03bef2ed18d6854a69ea315a34a6e0981"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjczOTUxNDAzOnYy", "diffSide": "RIGHT", "path": "lib/taskana-core/src/test/java/acceptance/task/DeleteTaskAccTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xM1QxNTo0MDoyNlrOGjYFWw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xM1QxNTo0MDoyNlrOGjYFWw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTc0NzkzMQ==", "bodyText": "please open and close the connection.", "url": "https://github.com/Taskana/taskana/pull/1118#discussion_r439747931", "createdAt": "2020-06-13T15:40:26Z", "author": {"login": "mustaphazorgati"}, "path": "lib/taskana-core/src/test/java/acceptance/task/DeleteTaskAccTest.java", "diffHunk": "@@ -43,6 +47,54 @@ void testDeleteSingleTaskNotAuthorized() {\n     assertThatThrownBy(call).isInstanceOf(NotAuthorizedException.class);\n   }\n \n+  @WithAccessId(user = \"admin\")\n+  @Test\n+  void should_deleteAttachments_When_MultipleTasksAreDeleted()\n+      throws NotAuthorizedException, InvalidArgumentException, NoSuchFieldException,\n+                 IllegalAccessException {\n+\n+    TaskService taskService = taskanaEngine.getTaskService();\n+\n+    TaskanaEngineProxyForTest engineProxy = new TaskanaEngineProxyForTest(taskanaEngine);\n+    AttachmentMapper attachmentMapper =\n+        engineProxy.getEngine().getSqlSession().getMapper(AttachmentMapper.class);\n+\n+    assertThat(attachmentMapper.findAttachmentSummariesByTaskIds(Arrays.asList(\n+        \"TKI:000000000000000000000000000000000067\", \"TKI:000000000000000000000000000000000068\")))\n+        .hasSize(4);\n+\n+    taskService.deleteTasks(Arrays.asList(\"TKI:000000000000000000000000000000000067\",\n+        \"TKI:000000000000000000000000000000000068\"));\n+\n+    assertThat(attachmentMapper.findAttachmentSummariesByTaskIds(Arrays.asList(\n+        \"TKI:000000000000000000000000000000000067\", \"TKI:000000000000000000000000000000000068\")))\n+        .hasSize(0);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c60d23b03bef2ed18d6854a69ea315a34a6e0981"}, "originalPosition": 45}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjczOTUxNDE4OnYy", "diffSide": "RIGHT", "path": "lib/taskana-core/src/test/java/acceptance/task/DeleteTaskAccTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xM1QxNTo0MDo1M1rOGjYFcw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xM1QxNTo0MDo1M1rOGjYFcw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTc0Nzk1NQ==", "bodyText": "please open and close the connection.", "url": "https://github.com/Taskana/taskana/pull/1118#discussion_r439747955", "createdAt": "2020-06-13T15:40:53Z", "author": {"login": "mustaphazorgati"}, "path": "lib/taskana-core/src/test/java/acceptance/task/DeleteTaskAccTest.java", "diffHunk": "@@ -43,6 +47,54 @@ void testDeleteSingleTaskNotAuthorized() {\n     assertThatThrownBy(call).isInstanceOf(NotAuthorizedException.class);\n   }\n \n+  @WithAccessId(user = \"admin\")\n+  @Test\n+  void should_deleteAttachments_When_MultipleTasksAreDeleted()\n+      throws NotAuthorizedException, InvalidArgumentException, NoSuchFieldException,\n+                 IllegalAccessException {\n+\n+    TaskService taskService = taskanaEngine.getTaskService();\n+\n+    TaskanaEngineProxyForTest engineProxy = new TaskanaEngineProxyForTest(taskanaEngine);\n+    AttachmentMapper attachmentMapper =\n+        engineProxy.getEngine().getSqlSession().getMapper(AttachmentMapper.class);\n+\n+    assertThat(attachmentMapper.findAttachmentSummariesByTaskIds(Arrays.asList(\n+        \"TKI:000000000000000000000000000000000067\", \"TKI:000000000000000000000000000000000068\")))\n+        .hasSize(4);\n+\n+    taskService.deleteTasks(Arrays.asList(\"TKI:000000000000000000000000000000000067\",\n+        \"TKI:000000000000000000000000000000000068\"));\n+\n+    assertThat(attachmentMapper.findAttachmentSummariesByTaskIds(Arrays.asList(\n+        \"TKI:000000000000000000000000000000000067\", \"TKI:000000000000000000000000000000000068\")))\n+        .hasSize(0);\n+\n+  }\n+\n+  @WithAccessId(user = \"admin\")\n+  @Test\n+  void should_deleteAttachments_When_SingleTaskIsDeleted()\n+      throws NotAuthorizedException, NoSuchFieldException,\n+                 IllegalAccessException, InvalidStateException, TaskNotFoundException {\n+\n+    TaskService taskService = taskanaEngine.getTaskService();\n+\n+    TaskanaEngineProxyForTest engineProxy = new TaskanaEngineProxyForTest(taskanaEngine);\n+    AttachmentMapper attachmentMapper =\n+        engineProxy.getSqlSession().getMapper(AttachmentMapper.class);\n+\n+    assertThat(attachmentMapper.findAttachmentsByTaskId(\"TKI:000000000000000000000000000000000069\"))\n+        .hasSize(1);\n+\n+    taskService.deleteTask(\n+        \"TKI:000000000000000000000000000000000069\");\n+\n+    assertThat(attachmentMapper.findAttachmentsByTaskId(\"TKI:000000000000000000000000000000000069\"))\n+        .hasSize(0);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c60d23b03bef2ed18d6854a69ea315a34a6e0981"}, "originalPosition": 68}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjczOTUxOTgxOnYy", "diffSide": "RIGHT", "path": "lib/taskana-core/src/test/java/acceptance/task/QueryTaskWithAttachmentAccTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xM1QxNTo1MDo1MFrOGjYIVQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xM1QxNTo1MDo1MFrOGjYIVQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTc0ODY5Mw==", "bodyText": "@gitgoodjhe: for some reason the ordering changed (and is somehow different running the tests on travis compared to my local machine.. This is a really weird behaviour, but ignoring the order of elements works \ud83d\udc4d )", "url": "https://github.com/Taskana/taskana/pull/1118#discussion_r439748693", "createdAt": "2020-06-13T15:50:50Z", "author": {"login": "mustaphazorgati"}, "path": "lib/taskana-core/src/test/java/acceptance/task/QueryTaskWithAttachmentAccTest.java", "diffHunk": "@@ -84,8 +84,7 @@ void should_ConfirmIfAttachmentSummariesAreCorrect_When_UsingTaskQueryAndGetTask\n             .collect(Collectors.toList());\n \n     assertThat(queryAttachmentSummaries)\n-        .hasSize(originalAttachments.size())\n-        .containsExactlyElementsOf(originalAttachments) // same values\n+        .containsExactlyInAnyOrderElementsOf(originalAttachments) // same values", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c60d23b03bef2ed18d6854a69ea315a34a6e0981"}, "originalPosition": 6}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjczOTUyMDI5OnYy", "diffSide": "RIGHT", "path": "lib/taskana-core/src/test/resources/taskana.properties", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xM1QxNTo1MTozNlrOGjYIlQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xM1QxNTo1MTozNlrOGjYIlQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTc0ODc1Nw==", "bodyText": "Is this property documented?", "url": "https://github.com/Taskana/taskana/pull/1118#discussion_r439748757", "createdAt": "2020-06-13T15:51:36Z", "author": {"login": "mustaphazorgati"}, "path": "lib/taskana-core/src/test/resources/taskana.properties", "diffHunk": "@@ -15,4 +15,6 @@ taskana.jobs.cleanup.firstRunAt=2018-07-25T08:00:00Z\n taskana.jobs.cleanup.minimumAge=P14D\n taskana.german.holidays.enabled=true\n taskana.german.holidays.corpus-christi.enabled=false\n+taskana.history.deletion.on.task.deletion.enabled=true", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c60d23b03bef2ed18d6854a69ea315a34a6e0981"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjczOTUyMTE2OnYy", "diffSide": "RIGHT", "path": "rest/taskana-rest-spring/src/main/java/pro/taskana/task/rest/TaskController.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xM1QxNTo1MzoxOFrOGjYJCA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xM1QxNTo1MzoxOFrOGjYJCA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTc0ODg3Mg==", "bodyText": "we are not using the CollectionModel. Please use the TaskanaPaginModel.", "url": "https://github.com/Taskana/taskana/pull/1118#discussion_r439748872", "createdAt": "2020-06-13T15:53:18Z", "author": {"login": "mustaphazorgati"}, "path": "rest/taskana-rest-spring/src/main/java/pro/taskana/task/rest/TaskController.java", "diffHunk": "@@ -132,6 +138,41 @@\n     return response;\n   }\n \n+  @DeleteMapping(path = Mapping.URL_TASKS)\n+  @Transactional(readOnly = true, rollbackFor = Exception.class)\n+  public ResponseEntity<CollectionModel<TaskSummaryRepresentationModel>> deleteTasks(\n+      @RequestParam MultiValueMap<String, String> params)\n+      throws InvalidArgumentException, NotAuthorizedException {\n+\n+    LOGGER.debug(\"Entry to deleteTasks(params= {})\", params);\n+\n+    TaskQuery query = taskService.createTaskQuery();\n+    query = applyFilterParams(query, params);\n+    validateNoInvalidParameterIsLeft(params);\n+\n+    List<TaskSummary> taskSummaries = getQueryList(query, null);\n+\n+    List<String> taskIdsToDelete =\n+        taskSummaries.stream().map(TaskSummary::getId).collect(Collectors.toList());\n+\n+    BulkOperationResults<String, TaskanaException> result =\n+        taskService.deleteTasks(taskIdsToDelete);\n+\n+    List<TaskSummary> successfullyDeletedTaskSummaries =\n+        taskSummaries.stream()\n+            .filter(summary -> !result.getFailedIds().contains(summary.getId()))\n+            .collect(Collectors.toList());\n+\n+    ResponseEntity<CollectionModel<TaskSummaryRepresentationModel>> response =\n+        ResponseEntity.ok(\n+            taskSummaryRepresentationModelAssembler.toCollectionModel(\n+                successfullyDeletedTaskSummaries));\n+\n+    LOGGER.debug(\"Exit from deleteTasks(), returning {}\", response);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c60d23b03bef2ed18d6854a69ea315a34a6e0981"}, "originalPosition": 76}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjczOTUyMTc4OnYy", "diffSide": "RIGHT", "path": "rest/taskana-rest-spring/src/main/java/pro/taskana/task/rest/TaskController.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xM1QxNTo1NDo1MFrOGjYJXA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xM1QxNTo1NDo1MFrOGjYJXA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTc0ODk1Ng==", "bodyText": "Is this documented?", "url": "https://github.com/Taskana/taskana/pull/1118#discussion_r439748956", "createdAt": "2020-06-13T15:54:50Z", "author": {"login": "mustaphazorgati"}, "path": "rest/taskana-rest-spring/src/main/java/pro/taskana/task/rest/TaskController.java", "diffHunk": "@@ -132,6 +138,41 @@\n     return response;\n   }\n \n+  @DeleteMapping(path = Mapping.URL_TASKS)\n+  @Transactional(readOnly = true, rollbackFor = Exception.class)\n+  public ResponseEntity<CollectionModel<TaskSummaryRepresentationModel>> deleteTasks(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c60d23b03bef2ed18d6854a69ea315a34a6e0981"}, "originalPosition": 48}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4229, "cost": 1, "resetAt": "2021-11-13T14:23:39Z"}}}