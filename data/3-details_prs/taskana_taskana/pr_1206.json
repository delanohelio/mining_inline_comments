{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDU4NDc4NTA1", "number": 1206, "title": "TSK-1338: tasklist now does not refresh after selection of a task", "bodyText": "https://sonarcloud.io/dashboard?branch=TSK-1338&id=Tristan2357_taskana", "createdAt": "2020-07-29T14:30:37Z", "url": "https://github.com/Taskana/taskana/pull/1206", "merged": true, "mergeCommit": {"oid": "418f37917d8d98d5c406353c5ca63b7d9bc2d2cf"}, "closed": true, "closedAt": "2020-08-10T16:37:57Z", "author": {"login": "Tristan2357"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc7L7iYAFqTQ1OTc3MTk0Mg==", "endCursor": "Y3Vyc29yOnYyOpPPAAABc9kMYTAFqTQ2NDM1Mzg4Mw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU5NzcxOTQy", "url": "https://github.com/Taskana/taskana/pull/1206#pullrequestreview-459771942", "createdAt": "2020-08-03T06:19:47Z", "commit": {"oid": "82eab5b2a93e30ef889c7c43151dcbf95161b5b1"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wM1QwNjoxOTo0N1rOG6tY4w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wM1QwNjoxOTo0N1rOG6tY4w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDIxNDI0Mw==", "bodyText": "Why don't we update selectedId and currentBasket like before when taskSelectedStream (getSelectedTask()) changes?", "url": "https://github.com/Taskana/taskana/pull/1206#discussion_r464214243", "createdAt": "2020-08-03T06:19:47Z", "author": {"login": "sofie29"}, "path": "web/src/app/workplace/components/task-master/task-master.component.ts", "diffHunk": "@@ -55,19 +55,13 @@ export class TaskMasterComponent implements OnInit, OnDestroy {\n   ) {}\n \n   ngOnInit() {\n-    this.taskService\n-      .getSelectedTask()\n-      .pipe(takeUntil(this.destroy$))\n-      .subscribe((task: Task) => {\n-        if (!this.currentBasket) {\n-          this.selectedId = task.taskId;\n-          this.currentBasket = task.workbasketSummary;\n-          this.getTasks();\n-        }\n-        if (!task) {\n-          this.selectedId = '';\n-        }\n-      });\n+    this.taskService.taskChangedStream.pipe(takeUntil(this.destroy$)).subscribe((task: Task) => {\n+      this.selectedId = task ? task.taskId : '';\n+      if (!this.currentBasket) {\n+        this.currentBasket = task.workbasketSummary;\n+        this.getTasks();\n+      }\n+    });", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "82eab5b2a93e30ef889c7c43151dcbf95161b5b1"}, "originalPosition": 23}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYxNTM3NTI0", "url": "https://github.com/Taskana/taskana/pull/1206#pullrequestreview-461537524", "createdAt": "2020-08-05T10:31:55Z", "commit": {"oid": "6dca685b62cfbaf991408319d1a7be79718afe5c"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYxODg4MjUz", "url": "https://github.com/Taskana/taskana/pull/1206#pullrequestreview-461888253", "createdAt": "2020-08-05T17:45:06Z", "commit": {"oid": "f0ddb1725ca1817662fecd1d23c6c60c74b0801f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNVQxNzo0NTowN1rOG8UIWA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNVQxNzo0NTowN1rOG8UIWA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTg5NzU2MA==", "bodyText": "I thought about this - I think we have to delete the currentBasket even when there is an objectReference. In case we search by type and value, the method getTasks() should be called without a currentBasket. Otherwise the method would filter the tasks by a workbasket (the currentBasket).", "url": "https://github.com/Taskana/taskana/pull/1206#discussion_r465897560", "createdAt": "2020-08-05T17:45:07Z", "author": {"login": "sofie29"}, "path": "web/src/app/workplace/components/task-master/task-master.component.ts", "diffHunk": "@@ -90,9 +84,10 @@ export class TaskMasterComponent implements OnInit, OnDestroy {\n \n     this.workplaceService.objectReferenceSelectedStream.pipe(takeUntil(this.destroy$)).subscribe((objectReference) => {\n       this.objectReference = objectReference;\n-      delete this.currentBasket;\n       if (objectReference) {\n         this.getTasks();\n+      } else {\n+        delete this.currentBasket;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f0ddb1725ca1817662fecd1d23c6c60c74b0801f"}, "originalPosition": 52}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b330dd287fe6b55d3de7c20cd5896e616eacdb37", "author": {"user": {"login": "Tristan2357", "name": null}}, "url": "https://github.com/Taskana/taskana/commit/b330dd287fe6b55d3de7c20cd5896e616eacdb37", "committedDate": "2020-08-06T14:39:59Z", "message": "TSK-1338: List now does not refresh after selection of a task"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY0MDI5ODU5", "url": "https://github.com/Taskana/taskana/pull/1206#pullrequestreview-464029859", "createdAt": "2020-08-10T08:11:33Z", "commit": {"oid": "b330dd287fe6b55d3de7c20cd5896e616eacdb37"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMFQwODoxMTozNFrOG-FCvQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMFQwODoxMTozNFrOG-FCvQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Nzc0NzUxNw==", "bodyText": "nice", "url": "https://github.com/Taskana/taskana/pull/1206#discussion_r467747517", "createdAt": "2020-08-10T08:11:34Z", "author": {"login": "cnguyen-de"}, "path": "web/src/app/workplace/services/task.service.ts", "diffHunk": "@@ -91,29 +90,17 @@ export class TaskService {\n     return this.httpClient.post<Task>(this.url, task);\n   }\n \n-  private convertTasksDatesToGMT(task: Task): Task {\n-    if (task.created) {\n-      task.created = new Date(task.created).toISOString();\n-    }\n-    if (task.claimed) {\n-      task.claimed = new Date(task.claimed).toISOString();\n-    }\n-    if (task.completed) {\n-      task.completed = new Date(task.completed).toISOString();\n-    }\n-    if (task.modified) {\n-      task.modified = new Date(task.modified).toISOString();\n-    }\n-    if (task.planned) {\n-      task.planned = new Date(task.planned).toISOString();\n-    }\n-    if (task.due) {\n-      task.due = new Date(task.due).toISOString();\n-    }\n+  private static convertTasksDatesToGMT(task: Task): Task {\n+    const timeAttributes = ['created', 'claimed', 'completed', 'modified', 'planned', 'due'];\n+    timeAttributes.forEach((attributeName) => {\n+      if (task[attributeName]) {\n+        task[attributeName] = new Date(task[attributeName]).toISOString();\n+      }\n+    });", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b330dd287fe6b55d3de7c20cd5896e616eacdb37"}, "originalPosition": 85}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY0MzUzODgz", "url": "https://github.com/Taskana/taskana/pull/1206#pullrequestreview-464353883", "createdAt": "2020-08-10T15:45:34Z", "commit": {"oid": "b330dd287fe6b55d3de7c20cd5896e616eacdb37"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4462, "cost": 1, "resetAt": "2021-11-02T12:20:56Z"}}}