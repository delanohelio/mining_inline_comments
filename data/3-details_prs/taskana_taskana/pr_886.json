{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY4NjIyMDIy", "number": 886, "title": "TSK-1024: Add tests for ldapclient", "bodyText": "Working Mockito test for the Ldapclient", "createdAt": "2020-01-29T15:33:22Z", "url": "https://github.com/Taskana/taskana/pull/886", "merged": true, "mergeCommit": {"oid": "ffa135ef1bcd178f747aa86a04985974793cf232"}, "closed": true, "closedAt": "2020-01-30T09:03:36Z", "author": {"login": "benjamineckstein"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb_H7GngFqTM1MDIxMDQzOQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABb_WZcwAFqTM1MDY1MjA3MA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUwMjEwNDM5", "url": "https://github.com/Taskana/taskana/pull/886#pullrequestreview-350210439", "createdAt": "2020-01-29T15:46:03Z", "commit": {"oid": "2646d66349bb6d0ef0c64f62b77d27b6d938afda"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUwMjEwNTg4", "url": "https://github.com/Taskana/taskana/pull/886#pullrequestreview-350210588", "createdAt": "2020-01-29T15:46:13Z", "commit": {"oid": "2646d66349bb6d0ef0c64f62b77d27b6d938afda"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOVQxNTo0NjoxNFrOFjNW8Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOVQxNTo0OToxM1rOFjNeiw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjQ2MzM0NQ==", "bodyText": "Just to understand: Since we use a different mockito version than provided by spring-boot we have to do this, right?", "url": "https://github.com/Taskana/taskana/pull/886#discussion_r372463345", "createdAt": "2020-01-29T15:46:14Z", "author": {"login": "mustaphazorgati"}, "path": "pom.xml", "diffHunk": "@@ -75,6 +75,9 @@\n \t\t<version.archunit>0.13.0</version.archunit>\n \t\t<version.mockito>3.2.4</version.mockito>\n \t\t<version.junit.mockito>3.2.4</version.junit.mockito>\n+    <!-- byte buddy 1.9.7+ is needed to solve dependency errors with spring mock tests see LdapClientTest -->\n+    <version.byte-buddy>1.9.7</version.byte-buddy>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2646d66349bb6d0ef0c64f62b77d27b6d938afda"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjQ2NDY4Nw==", "bodyText": "nice! I didn't know that Pattern.quote exists. awesome :)", "url": "https://github.com/Taskana/taskana/pull/886#discussion_r372464687", "createdAt": "2020-01-29T15:48:15Z", "author": {"login": "mustaphazorgati"}, "path": "rest/taskana-rest-spring/src/main/java/pro/taskana/ldap/LdapClient.java", "diffHunk": "@@ -182,16 +185,22 @@ public AccessIdResource searchGroupByDn(final String name) {\n       throw new SystemException(\n           \"LdapClient was called but is not active due to missing configuration: \" + message);\n     }\n-\n+    // Obviously Spring LdapTemplate does have a inconsistency and always adds the base name to the\n+    // given DN.\n+    // https://stackoverflow.com/questions/55285743/spring-ldaptemplate-how-to-lookup-fully-qualified-dn-with-configured-base-dn\n+    // Therefore we have to remove the base name from the dn before performing the lookup\n+    // (?i) --> case insensitive replacement\n+    String nameWithoutBaseDn = name.replaceAll(\"(?i)\" + Pattern.quote(\",\" + baseDn), \"\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2646d66349bb6d0ef0c64f62b77d27b6d938afda"}, "originalPosition": 27}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjQ2NTIxNA==", "bodyText": "can we please use the @ExtendWith(MockitoExtension.class) annotation?", "url": "https://github.com/Taskana/taskana/pull/886#discussion_r372465214", "createdAt": "2020-01-29T15:49:05Z", "author": {"login": "mustaphazorgati"}, "path": "rest/taskana-rest-spring/src/test/java/pro/taskana/ldap/LdapClientTest.java", "diffHunk": "@@ -0,0 +1,60 @@\n+package pro.taskana.ldap;\n+\n+import static org.mockito.Mockito.when;\n+\n+import org.junit.jupiter.api.Test;\n+import org.mockito.InjectMocks;\n+import org.mockito.Mock;\n+import org.mockito.Mockito;\n+import org.mockito.MockitoAnnotations;\n+import org.springframework.core.env.Environment;\n+import org.springframework.ldap.core.LdapTemplate;\n+\n+class LdapClientTest {\n+\n+  @Mock Environment environment;\n+\n+  @Mock LdapTemplate ldapTemplate;\n+\n+  @InjectMocks LdapClient cut;\n+\n+  @Test\n+  void testLdap() {\n+\n+    MockitoAnnotations.initMocks(this);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2646d66349bb6d0ef0c64f62b77d27b6d938afda"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjQ2NTI5MQ==", "bodyText": "like we always do :)", "url": "https://github.com/Taskana/taskana/pull/886#discussion_r372465291", "createdAt": "2020-01-29T15:49:13Z", "author": {"login": "mustaphazorgati"}, "path": "rest/taskana-rest-spring/src/test/java/pro/taskana/ldap/LdapClientTest.java", "diffHunk": "@@ -0,0 +1,60 @@\n+package pro.taskana.ldap;\n+\n+import static org.mockito.Mockito.when;\n+\n+import org.junit.jupiter.api.Test;\n+import org.mockito.InjectMocks;\n+import org.mockito.Mock;\n+import org.mockito.Mockito;\n+import org.mockito.MockitoAnnotations;\n+import org.springframework.core.env.Environment;\n+import org.springframework.ldap.core.LdapTemplate;\n+\n+class LdapClientTest {\n+\n+  @Mock Environment environment;\n+\n+  @Mock LdapTemplate ldapTemplate;\n+\n+  @InjectMocks LdapClient cut;\n+\n+  @Test\n+  void testLdap() {\n+\n+    MockitoAnnotations.initMocks(this);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjQ2NTIxNA=="}, "originalCommit": {"oid": "2646d66349bb6d0ef0c64f62b77d27b6d938afda"}, "originalPosition": 24}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d7e73b5e504442ad92aea7e2317d57e61196c99f", "author": {"user": null}, "url": "https://github.com/Taskana/taskana/commit/d7e73b5e504442ad92aea7e2317d57e61196c99f", "committedDate": "2020-01-29T16:42:00Z", "message": "TSK-1024: Add tests for ldapclient"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "323bdd74db6c64d204682db5bf644907950d9032", "author": {"user": {"login": "mustaphazorgati", "name": "Mustapha Zorgati"}}, "url": "https://github.com/Taskana/taskana/commit/323bdd74db6c64d204682db5bf644907950d9032", "committedDate": "2020-01-29T19:29:24Z", "message": "TSK-1024: removed lenient() and replaced MockitoSettings annotation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "458ff713e4d638711c302d4e20a19b9e0a56bad0", "author": {"user": null}, "url": "https://github.com/Taskana/taskana/commit/458ff713e4d638711c302d4e20a19b9e0a56bad0", "committedDate": "2020-01-30T08:09:29Z", "message": "TSK-1024: Refactor and clean up LdapClient changes"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUwNjQ3NDE0", "url": "https://github.com/Taskana/taskana/pull/886#pullrequestreview-350647414", "createdAt": "2020-01-30T08:28:20Z", "commit": {"oid": "458ff713e4d638711c302d4e20a19b9e0a56bad0"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUwNjUyMDcw", "url": "https://github.com/Taskana/taskana/pull/886#pullrequestreview-350652070", "createdAt": "2020-01-30T08:37:52Z", "commit": {"oid": "458ff713e4d638711c302d4e20a19b9e0a56bad0"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4551, "cost": 1, "resetAt": "2021-11-02T12:20:56Z"}}}