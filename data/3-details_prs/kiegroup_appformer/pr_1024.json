{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY0NzU0ODg1", "number": 1024, "title": "AF-2538: No server disconnection error message in dashbuilder runtime\u2026", "bodyText": "Hello,\nWith this change Runtime will show a popup when the server is disconnected or when a session timeout happened.\nTwo possible ways to see the popup:\n\nWith runtime running, login in a browser tab, open other tab, access Runtime and logout - you should see the popup in the first tab;\nLogin into Runtime, stop the server and the popup should show on Runtime.\n\nI also fixed the annoying error that appeared in first access in Runtime, now it won't show anymore because I correctly annotated the dummy service that should respond the client request.", "createdAt": "2020-08-07T18:34:57Z", "url": "https://github.com/kiegroup/appformer/pull/1024", "merged": true, "mergeCommit": {"oid": "ff87925fc765ea2377b30b2c918f21f954b1c49e"}, "closed": true, "closedAt": "2020-08-21T12:50:19Z", "author": {"login": "jesuino"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc8qVyegBqjM2MzQ2NTAxMTI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdAu_rGgFqTQ3MTUyNDMyNw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "8f9f694da43efa00c4f076bcef87d5d30c944908", "author": {"user": {"login": "jesuino", "name": "William Ant\u00f4nio Siqueira"}}, "url": "https://github.com/kiegroup/appformer/commit/8f9f694da43efa00c4f076bcef87d5d30c944908", "committedDate": "2020-08-07T18:31:59Z", "message": "AF-2538: No server disconnection error message in dashbuilder runtime UI if server is not connected"}, "afterCommit": {"oid": "4d145cac385afe9b32c167c77889fbc2d75171c4", "author": {"user": {"login": "jesuino", "name": "William Ant\u00f4nio Siqueira"}}, "url": "https://github.com/kiegroup/appformer/commit/4d145cac385afe9b32c167c77889fbc2d75171c4", "committedDate": "2020-08-07T20:21:08Z", "message": "AF-2538: No server disconnection error message in dashbuilder runtime UI if server is not connected"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYzNTI1MDk2", "url": "https://github.com/kiegroup/appformer/pull/1024#pullrequestreview-463525096", "createdAt": "2020-08-07T18:38:45Z", "commit": {"oid": "8f9f694da43efa00c4f076bcef87d5d30c944908"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wN1QxODozODo0NVrOG9kEwA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wN1QxOTowMDozNlrOG9krzg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzIwNzM2MA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                String DisconnectedFromServer();\n          \n          \n            \n            \n          \n          \n            \n                String CouldNotConnectToServer();\n          \n          \n            \n            \n          \n          \n            \n                String SessionTimeout();\n          \n          \n            \n            \n          \n          \n            \n                String InvalidBusResponseProbablySessionTimeout();\n          \n          \n            \n                String disconnectedFromServer();\n          \n          \n            \n            \n          \n          \n            \n                String couldNotConnectToServer();\n          \n          \n            \n            \n          \n          \n            \n                String sessionTimeout();\n          \n          \n            \n            \n          \n          \n            \n                String invalidBusResponseProbablySessionTimeout();", "url": "https://github.com/kiegroup/appformer/pull/1024#discussion_r467207360", "createdAt": "2020-08-07T18:38:45Z", "author": {"login": "caponetto"}, "path": "dashbuilder/dashbuilder-runtime/src/main/java/org/dashbuilder/client/resources/i18n/AppConstants.java", "diffHunk": "@@ -54,5 +54,13 @@\n     String dashboardAlreadyImport(String newModelId, String exitingModel);\n \n     String importSuccess(String fileName);\n-    \n+\n+    String DisconnectedFromServer();\n+\n+    String CouldNotConnectToServer();\n+\n+    String SessionTimeout();\n+\n+    String InvalidBusResponseProbablySessionTimeout();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8f9f694da43efa00c4f076bcef87d5d30c944908"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzIxMzYwNA==", "bodyText": "Please take into account that t could be null.", "url": "https://github.com/kiegroup/appformer/pull/1024#discussion_r467213604", "createdAt": "2020-08-07T18:52:42Z", "author": {"login": "caponetto"}, "path": "dashbuilder/dashbuilder-runtime/src/main/java/org/dashbuilder/client/error/DefaultRuntimeErrorCallback.java", "diffHunk": "@@ -0,0 +1,94 @@\n+/*\n+ * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *       http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.dashbuilder.client.error;\n+\n+import java.util.Arrays;\n+import java.util.List;\n+\n+import javax.enterprise.context.Dependent;\n+import javax.inject.Inject;\n+\n+import com.google.gwt.user.client.Window;\n+import org.dashbuilder.client.resources.i18n.AppConstants;\n+import org.jboss.errai.bus.client.api.InvalidBusContentException;\n+import org.uberfire.ext.widgets.common.client.common.BusyIndicatorView;\n+import org.uberfire.ext.widgets.common.client.common.popups.YesNoCancelPopup;\n+import org.uberfire.ext.widgets.common.client.resources.i18n.CommonConstants;\n+\n+import static org.uberfire.ext.widgets.common.client.common.popups.YesNoCancelPopup.newYesNoCancelPopup;\n+import static org.uberfire.ext.widgets.common.client.common.popups.errors.ErrorPopup.showMessage;\n+\n+@Dependent\n+public class DefaultRuntimeErrorCallback {\n+\n+    @Inject\n+    BusyIndicatorView loading;\n+\n+    AppConstants i18n = AppConstants.INSTANCE;\n+\n+    private boolean errorPopUpLock = false;\n+\n+    public void error(final Throwable throwable) {\n+        if (errorPopUpLock) {\n+            return;\n+        }\n+        loading.hideBusyIndicator();\n+        errorPopUpLock = true;\n+        if (isServerOfflineException(throwable)) {\n+            yesNoPopup(i18n.DisconnectedFromServer(), i18n.CouldNotConnectToServer());\n+        } else if (isInvalidBusContentException(throwable)) {\n+            yesNoPopup(i18n.SessionTimeout(), i18n.InvalidBusResponseProbablySessionTimeout());\n+        } else {\n+            showMessage(CommonConstants.INSTANCE.ExceptionGeneric0(extractMessageRecursively(throwable)),\n+                        this::unlock,\n+                        this::unlock);\n+        }\n+\n+    }\n+\n+    private void yesNoPopup(String title, String content) {\n+        final YesNoCancelPopup result = newYesNoCancelPopup(title, content, Window.Location::reload, this::unlock, this::unlock);\n+        result.clearScrollHeight();\n+        result.show();\n+    }\n+\n+    private String extractMessageRecursively(final Throwable t) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8f9f694da43efa00c4f076bcef87d5d30c944908"}, "originalPosition": 69}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzIxNzM1OA==", "bodyText": "Consider reusing only one instance of YesNoCancelPopup instead of creating a new one every time.\nThe only things that change would be title and content.\nPerhaps you could use the YesNoCancelPopup#isVisible method instead of errorPopUpLock.\nJust a suggestion.", "url": "https://github.com/kiegroup/appformer/pull/1024#discussion_r467217358", "createdAt": "2020-08-07T19:00:36Z", "author": {"login": "caponetto"}, "path": "dashbuilder/dashbuilder-runtime/src/main/java/org/dashbuilder/client/error/DefaultRuntimeErrorCallback.java", "diffHunk": "@@ -0,0 +1,94 @@\n+/*\n+ * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *       http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.dashbuilder.client.error;\n+\n+import java.util.Arrays;\n+import java.util.List;\n+\n+import javax.enterprise.context.Dependent;\n+import javax.inject.Inject;\n+\n+import com.google.gwt.user.client.Window;\n+import org.dashbuilder.client.resources.i18n.AppConstants;\n+import org.jboss.errai.bus.client.api.InvalidBusContentException;\n+import org.uberfire.ext.widgets.common.client.common.BusyIndicatorView;\n+import org.uberfire.ext.widgets.common.client.common.popups.YesNoCancelPopup;\n+import org.uberfire.ext.widgets.common.client.resources.i18n.CommonConstants;\n+\n+import static org.uberfire.ext.widgets.common.client.common.popups.YesNoCancelPopup.newYesNoCancelPopup;\n+import static org.uberfire.ext.widgets.common.client.common.popups.errors.ErrorPopup.showMessage;\n+\n+@Dependent\n+public class DefaultRuntimeErrorCallback {\n+\n+    @Inject\n+    BusyIndicatorView loading;\n+\n+    AppConstants i18n = AppConstants.INSTANCE;\n+\n+    private boolean errorPopUpLock = false;\n+\n+    public void error(final Throwable throwable) {\n+        if (errorPopUpLock) {\n+            return;\n+        }\n+        loading.hideBusyIndicator();\n+        errorPopUpLock = true;\n+        if (isServerOfflineException(throwable)) {\n+            yesNoPopup(i18n.DisconnectedFromServer(), i18n.CouldNotConnectToServer());\n+        } else if (isInvalidBusContentException(throwable)) {\n+            yesNoPopup(i18n.SessionTimeout(), i18n.InvalidBusResponseProbablySessionTimeout());\n+        } else {\n+            showMessage(CommonConstants.INSTANCE.ExceptionGeneric0(extractMessageRecursively(throwable)),\n+                        this::unlock,\n+                        this::unlock);\n+        }\n+\n+    }\n+\n+    private void yesNoPopup(String title, String content) {\n+        final YesNoCancelPopup result = newYesNoCancelPopup(title, content, Window.Location::reload, this::unlock, this::unlock);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8f9f694da43efa00c4f076bcef87d5d30c944908"}, "originalPosition": 64}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY0MzU5MDkw", "url": "https://github.com/kiegroup/appformer/pull/1024#pullrequestreview-464359090", "createdAt": "2020-08-10T15:51:47Z", "commit": {"oid": "d29fb6740aee98d08b6bce99352117f89bce9532"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY0NTYwNzc3", "url": "https://github.com/kiegroup/appformer/pull/1024#pullrequestreview-464560777", "createdAt": "2020-08-10T20:22:54Z", "commit": {"oid": "d29fb6740aee98d08b6bce99352117f89bce9532"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bd4226d53bda20e6dc85831fe526d061a98675e2", "author": {"user": {"login": "jesuino", "name": "William Ant\u00f4nio Siqueira"}}, "url": "https://github.com/kiegroup/appformer/commit/bd4226d53bda20e6dc85831fe526d061a98675e2", "committedDate": "2020-08-19T12:57:32Z", "message": "AF-2538: No server disconnection error message in dashbuilder runtime UI if server is not connected"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "02da7a2a1554cd46d9ec6ec277ab7c1973b27336", "author": {"user": {"login": "jesuino", "name": "William Ant\u00f4nio Siqueira"}}, "url": "https://github.com/kiegroup/appformer/commit/02da7a2a1554cd46d9ec6ec277ab7c1973b27336", "committedDate": "2020-08-19T12:57:32Z", "message": "i18n keys renaming and null checking"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a6095d12d246ceb17b6702240a1006b7c3042b50", "author": {"user": {"login": "jesuino", "name": "William Ant\u00f4nio Siqueira"}}, "url": "https://github.com/kiegroup/appformer/commit/a6095d12d246ceb17b6702240a1006b7c3042b50", "committedDate": "2020-08-19T12:57:32Z", "message": "Hiding no button from error popup"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "84527f1bbbdc6ef29d2380b0047d3ea027348035", "author": {"user": {"login": "jesuino", "name": "William Ant\u00f4nio Siqueira"}}, "url": "https://github.com/kiegroup/appformer/commit/84527f1bbbdc6ef29d2380b0047d3ea027348035", "committedDate": "2020-08-19T14:09:48Z", "message": "Method rename and adding test"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "8edf1dde1c698af664523d31ff437d0a31b3874b", "author": {"user": {"login": "jesuino", "name": "William Ant\u00f4nio Siqueira"}}, "url": "https://github.com/kiegroup/appformer/commit/8edf1dde1c698af664523d31ff437d0a31b3874b", "committedDate": "2020-08-11T15:43:39Z", "message": "Hiding no button from error popup"}, "afterCommit": {"oid": "84527f1bbbdc6ef29d2380b0047d3ea027348035", "author": {"user": {"login": "jesuino", "name": "William Ant\u00f4nio Siqueira"}}, "url": "https://github.com/kiegroup/appformer/commit/84527f1bbbdc6ef29d2380b0047d3ea027348035", "committedDate": "2020-08-19T14:09:48Z", "message": "Method rename and adding test"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDcxNTI0MzI3", "url": "https://github.com/kiegroup/appformer/pull/1024#pullrequestreview-471524327", "createdAt": "2020-08-20T12:02:25Z", "commit": {"oid": "84527f1bbbdc6ef29d2380b0047d3ea027348035"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1956, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}