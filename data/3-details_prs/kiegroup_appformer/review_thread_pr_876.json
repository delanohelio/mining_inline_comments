{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzYxNDE5NDk0", "number": 876, "reviewThreads": {"totalCount": 13, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNVQxMDo0Mzo1MVrODYIfaw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yM1QxMDoyNzo0MFrODaHvVQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI2NjMxNTMxOnYy", "diffSide": "RIGHT", "path": "uberfire-extensions/uberfire-security/uberfire-security-management/uberfire-widgets-security-management/src/main/java/org/uberfire/ext/security/management/client/widgets/management/editor/group/workflow/GroupEditorWorkflow.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNVQxMDo0Mzo1MVrOFd0KDw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNVQxMDo0Mzo1MVrOFd0KDw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjgwNzU2Nw==", "bodyText": "As done in doSave method, consider calling showLoadingBox before the service call and hideLoadingBox in the callback.", "url": "https://github.com/kiegroup/appformer/pull/876#discussion_r366807567", "createdAt": "2020-01-15T10:43:51Z", "author": {"login": "caponetto"}, "path": "uberfire-extensions/uberfire-security/uberfire-security-management/uberfire-widgets-security-management/src/main/java/org/uberfire/ext/security/management/client/widgets/management/editor/group/workflow/GroupEditorWorkflow.java", "diffHunk": "@@ -163,14 +163,25 @@ public boolean isDirty() {\n     void delete() {\n         final String name = group.getName();\n         userSystemManager.groups((Void v) -> {\n-                                     deleteGroupEvent.fire(new DeleteGroupEvent(name));\n-                                     workbenchNotification.fire(new NotificationEvent(UsersManagementWidgetsConstants.INSTANCE.groupRemoved(name),\n-                                                                                      INFO));\n+                                     doDelete();\n                                      clear();\n                                  },\n                                  errorCallback).delete(name);\n     }\n \n+    protected void doDelete(){\n+        final String name = group.getName();\n+        AuthorizationPolicy authzPolicy = permissionManager.getAuthorizationPolicy();\n+\n+        authorizationService.call(r -> {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "51bc235752b26a2db428f1ab6b827ceca76b2720"}, "originalPosition": 17}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI2NjMyODE2OnYy", "diffSide": "RIGHT", "path": "uberfire-backend/uberfire-backend-server/src/main/java/org/uberfire/backend/server/authz/AuthorizationServiceImpl.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNVQxMDo0Nzo0MFrOFd0RbQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xN1QxMToxODoxMVrOFe2E-w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjgwOTQ1Mw==", "bodyText": "Consider creating at least one unit test for this public method.", "url": "https://github.com/kiegroup/appformer/pull/876#discussion_r366809453", "createdAt": "2020-01-15T10:47:40Z", "author": {"login": "caponetto"}, "path": "uberfire-backend/uberfire-backend-server/src/main/java/org/uberfire/backend/server/authz/AuthorizationServiceImpl.java", "diffHunk": "@@ -50,4 +51,12 @@ public void savePolicy(AuthorizationPolicy policy) {\n         permissionManager.setAuthorizationPolicy(policy);\n         savedEvent.fire(new AuthorizationPolicySavedEvent(policy));\n     }\n+\n+    @Override\n+    public void deletePolicyByGroup(Group group, AuthorizationPolicy policy) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "51bc235752b26a2db428f1ab6b827ceca76b2720"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Nzg4NzYxMQ==", "bodyText": "added", "url": "https://github.com/kiegroup/appformer/pull/876#discussion_r367887611", "createdAt": "2020-01-17T11:18:11Z", "author": {"login": "RishiRajAnand"}, "path": "uberfire-backend/uberfire-backend-server/src/main/java/org/uberfire/backend/server/authz/AuthorizationServiceImpl.java", "diffHunk": "@@ -50,4 +51,12 @@ public void savePolicy(AuthorizationPolicy policy) {\n         permissionManager.setAuthorizationPolicy(policy);\n         savedEvent.fire(new AuthorizationPolicySavedEvent(policy));\n     }\n+\n+    @Override\n+    public void deletePolicyByGroup(Group group, AuthorizationPolicy policy) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjgwOTQ1Mw=="}, "originalCommit": {"oid": "51bc235752b26a2db428f1ab6b827ceca76b2720"}, "originalPosition": 14}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI2NjM0NzY0OnYy", "diffSide": "RIGHT", "path": "uberfire-backend/uberfire-backend-server/src/main/java/org/uberfire/backend/server/authz/AuthorizationPolicyVfsStorage.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNVQxMDo1Mzo1M1rOFd0dew==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xN1QxMToxODoyN1rOFe2FTg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjgxMjUzOQ==", "bodyText": "Consider creating at least one unit test for this public method.", "url": "https://github.com/kiegroup/appformer/pull/876#discussion_r366812539", "createdAt": "2020-01-15T10:53:53Z", "author": {"login": "caponetto"}, "path": "uberfire-backend/uberfire-backend-server/src/main/java/org/uberfire/backend/server/authz/AuthorizationPolicyVfsStorage.java", "diffHunk": "@@ -149,7 +150,34 @@ public FileVisitResult visitFile(final Path file,\n \n     public boolean isPolicyFile(Path p) {\n         String fileName = p.getName(p.getNameCount() - 1).toString();\n-        return fileName.equals(\"security-policy.properties\") || fileName.startsWith(\"security-module-\");\n+        return fileName.equals(POLICY_FILE) || fileName.startsWith(\"security-module-\");\n+    }\n+\n+    @Override\n+    public void deletePolicyByGroup(Group group, AuthorizationPolicy policy) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "51bc235752b26a2db428f1ab6b827ceca76b2720"}, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Nzg4NzY5NA==", "bodyText": "added", "url": "https://github.com/kiegroup/appformer/pull/876#discussion_r367887694", "createdAt": "2020-01-17T11:18:27Z", "author": {"login": "RishiRajAnand"}, "path": "uberfire-backend/uberfire-backend-server/src/main/java/org/uberfire/backend/server/authz/AuthorizationPolicyVfsStorage.java", "diffHunk": "@@ -149,7 +150,34 @@ public FileVisitResult visitFile(final Path file,\n \n     public boolean isPolicyFile(Path p) {\n         String fileName = p.getName(p.getNameCount() - 1).toString();\n-        return fileName.equals(\"security-policy.properties\") || fileName.startsWith(\"security-module-\");\n+        return fileName.equals(POLICY_FILE) || fileName.startsWith(\"security-module-\");\n+    }\n+\n+    @Override\n+    public void deletePolicyByGroup(Group group, AuthorizationPolicy policy) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjgxMjUzOQ=="}, "originalCommit": {"oid": "51bc235752b26a2db428f1ab6b827ceca76b2720"}, "originalPosition": 29}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI2NjM3OTExOnYy", "diffSide": "RIGHT", "path": "uberfire-backend/uberfire-backend-server/src/main/java/org/uberfire/backend/server/authz/AuthorizationPolicyVfsStorage.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNVQxMTowNTo0NlrOFd0wyw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xN1QxMToxOToxMFrOFe2GXg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjgxNzQ4Mw==", "bodyText": "I see that lines 161 to 174 have almost the same code as the savePolicyIntoVfs method.\nConsider extracting duplicated code into generic methods.", "url": "https://github.com/kiegroup/appformer/pull/876#discussion_r366817483", "createdAt": "2020-01-15T11:05:46Z", "author": {"login": "caponetto"}, "path": "uberfire-backend/uberfire-backend-server/src/main/java/org/uberfire/backend/server/authz/AuthorizationPolicyVfsStorage.java", "diffHunk": "@@ -149,7 +150,34 @@ public FileVisitResult visitFile(final Path file,\n \n     public boolean isPolicyFile(Path p) {\n         String fileName = p.getName(p.getNameCount() - 1).toString();\n-        return fileName.equals(\"security-policy.properties\") || fileName.startsWith(\"security-module-\");\n+        return fileName.equals(POLICY_FILE) || fileName.startsWith(\"security-module-\");\n+    }\n+\n+    @Override\n+    public void deletePolicyByGroup(Group group, AuthorizationPolicy policy) {\n+        ioService.startBatch(fileSystem,\n+                             new CommentedOption(\"system\",\n+                                                 \"Delete Policy\"));\n+        try (StringWriter sw = new StringWriter()){", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "51bc235752b26a2db428f1ab6b827ceca76b2720"}, "originalPosition": 33}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Nzg4Nzk2Ng==", "bodyText": "removed duplicated code", "url": "https://github.com/kiegroup/appformer/pull/876#discussion_r367887966", "createdAt": "2020-01-17T11:19:10Z", "author": {"login": "RishiRajAnand"}, "path": "uberfire-backend/uberfire-backend-server/src/main/java/org/uberfire/backend/server/authz/AuthorizationPolicyVfsStorage.java", "diffHunk": "@@ -149,7 +150,34 @@ public FileVisitResult visitFile(final Path file,\n \n     public boolean isPolicyFile(Path p) {\n         String fileName = p.getName(p.getNameCount() - 1).toString();\n-        return fileName.equals(\"security-policy.properties\") || fileName.startsWith(\"security-module-\");\n+        return fileName.equals(POLICY_FILE) || fileName.startsWith(\"security-module-\");\n+    }\n+\n+    @Override\n+    public void deletePolicyByGroup(Group group, AuthorizationPolicy policy) {\n+        ioService.startBatch(fileSystem,\n+                             new CommentedOption(\"system\",\n+                                                 \"Delete Policy\"));\n+        try (StringWriter sw = new StringWriter()){", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjgxNzQ4Mw=="}, "originalCommit": {"oid": "51bc235752b26a2db428f1ab6b827ceca76b2720"}, "originalPosition": 33}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI2NjM4OTUzOnYy", "diffSide": "RIGHT", "path": "uberfire-backend/uberfire-backend-server/src/main/java/org/uberfire/backend/server/authz/AuthorizationPolicyMarshaller.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNVQxMTowOTo1M1rOFd03TA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNVQxMTowOTo1M1rOFd03TA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjgxOTE0OA==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                public void remove (Group group , AuthorizationPolicy policy,\n          \n          \n            \n                public void remove(Group group, AuthorizationPolicy policy,", "url": "https://github.com/kiegroup/appformer/pull/876#discussion_r366819148", "createdAt": "2020-01-15T11:09:53Z", "author": {"login": "caponetto"}, "path": "uberfire-backend/uberfire-backend-server/src/main/java/org/uberfire/backend/server/authz/AuthorizationPolicyMarshaller.java", "diffHunk": "@@ -323,6 +323,39 @@ public void write(Group group,\n         }\n     }\n \n+    public void remove (Group group , AuthorizationPolicy policy,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "51bc235752b26a2db428f1ab6b827ceca76b2720"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI2NjM5MDM3OnYy", "diffSide": "RIGHT", "path": "uberfire-backend/uberfire-backend-server/src/main/java/org/uberfire/backend/server/authz/AuthorizationPolicyMarshaller.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNVQxMToxMDoxM1rOFd03zA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNVQxMToxMDoxM1rOFd03zA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjgxOTI3Ng==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                                  Map out) {\n          \n          \n            \n                                   Map out) {", "url": "https://github.com/kiegroup/appformer/pull/876#discussion_r366819276", "createdAt": "2020-01-15T11:10:13Z", "author": {"login": "caponetto"}, "path": "uberfire-backend/uberfire-backend-server/src/main/java/org/uberfire/backend/server/authz/AuthorizationPolicyMarshaller.java", "diffHunk": "@@ -323,6 +323,39 @@ public void write(Group group,\n         }\n     }\n \n+    public void remove (Group group , AuthorizationPolicy policy,\n+                        Map out) {\n+\n+        write(policy,out);\n+\n+        for (Group subject : policy.getGroups()) {\n+            if (group.getName().equals(subject.getName())){\n+                remove(subject,\n+                       out);\n+                remove(subject,\n+                      policy.getPermissions(subject),\n+                      out);\n+            }\n+        }\n+    }\n+\n+    public void remove(Group group,\n+                      Map out) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "51bc235752b26a2db428f1ab6b827ceca76b2720"}, "originalPosition": 21}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI2NjM5NDE1OnYy", "diffSide": "RIGHT", "path": "uberfire-backend/uberfire-backend-server/src/main/java/org/uberfire/backend/server/authz/AuthorizationPolicyMarshaller.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNVQxMToxMTo0MVrOFd06MQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNVQxMToxMTo0MVrOFd06MQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjgxOTg4OQ==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                                  policy.getPermissions(subject),\n          \n          \n            \n                                   policy.getPermissions(subject),", "url": "https://github.com/kiegroup/appformer/pull/876#discussion_r366819889", "createdAt": "2020-01-15T11:11:41Z", "author": {"login": "caponetto"}, "path": "uberfire-backend/uberfire-backend-server/src/main/java/org/uberfire/backend/server/authz/AuthorizationPolicyMarshaller.java", "diffHunk": "@@ -323,6 +323,39 @@ public void write(Group group,\n         }\n     }\n \n+    public void remove (Group group , AuthorizationPolicy policy,\n+                        Map out) {\n+\n+        write(policy,out);\n+\n+        for (Group subject : policy.getGroups()) {\n+            if (group.getName().equals(subject.getName())){\n+                remove(subject,\n+                       out);\n+                remove(subject,\n+                      policy.getPermissions(subject),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "51bc235752b26a2db428f1ab6b827ceca76b2720"}, "originalPosition": 14}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI2NjM5NDUyOnYy", "diffSide": "RIGHT", "path": "uberfire-backend/uberfire-backend-server/src/main/java/org/uberfire/backend/server/authz/AuthorizationPolicyMarshaller.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNVQxMToxMTo1MVrOFd06bQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNVQxMToxMTo1MVrOFd06bQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjgxOTk0OQ==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                                  out);\n          \n          \n            \n                                   out);", "url": "https://github.com/kiegroup/appformer/pull/876#discussion_r366819949", "createdAt": "2020-01-15T11:11:51Z", "author": {"login": "caponetto"}, "path": "uberfire-backend/uberfire-backend-server/src/main/java/org/uberfire/backend/server/authz/AuthorizationPolicyMarshaller.java", "diffHunk": "@@ -323,6 +323,39 @@ public void write(Group group,\n         }\n     }\n \n+    public void remove (Group group , AuthorizationPolicy policy,\n+                        Map out) {\n+\n+        write(policy,out);\n+\n+        for (Group subject : policy.getGroups()) {\n+            if (group.getName().equals(subject.getName())){\n+                remove(subject,\n+                       out);\n+                remove(subject,\n+                      policy.getPermissions(subject),\n+                      out);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "51bc235752b26a2db428f1ab6b827ceca76b2720"}, "originalPosition": 15}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI4Njk3NjAyOnYy", "diffSide": "RIGHT", "path": "uberfire-backend/uberfire-backend-server/src/main/java/org/uberfire/backend/server/authz/AuthorizationPolicyMarshaller.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yM1QwOToyOTo1NlrOFg3nJw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yN1QwODo0ODoxNlrOFh7Jgw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDAwOTg5NQ==", "bodyText": "This remove method as well as the following one can be private as they're only used in this class (if I looked correctly).", "url": "https://github.com/kiegroup/appformer/pull/876#discussion_r370009895", "createdAt": "2020-01-23T09:29:56Z", "author": {"login": "barboras7"}, "path": "uberfire-backend/uberfire-backend-server/src/main/java/org/uberfire/backend/server/authz/AuthorizationPolicyMarshaller.java", "diffHunk": "@@ -323,6 +323,39 @@ public void write(Group group,\n         }\n     }\n \n+    public void remove(Group group, AuthorizationPolicy policy,\n+                       Map out) {\n+\n+        write(policy, out);\n+\n+        for (Group subject : policy.getGroups()) {\n+            if (group.getName().equals(subject.getName())) {\n+                remove(subject,\n+                       out);\n+                remove(subject,\n+                       policy.getPermissions(subject),\n+                       out);\n+            }\n+        }\n+    }\n+\n+    public void remove(Group group,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cb91eaa57e1a6c4979c20504088579bc2cb32c37"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTExNjQxOQ==", "bodyText": "These methods are not used directly by other classes at the moment, so it makes sense to make this private. However, these methods are generic and can be used for specific use cases in future.", "url": "https://github.com/kiegroup/appformer/pull/876#discussion_r371116419", "createdAt": "2020-01-27T08:48:16Z", "author": {"login": "RishiRajAnand"}, "path": "uberfire-backend/uberfire-backend-server/src/main/java/org/uberfire/backend/server/authz/AuthorizationPolicyMarshaller.java", "diffHunk": "@@ -323,6 +323,39 @@ public void write(Group group,\n         }\n     }\n \n+    public void remove(Group group, AuthorizationPolicy policy,\n+                       Map out) {\n+\n+        write(policy, out);\n+\n+        for (Group subject : policy.getGroups()) {\n+            if (group.getName().equals(subject.getName())) {\n+                remove(subject,\n+                       out);\n+                remove(subject,\n+                       policy.getPermissions(subject),\n+                       out);\n+            }\n+        }\n+    }\n+\n+    public void remove(Group group,", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDAwOTg5NQ=="}, "originalCommit": {"oid": "cb91eaa57e1a6c4979c20504088579bc2cb32c37"}, "originalPosition": 20}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI4Njk5OTkxOnYy", "diffSide": "RIGHT", "path": "uberfire-backend/uberfire-backend-server/src/main/java/org/uberfire/backend/server/authz/AuthorizationPolicyVfsStorage.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yM1QwOTozNzoxM1rOFg31MQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yM1QwOTozNzoxM1rOFg31MQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDAxMzQ4OQ==", "bodyText": "unnecessary empty line", "url": "https://github.com/kiegroup/appformer/pull/876#discussion_r370013489", "createdAt": "2020-01-23T09:37:13Z", "author": {"login": "barboras7"}, "path": "uberfire-backend/uberfire-backend-server/src/main/java/org/uberfire/backend/server/authz/AuthorizationPolicyVfsStorage.java", "diffHunk": "@@ -84,7 +85,14 @@ public synchronized AuthorizationPolicy loadPolicy() {\n \n     @Override\n     public synchronized void savePolicy(AuthorizationPolicy policy) {\n-        savePolicyIntoVfs(policy,\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cb91eaa57e1a6c4979c20504088579bc2cb32c37"}, "originalPosition": 45}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI4NzAwMjA0OnYy", "diffSide": "RIGHT", "path": "uberfire-backend/uberfire-backend-server/src/main/java/org/uberfire/backend/server/authz/AuthorizationPolicyVfsStorage.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yM1QwOTozNzo0N1rOFg32VQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yN1QwODo0NToyOVrOFh7FKA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDAxMzc4MQ==", "bodyText": "empty line", "url": "https://github.com/kiegroup/appformer/pull/876#discussion_r370013781", "createdAt": "2020-01-23T09:37:47Z", "author": {"login": "barboras7"}, "path": "uberfire-backend/uberfire-backend-server/src/main/java/org/uberfire/backend/server/authz/AuthorizationPolicyVfsStorage.java", "diffHunk": "@@ -149,10 +157,22 @@ public FileVisitResult visitFile(final Path file,\n \n     public boolean isPolicyFile(Path p) {\n         String fileName = p.getName(p.getNameCount() - 1).toString();\n-        return fileName.equals(\"security-policy.properties\") || fileName.startsWith(\"security-module-\");\n+        return fileName.equals(POLICY_FILE) || fileName.startsWith(\"security-module-\");\n     }\n \n-    public void savePolicyIntoVfs(AuthorizationPolicy policy,\n+    @Override\n+    public void deletePolicyByGroup(Group group, AuthorizationPolicy policy) {\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cb91eaa57e1a6c4979c20504088579bc2cb32c37"}, "originalPosition": 67}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTExNTMwNA==", "bodyText": "removed empty line", "url": "https://github.com/kiegroup/appformer/pull/876#discussion_r371115304", "createdAt": "2020-01-27T08:45:29Z", "author": {"login": "RishiRajAnand"}, "path": "uberfire-backend/uberfire-backend-server/src/main/java/org/uberfire/backend/server/authz/AuthorizationPolicyVfsStorage.java", "diffHunk": "@@ -149,10 +157,22 @@ public FileVisitResult visitFile(final Path file,\n \n     public boolean isPolicyFile(Path p) {\n         String fileName = p.getName(p.getNameCount() - 1).toString();\n-        return fileName.equals(\"security-policy.properties\") || fileName.startsWith(\"security-module-\");\n+        return fileName.equals(POLICY_FILE) || fileName.startsWith(\"security-module-\");\n     }\n \n-    public void savePolicyIntoVfs(AuthorizationPolicy policy,\n+    @Override\n+    public void deletePolicyByGroup(Group group, AuthorizationPolicy policy) {\n+", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDAxMzc4MQ=="}, "originalCommit": {"oid": "cb91eaa57e1a6c4979c20504088579bc2cb32c37"}, "originalPosition": 67}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI4NzEyNTY1OnYy", "diffSide": "RIGHT", "path": "uberfire-backend/uberfire-backend-server/src/test/java/org/uberfire/backend/server/authz/AuthzPolicyDeployerTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yM1QxMDoxNToxM1rOFg5AZQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yM1QxMDoxNToxM1rOFg5AZQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDAzMjc0MQ==", "bodyText": "unnecessary semicolon", "url": "https://github.com/kiegroup/appformer/pull/876#discussion_r370032741", "createdAt": "2020-01-23T10:15:13Z", "author": {"login": "barboras7"}, "path": "uberfire-backend/uberfire-backend-server/src/test/java/org/uberfire/backend/server/authz/AuthzPolicyDeployerTest.java", "diffHunk": "@@ -95,6 +105,42 @@ public void testPolicyLoad2() throws Exception {\n         testPolicyLoad(\"WEB-INF/classes/split/security-policy.properties\");\n     }\n \n+    @Test\n+    public void testPolicyDelete() throws Exception {\n+        testPolicyDelete(\"WEB-INF/classes/security-policy.properties\");\n+    }\n+\n+    public void testPolicyDelete(String path) throws Exception {\n+        URL fileURL = Thread.currentThread().getContextClassLoader().getResource(path);\n+        Path policyDir = Paths.get(fileURL.toURI()).getParent();\n+\n+        assertTrue(RoleRegistry.get().getRegisteredRoles().isEmpty());\n+\n+        deployer.deployPolicy(policyDir);\n+\n+        ArgumentCaptor<AuthorizationPolicy> policyCaptor = ArgumentCaptor.forClass(AuthorizationPolicy.class);\n+        ArgumentCaptor<Group> groupCaptor = ArgumentCaptor.forClass(Group.class);\n+\n+        verify(storage).loadPolicy();\n+        verify(storage).savePolicy(policyCaptor.capture());\n+        Group group = new GroupImpl(\"group1\");\n+        storage.deletePolicyByGroup(group, policyCaptor.getValue());\n+        verify(storage).deletePolicyByGroup(groupCaptor.capture(), policyCaptor.capture());\n+        verify(event).fire(any());\n+\n+        AuthorizationPolicy policy = policyCaptor.getValue();\n+        verify(permissionManager).setAuthorizationPolicy(policy);\n+\n+        Set<Group> roles = policyCaptor.getValue().getGroups();\n+        assertEquals(1, roles.size());\n+\n+        PermissionCollection permissions = policy.getPermissions(group);\n+        Permission permission = permissions.get(\"perspective.read\");\n+        assertNotNull(permission);\n+        assertEquals(AuthorizationResult.ACCESS_GRANTED, permission.getResult());\n+        ;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cb91eaa57e1a6c4979c20504088579bc2cb32c37"}, "originalPosition": 67}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI4NzE2MzczOnYy", "diffSide": "RIGHT", "path": "uberfire-extensions/uberfire-security/uberfire-security-management/uberfire-widgets-security-management/src/main/java/org/uberfire/ext/security/management/client/widgets/management/editor/group/workflow/GroupEditorWorkflow.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yM1QxMDoyNzo0MFrOFg5Xmw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yM1QxMDoyNzo0MFrOFg5Xmw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDAzODY4Mw==", "bodyText": "empty line", "url": "https://github.com/kiegroup/appformer/pull/876#discussion_r370038683", "createdAt": "2020-01-23T10:27:40Z", "author": {"login": "barboras7"}, "path": "uberfire-extensions/uberfire-security/uberfire-security-management/uberfire-widgets-security-management/src/main/java/org/uberfire/ext/security/management/client/widgets/management/editor/group/workflow/GroupEditorWorkflow.java", "diffHunk": "@@ -163,14 +164,26 @@ public boolean isDirty() {\n     void delete() {\n         final String name = group.getName();\n         userSystemManager.groups((Void v) -> {\n-                                     deleteGroupEvent.fire(new DeleteGroupEvent(name));\n-                                     workbenchNotification.fire(new NotificationEvent(UsersManagementWidgetsConstants.INSTANCE.groupRemoved(name),\n-                                                                                      INFO));\n+                                     doDelete();\n                                      clear();\n                                  },\n                                  errorCallback).delete(name);\n     }\n \n+    protected void doDelete(){\n+        final String name = group.getName();\n+        AuthorizationPolicy authzPolicy = permissionManager.getAuthorizationPolicy();\n+        showLoadingBox();\n+        authorizationService.call(r -> {\n+                                      hideLoadingBox();\n+                                      deleteGroupEvent.fire(new DeleteGroupEvent(name));\n+                                      workbenchNotification.fire(new NotificationEvent(UsersManagementWidgetsConstants.INSTANCE.groupRemoved(name),\n+                                                                                       INFO));\n+                                  },\n+                                  errorCallback).deletePolicyByGroup(group, authzPolicy);\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cb91eaa57e1a6c4979c20504088579bc2cb32c37"}, "originalPosition": 32}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2850, "cost": 1, "resetAt": "2021-11-12T20:28:25Z"}}}