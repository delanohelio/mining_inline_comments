{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTM1Mjk1MzMw", "number": 1085, "title": "BAPL-1735 :[GSS-RFE] RHPAM + RHSSO customer asking for support of Client Roles", "bodyText": "Thank you for submitting this pull request\nBAPL-1735: https://issues.redhat.com/browse/BAPL-1735\n\nAdded a new system property -Dorg.uberfire.ext.security.management.keycloak.use-resource-role-mapping=true that allows the client roles in RHSSO to be fetched and used inside business central.\nAll the operations like add,remove,assign user etc will be supported in business central for these client roles.\n\n\n\nHow to retest this PR or trigger a specific build:\n\n\n\na pull request please add comment: Jenkins retest this\n\n\na full downstream build please add comment: Jenkins run fdb\n\n\na compile downstream build please  add comment: Jenkins run cdb\n\n\na full production downstream build please add comment: Jenkins execute product fdb\n\n\nan upstream build please add comment: Jenkins run upstream", "createdAt": "2020-12-09T16:17:07Z", "url": "https://github.com/kiegroup/appformer/pull/1085", "merged": true, "mergeCommit": {"oid": "ebebaf85a7f9d595129473234de71de6f0a79312"}, "closed": true, "closedAt": "2020-12-18T12:55:50Z", "author": {"login": "RishiRajAnand"}, "timelineItems": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdk0CuegBqjQwOTUzMzQ1OTM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdnXrQqgFqTU1NTQ2MTk3Ng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c85d8b37e198e06d7a13aff1de882fbeb4b4542d", "author": {"user": {"login": "RishiRajAnand", "name": "Rishiraj Anand"}}, "url": "https://github.com/kiegroup/appformer/commit/c85d8b37e198e06d7a13aff1de882fbeb4b4542d", "committedDate": "2020-12-09T16:10:31Z", "message": "BAPL-1735 :[GSS-RFE] RHPAM + RHSSO customer asking for support of Client Roles"}, "afterCommit": {"oid": "0d2b752d14917284a61fca6144d0c2f11aa605f2", "author": {"user": {"login": "RishiRajAnand", "name": "Rishiraj Anand"}}, "url": "https://github.com/kiegroup/appformer/commit/0d2b752d14917284a61fca6144d0c2f11aa605f2", "committedDate": "2020-12-10T14:15:37Z", "message": "BAPL-1735 :[GSS-RFE] RHPAM + RHSSO customer asking for support of Client Roles"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ5MjY1NTM0", "url": "https://github.com/kiegroup/appformer/pull/1085#pullrequestreview-549265534", "createdAt": "2020-12-10T14:43:54Z", "commit": {"oid": "0d2b752d14917284a61fca6144d0c2f11aa605f2"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMFQxNDo0Mzo1NFrOIDMq8Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMFQxNDo1NToxOVrOIDNQKw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDIyNDI0MQ==", "bodyText": "Can this be null or fail somehow?", "url": "https://github.com/kiegroup/appformer/pull/1085#discussion_r540224241", "createdAt": "2020-12-10T14:43:54Z", "author": {"login": "adrielparedes"}, "path": "uberfire-extensions/uberfire-security/uberfire-security-management/uberfire-security-management-keycloak/src/main/java/org/uberfire/ext/security/management/keycloak/KeyCloakGroupManager.java", "diffHunk": "@@ -104,9 +104,10 @@ public Group get(String identifier) throws SecurityManagementException {\n     @Override\n     public List<Group> getAll() throws SecurityManagementException {\n         final List<Group> roles = new LinkedList<>();\n+        final RolesResource[] rolesResource = new RolesResource[1];\n         consumeRealm(realmResource -> {\n-            final RolesResource rolesResource = realmResource.roles();\n-            final List<RoleRepresentation> roleRepresentations = rolesResource.list();\n+            rolesResource[0] = getRolesResource(realmResource, useResourceRoleMapping);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0d2b752d14917284a61fca6144d0c2f11aa605f2"}, "originalPosition": 26}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDIyNjk1MA==", "bodyText": "Why there is a list of 1 element here? Can't we wait until the list is needed to create a Collection.singletonList()?", "url": "https://github.com/kiegroup/appformer/pull/1085#discussion_r540226950", "createdAt": "2020-12-10T14:47:12Z", "author": {"login": "adrielparedes"}, "path": "uberfire-extensions/uberfire-security/uberfire-security-management/uberfire-security-management-keycloak/src/main/java/org/uberfire/ext/security/management/keycloak/KeyCloakGroupManager.java", "diffHunk": "@@ -104,9 +104,10 @@ public Group get(String identifier) throws SecurityManagementException {\n     @Override\n     public List<Group> getAll() throws SecurityManagementException {\n         final List<Group> roles = new LinkedList<>();\n+        final RolesResource[] rolesResource = new RolesResource[1];", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0d2b752d14917284a61fca6144d0c2f11aa605f2"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDIyNzQ4NQ==", "bodyText": "Is this always going to return a value or could be null?", "url": "https://github.com/kiegroup/appformer/pull/1085#discussion_r540227485", "createdAt": "2020-12-10T14:47:49Z", "author": {"login": "adrielparedes"}, "path": "uberfire-extensions/uberfire-security/uberfire-security-management/uberfire-security-management-keycloak/src/main/java/org/uberfire/ext/security/management/keycloak/BaseKeyCloakManager.java", "diffHunk": "@@ -288,4 +318,19 @@ protected void handleResponse(ClientResponse response) {\n             }\n         }\n     }\n+\n+    protected RolesResource getRolesResource(RealmResource realmResource, boolean useClientRoles) {\n+        if (useClientRoles) {\n+            return realmResource.clients().get(getClientIdByName(realmResource)).roles();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0d2b752d14917284a61fca6144d0c2f11aa605f2"}, "originalPosition": 112}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDIzMzc3MQ==", "bodyText": "I saw this IF Pattern 3 times. Can't we do something to extract that first part?\nSomething like:\npublic ACommonInterface getSomething(){\n  if (useResourceRoleMapping) {\n    return roleMappingResource.clientLevel(getClientIdByName(getRealmResource()))\n   } else {\n     return roleMappingResource.realmLevel()\n   }\n}", "url": "https://github.com/kiegroup/appformer/pull/1085#discussion_r540233771", "createdAt": "2020-12-10T14:55:19Z", "author": {"login": "adrielparedes"}, "path": "uberfire-extensions/uberfire-security/uberfire-security-management/uberfire-security-management-keycloak/src/main/java/org/uberfire/ext/security/management/keycloak/BaseKeyCloakManager.java", "diffHunk": "@@ -165,7 +174,13 @@ protected Group createGroup(String name) {\n \n     protected Set[] getUserGroupsAndRoles(final RoleMappingResource roleMappingResource) {\n         if (roleMappingResource != null) {\n-            List<RoleRepresentation> roles = roleMappingResource.realmLevel().listEffective();\n+            List<RoleRepresentation> roles;\n+            if (useResourceRoleMapping) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0d2b752d14917284a61fca6144d0c2f11aa605f2"}, "originalPosition": 65}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ5Mjg5NzM3", "url": "https://github.com/kiegroup/appformer/pull/1085#pullrequestreview-549289737", "createdAt": "2020-12-10T15:06:06Z", "commit": {"oid": "0d2b752d14917284a61fca6144d0c2f11aa605f2"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMFQxNTowNjowNlrOIDNzNw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMFQxNTowNjowNlrOIDNzNw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDI0Mjc0Mw==", "bodyText": "Is this a default value? Does client always have to be kie?", "url": "https://github.com/kiegroup/appformer/pull/1085#discussion_r540242743", "createdAt": "2020-12-10T15:06:06Z", "author": {"login": "tomasdavidorg"}, "path": "uberfire-extensions/uberfire-security/uberfire-security-management/uberfire-security-management-keycloak/src/main/java/org/uberfire/ext/security/management/keycloak/BaseKeyCloakManager.java", "diffHunk": "@@ -56,6 +61,10 @@\n \n     static final int STATUS_NOT_AUTHORIZED = 403;\n \n+    protected static final String DEFAULT_USE_RESOURCE_ROLE_MAPPING = \"false\";\n+    protected static final String CLIENT_ID = \"kie\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0d2b752d14917284a61fca6144d0c2f11aa605f2"}, "originalPosition": 53}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ5ODg1OTQ2", "url": "https://github.com/kiegroup/appformer/pull/1085#pullrequestreview-549885946", "createdAt": "2020-12-11T08:22:58Z", "commit": {"oid": "0d2b752d14917284a61fca6144d0c2f11aa605f2"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMVQwODoyMjo1OFrOIDt7xA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMVQwODoyMjo1OFrOIDt7xA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDc2OTIyMA==", "bodyText": "The formatting of the header is broken on the new files.", "url": "https://github.com/kiegroup/appformer/pull/1085#discussion_r540769220", "createdAt": "2020-12-11T08:22:58Z", "author": {"login": "tomasdavidorg"}, "path": "uberfire-extensions/uberfire-security/uberfire-security-management/uberfire-security-management-api/src/main/java/org/uberfire/ext/security/management/api/exception/ClientNotFoundException.java", "diffHunk": "@@ -0,0 +1,35 @@\n+/*\n+ *\n+ *   Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ *   Licensed under the Apache License, Version 2.0 (the \"License\");\n+ *   you may not use this file except in compliance with the License.\n+ *   You may obtain a copy of the License at\n+ *\n+ *         http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *   Unless required by applicable law or agreed to in writing, software\n+ *   distributed under the License is distributed on an \"AS IS\" BASIS,\n+ *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ *   See the License for the specific language governing permissions and\n+ *   limitations under the License.\n+ *\n+ */\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0d2b752d14917284a61fca6144d0c2f11aa605f2"}, "originalPosition": 18}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0d2b752d14917284a61fca6144d0c2f11aa605f2", "author": {"user": {"login": "RishiRajAnand", "name": "Rishiraj Anand"}}, "url": "https://github.com/kiegroup/appformer/commit/0d2b752d14917284a61fca6144d0c2f11aa605f2", "committedDate": "2020-12-10T14:15:37Z", "message": "BAPL-1735 :[GSS-RFE] RHPAM + RHSSO customer asking for support of Client Roles"}, "afterCommit": {"oid": "fd22d1da3461f393cbc2ae4cd186f1159797fc1c", "author": {"user": {"login": "RishiRajAnand", "name": "Rishiraj Anand"}}, "url": "https://github.com/kiegroup/appformer/commit/fd22d1da3461f393cbc2ae4cd186f1159797fc1c", "committedDate": "2020-12-11T11:07:18Z", "message": "BAPL-1735 :[GSS-RFE] RHPAM + RHSSO customer asking for support of Client Roles"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUwMDEzMjI1", "url": "https://github.com/kiegroup/appformer/pull/1085#pullrequestreview-550013225", "createdAt": "2020-12-11T11:21:20Z", "commit": {"oid": "fd22d1da3461f393cbc2ae4cd186f1159797fc1c"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMVQxMToyMToyMFrOID0iBQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMVQxMToyMTozN1rOID0ipg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDg3NzMxNw==", "bodyText": "Please format also here.", "url": "https://github.com/kiegroup/appformer/pull/1085#discussion_r540877317", "createdAt": "2020-12-11T11:21:20Z", "author": {"login": "tomasdavidorg"}, "path": "uberfire-extensions/uberfire-security/uberfire-security-management/uberfire-security-management-keycloak/src/main/java/org/uberfire/ext/security/management/keycloak/client/resource/ClientResource.java", "diffHunk": "@@ -0,0 +1,27 @@\n+/*\n+ *\n+ *   Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ *   Licensed under the Apache License, Version 2.0 (the \"License\");\n+ *   you may not use this file except in compliance with the License.\n+ *   You may obtain a copy of the License at\n+ *\n+ *         http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *   Unless required by applicable law or agreed to in writing, software\n+ *   distributed under the License is distributed on an \"AS IS\" BASIS,\n+ *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ *   See the License for the specific language governing permissions and\n+ *   limitations under the License.\n+ *\n+ */\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fd22d1da3461f393cbc2ae4cd186f1159797fc1c"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDg3NzQ3OA==", "bodyText": "Please format also here.", "url": "https://github.com/kiegroup/appformer/pull/1085#discussion_r540877478", "createdAt": "2020-12-11T11:21:37Z", "author": {"login": "tomasdavidorg"}, "path": "uberfire-extensions/uberfire-security/uberfire-security-management/uberfire-security-management-keycloak/src/main/java/org/uberfire/ext/security/management/keycloak/client/resource/ClientsResource.java", "diffHunk": "@@ -0,0 +1,41 @@\n+/*\n+ *\n+ *   Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ *   Licensed under the Apache License, Version 2.0 (the \"License\");\n+ *   you may not use this file except in compliance with the License.\n+ *   You may obtain a copy of the License at\n+ *\n+ *         http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *   Unless required by applicable law or agreed to in writing, software\n+ *   distributed under the License is distributed on an \"AS IS\" BASIS,\n+ *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ *   See the License for the specific language governing permissions and\n+ *   limitations under the License.\n+ *\n+ */", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fd22d1da3461f393cbc2ae4cd186f1159797fc1c"}, "originalPosition": 17}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "fd22d1da3461f393cbc2ae4cd186f1159797fc1c", "author": {"user": {"login": "RishiRajAnand", "name": "Rishiraj Anand"}}, "url": "https://github.com/kiegroup/appformer/commit/fd22d1da3461f393cbc2ae4cd186f1159797fc1c", "committedDate": "2020-12-11T11:07:18Z", "message": "BAPL-1735 :[GSS-RFE] RHPAM + RHSSO customer asking for support of Client Roles"}, "afterCommit": {"oid": "82dfca0c7d5449d0db043d9b97db3b61b627b524", "author": {"user": {"login": "RishiRajAnand", "name": "Rishiraj Anand"}}, "url": "https://github.com/kiegroup/appformer/commit/82dfca0c7d5449d0db043d9b97db3b61b627b524", "committedDate": "2020-12-11T11:24:23Z", "message": "BAPL-1735 :[GSS-RFE] RHPAM + RHSSO customer asking for support of Client Roles"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "52eafc71f7af61f46857c57527ddf39434eb0de9", "author": {"user": {"login": "RishiRajAnand", "name": "Rishiraj Anand"}}, "url": "https://github.com/kiegroup/appformer/commit/52eafc71f7af61f46857c57527ddf39434eb0de9", "committedDate": "2020-12-17T10:25:35Z", "message": "BAPL-1735 :[GSS-RFE] RHPAM + RHSSO customer asking for support of Client Roles\nBAPL-1735 :[GSS-RFE] RHPAM + RHSSO customer asking for support of Client Roles"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "82dfca0c7d5449d0db043d9b97db3b61b627b524", "author": {"user": {"login": "RishiRajAnand", "name": "Rishiraj Anand"}}, "url": "https://github.com/kiegroup/appformer/commit/82dfca0c7d5449d0db043d9b97db3b61b627b524", "committedDate": "2020-12-11T11:24:23Z", "message": "BAPL-1735 :[GSS-RFE] RHPAM + RHSSO customer asking for support of Client Roles"}, "afterCommit": {"oid": "52eafc71f7af61f46857c57527ddf39434eb0de9", "author": {"user": {"login": "RishiRajAnand", "name": "Rishiraj Anand"}}, "url": "https://github.com/kiegroup/appformer/commit/52eafc71f7af61f46857c57527ddf39434eb0de9", "committedDate": "2020-12-17T10:25:35Z", "message": "BAPL-1735 :[GSS-RFE] RHPAM + RHSSO customer asking for support of Client Roles\nBAPL-1735 :[GSS-RFE] RHPAM + RHSSO customer asking for support of Client Roles"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU0Nzg1MDQ3", "url": "https://github.com/kiegroup/appformer/pull/1085#pullrequestreview-554785047", "createdAt": "2020-12-17T16:42:02Z", "commit": {"oid": "52eafc71f7af61f46857c57527ddf39434eb0de9"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU0ODIyMzg0", "url": "https://github.com/kiegroup/appformer/pull/1085#pullrequestreview-554822384", "createdAt": "2020-12-17T17:24:24Z", "commit": {"oid": "52eafc71f7af61f46857c57527ddf39434eb0de9"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU1NDYxOTc2", "url": "https://github.com/kiegroup/appformer/pull/1085#pullrequestreview-555461976", "createdAt": "2020-12-18T12:55:21Z", "commit": {"oid": "52eafc71f7af61f46857c57527ddf39434eb0de9"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2040, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}