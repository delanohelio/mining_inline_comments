{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzYxNDE5NDk0", "number": 876, "title": "AF-2397 :Deletion of group from Business Central UI does not remove group from the security-policy.properties file", "bodyText": "Added feature to remove a specific group from security-policy.properties\nIf the user adds a group with the same name as deleted group, default configurations will be applied to the newly added group.", "createdAt": "2020-01-10T12:01:52Z", "url": "https://github.com/kiegroup/appformer/pull/876", "merged": true, "mergeCommit": {"oid": "68a4acdb866a94a0fb408b875b09da2c1e3dc84a"}, "closed": true, "closedAt": "2020-02-04T15:03:08Z", "author": {"login": "RishiRajAnand"}, "timelineItems": {"totalCount": 14, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb562tmABqjI5NDI4NDkwNzM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcBC5uWAFqTM1MzA0NTM1NA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0fc8342161831e46df3001aaa42e67cbc26fa457", "author": {"user": null}, "url": "https://github.com/kiegroup/appformer/commit/0fc8342161831e46df3001aaa42e67cbc26fa457", "committedDate": "2020-01-10T10:23:13Z", "message": "AF-2397 :Deletion of group from Business Central UI does not remove group from the security-policy.properties file\n-  Added feature to remove a specific group from security-policy.properties\n-  If the user adds a group with the same name as deleted group, default configurations will be applied to the newly added group."}, "afterCommit": {"oid": "51dfb288bb36d1f77a668b4421ead37b6d6b842c", "author": {"user": null}, "url": "https://github.com/kiegroup/appformer/commit/51dfb288bb36d1f77a668b4421ead37b6d6b842c", "committedDate": "2020-01-13T11:41:24Z", "message": "AF-2397 :Deletion of group from Business Central UI does not remove group from the security-policy.properties file\n-  Added feature to remove a specific group from security-policy.properties\n-  If the user adds a group with the same name as deleted group, default configurations will be applied to the newly added group."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "51dfb288bb36d1f77a668b4421ead37b6d6b842c", "author": {"user": null}, "url": "https://github.com/kiegroup/appformer/commit/51dfb288bb36d1f77a668b4421ead37b6d6b842c", "committedDate": "2020-01-13T11:41:24Z", "message": "AF-2397 :Deletion of group from Business Central UI does not remove group from the security-policy.properties file\n-  Added feature to remove a specific group from security-policy.properties\n-  If the user adds a group with the same name as deleted group, default configurations will be applied to the newly added group."}, "afterCommit": {"oid": "51bc235752b26a2db428f1ab6b827ceca76b2720", "author": {"user": null}, "url": "https://github.com/kiegroup/appformer/commit/51bc235752b26a2db428f1ab6b827ceca76b2720", "committedDate": "2020-01-13T14:29:51Z", "message": "AF-2397 :Deletion of group from Business Central UI does not remove group from the security-policy.properties file\n-  Added feature to remove a specific group from security-policy.properties\n-  If the user adds a group with the same name as deleted group, default configurations will be applied to the newly added group."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQzMTMwMDU3", "url": "https://github.com/kiegroup/appformer/pull/876#pullrequestreview-343130057", "createdAt": "2020-01-15T10:43:51Z", "commit": {"oid": "51bc235752b26a2db428f1ab6b827ceca76b2720"}, "state": "COMMENTED", "comments": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNVQxMDo0Mzo1MVrOFd0KDw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNVQxMToxMTo1MVrOFd06bQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjgwNzU2Nw==", "bodyText": "As done in doSave method, consider calling showLoadingBox before the service call and hideLoadingBox in the callback.", "url": "https://github.com/kiegroup/appformer/pull/876#discussion_r366807567", "createdAt": "2020-01-15T10:43:51Z", "author": {"login": "caponetto"}, "path": "uberfire-extensions/uberfire-security/uberfire-security-management/uberfire-widgets-security-management/src/main/java/org/uberfire/ext/security/management/client/widgets/management/editor/group/workflow/GroupEditorWorkflow.java", "diffHunk": "@@ -163,14 +163,25 @@ public boolean isDirty() {\n     void delete() {\n         final String name = group.getName();\n         userSystemManager.groups((Void v) -> {\n-                                     deleteGroupEvent.fire(new DeleteGroupEvent(name));\n-                                     workbenchNotification.fire(new NotificationEvent(UsersManagementWidgetsConstants.INSTANCE.groupRemoved(name),\n-                                                                                      INFO));\n+                                     doDelete();\n                                      clear();\n                                  },\n                                  errorCallback).delete(name);\n     }\n \n+    protected void doDelete(){\n+        final String name = group.getName();\n+        AuthorizationPolicy authzPolicy = permissionManager.getAuthorizationPolicy();\n+\n+        authorizationService.call(r -> {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "51bc235752b26a2db428f1ab6b827ceca76b2720"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjgwOTQ1Mw==", "bodyText": "Consider creating at least one unit test for this public method.", "url": "https://github.com/kiegroup/appformer/pull/876#discussion_r366809453", "createdAt": "2020-01-15T10:47:40Z", "author": {"login": "caponetto"}, "path": "uberfire-backend/uberfire-backend-server/src/main/java/org/uberfire/backend/server/authz/AuthorizationServiceImpl.java", "diffHunk": "@@ -50,4 +51,12 @@ public void savePolicy(AuthorizationPolicy policy) {\n         permissionManager.setAuthorizationPolicy(policy);\n         savedEvent.fire(new AuthorizationPolicySavedEvent(policy));\n     }\n+\n+    @Override\n+    public void deletePolicyByGroup(Group group, AuthorizationPolicy policy) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "51bc235752b26a2db428f1ab6b827ceca76b2720"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjgxMjUzOQ==", "bodyText": "Consider creating at least one unit test for this public method.", "url": "https://github.com/kiegroup/appformer/pull/876#discussion_r366812539", "createdAt": "2020-01-15T10:53:53Z", "author": {"login": "caponetto"}, "path": "uberfire-backend/uberfire-backend-server/src/main/java/org/uberfire/backend/server/authz/AuthorizationPolicyVfsStorage.java", "diffHunk": "@@ -149,7 +150,34 @@ public FileVisitResult visitFile(final Path file,\n \n     public boolean isPolicyFile(Path p) {\n         String fileName = p.getName(p.getNameCount() - 1).toString();\n-        return fileName.equals(\"security-policy.properties\") || fileName.startsWith(\"security-module-\");\n+        return fileName.equals(POLICY_FILE) || fileName.startsWith(\"security-module-\");\n+    }\n+\n+    @Override\n+    public void deletePolicyByGroup(Group group, AuthorizationPolicy policy) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "51bc235752b26a2db428f1ab6b827ceca76b2720"}, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjgxNzQ4Mw==", "bodyText": "I see that lines 161 to 174 have almost the same code as the savePolicyIntoVfs method.\nConsider extracting duplicated code into generic methods.", "url": "https://github.com/kiegroup/appformer/pull/876#discussion_r366817483", "createdAt": "2020-01-15T11:05:46Z", "author": {"login": "caponetto"}, "path": "uberfire-backend/uberfire-backend-server/src/main/java/org/uberfire/backend/server/authz/AuthorizationPolicyVfsStorage.java", "diffHunk": "@@ -149,7 +150,34 @@ public FileVisitResult visitFile(final Path file,\n \n     public boolean isPolicyFile(Path p) {\n         String fileName = p.getName(p.getNameCount() - 1).toString();\n-        return fileName.equals(\"security-policy.properties\") || fileName.startsWith(\"security-module-\");\n+        return fileName.equals(POLICY_FILE) || fileName.startsWith(\"security-module-\");\n+    }\n+\n+    @Override\n+    public void deletePolicyByGroup(Group group, AuthorizationPolicy policy) {\n+        ioService.startBatch(fileSystem,\n+                             new CommentedOption(\"system\",\n+                                                 \"Delete Policy\"));\n+        try (StringWriter sw = new StringWriter()){", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "51bc235752b26a2db428f1ab6b827ceca76b2720"}, "originalPosition": 33}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjgxOTE0OA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                public void remove (Group group , AuthorizationPolicy policy,\n          \n          \n            \n                public void remove(Group group, AuthorizationPolicy policy,", "url": "https://github.com/kiegroup/appformer/pull/876#discussion_r366819148", "createdAt": "2020-01-15T11:09:53Z", "author": {"login": "caponetto"}, "path": "uberfire-backend/uberfire-backend-server/src/main/java/org/uberfire/backend/server/authz/AuthorizationPolicyMarshaller.java", "diffHunk": "@@ -323,6 +323,39 @@ public void write(Group group,\n         }\n     }\n \n+    public void remove (Group group , AuthorizationPolicy policy,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "51bc235752b26a2db428f1ab6b827ceca76b2720"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjgxOTI3Ng==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                                  Map out) {\n          \n          \n            \n                                   Map out) {", "url": "https://github.com/kiegroup/appformer/pull/876#discussion_r366819276", "createdAt": "2020-01-15T11:10:13Z", "author": {"login": "caponetto"}, "path": "uberfire-backend/uberfire-backend-server/src/main/java/org/uberfire/backend/server/authz/AuthorizationPolicyMarshaller.java", "diffHunk": "@@ -323,6 +323,39 @@ public void write(Group group,\n         }\n     }\n \n+    public void remove (Group group , AuthorizationPolicy policy,\n+                        Map out) {\n+\n+        write(policy,out);\n+\n+        for (Group subject : policy.getGroups()) {\n+            if (group.getName().equals(subject.getName())){\n+                remove(subject,\n+                       out);\n+                remove(subject,\n+                      policy.getPermissions(subject),\n+                      out);\n+            }\n+        }\n+    }\n+\n+    public void remove(Group group,\n+                      Map out) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "51bc235752b26a2db428f1ab6b827ceca76b2720"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjgxOTg4OQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                                  policy.getPermissions(subject),\n          \n          \n            \n                                   policy.getPermissions(subject),", "url": "https://github.com/kiegroup/appformer/pull/876#discussion_r366819889", "createdAt": "2020-01-15T11:11:41Z", "author": {"login": "caponetto"}, "path": "uberfire-backend/uberfire-backend-server/src/main/java/org/uberfire/backend/server/authz/AuthorizationPolicyMarshaller.java", "diffHunk": "@@ -323,6 +323,39 @@ public void write(Group group,\n         }\n     }\n \n+    public void remove (Group group , AuthorizationPolicy policy,\n+                        Map out) {\n+\n+        write(policy,out);\n+\n+        for (Group subject : policy.getGroups()) {\n+            if (group.getName().equals(subject.getName())){\n+                remove(subject,\n+                       out);\n+                remove(subject,\n+                      policy.getPermissions(subject),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "51bc235752b26a2db428f1ab6b827ceca76b2720"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjgxOTk0OQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                                  out);\n          \n          \n            \n                                   out);", "url": "https://github.com/kiegroup/appformer/pull/876#discussion_r366819949", "createdAt": "2020-01-15T11:11:51Z", "author": {"login": "caponetto"}, "path": "uberfire-backend/uberfire-backend-server/src/main/java/org/uberfire/backend/server/authz/AuthorizationPolicyMarshaller.java", "diffHunk": "@@ -323,6 +323,39 @@ public void write(Group group,\n         }\n     }\n \n+    public void remove (Group group , AuthorizationPolicy policy,\n+                        Map out) {\n+\n+        write(policy,out);\n+\n+        for (Group subject : policy.getGroups()) {\n+            if (group.getName().equals(subject.getName())){\n+                remove(subject,\n+                       out);\n+                remove(subject,\n+                      policy.getPermissions(subject),\n+                      out);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "51bc235752b26a2db428f1ab6b827ceca76b2720"}, "originalPosition": 15}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "51bc235752b26a2db428f1ab6b827ceca76b2720", "author": {"user": null}, "url": "https://github.com/kiegroup/appformer/commit/51bc235752b26a2db428f1ab6b827ceca76b2720", "committedDate": "2020-01-13T14:29:51Z", "message": "AF-2397 :Deletion of group from Business Central UI does not remove group from the security-policy.properties file\n-  Added feature to remove a specific group from security-policy.properties\n-  If the user adds a group with the same name as deleted group, default configurations will be applied to the newly added group."}, "afterCommit": {"oid": "24d100f08ad18692142d678469c00cd94ccc16d9", "author": {"user": null}, "url": "https://github.com/kiegroup/appformer/commit/24d100f08ad18692142d678469c00cd94ccc16d9", "committedDate": "2020-01-17T11:11:19Z", "message": "AF-2397 :Deletion of group from Business Central UI does not remove group from the security-policy.properties file\n-  Added feature to remove a specific group from security-policy.properties\n-  If the user adds a group with the same name as deleted group, default configurations will be applied to the newly added group."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "24d100f08ad18692142d678469c00cd94ccc16d9", "author": {"user": null}, "url": "https://github.com/kiegroup/appformer/commit/24d100f08ad18692142d678469c00cd94ccc16d9", "committedDate": "2020-01-17T11:11:19Z", "message": "AF-2397 :Deletion of group from Business Central UI does not remove group from the security-policy.properties file\n-  Added feature to remove a specific group from security-policy.properties\n-  If the user adds a group with the same name as deleted group, default configurations will be applied to the newly added group."}, "afterCommit": {"oid": "90ba99f8cd60834cc7df3ad086233100fb50bf8d", "author": {"user": null}, "url": "https://github.com/kiegroup/appformer/commit/90ba99f8cd60834cc7df3ad086233100fb50bf8d", "committedDate": "2020-01-17T11:15:11Z", "message": "AF-2397 :Deletion of group from Business Central UI does not remove group from the security-policy.properties file\n-  Added feature to remove a specific group from security-policy.properties\n-  If the user adds a group with the same name as deleted group, default configurations will be applied to the newly added group."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ0NTI3MDg5", "url": "https://github.com/kiegroup/appformer/pull/876#pullrequestreview-344527089", "createdAt": "2020-01-17T11:45:38Z", "commit": {"oid": "90ba99f8cd60834cc7df3ad086233100fb50bf8d"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "90ba99f8cd60834cc7df3ad086233100fb50bf8d", "author": {"user": null}, "url": "https://github.com/kiegroup/appformer/commit/90ba99f8cd60834cc7df3ad086233100fb50bf8d", "committedDate": "2020-01-17T11:15:11Z", "message": "AF-2397 :Deletion of group from Business Central UI does not remove group from the security-policy.properties file\n-  Added feature to remove a specific group from security-policy.properties\n-  If the user adds a group with the same name as deleted group, default configurations will be applied to the newly added group."}, "afterCommit": {"oid": "cb91eaa57e1a6c4979c20504088579bc2cb32c37", "author": {"user": null}, "url": "https://github.com/kiegroup/appformer/commit/cb91eaa57e1a6c4979c20504088579bc2cb32c37", "committedDate": "2020-01-18T06:14:25Z", "message": "AF-2397 :Deletion of group from Business Central UI does not remove group from the security-policy.properties file\n-  Added feature to remove a specific group from security-policy.properties"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ3MTU3MzI1", "url": "https://github.com/kiegroup/appformer/pull/876#pullrequestreview-347157325", "createdAt": "2020-01-23T09:29:56Z", "commit": {"oid": "cb91eaa57e1a6c4979c20504088579bc2cb32c37"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yM1QwOToyOTo1NlrOFg3nJw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yM1QxMDoyNzo0MFrOFg5Xmw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDAwOTg5NQ==", "bodyText": "This remove method as well as the following one can be private as they're only used in this class (if I looked correctly).", "url": "https://github.com/kiegroup/appformer/pull/876#discussion_r370009895", "createdAt": "2020-01-23T09:29:56Z", "author": {"login": "barboras7"}, "path": "uberfire-backend/uberfire-backend-server/src/main/java/org/uberfire/backend/server/authz/AuthorizationPolicyMarshaller.java", "diffHunk": "@@ -323,6 +323,39 @@ public void write(Group group,\n         }\n     }\n \n+    public void remove(Group group, AuthorizationPolicy policy,\n+                       Map out) {\n+\n+        write(policy, out);\n+\n+        for (Group subject : policy.getGroups()) {\n+            if (group.getName().equals(subject.getName())) {\n+                remove(subject,\n+                       out);\n+                remove(subject,\n+                       policy.getPermissions(subject),\n+                       out);\n+            }\n+        }\n+    }\n+\n+    public void remove(Group group,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cb91eaa57e1a6c4979c20504088579bc2cb32c37"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDAxMzQ4OQ==", "bodyText": "unnecessary empty line", "url": "https://github.com/kiegroup/appformer/pull/876#discussion_r370013489", "createdAt": "2020-01-23T09:37:13Z", "author": {"login": "barboras7"}, "path": "uberfire-backend/uberfire-backend-server/src/main/java/org/uberfire/backend/server/authz/AuthorizationPolicyVfsStorage.java", "diffHunk": "@@ -84,7 +85,14 @@ public synchronized AuthorizationPolicy loadPolicy() {\n \n     @Override\n     public synchronized void savePolicy(AuthorizationPolicy policy) {\n-        savePolicyIntoVfs(policy,\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cb91eaa57e1a6c4979c20504088579bc2cb32c37"}, "originalPosition": 45}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDAxMzc4MQ==", "bodyText": "empty line", "url": "https://github.com/kiegroup/appformer/pull/876#discussion_r370013781", "createdAt": "2020-01-23T09:37:47Z", "author": {"login": "barboras7"}, "path": "uberfire-backend/uberfire-backend-server/src/main/java/org/uberfire/backend/server/authz/AuthorizationPolicyVfsStorage.java", "diffHunk": "@@ -149,10 +157,22 @@ public FileVisitResult visitFile(final Path file,\n \n     public boolean isPolicyFile(Path p) {\n         String fileName = p.getName(p.getNameCount() - 1).toString();\n-        return fileName.equals(\"security-policy.properties\") || fileName.startsWith(\"security-module-\");\n+        return fileName.equals(POLICY_FILE) || fileName.startsWith(\"security-module-\");\n     }\n \n-    public void savePolicyIntoVfs(AuthorizationPolicy policy,\n+    @Override\n+    public void deletePolicyByGroup(Group group, AuthorizationPolicy policy) {\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cb91eaa57e1a6c4979c20504088579bc2cb32c37"}, "originalPosition": 67}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDAzMjc0MQ==", "bodyText": "unnecessary semicolon", "url": "https://github.com/kiegroup/appformer/pull/876#discussion_r370032741", "createdAt": "2020-01-23T10:15:13Z", "author": {"login": "barboras7"}, "path": "uberfire-backend/uberfire-backend-server/src/test/java/org/uberfire/backend/server/authz/AuthzPolicyDeployerTest.java", "diffHunk": "@@ -95,6 +105,42 @@ public void testPolicyLoad2() throws Exception {\n         testPolicyLoad(\"WEB-INF/classes/split/security-policy.properties\");\n     }\n \n+    @Test\n+    public void testPolicyDelete() throws Exception {\n+        testPolicyDelete(\"WEB-INF/classes/security-policy.properties\");\n+    }\n+\n+    public void testPolicyDelete(String path) throws Exception {\n+        URL fileURL = Thread.currentThread().getContextClassLoader().getResource(path);\n+        Path policyDir = Paths.get(fileURL.toURI()).getParent();\n+\n+        assertTrue(RoleRegistry.get().getRegisteredRoles().isEmpty());\n+\n+        deployer.deployPolicy(policyDir);\n+\n+        ArgumentCaptor<AuthorizationPolicy> policyCaptor = ArgumentCaptor.forClass(AuthorizationPolicy.class);\n+        ArgumentCaptor<Group> groupCaptor = ArgumentCaptor.forClass(Group.class);\n+\n+        verify(storage).loadPolicy();\n+        verify(storage).savePolicy(policyCaptor.capture());\n+        Group group = new GroupImpl(\"group1\");\n+        storage.deletePolicyByGroup(group, policyCaptor.getValue());\n+        verify(storage).deletePolicyByGroup(groupCaptor.capture(), policyCaptor.capture());\n+        verify(event).fire(any());\n+\n+        AuthorizationPolicy policy = policyCaptor.getValue();\n+        verify(permissionManager).setAuthorizationPolicy(policy);\n+\n+        Set<Group> roles = policyCaptor.getValue().getGroups();\n+        assertEquals(1, roles.size());\n+\n+        PermissionCollection permissions = policy.getPermissions(group);\n+        Permission permission = permissions.get(\"perspective.read\");\n+        assertNotNull(permission);\n+        assertEquals(AuthorizationResult.ACCESS_GRANTED, permission.getResult());\n+        ;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cb91eaa57e1a6c4979c20504088579bc2cb32c37"}, "originalPosition": 67}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDAzODY4Mw==", "bodyText": "empty line", "url": "https://github.com/kiegroup/appformer/pull/876#discussion_r370038683", "createdAt": "2020-01-23T10:27:40Z", "author": {"login": "barboras7"}, "path": "uberfire-extensions/uberfire-security/uberfire-security-management/uberfire-widgets-security-management/src/main/java/org/uberfire/ext/security/management/client/widgets/management/editor/group/workflow/GroupEditorWorkflow.java", "diffHunk": "@@ -163,14 +164,26 @@ public boolean isDirty() {\n     void delete() {\n         final String name = group.getName();\n         userSystemManager.groups((Void v) -> {\n-                                     deleteGroupEvent.fire(new DeleteGroupEvent(name));\n-                                     workbenchNotification.fire(new NotificationEvent(UsersManagementWidgetsConstants.INSTANCE.groupRemoved(name),\n-                                                                                      INFO));\n+                                     doDelete();\n                                      clear();\n                                  },\n                                  errorCallback).delete(name);\n     }\n \n+    protected void doDelete(){\n+        final String name = group.getName();\n+        AuthorizationPolicy authzPolicy = permissionManager.getAuthorizationPolicy();\n+        showLoadingBox();\n+        authorizationService.call(r -> {\n+                                      hideLoadingBox();\n+                                      deleteGroupEvent.fire(new DeleteGroupEvent(name));\n+                                      workbenchNotification.fire(new NotificationEvent(UsersManagementWidgetsConstants.INSTANCE.groupRemoved(name),\n+                                                                                       INFO));\n+                                  },\n+                                  errorCallback).deletePolicyByGroup(group, authzPolicy);\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cb91eaa57e1a6c4979c20504088579bc2cb32c37"}, "originalPosition": 32}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "cb91eaa57e1a6c4979c20504088579bc2cb32c37", "author": {"user": null}, "url": "https://github.com/kiegroup/appformer/commit/cb91eaa57e1a6c4979c20504088579bc2cb32c37", "committedDate": "2020-01-18T06:14:25Z", "message": "AF-2397 :Deletion of group from Business Central UI does not remove group from the security-policy.properties file\n-  Added feature to remove a specific group from security-policy.properties"}, "afterCommit": {"oid": "1e7d2aef74166356c2b77607515be59fe4930e57", "author": {"user": {"login": "RishiJboss", "name": null}}, "url": "https://github.com/kiegroup/appformer/commit/1e7d2aef74166356c2b77607515be59fe4930e57", "committedDate": "2020-01-27T06:51:07Z", "message": "AF-2397 :Deletion of group from Business Central UI does not remove group from the security-policy.properties file\n- Added feature to remove a specific group from security-policy.properties"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e4db632daf8374a3e8b5b107dd9ebbbb5a90bdb9", "author": {"user": {"login": "RishiJboss", "name": null}}, "url": "https://github.com/kiegroup/appformer/commit/e4db632daf8374a3e8b5b107dd9ebbbb5a90bdb9", "committedDate": "2020-01-29T14:06:49Z", "message": "AF-2397 :Deletion of group from Business Central UI does not remove group from the security-policy.properties file\n- Added feature to remove a specific group from security-policy.properties"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "1e7d2aef74166356c2b77607515be59fe4930e57", "author": {"user": {"login": "RishiJboss", "name": null}}, "url": "https://github.com/kiegroup/appformer/commit/1e7d2aef74166356c2b77607515be59fe4930e57", "committedDate": "2020-01-27T06:51:07Z", "message": "AF-2397 :Deletion of group from Business Central UI does not remove group from the security-policy.properties file\n- Added feature to remove a specific group from security-policy.properties"}, "afterCommit": {"oid": "e4db632daf8374a3e8b5b107dd9ebbbb5a90bdb9", "author": {"user": {"login": "RishiJboss", "name": null}}, "url": "https://github.com/kiegroup/appformer/commit/e4db632daf8374a3e8b5b107dd9ebbbb5a90bdb9", "committedDate": "2020-01-29T14:06:49Z", "message": "AF-2397 :Deletion of group from Business Central UI does not remove group from the security-policy.properties file\n- Added feature to remove a specific group from security-policy.properties"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUwMTUwMTA4", "url": "https://github.com/kiegroup/appformer/pull/876#pullrequestreview-350150108", "createdAt": "2020-01-29T14:33:13Z", "commit": {"oid": "e4db632daf8374a3e8b5b107dd9ebbbb5a90bdb9"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUwMjkwMTg4", "url": "https://github.com/kiegroup/appformer/pull/876#pullrequestreview-350290188", "createdAt": "2020-01-29T17:28:46Z", "commit": {"oid": "e4db632daf8374a3e8b5b107dd9ebbbb5a90bdb9"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUzMDQ1MzU0", "url": "https://github.com/kiegroup/appformer/pull/876#pullrequestreview-353045354", "createdAt": "2020-02-04T15:02:53Z", "commit": {"oid": "e4db632daf8374a3e8b5b107dd9ebbbb5a90bdb9"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2166, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}