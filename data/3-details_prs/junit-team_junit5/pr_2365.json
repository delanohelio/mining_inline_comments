{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDU4NTU3MjY1", "number": 2365, "title": "Use specific name prefix in preemptive timeout threads", "bodyText": "Overview\nHaving a specific name prefix is useful when debugging stack traces to\nquickly identify which threads are created by the junit framework and\nfrom where exactly.\n\nI hereby agree to the terms of the JUnit Contributor License Agreement.\n\nDefinition of Done\n\n There are no TODOs left in the code\n Method preconditions are checked and documented in the method's Javadoc\n Coding conventions (e.g. for logging) have been followed\n Change is covered by automated tests including corner cases, errors, and exception handling\n Public API has Javadoc and @API annotations\n Change is documented in the User Guide and Release Notes\n All continuous integration builds pass", "createdAt": "2020-07-29T16:45:49Z", "url": "https://github.com/junit-team/junit5/pull/2365", "merged": true, "mergeCommit": {"oid": "b6b1a5766c3e5b8f3594b1aec84676035fde5b14"}, "closed": true, "closedAt": "2020-08-04T08:25:29Z", "author": {"login": "zabetak"}, "timelineItems": {"totalCount": 14, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc5vEslAFqTQ1Nzc2NzA2OA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABc7iSfbgFqTQ2MDYwMDU5OQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU3NzY3MDY4", "url": "https://github.com/junit-team/junit5/pull/2365#pullrequestreview-457767068", "createdAt": "2020-07-29T18:07:56Z", "commit": {"oid": "12ddf80ed1c7ba6fd35c47c4f35548ddaa771a05"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOVQxODowNzo1NlrOG5EJVw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOVQxODowODoyMlrOG5EKFw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjQ4OTk0Mw==", "bodyText": "There's no need to do this, Thread already does this if no group is specified explicitly.", "url": "https://github.com/junit-team/junit5/pull/2365#discussion_r462489943", "createdAt": "2020-07-29T18:07:56Z", "author": {"login": "marcphilipp"}, "path": "junit-jupiter-api/src/main/java/org/junit/jupiter/api/AssertTimeout.java", "diffHunk": "@@ -180,4 +182,30 @@ static void assertTimeoutPreemptively(Duration timeout, Executable executable, S\n \t\t}\n \t}\n \n+\t/**\n+\t * The thread factory used for preemptive timeout.\n+\t *\n+\t * This factory is the same with {@link Executors#defaultThreadFactory()} but provides more meaningful thread names,\n+\t * helpful for debugging purposes.\n+\t *\n+\t */\n+\tprivate static class TimeoutThreadFactory implements ThreadFactory {\n+\t\tprivate static final AtomicInteger threadNumber = new AtomicInteger(1);\n+\t\tprivate final ThreadGroup group;\n+\n+\t\tTimeoutThreadFactory() {\n+\t\t\tSecurityManager s = System.getSecurityManager();\n+\t\t\tgroup = (s != null) ? s.getThreadGroup() : Thread.currentThread().getThreadGroup();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "12ddf80ed1c7ba6fd35c47c4f35548ddaa771a05"}, "originalPosition": 37}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjQ5MDEzNQ==", "bodyText": "I don't think we need these two ifs as we shut down the executor afterwards.", "url": "https://github.com/junit-team/junit5/pull/2365#discussion_r462490135", "createdAt": "2020-07-29T18:08:22Z", "author": {"login": "marcphilipp"}, "path": "junit-jupiter-api/src/main/java/org/junit/jupiter/api/AssertTimeout.java", "diffHunk": "@@ -180,4 +182,30 @@ static void assertTimeoutPreemptively(Duration timeout, Executable executable, S\n \t\t}\n \t}\n \n+\t/**\n+\t * The thread factory used for preemptive timeout.\n+\t *\n+\t * This factory is the same with {@link Executors#defaultThreadFactory()} but provides more meaningful thread names,\n+\t * helpful for debugging purposes.\n+\t *\n+\t */\n+\tprivate static class TimeoutThreadFactory implements ThreadFactory {\n+\t\tprivate static final AtomicInteger threadNumber = new AtomicInteger(1);\n+\t\tprivate final ThreadGroup group;\n+\n+\t\tTimeoutThreadFactory() {\n+\t\t\tSecurityManager s = System.getSecurityManager();\n+\t\t\tgroup = (s != null) ? s.getThreadGroup() : Thread.currentThread().getThreadGroup();\n+\t\t}\n+\n+\t\tpublic Thread newThread(Runnable r) {\n+\t\t\tThread t = new Thread(group, r, \"junit-timeout-thread-\" + threadNumber.getAndIncrement(), 0);\n+\t\t\tif (t.isDaemon())\n+\t\t\t\tt.setDaemon(false);\n+\t\t\tif (t.getPriority() != Thread.NORM_PRIORITY)\n+\t\t\t\tt.setPriority(Thread.NORM_PRIORITY);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "12ddf80ed1c7ba6fd35c47c4f35548ddaa771a05"}, "originalPosition": 45}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f594709facc0c031cdc8d11e31c7854e43af427f", "author": {"user": {"login": "zabetak", "name": "Stamatis Zampetakis"}}, "url": "https://github.com/junit-team/junit5/commit/f594709facc0c031cdc8d11e31c7854e43af427f", "committedDate": "2020-07-29T21:47:42Z", "message": "Increase timeout in test to avoid flakiness in slow machines"}, "afterCommit": {"oid": "4bc15ee47c7190e7efc76f168f1503a35f668002", "author": {"user": {"login": "zabetak", "name": "Stamatis Zampetakis"}}, "url": "https://github.com/junit-team/junit5/commit/4bc15ee47c7190e7efc76f168f1503a35f668002", "committedDate": "2020-07-29T21:55:24Z", "message": "Increase timeout in test to avoid flakiness in slow machines"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4bc15ee47c7190e7efc76f168f1503a35f668002", "author": {"user": {"login": "zabetak", "name": "Stamatis Zampetakis"}}, "url": "https://github.com/junit-team/junit5/commit/4bc15ee47c7190e7efc76f168f1503a35f668002", "committedDate": "2020-07-29T21:55:24Z", "message": "Increase timeout in test to avoid flakiness in slow machines"}, "afterCommit": {"oid": "87920a39547d9a662d6e941883f139c46206f8ec", "author": {"user": {"login": "zabetak", "name": "Stamatis Zampetakis"}}, "url": "https://github.com/junit-team/junit5/commit/87920a39547d9a662d6e941883f139c46206f8ec", "committedDate": "2020-07-29T22:00:55Z", "message": "Increase timeout in test to avoid flakiness in slow machines"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU4MTM5ODA0", "url": "https://github.com/junit-team/junit5/pull/2365#pullrequestreview-458139804", "createdAt": "2020-07-30T07:13:35Z", "commit": {"oid": "87920a39547d9a662d6e941883f139c46206f8ec"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQwNzoxMzozNVrOG5Wv1A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQwNzoxMzozNVrOG5Wv1A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mjc5NDcwOA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \t\t\treturn new Thread(null, r, \"junit-timeout-thread-\" + threadNumber.getAndIncrement(), 0);\n          \n          \n            \n            \t\t\treturn new Thread(r, \"junit-timeout-thread-\" + threadNumber.getAndIncrement());", "url": "https://github.com/junit-team/junit5/pull/2365#discussion_r462794708", "createdAt": "2020-07-30T07:13:35Z", "author": {"login": "marcphilipp"}, "path": "junit-jupiter-api/src/main/java/org/junit/jupiter/api/AssertTimeout.java", "diffHunk": "@@ -180,4 +182,17 @@ static void assertTimeoutPreemptively(Duration timeout, Executable executable, S\n \t\t}\n \t}\n \n+\t/**\n+\t * The thread factory used for preemptive timeout.\n+\t *\n+\t * The factory creates threads with meaningful names, helpful for debugging purposes.\n+\t */\n+\tprivate static class TimeoutThreadFactory implements ThreadFactory {\n+\t\tprivate static final AtomicInteger threadNumber = new AtomicInteger(1);\n+\n+\t\tpublic Thread newThread(Runnable r) {\n+\t\t\treturn new Thread(null, r, \"junit-timeout-thread-\" + threadNumber.getAndIncrement(), 0);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "87920a39547d9a662d6e941883f139c46206f8ec"}, "originalPosition": 33}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7e877d64b34b848ea7a4efe41079fd092c93e779", "author": {"user": {"login": "zabetak", "name": "Stamatis Zampetakis"}}, "url": "https://github.com/junit-team/junit5/commit/7e877d64b34b848ea7a4efe41079fd092c93e779", "committedDate": "2020-08-03T21:36:51Z", "message": "Use specific name prefix in preemptive timeout threads\n\nHaving a specific name prefix is useful when debugging stack traces to\nquickly identify which threads are created by the junit framework and\nfrom where exactly."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9e547690c655fb7588c05226e037e8ba915f5b2e", "author": {"user": {"login": "zabetak", "name": "Stamatis Zampetakis"}}, "url": "https://github.com/junit-team/junit5/commit/9e547690c655fb7588c05226e037e8ba915f5b2e", "committedDate": "2020-08-03T21:36:51Z", "message": "Remove ThreadGroup resolution from the constructor of the thread factory\n\nThe same resolution takes place inside the constructor of Thread class\nif group is null."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d271cb30dcc09327bf35555bd9f7cd468dbf9636", "author": {"user": {"login": "zabetak", "name": "Stamatis Zampetakis"}}, "url": "https://github.com/junit-team/junit5/commit/d271cb30dcc09327bf35555bd9f7cd468dbf9636", "committedDate": "2020-08-03T21:36:51Z", "message": "Let timeout thread inherit daemon status and priority from parent"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1e72c284d4be3e6d4a56ee5835ee9c0588313785", "author": {"user": {"login": "zabetak", "name": "Stamatis Zampetakis"}}, "url": "https://github.com/junit-team/junit5/commit/1e72c284d4be3e6d4a56ee5835ee9c0588313785", "committedDate": "2020-08-03T21:36:51Z", "message": "Update TimeoutThreadFactory javadoc"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f8d44a585ee9b82d1f4d208755d941385862656a", "author": {"user": {"login": "zabetak", "name": "Stamatis Zampetakis"}}, "url": "https://github.com/junit-team/junit5/commit/f8d44a585ee9b82d1f4d208755d941385862656a", "committedDate": "2020-08-03T21:36:51Z", "message": "Increase timeout in test to avoid flakiness in slow machines"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e4b01d959f705f711b27f3a6954078b37775cd0a", "author": {"user": {"login": "zabetak", "name": "Stamatis Zampetakis"}}, "url": "https://github.com/junit-team/junit5/commit/e4b01d959f705f711b27f3a6954078b37775cd0a", "committedDate": "2020-08-03T21:36:51Z", "message": "Remove explicit group and stacksize from the Thread constructor"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3a3f116bc160a0cc09da8fbb86c88bf1c0e85df9", "author": {"user": {"login": "zabetak", "name": "Stamatis Zampetakis"}}, "url": "https://github.com/junit-team/junit5/commit/3a3f116bc160a0cc09da8fbb86c88bf1c0e85df9", "committedDate": "2020-08-03T21:36:51Z", "message": "Fix checkstyle violations"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "37b6a25c23c7098fd7a46aabd6dfe3bd11d4e752", "author": {"user": {"login": "zabetak", "name": "Stamatis Zampetakis"}}, "url": "https://github.com/junit-team/junit5/commit/37b6a25c23c7098fd7a46aabd6dfe3bd11d4e752", "committedDate": "2020-08-03T21:37:32Z", "message": "Update release-notes-5.7.0-M2.adoc"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "939bb1ae590bcc9a13ddec6d2c706e99ad4898ac", "author": {"user": {"login": "zabetak", "name": "Stamatis Zampetakis"}}, "url": "https://github.com/junit-team/junit5/commit/939bb1ae590bcc9a13ddec6d2c706e99ad4898ac", "committedDate": "2020-08-03T21:26:22Z", "message": "Update release-notes-5.7.0-M2.adoc"}, "afterCommit": {"oid": "37b6a25c23c7098fd7a46aabd6dfe3bd11d4e752", "author": {"user": {"login": "zabetak", "name": "Stamatis Zampetakis"}}, "url": "https://github.com/junit-team/junit5/commit/37b6a25c23c7098fd7a46aabd6dfe3bd11d4e752", "committedDate": "2020-08-03T21:37:32Z", "message": "Update release-notes-5.7.0-M2.adoc"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYwNjAwNTk5", "url": "https://github.com/junit-team/junit5/pull/2365#pullrequestreview-460600599", "createdAt": "2020-08-04T08:24:35Z", "commit": {"oid": "37b6a25c23c7098fd7a46aabd6dfe3bd11d4e752"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3587, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}