{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTI4OTYzNTkz", "number": 2484, "title": "Introduce utility method for processing all destroyed test instances", "bodyText": "The new utility method helps to ensure all test instances are processed\nby a TestInstancePreDestroyCallback when used in conjunction with\n@Nested tests.\nResolves #2430.\n\nDefinition of Done\n\n There are no TODOs left in the code\n Method preconditions are checked and documented in the method's Javadoc\n Coding conventions (e.g. for logging) have been followed\n Change is covered by automated tests including corner cases, errors, and exception handling\n Public API has Javadoc and @API annotations\n Change is documented in the User Guide and Release Notes\n All continuous integration builds pass", "createdAt": "2020-11-28T15:38:52Z", "url": "https://github.com/junit-team/junit5/pull/2484", "merged": true, "mergeCommit": {"oid": "05e9fb569202b00972b07029778a2e8fbe390bdd"}, "closed": true, "closedAt": "2020-12-13T13:30:02Z", "author": {"login": "marcphilipp"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdg-NW7gBqjQwNDgxODI2Mjg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdlf08RgBqjQxMDQ1MzM5OTk=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6e55e2f63eacd5d7347baf222baddd96fdf93509", "author": {"user": {"login": "marcphilipp", "name": "Marc Philipp"}}, "url": "https://github.com/junit-team/junit5/commit/6e55e2f63eacd5d7347baf222baddd96fdf93509", "committedDate": "2020-11-28T15:37:57Z", "message": "Introduce utility method for processing all destroyed test instances\n\nThe new utility method helps to ensure all test instances are processed\nby a `TestInstancePreDestroyCallback` when used in conjunction with\n`@Nested` tests.\n\nResolves #2430."}, "afterCommit": {"oid": "235946a07dc376095d21121f5a2e01f92c4796a1", "author": {"user": {"login": "marcphilipp", "name": "Marc Philipp"}}, "url": "https://github.com/junit-team/junit5/commit/235946a07dc376095d21121f5a2e01f92c4796a1", "committedDate": "2020-11-28T15:51:19Z", "message": "Introduce utility method for processing all destroyed test instances\n\nThe new utility method helps to ensure all test instances are processed\nby a `TestInstancePreDestroyCallback` when used in conjunction with\n`@Nested` tests.\n\nResolves #2430."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "235946a07dc376095d21121f5a2e01f92c4796a1", "author": {"user": {"login": "marcphilipp", "name": "Marc Philipp"}}, "url": "https://github.com/junit-team/junit5/commit/235946a07dc376095d21121f5a2e01f92c4796a1", "committedDate": "2020-11-28T15:51:19Z", "message": "Introduce utility method for processing all destroyed test instances\n\nThe new utility method helps to ensure all test instances are processed\nby a `TestInstancePreDestroyCallback` when used in conjunction with\n`@Nested` tests.\n\nResolves #2430."}, "afterCommit": {"oid": "a39c5212b8bd59a2909a8aa5f56e997b355ad0e1", "author": {"user": {"login": "marcphilipp", "name": "Marc Philipp"}}, "url": "https://github.com/junit-team/junit5/commit/a39c5212b8bd59a2909a8aa5f56e997b355ad0e1", "committedDate": "2020-11-28T16:01:28Z", "message": "Introduce utility method for processing all destroyed test instances\n\nThe new utility method helps to ensure all test instances are processed\nby a `TestInstancePreDestroyCallback` when used in conjunction with\n`@Nested` tests.\n\nResolves #2430."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ0ODcxOTU1", "url": "https://github.com/junit-team/junit5/pull/2484#pullrequestreview-544871955", "createdAt": "2020-12-04T11:19:54Z", "commit": {"oid": "a39c5212b8bd59a2909a8aa5f56e997b355ad0e1"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wNFQxMToxOTo1NFrOH_Mgww==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wNFQxMToxOTo1NFrOH_Mgww==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjAyNzMzMQ==", "bodyText": "Note to self: document in Javadoc", "url": "https://github.com/junit-team/junit5/pull/2484#discussion_r536027331", "createdAt": "2020-12-04T11:19:54Z", "author": {"login": "marcphilipp"}, "path": "junit-jupiter-api/src/main/java/org/junit/jupiter/api/extension/TestInstancePreDestroyCallback.java", "diffHunk": "@@ -48,12 +57,59 @@\n public interface TestInstancePreDestroyCallback extends Extension {\n \n \t/**\n-\t * Callback for processing a test instance before it is destroyed.\n+\t * Callback for processing test instances before they are destroyed.\n+\t *\n+\t * <p>Contrary to {@link TestInstancePostProcessor#postProcessTestInstance}\n+\t * this method is only called once for each {@link ExtensionContext} even if\n+\t * there are multiple test instances about to be destroyed in case of\n+\t * {@link Nested @Nested} tests. Please use the provided\n+\t * {@link #preDestroyTestInstances(ExtensionContext, Consumer)} utility\n+\t * method to ensure that all test instances are handled.\n \t *\n \t * @param context the current extension context; never {@code null}\n \t * @see ExtensionContext#getTestInstance()\n \t * @see ExtensionContext#getRequiredTestInstance()\n+\t * @see ExtensionContext#getTestInstances()\n+\t * @see ExtensionContext#getRequiredTestInstances()\n+\t * @see #preDestroyTestInstances(ExtensionContext, Consumer)\n \t */\n \tvoid preDestroyTestInstance(ExtensionContext context) throws Exception;\n \n+\t/**\n+\t * Utility method for processing <em>all</em> test instances of an\n+\t * {@link ExtensionContext} that are not present in any of its parent\n+\t * contexts (which would happen in case {@link Lifecycle#PER_CLASS} was\n+\t * used).\n+\t *\n+\t * <p>This method is intended to be called from an implementation of\n+\t * {@link #preDestroyTestInstance(ExtensionContext)} like this:\n+\t *\n+\t * <pre>{@code\n+\t * class MyExtension implements TestInstancePreDestroyCallback {\n+\t *     @Override\n+\t *     public void preDestroyTestInstance(ExtensionContext context) {\n+\t *         TestInstancePreDestroyCallback.preDestroyTestInstances(context, testInstance -> {\n+\t *             // custom logic\n+\t *         });\n+\t *     }\n+\t * }\n+\t * }</pre>\n+\t *\n+\t * @param context the current extension context; never {@code null}\n+\t * @param callback the callback to be invoked for every test instance of the\n+\t * current extension context that is about to be destroyed; never\n+\t * {@code null}\n+\t * @since 5.7.1\n+\t */\n+\t@API(status = EXPERIMENTAL, since = \"5.7.1\")\n+\tstatic void preDestroyTestInstances(ExtensionContext context, Consumer<Object> callback) {\n+\t\tList<Object> destroyedInstances = new ArrayList<>(context.getRequiredTestInstances().getAllInstances());\n+\t\tfor (Optional<ExtensionContext> current = context.getParent(); current.isPresent(); current = current.get().getParent()) {\n+\t\t\tcurrent.get().getTestInstances().map(TestInstances::getAllInstances).ifPresent(\n+\t\t\t\tdestroyedInstances::removeAll);\n+\t\t}\n+\t\tCollections.reverse(destroyedInstances);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a39c5212b8bd59a2909a8aa5f56e997b355ad0e1"}, "originalPosition": 87}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "281c0ddb862a05428513e7f2fbfd46bebe5073c5", "author": {"user": {"login": "marcphilipp", "name": "Marc Philipp"}}, "url": "https://github.com/junit-team/junit5/commit/281c0ddb862a05428513e7f2fbfd46bebe5073c5", "committedDate": "2020-12-12T17:17:02Z", "message": "Introduce utility method for processing all destroyed test instances\n\nThe new utility method helps to ensure all test instances are processed\nby a `TestInstancePreDestroyCallback` when used in conjunction with\n`@Nested` tests.\n\nResolves #2430."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a39c5212b8bd59a2909a8aa5f56e997b355ad0e1", "author": {"user": {"login": "marcphilipp", "name": "Marc Philipp"}}, "url": "https://github.com/junit-team/junit5/commit/a39c5212b8bd59a2909a8aa5f56e997b355ad0e1", "committedDate": "2020-11-28T16:01:28Z", "message": "Introduce utility method for processing all destroyed test instances\n\nThe new utility method helps to ensure all test instances are processed\nby a `TestInstancePreDestroyCallback` when used in conjunction with\n`@Nested` tests.\n\nResolves #2430."}, "afterCommit": {"oid": "281c0ddb862a05428513e7f2fbfd46bebe5073c5", "author": {"user": {"login": "marcphilipp", "name": "Marc Philipp"}}, "url": "https://github.com/junit-team/junit5/commit/281c0ddb862a05428513e7f2fbfd46bebe5073c5", "committedDate": "2020-12-12T17:17:02Z", "message": "Introduce utility method for processing all destroyed test instances\n\nThe new utility method helps to ensure all test instances are processed\nby a `TestInstancePreDestroyCallback` when used in conjunction with\n`@Nested` tests.\n\nResolves #2430."}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3478, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}