{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM0MDI3MzIy", "number": 966, "title": "Resolves #958: VersionstampSaveBehavior could have option to match version argument precisely", "bodyText": "This adds a new VersionstampSaveBehavior setting, IF_PRESENT, which only saves a version with a record if the provided version is not null. This is useful for times when you want to, say, copy the data from one store to another precisely, so the default behavior, where creating a\na version if not set explicitly, isn't desired.\nIn doing this, I also filed #964 because the test I wrote seemed to expose this. It's possible this behavior is correct \"enough\", but I'm not super happy with #964 as it is right now.\nThis resolves #958.", "createdAt": "2020-06-13T16:32:31Z", "url": "https://github.com/FoundationDB/fdb-record-layer/pull/966", "merged": true, "mergeCommit": {"oid": "1fa6beda5a95a9c7e045f50a81f6b54d22d190be"}, "closed": true, "closedAt": "2021-03-16T19:08:37Z", "author": {"login": "alecgrieser"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcsie8JgBqjM0NTk0NzM0NDg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABeDxwcCgFqTYxMzYyOTE3MA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "56b78ee94ca66cb766c98cedc01365c136b82421", "author": {"user": {"login": "alecgrieser", "name": "Alec Grieser"}}, "url": "https://github.com/FoundationDB/fdb-record-layer/commit/56b78ee94ca66cb766c98cedc01365c136b82421", "committedDate": "2020-06-13T16:29:00Z", "message": "Resolves #958: VersionstampSaveBehavior could have option to match version argument precisely\n\nThis adds a new `VersionstampSaveBehavior` setting, `IF_PRESENT`, which only saves a version with a record if the provided version is not `null`.\nThis is useful for times when you want to, say, copy the data from one store to another precisely, so the default behavior, where creating a\na version if not set explicitly, isn't desired.\n\nIn doing this, I also filed #964 because the test I wrote seemed to expose this. It's possible this behavior is correct \"enough\", but I'm\nnot super happy with #964 as it is right now.\n\nThis resolves #958."}, "afterCommit": {"oid": "009c34c0acc57d27ea9f0d7718169d66ceaa9d44", "author": {"user": {"login": "alecgrieser", "name": "Alec Grieser"}}, "url": "https://github.com/FoundationDB/fdb-record-layer/commit/009c34c0acc57d27ea9f0d7718169d66ceaa9d44", "committedDate": "2020-06-18T18:08:38Z", "message": "Resolves #958: VersionstampSaveBehavior could have option to match version argument precisely\n\nThis adds a new `VersionstampSaveBehavior` setting, `IF_PRESENT`, which only saves a version with a record if the provided version is not `null`.\nThis is useful for times when you want to, say, copy the data from one store to another precisely, so the default behavior, where creating a\na version if not set explicitly, isn't desired.\n\nIn doing this, I also filed #964 because the test I wrote seemed to expose this. It's possible this behavior is correct \"enough\", but I'm\nnot super happy with #964 as it is right now.\n\nThis resolves #958."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "009c34c0acc57d27ea9f0d7718169d66ceaa9d44", "author": {"user": {"login": "alecgrieser", "name": "Alec Grieser"}}, "url": "https://github.com/FoundationDB/fdb-record-layer/commit/009c34c0acc57d27ea9f0d7718169d66ceaa9d44", "committedDate": "2020-06-18T18:08:38Z", "message": "Resolves #958: VersionstampSaveBehavior could have option to match version argument precisely\n\nThis adds a new `VersionstampSaveBehavior` setting, `IF_PRESENT`, which only saves a version with a record if the provided version is not `null`.\nThis is useful for times when you want to, say, copy the data from one store to another precisely, so the default behavior, where creating a\na version if not set explicitly, isn't desired.\n\nIn doing this, I also filed #964 because the test I wrote seemed to expose this. It's possible this behavior is correct \"enough\", but I'm\nnot super happy with #964 as it is right now.\n\nThis resolves #958."}, "afterCommit": {"oid": "8b90ebed8c84a86d80e6389bec12efe07e48c9d9", "author": {"user": {"login": "alecgrieser", "name": "Alec Grieser"}}, "url": "https://github.com/FoundationDB/fdb-record-layer/commit/8b90ebed8c84a86d80e6389bec12efe07e48c9d9", "committedDate": "2020-10-15T20:49:07Z", "message": "Resolves #958: VersionstampSaveBehavior could have option to match version argument precisely\n\nThis adds a new `VersionstampSaveBehavior` setting, `IF_PRESENT`, which only saves a version with a record if the provided version is not `null`.\nThis is useful for times when you want to, say, copy the data from one store to another precisely, so the default behavior, where creating a\na version if not set explicitly, isn't desired.\n\nIn doing this, I also filed #964 because the test I wrote seemed to expose this. It's possible this behavior is correct \"enough\", but I'm\nnot super happy with #964 as it is right now.\n\nThis resolves #958."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NjA5OTU2MDMy", "url": "https://github.com/FoundationDB/fdb-record-layer/pull/966#pullrequestreview-609956032", "createdAt": "2021-03-11T16:25:06Z", "commit": {"oid": "8b90ebed8c84a86d80e6389bec12efe07e48c9d9"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMy0xMVQxNjoyNTowNlrOI1Dwow==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMy0xMVQxNjoyNTowNlrOI1Dwow==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5MjUwNzA0Mw==", "bodyText": "Should this reference issue  #964", "url": "https://github.com/FoundationDB/fdb-record-layer/pull/966#discussion_r592507043", "createdAt": "2021-03-11T16:25:06Z", "author": {"login": "ScottDugas"}, "path": "fdb-record-layer-core/src/main/java/com/apple/foundationdb/record/provider/foundationdb/FDBRecordStoreBase.java", "diffHunk": "@@ -299,13 +299,34 @@ public boolean errorIfTypeChanged() {\n     /**\n      * Provided during record save (via {@link #saveRecord(Message, FDBRecordVersion, VersionstampSaveBehavior)}),\n      * directs the behavior of the save w.r.t. the record's version.\n-     * In the presence of a version, either <code>DEFAULT</code> or <code>WITH_VERSION</code> can be used.\n+     * In the presence of a version, either {@code DEFAULT} or {@code WITH_VERSION} can be used.\n      * For safety, <code>NO_VERSION</code> should only be used with a null version.\n      */\n     enum VersionstampSaveBehavior {\n-        DEFAULT,        // Follow rules dictated by the metadata\n-        NO_VERSION,     // Explicitly do NOT save a version\n-        WITH_VERSION,   // Explicitly save a version even if meta-data says not to\n+        /**\n+         * Match the behavior dictated by the meta-data. If {@link com.apple.foundationdb.record.RecordMetaData#isStoreRecordVersions()}\n+         * returns {@code true}, this will always store the record with a version (like {@link #WITH_VERSION}). Otherwise,\n+         * it will store the record with the provided version if given or with no version if not.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8b90ebed8c84a86d80e6389bec12efe07e48c9d9"}, "originalPosition": 15}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "52f234d3a2f80164d1584ad78e2cb2c101e096e6", "author": {"user": {"login": "alecgrieser", "name": "Alec Grieser"}}, "url": "https://github.com/FoundationDB/fdb-record-layer/commit/52f234d3a2f80164d1584ad78e2cb2c101e096e6", "committedDate": "2021-03-11T22:22:40Z", "message": "Resolves #958: VersionstampSaveBehavior could have option to match version argument precisely\n\nThis adds a new `VersionstampSaveBehavior` setting, `IF_PRESENT`, which only saves a version with a record if the provided version is not `null`.\nThis is useful for times when you want to, say, copy the data from one store to another precisely, so the default behavior, where creating a\na version if not set explicitly, isn't desired.\n\nIn doing this, I also filed #964 because the test I wrote seemed to expose this. It's possible this behavior is correct \"enough\", but I'm\nnot super happy with #964 as it is right now.\n\nThis resolves #958."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "11ba06b09e1f9c2cc56a29749461bb1df1b80746", "author": {"user": {"login": "alecgrieser", "name": "Alec Grieser"}}, "url": "https://github.com/FoundationDB/fdb-record-layer/commit/11ba06b09e1f9c2cc56a29749461bb1df1b80746", "committedDate": "2021-03-11T22:34:03Z", "message": "add a clarifying comment referencing #964"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "8b90ebed8c84a86d80e6389bec12efe07e48c9d9", "author": {"user": {"login": "alecgrieser", "name": "Alec Grieser"}}, "url": "https://github.com/FoundationDB/fdb-record-layer/commit/8b90ebed8c84a86d80e6389bec12efe07e48c9d9", "committedDate": "2020-10-15T20:49:07Z", "message": "Resolves #958: VersionstampSaveBehavior could have option to match version argument precisely\n\nThis adds a new `VersionstampSaveBehavior` setting, `IF_PRESENT`, which only saves a version with a record if the provided version is not `null`.\nThis is useful for times when you want to, say, copy the data from one store to another precisely, so the default behavior, where creating a\na version if not set explicitly, isn't desired.\n\nIn doing this, I also filed #964 because the test I wrote seemed to expose this. It's possible this behavior is correct \"enough\", but I'm\nnot super happy with #964 as it is right now.\n\nThis resolves #958."}, "afterCommit": {"oid": "11ba06b09e1f9c2cc56a29749461bb1df1b80746", "author": {"user": {"login": "alecgrieser", "name": "Alec Grieser"}}, "url": "https://github.com/FoundationDB/fdb-record-layer/commit/11ba06b09e1f9c2cc56a29749461bb1df1b80746", "committedDate": "2021-03-11T22:34:03Z", "message": "add a clarifying comment referencing #964"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NjEzNjI5MTcw", "url": "https://github.com/FoundationDB/fdb-record-layer/pull/966#pullrequestreview-613629170", "createdAt": "2021-03-16T19:08:25Z", "commit": {"oid": "11ba06b09e1f9c2cc56a29749461bb1df1b80746"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2627, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}