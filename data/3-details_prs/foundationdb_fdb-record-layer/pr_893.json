{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk5ODQxOTI0", "number": 893, "title": "Merge 2.8.104.28 to master", "bodyText": "This merges the changes on the 2.8.102.26 and 2.8.104.28 patch releases into master.", "createdAt": "2020-04-06T18:58:14Z", "url": "https://github.com/FoundationDB/fdb-record-layer/pull/893", "merged": true, "mergeCommit": {"oid": "e3a2aa098e182da2c38486aada377373cce8b5a6"}, "closed": true, "closedAt": "2020-04-06T20:04:42Z", "author": {"login": "nschiefer"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcUFfm4gH2gAyMzk5ODQxOTI0OmQwMTEwYjJkM2ZiYTJjOGYyZmY3MDBjZDIwZmM3NWU3MjI3MWZhNzg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcVEYFSgFqTM4ODU3NjA3Mg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "d0110b2d3fba2c8f2ff700cd20fc75e72271fa78", "author": {"user": {"login": "nschiefer", "name": "Nicholas Schiefer"}}, "url": "https://github.com/FoundationDB/fdb-record-layer/commit/d0110b2d3fba2c8f2ff700cd20fc75e72271fa78", "committedDate": "2020-04-03T18:48:37Z", "message": "Fixes #888: IN to OR transformation does not plan with other predicates.\n\nPR #861 added a new transformation to the RecordQueryPlanner that\nattempts to transform an IN predicate into an equivalent OR of equality\npredicates when the planner determines that it cannot implement the IN\npredicate as an IN-join because of an incompatible sort order.\n\nHowever, the equivalent OR predicate is too complex for the simple\nnormalizer normalizeAndOr() if there are other predicates on the\noriginal filter. In this case, the predicates are not normalized and so\nthe union planner is unable to produce the desired union plan.\n\nThis change adds a more sophisticated normalizer to handle this case."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "deba84fce9037bd15e45507ffd5ae7380e2ebcdd", "author": {"user": {"login": "MMcM", "name": "Mike McMahon"}}, "url": "https://github.com/FoundationDB/fdb-record-layer/commit/deba84fce9037bd15e45507ffd5ae7380e2ebcdd", "committedDate": "2020-04-03T21:25:11Z", "message": "Merge pull request #889 from FoundationDB/plan-in-as-or-complex\n\nFixes #888: IN to OR transformation does not plan with other predicates."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a2e2706f7507644c5b10a4423a9aaef3cdd5a878", "author": {"user": null}, "url": "https://github.com/FoundationDB/fdb-record-layer/commit/a2e2706f7507644c5b10a4423a9aaef3cdd5a878", "committedDate": "2020-04-03T21:27:19Z", "message": "Release notes updated for version 2.8.102.27"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a1ec2a88d72b8fb458b43e473217de5ed83b1ddb", "author": {"user": {"login": "nschiefer", "name": "Nicholas Schiefer"}}, "url": "https://github.com/FoundationDB/fdb-record-layer/commit/a1ec2a88d72b8fb458b43e473217de5ed83b1ddb", "committedDate": "2020-04-03T21:58:01Z", "message": "Merge branch 'fdb-record-layer-2.8.102' into merge-2.8.102.27-to-2.8.104"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4dbb9ceeeb0a099e4da8ac80ae1da5ed0fda8026", "author": {"user": {"login": "nschiefer", "name": "Nicholas Schiefer"}}, "url": "https://github.com/FoundationDB/fdb-record-layer/commit/4dbb9ceeeb0a099e4da8ac80ae1da5ed0fda8026", "committedDate": "2020-04-03T22:13:52Z", "message": "Merge pull request #890 from nschiefer/merge-2.8.102.27-to-2.8.104\n\nMerge 2.8.102.27 to 2.8.104"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "04dea3fb9dc1b71fecbef74f307e52eba9a56b38", "author": {"user": null}, "url": "https://github.com/FoundationDB/fdb-record-layer/commit/04dea3fb9dc1b71fecbef74f307e52eba9a56b38", "committedDate": "2020-04-03T22:14:17Z", "message": "Release notes updated for version 2.8.104.28"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "babfb8e5915230e10c446cd25cb2850bc2f67a6e", "author": {"user": {"login": "nschiefer", "name": "Nicholas Schiefer"}}, "url": "https://github.com/FoundationDB/fdb-record-layer/commit/babfb8e5915230e10c446cd25cb2850bc2f67a6e", "committedDate": "2020-04-06T18:56:58Z", "message": "Merge branch 'fdb-record-layer-2.8.104' into merge-2.8.104.28-to-master"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg4NTcxNTQ3", "url": "https://github.com/FoundationDB/fdb-record-layer/pull/893#pullrequestreview-388571547", "createdAt": "2020-04-06T19:57:42Z", "commit": {"oid": "babfb8e5915230e10c446cd25cb2850bc2f67a6e"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wNlQxOTo1Nzo0MlrOGBnoEA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wNlQxOTo1Nzo0MlrOGBnoEA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDM1MDk5Mg==", "bodyText": "For master (versus patch release), do we want this to be the only definition of normalizeAndOr? Or just live with this until a more major overhaul?\nWe could also take this as a clean merge from the release branch and do that separately.", "url": "https://github.com/FoundationDB/fdb-record-layer/pull/893#discussion_r404350992", "createdAt": "2020-04-06T19:57:42Z", "author": {"login": "MMcM"}, "path": "fdb-record-layer-core/src/main/java/com/apple/foundationdb/record/query/plan/RecordQueryPlanner.java", "diffHunk": "@@ -1284,20 +1284,49 @@ private QueryComponent normalizeAndOr(AndComponent and) {\n             QueryComponent child1 = and.getChildren().get(0);\n             QueryComponent child2 = and.getChildren().get(1);\n             if (child1 instanceof OrComponent && Query.isSingleFieldComparison(child2)) {\n-                return OrComponent.from(distributeAnd(child2, ((OrComponent)child1).getChildren()));\n+                return OrComponent.from(distributeAnd(Collections.singletonList(child2), ((OrComponent)child1).getChildren()));\n             }\n             if (child2 instanceof OrComponent && Query.isSingleFieldComparison(child1)) {\n-                return OrComponent.from(distributeAnd(child1, ((OrComponent)child2).getChildren()));\n+                return OrComponent.from(distributeAnd(Collections.singletonList(child1), ((OrComponent)child2).getChildren()));\n             }\n         }\n         return and;\n     }\n \n-    private List<QueryComponent> distributeAnd(QueryComponent component, List<QueryComponent> children) {\n+    private QueryComponent normalizeAndOrForInAsOr(@Nonnull QueryComponent component) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "babfb8e5915230e10c446cd25cb2850bc2f67a6e"}, "originalPosition": 25}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg4NTc2MDcy", "url": "https://github.com/FoundationDB/fdb-record-layer/pull/893#pullrequestreview-388576072", "createdAt": "2020-04-06T20:04:25Z", "commit": {"oid": "babfb8e5915230e10c446cd25cb2850bc2f67a6e"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2562, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}