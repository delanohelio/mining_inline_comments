{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTA3NTE3NDAw", "number": 1049, "title": "Resolves #1048: preloadRecordAsync should cache negative results", "bodyText": "", "createdAt": "2020-10-21T12:59:15Z", "url": "https://github.com/FoundationDB/fdb-record-layer/pull/1049", "merged": true, "mergeCommit": {"oid": "c26f1cbe86e1098c1bf9b2ff74998703bede72d9"}, "closed": true, "closedAt": "2020-10-26T16:36:30Z", "author": {"login": "scgray"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdUuPrsgH2gAyNTA3NTE3NDAwOjE3N2ZkNWI4ZWZhYjA5MDVjMjYxNmU0N2M5ZGYzZjRiMDEwMTQ1OGQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdWXEVNgFqTUxNjk2NDY5MA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "177fd5b8efab0905c2616e47c9df3f4b0101458d", "author": {"user": null}, "url": "https://github.com/FoundationDB/fdb-record-layer/commit/177fd5b8efab0905c2616e47c9df3f4b0101458d", "committedDate": "2020-10-21T14:28:29Z", "message": "Resolves #1048: preloadRecordAsync should cache negative results"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0b69e8a9e433d6d4cbc3f659732ae40184c8857c", "author": {"user": null}, "url": "https://github.com/FoundationDB/fdb-record-layer/commit/0b69e8a9e433d6d4cbc3f659732ae40184c8857c", "committedDate": "2020-10-21T12:56:34Z", "message": "Resolves #1048: preloadRecordAsync should cache negative results"}, "afterCommit": {"oid": "177fd5b8efab0905c2616e47c9df3f4b0101458d", "author": {"user": null}, "url": "https://github.com/FoundationDB/fdb-record-layer/commit/177fd5b8efab0905c2616e47c9df3f4b0101458d", "committedDate": "2020-10-21T14:28:29Z", "message": "Resolves #1048: preloadRecordAsync should cache negative results"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE1OTAwNzMx", "url": "https://github.com/FoundationDB/fdb-record-layer/pull/1049#pullrequestreview-515900731", "createdAt": "2020-10-23T18:17:06Z", "commit": {"oid": "177fd5b8efab0905c2616e47c9df3f4b0101458d"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yM1QxODoxNzowNlrOHnYj-g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yM1QxODoxNzowNlrOHnYj-g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTA1ODkzOA==", "bodyText": "What is the purpose of having incomplete entries in the cache at all? They aren't returned to another load attempt or even shared by it?", "url": "https://github.com/FoundationDB/fdb-record-layer/pull/1049#discussion_r511058938", "createdAt": "2020-10-23T18:17:06Z", "author": {"login": "MMcM"}, "path": "fdb-record-layer-core/src/main/java/com/apple/foundationdb/record/provider/foundationdb/FDBPreloadRecordCache.java", "diffHunk": "@@ -0,0 +1,175 @@\n+/*\n+ * FDBRecordCache.java\n+ *\n+ * This source file is part of the FoundationDB open source project\n+ *\n+ * Copyright 2015-2020 Apple Inc. and the FoundationDB project authors\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.apple.foundationdb.record.provider.foundationdb;\n+\n+import com.apple.foundationdb.annotation.API;\n+import com.apple.foundationdb.tuple.Tuple;\n+import com.google.common.cache.Cache;\n+import com.google.common.cache.CacheBuilder;\n+\n+import javax.annotation.Nonnull;\n+import javax.annotation.Nullable;\n+\n+/**\n+ * A cache used to track and handle the results of asynchronously preloaded records.\n+ */\n+@API(API.Status.INTERNAL)\n+class FDBPreloadRecordCache {\n+    @Nonnull\n+    private final Cache<Tuple, EntryImpl>  cache;\n+\n+    public FDBPreloadRecordCache(int maximumSize) {\n+        cache = CacheBuilder.newBuilder().maximumSize(maximumSize).build();\n+    }\n+\n+    /**\n+     * Called prior to performing a prefetch for a given {@code Tuple}, returning a future holder that must\n+     * be filled in with the record when it has completed.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "177fd5b8efab0905c2616e47c9df3f4b0101458d"}, "originalPosition": 45}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "61501d23027cd6b4a7d2b8cbae741675dc00f1c4", "author": {"user": null}, "url": "https://github.com/FoundationDB/fdb-record-layer/commit/61501d23027cd6b4a7d2b8cbae741675dc00f1c4", "committedDate": "2020-10-23T21:20:41Z", "message": "Comment to explain why the cache behavior looks so strange"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE2OTY0Njkw", "url": "https://github.com/FoundationDB/fdb-record-layer/pull/1049#pullrequestreview-516964690", "createdAt": "2020-10-26T16:36:07Z", "commit": {"oid": "61501d23027cd6b4a7d2b8cbae741675dc00f1c4"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2471, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}