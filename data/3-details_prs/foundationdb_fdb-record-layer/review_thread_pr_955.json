{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDIxNjU4MDI5", "number": 955, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMlQxNTowOToyM1rOD---dw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMlQxNTowOTozM1rOD---ug==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY3MzcwMTAzOnYy", "diffSide": "LEFT", "path": "fdb-record-layer-core/src/test/java/com/apple/foundationdb/record/provider/foundationdb/VersionIndexTest.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMlQxNTowOToyM1rOGZaoKw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMlQxNToxODozOFrOGZa7sg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTMwMzg1MQ==", "bodyText": "Wait, this is wrong", "url": "https://github.com/FoundationDB/fdb-record-layer/pull/955#discussion_r429303851", "createdAt": "2020-05-22T15:09:23Z", "author": {"login": "alecgrieser"}, "path": "fdb-record-layer-core/src/test/java/com/apple/foundationdb/record/provider/foundationdb/VersionIndexTest.java", "diffHunk": "@@ -1059,13 +1295,13 @@ public void maxEverVersionWithinTransaction(int testFormatVersion, boolean testS\n         try (FDBRecordContext context = openContext(maxEverVersionHook)) {\n             MySimpleRecord record3 = MySimpleRecord.newBuilder().setRecNo(1066L).build();\n             MySimpleRecord record4 = MySimpleRecord.newBuilder().setRecNo(1415L).build();\n-            recordStore.saveRecord(record3);\n+            FDBRecordVersion version3 = recordStore.saveRecord(record3).getVersion();\n+            assertNotNull(version3);\n             FDBRecordVersion version4 = getBiggerVersion(expectedMaxVersion);\n-            recordStore.saveRecord(record4, version4);\n+            FDBStoredRecord<?> storedRecord4 = recordStore.saveRecord(record4, version4);\n \n             context.commit();\n             assertNotNull(context.getVersionStamp());\n-            FDBRecordVersion version3 = FDBRecordVersion.complete(context.getVersionStamp(), context.getLocalVersion(Tuple.from(record3.getRecNo())).get());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "83b9903d263e09b6f4af7ed4577165f15c70767e"}, "originalPosition": 288}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTMwODg1MA==", "bodyText": "A previous version of this had some confusion as to which versions were complete and which were incomplete. The newer version I think doesn't have that any more.", "url": "https://github.com/FoundationDB/fdb-record-layer/pull/955#discussion_r429308850", "createdAt": "2020-05-22T15:18:38Z", "author": {"login": "alecgrieser"}, "path": "fdb-record-layer-core/src/test/java/com/apple/foundationdb/record/provider/foundationdb/VersionIndexTest.java", "diffHunk": "@@ -1059,13 +1295,13 @@ public void maxEverVersionWithinTransaction(int testFormatVersion, boolean testS\n         try (FDBRecordContext context = openContext(maxEverVersionHook)) {\n             MySimpleRecord record3 = MySimpleRecord.newBuilder().setRecNo(1066L).build();\n             MySimpleRecord record4 = MySimpleRecord.newBuilder().setRecNo(1415L).build();\n-            recordStore.saveRecord(record3);\n+            FDBRecordVersion version3 = recordStore.saveRecord(record3).getVersion();\n+            assertNotNull(version3);\n             FDBRecordVersion version4 = getBiggerVersion(expectedMaxVersion);\n-            recordStore.saveRecord(record4, version4);\n+            FDBStoredRecord<?> storedRecord4 = recordStore.saveRecord(record4, version4);\n \n             context.commit();\n             assertNotNull(context.getVersionStamp());\n-            FDBRecordVersion version3 = FDBRecordVersion.complete(context.getVersionStamp(), context.getLocalVersion(Tuple.from(record3.getRecNo())).get());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTMwMzg1MQ=="}, "originalCommit": {"oid": "83b9903d263e09b6f4af7ed4577165f15c70767e"}, "originalPosition": 288}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY3MzcwMTcwOnYy", "diffSide": "LEFT", "path": "fdb-record-layer-core/src/test/java/com/apple/foundationdb/record/provider/foundationdb/VersionIndexTest.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMlQxNTowOTozM1rOGZaokg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMlQxNToxODo0N1rOGZa7-g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTMwMzk1NA==", "bodyText": "as is this", "url": "https://github.com/FoundationDB/fdb-record-layer/pull/955#discussion_r429303954", "createdAt": "2020-05-22T15:09:33Z", "author": {"login": "alecgrieser"}, "path": "fdb-record-layer-core/src/test/java/com/apple/foundationdb/record/provider/foundationdb/VersionIndexTest.java", "diffHunk": "@@ -1077,11 +1313,11 @@ public void maxEverVersionWithinTransaction(int testFormatVersion, boolean testS\n             MySimpleRecord record6 = MySimpleRecord.newBuilder().setRecNo(1455L).build();\n             FDBRecordVersion version5 = getBiggerVersion(expectedMaxVersion);\n             recordStore.saveRecord(record5, version5);\n-            recordStore.saveRecord(record6);\n+            FDBRecordVersion version6 = recordStore.saveRecord(record6).getVersion();\n+            assertNotNull(version6);\n \n             context.commit();\n             assertNotNull(context.getVersionStamp());\n-            FDBRecordVersion version6 = FDBRecordVersion.complete(context.getVersionStamp(), context.getLocalVersion(Tuple.from(record6.getRecNo())).get());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "83b9903d263e09b6f4af7ed4577165f15c70767e"}, "originalPosition": 302}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTMwODkyMg==", "bodyText": "Same as the other comment.", "url": "https://github.com/FoundationDB/fdb-record-layer/pull/955#discussion_r429308922", "createdAt": "2020-05-22T15:18:47Z", "author": {"login": "alecgrieser"}, "path": "fdb-record-layer-core/src/test/java/com/apple/foundationdb/record/provider/foundationdb/VersionIndexTest.java", "diffHunk": "@@ -1077,11 +1313,11 @@ public void maxEverVersionWithinTransaction(int testFormatVersion, boolean testS\n             MySimpleRecord record6 = MySimpleRecord.newBuilder().setRecNo(1455L).build();\n             FDBRecordVersion version5 = getBiggerVersion(expectedMaxVersion);\n             recordStore.saveRecord(record5, version5);\n-            recordStore.saveRecord(record6);\n+            FDBRecordVersion version6 = recordStore.saveRecord(record6).getVersion();\n+            assertNotNull(version6);\n \n             context.commit();\n             assertNotNull(context.getVersionStamp());\n-            FDBRecordVersion version6 = FDBRecordVersion.complete(context.getVersionStamp(), context.getLocalVersion(Tuple.from(record6.getRecNo())).get());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTMwMzk1NA=="}, "originalCommit": {"oid": "83b9903d263e09b6f4af7ed4577165f15c70767e"}, "originalPosition": 302}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4916, "cost": 1, "resetAt": "2021-11-12T19:05:54Z"}}}