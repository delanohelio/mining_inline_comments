{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE5ODEwNDQ3", "number": 948, "title": "Fixes #947: TupleKeyCountTree.addPrefixChild only ever adds one child", "bodyText": "Use the prefix's bytes as the unique child key.", "createdAt": "2020-05-19T00:34:55Z", "url": "https://github.com/FoundationDB/fdb-record-layer/pull/948", "merged": true, "mergeCommit": {"oid": "9f3853bffcd15875560fda115e03962c9dbe0186"}, "closed": true, "closedAt": "2020-05-19T16:33:42Z", "author": {"login": "MMcM"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcio9ZHAH2gAyNDE5ODEwNDQ3OjlhNDc4ZTQwYTY2OTNlOTAxMGYxN2E1ZjY2NjA5OGE0NGU0N2ZlMTM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABci3IiugFqTQxNDYyNTQ4MQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "9a478e40a6693e9010f17a5f666098a44e47fe13", "author": {"user": {"login": "MMcM", "name": "Mike McMahon"}}, "url": "https://github.com/FoundationDB/fdb-record-layer/commit/9a478e40a6693e9010f17a5f666098a44e47fe13", "committedDate": "2020-05-19T00:02:46Z", "message": "Fixes #947: TupleKeyCountTree.addPrefixChild only ever adds one child"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE0NTYzNzIw", "url": "https://github.com/FoundationDB/fdb-record-layer/pull/948#pullrequestreview-414563720", "createdAt": "2020-05-19T15:25:52Z", "commit": {"oid": "9a478e40a6693e9010f17a5f666098a44e47fe13"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOVQxNToyNTo1M1rOGXl8bA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOVQxNToyNTo1M1rOGXl8bA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzM5MjEwOA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    return children.computeIfAbsent(bytes, b -> newPrefixChild(prefixBytes, prefix));\n          \n          \n            \n                    return children.computeIfAbsent(prefixBytes, b -> newPrefixChild(prefixBytes, prefix));\n          \n      \n    \n    \n  \n\nI think? I'm not actually sure, but I thought that's what you were alluding to in the issue text.", "url": "https://github.com/FoundationDB/fdb-record-layer/pull/948#discussion_r427392108", "createdAt": "2020-05-19T15:25:53Z", "author": {"login": "alecgrieser"}, "path": "fdb-extensions/src/main/java/com/apple/foundationdb/clientlog/TupleKeyCountTree.java", "diffHunk": "@@ -152,12 +152,12 @@ private synchronized void addInternal(@Nonnull List<Object> items, int itemPosit\n     @Nonnull\n     public TupleKeyCountTree addPrefixChild(@Nonnull Object prefix) {\n         count++;\n-        return children.computeIfAbsent(bytes, b -> newPrefixChild(prefix));\n+        final byte[] prefixBytes = Tuple.from(prefix).pack();\n+        return children.computeIfAbsent(bytes, b -> newPrefixChild(prefixBytes, prefix));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9a478e40a6693e9010f17a5f666098a44e47fe13"}, "originalPosition": 6}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3b9ce858fc00b0a2190c1ae4ad93581d5a645ed6", "author": {"user": {"login": "MMcM", "name": "Mike McMahon"}}, "url": "https://github.com/FoundationDB/fdb-record-layer/commit/3b9ce858fc00b0a2190c1ae4ad93581d5a645ed6", "committedDate": "2020-05-19T15:41:29Z", "message": "Update fdb-extensions/src/main/java/com/apple/foundationdb/clientlog/TupleKeyCountTree.java\n\nCo-authored-by: Alec Grieser <alloc@apple.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1831b2bac486ae9e59894b112d80af31430956be", "author": {"user": {"login": "MMcM", "name": "Mike McMahon"}}, "url": "https://github.com/FoundationDB/fdb-record-layer/commit/1831b2bac486ae9e59894b112d80af31430956be", "committedDate": "2020-05-19T15:47:57Z", "message": "Don't use field name as parameter name"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0e582b9b2b05b92c5766d9e728b55bfb326a357f", "author": {"user": {"login": "MMcM", "name": "Mike McMahon"}}, "url": "https://github.com/FoundationDB/fdb-record-layer/commit/0e582b9b2b05b92c5766d9e728b55bfb326a357f", "committedDate": "2020-05-19T15:53:14Z", "message": "Release note"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE0NjI1NDgx", "url": "https://github.com/FoundationDB/fdb-record-layer/pull/948#pullrequestreview-414625481", "createdAt": "2020-05-19T16:33:37Z", "commit": {"oid": "0e582b9b2b05b92c5766d9e728b55bfb326a357f"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2599, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}