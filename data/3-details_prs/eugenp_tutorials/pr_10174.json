{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTA1MzQ1MjIw", "number": 10174, "title": "Storing Files Indexed by a Database", "bodyText": "", "createdAt": "2020-10-17T20:49:45Z", "url": "https://github.com/eugenp/tutorials/pull/10174", "merged": true, "mergeCommit": {"oid": "4711e4fedbb5e1f7eb4ed170f184c47103fdf30b"}, "closed": true, "closedAt": "2020-11-01T14:46:16Z", "author": {"login": "GilvanOrnelas"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdTsMkigFqTUxMTEyNTQxNw==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdW85TmABqjM5MzEwMjcxNjE=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTExMTI1NDE3", "url": "https://github.com/eugenp/tutorials/pull/10174#pullrequestreview-511125417", "createdAt": "2020-10-18T09:26:03Z", "commit": {"oid": "428b2db874425c42e8b9a39b1a07a63c101d6616"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xOFQwOToyNjowM1rOHjkceQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xOFQwOTozMToxMlrOHjki2A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzA1OTMyMQ==", "bodyText": "Why are you setting the image name to itself? and why do you have both a setter and a public property on Image? I'd rather than we just used getters and setters?", "url": "https://github.com/eugenp/tutorials/pull/10174#discussion_r507059321", "createdAt": "2020-10-18T09:26:03Z", "author": {"login": "ashleyfrieze"}, "path": "persistence-modules/spring-boot-persistence-2/src/main/java/com/baeldung/db/indexing/FileSystemRepository.java", "diffHunk": "@@ -0,0 +1,36 @@\n+package com.baeldung.db.indexing;\n+\n+import java.nio.file.Files;\n+import java.nio.file.Path;\n+import java.nio.file.Paths;\n+import java.util.Date;\n+\n+import org.springframework.data.jpa.repository.JpaRepository;\n+import org.springframework.stereotype.Repository;\n+\n+@Repository\n+interface FileSystemRepository extends JpaRepository<Image, Long> {\n+\n+    String RESOURCES_DIR = FileSystemRepository.class.getResource(\"/\")\n+        .getPath() + \"/\";\n+\n+    default Image saveToFileSystem(Image image) throws Exception {\n+        Path newFile = Paths.get(RESOURCES_DIR + new Date().getTime() + \"-\" + image.name);\n+        Files.createDirectories(newFile.getParent());\n+\n+        Files.write(newFile, image.content);\n+\n+        image.setName(image.name);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "428b2db874425c42e8b9a39b1a07a63c101d6616"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzA1OTg5MQ==", "bodyText": "On the whole, I think it would make cleaner code if the image you saved was a different object than the input. This works, which is fine, but it's kind of dirty as the caller provides you an image with its bytes and you delete them.\nBetter this should construct Image imageToSave = new Image(image.getName(), newFile.toAbsolutePath());\nAlso note - constructors are better than setters!", "url": "https://github.com/eugenp/tutorials/pull/10174#discussion_r507059891", "createdAt": "2020-10-18T09:27:32Z", "author": {"login": "ashleyfrieze"}, "path": "persistence-modules/spring-boot-persistence-2/src/main/java/com/baeldung/db/indexing/FileSystemRepository.java", "diffHunk": "@@ -0,0 +1,36 @@\n+package com.baeldung.db.indexing;\n+\n+import java.nio.file.Files;\n+import java.nio.file.Path;\n+import java.nio.file.Paths;\n+import java.util.Date;\n+\n+import org.springframework.data.jpa.repository.JpaRepository;\n+import org.springframework.stereotype.Repository;\n+\n+@Repository\n+interface FileSystemRepository extends JpaRepository<Image, Long> {\n+\n+    String RESOURCES_DIR = FileSystemRepository.class.getResource(\"/\")\n+        .getPath() + \"/\";\n+\n+    default Image saveToFileSystem(Image image) throws Exception {\n+        Path newFile = Paths.get(RESOURCES_DIR + new Date().getTime() + \"-\" + image.name);\n+        Files.createDirectories(newFile.getParent());\n+\n+        Files.write(newFile, image.content);\n+\n+        image.setName(image.name);\n+        image.setLocation(newFile.toAbsolutePath()\n+            .toString());\n+        image.setContent(null);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "428b2db874425c42e8b9a39b1a07a63c101d6616"}, "originalPosition": 26}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzA2MDM0OA==", "bodyText": "Perhaps this should return Optional<byte[]> with the code\nreturn findById(id)\n   .map(Image::getLocation) // use a getter!!\n   .map(this::readFile);\nwith a function readFile that does your readAllBytes.\nThen this code would handle what happens when the file is missing.", "url": "https://github.com/eugenp/tutorials/pull/10174#discussion_r507060348", "createdAt": "2020-10-18T09:29:09Z", "author": {"login": "ashleyfrieze"}, "path": "persistence-modules/spring-boot-persistence-2/src/main/java/com/baeldung/db/indexing/FileSystemRepository.java", "diffHunk": "@@ -0,0 +1,36 @@\n+package com.baeldung.db.indexing;\n+\n+import java.nio.file.Files;\n+import java.nio.file.Path;\n+import java.nio.file.Paths;\n+import java.util.Date;\n+\n+import org.springframework.data.jpa.repository.JpaRepository;\n+import org.springframework.stereotype.Repository;\n+\n+@Repository\n+interface FileSystemRepository extends JpaRepository<Image, Long> {\n+\n+    String RESOURCES_DIR = FileSystemRepository.class.getResource(\"/\")\n+        .getPath() + \"/\";\n+\n+    default Image saveToFileSystem(Image image) throws Exception {\n+        Path newFile = Paths.get(RESOURCES_DIR + new Date().getTime() + \"-\" + image.name);\n+        Files.createDirectories(newFile.getParent());\n+\n+        Files.write(newFile, image.content);\n+\n+        image.setName(image.name);\n+        image.setLocation(newFile.toAbsolutePath()\n+            .toString());\n+        image.setContent(null);\n+\n+        return save(image);\n+    }\n+\n+    default byte[] findInFileSystem(Long id) throws Exception {\n+        Path image = Paths.get(findById(id).get().location);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "428b2db874425c42e8b9a39b1a07a63c101d6616"}, "originalPosition": 32}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzA2MDUzMA==", "bodyText": "Similar issue here with calling get when the findById may return empty.", "url": "https://github.com/eugenp/tutorials/pull/10174#discussion_r507060530", "createdAt": "2020-10-18T09:29:44Z", "author": {"login": "ashleyfrieze"}, "path": "persistence-modules/spring-boot-persistence-2/src/main/java/com/baeldung/db/indexing/ImageController.java", "diffHunk": "@@ -0,0 +1,39 @@\n+package com.baeldung.db.indexing;\n+\n+import java.io.IOException;\n+\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.core.io.ByteArrayResource;\n+import org.springframework.core.io.Resource;\n+import org.springframework.http.MediaType;\n+import org.springframework.web.bind.annotation.GetMapping;\n+import org.springframework.web.bind.annotation.PathVariable;\n+import org.springframework.web.bind.annotation.PostMapping;\n+import org.springframework.web.bind.annotation.RequestParam;\n+import org.springframework.web.bind.annotation.RestController;\n+import org.springframework.web.multipart.MultipartFile;\n+\n+@RestController\n+class ImageController {\n+\n+    @Autowired\n+    ImageRepository imageRepository;\n+\n+    @PostMapping(\"/image\")\n+    long uploadImage(@RequestParam MultipartFile image) throws IOException {\n+        Image dbImage = new Image();\n+        dbImage.setName(image.getOriginalFilename());\n+        dbImage.setContent(image.getBytes());\n+\n+        return imageRepository.save(dbImage)\n+            .getId();\n+    }\n+\n+    @GetMapping(value = \"/image/{imageId}\", produces = MediaType.IMAGE_JPEG_VALUE)\n+    Resource downloadImage(@PathVariable Long imageId) {\n+        byte[] image = imageRepository.findById(imageId)\n+            .get()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "428b2db874425c42e8b9a39b1a07a63c101d6616"}, "originalPosition": 35}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzA2MDgwMg==", "bodyText": "Bad practice to use ordered tests - if a test case requires something from earlier, then it's probably one test case.", "url": "https://github.com/eugenp/tutorials/pull/10174#discussion_r507060802", "createdAt": "2020-10-18T09:30:37Z", "author": {"login": "ashleyfrieze"}, "path": "persistence-modules/spring-boot-persistence-2/src/test/java/com/baeldung/db/indexing/FileSystemImageIntegrationTest.java", "diffHunk": "@@ -0,0 +1,58 @@\n+package com.baeldung.db.indexing;\n+\n+import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.status;\n+\n+import java.io.InputStream;\n+\n+import org.assertj.core.api.Assertions;\n+import org.junit.FixMethodOrder;\n+import org.junit.jupiter.api.Order;\n+import org.junit.jupiter.api.Test;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.boot.test.autoconfigure.web.servlet.AutoConfigureMockMvc;\n+import org.springframework.boot.test.context.SpringBootTest;\n+import org.springframework.http.MediaType;\n+import org.springframework.mock.web.MockMultipartFile;\n+import org.springframework.test.web.servlet.MockMvc;\n+import org.springframework.test.web.servlet.MvcResult;\n+import org.springframework.test.web.servlet.request.MockMultipartHttpServletRequestBuilder;\n+import org.springframework.test.web.servlet.request.MockMvcRequestBuilders;\n+\n+import com.baeldung.db.indexing.ImageUploaderApplication;\n+\n+@SpringBootTest(classes = ImageUploaderApplication.class)\n+@AutoConfigureMockMvc\n+@FixMethodOrder\n+class FileSystemImageIntegrationTest {\n+\n+    @Autowired\n+    MockMvc mockMvc;\n+\n+    @Test\n+    @Order(1)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "428b2db874425c42e8b9a39b1a07a63c101d6616"}, "originalPosition": 32}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzA2MDg2Mw==", "bodyText": "static import assertThat", "url": "https://github.com/eugenp/tutorials/pull/10174#discussion_r507060863", "createdAt": "2020-10-18T09:30:51Z", "author": {"login": "ashleyfrieze"}, "path": "persistence-modules/spring-boot-persistence-2/src/test/java/com/baeldung/db/indexing/FileSystemImageIntegrationTest.java", "diffHunk": "@@ -0,0 +1,58 @@\n+package com.baeldung.db.indexing;\n+\n+import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.status;\n+\n+import java.io.InputStream;\n+\n+import org.assertj.core.api.Assertions;\n+import org.junit.FixMethodOrder;\n+import org.junit.jupiter.api.Order;\n+import org.junit.jupiter.api.Test;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.boot.test.autoconfigure.web.servlet.AutoConfigureMockMvc;\n+import org.springframework.boot.test.context.SpringBootTest;\n+import org.springframework.http.MediaType;\n+import org.springframework.mock.web.MockMultipartFile;\n+import org.springframework.test.web.servlet.MockMvc;\n+import org.springframework.test.web.servlet.MvcResult;\n+import org.springframework.test.web.servlet.request.MockMultipartHttpServletRequestBuilder;\n+import org.springframework.test.web.servlet.request.MockMvcRequestBuilders;\n+\n+import com.baeldung.db.indexing.ImageUploaderApplication;\n+\n+@SpringBootTest(classes = ImageUploaderApplication.class)\n+@AutoConfigureMockMvc\n+@FixMethodOrder\n+class FileSystemImageIntegrationTest {\n+\n+    @Autowired\n+    MockMvc mockMvc;\n+\n+    @Test\n+    @Order(1)\n+    void givenJpegImage_whenUploadIt_shallReturnItsId() throws Exception {\n+        ClassLoader classLoader = ClassLoader.getSystemClassLoader();\n+        InputStream image = classLoader.getResourceAsStream(\"baeldung.jpeg\");\n+\n+        MockMultipartHttpServletRequestBuilder multipartRequest = MockMvcRequestBuilders.multipart(\"/file-system/image\")\n+            .file(new MockMultipartFile(\"image\", \"baeldung\", MediaType.TEXT_PLAIN_VALUE, image));\n+\n+        MvcResult result = mockMvc.perform(multipartRequest)\n+            .andExpect(status().isOk())\n+            .andReturn();\n+\n+        Assertions.assertThat(result.getResponse()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "428b2db874425c42e8b9a39b1a07a63c101d6616"}, "originalPosition": 44}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzA2MDk1Mg==", "bodyText": "You can see that this test is part of the other one as its given describes something that's not in its body.", "url": "https://github.com/eugenp/tutorials/pull/10174#discussion_r507060952", "createdAt": "2020-10-18T09:31:12Z", "author": {"login": "ashleyfrieze"}, "path": "persistence-modules/spring-boot-persistence-2/src/test/java/com/baeldung/db/indexing/FileSystemImageIntegrationTest.java", "diffHunk": "@@ -0,0 +1,58 @@\n+package com.baeldung.db.indexing;\n+\n+import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.status;\n+\n+import java.io.InputStream;\n+\n+import org.assertj.core.api.Assertions;\n+import org.junit.FixMethodOrder;\n+import org.junit.jupiter.api.Order;\n+import org.junit.jupiter.api.Test;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.boot.test.autoconfigure.web.servlet.AutoConfigureMockMvc;\n+import org.springframework.boot.test.context.SpringBootTest;\n+import org.springframework.http.MediaType;\n+import org.springframework.mock.web.MockMultipartFile;\n+import org.springframework.test.web.servlet.MockMvc;\n+import org.springframework.test.web.servlet.MvcResult;\n+import org.springframework.test.web.servlet.request.MockMultipartHttpServletRequestBuilder;\n+import org.springframework.test.web.servlet.request.MockMvcRequestBuilders;\n+\n+import com.baeldung.db.indexing.ImageUploaderApplication;\n+\n+@SpringBootTest(classes = ImageUploaderApplication.class)\n+@AutoConfigureMockMvc\n+@FixMethodOrder\n+class FileSystemImageIntegrationTest {\n+\n+    @Autowired\n+    MockMvc mockMvc;\n+\n+    @Test\n+    @Order(1)\n+    void givenJpegImage_whenUploadIt_shallReturnItsId() throws Exception {\n+        ClassLoader classLoader = ClassLoader.getSystemClassLoader();\n+        InputStream image = classLoader.getResourceAsStream(\"baeldung.jpeg\");\n+\n+        MockMultipartHttpServletRequestBuilder multipartRequest = MockMvcRequestBuilders.multipart(\"/file-system/image\")\n+            .file(new MockMultipartFile(\"image\", \"baeldung\", MediaType.TEXT_PLAIN_VALUE, image));\n+\n+        MvcResult result = mockMvc.perform(multipartRequest)\n+            .andExpect(status().isOk())\n+            .andReturn();\n+\n+        Assertions.assertThat(result.getResponse()\n+            .getContentAsString())\n+            .isEqualTo(\"1\");\n+    }\n+\n+    @Test\n+    @Order(2)\n+    void givenBaeldungImage_whenDownloadIt_shallReturnTheImage() throws Exception {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "428b2db874425c42e8b9a39b1a07a63c101d6616"}, "originalPosition": 51}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTExNDkzNjU5", "url": "https://github.com/eugenp/tutorials/pull/10174#pullrequestreview-511493659", "createdAt": "2020-10-19T07:50:22Z", "commit": {"oid": "ac4cc8d299397518ec45117ac480efca9990de94"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xOVQwNzo1MDoyMlrOHkB0sw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xOVQwNzo1MToyNFrOHkB3JQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzU0MDY1OQ==", "bodyText": "@GilvanOrnelas you're right that given means I expect this precondition for a test. However, in test code, it's usual that the given part of the test is within the body of the test method, setting up that precondition so that each test can be run independently. In your previous version, for example, it wasn't possible to only execute the second test, as it depended on the execution of the first.\nI've seen this done before, sometimes for very good reasons. I even wrote a JUnit framework once to allow tests to express their dependencies, and for the test execution order to be determined from them, rather than have to be hard-coded using Order.\nHowever, on the whole, it's well worth avoiding this pattern.", "url": "https://github.com/eugenp/tutorials/pull/10174#discussion_r507540659", "createdAt": "2020-10-19T07:50:22Z", "author": {"login": "ashleyfrieze"}, "path": "persistence-modules/spring-boot-persistence-2/src/test/java/com/baeldung/db/indexing/FileSystemImageIntegrationTest.java", "diffHunk": "@@ -0,0 +1,58 @@\n+package com.baeldung.db.indexing;\n+\n+import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.status;\n+\n+import java.io.InputStream;\n+\n+import org.assertj.core.api.Assertions;\n+import org.junit.FixMethodOrder;\n+import org.junit.jupiter.api.Order;\n+import org.junit.jupiter.api.Test;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.boot.test.autoconfigure.web.servlet.AutoConfigureMockMvc;\n+import org.springframework.boot.test.context.SpringBootTest;\n+import org.springframework.http.MediaType;\n+import org.springframework.mock.web.MockMultipartFile;\n+import org.springframework.test.web.servlet.MockMvc;\n+import org.springframework.test.web.servlet.MvcResult;\n+import org.springframework.test.web.servlet.request.MockMultipartHttpServletRequestBuilder;\n+import org.springframework.test.web.servlet.request.MockMvcRequestBuilders;\n+\n+import com.baeldung.db.indexing.ImageUploaderApplication;\n+\n+@SpringBootTest(classes = ImageUploaderApplication.class)\n+@AutoConfigureMockMvc\n+@FixMethodOrder\n+class FileSystemImageIntegrationTest {\n+\n+    @Autowired\n+    MockMvc mockMvc;\n+\n+    @Test\n+    @Order(1)\n+    void givenJpegImage_whenUploadIt_shallReturnItsId() throws Exception {\n+        ClassLoader classLoader = ClassLoader.getSystemClassLoader();\n+        InputStream image = classLoader.getResourceAsStream(\"baeldung.jpeg\");\n+\n+        MockMultipartHttpServletRequestBuilder multipartRequest = MockMvcRequestBuilders.multipart(\"/file-system/image\")\n+            .file(new MockMultipartFile(\"image\", \"baeldung\", MediaType.TEXT_PLAIN_VALUE, image));\n+\n+        MvcResult result = mockMvc.perform(multipartRequest)\n+            .andExpect(status().isOk())\n+            .andReturn();\n+\n+        Assertions.assertThat(result.getResponse()\n+            .getContentAsString())\n+            .isEqualTo(\"1\");\n+    }\n+\n+    @Test\n+    @Order(2)\n+    void givenBaeldungImage_whenDownloadIt_shallReturnTheImage() throws Exception {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzA2MDk1Mg=="}, "originalCommit": {"oid": "428b2db874425c42e8b9a39b1a07a63c101d6616"}, "originalPosition": 51}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzU0MTI4NQ==", "bodyText": "As a bonus, you could use BDDMockito.given rather than when. This is minor and optional. As you're expressing the given part of the test, it's awkward to be doing so using functions called when. That's a question of preference, though.", "url": "https://github.com/eugenp/tutorials/pull/10174#discussion_r507541285", "createdAt": "2020-10-19T07:51:24Z", "author": {"login": "ashleyfrieze"}, "path": "persistence-modules/spring-boot-persistence-2/src/test/java/com/baeldung/db/indexing/FileSystemImageIntegrationTest.java", "diffHunk": "@@ -0,0 +1,65 @@\n+package com.baeldung.db.indexing;\n+\n+import static org.assertj.core.api.Assertions.assertThat;\n+import static org.mockito.Mockito.when;\n+import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.status;\n+\n+import java.io.InputStream;\n+import java.nio.file.Paths;\n+\n+import org.junit.jupiter.api.Test;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.boot.test.autoconfigure.web.servlet.AutoConfigureMockMvc;\n+import org.springframework.boot.test.context.SpringBootTest;\n+import org.springframework.boot.test.mock.mockito.MockBean;\n+import org.springframework.core.io.FileSystemResource;\n+import org.springframework.http.MediaType;\n+import org.springframework.mock.web.MockMultipartFile;\n+import org.springframework.test.web.servlet.MockMvc;\n+import org.springframework.test.web.servlet.MvcResult;\n+import org.springframework.test.web.servlet.request.MockMultipartHttpServletRequestBuilder;\n+import org.springframework.test.web.servlet.request.MockMvcRequestBuilders;\n+\n+@SpringBootTest(classes = ImageArchiveApplication.class)\n+@AutoConfigureMockMvc\n+class FileSystemImageIntegrationTest {\n+\n+    @Autowired\n+    MockMvc mockMvc;\n+\n+    @MockBean\n+    FileLocationService fileLocationService;\n+\n+    @Test\n+    void givenJpegImage_whenUploadIt_shallReturnItsId() throws Exception {\n+        ClassLoader classLoader = ClassLoader.getSystemClassLoader();\n+        InputStream image = classLoader.getResourceAsStream(\"baeldung.jpeg\");\n+\n+        MockMultipartHttpServletRequestBuilder multipartRequest = MockMvcRequestBuilders.multipart(\"/file-system/image\")\n+            .file(new MockMultipartFile(\"image\", \"baeldung\", MediaType.TEXT_PLAIN_VALUE, image));\n+\n+        MvcResult result = mockMvc.perform(multipartRequest)\n+            .andExpect(status().isOk())\n+            .andReturn();\n+\n+        assertThat(result.getResponse()\n+            .getContentAsString())\n+                .isEqualTo(\"1\");\n+    }\n+\n+    @Test\n+    void givenBaeldungImage_whenDownloadIt_shallReturnTheImage() throws Exception {\n+        ClassLoader classLoader = ClassLoader.getSystemClassLoader();\n+        String imagePath = classLoader.getResource(\"baeldung.jpeg\")\n+            .getFile();\n+\n+        when(fileLocationService.find(1L))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ac4cc8d299397518ec45117ac480efca9990de94"}, "originalPosition": 56}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTEyNDE1OTUy", "url": "https://github.com/eugenp/tutorials/pull/10174#pullrequestreview-512415952", "createdAt": "2020-10-20T07:41:20Z", "commit": {"oid": "75c1ce5111844935f074d786024a887396c52211"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE4MjkxNTY2", "url": "https://github.com/eugenp/tutorials/pull/10174#pullrequestreview-518291566", "createdAt": "2020-10-28T03:02:39Z", "commit": {"oid": "75c1ce5111844935f074d786024a887396c52211"}, "state": "COMMENTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOFQwMzowMjozOVrOHpYR5g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOFQwMzowMzozNlrOHpYS1g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzE1MTQ2Mg==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                void givenJpegImage_whenUploadIt_shallReturnItsId() throws Exception {\n          \n          \n            \n                void givenJpegImage_whenUploadIt_thenReturnItsId() throws Exception {", "url": "https://github.com/eugenp/tutorials/pull/10174#discussion_r513151462", "createdAt": "2020-10-28T03:02:39Z", "author": {"login": "KevinGilmore"}, "path": "persistence-modules/spring-boot-persistence-2/src/test/java/com/baeldung/db/indexing/FileSystemImageIntegrationTest.java", "diffHunk": "@@ -0,0 +1,69 @@\n+package com.baeldung.db.indexing;\n+\n+import static org.assertj.core.api.Assertions.assertThat;\n+import static org.mockito.BDDMockito.given;\n+import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.status;\n+\n+import java.io.InputStream;\n+import java.nio.file.Paths;\n+\n+import org.junit.jupiter.api.Test;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.boot.test.autoconfigure.web.servlet.AutoConfigureMockMvc;\n+import org.springframework.boot.test.context.SpringBootTest;\n+import org.springframework.boot.test.mock.mockito.MockBean;\n+import org.springframework.core.io.FileSystemResource;\n+import org.springframework.http.MediaType;\n+import org.springframework.mock.web.MockMultipartFile;\n+import org.springframework.test.web.servlet.MockMvc;\n+import org.springframework.test.web.servlet.MvcResult;\n+import org.springframework.test.web.servlet.request.MockMultipartHttpServletRequestBuilder;\n+import org.springframework.test.web.servlet.request.MockMvcRequestBuilders;\n+\n+@SpringBootTest(classes = ImageArchiveApplication.class)\n+@AutoConfigureMockMvc\n+class FileSystemImageIntegrationTest {\n+\n+    @Autowired\n+    MockMvc mockMvc;\n+\n+    @MockBean\n+    FileLocationService fileLocationService;\n+\n+    @Test\n+    void givenJpegImage_whenUploadIt_shallReturnItsId() throws Exception {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "75c1ce5111844935f074d786024a887396c52211"}, "originalPosition": 34}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzE1MTU3MQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                void givenBaeldungImage_whenDownloadIt_shallReturnTheImage() throws Exception {\n          \n          \n            \n                void givenBaeldungImage_whenDownloadIt_thenReturnTheImage() throws Exception {", "url": "https://github.com/eugenp/tutorials/pull/10174#discussion_r513151571", "createdAt": "2020-10-28T03:03:06Z", "author": {"login": "KevinGilmore"}, "path": "persistence-modules/spring-boot-persistence-2/src/test/java/com/baeldung/db/indexing/FileSystemImageIntegrationTest.java", "diffHunk": "@@ -0,0 +1,69 @@\n+package com.baeldung.db.indexing;\n+\n+import static org.assertj.core.api.Assertions.assertThat;\n+import static org.mockito.BDDMockito.given;\n+import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.status;\n+\n+import java.io.InputStream;\n+import java.nio.file.Paths;\n+\n+import org.junit.jupiter.api.Test;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.boot.test.autoconfigure.web.servlet.AutoConfigureMockMvc;\n+import org.springframework.boot.test.context.SpringBootTest;\n+import org.springframework.boot.test.mock.mockito.MockBean;\n+import org.springframework.core.io.FileSystemResource;\n+import org.springframework.http.MediaType;\n+import org.springframework.mock.web.MockMultipartFile;\n+import org.springframework.test.web.servlet.MockMvc;\n+import org.springframework.test.web.servlet.MvcResult;\n+import org.springframework.test.web.servlet.request.MockMultipartHttpServletRequestBuilder;\n+import org.springframework.test.web.servlet.request.MockMvcRequestBuilders;\n+\n+@SpringBootTest(classes = ImageArchiveApplication.class)\n+@AutoConfigureMockMvc\n+class FileSystemImageIntegrationTest {\n+\n+    @Autowired\n+    MockMvc mockMvc;\n+\n+    @MockBean\n+    FileLocationService fileLocationService;\n+\n+    @Test\n+    void givenJpegImage_whenUploadIt_shallReturnItsId() throws Exception {\n+        ClassLoader classLoader = ClassLoader.getSystemClassLoader();\n+        InputStream image = classLoader.getResourceAsStream(\"baeldung.jpeg\");\n+\n+        MockMultipartHttpServletRequestBuilder multipartRequest = MockMvcRequestBuilders.multipart(\"/file-system/image\")\n+            .file(new MockMultipartFile(\"image\", \"baeldung\", MediaType.TEXT_PLAIN_VALUE, image));\n+\n+        MvcResult result = mockMvc.perform(multipartRequest)\n+            .andExpect(status().isOk())\n+            .andReturn();\n+\n+        assertThat(result.getResponse()\n+            .getContentAsString())\n+                .isEqualTo(\"1\");\n+    }\n+\n+    @Test\n+    void givenBaeldungImage_whenDownloadIt_shallReturnTheImage() throws Exception {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "75c1ce5111844935f074d786024a887396c52211"}, "originalPosition": 51}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzE1MTY0MA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                void givenBaeldungJpegImage_whenUploadIt_shallReturnItsId() throws Exception {\n          \n          \n            \n                void givenBaeldungJpegImage_whenUploadIt_thenReturnItsId() throws Exception {", "url": "https://github.com/eugenp/tutorials/pull/10174#discussion_r513151640", "createdAt": "2020-10-28T03:03:25Z", "author": {"login": "KevinGilmore"}, "path": "persistence-modules/spring-boot-persistence-2/src/test/java/com/baeldung/db/indexing/ImageIntegrationTest.java", "diffHunk": "@@ -0,0 +1,72 @@\n+package com.baeldung.db.indexing;\n+\n+import static org.assertj.core.api.Assertions.assertThat;\n+import static org.mockito.BDDMockito.given;\n+import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.status;\n+\n+import java.io.IOException;\n+import java.io.InputStream;\n+import java.nio.file.Files;\n+import java.nio.file.Paths;\n+import java.util.Optional;\n+\n+import org.junit.jupiter.api.Test;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.boot.test.autoconfigure.web.servlet.AutoConfigureMockMvc;\n+import org.springframework.boot.test.context.SpringBootTest;\n+import org.springframework.boot.test.mock.mockito.MockBean;\n+import org.springframework.http.MediaType;\n+import org.springframework.mock.web.MockMultipartFile;\n+import org.springframework.test.web.servlet.MockMvc;\n+import org.springframework.test.web.servlet.MvcResult;\n+import org.springframework.test.web.servlet.request.MockMultipartHttpServletRequestBuilder;\n+import org.springframework.test.web.servlet.request.MockMvcRequestBuilders;\n+\n+@SpringBootTest(classes = ImageArchiveApplication.class)\n+@AutoConfigureMockMvc\n+class ImageIntegrationTest {\n+\n+    @Autowired\n+    MockMvc mockMvc;\n+\n+    @MockBean\n+    ImageDbRepository imageRepository;\n+\n+    @Test\n+    void givenBaeldungJpegImage_whenUploadIt_shallReturnItsId() throws Exception {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "75c1ce5111844935f074d786024a887396c52211"}, "originalPosition": 36}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzE1MTcwMg==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                void givenExistingImage_whenDownloadIt_shallReturnHttpStatusOk() throws Exception {\n          \n          \n            \n                void givenExistingImage_whenDownloadIt_thenReturnHttpStatusOk() throws Exception {", "url": "https://github.com/eugenp/tutorials/pull/10174#discussion_r513151702", "createdAt": "2020-10-28T03:03:36Z", "author": {"login": "KevinGilmore"}, "path": "persistence-modules/spring-boot-persistence-2/src/test/java/com/baeldung/db/indexing/ImageIntegrationTest.java", "diffHunk": "@@ -0,0 +1,72 @@\n+package com.baeldung.db.indexing;\n+\n+import static org.assertj.core.api.Assertions.assertThat;\n+import static org.mockito.BDDMockito.given;\n+import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.status;\n+\n+import java.io.IOException;\n+import java.io.InputStream;\n+import java.nio.file.Files;\n+import java.nio.file.Paths;\n+import java.util.Optional;\n+\n+import org.junit.jupiter.api.Test;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.boot.test.autoconfigure.web.servlet.AutoConfigureMockMvc;\n+import org.springframework.boot.test.context.SpringBootTest;\n+import org.springframework.boot.test.mock.mockito.MockBean;\n+import org.springframework.http.MediaType;\n+import org.springframework.mock.web.MockMultipartFile;\n+import org.springframework.test.web.servlet.MockMvc;\n+import org.springframework.test.web.servlet.MvcResult;\n+import org.springframework.test.web.servlet.request.MockMultipartHttpServletRequestBuilder;\n+import org.springframework.test.web.servlet.request.MockMvcRequestBuilders;\n+\n+@SpringBootTest(classes = ImageArchiveApplication.class)\n+@AutoConfigureMockMvc\n+class ImageIntegrationTest {\n+\n+    @Autowired\n+    MockMvc mockMvc;\n+\n+    @MockBean\n+    ImageDbRepository imageRepository;\n+\n+    @Test\n+    void givenBaeldungJpegImage_whenUploadIt_shallReturnItsId() throws Exception {\n+        ClassLoader classLoader = ClassLoader.getSystemClassLoader();\n+        InputStream image = classLoader.getResourceAsStream(\"baeldung.jpeg\");\n+\n+        MockMultipartHttpServletRequestBuilder multipartRequest = MockMvcRequestBuilders.multipart(\"/image\")\n+            .file(new MockMultipartFile(\"image\", \"baeldung\", MediaType.TEXT_PLAIN_VALUE, image));\n+\n+        MvcResult result = mockMvc.perform(multipartRequest)\n+            .andExpect(status().isOk())\n+            .andReturn();\n+\n+        assertThat(result.getResponse()\n+            .getContentAsString())\n+                .isEqualTo(\"1\");\n+    }\n+\n+    @Test\n+    void givenExistingImage_whenDownloadIt_shallReturnHttpStatusOk() throws Exception {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "75c1ce5111844935f074d786024a887396c52211"}, "originalPosition": 53}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE4MjkzNjc1", "url": "https://github.com/eugenp/tutorials/pull/10174#pullrequestreview-518293675", "createdAt": "2020-10-28T03:09:47Z", "commit": {"oid": "75c1ce5111844935f074d786024a887396c52211"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOFQwMzowOTo0N1rOHpYZRw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOFQwMzowOTo0N1rOHpYZRw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzE1MzM1MQ==", "bodyText": "It's generally considered better to use a wrapper type (Long) for the id instead of the primitive (long).", "url": "https://github.com/eugenp/tutorials/pull/10174#discussion_r513153351", "createdAt": "2020-10-28T03:09:47Z", "author": {"login": "KevinGilmore"}, "path": "persistence-modules/spring-boot-persistence-2/src/main/java/com/baeldung/db/indexing/Image.java", "diffHunk": "@@ -0,0 +1,62 @@\n+package com.baeldung.db.indexing;\n+\n+import javax.persistence.Entity;\n+import javax.persistence.GeneratedValue;\n+import javax.persistence.Id;\n+import javax.persistence.Lob;\n+\n+@Entity\n+class Image {\n+\n+    @Id\n+    @GeneratedValue\n+    long id;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "75c1ce5111844935f074d786024a887396c52211"}, "originalPosition": 13}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ed91836d4fac9b9a00f585798223eca0c45e7790", "author": {"user": null}, "url": "https://github.com/eugenp/tutorials/commit/ed91836d4fac9b9a00f585798223eca0c45e7790", "committedDate": "2020-10-28T12:39:56Z", "message": "Storing files indexed by a database\n\nCreating the FileLocationService to link the FileSystemRepository to the ImageDbRepository. Removing test order\n\nChanging to BDDMockito\n\nChanging Long wrapper for @id. Changing the test names to given-when-then pattern"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "75c1ce5111844935f074d786024a887396c52211", "author": {"user": null}, "url": "https://github.com/eugenp/tutorials/commit/75c1ce5111844935f074d786024a887396c52211", "committedDate": "2020-10-19T19:31:01Z", "message": "Changing to BDDMockito"}, "afterCommit": {"oid": "ed91836d4fac9b9a00f585798223eca0c45e7790", "author": {"user": null}, "url": "https://github.com/eugenp/tutorials/commit/ed91836d4fac9b9a00f585798223eca0c45e7790", "committedDate": "2020-10-28T12:39:56Z", "message": "Storing files indexed by a database\n\nCreating the FileLocationService to link the FileSystemRepository to the ImageDbRepository. Removing test order\n\nChanging to BDDMockito\n\nChanging Long wrapper for @id. Changing the test names to given-when-then pattern"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3911, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}