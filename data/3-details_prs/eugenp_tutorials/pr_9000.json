{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk2MjYyOTYw", "number": 9000, "title": "BAEL-3858 Java Exchanger introduction", "bodyText": "", "createdAt": "2020-03-31T11:20:22Z", "url": "https://github.com/eugenp/tutorials/pull/9000", "merged": true, "mergeCommit": {"oid": "fdd9c4add8d5b7476275e815e8259de1c85e5b4f"}, "closed": true, "closedAt": "2020-05-15T20:17:10Z", "author": {"login": "dhruba619"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcSeEZAAH2gAyMzk2MjYyOTYwOmM4YTE5ZjZhMzg5ZTZmZmY4YTFiYTY1Zjk2ZjA4NzI1Y2I5ZDhlNmY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABchJV1vgH2gAyMzk2MjYyOTYwOjNiMTgwZjNlMTg2NTg2Mjg3NDg1NDk4OTc2MWExNDQwMzNmODY5MjE=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "c8a19f6a389e6fff8a1ba65f96f08725cb9d8e6f", "author": {"user": {"login": "dhruba619", "name": "Dhrubajyoti Bhattacharjee"}}, "url": "https://github.com/eugenp/tutorials/commit/c8a19f6a389e6fff8a1ba65f96f08725cb9d8e6f", "committedDate": "2020-03-29T18:18:40Z", "message": "Merge pull request #1 from eugenp/master\n\nupdating"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "38549be4483c67b71ad5101c1002138467f9a0a8", "author": {"user": null}, "url": "https://github.com/eugenp/tutorials/commit/38549be4483c67b71ad5101c1002138467f9a0a8", "committedDate": "2020-03-31T11:27:05Z", "message": "BAEL-3858 Java Exchanger introduction"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e3c7894c57196e80e7c5b1bb90e66747edb5b023", "author": {"user": {"login": "dhruba619", "name": "Dhrubajyoti Bhattacharjee"}}, "url": "https://github.com/eugenp/tutorials/commit/e3c7894c57196e80e7c5b1bb90e66747edb5b023", "committedDate": "2020-04-14T14:44:05Z", "message": "Merge pull request #2 from eugenp/master\n\nSync from main fork"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "22517c579a7597616e478acb8dc192bce35b1c7a", "author": {"user": {"login": "dhrubajyotibhattacharjeeUL", "name": null}}, "url": "https://github.com/eugenp/tutorials/commit/22517c579a7597616e478acb8dc192bce35b1c7a", "committedDate": "2020-05-10T16:37:11Z", "message": "BAEL-3858 Added demo pipeline with exchanger"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEwNTkwNDE3", "url": "https://github.com/eugenp/tutorials/pull/9000#pullrequestreview-410590417", "createdAt": "2020-05-13T05:08:04Z", "commit": {"oid": "22517c579a7597616e478acb8dc192bce35b1c7a"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QwNTowODowNVrOGUhmOA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QwNTowODowNVrOGUhmOA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDE3NTE2MA==", "bodyText": "it's Exchanger :)", "url": "https://github.com/eugenp/tutorials/pull/9000#discussion_r424175160", "createdAt": "2020-05-13T05:08:05Z", "author": {"login": "pivovarit"}, "path": "core-java-modules/core-java-concurrency-advanced-3/src/test/java/com/baeldung/exchanger/ExachangerUnitTest.java", "diffHunk": "@@ -0,0 +1,60 @@\n+package com.baeldung.exchanger;\n+\n+import static org.junit.Assert.assertEquals;\n+\n+import java.util.concurrent.Exchanger;\n+\n+import org.junit.Test;\n+\n+public class ExachangerUnitTest {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "22517c579a7597616e478acb8dc192bce35b1c7a"}, "originalPosition": 9}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEwNTkyNTM0", "url": "https://github.com/eugenp/tutorials/pull/9000#pullrequestreview-410592534", "createdAt": "2020-05-13T05:14:27Z", "commit": {"oid": "22517c579a7597616e478acb8dc192bce35b1c7a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QwNToxNDoyN1rOGUhs3w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QwNToxNDoyN1rOGUhs3w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDE3Njg2Mw==", "bodyText": "This is just an instant deadlock, please remove it", "url": "https://github.com/eugenp/tutorials/pull/9000#discussion_r424176863", "createdAt": "2020-05-13T05:14:27Z", "author": {"login": "pivovarit"}, "path": "core-java-modules/core-java-concurrency-advanced-3/src/test/java/com/baeldung/exchanger/ExchangerPipeLineUnitTest.java", "diffHunk": "@@ -0,0 +1,83 @@\n+package com.baeldung.exchanger;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+import java.util.Queue;\n+import java.util.Random;\n+import java.util.UUID;\n+import java.util.concurrent.ConcurrentLinkedQueue;\n+import java.util.concurrent.Exchanger;\n+import java.util.stream.IntStream;\n+import org.junit.Test;\n+\n+public class ExchangerPipeLineUnitTest {\n+\n+    private static final int BUFFER_SIZE = 100;\n+\n+    @Test\n+    public void givenData_whenPassedThrough_thenCorrect() throws InterruptedException {\n+\n+        Exchanger<Queue<String>> readerExchanger = new Exchanger<>();\n+        Exchanger<Queue<String>> writerExchanger = new Exchanger<>();\n+\n+        Runnable reader = () -> {\n+            Queue<String> readerBuffer = new ConcurrentLinkedQueue<>();\n+            while (true) {\n+                readerBuffer.add(UUID.randomUUID().toString());\n+                if (readerBuffer.size() >= BUFFER_SIZE) {\n+                    try {\n+                        readerBuffer = readerExchanger.exchange(readerBuffer);\n+                    } catch (InterruptedException e) {\n+                        Thread.currentThread().interrupt();\n+                        throw new RuntimeException(e);\n+                    }\n+                }\n+            }\n+        };\n+\n+        Runnable processor = () -> {\n+            Queue<String> processorBuffer = new ConcurrentLinkedQueue<>();\n+            Queue<String> writterBuffer = new ConcurrentLinkedQueue<>();\n+            try {\n+                processorBuffer = readerExchanger.exchange(processorBuffer);\n+                while (true) {\n+                    writterBuffer.add(processorBuffer.poll());\n+                    if (processorBuffer.isEmpty()) {\n+                        try {\n+                            processorBuffer = readerExchanger.exchange(processorBuffer);\n+                            writterBuffer = writerExchanger.exchange(writterBuffer);\n+                        } catch (InterruptedException e) {\n+                            Thread.currentThread().interrupt();\n+                            throw new RuntimeException(e);\n+                        }\n+                    }\n+                }\n+            } catch (InterruptedException e) {\n+                Thread.currentThread().interrupt();\n+                throw new RuntimeException(e);\n+            }\n+        };\n+\n+        Runnable writer = () -> {\n+            Queue<String> writterBuffer = new ConcurrentLinkedQueue<>();\n+            try {\n+                writterBuffer = writerExchanger.exchange(writterBuffer);\n+                while (true) {\n+                    System.out.println(writterBuffer.poll());\n+                    if (writterBuffer.isEmpty()) {\n+                        writterBuffer = writerExchanger.exchange(writterBuffer);\n+                    }\n+                }\n+            } catch (InterruptedException e) {\n+                Thread.currentThread().interrupt();\n+                throw new RuntimeException(e);\n+            }\n+        };\n+\n+        new Thread(reader).start();\n+        new Thread(processor).start();\n+        new Thread(writer).start();\n+        //Thread.currentThread().join();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "22517c579a7597616e478acb8dc192bce35b1c7a"}, "originalPosition": 80}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDExMjI4Nzgx", "url": "https://github.com/eugenp/tutorials/pull/9000#pullrequestreview-411228781", "createdAt": "2020-05-13T19:21:20Z", "commit": {"oid": "95ea758e7d33c4ec6466041c94dbc06bc5e45222"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QxOToyMToyMFrOGVAKDg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QxOToyMToyMFrOGVAKDg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDY3NTg1NA==", "bodyText": "You can just do result.join()", "url": "https://github.com/eugenp/tutorials/pull/9000#discussion_r424675854", "createdAt": "2020-05-13T19:21:20Z", "author": {"login": "pivovarit"}, "path": "core-java-modules/core-java-concurrency-advanced-3/src/test/java/com/baeldung/exchanger/ExchangerUnitTest.java", "diffHunk": "@@ -0,0 +1,63 @@\n+package com.baeldung.exchanger;\n+\n+import static org.junit.Assert.assertEquals;\n+\n+import java.util.concurrent.CompletableFuture;\n+import java.util.concurrent.Exchanger;\n+\n+import java.util.concurrent.ExecutionException;\n+import org.junit.Test;\n+\n+import static java.util.concurrent.CompletableFuture.runAsync;\n+\n+public class ExchangerUnitTest {\n+    \n+    \n+    @Test\n+    public void givenThreads_whenMessageExchanged_thenCorrect() {\n+        Exchanger<String> exchanger = new Exchanger<>();\n+\n+        Runnable taskA = () -> {\n+            try {\n+                String message = exchanger.exchange(\"from A\");\n+                assertEquals(\"from B\", message);\n+            } catch (InterruptedException e) {\n+                Thread.currentThread().interrupt();\n+                throw new RuntimeException(e);\n+            }\n+        };\n+\n+        Runnable taskB = () -> {\n+            try {\n+                String message = exchanger.exchange(\"from B\");\n+                assertEquals(\"from A\", message);\n+            } catch (InterruptedException e) {\n+                Thread.currentThread().interrupt();\n+                throw new RuntimeException(e);\n+            }\n+        };\n+\n+        CompletableFuture.allOf(runAsync(taskA), runAsync(taskB)).join();\n+    }\n+\n+    @Test\n+    public void givenThread_WhenExchangedMessage_thenCorrect() throws InterruptedException, ExecutionException {\n+        Exchanger<String> exchanger = new Exchanger<>();\n+\n+        Runnable runner = () -> {\n+            try {\n+                String message = exchanger.exchange(\"from runner\");\n+                assertEquals(\"to runner\", message);\n+            } catch (InterruptedException e) {\n+                Thread.currentThread().interrupt();\n+                throw new RuntimeException(e);\n+            }\n+        };\n+\n+        CompletableFuture<Void> result = CompletableFuture.runAsync(runner);\n+        String msg = exchanger.exchange(\"to runner\");\n+        assertEquals(\"from runner\", msg);\n+        CompletableFuture.allOf(result).get();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "95ea758e7d33c4ec6466041c94dbc06bc5e45222"}, "originalPosition": 60}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3b180f3e1865862874854989761a144033f86921", "author": {"user": {"login": "dhrubajyotibhattacharjeeUL", "name": null}}, "url": "https://github.com/eugenp/tutorials/commit/3b180f3e1865862874854989761a144033f86921", "committedDate": "2020-05-14T08:38:35Z", "message": "BAEL-3858 Updated feedback comments"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4117, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}