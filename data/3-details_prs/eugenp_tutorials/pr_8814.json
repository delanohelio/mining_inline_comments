{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg0MTI1Njc0", "number": 8814, "title": "BAEL-2552 - spatialguru.net@gmail.com", "bodyText": "Add controller and unit test showing how to set timeouts", "createdAt": "2020-03-05T08:06:58Z", "url": "https://github.com/eugenp/tutorials/pull/8814", "merged": true, "mergeCommit": {"oid": "90bdd1e85b14e97eb4883e3f9ad1580c5edccb79"}, "closed": true, "closedAt": "2020-03-10T20:37:46Z", "author": {"login": "markathomas"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcKm5W3AH2gAyMzg0MTI1Njc0OjlkNjI0MzY2MjU3MDAxMDQwZDYyZGRiMDNiMWU4ZDE1OGEzZjU3YzY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcKvn0EgFqTM2OTgwMDk5NQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "9d624366257001040d62ddb03b1e8d158a3f57c6", "author": {"user": {"login": "markathomas", "name": "Mark Thomas"}}, "url": "https://github.com/eugenp/tutorials/commit/9d624366257001040d62ddb03b1e8d158a3f57c6", "committedDate": "2020-03-05T08:04:22Z", "message": "BAEL-2552 - Add controller and unit test showing how to set timeouts"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY5NzU0OTI5", "url": "https://github.com/eugenp/tutorials/pull/8814#pullrequestreview-369754929", "createdAt": "2020-03-05T17:08:09Z", "commit": {"oid": "9d624366257001040d62ddb03b1e8d158a3f57c6"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQxNzowODowOVrOFycPfg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQxNzowODo0MlrOFycQqQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODQzNTgzOA==", "bodyText": "this sounds a bit hacky, the best would be to create a junit rule and before the call just record rule.expect(ReadTimeoutException.class)", "url": "https://github.com/eugenp/tutorials/pull/8814#discussion_r388435838", "createdAt": "2020-03-05T17:08:09Z", "author": {"login": "rpvilao"}, "path": "spring-5-webflux/src/test/java/com/baeldung/spring/serverconfig/TimeoutLiveTest.java", "diffHunk": "@@ -0,0 +1,88 @@\n+package com.baeldung.spring.serverconfig;\n+\n+import java.util.concurrent.TimeUnit;\n+\n+import javax.net.ssl.SSLException;\n+\n+import org.junit.Assert;\n+import org.junit.Before;\n+import org.junit.Test;\n+import org.junit.runner.RunWith;\n+import org.springframework.boot.test.context.SpringBootTest;\n+import org.springframework.boot.test.context.SpringBootTest.WebEnvironment;\n+import org.springframework.http.client.reactive.ReactorClientHttpConnector;\n+import org.springframework.test.annotation.DirtiesContext;\n+import org.springframework.test.context.junit4.SpringRunner;\n+import org.springframework.test.web.reactive.server.WebTestClient;\n+\n+import io.netty.channel.ChannelOption;\n+import io.netty.handler.ssl.SslContext;\n+import io.netty.handler.ssl.SslContextBuilder;\n+import io.netty.handler.ssl.util.InsecureTrustManagerFactory;\n+import io.netty.handler.timeout.ReadTimeoutException;\n+import io.netty.handler.timeout.ReadTimeoutHandler;\n+import io.netty.handler.timeout.WriteTimeoutHandler;\n+import reactor.netty.http.client.HttpClient;\n+import reactor.netty.tcp.TcpClient;\n+\n+@RunWith(SpringRunner.class)\n+@SpringBootTest(webEnvironment = WebEnvironment.DEFINED_PORT)\n+@DirtiesContext\n+public class TimeoutLiveTest {\n+\n+    private static final String BASE_URL = \"https://localhost:8443\";\n+    private static final int TIMEOUT_MILLIS = 2000;\n+\n+    private WebTestClient webTestClient;\n+\n+    @Before\n+    public void setup() throws SSLException {\n+        webTestClient = WebTestClient.bindToServer(getConnector())\n+                                     .baseUrl(BASE_URL)\n+                                     .build();\n+    }\n+\n+    @Test\n+    public void shouldTimeout() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9d624366257001040d62ddb03b1e8d158a3f57c6"}, "originalPosition": 46}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODQzNjEzNw==", "bodyText": "I would remove this since the exception fails the test, and it's better to have that reported then to hide it", "url": "https://github.com/eugenp/tutorials/pull/8814#discussion_r388436137", "createdAt": "2020-03-05T17:08:42Z", "author": {"login": "rpvilao"}, "path": "spring-5-webflux/src/test/java/com/baeldung/spring/serverconfig/TimeoutLiveTest.java", "diffHunk": "@@ -0,0 +1,88 @@\n+package com.baeldung.spring.serverconfig;\n+\n+import java.util.concurrent.TimeUnit;\n+\n+import javax.net.ssl.SSLException;\n+\n+import org.junit.Assert;\n+import org.junit.Before;\n+import org.junit.Test;\n+import org.junit.runner.RunWith;\n+import org.springframework.boot.test.context.SpringBootTest;\n+import org.springframework.boot.test.context.SpringBootTest.WebEnvironment;\n+import org.springframework.http.client.reactive.ReactorClientHttpConnector;\n+import org.springframework.test.annotation.DirtiesContext;\n+import org.springframework.test.context.junit4.SpringRunner;\n+import org.springframework.test.web.reactive.server.WebTestClient;\n+\n+import io.netty.channel.ChannelOption;\n+import io.netty.handler.ssl.SslContext;\n+import io.netty.handler.ssl.SslContextBuilder;\n+import io.netty.handler.ssl.util.InsecureTrustManagerFactory;\n+import io.netty.handler.timeout.ReadTimeoutException;\n+import io.netty.handler.timeout.ReadTimeoutHandler;\n+import io.netty.handler.timeout.WriteTimeoutHandler;\n+import reactor.netty.http.client.HttpClient;\n+import reactor.netty.tcp.TcpClient;\n+\n+@RunWith(SpringRunner.class)\n+@SpringBootTest(webEnvironment = WebEnvironment.DEFINED_PORT)\n+@DirtiesContext\n+public class TimeoutLiveTest {\n+\n+    private static final String BASE_URL = \"https://localhost:8443\";\n+    private static final int TIMEOUT_MILLIS = 2000;\n+\n+    private WebTestClient webTestClient;\n+\n+    @Before\n+    public void setup() throws SSLException {\n+        webTestClient = WebTestClient.bindToServer(getConnector())\n+                                     .baseUrl(BASE_URL)\n+                                     .build();\n+    }\n+\n+    @Test\n+    public void shouldTimeout() {\n+        try {\n+            webTestClient.get()\n+              .uri(\"/timeout/{timeout}\", 3)\n+              .exchange();\n+            Assert.fail();\n+        } catch (ReadTimeoutException ignore) {\n+        }\n+    }\n+\n+    @Test\n+    public void shouldNotTimeout() {\n+        try {\n+            WebTestClient.ResponseSpec response = webTestClient.get()\n+              .uri(\"/timeout/{timeout}\", 1)\n+              .exchange();\n+            response.expectStatus()\n+              .isOk()\n+              .expectBody(String.class)\n+              .isEqualTo(\"OK\");\n+        } catch (ReadTimeoutException e) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9d624366257001040d62ddb03b1e8d158a3f57c6"}, "originalPosition": 66}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "75f7aa3b88d8c6d9a6dc406af882e5946a743eca", "author": {"user": {"login": "markathomas", "name": "Mark Thomas"}}, "url": "https://github.com/eugenp/tutorials/commit/75f7aa3b88d8c6d9a6dc406af882e5946a743eca", "committedDate": "2020-03-05T17:47:04Z", "message": "BAEL-2552 - use JUnit @Rule"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY5Nzk3NDA3", "url": "https://github.com/eugenp/tutorials/pull/8814#pullrequestreview-369797407", "createdAt": "2020-03-05T18:08:52Z", "commit": {"oid": "75f7aa3b88d8c6d9a6dc406af882e5946a743eca"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQxODowODo1M1rOFyeULw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQxODowODo1M1rOFyeULw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODQ2OTgwNw==", "bodyText": "this can now be removed because if the exception is not thrown, JUnit it will fail it since it was expecting it", "url": "https://github.com/eugenp/tutorials/pull/8814#discussion_r388469807", "createdAt": "2020-03-05T18:08:53Z", "author": {"login": "rpvilao"}, "path": "spring-5-webflux/src/test/java/com/baeldung/spring/serverconfig/TimeoutLiveTest.java", "diffHunk": "@@ -44,28 +49,22 @@ public void setup() throws SSLException {\n \n     @Test\n     public void shouldTimeout() {\n-        try {\n-            webTestClient.get()\n-              .uri(\"/timeout/{timeout}\", 3)\n-              .exchange();\n-            Assert.fail();\n-        } catch (ReadTimeoutException ignore) {\n-        }\n+        exception.expect(ReadTimeoutException.class);\n+        webTestClient.get()\n+          .uri(\"/timeout/{timeout}\", 3)\n+          .exchange();\n+        Assert.fail();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "75f7aa3b88d8c6d9a6dc406af882e5946a743eca"}, "originalPosition": 35}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2a409ab3494d3df192a6e36c61c8ebfc087057b0", "author": {"user": {"login": "markathomas", "name": "Mark Thomas"}}, "url": "https://github.com/eugenp/tutorials/commit/2a409ab3494d3df192a6e36c61c8ebfc087057b0", "committedDate": "2020-03-05T18:13:08Z", "message": "BAEL-2552 - Remove unnecessary line"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY5ODAwOTk1", "url": "https://github.com/eugenp/tutorials/pull/8814#pullrequestreview-369800995", "createdAt": "2020-03-05T18:14:21Z", "commit": {"oid": "2a409ab3494d3df192a6e36c61c8ebfc087057b0"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4122, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}