{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDUwMTk5NDky", "number": 1098, "title": "fix ci too much exception \"pk table not exist\"", "bodyText": "fix #1075\nChange-Id: Ie9a1ba689ae4aec876bf9793970a1d62e3c69abf", "createdAt": "2020-07-16T13:32:41Z", "url": "https://github.com/hugegraph/hugegraph/pull/1098", "merged": true, "mergeCommit": {"oid": "125b2ef617a1dea53fded67da77aefbfeb37e487"}, "closed": true, "closedAt": "2020-07-21T11:26:56Z", "author": {"login": "zhoney"}, "timelineItems": {"totalCount": 20, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc1p81AgFqTQ1MDMyNTQzMQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABc3EgFfgFqTQ1MjM2MjY5OQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUwMzI1NDMx", "url": "https://github.com/hugegraph/hugegraph/pull/1098#pullrequestreview-450325431", "createdAt": "2020-07-17T01:56:37Z", "commit": {"oid": "b2d0075c9e4e9d5a71ff3626cfbc383971eb692e"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUwMzUwNDYy", "url": "https://github.com/hugegraph/hugegraph/pull/1098#pullrequestreview-450350462", "createdAt": "2020-07-17T03:30:19Z", "commit": {"oid": "b2d0075c9e4e9d5a71ff3626cfbc383971eb692e"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xN1QwMzozMDoyMFrOGzEJAg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xN1QwMzozMzoyM1rOGzEL3Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjE5ODQwMg==", "bodyText": "move to line 258", "url": "https://github.com/hugegraph/hugegraph/pull/1098#discussion_r456198402", "createdAt": "2020-07-17T03:30:20Z", "author": {"login": "javeme"}, "path": "hugegraph-core/src/main/java/com/baidu/hugegraph/StandardHugeGraph.java", "diffHunk": "@@ -250,11 +252,13 @@ public void clearBackend() {\n         this.loadSystemStore().open(this.configuration);\n         this.loadGraphStore().open(this.configuration);\n         try {\n+            LockUtil.lock(this.name, TaskManager.HEARTBEAT);\n             this.storeProvider.clear();\n         } finally {\n             this.loadGraphStore().close();\n             this.loadSystemStore().close();\n             this.loadSchemaStore().close();\n+            LockUtil.unlock(this.name, TaskManager.HEARTBEAT);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b2d0075c9e4e9d5a71ff3626cfbc383971eb692e"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjE5ODQ4MA==", "bodyText": "move out of try", "url": "https://github.com/hugegraph/hugegraph/pull/1098#discussion_r456198480", "createdAt": "2020-07-17T03:30:38Z", "author": {"login": "javeme"}, "path": "hugegraph-core/src/main/java/com/baidu/hugegraph/StandardHugeGraph.java", "diffHunk": "@@ -250,11 +252,13 @@ public void clearBackend() {\n         this.loadSystemStore().open(this.configuration);\n         this.loadGraphStore().open(this.configuration);\n         try {\n+            LockUtil.lock(this.name, TaskManager.HEARTBEAT);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b2d0075c9e4e9d5a71ff3626cfbc383971eb692e"}, "originalPosition": 19}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjE5OTEzMw==", "bodyText": "rename to a common name like GRAPH_LOCK", "url": "https://github.com/hugegraph/hugegraph/pull/1098#discussion_r456199133", "createdAt": "2020-07-17T03:33:23Z", "author": {"login": "javeme"}, "path": "hugegraph-core/src/main/java/com/baidu/hugegraph/StandardHugeGraph.java", "diffHunk": "@@ -231,12 +231,14 @@ public void initBackend() {\n         this.loadSystemStore().open(this.configuration);\n         this.loadGraphStore().open(this.configuration);\n         try {\n+            LockUtil.lock(this.name, TaskManager.HEARTBEAT);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b2d0075c9e4e9d5a71ff3626cfbc383971eb692e"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUwNDI5MjU4", "url": "https://github.com/hugegraph/hugegraph/pull/1098#pullrequestreview-450429258", "createdAt": "2020-07-17T07:22:45Z", "commit": {"oid": "d4300877401040b6ad9ef39cf574e986efe39d2f"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xN1QwNzoyMjo0NVrOGzINkg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xN1QwNzoyNzowNFrOGzIVTQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjI2NTEwNg==", "bodyText": "remove empty line", "url": "https://github.com/hugegraph/hugegraph/pull/1098#discussion_r456265106", "createdAt": "2020-07-17T07:22:45Z", "author": {"login": "javeme"}, "path": "hugegraph-core/src/main/java/com/baidu/hugegraph/StandardHugeGraph.java", "diffHunk": "@@ -268,14 +272,15 @@ public void clearBackend() {\n     public void truncateBackend() {\n         this.waitUntilAllTasksCompleted();\n \n+        LockUtil.lock(this.name, TaskManager.GRAPH_LOCK);\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d4300877401040b6ad9ef39cf574e986efe39d2f"}, "originalPosition": 44}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjI2NzA4NQ==", "bodyText": "move to LockUtil", "url": "https://github.com/hugegraph/hugegraph/pull/1098#discussion_r456267085", "createdAt": "2020-07-17T07:27:04Z", "author": {"login": "javeme"}, "path": "hugegraph-core/src/main/java/com/baidu/hugegraph/task/TaskManager.java", "diffHunk": "@@ -45,7 +45,7 @@\n \n     private static final Logger LOG = Log.logger(TaskManager.class);\n \n-    public static final String HEARTBEAT = \"heartbeat\";\n+    public static final String GRAPH_LOCK = \"graph_lock\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d4300877401040b6ad9ef39cf574e986efe39d2f"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUwNzEwNzIy", "url": "https://github.com/hugegraph/hugegraph/pull/1098#pullrequestreview-450710722", "createdAt": "2020-07-17T14:35:09Z", "commit": {"oid": "94672c0407aa1ba9fa26e9582ee42605963c544b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUxMDMzMjUx", "url": "https://github.com/hugegraph/hugegraph/pull/1098#pullrequestreview-451033251", "createdAt": "2020-07-18T05:31:13Z", "commit": {"oid": "94672c0407aa1ba9fa26e9582ee42605963c544b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xOFQwNTozMToxM1rOGzl8ew==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xOFQwNTozMToxM1rOGzl8ew==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Njc1MjI1MQ==", "bodyText": "only do executeTasksOnWorker and cancelTasksOnWorker when !server.master() or server.onlySingleNode(), and rename server to serverManager", "url": "https://github.com/hugegraph/hugegraph/pull/1098#discussion_r456752251", "createdAt": "2020-07-18T05:31:13Z", "author": {"login": "javeme"}, "path": "hugegraph-core/src/main/java/com/baidu/hugegraph/task/TaskManager.java", "diffHunk": "@@ -276,6 +288,11 @@ private void scheduleOrExecuteJob() {\n             }\n         } catch (Throwable e) {\n             LOG.error(\"Exception occurred when schedule job\", e);\n+        } finally {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "94672c0407aa1ba9fa26e9582ee42605963c544b"}, "originalPosition": 42}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUxMDMzNDIy", "url": "https://github.com/hugegraph/hugegraph/pull/1098#pullrequestreview-451033422", "createdAt": "2020-07-18T05:34:57Z", "commit": {"oid": "94672c0407aa1ba9fa26e9582ee42605963c544b"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2eee796f97876dfb826f42c41377c06bd600d292", "author": {"user": {"login": "zhoney", "name": null}}, "url": "https://github.com/hugegraph/hugegraph/commit/2eee796f97876dfb826f42c41377c06bd600d292", "committedDate": "2020-07-21T02:27:39Z", "message": "fix ci too much exception \"pk table not exist\"\n\nChange-Id: Ie9a1ba689ae4aec876bf9793970a1d62e3c69abf"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c8a3d64f19c4b4b7a07188395134ee2a404caf8d", "author": {"user": {"login": "zhoney", "name": null}}, "url": "https://github.com/hugegraph/hugegraph/commit/c8a3d64f19c4b4b7a07188395134ee2a404caf8d", "committedDate": "2020-07-21T02:27:39Z", "message": "improve\n\nChange-Id: Ifbaa77b45177c668b61b90eeca5b436ea970060f"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "73cfba2cfda9247f816c8dfe0a39ccb9c1cf6958", "author": {"user": {"login": "zhoney", "name": null}}, "url": "https://github.com/hugegraph/hugegraph/commit/73cfba2cfda9247f816c8dfe0a39ccb9c1cf6958", "committedDate": "2020-07-21T02:27:39Z", "message": "improve\n\nChange-Id: I09dfb1a993ae382e590e2116ead6bcb14b3ebce0"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1d3ce5305d5b64ebe796ef674b9e36d58562129e", "author": {"user": {"login": "zhoney", "name": null}}, "url": "https://github.com/hugegraph/hugegraph/commit/1d3ce5305d5b64ebe796ef674b9e36d58562129e", "committedDate": "2020-07-21T02:27:39Z", "message": "improve\n\nChange-Id: I3c4e3330c8b9fb916f3fe1db591cbb74950bb6af"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f8e44da5305c1400faf4add5d9405ad074291b15", "author": {"user": {"login": "zhoney", "name": null}}, "url": "https://github.com/hugegraph/hugegraph/commit/f8e44da5305c1400faf4add5d9405ad074291b15", "committedDate": "2020-07-21T02:27:39Z", "message": "improve\n\nChange-Id: I6222493175e1c3438eb6023149ca598b8d583b7f"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "98d8fe007305532fe15a33d5bceb2faccec31567", "author": {"user": {"login": "zhoney", "name": null}}, "url": "https://github.com/hugegraph/hugegraph/commit/98d8fe007305532fe15a33d5bceb2faccec31567", "committedDate": "2020-07-21T02:27:39Z", "message": "improve\n\nChange-Id: I30149b43146e0e82f775357181c5455928ae463a"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "94672c0407aa1ba9fa26e9582ee42605963c544b", "author": {"user": {"login": "zhoney", "name": null}}, "url": "https://github.com/hugegraph/hugegraph/commit/94672c0407aa1ba9fa26e9582ee42605963c544b", "committedDate": "2020-07-17T09:48:56Z", "message": "improve\n\nChange-Id: I6222493175e1c3438eb6023149ca598b8d583b7f"}, "afterCommit": {"oid": "98d8fe007305532fe15a33d5bceb2faccec31567", "author": {"user": {"login": "zhoney", "name": null}}, "url": "https://github.com/hugegraph/hugegraph/commit/98d8fe007305532fe15a33d5bceb2faccec31567", "committedDate": "2020-07-21T02:27:39Z", "message": "improve\n\nChange-Id: I30149b43146e0e82f775357181c5455928ae463a"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUyMTAxNDI2", "url": "https://github.com/hugegraph/hugegraph/pull/1098#pullrequestreview-452101426", "createdAt": "2020-07-21T03:30:17Z", "commit": {"oid": "98d8fe007305532fe15a33d5bceb2faccec31567"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQwMzozMDoxN1rOG0mzLg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQwMzozMDoxN1rOG0mzLg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzgxNDgzMA==", "bodyText": "add graphName() to call graphparams.name() to avoid auth issue", "url": "https://github.com/hugegraph/hugegraph/pull/1098#discussion_r457814830", "createdAt": "2020-07-21T03:30:17Z", "author": {"login": "javeme"}, "path": "hugegraph-core/src/main/java/com/baidu/hugegraph/task/TaskManager.java", "diffHunk": "@@ -252,30 +254,48 @@ protected void notifyNewTask(HugeTask<?> task) {\n     }\n \n     private void scheduleOrExecuteJob() {\n+        List<String> graphs = new ArrayList<>();\n         try {\n             for (TaskScheduler entry : this.schedulers.values()) {\n                 StandardTaskScheduler scheduler = (StandardTaskScheduler) entry;\n-                ServerInfoManager server = scheduler.serverManager();\n+                ServerInfoManager serverManager = scheduler.serverManager();\n+\n+                String graph = scheduler.graph().name();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "98d8fe007305532fe15a33d5bceb2faccec31567"}, "originalPosition": 27}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2dd04ad72eabafb5d5a2badba7a7f74887b722a8", "author": {"user": {"login": "zhoney", "name": null}}, "url": "https://github.com/hugegraph/hugegraph/commit/2dd04ad72eabafb5d5a2badba7a7f74887b722a8", "committedDate": "2020-07-21T05:25:12Z", "message": "improve\n\nChange-Id: I4fed921ad3519e9ad8ecdc2df265eb568ada832d"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8977fa350e6c88f2ea8bd90734412ea946cd37fc", "author": {"user": {"login": "zhoney", "name": null}}, "url": "https://github.com/hugegraph/hugegraph/commit/8977fa350e6c88f2ea8bd90734412ea946cd37fc", "committedDate": "2020-07-21T06:22:56Z", "message": "improve\n\nChange-Id: Ide2df71f51ccd9ab381db371c0297450b1ebe3bc"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUyMjA5OTI5", "url": "https://github.com/hugegraph/hugegraph/pull/1098#pullrequestreview-452209929", "createdAt": "2020-07-21T07:51:25Z", "commit": {"oid": "8977fa350e6c88f2ea8bd90734412ea946cd37fc"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQwNzo1MToyNVrOG0sTDg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQwNzo1MToyNVrOG0sTDg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzkwNDkxMA==", "bodyText": "add some comments", "url": "https://github.com/hugegraph/hugegraph/pull/1098#discussion_r457904910", "createdAt": "2020-07-21T07:51:25Z", "author": {"login": "javeme"}, "path": "hugegraph-core/src/main/java/com/baidu/hugegraph/task/TaskManager.java", "diffHunk": "@@ -94,7 +94,7 @@ public void addScheduler(HugeGraphParams graph) {\n         this.schedulers.put(graph, scheduler);\n     }\n \n-    public void closeScheduler(HugeGraphParams graph) {\n+    public synchronized void closeScheduler(HugeGraphParams graph) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8977fa350e6c88f2ea8bd90734412ea946cd37fc"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e312e7e381018e52be3d7afcbeb38b44cd6ec3a8", "author": {"user": {"login": "zhoney", "name": null}}, "url": "https://github.com/hugegraph/hugegraph/commit/e312e7e381018e52be3d7afcbeb38b44cd6ec3a8", "committedDate": "2020-07-21T08:56:50Z", "message": "improve\n\nChange-Id: I01caba3f1c6fe9ebef6b948b4b90c367e272e026"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUyMzYxMzE5", "url": "https://github.com/hugegraph/hugegraph/pull/1098#pullrequestreview-452361319", "createdAt": "2020-07-21T11:24:21Z", "commit": {"oid": "e312e7e381018e52be3d7afcbeb38b44cd6ec3a8"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUyMzYyNjk5", "url": "https://github.com/hugegraph/hugegraph/pull/1098#pullrequestreview-452362699", "createdAt": "2020-07-21T11:26:35Z", "commit": {"oid": "e312e7e381018e52be3d7afcbeb38b44cd6ec3a8"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2231, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}