{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY1NjM2ODU2", "number": 842, "title": "Fix mysql backend openWithoutDB ssl-mode not work", "bodyText": "Change-Id: I3bf5ef9deae121a51f4e1b4ce8132958194bde31", "createdAt": "2020-01-22T02:49:39Z", "url": "https://github.com/hugegraph/hugegraph/pull/842", "merged": true, "mergeCommit": {"oid": "145bf0cd50224c324f0566453a849cccbb477c51"}, "closed": true, "closedAt": "2020-02-20T18:01:01Z", "author": {"login": "Linary"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb8za1LgFqTM0NjQ5Mzc1MQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcGMaWOAFqTM2MTk2ODkzMg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ2NDkzNzUx", "url": "https://github.com/hugegraph/hugegraph/pull/842#pullrequestreview-346493751", "createdAt": "2020-01-22T10:44:51Z", "commit": {"oid": "a4802a8980d3ee49db3289b5d8f3741cee6c6e8c"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ2NDk4NDI0", "url": "https://github.com/hugegraph/hugegraph/pull/842#pullrequestreview-346498424", "createdAt": "2020-01-22T10:52:39Z", "commit": {"oid": "a4802a8980d3ee49db3289b5d8f3741cee6c6e8c"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMlQxMDo1Mjo0MFrOFgX9RQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMlQxMDo1MzozN1rOFgX_EA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTQ5MTI2OQ==", "bodyText": "the origin logic is autoReconnect=false", "url": "https://github.com/hugegraph/hugegraph/pull/842#discussion_r369491269", "createdAt": "2020-01-22T10:52:40Z", "author": {"login": "javeme"}, "path": "hugegraph-mysql/src/main/java/com/baidu/hugegraph/backend/store/mysql/MysqlSessions.java", "diffHunk": "@@ -183,43 +183,35 @@ protected String buildExistsTable(String table) {\n      * Connect DB without specified database\n      */\n     protected Connection openWithoutDB(int timeout) {\n-        String jdbcUrl = this.config.get(MysqlOptions.JDBC_URL);\n-        String url = new URIBuilder().setPath(jdbcUrl)\n-                                     .setParameter(\"socketTimeout\",\n-                                                   String.valueOf(timeout))\n-                                     .toString();\n+        String url = this.buildUri(true, timeout);\n         try {\n             return this.connect(url);\n         } catch (SQLException e) {\n-            throw new BackendException(\"Failed to access %s\", e, jdbcUrl);\n+            throw new BackendException(\"Failed to access %s\", e, url);\n         }\n     }\n \n     /**\n      * Connect DB with specified database, but won't auto reconnect\n      */\n     protected Connection openWithDB(int timeout) {\n-        String jdbcUrl = this.config.get(MysqlOptions.JDBC_URL);\n-        if (jdbcUrl.endsWith(\"/\")) {\n-            jdbcUrl = String.format(\"%s%s\", jdbcUrl, this.database());\n-        } else {\n-            jdbcUrl = String.format(\"%s/%s\", jdbcUrl, this.database());\n-        }\n-        String url = new URIBuilder().setPath(jdbcUrl)\n-                                     .setParameter(\"socketTimeout\",\n-                                                   String.valueOf(timeout))\n-                                     .toString();\n+        String url = this.buildUri(true, timeout);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a4802a8980d3ee49db3289b5d8f3741cee6c6e8c"}, "originalPosition": 32}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTQ5MTcyOA==", "bodyText": "the origin logic is autoReconnect=false and no database parameter", "url": "https://github.com/hugegraph/hugegraph/pull/842#discussion_r369491728", "createdAt": "2020-01-22T10:53:37Z", "author": {"login": "javeme"}, "path": "hugegraph-mysql/src/main/java/com/baidu/hugegraph/backend/store/mysql/MysqlSessions.java", "diffHunk": "@@ -183,43 +183,35 @@ protected String buildExistsTable(String table) {\n      * Connect DB without specified database\n      */\n     protected Connection openWithoutDB(int timeout) {\n-        String jdbcUrl = this.config.get(MysqlOptions.JDBC_URL);\n-        String url = new URIBuilder().setPath(jdbcUrl)\n-                                     .setParameter(\"socketTimeout\",\n-                                                   String.valueOf(timeout))\n-                                     .toString();\n+        String url = this.buildUri(true, timeout);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a4802a8980d3ee49db3289b5d8f3741cee6c6e8c"}, "originalPosition": 9}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a75edf27e701b6c20ae2c42fa889838c05685f44", "author": {"user": {"login": "Linary", "name": "Linary"}}, "url": "https://github.com/hugegraph/hugegraph/commit/a75edf27e701b6c20ae2c42fa889838c05685f44", "committedDate": "2020-02-18T07:03:48Z", "message": "Fix mysql backend openWithoutDB ssl-mode not work\n\nChange-Id: I3bf5ef9deae121a51f4e1b4ce8132958194bde31"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a4802a8980d3ee49db3289b5d8f3741cee6c6e8c", "author": {"user": {"login": "Linary", "name": "Linary"}}, "url": "https://github.com/hugegraph/hugegraph/commit/a4802a8980d3ee49db3289b5d8f3741cee6c6e8c", "committedDate": "2020-01-22T02:48:14Z", "message": "Fix mysql backend openWithoutDB ssl-mode not work\n\nChange-Id: I3bf5ef9deae121a51f4e1b4ce8132958194bde31"}, "afterCommit": {"oid": "40e962f53039921084f1d3e0908a00778a5b01d8", "author": {"user": {"login": "Linary", "name": "Linary"}}, "url": "https://github.com/hugegraph/hugegraph/commit/40e962f53039921084f1d3e0908a00778a5b01d8", "committedDate": "2020-02-18T07:34:50Z", "message": "improve\n\nChange-Id: I542c42cb6cb5ead6f3046661f66ea0583ff1c671"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8937e389c367043fa8d3db9853a5d0ef1803afac", "author": {"user": {"login": "Linary", "name": "Linary"}}, "url": "https://github.com/hugegraph/hugegraph/commit/8937e389c367043fa8d3db9853a5d0ef1803afac", "committedDate": "2020-02-19T08:39:44Z", "message": "improve\n\nChange-Id: I542c42cb6cb5ead6f3046661f66ea0583ff1c671"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "40e962f53039921084f1d3e0908a00778a5b01d8", "author": {"user": {"login": "Linary", "name": "Linary"}}, "url": "https://github.com/hugegraph/hugegraph/commit/40e962f53039921084f1d3e0908a00778a5b01d8", "committedDate": "2020-02-18T07:34:50Z", "message": "improve\n\nChange-Id: I542c42cb6cb5ead6f3046661f66ea0583ff1c671"}, "afterCommit": {"oid": "8937e389c367043fa8d3db9853a5d0ef1803afac", "author": {"user": {"login": "Linary", "name": "Linary"}}, "url": "https://github.com/hugegraph/hugegraph/commit/8937e389c367043fa8d3db9853a5d0ef1803afac", "committedDate": "2020-02-19T08:39:44Z", "message": "improve\n\nChange-Id: I542c42cb6cb5ead6f3046661f66ea0583ff1c671"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYwOTI1NzE4", "url": "https://github.com/hugegraph/hugegraph/pull/842#pullrequestreview-360925718", "createdAt": "2020-02-19T08:43:13Z", "commit": {"oid": "8937e389c367043fa8d3db9853a5d0ef1803afac"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOVQwODo0MzoxM1rOFrfTlg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOVQwODo0MzoxM1rOFrfTlg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTE0NjAwNg==", "bodyText": "rename to withDB\nand prefer to set withConnParams as first param", "url": "https://github.com/hugegraph/hugegraph/pull/842#discussion_r381146006", "createdAt": "2020-02-19T08:43:13Z", "author": {"login": "javeme"}, "path": "hugegraph-mysql/src/main/java/com/baidu/hugegraph/backend/store/mysql/MysqlSessions.java", "diffHunk": "@@ -207,35 +207,39 @@ protected Connection openWithDB(int timeout) {\n      * Connect DB with specified database\n      */\n     private Connection open(boolean autoReconnect) throws SQLException {\n-        String url = this.buildUri(autoReconnect, null);\n+        String url = this.buildUri(true, true, autoReconnect, null);\n         return this.connect(url);\n     }\n \n-    protected String buildUri(boolean autoReconnect, Integer timeout) {\n+    protected String buildUri(boolean withdb, boolean withConnParams,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8937e389c367043fa8d3db9853a5d0ef1803afac"}, "originalPosition": 28}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1e46ed05b7e6a78b70ffe3d4d9241cdeeb3270f7", "author": {"user": {"login": "Linary", "name": "Linary"}}, "url": "https://github.com/hugegraph/hugegraph/commit/1e46ed05b7e6a78b70ffe3d4d9241cdeeb3270f7", "committedDate": "2020-02-19T09:07:26Z", "message": "tiny improve\n\nChange-Id: I457247da404b2dea44f272e9eec60345baa048d6"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYxODkyMzUx", "url": "https://github.com/hugegraph/hugegraph/pull/842#pullrequestreview-361892351", "createdAt": "2020-02-20T13:19:28Z", "commit": {"oid": "1e46ed05b7e6a78b70ffe3d4d9241cdeeb3270f7"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYxOTY4OTMy", "url": "https://github.com/hugegraph/hugegraph/pull/842#pullrequestreview-361968932", "createdAt": "2020-02-20T14:57:16Z", "commit": {"oid": "1e46ed05b7e6a78b70ffe3d4d9241cdeeb3270f7"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2377, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}