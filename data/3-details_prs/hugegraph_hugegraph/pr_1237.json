{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTEzOTY3Mzkx", "number": 1237, "title": "Move lz4 decompress to backend executor", "bodyText": "Change-Id: Idf2e796739fda1dc5ce5ffcfa16bc61b6e1a6281", "createdAt": "2020-11-02T10:44:04Z", "url": "https://github.com/hugegraph/hugegraph/pull/1237", "merged": true, "mergeCommit": {"oid": "636bcbbd0f826b02f2538d52dc5db6c188fa0f8d"}, "closed": true, "closedAt": "2020-11-05T02:48:20Z", "author": {"login": "Linary"}, "timelineItems": {"totalCount": 18, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdYiMx-gH2gAyNTEzOTY3MzkxOjQ0NWEyYmZmYTQxOThmN2YwMzk1ZDhmM2ZlMDRjNmI4MjBmZmJjMGQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdZLZtpgFqTUyMzI0MDU0NQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "445a2bffa4198f7f0395d8f3fe04c6b820ffbc0d", "author": {"user": {"login": "Linary", "name": "Linary"}}, "url": "https://github.com/hugegraph/hugegraph/commit/445a2bffa4198f7f0395d8f3fe04c6b820ffbc0d", "committedDate": "2020-11-02T10:42:09Z", "message": "Let lz4 decompress in thread pool\n\nChange-Id: Idf2e796739fda1dc5ce5ffcfa16bc61b6e1a6281"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIxNTkyMjI3", "url": "https://github.com/hugegraph/hugegraph/pull/1237#pullrequestreview-521592227", "createdAt": "2020-11-02T12:41:40Z", "commit": {"oid": "445a2bffa4198f7f0395d8f3fe04c6b820ffbc0d"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQxMjo0MTo0MVrOHsCv7Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQxMjo0Mjo0MVrOHsCx-Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTk0NDQyOQ==", "bodyText": "prefer to define a var", "url": "https://github.com/hugegraph/hugegraph/pull/1237#discussion_r515944429", "createdAt": "2020-11-02T12:41:41Z", "author": {"login": "javeme"}, "path": "hugegraph-core/src/main/java/com/baidu/hugegraph/backend/store/raft/RaftNode.java", "diffHunk": "@@ -230,7 +230,8 @@ private void waitIfBusy() {\n             if (this.busyCounter.get() > 0) {\n                 synchronized (this) {\n                     if (this.busyCounter.get() > 0) {\n-                        this.busyCounter.decrementAndGet();\n+                        LOG.info(\"Decrease busy counter: [{}]\",\n+                                 this.busyCounter.decrementAndGet());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "445a2bffa4198f7f0395d8f3fe04c6b820ffbc0d"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTk0NDk1Mw==", "bodyText": "prefer isRpcTimeout", "url": "https://github.com/hugegraph/hugegraph/pull/1237#discussion_r515944953", "createdAt": "2020-11-02T12:42:41Z", "author": {"login": "javeme"}, "path": "hugegraph-core/src/main/java/com/baidu/hugegraph/backend/store/raft/RaftNode.java", "diffHunk": "@@ -278,6 +279,16 @@ private boolean isWriteBufferOverflow(Status status) {\n                    status.getErrorMsg().contains(expectMsg);\n         }\n \n+        /**\n+         * Maybe useful in the future\n+         */\n+        private boolean isRPCTimeout(Status status) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "445a2bffa4198f7f0395d8f3fe04c6b820ffbc0d"}, "originalPosition": 42}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f3ac5449f94d07b7081cdd50dcd132b6e7c152d4", "author": {"user": {"login": "Linary", "name": "Linary"}}, "url": "https://github.com/hugegraph/hugegraph/commit/f3ac5449f94d07b7081cdd50dcd132b6e7c152d4", "committedDate": "2020-11-03T02:50:06Z", "message": "tiny improve\n\nChange-Id: I4b4c470228caa4ba7e44df9618a7aa1f35da06ef"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIyMTYyNjQ1", "url": "https://github.com/hugegraph/hugegraph/pull/1237#pullrequestreview-522162645", "createdAt": "2020-11-03T02:53:28Z", "commit": {"oid": "f3ac5449f94d07b7081cdd50dcd132b6e7c152d4"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wM1QwMjo1MzoyOVrOHseukA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wM1QwMjo1Mzo0OFrOHseu1Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjQwMjgzMg==", "bodyText": "ditto", "url": "https://github.com/hugegraph/hugegraph/pull/1237#discussion_r516402832", "createdAt": "2020-11-03T02:53:29Z", "author": {"login": "zhoney"}, "path": "hugegraph-core/src/main/java/com/baidu/hugegraph/config/CoreOptions.java", "diffHunk": "@@ -249,6 +249,22 @@ public static synchronized CoreOptions instance() {\n                     60000\n             );\n \n+    public static final ConfigOption<Integer> RAFT_RPC_BUF_LOW_WATER_MARK =\n+            new ConfigOption<>(\n+                    \"raft.rpc_buf_low_water_mark\",\n+                    \"\",\n+                    positiveInt(),\n+                    10 * 1024 * 1024\n+            );\n+\n+    public static final ConfigOption<Integer> RAFT_RPC_BUF_HIGH_WATER_MARK =\n+            new ConfigOption<>(\n+                    \"raft.rpc_buf_high_water_mark\",\n+                    \"\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f3ac5449f94d07b7081cdd50dcd132b6e7c152d4"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjQwMjkwMQ==", "bodyText": "prefer write some description", "url": "https://github.com/hugegraph/hugegraph/pull/1237#discussion_r516402901", "createdAt": "2020-11-03T02:53:48Z", "author": {"login": "zhoney"}, "path": "hugegraph-core/src/main/java/com/baidu/hugegraph/config/CoreOptions.java", "diffHunk": "@@ -249,6 +249,22 @@ public static synchronized CoreOptions instance() {\n                     60000\n             );\n \n+    public static final ConfigOption<Integer> RAFT_RPC_BUF_LOW_WATER_MARK =\n+            new ConfigOption<>(\n+                    \"raft.rpc_buf_low_water_mark\",\n+                    \"\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f3ac5449f94d07b7081cdd50dcd132b6e7c152d4"}, "originalPosition": 7}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIyMjA4OTA0", "url": "https://github.com/hugegraph/hugegraph/pull/1237#pullrequestreview-522208904", "createdAt": "2020-11-03T06:13:33Z", "commit": {"oid": "f3ac5449f94d07b7081cdd50dcd132b6e7c152d4"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wM1QwNjoxMzozM1rOHshR-A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wM1QwNjozMzowN1rOHshkVw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjQ0NDY2NA==", "bodyText": "add some comment", "url": "https://github.com/hugegraph/hugegraph/pull/1237#discussion_r516444664", "createdAt": "2020-11-03T06:13:33Z", "author": {"login": "javeme"}, "path": "hugegraph-core/src/main/java/com/baidu/hugegraph/backend/store/raft/RaftSharedContext.java", "diffHunk": "@@ -266,6 +267,9 @@ public void notifyCache(HugeType type, Id id) {\n             eventHub = this.params.graphEventHub();\n         } else if (type.isSchema()) {\n             eventHub = this.params.schemaEventHub();\n+            if (id.number() && id.asLong() < 0) {\n+                return;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f3ac5449f94d07b7081cdd50dcd132b6e7c152d4"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjQ0OTM2Nw==", "bodyText": "need to perform", "url": "https://github.com/hugegraph/hugegraph/pull/1237#discussion_r516449367", "createdAt": "2020-11-03T06:33:07Z", "author": {"login": "javeme"}, "path": "hugegraph-core/src/main/java/com/baidu/hugegraph/util/LZ4Util.java", "diffHunk": "@@ -54,6 +54,10 @@ public static BytesBuffer compress(byte[] bytes, int blockSize,\n         } catch (IOException e) {\n             throw new BackendException(\"Failed to compress\", e);\n         }\n+        /*\n+         * If need perform reading outside the method,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f3ac5449f94d07b7081cdd50dcd132b6e7c152d4"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "408689e38fbb1a40775a382310a14b010c86df3c", "author": {"user": {"login": "Linary", "name": "Linary"}}, "url": "https://github.com/hugegraph/hugegraph/commit/408689e38fbb1a40775a382310a14b010c86df3c", "committedDate": "2020-11-03T08:05:54Z", "message": "some improve\n\nChange-Id: I70c2fcfd92ed923d801394cd6f97b31afa8475d4"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIyMzM2MTA0", "url": "https://github.com/hugegraph/hugegraph/pull/1237#pullrequestreview-522336104", "createdAt": "2020-11-03T09:56:12Z", "commit": {"oid": "408689e38fbb1a40775a382310a14b010c86df3c"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIyMzU0NzAx", "url": "https://github.com/hugegraph/hugegraph/pull/1237#pullrequestreview-522354701", "createdAt": "2020-11-03T10:19:36Z", "commit": {"oid": "408689e38fbb1a40775a382310a14b010c86df3c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wM1QxMDoxOTozNlrOHsoO5w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wM1QxMDoxOTozNlrOHsoO5w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjU1ODU2Nw==", "bodyText": "move to remove() method", "url": "https://github.com/hugegraph/hugegraph/pull/1237#discussion_r516558567", "createdAt": "2020-11-03T10:19:36Z", "author": {"login": "javeme"}, "path": "hugegraph-core/src/main/java/com/baidu/hugegraph/backend/cache/CachedSchemaTransaction.java", "diffHunk": "@@ -107,7 +107,9 @@ private void listenChanges() {\n             if (\"invalid\".equals(args[0])) {\n                 HugeType type = (HugeType) args[1];\n                 Id id = (Id) args[2];\n-                this.arrayCaches.remove(type, id);\n+                if (id.number() && id.asLong() > 0) {\n+                    this.arrayCaches.remove(type, id);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "408689e38fbb1a40775a382310a14b010c86df3c"}, "originalPosition": 6}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d1189c7c08d190dd2ac3e272974b7b5bc3a0d3fd", "author": {"user": {"login": "Linary", "name": "Linary"}}, "url": "https://github.com/hugegraph/hugegraph/commit/d1189c7c08d190dd2ac3e272974b7b5bc3a0d3fd", "committedDate": "2020-11-04T02:08:35Z", "message": "tiny improve\n\nChange-Id: I8008c86b8e7c92d72dac205eca8894826a39edb8"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "da6a0bdd2ed8da16fb5bb1ac87742f2134d2333c", "author": {"user": {"login": "Linary", "name": "Linary"}}, "url": "https://github.com/hugegraph/hugegraph/commit/da6a0bdd2ed8da16fb5bb1ac87742f2134d2333c", "committedDate": "2020-11-03T13:03:36Z", "message": "tiny improve\n\nChange-Id: I8008c86b8e7c92d72dac205eca8894826a39edb8"}, "afterCommit": {"oid": "d1189c7c08d190dd2ac3e272974b7b5bc3a0d3fd", "author": {"user": {"login": "Linary", "name": "Linary"}}, "url": "https://github.com/hugegraph/hugegraph/commit/d1189c7c08d190dd2ac3e272974b7b5bc3a0d3fd", "committedDate": "2020-11-04T02:08:35Z", "message": "tiny improve\n\nChange-Id: I8008c86b8e7c92d72dac205eca8894826a39edb8"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIzMDU5NjAy", "url": "https://github.com/hugegraph/hugegraph/pull/1237#pullrequestreview-523059602", "createdAt": "2020-11-04T05:52:21Z", "commit": {"oid": "d1189c7c08d190dd2ac3e272974b7b5bc3a0d3fd"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIzMTA0MTgw", "url": "https://github.com/hugegraph/hugegraph/pull/1237#pullrequestreview-523104180", "createdAt": "2020-11-04T07:41:42Z", "commit": {"oid": "d1189c7c08d190dd2ac3e272974b7b5bc3a0d3fd"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNFQwNzo0MTo0MlrOHtMJRQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNFQwNzo0MjowNlrOHtMJ_w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzE0Njk0OQ==", "bodyText": "define var longId=id.asLong()", "url": "https://github.com/hugegraph/hugegraph/pull/1237#discussion_r517146949", "createdAt": "2020-11-04T07:41:42Z", "author": {"login": "javeme"}, "path": "hugegraph-core/src/main/java/com/baidu/hugegraph/backend/cache/CachedSchemaTransaction.java", "diffHunk": "@@ -322,13 +320,16 @@ public void updateIfNeeded(V schema) {\n                 return;\n             }\n             Id id = schema.id();\n-            if (id.number() && id.asLong() > 0) {\n+            if (id.number() && id.asLong() > 0L) {\n                 this.set(schema.type(), id, schema);\n             }\n         }\n \n         public V get(HugeType type, Id id) {\n-            assert id.number() && id.asLong() > 0 : id;\n+            assert id.number();\n+            if (id.asLong() <= 0L) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d1189c7c08d190dd2ac3e272974b7b5bc3a0d3fd"}, "originalPosition": 33}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzE0NzA3NQ==", "bodyText": "ditto", "url": "https://github.com/hugegraph/hugegraph/pull/1237#discussion_r517147075", "createdAt": "2020-11-04T07:41:59Z", "author": {"login": "javeme"}, "path": "hugegraph-core/src/main/java/com/baidu/hugegraph/backend/cache/CachedSchemaTransaction.java", "diffHunk": "@@ -348,7 +349,10 @@ public V get(HugeType type, Id id) {\n         }\n \n         public void set(HugeType type, Id id, V value) {\n-            assert id.number() && id.asLong() > 0 : id;\n+            assert id.number();\n+            if (id.asLong() <= 0L) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d1189c7c08d190dd2ac3e272974b7b5bc3a0d3fd"}, "originalPosition": 45}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzE0NzEzNQ==", "bodyText": "ditto", "url": "https://github.com/hugegraph/hugegraph/pull/1237#discussion_r517147135", "createdAt": "2020-11-04T07:42:06Z", "author": {"login": "javeme"}, "path": "hugegraph-core/src/main/java/com/baidu/hugegraph/backend/cache/CachedSchemaTransaction.java", "diffHunk": "@@ -373,7 +377,10 @@ public void set(HugeType type, Id id, V value) {\n         }\n \n         public void remove(HugeType type, Id id) {\n-            assert id.number() && id.asLong() > 0 : id;\n+            assert id.number();\n+            if (id.asLong() <= 0L) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d1189c7c08d190dd2ac3e272974b7b5bc3a0d3fd"}, "originalPosition": 57}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "25f7e50527147084630082bfb6abf80bb902116a", "author": {"user": {"login": "Linary", "name": "Linary"}}, "url": "https://github.com/hugegraph/hugegraph/commit/25f7e50527147084630082bfb6abf80bb902116a", "committedDate": "2020-11-04T08:32:46Z", "message": "use whitebox to set LOW_WATER_MARK and HIGH_WATER_MARK\n\nChange-Id: Ia15672c9e0564cb9673a0b8ab983272c3943c276"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIzMTM5MTI5", "url": "https://github.com/hugegraph/hugegraph/pull/1237#pullrequestreview-523139129", "createdAt": "2020-11-04T08:36:19Z", "commit": {"oid": "d1189c7c08d190dd2ac3e272974b7b5bc3a0d3fd"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNFQwODozNjoyMFrOHtNzkA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNFQwODozNjoyMFrOHtNzkA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzE3NDE2MA==", "bodyText": "add assert false : id;", "url": "https://github.com/hugegraph/hugegraph/pull/1237#discussion_r517174160", "createdAt": "2020-11-04T08:36:20Z", "author": {"login": "javeme"}, "path": "hugegraph-core/src/main/java/com/baidu/hugegraph/backend/cache/CachedSchemaTransaction.java", "diffHunk": "@@ -348,7 +349,10 @@ public V get(HugeType type, Id id) {\n         }\n \n         public void set(HugeType type, Id id, V value) {\n-            assert id.number() && id.asLong() > 0 : id;\n+            assert id.number();\n+            if (id.asLong() <= 0L) {\n+                return;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d1189c7c08d190dd2ac3e272974b7b5bc3a0d3fd"}, "originalPosition": 46}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ec8cb4db87eebd614de627cc5d9ef19c703699cd", "author": {"user": {"login": "Linary", "name": "Linary"}}, "url": "https://github.com/hugegraph/hugegraph/commit/ec8cb4db87eebd614de627cc5d9ef19c703699cd", "committedDate": "2020-11-04T08:42:07Z", "message": "tiny improve\n\nChange-Id: I4d7a90c5e40117e00c1e017917ac5d83824df3ce"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "21178e0f5e120b278f95a0d126a723d3b5a72efd", "author": {"user": {"login": "Linary", "name": "Linary"}}, "url": "https://github.com/hugegraph/hugegraph/commit/21178e0f5e120b278f95a0d126a723d3b5a72efd", "committedDate": "2020-11-04T08:51:23Z", "message": "tiny improve\n\nChange-Id: Ic7770f0b8cb9a81dbb714ea9ce8ef99d5b710807"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIzMTc1OTk1", "url": "https://github.com/hugegraph/hugegraph/pull/1237#pullrequestreview-523175995", "createdAt": "2020-11-04T09:23:51Z", "commit": {"oid": "21178e0f5e120b278f95a0d126a723d3b5a72efd"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIzMjQwNTQ1", "url": "https://github.com/hugegraph/hugegraph/pull/1237#pullrequestreview-523240545", "createdAt": "2020-11-04T10:42:23Z", "commit": {"oid": "21178e0f5e120b278f95a0d126a723d3b5a72efd"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2310, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}