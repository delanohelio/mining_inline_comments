{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg3MjAyMzYy", "number": 892, "title": "allow system async task in gremlin context", "bodyText": "Change-Id: I5ec9e09ea366ff32b6460ff138d8412065da2ca4\nfix:\n2020-03-12 10:41:27 65011 [gremlin-server-exec-4] [WARN ] com.baidu.hugegraph.security.HugeSecurityManager [] - SecurityException: Not allowed to access thread group via Gremlin\n2020-03-12 10:41:27 65012 [gremlin-server-exec-4] [WARN ] org.apache.tinkerpop.gremlin.server.handler.HttpGremlinEndpointHandler [] - Invalid request - responding with 500 Internal Server Error and Not allowed to access thread group via Gremlin\njava.lang.SecurityException: Not allowed to access thread group via Gremlin\n    at com.baidu.hugegraph.security.HugeSecurityManager.newSecurityException(HugeSecurityManager.java:357) ~[classes/:?]\n    at com.baidu.hugegraph.security.HugeSecurityManager.checkAccess(HugeSecurityManager.java:136) ~[classes/:?]\n    at java.lang.ThreadGroup.checkAccess(ThreadGroup.java:315) ~[?:1.8.0_121]\n    at java.lang.Thread.init(Thread.java:391) ~[?:1.8.0_121]\n    at java.lang.Thread.init(Thread.java:349) ~[?:1.8.0_121]\n    at java.lang.Thread.<init>(Thread.java:675) ~[?:1.8.0_121]\n    at java.util.concurrent.Executors$DefaultThreadFactory.newThread(Executors.java:613) ~[?:1.8.0_121]\n    at org.apache.commons.lang3.concurrent.BasicThreadFactory.newThread(BasicThreadFactory.java:206) ~[commons-lang3-3.8.1.jar:3.8.1]\n    at java.util.concurrent.ThreadPoolExecutor$Worker.<init>(ThreadPoolExecutor.java:612) ~[?:1.8.0_121]\n    at java.util.concurrent.ThreadPoolExecutor.addWorker(ThreadPoolExecutor.java:925) ~[?:1.8.0_121]\n    at java.util.concurrent.ThreadPoolExecutor.execute(ThreadPoolExecutor.java:1357) ~[?:1.8.0_121]\n    at java.util.concurrent.AbstractExecutorService.submit(AbstractExecutorService.java:112) ~[?:1.8.0_121]\n    at com.baidu.hugegraph.task.TaskScheduler.submitTask(TaskScheduler.java:190) ~[classes/:?]\n    at com.baidu.hugegraph.task.TaskScheduler.schedule(TaskScheduler.java:180) ~[classes/:?]\n    at com.baidu.hugegraph.job.JobBuilder.schedule(JobBuilder.java:85) ~[classes/:?]\n    at com.baidu.hugegraph.backend.tx.SchemaTransaction.asyncRun(SchemaTransaction.java:475) ~[classes/:?]\n    at com.baidu.hugegraph.backend.tx.SchemaTransaction.rebuildIndex(SchemaTransaction.java:255) ~[classes/:?]\n    at com.baidu.hugegraph.schema.builder.IndexLabelBuilder.createWithTask(IndexLabelBuilder.java:143) ~[classes/:?]\n    at com.baidu.hugegraph.schema.builder.IndexLabelBuilder.create(IndexLabelBuilder.java:155) ~[classes/:?]\n    at com.baidu.hugegraph.schema.builder.IndexLabelBuilder.create(IndexLabelBuilder.java:55) ~[classes/:?]\n    at com.baidu.hugegraph.schema.builder.SchemaBuilder$create.call(Unknown Source) ~[?:?]\n    at org.codehaus.groovy.runtime.callsite.CallSiteArray.defaultCall(CallSiteArray.java:47) ~[groovy-2.5.7-indy.jar:2.5.7]\n    at org.codehaus.groovy.runtime.callsite.AbstractCallSite.call(AbstractCallSite.java:115) ~[groovy-2.5.7-indy.jar:2.5.7]\n    at org.codehaus.groovy.runtime.callsite.AbstractCallSite.call(AbstractCallSite.java:119) ~[groovy-2.5.7-indy.jar:2.5.7]\n    at Script5.run(Script5.groovy:1) ~[?:?]\n    at org.apache.tinkerpop.gremlin.groovy.jsr223.GremlinGroovyScriptEngine.eval(GremlinGroovyScriptEngine.java:674) ~[gremlin-groovy-3.4.3.jar:3.4.3]\n    at org.apache.tinkerpop.gremlin.groovy.jsr223.GremlinGroovyScriptEngine.eval(GremlinGroovyScriptEngine.java:376) ~[gremlin-groovy-3.4.3.jar:3.4.3]\n    at javax.script.AbstractScriptEngine.eval(AbstractScriptEngine.java:233) ~[?:1.8.0_121]\n    at org.apache.tinkerpop.gremlin.groovy.engine.GremlinExecutor.lambda$eval$0(GremlinExecutor.java:266) ~[gremlin-groovy-3.4.3.jar:3.4.3]\n    at java.util.concurrent.FutureTask.run(FutureTask.java:266) [?:1.8.0_121]\n    at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511) [?:1.8.0_121]\n    at java.util.concurrent.FutureTask.run(FutureTask.java:266) [?:1.8.0_121]\n    at com.baidu.hugegraph.auth.HugeGraphAuthProxy$ContextTask.run(HugeGraphAuthProxy.java:282) [classes/:?]\n    at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142) [?:1.8.0_121]\n    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617) [?:1.8.0_121]\n    at java.lang.Thread.run(Thread.java:745) [?:1.8.0_121]", "createdAt": "2020-03-12T11:59:46Z", "url": "https://github.com/hugegraph/hugegraph/pull/892", "merged": true, "mergeCommit": {"oid": "44c555dd1d6e5069a6b7400f5191093eacf84515"}, "closed": true, "closedAt": "2020-03-13T04:28:20Z", "author": {"login": "zhoney"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcM6caVAH2gAyMzg3MjAyMzYyOmI0MTlhYzczMTQwZjFmOGQzZTNmNzhhMjE3M2UzMjBmN2MzN2Y5NTI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcM8BswAFqTM3MzU3MDIyMQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "b419ac73140f1f8d3e3f78a2173e320f7c37f952", "author": {"user": {"login": "zhoney", "name": null}}, "url": "https://github.com/hugegraph/hugegraph/commit/b419ac73140f1f8d3e3f78a2173e320f7c37f952", "committedDate": "2020-03-12T11:58:42Z", "message": "allow system async task in gremlin context\n\nChange-Id: I5ec9e09ea366ff32b6460ff138d8412065da2ca4"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzczNTUxNzI0", "url": "https://github.com/hugegraph/hugegraph/pull/892#pullrequestreview-373551724", "createdAt": "2020-03-12T13:26:21Z", "commit": {"oid": "b419ac73140f1f8d3e3f78a2173e320f7c37f952"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMlQxMzoyNjoyMlrOF1efEg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMlQxMzoyNjoyMlrOF1efEg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTYxODMyMg==", "bodyText": "put rebuildIndex to the fourth param", "url": "https://github.com/hugegraph/hugegraph/pull/892#discussion_r391618322", "createdAt": "2020-03-12T13:26:22Z", "author": {"login": "javeme"}, "path": "hugegraph-core/src/main/java/com/baidu/hugegraph/security/HugeSecurityManager.java", "diffHunk": "@@ -64,6 +64,14 @@\n             \"file.encoding\" // PostgreSQL\n     );\n \n+    private static final Map<String, Set<String>> ASYNC_TASKS = ImmutableMap.of(\n+            \"com.baidu.hugegraph.backend.tx.SchemaTransaction\",\n+            ImmutableSet.of(\"rebuildIndex\", \"removeVertexLabel\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b419ac73140f1f8d3e3f78a2173e320f7c37f952"}, "originalPosition": 6}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "54ac303ca9ec4fe407c581d109fea92402a60391", "author": {"user": {"login": "zhoney", "name": null}}, "url": "https://github.com/hugegraph/hugegraph/commit/54ac303ca9ec4fe407c581d109fea92402a60391", "committedDate": "2020-03-12T13:36:25Z", "message": "tiny improve\n\nChange-Id: I6752230058bbcf4c8e8c76f4ba953ad1d6a90df7"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzczNTYyMjM5", "url": "https://github.com/hugegraph/hugegraph/pull/892#pullrequestreview-373562239", "createdAt": "2020-03-12T13:39:35Z", "commit": {"oid": "54ac303ca9ec4fe407c581d109fea92402a60391"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzczNTcwMjIx", "url": "https://github.com/hugegraph/hugegraph/pull/892#pullrequestreview-373570221", "createdAt": "2020-03-12T13:49:20Z", "commit": {"oid": "54ac303ca9ec4fe407c581d109fea92402a60391"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2402, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}