{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDc1ODc1MzUw", "number": 1158, "title": "Add rate_limit.read to limit query rate", "bodyText": "Change-Id: I6d620270937e425b417cbaaedd1d67dfb058791f", "createdAt": "2020-08-30T07:23:38Z", "url": "https://github.com/hugegraph/hugegraph/pull/1158", "merged": true, "mergeCommit": {"oid": "9babdae84a85b5062680a824901d939fb845f5e5"}, "closed": true, "closedAt": "2020-09-02T17:17:27Z", "author": {"login": "Linary"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdD5HRCAFqTQ3ODE3ODk2OQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdE_SBPAFqTQ4MTAzNTk5NQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc4MTc4OTY5", "url": "https://github.com/hugegraph/hugegraph/pull/1158#pullrequestreview-478178969", "createdAt": "2020-08-30T07:31:08Z", "commit": {"oid": "1f8a36fb02d4969393117efb13f7ab141c8138bc"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0zMFQwNzozMTowOFrOHJgqBw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0zMFQwNzozMTowOFrOHJgqBw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTczNDI3OQ==", "bodyText": "execute query of vertices/edges.", "url": "https://github.com/hugegraph/hugegraph/pull/1158#discussion_r479734279", "createdAt": "2020-08-30T07:31:08Z", "author": {"login": "javeme"}, "path": "hugegraph-core/src/main/java/com/baidu/hugegraph/config/CoreOptions.java", "diffHunk": "@@ -182,14 +182,22 @@ public static synchronized CoreOptions instance() {\n                     8\n             );\n \n-    public static final ConfigOption<Integer> RATE_LIMIT =\n+    public static final ConfigOption<Integer> RATE_LIMIT_WRITE =\n             new ConfigOption<>(\n-                    \"rate_limit\",\n+                    \"rate_limit.write\",\n                     \"The max rate(items/s) to add/update/delete vertices/edges.\",\n                     rangeInt(0, Integer.MAX_VALUE),\n                     0\n             );\n \n+    public static final ConfigOption<Integer> RATE_LIMIT_READ =\n+            new ConfigOption<>(\n+                    \"rate_limit.read\",\n+                    \"The max rate(times/s) to execute query.\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1f8a36fb02d4969393117efb13f7ab141c8138bc"}, "originalPosition": 17}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc4MTgzMjIz", "url": "https://github.com/hugegraph/hugegraph/pull/1158#pullrequestreview-478183223", "createdAt": "2020-08-30T08:37:26Z", "commit": {"oid": "1f8a36fb02d4969393117efb13f7ab141c8138bc"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d281a79545a3ceafa2d08171fd2eac44d562232b", "author": {"user": {"login": "Linary", "name": "Linary"}}, "url": "https://github.com/hugegraph/hugegraph/commit/d281a79545a3ceafa2d08171fd2eac44d562232b", "committedDate": "2020-08-30T10:15:27Z", "message": "Add read rate limiter to limit query rate on vertices/edges\n\nChange-Id: I6d620270937e425b417cbaaedd1d67dfb058791f"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "1f8a36fb02d4969393117efb13f7ab141c8138bc", "author": {"user": {"login": "Linary", "name": "Linary"}}, "url": "https://github.com/hugegraph/hugegraph/commit/1f8a36fb02d4969393117efb13f7ab141c8138bc", "committedDate": "2020-08-30T07:22:11Z", "message": "Add rate_limit.read to limit query rate\n\nChange-Id: I6d620270937e425b417cbaaedd1d67dfb058791f"}, "afterCommit": {"oid": "d281a79545a3ceafa2d08171fd2eac44d562232b", "author": {"user": {"login": "Linary", "name": "Linary"}}, "url": "https://github.com/hugegraph/hugegraph/commit/d281a79545a3ceafa2d08171fd2eac44d562232b", "committedDate": "2020-08-30T10:15:27Z", "message": "Add read rate limiter to limit query rate on vertices/edges\n\nChange-Id: I6d620270937e425b417cbaaedd1d67dfb058791f"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc4NTc3NjI0", "url": "https://github.com/hugegraph/hugegraph/pull/1158#pullrequestreview-478577624", "createdAt": "2020-08-31T12:39:48Z", "commit": {"oid": "d281a79545a3ceafa2d08171fd2eac44d562232b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0zMVQxMjozOTo0OFrOHJ3HVg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0zMVQxMjozOTo0OFrOHJ3HVg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDEwMjIzMA==", "bodyText": "what is the behavior if it is interrupted", "url": "https://github.com/hugegraph/hugegraph/pull/1158#discussion_r480102230", "createdAt": "2020-08-31T12:39:48Z", "author": {"login": "javeme"}, "path": "hugegraph-core/src/main/java/com/baidu/hugegraph/backend/tx/AbstractTransaction.java", "diffHunk": "@@ -150,6 +150,15 @@ public Number queryNumber(Query query) {\n \n         Query squery = this.serializer.writeQuery(query);\n \n+        // Do rate limit if needed\n+        RateLimiter rateLimiter = this.graph.readRateLimiter();\n+        if (rateLimiter != null && query.resultType().isGraph()) {\n+            double time = rateLimiter.acquire(1);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d281a79545a3ceafa2d08171fd2eac44d562232b"}, "originalPosition": 7}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9516a40f695653c7a242fff49acce55790ff96a0", "author": {"user": {"login": "Linary", "name": "Linary"}}, "url": "https://github.com/hugegraph/hugegraph/commit/9516a40f695653c7a242fff49acce55790ff96a0", "committedDate": "2020-08-31T14:00:04Z", "message": "add checkInterrupted() after rate limit\n\nChange-Id: I035515137dba4c9314bbf66fb7e4c13f79ab448b"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgwOTkwODY3", "url": "https://github.com/hugegraph/hugegraph/pull/1158#pullrequestreview-480990867", "createdAt": "2020-09-02T16:22:52Z", "commit": {"oid": "9516a40f695653c7a242fff49acce55790ff96a0"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgxMDM1OTk1", "url": "https://github.com/hugegraph/hugegraph/pull/1158#pullrequestreview-481035995", "createdAt": "2020-09-02T17:16:38Z", "commit": {"oid": "9516a40f695653c7a242fff49acce55790ff96a0"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2274, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}