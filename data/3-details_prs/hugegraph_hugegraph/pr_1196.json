{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDk0MTAzNzQ1", "number": 1196, "title": "use lz4 instead of gzip for StringEncoding compress/decompress", "bodyText": "", "createdAt": "2020-09-28T12:22:02Z", "url": "https://github.com/hugegraph/hugegraph/pull/1196", "merged": true, "mergeCommit": {"oid": "0e4eaa0b8675d5bcd1708813ecb4879513673512"}, "closed": true, "closedAt": "2020-10-26T10:58:38Z", "author": {"login": "zhoney"}, "timelineItems": {"totalCount": 21, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdNSqq8gH2gAyNDk0MTAzNzQ1OmYwMGY1NDdjZDI0MzJmZTg4MGMyZWY5MWY3NWIzMTBiY2RiMDk4ZWQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdWRXW0AFqTUxNjYxOTAxMQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "f00f547cd2432fe880c2ef91f75b310bcdb098ed", "author": {"user": {"login": "zhoney", "name": null}}, "url": "https://github.com/hugegraph/hugegraph/commit/f00f547cd2432fe880c2ef91f75b310bcdb098ed", "committedDate": "2020-09-28T12:23:09Z", "message": "use lz4 instead of gzip for StringEncoding compress/decompress\n\nChange-Id: Ie4458ba481ac3625139458cc92e9dbc0631898da"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f4de8489c9b9e60195d64b033d4053cb7b37b9bd", "author": {"user": {"login": "zhoney", "name": null}}, "url": "https://github.com/hugegraph/hugegraph/commit/f4de8489c9b9e60195d64b033d4053cb7b37b9bd", "committedDate": "2020-09-28T12:05:46Z", "message": "use lz4 instead of gzip for StringEncoding compress/decompress\n\nChange-Id: Ie4458ba481ac3625139458cc92e9dbc0631898da"}, "afterCommit": {"oid": "f00f547cd2432fe880c2ef91f75b310bcdb098ed", "author": {"user": {"login": "zhoney", "name": null}}, "url": "https://github.com/hugegraph/hugegraph/commit/f00f547cd2432fe880c2ef91f75b310bcdb098ed", "committedDate": "2020-09-28T12:23:09Z", "message": "use lz4 instead of gzip for StringEncoding compress/decompress\n\nChange-Id: Ie4458ba481ac3625139458cc92e9dbc0631898da"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0910c1c30c9618ad3245391ac00e00539888ad51", "author": {"user": {"login": "zhoney", "name": null}}, "url": "https://github.com/hugegraph/hugegraph/commit/0910c1c30c9618ad3245391ac00e00539888ad51", "committedDate": "2020-09-28T13:22:27Z", "message": "improve\n\nChange-Id: I39cbfe2f643b46ca736e5076ef73ec6203b0be3a"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk4MTExNTQ1", "url": "https://github.com/hugegraph/hugegraph/pull/1196#pullrequestreview-498111545", "createdAt": "2020-09-29T05:44:35Z", "commit": {"oid": "f00f547cd2432fe880c2ef91f75b310bcdb098ed"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQwNTo0NDozNVrOHZbwgA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQwNTo1NjoxN1rOHZb-aA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjQzMTIzMg==", "bodyText": "to avoid copy bytes, add method decode(bytes, offset, length), and let BytesBuffer implements OutputStream that  BytesBuffer instance could be pass into LZ4BlockOutputStream.", "url": "https://github.com/hugegraph/hugegraph/pull/1196#discussion_r496431232", "createdAt": "2020-09-29T05:44:35Z", "author": {"login": "javeme"}, "path": "hugegraph-core/src/main/java/com/baidu/hugegraph/util/StringEncoding.java", "diffHunk": "@@ -156,14 +153,13 @@ public static String encodeBase64(byte[] bytes) {\n \n     public static String decompress(byte[] value) {\n         BytesBuffer buf = BytesBuffer.allocate(value.length * 2);\n-        try (ByteArrayInputStream bis = new ByteArrayInputStream(value);\n-             GZIPInputStream in = new GZIPInputStream(bis)) {\n+        try (ByteArrayInputStream bis = new ByteArrayInputStream(value)) {\n             byte[] bytes = new byte[value.length];\n             int len;\n-            while ((len = in.read(bytes)) > 0) {\n+            while ((len = bis.read(bytes)) > 0) {\n                 buf.write(bytes, 0, len);\n             }\n-            return decode(buf.bytes());\n+            return decode(LZ4Util.decompress(buf.bytes(), BLOCK_SIZE).array());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f00f547cd2432fe880c2ef91f75b310bcdb098ed"}, "originalPosition": 47}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjQzNDMzNg==", "bodyText": "no need to write a buf, just LZ4Util.decompress(value)", "url": "https://github.com/hugegraph/hugegraph/pull/1196#discussion_r496434336", "createdAt": "2020-09-29T05:54:54Z", "author": {"login": "javeme"}, "path": "hugegraph-core/src/main/java/com/baidu/hugegraph/util/StringEncoding.java", "diffHunk": "@@ -156,14 +153,13 @@ public static String encodeBase64(byte[] bytes) {\n \n     public static String decompress(byte[] value) {\n         BytesBuffer buf = BytesBuffer.allocate(value.length * 2);\n-        try (ByteArrayInputStream bis = new ByteArrayInputStream(value);\n-             GZIPInputStream in = new GZIPInputStream(bis)) {\n+        try (ByteArrayInputStream bis = new ByteArrayInputStream(value)) {\n             byte[] bytes = new byte[value.length];\n             int len;\n-            while ((len = in.read(bytes)) > 0) {\n+            while ((len = bis.read(bytes)) > 0) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f00f547cd2432fe880c2ef91f75b310bcdb098ed"}, "originalPosition": 43}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjQzNDc5Mg==", "bodyText": "just return LZ4Util.compress(bytes, BLOCK_SIZE).bytes()", "url": "https://github.com/hugegraph/hugegraph/pull/1196#discussion_r496434792", "createdAt": "2020-09-29T05:56:17Z", "author": {"login": "javeme"}, "path": "hugegraph-core/src/main/java/com/baidu/hugegraph/util/StringEncoding.java", "diffHunk": "@@ -142,12 +141,10 @@ public static String encodeBase64(byte[] bytes) {\n \n     public static byte[] compress(String value) {\n         final int outputSize = Math.max(32, value.length() / 8);\n-        final int gzipBufSize = 4 * (int) Bytes.KB;\n-        try (ByteArrayOutputStream bos = new ByteArrayOutputStream(outputSize);\n-             GZIPOutputStream out = new GZIPOutputStream(bos, gzipBufSize)) {\n+        try (ByteArrayOutputStream bos = new ByteArrayOutputStream(outputSize)) {\n             byte[] bytes = encode(value);\n-            out.write(bytes);\n-            out.finish();\n+            bytes = LZ4Util.compress(bytes, BLOCK_SIZE).array();\n+            bos.write(bytes);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f00f547cd2432fe880c2ef91f75b310bcdb098ed"}, "originalPosition": 29}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5b2b44ce3a89794673023f0a88c538d49b5a45dc", "author": {"user": {"login": "zhoney", "name": null}}, "url": "https://github.com/hugegraph/hugegraph/commit/5b2b44ce3a89794673023f0a88c538d49b5a45dc", "committedDate": "2020-09-29T07:37:00Z", "message": "improve\n\nChange-Id: I408bc15c3be531239c92b3da1d75af192a532347"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk4Mjk0MjM3", "url": "https://github.com/hugegraph/hugegraph/pull/1196#pullrequestreview-498294237", "createdAt": "2020-09-29T09:44:04Z", "commit": {"oid": "5b2b44ce3a89794673023f0a88c538d49b5a45dc"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQwOTo0NDowNFrOHZlEfQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQwOTo0ODo1N1rOHZlQrA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjU4MzgwNQ==", "bodyText": "keep origin", "url": "https://github.com/hugegraph/hugegraph/pull/1196#discussion_r496583805", "createdAt": "2020-09-29T09:44:04Z", "author": {"login": "javeme"}, "path": "hugegraph-test/src/main/resources/hugegraph.properties", "diffHunk": "@@ -1,7 +1,7 @@\n gremlin.graph=com.baidu.hugegraph.HugeFactory\n \n-backend=${backend}\n-serializer=${serializer}\n+backend=rocksdb\n+serializer=binary", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5b2b44ce3a89794673023f0a88c538d49b5a45dc"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjU4NjkyNA==", "bodyText": "address it:\nuse BytesBuffer instead of ByteArrayOutputStream in compress and decompress method, and init  BytesBuffer estimate size", "url": "https://github.com/hugegraph/hugegraph/pull/1196#discussion_r496586924", "createdAt": "2020-09-29T09:48:57Z", "author": {"login": "javeme"}, "path": "hugegraph-core/src/main/java/com/baidu/hugegraph/util/StringEncoding.java", "diffHunk": "@@ -156,14 +153,13 @@ public static String encodeBase64(byte[] bytes) {\n \n     public static String decompress(byte[] value) {\n         BytesBuffer buf = BytesBuffer.allocate(value.length * 2);\n-        try (ByteArrayInputStream bis = new ByteArrayInputStream(value);\n-             GZIPInputStream in = new GZIPInputStream(bis)) {\n+        try (ByteArrayInputStream bis = new ByteArrayInputStream(value)) {\n             byte[] bytes = new byte[value.length];\n             int len;\n-            while ((len = in.read(bytes)) > 0) {\n+            while ((len = bis.read(bytes)) > 0) {\n                 buf.write(bytes, 0, len);\n             }\n-            return decode(buf.bytes());\n+            return decode(LZ4Util.decompress(buf.bytes(), BLOCK_SIZE).array());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjQzMTIzMg=="}, "originalCommit": {"oid": "f00f547cd2432fe880c2ef91f75b310bcdb098ed"}, "originalPosition": 47}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "be7e3ee0ea6d60410d965e0bced14a75ce869b40", "author": {"user": {"login": "zhoney", "name": null}}, "url": "https://github.com/hugegraph/hugegraph/commit/be7e3ee0ea6d60410d965e0bced14a75ce869b40", "committedDate": "2020-09-29T10:38:45Z", "message": "use BytesBuffer improve LZ4Util\n\nChange-Id: I812c0ba5a2abda0d11cb2e7af5ebc00da0c26ef6"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk4MzQxNTc1", "url": "https://github.com/hugegraph/hugegraph/pull/1196#pullrequestreview-498341575", "createdAt": "2020-09-29T10:47:19Z", "commit": {"oid": "be7e3ee0ea6d60410d965e0bced14a75ce869b40"}, "state": "COMMENTED", "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxMDo0NzoyMFrOHZnTOg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxMDo1MTo0NFrOHZncQA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjYyMDM0Ng==", "bodyText": "rename to buf", "url": "https://github.com/hugegraph/hugegraph/pull/1196#discussion_r496620346", "createdAt": "2020-09-29T10:47:20Z", "author": {"login": "javeme"}, "path": "hugegraph-core/src/main/java/com/baidu/hugegraph/util/StringEncoding.java", "diffHunk": "@@ -135,11 +144,13 @@ public static String encodeBase64(byte[] bytes) {\n     }\n \n     public static byte[] compress(String value) {\n-        return LZ4Util.compress(encode(value), BLOCK_SIZE).array();\n+        BytesBuffer bf = LZ4Util.compress(encode(value), BLOCK_SIZE);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "be7e3ee0ea6d60410d965e0bced14a75ce869b40"}, "originalPosition": 28}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjYyMDQxOQ==", "bodyText": "ditto", "url": "https://github.com/hugegraph/hugegraph/pull/1196#discussion_r496620419", "createdAt": "2020-09-29T10:47:28Z", "author": {"login": "javeme"}, "path": "hugegraph-core/src/main/java/com/baidu/hugegraph/util/StringEncoding.java", "diffHunk": "@@ -135,11 +144,13 @@ public static String encodeBase64(byte[] bytes) {\n     }\n \n     public static byte[] compress(String value) {\n-        return LZ4Util.compress(encode(value), BLOCK_SIZE).array();\n+        BytesBuffer bf = LZ4Util.compress(encode(value), BLOCK_SIZE);\n+        return bf.bytes();\n     }\n \n     public static String decompress(byte[] value) {\n-        return decode(LZ4Util.decompress(value, BLOCK_SIZE).array());\n+        BytesBuffer bf = LZ4Util.decompress(value, BLOCK_SIZE);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "be7e3ee0ea6d60410d965e0bced14a75ce869b40"}, "originalPosition": 34}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjYyMDY2Ng==", "bodyText": "rename to buf", "url": "https://github.com/hugegraph/hugegraph/pull/1196#discussion_r496620666", "createdAt": "2020-09-29T10:47:55Z", "author": {"login": "javeme"}, "path": "hugegraph-core/src/main/java/com/baidu/hugegraph/util/LZ4Util.java", "diffHunk": "@@ -37,35 +36,35 @@\n     public static BytesBuffer compress(byte[] bytes, int blockSize) {\n         LZ4Factory factory = LZ4Factory.fastestInstance();\n         LZ4Compressor compressor = factory.fastCompressor();\n-        ByteArrayOutputStream baos = new ByteArrayOutputStream();\n+        BytesBuffer bf = new BytesBuffer(bytes.length / 8);\n         LZ4BlockOutputStream lz4Output = new LZ4BlockOutputStream(\n-                                         baos, blockSize, compressor);\n+                                         bf, blockSize, compressor);\n         try {\n             lz4Output.write(bytes);\n             lz4Output.close();\n         } catch (IOException e) {\n             throw new BackendException(\"Failed to compress\", e);\n         }\n-        return BytesBuffer.wrap(baos.toByteArray());\n+        return bf;\n     }\n \n     public static BytesBuffer decompress(byte[] bytes, int blockSize) {\n         LZ4Factory factory = LZ4Factory.fastestInstance();\n-        LZ4FastDecompressor decompresser = factory.fastDecompressor();\n+        LZ4FastDecompressor decompressor = factory.fastDecompressor();\n         ByteArrayInputStream bais = new ByteArrayInputStream(bytes);\n-        ByteArrayOutputStream baos = new ByteArrayOutputStream(blockSize);\n+        BytesBuffer bf = new BytesBuffer(bytes.length * 8);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "be7e3ee0ea6d60410d965e0bced14a75ce869b40"}, "originalPosition": 33}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjYyMDczNA==", "bodyText": "rename to buf", "url": "https://github.com/hugegraph/hugegraph/pull/1196#discussion_r496620734", "createdAt": "2020-09-29T10:47:59Z", "author": {"login": "javeme"}, "path": "hugegraph-core/src/main/java/com/baidu/hugegraph/util/LZ4Util.java", "diffHunk": "@@ -37,35 +36,35 @@\n     public static BytesBuffer compress(byte[] bytes, int blockSize) {\n         LZ4Factory factory = LZ4Factory.fastestInstance();\n         LZ4Compressor compressor = factory.fastCompressor();\n-        ByteArrayOutputStream baos = new ByteArrayOutputStream();\n+        BytesBuffer bf = new BytesBuffer(bytes.length / 8);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "be7e3ee0ea6d60410d965e0bced14a75ce869b40"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjYyMjY1Ng==", "bodyText": "prefer keep these methods returning void", "url": "https://github.com/hugegraph/hugegraph/pull/1196#discussion_r496622656", "createdAt": "2020-09-29T10:51:44Z", "author": {"login": "javeme"}, "path": "hugegraph-core/src/main/java/com/baidu/hugegraph/backend/serializer/BytesBuffer.java", "diffHunk": "@@ -179,27 +181,32 @@ public BytesBuffer write(byte val) {\n         return this;\n     }\n \n-    public BytesBuffer write(int val) {\n+    @Override\n+    public void write(int b) throws IOException {\n+        this.writeByte(b);\n+    }\n+\n+    public BytesBuffer writeByte(int val) {\n         assert val <= UINT8_MAX;\n         require(BYTE_LEN);\n         this.buffer.put((byte) val);\n         return this;\n     }\n \n-    public BytesBuffer write(byte[] val) {\n+    public BytesBuffer writeByteArray(byte[] val) {\n         require(BYTE_LEN * val.length);\n         this.buffer.put(val);\n         return this;\n     }\n \n-    public BytesBuffer write(byte[] val, int offset, int length) {\n+    public BytesBuffer writeByteArray(byte[] val, int offset, int length) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "be7e3ee0ea6d60410d965e0bced14a75ce869b40"}, "originalPosition": 52}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0019088faf4e46fe543cf4cfee6053edcef47756", "author": {"user": {"login": "zhoney", "name": null}}, "url": "https://github.com/hugegraph/hugegraph/commit/0019088faf4e46fe543cf4cfee6053edcef47756", "committedDate": "2020-09-29T11:05:02Z", "message": "improve\n\nChange-Id: I3bc4db83bdf3d6eed14567a771f25c744d486d44"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk4Mzk1ODYz", "url": "https://github.com/hugegraph/hugegraph/pull/1196#pullrequestreview-498395863", "createdAt": "2020-09-29T12:05:31Z", "commit": {"oid": "0019088faf4e46fe543cf4cfee6053edcef47756"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxMjowNTozMVrOHZp1Xw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxMjowNTozMVrOHZp1Xw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjY2MTg1NQ==", "bodyText": "add \"@OverRide\" for 3 write() methods", "url": "https://github.com/hugegraph/hugegraph/pull/1196#discussion_r496661855", "createdAt": "2020-09-29T12:05:31Z", "author": {"login": "javeme"}, "path": "hugegraph-core/src/main/java/com/baidu/hugegraph/backend/serializer/BytesBuffer.java", "diffHunk": "@@ -179,27 +181,25 @@ public BytesBuffer write(byte val) {\n         return this;\n     }\n \n-    public BytesBuffer write(int val) {\n+    public void write(int val) {\n         assert val <= UINT8_MAX;\n         require(BYTE_LEN);\n         this.buffer.put((byte) val);\n-        return this;\n     }\n \n-    public BytesBuffer write(byte[] val) {\n+    public void write(byte[] val) {\n         require(BYTE_LEN * val.length);\n         this.buffer.put(val);\n-        return this;\n     }\n \n-    public BytesBuffer write(byte[] val, int offset, int length) {\n+    public void write(byte[] val, int offset, int length) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0019088faf4e46fe543cf4cfee6053edcef47756"}, "originalPosition": 47}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "99f44ff40a34d23e336517de8fbfe46e1c404e5f", "author": {"user": {"login": "zhoney", "name": null}}, "url": "https://github.com/hugegraph/hugegraph/commit/99f44ff40a34d23e336517de8fbfe46e1c404e5f", "committedDate": "2020-09-29T12:26:36Z", "message": "improve\n\nChange-Id: Ia3b3b4cff5cb4967815deeb27d0bcd5093d3c75e"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk4NDg0ODkw", "url": "https://github.com/hugegraph/hugegraph/pull/1196#pullrequestreview-498484890", "createdAt": "2020-09-29T13:44:44Z", "commit": {"oid": "99f44ff40a34d23e336517de8fbfe46e1c404e5f"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxMzo0NDo0NFrOHZt7Sw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxMzo0NDo0NFrOHZt7Sw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjcyODkwNw==", "bodyText": "add a const var buf_ratio, let init_size=bytes.length/buf_ratio, also update decompress to bytes.length*buf_ratio", "url": "https://github.com/hugegraph/hugegraph/pull/1196#discussion_r496728907", "createdAt": "2020-09-29T13:44:44Z", "author": {"login": "javeme"}, "path": "hugegraph-core/src/main/java/com/baidu/hugegraph/util/LZ4Util.java", "diffHunk": "@@ -36,7 +36,7 @@\n     public static BytesBuffer compress(byte[] bytes, int blockSize) {\n         LZ4Factory factory = LZ4Factory.fastestInstance();\n         LZ4Compressor compressor = factory.fastCompressor();\n-        BytesBuffer buf = new BytesBuffer(bytes.length / 8);\n+        BytesBuffer buf = new BytesBuffer(bytes.length);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "99f44ff40a34d23e336517de8fbfe46e1c404e5f"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "866a9337222672b398c156d42d969289c7863c36", "author": {"user": {"login": "zhoney", "name": null}}, "url": "https://github.com/hugegraph/hugegraph/commit/866a9337222672b398c156d42d969289c7863c36", "committedDate": "2020-09-30T02:17:01Z", "message": "improve\n\nChange-Id: Ie15e6bf9c6eed48a448c4ed84d35e4f27197b67b"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e593b5376af88aa18fd1f50d89c01def3f2d037e", "author": {"user": {"login": "zhoney", "name": null}}, "url": "https://github.com/hugegraph/hugegraph/commit/e593b5376af88aa18fd1f50d89c01def3f2d037e", "committedDate": "2020-09-30T03:37:42Z", "message": "improve\n\nChange-Id: Ib68648def8946433666211b25782775151fb4c52"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c703c6d830437f215f48ccecb7bcab0104777085", "author": {"user": {"login": "zhoney", "name": null}}, "url": "https://github.com/hugegraph/hugegraph/commit/c703c6d830437f215f48ccecb7bcab0104777085", "committedDate": "2020-10-23T08:33:06Z", "message": "improve\n\nChange-Id: I0919c57e990f50a0df18a4d942d2de67947f928e"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE1NjM2MDIz", "url": "https://github.com/hugegraph/hugegraph/pull/1196#pullrequestreview-515636023", "createdAt": "2020-10-23T12:51:20Z", "commit": {"oid": "c703c6d830437f215f48ccecb7bcab0104777085"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yM1QxMjo1MToyMFrOHnMgMg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yM1QxMjo1MToyNlrOHnMgbg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDg2MTM2Mg==", "bodyText": "prefer to not add this method", "url": "https://github.com/hugegraph/hugegraph/pull/1196#discussion_r510861362", "createdAt": "2020-10-23T12:51:20Z", "author": {"login": "javeme"}, "path": "hugegraph-core/src/main/java/com/baidu/hugegraph/util/StringEncoding.java", "diffHunk": "@@ -144,12 +144,20 @@ public static String encodeBase64(byte[] bytes) {\n     }\n \n     public static byte[] compress(String value) {\n-        BytesBuffer buf = LZ4Util.compress(encode(value), BLOCK_SIZE);\n+        return compress(value, 0.0F);\n+    }\n+\n+    public static byte[] compress(String value, float ratio) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c703c6d830437f215f48ccecb7bcab0104777085"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDg2MTQyMg==", "bodyText": "ditto", "url": "https://github.com/hugegraph/hugegraph/pull/1196#discussion_r510861422", "createdAt": "2020-10-23T12:51:26Z", "author": {"login": "javeme"}, "path": "hugegraph-core/src/main/java/com/baidu/hugegraph/util/StringEncoding.java", "diffHunk": "@@ -144,12 +144,20 @@ public static String encodeBase64(byte[] bytes) {\n     }\n \n     public static byte[] compress(String value) {\n-        BytesBuffer buf = LZ4Util.compress(encode(value), BLOCK_SIZE);\n+        return compress(value, 0.0F);\n+    }\n+\n+    public static byte[] compress(String value, float ratio) {\n+        BytesBuffer buf = LZ4Util.compress(encode(value), BLOCK_SIZE, ratio);\n         return buf.bytes();\n     }\n \n     public static String decompress(byte[] value) {\n-        BytesBuffer buf = LZ4Util.decompress(value, BLOCK_SIZE);\n+        return decompress(value, 0.0F);\n+    }\n+\n+    public static String decompress(byte[] value, float ratio) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c703c6d830437f215f48ccecb7bcab0104777085"}, "originalPosition": 18}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e457ec05224154499674521ccacd420dfb82e65b", "author": {"user": {"login": "zhoney", "name": null}}, "url": "https://github.com/hugegraph/hugegraph/commit/e457ec05224154499674521ccacd420dfb82e65b", "committedDate": "2020-10-26T02:53:29Z", "message": "improve\n\nChange-Id: If332999b94a2ef918b2b9d125a99de6ae15b59fe"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE2NTUxNDU1", "url": "https://github.com/hugegraph/hugegraph/pull/1196#pullrequestreview-516551455", "createdAt": "2020-10-26T08:27:05Z", "commit": {"oid": "e457ec05224154499674521ccacd420dfb82e65b"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yNlQwODoyNzowNlrOHoE8wg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yNlQwODoyNzoyMFrOHoE9Mg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTc4NjE3OA==", "bodyText": "define const", "url": "https://github.com/hugegraph/hugegraph/pull/1196#discussion_r511786178", "createdAt": "2020-10-26T08:27:06Z", "author": {"login": "javeme"}, "path": "hugegraph-core/src/main/java/com/baidu/hugegraph/util/StringEncoding.java", "diffHunk": "@@ -141,32 +144,21 @@ public static String encodeBase64(byte[] bytes) {\n     }\n \n     public static byte[] compress(String value) {\n-        final int outputSize = Math.max(32, value.length() / 8);\n-        final int gzipBufSize = 4 * (int) Bytes.KB;\n-        try (ByteArrayOutputStream bos = new ByteArrayOutputStream(outputSize);\n-             GZIPOutputStream out = new GZIPOutputStream(bos, gzipBufSize)) {\n-            byte[] bytes = encode(value);\n-            out.write(bytes);\n-            out.finish();\n-            return bos.toByteArray();\n-        } catch (IOException e) {\n-            throw new BackendException(\"Failed to compress: %s\", e, value);\n-        }\n+        return compress(value, 0.0F);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e457ec05224154499674521ccacd420dfb82e65b"}, "originalPosition": 60}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTc4NjI5MA==", "bodyText": "rename to bufferRatio", "url": "https://github.com/hugegraph/hugegraph/pull/1196#discussion_r511786290", "createdAt": "2020-10-26T08:27:20Z", "author": {"login": "javeme"}, "path": "hugegraph-core/src/main/java/com/baidu/hugegraph/util/StringEncoding.java", "diffHunk": "@@ -144,12 +144,20 @@ public static String encodeBase64(byte[] bytes) {\n     }\n \n     public static byte[] compress(String value) {\n-        BytesBuffer buf = LZ4Util.compress(encode(value), BLOCK_SIZE);\n+        return compress(value, 0.0F);\n+    }\n+\n+    public static byte[] compress(String value, float ratio) {\n+        BytesBuffer buf = LZ4Util.compress(encode(value), BLOCK_SIZE, ratio);\n         return buf.bytes();\n     }\n \n     public static String decompress(byte[] value) {\n-        BytesBuffer buf = LZ4Util.decompress(value, BLOCK_SIZE);\n+        return decompress(value, 0.0F);\n+    }\n+\n+    public static String decompress(byte[] value, float ratio) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDg2MTQyMg=="}, "originalCommit": {"oid": "c703c6d830437f215f48ccecb7bcab0104777085"}, "originalPosition": 18}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3751061f74954912d88f59d858febfad0ddd1f09", "author": {"user": {"login": "zhoney", "name": null}}, "url": "https://github.com/hugegraph/hugegraph/commit/3751061f74954912d88f59d858febfad0ddd1f09", "committedDate": "2020-10-26T08:34:49Z", "message": "improve\n\nChange-Id: I1970aab20cea373a6e5e1c11dea364aa38b7d3d4"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE2NTk1NTI1", "url": "https://github.com/hugegraph/hugegraph/pull/1196#pullrequestreview-516595525", "createdAt": "2020-10-26T09:27:35Z", "commit": {"oid": "3751061f74954912d88f59d858febfad0ddd1f09"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE2NjE5MDEx", "url": "https://github.com/hugegraph/hugegraph/pull/1196#pullrequestreview-516619011", "createdAt": "2020-10-26T09:57:28Z", "commit": {"oid": "3751061f74954912d88f59d858febfad0ddd1f09"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2297, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}