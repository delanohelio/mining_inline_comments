{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTEzOTY3Mzkx", "number": 1237, "reviewThreads": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQxMjo0MTo0MVrOE0XIDg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNFQwODozNjoyMFrOE1Htjg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIzMzQwMzAyOnYy", "diffSide": "RIGHT", "path": "hugegraph-core/src/main/java/com/baidu/hugegraph/backend/store/raft/RaftNode.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQxMjo0MTo0MVrOHsCv7Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQxMjo0MTo0MVrOHsCv7Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTk0NDQyOQ==", "bodyText": "prefer to define a var", "url": "https://github.com/hugegraph/hugegraph/pull/1237#discussion_r515944429", "createdAt": "2020-11-02T12:41:41Z", "author": {"login": "javeme"}, "path": "hugegraph-core/src/main/java/com/baidu/hugegraph/backend/store/raft/RaftNode.java", "diffHunk": "@@ -230,7 +230,8 @@ private void waitIfBusy() {\n             if (this.busyCounter.get() > 0) {\n                 synchronized (this) {\n                     if (this.busyCounter.get() > 0) {\n-                        this.busyCounter.decrementAndGet();\n+                        LOG.info(\"Decrease busy counter: [{}]\",\n+                                 this.busyCounter.decrementAndGet());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "445a2bffa4198f7f0395d8f3fe04c6b820ffbc0d"}, "originalPosition": 22}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIzMzQwNjU1OnYy", "diffSide": "RIGHT", "path": "hugegraph-core/src/main/java/com/baidu/hugegraph/backend/store/raft/RaftNode.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQxMjo0Mjo0MVrOHsCx-Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQxMjo0Mjo0MVrOHsCx-Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTk0NDk1Mw==", "bodyText": "prefer isRpcTimeout", "url": "https://github.com/hugegraph/hugegraph/pull/1237#discussion_r515944953", "createdAt": "2020-11-02T12:42:41Z", "author": {"login": "javeme"}, "path": "hugegraph-core/src/main/java/com/baidu/hugegraph/backend/store/raft/RaftNode.java", "diffHunk": "@@ -278,6 +279,16 @@ private boolean isWriteBufferOverflow(Status status) {\n                    status.getErrorMsg().contains(expectMsg);\n         }\n \n+        /**\n+         * Maybe useful in the future\n+         */\n+        private boolean isRPCTimeout(Status status) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "445a2bffa4198f7f0395d8f3fe04c6b820ffbc0d"}, "originalPosition": 42}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIzNjMzNTA2OnYy", "diffSide": "RIGHT", "path": "hugegraph-core/src/main/java/com/baidu/hugegraph/config/CoreOptions.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wM1QwMjo1MzoyOVrOHseukA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wM1QwMjo1MzoyOVrOHseukA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjQwMjgzMg==", "bodyText": "ditto", "url": "https://github.com/hugegraph/hugegraph/pull/1237#discussion_r516402832", "createdAt": "2020-11-03T02:53:29Z", "author": {"login": "zhoney"}, "path": "hugegraph-core/src/main/java/com/baidu/hugegraph/config/CoreOptions.java", "diffHunk": "@@ -249,6 +249,22 @@ public static synchronized CoreOptions instance() {\n                     60000\n             );\n \n+    public static final ConfigOption<Integer> RAFT_RPC_BUF_LOW_WATER_MARK =\n+            new ConfigOption<>(\n+                    \"raft.rpc_buf_low_water_mark\",\n+                    \"\",\n+                    positiveInt(),\n+                    10 * 1024 * 1024\n+            );\n+\n+    public static final ConfigOption<Integer> RAFT_RPC_BUF_HIGH_WATER_MARK =\n+            new ConfigOption<>(\n+                    \"raft.rpc_buf_high_water_mark\",\n+                    \"\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f3ac5449f94d07b7081cdd50dcd132b6e7c152d4"}, "originalPosition": 15}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIzNjMzNTQ3OnYy", "diffSide": "RIGHT", "path": "hugegraph-core/src/main/java/com/baidu/hugegraph/config/CoreOptions.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wM1QwMjo1Mzo0OFrOHseu1Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wM1QwMjo1Mzo0OFrOHseu1Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjQwMjkwMQ==", "bodyText": "prefer write some description", "url": "https://github.com/hugegraph/hugegraph/pull/1237#discussion_r516402901", "createdAt": "2020-11-03T02:53:48Z", "author": {"login": "zhoney"}, "path": "hugegraph-core/src/main/java/com/baidu/hugegraph/config/CoreOptions.java", "diffHunk": "@@ -249,6 +249,22 @@ public static synchronized CoreOptions instance() {\n                     60000\n             );\n \n+    public static final ConfigOption<Integer> RAFT_RPC_BUF_LOW_WATER_MARK =\n+            new ConfigOption<>(\n+                    \"raft.rpc_buf_low_water_mark\",\n+                    \"\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f3ac5449f94d07b7081cdd50dcd132b6e7c152d4"}, "originalPosition": 7}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIzNjYzNjEzOnYy", "diffSide": "RIGHT", "path": "hugegraph-core/src/main/java/com/baidu/hugegraph/backend/store/raft/RaftSharedContext.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wM1QwNjoxMzozM1rOHshR-A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wM1QwNjoxMzozM1rOHshR-A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjQ0NDY2NA==", "bodyText": "add some comment", "url": "https://github.com/hugegraph/hugegraph/pull/1237#discussion_r516444664", "createdAt": "2020-11-03T06:13:33Z", "author": {"login": "javeme"}, "path": "hugegraph-core/src/main/java/com/baidu/hugegraph/backend/store/raft/RaftSharedContext.java", "diffHunk": "@@ -266,6 +267,9 @@ public void notifyCache(HugeType type, Id id) {\n             eventHub = this.params.graphEventHub();\n         } else if (type.isSchema()) {\n             eventHub = this.params.schemaEventHub();\n+            if (id.number() && id.asLong() < 0) {\n+                return;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f3ac5449f94d07b7081cdd50dcd132b6e7c152d4"}, "originalPosition": 13}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIzNjY2OTE4OnYy", "diffSide": "RIGHT", "path": "hugegraph-core/src/main/java/com/baidu/hugegraph/util/LZ4Util.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wM1QwNjozMzowN1rOHshkVw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wM1QwNjozMzowN1rOHshkVw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjQ0OTM2Nw==", "bodyText": "need to perform", "url": "https://github.com/hugegraph/hugegraph/pull/1237#discussion_r516449367", "createdAt": "2020-11-03T06:33:07Z", "author": {"login": "javeme"}, "path": "hugegraph-core/src/main/java/com/baidu/hugegraph/util/LZ4Util.java", "diffHunk": "@@ -54,6 +54,10 @@ public static BytesBuffer compress(byte[] bytes, int blockSize,\n         } catch (IOException e) {\n             throw new BackendException(\"Failed to compress\", e);\n         }\n+        /*\n+         * If need perform reading outside the method,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f3ac5449f94d07b7081cdd50dcd132b6e7c152d4"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIzNzM4MjcwOnYy", "diffSide": "RIGHT", "path": "hugegraph-core/src/main/java/com/baidu/hugegraph/backend/cache/CachedSchemaTransaction.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wM1QxMDoxOTozNlrOHsoO5w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wM1QxMDoxOTozNlrOHsoO5w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjU1ODU2Nw==", "bodyText": "move to remove() method", "url": "https://github.com/hugegraph/hugegraph/pull/1237#discussion_r516558567", "createdAt": "2020-11-03T10:19:36Z", "author": {"login": "javeme"}, "path": "hugegraph-core/src/main/java/com/baidu/hugegraph/backend/cache/CachedSchemaTransaction.java", "diffHunk": "@@ -107,7 +107,9 @@ private void listenChanges() {\n             if (\"invalid\".equals(args[0])) {\n                 HugeType type = (HugeType) args[1];\n                 Id id = (Id) args[2];\n-                this.arrayCaches.remove(type, id);\n+                if (id.number() && id.asLong() > 0) {\n+                    this.arrayCaches.remove(type, id);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "408689e38fbb1a40775a382310a14b010c86df3c"}, "originalPosition": 6}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI0MTE4NTU2OnYy", "diffSide": "RIGHT", "path": "hugegraph-core/src/main/java/com/baidu/hugegraph/backend/cache/CachedSchemaTransaction.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNFQwNzo0MTo0MlrOHtMJRQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNFQwNzo0MTo0MlrOHtMJRQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzE0Njk0OQ==", "bodyText": "define var longId=id.asLong()", "url": "https://github.com/hugegraph/hugegraph/pull/1237#discussion_r517146949", "createdAt": "2020-11-04T07:41:42Z", "author": {"login": "javeme"}, "path": "hugegraph-core/src/main/java/com/baidu/hugegraph/backend/cache/CachedSchemaTransaction.java", "diffHunk": "@@ -322,13 +320,16 @@ public void updateIfNeeded(V schema) {\n                 return;\n             }\n             Id id = schema.id();\n-            if (id.number() && id.asLong() > 0) {\n+            if (id.number() && id.asLong() > 0L) {\n                 this.set(schema.type(), id, schema);\n             }\n         }\n \n         public V get(HugeType type, Id id) {\n-            assert id.number() && id.asLong() > 0 : id;\n+            assert id.number();\n+            if (id.asLong() <= 0L) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d1189c7c08d190dd2ac3e272974b7b5bc3a0d3fd"}, "originalPosition": 33}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI0MTE4NjQwOnYy", "diffSide": "RIGHT", "path": "hugegraph-core/src/main/java/com/baidu/hugegraph/backend/cache/CachedSchemaTransaction.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNFQwNzo0MTo1OVrOHtMJww==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNFQwNzo0MTo1OVrOHtMJww==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzE0NzA3NQ==", "bodyText": "ditto", "url": "https://github.com/hugegraph/hugegraph/pull/1237#discussion_r517147075", "createdAt": "2020-11-04T07:41:59Z", "author": {"login": "javeme"}, "path": "hugegraph-core/src/main/java/com/baidu/hugegraph/backend/cache/CachedSchemaTransaction.java", "diffHunk": "@@ -348,7 +349,10 @@ public V get(HugeType type, Id id) {\n         }\n \n         public void set(HugeType type, Id id, V value) {\n-            assert id.number() && id.asLong() > 0 : id;\n+            assert id.number();\n+            if (id.asLong() <= 0L) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d1189c7c08d190dd2ac3e272974b7b5bc3a0d3fd"}, "originalPosition": 45}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI0MTE4Njg0OnYy", "diffSide": "RIGHT", "path": "hugegraph-core/src/main/java/com/baidu/hugegraph/backend/cache/CachedSchemaTransaction.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNFQwNzo0MjowNlrOHtMJ_w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNFQwNzo0MjowNlrOHtMJ_w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzE0NzEzNQ==", "bodyText": "ditto", "url": "https://github.com/hugegraph/hugegraph/pull/1237#discussion_r517147135", "createdAt": "2020-11-04T07:42:06Z", "author": {"login": "javeme"}, "path": "hugegraph-core/src/main/java/com/baidu/hugegraph/backend/cache/CachedSchemaTransaction.java", "diffHunk": "@@ -373,7 +377,10 @@ public void set(HugeType type, Id id, V value) {\n         }\n \n         public void remove(HugeType type, Id id) {\n-            assert id.number() && id.asLong() > 0 : id;\n+            assert id.number();\n+            if (id.asLong() <= 0L) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d1189c7c08d190dd2ac3e272974b7b5bc3a0d3fd"}, "originalPosition": 57}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI0MTM2MzM0OnYy", "diffSide": "RIGHT", "path": "hugegraph-core/src/main/java/com/baidu/hugegraph/backend/cache/CachedSchemaTransaction.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNFQwODozNjoyMFrOHtNzkA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNFQwODozNjoyMFrOHtNzkA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzE3NDE2MA==", "bodyText": "add assert false : id;", "url": "https://github.com/hugegraph/hugegraph/pull/1237#discussion_r517174160", "createdAt": "2020-11-04T08:36:20Z", "author": {"login": "javeme"}, "path": "hugegraph-core/src/main/java/com/baidu/hugegraph/backend/cache/CachedSchemaTransaction.java", "diffHunk": "@@ -348,7 +349,10 @@ public V get(HugeType type, Id id) {\n         }\n \n         public void set(HugeType type, Id id, V value) {\n-            assert id.number() && id.asLong() > 0 : id;\n+            assert id.number();\n+            if (id.asLong() <= 0L) {\n+                return;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d1189c7c08d190dd2ac3e272974b7b5bc3a0d3fd"}, "originalPosition": 46}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1514, "cost": 1, "resetAt": "2021-11-12T20:44:06Z"}}}