{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY1NjM2ODU2", "number": 842, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMlQxMDo1Mjo0MFrODZyfhw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOVQwODo0MzoxM1rODg-3Dw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI4MzY4MjYzOnYy", "diffSide": "RIGHT", "path": "hugegraph-mysql/src/main/java/com/baidu/hugegraph/backend/store/mysql/MysqlSessions.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMlQxMDo1Mjo0MFrOFgX9RQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMlQxMDo1Mjo0MFrOFgX9RQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTQ5MTI2OQ==", "bodyText": "the origin logic is autoReconnect=false", "url": "https://github.com/hugegraph/hugegraph/pull/842#discussion_r369491269", "createdAt": "2020-01-22T10:52:40Z", "author": {"login": "javeme"}, "path": "hugegraph-mysql/src/main/java/com/baidu/hugegraph/backend/store/mysql/MysqlSessions.java", "diffHunk": "@@ -183,43 +183,35 @@ protected String buildExistsTable(String table) {\n      * Connect DB without specified database\n      */\n     protected Connection openWithoutDB(int timeout) {\n-        String jdbcUrl = this.config.get(MysqlOptions.JDBC_URL);\n-        String url = new URIBuilder().setPath(jdbcUrl)\n-                                     .setParameter(\"socketTimeout\",\n-                                                   String.valueOf(timeout))\n-                                     .toString();\n+        String url = this.buildUri(true, timeout);\n         try {\n             return this.connect(url);\n         } catch (SQLException e) {\n-            throw new BackendException(\"Failed to access %s\", e, jdbcUrl);\n+            throw new BackendException(\"Failed to access %s\", e, url);\n         }\n     }\n \n     /**\n      * Connect DB with specified database, but won't auto reconnect\n      */\n     protected Connection openWithDB(int timeout) {\n-        String jdbcUrl = this.config.get(MysqlOptions.JDBC_URL);\n-        if (jdbcUrl.endsWith(\"/\")) {\n-            jdbcUrl = String.format(\"%s%s\", jdbcUrl, this.database());\n-        } else {\n-            jdbcUrl = String.format(\"%s/%s\", jdbcUrl, this.database());\n-        }\n-        String url = new URIBuilder().setPath(jdbcUrl)\n-                                     .setParameter(\"socketTimeout\",\n-                                                   String.valueOf(timeout))\n-                                     .toString();\n+        String url = this.buildUri(true, timeout);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a4802a8980d3ee49db3289b5d8f3741cee6c6e8c"}, "originalPosition": 32}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI4MzY4NTQ5OnYy", "diffSide": "RIGHT", "path": "hugegraph-mysql/src/main/java/com/baidu/hugegraph/backend/store/mysql/MysqlSessions.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMlQxMDo1MzozN1rOFgX_EA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOFQwNzoyNDo0N1rOFq3m2g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTQ5MTcyOA==", "bodyText": "the origin logic is autoReconnect=false and no database parameter", "url": "https://github.com/hugegraph/hugegraph/pull/842#discussion_r369491728", "createdAt": "2020-01-22T10:53:37Z", "author": {"login": "javeme"}, "path": "hugegraph-mysql/src/main/java/com/baidu/hugegraph/backend/store/mysql/MysqlSessions.java", "diffHunk": "@@ -183,43 +183,35 @@ protected String buildExistsTable(String table) {\n      * Connect DB without specified database\n      */\n     protected Connection openWithoutDB(int timeout) {\n-        String jdbcUrl = this.config.get(MysqlOptions.JDBC_URL);\n-        String url = new URIBuilder().setPath(jdbcUrl)\n-                                     .setParameter(\"socketTimeout\",\n-                                                   String.valueOf(timeout))\n-                                     .toString();\n+        String url = this.buildUri(true, timeout);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a4802a8980d3ee49db3289b5d8f3741cee6c6e8c"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDQ5NTU3OA==", "bodyText": "autoReconnect really do not need, but need useSSL param", "url": "https://github.com/hugegraph/hugegraph/pull/842#discussion_r380495578", "createdAt": "2020-02-18T07:24:47Z", "author": {"login": "Linary"}, "path": "hugegraph-mysql/src/main/java/com/baidu/hugegraph/backend/store/mysql/MysqlSessions.java", "diffHunk": "@@ -183,43 +183,35 @@ protected String buildExistsTable(String table) {\n      * Connect DB without specified database\n      */\n     protected Connection openWithoutDB(int timeout) {\n-        String jdbcUrl = this.config.get(MysqlOptions.JDBC_URL);\n-        String url = new URIBuilder().setPath(jdbcUrl)\n-                                     .setParameter(\"socketTimeout\",\n-                                                   String.valueOf(timeout))\n-                                     .toString();\n+        String url = this.buildUri(true, timeout);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTQ5MTcyOA=="}, "originalCommit": {"oid": "a4802a8980d3ee49db3289b5d8f3741cee6c6e8c"}, "originalPosition": 9}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM1OTEwOTI3OnYy", "diffSide": "RIGHT", "path": "hugegraph-mysql/src/main/java/com/baidu/hugegraph/backend/store/mysql/MysqlSessions.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOVQwODo0MzoxM1rOFrfTlg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOVQwODo0MzoxM1rOFrfTlg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTE0NjAwNg==", "bodyText": "rename to withDB\nand prefer to set withConnParams as first param", "url": "https://github.com/hugegraph/hugegraph/pull/842#discussion_r381146006", "createdAt": "2020-02-19T08:43:13Z", "author": {"login": "javeme"}, "path": "hugegraph-mysql/src/main/java/com/baidu/hugegraph/backend/store/mysql/MysqlSessions.java", "diffHunk": "@@ -207,35 +207,39 @@ protected Connection openWithDB(int timeout) {\n      * Connect DB with specified database\n      */\n     private Connection open(boolean autoReconnect) throws SQLException {\n-        String url = this.buildUri(autoReconnect, null);\n+        String url = this.buildUri(true, true, autoReconnect, null);\n         return this.connect(url);\n     }\n \n-    protected String buildUri(boolean autoReconnect, Integer timeout) {\n+    protected String buildUri(boolean withdb, boolean withConnParams,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8937e389c367043fa8d3db9853a5d0ef1803afac"}, "originalPosition": 28}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1577, "cost": 1, "resetAt": "2021-11-12T20:44:06Z"}}}