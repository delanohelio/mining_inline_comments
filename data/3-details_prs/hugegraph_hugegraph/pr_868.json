{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc5Njg2MTAw", "number": 868, "title": "speed up hbase truncate with disableTableAsync()", "bodyText": "improve: #770\nChange-Id: Ie4da8b77a4ce63d388322c838415870e7225ae21", "createdAt": "2020-02-25T16:44:34Z", "url": "https://github.com/hugegraph/hugegraph/pull/868", "merged": true, "mergeCommit": {"oid": "9b0290cd44fafabb8c31c749e5f86d5547059960"}, "closed": true, "closedAt": "2020-02-27T01:43:21Z", "author": {"login": "javeme"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcH09OCgH2gAyMzc5Njg2MTAwOjhjMTUxNDBjMzFiMzQzZDFiN2UwOTRiOTRmZTFlNDU3ZDA3NzI0Nzg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcIRPoQAFqTM2NTM2NDc3MQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "8c15140c31b343d1b7e094b94fe1e457d0772478", "author": {"user": {"login": "javeme", "name": "Jermy Li"}}, "url": "https://github.com/hugegraph/hugegraph/commit/8c15140c31b343d1b7e094b94fe1e457d0772478", "committedDate": "2020-02-25T16:45:29Z", "message": "speed up hbase truncate with disableTableAsync()\n\nOptimized hbase clear() cost time from 19s to 6s\n\nimprove: #770\nChange-Id: Ie4da8b77a4ce63d388322c838415870e7225ae21"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "52d02fc87a7bd34603c3a6785018143e77dc9766", "author": {"user": {"login": "javeme", "name": "Jermy Li"}}, "url": "https://github.com/hugegraph/hugegraph/commit/52d02fc87a7bd34603c3a6785018143e77dc9766", "committedDate": "2020-02-25T19:10:56Z", "message": "improve error resume and remove empty table optimize\n\nChange-Id: I701f2e105648dcd9b639c263a260a193ee00040e"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c533adf0bfdac73086ae0363e99dbf660e7f97e3", "author": {"user": {"login": "javeme", "name": "Jermy Li"}}, "url": "https://github.com/hugegraph/hugegraph/commit/c533adf0bfdac73086ae0363e99dbf660e7f97e3", "committedDate": "2020-02-25T16:42:59Z", "message": "speed up hbase truncate with disableTableAsync()\n\nimprove: #770\nChange-Id: Ie4da8b77a4ce63d388322c838415870e7225ae21"}, "afterCommit": {"oid": "52d02fc87a7bd34603c3a6785018143e77dc9766", "author": {"user": {"login": "javeme", "name": "Jermy Li"}}, "url": "https://github.com/hugegraph/hugegraph/commit/52d02fc87a7bd34603c3a6785018143e77dc9766", "committedDate": "2020-02-25T19:10:56Z", "message": "improve error resume and remove empty table optimize\n\nChange-Id: I701f2e105648dcd9b639c263a260a193ee00040e"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY0NjAzMDA4", "url": "https://github.com/hugegraph/hugegraph/pull/868#pullrequestreview-364603008", "createdAt": "2020-02-26T03:30:24Z", "commit": {"oid": "8c15140c31b343d1b7e094b94fe1e457d0772478"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNlQwMzozMDoyNFrOFudOiw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNlQwMzozMDozOFrOFudOug==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDI1NzY3NQ==", "bodyText": "try( => try (", "url": "https://github.com/hugegraph/hugegraph/pull/868#discussion_r384257675", "createdAt": "2020-02-26T03:30:24Z", "author": {"login": "Linary"}, "path": "hugegraph-hbase/src/main/java/com/baidu/hugegraph/backend/store/hbase/HbaseSessions.java", "diffHunk": "@@ -202,15 +203,23 @@ public void dropTable(String table) throws IOException {\n         }\n     }\n \n-    public Future<Void> truncateTable(String table) throws IOException {\n+    public Future<Void> disableTable(String table) throws IOException {\n         assert this.existsTable(table);\n         TableName tableName = TableName.valueOf(this.namespace, table);\n         try(Admin admin = this.hbase.getAdmin()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8c15140c31b343d1b7e094b94fe1e457d0772478"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDI1NzcyMg==", "bodyText": "ditto", "url": "https://github.com/hugegraph/hugegraph/pull/868#discussion_r384257722", "createdAt": "2020-02-26T03:30:38Z", "author": {"login": "Linary"}, "path": "hugegraph-hbase/src/main/java/com/baidu/hugegraph/backend/store/hbase/HbaseSessions.java", "diffHunk": "@@ -202,15 +203,23 @@ public void dropTable(String table) throws IOException {\n         }\n     }\n \n-    public Future<Void> truncateTable(String table) throws IOException {\n+    public Future<Void> disableTable(String table) throws IOException {\n         assert this.existsTable(table);\n         TableName tableName = TableName.valueOf(this.namespace, table);\n         try(Admin admin = this.hbase.getAdmin()) {\n             try {\n-                admin.disableTable(tableName);\n+                return admin.disableTableAsync(tableName);\n             } catch (TableNotEnabledException ignored) {\n-                // pass\n+                // Ignore if it's disabled\n+                return Futures.immediateFuture(null);\n             }\n+        }\n+    }\n+\n+    public Future<Void> truncateTable(String table) throws IOException {\n+        assert this.existsTable(table);\n+        TableName tableName = TableName.valueOf(this.namespace, table);\n+        try(Admin admin = this.hbase.getAdmin()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8c15140c31b343d1b7e094b94fe1e457d0772478"}, "originalPosition": 31}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d3742bc3915c1740ce47b19a0eccf13a999a7647", "author": {"user": {"login": "javeme", "name": "Jermy Li"}}, "url": "https://github.com/hugegraph/hugegraph/commit/d3742bc3915c1740ce47b19a0eccf13a999a7647", "committedDate": "2020-02-26T17:14:46Z", "message": "add a space after 'try'\n\nChange-Id: I82647d7635ce328581150b66c879d9ac202796c9"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY1MTI1MzY2", "url": "https://github.com/hugegraph/hugegraph/pull/868#pullrequestreview-365125366", "createdAt": "2020-02-26T18:10:14Z", "commit": {"oid": "d3742bc3915c1740ce47b19a0eccf13a999a7647"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY1MzY0Nzcx", "url": "https://github.com/hugegraph/hugegraph/pull/868#pullrequestreview-365364771", "createdAt": "2020-02-27T01:42:56Z", "commit": {"oid": "d3742bc3915c1740ce47b19a0eccf13a999a7647"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2396, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}