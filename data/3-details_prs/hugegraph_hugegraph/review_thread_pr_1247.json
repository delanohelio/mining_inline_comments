{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE3NjQwNzA5", "number": 1247, "reviewThreads": {"totalCount": 13, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wOVQxMToxNzozMlrOE2t5dA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xN1QxMzowNDowNVrOE6AZqg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI1ODEwNTQ4OnYy", "diffSide": "RIGHT", "path": "hugegraph-core/src/main/java/com/baidu/hugegraph/backend/store/raft/RaftBackendStoreProvider.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wOVQxMToxNzozMlrOHvp84Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wOVQxMToxNzozMlrOHvp84Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTczMjQ0OQ==", "bodyText": "The raft node is initialized", "url": "https://github.com/hugegraph/hugegraph/pull/1247#discussion_r519732449", "createdAt": "2020-11-09T11:17:32Z", "author": {"login": "javeme"}, "path": "hugegraph-core/src/main/java/com/baidu/hugegraph/backend/store/raft/RaftBackendStoreProvider.java", "diffHunk": "@@ -129,6 +129,7 @@ public void open(String name) {\n     @Override\n     public void waitStoreStarted() {\n         this.context.initRaftNode();\n+        LOG.info(\"The raft node was inited\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "84050365c34ed61c19e4ec63b630d3873ee4d634"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI1ODE0NjkwOnYy", "diffSide": "RIGHT", "path": "hugegraph-rocksdb/src/main/java/com/baidu/hugegraph/backend/store/rocksdb/RocksDBStore.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wOVQxMToyODo1M1rOHvqVgw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wOVQxMToyODo1M1rOHvqVgw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTczODc1NQ==", "bodyText": "use %s", "url": "https://github.com/hugegraph/hugegraph/pull/1247#discussion_r519738755", "createdAt": "2020-11-09T11:28:53Z", "author": {"login": "javeme"}, "path": "hugegraph-rocksdb/src/main/java/com/baidu/hugegraph/backend/store/rocksdb/RocksDBStore.java", "diffHunk": "@@ -635,23 +635,28 @@ public void readSnapshot(String parentPath) {\n                                                e, snapshotFile, dataFile);\n                 }\n             }\n-\n-            // Reopen the db\n-            this.open(this.sessions.config());\n+            // Reload rocksdb instance\n+            for (RocksDBSessions sessions : this.dbs.values()) {\n+                sessions.reload();\n+            }\n+            LOG.info(\"The store {} load snapshot succeed\", this.store);\n+        } catch (RocksDBException e) {\n+            throw new BackendException(\"Failed to reload rocksdb: \" + e.toString());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "84050365c34ed61c19e4ec63b630d3873ee4d634"}, "originalPosition": 97}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI1ODE1Mzg2OnYy", "diffSide": "RIGHT", "path": "hugegraph-rocksdb/src/main/java/com/baidu/hugegraph/backend/store/rocksdb/RocksDBStore.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wOVQxMTozMDo1MlrOHvqZuw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wOVQxMTozMDo1MlrOHvqZuw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTczOTgzNQ==", "bodyText": "rename to storeLock", "url": "https://github.com/hugegraph/hugegraph/pull/1247#discussion_r519739835", "createdAt": "2020-11-09T11:30:52Z", "author": {"login": "javeme"}, "path": "hugegraph-rocksdb/src/main/java/com/baidu/hugegraph/backend/store/rocksdb/RocksDBStore.java", "diffHunk": "@@ -586,21 +581,22 @@ protected Session session(HugeType tableType) {\n \n     @Override\n     public void writeSnapshot(String parentPath) {\n-        Lock readLock = this.truncateLock.readLock();\n-        readLock.lock();\n+        Lock writeLock = this.truncateLock.writeLock();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "84050365c34ed61c19e4ec63b630d3873ee4d634"}, "originalPosition": 38}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI1ODE2MDI5OnYy", "diffSide": "RIGHT", "path": "hugegraph-rocksdb/src/main/java/com/baidu/hugegraph/backend/store/rocksdb/RocksDBStore.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wOVQxMTozMjozN1rOHvqdeA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wOVQxMTozMjozN1rOHvqdeA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTc0MDc5Mg==", "bodyText": "move forceCloseRocksDB to RocksDBSessions", "url": "https://github.com/hugegraph/hugegraph/pull/1247#discussion_r519740792", "createdAt": "2020-11-09T11:32:37Z", "author": {"login": "javeme"}, "path": "hugegraph-rocksdb/src/main/java/com/baidu/hugegraph/backend/store/rocksdb/RocksDBStore.java", "diffHunk": "@@ -614,12 +610,16 @@ public void readSnapshot(String parentPath) {\n                 File dataFile = new File(session.dataPath());\n                 fileRenamePairs.add(Pair.of(snapshotFile, dataFile));\n             }\n-            // Close old sessions, is that right?\n-            for (Session session : this.session()) {\n-                session.close();\n+            /*\n+             * NOTE: must close rocksdb instance before deleting file directory,\n+             * if close after copying the snapshot directory to origin position,\n+             * it may produce dirty data.\n+             */\n+            for (RocksDBSessions sessions : this.dbs.values()) {\n+                if (sessions instanceof RocksDBStdSessions) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "84050365c34ed61c19e4ec63b630d3873ee4d634"}, "originalPosition": 75}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI1ODE2MjU5OnYy", "diffSide": "RIGHT", "path": "hugegraph-rocksdb/src/main/java/com/baidu/hugegraph/backend/store/rocksdb/RocksDBStore.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wOVQxMTozMzoxN1rOHvqe5A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wOVQxMTozMzoxN1rOHvqe5A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTc0MTE1Ng==", "bodyText": "successfully", "url": "https://github.com/hugegraph/hugegraph/pull/1247#discussion_r519741156", "createdAt": "2020-11-09T11:33:17Z", "author": {"login": "javeme"}, "path": "hugegraph-rocksdb/src/main/java/com/baidu/hugegraph/backend/store/rocksdb/RocksDBStore.java", "diffHunk": "@@ -635,23 +635,28 @@ public void readSnapshot(String parentPath) {\n                                                e, snapshotFile, dataFile);\n                 }\n             }\n-\n-            // Reopen the db\n-            this.open(this.sessions.config());\n+            // Reload rocksdb instance\n+            for (RocksDBSessions sessions : this.dbs.values()) {\n+                sessions.reload();\n+            }\n+            LOG.info(\"The store {} load snapshot succeed\", this.store);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "84050365c34ed61c19e4ec63b630d3873ee4d634"}, "originalPosition": 95}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI1ODE3NzYyOnYy", "diffSide": "RIGHT", "path": "hugegraph-core/src/main/java/com/baidu/hugegraph/backend/store/raft/StoreSnapshotFile.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wOVQxMTozNzozMVrOHvqn0g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wOVQxMTozNzozMVrOHvqn0g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTc0MzQ0Mg==", "bodyText": "\"Failed to save snapshot, path={}, files={}\", the exception stack will be printed", "url": "https://github.com/hugegraph/hugegraph/pull/1247#discussion_r519743442", "createdAt": "2020-11-09T11:37:31Z", "author": {"login": "javeme"}, "path": "hugegraph-core/src/main/java/com/baidu/hugegraph/backend/store/raft/StoreSnapshotFile.java", "diffHunk": "@@ -49,22 +48,27 @@\n     private static final String SNAPSHOT_DIR = \"ss\";\n     private static final String SNAPSHOT_ARCHIVE = \"ss.zip\";\n \n-    public void save(BackendStore store, SnapshotWriter writer,\n-                     Closure done, ExecutorService executor) {\n+    private final RaftBackendStore[] stores;\n+\n+    public StoreSnapshotFile(RaftBackendStore[] stores) {\n+        this.stores = stores;\n+    }\n+\n+    public void save(SnapshotWriter writer, Closure done,\n+                     ExecutorService executor) {\n         String writerPath = writer.getPath();\n         String snapshotPath = Paths.get(writerPath, SNAPSHOT_DIR).toString();\n         try {\n-            this.doSnapshotSave(store, snapshotPath)\n-                .whenComplete((metaBuilder, throwable) -> {\n-                if (throwable == null) {\n+            this.doSnapshotSave(snapshotPath).whenComplete((metaBuilder, t) -> {\n+                if (t == null) {\n                     executor.execute(() -> compressSnapshot(writer, metaBuilder,\n                                                             done));\n                 } else {\n                     LOG.error(\"Failed to save snapshot, path={}, files={}, {}.\",\n-                              writerPath, writer.listFiles(), throwable);\n+                              writerPath, writer.listFiles(), t);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "84050365c34ed61c19e4ec63b630d3873ee4d634"}, "originalPosition": 35}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI1ODE4MTI2OnYy", "diffSide": "RIGHT", "path": "hugegraph-core/src/main/java/com/baidu/hugegraph/backend/store/raft/StoreSnapshotFile.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wOVQxMTozODozOVrOHvqqGA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wOVQxMTozODozOVrOHvqqGA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTc0NDAyNA==", "bodyText": "set private", "url": "https://github.com/hugegraph/hugegraph/pull/1247#discussion_r519744024", "createdAt": "2020-11-09T11:38:39Z", "author": {"login": "javeme"}, "path": "hugegraph-core/src/main/java/com/baidu/hugegraph/backend/store/raft/StoreSnapshotFile.java", "diffHunk": "@@ -105,14 +109,21 @@ public boolean load(BackendStore store, SnapshotReader reader) {\n     }\n \n     public CompletableFuture<LocalFileMeta.Builder> doSnapshotSave(\n-                                                    BackendStore store,\n                                                     String snapshotPath) {\n-        store.writeSnapshot(snapshotPath);\n+        for (RaftBackendStore store : this.stores) {\n+            String parentPath = Paths.get(snapshotPath, store.store())\n+                                     .toString();\n+            store.writeSnapshot(parentPath);\n+        }\n         return CompletableFuture.completedFuture(LocalFileMeta.newBuilder());\n     }\n \n-    public void doSnapshotLoad(BackendStore store, String snapshotPath) {\n-        store.readSnapshot(snapshotPath);\n+    public void doSnapshotLoad(String snapshotPath) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "84050365c34ed61c19e4ec63b630d3873ee4d634"}, "originalPosition": 90}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI1ODE4MjA5OnYy", "diffSide": "RIGHT", "path": "hugegraph-core/src/main/java/com/baidu/hugegraph/backend/store/raft/RaftSharedContext.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wOVQxMTozODo1N1rOHvqqtg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wOVQxMTozODo1N1rOHvqqtg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTc0NDE4Mg==", "bodyText": "set protected", "url": "https://github.com/hugegraph/hugegraph/pull/1247#discussion_r519744182", "createdAt": "2020-11-09T11:38:57Z", "author": {"login": "javeme"}, "path": "hugegraph-core/src/main/java/com/baidu/hugegraph/backend/store/raft/RaftSharedContext.java", "diffHunk": "@@ -186,6 +186,10 @@ public StoreType storeType(String store) {\n         }\n     }\n \n+    public RaftBackendStore[] stores() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "84050365c34ed61c19e4ec63b630d3873ee4d634"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI1ODUwMjM3OnYy", "diffSide": "RIGHT", "path": "hugegraph-core/src/main/java/com/baidu/hugegraph/backend/store/raft/StoreSnapshotFile.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wOVQxMzowNjowM1rOHvttlg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wOVQxMzowNjowM1rOHvttlg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTc5NDA3MA==", "bodyText": "\"the exception stack will be printed\" is just comment", "url": "https://github.com/hugegraph/hugegraph/pull/1247#discussion_r519794070", "createdAt": "2020-11-09T13:06:03Z", "author": {"login": "javeme"}, "path": "hugegraph-core/src/main/java/com/baidu/hugegraph/backend/store/raft/StoreSnapshotFile.java", "diffHunk": "@@ -64,7 +64,8 @@ public void save(SnapshotWriter writer, Closure done,\n                     executor.execute(() -> compressSnapshot(writer, metaBuilder,\n                                                             done));\n                 } else {\n-                    LOG.error(\"Failed to save snapshot, path={}, files={}, {}.\",\n+                    LOG.error(\"Failed to save snapshot, path={}, files={}, \" +\n+                              \"the exception stack will be printed.\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bc73b3cb84842c3ef9422cd4800d3e117466acbf"}, "originalPosition": 6}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI2MzAxNDgyOnYy", "diffSide": "RIGHT", "path": "hugegraph-core/src/main/java/com/baidu/hugegraph/backend/store/raft/RaftBackendStoreProvider.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQxMTozMzoyNFrOHwYcxw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMVQwNTo0MTo0NVrOHw-8hg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDQ5NDI3OQ==", "bodyText": "remove \"is\"", "url": "https://github.com/hugegraph/hugegraph/pull/1247#discussion_r520494279", "createdAt": "2020-11-10T11:33:24Z", "author": {"login": "houzhizhen"}, "path": "hugegraph-core/src/main/java/com/baidu/hugegraph/backend/store/raft/RaftBackendStoreProvider.java", "diffHunk": "@@ -129,8 +129,9 @@ public void open(String name) {\n     @Override\n     public void waitStoreStarted() {\n         this.context.initRaftNode();\n+        LOG.info(\"The raft node is initialized\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b11a2197aead8543def94769b13fb62336132354"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTEyNDk5OA==", "bodyText": "prefer keep it", "url": "https://github.com/hugegraph/hugegraph/pull/1247#discussion_r521124998", "createdAt": "2020-11-11T05:41:45Z", "author": {"login": "javeme"}, "path": "hugegraph-core/src/main/java/com/baidu/hugegraph/backend/store/raft/RaftBackendStoreProvider.java", "diffHunk": "@@ -129,8 +129,9 @@ public void open(String name) {\n     @Override\n     public void waitStoreStarted() {\n         this.context.initRaftNode();\n+        LOG.info(\"The raft node is initialized\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDQ5NDI3OQ=="}, "originalCommit": {"oid": "b11a2197aead8543def94769b13fb62336132354"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI2MzAxNTU2OnYy", "diffSide": "RIGHT", "path": "hugegraph-core/src/main/java/com/baidu/hugegraph/backend/store/raft/RaftBackendStoreProvider.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQxMTozMzozMVrOHwYdLg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQxMTozMzozMVrOHwYdLg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDQ5NDM4Mg==", "bodyText": "remove \"is\"", "url": "https://github.com/hugegraph/hugegraph/pull/1247#discussion_r520494382", "createdAt": "2020-11-10T11:33:31Z", "author": {"login": "houzhizhen"}, "path": "hugegraph-core/src/main/java/com/baidu/hugegraph/backend/store/raft/RaftBackendStoreProvider.java", "diffHunk": "@@ -129,8 +129,9 @@ public void open(String name) {\n     @Override\n     public void waitStoreStarted() {\n         this.context.initRaftNode();\n+        LOG.info(\"The raft node is initialized\");\n         this.context.waitRaftNodeStarted();\n-        LOG.info(\"The raft store was started\");\n+        LOG.info(\"The raft store is started\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b11a2197aead8543def94769b13fb62336132354"}, "originalPosition": 7}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI5MjU1MDkxOnYy", "diffSide": "RIGHT", "path": "hugegraph-rocksdb/src/main/java/com/baidu/hugegraph/backend/store/rocksdb/RocksDBStdSessions.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xN1QxMjo1MjoxMFrOH0zZXw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xN1QxMjo1MjoxMFrOH0zZXw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTEzMDA3OQ==", "bodyText": "move line 259 to line 256", "url": "https://github.com/hugegraph/hugegraph/pull/1247#discussion_r525130079", "createdAt": "2020-11-17T12:52:10Z", "author": {"login": "javeme"}, "path": "hugegraph-rocksdb/src/main/java/com/baidu/hugegraph/backend/store/rocksdb/RocksDBStdSessions.java", "diffHunk": "@@ -251,9 +251,11 @@ public synchronized void dropTable(String... tables)\n         }\n     }\n \n-    @SuppressWarnings(\"unused\")\n-    private void reload() throws RocksDBException {\n-        this.rocksdb.close();\n+    @Override\n+    public void reload() throws RocksDBException {\n+        if (this.rocksdb.isOwningHandle()) {\n+            this.rocksdb.close();\n+        }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e9de3775d2949c875936f3086f666480c4f4105e"}, "originalPosition": 20}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI5MjU5NDM0OnYy", "diffSide": "RIGHT", "path": "hugegraph-rocksdb/src/main/java/com/baidu/hugegraph/backend/store/rocksdb/RocksDBStore.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xN1QxMzowNDowNVrOH0zz9g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xN1QxMzowNDowNVrOH0zz9g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTEzNjg4Ng==", "bodyText": "update comments:\nOpen twice, copy a RocksDBSessions reference, since from v0.11.2 release we don't support multi graphs share rocksdb instance (before v0.11.2 graphs with different CF-prefix share one rocksdb instance and data path), so each graph has its independent data paths, but multi CFs may share same optimized disk(or optimized disk path).", "url": "https://github.com/hugegraph/hugegraph/pull/1247#discussion_r525136886", "createdAt": "2020-11-17T13:04:05Z", "author": {"login": "javeme"}, "path": "hugegraph-rocksdb/src/main/java/com/baidu/hugegraph/backend/store/rocksdb/RocksDBStore.java", "diffHunk": "@@ -265,7 +260,7 @@ protected RocksDBSessions open(HugeConfig config, String dataPath,\n             sessions = this.openSessionPool(config, dataPath,\n                                             walPath, tableNames);\n         } catch (RocksDBException e) {\n-            RocksDBSessions origin = dbs.get(dataPath);\n+            RocksDBSessions origin = this.dbs.get(dataPath);\n             if (origin != null) {\n                 if (e.getMessage().contains(\"No locks available\")) {\n                     // Open twice, but we should support keyspace", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e9de3775d2949c875936f3086f666480c4f4105e"}, "originalPosition": 44}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1517, "cost": 1, "resetAt": "2021-11-12T20:44:06Z"}}}