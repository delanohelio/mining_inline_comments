{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTMzNTIwNjAy", "number": 1289, "title": "export new implemented oltp traversals", "bodyText": "Change-Id: I0e501dcffd7c38dbd6afe76e82000935160bee36", "createdAt": "2020-12-07T09:22:33Z", "url": "https://github.com/hugegraph/hugegraph/pull/1289", "merged": true, "mergeCommit": {"oid": "f6f44bb24e9d03224df89eeda027cef2db90b6b7"}, "closed": true, "closedAt": "2020-12-09T11:54:45Z", "author": {"login": "zhoney"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdjyBiXgH2gAyNTMzNTIwNjAyOjEyM2ZmMWNmMzA1M2ZjZTliYmIwMzNlMTE2YTIxYzkyNTY0ZmU4Yjg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdkbWkmAFqTU0Nzk5MTgzNA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "123ff1cf3053fce9bbb033e116a21c92564fe8b8", "author": {"user": {"login": "zhoney", "name": null}}, "url": "https://github.com/hugegraph/hugegraph/commit/123ff1cf3053fce9bbb033e116a21c92564fe8b8", "committedDate": "2020-12-07T09:21:31Z", "message": "export new implemented oltp traversals\n\nChange-Id: I0e501dcffd7c38dbd6afe76e82000935160bee36"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7837241ca702b4667e512eac38ec6feaaf0e6bb9", "author": {"user": {"login": "zhoney", "name": null}}, "url": "https://github.com/hugegraph/hugegraph/commit/7837241ca702b4667e512eac38ec6feaaf0e6bb9", "committedDate": "2020-12-09T03:54:20Z", "message": "improve\n\nChange-Id: I3b541099d0dbec6dc455f28324fb80229cdb45d6"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "806f2db74038dfbfc266127aca0d23c1d68c1565", "author": {"user": {"login": "zhoney", "name": null}}, "url": "https://github.com/hugegraph/hugegraph/commit/806f2db74038dfbfc266127aca0d23c1d68c1565", "committedDate": "2020-12-09T05:48:26Z", "message": "move EdgeStep, WeightedEdgeStep and RepeatEdgeStep to steps package\n\nChange-Id: I934670631e3b7969e7be975bef0fb5104d633965"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ3ODYwNTc2", "url": "https://github.com/hugegraph/hugegraph/pull/1289#pullrequestreview-547860576", "createdAt": "2020-12-09T05:53:05Z", "commit": {"oid": "7837241ca702b4667e512eac38ec6feaaf0e6bb9"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOVQwNTo1MzowNVrOICDvQQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOVQwNTo1NzozMVrOICD1rg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTAyOTMxMw==", "bodyText": "export EdgeStep", "url": "https://github.com/hugegraph/hugegraph/pull/1289#discussion_r539029313", "createdAt": "2020-12-09T05:53:05Z", "author": {"login": "javeme"}, "path": "hugegraph-dist/src/assembly/static/conf/gremlin-server.yaml", "diffHunk": "@@ -20,15 +20,27 @@ scriptEngines: {\n           com.baidu.hugegraph.backend.id.IdGenerator,\n           com.baidu.hugegraph.type.define.Directions,\n           com.baidu.hugegraph.type.define.NodeRole,\n-          com.baidu.hugegraph.traversal.algorithm.CustomizePathsTraverser,\n+          com.baidu.hugegraph.traversal.algorithm.CollectionPathsTraverser,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7837241ca702b4667e512eac38ec6feaaf0e6bb9"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTAzMDk1OA==", "bodyText": "move to TemplatePathsAPI", "url": "https://github.com/hugegraph/hugegraph/pull/1289#discussion_r539030958", "createdAt": "2020-12-09T05:57:31Z", "author": {"login": "javeme"}, "path": "hugegraph-api/src/main/java/com/baidu/hugegraph/api/traversers/TraverserAPI.java", "diffHunk": "@@ -38,14 +38,11 @@ protected static EdgeStep step(HugeGraph graph, Step step) {\n                             step.degree, step.skipDegree);\n     }\n \n-    protected static TemplatePathsTraverser.RepeatEdgeStep repeatEdgeStep(\n-              HugeGraph graph, TemplatePathsAPI.RepeatEdgeStep step) {\n-        return new TemplatePathsTraverser.RepeatEdgeStep(graph, step.direction,\n-                                                         step.labels,\n-                                                         step.properties,\n-                                                         step.degree,\n-                                                         step.skipDegree,\n-                                                         step.maxTimes);\n+    protected static RepeatEdgeStep repeatEdgeStep(\n+              HugeGraph graph, TemplatePathsAPI.TemplatePathStep step) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "806f2db74038dfbfc266127aca0d23c1d68c1565"}, "originalPosition": 24}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ3ODY0ODUx", "url": "https://github.com/hugegraph/hugegraph/pull/1289#pullrequestreview-547864851", "createdAt": "2020-12-09T06:04:09Z", "commit": {"oid": "806f2db74038dfbfc266127aca0d23c1d68c1565"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOVQwNjowNDowOVrOICD_pw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOVQwNjowNDowOVrOICD_pw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTAzMzUxMQ==", "bodyText": "edgesOfVertexWithCount", "url": "https://github.com/hugegraph/hugegraph/pull/1289#discussion_r539033511", "createdAt": "2020-12-09T06:04:09Z", "author": {"login": "javeme"}, "path": "hugegraph-core/src/main/java/com/baidu/hugegraph/traversal/algorithm/CountTraverser.java", "diffHunk": "@@ -63,45 +62,45 @@ public long count(Id source, List<Step> steps,\n         }\n \n         int stepNum = steps.size();\n-        Step firstStep = steps.get(0);\n+        EdgeStep firstStep = steps.get(0);\n         if (stepNum == 1) {\n             // Just one step, query count and return\n-            long edgesCount = this.edgesCount(source, firstStep.edgeStep);\n+            long edgesCount = this.edgesCount(source, firstStep);\n             this.count.add(edgesCount);\n             return this.count.longValue();\n         }\n \n         // Multiple steps, construct first step to iterator\n-        Iterator<Edge> edges = this.edgesOfVertex(source, firstStep);\n+        Iterator<Edge> edges = this.edgesOfVertexWithDedup(source, firstStep);\n         // Wrap steps to Iterator except last step\n         for (int i = 1; i < stepNum - 1; i++) {\n-            Step currentStep = steps.get(i);\n+            EdgeStep currentStep = steps.get(i);\n             edges = new FlatMapperIterator<>(edges, (edge) -> {\n                 Id target = ((HugeEdge) edge).id().otherVertexId();\n-                return this.edgesOfVertex(target, currentStep);\n+                return this.edgesOfVertexWithDedup(target, currentStep);\n             });\n         }\n \n         // The last step, just query count\n-        Step lastStep = steps.get(stepNum - 1);\n+        EdgeStep lastStep = steps.get(stepNum - 1);\n         while (edges.hasNext()) {\n             Id target = ((HugeEdge) edges.next()).id().otherVertexId();\n             if (this.dedup(target)) {\n                 continue;\n             }\n             // Count last layer vertices(without dedup size)\n-            long edgesCount = this.edgesCount(target, lastStep.edgeStep);\n+            long edgesCount = this.edgesCount(target, lastStep);\n             this.count.add(edgesCount);\n         }\n \n         return this.count.longValue();\n     }\n \n-    private Iterator<Edge> edgesOfVertex(Id source, Step step) {\n+    private Iterator<Edge> edgesOfVertexWithDedup(Id source, EdgeStep step) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "806f2db74038dfbfc266127aca0d23c1d68c1565"}, "originalPosition": 72}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d81a5c677a988c71da0380ab69ae93ac1e67b1cb", "author": {"user": {"login": "zhoney", "name": null}}, "url": "https://github.com/hugegraph/hugegraph/commit/d81a5c677a988c71da0380ab69ae93ac1e67b1cb", "committedDate": "2020-12-09T07:29:07Z", "message": "improve\n\nChange-Id: I5c16abb730a176c638bf842118a61d58c52fe80e"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ3OTI1ODYz", "url": "https://github.com/hugegraph/hugegraph/pull/1289#pullrequestreview-547925863", "createdAt": "2020-12-09T08:06:40Z", "commit": {"oid": "d81a5c677a988c71da0380ab69ae93ac1e67b1cb"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ3OTkxODM0", "url": "https://github.com/hugegraph/hugegraph/pull/1289#pullrequestreview-547991834", "createdAt": "2020-12-09T09:30:36Z", "commit": {"oid": "d81a5c677a988c71da0380ab69ae93ac1e67b1cb"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2331, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}