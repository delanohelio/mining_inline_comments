{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY0NDM4MTcw", "number": 1265, "title": "Add SPI for logger", "bodyText": "Describe what this PR does / why we need it\nAdd SPI for logger.\nDoes this pull request fix one issue?\n#757 #1163 #1261\n\nDescribe how you did it\nDescribe how to verify it\n\nCreate a class which implements the {@link Logger} SPI interface\nUse a {@link LogTarget} to specify the log type\nImplement your own method\nAdd your logger in {@code com.alibaba.csp.sentinel.log.Logger} file which is stored in {@code resources/META-INF/services/} directory\n\nThe logback demo see sentinel-demo-log-logback module.\nSpecial notes for reviews", "createdAt": "2020-01-18T15:48:46Z", "url": "https://github.com/alibaba/Sentinel/pull/1265", "merged": true, "mergeCommit": {"oid": "5f203aa79f16d57939c5e6bbccf956934d650afe"}, "closed": true, "closedAt": "2020-02-21T03:24:01Z", "author": {"login": "xue8"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb5zJdPAH2gAyMzY0NDM4MTcwOjk4NjExN2FiY2U2YjdhNjlmMGZhNGIwNzkyODFiZDY1YTc4ZWRjZTE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABb84aD2AFqTM0NjcyOTUzNQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "986117abce6b7a69f0fa4b079281bd65a78edce1", "author": {"user": {"login": "xue8", "name": "xue8"}}, "url": "https://github.com/alibaba/Sentinel/commit/986117abce6b7a69f0fa4b079281bd65a78edce1", "committedDate": "2020-01-13T02:44:06Z", "message": "Fix hardcoded file separator"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "baffb93b837e17aa4dcfa2bce0955003d6e27e51", "author": {"user": {"login": "xue8", "name": "xue8"}}, "url": "https://github.com/alibaba/Sentinel/commit/baffb93b837e17aa4dcfa2bce0955003d6e27e51", "committedDate": "2020-01-18T13:18:00Z", "message": "Merge remote-tracking branch 'upstream/master'"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7124a6178738ade54615754e8afb338cc3d28bc4", "author": {"user": {"login": "xue8", "name": "xue8"}}, "url": "https://github.com/alibaba/Sentinel/commit/7124a6178738ade54615754e8afb338cc3d28bc4", "committedDate": "2020-01-18T15:38:35Z", "message": "Add SPI for logger"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ0OTk0OTQ2", "url": "https://github.com/alibaba/Sentinel/pull/1265#pullrequestreview-344994946", "createdAt": "2020-01-19T11:22:11Z", "commit": {"oid": "7124a6178738ade54615754e8afb338cc3d28bc4"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xOVQxMToyMjoxMVrOFfOaBg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xOVQxMTo1OToxMVrOFfOiTQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODI4NjIxNA==", "bodyText": "Because types in LogType share the same interface is it necessary enabling users specify the same implementation and merging all the logs?\nSomething like LogType[] value() and new type ALL in LogType.", "url": "https://github.com/alibaba/Sentinel/pull/1265#discussion_r368286214", "createdAt": "2020-01-19T11:22:11Z", "author": {"login": "jasonjoo2010"}, "path": "sentinel-core/src/main/java/com/alibaba/csp/sentinel/log/LogTarget.java", "diffHunk": "@@ -0,0 +1,13 @@\n+package com.alibaba.csp.sentinel.log;\n+\n+import java.lang.annotation.*;\n+\n+/**\n+ * @author xue8\n+ */\n+@Retention(RetentionPolicy.RUNTIME)\n+@Target(ElementType.TYPE)\n+@Documented\n+public @interface LogTarget {\n+    LogType value() default LogType.RECORD_LOG;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7124a6178738ade54615754e8afb338cc3d28bc4"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODI4NjI3MA==", "bodyText": "Is it necessary for us adding more levels like error, debug?", "url": "https://github.com/alibaba/Sentinel/pull/1265#discussion_r368286270", "createdAt": "2020-01-19T11:23:11Z", "author": {"login": "jasonjoo2010"}, "path": "sentinel-core/src/main/java/com/alibaba/csp/sentinel/log/Logger.java", "diffHunk": "@@ -0,0 +1,15 @@\n+package com.alibaba.csp.sentinel.log;\n+\n+/**\n+ * Provide logger SPI interface\n+ * @author xue8\n+ */\n+public interface Logger {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7124a6178738ade54615754e8afb338cc3d28bc4"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODI4Njk2MQ==", "bodyText": "And don't forget to add license to new files.", "url": "https://github.com/alibaba/Sentinel/pull/1265#discussion_r368286961", "createdAt": "2020-01-19T11:34:39Z", "author": {"login": "jasonjoo2010"}, "path": "sentinel-core/src/main/java/com/alibaba/csp/sentinel/log/Logger.java", "diffHunk": "@@ -0,0 +1,15 @@\n+package com.alibaba.csp.sentinel.log;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7124a6178738ade54615754e8afb338cc3d28bc4"}, "originalPosition": 1}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODI4NzEzNQ==", "bodyText": "I think it's better placing this kind of module into sentinel-log folder instead of treating it just as a demo.\nHow do you think about, @sczyh30", "url": "https://github.com/alibaba/Sentinel/pull/1265#discussion_r368287135", "createdAt": "2020-01-19T11:37:43Z", "author": {"login": "jasonjoo2010"}, "path": "sentinel-demo/sentinel-demo-log-logback/pom.xml", "diffHunk": "@@ -0,0 +1,34 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7124a6178738ade54615754e8afb338cc3d28bc4"}, "originalPosition": 1}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODI4NzMxOQ==", "bodyText": "May be the modifier should be clear as private and same as another implementation.", "url": "https://github.com/alibaba/Sentinel/pull/1265#discussion_r368287319", "createdAt": "2020-01-19T11:40:52Z", "author": {"login": "jasonjoo2010"}, "path": "sentinel-demo/sentinel-demo-log-logback/src/main/java/com/alibaba/csp/sentinel/demo/log/logback/CommandCenterLogLoggerImpl.java", "diffHunk": "@@ -0,0 +1,28 @@\n+package com.alibaba.csp.sentinel.demo.log.logback;\n+\n+import com.alibaba.csp.sentinel.log.LogTarget;\n+import com.alibaba.csp.sentinel.log.LogType;\n+import com.alibaba.csp.sentinel.log.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+@LogTarget(value = LogType.COMMAND_CENTER_LOG)\n+public class CommandCenterLogLoggerImpl implements Logger {\n+    org.slf4j.Logger logger = LoggerFactory.getLogger(\"commandCenterLogLogger\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7124a6178738ade54615754e8afb338cc3d28bc4"}, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODI4NzUwMQ==", "bodyText": "And maybe we should add a new property something like order to specify the priority because of we may implement several extensions for general logger like log4j/log4j2, logback, slf4j, commons-logging, etc.", "url": "https://github.com/alibaba/Sentinel/pull/1265#discussion_r368287501", "createdAt": "2020-01-19T11:43:45Z", "author": {"login": "jasonjoo2010"}, "path": "sentinel-core/src/main/java/com/alibaba/csp/sentinel/log/LogTarget.java", "diffHunk": "@@ -0,0 +1,13 @@\n+package com.alibaba.csp.sentinel.log;\n+\n+import java.lang.annotation.*;\n+\n+/**\n+ * @author xue8\n+ */\n+@Retention(RetentionPolicy.RUNTIME)\n+@Target(ElementType.TYPE)\n+@Documented\n+public @interface LogTarget {\n+    LogType value() default LogType.RECORD_LOG;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODI4NjIxNA=="}, "originalCommit": {"oid": "7124a6178738ade54615754e8afb338cc3d28bc4"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODI4NzU2MQ==", "bodyText": "Shall we add some assertion in this unit test?", "url": "https://github.com/alibaba/Sentinel/pull/1265#discussion_r368287561", "createdAt": "2020-01-19T11:45:10Z", "author": {"login": "jasonjoo2010"}, "path": "sentinel-demo/sentinel-demo-log-logback/src/test/java/com/alibaba/csp/sentinel/demo/log/logback/CommandCenterLogTest.java", "diffHunk": "@@ -0,0 +1,23 @@\n+package com.alibaba.csp.sentinel.demo.log.logback;\n+\n+import com.alibaba.csp.sentinel.log.CommandCenterLog;\n+import org.junit.Test;\n+\n+/**\n+ * @author xue8\n+ */\n+public class CommandCenterLogTest {\n+    @Test\n+    public void testLogException() {\n+        Exception e = new Exception(\"ex\");\n+        CommandCenterLog.info(\"Error\", e);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7124a6178738ade54615754e8afb338cc3d28bc4"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODI4ODExNA==", "bodyText": "Because we will not use it statically any more the handler can be non-static.", "url": "https://github.com/alibaba/Sentinel/pull/1265#discussion_r368288114", "createdAt": "2020-01-19T11:55:40Z", "author": {"login": "jasonjoo2010"}, "path": "sentinel-core/src/main/java/com/alibaba/csp/sentinel/log/RecordLogLogging.java", "diffHunk": "@@ -0,0 +1,39 @@\n+package com.alibaba.csp.sentinel.log;\n+\n+import java.util.logging.Handler;\n+import java.util.logging.Level;\n+import java.util.logging.Logger;\n+\n+/**\n+ * Default logger implementation.\n+ * @author xue8\n+ */\n+public class RecordLogLogging extends LogBase implements com.alibaba.csp.sentinel.log.Logger {\n+    private static final Logger heliumRecordLog = Logger.getLogger(\"cspSentinelRecordLog\");\n+    private static final String FILE_NAME = \"sentinel-record.log\";\n+    private static Handler logHandler = null;\n+\n+    static {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7124a6178738ade54615754e8afb338cc3d28bc4"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODI4ODMzMw==", "bodyText": "Because there maybe different implementation for placeholder in different logging system we'd better to clarify what kind of placeholder we use.\nFor example {}.", "url": "https://github.com/alibaba/Sentinel/pull/1265#discussion_r368288333", "createdAt": "2020-01-19T11:59:11Z", "author": {"login": "jasonjoo2010"}, "path": "sentinel-core/src/main/java/com/alibaba/csp/sentinel/log/Logger.java", "diffHunk": "@@ -0,0 +1,15 @@\n+package com.alibaba.csp.sentinel.log;\n+\n+/**\n+ * Provide logger SPI interface\n+ * @author xue8\n+ */\n+public interface Logger {\n+    void info(String detail, Object... params);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7124a6178738ade54615754e8afb338cc3d28bc4"}, "originalPosition": 8}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "da0551109b490a77a0abadb8a7635ab86afa405c", "author": {"user": {"login": "xue8", "name": "xue8"}}, "url": "https://github.com/alibaba/Sentinel/commit/da0551109b490a77a0abadb8a7635ab86afa405c", "committedDate": "2020-01-20T04:40:19Z", "message": "code fix"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "effad14ecc74e3683d9df8dc6f5c661891d84b9d", "author": {"user": {"login": "xue8", "name": "xue8"}}, "url": "https://github.com/alibaba/Sentinel/commit/effad14ecc74e3683d9df8dc6f5c661891d84b9d", "committedDate": "2020-01-20T06:19:31Z", "message": "fix line separator hard-coded"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ1MzkxNDE5", "url": "https://github.com/alibaba/Sentinel/pull/1265#pullrequestreview-345391419", "createdAt": "2020-01-20T15:40:16Z", "commit": {"oid": "effad14ecc74e3683d9df8dc6f5c661891d84b9d"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "604898e5303e650cfc4183711fd5c7ab4612722d", "author": {"user": {"login": "xue8", "name": "xue8"}}, "url": "https://github.com/alibaba/Sentinel/commit/604898e5303e650cfc4183711fd5c7ab4612722d", "committedDate": "2020-01-22T07:06:54Z", "message": "create adapters compatible with placeholders \u2018'{}'"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "971b127edfb7af29bbd572fb8ba7c7c6f2699e14", "author": {"user": {"login": "xue8", "name": "xue8"}}, "url": "https://github.com/alibaba/Sentinel/commit/971b127edfb7af29bbd572fb8ba7c7c6f2699e14", "committedDate": "2020-01-22T07:19:09Z", "message": "add {}"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ2NzI5NTM1", "url": "https://github.com/alibaba/Sentinel/pull/1265#pullrequestreview-346729535", "createdAt": "2020-01-22T16:33:32Z", "commit": {"oid": "971b127edfb7af29bbd572fb8ba7c7c6f2699e14"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4021, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}