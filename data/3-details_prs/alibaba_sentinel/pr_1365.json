{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk0ODQzMjQ4", "number": 1365, "title": "Set default log level to INFO of JDK logging and improve log info and comment in SpiLoader", "bodyText": "Describe what this PR does / why we need it\nRelate to #411\nImprove the log, comment and test case of SpiLoader.\nDoes this pull request fix one issue?\nNONE\nDescribe how you did it\nRename the method loadDifferentInstanceListSorted to loadPrototypeInstanceListSorted in SpiLoader, using RecordLog.debug in it instead of RecordLog.info, and use {} to print log.\nUse a static block to log the ProcessorSlot info loaded by SpiLoader in DefaultSlotChainBuilder, which is in order to facilitate log troubleshooting.\nDescribe how to verify it\nRun test case; Start dashboard, view log file to check.\nSpecial notes for reviews\nWhen using RecordLog.debug in SpiLoader#loadPrototypeInstanceListSorted, I found that the debug log messages are also printed in sentinel-record.log file. Feeling surprised, debug and check finally find one line in BaseJulLogger#makeLoggingHandler, which seems to be the reason.\nheliumRecordLog.setLevel(Level.ALL);\nAs default log level is usually INFO, so I changed it to heliumRecordLog.setLevel(Level.INFO); and it works as expected.\nPTAL.", "createdAt": "2020-03-27T16:11:38Z", "url": "https://github.com/alibaba/Sentinel/pull/1365", "merged": true, "mergeCommit": {"oid": "e1435974c6c592128401778f98b2b3d80ccbb89a"}, "closed": true, "closedAt": "2020-04-03T07:46:26Z", "author": {"login": "cdfive"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcRyi9bAH2gAyMzk0ODQzMjQ4OjFiZGJiZTc4YmI3NjZlNTJmYjhiYWYzZWQ1M2RkY2VjOTdlYWYyZjc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcTuM6lgFqTM4NjU1MjI3OA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "1bdbbe78bb766e52fb8baf3ed53ddcec97eaf2f7", "author": {"user": {"login": "cdfive", "name": null}}, "url": "https://github.com/alibaba/Sentinel/commit/1bdbbe78bb766e52fb8baf3ed53ddcec97eaf2f7", "committedDate": "2020-03-27T15:36:14Z", "message": "Improve log info in SpiLoader, improve comment and test case"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "84de476fdb5c7908ec398e11eeddc6aac6ec3781", "author": {"user": {"login": "cdfive", "name": null}}, "url": "https://github.com/alibaba/Sentinel/commit/84de476fdb5c7908ec398e11eeddc6aac6ec3781", "committedDate": "2020-03-27T16:25:32Z", "message": "Fix comment"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgzMzI4MDk1", "url": "https://github.com/alibaba/Sentinel/pull/1365#pullrequestreview-383328095", "createdAt": "2020-03-28T16:37:06Z", "commit": {"oid": "84de476fdb5c7908ec398e11eeddc6aac6ec3781"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yOFQxNjozNzowNlrOF9KqMA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yOFQxNjo0MjowNFrOF9KsWQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTY4MjA5Ng==", "bodyText": "Although these codes are not changed in this PR but i should point out there are two ways to optimize a little, just FYI:\n\nlist should have an initial capacity specified because we know it(Same to orderWrappers)\nIt's an in order copying so add(T obj) is enough and will make sense.", "url": "https://github.com/alibaba/Sentinel/pull/1365#discussion_r399682096", "createdAt": "2020-03-28T16:37:06Z", "author": {"login": "jasonjoo2010"}, "path": "sentinel-core/src/main/java/com/alibaba/csp/sentinel/util/SpiLoader.java", "diffHunk": "@@ -219,16 +233,16 @@\n                 int order = SpiOrderResolver.resolveOrder(spi);\n                 // Since SPI is lazy initialized in ServiceLoader, we use online sort algorithm here.\n                 SpiOrderResolver.insertSorted(orderWrappers, spi, order);\n-                RecordLog.info(\"[SpiLoader] Found {0} SPI: {1} with order \" + order, clazz.getSimpleName(),\n-                        spi.getClass().getCanonicalName());\n+                RecordLog.debug(\"[SpiLoader] Found {} SPI: {} with order {}\", clazz.getSimpleName(),\n+                        spi.getClass().getCanonicalName(), order);\n             }\n             List<T> list = new ArrayList<>();\n             for (int i = 0; i < orderWrappers.size(); i++) {\n                 list.add(i, orderWrappers.get(i).spi);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "84de476fdb5c7908ec398e11eeddc6aac6ec3781"}, "originalPosition": 99}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTY4MjY0OQ==", "bodyText": "warn and ERROR are a little confused(Although it's also not included in this PR actually).\nAnd after several iterations enhancing logging of Sentinel is it still necessary to use printStackTrace() directly? We just make a decision and go.", "url": "https://github.com/alibaba/Sentinel/pull/1365#discussion_r399682649", "createdAt": "2020-03-28T16:42:04Z", "author": {"login": "jasonjoo2010"}, "path": "sentinel-core/src/main/java/com/alibaba/csp/sentinel/util/SpiLoader.java", "diffHunk": "@@ -219,16 +233,16 @@\n                 int order = SpiOrderResolver.resolveOrder(spi);\n                 // Since SPI is lazy initialized in ServiceLoader, we use online sort algorithm here.\n                 SpiOrderResolver.insertSorted(orderWrappers, spi, order);\n-                RecordLog.info(\"[SpiLoader] Found {0} SPI: {1} with order \" + order, clazz.getSimpleName(),\n-                        spi.getClass().getCanonicalName());\n+                RecordLog.debug(\"[SpiLoader] Found {} SPI: {} with order {}\", clazz.getSimpleName(),\n+                        spi.getClass().getCanonicalName(), order);\n             }\n             List<T> list = new ArrayList<>();\n             for (int i = 0; i < orderWrappers.size(); i++) {\n                 list.add(i, orderWrappers.get(i).spi);\n             }\n             return list;\n         } catch (Throwable t) {\n-            RecordLog.warn(\"[SpiLoader] ERROR: loadDifferentInstanceListSorted failed\", t);\n+            RecordLog.warn(\"[SpiLoader] ERROR: loadPrototypeInstanceListSorted failed\", t);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "84de476fdb5c7908ec398e11eeddc6aac6ec3781"}, "originalPosition": 104}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2c2375141cebc07458eeca196acf91dd9b491175", "author": {"user": {"login": "cdfive", "name": null}}, "url": "https://github.com/alibaba/Sentinel/commit/2c2375141cebc07458eeca196acf91dd9b491175", "committedDate": "2020-03-29T02:28:49Z", "message": "Use error level in catch block, init ArrayList with capacity and improve add item to list"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgzMzY3NDU4", "url": "https://github.com/alibaba/Sentinel/pull/1365#pullrequestreview-383367458", "createdAt": "2020-03-29T02:45:35Z", "commit": {"oid": "2c2375141cebc07458eeca196acf91dd9b491175"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0b87c4840571323a99934481383f9aeba89b921f", "author": {"user": {"login": "cdfive", "name": null}}, "url": "https://github.com/alibaba/Sentinel/commit/0b87c4840571323a99934481383f9aeba89b921f", "committedDate": "2020-04-02T12:54:56Z", "message": "Remove static block for print log in DefaultSlotChainBuilder"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f8c5bf02118c7e0bc77f20e70f33afa10ff8d392", "author": {"user": {"login": "cdfive", "name": null}}, "url": "https://github.com/alibaba/Sentinel/commit/f8c5bf02118c7e0bc77f20e70f33afa10ff8d392", "committedDate": "2020-04-02T12:57:24Z", "message": "Fix comment in test case"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg2NTUyMjc4", "url": "https://github.com/alibaba/Sentinel/pull/1365#pullrequestreview-386552278", "createdAt": "2020-04-02T15:40:23Z", "commit": {"oid": "f8c5bf02118c7e0bc77f20e70f33afa10ff8d392"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3897, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}