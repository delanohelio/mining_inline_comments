{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTQyOTAwMzA5", "number": 1919, "title": "Support setting flush interval of the metric log via SentinelConfig property", "bodyText": "\u2026roperty\n\nDescribe what this PR does / why we need it\nadd a new feature to support control the flush interval of metric via sentinel config: csp.sentinel.metric.flush.interval\nDoes this pull request fix one issue?\n\nFixs 1867\nDescribe how you did it\nadd a new property in sentinel config(csp.sentinel.metric.flush.interval). control the metic timer start via this config.\n\nif the SentinelConfig#METRIC_FLUSH_INTERVAL more than 0, the timer will run with the SentinelConfig#METRIC_FLUSH_INTERVAL as the rate.\nif the SentinelConfig#METRIC_FLUSH_INTERVAL less than 0(include) or value is not valid, then means the timer will not be started.\n\nDescribe how to verify it\nchange the config value,  see the metric log file output and use jvm tool to see if the timer thread is started.\nSpecial notes for reviews", "createdAt": "2020-12-19T09:02:07Z", "url": "https://github.com/alibaba/Sentinel/pull/1919", "merged": true, "mergeCommit": {"oid": "a343873c813fc6fdb0404ca80b43ca9da83fa393"}, "closed": true, "closedAt": "2020-12-31T08:28:44Z", "author": {"login": "brotherlu-xcq"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdno1FaAH2gAyNTQyOTAwMzA5OjlkNDI3ZTU2MDE3NmRmYTE4ZGEyMGUwYjQ5ZTg5YWM5NWM3YWJmNTA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdrfpjCgFqTU2MDI5MjU1Ng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "9d427e560176dfa18da20e0b49e89ac95c7abf50", "author": {"user": {"login": "brotherlu-xcq", "name": null}}, "url": "https://github.com/alibaba/Sentinel/commit/9d427e560176dfa18da20e0b49e89ac95c7abf50", "committedDate": "2020-12-19T08:54:28Z", "message": "Support setting flush interval of the metric log via SentinelConfig property"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU5MDExMjY5", "url": "https://github.com/alibaba/Sentinel/pull/1919#pullrequestreview-559011269", "createdAt": "2020-12-28T06:26:59Z", "commit": {"oid": "9d427e560176dfa18da20e0b49e89ac95c7abf50"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yOFQwNjoyNjo1OVrOILyXVQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yOFQwNjoyNjo1OVrOILyXVQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTIzMDQyMQ==", "bodyText": "Can we add a metricLogFlushIntervalSec() method in SentinelConfig to resolve the metric flushing interval, and leverage the method here?", "url": "https://github.com/alibaba/Sentinel/pull/1919#discussion_r549230421", "createdAt": "2020-12-28T06:26:59Z", "author": {"login": "sczyh30"}, "path": "sentinel-core/src/main/java/com/alibaba/csp/sentinel/slots/block/flow/FlowRuleManager.java", "diffHunk": "@@ -61,9 +62,42 @@\n     static {\n         flowRules.set(Collections.<String, List<FlowRule>>emptyMap());\n         currentProperty.addListener(LISTENER);\n-        SCHEDULER.scheduleAtFixedRate(new MetricTimerListener(), 0, 1, TimeUnit.SECONDS);\n+        startMetricTimerListener();\n     }\n-\n+    \n+    /**\n+     * <p> Start the MetricTimerListener\n+     * <ol>\n+     *     <li>if the {@link SentinelConfig#METRIC_FLUSH_INTERVAL} more than 0,\n+     * the timer will run with the {@link SentinelConfig#METRIC_FLUSH_INTERVAL} as the rate </li>.\n+     *      <li>if the {@link SentinelConfig#METRIC_FLUSH_INTERVAL} less than 0(include) or value is not valid,\n+     * then means the timer will not be started </li>\n+     * <ol></p>\n+     */\n+    private static void startMetricTimerListener() {\n+        long flushInterval;\n+        String flushIntervalStr = SentinelConfig.getConfig(SentinelConfig.METRIC_FLUSH_INTERVAL);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9d427e560176dfa18da20e0b49e89ac95c7abf50"}, "originalPosition": 28}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "88b3db91c63e0d01c2bb9fe0e5592ad86d85d2b5", "author": {"user": {"login": "brotherlu-xcq", "name": null}}, "url": "https://github.com/alibaba/Sentinel/commit/88b3db91c63e0d01c2bb9fe0e5592ad86d85d2b5", "committedDate": "2020-12-28T07:28:43Z", "message": "move the metric flush interval time valid code to SentinelConfig"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "69f8894a5634911b6d09faa3e22e5f1fca779c70", "author": {"user": {"login": "brotherlu-xcq", "name": null}}, "url": "https://github.com/alibaba/Sentinel/commit/69f8894a5634911b6d09faa3e22e5f1fca779c70", "committedDate": "2020-12-28T07:30:04Z", "message": "remove constant the prefix in SentinelConfig"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTYwMjkyNTU2", "url": "https://github.com/alibaba/Sentinel/pull/1919#pullrequestreview-560292556", "createdAt": "2020-12-31T08:28:25Z", "commit": {"oid": "69f8894a5634911b6d09faa3e22e5f1fca779c70"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3888, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}