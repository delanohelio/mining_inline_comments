{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTM5MTAxNjI4", "number": 1896, "title": "Support HTTPS url for -Dcsp.sentinel.dashboard.server attribute", "bodyText": "Does this pull request fix one issue?\nFixes #1840\nDescribe how you did it\n\nThe involved HTTPS request is only heartbeat transmission,  so this PR takes the operation of trusting all certificates\nBecause the dashboard does not have a certificate configured by default, this modification does not involve the dashboard. The dashboard is a spring-boot project. If you need to use HTTPS, you need to configure it yourself\n\nDescribe how to verify it\nFirst we verify the https protocol:\n\nAdd ssl config in dashboard application.properties, like this one:\n\n\nserver.ssl.key-store=xxx/yyy.keystore\nserver.ssl.key-store-password=zzz\nserver.ssl.keyStoreType=JKS\nserver.ssl.keyAlias=aaa\n\nI used keytool to generate certificates\n2. Start a project that uses the modified jar with -Dcsp.sentinel.dashboard.server=https://127.0.0.1:8080\n3. Start the dashboard jar\n4. Use browser access https://127.0.0.1:8080, we can see that the dashboard has been able to receive the data of demo\nSecond, we verify the http protocol\n\nStart a project that uses the modified jar with -Dcsp.sentinel.dashboard.server=http://127.0.0.1:8080 or -Dcsp.sentinel.dashboard.server=127.0.0.1:8080\nStart the dashboard jar without ssl config\nUse browser access http://127.0.0.1:8080, also we can see the client.\n\nSpecial notes for reviews\n1.Is it necessary to set a certificate for the heartbeat of https?\n2.Whether it is necessary to set parameters for the dashboard so that the https protocol can be used (because users may directly use the jar package instead of compiling by themselves)", "createdAt": "2020-12-14T03:30:25Z", "url": "https://github.com/alibaba/Sentinel/pull/1896", "merged": true, "mergeCommit": {"oid": "82826fa8865197998080625747a9333943915ee8"}, "closed": true, "closedAt": "2020-12-16T01:34:40Z", "author": {"login": "polarbear567"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdl80RfAH2gAyNTM5MTAxNjI4OmNlMmIwYmJhZmViNjM2MDk3MDg4N2QyOWI0ZTE2MmYyMWFmMWY1ZjA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdmV58LgFqTU1MjE5OTY3NQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "ce2b0bbafeb6360970887d29b4e162f21af1f5f0", "author": {"user": {"login": "polarbear567", "name": null}}, "url": "https://github.com/alibaba/Sentinel/commit/ce2b0bbafeb6360970887d29b4e162f21af1f5f0", "committedDate": "2020-12-14T03:03:50Z", "message": "Support HTTPS url for -Dcsp.sentinel.dashboard.server attribute"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUxMDYxNzUz", "url": "https://github.com/alibaba/Sentinel/pull/1896#pullrequestreview-551061753", "createdAt": "2020-12-14T05:54:28Z", "commit": {"oid": "ce2b0bbafeb6360970887d29b4e162f21af1f5f0"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNFQwNTo1NDoyOVrOIFA9OQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNFQwNjoxMDowMlrOIFBRPA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjEyOTQ2NQ==", "bodyText": "Please fix up the indents.", "url": "https://github.com/alibaba/Sentinel/pull/1896#discussion_r542129465", "createdAt": "2020-12-14T05:54:29Z", "author": {"login": "jasonjoo2010"}, "path": "sentinel-transport/sentinel-transport-common/src/main/java/com/alibaba/csp/sentinel/transport/config/TransportConfig.java", "diffHunk": "@@ -92,11 +95,17 @@ public static Long getHeartbeatIntervalMs() {\n                 continue;\n             }\n             ipPortStr = ipPortStr.trim();\n-            if (ipPortStr.startsWith(\"http://\")) {\n-                ipPortStr = ipPortStr.substring(7);\n-            }\n-            int index = ipPortStr.indexOf(\":\");\n-            int port = 80;\n+\t\t\tint port = 80;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ce2b0bbafeb6360970887d29b4e162f21af1f5f0"}, "originalPosition": 26}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjEzMTA0MA==", "bodyText": "I suggest using an enum type to make it easy to compare.\nAnd the protocol should not be a global state but be a kind of state in the addr-port pairs.", "url": "https://github.com/alibaba/Sentinel/pull/1896#discussion_r542131040", "createdAt": "2020-12-14T05:59:21Z", "author": {"login": "jasonjoo2010"}, "path": "sentinel-transport/sentinel-transport-common/src/main/java/com/alibaba/csp/sentinel/transport/config/TransportConfig.java", "diffHunk": "@@ -40,6 +41,8 @@\n \n     private static int runtimePort = -1;\n \n+\tprivate static String protocol = \"http\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ce2b0bbafeb6360970887d29b4e162f21af1f5f0"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjEzMTQwMw==", "bodyText": "Here an \"ELSE\" should be introduced as a different condition branch.", "url": "https://github.com/alibaba/Sentinel/pull/1896#discussion_r542131403", "createdAt": "2020-12-14T06:00:19Z", "author": {"login": "jasonjoo2010"}, "path": "sentinel-transport/sentinel-transport-common/src/main/java/com/alibaba/csp/sentinel/transport/config/TransportConfig.java", "diffHunk": "@@ -92,11 +95,17 @@ public static Long getHeartbeatIntervalMs() {\n                 continue;\n             }\n             ipPortStr = ipPortStr.trim();\n-            if (ipPortStr.startsWith(\"http://\")) {\n-                ipPortStr = ipPortStr.substring(7);\n-            }\n-            int index = ipPortStr.indexOf(\":\");\n-            int port = 80;\n+\t\t\tint port = 80;\n+\t\t\tif (ipPortStr.startsWith(\"http://\")) {\n+\t\t\t\tipPortStr = ipPortStr.substring(7);\n+\t\t\t\tport = 80;\n+\t\t\t}\n+\t\t\tif (ipPortStr.startsWith(\"https://\")) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ce2b0bbafeb6360970887d29b4e162f21af1f5f0"}, "originalPosition": 31}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjEzMjAxNw==", "bodyText": "If a new type was introduced it's highly recommended to pass it into query implementations directly.", "url": "https://github.com/alibaba/Sentinel/pull/1896#discussion_r542132017", "createdAt": "2020-12-14T06:02:07Z", "author": {"login": "jasonjoo2010"}, "path": "sentinel-transport/sentinel-transport-simple-http/src/main/java/com/alibaba/csp/sentinel/transport/heartbeat/SimpleHttpHeartbeatSender.java", "diffHunk": "@@ -69,7 +70,7 @@ public boolean sendHeartbeat() throws Exception {\n         }\n \n         InetSocketAddress addr = new InetSocketAddress(addrInfo.r1, addrInfo.r2);\n-        SimpleHttpRequest request = new SimpleHttpRequest(addr, TransportConfig.getHeartbeatApiPath());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ce2b0bbafeb6360970887d29b4e162f21af1f5f0"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjEzMzcwMg==", "bodyText": "Maybe it doesn't make any sense here?", "url": "https://github.com/alibaba/Sentinel/pull/1896#discussion_r542133702", "createdAt": "2020-12-14T06:07:12Z", "author": {"login": "jasonjoo2010"}, "path": "sentinel-transport/sentinel-transport-simple-http/src/main/java/com/alibaba/csp/sentinel/transport/heartbeat/client/SimpleHttpClient.java", "diffHunk": "@@ -77,57 +90,73 @@ public SimpleHttpResponse post(SimpleHttpRequest request) throws IOException {\n         if (request == null) {\n             return null;\n         }\n-        return request(request.getSocketAddress(),\n+        return request(request.getProtocol(), request.getSocketAddress(),\n             RequestMethod.POST, request.getRequestPath(),\n             request.getParams(), request.getCharset(),\n             request.getSoTimeout());\n     }\n \n+\tprivate SimpleHttpResponse request(String protocol, InetSocketAddress socketAddress,\n+\t\t\t\t\t\t\t\t\t   RequestMethod type, String requestPath,\n+\t\t\t\t\t\t\t\t\t   Map<String, String> paramsMap, Charset charset, int soTimeout)\n+\t\t\tthrows IOException {\n+\t\tSocket socket = null;\n+\t\tBufferedWriter writer;\n+\t\ttry {\n+\t\t\tif (StringUtil.equals(protocol, \"http\")) {\n+\t\t\t\tsocket = new Socket();\n+\t\t\t} else if (StringUtil.equals(protocol, \"https\")){\n+\t\t\t\tsslSocketFactory = getSSLSocketFactory();\n+\t\t\t\tif (sslSocketFactory != null) {\n+\t\t\t\t\tsocket = sslSocketFactory.createSocket();\n+\t\t\t\t} else {\n+\t\t\t\t\tsocket = new Socket();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ce2b0bbafeb6360970887d29b4e162f21af1f5f0"}, "originalPosition": 59}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjEzNDU4OA==", "bodyText": "The All-In-One approach makes the class a little ambiguous.\nSuggest abstracting the socket creation into different implementations outside.", "url": "https://github.com/alibaba/Sentinel/pull/1896#discussion_r542134588", "createdAt": "2020-12-14T06:10:02Z", "author": {"login": "jasonjoo2010"}, "path": "sentinel-transport/sentinel-transport-simple-http/src/main/java/com/alibaba/csp/sentinel/transport/heartbeat/client/SimpleHttpClient.java", "diffHunk": "@@ -184,6 +213,50 @@ private String encodeRequestParams(Map<String, String> paramsMap, Charset charse\n         }\n     }\n \n+\tprivate X509TrustManager getX509TrustManager() {\n+\t\tif (x509TrustManager == null) {\n+\t\t\tx509TrustManager = new X509TrustManager() {\n+\t\t\t\tpublic boolean isServerTrusted(X509Certificate[] certs) {\n+\t\t\t\t\treturn true;\n+\t\t\t\t}\n+\n+\t\t\t\tpublic boolean isClientTrusted(X509Certificate[] certs) {\n+\t\t\t\t\treturn true;\n+\t\t\t\t}\n+\n+\t\t\t\t@Override\n+\t\t\t\tpublic void checkServerTrusted(X509Certificate[] certs, String authType)\n+\t\t\t\t\t\tthrows CertificateException {\n+\t\t\t\t}\n+\n+\t\t\t\t@Override\n+\t\t\t\tpublic void checkClientTrusted(X509Certificate[] certs, String authType)\n+\t\t\t\t\t\tthrows CertificateException {\n+\t\t\t\t}\n+\n+\t\t\t\t@Override\n+\t\t\t\tpublic X509Certificate[] getAcceptedIssuers() {\n+\t\t\t\t\treturn null;\n+\t\t\t\t}\n+\t\t\t};\n+\t\t}\n+\t\treturn x509TrustManager;\n+\t}\n+\n+\tprivate SSLSocketFactory getSSLSocketFactory() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ce2b0bbafeb6360970887d29b4e162f21af1f5f0"}, "originalPosition": 184}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f64d511e8f204a11c3388d6cce8fa873a8d22d40", "author": {"user": {"login": "polarbear567", "name": null}}, "url": "https://github.com/alibaba/Sentinel/commit/f64d511e8f204a11c3388d6cce8fa873a8d22d40", "committedDate": "2020-12-14T10:03:33Z", "message": "fix and optimize"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUxNDc3ODUy", "url": "https://github.com/alibaba/Sentinel/pull/1896#pullrequestreview-551477852", "createdAt": "2020-12-14T15:26:01Z", "commit": {"oid": "f64d511e8f204a11c3388d6cce8fa873a8d22d40"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNFQxNToyNjowMVrOIFV2fA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNFQxNTo0NTo1NVrOIFW2yA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjQ3MTgwNA==", "bodyText": "\ud83d\ude05Is it better to put them in transport-common instead of the core package?\nOr are there other pieces of code outside the transport module depending on them?", "url": "https://github.com/alibaba/Sentinel/pull/1896#discussion_r542471804", "createdAt": "2020-12-14T15:26:01Z", "author": {"login": "jasonjoo2010"}, "path": "sentinel-core/src/main/java/com/alibaba/csp/sentinel/util/function/Endpoint.java", "diffHunk": "@@ -0,0 +1,53 @@\n+package com.alibaba.csp.sentinel.util.function;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f64d511e8f204a11c3388d6cce8fa873a8d22d40"}, "originalPosition": 1}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjQ3NDY0MA==", "bodyText": "And please function makes little sense here. I believe you really can figure out a good naming\ud83d\udcaa", "url": "https://github.com/alibaba/Sentinel/pull/1896#discussion_r542474640", "createdAt": "2020-12-14T15:29:23Z", "author": {"login": "jasonjoo2010"}, "path": "sentinel-core/src/main/java/com/alibaba/csp/sentinel/util/function/Endpoint.java", "diffHunk": "@@ -0,0 +1,53 @@\n+package com.alibaba.csp.sentinel.util.function;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjQ3MTgwNA=="}, "originalCommit": {"oid": "f64d511e8f204a11c3388d6cce8fa873a8d22d40"}, "originalPosition": 1}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjQ3NjMzNg==", "bodyText": "It's strange to put such a piece of code here but I won't consist on it. It looks like no harm.", "url": "https://github.com/alibaba/Sentinel/pull/1896#discussion_r542476336", "createdAt": "2020-12-14T15:31:30Z", "author": {"login": "jasonjoo2010"}, "path": "sentinel-core/src/main/java/com/alibaba/csp/sentinel/util/function/Endpoint.java", "diffHunk": "@@ -0,0 +1,53 @@\n+package com.alibaba.csp.sentinel.util.function;\n+\n+import java.net.InetSocketAddress;\n+\n+/**\n+ * @author Leo Li\n+ */\n+public class Endpoint {\n+    private Protocol protocol;\n+\n+    private String host;\n+\n+    private int port;\n+\n+    public Endpoint(Protocol protocol, String host, int port) {\n+        this.protocol = protocol;\n+        this.host = host;\n+        this.port = port;\n+    }\n+\n+    public Protocol getProtocol() {\n+        return protocol;\n+    }\n+\n+    public void setProtocol(Protocol protocol) {\n+        this.protocol = protocol;\n+    }\n+\n+    public String getHost() {\n+        return host;\n+    }\n+\n+    public void setHost(String host) {\n+        this.host = host;\n+    }\n+\n+    public int getPort() {\n+        return port;\n+    }\n+\n+    public void setPort(int port) {\n+        this.port = port;\n+    }\n+\n+    public InetSocketAddress getInetSocketAddress() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f64d511e8f204a11c3388d6cce8fa873a8d22d40"}, "originalPosition": 45}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjQ4NTM1NA==", "bodyText": "There is a small tweak here.\nIt would be better to make sslSocketFactory initialized only if necessary.", "url": "https://github.com/alibaba/Sentinel/pull/1896#discussion_r542485354", "createdAt": "2020-12-14T15:42:20Z", "author": {"login": "jasonjoo2010"}, "path": "sentinel-transport/sentinel-transport-simple-http/src/main/java/com/alibaba/csp/sentinel/transport/heartbeat/client/SocketFactory.java", "diffHunk": "@@ -0,0 +1,62 @@\n+package com.alibaba.csp.sentinel.transport.heartbeat.client;\n+\n+import java.io.IOException;\n+import java.net.Socket;\n+import java.security.cert.CertificateException;\n+import java.security.cert.X509Certificate;\n+\n+import javax.net.ssl.SSLContext;\n+import javax.net.ssl.SSLSocketFactory;\n+import javax.net.ssl.TrustManager;\n+import javax.net.ssl.X509TrustManager;\n+\n+import com.alibaba.csp.sentinel.log.RecordLog;\n+import com.alibaba.csp.sentinel.util.function.Protocol;\n+\n+/**\n+ * @author Leo Li\n+ */\n+public class SocketFactory {\n+    private static X509TrustManager x509TrustManager;\n+    private static SSLContext sslContext;\n+    private static SSLSocketFactory sslSocketFactory;\n+\n+    static {\n+        try {\n+            x509TrustManager = new X509TrustManager() {\n+                public boolean isServerTrusted(X509Certificate[] certs) {\n+                    return true;\n+                }\n+\n+                public boolean isClientTrusted(X509Certificate[] certs) {\n+                    return true;\n+                }\n+\n+                @Override\n+                public void checkServerTrusted(X509Certificate[] certs, String authType)\n+                        throws CertificateException {\n+                }\n+\n+                @Override\n+                public void checkClientTrusted(X509Certificate[] certs, String authType)\n+                        throws CertificateException {\n+                }\n+\n+                @Override\n+                public X509Certificate[] getAcceptedIssuers() {\n+                    return null;\n+                }\n+            };\n+\n+            sslContext = SSLContext.getInstance(\"TLS\");\n+            sslContext.init(null, new TrustManager[] { x509TrustManager }, null);\n+            sslSocketFactory = sslContext.getSocketFactory();\n+        } catch (Exception e) {\n+            RecordLog.error(\"get ssl socket factory error\", e);\n+        }\n+    }\n+\n+    public static Socket getSocket(Protocol protocol) throws IOException {\n+        return protocol == Protocol.HTTP ? new Socket() : sslSocketFactory.createSocket();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f64d511e8f204a11c3388d6cce8fa873a8d22d40"}, "originalPosition": 60}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjQ4ODI2NA==", "bodyText": "Maybe HTTPS support is not implemented in netty-http module.", "url": "https://github.com/alibaba/Sentinel/pull/1896#discussion_r542488264", "createdAt": "2020-12-14T15:45:55Z", "author": {"login": "jasonjoo2010"}, "path": "sentinel-transport/sentinel-transport-netty-http/src/main/java/com/alibaba/csp/sentinel/transport/heartbeat/HttpHeartbeatSender.java", "diffHunk": "@@ -59,14 +59,14 @@\n \n     public HttpHeartbeatSender() {\n         this.client = HttpClients.createDefault();\n-        List<Tuple2<String, Integer>> dashboardList = TransportConfig.getConsoleServerList();\n+        List<Endpoint> dashboardList = TransportConfig.getConsoleServerList();\n         if (dashboardList == null || dashboardList.isEmpty()) {\n             RecordLog.info(\"[NettyHttpHeartbeatSender] No dashboard server available\");\n             consoleHost = null;\n             consolePort = -1;\n         } else {\n-            consoleHost = dashboardList.get(0).r1;\n-            consolePort = dashboardList.get(0).r2;\n+            consoleHost = dashboardList.get(0).getHost();\n+            consolePort = dashboardList.get(0).getPort();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f64d511e8f204a11c3388d6cce8fa873a8d22d40"}, "originalPosition": 23}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3fb45d4802d5e7bbe27e2164ded88f4bccb544ac", "author": {"user": {"login": "polarbear567", "name": null}}, "url": "https://github.com/alibaba/Sentinel/commit/3fb45d4802d5e7bbe27e2164ded88f4bccb544ac", "committedDate": "2020-12-15T05:48:56Z", "message": "optimize and support https for netty http"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ad8d0af86693d2779f0a5b43c92a10b58d1daff3", "author": {"user": {"login": "polarbear567", "name": null}}, "url": "https://github.com/alibaba/Sentinel/commit/ad8d0af86693d2779f0a5b43c92a10b58d1daff3", "committedDate": "2020-12-15T06:17:58Z", "message": "fix test error"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUyMTMzOTQz", "url": "https://github.com/alibaba/Sentinel/pull/1896#pullrequestreview-552133943", "createdAt": "2020-12-15T06:14:03Z", "commit": {"oid": "3fb45d4802d5e7bbe27e2164ded88f4bccb544ac"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNVQwNjoxNDowM1rOIF6nhA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNVQwNjo0Mjo0NlrOIF7Ucw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzA3NDE4MA==", "bodyText": "What's the difference between the wrapped form and Class.varible form?", "url": "https://github.com/alibaba/Sentinel/pull/1896#discussion_r543074180", "createdAt": "2020-12-15T06:14:03Z", "author": {"login": "jasonjoo2010"}, "path": "sentinel-transport/sentinel-transport-simple-http/src/main/java/com/alibaba/csp/sentinel/transport/heartbeat/client/SocketFactory.java", "diffHunk": "@@ -0,0 +1,27 @@\n+package com.alibaba.csp.sentinel.transport.heartbeat.client;\n+\n+import java.io.IOException;\n+import java.net.Socket;\n+\n+import javax.net.ssl.SSLSocketFactory;\n+\n+import com.alibaba.csp.sentinel.transport.endpoint.Protocol;\n+import com.alibaba.csp.sentinel.transport.ssl.SslFactory;\n+\n+/**\n+ * @author Leo Li\n+ */\n+public class SocketFactory {\n+\n+    private static class SSLSocketFactoryInstance {\n+        private static final SSLSocketFactory SSL_SOCKET_FACTORY = SslFactory.getSslConnectionSocketFactory().getSocketFactory();\n+    }\n+\n+    public static Socket getSocket(Protocol protocol) throws IOException {\n+        return protocol == Protocol.HTTP ? new Socket() : getSslSocketFactory().createSocket();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3fb45d4802d5e7bbe27e2164ded88f4bccb544ac"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzA3NTMyOQ==", "bodyText": "I just wrote a small piece testing code and didn't find any different.", "url": "https://github.com/alibaba/Sentinel/pull/1896#discussion_r543075329", "createdAt": "2020-12-15T06:16:59Z", "author": {"login": "jasonjoo2010"}, "path": "sentinel-transport/sentinel-transport-simple-http/src/main/java/com/alibaba/csp/sentinel/transport/heartbeat/client/SocketFactory.java", "diffHunk": "@@ -0,0 +1,27 @@\n+package com.alibaba.csp.sentinel.transport.heartbeat.client;\n+\n+import java.io.IOException;\n+import java.net.Socket;\n+\n+import javax.net.ssl.SSLSocketFactory;\n+\n+import com.alibaba.csp.sentinel.transport.endpoint.Protocol;\n+import com.alibaba.csp.sentinel.transport.ssl.SslFactory;\n+\n+/**\n+ * @author Leo Li\n+ */\n+public class SocketFactory {\n+\n+    private static class SSLSocketFactoryInstance {\n+        private static final SSLSocketFactory SSL_SOCKET_FACTORY = SslFactory.getSslConnectionSocketFactory().getSocketFactory();\n+    }\n+\n+    public static Socket getSocket(Protocol protocol) throws IOException {\n+        return protocol == Protocol.HTTP ? new Socket() : getSslSocketFactory().createSocket();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzA3NDE4MA=="}, "originalCommit": {"oid": "3fb45d4802d5e7bbe27e2164ded88f4bccb544ac"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzA3NzQ5Mw==", "bodyText": "\ud83e\udd12Do you forget to remove the useless main?", "url": "https://github.com/alibaba/Sentinel/pull/1896#discussion_r543077493", "createdAt": "2020-12-15T06:22:29Z", "author": {"login": "jasonjoo2010"}, "path": "sentinel-transport/sentinel-transport-common/src/main/java/com/alibaba/csp/sentinel/transport/endpoint/Protocol.java", "diffHunk": "@@ -0,0 +1,23 @@\n+package com.alibaba.csp.sentinel.transport.endpoint;\n+\n+/**\n+ * @author Leo Li\n+ */\n+public enum Protocol {\n+    HTTP(\"http\"),\n+    HTTPS(\"https\");\n+\n+    private String protocol;\n+\n+    Protocol(String protocol) {\n+        this.protocol = protocol;\n+    }\n+\n+    public String getProtocol() {\n+        return protocol;\n+    }\n+\n+    public static void main(String[] args) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3fb45d4802d5e7bbe27e2164ded88f4bccb544ac"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzA4NTY4Mw==", "bodyText": "Hi @sczyh30\nIs bypass certificate verifying acceptable?\nI don't insist on it.", "url": "https://github.com/alibaba/Sentinel/pull/1896#discussion_r543085683", "createdAt": "2020-12-15T06:42:46Z", "author": {"login": "jasonjoo2010"}, "path": "sentinel-transport/sentinel-transport-netty-http/src/main/java/com/alibaba/csp/sentinel/transport/heartbeat/client/HttpClientsFactory.java", "diffHunk": "@@ -0,0 +1,23 @@\n+package com.alibaba.csp.sentinel.transport.heartbeat.client;\n+\n+import com.alibaba.csp.sentinel.transport.endpoint.Protocol;\n+import com.alibaba.csp.sentinel.transport.ssl.SslFactory;\n+import org.apache.http.conn.ssl.NoopHostnameVerifier;\n+import org.apache.http.conn.ssl.SSLConnectionSocketFactory;\n+import org.apache.http.impl.client.CloseableHttpClient;\n+import org.apache.http.impl.client.HttpClients;\n+\n+/**\n+ * @author Leo Li\n+ */\n+public class HttpClientsFactory {\n+\n+    private static class SslConnectionSocketFactoryInstance {\n+        private static final SSLConnectionSocketFactory SSL_CONNECTION_SOCKET_FACTORY = new SSLConnectionSocketFactory(SslFactory.getSslConnectionSocketFactory(), NoopHostnameVerifier.INSTANCE);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ad8d0af86693d2779f0a5b43c92a10b58d1daff3"}, "originalPosition": 16}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "35a9e4d26f24f8971590ab69db3326a544d5a157", "author": {"user": {"login": "polarbear567", "name": null}}, "url": "https://github.com/alibaba/Sentinel/commit/35a9e4d26f24f8971590ab69db3326a544d5a157", "committedDate": "2020-12-15T07:47:24Z", "message": "optimize"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUyMTk5Njc1", "url": "https://github.com/alibaba/Sentinel/pull/1896#pullrequestreview-552199675", "createdAt": "2020-12-15T08:17:39Z", "commit": {"oid": "35a9e4d26f24f8971590ab69db3326a544d5a157"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3885, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}