{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTEwOTMxOTQ2", "number": 1825, "title": "[Adapter] Support motan RPC", "bodyText": "2\u3001the design is reference dubbo\n\nDescribe what this PR does / why we need it\n    support motan rpc\n\nDoes this pull request fix one issue?\n    Fixes #1803\n\n\nDescribe how you did it\n  the design is reference dubbo\n\nDescribe how to verify it\n  Have sentinel-demo-motan module\uff0crun SentinelMotanConsumerService and SentinelMotanProviderService\n\nSpecial notes for reviews", "createdAt": "2020-10-27T17:27:31Z", "url": "https://github.com/alibaba/Sentinel/pull/1825", "merged": true, "mergeCommit": {"oid": "6719ceef65258aa691e0424967ac9b5865c9ee2b"}, "closed": true, "closedAt": "2020-12-05T05:56:37Z", "author": {"login": "zhangxn8"}, "timelineItems": {"totalCount": 19, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdWsQJrAH2gAyNTEwOTMxOTQ2OmQwYTE2NDBlZWRiODk4NDZjMWE3MTcwYTUyMWE4ODQxZmNhYWI5NmE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdjF4R9gFqTU0NTQxNDQwMQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "d0a1640eedb89846c1a7170a521a8841fcaab96a", "author": {"user": {"login": "zhangxn8", "name": "zhangxn"}}, "url": "https://github.com/alibaba/Sentinel/commit/d0a1640eedb89846c1a7170a521a8841fcaab96a", "committedDate": "2020-10-27T17:17:02Z", "message": "1\u3001support motan rpc\n2\u3001the design is reference dubbo"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI1NjMwNDYx", "url": "https://github.com/alibaba/Sentinel/pull/1825#pullrequestreview-525630461", "createdAt": "2020-11-07T06:02:20Z", "commit": {"oid": "d0a1640eedb89846c1a7170a521a8841fcaab96a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wN1QwNjowMjoyMFrOHvElTw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wN1QwNjowMjoyMFrOHvElTw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTEyMDIwNw==", "bodyText": "This filter doesn't seem to work, is the key = MotanConstants.NODE_TYPE_REFERER missing?\nlike SentinelMotanConsumerFilter.", "url": "https://github.com/alibaba/Sentinel/pull/1825#discussion_r519120207", "createdAt": "2020-11-07T06:02:20Z", "author": {"login": "cdfive"}, "path": "sentinel-adapter/sentinel-motan-adapter/src/main/java/com/alibaba/csp/sentinel/adapter/motan/MotanAppContextFilter.java", "diffHunk": "@@ -0,0 +1,31 @@\n+package com.alibaba.csp.sentinel.adapter.motan;\n+\n+import com.weibo.api.motan.core.extension.Activation;\n+import com.weibo.api.motan.core.extension.SpiMeta;\n+import com.weibo.api.motan.filter.Filter;\n+import com.weibo.api.motan.rpc.Caller;\n+import com.weibo.api.motan.rpc.Request;\n+import com.weibo.api.motan.rpc.Response;\n+import com.weibo.api.motan.rpc.RpcContext;\n+\n+import java.util.Map;\n+\n+/**\n+ * program: sentinel-parent\n+ * description: ${description}\n+ * author: zxn\n+ * create: 2020-10-28 00:28\n+ **/\n+@SpiMeta(name = \"motanAppContext\")\n+@Activation(sequence = 2)\n+public class MotanAppContextFilter implements Filter {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d0a1640eedb89846c1a7170a521a8841fcaab96a"}, "originalPosition": 21}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI1NjMwNjkz", "url": "https://github.com/alibaba/Sentinel/pull/1825#pullrequestreview-525630693", "createdAt": "2020-11-07T06:07:26Z", "commit": {"oid": "d0a1640eedb89846c1a7170a521a8841fcaab96a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wN1QwNjowNzoyN1rOHvEqUg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wN1QwNjowNzoyN1rOHvEqUg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTEyMTQ5MA==", "bodyText": "It is suggested to add a space to the right of =, like key = MotanConstants.NODE_TYPE_REFERER, for better format.\nBesides, create date can be removed to unified with other files.", "url": "https://github.com/alibaba/Sentinel/pull/1825#discussion_r519121490", "createdAt": "2020-11-07T06:07:27Z", "author": {"login": "cdfive"}, "path": "sentinel-adapter/sentinel-motan-adapter/src/main/java/com/alibaba/csp/sentinel/adapter/motan/SentinelMotanConsumerFilter.java", "diffHunk": "@@ -0,0 +1,71 @@\n+package com.alibaba.csp.sentinel.adapter.motan;\n+\n+import com.alibaba.csp.sentinel.*;\n+import com.alibaba.csp.sentinel.adapter.motan.config.MotanAdapterGlobalConfig;\n+import com.alibaba.csp.sentinel.log.RecordLog;\n+import com.alibaba.csp.sentinel.slots.block.BlockException;\n+import com.weibo.api.motan.common.MotanConstants;\n+import com.weibo.api.motan.core.extension.Activation;\n+import com.weibo.api.motan.core.extension.SpiMeta;\n+import com.weibo.api.motan.exception.MotanAbstractException;\n+import com.weibo.api.motan.rpc.Caller;\n+import com.weibo.api.motan.rpc.Request;\n+import com.weibo.api.motan.rpc.Response;\n+\n+/**\n+ * program: sentinel-parent\n+ * description: ${description}\n+ * author: zxn\n+ * create: 2020-10-28 00:41\n+ **/\n+@Activation(key =MotanConstants.NODE_TYPE_REFERER)\n+@SpiMeta(name = \"sentinelMotanConsumer\")\n+public class SentinelMotanConsumerFilter extends BaseMotanSentinelFilter {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d0a1640eedb89846c1a7170a521a8841fcaab96a"}, "originalPosition": 23}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI1NjMwNzc0", "url": "https://github.com/alibaba/Sentinel/pull/1825#pullrequestreview-525630774", "createdAt": "2020-11-07T06:09:09Z", "commit": {"oid": "d0a1640eedb89846c1a7170a521a8841fcaab96a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wN1QwNjowOToxMFrOHvEr_Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wN1QwNjowOToxMFrOHvEr_Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTEyMTkxNw==", "bodyText": "Should it use MotanAdapterGlobalConfig#getMotanProviderPrefix() here?", "url": "https://github.com/alibaba/Sentinel/pull/1825#discussion_r519121917", "createdAt": "2020-11-07T06:09:10Z", "author": {"login": "cdfive"}, "path": "sentinel-adapter/sentinel-motan-adapter/src/main/java/com/alibaba/csp/sentinel/adapter/motan/SentinelMotanProviderFilter.java", "diffHunk": "@@ -0,0 +1,74 @@\n+package com.alibaba.csp.sentinel.adapter.motan;\n+\n+import com.alibaba.csp.sentinel.*;\n+import com.alibaba.csp.sentinel.adapter.motan.config.MotanAdapterGlobalConfig;\n+import com.alibaba.csp.sentinel.context.ContextUtil;\n+import com.alibaba.csp.sentinel.log.RecordLog;\n+import com.alibaba.csp.sentinel.slots.block.BlockException;\n+import com.weibo.api.motan.common.MotanConstants;\n+import com.weibo.api.motan.core.extension.Activation;\n+import com.weibo.api.motan.core.extension.SpiMeta;\n+import com.weibo.api.motan.exception.MotanAbstractException;\n+import com.weibo.api.motan.rpc.Caller;\n+import com.weibo.api.motan.rpc.Request;\n+import com.weibo.api.motan.rpc.Response;\n+\n+/**\n+ * program: sentinel-parent\n+ * description: ${description}\n+ * author: zxn\n+ * create: 2020-10-28 00:44\n+ **/\n+@Activation(key =MotanConstants.NODE_TYPE_SERVICE)\n+@SpiMeta(name = \"sentinelMotanProvider\")\n+public class SentinelMotanProviderFilter extends BaseMotanSentinelFilter {\n+\n+    public SentinelMotanProviderFilter(){\n+        RecordLog.info(\"Sentinel motan provider filter initialized\");\n+    }\n+\n+    @Override\n+    String getMethodName(Caller<?> caller, Request request, String prefix) {\n+        return MotanUtils.getMethodResourceName(caller, request, prefix);\n+    }\n+\n+    @Override\n+    String getInterfaceName(Caller<?> caller, String prefix) {\n+        return MotanUtils.getInterfaceName(caller, prefix);\n+    }\n+\n+    @Override\n+    public Response filter(Caller<?> caller, Request request) {\n+        Entry interfaceEntry = null;\n+        Entry methodEntry = null;\n+        String prefix = \"\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d0a1640eedb89846c1a7170a521a8841fcaab96a"}, "originalPosition": 44}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI1NjMwODc3", "url": "https://github.com/alibaba/Sentinel/pull/1825#pullrequestreview-525630877", "createdAt": "2020-11-07T06:11:18Z", "commit": {"oid": "d0a1640eedb89846c1a7170a521a8841fcaab96a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wN1QwNjoxMToxOFrOHvEuRg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wN1QwNjoxMToxOFrOHvEuRg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTEyMjUwMg==", "bodyText": "The origin is \"\", which doesn't use the application of consumer,  refer to MotanAppContextFilter.", "url": "https://github.com/alibaba/Sentinel/pull/1825#discussion_r519122502", "createdAt": "2020-11-07T06:11:18Z", "author": {"login": "cdfive"}, "path": "sentinel-adapter/sentinel-motan-adapter/src/main/java/com/alibaba/csp/sentinel/adapter/motan/SentinelMotanProviderFilter.java", "diffHunk": "@@ -0,0 +1,74 @@\n+package com.alibaba.csp.sentinel.adapter.motan;\n+\n+import com.alibaba.csp.sentinel.*;\n+import com.alibaba.csp.sentinel.adapter.motan.config.MotanAdapterGlobalConfig;\n+import com.alibaba.csp.sentinel.context.ContextUtil;\n+import com.alibaba.csp.sentinel.log.RecordLog;\n+import com.alibaba.csp.sentinel.slots.block.BlockException;\n+import com.weibo.api.motan.common.MotanConstants;\n+import com.weibo.api.motan.core.extension.Activation;\n+import com.weibo.api.motan.core.extension.SpiMeta;\n+import com.weibo.api.motan.exception.MotanAbstractException;\n+import com.weibo.api.motan.rpc.Caller;\n+import com.weibo.api.motan.rpc.Request;\n+import com.weibo.api.motan.rpc.Response;\n+\n+/**\n+ * program: sentinel-parent\n+ * description: ${description}\n+ * author: zxn\n+ * create: 2020-10-28 00:44\n+ **/\n+@Activation(key =MotanConstants.NODE_TYPE_SERVICE)\n+@SpiMeta(name = \"sentinelMotanProvider\")\n+public class SentinelMotanProviderFilter extends BaseMotanSentinelFilter {\n+\n+    public SentinelMotanProviderFilter(){\n+        RecordLog.info(\"Sentinel motan provider filter initialized\");\n+    }\n+\n+    @Override\n+    String getMethodName(Caller<?> caller, Request request, String prefix) {\n+        return MotanUtils.getMethodResourceName(caller, request, prefix);\n+    }\n+\n+    @Override\n+    String getInterfaceName(Caller<?> caller, String prefix) {\n+        return MotanUtils.getInterfaceName(caller, prefix);\n+    }\n+\n+    @Override\n+    public Response filter(Caller<?> caller, Request request) {\n+        Entry interfaceEntry = null;\n+        Entry methodEntry = null;\n+        String prefix = \"\";\n+        String interfaceResourceName = getInterfaceName(caller, prefix);\n+        String methodResourceName = getMethodName(caller, request, prefix);\n+        try {\n+            ContextUtil.enter(methodResourceName, \"\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d0a1640eedb89846c1a7170a521a8841fcaab96a"}, "originalPosition": 48}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI1NjMwOTU2", "url": "https://github.com/alibaba/Sentinel/pull/1825#pullrequestreview-525630956", "createdAt": "2020-11-07T06:12:52Z", "commit": {"oid": "d0a1640eedb89846c1a7170a521a8841fcaab96a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wN1QwNjoxMjo1M1rOHvEwvg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wN1QwNjoxMjo1M1rOHvEwvg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTEyMzEzNA==", "bodyText": "${motan.version} is better.", "url": "https://github.com/alibaba/Sentinel/pull/1825#discussion_r519123134", "createdAt": "2020-11-07T06:12:53Z", "author": {"login": "cdfive"}, "path": "sentinel-demo/sentinel-demo-motan/pom.xml", "diffHunk": "@@ -0,0 +1,72 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<project xmlns=\"http://maven.apache.org/POM/4.0.0\"\n+         xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n+         xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\">\n+    <parent>\n+        <artifactId>sentinel-demo</artifactId>\n+        <groupId>com.alibaba.csp</groupId>\n+        <version>1.8.1-SNAPSHOT</version>\n+    </parent>\n+    <modelVersion>4.0.0</modelVersion>\n+    <artifactId>sentinel-demo-motan</artifactId>\n+\n+    <properties>\n+        <motan.version>1.1.8</motan.version>\n+    </properties>\n+\n+    <dependencies>\n+        <dependency>\n+            <groupId>com.alibaba.csp</groupId>\n+            <artifactId>sentinel-motan-adapter</artifactId>\n+            <version>${project.version}</version>\n+        </dependency>\n+        <dependency>\n+            <groupId>com.alibaba.csp</groupId>\n+            <artifactId>sentinel-transport-simple-http</artifactId>\n+            <version>${project.version}</version>\n+        </dependency>\n+        <dependency>\n+            <groupId>com.weibo</groupId>\n+            <artifactId>motan-core</artifactId>\n+            <version>1.1.8</version>\n+            <scope>compile</scope>\n+        </dependency>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d0a1640eedb89846c1a7170a521a8841fcaab96a"}, "originalPosition": 33}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI1NjMxMDQy", "url": "https://github.com/alibaba/Sentinel/pull/1825#pullrequestreview-525631042", "createdAt": "2020-11-07T06:14:34Z", "commit": {"oid": "d0a1640eedb89846c1a7170a521a8841fcaab96a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wN1QwNjoxNDozNVrOHvEzvg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wN1QwNjoxNDozNVrOHvEzvg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTEyMzkwMg==", "bodyText": "Two netty dependency, can motan-transport-netty be removed?", "url": "https://github.com/alibaba/Sentinel/pull/1825#discussion_r519123902", "createdAt": "2020-11-07T06:14:35Z", "author": {"login": "cdfive"}, "path": "sentinel-demo/sentinel-demo-motan/pom.xml", "diffHunk": "@@ -0,0 +1,72 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<project xmlns=\"http://maven.apache.org/POM/4.0.0\"\n+         xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n+         xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\">\n+    <parent>\n+        <artifactId>sentinel-demo</artifactId>\n+        <groupId>com.alibaba.csp</groupId>\n+        <version>1.8.1-SNAPSHOT</version>\n+    </parent>\n+    <modelVersion>4.0.0</modelVersion>\n+    <artifactId>sentinel-demo-motan</artifactId>\n+\n+    <properties>\n+        <motan.version>1.1.8</motan.version>\n+    </properties>\n+\n+    <dependencies>\n+        <dependency>\n+            <groupId>com.alibaba.csp</groupId>\n+            <artifactId>sentinel-motan-adapter</artifactId>\n+            <version>${project.version}</version>\n+        </dependency>\n+        <dependency>\n+            <groupId>com.alibaba.csp</groupId>\n+            <artifactId>sentinel-transport-simple-http</artifactId>\n+            <version>${project.version}</version>\n+        </dependency>\n+        <dependency>\n+            <groupId>com.weibo</groupId>\n+            <artifactId>motan-core</artifactId>\n+            <version>1.1.8</version>\n+            <scope>compile</scope>\n+        </dependency>\n+        <dependency>\n+            <groupId>com.weibo</groupId>\n+            <artifactId>motan-transport-netty4</artifactId>\n+            <version>${motan.version}</version>\n+        </dependency>\n+        <dependency>\n+            <groupId>com.weibo</groupId>\n+            <artifactId>motan-transport-netty</artifactId>\n+            <version>${motan.version}</version>\n+        </dependency>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d0a1640eedb89846c1a7170a521a8841fcaab96a"}, "originalPosition": 43}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI1NjMxMzE5", "url": "https://github.com/alibaba/Sentinel/pull/1825#pullrequestreview-525631319", "createdAt": "2020-11-07T06:20:20Z", "commit": {"oid": "d0a1640eedb89846c1a7170a521a8841fcaab96a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wN1QwNjoyMDoyMFrOHvE9oA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wN1QwNjoyMDoyMFrOHvE9oA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTEyNjQzMg==", "bodyText": "Since the flow rule is inited, here will throw BlockException, suggest to catch it and print the message to console.\nBigger loop times such as 5000, we can observe with dashboard UI more conveniently.", "url": "https://github.com/alibaba/Sentinel/pull/1825#discussion_r519126432", "createdAt": "2020-11-07T06:20:20Z", "author": {"login": "cdfive"}, "path": "sentinel-demo/sentinel-demo-motan/src/main/java/com/alibaba/csp/sentinel/demo/motan/SentinelMotanConsumerService.java", "diffHunk": "@@ -0,0 +1,78 @@\n+package com.alibaba.csp.sentinel.demo.motan;\n+\n+import com.alibaba.csp.sentinel.demo.motan.service.MotanDemoService;\n+import com.alibaba.csp.sentinel.slots.block.RuleConstant;\n+import com.alibaba.csp.sentinel.slots.block.flow.FlowRule;\n+import com.alibaba.csp.sentinel.slots.block.flow.FlowRuleManager;\n+import com.weibo.api.motan.config.ProtocolConfig;\n+import com.weibo.api.motan.config.RefererConfig;\n+import com.weibo.api.motan.config.RegistryConfig;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+\n+/**\n+ * program: sentinel-parent\n+ * description: ${description}\n+ * author: zxn\n+ * create: 2020-10-28 00:57\n+ **/\n+public class SentinelMotanConsumerService {\n+\n+    private static final String INTERFACE_RES_KEY = MotanDemoService.class.getName();\n+    private static final String RES_KEY = INTERFACE_RES_KEY + \":hello(java.lang.String)\";\n+\n+    public static void main(String[] args) {\n+        RefererConfig<MotanDemoService> motanDemoServiceReferer = new RefererConfig<MotanDemoService>();\n+        // \u8bbe\u7f6e\u63a5\u53e3\u53ca\u5b9e\u73b0\u7c7b\n+        motanDemoServiceReferer.setInterface(MotanDemoService.class);\n+        // \u914d\u7f6e\u670d\u52a1\u7684group\u4ee5\u53ca\u7248\u672c\u53f7\n+        motanDemoServiceReferer.setGroup(\"motan-demo-rpc\");\n+        motanDemoServiceReferer.setVersion(\"1.0\");\n+        motanDemoServiceReferer.setRequestTimeout(100000);\n+\n+        // \u914d\u7f6e\u6ce8\u518c\u4e2d\u5fc3\u76f4\u8fde\u8c03\u7528\n+        RegistryConfig registry = new RegistryConfig();\n+\n+        //use direct registry\n+        registry.setRegProtocol(\"direct\");\n+        registry.setAddress(\"127.0.0.1:8002\");\n+\n+        // use ZooKeeper: 2181  or consul:8500 registry\n+//        registry.setRegProtocol(\"consul\");\n+//        registry.setAddress(\"127.0.0.1:8500\");\n+        motanDemoServiceReferer.setRegistry(registry);\n+\n+        // \u914d\u7f6eRPC\u534f\u8bae\n+        ProtocolConfig protocol = new ProtocolConfig();\n+        protocol.setId(\"motan\");\n+        protocol.setName(\"motan\");\n+        motanDemoServiceReferer.setProtocol(protocol);\n+        motanDemoServiceReferer.setDirectUrl(\"localhost:8002\");  // \u6ce8\u518c\u4e2d\u5fc3\u76f4\u8fde\u8c03\u7528\u9700\u6dfb\u52a0\u6b64\u914d\u7f6e\n+\n+        initFlowRule(5, false);\n+\n+        // \u4f7f\u7528\u670d\u52a1\n+        MotanDemoService service = motanDemoServiceReferer.getRef();\n+        for (int i = 0 ;i< 20 ;i++) {\n+            System.out.println(service.hello(\"motan\"));\n+        }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d0a1640eedb89846c1a7170a521a8841fcaab96a"}, "originalPosition": 59}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI1NjMxNTU3", "url": "https://github.com/alibaba/Sentinel/pull/1825#pullrequestreview-525631557", "createdAt": "2020-11-07T06:24:11Z", "commit": {"oid": "d0a1640eedb89846c1a7170a521a8841fcaab96a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wN1QwNjoyNDoxMVrOHvFEbA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wN1QwNjoyNDoxMVrOHvFEbA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTEyODE3Mg==", "bodyText": "attachment.getOrDefault use JDK1.8, should it be configured in the pom.xml", "url": "https://github.com/alibaba/Sentinel/pull/1825#discussion_r519128172", "createdAt": "2020-11-07T06:24:11Z", "author": {"login": "cdfive"}, "path": "sentinel-adapter/sentinel-motan-adapter/src/main/java/com/alibaba/csp/sentinel/adapter/motan/MotanAppContextFilter.java", "diffHunk": "@@ -0,0 +1,31 @@\n+package com.alibaba.csp.sentinel.adapter.motan;\n+\n+import com.weibo.api.motan.core.extension.Activation;\n+import com.weibo.api.motan.core.extension.SpiMeta;\n+import com.weibo.api.motan.filter.Filter;\n+import com.weibo.api.motan.rpc.Caller;\n+import com.weibo.api.motan.rpc.Request;\n+import com.weibo.api.motan.rpc.Response;\n+import com.weibo.api.motan.rpc.RpcContext;\n+\n+import java.util.Map;\n+\n+/**\n+ * program: sentinel-parent\n+ * description: ${description}\n+ * author: zxn\n+ * create: 2020-10-28 00:28\n+ **/\n+@SpiMeta(name = \"motanAppContext\")\n+@Activation(sequence = 2)\n+public class MotanAppContextFilter implements Filter {\n+\n+    @Override\n+    public Response filter(Caller<?> caller, Request request) {\n+        if (request != null){\n+            Map<String, String> attachment = request.getAttachments();\n+            RpcContext.getContext().setRpcAttachment(\"application\", attachment.getOrDefault(\"application\", \"motan\"));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d0a1640eedb89846c1a7170a521a8841fcaab96a"}, "originalPosition": 27}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4b06d028c44025df7a5c55556b5faf08e1e302f5", "author": {"user": {"login": "zhangxn8", "name": "zhangxn"}}, "url": "https://github.com/alibaba/Sentinel/commit/4b06d028c44025df7a5c55556b5faf08e1e302f5", "committedDate": "2020-11-07T14:56:58Z", "message": "modify by code reviews"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI1ODA3MTE1", "url": "https://github.com/alibaba/Sentinel/pull/1825#pullrequestreview-525807115", "createdAt": "2020-11-08T13:18:44Z", "commit": {"oid": "4b06d028c44025df7a5c55556b5faf08e1e302f5"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wOFQxMzoxODo0NVrOHvVd0Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wOFQxMzoxODo0NVrOHvVd0Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTM5NjgxNw==", "bodyText": "ContextUtil.enter(methodResourceName, \"\");  The second parameter is used to identify the caller, refer to SentinelDubboProviderFilter, which get the caller name by DubboUtils#getApplication.\nIt seems that MotanAppContextFilter can be removed, since without it , we can also get the caller application from attachments, by calling request.getAttachments().get(\"application\").", "url": "https://github.com/alibaba/Sentinel/pull/1825#discussion_r519396817", "createdAt": "2020-11-08T13:18:45Z", "author": {"login": "cdfive"}, "path": "sentinel-adapter/sentinel-motan-adapter/src/main/java/com/alibaba/csp/sentinel/adapter/motan/SentinelMotanProviderFilter.java", "diffHunk": "@@ -0,0 +1,73 @@\n+package com.alibaba.csp.sentinel.adapter.motan;\n+\n+import com.alibaba.csp.sentinel.*;\n+import com.alibaba.csp.sentinel.adapter.motan.config.MotanAdapterGlobalConfig;\n+import com.alibaba.csp.sentinel.context.ContextUtil;\n+import com.alibaba.csp.sentinel.log.RecordLog;\n+import com.alibaba.csp.sentinel.slots.block.BlockException;\n+import com.weibo.api.motan.common.MotanConstants;\n+import com.weibo.api.motan.core.extension.Activation;\n+import com.weibo.api.motan.core.extension.SpiMeta;\n+import com.weibo.api.motan.exception.MotanAbstractException;\n+import com.weibo.api.motan.rpc.Caller;\n+import com.weibo.api.motan.rpc.Request;\n+import com.weibo.api.motan.rpc.Response;\n+\n+/**\n+ * program: sentinel-parent\n+ * description: provider filter\n+ * author: zhangxn8\n+ **/\n+@Activation(key =MotanConstants.NODE_TYPE_SERVICE)\n+@SpiMeta(name = MotanAdapterGlobalConfig.SENTINEL_MOTAN_PROVIDER)\n+public class SentinelMotanProviderFilter extends BaseMotanSentinelFilter {\n+\n+    public SentinelMotanProviderFilter(){\n+        RecordLog.info(\"Sentinel motan provider filter initialized\");\n+    }\n+\n+    @Override\n+    String getMethodName(Caller<?> caller, Request request, String prefix) {\n+        return MotanUtils.getMethodResourceName(caller, request, prefix);\n+    }\n+\n+    @Override\n+    String getInterfaceName(Caller<?> caller, String prefix) {\n+        return MotanUtils.getInterfaceName(caller, prefix);\n+    }\n+\n+    @Override\n+    public Response filter(Caller<?> caller, Request request) {\n+        Entry interfaceEntry = null;\n+        Entry methodEntry = null;\n+        String prefix = MotanAdapterGlobalConfig.getMotanProviderPrefix();\n+        String interfaceResourceName = getInterfaceName(caller, prefix);\n+        String methodResourceName = getMethodName(caller, request, prefix);\n+        try {\n+            ContextUtil.enter(methodResourceName, \"\");\n+            interfaceEntry = SphU.entry(interfaceResourceName, ResourceTypeConstants.COMMON_RPC, EntryType.IN);\n+            methodEntry = SphU.entry(methodResourceName, ResourceTypeConstants.COMMON_RPC, EntryType.IN,\n+                    request.getArguments());\n+            Response result = caller.call(request);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4b06d028c44025df7a5c55556b5faf08e1e302f5"}, "originalPosition": 51}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI1ODA3MjA5", "url": "https://github.com/alibaba/Sentinel/pull/1825#pullrequestreview-525807209", "createdAt": "2020-11-08T13:19:50Z", "commit": {"oid": "4b06d028c44025df7a5c55556b5faf08e1e302f5"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wOFQxMzoxOTo1MFrOHvVe2g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wOFQxMzoxOTo1MFrOHvVe2g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTM5NzA4Mg==", "bodyText": "Format the line will be better.", "url": "https://github.com/alibaba/Sentinel/pull/1825#discussion_r519397082", "createdAt": "2020-11-08T13:19:50Z", "author": {"login": "cdfive"}, "path": "sentinel-adapter/sentinel-motan-adapter/src/main/java/com/alibaba/csp/sentinel/adapter/motan/SentinelMotanProviderFilter.java", "diffHunk": "@@ -0,0 +1,73 @@\n+package com.alibaba.csp.sentinel.adapter.motan;\n+\n+import com.alibaba.csp.sentinel.*;\n+import com.alibaba.csp.sentinel.adapter.motan.config.MotanAdapterGlobalConfig;\n+import com.alibaba.csp.sentinel.context.ContextUtil;\n+import com.alibaba.csp.sentinel.log.RecordLog;\n+import com.alibaba.csp.sentinel.slots.block.BlockException;\n+import com.weibo.api.motan.common.MotanConstants;\n+import com.weibo.api.motan.core.extension.Activation;\n+import com.weibo.api.motan.core.extension.SpiMeta;\n+import com.weibo.api.motan.exception.MotanAbstractException;\n+import com.weibo.api.motan.rpc.Caller;\n+import com.weibo.api.motan.rpc.Request;\n+import com.weibo.api.motan.rpc.Response;\n+\n+/**\n+ * program: sentinel-parent\n+ * description: provider filter\n+ * author: zhangxn8\n+ **/\n+@Activation(key =MotanConstants.NODE_TYPE_SERVICE)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4b06d028c44025df7a5c55556b5faf08e1e302f5"}, "originalPosition": 21}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI1ODA3MzQ2", "url": "https://github.com/alibaba/Sentinel/pull/1825#pullrequestreview-525807346", "createdAt": "2020-11-08T13:21:38Z", "commit": {"oid": "4b06d028c44025df7a5c55556b5faf08e1e302f5"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wOFQxMzoyMTozOVrOHvVgug==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wOFQxMzoyMTozOVrOHvVgug==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTM5NzU2Mg==", "bodyText": "Class comment could be corresponding or just removed.", "url": "https://github.com/alibaba/Sentinel/pull/1825#discussion_r519397562", "createdAt": "2020-11-08T13:21:39Z", "author": {"login": "cdfive"}, "path": "sentinel-adapter/sentinel-motan-adapter/src/main/java/com/alibaba/csp/sentinel/adapter/motan/SentinelMotanProviderFilter.java", "diffHunk": "@@ -0,0 +1,73 @@\n+package com.alibaba.csp.sentinel.adapter.motan;\n+\n+import com.alibaba.csp.sentinel.*;\n+import com.alibaba.csp.sentinel.adapter.motan.config.MotanAdapterGlobalConfig;\n+import com.alibaba.csp.sentinel.context.ContextUtil;\n+import com.alibaba.csp.sentinel.log.RecordLog;\n+import com.alibaba.csp.sentinel.slots.block.BlockException;\n+import com.weibo.api.motan.common.MotanConstants;\n+import com.weibo.api.motan.core.extension.Activation;\n+import com.weibo.api.motan.core.extension.SpiMeta;\n+import com.weibo.api.motan.exception.MotanAbstractException;\n+import com.weibo.api.motan.rpc.Caller;\n+import com.weibo.api.motan.rpc.Request;\n+import com.weibo.api.motan.rpc.Response;\n+\n+/**\n+ * program: sentinel-parent", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4b06d028c44025df7a5c55556b5faf08e1e302f5"}, "originalPosition": 17}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "66b97aa4e092b1e725f2abc133eee86b3fa22944", "author": {"user": {"login": "zhangxn8", "name": "zhangxn"}}, "url": "https://github.com/alibaba/Sentinel/commit/66b97aa4e092b1e725f2abc133eee86b3fa22944", "committedDate": "2020-11-08T14:22:20Z", "message": "1\u3001remove  MotanAppContextFilter\n2\u3001format comment"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "aa713e503190337511254aa0089914c4ad07d7d1", "author": {"user": {"login": "zhangxn8", "name": "zhangxn"}}, "url": "https://github.com/alibaba/Sentinel/commit/aa713e503190337511254aa0089914c4ad07d7d1", "committedDate": "2020-11-08T14:27:38Z", "message": "1\u3001format comment"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI2ODAwNjU0", "url": "https://github.com/alibaba/Sentinel/pull/1825#pullrequestreview-526800654", "createdAt": "2020-11-10T02:13:30Z", "commit": {"oid": "aa713e503190337511254aa0089914c4ad07d7d1"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQwMjoxMzozMFrOHwJAFA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQwMjoxNTo0MVrOHwJCxQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDI0MTE3Mg==", "bodyText": "Could you please prepend the license header here?", "url": "https://github.com/alibaba/Sentinel/pull/1825#discussion_r520241172", "createdAt": "2020-11-10T02:13:30Z", "author": {"login": "sczyh30"}, "path": "sentinel-adapter/sentinel-motan-adapter/src/main/java/com/alibaba/csp/sentinel/adapter/motan/BaseMotanSentinelFilter.java", "diffHunk": "@@ -0,0 +1,34 @@\n+package com.alibaba.csp.sentinel.adapter.motan;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "aa713e503190337511254aa0089914c4ad07d7d1"}, "originalPosition": 1}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDI0MTM1Ng==", "bodyText": "Could you please replace it with the standard javadoc format here? (@author xxx)", "url": "https://github.com/alibaba/Sentinel/pull/1825#discussion_r520241356", "createdAt": "2020-11-10T02:14:07Z", "author": {"login": "sczyh30"}, "path": "sentinel-adapter/sentinel-motan-adapter/src/main/java/com/alibaba/csp/sentinel/adapter/motan/BaseMotanSentinelFilter.java", "diffHunk": "@@ -0,0 +1,34 @@\n+package com.alibaba.csp.sentinel.adapter.motan;\n+\n+import com.alibaba.csp.sentinel.adapter.motan.config.MotanAdapterGlobalConfig;\n+import com.weibo.api.motan.core.extension.Activation;\n+import com.weibo.api.motan.core.extension.SpiMeta;\n+import com.weibo.api.motan.filter.Filter;\n+import com.weibo.api.motan.rpc.Caller;\n+import com.weibo.api.motan.rpc.Request;\n+\n+/**\n+ * author: zhangxn8", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "aa713e503190337511254aa0089914c4ad07d7d1"}, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDI0MTg2MQ==", "bodyText": "Why this class is needed? Actually the implementation of the two methods is in MotanUtils.", "url": "https://github.com/alibaba/Sentinel/pull/1825#discussion_r520241861", "createdAt": "2020-11-10T02:15:41Z", "author": {"login": "sczyh30"}, "path": "sentinel-adapter/sentinel-motan-adapter/src/main/java/com/alibaba/csp/sentinel/adapter/motan/BaseMotanSentinelFilter.java", "diffHunk": "@@ -0,0 +1,34 @@\n+package com.alibaba.csp.sentinel.adapter.motan;\n+\n+import com.alibaba.csp.sentinel.adapter.motan.config.MotanAdapterGlobalConfig;\n+import com.weibo.api.motan.core.extension.Activation;\n+import com.weibo.api.motan.core.extension.SpiMeta;\n+import com.weibo.api.motan.filter.Filter;\n+import com.weibo.api.motan.rpc.Caller;\n+import com.weibo.api.motan.rpc.Request;\n+\n+/**\n+ * author: zhangxn8\n+ */\n+@SpiMeta(name = MotanAdapterGlobalConfig.BASE_SENTINEL_MOTAN_FILTER)\n+@Activation(sequence = 1)\n+public abstract class BaseMotanSentinelFilter implements Filter {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "aa713e503190337511254aa0089914c4ad07d7d1"}, "originalPosition": 15}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6b0eac6e97a755ee341bd89fdc4f354310d714a3", "author": {"user": {"login": "zhangxn8", "name": "zhangxn"}}, "url": "https://github.com/alibaba/Sentinel/commit/6b0eac6e97a755ee341bd89fdc4f354310d714a3", "committedDate": "2020-11-10T15:15:58Z", "message": "1\u3001Remove BaseMotanSentinelFilter use motanutils get resource\n2\u3001format comment"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7d6d30c02b6e74cfea7cffc1619d2c93f1ccef04", "author": {"user": {"login": "zhangxn8", "name": "zhangxn"}}, "url": "https://github.com/alibaba/Sentinel/commit/7d6d30c02b6e74cfea7cffc1619d2c93f1ccef04", "committedDate": "2020-11-11T14:24:55Z", "message": "add licenses"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ1NDE0NDAx", "url": "https://github.com/alibaba/Sentinel/pull/1825#pullrequestreview-545414401", "createdAt": "2020-12-05T05:55:35Z", "commit": {"oid": "7d6d30c02b6e74cfea7cffc1619d2c93f1ccef04"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3877, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}