{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDIxMTM0NDI4", "number": 1493, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yM1QwOTozMDowN1rOD_Hzrw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNVQwODoyNjowOVrOD_TfeA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY3NTE0Nzk5OnYy", "diffSide": "RIGHT", "path": "sentinel-extension/sentinel-annotation-aspectj/src/test/java/com/alibaba/csp/sentinel/annotation/aspectj/integration/service/GlobalFallback.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yM1QwOTozMDowN1rOGZofOA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNFQxNToyNDo0OVrOGZvnFw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTUzMDkzNg==", "bodyText": "Could you please add licese header(1999-2020) for the class and remove this unused blank line", "url": "https://github.com/alibaba/Sentinel/pull/1493#discussion_r429530936", "createdAt": "2020-05-23T09:30:07Z", "author": {"login": "cdfive"}, "path": "sentinel-extension/sentinel-annotation-aspectj/src/test/java/com/alibaba/csp/sentinel/annotation/aspectj/integration/service/GlobalFallback.java", "diffHunk": "@@ -0,0 +1,12 @@\n+package com.alibaba.csp.sentinel.annotation.aspectj.integration.service;\n+\n+/**\n+ * @author zhaoyuguang\n+ */\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dc86fbf122e9093bddae4c24da369f485afcd8cc"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTY0NzYzOQ==", "bodyText": "fixed", "url": "https://github.com/alibaba/Sentinel/pull/1493#discussion_r429647639", "createdAt": "2020-05-24T15:24:49Z", "author": {"login": "zhaoyuguang"}, "path": "sentinel-extension/sentinel-annotation-aspectj/src/test/java/com/alibaba/csp/sentinel/annotation/aspectj/integration/service/GlobalFallback.java", "diffHunk": "@@ -0,0 +1,12 @@\n+package com.alibaba.csp.sentinel.annotation.aspectj.integration.service;\n+\n+/**\n+ * @author zhaoyuguang\n+ */\n+", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTUzMDkzNg=="}, "originalCommit": {"oid": "dc86fbf122e9093bddae4c24da369f485afcd8cc"}, "originalPosition": 6}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY3NzA2MjMyOnYy", "diffSide": "RIGHT", "path": "sentinel-extension/sentinel-annotation-aspectj/src/main/java/com/alibaba/csp/sentinel/annotation/aspectj/AbstractSentinelAspectSupport.java", "isResolved": false, "comments": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNVQwODoyNjowOVrOGZ5Dag==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOVQwNTo0ODoyOFrOGcPjfA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTgwMjM0Ng==", "bodyText": "The priority of method-level annotation is higher than class-level annotation, so maybe here we need to check whether original locationClass is absent.", "url": "https://github.com/alibaba/Sentinel/pull/1493#discussion_r429802346", "createdAt": "2020-05-25T08:26:09Z", "author": {"login": "sczyh30"}, "path": "sentinel-extension/sentinel-annotation-aspectj/src/main/java/com/alibaba/csp/sentinel/annotation/aspectj/AbstractSentinelAspectSupport.java", "diffHunk": "@@ -186,7 +187,13 @@ private Method extractFallbackMethod(ProceedingJoinPoint pjp, String fallbackNam\n     private Method extractDefaultFallbackMethod(ProceedingJoinPoint pjp, String defaultFallback,\n                                                 Class<?>[] locationClass) {\n         if (StringUtil.isBlank(defaultFallback)) {\n-            return null;\n+            SentinelResource annotationClass = pjp.getTarget().getClass().getAnnotation(SentinelResource.class);\n+            if (annotationClass != null && StringUtil.isNotBlank(annotationClass.defaultFallback())) {\n+                defaultFallback = annotationClass.defaultFallback();\n+                locationClass = annotationClass.fallbackClass();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0124edf76afd6d173d0b894f72d0221ec546322d"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTgwODA3MQ==", "bodyText": "\u5982\u679c locationClass \u6ca1\u6709\u914d\u7f6e\uff0c\u90a3\u4e48\u5c31\u662f\u7528\u5f53\u524d\u7c7b\u7684\u4f5c\u4e3a\u9ed8\u8ba4\uff0c\u8fd9\u6837\u7684\u903b\u8f91\u5408\u9002\u4e48\uff1f", "url": "https://github.com/alibaba/Sentinel/pull/1493#discussion_r429808071", "createdAt": "2020-05-25T08:38:02Z", "author": {"login": "zhaoyuguang"}, "path": "sentinel-extension/sentinel-annotation-aspectj/src/main/java/com/alibaba/csp/sentinel/annotation/aspectj/AbstractSentinelAspectSupport.java", "diffHunk": "@@ -186,7 +187,13 @@ private Method extractFallbackMethod(ProceedingJoinPoint pjp, String fallbackNam\n     private Method extractDefaultFallbackMethod(ProceedingJoinPoint pjp, String defaultFallback,\n                                                 Class<?>[] locationClass) {\n         if (StringUtil.isBlank(defaultFallback)) {\n-            return null;\n+            SentinelResource annotationClass = pjp.getTarget().getClass().getAnnotation(SentinelResource.class);\n+            if (annotationClass != null && StringUtil.isNotBlank(annotationClass.defaultFallback())) {\n+                defaultFallback = annotationClass.defaultFallback();\n+                locationClass = annotationClass.fallbackClass();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTgwMjM0Ng=="}, "originalCommit": {"oid": "0124edf76afd6d173d0b894f72d0221ec546322d"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTgyODg5MQ==", "bodyText": "\u89e3\u6790\u4f18\u5148\u7ea7\uff1a\u65b9\u6cd5\u7ea7\u522b\u7684 fallbackClass > \u7c7b\u7ea7\u522b\u7684 fallbackClass\uff0c\u82e5\u4e0d\u5b58\u5728\u5219\u7528\u5f53\u524d\u7c7b\u66ff\u4ee3\u3002", "url": "https://github.com/alibaba/Sentinel/pull/1493#discussion_r429828891", "createdAt": "2020-05-25T09:18:52Z", "author": {"login": "sczyh30"}, "path": "sentinel-extension/sentinel-annotation-aspectj/src/main/java/com/alibaba/csp/sentinel/annotation/aspectj/AbstractSentinelAspectSupport.java", "diffHunk": "@@ -186,7 +187,13 @@ private Method extractFallbackMethod(ProceedingJoinPoint pjp, String fallbackNam\n     private Method extractDefaultFallbackMethod(ProceedingJoinPoint pjp, String defaultFallback,\n                                                 Class<?>[] locationClass) {\n         if (StringUtil.isBlank(defaultFallback)) {\n-            return null;\n+            SentinelResource annotationClass = pjp.getTarget().getClass().getAnnotation(SentinelResource.class);\n+            if (annotationClass != null && StringUtil.isNotBlank(annotationClass.defaultFallback())) {\n+                defaultFallback = annotationClass.defaultFallback();\n+                locationClass = annotationClass.fallbackClass();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTgwMjM0Ng=="}, "originalCommit": {"oid": "0124edf76afd6d173d0b894f72d0221ec546322d"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTg5MjA1MA==", "bodyText": "\u5047\u5982\u65b9\u6cd5\u6ce8\u89e3 \u5199\u4e86\u7684locationClass \u6ca1\u5199defaultFallback\n\u800c\u7c7b\u6ce8\u89e3\u5199\u4e86\u7684locationClass \u548cdefaultFallback\n\u5728\u8fd9\u79cdcase\u4e0b\u662f\u4e0d\u662f \u4f7f\u7528\u8005\u914d\u7f6e\u9519\u8bef \u5e94\u8be5\u5168\u90e8\u4f7f\u7528\u7c7b\u6ce8\u89e3\u4e0a\u7684locationClass \u548cdefaultFallback\u6bd4\u8f83\u597d\uff1f", "url": "https://github.com/alibaba/Sentinel/pull/1493#discussion_r429892050", "createdAt": "2020-05-25T11:47:17Z", "author": {"login": "zhaoyuguang"}, "path": "sentinel-extension/sentinel-annotation-aspectj/src/main/java/com/alibaba/csp/sentinel/annotation/aspectj/AbstractSentinelAspectSupport.java", "diffHunk": "@@ -186,7 +187,13 @@ private Method extractFallbackMethod(ProceedingJoinPoint pjp, String fallbackNam\n     private Method extractDefaultFallbackMethod(ProceedingJoinPoint pjp, String defaultFallback,\n                                                 Class<?>[] locationClass) {\n         if (StringUtil.isBlank(defaultFallback)) {\n-            return null;\n+            SentinelResource annotationClass = pjp.getTarget().getClass().getAnnotation(SentinelResource.class);\n+            if (annotationClass != null && StringUtil.isNotBlank(annotationClass.defaultFallback())) {\n+                defaultFallback = annotationClass.defaultFallback();\n+                locationClass = annotationClass.fallbackClass();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTgwMjM0Ng=="}, "originalCommit": {"oid": "0124edf76afd6d173d0b894f72d0221ec546322d"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTg5Nzg3MA==", "bodyText": "\u8003\u8651\u4e00\u4e0b\u8fd9\u79cd\u573a\u666f\uff08\u4e0d\u4e00\u5b9a\u5408\u7406\uff09\uff1a\u67d0\u4e2a\u65b9\u6cd5\u5e0c\u671b override \u5bf9\u5e94\u7684 fallbackClass\uff0c\u8fd9\u79cd\u60c5\u51b5\u7684\u8bdd \u53ef\u80fd\u8fd8\u4e0d\u80fd\u5224\u5b9a\u4e3a\u914d\u7f6e\u9519\u8bef", "url": "https://github.com/alibaba/Sentinel/pull/1493#discussion_r429897870", "createdAt": "2020-05-25T12:01:43Z", "author": {"login": "sczyh30"}, "path": "sentinel-extension/sentinel-annotation-aspectj/src/main/java/com/alibaba/csp/sentinel/annotation/aspectj/AbstractSentinelAspectSupport.java", "diffHunk": "@@ -186,7 +187,13 @@ private Method extractFallbackMethod(ProceedingJoinPoint pjp, String fallbackNam\n     private Method extractDefaultFallbackMethod(ProceedingJoinPoint pjp, String defaultFallback,\n                                                 Class<?>[] locationClass) {\n         if (StringUtil.isBlank(defaultFallback)) {\n-            return null;\n+            SentinelResource annotationClass = pjp.getTarget().getClass().getAnnotation(SentinelResource.class);\n+            if (annotationClass != null && StringUtil.isNotBlank(annotationClass.defaultFallback())) {\n+                defaultFallback = annotationClass.defaultFallback();\n+                locationClass = annotationClass.fallbackClass();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTgwMjM0Ng=="}, "originalCommit": {"oid": "0124edf76afd6d173d0b894f72d0221ec546322d"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDE3OTI2MA==", "bodyText": "\u6539\u4e86\u4e0b\u903b\u8f91 \u5982\u679c\u53d6\u65b9\u6cd5\u6ce8\u89e3 ->  \u53d6\u7c7b\u6ce8\u89e3 -> \u53d6\u672c\u7c7b", "url": "https://github.com/alibaba/Sentinel/pull/1493#discussion_r430179260", "createdAt": "2020-05-26T06:20:55Z", "author": {"login": "zhaoyuguang"}, "path": "sentinel-extension/sentinel-annotation-aspectj/src/main/java/com/alibaba/csp/sentinel/annotation/aspectj/AbstractSentinelAspectSupport.java", "diffHunk": "@@ -186,7 +187,13 @@ private Method extractFallbackMethod(ProceedingJoinPoint pjp, String fallbackNam\n     private Method extractDefaultFallbackMethod(ProceedingJoinPoint pjp, String defaultFallback,\n                                                 Class<?>[] locationClass) {\n         if (StringUtil.isBlank(defaultFallback)) {\n-            return null;\n+            SentinelResource annotationClass = pjp.getTarget().getClass().getAnnotation(SentinelResource.class);\n+            if (annotationClass != null && StringUtil.isNotBlank(annotationClass.defaultFallback())) {\n+                defaultFallback = annotationClass.defaultFallback();\n+                locationClass = annotationClass.fallbackClass();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTgwMjM0Ng=="}, "originalCommit": {"oid": "0124edf76afd6d173d0b894f72d0221ec546322d"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDIwMjIwOA==", "bodyText": "\u65b9\u6cd5\u7ea7\u522b\u7684 fallbackClass > \u7c7b\u7ea7\u522b\u7684 fallbackClass\n\n\u770b\u76ee\u524d\u4ee3\u7801\u5df2\u7b26\u5408\u6ee1\u8db3\u8be5\u573a\u666f\u4e86\n\n\u6539\u4e86\u4e0b\u903b\u8f91 \u5982\u679c\u53d6\u65b9\u6cd5\u6ce8\u89e3 -> \u53d6\u7c7b\u6ce8\u89e3 -> \u53d6\u672c\u7c7b\n\n\u4e0d\u8fc7\u8fd9\u53e5\u597d\u50cf\u5e76\u6ca1\u6709\u5b8c\u5168\u8986\u76d6\u5230\u3002\n\u6bd4\u5982\u65b9\u6cd5\u7ea7\u7684defaultFallback\u4e0d\u4e3a\u7a7a\uff0c\u4f46\u65b9\u6cd5\u7ea7\u7684fallbackClass\u4e3a\u7a7a\uff0c\u76ee\u524d\u6ca1\u6709\u53d6\u7c7b\u7ea7\u522b\u7684\uff0c\u53d6\u7684\u672c\u7c7b\u3002\u56e0\u4e3a\u7b2c\u4e00\u4e2aif\u5224\u65ad\u662f\u65b9\u6cd5\u7ea7\u522b\u7684defaultFallback\u3002\n\u8fd9\u4e2a\u573a\u666f\u4e5f\u4e0d\u4e00\u5b9a\u5408\u7406\uff0c\u5c31\u770b\u662f\u5426\u9700\u8981\u5b8c\u5168\u6309\u65b9\u6cd5\u6ce8\u89e3 -> \u53d6\u7c7b\u6ce8\u89e3 -> \u53d6\u672c\u7c7b\u4f18\u5148\u7ea7\u4e86\u3002\nBTW\uff0c\u6709\u4e2a\u7591\u95ee\uff1a\nSentinelResource\u6ce8\u89e3:\nClass<?>[] blockHandlerClass() default {};\nClass<?>[] fallbackClass() default {};\n\u4e3a\u4f55\u8981\u8bbe\u8ba1\u6210\u6570\u7ec4\u5462\uff1f\u770b\u4ee3\u7801\u91cc\u53ea\u53d6\u4e86[0]\u7b2c\u4e00\u4e2a\uff0c\u662f\u4e0d\u662f\u7528Class<?>\u5c31\u597d", "url": "https://github.com/alibaba/Sentinel/pull/1493#discussion_r430202208", "createdAt": "2020-05-26T07:15:25Z", "author": {"login": "cdfive"}, "path": "sentinel-extension/sentinel-annotation-aspectj/src/main/java/com/alibaba/csp/sentinel/annotation/aspectj/AbstractSentinelAspectSupport.java", "diffHunk": "@@ -186,7 +187,13 @@ private Method extractFallbackMethod(ProceedingJoinPoint pjp, String fallbackNam\n     private Method extractDefaultFallbackMethod(ProceedingJoinPoint pjp, String defaultFallback,\n                                                 Class<?>[] locationClass) {\n         if (StringUtil.isBlank(defaultFallback)) {\n-            return null;\n+            SentinelResource annotationClass = pjp.getTarget().getClass().getAnnotation(SentinelResource.class);\n+            if (annotationClass != null && StringUtil.isNotBlank(annotationClass.defaultFallback())) {\n+                defaultFallback = annotationClass.defaultFallback();\n+                locationClass = annotationClass.fallbackClass();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTgwMjM0Ng=="}, "originalCommit": {"oid": "0124edf76afd6d173d0b894f72d0221ec546322d"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjI2ODE1Ng==", "bodyText": "\u65b9\u6cd5\u7ea7\u522b\u7684 fallbackClass > \u7c7b\u7ea7\u522b\u7684 fallbackClass\n\n\u770b\u76ee\u524d\u4ee3\u7801\u5df2\u7b26\u5408\u6ee1\u8db3\u8be5\u573a\u666f\u4e86\n\n\u6539\u4e86\u4e0b\u903b\u8f91 \u5982\u679c\u53d6\u65b9\u6cd5\u6ce8\u89e3 -> \u53d6\u7c7b\u6ce8\u89e3 -> \u53d6\u672c\u7c7b\n\n\u4e0d\u8fc7\u8fd9\u53e5\u597d\u50cf\u5e76\u6ca1\u6709\u5b8c\u5168\u8986\u76d6\u5230\u3002\n\u6bd4\u5982\u65b9\u6cd5\u7ea7\u7684defaultFallback\u4e0d\u4e3a\u7a7a\uff0c\u4f46\u65b9\u6cd5\u7ea7\u7684fallbackClass\u4e3a\u7a7a\uff0c\u76ee\u524d\u6ca1\u6709\u53d6\u7c7b\u7ea7\u522b\u7684\uff0c\u53d6\u7684\u672c\u7c7b\u3002\u56e0\u4e3a\u7b2c\u4e00\u4e2aif\u5224\u65ad\u662f\u65b9\u6cd5\u7ea7\u522b\u7684defaultFallback\u3002\n\u8fd9\u4e2a\u573a\u666f\u4e5f\u4e0d\u4e00\u5b9a\u5408\u7406\uff0c\u5c31\u770b\u662f\u5426\u9700\u8981\u5b8c\u5168\u6309\u65b9\u6cd5\u6ce8\u89e3 -> \u53d6\u7c7b\u6ce8\u89e3 -> \u53d6\u672c\u7c7b\u4f18\u5148\u7ea7\u4e86\u3002\n\nWe may improve this later.\n\nBTW\uff0c\u6709\u4e2a\u7591\u95ee\uff1a\nSentinelResource\u6ce8\u89e3:\nClass<?>[] blockHandlerClass() default {};\nClass<?>[] fallbackClass() default {};\n\u4e3a\u4f55\u8981\u8bbe\u8ba1\u6210\u6570\u7ec4\u5462\uff1f\u770b\u4ee3\u7801\u91cc\u53ea\u53d6\u4e86[0]\u7b2c\u4e00\u4e2a\uff0c\u662f\u4e0d\u662f\u7528Class<?>\u5c31\u597d\n\nActually fallbackClass is optional. If using Class<?>, it cannot be null anymore.", "url": "https://github.com/alibaba/Sentinel/pull/1493#discussion_r432268156", "createdAt": "2020-05-29T05:48:28Z", "author": {"login": "sczyh30"}, "path": "sentinel-extension/sentinel-annotation-aspectj/src/main/java/com/alibaba/csp/sentinel/annotation/aspectj/AbstractSentinelAspectSupport.java", "diffHunk": "@@ -186,7 +187,13 @@ private Method extractFallbackMethod(ProceedingJoinPoint pjp, String fallbackNam\n     private Method extractDefaultFallbackMethod(ProceedingJoinPoint pjp, String defaultFallback,\n                                                 Class<?>[] locationClass) {\n         if (StringUtil.isBlank(defaultFallback)) {\n-            return null;\n+            SentinelResource annotationClass = pjp.getTarget().getClass().getAnnotation(SentinelResource.class);\n+            if (annotationClass != null && StringUtil.isNotBlank(annotationClass.defaultFallback())) {\n+                defaultFallback = annotationClass.defaultFallback();\n+                locationClass = annotationClass.fallbackClass();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTgwMjM0Ng=="}, "originalCommit": {"oid": "0124edf76afd6d173d0b894f72d0221ec546322d"}, "originalPosition": 23}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4177, "cost": 1, "resetAt": "2021-11-11T21:28:48Z"}}}