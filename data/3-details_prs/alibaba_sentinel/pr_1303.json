{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc4OTExNDc1", "number": 1303, "title": "Improve the logs when the heartbeat response indicates failure", "bodyText": "Describe what this PR does / why we need it\nDoes this pull request fix one issue?\nfix #1194\nDescribe how you did it\nDescribe how to verify it\nSpecial notes for reviews", "createdAt": "2020-02-24T10:22:54Z", "url": "https://github.com/alibaba/Sentinel/pull/1303", "merged": true, "mergeCommit": {"oid": "72bfe870cb4dcf7172e84f3356f20585966f09cc"}, "closed": true, "closedAt": "2020-03-04T15:38:54Z", "author": {"login": "linlinisme"}, "timelineItems": {"totalCount": 44, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABaptfPFgH2gAyMzc4OTExNDc1OjExZGJhNWUwMWEzYzc2NTgzYWU5ZmFiZWI5MzU2N2E5YTdjMTgxN2M=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcKYv3sAFqTM2ODg4MTc0OQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "11dba5e01a3c76583ae9fabeb93567a9a7c1817c", "author": {"user": null}, "url": "https://github.com/alibaba/Sentinel/commit/11dba5e01a3c76583ae9fabeb93567a9a7c1817c", "committedDate": "2019-05-09T06:54:31Z", "message": "com.alibaba.csp.sentinel.node.StatisticNode#curThreadNum\nusing the LongAdder rather than AtomicInteger to Provides better performance"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "362f326974e310308b135438e96b4d2052679447", "author": {"user": null}, "url": "https://github.com/alibaba/Sentinel/commit/362f326974e310308b135438e96b4d2052679447", "committedDate": "2019-05-11T13:39:54Z", "message": "reformat the code according to Alibaba Java Coding Guideline"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "50d2a5ab8a02b05b9f427eab64812118b8b11eb2", "author": {"user": null}, "url": "https://github.com/alibaba/Sentinel/commit/50d2a5ab8a02b05b9f427eab64812118b8b11eb2", "committedDate": "2019-05-11T14:01:55Z", "message": "reformat the code according to Alibaba Java Coding Guideline"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "509ecf290d6f8ebfb7c14ba0342b03bbd5dcc026", "author": {"user": {"login": "linlinisme", "name": "Lin.Liang"}}, "url": "https://github.com/alibaba/Sentinel/commit/509ecf290d6f8ebfb7c14ba0342b03bbd5dcc026", "committedDate": "2019-05-25T04:27:44Z", "message": "Merge pull request #1 from alibaba/master\n\nmerge master"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "01bda6bfb30b0d27f28ac78a7b37e4eacb575971", "author": {"user": null}, "url": "https://github.com/alibaba/Sentinel/commit/01bda6bfb30b0d27f28ac78a7b37e4eacb575971", "committedDate": "2019-05-28T08:28:10Z", "message": "Remove the one redundant space...."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ce717e954f0f860101ed185803aad85bf6f9ca3e", "author": {"user": null}, "url": "https://github.com/alibaba/Sentinel/commit/ce717e954f0f860101ed185803aad85bf6f9ca3e", "committedDate": "2019-05-31T11:27:32Z", "message": "fix issue 62 : Support customized log directory and configuration properties directory"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b8e66b8a8679eda21ec199e3847ba2c68e2a9c61", "author": {"user": null}, "url": "https://github.com/alibaba/Sentinel/commit/b8e66b8a8679eda21ec199e3847ba2c68e2a9c61", "committedDate": "2019-05-31T11:40:30Z", "message": "use System.getProperty to get the property"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5c6600d374eea984a11b29806486e7c4759f3268", "author": {"user": {"login": "linlinisme", "name": "Lin.Liang"}}, "url": "https://github.com/alibaba/Sentinel/commit/5c6600d374eea984a11b29806486e7c4759f3268", "committedDate": "2019-06-14T02:21:59Z", "message": "Merge pull request #2 from alibaba/master\n\nmerge online"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "99991547fde3c4fefe152fef396fe955212b6456", "author": {"user": null}, "url": "https://github.com/alibaba/Sentinel/commit/99991547fde3c4fefe152fef396fe955212b6456", "committedDate": "2019-06-14T02:32:26Z", "message": "merge master latest code"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8f9339b5b3a0544fd36bf1a942fecf8f1f007999", "author": {"user": null}, "url": "https://github.com/alibaba/Sentinel/commit/8f9339b5b3a0544fd36bf1a942fecf8f1f007999", "committedDate": "2019-06-19T09:45:06Z", "message": "using SentinelConfigLocator to load sentinel-core config, LogConfigLocator to load log config"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2f485b4a8509616dba83fe003241ff0bbd3a859b", "author": {"user": {"login": "linlinisme", "name": "Lin.Liang"}}, "url": "https://github.com/alibaba/Sentinel/commit/2f485b4a8509616dba83fe003241ff0bbd3a859b", "committedDate": "2019-06-19T09:46:16Z", "message": "Merge pull request #3 from alibaba/master\n\nmerge onlie"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c6dd24dcc26c57ee09c50fb7d520b38a23a2fa95", "author": {"user": null}, "url": "https://github.com/alibaba/Sentinel/commit/c6dd24dcc26c57ee09c50fb7d520b38a23a2fa95", "committedDate": "2019-06-19T10:28:28Z", "message": "merge remote master"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "810d40ad98a62efb69e783840bd3e8ae761c9e3c", "author": {"user": null}, "url": "https://github.com/alibaba/Sentinel/commit/810d40ad98a62efb69e783840bd3e8ae761c9e3c", "committedDate": "2019-06-19T10:34:24Z", "message": "fix typo"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3f98b626a0293b3159a5f23a5fb069194507af15", "author": {"user": null}, "url": "https://github.com/alibaba/Sentinel/commit/3f98b626a0293b3159a5f23a5fb069194507af15", "committedDate": "2019-06-19T10:44:33Z", "message": "add null judge"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "23244e9f88d915f856b0d59080124e2db4b1c5cd", "author": {"user": null}, "url": "https://github.com/alibaba/Sentinel/commit/23244e9f88d915f856b0d59080124e2db4b1c5cd", "committedDate": "2019-06-20T10:26:06Z", "message": "Reorganize the code"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bd8a481d84654a5773bc346dc72ddc7ae7587024", "author": {"user": null}, "url": "https://github.com/alibaba/Sentinel/commit/bd8a481d84654a5773bc346dc72ddc7ae7587024", "committedDate": "2019-06-20T11:27:02Z", "message": "Reorganize the code"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e6bbf7998617d482e6b6be7574ffa8b2a0a22569", "author": {"user": null}, "url": "https://github.com/alibaba/Sentinel/commit/e6bbf7998617d482e6b6be7574ffa8b2a0a22569", "committedDate": "2019-06-25T09:02:10Z", "message": "add config test cases"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c91b963039edcf2358d11d781e378783e8ced774", "author": {"user": null}, "url": "https://github.com/alibaba/Sentinel/commit/c91b963039edcf2358d11d781e378783e8ced774", "committedDate": "2019-06-25T11:02:57Z", "message": "ConfigUtil.loadPropertiesFromFile when file not exist return null"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d401c2fe0f1fb7c860d2674712dde11dbcd264b0", "author": {"user": null}, "url": "https://github.com/alibaba/Sentinel/commit/d401c2fe0f1fb7c860d2674712dde11dbcd264b0", "committedDate": "2019-06-27T11:38:39Z", "message": "rename classname and method name"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "85173a546873127564fcb6b233c481d1ae6bd6ea", "author": {"user": null}, "url": "https://github.com/alibaba/Sentinel/commit/85173a546873127564fcb6b233c481d1ae6bd6ea", "committedDate": "2019-06-27T11:43:29Z", "message": "rename classname and method name"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4510234aa476337a052624be731b5149a7d5dfcd", "author": {"user": null}, "url": "https://github.com/alibaba/Sentinel/commit/4510234aa476337a052624be731b5149a7d5dfcd", "committedDate": "2019-06-27T11:57:42Z", "message": "using  File.separator  to replace  \"/\""}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c068eddaeba4e968557dd79f1590b0aaa11f3e6b", "author": {"user": null}, "url": "https://github.com/alibaba/Sentinel/commit/c068eddaeba4e968557dd79f1590b0aaa11f3e6b", "committedDate": "2019-06-27T13:32:13Z", "message": "support retrieve properties from classpath file"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9af06c99318e46af9727f0fe16a440f669b4eb95", "author": {"user": null}, "url": "https://github.com/alibaba/Sentinel/commit/9af06c99318e46af9727f0fe16a440f669b4eb95", "committedDate": "2019-06-27T13:40:37Z", "message": "support retrieve properties from classpath file"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "014cda3489223e54e7bf490ef733edae14bfff2c", "author": {"user": null}, "url": "https://github.com/alibaba/Sentinel/commit/014cda3489223e54e7bf490ef733edae14bfff2c", "committedDate": "2019-07-01T08:39:24Z", "message": "add feature support : retrieve properties from relative file"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a899dc6b434aac6328bee0f7fb86ea0586065b29", "author": {"user": null}, "url": "https://github.com/alibaba/Sentinel/commit/a899dc6b434aac6328bee0f7fb86ea0586065b29", "committedDate": "2019-07-01T09:33:42Z", "message": "reformat code"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "419d97fb9f1fa0669f56d376b5a155323aef8424", "author": {"user": {"login": "linlinisme", "name": "Lin.Liang"}}, "url": "https://github.com/alibaba/Sentinel/commit/419d97fb9f1fa0669f56d376b5a155323aef8424", "committedDate": "2019-07-01T09:42:06Z", "message": "Merge pull request #4 from alibaba/master\n\nmerge online"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "80f283e3222c70e66ab582aabf7f47c9f3fc1b94", "author": {"user": null}, "url": "https://github.com/alibaba/Sentinel/commit/80f283e3222c70e66ab582aabf7f47c9f3fc1b94", "committedDate": "2019-07-01T09:43:13Z", "message": "Merge remote-tracking branch 'remotes/origin/master' into 20190531-fix-issue62"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "14a1d5b5599016f1f601a45cf51d5830ea35059f", "author": {"user": null}, "url": "https://github.com/alibaba/Sentinel/commit/14a1d5b5599016f1f601a45cf51d5830ea35059f", "committedDate": "2019-07-05T14:49:27Z", "message": "Revert \"rename classname and method name\"\n\nThis reverts commit d401c2fe"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ea18020610dfb0099e6f07ea5a630ab90b908ff0", "author": {"user": null}, "url": "https://github.com/alibaba/Sentinel/commit/ea18020610dfb0099e6f07ea5a630ab90b908ff0", "committedDate": "2019-07-05T14:58:47Z", "message": "add copy right doc"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c562474480fb7fa7d1e941edab3f1a97bb3f0bff", "author": {"user": null}, "url": "https://github.com/alibaba/Sentinel/commit/c562474480fb7fa7d1e941edab3f1a97bb3f0bff", "committedDate": "2019-07-06T01:37:20Z", "message": "reset commit"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c71759fadfa9275e568a88f118b6eb7dc7981790", "author": {"user": null}, "url": "https://github.com/alibaba/Sentinel/commit/c71759fadfa9275e568a88f118b6eb7dc7981790", "committedDate": "2019-07-06T04:10:50Z", "message": "remove unused code"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d387b47f131c7c7d724788236d1ed6f9657174c6", "author": {"user": null}, "url": "https://github.com/alibaba/Sentinel/commit/d387b47f131c7c7d724788236d1ed6f9657174c6", "committedDate": "2019-07-10T06:56:37Z", "message": "merge alibaba master"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "56d5df032b574e48ca5de2a635170d2ed8fbe629", "author": {"user": {"login": "linlinisme", "name": "Lin.Liang"}}, "url": "https://github.com/alibaba/Sentinel/commit/56d5df032b574e48ca5de2a635170d2ed8fbe629", "committedDate": "2019-07-24T03:01:19Z", "message": "Merge pull request #6 from alibaba/master\n\nmerge online"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "22cafd2454881988180a23dfde582f3a1c74ed0c", "author": {"user": {"login": "linlinisme", "name": "Lin.Liang"}}, "url": "https://github.com/alibaba/Sentinel/commit/22cafd2454881988180a23dfde582f3a1c74ed0c", "committedDate": "2019-08-22T07:28:26Z", "message": "Merge pull request #7 from alibaba/master\n\nmerge remote master"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7a0c6b7b11b128134845e4daaa50f7267b21a1ea", "author": {"user": {"login": "linlinisme", "name": "Lin.Liang"}}, "url": "https://github.com/alibaba/Sentinel/commit/7a0c6b7b11b128134845e4daaa50f7267b21a1ea", "committedDate": "2019-09-10T02:36:30Z", "message": "Merge pull request #8 from alibaba/master\n\nmerge online"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7a4391d098ee2420bbbf1b974ff9d97f410de5d9", "author": {"user": null}, "url": "https://github.com/alibaba/Sentinel/commit/7a4391d098ee2420bbbf1b974ff9d97f410de5d9", "committedDate": "2020-02-24T10:21:09Z", "message": "Improve the logs when the heartbeat response indicates failure (#1194)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "654d73a973ad5ddc09d6e2f1a5cdca4ed8a16b48", "author": {"user": {"login": "linlinisme", "name": "Lin.Liang"}}, "url": "https://github.com/alibaba/Sentinel/commit/654d73a973ad5ddc09d6e2f1a5cdca4ed8a16b48", "committedDate": "2020-02-24T10:30:50Z", "message": "Merge branch 'master' into log-heartbeat-response"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYzNDQ1MzY3", "url": "https://github.com/alibaba/Sentinel/pull/1303#pullrequestreview-363445367", "createdAt": "2020-02-24T14:51:46Z", "commit": {"oid": "654d73a973ad5ddc09d6e2f1a5cdca4ed8a16b48"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNFQxNDo1MTo0NlrOFtjXeA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNFQxNDo1MTo0NlrOFtjXeA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzMwOTY4OA==", "bodyText": "Maybe it's not necessary to log here, as we also checked and warned in the constructor of the HeartbeatSender impls.", "url": "https://github.com/alibaba/Sentinel/pull/1303#discussion_r383309688", "createdAt": "2020-02-24T14:51:46Z", "author": {"login": "sczyh30"}, "path": "sentinel-transport/sentinel-transport-netty-http/src/main/java/com/alibaba/csp/sentinel/transport/heartbeat/HttpHeartbeatSender.java", "diffHunk": "@@ -104,7 +106,8 @@ public HttpHeartbeatSender() {\n \n     @Override\n     public boolean sendHeartbeat() throws Exception {\n-        if (StringUtil.isEmpty(consoleHost)) {\n+        if (StringUtil.isEmpty(consoleHost) || invalidPort(consolePort)) {\n+            RecordLog.warn(\"[HttpHeartbeatSender] Failed to send heartbeat for invalid args consoleHost:{0} consolePort:{1}\", consoleHost, consolePort);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "654d73a973ad5ddc09d6e2f1a5cdca4ed8a16b48"}, "originalPosition": 50}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3b0f07deed406be8e45e16d68c1783078d010e89", "author": {"user": {"login": "linlinisme", "name": "Lin.Liang"}}, "url": "https://github.com/alibaba/Sentinel/commit/3b0f07deed406be8e45e16d68c1783078d010e89", "committedDate": "2020-02-24T14:59:33Z", "message": "Merge pull request #9 from alibaba/master\n\nMerge remote master"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f3a32dd08c28bd49ae5a3ba6282266d76fb4536e", "author": {"user": null}, "url": "https://github.com/alibaba/Sentinel/commit/f3a32dd08c28bd49ae5a3ba6282266d76fb4536e", "committedDate": "2020-02-24T15:13:20Z", "message": "HttpHeartbeatSender remove duplicate host port check"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYzNDkzODMy", "url": "https://github.com/alibaba/Sentinel/pull/1303#pullrequestreview-363493832", "createdAt": "2020-02-24T15:51:39Z", "commit": {"oid": "f3a32dd08c28bd49ae5a3ba6282266d76fb4536e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNFQxNTo1MTo0MFrOFtlr5g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNFQxNTo1MTo0MFrOFtlr5g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzM0NzY4Ng==", "bodyText": "Here we may need use placeholder for log: RecordLog.warn(\"xxx{},{}\", arg1,arg2);.\nOr just concat all message string.\nBesides, I found that SimpleHttpResponse#toString may throws NPE, when body is null,\nIn SimpleHttpResponse#108L, maybe need add checking logic.", "url": "https://github.com/alibaba/Sentinel/pull/1303#discussion_r383347686", "createdAt": "2020-02-24T15:51:40Z", "author": {"login": "cdfive"}, "path": "sentinel-transport/sentinel-transport-netty-http/src/main/java/com/alibaba/csp/sentinel/transport/heartbeat/HttpHeartbeatSender.java", "diffHunk": "@@ -89,11 +91,43 @@ public boolean sendHeartbeat() throws Exception {\n         // Send heartbeat request.\n         CloseableHttpResponse response = client.execute(request);\n         response.close();\n-        return true;\n+        int statusCode = response.getStatusLine().getStatusCode();\n+        if (statusCode == OK_STATUS) {\n+            return true;\n+        } else if (clientErrorCode(statusCode) || serverErrorCode(statusCode)) {\n+            RecordLog.warn(\"[HttpHeartbeatSender] Failed to send heartbeat to \"\n+                    + consoleHost + \":\" + consolePort + \", response : \", response);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f3a32dd08c28bd49ae5a3ba6282266d76fb4536e"}, "originalPosition": 52}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d39d090c559051051fa953800531c53943ce0852", "author": {"user": null}, "url": "https://github.com/alibaba/Sentinel/commit/d39d090c559051051fa953800531c53943ce0852", "committedDate": "2020-02-25T01:44:20Z", "message": "simply HeartBeatSender log and fix SimpleHttpResponse.toString() NPE problem"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY4ODc4MDI2", "url": "https://github.com/alibaba/Sentinel/pull/1303#pullrequestreview-368878026", "createdAt": "2020-03-04T15:31:23Z", "commit": {"oid": "d39d090c559051051fa953800531c53943ce0852"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY4ODgxNzQ5", "url": "https://github.com/alibaba/Sentinel/pull/1303#pullrequestreview-368881749", "createdAt": "2020-03-04T15:35:20Z", "commit": {"oid": "d39d090c559051051fa953800531c53943ce0852"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4029, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}