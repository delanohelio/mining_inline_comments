{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDg0ODA2NTUw", "number": 1729, "title": "Fix NPE bug when updating gateway flow rules before the route has been requested once", "bodyText": "Fixes the bug :\ntry to update resource rule while the resource has not been requested , that will throw a NPE.", "createdAt": "2020-09-11T08:28:34Z", "url": "https://github.com/alibaba/Sentinel/pull/1729", "merged": true, "mergeCommit": {"oid": "b7b54034ccb89a5cecff0c4cd6c0af78c31a429d"}, "closed": true, "closedAt": "2020-09-14T02:03:59Z", "author": {"login": "dani3lWong"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdHw3a-gH2gAyNDg0ODA2NTUwOmI5OWU1M2I5ZmZkZTQ0YTE4ZDYzNzM3MTBhODNmMjVmNDU3NTc5NTk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdIpaCxgFqTQ4NzM3MzYxOQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "b99e53b9ffde44a18d6373710a83f25f45757959", "author": {"user": {"login": "dani3lWong", "name": null}}, "url": "https://github.com/alibaba/Sentinel/commit/b99e53b9ffde44a18d6373710a83f25f45757959", "committedDate": "2020-09-11T08:10:41Z", "message": "fix https://github.com/alibaba/Sentinel/issues/1724"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg2NzE2OTA4", "url": "https://github.com/alibaba/Sentinel/pull/1729#pullrequestreview-486716908", "createdAt": "2020-09-11T11:14:51Z", "commit": {"oid": "b99e53b9ffde44a18d6373710a83f25f45757959"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMVQxMToxNDo1MVrOHQau6w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMVQxMToxNTowOFrOHQavlg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Njk3NzI1OQ==", "bodyText": "[INFO] --- maven-pmd-plugin:3.8:check (default) @ sentinel-api-gateway-adapter-common ---\n[INFO] PMD Failure: com.alibaba.csp.sentinel.adapter.gateway.common.rule.GatewayRuleManager$GatewayRulePropertyListener:232 Rule:NeedBraceRule Priority:1 if\u8bed\u53e5\u7f3a\u5c11\u5927\u62ec\u53f7.", "url": "https://github.com/alibaba/Sentinel/pull/1729#discussion_r486977259", "createdAt": "2020-09-11T11:14:51Z", "author": {"login": "sczyh30"}, "path": "sentinel-adapter/sentinel-api-gateway-adapter-common/src/main/java/com/alibaba/csp/sentinel/adapter/gateway/common/rule/GatewayRuleManager.java", "diffHunk": "@@ -227,7 +228,8 @@ private void applyToConvertedParamMap(Set<ParamFlowRule> paramFlowRules) {\n                 List<ParamFlowRule> oldRuleList = new ArrayList<>(entry.getValue());\n                 oldRuleList.removeAll(newRuleList);\n                 for (ParamFlowRule rule : oldRuleList) {\n-                    ParameterMetricStorage.getParamMetricForResource(resource).clearForRule(rule);\n+                    ParameterMetric metric = ParameterMetricStorage.getParamMetricForResource(resource);\n+                    if(null != metric) metric.clearForRule(rule);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b99e53b9ffde44a18d6373710a83f25f45757959"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Njk3NzQzMA==", "bodyText": "And you'll need to reformat your code.", "url": "https://github.com/alibaba/Sentinel/pull/1729#discussion_r486977430", "createdAt": "2020-09-11T11:15:08Z", "author": {"login": "sczyh30"}, "path": "sentinel-adapter/sentinel-api-gateway-adapter-common/src/main/java/com/alibaba/csp/sentinel/adapter/gateway/common/rule/GatewayRuleManager.java", "diffHunk": "@@ -227,7 +228,8 @@ private void applyToConvertedParamMap(Set<ParamFlowRule> paramFlowRules) {\n                 List<ParamFlowRule> oldRuleList = new ArrayList<>(entry.getValue());\n                 oldRuleList.removeAll(newRuleList);\n                 for (ParamFlowRule rule : oldRuleList) {\n-                    ParameterMetricStorage.getParamMetricForResource(resource).clearForRule(rule);\n+                    ParameterMetric metric = ParameterMetricStorage.getParamMetricForResource(resource);\n+                    if(null != metric) metric.clearForRule(rule);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Njk3NzI1OQ=="}, "originalCommit": {"oid": "b99e53b9ffde44a18d6373710a83f25f45757959"}, "originalPosition": 14}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d7a84572fed694ee6ffe3f05a19c02f55547a6a9", "author": {"user": {"login": "dani3lWong", "name": null}}, "url": "https://github.com/alibaba/Sentinel/commit/d7a84572fed694ee6ffe3f05a19c02f55547a6a9", "committedDate": "2020-09-11T11:17:39Z", "message": "fix https://github.com/alibaba/Sentinel/issues/1724"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg3MzczNjE5", "url": "https://github.com/alibaba/Sentinel/pull/1729#pullrequestreview-487373619", "createdAt": "2020-09-14T02:03:11Z", "commit": {"oid": "d7a84572fed694ee6ffe3f05a19c02f55547a6a9"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3847, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}