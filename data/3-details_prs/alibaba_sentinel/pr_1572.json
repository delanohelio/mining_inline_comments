{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQxMjUwNDU1", "number": 1572, "title": "Polish Dubbo 2.6.x adapter", "bodyText": "Describe what this PR does / why we need it\nPolish Dubbo 2.6.x adapter.\nDoes this pull request fix one issue?\nRelated to #1252\nDescribe how you did it\n\nUnify Dubbo callback registry (for fallback and origin parser) into DubboAdapterGlobalConfig\nPolish default fallback implementation (wrap exception with RpcResult rather than directly throw it out)\n\nDescribe how to verify it\nRun the test cases and demo.\nSpecial notes for reviews\nThis PR contains some breaking changes. Please pay attention.", "createdAt": "2020-06-29T07:21:01Z", "url": "https://github.com/alibaba/Sentinel/pull/1572", "merged": true, "mergeCommit": {"oid": "58ff01e39b34162c177cff4005b772c415e75caf"}, "closed": true, "closedAt": "2020-08-19T02:09:25Z", "author": {"login": "sczyh30"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcv7skQAH2gAyNDQxMjUwNDU1OmY3YTA1MDFmNmM1OWUyZWQxM2JiNGNlMmQ2N2Q5OWFkZjA5ZmEyMzQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc6KAFdAFqTQ1ODg2NTc0MQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "f7a0501f6c59e2ed13bb4ce2d67d99adf09fa234", "author": {"user": {"login": "sczyh30", "name": "Eric Zhao"}}, "url": "https://github.com/alibaba/Sentinel/commit/f7a0501f6c59e2ed13bb4ce2d67d99adf09fa234", "committedDate": "2020-06-29T07:13:36Z", "message": "Polish code of Dubbo 2.6.x adapter\n\n- Unify Dubbo callback registry into DubboAdapterGlobalConfig\n- Polish default fallback implementation\n\nSigned-off-by: Eric Zhao <sczyh16@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0d7ec4306020e0e2ec905d0fbc7b425144053c8e", "author": {"user": {"login": "sczyh30", "name": "Eric Zhao"}}, "url": "https://github.com/alibaba/Sentinel/commit/0d7ec4306020e0e2ec905d0fbc7b425144053c8e", "committedDate": "2020-06-29T07:13:36Z", "message": "Update README.md of sentinel-dubbo-adapter\n\nSigned-off-by: Eric Zhao <sczyh16@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUzNDY2ODU0", "url": "https://github.com/alibaba/Sentinel/pull/1572#pullrequestreview-453466854", "createdAt": "2020-07-22T16:07:13Z", "commit": {"oid": "0d7ec4306020e0e2ec905d0fbc7b425144053c8e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMlQxNjowNzoxM1rOG1pe-w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMlQxNjowNzoxM1rOG1pe-w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODkwNzM4Nw==", "bodyText": "If provider prefix is configured, the methodResourceName has a prefix which is marked for provider, it's useful when searching with prefix in dashboard menu(one scene is that only want to view all provider resources), but the interfaceResourceName has no prefix. How about also adding prefix for interface resource?\nMaybe getInterfaceResourceName can be added in AbstractDubboFilter.Same  for consumer Filter.\nBesides, is there a need to distinguish between interface and method via another prefix, a little tangled.\n@sczyh30 @jasonjoo2010", "url": "https://github.com/alibaba/Sentinel/pull/1572#discussion_r458907387", "createdAt": "2020-07-22T16:07:13Z", "author": {"login": "cdfive"}, "path": "sentinel-adapter/sentinel-dubbo-adapter/src/main/java/com/alibaba/csp/sentinel/adapter/dubbo/SentinelDubboProviderFilter.java", "diffHunk": "@@ -56,19 +53,20 @@ public SentinelDubboProviderFilter() {\n     @Override\n     public Result invoke(Invoker<?> invoker, Invocation invocation) throws RpcException {\n         // Get origin caller.\n-        String origin = DubboOriginParserRegistry.getDubboOriginParser().parse(invoker, invocation);\n+        String origin = DubboAdapterGlobalConfig.getOriginParser().parse(invoker, invocation);\n         if (null == origin) {\n             origin = \"\";\n         }\n \n         Entry interfaceEntry = null;\n         Entry methodEntry = null;\n         try {\n-            String resourceName = getResourceName(invoker, invocation, DubboConfig.getDubboProviderPrefix());\n+            String methodResourceName = getMethodResourceName(invoker, invocation,\n+                DubboAdapterGlobalConfig.getDubboProviderPrefix());\n             String interfaceName = invoker.getInterface().getName();\n-            ContextUtil.enter(resourceName, origin);\n+            ContextUtil.enter(methodResourceName, origin);\n             interfaceEntry = SphU.entry(interfaceName, ResourceTypeConstants.COMMON_RPC, EntryType.IN);\n-            methodEntry = SphU.entry(resourceName, ResourceTypeConstants.COMMON_RPC,\n+            methodEntry = SphU.entry(methodResourceName, ResourceTypeConstants.COMMON_RPC,\n                 EntryType.IN, invocation.getArguments());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0d7ec4306020e0e2ec905d0fbc7b425144053c8e"}, "originalPosition": 32}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2131e8dc6c887e4466db479c905279ec13aa9434", "author": {"user": {"login": "sczyh30", "name": "Eric Zhao"}}, "url": "https://github.com/alibaba/Sentinel/commit/2131e8dc6c887e4466db479c905279ec13aa9434", "committedDate": "2020-07-28T06:15:42Z", "message": "Append interface resource name with configured prefix in Dubbo 2.6.x adapter\n\nSigned-off-by: Eric Zhao <sczyh16@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU2NzY2MTMy", "url": "https://github.com/alibaba/Sentinel/pull/1572#pullrequestreview-456766132", "createdAt": "2020-07-28T15:43:48Z", "commit": {"oid": "2131e8dc6c887e4466db479c905279ec13aa9434"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOFQxNTo0Mzo0OVrOG4S52w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOFQxNTo0Mzo0OVrOG4S52w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTY4MzE2Mw==", "bodyText": "It seems that normally when overloading methods, the method which has less parameters call the method which has more. This is the opposite, but it is okay.", "url": "https://github.com/alibaba/Sentinel/pull/1572#discussion_r461683163", "createdAt": "2020-07-28T15:43:49Z", "author": {"login": "cdfive"}, "path": "sentinel-adapter/sentinel-dubbo-adapter/src/main/java/com/alibaba/csp/sentinel/adapter/dubbo/AbstractDubboFilter.java", "diffHunk": "@@ -43,15 +43,24 @@ protected String getResourceName(Invoker<?> invoker, Invocation invocation) {\n         return buf.toString();\n     }\n \n-    protected String getResourceName(Invoker<?> invoker, Invocation invocation, String prefix) {\n+    protected String getMethodResourceName(Invoker<?> invoker, Invocation invocation, String prefix) {\n         if (StringUtil.isBlank(prefix)) {\n-            return getResourceName(invoker, invocation);\n+            return getMethodResourceName(invoker, invocation);\n         }\n         StringBuilder buf = new StringBuilder(64);\n         return buf.append(prefix)\n-                .append(getResourceName(invoker, invocation))\n-                .toString();\n+            .append(getMethodResourceName(invoker, invocation))\n+            .toString();\n+    }\n \n+    protected String getInterfaceName(Invoker<?> invoker) {\n+        return invoker.getInterface().getName();\n+    }\n \n+    protected String getInterfaceName(Invoker<?> invoker, String prefix) {\n+        if (StringUtil.isBlank(prefix)) {\n+            return getInterfaceName(invoker);\n+        }\n+        return prefix + getInterfaceName(invoker);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2131e8dc6c887e4466db479c905279ec13aa9434"}, "originalPosition": 43}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU4ODY1NzQx", "url": "https://github.com/alibaba/Sentinel/pull/1572#pullrequestreview-458865741", "createdAt": "2020-07-31T01:32:50Z", "commit": {"oid": "2131e8dc6c887e4466db479c905279ec13aa9434"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3979, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}