{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTExMDY5NDAz", "number": 7363, "title": "add script for rebuilding dev environment #7256", "bodyText": "What this PR does / why we need it:\nSometimes developers benefit from dropping their database. This script does that and the subsequent setup so that API test can run.\nWhich issue(s) this PR closes:\nCloses #7256\nSpecial notes for your reviewer:\nAs mentioned in the issue and tech hours today, I've been using a variation of this script for years. That script was also in use on the phoenix server for years.\nSuggestions on how to test this:\n\nSet up a dev environment, create a dataset or two.\nRun the script.\nThe dev environment should be clear and empty (no datasets, etc.).\n\nDoes this PR introduce a user interface change? If mockups are available, please link/include them here:\nNo.\nIs there a release notes update needed for this change?:\nProbably not worth mentioning.\nAdditional documentation:\nJust the included dev guide update.", "createdAt": "2020-10-27T21:07:21Z", "url": "https://github.com/IQSS/dataverse/pull/7363", "merged": true, "mergeCommit": {"oid": "0b268cae330849a036464be60aec0f5a1146d945"}, "closed": true, "closedAt": "2020-10-30T14:50:40Z", "author": {"login": "pdurbin"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdWveW8AH2gAyNTExMDY5NDAzOjViNWU5NDY5MTcyMDRjN2Y3Njg5Mzc4MGVkNzRmMWRhNTkxMjJlMjM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdXZQtJAFqTUyMDExMDQ2Mw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "5b5e946917204c7f76893780ed74f1da59122e23", "author": {"user": {"login": "pdurbin", "name": "Philip Durbin"}}, "url": "https://github.com/IQSS/dataverse/commit/5b5e946917204c7f76893780ed74f1da59122e23", "committedDate": "2020-10-27T21:02:16Z", "message": "add script for rebuilding dev environment #7256"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIwMDYzMTE5", "url": "https://github.com/IQSS/dataverse/pull/7363#pullrequestreview-520063119", "createdAt": "2020-10-29T20:40:09Z", "commit": {"oid": "5b5e946917204c7f76893780ed74f1da59122e23"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOVQyMDo0MDowOVrOHqtzLg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOVQyMDo0MDo1MVrOHqt0pg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDU1MjYyMg==", "bodyText": "since you can change this location, can this be determined from the jvm option instead of hardcoded?", "url": "https://github.com/IQSS/dataverse/pull/7363#discussion_r514552622", "createdAt": "2020-10-29T20:40:09Z", "author": {"login": "scolapasta"}, "path": "scripts/dev/dev-rebuild.sh", "diffHunk": "@@ -0,0 +1,71 @@\n+#!/bin/sh\n+PAYARA_DIR=/usr/local/payara5\n+ASADMIN=$PAYARA_DIR/glassfish/bin/asadmin\n+DB_NAME=dvndb\n+DB_USER=dvnapp\n+\n+echo \"Checking if there is a war file to undeploy...\"\n+LIST_APP=$($ASADMIN list-applications -t)\n+OLD_WAR=$(echo $LIST_APP | awk '{print $1}')\n+NEW_WAR=target/dataverse*.war\n+if [ ! -z $OLD_WAR ]; then\n+  $ASADMIN undeploy $OLD_WAR\n+fi\n+\n+echo \"Stopping app server...\"\n+$ASADMIN stop-domain\n+\n+echo \"Deleting \\\"generated\\\" directory...\"\n+rm -rf $PAYARA_DIR/glassfish/domains/domain1/generated\n+\n+echo \"Deleting ALL DATA FILES uploaded to Dataverse...\" \n+rm -rf $PAYARA_DIR/glassfish/domains/domain1/files", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5b5e946917204c7f76893780ed74f1da59122e23"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDU1Mjk5OA==", "bodyText": "just because I'm curious, what does this do?", "url": "https://github.com/IQSS/dataverse/pull/7363#discussion_r514552998", "createdAt": "2020-10-29T20:40:51Z", "author": {"login": "scolapasta"}, "path": "scripts/dev/dev-rebuild.sh", "diffHunk": "@@ -0,0 +1,71 @@\n+#!/bin/sh\n+PAYARA_DIR=/usr/local/payara5\n+ASADMIN=$PAYARA_DIR/glassfish/bin/asadmin\n+DB_NAME=dvndb\n+DB_USER=dvnapp\n+\n+echo \"Checking if there is a war file to undeploy...\"\n+LIST_APP=$($ASADMIN list-applications -t)\n+OLD_WAR=$(echo $LIST_APP | awk '{print $1}')\n+NEW_WAR=target/dataverse*.war\n+if [ ! -z $OLD_WAR ]; then\n+  $ASADMIN undeploy $OLD_WAR\n+fi\n+\n+echo \"Stopping app server...\"\n+$ASADMIN stop-domain\n+\n+echo \"Deleting \\\"generated\\\" directory...\"\n+rm -rf $PAYARA_DIR/glassfish/domains/domain1/generated\n+\n+echo \"Deleting ALL DATA FILES uploaded to Dataverse...\" \n+rm -rf $PAYARA_DIR/glassfish/domains/domain1/files\n+\n+echo \"Terminating database settings so we can drop the database...\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5b5e946917204c7f76893780ed74f1da59122e23"}, "originalPosition": 24}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ecde956db1e822b510d730d19fb9b815956621a7", "author": {"user": {"login": "pdurbin", "name": "Philip Durbin"}}, "url": "https://github.com/IQSS/dataverse/commit/ecde956db1e822b510d730d19fb9b815956621a7", "committedDate": "2020-10-29T20:58:43Z", "message": "note that files dir must be the default #7256"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d3778f3600e8284df6950c19f4fc4c3b38c5c7a2", "author": {"user": {"login": "pdurbin", "name": "Philip Durbin"}}, "url": "https://github.com/IQSS/dataverse/commit/d3778f3600e8284df6950c19f4fc4c3b38c5c7a2", "committedDate": "2020-10-29T21:01:09Z", "message": "typo #7256"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIwMTEwNDYz", "url": "https://github.com/IQSS/dataverse/pull/7363#pullrequestreview-520110463", "createdAt": "2020-10-29T21:43:22Z", "commit": {"oid": "d3778f3600e8284df6950c19f4fc4c3b38c5c7a2"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 812, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}