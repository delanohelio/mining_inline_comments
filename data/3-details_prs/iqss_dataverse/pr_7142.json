{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDU4NDM2Mjg3", "number": 7142, "title": "6980 datacite reservation upgrade", "bodyText": "What this PR does / why we need it:\nThis is a documentation-only PR, the upgrade instructions for installations using Datacite - the DOIs for any unpublished drafts will need to be reserved.\nSee the discussion in the issue #6980 for more information.\nWhich issue(s) this PR closes:\nCloses #6980\nSpecial notes for your reviewer:\nThe good news is that we don't need to do anything special for any DOIs that are \"unpublished\" in the Dataverse, but somehow already exist on the Datacite side. It's not even necessary to check if any such cases exist before running the batch reserve job as described in the instruction.\nSuggestions on how to test this:\nCan be tested on any system running the develop branch (in its current state), and configured with a Datacite test account (not \"fake\"!). If it has any datasets created before the \"reserve DOIs\" PR was merged, they will be reported by the \"unreserved\" API, and they can be reserved as described in the instruction. If there are no such legacy unreserved DOIs, the condition can be emulated by setting the GlobalIdCreateTime to null in the dvobject table for some draft dataset(s).\nDoes this PR introduce a user interface change? If mockups are available, please link/include them here:\nIs there a release notes update needed for this change?:\nAdditional documentation:", "createdAt": "2020-07-29T13:22:23Z", "url": "https://github.com/IQSS/dataverse/pull/7142", "merged": true, "mergeCommit": {"oid": "7e6f5eb476683fd6277ae217602a5639a177d5eb"}, "closed": true, "closedAt": "2020-08-05T13:48:35Z", "author": {"login": "landreev"}, "timelineItems": {"totalCount": 21, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc5dzMoAH2gAyNDU4NDM2Mjg3Ojg2YjQ3MjI2MWFmZGYzY2QyZWRlYTk5NmVhNTViNjY5NmMxNzFiYWM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc7s0p6gFqTQ2MTE1NzI0Nw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "86b472261afdf3cd2edea996ea55b6696c171bac", "author": {"user": {"login": "landreev", "name": null}}, "url": "https://github.com/IQSS/dataverse/commit/86b472261afdf3cd2edea996ea55b6696c171bac", "committedDate": "2020-07-28T22:02:56Z", "message": "Datacite DOI reservation instruction for the upgrade, as a release note. #6980"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "23de0dfd85e9ec43b0b8661875dd9c9681f71dc5", "author": {"user": {"login": "landreev", "name": null}}, "url": "https://github.com/IQSS/dataverse/commit/23de0dfd85e9ec43b0b8661875dd9c9681f71dc5", "committedDate": "2020-07-28T22:09:21Z", "message": "figuring the formatting for the release note... (#6980)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f71526dd1fc69c1a780102be724fc86e2074883d", "author": {"user": {"login": "landreev", "name": null}}, "url": "https://github.com/IQSS/dataverse/commit/f71526dd1fc69c1a780102be724fc86e2074883d", "committedDate": "2020-07-28T22:12:51Z", "message": "still not sure about the formatting... #6978"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "94121e714f7484d78e65e5d916dbd5748d3cc2e1", "author": {"user": {"login": "landreev", "name": null}}, "url": "https://github.com/IQSS/dataverse/commit/94121e714f7484d78e65e5d916dbd5748d3cc2e1", "committedDate": "2020-07-28T22:34:57Z", "message": "still not sure about the formatting... #6980"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4b2fa8e244a208c02cf728320fc4848b7a3a12fe", "author": {"user": {"login": "landreev", "name": null}}, "url": "https://github.com/IQSS/dataverse/commit/4b2fa8e244a208c02cf728320fc4848b7a3a12fe", "committedDate": "2020-07-28T22:35:28Z", "message": "Merge branch '6980-datacite-reservation-upgrade' of https://github.com/IQSS/dataverse into 6980-datacite-reservation-upgrade"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "49c8c38ef2722ca6448ee98c53e8faf4c4a098dc", "author": {"user": {"login": "landreev", "name": null}}, "url": "https://github.com/IQSS/dataverse/commit/49c8c38ef2722ca6448ee98c53e8faf4c4a098dc", "committedDate": "2020-07-29T13:00:47Z", "message": "more cosmetic changes (#6980)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cda7bca30d91c3fa4a32d33e4cd1e1837132f0b3", "author": {"user": {"login": "landreev", "name": null}}, "url": "https://github.com/IQSS/dataverse/commit/cda7bca30d91c3fa4a32d33e4cd1e1837132f0b3", "committedDate": "2020-07-29T13:08:07Z", "message": "more cosmetic changes #6980"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU3NTU5NjI2", "url": "https://github.com/IQSS/dataverse/pull/7142#pullrequestreview-457559626", "createdAt": "2020-07-29T14:09:30Z", "commit": {"oid": "cda7bca30d91c3fa4a32d33e4cd1e1837132f0b3"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOVQxNDowOTozMFrOG46QDw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOVQxNDowOTozMFrOG46QDw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjMyNzgyMw==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            For Dataverses using Datacite v5.0 changes the process of registering the Global Identifier (DOI) for the dataset. Instead of registering it when the dataset is published for the first time, Dataverse will try to \"reserve\" the DOI when it's created (by registering it as a \"draft\", using Datacite terminology). When the user publishes the dataset, the DOI will be publicized as well (by switching the registration status to \"findable\"). \n          \n          \n            \n            For installations using Dataverse v5.x, the process of registering the Global Identifier (DOI) for the dataset changes. Instead of registering it when the dataset is published for the first time, Dataverse will try to \"reserve\" the DOI when it's created (by registering it as a \"draft\", using Datacite terminology). When the user publishes the dataset, the DOI will be publicized as well (by switching the registration status to \"findable\").", "url": "https://github.com/IQSS/dataverse/pull/7142#discussion_r462327823", "createdAt": "2020-07-29T14:09:30Z", "author": {"login": "poikilotherm"}, "path": "doc/release-notes/6980-datacite-reservation-upgrade", "diffHunk": "@@ -0,0 +1,28 @@\n+# Dataverse installatins using Datacite: upgrade action required.\n+\n+For Dataverses using Datacite v5.0 changes the process of registering the Global Identifier (DOI) for the dataset. Instead of registering it when the dataset is published for the first time, Dataverse will try to \"reserve\" the DOI when it's created (by registering it as a \"draft\", using Datacite terminology). When the user publishes the dataset, the DOI will be publicized as well (by switching the registration status to \"findable\"). ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cda7bca30d91c3fa4a32d33e4cd1e1837132f0b3"}, "originalPosition": 3}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ef87b1f71259bd7b2ab125b13c2674e77b7e9157", "author": {"user": {"login": "landreev", "name": null}}, "url": "https://github.com/IQSS/dataverse/commit/ef87b1f71259bd7b2ab125b13c2674e77b7e9157", "committedDate": "2020-07-29T16:11:03Z", "message": "how about this? #6980"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU3Nzk0NDAy", "url": "https://github.com/IQSS/dataverse/pull/7142#pullrequestreview-457794402", "createdAt": "2020-07-29T18:46:05Z", "commit": {"oid": "ef87b1f71259bd7b2ab125b13c2674e77b7e9157"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU3NzkzODAw", "url": "https://github.com/IQSS/dataverse/pull/7142#pullrequestreview-457793800", "createdAt": "2020-07-29T18:45:15Z", "commit": {"oid": "ef87b1f71259bd7b2ab125b13c2674e77b7e9157"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOVQxODo0NToxNVrOG5Fd6w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOVQxODo0NzoyOVrOG5FigA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjUxMTU5NQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            Going forward, once all the DOIs have been reserved for the legacy drafts, some newly-created datasets may still end up with unreserved DOIs. (For example, if Datacite service was unavailable at the time of the datast creation; we don't expect it to happen too often, but it is not impossible). To address this preemptively we recommend that you set up a cronjob to run the script above (perhaps with some extra diagnostics added) weekly or even nightly. \n          \n          \n            \n            Going forward, once all the DOIs have been reserved for the legacy drafts, some newly-created datasets may still end up with unreserved DOIs. (For example, if Datacite service was unavailable at the time of the dataset creation; we don't expect it to happen too often, but it is not impossible). To address this preemptively we recommend that you set up a cronjob to run the script above (perhaps with some extra diagnostics added) weekly or even nightly.", "url": "https://github.com/IQSS/dataverse/pull/7142#discussion_r462511595", "createdAt": "2020-07-29T18:45:15Z", "author": {"login": "pdurbin"}, "path": "doc/release-notes/6980-datacite-reservation-upgrade", "diffHunk": "@@ -0,0 +1,28 @@\n+## Dataverse installations using Datacite: upgrade action required.\n+\n+For installations that are using Datacite, Dataverse v5.0 introduces a change in the process of registering the Global Identifier (DOI) for a dataset. Instead of registering it when the dataset is published for the first time, Dataverse will try to \"reserve\" the DOI when it's created (by registering it as a \"draft\", using Datacite terminology). When the user publishes the dataset, the DOI will be publicized as well (by switching the registration status to \"findable\"). \n+\n+This approach makes the process of publishing datasets simpler and less error-prone. One drawback is that a dataset cannot be published until the DOI has been reserved. Specifically, if your installation uses Datacite, the moment it is upgraded to v5.0, all the pre-existing unpublished drafts will become \"unpublishable\", until you reserve the DOIs as described below. So it is important to do that immediately after the upgrade, by using the following APIs:\n+\n+`/api/pids/unreserved`  will report the ids of the datasets \n+`/api/pids/:persistentId/reserve` reserves the assigned DOI with Datacite (will need to be run on every id reported by the the first API). \n+(See the Native API guide for more information).\n+\n+Scripted, the whole process would look as follows (adjust as needed):\n+\n+```\n+   API_TOKEN='xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx'\n+   \n+   curl -s -H \"X-Dataverse-key:$API_TOKEN\" http://localhost:8080/api/pids/unreserved |\n+   # the API outputs JSON; note the use of jq to parse it:\n+   jq '.data.count[].pid' | tr -d '\"' | \n+   while read doi\n+   do\n+      curl -s -H \"X-Dataverse-key:$API_TOKEN\" -X POST http://localhost:8080/api/pids/:persistentId/reserve?persistentId=$doi\n+   done\n+```\n+\n+If you have a large number of unpublished drafts in the database, reserving them one by one may take some time. So if you want to be extra nice to your users, you may warn them ahead of time that some may have trouble publishing their drafts immediately after the upgrade. \n+\n+Going forward, once all the DOIs have been reserved for the legacy drafts, some newly-created datasets may still end up with unreserved DOIs. (For example, if Datacite service was unavailable at the time of the datast creation; we don't expect it to happen too often, but it is not impossible). To address this preemptively we recommend that you set up a cronjob to run the script above (perhaps with some extra diagnostics added) weekly or even nightly. ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ef87b1f71259bd7b2ab125b13c2674e77b7e9157"}, "originalPosition": 27}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjUxMjc2OA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            For installations that are using Datacite, Dataverse v5.0 introduces a change in the process of registering the Global Identifier (DOI) for a dataset. Instead of registering it when the dataset is published for the first time, Dataverse will try to \"reserve\" the DOI when it's created (by registering it as a \"draft\", using Datacite terminology). When the user publishes the dataset, the DOI will be publicized as well (by switching the registration status to \"findable\"). \n          \n          \n            \n            For installations that are using Datacite, Dataverse v5.0 introduces a change in the process of registering the Persistent Identifier (DOI) for a dataset. Instead of registering it when the dataset is published for the first time, Dataverse will try to \"reserve\" the DOI when it's created (by registering it as a \"draft\", using Datacite terminology). When the user publishes the dataset, the DOI will be publicized as well (by switching the registration status to \"findable\"). \n          \n      \n    \n    \n  \n\nI know in the code we call it GlobalId but everywhere else we call it a Persistent Identifier, a PID.", "url": "https://github.com/IQSS/dataverse/pull/7142#discussion_r462512768", "createdAt": "2020-07-29T18:47:29Z", "author": {"login": "pdurbin"}, "path": "doc/release-notes/6980-datacite-reservation-upgrade", "diffHunk": "@@ -0,0 +1,28 @@\n+## Dataverse installations using Datacite: upgrade action required.\n+\n+For installations that are using Datacite, Dataverse v5.0 introduces a change in the process of registering the Global Identifier (DOI) for a dataset. Instead of registering it when the dataset is published for the first time, Dataverse will try to \"reserve\" the DOI when it's created (by registering it as a \"draft\", using Datacite terminology). When the user publishes the dataset, the DOI will be publicized as well (by switching the registration status to \"findable\"). ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ef87b1f71259bd7b2ab125b13c2674e77b7e9157"}, "originalPosition": 3}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4f5a6ea5963783ba911682c7dfea388be2a8f896", "author": {"user": {"login": "landreev", "name": null}}, "url": "https://github.com/IQSS/dataverse/commit/4f5a6ea5963783ba911682c7dfea388be2a8f896", "committedDate": "2020-07-29T18:56:11Z", "message": "Update doc/release-notes/6980-datacite-reservation-upgrade\n\nCo-authored-by: Philip Durbin <philip_durbin@harvard.edu>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e1dfc9828d11e69a5237400247d355f890d17543", "author": {"user": {"login": "landreev", "name": null}}, "url": "https://github.com/IQSS/dataverse/commit/e1dfc9828d11e69a5237400247d355f890d17543", "committedDate": "2020-07-29T18:56:24Z", "message": "Update doc/release-notes/6980-datacite-reservation-upgrade\n\nCo-authored-by: Philip Durbin <philip_durbin@harvard.edu>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c693427c2d22f30f8b1a7d37ff08d3ba3d3d8e3e", "author": {"user": {"login": "landreev", "name": null}}, "url": "https://github.com/IQSS/dataverse/commit/c693427c2d22f30f8b1a7d37ff08d3ba3d3d8e3e", "committedDate": "2020-07-29T19:26:15Z", "message": "adding the .md extension... #6980"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c98ff4fe423ca32a1763db3e8047961d91aee169", "author": {"user": {"login": "landreev", "name": null}}, "url": "https://github.com/IQSS/dataverse/commit/c98ff4fe423ca32a1763db3e8047961d91aee169", "committedDate": "2020-08-04T16:27:48Z", "message": "changes to the upgrade instruction"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYxMDczODc4", "url": "https://github.com/IQSS/dataverse/pull/7142#pullrequestreview-461073878", "createdAt": "2020-08-04T18:42:40Z", "commit": {"oid": "c98ff4fe423ca32a1763db3e8047961d91aee169"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNFQxODo0Mjo0MFrOG7s4UQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNFQxODo0NToyM1rOG7s94A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTI1NDQ4MQ==", "bodyText": "The sentence starting with \"But\" feels unnecessary.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            This approach makes the process of publishing datasets simpler and less error-prone. If the DOI has not been reserved (for example, if Datacite was down when the dataset was created), the author can still attempt to publish. But it does help to ensure that the DOI is guaranteed to be available beforehand. New APIs have been provided for finding any unreserved Datacite-issued DOIs in your Dataverse, and for reserving them (see below). If you are upgrading an installation that uses Datacite, we specifically recommend that you reserve the DOIs for all your pre-existing unpublished drafts as soon as Dataverse v5.0 is deployed, since none of them were registered at create time. \n          \n          \n            \n            This approach makes the process of publishing datasets simpler and less error-prone. If the DOI has not been reserved (for example, if Datacite was down when the dataset was created), the author can still attempt to publish. New APIs have been provided for finding any unreserved Datacite-issued DOIs in your Dataverse, and for reserving them (see below). If you are upgrading an installation that uses Datacite, we specifically recommend that you reserve the DOIs for all your pre-existing unpublished drafts as soon as Dataverse v5.0 is deployed, since none of them were registered at create time.", "url": "https://github.com/IQSS/dataverse/pull/7142#discussion_r465254481", "createdAt": "2020-08-04T18:42:40Z", "author": {"login": "pdurbin"}, "path": "doc/release-notes/6980-datacite-reservation-upgrade.md", "diffHunk": "@@ -0,0 +1,26 @@\n+## Dataverse installations using Datacite: upgrade action required.\n+\n+For installations that are using Datacite, Dataverse v5.0 introduces a change in the process of registering the Persistent Identifier (DOI) for a dataset. Instead of registering it when the dataset is published for the first time, Dataverse will try to \"reserve\" the DOI when it's created (by registering it as a \"draft\", using Datacite terminology). When the user publishes the dataset, the DOI will be publicized as well (by switching the registration status to \"findable\"). \n+\n+This approach makes the process of publishing datasets simpler and less error-prone. If the DOI has not been reserved (for example, if Datacite was down when the dataset was created), the author can still attempt to publish. But it does help to ensure that the DOI is guaranteed to be available beforehand. New APIs have been provided for finding any unreserved Datacite-issued DOIs in your Dataverse, and for reserving them (see below). If you are upgrading an installation that uses Datacite, we specifically recommend that you reserve the DOIs for all your pre-existing unpublished drafts as soon as Dataverse v5.0 is deployed, since none of them were registered at create time. ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c98ff4fe423ca32a1763db3e8047961d91aee169"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTI1NTMxMA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            ## Dataverse installations using Datacite: upgrade action required.\n          \n          \n            \n            ## Dataverse installations using Datacite: upgrade action recommended.", "url": "https://github.com/IQSS/dataverse/pull/7142#discussion_r465255310", "createdAt": "2020-08-04T18:44:16Z", "author": {"login": "pdurbin"}, "path": "doc/release-notes/6980-datacite-reservation-upgrade.md", "diffHunk": "@@ -0,0 +1,26 @@\n+## Dataverse installations using Datacite: upgrade action required.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c98ff4fe423ca32a1763db3e8047961d91aee169"}, "originalPosition": 1}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTI1NTkwNA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            Going forward, once all the DOIs have been reserved for the legacy drafts, you may still get an occasional dataset with an unreserved identfier. Datacite service instability would be a potential cause. There is no reason to expect that to happen often, but it is not impossible. You may consider running the script above (perhaps with some extra diagnostics added) regularly, from a cron job or otherwise, to address this preemptively.  \n          \n          \n            \n            Going forward, once all the DOIs have been reserved for the legacy drafts, you may still get an occasional dataset with an unreserved identifier. Datacite service instability would be a potential cause. There is no reason to expect that to happen often, but it is not impossible. You may consider running the script above (perhaps with some extra diagnostics added) regularly, from a cron job or otherwise, to address this preemptively.", "url": "https://github.com/IQSS/dataverse/pull/7142#discussion_r465255904", "createdAt": "2020-08-04T18:45:23Z", "author": {"login": "pdurbin"}, "path": "doc/release-notes/6980-datacite-reservation-upgrade.md", "diffHunk": "@@ -0,0 +1,26 @@\n+## Dataverse installations using Datacite: upgrade action required.\n+\n+For installations that are using Datacite, Dataverse v5.0 introduces a change in the process of registering the Persistent Identifier (DOI) for a dataset. Instead of registering it when the dataset is published for the first time, Dataverse will try to \"reserve\" the DOI when it's created (by registering it as a \"draft\", using Datacite terminology). When the user publishes the dataset, the DOI will be publicized as well (by switching the registration status to \"findable\"). \n+\n+This approach makes the process of publishing datasets simpler and less error-prone. If the DOI has not been reserved (for example, if Datacite was down when the dataset was created), the author can still attempt to publish. But it does help to ensure that the DOI is guaranteed to be available beforehand. New APIs have been provided for finding any unreserved Datacite-issued DOIs in your Dataverse, and for reserving them (see below). If you are upgrading an installation that uses Datacite, we specifically recommend that you reserve the DOIs for all your pre-existing unpublished drafts as soon as Dataverse v5.0 is deployed, since none of them were registered at create time. \n+\n+The following API calls should be used:\n+`/api/pids/unreserved`  will report the ids of the datasets \n+`/api/pids/:persistentId/reserve` reserves the assigned DOI with Datacite (will need to be run on every id reported by the the first API). \n+(See the Native API guide for more information).\n+\n+Scripted, the whole process would look as follows (adjust as needed):\n+\n+```\n+   API_TOKEN='xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx'\n+   \n+   curl -s -H \"X-Dataverse-key:$API_TOKEN\" http://localhost:8080/api/pids/unreserved |\n+   # the API outputs JSON; note the use of jq to parse it:\n+   jq '.data.count[].pid' | tr -d '\"' | \n+   while read doi\n+   do\n+      curl -s -H \"X-Dataverse-key:$API_TOKEN\" -X POST http://localhost:8080/api/pids/:persistentId/reserve?persistentId=$doi\n+   done\n+``` \n+\n+Going forward, once all the DOIs have been reserved for the legacy drafts, you may still get an occasional dataset with an unreserved identfier. Datacite service instability would be a potential cause. There is no reason to expect that to happen often, but it is not impossible. You may consider running the script above (perhaps with some extra diagnostics added) regularly, from a cron job or otherwise, to address this preemptively.  ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c98ff4fe423ca32a1763db3e8047961d91aee169"}, "originalPosition": 26}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f7e0ed68106c65ccb887145c34516ed46f7d698d", "author": {"user": {"login": "landreev", "name": null}}, "url": "https://github.com/IQSS/dataverse/commit/f7e0ed68106c65ccb887145c34516ed46f7d698d", "committedDate": "2020-08-04T18:58:53Z", "message": "typo\n\nCo-authored-by: Philip Durbin <philip_durbin@harvard.edu>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "907802e1c383f8c04069629b6ae8b3e21b562158", "author": {"user": {"login": "landreev", "name": null}}, "url": "https://github.com/IQSS/dataverse/commit/907802e1c383f8c04069629b6ae8b3e21b562158", "committedDate": "2020-08-04T19:11:10Z", "message": "Changed Datacite to DataCite"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "111642709e2de086c421c72c41e7c0d0fb47b278", "author": {"user": {"login": "landreev", "name": null}}, "url": "https://github.com/IQSS/dataverse/commit/111642709e2de086c421c72c41e7c0d0fb47b278", "committedDate": "2020-08-04T19:42:15Z", "message": "changed \"required\" to \"recommended\""}}, {"__typename": "PullRequestCommit", "commit": {"oid": "97b92e4d3eed354bb93c81ecde22d982ab4d58d9", "author": {"user": {"login": "landreev", "name": null}}, "url": "https://github.com/IQSS/dataverse/commit/97b92e4d3eed354bb93c81ecde22d982ab4d58d9", "committedDate": "2020-08-04T20:32:30Z", "message": "a few more changes"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYxMTU3MjQ3", "url": "https://github.com/IQSS/dataverse/pull/7142#pullrequestreview-461157247", "createdAt": "2020-08-04T20:40:57Z", "commit": {"oid": "97b92e4d3eed354bb93c81ecde22d982ab4d58d9"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 919, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}