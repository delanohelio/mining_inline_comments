{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTIyNTQ2ODkz", "number": 7416, "title": "5345 Make EJB timers nonpersistent", "bodyText": "What this PR does / why we need it:\nAs discussed in #5345, #7048, on IRC, Slack and Zoom plus this Google doc, we need to make the EJB timers non-persistent for enabling application-level database connection definitions.\nWhich issue(s) this PR closes:\nCloses #5345\nSpecial notes for your reviewer:\n\nIt might me an idea to add a Flyway migration dropping the unused EJB timer table from the DB.\n\nSuggestions on how to test this:\n\nRemember to reconfigure the EJB timer database (see release note)\nCheck if timers still work.\nCheck if timers still work on multi-instance installation without conflicting runs.\n\nDoes this PR introduce a user interface change? If mockups are available, please link/include them here:\nNope.\nIs there a release notes update needed for this change?:\nYeah, a small one about removing the EJB timer database configuration setting on the app server. \ud83d\udd0b included.\nAdditional documentation:\nThis is a quick and dirty solution, not very sophisticated for future enhancements. At some point in the future, we need to come back to the ideas of the Google Doc.", "createdAt": "2020-11-17T16:38:49Z", "url": "https://github.com/IQSS/dataverse/pull/7416", "merged": true, "mergeCommit": {"oid": "ffaba33d17fb0217447be14cbfe4da29aa61de3f"}, "closed": true, "closedAt": "2020-11-24T20:31:37Z", "author": {"login": "poikilotherm"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABddcF3JgH2gAyNTIyNTQ2ODkzOmE3NWFhZGY1ZjI1OGZlNmFiYzZlOTBiYzAwNmM2ZjI0OWIwYmIzYjc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdecW0pAFqTUzNTcxMTM5Mw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "a75aadf5f258fe6abc6e90bc006c6f249b0bb3b7", "author": {"user": {"login": "poikilotherm", "name": "Oliver Bertuch"}}, "url": "https://github.com/IQSS/dataverse/commit/a75aadf5f258fe6abc6e90bc006c6f249b0bb3b7", "committedDate": "2020-11-17T16:24:47Z", "message": "Remove unused resources from DataverseTimerServiceBean. #5345"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ebcd1e0c3577c9c234e4fac4a6b1c1ab228b9e27", "author": {"user": {"login": "poikilotherm", "name": "Oliver Bertuch"}}, "url": "https://github.com/IQSS/dataverse/commit/ebcd1e0c3577c9c234e4fac4a6b1c1ab228b9e27", "committedDate": "2020-11-17T16:31:44Z", "message": "Make timers non-persistent. #5345"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "56a6bd4125cca0fa224d6b5329031f772be24f15", "author": {"user": {"login": "poikilotherm", "name": "Oliver Bertuch"}}, "url": "https://github.com/IQSS/dataverse/commit/56a6bd4125cca0fa224d6b5329031f772be24f15", "committedDate": "2020-11-17T17:05:48Z", "message": "Add doc changes due to timers now non-persistent. #5345"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "80393b70568828c456b870e1036a5d40730df51f", "author": {"user": {"login": "poikilotherm", "name": "Oliver Bertuch"}}, "url": "https://github.com/IQSS/dataverse/commit/80393b70568828c456b870e1036a5d40730df51f", "committedDate": "2020-11-18T13:03:25Z", "message": "Release note about EJB timer change. #5345"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM1NzAzODA0", "url": "https://github.com/IQSS/dataverse/pull/7416#pullrequestreview-535703804", "createdAt": "2020-11-20T19:05:41Z", "commit": {"oid": "80393b70568828c456b870e1036a5d40730df51f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yMFQxOTowNTo0MVrOH3dT1Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yMFQxOTowNTo0MVrOH3dT1Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzkxMzk0MQ==", "bodyText": "very minor comment, but I think this would read better the way it was before (outside of the removing the aside): \" The configuration values might need to be changed to reflect your environment (the Payara directory).\"", "url": "https://github.com/IQSS/dataverse/pull/7416#discussion_r527913941", "createdAt": "2020-11-20T19:05:41Z", "author": {"login": "scolapasta"}, "path": "doc/sphinx-guides/source/admin/troubleshooting.rst", "diffHunk": "@@ -98,14 +98,12 @@ We don't know what's causing this issue, but here's a known workaround:\n \n - Stop Payara; \n \n-- Remove the ``generated`` and ``osgi-cache`` directories; \n-\n-- Delete all the rows from the ``EJB__TIMER__TBL`` table in the database;\n+- Remove the ``generated`` and ``osgi-cache`` directories;\n \n - Start Payara\n \n The shell script below performs the steps above. \n-Note that it may or may not work on your system, so it is provided as an example only, downloadable :download:`here </_static/util/clear_timer.sh>`. Aside from the configuration values that need to be changed to reflect your environment (the Payara directory, name of the database, etc.) the script relies on the database being configured in a certain way for access. (See the comments in the script for more information)\n+Note that it may or may not work on your system, so it is provided as an example only, downloadable :download:`here </_static/util/clear_timer.sh>`. The configuration values to reflect your environment (the Payara directory) might need to be changed. (See the comments in the script for more information)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "80393b70568828c456b870e1036a5d40730df51f"}, "originalPosition": 13}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM1NzA0NTEy", "url": "https://github.com/IQSS/dataverse/pull/7416#pullrequestreview-535704512", "createdAt": "2020-11-20T19:06:50Z", "commit": {"oid": "80393b70568828c456b870e1036a5d40730df51f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yMFQxOTowNjo1MFrOH3dV9A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yMFQxOTowNjo1MFrOH3dV9A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzkxNDQ4NA==", "bodyText": "typo: \"it's\" should be \"its\"", "url": "https://github.com/IQSS/dataverse/pull/7416#discussion_r527914484", "createdAt": "2020-11-20T19:06:50Z", "author": {"login": "scolapasta"}, "path": "doc/sphinx-guides/source/admin/troubleshooting.rst", "diffHunk": "@@ -127,9 +125,9 @@ followed by an Exception stack trace with these lines in it:\n :fixedwidthplain:`Exception Description: Could not deserialize object from byte array` ...\n \n \n-... it most likely means that it is the JDBC driver incompatibility that's preventing the timer from working correctly. \n-Make sure you install the correct version of the driver. For example, if you are running the version 9.3 of PostgreSQL, make sure you have the driver postgresql-9.3-1104.jdbc4.jar in your :fixedwidthplain:`<PAYARA FOLDER>/glassfish/lib` directory. Go `here <https://jdbc.postgresql.org/download.html>`_\n-to download the correct version of the driver. If you have an older driver in glassfish/lib, make sure to remove it, replace it with the new version and restart Payara. (You may need to remove the entire contents of :fixedwidthplain:`<PAYARA FOLDER>/glassfish/domains/domain1/generated` before you start Payara). \n+... you should reach out by opening an issue. In the good old days of running Dataverse 4 running on Glassfish 4, this\n+was a hint for an unsupported JDBC driver. In Dataverse 5 this would be a new regression and it's cause would need to be", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "80393b70568828c456b870e1036a5d40730df51f"}, "originalPosition": 34}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "67172d7c02de585ac8bfb1bf923bb520ded61270", "author": {"user": {"login": "scolapasta", "name": "Gustavo Durand"}}, "url": "https://github.com/IQSS/dataverse/commit/67172d7c02de585ac8bfb1bf923bb520ded61270", "committedDate": "2020-11-20T19:13:42Z", "message": "small doc changes"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM1NzExMzkz", "url": "https://github.com/IQSS/dataverse/pull/7416#pullrequestreview-535711393", "createdAt": "2020-11-20T19:17:14Z", "commit": {"oid": "67172d7c02de585ac8bfb1bf923bb520ded61270"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 689, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}