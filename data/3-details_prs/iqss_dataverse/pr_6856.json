{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA4NzI1Mjg2", "number": 6856, "title": "6741 add data render logic", "bodyText": "What this PR does / why we need it:\nThis modifies the rendering of the Add Data buttonsin the header  The Add Data button in the header has been changed so that whether or not the user is not logged in it will be rendered based on the permissions of a generic authenticated user in the Root Dataverse.\nFunctionality of the Add Data button in the body of the Dataverse Page is unchanged (and based on the respective permissions of the Dataverse being viewed.)\nWhich issue(s) this PR closes:\nCloses #6741\nSpecial notes for your reviewer:\nI am making use of ui:params to isolate the render logic\nSuggestions on how to test this:\nDoes this PR introduce a user interface change?:\nno\nIs there a release notes update needed for this change?:\nno\nAdditional documentation:\nnone", "createdAt": "2020-04-24T19:26:01Z", "url": "https://github.com/IQSS/dataverse/pull/6856", "merged": true, "mergeCommit": {"oid": "f03076300a6eabb8badf7554666091572a4be2d4"}, "closed": true, "closedAt": "2020-05-04T18:14:53Z", "author": {"login": "sekmiller"}, "timelineItems": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcaghk6gH2gAyNDA4NzI1Mjg2Ojg2MWY4NzNmMzMyMjQ2YWUxOTY2NTY4YWFkMjJmNGIyYzM2OTYxMzE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABccJFC0gFqTQwMjE0NjkwMA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "861f873f332246ae1966568aad22f4b2c3696131", "author": {"user": {"login": "sekmiller", "name": "Stephen Kraffmiller"}}, "url": "https://github.com/IQSS/dataverse/commit/861f873f332246ae1966568aad22f4b2c3696131", "committedDate": "2020-04-23T17:41:45Z", "message": "Merge branch 'develop' into 6741-add-data-render-logic"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e8d2bf2edb875d1e695f08c230c421f7518cde9d", "author": {"user": {"login": "sekmiller", "name": "Stephen Kraffmiller"}}, "url": "https://github.com/IQSS/dataverse/commit/e8d2bf2edb875d1e695f08c230c421f7518cde9d", "committedDate": "2020-04-24T19:04:52Z", "message": "#6741 restrict Add Data in header"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a460b80a319b7c21ced6ca56840f89ed978d5db6", "author": {"user": {"login": "sekmiller", "name": "Stephen Kraffmiller"}}, "url": "https://github.com/IQSS/dataverse/commit/a460b80a319b7c21ced6ca56840f89ed978d5db6", "committedDate": "2020-04-24T19:27:35Z", "message": "#6741 remove unused script"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAwMjE0NzU5", "url": "https://github.com/IQSS/dataverse/pull/6856#pullrequestreview-400214759", "createdAt": "2020-04-24T19:27:36Z", "commit": {"oid": "e8d2bf2edb875d1e695f08c230c421f7518cde9d"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yNFQxOToyNzozN1rOGLmFtw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yNFQxOToyNzozN1rOGLmFtw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDgxMTU3NQ==", "bodyText": "Is this code just for debugging?", "url": "https://github.com/IQSS/dataverse/pull/6856#discussion_r414811575", "createdAt": "2020-04-24T19:27:37Z", "author": {"login": "pdurbin"}, "path": "src/main/webapp/dataverse_header.xhtml", "diffHunk": "@@ -189,6 +211,11 @@\n                 </div>\n             </div>\n         </noscript>\n+        <script>\n+function a () {\n+var contact = prompt(\"Add the contact.\");\n+}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e8d2bf2edb875d1e695f08c230c421f7518cde9d"}, "originalPosition": 72}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAwOTQxMjE4", "url": "https://github.com/IQSS/dataverse/pull/6856#pullrequestreview-400941218", "createdAt": "2020-04-27T13:17:35Z", "commit": {"oid": "a460b80a319b7c21ced6ca56840f89ed978d5db6"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yN1QxMzoxNzozNVrOGMiqcw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yN1QxMzoyMzozN1rOGMi8ZA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTgwNDAxOQ==", "bodyText": "The render logic in these duplicate ui:fragment components should consolidated and moved directly into the li components like other navbar features on this page <li jsf:rendered=\"#{...}\"> (line 88).", "url": "https://github.com/IQSS/dataverse/pull/6856#discussion_r415804019", "createdAt": "2020-04-27T13:17:35Z", "author": {"login": "mheppler"}, "path": "src/main/webapp/dataverse_header.xhtml", "diffHunk": "@@ -31,21 +39,35 @@\n                 </div>\n                 <div class=\"collapse navbar-collapse\" id=\"topNavBar\">\n                     <ul class=\"nav navbar-nav navbar-right\">\n-                        <li class=\"dropdown\">\n-                            <a href=\"#\" class=\"dropdown-toggle\" data-toggle=\"dropdown\">#{bundle['dataverse.results.btn.addData']} <b class=\"caret\"></b></a>\n-                            <ul class=\"dropdown-menu\">\n-                                <li>\n-                                    <h:outputLink value=\"/dataverse.xhtml?ownerId=#{dataverseServiceBean.findRootDataverse().id}\">\n-                                        <h:outputText value=\"#{bundle['dataverse.results.btn.addData.newDataverse']}\"/>\n-                                    </h:outputLink>\n-                                </li>\n-                                <li>\n-                                    <h:outputLink value=\"/dataset.xhtml?ownerId=#{dataverseServiceBean.findRootDataverse().id}\">\n-                                        <h:outputText value=\"#{bundle['dataverse.results.btn.addData.newDataset']}\"/>\n-                                    </h:outputLink>\n+                        <ui:fragment rendered=\"#{showAddDataGroup}\">", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a460b80a319b7c21ced6ca56840f89ed978d5db6"}, "originalPosition": 31}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTgwNTEzMw==", "bodyText": "Same render logic moved into the li here as suggested above.", "url": "https://github.com/IQSS/dataverse/pull/6856#discussion_r415805133", "createdAt": "2020-04-27T13:18:59Z", "author": {"login": "mheppler"}, "path": "src/main/webapp/dataverse_header.xhtml", "diffHunk": "@@ -31,21 +39,35 @@\n                 </div>\n                 <div class=\"collapse navbar-collapse\" id=\"topNavBar\">\n                     <ul class=\"nav navbar-nav navbar-right\">\n-                        <li class=\"dropdown\">\n-                            <a href=\"#\" class=\"dropdown-toggle\" data-toggle=\"dropdown\">#{bundle['dataverse.results.btn.addData']} <b class=\"caret\"></b></a>\n-                            <ul class=\"dropdown-menu\">\n-                                <li>\n-                                    <h:outputLink value=\"/dataverse.xhtml?ownerId=#{dataverseServiceBean.findRootDataverse().id}\">\n-                                        <h:outputText value=\"#{bundle['dataverse.results.btn.addData.newDataverse']}\"/>\n-                                    </h:outputLink>\n-                                </li>\n-                                <li>\n-                                    <h:outputLink value=\"/dataset.xhtml?ownerId=#{dataverseServiceBean.findRootDataverse().id}\">\n-                                        <h:outputText value=\"#{bundle['dataverse.results.btn.addData.newDataset']}\"/>\n-                                    </h:outputLink>\n+                        <ui:fragment rendered=\"#{showAddDataGroup}\">\n+                        <ui:fragment rendered=\"#{!authUserSession}\">\n+                            <li>\n+                                <a href=\"#\" onClick=\"PF('addData_popup').show()\">#{bundle['dataverse.results.btn.addData']} </a>\n+                            </li> \n+                        </ui:fragment>\n+\n+                            <ui:fragment rendered=\"#{authUserSession}\">\n+                                <li class=\"dropdown\">\n+                                    <a href=\"#\" class=\"dropdown-toggle\" data-toggle=\"dropdown\">#{bundle['dataverse.results.btn.addData']} <b class=\"caret\"></b></a>\n+                                    <ul class=\"dropdown-menu\">\n+                                        <ui:fragment rendered=\"#{showAddDataverseLink}\">", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a460b80a319b7c21ced6ca56840f89ed978d5db6"}, "originalPosition": 42}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTgwODYxMg==", "bodyText": "This addData_popup reference that was copied over from search-include-fragment will now look for that dialog on every page, but the dataverse pg is the only page that will have the dialog included on it.", "url": "https://github.com/IQSS/dataverse/pull/6856#discussion_r415808612", "createdAt": "2020-04-27T13:23:37Z", "author": {"login": "mheppler"}, "path": "src/main/webapp/dataverse_header.xhtml", "diffHunk": "@@ -31,21 +39,35 @@\n                 </div>\n                 <div class=\"collapse navbar-collapse\" id=\"topNavBar\">\n                     <ul class=\"nav navbar-nav navbar-right\">\n-                        <li class=\"dropdown\">\n-                            <a href=\"#\" class=\"dropdown-toggle\" data-toggle=\"dropdown\">#{bundle['dataverse.results.btn.addData']} <b class=\"caret\"></b></a>\n-                            <ul class=\"dropdown-menu\">\n-                                <li>\n-                                    <h:outputLink value=\"/dataverse.xhtml?ownerId=#{dataverseServiceBean.findRootDataverse().id}\">\n-                                        <h:outputText value=\"#{bundle['dataverse.results.btn.addData.newDataverse']}\"/>\n-                                    </h:outputLink>\n-                                </li>\n-                                <li>\n-                                    <h:outputLink value=\"/dataset.xhtml?ownerId=#{dataverseServiceBean.findRootDataverse().id}\">\n-                                        <h:outputText value=\"#{bundle['dataverse.results.btn.addData.newDataset']}\"/>\n-                                    </h:outputLink>\n+                        <ui:fragment rendered=\"#{showAddDataGroup}\">\n+                        <ui:fragment rendered=\"#{!authUserSession}\">\n+                            <li>\n+                                <a href=\"#\" onClick=\"PF('addData_popup').show()\">#{bundle['dataverse.results.btn.addData']} </a>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a460b80a319b7c21ced6ca56840f89ed978d5db6"}, "originalPosition": 34}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7b9c999c3449f71d9e3e67d9310ea3c5bd12a035", "author": {"user": {"login": "sekmiller", "name": "Stephen Kraffmiller"}}, "url": "https://github.com/IQSS/dataverse/commit/7b9c999c3449f71d9e3e67d9310ea3c5bd12a035", "committedDate": "2020-04-27T15:05:44Z", "message": "#6741 address CR suggestions"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAxMDczOTkw", "url": "https://github.com/IQSS/dataverse/pull/6856#pullrequestreview-401073990", "createdAt": "2020-04-27T15:36:14Z", "commit": {"oid": "7b9c999c3449f71d9e3e67d9310ea3c5bd12a035"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yN1QxNTozNjoxNFrOGMprmA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yN1QxNTozNjoxNFrOGMprmA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTkxOTAwMA==", "bodyText": "I was wondering what the best way to handle this popup is, and I think this a great solution. \ud83d\udc4d", "url": "https://github.com/IQSS/dataverse/pull/6856#discussion_r415919000", "createdAt": "2020-04-27T15:36:14Z", "author": {"login": "mheppler"}, "path": "src/main/webapp/dataverse_template.xhtml", "diffHunk": "@@ -79,6 +79,7 @@\n             </f:facet>\n         </p:ajaxStatus>\n         <ui:include src=\"contactFormFragment.xhtml\"></ui:include>\n+        <ui:include src=\"addDataFormFragment.xhtml\"></ui:include>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7b9c999c3449f71d9e3e67d9310ea3c5bd12a035"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAxMDc1MDcy", "url": "https://github.com/IQSS/dataverse/pull/6856#pullrequestreview-401075072", "createdAt": "2020-04-27T15:37:27Z", "commit": {"oid": "7b9c999c3449f71d9e3e67d9310ea3c5bd12a035"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bb287377d90a57a61bd0675f4d5323aa7b0bc767", "author": {"user": {"login": "sekmiller", "name": "Stephen Kraffmiller"}}, "url": "https://github.com/IQSS/dataverse/commit/bb287377d90a57a61bd0675f4d5323aa7b0bc767", "committedDate": "2020-04-27T19:39:14Z", "message": "#6741 Change add data button logic to AuthUser only"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "674a240c9e39f32182350ee84588dcf0874b3117", "author": {"user": {"login": "sekmiller", "name": "Stephen Kraffmiller"}}, "url": "https://github.com/IQSS/dataverse/commit/674a240c9e39f32182350ee84588dcf0874b3117", "committedDate": "2020-04-28T18:01:56Z", "message": "#6741 redirect to login page from Add Data in header\n\n-if the user is not logged in when pressing button"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ff4806046ba0c27d6e0f6ab56349937ffc630221", "author": {"user": {"login": "sekmiller", "name": "Stephen Kraffmiller"}}, "url": "https://github.com/IQSS/dataverse/commit/ff4806046ba0c27d6e0f6ab56349937ffc630221", "committedDate": "2020-04-28T19:27:37Z", "message": "#6741 move popup include back to search inc frag"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAyMTQ2OTAw", "url": "https://github.com/IQSS/dataverse/pull/6856#pullrequestreview-402146900", "createdAt": "2020-04-28T19:30:37Z", "commit": {"oid": "ff4806046ba0c27d6e0f6ab56349937ffc630221"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 977, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}