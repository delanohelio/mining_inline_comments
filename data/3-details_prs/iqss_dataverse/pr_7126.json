{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDU1ODgzOTM0", "number": 7126, "title": "post 6823 edit file form update fixes", "bodyText": "What this PR does / why we need it: fixes bugs introduced in by #7045\nWhich issue(s) this PR closes:\nCloses #7123\nSpecial notes for your reviewer: I picked the contentOfHttpPanel to fix the direct upload issue (when the select files widget is updated, the directupload script that is outside that (above in the code) needs to run again and wasn't. Any other element outside the script could work. For the fix of the button updates, I changes the name of the element from filesButtons to completionButtons primarily because an empty element with that name is now in the dataset.xhtml but the name could stay as it was.(I originally put the empty panel around the button bar in the dataset form (in which case a name change would be more helpful) but I updating those buttons (in dataset create mode) isn't needed.)\nSuggestions on how to test this: Current production - using direct upload and uploading a file leaves the 'select new files' box with upload and cancel buttons showing. The button at the bottom of the page remains as 'Done' rather than updating to 'Save/Cancel' . (Same behavior after the first upload to a file store, but the 'Done' button updates to Save/Cancel after a second upload of additional file(s)). With the fix, direct-upload and normal upload to s3 or files (testing just one of these two should be OK) in dataset create and edit mode should always work - direct upload shows a normal select files box after a single file is uploaded and the 'Done' button changes in edit for all cases after one upload, and the dataset create form still doesn't scroll to the top of the page (just keeps the select files box in view)).\nDoes this PR introduce a user interface change? If mockups are available, please link/include them here: only restores missing functionality from prior to #7045.\nIs there a release notes update needed for this change?: no\nAdditional documentation:", "createdAt": "2020-07-23T18:32:32Z", "url": "https://github.com/IQSS/dataverse/pull/7126", "merged": true, "mergeCommit": {"oid": "746d7b6d571c4324b59aaafdd8040d7fc2cec8b4"}, "closed": true, "closedAt": "2020-07-29T19:13:22Z", "author": {"login": "qqmyers"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc3zizCgH2gAyNDU1ODgzOTM0OjU5YTVhZDBmOWI4MTBlYmYzNWM2YTA0ODlhZjYxY2JkYjZjZDRjMTI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc5XbRNAH2gAyNDU1ODgzOTM0OmRjMTlmZGM4YWZmZDQxMjE2N2Y1Njk5MmMxNTI2Nzc1MjczZDQ3ZWE=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "59a5ad0f9b810ebf35c6a0489af61cbdb6cd4c12", "author": {"user": {"login": "qqmyers", "name": null}}, "url": "https://github.com/IQSS/dataverse/commit/59a5ad0f9b810ebf35c6a0489af61cbdb6cd4c12", "committedDate": "2020-07-23T18:15:05Z", "message": "fix file upload form updating in create and edit modes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a79366d6a30247fac683352c2ec10d16186c8965", "author": {"user": {"login": "qqmyers", "name": null}}, "url": "https://github.com/IQSS/dataverse/commit/a79366d6a30247fac683352c2ec10d16186c8965", "committedDate": "2020-07-23T18:16:28Z", "message": "remove blank line"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU0NDE1Nzk5", "url": "https://github.com/IQSS/dataverse/pull/7126#pullrequestreview-454415799", "createdAt": "2020-07-23T19:02:51Z", "commit": {"oid": "a79366d6a30247fac683352c2ec10d16186c8965"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yM1QxOTowMjo1MVrOG2XunA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yM1QxOTowMjo1MVrOG2XunA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTY2NTA1Mg==", "bodyText": "Does the addition of the contentOfHttpPanel to the update here make the fileUpload component redundant?", "url": "https://github.com/IQSS/dataverse/pull/7126#discussion_r459665052", "createdAt": "2020-07-23T19:02:51Z", "author": {"login": "mheppler"}, "path": "src/main/webapp/editFilesFragment.xhtml", "diffHunk": "@@ -282,7 +282,7 @@\n                     \n                     <p:commandButton id=\"updateEditDataFilesButtonsForUpload\" action=\"#{EditDatafilesPage.uploadFinished()}\" update=\"datasetForm:editDataFilesButtons\" rendered=\"#{showFileButtonUpdate}\" style=\"display:none\"/>\n                     <p:commandButton id=\"updateEditDataFilesButtonsForDelete\" action=\"#{EditDatafilesPage.deleteFilesCompleted()}\" update=\"datasetForm:editDataFilesButtons\" rendered=\"#{showFileButtonUpdate}\" style=\"display:none\"/>\n-                    <p:commandButton id=\"AllUploadsFinished\" action=\"#{EditDatafilesPage.uploadFinished()}\" update=\"datasetForm:fileUpload,datasetForm:dropBoxUserButton,datasetForm:uploadMessage,datasetForm:rsyncPanel,datasetForm:filesCounts,datasetForm:filesTable\" oncomplete=\"javascript:bind_bsui_components();javascript:uploadWidgetDropMsg();\" style=\"display:none\"/> \n+                    <p:commandButton id=\"AllUploadsFinished\" action=\"#{EditDatafilesPage.uploadFinished()}\" update=\"datasetForm:completionButtons,datasetForm:contentOfHttpPanel,datasetForm:fileUpload,datasetForm:dropBoxUserButton,datasetForm:uploadMessage,datasetForm:rsyncPanel,datasetForm:filesCounts,datasetForm:filesTable\" oncomplete=\"javascript:bind_bsui_components();javascript:uploadWidgetDropMsg();\" style=\"display:none\"/> ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a79366d6a30247fac683352c2ec10d16186c8965"}, "originalPosition": 14}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU0NDE3MzU2", "url": "https://github.com/IQSS/dataverse/pull/7126#pullrequestreview-454417356", "createdAt": "2020-07-23T19:05:09Z", "commit": {"oid": "a79366d6a30247fac683352c2ec10d16186c8965"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yM1QxOTowNTowOVrOG2Xzmw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yM1QxOTowNTowOVrOG2Xzmw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTY2NjMzMQ==", "bodyText": "Isn't this a duplicate ID of the new completionButtons outputPanel added to the dataset?", "url": "https://github.com/IQSS/dataverse/pull/7126#discussion_r459666331", "createdAt": "2020-07-23T19:05:09Z", "author": {"login": "mheppler"}, "path": "src/main/webapp/filesFragment.xhtml", "diffHunk": "@@ -117,7 +117,7 @@\n                     </div>\n                 </div>\n                 <div class=\"col-xs-7 text-right\">\n-                    <p:outputPanel id=\"filesButtons\">\n+                    <p:outputPanel id=\"completionButtons\">", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a79366d6a30247fac683352c2ec10d16186c8965"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU2NjQwNjQ2", "url": "https://github.com/IQSS/dataverse/pull/7126#pullrequestreview-456640646", "createdAt": "2020-07-28T13:39:59Z", "commit": {"oid": "a79366d6a30247fac683352c2ec10d16186c8965"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "398459cf4b7c67b1b6e5eab96e24ddfef89eabaf", "author": {"user": {"login": "qqmyers", "name": null}}, "url": "https://github.com/IQSS/dataverse/commit/398459cf4b7c67b1b6e5eab96e24ddfef89eabaf", "committedDate": "2020-07-28T14:33:53Z", "message": "Merge remote-tracking branch 'IQSS/develop' into IQSS/7123_edit_file-form_updates"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dc19fdc8affd412167f56992c1526775273d47ea", "author": {"user": {"login": "qqmyers", "name": null}}, "url": "https://github.com/IQSS/dataverse/commit/dc19fdc8affd412167f56992c1526775273d47ea", "committedDate": "2020-07-28T14:37:22Z", "message": "simplify by using 'optional' update of filesButtons"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 911, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}