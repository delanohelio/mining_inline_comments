{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDU1ODc1MTA5", "number": 7124, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wN1QxMzo0MDowMFrOEWOBaA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMlQyMTo0OTozOVrOEXz8UQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkxNzMzODY0OnYy", "diffSide": "RIGHT", "path": "src/main/java/edu/harvard/iq/dataverse/util/FileUtil.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wN1QxMzo0MDowMFrOG9aROw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wN1QxODo1NToxMlrOG9kh-w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzA0NjcxNQ==", "bodyText": "Do we care if the suppliedContentType is blank or null?", "url": "https://github.com/IQSS/dataverse/pull/7124#discussion_r467046715", "createdAt": "2020-08-07T13:40:00Z", "author": {"login": "sekmiller"}, "path": "src/main/java/edu/harvard/iq/dataverse/util/FileUtil.java", "diffHunk": "@@ -1091,8 +1091,13 @@ public static String generateOriginalExtension(String fileType) {\n \n \t\t\t} \n \t\t} else {\n-\t\t\t//Remote file, trust supplier\n-\t\t\tfinalType = suppliedContentType;\n+\t\t\tif(suppliedContentType==FileUtil.MIME_TYPE_UNDETERMINED_DEFAULT) {\n+\t\t\t\tfinalType=determineFileTypeByExtension(fileName);\n+\t\t\t\tlogger.fine(\"Determined type: \" + finalType);\n+\t\t\t} else {\n+\t\t\t  //Remote file, trust supplier\n+\t\t\t  finalType = suppliedContentType;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8ae270b9a04924ac8fd0b1b2371b9e96e38800ff"}, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzA2MTc3NA==", "bodyText": "That should already be being caught (e.g. in the EditDatafilesPage.handleExternalUpload method) but worth a safety check here probably. And we shouldn't replace the default with a null/blank response if determineFileTypeByExtension returns null/blank.", "url": "https://github.com/IQSS/dataverse/pull/7124#discussion_r467061774", "createdAt": "2020-08-07T14:04:55Z", "author": {"login": "qqmyers"}, "path": "src/main/java/edu/harvard/iq/dataverse/util/FileUtil.java", "diffHunk": "@@ -1091,8 +1091,13 @@ public static String generateOriginalExtension(String fileType) {\n \n \t\t\t} \n \t\t} else {\n-\t\t\t//Remote file, trust supplier\n-\t\t\tfinalType = suppliedContentType;\n+\t\t\tif(suppliedContentType==FileUtil.MIME_TYPE_UNDETERMINED_DEFAULT) {\n+\t\t\t\tfinalType=determineFileTypeByExtension(fileName);\n+\t\t\t\tlogger.fine(\"Determined type: \" + finalType);\n+\t\t\t} else {\n+\t\t\t  //Remote file, trust supplier\n+\t\t\t  finalType = suppliedContentType;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzA0NjcxNQ=="}, "originalCommit": {"oid": "8ae270b9a04924ac8fd0b1b2371b9e96e38800ff"}, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzIxNDg0Mw==", "bodyText": "If you make that change, I'll put this into QA. Thanks!", "url": "https://github.com/IQSS/dataverse/pull/7124#discussion_r467214843", "createdAt": "2020-08-07T18:55:12Z", "author": {"login": "sekmiller"}, "path": "src/main/java/edu/harvard/iq/dataverse/util/FileUtil.java", "diffHunk": "@@ -1091,8 +1091,13 @@ public static String generateOriginalExtension(String fileType) {\n \n \t\t\t} \n \t\t} else {\n-\t\t\t//Remote file, trust supplier\n-\t\t\tfinalType = suppliedContentType;\n+\t\t\tif(suppliedContentType==FileUtil.MIME_TYPE_UNDETERMINED_DEFAULT) {\n+\t\t\t\tfinalType=determineFileTypeByExtension(fileName);\n+\t\t\t\tlogger.fine(\"Determined type: \" + finalType);\n+\t\t\t} else {\n+\t\t\t  //Remote file, trust supplier\n+\t\t\t  finalType = suppliedContentType;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzA0NjcxNQ=="}, "originalCommit": {"oid": "8ae270b9a04924ac8fd0b1b2371b9e96e38800ff"}, "originalPosition": 11}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkzNDAzNzI5OnYy", "diffSide": "RIGHT", "path": "src/main/java/edu/harvard/iq/dataverse/util/FileUtil.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMlQyMTo0OTozOVrOG_0EuA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMlQyMTo0OTozOVrOG_0EuA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTU2NjY0OA==", "bodyText": "just moved and made to return a boolean, no logic changes.", "url": "https://github.com/IQSS/dataverse/pull/7124#discussion_r469566648", "createdAt": "2020-08-12T21:49:39Z", "author": {"login": "qqmyers"}, "path": "src/main/java/edu/harvard/iq/dataverse/util/FileUtil.java", "diffHunk": "@@ -1126,7 +1106,42 @@ public static String generateOriginalExtension(String fileType) {\n     }   // end createDataFiles\n     \n \n-    private static File saveInputStreamInTempFile(InputStream inputStream, Long fileSizeLimit)\n+\tprivate static boolean useRecognizedType(String suppliedContentType, String recognizedType) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b3be92f4ae977d7883abf1a1b1fed151daa9d7f0"}, "originalPosition": 83}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3284, "cost": 1, "resetAt": "2021-11-13T12:10:21Z"}}}