{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQwNTc4MjM2", "number": 7025, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMVQyMDo1MTozMVrOEKqD3w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMVQyMTowNzozMVrOEKqVZw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc5NjEwMzM1OnYy", "diffSide": "RIGHT", "path": "doc/sphinx-guides/source/installation/oauth2.rst", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMVQyMDo1MTozMVrOGr09Xg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMlQxNDo1MDoyOVrOGsQVnA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODYwOTYzMA==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            - ORCID: https://orcid.org/content/register-client-application-0\n          \n          \n            \n            - ORCID: https://orcid.org/content/register-client-application", "url": "https://github.com/IQSS/dataverse/pull/7025#discussion_r448609630", "createdAt": "2020-07-01T20:51:31Z", "author": {"login": "poikilotherm"}, "path": "doc/sphinx-guides/source/installation/oauth2.rst", "diffHunk": "@@ -26,11 +26,11 @@ Identity Provider Side\n Obtain Client ID and Client Secret \n ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n \n-Before OAuth providers will release information about their users (first name, last name, etc.) to your Dataverse installation, you must request a \"Client ID\" and \"Client Secret\" from them. In the case of GitHub and Google, this is as simple as clicking a few buttons and there is no cost associated with using their authentication service. ORCID and Microsoft, on the other hand, do not have an automated system for requesting these credentials, and it is not free to use these authentication services.\n+Before OAuth providers will release information about their users (first name, last name, etc.) to your Dataverse installation, you must request a \"Client ID\" and \"Client Secret\" from them. In many cases you can use providers' automated system to request these credentials, but if not, contact the provider for assistance.\n \n URLs to help you request a Client ID and Client Secret from the providers supported by Dataverse are provided below.  For all of these providers, it's a good idea to request the Client ID and Client secret using a generic account, perhaps the one that's associated with the ``:SystemEmail`` you've configured for Dataverse, rather than your own personal Microsoft Azure AD, ORCID, GitHub, or Google account:\n \n-- ORCID: https://orcid.org/content/register-client-application-production-trusted-party\n+- ORCID: https://orcid.org/content/register-client-application-0", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0bcd8711d07e82df96f5ca692ce7de463bd139de"}, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTAxMzczNQ==", "bodyText": "Can you please update the top comment of the PR to match the pull request template format in other PRs\n\nThis done so I'm moving this to code review.", "url": "https://github.com/IQSS/dataverse/pull/7025#discussion_r449013735", "createdAt": "2020-07-02T13:46:41Z", "author": {"login": "pdurbin"}, "path": "doc/sphinx-guides/source/installation/oauth2.rst", "diffHunk": "@@ -26,11 +26,11 @@ Identity Provider Side\n Obtain Client ID and Client Secret \n ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n \n-Before OAuth providers will release information about their users (first name, last name, etc.) to your Dataverse installation, you must request a \"Client ID\" and \"Client Secret\" from them. In the case of GitHub and Google, this is as simple as clicking a few buttons and there is no cost associated with using their authentication service. ORCID and Microsoft, on the other hand, do not have an automated system for requesting these credentials, and it is not free to use these authentication services.\n+Before OAuth providers will release information about their users (first name, last name, etc.) to your Dataverse installation, you must request a \"Client ID\" and \"Client Secret\" from them. In many cases you can use providers' automated system to request these credentials, but if not, contact the provider for assistance.\n \n URLs to help you request a Client ID and Client Secret from the providers supported by Dataverse are provided below.  For all of these providers, it's a good idea to request the Client ID and Client secret using a generic account, perhaps the one that's associated with the ``:SystemEmail`` you've configured for Dataverse, rather than your own personal Microsoft Azure AD, ORCID, GitHub, or Google account:\n \n-- ORCID: https://orcid.org/content/register-client-application-production-trusted-party\n+- ORCID: https://orcid.org/content/register-client-application-0", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODYwOTYzMA=="}, "originalCommit": {"oid": "0bcd8711d07e82df96f5ca692ce7de463bd139de"}, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTA1ODIwNA==", "bodyText": "Interesting. I got the longer link with the \"-0\" at the end from https://orcid.org/organizations/integrators but I do think the shorter link looks nicer (and goes to the same place) so it would be a good change. @felker13 I don't have access to accept this change.", "url": "https://github.com/IQSS/dataverse/pull/7025#discussion_r449058204", "createdAt": "2020-07-02T14:50:29Z", "author": {"login": "pdurbin"}, "path": "doc/sphinx-guides/source/installation/oauth2.rst", "diffHunk": "@@ -26,11 +26,11 @@ Identity Provider Side\n Obtain Client ID and Client Secret \n ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n \n-Before OAuth providers will release information about their users (first name, last name, etc.) to your Dataverse installation, you must request a \"Client ID\" and \"Client Secret\" from them. In the case of GitHub and Google, this is as simple as clicking a few buttons and there is no cost associated with using their authentication service. ORCID and Microsoft, on the other hand, do not have an automated system for requesting these credentials, and it is not free to use these authentication services.\n+Before OAuth providers will release information about their users (first name, last name, etc.) to your Dataverse installation, you must request a \"Client ID\" and \"Client Secret\" from them. In many cases you can use providers' automated system to request these credentials, but if not, contact the provider for assistance.\n \n URLs to help you request a Client ID and Client Secret from the providers supported by Dataverse are provided below.  For all of these providers, it's a good idea to request the Client ID and Client secret using a generic account, perhaps the one that's associated with the ``:SystemEmail`` you've configured for Dataverse, rather than your own personal Microsoft Azure AD, ORCID, GitHub, or Google account:\n \n-- ORCID: https://orcid.org/content/register-client-application-production-trusted-party\n+- ORCID: https://orcid.org/content/register-client-application-0", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODYwOTYzMA=="}, "originalCommit": {"oid": "0bcd8711d07e82df96f5ca692ce7de463bd139de"}, "originalPosition": 10}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc5NjE0ODIzOnYy", "diffSide": "RIGHT", "path": "src/main/java/edu/harvard/iq/dataverse/authorization/providers/oauth2/impl/OrcidOAuth2AP.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMVQyMTowNzozMVrOGr1Yyg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMlQxNDo1MTowM1rOGsQXHQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODYxNjY1MA==", "bodyText": "One could argue that this can be done more compact with only one if and without an extra variable allocation.\nE. g. like\nif(userEndpoint != null && userEndpoint.startsWith(\"https://pub\")) {\n    this.scope = Arrays.asList(\"/authenticate\");\n} else {\n    this.scope = Arrays.asList(\"/read-limited\");\n}\nOr you leave it to the code optimizer of the JVM... \ud83d\ude09", "url": "https://github.com/IQSS/dataverse/pull/7025#discussion_r448616650", "createdAt": "2020-07-01T21:07:31Z", "author": {"login": "poikilotherm"}, "path": "src/main/java/edu/harvard/iq/dataverse/authorization/providers/oauth2/impl/OrcidOAuth2AP.java", "diffHunk": "@@ -55,7 +55,12 @@\n     public static final String PROVIDER_ID_SANDBOX = \"orcid-sandbox\";\n     \n     public OrcidOAuth2AP(String clientId, String clientSecret, String userEndpoint) {\n-        scope = Arrays.asList(\"/read-limited\");\n+\n+        String s = null;\n+        if(userEndpoint != null){\n+            s = userEndpoint.startsWith(\"https://pub\") ? \"/authenticate\" : \"/read-limited\";\n+        }\n+        scope = Arrays.asList(s);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0bcd8711d07e82df96f5ca692ce7de463bd139de"}, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTA1ODU4OQ==", "bodyText": "I'm fine with letting the JVM optimize it. \ud83d\ude04", "url": "https://github.com/IQSS/dataverse/pull/7025#discussion_r449058589", "createdAt": "2020-07-02T14:51:03Z", "author": {"login": "pdurbin"}, "path": "src/main/java/edu/harvard/iq/dataverse/authorization/providers/oauth2/impl/OrcidOAuth2AP.java", "diffHunk": "@@ -55,7 +55,12 @@\n     public static final String PROVIDER_ID_SANDBOX = \"orcid-sandbox\";\n     \n     public OrcidOAuth2AP(String clientId, String clientSecret, String userEndpoint) {\n-        scope = Arrays.asList(\"/read-limited\");\n+\n+        String s = null;\n+        if(userEndpoint != null){\n+            s = userEndpoint.startsWith(\"https://pub\") ? \"/authenticate\" : \"/read-limited\";\n+        }\n+        scope = Arrays.asList(s);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODYxNjY1MA=="}, "originalCommit": {"oid": "0bcd8711d07e82df96f5ca692ce7de463bd139de"}, "originalPosition": 10}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3241, "cost": 1, "resetAt": "2021-11-13T12:10:21Z"}}}