{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ1NzA3ODQy", "number": 7062, "title": "4597 Fix invalid identify response.", "bodyText": "What this PR does / why we need it: Changes the Identify response for a OAI PMH request so it's XSD valid.\nWhich issue(s) this PR closes: 4597\nCloses #4597\nSpecial notes for your reviewer: It's looking good\nSuggestions on how to test this: Example call: https://dataverse.harvard.edu/oai?verb=Identify\nDoes this PR introduce a user interface change? If mockups are available, please link/include them here: No\nIs there a release notes update needed for this change?: Perhaps\nAdditional documentation:", "createdAt": "2020-07-07T21:52:30Z", "url": "https://github.com/IQSS/dataverse/pull/7062", "merged": true, "mergeCommit": {"oid": "3158c86c7e903841d91af158a5417079558fd22b"}, "closed": true, "closedAt": "2020-08-03T20:56:37Z", "author": {"login": "JingMa87"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABczRhHxgFqTQ0NTc3MzQ0OA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABc6VC7vAFqTQ1OTIxNTQ0Mg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ1NzczNDQ4", "url": "https://github.com/IQSS/dataverse/pull/7062#pullrequestreview-445773448", "createdAt": "2020-07-09T16:20:09Z", "commit": {"oid": "f69f048bd1dae54199b27a3eb4cc32944a04a29c"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOVQxNjoyMDowOVrOGvYenA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOVQxNjoyMDowOVrOGvYenA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjMzNzMwOA==", "bodyText": "In #4597 @JingMa87 and I have been discussing making \"repositoryIdentifier\" (and possibly other identifiers configurable).", "url": "https://github.com/IQSS/dataverse/pull/7062#discussion_r452337308", "createdAt": "2020-07-09T16:20:09Z", "author": {"login": "pdurbin"}, "path": "src/main/java/edu/harvard/iq/dataverse/harvest/server/web/servlet/OAIServlet.java", "diffHunk": "@@ -193,10 +193,48 @@ private RepositoryConfiguration createRepositoryConfiguration() {\n                 .withMaxListRecords(100)\n                 .withMaxListSets(100)\n                 .withEarliestDate(new Date());\n-        \n+        String descriptionXml = getDescriptionXml();\n+        if (descriptionXml != null) {\n+            repositoryConfiguration.withDescription(descriptionXml);\n+        }\n         return repositoryConfiguration; \n     }\n-    \n+\n+    private String getDescriptionXml() {\n+        try {\n+            // Builds the XML\n+            Document doc = DocumentBuilderFactory.newInstance().newDocumentBuilder().newDocument();\n+            Element oaiIdentifier = doc.createElement(\"oai-identifier\");\n+            oaiIdentifier.setAttribute(\"xmlns\", \"http://www.openarchives.org/OAI/2.0/oai-identifier\");\n+            oaiIdentifier.setAttribute(\"xmlns:xsi\", \"http://www.w3.org/2001/XMLSchema-instance\");\n+            oaiIdentifier.setAttribute(\"xsi:schemaLocation\", \"http://www.openarchives.org/OAI/2.0/oai-identifier http://www.openarchives.org/OAI/2.0/oai-identifier.xsd\");\n+            doc.appendChild(oaiIdentifier);\n+            Element scheme = doc.createElement(\"scheme\");\n+            scheme.appendChild(doc.createTextNode(\"oai\"));\n+            oaiIdentifier.appendChild(scheme);\n+            Element repositoryIdentifier = doc.createElement(\"repositoryIdentifier\");\n+            repositoryIdentifier.appendChild(doc.createTextNode(\"dataverse.org\"));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f69f048bd1dae54199b27a3eb4cc32944a04a29c"}, "originalPosition": 109}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUyNjE2Mjky", "url": "https://github.com/IQSS/dataverse/pull/7062#pullrequestreview-452616292", "createdAt": "2020-07-21T16:12:15Z", "commit": {"oid": "7ebdb42009076430312ab7068834f6a637c94675"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQxNjoxMjoxNVrOG0_elA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQxNjoyMzo1MFrOG0_83A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODIxOTE1Ng==", "bodyText": "Why is this change to @form in this pull request?", "url": "https://github.com/IQSS/dataverse/pull/7062#discussion_r458219156", "createdAt": "2020-07-21T16:12:15Z", "author": {"login": "pdurbin"}, "path": "src/main/webapp/editFilesFragment.xhtml", "diffHunk": "@@ -282,7 +282,7 @@\n                     \n                     <p:commandButton id=\"updateEditDataFilesButtonsForUpload\" action=\"#{EditDatafilesPage.uploadFinished()}\" update=\"datasetForm:editDataFilesButtons\" rendered=\"#{showFileButtonUpdate}\" style=\"display:none\"/>\n                     <p:commandButton id=\"updateEditDataFilesButtonsForDelete\" action=\"#{EditDatafilesPage.deleteFilesCompleted()}\" update=\"datasetForm:editDataFilesButtons\" rendered=\"#{showFileButtonUpdate}\" style=\"display:none\"/>\n-                    <p:commandButton id=\"AllUploadsFinished\" action=\"#{EditDatafilesPage.uploadFinished()}\" update=\"@form,datasetForm:fileUpload,datasetForm:dropBoxUserButton,datasetForm:uploadMessage,datasetForm:rsyncPanel,datasetForm:filesCounts,datasetForm:filesTable\" oncomplete=\"javascript:bind_bsui_components();javascript:uploadWidgetDropMsg();\" style=\"display:none\"/> ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7ebdb42009076430312ab7068834f6a637c94675"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODIxOTU0NQ==", "bodyText": "Why is this change to immediate=\"true\" true` in this pull request?", "url": "https://github.com/IQSS/dataverse/pull/7062#discussion_r458219545", "createdAt": "2020-07-21T16:12:48Z", "author": {"login": "pdurbin"}, "path": "src/main/webapp/dataset.xhtml", "diffHunk": "@@ -1589,7 +1589,7 @@\n                         </ui:fragment>\n                         <div class=\"button-block\">\n                             <p:commandButton styleClass=\"btn btn-default\" value=\"#{bundle.continue}\" \n-                                             onclick=\"PF('publishDataset').hide();PF('blockDatasetForm').hide();\" action=\"#{DatasetPage.releaseDataset}\" immediate=\"true\"/>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7ebdb42009076430312ab7068834f6a637c94675"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODIyMzk2Mw==", "bodyText": "Can you please change all these (in the code too, of course) to start with \"Harvesting\"? That is:\n:HarvestingScheme, :HarvestingRepositoryIdentifier, :HarvestingDelimiter, :HarvestingSampleIdentifier\nOtherwise, they're too generic, especially :Scheme or :Delimiter.", "url": "https://github.com/IQSS/dataverse/pull/7062#discussion_r458223963", "createdAt": "2020-07-21T16:19:26Z", "author": {"login": "pdurbin"}, "path": "doc/release-notes/4597-fix-invalid-identify-response.md", "diffHunk": "@@ -0,0 +1 @@\n+Added the following database options: Scheme, RepositoryIdentifier, Delimiter, SampleIdentifier.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7ebdb42009076430312ab7068834f6a637c94675"}, "originalPosition": 1}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODIyNjkwOA==", "bodyText": "In http://oval.base-search.net this DOI is giving an error:\nERROR: Identify response well-formed but invalid: Element '{http://www.openarchives.org/OAI/2.0/oai-identifier}sampleIdentifier': [facet 'pattern'] The value 'doi:10.7910/DVN/1HE30F' is not accepted by the pattern 'oai:[a-zA-Z][a-zA-Z0-9-](.[a-zA-Z][a-zA-Z0-9-])+:[a-zA-Z0-9-_.!~*'();/?:@&=+$,%]+'., line 5\nIn context:", "url": "https://github.com/IQSS/dataverse/pull/7062#discussion_r458226908", "createdAt": "2020-07-21T16:23:50Z", "author": {"login": "pdurbin"}, "path": "src/main/java/edu/harvard/iq/dataverse/harvest/server/web/servlet/OAIServlet.java", "diffHunk": "@@ -180,6 +180,11 @@ private RepositoryConfiguration createRepositoryConfiguration() {\n         String dataverseName = dataverseService.findRootDataverse().getName();\n         String repositoryName = StringUtils.isEmpty(dataverseName) || \"Root\".equals(dataverseName) ? \"Test Dataverse OAI Archive\" : dataverseName + \" Dataverse OAI Archive\";\n         InternetAddress internetAddress = MailUtil.parseSystemAddress(settingsService.getValueForKey(SettingsServiceBean.Key.SystemEmail));\n+        String scheme = settingsService.getValueForKey(SettingsServiceBean.Key.Scheme, \"oai\");\n+        String repositoryIdentifier = settingsService.getValueForKey(SettingsServiceBean.Key.RepositoryIdentifier, \"dataverse.org\");\n+        String delimiter = settingsService.getValueForKey(SettingsServiceBean.Key.Delimiter, \":\");\n+        String sampleIdentifier = settingsService.getValueForKey(SettingsServiceBean.Key.SampleIdentifier, \"doi:10.7910/DVN/1HE30F\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7ebdb42009076430312ab7068834f6a637c94675"}, "originalPosition": 90}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "089415c9f499d8fe3feb067e05435962c74afd2b", "author": {"user": {"login": "JingMa87", "name": "Jing Ma"}}, "url": "https://github.com/IQSS/dataverse/commit/089415c9f499d8fe3feb067e05435962c74afd2b", "committedDate": "2020-07-31T10:25:45Z", "message": "4597 Remove the default description from the Identify response."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU5MjE1NDQy", "url": "https://github.com/IQSS/dataverse/pull/7062#pullrequestreview-459215442", "createdAt": "2020-07-31T14:24:54Z", "commit": {"oid": "089415c9f499d8fe3feb067e05435962c74afd2b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 883, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}