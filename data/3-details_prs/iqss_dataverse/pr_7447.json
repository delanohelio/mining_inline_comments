{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTMwNjEwMDQ2", "number": 7447, "title": "7398 saved search performance", "bodyText": "What this PR does / why we need it:\nAdds some optimization for saved searches and some code cleanup\nWhich issue(s) this PR closes:\nNone for sure - it may fix #7398if the performance is improved enough\nSpecial notes for your reviewer:\nWhile I was at it, I made some Named queries and did some cleanup.\nSuggestions on how to test this:\njust make sure saved searches work as expected. You could also compare the timing of how long it takes to update a saved search before and after. (I will be doing some timing test with prod once released)\nDoes this PR introduce a user interface change? If mockups are available, please link/include them here:\nNo\nIs there a release notes update needed for this change?:\nNo\nAdditional documentation:", "createdAt": "2020-12-01T22:19:34Z", "url": "https://github.com/IQSS/dataverse/pull/7447", "merged": true, "mergeCommit": {"oid": "b5b96fc52f39e5e65c3376539f6df59d4b2166bc"}, "closed": true, "closedAt": "2020-12-03T20:49:26Z", "author": {"login": "scolapasta"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdh_fBDAH2gAyNTMwNjEwMDQ2OmZiNzMwZWExNzdlYzRmZGNmMzNiOGMxZTUzYjM2NzhhNTRhY2IyMDM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdiTGmeAFqTU0MzEzNjI0Ng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "fb730ea177ec4fdcf33b8c1e53b3678a54acb203", "author": {"user": {"login": "djbrooke", "name": "Danny Brooke"}}, "url": "https://github.com/IQSS/dataverse/commit/fb730ea177ec4fdcf33b8c1e53b3678a54acb203", "committedDate": "2020-12-01T19:54:38Z", "message": "adding release note about optimization"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6caeef67b3002fc52e72f5c0fbfa3316777de975", "author": {"user": null}, "url": "https://github.com/IQSS/dataverse/commit/6caeef67b3002fc52e72f5c0fbfa3316777de975", "committedDate": "2020-12-01T22:10:31Z", "message": "performance tweak for saved search (reduce queries) and code cleanup"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cc62a8ffa49ff7ff658efaf5c89db5f1517266a6", "author": {"user": null}, "url": "https://github.com/IQSS/dataverse/commit/cc62a8ffa49ff7ff658efaf5c89db5f1517266a6", "committedDate": "2020-12-01T22:11:21Z", "message": "Merge origin/7398-saved-search-performance into 7398-saved-search-performance"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b016574a6853470570d292d6778daf7d6395fae8", "author": {"user": {"login": "scolapasta", "name": "Gustavo Durand"}}, "url": "https://github.com/IQSS/dataverse/commit/b016574a6853470570d292d6778daf7d6395fae8", "committedDate": "2020-12-01T22:17:29Z", "message": "Delete 7398-saved-search-optimization.md"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "275d9d4af4883395e528494520f4d0fe22d05883", "author": {"user": {"login": "scolapasta", "name": "Gustavo Durand"}}, "url": "https://github.com/IQSS/dataverse/commit/275d9d4af4883395e528494520f4d0fe22d05883", "committedDate": "2020-12-02T03:52:55Z", "message": "accidentally checked in \"debug\" schedule"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "acedfa2f9359a54e39c74ba2d6f5deb92476e564", "author": {"user": {"login": "sekmiller", "name": "Stephen Kraffmiller"}}, "url": "https://github.com/IQSS/dataverse/commit/acedfa2f9359a54e39c74ba2d6f5deb92476e564", "committedDate": "2020-12-02T14:34:56Z", "message": "Merge branch 'develop' into 7398-saved-search-performance"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQzMDA2MTIx", "url": "https://github.com/IQSS/dataverse/pull/7447#pullrequestreview-543006121", "createdAt": "2020-12-02T16:19:54Z", "commit": {"oid": "acedfa2f9359a54e39c74ba2d6f5deb92476e564"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wMlQxNjoxOTo1NFrOH9i_qQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wMlQxNjoxOTo1NFrOH9i_qQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDI5ODUzNw==", "bodyText": "Any reason this wasn't added as a named query?", "url": "https://github.com/IQSS/dataverse/pull/7447#discussion_r534298537", "createdAt": "2020-12-02T16:19:54Z", "author": {"login": "sekmiller"}, "path": "src/main/java/edu/harvard/iq/dataverse/DatasetLinkingServiceBean.java", "diffHunk": "@@ -60,31 +42,15 @@\n \n     public List<Dataverse> findLinkingDataverses(Long datasetId) {\n         List<Dataverse> retList = new ArrayList<>();\n-        for (DatasetLinkingDataverse dld : findDatasetLinkingDataverses(datasetId)) {\n-            retList.add(dld.getLinkingDataverse());\n+        Query query = em.createQuery(\"select object(o) from DatasetLinkingDataverse as o where o.dataset.id =:datasetId order by o.id\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "acedfa2f9359a54e39c74ba2d6f5deb92476e564"}, "originalPosition": 36}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "13443b48b38cbc1995af0a2b4406154bbb51264f", "author": {"user": null}, "url": "https://github.com/IQSS/dataverse/commit/13443b48b38cbc1995af0a2b4406154bbb51264f", "committedDate": "2020-12-02T17:10:13Z", "message": "some more cleaned up - namely some more Named Queries"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQzMTM2MjQ2", "url": "https://github.com/IQSS/dataverse/pull/7447#pullrequestreview-543136246", "createdAt": "2020-12-02T18:46:04Z", "commit": {"oid": "13443b48b38cbc1995af0a2b4406154bbb51264f"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 705, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}