{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDIwODgxNDUy", "number": 6921, "title": "#6920 Informative error message for custom metadata block definition.", "bodyText": "What this PR does / why we need it: Improve the error handling of the custom metadata block definition API call\nWhich issue(s) this PR closes: #6920\nCloses #6920\nSpecial notes for your reviewer:\nSuggestions on how to test this:\nI have created an integration test for it. If you would like to run only that test, run the following:\n./conf/docker-aio/prep_it.bash\nmvn test -Dtest=AdminIT#testLoadMetadataBlock_ErrorHandling -Ddataverse.test.baseurl=http://localhost:8084\n\nDoes this PR introduce a user interface change?: no\nIs there a release notes update needed for this change?: no\nAdditional documentation: no", "createdAt": "2020-05-20T16:48:46Z", "url": "https://github.com/IQSS/dataverse/pull/6921", "merged": true, "mergeCommit": {"oid": "91ddb110e27f1495f268079625949fe315e1f55a"}, "closed": true, "closedAt": "2020-05-22T20:03:58Z", "author": {"login": "pkiraly"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcjhMbAAFqTQxNjM0ODUwMA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcjywYmAFqTQxNjkzNDI0Ng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE2MzQ4NTAw", "url": "https://github.com/IQSS/dataverse/pull/6921#pullrequestreview-416348500", "createdAt": "2020-05-21T17:30:46Z", "commit": {"oid": "833c83349d8c1e256279fcb57bc5947a2d4a15bd"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMVQxNzozMDo0NlrOGY8ETA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMVQxNzozMDo0NlrOGY8ETA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODgwMzE0OA==", "bodyText": "This test is failing because the test has \"cell\" in the error message while the api uses \"column\". Suggest putting the error message into the Bundle. None of the rest of the endpoints use the bundle because this is a very old api, but we're trying to add new work to the bundle when possible", "url": "https://github.com/IQSS/dataverse/pull/6921#discussion_r428803148", "createdAt": "2020-05-21T17:30:46Z", "author": {"login": "sekmiller"}, "path": "src/test/java/edu/harvard/iq/dataverse/api/AdminIT.java", "diffHunk": "@@ -671,4 +679,30 @@ public void testMigrateHDLToDOI() {\n                 .statusCode(OK.getStatusCode());\n     }\n \n+    @Test\n+    public void testLoadMetadataBlock_ErrorHandling() {\n+        Response createUser = UtilIT.createRandomUser();\n+        String apiToken = UtilIT.getApiTokenFromResponse(createUser);\n+\n+        byte[] updatedContent = null;\n+        try {\n+            updatedContent = Files.readAllBytes(Paths.get(\"src/test/resources/tsv/test.tsv\"));\n+        } catch (IOException e) {\n+            logger.warning(e.getMessage());\n+            assertEquals(0,1);\n+        }\n+        Response response = UtilIT.loadMetadataBlock(apiToken, updatedContent);\n+        assertEquals(500, response.getStatusCode());\n+        response.then().assertThat().statusCode(INTERNAL_SERVER_ERROR.getStatusCode());\n+\n+        String body = response.getBody().asString();\n+        String status = JsonPath.from(body).getString(\"status\");\n+        assertEquals(\"ERROR\", status);\n+\n+        String message = JsonPath.from(body).getString(\"message\");\n+        assertEquals(\n+          \"Error parsing metadata block in DATASETFIELD part, line #5: missing 'watermark' cell (#5)\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "833c83349d8c1e256279fcb57bc5947a2d4a15bd"}, "originalPosition": 57}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "aecb7c52a00e9b8ae29bd06aaa70620cd2333c2b", "author": {"user": {"login": "pkiraly", "name": "Kir\u00e1ly P\u00e9ter"}}, "url": "https://github.com/IQSS/dataverse/commit/aecb7c52a00e9b8ae29bd06aaa70620cd2333c2b", "committedDate": "2020-05-21T20:26:00Z", "message": "#6920 Informative error message for custom metadata block definition."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "957ed4e89f2671be389ab87b79956d8f604f301c", "author": {"user": {"login": "pkiraly", "name": "Kir\u00e1ly P\u00e9ter"}}, "url": "https://github.com/IQSS/dataverse/commit/957ed4e89f2671be389ab87b79956d8f604f301c", "committedDate": "2020-05-21T20:26:00Z", "message": "#6920 adding test.tsv file."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8c331dfd5172f842ac9cd2e462c93371df9561dc", "author": {"user": {"login": "pkiraly", "name": "Kir\u00e1ly P\u00e9ter"}}, "url": "https://github.com/IQSS/dataverse/commit/8c331dfd5172f842ac9cd2e462c93371df9561dc", "committedDate": "2020-05-21T20:26:00Z", "message": "#6920 replacing simple strings to bundles."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d89991688af9ef8313cdd37ef754db1e9c1f0cf1", "author": {"user": {"login": "pkiraly", "name": "Kir\u00e1ly P\u00e9ter"}}, "url": "https://github.com/IQSS/dataverse/commit/d89991688af9ef8313cdd37ef754db1e9c1f0cf1", "committedDate": "2020-05-21T20:26:26Z", "message": "Merge branch '6920-informative-error-message-for-custom-metadata-block-definition' of github.com:pkiraly/dataverse into 6920-informative-error-message-for-custom-metadata-block-definition"}, "afterCommit": {"oid": "8c331dfd5172f842ac9cd2e462c93371df9561dc", "author": {"user": {"login": "pkiraly", "name": "Kir\u00e1ly P\u00e9ter"}}, "url": "https://github.com/IQSS/dataverse/commit/8c331dfd5172f842ac9cd2e462c93371df9561dc", "committedDate": "2020-05-21T20:26:00Z", "message": "#6920 replacing simple strings to bundles."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "95cac28c56169baf787131eaee4b1a2f1364382b", "author": {"user": {"login": "pkiraly", "name": "Kir\u00e1ly P\u00e9ter"}}, "url": "https://github.com/IQSS/dataverse/commit/95cac28c56169baf787131eaee4b1a2f1364382b", "committedDate": "2020-05-22T09:09:58Z", "message": "#6920 add unit tests for getArrayIndexOutOfBoundMessage() and getGeneralErrorMessage()."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cfd79740667e78a56316031ba6090869b2d284ef", "author": {"user": {"login": "pkiraly", "name": "Kir\u00e1ly P\u00e9ter"}}, "url": "https://github.com/IQSS/dataverse/commit/cfd79740667e78a56316031ba6090869b2d284ef", "committedDate": "2020-05-22T12:31:09Z", "message": "#6920 testing citation.tsv metadata block."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE2OTM0MjQ2", "url": "https://github.com/IQSS/dataverse/pull/6921#pullrequestreview-416934246", "createdAt": "2020-05-22T14:01:32Z", "commit": {"oid": "cfd79740667e78a56316031ba6090869b2d284ef"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 825, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}