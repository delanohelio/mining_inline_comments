{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDIwODgxNDUy", "number": 6921, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMVQxNzozMDo0NlrOD-r3Eg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMVQxNzozMDo0NlrOD-r3Eg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY3MDU2OTE0OnYy", "diffSide": "RIGHT", "path": "src/test/java/edu/harvard/iq/dataverse/api/AdminIT.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMVQxNzozMDo0NlrOGY8ETA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMVQxNzo0ODo0M1rOGY8rAw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODgwMzE0OA==", "bodyText": "This test is failing because the test has \"cell\" in the error message while the api uses \"column\". Suggest putting the error message into the Bundle. None of the rest of the endpoints use the bundle because this is a very old api, but we're trying to add new work to the bundle when possible", "url": "https://github.com/IQSS/dataverse/pull/6921#discussion_r428803148", "createdAt": "2020-05-21T17:30:46Z", "author": {"login": "sekmiller"}, "path": "src/test/java/edu/harvard/iq/dataverse/api/AdminIT.java", "diffHunk": "@@ -671,4 +679,30 @@ public void testMigrateHDLToDOI() {\n                 .statusCode(OK.getStatusCode());\n     }\n \n+    @Test\n+    public void testLoadMetadataBlock_ErrorHandling() {\n+        Response createUser = UtilIT.createRandomUser();\n+        String apiToken = UtilIT.getApiTokenFromResponse(createUser);\n+\n+        byte[] updatedContent = null;\n+        try {\n+            updatedContent = Files.readAllBytes(Paths.get(\"src/test/resources/tsv/test.tsv\"));\n+        } catch (IOException e) {\n+            logger.warning(e.getMessage());\n+            assertEquals(0,1);\n+        }\n+        Response response = UtilIT.loadMetadataBlock(apiToken, updatedContent);\n+        assertEquals(500, response.getStatusCode());\n+        response.then().assertThat().statusCode(INTERNAL_SERVER_ERROR.getStatusCode());\n+\n+        String body = response.getBody().asString();\n+        String status = JsonPath.from(body).getString(\"status\");\n+        assertEquals(\"ERROR\", status);\n+\n+        String message = JsonPath.from(body).getString(\"message\");\n+        assertEquals(\n+          \"Error parsing metadata block in DATASETFIELD part, line #5: missing 'watermark' cell (#5)\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "833c83349d8c1e256279fcb57bc5947a2d4a15bd"}, "originalPosition": 57}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODgxMzA1OQ==", "bodyText": "Oh, and you'll need to get the latest from the develop branch.", "url": "https://github.com/IQSS/dataverse/pull/6921#discussion_r428813059", "createdAt": "2020-05-21T17:48:43Z", "author": {"login": "sekmiller"}, "path": "src/test/java/edu/harvard/iq/dataverse/api/AdminIT.java", "diffHunk": "@@ -671,4 +679,30 @@ public void testMigrateHDLToDOI() {\n                 .statusCode(OK.getStatusCode());\n     }\n \n+    @Test\n+    public void testLoadMetadataBlock_ErrorHandling() {\n+        Response createUser = UtilIT.createRandomUser();\n+        String apiToken = UtilIT.getApiTokenFromResponse(createUser);\n+\n+        byte[] updatedContent = null;\n+        try {\n+            updatedContent = Files.readAllBytes(Paths.get(\"src/test/resources/tsv/test.tsv\"));\n+        } catch (IOException e) {\n+            logger.warning(e.getMessage());\n+            assertEquals(0,1);\n+        }\n+        Response response = UtilIT.loadMetadataBlock(apiToken, updatedContent);\n+        assertEquals(500, response.getStatusCode());\n+        response.then().assertThat().statusCode(INTERNAL_SERVER_ERROR.getStatusCode());\n+\n+        String body = response.getBody().asString();\n+        String status = JsonPath.from(body).getString(\"status\");\n+        assertEquals(\"ERROR\", status);\n+\n+        String message = JsonPath.from(body).getString(\"message\");\n+        assertEquals(\n+          \"Error parsing metadata block in DATASETFIELD part, line #5: missing 'watermark' cell (#5)\",", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODgwMzE0OA=="}, "originalCommit": {"oid": "833c83349d8c1e256279fcb57bc5947a2d4a15bd"}, "originalPosition": 57}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3201, "cost": 1, "resetAt": "2021-11-13T12:10:21Z"}}}