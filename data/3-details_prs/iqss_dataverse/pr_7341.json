{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTA3MDAyNDAw", "number": 7341, "title": "#7097 move dv indexing to on success in Finalize Dataset Publication Command", "bodyText": "What this PR does / why we need it:\nAs it is currently written it's possible for the Finalize Dataset Publication Command to fail in such a way that the dataverse owners have been reindexed fond subjects while the transaction to save those subjects fails. Moving the re-index to OnSuccess will prevent that from happening.\nWhich issue(s) this PR closes:\nCloses #7097 in FinalizeDatasetPublicationCommand move reindex dv to OnSuccess\nSpecial notes for your reviewer:\nSuggestions on how to test this:\nDoes this PR introduce a user interface change? If mockups are available, please link/include them here:\nIs there a release notes update needed for this change?:\nAdditional documentation:", "createdAt": "2020-10-20T18:17:16Z", "url": "https://github.com/IQSS/dataverse/pull/7341", "merged": true, "mergeCommit": {"oid": "5ad608631911f1bdd939f13b74d7639a65182916"}, "closed": true, "closedAt": "2020-10-20T20:36:51Z", "author": {"login": "sekmiller"}, "timelineItems": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdUcpN8gH2gAyNTA3MDAyNDAwOjhmOGZmODU0NzU0ODMxMjk2YzY2NTZmNTMzMmU1NmMzZjAzNGEyMTU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdUdzRNAFqTUxMzA1NzMyOQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "8f8ff854754831296c6656f5332e56c3f034a215", "author": {"user": {"login": "sekmiller", "name": "Stephen Kraffmiller"}}, "url": "https://github.com/IQSS/dataverse/commit/8f8ff854754831296c6656f5332e56c3f034a215", "committedDate": "2020-10-20T17:58:05Z", "message": "#7097 move dv indexing to on success"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTEzMDQ1NDEy", "url": "https://github.com/IQSS/dataverse/pull/7341#pullrequestreview-513045412", "createdAt": "2020-10-20T19:02:06Z", "commit": {"oid": "8f8ff854754831296c6656f5332e56c3f034a215"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMFQxOTowMjowNlrOHlM2_w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMFQxOTowMjowNlrOHlM2_w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODc3MDA0Nw==", "bodyText": "Maybe a stupid question - but is it wrong to just \"catch (Exception e)\" in a situation like this - where we don't care why it failed/what kind of an exception it was? Does catching any exception make it more reliable potentially... or are there reasons why it should be avoided?", "url": "https://github.com/IQSS/dataverse/pull/7341#discussion_r508770047", "createdAt": "2020-10-20T19:02:06Z", "author": {"login": "landreev"}, "path": "src/main/java/edu/harvard/iq/dataverse/engine/command/impl/FinalizeDatasetPublicationCommand.java", "diffHunk": "@@ -224,6 +227,20 @@ public boolean onSuccess(CommandContext ctxt, Object r) {\n             LoggingUtil.writeOnSuccessFailureLog(this, failureLogText,  dataset);\n             retVal = false;\n         }\n+        \n+        //re-indexing dataverses that have additional subjects\n+        if (!dataversesToIndex.isEmpty()){\n+            for (Dataverse dv : dataversesToIndex) {\n+                try {\n+                    Future<String> indexString = ctxt.index().indexDataverse(dv);\n+                } catch (IOException | SolrServerException e) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8f8ff854754831296c6656f5332e56c3f034a215"}, "originalPosition": 27}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTEzMDU3MzI5", "url": "https://github.com/IQSS/dataverse/pull/7341#pullrequestreview-513057329", "createdAt": "2020-10-20T19:18:58Z", "commit": {"oid": "8f8ff854754831296c6656f5332e56c3f034a215"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 800, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}