{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDIwOTgwOTYw", "number": 6924, "reviewThreads": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOFQyMTozNDoyOVrOEArwHQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOVQxOToxNjoyN1rOETZDPQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY5MTUyMjg1OnYy", "diffSide": "RIGHT", "path": "src/main/java/edu/harvard/iq/dataverse/api/Files.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOFQyMTozNDoyOVrOGcHj6g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOVQxOToxNzoxM1rOG5Gk7g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjEzNzE5NA==", "bodyText": "rather than leave (and add) to these comments, at this point we can probably remove all (from the \"not sure..\" . Feel free to check with @landreev if he feels any reason these should stay?", "url": "https://github.com/IQSS/dataverse/pull/6924#discussion_r432137194", "createdAt": "2020-05-28T21:34:29Z", "author": {"login": "scolapasta"}, "path": "src/main/java/edu/harvard/iq/dataverse/api/Files.java", "diffHunk": "@@ -378,9 +378,16 @@ public Response updateFileMetadata(@FormDataParam(\"jsonData\") String jsonData,\n                     // on *new* datafiles, that haven't been saved in the database yet;\n                     // but it should never be the case in the context of this API) \n                     // -- L.A. Mar. 2020\n+                    //SEK 5/2020 - we can't use checksum because it", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "aa02d3451035fb1fd2f2465b8d236628270a4fd7"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjUyOTc3NA==", "bodyText": "did you check if we can just remove?", "url": "https://github.com/IQSS/dataverse/pull/6924#discussion_r462529774", "createdAt": "2020-07-29T19:17:13Z", "author": {"login": "scolapasta"}, "path": "src/main/java/edu/harvard/iq/dataverse/api/Files.java", "diffHunk": "@@ -378,9 +378,16 @@ public Response updateFileMetadata(@FormDataParam(\"jsonData\") String jsonData,\n                     // on *new* datafiles, that haven't been saved in the database yet;\n                     // but it should never be the case in the context of this API) \n                     // -- L.A. Mar. 2020\n+                    //SEK 5/2020 - we can't use checksum because it", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjEzNzE5NA=="}, "originalCommit": {"oid": "aa02d3451035fb1fd2f2465b8d236628270a4fd7"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgyOTc4OTg5OnYy", "diffSide": "RIGHT", "path": "doc/sphinx-guides/source/user/dataset-management.rst", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xM1QxNToyNzozN1rOGwttkw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xM1QxNToyNzozN1rOGwttkw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzczMzc3OQ==", "bodyText": "This should read \"...in different directories.\"", "url": "https://github.com/IQSS/dataverse/pull/6924#discussion_r453733779", "createdAt": "2020-07-13T15:27:37Z", "author": {"login": "mheppler"}, "path": "doc/sphinx-guides/source/user/dataset-management.rst", "diffHunk": "@@ -147,6 +146,18 @@ File Handling\n \n Certain file types in Dataverse are supported by additional functionality, which can include downloading in different formats, previews, file-level metadata preservation, file-level data citation; and exploration through data visualization and analysis. See the sections below for information about special functionality for specific file types.\n \n+Duplicate Files\n+===============\n+\n+Beginning with Dataverse 5.0, the way Dataverse handles duplicate files (filename and checksums) is changing to be more flexible. Specifically:\n+\n+- Files with the same checksum can be included in a dataset, even if the files are in the same directory.\n+- Files with the same filename can be included in a dataset as long as the files are in different directory.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dfe9af52424cbf937094edbe82113fd0138cbcfa"}, "originalPosition": 18}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg4NzY1NzQzOnYy", "diffSide": "RIGHT", "path": "doc/sphinx-guides/source/user/dataset-management.rst", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOVQxOTowODoxMVrOG5GQPQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQxODozMjozOFrOG5vCkA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjUyNDQ3Nw==", "bodyText": "is it worth being more explicit here about upload vs edit? i.e. related to the next bullet about changing the directory, is also changing the name after upload. (so the suggestion is to add that there, and change add to upload here)", "url": "https://github.com/IQSS/dataverse/pull/6924#discussion_r462524477", "createdAt": "2020-07-29T19:08:11Z", "author": {"login": "scolapasta"}, "path": "doc/sphinx-guides/source/user/dataset-management.rst", "diffHunk": "@@ -147,6 +146,20 @@ File Handling\n \n Certain file types in Dataverse are supported by additional functionality, which can include downloading in different formats, previews, file-level metadata preservation, file-level data citation; and exploration through data visualization and analysis. See the sections below for information about special functionality for specific file types.\n \n+.. _duplicate-files:\n+\n+Duplicate Files\n+===============\n+\n+Beginning with Dataverse 5.0, the way Dataverse handles duplicate files (filename and checksums) is changing to be more flexible. Specifically:\n+\n+- Files with the same checksum can be included in a dataset, even if the files are in the same directory.\n+- Files with the same filename can be included in a dataset as long as the files are in different directories.\n+- If a user attempts to add a file to a directory where a file already exists with that directory/filename combination, Dataverse will adjust the file path and names by adding \"-1\" or \"-2\" as applicable. This change will be visible in the list of files being uploaded. ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0f41e9ded3f507a58b43cae84569f67d7a9e8821"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzE5MjcyMA==", "bodyText": "I made a change to the doc here, please see that it helps to add some clarity.", "url": "https://github.com/IQSS/dataverse/pull/6924#discussion_r463192720", "createdAt": "2020-07-30T18:32:38Z", "author": {"login": "sekmiller"}, "path": "doc/sphinx-guides/source/user/dataset-management.rst", "diffHunk": "@@ -147,6 +146,20 @@ File Handling\n \n Certain file types in Dataverse are supported by additional functionality, which can include downloading in different formats, previews, file-level metadata preservation, file-level data citation; and exploration through data visualization and analysis. See the sections below for information about special functionality for specific file types.\n \n+.. _duplicate-files:\n+\n+Duplicate Files\n+===============\n+\n+Beginning with Dataverse 5.0, the way Dataverse handles duplicate files (filename and checksums) is changing to be more flexible. Specifically:\n+\n+- Files with the same checksum can be included in a dataset, even if the files are in the same directory.\n+- Files with the same filename can be included in a dataset as long as the files are in different directories.\n+- If a user attempts to add a file to a directory where a file already exists with that directory/filename combination, Dataverse will adjust the file path and names by adding \"-1\" or \"-2\" as applicable. This change will be visible in the list of files being uploaded. ", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjUyNDQ3Nw=="}, "originalCommit": {"oid": "0f41e9ded3f507a58b43cae84569f67d7a9e8821"}, "originalPosition": 21}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg4NzY3ODY5OnYy", "diffSide": "RIGHT", "path": "src/main/java/edu/harvard/iq/dataverse/EditDatafilesPage.java", "isResolved": false, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOVQxOToxMzo0M1rOG5GdOg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQyMDowMDowNFrOG5x0UA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjUyNzgwMg==", "bodyText": "does this need to be a separate method? or could it call delete files after setting the selected files from the files with same checksum? Or maybe better yet, have a private delete method that takes a list, have this call this with the list of files with same checksum and have the other (regular) delete call the private method with the list of selected files. (you also have to be careful to differentiate between delete of newly uploaded vs pre-existing, but I think in the end it would be cleaner (and less duplicate) code. Let me know what you think of this suggestion.", "url": "https://github.com/IQSS/dataverse/pull/6924#discussion_r462527802", "createdAt": "2020-07-29T19:13:43Z", "author": {"login": "scolapasta"}, "path": "src/main/java/edu/harvard/iq/dataverse/EditDatafilesPage.java", "diffHunk": "@@ -869,9 +869,57 @@ private String getBundleString(String msgName){\n     public void deleteFilesCompleted(){\n         \n     }\n+    \n+    public void deleteMarkedAsDuplicateFiles() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0f41e9ded3f507a58b43cae84569f67d7a9e8821"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjYwNzI4OQ==", "bodyText": "Makes sense. i'll take a look. I know we have different success messages - that were introduced yesterday, but it might not be too bad to consolidate.", "url": "https://github.com/IQSS/dataverse/pull/6924#discussion_r462607289", "createdAt": "2020-07-29T21:43:25Z", "author": {"login": "sekmiller"}, "path": "src/main/java/edu/harvard/iq/dataverse/EditDatafilesPage.java", "diffHunk": "@@ -869,9 +869,57 @@ private String getBundleString(String msgName){\n     public void deleteFilesCompleted(){\n         \n     }\n+    \n+    public void deleteMarkedAsDuplicateFiles() {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjUyNzgwMg=="}, "originalCommit": {"oid": "0f41e9ded3f507a58b43cae84569f67d7a9e8821"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzE4MTQzNg==", "bodyText": "Was able to use only one method for delete. Ran into a weird situation - real edge case - where if you uploaded a dupe, allowed it to stay, uploaded it again, decided no once is enough so deleted the new one it would also delete the first dupe that was \"ok\" - so fixed that, allowing the first dupe to stay.", "url": "https://github.com/IQSS/dataverse/pull/6924#discussion_r463181436", "createdAt": "2020-07-30T18:11:57Z", "author": {"login": "sekmiller"}, "path": "src/main/java/edu/harvard/iq/dataverse/EditDatafilesPage.java", "diffHunk": "@@ -869,9 +869,57 @@ private String getBundleString(String msgName){\n     public void deleteFilesCompleted(){\n         \n     }\n+    \n+    public void deleteMarkedAsDuplicateFiles() {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjUyNzgwMg=="}, "originalCommit": {"oid": "0f41e9ded3f507a58b43cae84569f67d7a9e8821"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzIzODIyNA==", "bodyText": "Turns out the one method way (and checking if selected to determine which delete is wanted) is problematic, so we do still need two public methods. BUT they just need to \"collect\" the files and then call a private delete which still centralizes the code. @sekmiller's aware of the change needed, and will move to QA once that is all set.", "url": "https://github.com/IQSS/dataverse/pull/6924#discussion_r463238224", "createdAt": "2020-07-30T20:00:04Z", "author": {"login": "scolapasta"}, "path": "src/main/java/edu/harvard/iq/dataverse/EditDatafilesPage.java", "diffHunk": "@@ -869,9 +869,57 @@ private String getBundleString(String msgName){\n     public void deleteFilesCompleted(){\n         \n     }\n+    \n+    public void deleteMarkedAsDuplicateFiles() {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjUyNzgwMg=="}, "originalCommit": {"oid": "0f41e9ded3f507a58b43cae84569f67d7a9e8821"}, "originalPosition": 21}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg4NzY4ODI5OnYy", "diffSide": "RIGHT", "path": "src/main/java/edu/harvard/iq/dataverse/FileMetadata.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOVQxOToxNjoyN1rOG5GjQQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOVQyMTozNDowOVrOG5LCuQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjUyOTM0NQ==", "bodyText": "is this for checksums? if so, do we need, since we already have it on the datafile object?", "url": "https://github.com/IQSS/dataverse/pull/6924#discussion_r462529345", "createdAt": "2020-07-29T19:16:27Z", "author": {"login": "scolapasta"}, "path": "src/main/java/edu/harvard/iq/dataverse/FileMetadata.java", "diffHunk": "@@ -472,6 +472,22 @@ public void setSelected(boolean selected) {\n         this.selected = selected;\n     }\n     \n+    /*\n+    For use during file upload so that the user may delete \n+    files that have already been uploaded to the current dataset version\n+    */\n+    \n+    @Transient\n+    private boolean markedAsDuplicate;\n+\n+    public boolean isMarkedAsDuplicate() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0f41e9ded3f507a58b43cae84569f67d7a9e8821"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjYwMTgzNA==", "bodyText": "We actually do need it because there's a separate list of file metadata that feed the uploaded files table and if the user deletes the duplicates we have to remove them too. I was also using it to write the success message, but since were no longer using names there I did some code simplification there.", "url": "https://github.com/IQSS/dataverse/pull/6924#discussion_r462601834", "createdAt": "2020-07-29T21:31:46Z", "author": {"login": "sekmiller"}, "path": "src/main/java/edu/harvard/iq/dataverse/FileMetadata.java", "diffHunk": "@@ -472,6 +472,22 @@ public void setSelected(boolean selected) {\n         this.selected = selected;\n     }\n     \n+    /*\n+    For use during file upload so that the user may delete \n+    files that have already been uploaded to the current dataset version\n+    */\n+    \n+    @Transient\n+    private boolean markedAsDuplicate;\n+\n+    public boolean isMarkedAsDuplicate() {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjUyOTM0NQ=="}, "originalCommit": {"oid": "0f41e9ded3f507a58b43cae84569f67d7a9e8821"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjYwMjkzNw==", "bodyText": "But can't you call fileMetaData.datafile.isMarkedAsDuplicate()? or something like that?", "url": "https://github.com/IQSS/dataverse/pull/6924#discussion_r462602937", "createdAt": "2020-07-29T21:34:09Z", "author": {"login": "scolapasta"}, "path": "src/main/java/edu/harvard/iq/dataverse/FileMetadata.java", "diffHunk": "@@ -472,6 +472,22 @@ public void setSelected(boolean selected) {\n         this.selected = selected;\n     }\n     \n+    /*\n+    For use during file upload so that the user may delete \n+    files that have already been uploaded to the current dataset version\n+    */\n+    \n+    @Transient\n+    private boolean markedAsDuplicate;\n+\n+    public boolean isMarkedAsDuplicate() {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjUyOTM0NQ=="}, "originalCommit": {"oid": "0f41e9ded3f507a58b43cae84569f67d7a9e8821"}, "originalPosition": 12}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3204, "cost": 1, "resetAt": "2021-11-13T12:10:21Z"}}}