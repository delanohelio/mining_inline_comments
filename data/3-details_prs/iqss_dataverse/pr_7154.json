{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDYwNDQyMTg3", "number": 7154, "title": "6641 search ui bug", "bodyText": "What this PR does / why we need it:\nThis PR prevents the display of duplicate filter query facets on the Dataverse Page. It also removes the subtree and dvobject type facets from the selected filter queries display.\nWhich issue(s) this PR closes:\nCloses #6641 Search UI Bug\nSpecial notes for your reviewer:\nSuggestions on how to test this:\nFrom a sub-dataverse select multiple facets and verify that search works as expected.\nDoes this PR introduce a user interface change? If mockups are available, please link/include them here:\nBug fix\nIs there a release notes update needed for this change?:\nNo\nAdditional documentation:\nNone", "createdAt": "2020-07-31T19:44:31Z", "url": "https://github.com/IQSS/dataverse/pull/7154", "merged": true, "mergeCommit": {"oid": "c859b162899f82782a88a052b0a199701fc9309b"}, "closed": true, "closedAt": "2020-08-07T19:37:21Z", "author": {"login": "sekmiller"}, "timelineItems": {"totalCount": 16, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc5wawZAH2gAyNDYwNDQyMTg3OjlhNmU1OWU2YTQ2NmI5NjBhNTQxODI2MzlmOGI0NDEzZmQ5NTY5ZmQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc8lkVpgH2gAyNDYwNDQyMTg3OmJlNDBkMzUwZTI2ZTYyZmViYWVjMDljYjJhYzM2YzUzMzE0NDBmNTE=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "9a6e59e6a466b960a54182639f8b4413fd9569fd", "author": {"user": {"login": "sekmiller", "name": "Stephen Kraffmiller"}}, "url": "https://github.com/IQSS/dataverse/commit/9a6e59e6a466b960a54182639f8b4413fd9569fd", "committedDate": "2020-07-29T19:44:26Z", "message": "#6641 remove extra search tags"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e560d246c4991563993884c43cc56fd11c3ae112", "author": {"user": {"login": "sekmiller", "name": "Stephen Kraffmiller"}}, "url": "https://github.com/IQSS/dataverse/commit/e560d246c4991563993884c43cc56fd11c3ae112", "committedDate": "2020-07-29T19:44:51Z", "message": "Merge branch 'develop' into 6641-search-ui-bug"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "333af7627e7fd034799f362adc52879f49c772a2", "author": {"user": {"login": "sekmiller", "name": "Stephen Kraffmiller"}}, "url": "https://github.com/IQSS/dataverse/commit/333af7627e7fd034799f362adc52879f49c772a2", "committedDate": "2020-07-30T20:41:06Z", "message": "Merge branch 'develop' into 6641-search-ui-bug"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "35a8e41a0805ee8114591275afca100be5785c4b", "author": {"user": {"login": "sekmiller", "name": "Stephen Kraffmiller"}}, "url": "https://github.com/IQSS/dataverse/commit/35a8e41a0805ee8114591275afca100be5785c4b", "committedDate": "2020-07-31T17:44:58Z", "message": "#6641 fix doubling up of subtree and filter queries"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "12031a6df70772d6cedb8b7a218d9a960c404888", "author": {"user": {"login": "sekmiller", "name": "Stephen Kraffmiller"}}, "url": "https://github.com/IQSS/dataverse/commit/12031a6df70772d6cedb8b7a218d9a960c404888", "committedDate": "2020-07-31T17:45:26Z", "message": "Merge branch 'develop' into 6641-search-ui-bug"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9005d9b7cd5891cac6b6e0e3f43d04122732dc6a", "author": {"user": {"login": "sekmiller", "name": "Stephen Kraffmiller"}}, "url": "https://github.com/IQSS/dataverse/commit/9005d9b7cd5891cac6b6e0e3f43d04122732dc6a", "committedDate": "2020-07-31T19:37:23Z", "message": "#6641 convert subDV ids to alias for facet tags"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9b008f700d3f80078ada9a483bf608f8661cc633", "author": {"user": {"login": "sekmiller", "name": "Stephen Kraffmiller"}}, "url": "https://github.com/IQSS/dataverse/commit/9b008f700d3f80078ada9a483bf608f8661cc633", "committedDate": "2020-07-31T19:49:21Z", "message": "#6641 code formatting"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "25bfd0eb98dadfbde975a337697a82b3393838a6", "author": {"user": {"login": "sekmiller", "name": "Stephen Kraffmiller"}}, "url": "https://github.com/IQSS/dataverse/commit/25bfd0eb98dadfbde975a337697a82b3393838a6", "committedDate": "2020-08-03T15:24:43Z", "message": "Merge branch 'develop' into 6641-search-ui-bug"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "366b76ecc45e501c8c9b02104eec24638f68740c", "author": {"user": {"login": "sekmiller", "name": "Stephen Kraffmiller"}}, "url": "https://github.com/IQSS/dataverse/commit/366b76ecc45e501c8c9b02104eec24638f68740c", "committedDate": "2020-08-04T14:59:21Z", "message": "Merge branch 'develop' into 6641-search-ui-bug"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5b683851caccc1990d1cbb04c14c69c86d4658fc", "author": {"user": {"login": "sekmiller", "name": "Stephen Kraffmiller"}}, "url": "https://github.com/IQSS/dataverse/commit/5b683851caccc1990d1cbb04c14c69c86d4658fc", "committedDate": "2020-08-04T15:46:02Z", "message": "#6641 don't show type and subtree facets"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYwOTcwNTEw", "url": "https://github.com/IQSS/dataverse/pull/7154#pullrequestreview-460970510", "createdAt": "2020-08-04T16:20:14Z", "commit": {"oid": "5b683851caccc1990d1cbb04c14c69c86d4658fc"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNFQxNjoyMDoxNFrOG7n2UA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNFQxNjoyNDozNlrOG7oA5g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTE3MjA0OA==", "bodyText": "The lack of curly braces (preferred) or indentation of the code in the \"if\" is confusing.", "url": "https://github.com/IQSS/dataverse/pull/7154#discussion_r465172048", "createdAt": "2020-08-04T16:20:14Z", "author": {"login": "pdurbin"}, "path": "src/main/java/edu/harvard/iq/dataverse/search/SearchIncludeFragment.java", "diffHunk": "@@ -291,6 +294,7 @@ public void search(boolean onlyDataRelatedToMe) {\n                 /**\n                  * @todo centralize this into SearchServiceBean\n                  */\n+                if (!isfilterQueryAlreadyInMap(filterDownToSubtree))\n                 filterQueriesFinal.add(filterDownToSubtree);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5b683851caccc1990d1cbb04c14c69c86d4658fc"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTE3NDc1OA==", "bodyText": "Is this setFilterQueries the crux of the bug? Of #6641? I see some conversation at cbad027#r360054910 about it was switched from filterQueries to filterQueriesFinal in cbad027 (part of pull request #6473). I guess I'm wondering if a one line change to switch it back from filterQueriesFinal to filterQueries would fix it the bug.", "url": "https://github.com/IQSS/dataverse/pull/7154#discussion_r465174758", "createdAt": "2020-08-04T16:24:36Z", "author": {"login": "pdurbin"}, "path": "src/main/java/edu/harvard/iq/dataverse/search/SearchIncludeFragment.java", "diffHunk": "@@ -475,12 +481,11 @@ public void search(boolean onlyDataRelatedToMe) {\n                     }\n                 }\n             }\n-            \n-\n-            \n+                        \n             dataversePage.setQuery(query);\n             dataversePage.setFacetCategoryList(facetCategoryList);\n-            dataversePage.setFilterQueries(filterQueriesFinal);\n+            dataversePage.setFilterQueries(filterQueriesDisplay);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5b683851caccc1990d1cbb04c14c69c86d4658fc"}, "originalPosition": 52}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "96f94af30262b97cededfc1c48c114783f8e17a9", "author": {"user": {"login": "sekmiller", "name": "Stephen Kraffmiller"}}, "url": "https://github.com/IQSS/dataverse/commit/96f94af30262b97cededfc1c48c114783f8e17a9", "committedDate": "2020-08-05T19:07:13Z", "message": "#6641 fix facet display and code cleanup"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "934889d3786414116f71da54e60930a80c2bcfb8", "author": {"user": {"login": "sekmiller", "name": "Stephen Kraffmiller"}}, "url": "https://github.com/IQSS/dataverse/commit/934889d3786414116f71da54e60930a80c2bcfb8", "committedDate": "2020-08-05T19:07:36Z", "message": "Merge branch 'develop' into 6641-search-ui-bug"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYyNjU2ODc0", "url": "https://github.com/IQSS/dataverse/pull/7154#pullrequestreview-462656874", "createdAt": "2020-08-06T15:58:47Z", "commit": {"oid": "934889d3786414116f71da54e60930a80c2bcfb8"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3d789c1142196ab614297051f575cfe79c1d56d4", "author": {"user": {"login": "sekmiller", "name": "Stephen Kraffmiller"}}, "url": "https://github.com/IQSS/dataverse/commit/3d789c1142196ab614297051f575cfe79c1d56d4", "committedDate": "2020-08-06T20:07:52Z", "message": "Merge branch 'develop' into 6641-search-ui-bug"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "be40d350e26e62febaec09cb2ac36c5331440f51", "author": {"user": {"login": "sekmiller", "name": "Stephen Kraffmiller"}}, "url": "https://github.com/IQSS/dataverse/commit/be40d350e26e62febaec09cb2ac36c5331440f51", "committedDate": "2020-08-07T14:47:43Z", "message": "Merge branch 'develop' into 6641-search-ui-bug"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 727, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}