{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDk5NDc3MTI5", "number": 7312, "reviewThreads": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOFQxNjoxODoyMlrOErsJHg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0yNlQwMTo1NDowOVrOFS4C7A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE0MjQ3NDU0OnYy", "diffSide": "LEFT", "path": "src/main/java/edu/harvard/iq/dataverse/EditDatafilesPage.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOFQxNjoxODoyMlrOHemUpg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0yNlQyMjoyMToxNFrOIatLDQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTg0NzIwNg==", "bodyText": "Here is the canDownloadFile logic that was removed, as I do no believe is necessary on EditDatafilesPage. If you can edit, you can download.", "url": "https://github.com/IQSS/dataverse/pull/7312#discussion_r501847206", "createdAt": "2020-10-08T16:18:22Z", "author": {"login": "mheppler"}, "path": "src/main/java/edu/harvard/iq/dataverse/EditDatafilesPage.java", "diffHunk": "@@ -2562,20 +2562,6 @@ public boolean isLocked() {\n         return false;\n     }\n     \n-    public boolean isThumbnailAvailable(FileMetadata fileMetadata) {\n-        // new and optimized logic: \n-        // - check download permission here (should be cached - so it's free!)\n-        // - only then ask the file service if the thumbnail is available/exists.\n-        // the service itself no longer checks download permissions.  \n-        if (!fileDownloadHelper.canDownloadFile(fileMetadata)) {\n-            return false;\n-        }\n-\n-        return datafileService.isThumbnailAvailable(fileMetadata.getDataFile());\n-    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f094b97dce164f28701492db089de3164c85ef14"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NDAxMzM0Mg==", "bodyText": "While this is true with the current built in roles, it is not inherently true of the permission system. Is it possible that some day, someone would want a a role that can edit but not download (for example editing the metadata?) It may be worth keeping this; alternatively we can keep removed knowing that we'd have to revisit it someday.", "url": "https://github.com/IQSS/dataverse/pull/7312#discussion_r564013342", "createdAt": "2021-01-25T20:13:21Z", "author": {"login": "scolapasta"}, "path": "src/main/java/edu/harvard/iq/dataverse/EditDatafilesPage.java", "diffHunk": "@@ -2562,20 +2562,6 @@ public boolean isLocked() {\n         return false;\n     }\n     \n-    public boolean isThumbnailAvailable(FileMetadata fileMetadata) {\n-        // new and optimized logic: \n-        // - check download permission here (should be cached - so it's free!)\n-        // - only then ask the file service if the thumbnail is available/exists.\n-        // the service itself no longer checks download permissions.  \n-        if (!fileDownloadHelper.canDownloadFile(fileMetadata)) {\n-            return false;\n-        }\n-\n-        return datafileService.isThumbnailAvailable(fileMetadata.getDataFile());\n-    }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTg0NzIwNg=="}, "originalCommit": {"oid": "f094b97dce164f28701492db089de3164c85ef14"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NDg3Mzk5Nw==", "bodyText": "note: added the permission check back (directly in the rendered of the fragment).", "url": "https://github.com/IQSS/dataverse/pull/7312#discussion_r564873997", "createdAt": "2021-01-26T22:21:14Z", "author": {"login": "scolapasta"}, "path": "src/main/java/edu/harvard/iq/dataverse/EditDatafilesPage.java", "diffHunk": "@@ -2562,20 +2562,6 @@ public boolean isLocked() {\n         return false;\n     }\n     \n-    public boolean isThumbnailAvailable(FileMetadata fileMetadata) {\n-        // new and optimized logic: \n-        // - check download permission here (should be cached - so it's free!)\n-        // - only then ask the file service if the thumbnail is available/exists.\n-        // the service itself no longer checks download permissions.  \n-        if (!fileDownloadHelper.canDownloadFile(fileMetadata)) {\n-            return false;\n-        }\n-\n-        return datafileService.isThumbnailAvailable(fileMetadata.getDataFile());\n-    }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTg0NzIwNg=="}, "originalCommit": {"oid": "f094b97dce164f28701492db089de3164c85ef14"}, "originalPosition": 14}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQ5OTk2NDY1OnYy", "diffSide": "RIGHT", "path": "src/main/java/edu/harvard/iq/dataverse/DataFileServiceBean.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xMlQxNzoxMToxMFrOISLq5Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xMlQyMTo0NzoxMlrOISWrEw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NTkzNjQ4NQ==", "bodyText": "If I understand correctly (e.g. from the code links below), MIME_TYPE_TSV_ALT should be the only mimetype that will have variable metadata. So -  can you also drop the first MIME_TYPE_TSV in this if statement?\nIngested tabular file mimetype set to MIME_TYPE_TSV_ALT:\n\n  \n    \n      dataverse/src/main/java/edu/harvard/iq/dataverse/ingest/IngestServiceBean.java\n    \n    \n         Line 922\n      in\n      0bcdcfd\n    \n    \n    \n    \n\n        \n          \n           dataFile.setContentType(FileUtil.MIME_TYPE_INGESTED_FILE); \n        \n    \n  \n\n\nIncoming files of type MIME_TYPE_TSV_ALT changed to MIME_TYPE_TSV\n\n  \n    \n      dataverse/src/main/java/edu/harvard/iq/dataverse/ingest/IngestServiceBean.java\n    \n    \n        Lines 355 to 358\n      in\n      0bcdcfd\n    \n    \n    \n    \n\n        \n          \n           } else if (FileUtil.MIME_TYPE_INGESTED_FILE.equals(dataFile.getContentType())) { \n        \n\n        \n          \n                              // Make sure no *uningested* tab-delimited files are saved with the type \"text/tab-separated-values\"! \n        \n\n        \n          \n                              // \"text/tsv\" should be used instead:  \n        \n\n        \n          \n                              dataFile.setContentType(FileUtil.MIME_TYPE_TSV);", "url": "https://github.com/IQSS/dataverse/pull/7312#discussion_r555936485", "createdAt": "2021-01-12T17:11:10Z", "author": {"login": "qqmyers"}, "path": "src/main/java/edu/harvard/iq/dataverse/DataFileServiceBean.java", "diffHunk": "@@ -497,7 +497,7 @@ public DataFile findCheapAndEasy(Long id) {\n         // If content type indicates it's tabular data, spend 2 extra queries \n         // looking up the data table and tabular tags objects:\n         \n-        if (MIME_TYPE_TSV.equalsIgnoreCase(contentType)) {\n+        if (MIME_TYPE_TSV.equalsIgnoreCase(contentType) || MIME_TYPE_TSV_ALT.equalsIgnoreCase(contentType)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d85806e6f31adc7360abed068cd85b9e83135777"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NjExNjc1NQ==", "bodyText": "I thought about it, but I believe it is entirely possible for some legacy installations to still have some ingested tabular files with the other mime types. So I figured I would leave it in place to be safe. The worst possible drawback here is 1 wasted custom query, if this not an ingested tab. file.\n(We make sure NOT to rely on the mime type, for identifying tabular data files elsewhere, and instead check for the presence of the DataTable object; but this is one situation where we have to - because we only have the search result, but not the entity).", "url": "https://github.com/IQSS/dataverse/pull/7312#discussion_r556116755", "createdAt": "2021-01-12T21:47:12Z", "author": {"login": "landreev"}, "path": "src/main/java/edu/harvard/iq/dataverse/DataFileServiceBean.java", "diffHunk": "@@ -497,7 +497,7 @@ public DataFile findCheapAndEasy(Long id) {\n         // If content type indicates it's tabular data, spend 2 extra queries \n         // looking up the data table and tabular tags objects:\n         \n-        if (MIME_TYPE_TSV.equalsIgnoreCase(contentType)) {\n+        if (MIME_TYPE_TSV.equalsIgnoreCase(contentType) || MIME_TYPE_TSV_ALT.equalsIgnoreCase(contentType)) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NTkzNjQ4NQ=="}, "originalCommit": {"oid": "d85806e6f31adc7360abed068cd85b9e83135777"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzU0MDExMzI1OnYy", "diffSide": "RIGHT", "path": "src/main/java/edu/harvard/iq/dataverse/DatasetVersionDifference.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0yMVQyMDo1MDo0M1rOIYJRag==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0yNVQyMToyNTo1M1rOIZ7Hzw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MjE4ODY1MA==", "bodyText": "these values are only used for the equality check, seems silly to not just check isRestricted directly.", "url": "https://github.com/IQSS/dataverse/pull/7312#discussion_r562188650", "createdAt": "2021-01-21T20:50:43Z", "author": {"login": "scolapasta"}, "path": "src/main/java/edu/harvard/iq/dataverse/DatasetVersionDifference.java", "diffHunk": "@@ -1080,10 +1055,9 @@ private boolean fileMetadataIsDifferent(FileMetadata fm1, FileMetadata fm2) {\n             return true;\n         }\n         \n-        //File restrictions\n-        \n-        value1 = fm1.isRestricted() ? \"Restricted\" : \"Not Restricted\";\n-        value2 = fm2.isRestricted() ? \"Restricted\" : \"Not Restricted\";\n+        // File restrictions\n+        value1 = fm1.isRestricted() ? BundleUtil.getStringFromBundle(\"restricted\") : BundleUtil.getStringFromBundle(\"public\");\n+        value2 = fm2.isRestricted() ? BundleUtil.getStringFromBundle(\"restricted\") : BundleUtil.getStringFromBundle(\"public\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dfa367e8ceb087f257312823ef523a146f603d23"}, "originalPosition": 112}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NDA1Mzk2Nw==", "bodyText": "Happy to copy and paste any further code refactoring suggestions if you could be so kind as to provide them.", "url": "https://github.com/IQSS/dataverse/pull/7312#discussion_r564053967", "createdAt": "2021-01-25T21:25:53Z", "author": {"login": "mheppler"}, "path": "src/main/java/edu/harvard/iq/dataverse/DatasetVersionDifference.java", "diffHunk": "@@ -1080,10 +1055,9 @@ private boolean fileMetadataIsDifferent(FileMetadata fm1, FileMetadata fm2) {\n             return true;\n         }\n         \n-        //File restrictions\n-        \n-        value1 = fm1.isRestricted() ? \"Restricted\" : \"Not Restricted\";\n-        value2 = fm2.isRestricted() ? \"Restricted\" : \"Not Restricted\";\n+        // File restrictions\n+        value1 = fm1.isRestricted() ? BundleUtil.getStringFromBundle(\"restricted\") : BundleUtil.getStringFromBundle(\"public\");\n+        value2 = fm2.isRestricted() ? BundleUtil.getStringFromBundle(\"restricted\") : BundleUtil.getStringFromBundle(\"public\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MjE4ODY1MA=="}, "originalCommit": {"oid": "dfa367e8ceb087f257312823ef523a146f603d23"}, "originalPosition": 112}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzU1MjQwODE0OnYy", "diffSide": "LEFT", "path": "src/main/webapp/filesFragment.xhtml", "isResolved": true, "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0yNVQyMDoyMDoyNVrOIZ44sQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0yNlQyMjoyMjoyOFrOIatNVg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NDAxNzMyOQ==", "bodyText": "is this removed because the filefragment itself is only shown when not in editMode?", "url": "https://github.com/IQSS/dataverse/pull/7312#discussion_r564017329", "createdAt": "2021-01-25T20:20:25Z", "author": {"login": "scolapasta"}, "path": "src/main/webapp/filesFragment.xhtml", "diffHunk": "@@ -35,15 +35,16 @@\n     <p:remoteCommand name=\"rebindCommand\" process=\"@this\" update=\"filesTable\" oncomplete=\"javascript:bind_bsui_components();\"/>\n \n     <!-- Files Table -->\n+    <!-- TABLESTYLE + WIDTH:AUTO FIX COL WIDTH OVERFLOW HIDDEN, MIN-WIDTH 100% ADDED FOR TABLE CONTENT LESS THAN 100% https://stackoverflow.com/a/38582318 -->\n     <p:dataTable id=\"filesTable\" \n                  rows=\"10\" paginator=\"#{DatasetPage.fileMetadatasSearch.size() gt 10}\" paginatorPosition=\"bottom\"\n                  paginatorTemplate=\"{FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} #{bundle['file.dynamicCounter.filesPerPage']} {RowsPerPageDropdown}\"\n                  rowsPerPageTemplate=\"10,25,50\"\n-                 style=\"margin-right:1px;\"\n+                 style=\"margin-right:1px;\" tableStyle=\"min-width:100%;width:auto;\"\n                  value=\"#{DatasetPage.fileMetadatasSearch}\"\n                  rowIndexVar=\"rowNum\" rowKey=\"#{fileMetadata.dataFile.storageIdentifier}\"\n                  selection=\"#{DatasetPage.selectedFiles}\" var=\"fileMetadata\" widgetVar=\"filesTable\"\n-                 rendered=\"#{DatasetPage.fileDisplayTable and empty DatasetPage.editMode and (DatasetPage.workingVersion != null)}\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dfa367e8ceb087f257312823ef523a146f603d23"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NDA1OTc0Ng==", "bodyText": "Wanted to remove editMode logic as the filesFragment is only included on the dataset pg. There is also render logic on the tab containing the include for editMode, and that too may be kosher to remove.", "url": "https://github.com/IQSS/dataverse/pull/7312#discussion_r564059746", "createdAt": "2021-01-25T21:36:41Z", "author": {"login": "mheppler"}, "path": "src/main/webapp/filesFragment.xhtml", "diffHunk": "@@ -35,15 +35,16 @@\n     <p:remoteCommand name=\"rebindCommand\" process=\"@this\" update=\"filesTable\" oncomplete=\"javascript:bind_bsui_components();\"/>\n \n     <!-- Files Table -->\n+    <!-- TABLESTYLE + WIDTH:AUTO FIX COL WIDTH OVERFLOW HIDDEN, MIN-WIDTH 100% ADDED FOR TABLE CONTENT LESS THAN 100% https://stackoverflow.com/a/38582318 -->\n     <p:dataTable id=\"filesTable\" \n                  rows=\"10\" paginator=\"#{DatasetPage.fileMetadatasSearch.size() gt 10}\" paginatorPosition=\"bottom\"\n                  paginatorTemplate=\"{FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} #{bundle['file.dynamicCounter.filesPerPage']} {RowsPerPageDropdown}\"\n                  rowsPerPageTemplate=\"10,25,50\"\n-                 style=\"margin-right:1px;\"\n+                 style=\"margin-right:1px;\" tableStyle=\"min-width:100%;width:auto;\"\n                  value=\"#{DatasetPage.fileMetadatasSearch}\"\n                  rowIndexVar=\"rowNum\" rowKey=\"#{fileMetadata.dataFile.storageIdentifier}\"\n                  selection=\"#{DatasetPage.selectedFiles}\" var=\"fileMetadata\" widgetVar=\"filesTable\"\n-                 rendered=\"#{DatasetPage.fileDisplayTable and empty DatasetPage.editMode and (DatasetPage.workingVersion != null)}\"", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NDAxNzMyOQ=="}, "originalCommit": {"oid": "dfa367e8ceb087f257312823ef523a146f603d23"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NDc4ODk2Mg==", "bodyText": "@mheppler right, but dataset pg does have the different edit modes; so we can't generally remove editMode. Specifically, though, if this is a case where this fragment is only included within an element that alread checks edit mode then we're probably ok removing here.", "url": "https://github.com/IQSS/dataverse/pull/7312#discussion_r564788962", "createdAt": "2021-01-26T19:51:07Z", "author": {"login": "scolapasta"}, "path": "src/main/webapp/filesFragment.xhtml", "diffHunk": "@@ -35,15 +35,16 @@\n     <p:remoteCommand name=\"rebindCommand\" process=\"@this\" update=\"filesTable\" oncomplete=\"javascript:bind_bsui_components();\"/>\n \n     <!-- Files Table -->\n+    <!-- TABLESTYLE + WIDTH:AUTO FIX COL WIDTH OVERFLOW HIDDEN, MIN-WIDTH 100% ADDED FOR TABLE CONTENT LESS THAN 100% https://stackoverflow.com/a/38582318 -->\n     <p:dataTable id=\"filesTable\" \n                  rows=\"10\" paginator=\"#{DatasetPage.fileMetadatasSearch.size() gt 10}\" paginatorPosition=\"bottom\"\n                  paginatorTemplate=\"{FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} #{bundle['file.dynamicCounter.filesPerPage']} {RowsPerPageDropdown}\"\n                  rowsPerPageTemplate=\"10,25,50\"\n-                 style=\"margin-right:1px;\"\n+                 style=\"margin-right:1px;\" tableStyle=\"min-width:100%;width:auto;\"\n                  value=\"#{DatasetPage.fileMetadatasSearch}\"\n                  rowIndexVar=\"rowNum\" rowKey=\"#{fileMetadata.dataFile.storageIdentifier}\"\n                  selection=\"#{DatasetPage.selectedFiles}\" var=\"fileMetadata\" widgetVar=\"filesTable\"\n-                 rendered=\"#{DatasetPage.fileDisplayTable and empty DatasetPage.editMode and (DatasetPage.workingVersion != null)}\"", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NDAxNzMyOQ=="}, "originalCommit": {"oid": "dfa367e8ceb087f257312823ef523a146f603d23"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NDc5MzgzMA==", "bodyText": "OK, found the code where it is included - do note it does have the editmode checked in the rendered, so from a logic sense, it would be ok to remove. If we ever decide to use this fragment for something else, we'd also need to make sure this was the case, or re add here.\n                                   rendered=\"#{(!DatasetPage.workingVersion.deaccessioned \n                                               or (DatasetPage.workingVersion.deaccessioned and DatasetPage.canUpdateDataset())) \n                                               and (empty DatasetPage.editMode)}\">\n                                <ui:include src=\"filesFragment.xhtml\">\n                                    <ui:param name=\"fileDownloadHelper\" value=\"#{DatasetPage.fileDownloadHelper}\"/>\n                                </ui:include>\n                            </p:tab>\n\nOne thing I started to do is at a comment at the top of new fragments explaining their use a little (see the kebab related fragments). Can you add some comments to the top of this (basically saying that it is currently only used by dataset page in a case where editmode is empty)?", "url": "https://github.com/IQSS/dataverse/pull/7312#discussion_r564793830", "createdAt": "2021-01-26T19:58:56Z", "author": {"login": "scolapasta"}, "path": "src/main/webapp/filesFragment.xhtml", "diffHunk": "@@ -35,15 +35,16 @@\n     <p:remoteCommand name=\"rebindCommand\" process=\"@this\" update=\"filesTable\" oncomplete=\"javascript:bind_bsui_components();\"/>\n \n     <!-- Files Table -->\n+    <!-- TABLESTYLE + WIDTH:AUTO FIX COL WIDTH OVERFLOW HIDDEN, MIN-WIDTH 100% ADDED FOR TABLE CONTENT LESS THAN 100% https://stackoverflow.com/a/38582318 -->\n     <p:dataTable id=\"filesTable\" \n                  rows=\"10\" paginator=\"#{DatasetPage.fileMetadatasSearch.size() gt 10}\" paginatorPosition=\"bottom\"\n                  paginatorTemplate=\"{FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} #{bundle['file.dynamicCounter.filesPerPage']} {RowsPerPageDropdown}\"\n                  rowsPerPageTemplate=\"10,25,50\"\n-                 style=\"margin-right:1px;\"\n+                 style=\"margin-right:1px;\" tableStyle=\"min-width:100%;width:auto;\"\n                  value=\"#{DatasetPage.fileMetadatasSearch}\"\n                  rowIndexVar=\"rowNum\" rowKey=\"#{fileMetadata.dataFile.storageIdentifier}\"\n                  selection=\"#{DatasetPage.selectedFiles}\" var=\"fileMetadata\" widgetVar=\"filesTable\"\n-                 rendered=\"#{DatasetPage.fileDisplayTable and empty DatasetPage.editMode and (DatasetPage.workingVersion != null)}\"", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NDAxNzMyOQ=="}, "originalCommit": {"oid": "dfa367e8ceb087f257312823ef523a146f603d23"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NDg3NDU4Mg==", "bodyText": "we added some comments to the fragment that is is only included with empty editMode. (so if we reuse this some day elsewhere, we know to check that)", "url": "https://github.com/IQSS/dataverse/pull/7312#discussion_r564874582", "createdAt": "2021-01-26T22:22:28Z", "author": {"login": "scolapasta"}, "path": "src/main/webapp/filesFragment.xhtml", "diffHunk": "@@ -35,15 +35,16 @@\n     <p:remoteCommand name=\"rebindCommand\" process=\"@this\" update=\"filesTable\" oncomplete=\"javascript:bind_bsui_components();\"/>\n \n     <!-- Files Table -->\n+    <!-- TABLESTYLE + WIDTH:AUTO FIX COL WIDTH OVERFLOW HIDDEN, MIN-WIDTH 100% ADDED FOR TABLE CONTENT LESS THAN 100% https://stackoverflow.com/a/38582318 -->\n     <p:dataTable id=\"filesTable\" \n                  rows=\"10\" paginator=\"#{DatasetPage.fileMetadatasSearch.size() gt 10}\" paginatorPosition=\"bottom\"\n                  paginatorTemplate=\"{FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} #{bundle['file.dynamicCounter.filesPerPage']} {RowsPerPageDropdown}\"\n                  rowsPerPageTemplate=\"10,25,50\"\n-                 style=\"margin-right:1px;\"\n+                 style=\"margin-right:1px;\" tableStyle=\"min-width:100%;width:auto;\"\n                  value=\"#{DatasetPage.fileMetadatasSearch}\"\n                  rowIndexVar=\"rowNum\" rowKey=\"#{fileMetadata.dataFile.storageIdentifier}\"\n                  selection=\"#{DatasetPage.selectedFiles}\" var=\"fileMetadata\" widgetVar=\"filesTable\"\n-                 rendered=\"#{DatasetPage.fileDisplayTable and empty DatasetPage.editMode and (DatasetPage.workingVersion != null)}\"", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NDAxNzMyOQ=="}, "originalCommit": {"oid": "dfa367e8ceb087f257312823ef523a146f603d23"}, "originalPosition": 14}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzU1MzM2OTQwOnYy", "diffSide": "RIGHT", "path": "src/main/webapp/file-info-fragment.xhtml", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0yNlQwMTo1NDowOVrOIaBw8w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0yNlQwMTo1NDowOVrOIaBw8w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NDE2MjgwMw==", "bodyText": "@scolapasta I believe this is change related to the removing of the isThumbnailAvailable function from EditDatafilesPage.java that you commented on, as I am now using this include on more than just the edit file pgs, so I am pointing the logic at the dataFileServiceBean version of the logic.", "url": "https://github.com/IQSS/dataverse/pull/7312#discussion_r564162803", "createdAt": "2021-01-26T01:54:09Z", "author": {"login": "mheppler"}, "path": "src/main/webapp/file-info-fragment.xhtml", "diffHunk": "@@ -10,52 +10,79 @@\n     xmlns:cc=\"http://java.sun.com/jsf/composite\"\n     xmlns:o=\"http://omnifaces.org/ui\"\n     xmlns:iqbs=\"http://xmlns.jcp.org/jsf/composite/iqbs\">\n-    <p:outputPanel>\n-        <div id=\"fileInfoInclude-filesTable\" class=\"col-sm-12 row\">\n-            <div class=\"pull-left col-file-thumb\">\n-                <div class=\"thumbnail-block text-center\">  \n-                    <span class=\"icon-#{dataFileServiceBean.getFileThumbnailClass(fileMetadata.dataFile)} file-thumbnail-icon text-muted\" jsf:rendered=\"#{!EditDatafilesPage.isThumbnailAvailable(fileMetadata)}\"/>\n-                    <span class=\"file-thumbnail-preview-img\" jsf:rendered=\"#{EditDatafilesPage.isThumbnailAvailable(fileMetadata)}\"\n-                          data-toggle=\"popover\" data-placement=\"bottom\" data-trigger=\"hover\" data-html=\"true\" data-content=\"&lt;img src=&#34;/api/access/datafile/#{fileMetadata.dataFile.id}?imageThumb=400&#34; alt=&#34;#{bundle['file.preview']} #{fileMetadata.label}&#34; /&gt;\"\n-                          data-template='&lt;div class=\"popover thumb-preview\" role=\"tooltip\"&gt;&lt;div class=\"arrow\"&gt;&lt;/div&gt;&lt;h3 class=\"popover-title\"&gt;&lt;/h3&gt;&lt;div class=\"popover-content\"&gt;&lt;/div&gt;&lt;/div&gt;'>\n-                        <p:graphicImage value=\"/api/access/datafile/#{fileMetadata.dataFile.id}?imageThumb=true\" alt=\"#{fileMetadata.label}\"/>\n-                    </span>\n-                    <!-- Restricted File Icon -->\n-                    <div class=\"file-icon-restricted-block\" jsf:rendered=\"#{fileMetadata.restricted and !fileDownloadHelper.canDownloadFile(fileMetadata)}\">                  \n-                        <span class=\"glyphicon glyphicon-lock text-danger\"/>\n-                    </div>\n-                    <div class=\"file-icon-restricted-block\" jsf:rendered=\"#{fileMetadata.restricted and fileDownloadHelper.canDownloadFile(fileMetadata) }\">\n-                        <span class=\"icon-unlock text-success\"/>\n-                    </div>\n+    <p:outputPanel id=\"fileInfoInclude-filesTable\" styleClass=\"media\">\n+        <div class=\"media-left col-file-thumb\" style=\"padding-top:4px;\">\n+            <div class=\"media-object thumbnail-block text-center\">\n+                <span class=\"icon-#{dataFileServiceBean.getFileThumbnailClass(fileMetadata.dataFile)} file-thumbnail-icon text-muted\" jsf:rendered=\"#{!dataFileServiceBean.isThumbnailAvailable(fileMetadata.dataFile)}\"/>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f46a87f52b573f9ecc77778c8e6b62801e3bad58"}, "originalPosition": 24}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2404, "cost": 1, "resetAt": "2021-11-12T19:05:54Z"}}}