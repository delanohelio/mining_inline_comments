{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDI2Nzg3NzYz", "number": 6956, "title": "Shib attribute character set conversion enabled", "bodyText": "This fixes #6946\n(Shibboleth attribute character set conversion error.)\nCloses #6946\nYou can test it by logging in with someone having an accented name (containing e.g. \u00f6\u00fc\u00f3\u0151\u00fa\u00e9\u00e1\u0171\u00e4) using shibboleth.\nI think the release notes or documentation should include the new ShibAttributeCharacterSetConversionEnabled setting that is now true by default.", "createdAt": "2020-06-02T19:33:26Z", "url": "https://github.com/IQSS/dataverse/pull/6956", "merged": true, "mergeCommit": {"oid": "498c0214af78ee7a2be912a198da911a89b7600d"}, "closed": true, "closedAt": "2020-06-05T15:37:33Z", "author": {"login": "pallinger"}, "timelineItems": {"totalCount": 16, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb8nv7bAH2gAyNDI2Nzg3NzYzOmFmZmJmNGZiZWI1MTFlMGE4NTkxMzQ4YWNjZGVjNTE0MjNlMDJkOTI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcn_4dagFqTQyNDU3NzU2OQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "affbf4fbeb511e0a8591348accdec51423e02d92", "author": {"user": {"login": "kcondon", "name": "Kevin Condon"}}, "url": "https://github.com/IQSS/dataverse/commit/affbf4fbeb511e0a8591348accdec51423e02d92", "committedDate": "2020-01-21T21:09:02Z", "message": "Merge pull request #6552 from IQSS/develop\n\nMerge v4.19 into master"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4e07b625ed585d2feb0ff44b9273c95746958476", "author": {"user": {"login": "kcondon", "name": "Kevin Condon"}}, "url": "https://github.com/IQSS/dataverse/commit/4e07b625ed585d2feb0ff44b9273c95746958476", "committedDate": "2020-04-01T19:10:03Z", "message": "Merge pull request #6788 from IQSS/develop\n\nv4.20"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0808d9b454674b172a906f55232c38bac7202798", "author": {"user": null}, "url": "https://github.com/IQSS/dataverse/commit/0808d9b454674b172a906f55232c38bac7202798", "committedDate": "2020-06-02T15:22:51Z", "message": "Convert shibboleth AJP attributes from ISO-8859-1 to UTF-8 if ShibAttributeCharacterSetConversionEnabled is true.\nintends to fix https://github.com/IQSS/dataverse/issues/6946"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ee7e94d97f3b606ae9cc68e7508f219f14754015", "author": {"user": null}, "url": "https://github.com/IQSS/dataverse/commit/ee7e94d97f3b606ae9cc68e7508f219f14754015", "committedDate": "2020-06-02T19:24:42Z", "message": "Convert shibboleth AJP attributes from ISO-8859-1 to UTF-8 if ShibAttributeCharacterSetConversionEnabled is true (now default).\nintends to fix https://github.com/IQSS/dataverse/issues/6946"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f4a399191511417b86ee5b431e2c75fb662c4fbe", "author": {"user": null}, "url": "https://github.com/IQSS/dataverse/commit/f4a399191511417b86ee5b431e2c75fb662c4fbe", "committedDate": "2020-06-02T19:26:58Z", "message": "Merge branch 'ShibAttributeCharacterSetConversionEnabled' into develop"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "848ec6a8b57b1f5326f9e40d956f6a6ccb4a105a", "author": {"user": {"login": "pallinger", "name": null}}, "url": "https://github.com/IQSS/dataverse/commit/848ec6a8b57b1f5326f9e40d956f6a6ccb4a105a", "committedDate": "2020-06-02T19:35:01Z", "message": "Merge branch 'develop' into ShibAttributeCharacterSetConversionEnabled"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIzMDI1NDI4", "url": "https://github.com/IQSS/dataverse/pull/6956#pullrequestreview-423025428", "createdAt": "2020-06-02T20:16:53Z", "commit": {"oid": "ee7e94d97f3b606ae9cc68e7508f219f14754015"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMlQyMDoxNjo1NFrOGeCdVA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMlQyMDoxNzoyMVrOGeCeQw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDE1MDc0MA==", "bodyText": "ShibAttributeCharacterSetConversionEnabled should be documented in https://github.com/IQSS/dataverse/blob/develop/doc/sphinx-guides/source/installation/config.rst", "url": "https://github.com/IQSS/dataverse/pull/6956#discussion_r434150740", "createdAt": "2020-06-02T20:16:54Z", "author": {"login": "pdurbin"}, "path": "src/main/java/edu/harvard/iq/dataverse/settings/SettingsServiceBean.java", "diffHunk": "@@ -422,7 +422,13 @@ Whether Harvesting (OAI) service is enabled\n         /**\n          * Shibboleth affiliation attribute which holds information about the affiliation of the user (e.g. ou)\n          */\n-        ShibAffiliationAttribute\n+        ShibAffiliationAttribute,\n+        /*Convert shibboleth AJP attributes from ISO-8859-1 to UTF-8 */\n+        ShibAttributeCharacterSetConversionEnabled,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ee7e94d97f3b606ae9cc68e7508f219f14754015"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDE1MDk3OQ==", "bodyText": "Why was FileValidationOnPublishEnabled added? I'm confused.", "url": "https://github.com/IQSS/dataverse/pull/6956#discussion_r434150979", "createdAt": "2020-06-02T20:17:21Z", "author": {"login": "pdurbin"}, "path": "src/main/java/edu/harvard/iq/dataverse/settings/SettingsServiceBean.java", "diffHunk": "@@ -422,7 +422,13 @@ Whether Harvesting (OAI) service is enabled\n         /**\n          * Shibboleth affiliation attribute which holds information about the affiliation of the user (e.g. ou)\n          */\n-        ShibAffiliationAttribute\n+        ShibAffiliationAttribute,\n+        /*Convert shibboleth AJP attributes from ISO-8859-1 to UTF-8 */\n+        ShibAttributeCharacterSetConversionEnabled,\n+        /**\n+         * Validate physical files for all the datafiles in the dataset when publishing\n+         */\n+        FileValidationOnPublishEnabled", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ee7e94d97f3b606ae9cc68e7508f219f14754015"}, "originalPosition": 11}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "336f802846996a1b11a99a7d7d86708c2d44956f", "author": {"user": null}, "url": "https://github.com/IQSS/dataverse/commit/336f802846996a1b11a99a7d7d86708c2d44956f", "committedDate": "2020-06-03T07:10:25Z", "message": "Merge remote-tracking branch 'iqss/develop' into develop"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8e36e1fc0c77d3bf7c1da65fefa3e9b1cf03d1b6", "author": {"user": null}, "url": "https://github.com/IQSS/dataverse/commit/8e36e1fc0c77d3bf7c1da65fefa3e9b1cf03d1b6", "committedDate": "2020-06-03T07:13:02Z", "message": "Merge branch 'develop' into ShibAttributeCharacterSetConversionEnabled"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "97634050e256521089aa8499d677327e04414dfb", "author": {"user": null}, "url": "https://github.com/IQSS/dataverse/commit/97634050e256521089aa8499d677327e04414dfb", "committedDate": "2020-06-03T07:35:43Z", "message": "code formatting cleanup and documentation for ShibAttributeCharacterSetConversionEnabled"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIzNTEyMjky", "url": "https://github.com/IQSS/dataverse/pull/6956#pullrequestreview-423512292", "createdAt": "2020-06-03T12:42:58Z", "commit": {"oid": "97634050e256521089aa8499d677327e04414dfb"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wM1QxMjo0Mjo1OFrOGeaCew==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wM1QxMjo0Mjo1OFrOGeaCew==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDUzNzA4Mw==", "bodyText": "@pallinger overall, these docs are looking great. They should be above  .. _:ComputeBaseUrl: which is an anchor. Also, since we're moving from Glassfish to Payara, if you could change \"Glassfish\" to \"the application server\" (or \"your application server\") as appropriate, it would be great.", "url": "https://github.com/IQSS/dataverse/pull/6956#discussion_r434537083", "createdAt": "2020-06-03T12:42:58Z", "author": {"login": "pdurbin"}, "path": "doc/sphinx-guides/source/installation/config.rst", "diffHunk": "@@ -1875,6 +1875,17 @@ To check the current value of ``:ShibAffiliationAttribute``:\n \n .. _:ComputeBaseUrl:\n \n+:ShibAttributeCharacterSetConversionEnabled\n++++++++++++++++++++++++++++++++++++++++++++\n+\n+It seems that Glassfish will interpret all Shibboleth attributes that come through AJP as ISO-8859-1, even if they where originally UTF-8.\n+To circumvent that, we re-encode all received Shibboleth attributes manually as UTF-8 by default. \n+In the case you get garbled characters in Shibboleth-supplied fields (e.g. given name, surname, affiliation), you can disable this behaviour by setting ShibAttributeCharacterSetConversionEnabled to false:\n+\n+``curl -X PUT -d false http://localhost:8080/api/admin/settings/:ShibAttributeCharacterSetConversionEnabled``\n+\n+If you managed to get correct accented characters from shibboleth while this setting is _false_, please contact us with your Glassfish and Shibboleth configuration!\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "97634050e256521089aa8499d677327e04414dfb"}, "originalPosition": 14}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIzODU0NjU1", "url": "https://github.com/IQSS/dataverse/pull/6956#pullrequestreview-423854655", "createdAt": "2020-06-03T19:16:42Z", "commit": {"oid": "97634050e256521089aa8499d677327e04414dfb"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6ee3681f8990caf48f1db4dbe3221e487b967708", "author": {"user": {"login": "pallinger", "name": null}}, "url": "https://github.com/IQSS/dataverse/commit/6ee3681f8990caf48f1db4dbe3221e487b967708", "committedDate": "2020-06-04T08:51:18Z", "message": "fix documentation for ShibAttributeCharacterSetConversionEnabled\n\n- move section above an unrelated anchor\r\n- rename Glassfish to something more generic"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fd4b1602aff9297112fe486157cbe0f3326a34c6", "author": {"user": null}, "url": "https://github.com/IQSS/dataverse/commit/fd4b1602aff9297112fe486157cbe0f3326a34c6", "committedDate": "2020-06-04T09:04:50Z", "message": "release notes for https://github.com/IQSS/dataverse/pull/6956"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI0NDA3NjAz", "url": "https://github.com/IQSS/dataverse/pull/6956#pullrequestreview-424407603", "createdAt": "2020-06-04T12:51:27Z", "commit": {"oid": "fd4b1602aff9297112fe486157cbe0f3326a34c6"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI0NTc3NTY5", "url": "https://github.com/IQSS/dataverse/pull/6956#pullrequestreview-424577569", "createdAt": "2020-06-04T15:34:49Z", "commit": {"oid": "fd4b1602aff9297112fe486157cbe0f3326a34c6"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 834, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}