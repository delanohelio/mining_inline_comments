{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ1NzA3ODQy", "number": 7062, "reviewThreads": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOVQxNjoyMDowOVrOEM9z9w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQxNjoyMzo1MFrOEQs2KQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgyMDMxMDk1OnYy", "diffSide": "RIGHT", "path": "src/main/java/edu/harvard/iq/dataverse/harvest/server/web/servlet/OAIServlet.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOVQxNjoyMDowOVrOGvYenA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOVQxNjoyMDowOVrOGvYenA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjMzNzMwOA==", "bodyText": "In #4597 @JingMa87 and I have been discussing making \"repositoryIdentifier\" (and possibly other identifiers configurable).", "url": "https://github.com/IQSS/dataverse/pull/7062#discussion_r452337308", "createdAt": "2020-07-09T16:20:09Z", "author": {"login": "pdurbin"}, "path": "src/main/java/edu/harvard/iq/dataverse/harvest/server/web/servlet/OAIServlet.java", "diffHunk": "@@ -193,10 +193,48 @@ private RepositoryConfiguration createRepositoryConfiguration() {\n                 .withMaxListRecords(100)\n                 .withMaxListSets(100)\n                 .withEarliestDate(new Date());\n-        \n+        String descriptionXml = getDescriptionXml();\n+        if (descriptionXml != null) {\n+            repositoryConfiguration.withDescription(descriptionXml);\n+        }\n         return repositoryConfiguration; \n     }\n-    \n+\n+    private String getDescriptionXml() {\n+        try {\n+            // Builds the XML\n+            Document doc = DocumentBuilderFactory.newInstance().newDocumentBuilder().newDocument();\n+            Element oaiIdentifier = doc.createElement(\"oai-identifier\");\n+            oaiIdentifier.setAttribute(\"xmlns\", \"http://www.openarchives.org/OAI/2.0/oai-identifier\");\n+            oaiIdentifier.setAttribute(\"xmlns:xsi\", \"http://www.w3.org/2001/XMLSchema-instance\");\n+            oaiIdentifier.setAttribute(\"xsi:schemaLocation\", \"http://www.openarchives.org/OAI/2.0/oai-identifier http://www.openarchives.org/OAI/2.0/oai-identifier.xsd\");\n+            doc.appendChild(oaiIdentifier);\n+            Element scheme = doc.createElement(\"scheme\");\n+            scheme.appendChild(doc.createTextNode(\"oai\"));\n+            oaiIdentifier.appendChild(scheme);\n+            Element repositoryIdentifier = doc.createElement(\"repositoryIdentifier\");\n+            repositoryIdentifier.appendChild(doc.createTextNode(\"dataverse.org\"));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f69f048bd1dae54199b27a3eb4cc32944a04a29c"}, "originalPosition": 109}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg1OTQyNjI4OnYy", "diffSide": "LEFT", "path": "src/main/webapp/editFilesFragment.xhtml", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQxNjoxMjoxNVrOG0_elA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQyMjoyMjozMFrOG1L7LQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODIxOTE1Ng==", "bodyText": "Why is this change to @form in this pull request?", "url": "https://github.com/IQSS/dataverse/pull/7062#discussion_r458219156", "createdAt": "2020-07-21T16:12:15Z", "author": {"login": "pdurbin"}, "path": "src/main/webapp/editFilesFragment.xhtml", "diffHunk": "@@ -282,7 +282,7 @@\n                     \n                     <p:commandButton id=\"updateEditDataFilesButtonsForUpload\" action=\"#{EditDatafilesPage.uploadFinished()}\" update=\"datasetForm:editDataFilesButtons\" rendered=\"#{showFileButtonUpdate}\" style=\"display:none\"/>\n                     <p:commandButton id=\"updateEditDataFilesButtonsForDelete\" action=\"#{EditDatafilesPage.deleteFilesCompleted()}\" update=\"datasetForm:editDataFilesButtons\" rendered=\"#{showFileButtonUpdate}\" style=\"display:none\"/>\n-                    <p:commandButton id=\"AllUploadsFinished\" action=\"#{EditDatafilesPage.uploadFinished()}\" update=\"@form,datasetForm:fileUpload,datasetForm:dropBoxUserButton,datasetForm:uploadMessage,datasetForm:rsyncPanel,datasetForm:filesCounts,datasetForm:filesTable\" oncomplete=\"javascript:bind_bsui_components();javascript:uploadWidgetDropMsg();\" style=\"display:none\"/> ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7ebdb42009076430312ab7068834f6a637c94675"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODQyMzA4NQ==", "bodyText": "Good point, I was testing some new functionality but inadvertently pushed these changes so I'll revert them. Same applies to immediate=\"true\".", "url": "https://github.com/IQSS/dataverse/pull/7062#discussion_r458423085", "createdAt": "2020-07-21T22:22:30Z", "author": {"login": "JingMa87"}, "path": "src/main/webapp/editFilesFragment.xhtml", "diffHunk": "@@ -282,7 +282,7 @@\n                     \n                     <p:commandButton id=\"updateEditDataFilesButtonsForUpload\" action=\"#{EditDatafilesPage.uploadFinished()}\" update=\"datasetForm:editDataFilesButtons\" rendered=\"#{showFileButtonUpdate}\" style=\"display:none\"/>\n                     <p:commandButton id=\"updateEditDataFilesButtonsForDelete\" action=\"#{EditDatafilesPage.deleteFilesCompleted()}\" update=\"datasetForm:editDataFilesButtons\" rendered=\"#{showFileButtonUpdate}\" style=\"display:none\"/>\n-                    <p:commandButton id=\"AllUploadsFinished\" action=\"#{EditDatafilesPage.uploadFinished()}\" update=\"@form,datasetForm:fileUpload,datasetForm:dropBoxUserButton,datasetForm:uploadMessage,datasetForm:rsyncPanel,datasetForm:filesCounts,datasetForm:filesTable\" oncomplete=\"javascript:bind_bsui_components();javascript:uploadWidgetDropMsg();\" style=\"display:none\"/> ", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODIxOTE1Ng=="}, "originalCommit": {"oid": "7ebdb42009076430312ab7068834f6a637c94675"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg1OTQyODYwOnYy", "diffSide": "LEFT", "path": "src/main/webapp/dataset.xhtml", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQxNjoxMjo0OFrOG0_gGQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQxNjoxMjo0OFrOG0_gGQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODIxOTU0NQ==", "bodyText": "Why is this change to immediate=\"true\" true` in this pull request?", "url": "https://github.com/IQSS/dataverse/pull/7062#discussion_r458219545", "createdAt": "2020-07-21T16:12:48Z", "author": {"login": "pdurbin"}, "path": "src/main/webapp/dataset.xhtml", "diffHunk": "@@ -1589,7 +1589,7 @@\n                         </ui:fragment>\n                         <div class=\"button-block\">\n                             <p:commandButton styleClass=\"btn btn-default\" value=\"#{bundle.continue}\" \n-                                             onclick=\"PF('publishDataset').hide();PF('blockDatasetForm').hide();\" action=\"#{DatasetPage.releaseDataset}\" immediate=\"true\"/>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7ebdb42009076430312ab7068834f6a637c94675"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg1OTQ1NjMyOnYy", "diffSide": "RIGHT", "path": "doc/release-notes/4597-fix-invalid-identify-response.md", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQxNjoxOToyNlrOG0_xWw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQxNjozODo1NFrOG1Aipg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODIyMzk2Mw==", "bodyText": "Can you please change all these (in the code too, of course) to start with \"Harvesting\"? That is:\n:HarvestingScheme, :HarvestingRepositoryIdentifier, :HarvestingDelimiter, :HarvestingSampleIdentifier\nOtherwise, they're too generic, especially :Scheme or :Delimiter.", "url": "https://github.com/IQSS/dataverse/pull/7062#discussion_r458223963", "createdAt": "2020-07-21T16:19:26Z", "author": {"login": "pdurbin"}, "path": "doc/release-notes/4597-fix-invalid-identify-response.md", "diffHunk": "@@ -0,0 +1 @@\n+Added the following database options: Scheme, RepositoryIdentifier, Delimiter, SampleIdentifier.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7ebdb42009076430312ab7068834f6a637c94675"}, "originalPosition": 1}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODIzNjU4Mg==", "bodyText": "Whoops, I jumped the gun. Can you please have these start with \"Oiapmh\" instead? Like this:\n:OaipmhScheme, :OaipmhRepositoryIdentifier, :OaipmhDelimiter, :OaipmhSampleIdentifier\nAlso, can you please document these in doc/sphinx-guides/source/installation/config.rst? Thanks!", "url": "https://github.com/IQSS/dataverse/pull/7062#discussion_r458236582", "createdAt": "2020-07-21T16:38:54Z", "author": {"login": "pdurbin"}, "path": "doc/release-notes/4597-fix-invalid-identify-response.md", "diffHunk": "@@ -0,0 +1 @@\n+Added the following database options: Scheme, RepositoryIdentifier, Delimiter, SampleIdentifier.", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODIyMzk2Mw=="}, "originalCommit": {"oid": "7ebdb42009076430312ab7068834f6a637c94675"}, "originalPosition": 1}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg1OTQ3NDMzOnYy", "diffSide": "RIGHT", "path": "src/main/java/edu/harvard/iq/dataverse/harvest/server/web/servlet/OAIServlet.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQxNjoyMzo1MFrOG0_83A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQxNjoyMzo1MFrOG0_83A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODIyNjkwOA==", "bodyText": "In http://oval.base-search.net this DOI is giving an error:\nERROR: Identify response well-formed but invalid: Element '{http://www.openarchives.org/OAI/2.0/oai-identifier}sampleIdentifier': [facet 'pattern'] The value 'doi:10.7910/DVN/1HE30F' is not accepted by the pattern 'oai:[a-zA-Z][a-zA-Z0-9-](.[a-zA-Z][a-zA-Z0-9-])+:[a-zA-Z0-9-_.!~*'();/?:@&=+$,%]+'., line 5\nIn context:", "url": "https://github.com/IQSS/dataverse/pull/7062#discussion_r458226908", "createdAt": "2020-07-21T16:23:50Z", "author": {"login": "pdurbin"}, "path": "src/main/java/edu/harvard/iq/dataverse/harvest/server/web/servlet/OAIServlet.java", "diffHunk": "@@ -180,6 +180,11 @@ private RepositoryConfiguration createRepositoryConfiguration() {\n         String dataverseName = dataverseService.findRootDataverse().getName();\n         String repositoryName = StringUtils.isEmpty(dataverseName) || \"Root\".equals(dataverseName) ? \"Test Dataverse OAI Archive\" : dataverseName + \" Dataverse OAI Archive\";\n         InternetAddress internetAddress = MailUtil.parseSystemAddress(settingsService.getValueForKey(SettingsServiceBean.Key.SystemEmail));\n+        String scheme = settingsService.getValueForKey(SettingsServiceBean.Key.Scheme, \"oai\");\n+        String repositoryIdentifier = settingsService.getValueForKey(SettingsServiceBean.Key.RepositoryIdentifier, \"dataverse.org\");\n+        String delimiter = settingsService.getValueForKey(SettingsServiceBean.Key.Delimiter, \":\");\n+        String sampleIdentifier = settingsService.getValueForKey(SettingsServiceBean.Key.SampleIdentifier, \"doi:10.7910/DVN/1HE30F\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7ebdb42009076430312ab7068834f6a637c94675"}, "originalPosition": 90}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3252, "cost": 1, "resetAt": "2021-11-13T12:10:21Z"}}}