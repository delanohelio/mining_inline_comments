{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDU1Nzk4OTYz", "number": 7121, "title": "add message when DataCite DOI has not been reserved #7102", "bodyText": "What this PR does / why we need it:\nHere's the problem scenario:\n\nDataCite was down when the dataset was created, meaning that the DOI was never reserved on the DataCite side.\nWhen the user tries to publish, they get a somewhat confusing error: \"Cannot publish dataset because its persistent identifier has not been reserved.\" (screenshot below).\n\n\nTo help explain what's going on, this pull request add a message to the top of the dataset page:\n\nWhich issue(s) this PR closes:\nCloses #7102\nSpecial notes for your reviewer:\n\nI copied and pasted the text that was given to me but I would prefer to use the word \"reserved\" rather than \"registered\" because we already use the former throughout our documentation and code. Fixed in fee1772.\nI used \"Dataset Locked\" as the short message before the long explanation but we can certainly change this to whatever we want. Changed to \"Dataset DOI Not Reserved\" in fee1772.\nI made use of the the \"displayLockInfo\" infrastructure even though this message isn't a true DatasetLock.\n\nSuggestions on how to test this:\nThe message should only appear for DataCite installations. In addition, the message should only appear for datasets with a null value for GlobalIdCreateTime (dvobject table), which is what we use to indicate if a DOI is reserved. It's the time the PID was created on the remote system.\nDoes this PR introduce a user interface change? If mockups are available, please link/include them here:\nYes, please see screenshots, above.\nIs there a release notes update needed for this change?:\nNo, I think it falls under the umbrella of Dataverse 5 allowing DOIs to be reserved.\nAdditional documentation:\nNone.", "createdAt": "2020-07-23T15:38:33Z", "url": "https://github.com/IQSS/dataverse/pull/7121", "merged": true, "mergeCommit": {"oid": "1ad8647c1e8af2846229a996a5e53cde0cbe2a60"}, "closed": true, "closedAt": "2020-07-30T15:12:26Z", "author": {"login": "pdurbin"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc3xCaZAH2gAyNDU1Nzk4OTYzOjlhZjdkOTllNWU0N2JkMzc3OTRhM2QzMGIzNDgzMjQ5MjgzNTVlZDk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc5w1-lAH2gAyNDU1Nzk4OTYzOjFjMWFlMmMwZTU0NjBmYzA1YjQ3MzFkYWY2NzllY2FkZTBkZGU3MzA=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "9af7d99e5e47bd37794a3d30b348324928355ed9", "author": {"user": {"login": "pdurbin", "name": "Philip Durbin"}}, "url": "https://github.com/IQSS/dataverse/commit/9af7d99e5e47bd37794a3d30b348324928355ed9", "committedDate": "2020-07-23T15:19:54Z", "message": "add message when DataCite DOI has not been reserved #7102"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU1Nzk2MjI5", "url": "https://github.com/IQSS/dataverse/pull/7121#pullrequestreview-455796229", "createdAt": "2020-07-27T13:46:44Z", "commit": {"oid": "9af7d99e5e47bd37794a3d30b348324928355ed9"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yN1QxMzo0Njo0NFrOG3jL3A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yN1QxMzo0Njo0NFrOG3jL3A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDkwMTM0MA==", "bodyText": "I know we don't want to keep going back and forth on this, but... this msg reads like we need additional success and warning issues if the DOI was finally registered or ultimately changed. This came to mind reading the comment from @landreev in Slack in regards to issue #6980.", "url": "https://github.com/IQSS/dataverse/pull/7121#discussion_r460901340", "createdAt": "2020-07-27T13:46:44Z", "author": {"login": "mheppler"}, "path": "src/main/java/propertyFiles/Bundle.properties", "diffHunk": "@@ -1322,6 +1322,8 @@ dataset.locked.ingest.message=The tabular data files uploaded are being processe\n dataset.unlocked.ingest.message=The tabular files have been ingested.\n dataset.locked.editInProgress.message=Edit In Progress\n dataset.locked.editInProgress.message.details=Additional edits cannot be made at this time. Contact {0} if this status persists.\n+dataset.locked.pidNotReserved.message=Dataset Locked\n+dataset.locked.pidNotReserved.message.details=The DOI displayed in the citation for this dataset has not yet been registered with DataCite. Please do not share this DOI until it has been registered.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9af7d99e5e47bd37794a3d30b348324928355ed9"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU1Nzk4ODU5", "url": "https://github.com/IQSS/dataverse/pull/7121#pullrequestreview-455798859", "createdAt": "2020-07-27T13:49:38Z", "commit": {"oid": "9af7d99e5e47bd37794a3d30b348324928355ed9"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yN1QxMzo0OTozOFrOG3jTvA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yN1QxMzo0OTozOFrOG3jTvA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDkwMzM1Ng==", "bodyText": "I don't think we need to add another \"Dataset Locked\" bundle value here. There is already dataset.locked.message.", "url": "https://github.com/IQSS/dataverse/pull/7121#discussion_r460903356", "createdAt": "2020-07-27T13:49:38Z", "author": {"login": "mheppler"}, "path": "src/main/java/propertyFiles/Bundle.properties", "diffHunk": "@@ -1322,6 +1322,8 @@ dataset.locked.ingest.message=The tabular data files uploaded are being processe\n dataset.unlocked.ingest.message=The tabular files have been ingested.\n dataset.locked.editInProgress.message=Edit In Progress\n dataset.locked.editInProgress.message.details=Additional edits cannot be made at this time. Contact {0} if this status persists.\n+dataset.locked.pidNotReserved.message=Dataset Locked", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9af7d99e5e47bd37794a3d30b348324928355ed9"}, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fee17726d996145ad16c1110cc34139a97c1d945", "author": {"user": {"login": "pdurbin", "name": "Philip Durbin"}}, "url": "https://github.com/IQSS/dataverse/commit/fee17726d996145ad16c1110cc34139a97c1d945", "committedDate": "2020-07-27T17:32:12Z", "message": "use \"reserved\" for consistency, not locked #7102"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU3NTA0NTIz", "url": "https://github.com/IQSS/dataverse/pull/7121#pullrequestreview-457504523", "createdAt": "2020-07-29T13:10:52Z", "commit": {"oid": "fee17726d996145ad16c1110cc34139a97c1d945"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1c1ae2c0e5460fc05b4731daf679ecade0dde730", "author": {"user": {"login": "pdurbin", "name": "Philip Durbin"}}, "url": "https://github.com/IQSS/dataverse/commit/1c1ae2c0e5460fc05b4731daf679ecade0dde730", "committedDate": "2020-07-29T20:14:10Z", "message": "don't show \"DOI not reserved\" message on create #7102"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 907, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}