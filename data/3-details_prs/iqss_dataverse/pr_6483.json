{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzU5MDM4MjA5", "number": 6483, "title": "#6345 add comma to display format for geographic coverage", "bodyText": "What this PR does / why we need it:\nAdds commas between geographic coverage items in the display of metadata as a visual cue to the user\nWhich issue(s) this PR closes:\nCloses #6345 Geographic Coverage: add punctuation\nSpecial notes for your reviewer:\nneed to update geospatial.tsv\ncurl http://localhost:8080/api/admin/datasetfield/load -H \"Content-type: text/tab-separated-values\" -X POST --upload-file geospatial.tsv\nSuggestions on how to test this:\nAdd geographic coverage data to a dataset and see that it displays commas.\nDoes this PR introduce a user interface change?:\nminor metadata display change\nIs there a release notes update needed for this change?:\nYes. Installations will need to reload their geospatial.tsv file (see curl command above.)\nAdditional documentation:\nNone", "createdAt": "2020-01-03T16:05:04Z", "url": "https://github.com/IQSS/dataverse/pull/6483", "merged": true, "mergeCommit": {"oid": "5e25f512ba999f2bee57cccff2a85ba4aa37c77d"}, "closed": true, "closedAt": "2020-01-07T19:00:21Z", "author": {"login": "sekmiller"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb2wgZSAH2gAyMzU5MDM4MjA5Ojc1ZDcxZDQ3MWQwY2FhODdjYjMyMjM1YWRlNzQ0YmNhMTU4MjgxYjc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABb3xkp-gH2gAyMzU5MDM4MjA5OmI1MzhkMTBkNjRlODQyMzUxODc3ZjJlNGM1OGNmZjc3YTcyNmQxMjM=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "75d71d471d0caa87cb32235ade744bca158281b7", "author": {"user": {"login": "sekmiller", "name": "Stephen Kraffmiller"}}, "url": "https://github.com/IQSS/dataverse/commit/75d71d471d0caa87cb32235ade744bca158281b7", "committedDate": "2020-01-03T15:57:40Z", "message": "#6345 add comma to display format for geographic coverage"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzM4MTc0OTM3", "url": "https://github.com/IQSS/dataverse/pull/6483#pullrequestreview-338174937", "createdAt": "2020-01-03T16:58:47Z", "commit": {"oid": "75d71d471d0caa87cb32235ade744bca158281b7"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "36235d446ccf24814d25ecc4ef7cbda59d17f1c2", "author": {"user": {"login": "sekmiller", "name": "Stephen Kraffmiller"}}, "url": "https://github.com/IQSS/dataverse/commit/36235d446ccf24814d25ecc4ef7cbda59d17f1c2", "committedDate": "2020-01-06T16:03:17Z", "message": "#6345 strip off comma from last geo metadata entry"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzM4NzY3OTM1", "url": "https://github.com/IQSS/dataverse/pull/6483#pullrequestreview-338767935", "createdAt": "2020-01-06T17:04:30Z", "commit": {"oid": "36235d446ccf24814d25ecc4ef7cbda59d17f1c2"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wNlQxNzowNDozMFrOFajXxQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wNlQxNzowNDozMFrOFajXxQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzM4NjgyMQ==", "bodyText": "We should remove this debug line.", "url": "https://github.com/IQSS/dataverse/pull/6483#discussion_r363386821", "createdAt": "2020-01-06T17:04:30Z", "author": {"login": "pdurbin"}, "path": "src/main/java/edu/harvard/iq/dataverse/DatasetFieldCompoundValue.java", "diffHunk": "@@ -148,19 +150,51 @@ public DatasetFieldCompoundValue copy(DatasetField parent) {\n                 if (!childDatasetField.getDatasetFieldType().isSanitizeHtml() && childDatasetField.getDatasetFieldType().isEscapeOutputText()){\n                     sanitizedValue = MarkupChecker.stripAllTags(sanitizedValue);\n                 }\n+                //if a series of child values is comma delimited we want to strip off the final entry's comma\n+                if (format.equals(\"#VALUE, \")) fixTrailingComma = true;\n+                \n                 // replace the special values in the format (note: we replace #VALUE last since we don't\n                 // want any issues if the value itself has #NAME in it)\n+\n                 String displayValue = format\n                         .replace(\"#NAME\", childDatasetField.getDatasetFieldType().getTitle())\n                         //todo: this should be handled in more generic way for any other text that can then be internationalized\n                         // if we need to use replaceAll for regexp, then make sure to use: java.util.regex.Matcher.quoteReplacement(<target string>)\n                         .replace(\"#EMAIL\", BundleUtil.getStringFromBundle(\"dataset.email.hiddenMessage\"))\n                         .replace(\"#VALUE\",  sanitizedValue );\n-\n+                            if(childDatasetField.getDatasetFieldType().getName().equals(\"country\")){\n+                                    System.out.print(displayValue);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "36235d446ccf24814d25ecc4ef7cbda59d17f1c2"}, "originalPosition": 37}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c85abf54312ff814cac1af149363a8b8f3faeffe", "author": {"user": {"login": "sekmiller", "name": "Stephen Kraffmiller"}}, "url": "https://github.com/IQSS/dataverse/commit/c85abf54312ff814cac1af149363a8b8f3faeffe", "committedDate": "2020-01-06T19:18:48Z", "message": "#6345 update tsv remove debug code"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzM4ODQ3Nzk3", "url": "https://github.com/IQSS/dataverse/pull/6483#pullrequestreview-338847797", "createdAt": "2020-01-06T19:33:29Z", "commit": {"oid": "c85abf54312ff814cac1af149363a8b8f3faeffe"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b538d10d64e842351877f2e4c58cff77a726d123", "author": {"user": {"login": "sekmiller", "name": "Stephen Kraffmiller"}}, "url": "https://github.com/IQSS/dataverse/commit/b538d10d64e842351877f2e4c58cff77a726d123", "committedDate": "2020-01-06T19:46:09Z", "message": "#6345 start 4.19 release notes"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 998, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}