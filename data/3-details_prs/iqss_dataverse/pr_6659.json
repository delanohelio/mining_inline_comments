{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc2Nzg5NzM3", "number": 6659, "title": "6587 deleted files shown on grant permission", "bodyText": "What this PR does / why we need it:\nThis PR allows the admin to deal with file permissions without having to wade through files that have been deleted from previous dataset versions. through the use of a check box she may include deleted files in case there are residual permissions on the deleted files.\nWhich issue(s) this PR closes:\nCloses #6587 Deleted files showing up as duplicates in Grant File Permissions\nSpecial notes for your reviewer:\nAdded \"Transient\" fields to DataFile and Role Assignment Row for ease of use\nSuggestions on how to test this:\nAdd permissions or request access on files, then delete them.\nDoes this PR introduce a user interface change?:\nMinor UI change, reviewed with Sonia.\nIs there a release notes update needed for this change?:\nNo\nAdditional documentation:\nNone", "createdAt": "2020-02-18T19:17:33Z", "url": "https://github.com/IQSS/dataverse/pull/6659", "merged": true, "mergeCommit": {"oid": "7227c381a0669c6e2d21d87edbe90947893cccc2"}, "closed": true, "closedAt": "2020-02-21T19:43:50Z", "author": {"login": "sekmiller"}, "timelineItems": {"totalCount": 30, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcDEK_mgH2gAyMzc2Nzg5NzM3OjBjMWY1M2Y3NzVjMjdlZGVhZTQxMDVjMDI4OGRhNzRmMzVjNmYzN2E=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcGgjIpAH2gAyMzc2Nzg5NzM3OmM2ODIyNDllYzg5ZmJhNzEzMGNmZDhkZmVhYzI0YmMwYTAzZjhhNTA=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "0c1f53f775c27edeae4105c0288da74f35c6f37a", "author": {"user": {"login": "sekmiller", "name": "Stephen Kraffmiller"}}, "url": "https://github.com/IQSS/dataverse/commit/0c1f53f775c27edeae4105c0288da74f35c6f37a", "committedDate": "2020-02-10T21:39:29Z", "message": "Merge branch 'develop' into 6587-deleted-files-shown-on-grant-permission"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a016b12087eb7eafb22428f7bd64ed23493b2bd1", "author": {"user": {"login": "sekmiller", "name": "Stephen Kraffmiller"}}, "url": "https://github.com/IQSS/dataverse/commit/a016b12087eb7eafb22428f7bd64ed23493b2bd1", "committedDate": "2020-02-11T14:37:52Z", "message": "Merge branch 'develop' into 6587-deleted-files-shown-on-grant-permission"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1d5983a5b06711b379f3cee075d2ec70178ce203", "author": {"user": {"login": "sekmiller", "name": "Stephen Kraffmiller"}}, "url": "https://github.com/IQSS/dataverse/commit/1d5983a5b06711b379f3cee075d2ec70178ce203", "committedDate": "2020-02-11T19:38:30Z", "message": "#6587 check file status before adding to map"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ba0c7f75721e5b94a4511c231bfe00cb3e26e83b", "author": {"user": {"login": "sekmiller", "name": "Stephen Kraffmiller"}}, "url": "https://github.com/IQSS/dataverse/commit/ba0c7f75721e5b94a4511c231bfe00cb3e26e83b", "committedDate": "2020-02-11T22:19:27Z", "message": "#6587 add boolean for show deleted files\n\nhard-coded to false for now"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "641a0e13afe53dce8e4d4d46e5e7dae013ddf197", "author": {"user": {"login": "sekmiller", "name": "Stephen Kraffmiller"}}, "url": "https://github.com/IQSS/dataverse/commit/641a0e13afe53dce8e4d4d46e5e7dae013ddf197", "committedDate": "2020-02-12T16:59:32Z", "message": "#6587 Add toggle for Include Deleted Files"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b3e8ccfbb774fcba7dcb49f86a80087b35ad07df", "author": {"user": {"login": "sekmiller", "name": "Stephen Kraffmiller"}}, "url": "https://github.com/IQSS/dataverse/commit/b3e8ccfbb774fcba7dcb49f86a80087b35ad07df", "committedDate": "2020-02-12T16:59:45Z", "message": "Merge branch 'develop' into 6587-deleted-files-shown-on-grant-permission"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b9ba76ee3a88ed17ba2f72f1da72568e682c0e86", "author": {"user": {"login": "sekmiller", "name": "Stephen Kraffmiller"}}, "url": "https://github.com/IQSS/dataverse/commit/b9ba76ee3a88ed17ba2f72f1da72568e682c0e86", "committedDate": "2020-02-12T18:48:41Z", "message": "Merge branch 'develop' into 6587-deleted-files-shown-on-grant-permission"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d83c88187bb7db04bf7436775729866afa326d19", "author": {"user": {"login": "sekmiller", "name": "Stephen Kraffmiller"}}, "url": "https://github.com/IQSS/dataverse/commit/d83c88187bb7db04bf7436775729866afa326d19", "committedDate": "2020-02-12T19:26:28Z", "message": "#6587 add file directory label to manage permissions"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3556433329eab511673471184e677a38974216f2", "author": {"user": {"login": "sekmiller", "name": "Stephen Kraffmiller"}}, "url": "https://github.com/IQSS/dataverse/commit/3556433329eab511673471184e677a38974216f2", "committedDate": "2020-02-13T18:27:25Z", "message": "Merge branch 'develop' into 6587-deleted-files-shown-on-grant-permission"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b56df57115debf20e0a66cf7175e2d1f25cdb9d4", "author": {"user": {"login": "sekmiller", "name": "Stephen Kraffmiller"}}, "url": "https://github.com/IQSS/dataverse/commit/b56df57115debf20e0a66cf7175e2d1f25cdb9d4", "committedDate": "2020-02-13T19:26:30Z", "message": "#6587 add status annotation to file list"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0d1a72689d3f5dcbf33800cbdc7ee63232916825", "author": {"user": {"login": "sekmiller", "name": "Stephen Kraffmiller"}}, "url": "https://github.com/IQSS/dataverse/commit/0d1a72689d3f5dcbf33800cbdc7ee63232916825", "committedDate": "2020-02-13T22:24:55Z", "message": "Merge branch 'develop' into 6587-deleted-files-shown-on-grant-permission"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "38f4885bc3dc9722aae800e8f16ef844322b1c77", "author": {"user": {"login": "sekmiller", "name": "Stephen Kraffmiller"}}, "url": "https://github.com/IQSS/dataverse/commit/38f4885bc3dc9722aae800e8f16ef844322b1c77", "committedDate": "2020-02-18T16:29:21Z", "message": "#6587 add notations for deleted files"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "64bca69a7adb5a6cfb1fed4be26055f79ac03c69", "author": {"user": {"login": "sekmiller", "name": "Stephen Kraffmiller"}}, "url": "https://github.com/IQSS/dataverse/commit/64bca69a7adb5a6cfb1fed4be26055f79ac03c69", "committedDate": "2020-02-18T16:29:41Z", "message": "Merge branch 'develop' into 6587-deleted-files-shown-on-grant-permission"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "86b7aeeef68c2195e19062ff138f7cf71ac691e4", "author": {"user": {"login": "sekmiller", "name": "Stephen Kraffmiller"}}, "url": "https://github.com/IQSS/dataverse/commit/86b7aeeef68c2195e19062ff138f7cf71ac691e4", "committedDate": "2020-02-18T18:52:17Z", "message": "#6587 cleanup formatting of Grant Access popup"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7112a83b5574ced4ea3728a1d968b7bb3639a5af", "author": {"user": {"login": "sekmiller", "name": "Stephen Kraffmiller"}}, "url": "https://github.com/IQSS/dataverse/commit/7112a83b5574ced4ea3728a1d968b7bb3639a5af", "committedDate": "2020-02-18T18:52:38Z", "message": "Merge branch 'develop' into 6587-deleted-files-shown-on-grant-permission"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8fbc2b41ce741014e6db1c4a655f64b3c94e76ea", "author": {"user": {"login": "sekmiller", "name": "Stephen Kraffmiller"}}, "url": "https://github.com/IQSS/dataverse/commit/8fbc2b41ce741014e6db1c4a655f64b3c94e76ea", "committedDate": "2020-02-18T19:32:51Z", "message": "Merge branch 'develop' into 6587-deleted-files-shown-on-grant-permission"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYwNjc0Mjg2", "url": "https://github.com/IQSS/dataverse/pull/6659#pullrequestreview-360674286", "createdAt": "2020-02-18T21:09:46Z", "commit": {"oid": "8fbc2b41ce741014e6db1c4a655f64b3c94e76ea"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOFQyMTowOTo0NlrOFrSfyw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOFQyMToyNToyMlrOFrS92A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDkzNjEzOQ==", "bodyText": "This checkbox for \"Include Deleted Files\" displays at the top of page, rather than at the top of the table it relates to. I suggest moving it down, next to the file count, above the file table in the Restricted Files panel.", "url": "https://github.com/IQSS/dataverse/pull/6659#discussion_r380936139", "createdAt": "2020-02-18T21:09:46Z", "author": {"login": "mheppler"}, "path": "src/main/webapp/permissions-manage-files.xhtml", "diffHunk": "@@ -25,6 +25,11 @@\n             <ui:param name=\"showMessagePanel\" value=\"false\"/>\n             <ui:define name=\"body\">\n                 <h:form id=\"rolesPermissionsForm\" styleClass=\"margin-top\">\n+                    <div class=\"panel-group\">\n+                    <p:selectBooleanCheckbox value=\"#{manageFilePermissionsPage.showDeleted}\" itemLabel=\"#{bundle['dataverse.permissionsFiles.files.includeDeleted']}\" onchange=\"#{manageFilePermissionsPage.init()}\" >", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8fbc2b41ce741014e6db1c4a655f64b3c94e76ea"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDk0MDA1Mw==", "bodyText": "Not sure about the UX of the second column here for \"Draft\", while it may help when file has been deleted, it appears to be visual noise for all other use cases, by just have \"Restricted\" in two columns.", "url": "https://github.com/IQSS/dataverse/pull/6659#discussion_r380940053", "createdAt": "2020-02-18T21:17:20Z", "author": {"login": "mheppler"}, "path": "src/main/webapp/permissions-manage-files.xhtml", "diffHunk": "@@ -314,7 +321,9 @@\n                                     <p:ajax event=\"toggleSelect\"  update=\":rolesPermissionsForm:selectionCounter\" />\n \n                                     <p:column selectionMode=\"multiple\" style=\"width:2%;text-align:center\"/>\n-                                    <p:column headerText=\"#{bundle['dataverse.permissionsFiles.assignDialog.fileName']}\">\n+                                    <p:column width=\"98%\"  headerText=\"#{bundle['dataverse.permissionsFiles.assignDialog.fileName']}\">", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8fbc2b41ce741014e6db1c4a655f64b3c94e76ea"}, "originalPosition": 35}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDk0Mjc2OA==", "bodyText": "I think the \"(Deleted)\" text should be after the file name, not before, so you can easily scan the file names, since that is the value the table rows are sorted on. The same could be said about the file directory path that is added to this column (e.g \"one/001.txt\", \"two/002.txt\" \"three/003.txt\" shouldn't be the order in the table, if sorting by file path).", "url": "https://github.com/IQSS/dataverse/pull/6659#discussion_r380942768", "createdAt": "2020-02-18T21:23:01Z", "author": {"login": "mheppler"}, "path": "src/main/webapp/permissions-manage-files.xhtml", "diffHunk": "@@ -227,7 +233,8 @@\n                                     <h:outputText value=\"#{roleAssignment.assigneeDisplayInfo.title}\"/> <h:outputText value=\" (#{roleAssignment.assigneeDisplayInfo.affiliation})\" rendered=\"#{!empty roleAssignment.assigneeDisplayInfo.affiliation}\"/>\n                                 </p:column>\n                                 <p:column width=\"98%\" headerText=\"#{bundle['dataverse.permissionsFiles.files.tabHeader.fileName']}\" rendered=\"#{!empty manageFilePermissionsPage.selectedRoleAssignee}\">\n-                                    <h:outputText value=\"#{roleAssignment.definitionPoint.displayName}\"/>\n+                                    <h:outputText value=\" (#{bundle['dataverse.permissionsFiles.files.deleted']}) \" rendered=\"#{roleAssignment.deleted}\"/>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8fbc2b41ce741014e6db1c4a655f64b3c94e76ea"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDk0MzgzMg==", "bodyText": "See comment above at line 236 about the file.directoryLabel, in the Grant File Access popup, looking out of order because the table rows are sorted by File Name. Same applies here to the Restricted Files table.", "url": "https://github.com/IQSS/dataverse/pull/6659#discussion_r380943832", "createdAt": "2020-02-18T21:25:22Z", "author": {"login": "mheppler"}, "path": "src/main/webapp/permissions-manage-files.xhtml", "diffHunk": "@@ -314,7 +321,9 @@\n                                     <p:ajax event=\"toggleSelect\"  update=\":rolesPermissionsForm:selectionCounter\" />\n \n                                     <p:column selectionMode=\"multiple\" style=\"width:2%;text-align:center\"/>\n-                                    <p:column headerText=\"#{bundle['dataverse.permissionsFiles.assignDialog.fileName']}\">\n+                                    <p:column width=\"98%\"  headerText=\"#{bundle['dataverse.permissionsFiles.assignDialog.fileName']}\">\n+                                        <h:outputText value=\" (#{bundle['dataverse.permissionsFiles.files.deleted']}) \" rendered=\"#{file.deleted}\"/>\n+                                        <h:outputText rendered=\"#{!empty file.directoryLabel}\"  value=\"#{file.directoryLabel}/\"/>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8fbc2b41ce741014e6db1c4a655f64b3c94e76ea"}, "originalPosition": 37}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "faceebc78ab794a3fbdc446e42da2848121f5117", "author": {"user": {"login": "sekmiller", "name": "Stephen Kraffmiller"}}, "url": "https://github.com/IQSS/dataverse/commit/faceebc78ab794a3fbdc446e42da2848121f5117", "committedDate": "2020-02-18T22:17:16Z", "message": "Merge branch 'develop' into 6587-deleted-files-shown-on-grant-permission"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e6276d73007cf89a7f16cd7be08fbe871e0710c6", "author": {"user": {"login": "sekmiller", "name": "Stephen Kraffmiller"}}, "url": "https://github.com/IQSS/dataverse/commit/e6276d73007cf89a7f16cd7be08fbe871e0710c6", "committedDate": "2020-02-19T14:22:09Z", "message": "Merge branch 'develop' into 6587-deleted-files-shown-on-grant-permission"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "32d5feff768278a0ab9a83b79f538aa304b2e0d3", "author": {"user": {"login": "sekmiller", "name": "Stephen Kraffmiller"}}, "url": "https://github.com/IQSS/dataverse/commit/32d5feff768278a0ab9a83b79f538aa304b2e0d3", "committedDate": "2020-02-19T15:34:54Z", "message": "#6587 move \"Deleted\" to after file name"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "222bf508a84fc0253859ef693c72811be3b5f0e0", "author": {"user": {"login": "sekmiller", "name": "Stephen Kraffmiller"}}, "url": "https://github.com/IQSS/dataverse/commit/222bf508a84fc0253859ef693c72811be3b5f0e0", "committedDate": "2020-02-19T16:06:20Z", "message": "#6587 remove directory label"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7aca3e81596cc5d26ed5b3cdd3f808f59513be30", "author": {"user": {"login": "sekmiller", "name": "Stephen Kraffmiller"}}, "url": "https://github.com/IQSS/dataverse/commit/7aca3e81596cc5d26ed5b3cdd3f808f59513be30", "committedDate": "2020-02-19T19:18:55Z", "message": "Merge branch 'develop' into 6587-deleted-files-shown-on-grant-permission"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c279350e54c6cb97838c4518ae7b35befc2524ad", "author": {"user": {"login": "sekmiller", "name": "Stephen Kraffmiller"}}, "url": "https://github.com/IQSS/dataverse/commit/c279350e54c6cb97838c4518ae7b35befc2524ad", "committedDate": "2020-02-19T19:39:40Z", "message": "#6587 include deleted on both panels"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "76c393e9680349cda212ece16f140a733d766104", "author": {"user": {"login": "sekmiller", "name": "Stephen Kraffmiller"}}, "url": "https://github.com/IQSS/dataverse/commit/76c393e9680349cda212ece16f140a733d766104", "committedDate": "2020-02-20T15:24:31Z", "message": "#6587 suppress deleted files for assign access"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1aaa01f1e7831b063ec8d0595051820069e35dbb", "author": {"user": {"login": "sekmiller", "name": "Stephen Kraffmiller"}}, "url": "https://github.com/IQSS/dataverse/commit/1aaa01f1e7831b063ec8d0595051820069e35dbb", "committedDate": "2020-02-20T19:43:08Z", "message": "Merge branch 'develop' into 6587-deleted-files-shown-on-grant-permission"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f2748b7968371974d55acc6fc96edabc53261b2b", "author": {"user": {"login": "mheppler", "name": "Michael Heppler"}}, "url": "https://github.com/IQSS/dataverse/commit/f2748b7968371974d55acc6fc96edabc53261b2b", "committedDate": "2020-02-20T21:26:06Z", "message": "Added text-muted styles to file path in Manage Restricted Files pg [ref #6587]"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "61b24ee4833b386f9c24ea40f49e0941f1105f40", "author": {"user": {"login": "sekmiller", "name": "Stephen Kraffmiller"}}, "url": "https://github.com/IQSS/dataverse/commit/61b24ee4833b386f9c24ea40f49e0941f1105f40", "committedDate": "2020-02-20T22:19:33Z", "message": "#6587 fix refresh - default show deleted"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYyMjg2OTc1", "url": "https://github.com/IQSS/dataverse/pull/6659#pullrequestreview-362286975", "createdAt": "2020-02-20T22:41:04Z", "commit": {"oid": "f2748b7968371974d55acc6fc96edabc53261b2b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYyNjM5NTcy", "url": "https://github.com/IQSS/dataverse/pull/6659#pullrequestreview-362639572", "createdAt": "2020-02-21T13:49:14Z", "commit": {"oid": "61b24ee4833b386f9c24ea40f49e0941f1105f40"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c682249ec89fba7130cfd8dfeac24bc0a03f8a50", "author": {"user": {"login": "sekmiller", "name": "Stephen Kraffmiller"}}, "url": "https://github.com/IQSS/dataverse/commit/c682249ec89fba7130cfd8dfeac24bc0a03f8a50", "committedDate": "2020-02-21T14:24:58Z", "message": "#6587 remove stray ;"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 930, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}