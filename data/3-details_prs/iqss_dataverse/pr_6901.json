{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE1MzUzMjAx", "number": 6901, "title": "ability to reserve DOIs through DataCite #5093", "bodyText": "What this PR does / why we need it:\nWe want to reserve PIDs from DataCite when we create datasets.\nWhich issue(s) this PR closes:\nCloses #5093\nSpecial notes for your reviewer:\n\nMost of the infrastructure was already there. It hinges on changing registerWhenPublished from true to false.\nWe are now using both the old MDS API and the new REST API.\n\nSuggestions on how to test this:\n\nConfigure for DataCite\nTest all the documented APIs\n\nDoes this PR introduce a user interface change?:\nNo.\nIs there a release notes update needed for this change?:\nNo.\nAdditional documentation:\nNo.", "createdAt": "2020-05-08T17:52:20Z", "url": "https://github.com/IQSS/dataverse/pull/6901", "merged": true, "mergeCommit": {"oid": "eb34a77c6b3cb4daa0bfba5756333a0c47fccd8d"}, "closed": true, "closedAt": "2020-06-04T20:49:52Z", "author": {"login": "pdurbin"}, "timelineItems": {"totalCount": 22, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcfVjhAAH2gAyNDE1MzUzMjAxOjQ5YTUwOTFjZTcxNjA5YWIxNGE1ODBkYjVhNzc1MTdhZmEzNDQ4Y2I=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcoCfZ_AH2gAyNDE1MzUzMjAxOjZiYzdkOTNlNzI2YjFlMjJmZjZiNzVlOTQ2OTE3NmYxZGYyM2ZhZWE=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "49a5091ce71609ab14a580db5a77517afa3448cb", "author": {"user": {"login": "pdurbin", "name": "Philip Durbin"}}, "url": "https://github.com/IQSS/dataverse/commit/49a5091ce71609ab14a580db5a77517afa3448cb", "committedDate": "2020-05-08T17:44:32Z", "message": "for DataCite, get PID (draft state) on create #5093"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cba83f573f57e6a44be4cac889317ff6d26b69d8", "author": {"user": {"login": "pdurbin", "name": "Philip Durbin"}}, "url": "https://github.com/IQSS/dataverse/commit/cba83f573f57e6a44be4cac889317ff6d26b69d8", "committedDate": "2020-05-11T19:18:42Z", "message": "add API to query PID state (e.g. draft vs. findable) #5093"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA5NTA4MDA0", "url": "https://github.com/IQSS/dataverse/pull/6901#pullrequestreview-409508004", "createdAt": "2020-05-11T20:32:13Z", "commit": {"oid": "cba83f573f57e6a44be4cac889317ff6d26b69d8"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMVQyMDozMjoxNFrOGTsSVQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMVQyMDozMjoxNFrOGTsSVQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzMwMTcxNw==", "bodyText": "Since this is specific to DataCite, it might be better to name it for that - doi.dataciteapibaseurl or something. (FWIW - I could swear that at some point I discussed adding a second option versus swapping mds for api in baseurlstring with someone and decided against having a second option, but I can't find code nor conversation...)", "url": "https://github.com/IQSS/dataverse/pull/6901#discussion_r423301717", "createdAt": "2020-05-11T20:32:14Z", "author": {"login": "qqmyers"}, "path": "doc/sphinx-guides/source/installation/config.rst", "diffHunk": "@@ -1038,6 +1038,20 @@ See also these related database settings below:\n - :ref:`:Authority`\n - :ref:`:Shoulder`\n \n+.. _doi.baseurlstringnext\n+\n+doi.baseurlstringnext\n++++++++++++++++++++++\n+\n+Dataverse uses multiple APIs from DataCite:\n+\n+- The DataCite MDS API is older, XML-based, and configured using :ref:`doi.baseurlstring`.\n+- The DataCite REST API is newer, JSON-based, and configured using ``doi.baseurlstringnext``.\n+\n+In production, ``doi.baseurlstringnext`` should be set to ``https://api.datacite.org``", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cba83f573f57e6a44be4cac889317ff6d26b69d8"}, "originalPosition": 14}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e72616f9998965b2866aef58021b2ac7b3885ac5", "author": {"user": {"login": "pdurbin", "name": "Philip Durbin"}}, "url": "https://github.com/IQSS/dataverse/commit/e72616f9998965b2866aef58021b2ac7b3885ac5", "committedDate": "2020-05-21T21:10:46Z", "message": "add APIs to reserve PIDs and list unreserved PIDs #5093"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "431ee35588bdf1e067b3fcc84e57efa9c4ae2f72", "author": {"user": {"login": "pdurbin", "name": "Philip Durbin"}}, "url": "https://github.com/IQSS/dataverse/commit/431ee35588bdf1e067b3fcc84e57efa9c4ae2f72", "committedDate": "2020-05-22T18:10:53Z", "message": "have \"get DOI\" accept normal form with doi: #5093"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9cbd5d3fd0ece200241d85365f6078c1ca55041d", "author": {"user": {"login": "pdurbin", "name": "Philip Durbin"}}, "url": "https://github.com/IQSS/dataverse/commit/9cbd5d3fd0ece200241d85365f6078c1ca55041d", "committedDate": "2020-05-22T20:32:27Z", "message": "allow dataset to be created if DataCite is down #5093"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e8e4c9877de227d539a689b3350fba43bc5b8bbc", "author": {"user": {"login": "pdurbin", "name": "Philip Durbin"}}, "url": "https://github.com/IQSS/dataverse/commit/e8e4c9877de227d539a689b3350fba43bc5b8bbc", "committedDate": "2020-05-22T21:09:18Z", "message": "add docs for undocumented APIs (list, reserve) #5093"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "28f32220f7ed7ea19cf251e9c06d54ee5f9d1a2a", "author": {"user": {"login": "pdurbin", "name": "Philip Durbin"}}, "url": "https://github.com/IQSS/dataverse/commit/28f32220f7ed7ea19cf251e9c06d54ee5f9d1a2a", "committedDate": "2020-05-26T20:58:05Z", "message": "grey out publish button if DataCite and no PID create time #5093"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8aacc9251c8d1288a3c0cc725a39ee9909a353c8", "author": {"user": {"login": "pdurbin", "name": "Philip Durbin"}}, "url": "https://github.com/IQSS/dataverse/commit/8aacc9251c8d1288a3c0cc725a39ee9909a353c8", "committedDate": "2020-05-27T21:54:43Z", "message": "add API to delete DOIs when possible #5093"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f58b24ef9a87edd8e6965acb55a2f449d1609a8b", "author": {"user": {"login": "pdurbin", "name": "Philip Durbin"}}, "url": "https://github.com/IQSS/dataverse/commit/f58b24ef9a87edd8e6965acb55a2f449d1609a8b", "committedDate": "2020-05-28T16:38:23Z", "message": "prevent publishing of unreserved PIDs #5093"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "85fd5be13b1be303a1e590914f3cc7ecc0098a5c", "author": {"user": {"login": "pdurbin", "name": "Philip Durbin"}}, "url": "https://github.com/IQSS/dataverse/commit/85fd5be13b1be303a1e590914f3cc7ecc0098a5c", "committedDate": "2020-05-28T18:42:36Z", "message": "get deleteIdentifier working for DataCite DOIs #5093"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "62509c89fff6f77b062ab1a34e2221b2586c7337", "author": {"user": {"login": "pdurbin", "name": "Philip Durbin"}}, "url": "https://github.com/IQSS/dataverse/commit/62509c89fff6f77b062ab1a34e2221b2586c7337", "committedDate": "2020-05-29T18:38:35Z", "message": "only set the create time if createIdentifier succeeded #5093\n\nThe fix required removing the throwing of RuntimeException in\nDataCiteRESTfullClient. This is considered a system exception and rolls\nback the entire \"create dataset\" command and transaction.\n\nThis commit also remove the temporary fix I had put in to allow datasets\nto be created when DataCite is down: 9cbd5d3\n\nBasically, it's a better fix. We need the create time to be null if\nDataCite is down so that we can query for unreserved DOIs and then\nreserve them."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1dfe944775b638a86c03d4bc28b593ddb2950656", "author": {"user": {"login": "pdurbin", "name": "Philip Durbin"}}, "url": "https://github.com/IQSS/dataverse/commit/1dfe944775b638a86c03d4bc28b593ddb2950656", "committedDate": "2020-05-29T20:29:13Z", "message": "finish removing RuntimeException (see 62509c89f) #5093"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "786a7a4430547b3555d789f1069e9f930aee5012", "author": {"user": {"login": "pdurbin", "name": "Philip Durbin"}}, "url": "https://github.com/IQSS/dataverse/commit/786a7a4430547b3555d789f1069e9f930aee5012", "committedDate": "2020-05-29T21:02:51Z", "message": "move English to bundle #5093"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "27da57a02a41573832fd930856f977bcbe6fdbd8", "author": {"user": {"login": "pdurbin", "name": "Philip Durbin"}}, "url": "https://github.com/IQSS/dataverse/commit/27da57a02a41573832fd930856f977bcbe6fdbd8", "committedDate": "2020-05-29T21:10:41Z", "message": "document \"delete PID\" API endpoint #5093"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c700f617ef13641095869aac2728a9a44c25064c", "author": {"user": {"login": "pdurbin", "name": "Philip Durbin"}}, "url": "https://github.com/IQSS/dataverse/commit/c700f617ef13641095869aac2728a9a44c25064c", "committedDate": "2020-06-01T14:10:08Z", "message": "Merge branch 'develop' into 5093-datacite #5093\n\nConflicts:\nsrc/main/java/propertyFiles/Bundle.properties"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIzNTY2NDc4", "url": "https://github.com/IQSS/dataverse/pull/6901#pullrequestreview-423566478", "createdAt": "2020-06-03T13:44:03Z", "commit": {"oid": "c700f617ef13641095869aac2728a9a44c25064c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e1914ee20d58966dfdff1f263730fbf791065841", "author": {"user": {"login": "pdurbin", "name": "Philip Durbin"}}, "url": "https://github.com/IQSS/dataverse/commit/e1914ee20d58966dfdff1f263730fbf791065841", "committedDate": "2020-06-03T20:28:10Z", "message": "correct docs: \"doi:\" required for get PID API #5093"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dde481c4cce48a50696fc78939f2a2c21fd15085", "author": {"user": {"login": "pdurbin", "name": "Philip Durbin"}}, "url": "https://github.com/IQSS/dataverse/commit/dde481c4cce48a50696fc78939f2a2c21fd15085", "committedDate": "2020-06-03T20:57:25Z", "message": "add release note #5093"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c1be93f07cb0a0ef2c628ace5593d91d11d9be04", "author": {"user": {"login": "pdurbin", "name": "Philip Durbin"}}, "url": "https://github.com/IQSS/dataverse/commit/c1be93f07cb0a0ef2c628ace5593d91d11d9be04", "committedDate": "2020-06-04T15:11:37Z", "message": "correct PID API docs for delete and reserve #5093"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7821ac7a5ab0e372b86e9337db262dec71abe7b2", "author": {"user": {"login": "pdurbin", "name": "Philip Durbin"}}, "url": "https://github.com/IQSS/dataverse/commit/7821ac7a5ab0e372b86e9337db262dec71abe7b2", "committedDate": "2020-06-04T16:25:27Z", "message": "more descriptive error on bad API token than \"ERROR\" #5093"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6bc7d93e726b1e22ff6b75e9469176f1df23faea", "author": {"user": {"login": "pdurbin", "name": "Philip Durbin"}}, "url": "https://github.com/IQSS/dataverse/commit/6bc7d93e726b1e22ff6b75e9469176f1df23faea", "committedDate": "2020-06-04T18:37:10Z", "message": "cross ref PID-related docs #5093"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 985, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}