{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTA4ODczNTg5", "number": 7351, "title": "7344 mailgroup regex", "bodyText": "What this PR does / why we need it:\nPer #7344, @scolapasta asked for regex support in mail domain groups. Sounded like this would be a use case for Harvard Dataverse.\nWhich issue(s) this PR closes:\nCloses #7344\nSpecial notes for your reviewer:\nNone.\nSuggestions on how to test this:\nCreate a group with a regex, create users with mail addresses matching the regex and some with non-matching. Assign perms to the group and test with different users.\nDoes this PR introduce a user interface change? If mockups are available, please link/include them here:\nNone.\nIs there a release notes update needed for this change?:\nThis might be worth a short note.\nAdditional documentation:\nNone.", "createdAt": "2020-10-23T10:31:33Z", "url": "https://github.com/IQSS/dataverse/pull/7351", "merged": true, "mergeCommit": {"oid": "666768aa978bc465e845a32ef803afba447d1a52"}, "closed": true, "closedAt": "2020-10-28T14:40:03Z", "author": {"login": "poikilotherm"}, "timelineItems": {"totalCount": 16, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdVBnXigH2gAyNTA4ODczNTg5OjM1NjEyNDIxYjA2MGQ2YjhjZGJmMTZhZGYyZDAwNTc3MGU1ODNhYzc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdWeNbHgH2gAyNTA4ODczNTg5OjUyZjE0MGMxZWQ4YTQ5YTcxNzY5ZjhiMTA2ZTk5NWI1ZjJhMTc1ZmI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "35612421b060d6b8cdbf16adf2d005770e583ac7", "author": {"user": {"login": "poikilotherm", "name": "Oliver Bertuch"}}, "url": "https://github.com/IQSS/dataverse/commit/35612421b060d6b8cdbf16adf2d005770e583ac7", "committedDate": "2020-10-22T13:02:33Z", "message": "Replace deprecated @NotEmpty annotation in MailDomainGroup. #7344"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e6e0af450d5923b25d20d341cf8fa558a1504e7a", "author": {"user": {"login": "poikilotherm", "name": "Oliver Bertuch"}}, "url": "https://github.com/IQSS/dataverse/commit/e6e0af450d5923b25d20d341cf8fa558a1504e7a", "committedDate": "2020-10-22T14:08:01Z", "message": "Initial support for regexes in mail domain groups. Not tested yet, but caching in a singleton. No API yet. #7344"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8af96c83b5c75dac00dcba45083c9c44e1593d33", "author": {"user": {"login": "poikilotherm", "name": "Oliver Bertuch"}}, "url": "https://github.com/IQSS/dataverse/commit/8af96c83b5c75dac00dcba45083c9c44e1593d33", "committedDate": "2020-10-23T09:38:25Z", "message": "Add JSON parser & printer support for the new regex support, enabling API usage. #7344"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7f0a00b2d65ccee990c859d4eb5d0066164e44d8", "author": {"user": {"login": "poikilotherm", "name": "Oliver Bertuch"}}, "url": "https://github.com/IQSS/dataverse/commit/7f0a00b2d65ccee990c859d4eb5d0066164e44d8", "committedDate": "2020-10-23T09:39:35Z", "message": "Split simple mail domain groups and regex based to avoid double-processing and make code more readable. #7344"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d39dd14450a4b07412f795aff7abc401c00ed074", "author": {"user": {"login": "poikilotherm", "name": "Oliver Bertuch"}}, "url": "https://github.com/IQSS/dataverse/commit/d39dd14450a4b07412f795aff7abc401c00ed074", "committedDate": "2020-10-23T09:39:56Z", "message": "Add unit testing for mail domain group changes. #7344"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "59c33ffaf6855d3b38d1b71a0754c6876dd57699", "author": {"user": {"login": "poikilotherm", "name": "Oliver Bertuch"}}, "url": "https://github.com/IQSS/dataverse/commit/59c33ffaf6855d3b38d1b71a0754c6876dd57699", "committedDate": "2020-10-23T09:40:31Z", "message": "Add DB migration for maildomaingroups regex flag support. #7344"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f6168967c16a3787eef65f82a4d4e232007f1076", "author": {"user": {"login": "poikilotherm", "name": "Oliver Bertuch"}}, "url": "https://github.com/IQSS/dataverse/commit/f6168967c16a3787eef65f82a4d4e232007f1076", "committedDate": "2020-10-23T09:57:43Z", "message": "Remove timer, instead trigger updates of mail domain groups cache from API calls, avoiding unnecessary CPU cycles. #7344"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5b009d6ec8a6e04ff98cad97b163719c14095b43", "author": {"user": {"login": "poikilotherm", "name": "Oliver Bertuch"}}, "url": "https://github.com/IQSS/dataverse/commit/5b009d6ec8a6e04ff98cad97b163719c14095b43", "committedDate": "2020-10-23T10:00:59Z", "message": "Make mail domain group service singleton scale by assigning proper lock types. #7344"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7aa42d24bf81999bf6ed89e5b9d8162ca86f2c4e", "author": {"user": {"login": "poikilotherm", "name": "Oliver Bertuch"}}, "url": "https://github.com/IQSS/dataverse/commit/7aa42d24bf81999bf6ed89e5b9d8162ca86f2c4e", "committedDate": "2020-10-23T10:18:02Z", "message": "Add docs about regex support for mail domain groups. #7344"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4fa63338640bef2a195d74f5c036aee461c070c4", "author": {"user": {"login": "poikilotherm", "name": "Oliver Bertuch"}}, "url": "https://github.com/IQSS/dataverse/commit/4fa63338640bef2a195d74f5c036aee461c070c4", "committedDate": "2020-10-23T14:16:17Z", "message": "Fix migration SQL script to use the parent entity table name. #7344"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8b523ffa2a6e085e811cd62e06dd47fabcc02d22", "author": {"user": {"login": "poikilotherm", "name": "Oliver Bertuch"}}, "url": "https://github.com/IQSS/dataverse/commit/8b523ffa2a6e085e811cd62e06dd47fabcc02d22", "committedDate": "2020-10-23T14:16:56Z", "message": "Cleanup maildomain group service and make it an EJB Singleton instead of CDI. Otherwise it does not start and cannot be used as a facade. #7344"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c10e11b3db51e9f712828c49834ad55fbea63e62", "author": {"user": {"login": "poikilotherm", "name": "Oliver Bertuch"}}, "url": "https://github.com/IQSS/dataverse/commit/c10e11b3db51e9f712828c49834ad55fbea63e62", "committedDate": "2020-10-23T18:20:44Z", "message": "Make MailDomainGroupServiceBean startup _after_ the Flyway migrations happened, as we rely on the database... #7344"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE1OTMwODc1", "url": "https://github.com/IQSS/dataverse/pull/7351#pullrequestreview-515930875", "createdAt": "2020-10-23T18:57:43Z", "commit": {"oid": "c10e11b3db51e9f712828c49834ad55fbea63e62"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yM1QxODo1Nzo0M1rOHnaJ-A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yM1QxODo1Nzo0M1rOHnaJ-A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTA4NTA0OA==", "bodyText": "Can you explain a little more what you mean by this? what is cached and when?", "url": "https://github.com/IQSS/dataverse/pull/7351#discussion_r511085048", "createdAt": "2020-10-23T18:57:43Z", "author": {"login": "scolapasta"}, "path": "doc/sphinx-guides/source/admin/mail-groups.rst", "diffHunk": "@@ -55,6 +55,36 @@ To load it into your Dataverse installation, either use a ``POST`` or ``PUT`` re\n \n ``curl -X POST -H 'Content-type: application/json' http://localhost:8080/api/admin/groups/domain --upload-file domainGroup1.json``\n \n+Matching with domains or regular expressions\n+^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n+Adding simple domain names requires exact matches of user email domains and the configured domains of a group.\n+Although you could add multiple domains to a group, those still require exact matches.\n+\n+In addition, you can use one or multiple regular expressions instead of simple domains for a group. Those\n+should not be mixed, although it would work. Regular expressions still require exact matches, but are way more flexible.\n+\n+Some hints:\n+\n+- Due to their excessive CPU usage, regular expressions should be used rarely.\n+- Also due to their CPU usage, all domain groups are cached. Cache updates when groups change via API.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c10e11b3db51e9f712828c49834ad55fbea63e62"}, "originalPosition": 15}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "18ce38ca56a793be726b43b6603264ba9543b9e6", "author": {"user": {"login": "djbrooke", "name": "Danny Brooke"}}, "url": "https://github.com/IQSS/dataverse/commit/18ce38ca56a793be726b43b6603264ba9543b9e6", "committedDate": "2020-10-23T20:58:07Z", "message": "doc updates"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "be25dd6a0004178c6c4fa40d1a0c3f6fe1eea4bd", "author": {"user": {"login": "djbrooke", "name": "Danny Brooke"}}, "url": "https://github.com/IQSS/dataverse/commit/be25dd6a0004178c6c4fa40d1a0c3f6fe1eea4bd", "committedDate": "2020-10-26T23:37:53Z", "message": "removing bullet based on code review"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "52f140c1ed8a49a71769f8b106e995b5f2a175fb", "author": {"user": {"login": "poikilotherm", "name": "Oliver Bertuch"}}, "url": "https://github.com/IQSS/dataverse/commit/52f140c1ed8a49a71769f8b106e995b5f2a175fb", "committedDate": "2020-10-27T00:55:23Z", "message": "Merge pull request #340 from IQSS/pr/7351\n\nDocumentation Updates"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 807, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}