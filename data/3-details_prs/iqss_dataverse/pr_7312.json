{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDk5NDc3MTI5", "number": 7312, "title": "Checksum truncation, click to copy + file metadata fragment code consolidation", "bodyText": "What this PR does / why we need it:\nLong checksums (see SHA512) are too long to display in the file table, so they are truncated to only display first 3 and last 3 characters, with a hover tooltip to display the entire checksum/UNF string and provide \"click to copy\" directions for the user. Added word-break CSS to wrap long checksums to another line within container widths across dataset, file and upload/edit pg metadata views.\nOverwrite css property from PrimeFaces component.css that was applying the hidden value to the overflow property of table cells in the dataTable component. Applied a new style attribute to the file dataTable on the dataset pg, so that it no longer cuts off long strings when the overflow is hidden by the width of the containing table cell.\nConsolidated file metadata on dataset pg by using file-info-fragment from file replace pg. For the files table on the dataset pg, filesFragment.xhtml uses 87 lines code that can also be found on files-info-fragment.xhtml, which was created as part of file replace. This is an attempt to clean up and consolidate that code, making it easier to manage going forward. Already there was not-all-that-recently added file metadata displayed on the dataset pg that was not added to the file replace pg (e.g. file path/hierarchy).\nThere were also other responsive layout improvements to the file table, as part of the constant effort to improve the UI and UX for all users, on all devices.\nWhich issue(s) this PR closes:\nCloses #5210 Long (e.g. SHA-512) fixity checksums are too long for display (NOTE, this issue was already closed and consolidated into #6685, but this PR does not address all issues outlined in that effort)\nCloses #5215 Search Result Cards - Missing UNF + Variables, Observations for tabular files\nSpecial notes for your reviewer:\nThis will effect the file metadata, thumbnails, tags, unfs, downloads on the dataset pg and file replace pg and S3-download dataverse package popup.\nAll checksums/UNF's in the file table on the dataset pg and file cards on the dataverse pg, will now be truncated, displaying just the type label (e.g. MD5, SHA512, UNF:6:, et al), then the first three unique characters, then \"...\" in place of the truncated middle portion of the string, and then the last three unique characters (NOTE: UNF strings end with either a \"=\" or \"==\" suffix, so three characters will be displayed prior to those characters).\nSuggestions on how to test this:\nHover over the truncated checksum in the file table on the dataset pg, as well as file result cards on the dataverse pg, to see the full checksum. Click to copy to clipboard. You can also see the checksum info logged in the browser console.\nCheck out the dataset version differences popup and make sure all long checksums are displayed in full.\nMake sure the file metadata, thumbnails, tags, unfs, downloads on the dataset pg and file replace pg and download dataverse package on S3 popup are all kosher still.\nDoes this PR introduce a user interface change? If mockups are available, please link/include them here:\nNo mockups. Checksum is truncated to only show first 3 and last 3 digits. Hover to see full checksum displayed in a browser title tooltip.\nIs there a release notes update needed for this change?:\nN/A\nAdditional documentation:\nN/A", "createdAt": "2020-10-07T19:45:23Z", "url": "https://github.com/IQSS/dataverse/pull/7312", "merged": true, "mergeCommit": {"oid": "78a10444d731f63560714ac7f1e76880b47f8754"}, "closed": true, "closedAt": "2021-02-03T23:22:57Z", "author": {"login": "mheppler"}, "timelineItems": {"totalCount": 47, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdQSOb8gH2gAyNDk5NDc3MTI5OjI5MDNiMDg4OGE4ZDg1OTFmNjhkZWMyYWZjYTA4OWJlZTE3YmRjZmU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABd2VknogH2gAyNDk5NDc3MTI5OmU5ZTk5YjQxMjEwMTJlY2M0ZmY5MzdiN2MzYWM1NTAwZThmZjU2MzI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "2903b0888a8d8591f68dec2afca089bee17bdcfe", "author": {"user": {"login": "mheppler", "name": "Michael Heppler"}}, "url": "https://github.com/IQSS/dataverse/commit/2903b0888a8d8591f68dec2afca089bee17bdcfe", "committedDate": "2020-10-07T19:34:05Z", "message": "Consolidated file metadata on dataset pg by using file-info-fragment from file replace pg [ref #7081]"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f094b97dce164f28701492db089de3164c85ef14", "author": {"user": {"login": "mheppler", "name": "Michael Heppler"}}, "url": "https://github.com/IQSS/dataverse/commit/f094b97dce164f28701492db089de3164c85ef14", "committedDate": "2020-10-08T15:19:49Z", "message": "Fixed download count error on file-info-fragment, as well as cleaned up thumbnail code [ref #7081]"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA0OTUxODkz", "url": "https://github.com/IQSS/dataverse/pull/7312#pullrequestreview-504951893", "createdAt": "2020-10-08T16:18:22Z", "commit": {"oid": "f094b97dce164f28701492db089de3164c85ef14"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOFQxNjoxODoyMlrOHemUpg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOFQxNjoxODoyMlrOHemUpg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTg0NzIwNg==", "bodyText": "Here is the canDownloadFile logic that was removed, as I do no believe is necessary on EditDatafilesPage. If you can edit, you can download.", "url": "https://github.com/IQSS/dataverse/pull/7312#discussion_r501847206", "createdAt": "2020-10-08T16:18:22Z", "author": {"login": "mheppler"}, "path": "src/main/java/edu/harvard/iq/dataverse/EditDatafilesPage.java", "diffHunk": "@@ -2562,20 +2562,6 @@ public boolean isLocked() {\n         return false;\n     }\n     \n-    public boolean isThumbnailAvailable(FileMetadata fileMetadata) {\n-        // new and optimized logic: \n-        // - check download permission here (should be cached - so it's free!)\n-        // - only then ask the file service if the thumbnail is available/exists.\n-        // the service itself no longer checks download permissions.  \n-        if (!fileDownloadHelper.canDownloadFile(fileMetadata)) {\n-            return false;\n-        }\n-\n-        return datafileService.isThumbnailAvailable(fileMetadata.getDataFile());\n-    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f094b97dce164f28701492db089de3164c85ef14"}, "originalPosition": 14}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "56dc4c75ba9acf9c66906169bb9baa2dc74a7691", "author": {"user": {"login": "mheppler", "name": "Michael Heppler"}}, "url": "https://github.com/IQSS/dataverse/commit/56dc4c75ba9acf9c66906169bb9baa2dc74a7691", "committedDate": "2020-10-08T19:52:24Z", "message": "Removed additional editMode render logic not needed in file table on dataset pg [ref #7081]"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "44722f51a12878d8e1bf01d452eed082f0b6a6e6", "author": {"user": {"login": "mheppler", "name": "Michael Heppler"}}, "url": "https://github.com/IQSS/dataverse/commit/44722f51a12878d8e1bf01d452eed082f0b6a6e6", "committedDate": "2020-10-09T16:27:56Z", "message": "Removed commented out isDuplicate render logic from checksum in dataset pg file table [ref #7081]"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9eb7f9aef2dd38556d025431b840ae42783300e2", "author": {"user": {"login": "mheppler", "name": "Michael Heppler"}}, "url": "https://github.com/IQSS/dataverse/commit/9eb7f9aef2dd38556d025431b840ae42783300e2", "committedDate": "2020-10-09T16:50:37Z", "message": "Additional render logic clean up on file-info-fragment [ref #7081]"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "81384baec44f1a100ff84434a511bc7df93d975e", "author": {"user": {"login": "mheppler", "name": "Michael Heppler"}}, "url": "https://github.com/IQSS/dataverse/commit/81384baec44f1a100ff84434a511bc7df93d975e", "committedDate": "2020-10-15T16:56:42Z", "message": "Added checksum truncation function WIP [ref #7081 #6685 #5210]"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "aefcfad57abd0d4a35256c098a44359bb54cb103", "author": {"user": {"login": "mheppler", "name": "Michael Heppler"}}, "url": "https://github.com/IQSS/dataverse/commit/aefcfad57abd0d4a35256c098a44359bb54cb103", "committedDate": "2020-10-18T19:25:18Z", "message": "Merge branch '7081-kebab-file-options-icon-btn' into 7081-file-metadata-include"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "da6e3640566489366ad29ad7f7ff8ba076ef0c92", "author": {"user": {"login": "mheppler", "name": "Michael Heppler"}}, "url": "https://github.com/IQSS/dataverse/commit/da6e3640566489366ad29ad7f7ff8ba076ef0c92", "committedDate": "2020-12-17T16:05:37Z", "message": "Merge branch 'develop' into 7081-file-metadata-include"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3b90d1c87d923c3325e9343c9f9abb7d3dc24f56", "author": {"user": {"login": "mheppler", "name": "Michael Heppler"}}, "url": "https://github.com/IQSS/dataverse/commit/3b90d1c87d923c3325e9343c9f9abb7d3dc24f56", "committedDate": "2020-12-17T16:41:25Z", "message": "Commented out code in file table include to clean up UI [ref #6685 #5210]"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "35982b764575553c5a3fdc5f8f0f18f2274dbd8e", "author": {"user": {"login": "mheppler", "name": "Michael Heppler"}}, "url": "https://github.com/IQSS/dataverse/commit/35982b764575553c5a3fdc5f8f0f18f2274dbd8e", "committedDate": "2021-01-05T20:23:27Z", "message": "Checksum truncate and click to copy added to file table on dataset pg [ref #5210]"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b9052ceba00a43598df3b4a5c827a245f9c87d17", "author": {"user": {"login": "mheppler", "name": "Michael Heppler"}}, "url": "https://github.com/IQSS/dataverse/commit/b9052ceba00a43598df3b4a5c827a245f9c87d17", "committedDate": "2021-01-05T20:23:59Z", "message": "Merge branch 'develop' into 7081-file-metadata-include"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3ea71dd0c3fbfd008831d82e84142ad498ab5ca9", "author": {"user": {"login": "mheppler", "name": "Michael Heppler"}}, "url": "https://github.com/IQSS/dataverse/commit/3ea71dd0c3fbfd008831d82e84142ad498ab5ca9", "committedDate": "2021-01-08T18:25:08Z", "message": "Checksum/unf truncation, click to copy, for dataset pg and dataverse pg, plus file metadata code clean up [ref #5210]"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d0397848abc540bc92345a38449c8cf74710d0de", "author": {"user": {"login": "mheppler", "name": "Michael Heppler"}}, "url": "https://github.com/IQSS/dataverse/commit/d0397848abc540bc92345a38449c8cf74710d0de", "committedDate": "2021-01-11T15:12:15Z", "message": "Applied truncation to UNF, moved tabular metadata labels to bundle [ref #5210 #6685]"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "2b48df5e35aaad42a493473c860d41b85e8e14d9", "author": {"user": {"login": "landreev", "name": null}}, "url": "https://github.com/IQSS/dataverse/commit/2b48df5e35aaad42a493473c860d41b85e8e14d9", "committedDate": "2021-01-11T16:42:26Z", "message": "Merge branch '7081-file-metadata-include' of https://github.com/IQSS/dataverse into 7081-file-metadata-include"}, "afterCommit": {"oid": "d0397848abc540bc92345a38449c8cf74710d0de", "author": {"user": {"login": "mheppler", "name": "Michael Heppler"}}, "url": "https://github.com/IQSS/dataverse/commit/d0397848abc540bc92345a38449c8cf74710d0de", "committedDate": "2021-01-11T15:12:15Z", "message": "Applied truncation to UNF, moved tabular metadata labels to bundle [ref #5210 #6685]"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d16b6ee4bdb8b5fb282200391bcf78963d8f7247", "author": {"user": {"login": "landreev", "name": null}}, "url": "https://github.com/IQSS/dataverse/commit/d16b6ee4bdb8b5fb282200391bcf78963d8f7247", "committedDate": "2021-01-11T17:15:36Z", "message": "This is the reason search cards were not fully initialized for tabular files. (#7312)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1b27ec324fa45968e329b6ae39411b7d9f58b064", "author": {"user": {"login": "mheppler", "name": "Michael Heppler"}}, "url": "https://github.com/IQSS/dataverse/commit/1b27ec324fa45968e329b6ae39411b7d9f58b064", "committedDate": "2021-01-11T20:08:28Z", "message": "Separate unf display from variables + observations on dataverse pg result cards [ref #5210 #6685]"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "16a3efad80f995f95a199bf9eb59740a69146f85", "author": {"user": {"login": "mheppler", "name": "Michael Heppler"}}, "url": "https://github.com/IQSS/dataverse/commit/16a3efad80f995f95a199bf9eb59740a69146f85", "committedDate": "2021-01-11T20:20:24Z", "message": "Overwrite css from primefaces component.css for overflow property to be visible for datatables [ref #5210 #6685]"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "aae992507223dcec08dbe58f99090195e9bc6a18", "author": {"user": {"login": "mheppler", "name": "Michael Heppler"}}, "url": "https://github.com/IQSS/dataverse/commit/aae992507223dcec08dbe58f99090195e9bc6a18", "committedDate": "2021-01-11T21:33:48Z", "message": "Fixed float UI issue in file table on dataset pg [ref #5210, #6685]"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d85806e6f31adc7360abed068cd85b9e83135777", "author": {"user": {"login": "mheppler", "name": "Michael Heppler"}}, "url": "https://github.com/IQSS/dataverse/commit/d85806e6f31adc7360abed068cd85b9e83135777", "committedDate": "2021-01-11T21:48:04Z", "message": "Merge branch 'develop' into 7081-file-metadata-include"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTY2NDkwNTMw", "url": "https://github.com/IQSS/dataverse/pull/7312#pullrequestreview-566490530", "createdAt": "2021-01-12T17:11:10Z", "commit": {"oid": "d85806e6f31adc7360abed068cd85b9e83135777"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xMlQxNzoxMToxMFrOISLq5Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xMlQxNzoxMToxMFrOISLq5Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NTkzNjQ4NQ==", "bodyText": "If I understand correctly (e.g. from the code links below), MIME_TYPE_TSV_ALT should be the only mimetype that will have variable metadata. So -  can you also drop the first MIME_TYPE_TSV in this if statement?\nIngested tabular file mimetype set to MIME_TYPE_TSV_ALT:\n\n  \n    \n      dataverse/src/main/java/edu/harvard/iq/dataverse/ingest/IngestServiceBean.java\n    \n    \n         Line 922\n      in\n      0bcdcfd\n    \n    \n    \n    \n\n        \n          \n           dataFile.setContentType(FileUtil.MIME_TYPE_INGESTED_FILE); \n        \n    \n  \n\n\nIncoming files of type MIME_TYPE_TSV_ALT changed to MIME_TYPE_TSV\n\n  \n    \n      dataverse/src/main/java/edu/harvard/iq/dataverse/ingest/IngestServiceBean.java\n    \n    \n        Lines 355 to 358\n      in\n      0bcdcfd\n    \n    \n    \n    \n\n        \n          \n           } else if (FileUtil.MIME_TYPE_INGESTED_FILE.equals(dataFile.getContentType())) { \n        \n\n        \n          \n                              // Make sure no *uningested* tab-delimited files are saved with the type \"text/tab-separated-values\"! \n        \n\n        \n          \n                              // \"text/tsv\" should be used instead:  \n        \n\n        \n          \n                              dataFile.setContentType(FileUtil.MIME_TYPE_TSV);", "url": "https://github.com/IQSS/dataverse/pull/7312#discussion_r555936485", "createdAt": "2021-01-12T17:11:10Z", "author": {"login": "qqmyers"}, "path": "src/main/java/edu/harvard/iq/dataverse/DataFileServiceBean.java", "diffHunk": "@@ -497,7 +497,7 @@ public DataFile findCheapAndEasy(Long id) {\n         // If content type indicates it's tabular data, spend 2 extra queries \n         // looking up the data table and tabular tags objects:\n         \n-        if (MIME_TYPE_TSV.equalsIgnoreCase(contentType)) {\n+        if (MIME_TYPE_TSV.equalsIgnoreCase(contentType) || MIME_TYPE_TSV_ALT.equalsIgnoreCase(contentType)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d85806e6f31adc7360abed068cd85b9e83135777"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6b4fb249a3a4a5bf84ab9fb5c67eec3b7e8f4415", "author": {"user": {"login": "mheppler", "name": "Michael Heppler"}}, "url": "https://github.com/IQSS/dataverse/commit/6b4fb249a3a4a5bf84ab9fb5c67eec3b7e8f4415", "committedDate": "2021-01-12T21:33:32Z", "message": "Undo on bug testing revision mistakenly left in java function [ref #5210, #6685]"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2ee739aa59d7ac22db815c8f8005043370a4f4ec", "author": {"user": {"login": "mheppler", "name": "Michael Heppler"}}, "url": "https://github.com/IQSS/dataverse/commit/2ee739aa59d7ac22db815c8f8005043370a4f4ec", "committedDate": "2021-01-19T16:32:16Z", "message": "File table responsive clean up, added file date labels [ref #5210, #6685]"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "23e8f5cc2b05d069af92fc32c92b7884087a3ff8", "author": {"user": {"login": "mheppler", "name": "Michael Heppler"}}, "url": "https://github.com/IQSS/dataverse/commit/23e8f5cc2b05d069af92fc32c92b7884087a3ff8", "committedDate": "2021-01-19T16:58:35Z", "message": "Merge branch 'develop' into 7081-file-metadata-include"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c7f7782d73811d7dffcb569f80476063d1c2f964", "author": {"user": {"login": "mheppler", "name": "Michael Heppler"}}, "url": "https://github.com/IQSS/dataverse/commit/c7f7782d73811d7dffcb569f80476063d1c2f964", "committedDate": "2021-01-20T21:58:55Z", "message": "Updated metadata labels in dataset version differences popup, added to bundle [ref #5210, #6685]"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0706720c310adc0c22f26afd8cc9b17a68c54cc7", "author": {"user": {"login": "mheppler", "name": "Michael Heppler"}}, "url": "https://github.com/IQSS/dataverse/commit/0706720c310adc0c22f26afd8cc9b17a68c54cc7", "committedDate": "2021-01-21T17:42:41Z", "message": "Mistakenly committed dev workaround, removed emuns [ref #5210, #6685]"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3587fe9c345f5a75f1a81c18b9afc22aa315ef7a", "author": {"user": {"login": "mheppler", "name": "Michael Heppler"}}, "url": "https://github.com/IQSS/dataverse/commit/3587fe9c345f5a75f1a81c18b9afc22aa315ef7a", "committedDate": "2021-01-21T19:22:21Z", "message": "Hide file metadata download count in file tables if dataset unpublished [ref #5210, #7513]"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dfa367e8ceb087f257312823ef523a146f603d23", "author": {"user": {"login": "mheppler", "name": "Michael Heppler"}}, "url": "https://github.com/IQSS/dataverse/commit/dfa367e8ceb087f257312823ef523a146f603d23", "committedDate": "2021-01-21T19:29:46Z", "message": "Removed parantesis from Tags label [ref #5210]"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTczNzI0OTQ5", "url": "https://github.com/IQSS/dataverse/pull/7312#pullrequestreview-573724949", "createdAt": "2021-01-21T20:50:43Z", "commit": {"oid": "dfa367e8ceb087f257312823ef523a146f603d23"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0yMVQyMDo1MDo0M1rOIYJRag==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0yNVQyMDoyMDoyNVrOIZ44sQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MjE4ODY1MA==", "bodyText": "these values are only used for the equality check, seems silly to not just check isRestricted directly.", "url": "https://github.com/IQSS/dataverse/pull/7312#discussion_r562188650", "createdAt": "2021-01-21T20:50:43Z", "author": {"login": "scolapasta"}, "path": "src/main/java/edu/harvard/iq/dataverse/DatasetVersionDifference.java", "diffHunk": "@@ -1080,10 +1055,9 @@ private boolean fileMetadataIsDifferent(FileMetadata fm1, FileMetadata fm2) {\n             return true;\n         }\n         \n-        //File restrictions\n-        \n-        value1 = fm1.isRestricted() ? \"Restricted\" : \"Not Restricted\";\n-        value2 = fm2.isRestricted() ? \"Restricted\" : \"Not Restricted\";\n+        // File restrictions\n+        value1 = fm1.isRestricted() ? BundleUtil.getStringFromBundle(\"restricted\") : BundleUtil.getStringFromBundle(\"public\");\n+        value2 = fm2.isRestricted() ? BundleUtil.getStringFromBundle(\"restricted\") : BundleUtil.getStringFromBundle(\"public\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dfa367e8ceb087f257312823ef523a146f603d23"}, "originalPosition": 112}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NDAxMzM0Mg==", "bodyText": "While this is true with the current built in roles, it is not inherently true of the permission system. Is it possible that some day, someone would want a a role that can edit but not download (for example editing the metadata?) It may be worth keeping this; alternatively we can keep removed knowing that we'd have to revisit it someday.", "url": "https://github.com/IQSS/dataverse/pull/7312#discussion_r564013342", "createdAt": "2021-01-25T20:13:21Z", "author": {"login": "scolapasta"}, "path": "src/main/java/edu/harvard/iq/dataverse/EditDatafilesPage.java", "diffHunk": "@@ -2562,20 +2562,6 @@ public boolean isLocked() {\n         return false;\n     }\n     \n-    public boolean isThumbnailAvailable(FileMetadata fileMetadata) {\n-        // new and optimized logic: \n-        // - check download permission here (should be cached - so it's free!)\n-        // - only then ask the file service if the thumbnail is available/exists.\n-        // the service itself no longer checks download permissions.  \n-        if (!fileDownloadHelper.canDownloadFile(fileMetadata)) {\n-            return false;\n-        }\n-\n-        return datafileService.isThumbnailAvailable(fileMetadata.getDataFile());\n-    }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTg0NzIwNg=="}, "originalCommit": {"oid": "f094b97dce164f28701492db089de3164c85ef14"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NDAxNzMyOQ==", "bodyText": "is this removed because the filefragment itself is only shown when not in editMode?", "url": "https://github.com/IQSS/dataverse/pull/7312#discussion_r564017329", "createdAt": "2021-01-25T20:20:25Z", "author": {"login": "scolapasta"}, "path": "src/main/webapp/filesFragment.xhtml", "diffHunk": "@@ -35,15 +35,16 @@\n     <p:remoteCommand name=\"rebindCommand\" process=\"@this\" update=\"filesTable\" oncomplete=\"javascript:bind_bsui_components();\"/>\n \n     <!-- Files Table -->\n+    <!-- TABLESTYLE + WIDTH:AUTO FIX COL WIDTH OVERFLOW HIDDEN, MIN-WIDTH 100% ADDED FOR TABLE CONTENT LESS THAN 100% https://stackoverflow.com/a/38582318 -->\n     <p:dataTable id=\"filesTable\" \n                  rows=\"10\" paginator=\"#{DatasetPage.fileMetadatasSearch.size() gt 10}\" paginatorPosition=\"bottom\"\n                  paginatorTemplate=\"{FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} #{bundle['file.dynamicCounter.filesPerPage']} {RowsPerPageDropdown}\"\n                  rowsPerPageTemplate=\"10,25,50\"\n-                 style=\"margin-right:1px;\"\n+                 style=\"margin-right:1px;\" tableStyle=\"min-width:100%;width:auto;\"\n                  value=\"#{DatasetPage.fileMetadatasSearch}\"\n                  rowIndexVar=\"rowNum\" rowKey=\"#{fileMetadata.dataFile.storageIdentifier}\"\n                  selection=\"#{DatasetPage.selectedFiles}\" var=\"fileMetadata\" widgetVar=\"filesTable\"\n-                 rendered=\"#{DatasetPage.fileDisplayTable and empty DatasetPage.editMode and (DatasetPage.workingVersion != null)}\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dfa367e8ceb087f257312823ef523a146f603d23"}, "originalPosition": 14}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0a14b8625f46ed5a82c046905302acfbad5cd56d", "author": {"user": {"login": "mheppler", "name": "Michael Heppler"}}, "url": "https://github.com/IQSS/dataverse/commit/0a14b8625f46ed5a82c046905302acfbad5cd56d", "committedDate": "2021-01-25T21:40:41Z", "message": "Merge branch 'develop' into 7081-file-metadata-include"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f46a87f52b573f9ecc77778c8e6b62801e3bad58", "author": {"user": {"login": "mheppler", "name": "Michael Heppler"}}, "url": "https://github.com/IQSS/dataverse/commit/f46a87f52b573f9ecc77778c8e6b62801e3bad58", "committedDate": "2021-01-26T01:41:30Z", "message": "Removed unnecessary editMode render logic, refactored other logic [ref #7081]"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTc1OTUwMjYz", "url": "https://github.com/IQSS/dataverse/pull/7312#pullrequestreview-575950263", "createdAt": "2021-01-26T01:52:01Z", "commit": {"oid": "dfa367e8ceb087f257312823ef523a146f603d23"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0yNlQwMTo1NDowOVrOIaBw8w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0yNlQwMTo1NDowOVrOIaBw8w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NDE2MjgwMw==", "bodyText": "@scolapasta I believe this is change related to the removing of the isThumbnailAvailable function from EditDatafilesPage.java that you commented on, as I am now using this include on more than just the edit file pgs, so I am pointing the logic at the dataFileServiceBean version of the logic.", "url": "https://github.com/IQSS/dataverse/pull/7312#discussion_r564162803", "createdAt": "2021-01-26T01:54:09Z", "author": {"login": "mheppler"}, "path": "src/main/webapp/file-info-fragment.xhtml", "diffHunk": "@@ -10,52 +10,79 @@\n     xmlns:cc=\"http://java.sun.com/jsf/composite\"\n     xmlns:o=\"http://omnifaces.org/ui\"\n     xmlns:iqbs=\"http://xmlns.jcp.org/jsf/composite/iqbs\">\n-    <p:outputPanel>\n-        <div id=\"fileInfoInclude-filesTable\" class=\"col-sm-12 row\">\n-            <div class=\"pull-left col-file-thumb\">\n-                <div class=\"thumbnail-block text-center\">  \n-                    <span class=\"icon-#{dataFileServiceBean.getFileThumbnailClass(fileMetadata.dataFile)} file-thumbnail-icon text-muted\" jsf:rendered=\"#{!EditDatafilesPage.isThumbnailAvailable(fileMetadata)}\"/>\n-                    <span class=\"file-thumbnail-preview-img\" jsf:rendered=\"#{EditDatafilesPage.isThumbnailAvailable(fileMetadata)}\"\n-                          data-toggle=\"popover\" data-placement=\"bottom\" data-trigger=\"hover\" data-html=\"true\" data-content=\"&lt;img src=&#34;/api/access/datafile/#{fileMetadata.dataFile.id}?imageThumb=400&#34; alt=&#34;#{bundle['file.preview']} #{fileMetadata.label}&#34; /&gt;\"\n-                          data-template='&lt;div class=\"popover thumb-preview\" role=\"tooltip\"&gt;&lt;div class=\"arrow\"&gt;&lt;/div&gt;&lt;h3 class=\"popover-title\"&gt;&lt;/h3&gt;&lt;div class=\"popover-content\"&gt;&lt;/div&gt;&lt;/div&gt;'>\n-                        <p:graphicImage value=\"/api/access/datafile/#{fileMetadata.dataFile.id}?imageThumb=true\" alt=\"#{fileMetadata.label}\"/>\n-                    </span>\n-                    <!-- Restricted File Icon -->\n-                    <div class=\"file-icon-restricted-block\" jsf:rendered=\"#{fileMetadata.restricted and !fileDownloadHelper.canDownloadFile(fileMetadata)}\">                  \n-                        <span class=\"glyphicon glyphicon-lock text-danger\"/>\n-                    </div>\n-                    <div class=\"file-icon-restricted-block\" jsf:rendered=\"#{fileMetadata.restricted and fileDownloadHelper.canDownloadFile(fileMetadata) }\">\n-                        <span class=\"icon-unlock text-success\"/>\n-                    </div>\n+    <p:outputPanel id=\"fileInfoInclude-filesTable\" styleClass=\"media\">\n+        <div class=\"media-left col-file-thumb\" style=\"padding-top:4px;\">\n+            <div class=\"media-object thumbnail-block text-center\">\n+                <span class=\"icon-#{dataFileServiceBean.getFileThumbnailClass(fileMetadata.dataFile)} file-thumbnail-icon text-muted\" jsf:rendered=\"#{!dataFileServiceBean.isThumbnailAvailable(fileMetadata.dataFile)}\"/>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f46a87f52b573f9ecc77778c8e6b62801e3bad58"}, "originalPosition": 24}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "191bdfc45371fc146b2e92ee33d63684896dea2f", "author": {"user": {"login": "mheppler", "name": "Michael Heppler"}}, "url": "https://github.com/IQSS/dataverse/commit/191bdfc45371fc146b2e92ee33d63684896dea2f", "committedDate": "2021-01-26T21:22:37Z", "message": "Code clean up and comments to doc renders and params for file-info [ref #7081, #6685, #5210]"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "59610338421de5774b9a65b0ef8b9aa172f2262e", "author": {"user": {"login": "mheppler", "name": "Michael Heppler"}}, "url": "https://github.com/IQSS/dataverse/commit/59610338421de5774b9a65b0ef8b9aa172f2262e", "committedDate": "2021-01-26T21:26:17Z", "message": "Undoing mistakenly committed bug workaround hack for notifications git add src/main/java/edu/harvard/iq/dataverse/UserNotification.javagit add src/main/java/edu/harvard/iq/dataverse/UserNotification.java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c0dc967cffe64ac468fef229611a1dbaa12e78b7", "author": {"user": {"login": "scolapasta", "name": "Gustavo Durand"}}, "url": "https://github.com/IQSS/dataverse/commit/c0dc967cffe64ac468fef229611a1dbaa12e78b7", "committedDate": "2021-01-26T21:48:36Z", "message": "Update file-info-fragment.xhtml"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0ebc23f42102230af140044387dee517f7c442de", "author": {"user": {"login": "scolapasta", "name": "Gustavo Durand"}}, "url": "https://github.com/IQSS/dataverse/commit/0ebc23f42102230af140044387dee517f7c442de", "committedDate": "2021-01-26T21:58:07Z", "message": "Update dataset.xhtml"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "714b288363a2a68d816d2532fc5e58bc96d885a9", "author": {"user": {"login": "scolapasta", "name": "Gustavo Durand"}}, "url": "https://github.com/IQSS/dataverse/commit/714b288363a2a68d816d2532fc5e58bc96d885a9", "committedDate": "2021-01-26T21:58:46Z", "message": "Update filesFragment.xhtml"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7f97d018b1383420d2b45516aaa254eaef1b63d8", "author": {"user": {"login": "scolapasta", "name": "Gustavo Durand"}}, "url": "https://github.com/IQSS/dataverse/commit/7f97d018b1383420d2b45516aaa254eaef1b63d8", "committedDate": "2021-01-26T22:04:47Z", "message": "Update dataset.xhtml"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "63eb5bdad0aec8df97aefd0f84330f46682d73fa", "author": {"user": {"login": "scolapasta", "name": "Gustavo Durand"}}, "url": "https://github.com/IQSS/dataverse/commit/63eb5bdad0aec8df97aefd0f84330f46682d73fa", "committedDate": "2021-01-26T22:09:30Z", "message": "Update DatasetPage.java"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTc2ODMxNzE4", "url": "https://github.com/IQSS/dataverse/pull/7312#pullrequestreview-576831718", "createdAt": "2021-01-26T22:54:39Z", "commit": {"oid": "63eb5bdad0aec8df97aefd0f84330f46682d73fa"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0d08717b8d28656040db4789775435f804e9de33", "author": {"user": {"login": "mheppler", "name": "Michael Heppler"}}, "url": "https://github.com/IQSS/dataverse/commit/0d08717b8d28656040db4789775435f804e9de33", "committedDate": "2021-01-27T21:20:23Z", "message": "Merge branch 'develop' into 7081-file-metadata-include"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "814c005645a09163a897276a6934f16e3b956429", "author": {"user": {"login": "mheppler", "name": "Michael Heppler"}}, "url": "https://github.com/IQSS/dataverse/commit/814c005645a09163a897276a6934f16e3b956429", "committedDate": "2021-01-27T22:00:10Z", "message": "Cleaned up copy to clipboard code for checksums and tokens [ref #6039, #7081, #6685, #5210]"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "89023bae820cf46b2481da191e6ddaf626fabbd1", "author": {"user": {"login": "mheppler", "name": "Michael Heppler"}}, "url": "https://github.com/IQSS/dataverse/commit/89023bae820cf46b2481da191e6ddaf626fabbd1", "committedDate": "2021-01-29T16:53:17Z", "message": "Fix checksum flashing and rebinding issues on download, search [ref #7081]"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "85755bad3aba0e577d539c447aa650a63e26252f", "author": {"user": {"login": "mheppler", "name": "Michael Heppler"}}, "url": "https://github.com/IQSS/dataverse/commit/85755bad3aba0e577d539c447aa650a63e26252f", "committedDate": "2021-01-29T17:05:32Z", "message": "Fix checksum flashing and rebinding issues on download [ref #7081]"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a6d46bb47d7da64da9cdffe8f82e0166d610cc7c", "author": {"user": {"login": "mheppler", "name": "Michael Heppler"}}, "url": "https://github.com/IQSS/dataverse/commit/a6d46bb47d7da64da9cdffe8f82e0166d610cc7c", "committedDate": "2021-02-02T15:15:34Z", "message": "Added copy to clipboard success ok icon for checksums [ref #7081]"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e17300f516654e176eaa81747391341fdb9994aa", "author": {"user": {"login": "mheppler", "name": "Michael Heppler"}}, "url": "https://github.com/IQSS/dataverse/commit/e17300f516654e176eaa81747391341fdb9994aa", "committedDate": "2021-02-02T16:40:35Z", "message": "Merge branch 'develop' into 7081-file-metadata-include"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e9e99b4121012ecc4ff937b7c3ac5500e8ff5632", "author": {"user": {"login": "mheppler", "name": "Michael Heppler"}}, "url": "https://github.com/IQSS/dataverse/commit/e9e99b4121012ecc4ff937b7c3ac5500e8ff5632", "committedDate": "2021-02-03T00:57:09Z", "message": "Fixed double click issue on click to copy [ref #7081, #6685, #5210]"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 781, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}