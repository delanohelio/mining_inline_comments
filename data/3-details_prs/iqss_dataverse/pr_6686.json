{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc5ODc5ODIx", "number": 6686, "title": "4964 harvesting issues", "bodyText": "What this PR does / why we need it:\nThis addresses a few harvesting issues from #4964:\n\nMost important one: the create/edit dialog on the harvesting clients page is now going to actively push the user to select a sensible \"archive type\" for the remote repository. It no longer defaults to \"Dataverse\", and it's not going to allow the user to leave it blank. Dataverse needs to know this \"archive type\" in order to be able to generate redirect links for harvested objects.\nFor datasets harvested from \"Generic OAI Archives\", much improved redirect links. Prod. example: https://dataverse.harvard.edu/dataverse/srda_harvested - clicking on the titles in the search cards is currently redirecting to a bland OAI page on datacite.org. With the fix in this PR, it'll change to redirecting to the proper study pages  via the DOI resolver.\nSome improved labels/user messages. (\"DC\" is dropped from the \"Generic OAI archive\" label, per Julian's suggestion).\nA somewhat limited fix for the exotic, but annoying problem discovered as we were working on the issue: (bear with me!)\nThe SRDA dataverse (link above) is configured to harvest from oai.datacite.org. The archive has ~2200 sets total; and it takes forever to retrieve the whole list. The site only gives them out in chunks of 50; and as of yesterday it was taking between 40-50+ seconds for each chunk (!). So it would take ~30 min. to retrieve the whole list. In its current form harvesting client setup page needs the full set list before it can proceed to the next step and offer the user a choice of which set to harvest... Obviously, we can't make the user wait 30 min.; and something times out anyway before it's done. This means it is impossible to set up harvesting from oai.datacite.org, and impossible to edit an already configured client. (Julian must have set it up originally back when there were either fewer sets, or it wasn't taking as long to retrieve them).\nThe best I could think of to work around this, I'm now checking on the progress, and if it's taken longer than a minute to retrieve the first 100 sets, I proceed to the next step, show the user the truncated list of sets, and warn them about what happened:\n\n\nThey may still not be able to select the set they want; but they may be able to set up the client with the default set, for example, and then configure the client with the set they want via the API; or they may be able to edit the schedule of an existing client... better than what's going on now.\nIf anyone can think of a better solution, please open a new issue for it. But I don't think it's worth investing too much energy into this. I'm not aware of another OAI archive where this is a problem.\nWhich issue(s) this PR closes:\nCloses #4964\nSpecial notes for your reviewer:\nSuggestions on how to test this:\nDoes this PR introduce a user interface change?:\nIs there a release notes update needed for this change?:\nAdditional documentation:", "createdAt": "2020-02-25T23:36:28Z", "url": "https://github.com/IQSS/dataverse/pull/6686", "merged": true, "mergeCommit": {"oid": "1ec2260c74055bfe63ea4685c6b22d4727d1fab0"}, "closed": true, "closedAt": "2020-02-27T21:31:49Z", "author": {"login": "landreev"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcHlfD7AH2gAyMzc5ODc5ODIxOjU0OTBhMzFiMmQ2ZWI0Zjg4YWM5YjhmYWY2NWNjZTg1N2Y1ODNlYzc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcIezdRAH2gAyMzc5ODc5ODIxOjY0MWM3M2ZkNjhhN2YyOTRhMzdjNTQxZmVjMTJhNmQzZjRkYWNjNjk=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "5490a31b2d6eb4f88ac9b8faf65cce857f583ec7", "author": {"user": {"login": "landreev", "name": null}}, "url": "https://github.com/IQSS/dataverse/commit/5490a31b2d6eb4f88ac9b8faf65cce857f583ec7", "committedDate": "2020-02-24T22:43:58Z", "message": "small improvements for handling harvested datasets and configuring harvesting clients, per #4964."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3e30bcbfa3773f858d48dbff842b263c5405f8e9", "author": {"user": {"login": "landreev", "name": null}}, "url": "https://github.com/IQSS/dataverse/commit/3e30bcbfa3773f858d48dbff842b263c5405f8e9", "committedDate": "2020-02-25T19:14:25Z", "message": "more aggressive validation, forcing the user to pick the remote archive type. (#4964)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e5465f0b15eb96aa845b16b66a94f55bf50d62e0", "author": {"user": {"login": "landreev", "name": null}}, "url": "https://github.com/IQSS/dataverse/commit/e5465f0b15eb96aa845b16b66a94f55bf50d62e0", "committedDate": "2020-02-25T23:34:25Z", "message": "a simple solution for the \"too many sets\" problem. (#4964)."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "eb063f2e76b5ce47c2c2daf392ca29785f975c9e", "author": {"user": {"login": "landreev", "name": null}}, "url": "https://github.com/IQSS/dataverse/commit/eb063f2e76b5ce47c2c2daf392ca29785f975c9e", "committedDate": "2020-02-26T15:53:55Z", "message": "minor cleanup of the code in OaiHandler - was supposed to be part of the PR. (#4964)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "230609cad42ab16bf37d87b1b35e39ff7ad7ba50", "author": {"user": {"login": "landreev", "name": null}}, "url": "https://github.com/IQSS/dataverse/commit/230609cad42ab16bf37d87b1b35e39ff7ad7ba50", "committedDate": "2020-02-26T23:29:23Z", "message": "another minor improvement, for an OAI server with a tricky list of sets. (#4964)\nI'm done, for reals."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3cd1575c85ca89e8e6f7092575c14cc268b1f7d0", "author": {"user": {"login": "landreev", "name": null}}, "url": "https://github.com/IQSS/dataverse/commit/3cd1575c85ca89e8e6f7092575c14cc268b1f7d0", "committedDate": "2020-02-26T23:38:36Z", "message": "ok, now I'm done (#4964)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5b6b75c463c03489b4ed339b01548951eb2f5a05", "author": {"user": {"login": "landreev", "name": null}}, "url": "https://github.com/IQSS/dataverse/commit/5b6b75c463c03489b4ed339b01548951eb2f5a05", "committedDate": "2020-02-27T01:36:09Z", "message": "Merge branch 'develop' into 4964-harvesting-issues"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY1NzkxMTkx", "url": "https://github.com/IQSS/dataverse/pull/6686#pullrequestreview-365791191", "createdAt": "2020-02-27T16:11:50Z", "commit": {"oid": "5b6b75c463c03489b4ed339b01548951eb2f5a05"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yN1QxNjoxMTo1MFrOFvXZbg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yN1QxNjoxMjo1OVrOFvXceQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTIxMDczNA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            harvestclients.newClientDialog.harvestingStyle.required=Please select one of the values from the menu\n          \n          \n            \n            harvestclients.newClientDialog.harvestingStyle.required=Please select one of the values from the menu.\n          \n      \n    \n    \n  \n\nI didn't run the code to see how the GUI looks but perhaps this sentence should end with a period? Apologies if I'm mistaken and some other string is concatenated or something.", "url": "https://github.com/IQSS/dataverse/pull/6686#discussion_r385210734", "createdAt": "2020-02-27T16:11:50Z", "author": {"login": "pdurbin"}, "path": "src/main/java/propertyFiles/Bundle.properties", "diffHunk": "@@ -503,6 +504,7 @@ harvestclients.newClientDialog.step4=Step 4 of 4 - Display\n harvestclients.newClientDialog.harvestingStyle=Archive Type\n harvestclients.newClientDialog.harvestingStyle.tip=Type of remote archive.\n harvestclients.newClientDialog.harvestingStyle.helptext=Select the archive type that best describes this remote server in order to properly apply formatting rules and styles to the harvested metadata as they are shown in the search results. Note that improperly selecting the type of the remote archive can result in incomplete entries in the search results, and a failure to redirect the user to the archival source of the data.\n+harvestclients.newClientDialog.harvestingStyle.required=Please select one of the values from the menu", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5b6b75c463c03489b4ed339b01548951eb2f5a05"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTIxMTUxMw==", "bodyText": "My only thought here is that we could replace the exclamation mark with a period. This is sort of a \"voice\" thing. I'm not sure what the voice for the Dataverse software is or should be.", "url": "https://github.com/IQSS/dataverse/pull/6686#discussion_r385211513", "createdAt": "2020-02-27T16:12:59Z", "author": {"login": "pdurbin"}, "path": "src/main/java/propertyFiles/Bundle.properties", "diffHunk": "@@ -482,6 +482,7 @@ harvestclients.newClientDialog.oaiSets.tip=Harvesting sets offered by this OAI s\n harvestclients.newClientDialog.oaiSets.noset=None\n harvestclients.newClientDialog.oaiSets.helptext=Selecting \"none\" will harvest the default set, as defined by the server. Often this will be the entire body of content across all sub-sets.\n harvestclients.newClientDialog.oaiSets.helptext.noset=This OAI server does not support named sets. The entire body of content offered by the server will be harvested.\n+harvestclients.newClientDialog.oaiSets.listTruncated=Please note that the remote server was taking too long to return the full list of available OAI sets, so the list was truncated! Please select a set from the current list (or select the \"no set\" option), and try again later if you need to change it. ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5b6b75c463c03489b4ed339b01548951eb2f5a05"}, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "641c73fd68a7f294a37c541fec12a6d3f4dacc69", "author": {"user": {"login": "landreev", "name": null}}, "url": "https://github.com/IQSS/dataverse/commit/641c73fd68a7f294a37c541fec12a6d3f4dacc69", "committedDate": "2020-02-27T17:30:50Z", "message": "couple of cosmetic/punctuation changes to the messages in the bundle. (#4964)"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 932, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}