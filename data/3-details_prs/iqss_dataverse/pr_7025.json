{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQwNTc4MjM2", "number": 7025, "title": "Public ORCID login is available.", "bodyText": "What this PR does / why we need it: This change will make it possible to use orcid public api for orcid authentication. Using member api is still possible, the chosen method depends on the userEndpoint parameter provided in the uploaded json. This feature is also mentioned in #6329.\nWhich issue(s) this PR closes: none\nSpecial notes for your reviewer: none\nSuggestions on how to test this: Use the new orcid-public.json with your ORCID public api credentials to create a new login option. Using the new option you should be able to log in to Dataverse using your ORCID credentials.\nDoes this PR introduce a user interface change? If mockups are available, please link/include them here: no\nIs there a release notes update needed for this change?: This should be included in the release notes as a new feature.\nAdditional documentation: none", "createdAt": "2020-06-26T13:12:07Z", "url": "https://github.com/IQSS/dataverse/pull/7025", "merged": true, "mergeCommit": {"oid": "f5104d1fa8539f7deee2a3ed126a4f0298be958f"}, "closed": true, "closedAt": "2020-07-20T21:52:19Z", "author": {"login": "felker13"}, "timelineItems": {"totalCount": 14, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcvCoiwgH2gAyNDQwNTc4MjM2OmMxMGI1MTZkNGI3N2Y4MTY5ZTM1ZjFkMjdkOGY5NWI3ZTg5MzViMzU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABczg_-0AH2gAyNDQwNTc4MjM2OjI5OGJmYWI3OWZkNDIwMTgzOGZkYTg3YjA3Y2YyMzNlNGI1N2I4YzY=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "c10b516d4b77f8169e35f1d27d8f95b7e8935b35", "author": {"user": {"login": "felker13", "name": null}}, "url": "https://github.com/IQSS/dataverse/commit/c10b516d4b77f8169e35f1d27d8f95b7e8935b35", "committedDate": "2020-06-26T12:44:37Z", "message": "Public ORCID login is available."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM4MzQ5OTMz", "url": "https://github.com/IQSS/dataverse/pull/7025#pullrequestreview-438349933", "createdAt": "2020-06-26T14:37:18Z", "commit": {"oid": "c10b516d4b77f8169e35f1d27d8f95b7e8935b35"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "55c2c8918c384404c1dec008d6c60d03e71897de", "author": {"user": {"login": "felker13", "name": null}}, "url": "https://github.com/IQSS/dataverse/commit/55c2c8918c384404c1dec008d6c60d03e71897de", "committedDate": "2020-06-29T08:33:08Z", "message": "Fix for NPE in test."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8da201b42a5e61e15a8835b2b5d82c6f06c27fbc", "author": {"user": {"login": "felker13", "name": null}}, "url": "https://github.com/IQSS/dataverse/commit/8da201b42a5e61e15a8835b2b5d82c6f06c27fbc", "committedDate": "2020-06-29T09:10:21Z", "message": "Oauth documentation is extended with ORCID public API option."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9d7c843e4c9b667d0c51a19796af319b9e37d4ac", "author": {"user": {"login": "pdurbin", "name": "Philip Durbin"}}, "url": "https://github.com/IQSS/dataverse/commit/9d7c843e4c9b667d0c51a19796af319b9e37d4ac", "committedDate": "2020-06-29T15:10:43Z", "message": "remove cost, link to ORCID APIs public, member #7025"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0bcd8711d07e82df96f5ca692ce7de463bd139de", "author": {"user": {"login": "felker13", "name": null}}, "url": "https://github.com/IQSS/dataverse/commit/0bcd8711d07e82df96f5ca692ce7de463bd139de", "committedDate": "2020-06-30T07:34:18Z", "message": "Merge pull request #1 from IQSS/7025-orcid-docs\n\nremove cost, link to ORCID APIs public, member #7025"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQwMDgzNzU0", "url": "https://github.com/IQSS/dataverse/pull/7025#pullrequestreview-440083754", "createdAt": "2020-06-30T14:38:28Z", "commit": {"oid": "0bcd8711d07e82df96f5ca692ce7de463bd139de"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQxMTg4Mzky", "url": "https://github.com/IQSS/dataverse/pull/7025#pullrequestreview-441188392", "createdAt": "2020-07-01T20:51:31Z", "commit": {"oid": "0bcd8711d07e82df96f5ca692ce7de463bd139de"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMVQyMDo1MTozMVrOGr09Xg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMVQyMTowNzozMVrOGr1Yyg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODYwOTYzMA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            - ORCID: https://orcid.org/content/register-client-application-0\n          \n          \n            \n            - ORCID: https://orcid.org/content/register-client-application", "url": "https://github.com/IQSS/dataverse/pull/7025#discussion_r448609630", "createdAt": "2020-07-01T20:51:31Z", "author": {"login": "poikilotherm"}, "path": "doc/sphinx-guides/source/installation/oauth2.rst", "diffHunk": "@@ -26,11 +26,11 @@ Identity Provider Side\n Obtain Client ID and Client Secret \n ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n \n-Before OAuth providers will release information about their users (first name, last name, etc.) to your Dataverse installation, you must request a \"Client ID\" and \"Client Secret\" from them. In the case of GitHub and Google, this is as simple as clicking a few buttons and there is no cost associated with using their authentication service. ORCID and Microsoft, on the other hand, do not have an automated system for requesting these credentials, and it is not free to use these authentication services.\n+Before OAuth providers will release information about their users (first name, last name, etc.) to your Dataverse installation, you must request a \"Client ID\" and \"Client Secret\" from them. In many cases you can use providers' automated system to request these credentials, but if not, contact the provider for assistance.\n \n URLs to help you request a Client ID and Client Secret from the providers supported by Dataverse are provided below.  For all of these providers, it's a good idea to request the Client ID and Client secret using a generic account, perhaps the one that's associated with the ``:SystemEmail`` you've configured for Dataverse, rather than your own personal Microsoft Azure AD, ORCID, GitHub, or Google account:\n \n-- ORCID: https://orcid.org/content/register-client-application-production-trusted-party\n+- ORCID: https://orcid.org/content/register-client-application-0", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0bcd8711d07e82df96f5ca692ce7de463bd139de"}, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODYxNjY1MA==", "bodyText": "One could argue that this can be done more compact with only one if and without an extra variable allocation.\nE. g. like\nif(userEndpoint != null && userEndpoint.startsWith(\"https://pub\")) {\n    this.scope = Arrays.asList(\"/authenticate\");\n} else {\n    this.scope = Arrays.asList(\"/read-limited\");\n}\nOr you leave it to the code optimizer of the JVM... \ud83d\ude09", "url": "https://github.com/IQSS/dataverse/pull/7025#discussion_r448616650", "createdAt": "2020-07-01T21:07:31Z", "author": {"login": "poikilotherm"}, "path": "src/main/java/edu/harvard/iq/dataverse/authorization/providers/oauth2/impl/OrcidOAuth2AP.java", "diffHunk": "@@ -55,7 +55,12 @@\n     public static final String PROVIDER_ID_SANDBOX = \"orcid-sandbox\";\n     \n     public OrcidOAuth2AP(String clientId, String clientSecret, String userEndpoint) {\n-        scope = Arrays.asList(\"/read-limited\");\n+\n+        String s = null;\n+        if(userEndpoint != null){\n+            s = userEndpoint.startsWith(\"https://pub\") ? \"/authenticate\" : \"/read-limited\";\n+        }\n+        scope = Arrays.asList(s);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0bcd8711d07e82df96f5ca692ce7de463bd139de"}, "originalPosition": 10}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ0MDIzMDE0", "url": "https://github.com/IQSS/dataverse/pull/7025#pullrequestreview-444023014", "createdAt": "2020-07-07T15:47:57Z", "commit": {"oid": "0bcd8711d07e82df96f5ca692ce7de463bd139de"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "80630675213d65ecb73d0bac88f3cb076013e916", "author": {"user": {"login": "poikilotherm", "name": "Oliver Bertuch"}}, "url": "https://github.com/IQSS/dataverse/commit/80630675213d65ecb73d0bac88f3cb076013e916", "committedDate": "2020-07-08T09:33:21Z", "message": "Merge branch 'develop' into orcid-public-api"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5a98e64d54b6afce65085ee27fe3de8e4446246f", "author": {"user": {"login": "poikilotherm", "name": "Oliver Bertuch"}}, "url": "https://github.com/IQSS/dataverse/commit/5a98e64d54b6afce65085ee27fe3de8e4446246f", "committedDate": "2020-07-08T09:33:46Z", "message": "Refactor userEndpoint checks for Public ORCID scope. #7025"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9475838583c127584ca81a49643a4a3d16910bf8", "author": {"user": {"login": "poikilotherm", "name": "Oliver Bertuch"}}, "url": "https://github.com/IQSS/dataverse/commit/9475838583c127584ca81a49643a4a3d16910bf8", "committedDate": "2020-07-08T09:33:52Z", "message": "Convert ORCID OAuth2 provider test from JUnit4 to JUnit5. #7025"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d588210a497503ed0a715be04bef677bcb960f47", "author": {"user": {"login": "poikilotherm", "name": "Oliver Bertuch"}}, "url": "https://github.com/IQSS/dataverse/commit/d588210a497503ed0a715be04bef677bcb960f47", "committedDate": "2020-07-08T09:33:59Z", "message": "Add test case for public ORCID API endpoint to result in scope /authenticate. #7025"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "298bfab79fd4201838fda87b07cf233e4b57b8c6", "author": {"user": {"login": "felker13", "name": null}}, "url": "https://github.com/IQSS/dataverse/commit/298bfab79fd4201838fda87b07cf233e4b57b8c6", "committedDate": "2020-07-10T10:23:04Z", "message": "Merge pull request #2 from poikilotherm/7025-orcid-public\n\n7025 orcid public"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 867, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}