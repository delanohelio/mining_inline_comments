{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDU1NDM0NzA3", "number": 1543, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yM1QwMjoxNToyNFrOERR-6Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yM1QwMjoxNToyNFrOERR-6Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg2NTU1ODgxOnYy", "diffSide": "RIGHT", "path": "server/src/main/java/org/apache/iotdb/db/conf/IoTDBConfigCheck.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yM1QwMjoxNToyNFrOG16M-A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yM1QwMjoxNToyNFrOG16M-A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTE4MTMwNA==", "bodyText": "It suddenly occurs to me that mlog is a system file but FSFactoryProducer.getFSFactory() is for data files (like tsfile)... This may result in the problem that when upgrading 0.9 version tsfiles, HDFS cannot find mlog because it is actually stored in local.\nSorry I forgot and ignored it in the PR #1540 yesterday... \ud83d\ude23\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                  FSFactoryProducer.getFSFactory().moveFile(tmpMLogFile, mlogFile);\n          \n          \n            \n                  FileUtils.moveFile(tmpMLogFile, mlogFile);", "url": "https://github.com/apache/iotdb/pull/1543#discussion_r459181304", "createdAt": "2020-07-23T02:15:24Z", "author": {"login": "samperson1997"}, "path": "server/src/main/java/org/apache/iotdb/db/conf/IoTDBConfigCheck.java", "diffHunk": "@@ -191,6 +191,18 @@ public void checkConfig() throws IOException {\n       checkUnClosedTsFileV1();\n       MLogWriter.upgradeMLog(SCHEMA_DIR, MetadataConstant.METADATA_LOG);\n       upgradePropertiesFile();\n+\n+      // upgrade mlog finished, delete old mlog file\n+      File mlogFile = SystemFileFactory.INSTANCE.getFile(SCHEMA_DIR + File.separator\n+          + MetadataConstant.METADATA_LOG);\n+      File tmpMLogFile = SystemFileFactory.INSTANCE.getFile(mlogFile.getAbsolutePath()\n+          + \".tmp\");\n+\n+      if (!mlogFile.delete()) {\n+        throw new IOException(\"Deleting \" + mlogFile + \"failed.\");\n+      }\n+      // rename tmpLogFile to mlog\n+      FSFactoryProducer.getFSFactory().moveFile(tmpMLogFile, mlogFile);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "46115d079e07edbd9927078b289e1dae08ab2ad0"}, "originalPosition": 15}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4754, "cost": 1, "resetAt": "2021-11-12T11:18:39Z"}}}