{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM3ODA4NjA5", "number": 1406, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yOFQwNTo1NTo0MVrOEJaZpg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yOFQwNTo1NTo0MVrOEJaZpg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc4MzA1MTkwOnYy", "diffSide": "RIGHT", "path": "docs/zh/SystemDesign/DataQuery/AlignByDeviceQuery.md", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yOFQwNTo1NTo0MVrOGp6loQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yOFQwNTo1NTo0MVrOGp6loQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjYwNDcwNQ==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                // \u7528\u4e8e\u8bb0\u5f55\u67d0\u4e00\u540e\u7f00\u8def\u5f84\u5bf9\u5e94\u7684 measurement\uff0c\u793a\u4f8b\u89c1\u4e0b\u6587\n          \n          \n            \n                // \u7528\u4e8e\u8bb0\u5f55\u6b64\u540e\u7f00\u8def\u5f84\u5bf9\u5e94\u7684\u6240\u6709 measurement\uff0c\u793a\u4f8b\u89c1\u4e0b\u6587", "url": "https://github.com/apache/iotdb/pull/1406#discussion_r446604705", "createdAt": "2020-06-28T05:55:41Z", "author": {"login": "qiaojialin"}, "path": "docs/zh/SystemDesign/DataQuery/AlignByDeviceQuery.md", "diffHunk": "@@ -74,20 +78,85 @@ SELECT s1, \"1\", *, s2, s5 FROM root.sg.d1, root.sg.* WHERE time = 1 AND s1 < 25\n \n **\u8be5\u9636\u6bb5\u6240\u505a\u7684\u4e3b\u8981\u5de5\u4f5c\u4e3a\u751f\u6210\u67e5\u8be2\u5bf9\u5e94\u7684** `AlignByDevicePlan`\uff0c**\u586b\u5145\u5176\u4e2d\u7684\u53d8\u91cf\u4fe1\u606f\u3002**\n \n-\u9996\u5148\u89e3\u91ca\u4e00\u4e0b `transformQuery()` \u65b9\u6cd5\u4e2d\u4e00\u4e9b\u91cd\u8981\u5b57\u6bb5\u7684\u542b\u4e49(\u4e0e AlignByDevicePlan \u4e2d\u91cd\u590d\u7684\u5b57\u6bb5\u89c1\u4e0a\u6587)\uff1a\n-\n-- prefixPaths, suffixPaths\uff1a\u524d\u8005\u4e3a FROM \u5b50\u53e5\u4e2d\u7684\u524d\u7f00\u8def\u5f84\uff0c\u793a\u4f8b\u4e2d\u4e3a `[root.sg.d1, root.sg.*]`; \u540e\u8005\u4e3a SELECT \u5b50\u53e5\u4e2d\u7684\u540e\u7f00\u8def\u5f84\uff0c\u793a\u4f8b\u4e2d\u4e3a `[s1, \"1\", *, s2, s5]`.\n-- devices\uff1a\u5bf9\u524d\u7f00\u8def\u5f84\u53bb\u901a\u914d\u7b26\u548c\u8bbe\u5907\u53bb\u91cd\u540e\u5f97\u5230\u7684\u8bbe\u5907\u5217\u8868\uff0c\u793a\u4f8b\u4e2d\u4e3a `[root.sg.d1, root.sg.d2]`\u3002\n-- measurementSetOfGivenSuffix\uff1a\u4e2d\u95f4\u53d8\u91cf\uff0c\u8bb0\u5f55\u67d0\u4e00 suffix \u5bf9\u5e94\u7684 measurement\uff0c\u793a\u4f8b\u4e2d\uff0c\u5bf9\u4e8e\u540e\u7f00 \\*, `measurementSetOfGivenSuffix = {s1,s2}`\uff0c\u5bf9\u4e8e\u540e\u7f00 s1, `measurementSetOfGivenSuffix = {s1}`;\n-\n-\u63a5\u4e0b\u6765\u4ecb\u7ecd AlignByDevicePlan \u7684\u8ba1\u7b97\u8fc7\u7a0b\uff1a\n+\u5176\u4e3b\u8981\u5c06 SELECT \u8bed\u53e5\u4e2d\u5f97\u5230\u7684\u540e\u7f00\u8def\u5f84\u4e0e FROM \u5b50\u53e5\u4e2d\u7684\u524d\u7f00\u8def\u5f84\u8fdb\u884c\u62fc\u63a5\uff0c\u4ece\u800c\u8ba1\u7b97\u51fa\u67e5\u8be2\u7684 Measurement \u53ca\u5176\u7c7b\u578b\u3001\u6570\u636e\u7c7b\u578b\uff0c\u8ba1\u7b97\u6d41\u7a0b\u5982\u4e0b\uff1a\n \n-1. \u68c0\u67e5\u67e5\u8be2\u7c7b\u578b\u662f\u5426\u4e3a groupByTimePlan, fillQueryPlan, aggregationPlan \u8fd9\u4e09\u7c7b\u67e5\u8be2\u4e2d\u7684\u4e00\u79cd\uff0c\u5982\u679c\u662f\u5219\u5bf9\u76f8\u5e94\u7684\u53d8\u91cf\u8fdb\u884c\u8d4b\u503c\uff0c\u5e76\u66f4\u6539 `AlignByDevicePlan` \u7684\u67e5\u8be2\u7c7b\u578b\u3002\n-2. \u904d\u5386 SELECT \u540e\u7f00\u8def\u5f84\uff0c\u5bf9\u6bcf\u4e00\u4e2a\u540e\u7f00\u8def\u5f84\u8bbe\u7f6e\u4e00\u4e2a\u4e2d\u95f4\u53d8\u91cf\u4e3a `measurementSetOfGivenSuffix`\uff0c\u7528\u6765\u8bb0\u5f55\u8be5\u540e\u7f00\u8def\u5f84\u5bf9\u5e94\u7684\u6240\u6709 measurement\u3002\u5982\u679c\u540e\u7f00\u8def\u5f84\u4ee5\u5355\u5f15\u53f7\u6216\u53cc\u5f15\u53f7\u5f00\u5934\uff0c\u5219\u76f4\u63a5\u5728 `measurements` \u4e2d\u589e\u52a0\u8be5\u503c\uff0c\u5e76\u8bb0\u5f55\u5176\u7c7b\u578b\u4e3a `Constant` \u7c7b\u578b\u3002\n-3. \u5426\u5219\u5c06\u8bbe\u5907\u5217\u8868\u4e0e\u8be5\u540e\u7f00\u8def\u5f84\u62fc\u63a5\uff0c\u5f97\u5230\u5b8c\u6574\u7684\u8def\u5f84\uff0c\u5982\u679c\u62fc\u63a5\u540e\u7684\u8def\u5f84\u4e0d\u5b58\u5728\uff0c\u9700\u8981\u8fdb\u4e00\u6b65\u5224\u65ad\u8be5 measurement \u662f\u5426\u5728\u5176\u5b83\u8bbe\u5907\u4e2d\u5b58\u5728\uff0c\u5982\u679c\u90fd\u6ca1\u6709\u5219\u6682\u65f6\u8bc6\u522b\u4e3a `NonExist`\uff0c\u5982\u679c\u540e\u7eed\u51fa\u73b0\u8bbe\u5907\u5b58\u5728\u8be5 measurement\uff0c\u5219\u8986\u76d6 `NonExist` \u503c\u4e3a `Exist`\u3002\n-4. \u5982\u679c\u62fc\u63a5\u540e\u8def\u5f84\u5b58\u5728\uff0c\u5219\u8bc1\u660e measurement \u662f `Exist` \u7c7b\u578b\uff0c\u9700\u8981\u68c0\u9a8c\u6570\u636e\u7c7b\u578b\u7684\u4e00\u81f4\u6027\uff0c\u4e0d\u6ee1\u8db3\u8fd4\u56de\u9519\u8bef\u4fe1\u606f\uff0c\u6ee1\u8db3\u5219\u8bb0\u5f55\u4e0b\u8be5 Measurement\uff0c\u5bf9 `measurementSetOfGivenSuffix` \u7b49\u8fdb\u884c\u66f4\u65b0\u3002\n-5. \u5728\u4e00\u5c42 suffix \u5faa\u73af\u7ed3\u675f\u540e\uff0c\u5c06\u8be5\u5c42\u5faa\u73af\u4e2d\u51fa\u73b0\u7684 `measurementSetOfGivenSuffix` \u52a0\u5165 `measurements` \u4e2d\u3002\u5728\u6574\u4e2a\u5faa\u73af\u7ed3\u675f\u540e\uff0c\u5c06\u5faa\u73af\u4e2d\u5f97\u5230\u7684\u53d8\u91cf\u4fe1\u606f\u8d4b\u503c\u5230 AlignByDevicePlan \u4e2d\u3002\u6b64\u5904\u5f97\u5230\u7684 measurements \u5217\u8868\u662f\u672a\u7ecf\u8fc7\u53bb\u91cd\u7684\uff0c\u5728\u751f\u6210 `ColumnHeader` \u65f6\u5c06\u8fdb\u884c\u53bb\u91cd\u3002\n-6. \u6700\u540e\u8c03\u7528 `concatFilterByDevice()` \u65b9\u6cd5\u8ba1\u7b97 `deviceToFilterMap`\uff0c\u5f97\u5230\u5c06\u6bcf\u4e2a\u8bbe\u5907\u5206\u522b\u62fc\u63a5\u540e\u5bf9\u5e94\u7684 Filter \u4fe1\u606f\u3002\n+```java\n+  // \u9996\u5148\u904d\u5386\u540e\u7f00\u8def\u5f84\n+  for (int i = 0; i < suffixPaths.size(); i++) {\n+    Path suffixPath = suffixPaths.get(i);\n+    // \u7528\u4e8e\u8bb0\u5f55\u67d0\u4e00\u540e\u7f00\u8def\u5f84\u5bf9\u5e94\u7684 measurement\uff0c\u793a\u4f8b\u89c1\u4e0b\u6587", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "139b0eb3afad1f9d6b2079586b9c83ad7a2f9efe"}, "originalPosition": 54}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4819, "cost": 1, "resetAt": "2021-11-12T11:18:39Z"}}}