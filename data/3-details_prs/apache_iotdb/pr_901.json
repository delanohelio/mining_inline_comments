{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg2NTgxNjI2", "number": 901, "title": "Cheery pick changes from cluster_new", "bodyText": "To avoid further conflicts with the master branch, I would like to merge the following changes into master:\n\ngetAllClosedStorageGroupTsFile is now grouped by partition\nfix empty AggregationResult is not correctly serialized\nfix two empty AvgAggrResults merge to a wrong result\nfix reset in First/LastValue\nchange member protection levels\nextract GroupByExecutor and LocalGroupByExecutor\nextract getters of readers and datasets\nextract fill initialization", "createdAt": "2020-03-11T09:43:40Z", "url": "https://github.com/apache/iotdb/pull/901", "merged": true, "mergeCommit": {"oid": "40ae1e9fa1f50056bf51c61c2ffef38e8ad80253"}, "closed": true, "closedAt": "2020-03-13T12:01:37Z", "author": {"login": "jt2594838"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcMj3qdgH2gAyMzg2NTgxNjI2OjBhNDVjMTljOGYwN2NhODAxNGVmN2Q3YzRhMzdmZDk5NTZiMWRlMzI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcNM5eOAH2gAyMzg2NTgxNjI2OjIxNTE5N2VhY2I2NDk1ZjU2OGI3ZDgzZjE4YzQ2M2Q4OGZhMTVkMDE=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "0a45c19c8f07ca8014ef7d7c4a37fd9956b1de32", "author": {"user": {"login": "jt2594838", "name": "Jiang Tian"}}, "url": "https://github.com/apache/iotdb/commit/0a45c19c8f07ca8014ef7d7c4a37fd9956b1de32", "committedDate": "2020-03-11T09:40:39Z", "message": "cheery pick changes from cluster_new:\n1. getAllClosedStorageGroupTsFile is now grouped by partition\n2. fix empty AggregationResult is not correctly serialized\n3. fix two empty AvgAggrResult merge to a wrong result\n4. fix reset in First/LastValue\n5. change member protection levels\n6. extract GroupByExecutor and LocalGroupByExecutor\n7. extract getters of readers and datasets\n8. extract fill initialization"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "24540ddf39dbaf4bba2a8c7354c4955a296029fe", "author": {"user": {"login": "jt2594838", "name": "Jiang Tian"}}, "url": "https://github.com/apache/iotdb/commit/24540ddf39dbaf4bba2a8c7354c4955a296029fe", "committedDate": "2020-03-12T03:34:35Z", "message": "fix license"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "596e1c1855a0bdf505cee9fd3cd7edc7a2ebba92", "author": {"user": {"login": "qiaojialin", "name": "Jialin Qiao"}}, "url": "https://github.com/apache/iotdb/commit/596e1c1855a0bdf505cee9fd3cd7edc7a2ebba92", "committedDate": "2020-03-13T08:15:29Z", "message": "simplify GroupByExecutor"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc0MDg0Mjk4", "url": "https://github.com/apache/iotdb/pull/901#pullrequestreview-374084298", "createdAt": "2020-03-13T07:03:49Z", "commit": {"oid": "24540ddf39dbaf4bba2a8c7354c4955a296029fe"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xM1QwNzowMzo1MFrOF15a5w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xM1QwNzowODowMlrOF15ffQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjA1OTYyMw==", "bodyText": "The partition number is an Integer or Long?", "url": "https://github.com/apache/iotdb/pull/901#discussion_r392059623", "createdAt": "2020-03-13T07:03:50Z", "author": {"login": "qiaojialin"}, "path": "server/src/main/java/org/apache/iotdb/db/engine/StorageEngine.java", "diffHunk": "@@ -529,15 +529,23 @@ private String getSgByEngineFile(File file) {\n \n   /**\n    *\n-   * @return TsFiles (seq or unseq) grouped by their storage group.\n+   * @return TsFiles (seq or unseq) grouped by their storage group and partition number.\n    */\n-  public Map<String, List<TsFileResource>> getAllClosedStorageGroupTsFile() {\n-    Map<String, List<TsFileResource>> ret = new HashMap<>();\n+  public Map<String, Map<Integer, List<TsFileResource>>> getAllClosedStorageGroupTsFile() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "24540ddf39dbaf4bba2a8c7354c4955a296029fe"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjA1OTc1Ng==", "bodyText": "only get sequence file?", "url": "https://github.com/apache/iotdb/pull/901#discussion_r392059756", "createdAt": "2020-03-13T07:04:18Z", "author": {"login": "qiaojialin"}, "path": "server/src/main/java/org/apache/iotdb/db/engine/StorageEngine.java", "diffHunk": "@@ -529,15 +529,23 @@ private String getSgByEngineFile(File file) {\n \n   /**\n    *\n-   * @return TsFiles (seq or unseq) grouped by their storage group.\n+   * @return TsFiles (seq or unseq) grouped by their storage group and partition number.\n    */\n-  public Map<String, List<TsFileResource>> getAllClosedStorageGroupTsFile() {\n-    Map<String, List<TsFileResource>> ret = new HashMap<>();\n+  public Map<String, Map<Integer, List<TsFileResource>>> getAllClosedStorageGroupTsFile() {\n+    Map<String, Map<Integer, List<TsFileResource>>> ret = new HashMap<>();\n     for (Entry<String, StorageGroupProcessor> entry : processorMap\n         .entrySet()) {\n-      ret.computeIfAbsent(entry.getKey(), sg -> new ArrayList<>()).addAll(entry.getValue().getSequenceFileTreeSet());\n-      ret.get(entry.getKey()).addAll(entry.getValue().getUnSequenceFileList());\n-      ret.get(entry.getKey()).removeIf(file -> !file.isClosed());\n+      List<TsFileResource> sequenceFiles = entry.getValue().getSequenceFileTreeSet();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "24540ddf39dbaf4bba2a8c7354c4955a296029fe"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjA2MDc5Nw==", "bodyText": "part?", "url": "https://github.com/apache/iotdb/pull/901#discussion_r392060797", "createdAt": "2020-03-13T07:08:02Z", "author": {"login": "qiaojialin"}, "path": "server/src/main/java/org/apache/iotdb/db/metadata/MManager.java", "diffHunk": "@@ -885,7 +885,7 @@ public void collectSeries(String startingPath, List<MeasurementSchema> timeserie\n    * and the wildcard will be removed.\n    * If the wildcard is at the tail, then the inference will go on until the storage groups are found\n    * and the wildcard will be kept.\n-   * (2) Suppose the part of the path is a substring that begin after the storage group name. (e.g.,\n+   * (2) Suppose the path of the path is a substring that begin after the storage group name. (e.g.,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "24540ddf39dbaf4bba2a8c7354c4955a296029fe"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "acd5fee1467a982da1bccbf95194c6d49aebf1db", "author": {"user": {"login": "qiaojialin", "name": "Jialin Qiao"}}, "url": "https://github.com/apache/iotdb/commit/acd5fee1467a982da1bccbf95194c6d49aebf1db", "committedDate": "2020-03-13T08:37:32Z", "message": "fix sonar and getAllResource"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9544f2a7b534afc01497605e44828b96afdce381", "author": {"user": {"login": "qiaojialin", "name": "Jialin Qiao"}}, "url": "https://github.com/apache/iotdb/commit/9544f2a7b534afc01497605e44828b96afdce381", "committedDate": "2020-03-13T08:45:36Z", "message": "fix last getDeviceNode"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ed1ac34c55302ee89e34cc49f4e812a430fd8223", "author": {"user": {"login": "jt2594838", "name": "Jiang Tian"}}, "url": "https://github.com/apache/iotdb/commit/ed1ac34c55302ee89e34cc49f4e812a430fd8223", "committedDate": "2020-03-13T09:27:27Z", "message": "extract get series type in TSServiceImpl"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "215197eacb6495f568b7d83f18c463d88fa15d01", "author": {"user": {"login": "jt2594838", "name": "Jiang Tian"}}, "url": "https://github.com/apache/iotdb/commit/215197eacb6495f568b7d83f18c463d88fa15d01", "committedDate": "2020-03-13T09:28:44Z", "message": "Merge branch 'master' into cherry_pick_cluster_2"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3181, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}