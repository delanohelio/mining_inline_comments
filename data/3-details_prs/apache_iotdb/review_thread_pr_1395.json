{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM3MzkzMjMy", "number": 1395, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMFQxNDo1MTo0MFrOEHTQ9w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMFQxNDo1MzoxM1rOEHTRUA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc2MDkxMTI3OnYy", "diffSide": "RIGHT", "path": "server/src/main/java/org/apache/iotdb/db/qp/executor/PlanExecutor.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMFQxNDo1MTo0MFrOGmm6xQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMFQxNDo1MTo0MFrOGmm6xQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzEzNjcwOQ==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        logger.error(\"not enable\");\n          \n          \n            \n                        logger.warn(\"insertion is interrupted because of not enable partial insertion\");", "url": "https://github.com/apache/iotdb/pull/1395#discussion_r443136709", "createdAt": "2020-06-20T14:51:40Z", "author": {"login": "qiaojialin"}, "path": "server/src/main/java/org/apache/iotdb/db/qp/executor/PlanExecutor.java", "diffHunk": "@@ -1122,17 +1122,28 @@ public void insertTablet(InsertTabletPlan insertTabletPlan) throws QueryProcessE\n \n         // check data type\n         if (measurementNode.getSchema().getType() != insertTabletPlan.getDataTypes()[i]) {\n-          throw new QueryProcessException(String.format(\n+          if (!enablePartialInsert) {\n+            logger.error(\"not enable\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9bad981dc4fb0e05f568d9a4fa5d73689decc8a6"}, "originalPosition": 6}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc2MDkxMTkwOnYy", "diffSide": "RIGHT", "path": "server/src/main/java/org/apache/iotdb/db/qp/executor/PlanExecutor.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMFQxNDo1Mjo1MlrOGmm7Dw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMFQxNDo1Mjo1MlrOGmm7Dw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzEzNjc4Mw==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        logger.error(\"failed {}\", i);\n          \n          \n            \n                        logger.warn(\"the {}-th measurement {} failed\", i, measurement);", "url": "https://github.com/apache/iotdb/pull/1395#discussion_r443136783", "createdAt": "2020-06-20T14:52:52Z", "author": {"login": "qiaojialin"}, "path": "server/src/main/java/org/apache/iotdb/db/qp/executor/PlanExecutor.java", "diffHunk": "@@ -1122,17 +1122,28 @@ public void insertTablet(InsertTabletPlan insertTabletPlan) throws QueryProcessE\n \n         // check data type\n         if (measurementNode.getSchema().getType() != insertTabletPlan.getDataTypes()[i]) {\n-          throw new QueryProcessException(String.format(\n+          if (!enablePartialInsert) {\n+            logger.error(\"not enable\");\n+            throw new QueryProcessException(String.format(\n               \"Datatype mismatch, Insert measurement %s type %s, metadata tree type %s\",\n               measurement, insertTabletPlan.getDataTypes()[i],\n               measurementNode.getSchema().getType()));\n+          } else {\n+            logger.error(\"failed {}\", i);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9bad981dc4fb0e05f568d9a4fa5d73689decc8a6"}, "originalPosition": 12}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc2MDkxMjE2OnYy", "diffSide": "RIGHT", "path": "server/src/main/java/org/apache/iotdb/db/qp/executor/PlanExecutor.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMFQxNDo1MzoxNFrOGmm7LQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMFQxNDo1MzoxNFrOGmm7LQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzEzNjgxMw==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                      \"failed to insert points \" + insertTabletPlan.getFailedMeasurements());\n          \n          \n            \n                      \"failed to insert measurements \" + insertTabletPlan.getFailedMeasurements());", "url": "https://github.com/apache/iotdb/pull/1395#discussion_r443136813", "createdAt": "2020-06-20T14:53:14Z", "author": {"login": "qiaojialin"}, "path": "server/src/main/java/org/apache/iotdb/db/qp/executor/PlanExecutor.java", "diffHunk": "@@ -1122,17 +1122,28 @@ public void insertTablet(InsertTabletPlan insertTabletPlan) throws QueryProcessE\n \n         // check data type\n         if (measurementNode.getSchema().getType() != insertTabletPlan.getDataTypes()[i]) {\n-          throw new QueryProcessException(String.format(\n+          if (!enablePartialInsert) {\n+            logger.error(\"not enable\");\n+            throw new QueryProcessException(String.format(\n               \"Datatype mismatch, Insert measurement %s type %s, metadata tree type %s\",\n               measurement, insertTabletPlan.getDataTypes()[i],\n               measurementNode.getSchema().getType()));\n+          } else {\n+            logger.error(\"failed {}\", i);\n+            insertTabletPlan.markMeasurementInsertionFailed(i);\n+            continue;\n+          }\n         }\n         schemas[i] = measurementNode.getSchema();\n         // reset measurement to common name instead of alias\n         measurementList[i] = measurementNode.getName();\n       }\n       insertTabletPlan.setSchemas(schemas);\n       StorageEngine.getInstance().insertTablet(insertTabletPlan);\n+      if (insertTabletPlan.getFailedMeasurements() != null) {\n+        throw new StorageEngineException(\n+          \"failed to insert points \" + insertTabletPlan.getFailedMeasurements());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9bad981dc4fb0e05f568d9a4fa5d73689decc8a6"}, "originalPosition": 25}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4799, "cost": 1, "resetAt": "2021-11-12T11:18:39Z"}}}