{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDc2NzkyMDU3", "number": 1665, "title": "IOTDB-851: enhance failure tolerance when recover WAL", "bodyText": "WAL will skip error series instead of all series in the device", "createdAt": "2020-09-01T04:02:01Z", "url": "https://github.com/apache/iotdb/pull/1665", "merged": true, "mergeCommit": {"oid": "d71da597e983fc9e5856c41c8b6d09ae3ca4ffe6"}, "closed": true, "closedAt": "2020-09-07T04:56:15Z", "author": {"login": "haimeiguo"}, "timelineItems": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdEfKvJgH2gAyNDc2NzkyMDU3OmFmNTUxMTcxMGUxZTg4MGViNGFjYjhkYzJiNzY0NWU3NWM2MTE5YWM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdF4BjNAFqTQ4MzA0OTE2Mg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "af5511710e1e880eb4acb8dc2b7645e75c6119ac", "author": {"user": {"login": "haimeiguo", "name": "Haimei Guo"}}, "url": "https://github.com/apache/iotdb/commit/af5511710e1e880eb4acb8dc2b7645e75c6119ac", "committedDate": "2020-09-01T03:51:43Z", "message": "WAL will skip error series instead of all series in the device"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2a4542234b8da3577ad613733b12e6eb611cbee7", "author": {"user": {"login": "haimeiguo", "name": "Haimei Guo"}}, "url": "https://github.com/apache/iotdb/commit/2a4542234b8da3577ad613733b12e6eb611cbee7", "committedDate": "2020-09-01T04:01:03Z", "message": "edit unit test"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc5NDMxNTk3", "url": "https://github.com/apache/iotdb/pull/1665#pullrequestreview-479431597", "createdAt": "2020-09-01T06:23:26Z", "commit": {"oid": "2a4542234b8da3577ad613733b12e6eb611cbee7"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc5NDQ5MzQ5", "url": "https://github.com/apache/iotdb/pull/1665#pullrequestreview-479449349", "createdAt": "2020-09-01T06:56:40Z", "commit": {"oid": "2a4542234b8da3577ad613733b12e6eb611cbee7"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c818bd5bb9620d6d9797bbcc14640d6c3fcc7cfc", "author": {"user": {"login": "haimeiguo", "name": "Haimei Guo"}}, "url": "https://github.com/apache/iotdb/commit/c818bd5bb9620d6d9797bbcc14640d6c3fcc7cfc", "committedDate": "2020-09-02T07:09:14Z", "message": "recover wal for insert plan"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgwNTQ1MjI3", "url": "https://github.com/apache/iotdb/pull/1665#pullrequestreview-480545227", "createdAt": "2020-09-02T07:17:13Z", "commit": {"oid": "c818bd5bb9620d6d9797bbcc14640d6c3fcc7cfc"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMlQwNzoxNzoxM1rOHLgCMA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMlQwNzoxNzoxM1rOHLgCMA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTgyMTIzMg==", "bodyText": "add comment to explain the reason", "url": "https://github.com/apache/iotdb/pull/1665#discussion_r481821232", "createdAt": "2020-09-02T07:17:13Z", "author": {"login": "mychaow"}, "path": "server/src/main/java/org/apache/iotdb/db/writelog/recover/LogReplayer.java", "diffHunk": "@@ -164,11 +164,14 @@ private void replayInsert(InsertPlan plan) throws WriteProcessException, QueryPr\n     }\n     if (plan instanceof InsertRowPlan) {\n       InsertRowPlan tPlan = (InsertRowPlan) plan;\n+      ((InsertRowPlan) plan).setNeedInferType(false);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c818bd5bb9620d6d9797bbcc14640d6c3fcc7cfc"}, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "54ac7599ac481510cd1222a2ae2574ccb0bd9e01", "author": {"user": {"login": "haimeiguo", "name": "Haimei Guo"}}, "url": "https://github.com/apache/iotdb/commit/54ac7599ac481510cd1222a2ae2574ccb0bd9e01", "committedDate": "2020-09-02T07:45:29Z", "message": "add comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2d8e5b8cb3ba4bd0b39dabc684fdcb8628b09803", "author": {"user": {"login": "haimeiguo", "name": "Haimei Guo"}}, "url": "https://github.com/apache/iotdb/commit/2d8e5b8cb3ba4bd0b39dabc684fdcb8628b09803", "committedDate": "2020-09-02T07:48:45Z", "message": "edit comments"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgwNTgzMjc1", "url": "https://github.com/apache/iotdb/pull/1665#pullrequestreview-480583275", "createdAt": "2020-09-02T08:10:50Z", "commit": {"oid": "2d8e5b8cb3ba4bd0b39dabc684fdcb8628b09803"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgxNDkxNTk1", "url": "https://github.com/apache/iotdb/pull/1665#pullrequestreview-481491595", "createdAt": "2020-09-03T04:55:10Z", "commit": {"oid": "2d8e5b8cb3ba4bd0b39dabc684fdcb8628b09803"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgzMDM5MjMz", "url": "https://github.com/apache/iotdb/pull/1665#pullrequestreview-483039233", "createdAt": "2020-09-05T08:01:22Z", "commit": {"oid": "2d8e5b8cb3ba4bd0b39dabc684fdcb8628b09803"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wNVQwODowMToyMlrOHNgb-Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wNVQwODowMToyMlrOHNgb-Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzkyNDk4NQ==", "bodyText": "seems setSchemasAndTransferType  has marked the related data point failed already.", "url": "https://github.com/apache/iotdb/pull/1665#discussion_r483924985", "createdAt": "2020-09-05T08:01:22Z", "author": {"login": "jixuan1989"}, "path": "server/src/main/java/org/apache/iotdb/db/writelog/recover/LogReplayer.java", "diffHunk": "@@ -164,11 +164,17 @@ private void replayInsert(InsertPlan plan) throws WriteProcessException, QueryPr\n     }\n     if (plan instanceof InsertRowPlan) {\n       InsertRowPlan tPlan = (InsertRowPlan) plan;\n+      //only infer type when users pass a String value\n+      //WAL already serializes the real data type, so no need to infer type\n+      ((InsertRowPlan) plan).setNeedInferType(false);\n       tPlan.setSchemasAndTransferType(schemas);\n+      //mark failed plan manually \n+      checkDataTypeAndMarkFailed(schemas, tPlan);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2d8e5b8cb3ba4bd0b39dabc684fdcb8628b09803"}, "originalPosition": 9}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgzMDQ5MTYy", "url": "https://github.com/apache/iotdb/pull/1665#pullrequestreview-483049162", "createdAt": "2020-09-05T11:23:14Z", "commit": {"oid": "2d8e5b8cb3ba4bd0b39dabc684fdcb8628b09803"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3438, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}