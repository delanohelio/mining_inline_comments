{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY4NjEyNTg2", "number": 1627, "reviewThreads": {"totalCount": 19, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOVQxMToyNzozNFrOEZ7xng==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOFQxMTo0NzoyMVrOEdrr0A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk1NjI5MjE0OnYy", "diffSide": "RIGHT", "path": "server/src/main/java/org/apache/iotdb/db/metadata/PartialPath.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOVQxMToyNzozNFrOHDDB6Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMFQxMTozOTozMlrOHD85Gw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3Mjk1NzQxNw==", "bodyText": "getMeasurement()?", "url": "https://github.com/apache/iotdb/pull/1627#discussion_r472957417", "createdAt": "2020-08-19T11:27:34Z", "author": {"login": "qiaojialin"}, "path": "server/src/main/java/org/apache/iotdb/db/metadata/PartialPath.java", "diffHunk": "@@ -0,0 +1,173 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+package org.apache.iotdb.db.metadata;\n+\n+import java.util.Arrays;\n+import org.apache.iotdb.db.conf.IoTDBConstant;\n+import org.apache.iotdb.db.exception.metadata.IllegalPathException;\n+import org.apache.iotdb.tsfile.common.constant.TsFileConstant;\n+import org.apache.iotdb.tsfile.read.common.Path;\n+\n+/**\n+ * A prefix path, suffix path or fullPath generated from SQL\n+ */\n+public class PartialPath implements Comparable<PartialPath> {\n+\n+  private String[] nodes;\n+  private String path;\n+  private String pathWithoutLastNode;\n+  private String alias;\n+\n+  public PartialPath(String path) throws IllegalPathException {\n+    this.nodes = MetaUtils.splitPathToDetachedPath(path);\n+    this.path = path;\n+  }\n+\n+  public PartialPath(String[] partialNodes) {\n+    nodes = partialNodes;\n+  }\n+\n+  /**\n+   * it will return a new partial path\n+   * @param partialPath the path you want to concat\n+   * @return new partial path\n+   */\n+  public PartialPath concatPath(PartialPath partialPath) {\n+    int len = nodes.length;\n+    String[] newNodes = Arrays.copyOf(nodes, nodes.length + partialPath.nodes.length);\n+    System.arraycopy(partialPath.nodes, 0, newNodes, len, partialPath.nodes.length);\n+    return new PartialPath(newNodes);\n+  }\n+\n+  /**\n+   * It will change nodes in this partial path\n+   * @param otherNodes nodes\n+   */\n+  public void concatPath(String[] otherNodes) {\n+    int len = nodes.length;\n+    this.nodes = Arrays.copyOf(nodes, nodes.length + otherNodes.length);\n+    System.arraycopy(otherNodes, 0, nodes, len, otherNodes.length);\n+  }\n+\n+  public PartialPath concatNode(String node) {\n+    String[] newPathNodes = Arrays.copyOf(nodes, nodes.length + 1);\n+    newPathNodes[newPathNodes.length - 1] = node;\n+    return new PartialPath(newPathNodes);\n+  }\n+\n+  public String[] getNodes() {\n+    return nodes;\n+  }\n+\n+  public String toString() {\n+    if (path != null) {\n+      return path;\n+    } else {\n+      StringBuilder s = new StringBuilder(nodes[0]);\n+      for (int i = 1; i < nodes.length; i++) {\n+        s.append(TsFileConstant.PATH_SEPARATOR);\n+        s.append(nodes[i]);\n+      }\n+      path = s.toString();\n+      return path;\n+    }\n+  }\n+\n+  @Override\n+  public boolean equals(Object obj) {\n+    if(!(obj instanceof PartialPath)) {\n+      return false;\n+    }\n+    String[] otherNodes = ((PartialPath) obj).getNodes();\n+    if( this.nodes.length != otherNodes.length) {\n+      return false;\n+    } else {\n+      for(int i = 0; i < this.nodes.length; i++) {\n+        if(!nodes[i].equals(otherNodes[i])) {\n+          return false;\n+        }\n+      }\n+     }\n+    return true;\n+  }\n+\n+  @Override\n+  public int hashCode() {\n+    return this.toString().hashCode();\n+  }\n+\n+  public String getLastNode() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9b512a695178b66909b84ac605b368d27fb36ab8"}, "originalPosition": 115}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzkwNTQzNQ==", "bodyText": "fixed", "url": "https://github.com/apache/iotdb/pull/1627#discussion_r473905435", "createdAt": "2020-08-20T11:39:32Z", "author": {"login": "Genius-pig"}, "path": "server/src/main/java/org/apache/iotdb/db/metadata/PartialPath.java", "diffHunk": "@@ -0,0 +1,173 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+package org.apache.iotdb.db.metadata;\n+\n+import java.util.Arrays;\n+import org.apache.iotdb.db.conf.IoTDBConstant;\n+import org.apache.iotdb.db.exception.metadata.IllegalPathException;\n+import org.apache.iotdb.tsfile.common.constant.TsFileConstant;\n+import org.apache.iotdb.tsfile.read.common.Path;\n+\n+/**\n+ * A prefix path, suffix path or fullPath generated from SQL\n+ */\n+public class PartialPath implements Comparable<PartialPath> {\n+\n+  private String[] nodes;\n+  private String path;\n+  private String pathWithoutLastNode;\n+  private String alias;\n+\n+  public PartialPath(String path) throws IllegalPathException {\n+    this.nodes = MetaUtils.splitPathToDetachedPath(path);\n+    this.path = path;\n+  }\n+\n+  public PartialPath(String[] partialNodes) {\n+    nodes = partialNodes;\n+  }\n+\n+  /**\n+   * it will return a new partial path\n+   * @param partialPath the path you want to concat\n+   * @return new partial path\n+   */\n+  public PartialPath concatPath(PartialPath partialPath) {\n+    int len = nodes.length;\n+    String[] newNodes = Arrays.copyOf(nodes, nodes.length + partialPath.nodes.length);\n+    System.arraycopy(partialPath.nodes, 0, newNodes, len, partialPath.nodes.length);\n+    return new PartialPath(newNodes);\n+  }\n+\n+  /**\n+   * It will change nodes in this partial path\n+   * @param otherNodes nodes\n+   */\n+  public void concatPath(String[] otherNodes) {\n+    int len = nodes.length;\n+    this.nodes = Arrays.copyOf(nodes, nodes.length + otherNodes.length);\n+    System.arraycopy(otherNodes, 0, nodes, len, otherNodes.length);\n+  }\n+\n+  public PartialPath concatNode(String node) {\n+    String[] newPathNodes = Arrays.copyOf(nodes, nodes.length + 1);\n+    newPathNodes[newPathNodes.length - 1] = node;\n+    return new PartialPath(newPathNodes);\n+  }\n+\n+  public String[] getNodes() {\n+    return nodes;\n+  }\n+\n+  public String toString() {\n+    if (path != null) {\n+      return path;\n+    } else {\n+      StringBuilder s = new StringBuilder(nodes[0]);\n+      for (int i = 1; i < nodes.length; i++) {\n+        s.append(TsFileConstant.PATH_SEPARATOR);\n+        s.append(nodes[i]);\n+      }\n+      path = s.toString();\n+      return path;\n+    }\n+  }\n+\n+  @Override\n+  public boolean equals(Object obj) {\n+    if(!(obj instanceof PartialPath)) {\n+      return false;\n+    }\n+    String[] otherNodes = ((PartialPath) obj).getNodes();\n+    if( this.nodes.length != otherNodes.length) {\n+      return false;\n+    } else {\n+      for(int i = 0; i < this.nodes.length; i++) {\n+        if(!nodes[i].equals(otherNodes[i])) {\n+          return false;\n+        }\n+      }\n+     }\n+    return true;\n+  }\n+\n+  @Override\n+  public int hashCode() {\n+    return this.toString().hashCode();\n+  }\n+\n+  public String getLastNode() {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3Mjk1NzQxNw=="}, "originalCommit": {"oid": "9b512a695178b66909b84ac605b368d27fb36ab8"}, "originalPosition": 115}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk1NjI5MzAyOnYy", "diffSide": "RIGHT", "path": "server/src/main/java/org/apache/iotdb/db/metadata/PartialPath.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOVQxMToyNzo1NFrOHDDCgw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMFQxMTozOTozN1rOHD85VQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3Mjk1NzU3MQ==", "bodyText": "getDevice?", "url": "https://github.com/apache/iotdb/pull/1627#discussion_r472957571", "createdAt": "2020-08-19T11:27:54Z", "author": {"login": "qiaojialin"}, "path": "server/src/main/java/org/apache/iotdb/db/metadata/PartialPath.java", "diffHunk": "@@ -0,0 +1,173 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+package org.apache.iotdb.db.metadata;\n+\n+import java.util.Arrays;\n+import org.apache.iotdb.db.conf.IoTDBConstant;\n+import org.apache.iotdb.db.exception.metadata.IllegalPathException;\n+import org.apache.iotdb.tsfile.common.constant.TsFileConstant;\n+import org.apache.iotdb.tsfile.read.common.Path;\n+\n+/**\n+ * A prefix path, suffix path or fullPath generated from SQL\n+ */\n+public class PartialPath implements Comparable<PartialPath> {\n+\n+  private String[] nodes;\n+  private String path;\n+  private String pathWithoutLastNode;\n+  private String alias;\n+\n+  public PartialPath(String path) throws IllegalPathException {\n+    this.nodes = MetaUtils.splitPathToDetachedPath(path);\n+    this.path = path;\n+  }\n+\n+  public PartialPath(String[] partialNodes) {\n+    nodes = partialNodes;\n+  }\n+\n+  /**\n+   * it will return a new partial path\n+   * @param partialPath the path you want to concat\n+   * @return new partial path\n+   */\n+  public PartialPath concatPath(PartialPath partialPath) {\n+    int len = nodes.length;\n+    String[] newNodes = Arrays.copyOf(nodes, nodes.length + partialPath.nodes.length);\n+    System.arraycopy(partialPath.nodes, 0, newNodes, len, partialPath.nodes.length);\n+    return new PartialPath(newNodes);\n+  }\n+\n+  /**\n+   * It will change nodes in this partial path\n+   * @param otherNodes nodes\n+   */\n+  public void concatPath(String[] otherNodes) {\n+    int len = nodes.length;\n+    this.nodes = Arrays.copyOf(nodes, nodes.length + otherNodes.length);\n+    System.arraycopy(otherNodes, 0, nodes, len, otherNodes.length);\n+  }\n+\n+  public PartialPath concatNode(String node) {\n+    String[] newPathNodes = Arrays.copyOf(nodes, nodes.length + 1);\n+    newPathNodes[newPathNodes.length - 1] = node;\n+    return new PartialPath(newPathNodes);\n+  }\n+\n+  public String[] getNodes() {\n+    return nodes;\n+  }\n+\n+  public String toString() {\n+    if (path != null) {\n+      return path;\n+    } else {\n+      StringBuilder s = new StringBuilder(nodes[0]);\n+      for (int i = 1; i < nodes.length; i++) {\n+        s.append(TsFileConstant.PATH_SEPARATOR);\n+        s.append(nodes[i]);\n+      }\n+      path = s.toString();\n+      return path;\n+    }\n+  }\n+\n+  @Override\n+  public boolean equals(Object obj) {\n+    if(!(obj instanceof PartialPath)) {\n+      return false;\n+    }\n+    String[] otherNodes = ((PartialPath) obj).getNodes();\n+    if( this.nodes.length != otherNodes.length) {\n+      return false;\n+    } else {\n+      for(int i = 0; i < this.nodes.length; i++) {\n+        if(!nodes[i].equals(otherNodes[i])) {\n+          return false;\n+        }\n+      }\n+     }\n+    return true;\n+  }\n+\n+  @Override\n+  public int hashCode() {\n+    return this.toString().hashCode();\n+  }\n+\n+  public String getLastNode() {\n+    return nodes[nodes.length - 1];\n+  }\n+\n+  public String getFirstNode() {\n+    return nodes[0];\n+  }\n+\n+  public String getPathWithoutLastNode() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9b512a695178b66909b84ac605b368d27fb36ab8"}, "originalPosition": 123}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzkwNTQ5Mw==", "bodyText": "fixed", "url": "https://github.com/apache/iotdb/pull/1627#discussion_r473905493", "createdAt": "2020-08-20T11:39:37Z", "author": {"login": "Genius-pig"}, "path": "server/src/main/java/org/apache/iotdb/db/metadata/PartialPath.java", "diffHunk": "@@ -0,0 +1,173 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+package org.apache.iotdb.db.metadata;\n+\n+import java.util.Arrays;\n+import org.apache.iotdb.db.conf.IoTDBConstant;\n+import org.apache.iotdb.db.exception.metadata.IllegalPathException;\n+import org.apache.iotdb.tsfile.common.constant.TsFileConstant;\n+import org.apache.iotdb.tsfile.read.common.Path;\n+\n+/**\n+ * A prefix path, suffix path or fullPath generated from SQL\n+ */\n+public class PartialPath implements Comparable<PartialPath> {\n+\n+  private String[] nodes;\n+  private String path;\n+  private String pathWithoutLastNode;\n+  private String alias;\n+\n+  public PartialPath(String path) throws IllegalPathException {\n+    this.nodes = MetaUtils.splitPathToDetachedPath(path);\n+    this.path = path;\n+  }\n+\n+  public PartialPath(String[] partialNodes) {\n+    nodes = partialNodes;\n+  }\n+\n+  /**\n+   * it will return a new partial path\n+   * @param partialPath the path you want to concat\n+   * @return new partial path\n+   */\n+  public PartialPath concatPath(PartialPath partialPath) {\n+    int len = nodes.length;\n+    String[] newNodes = Arrays.copyOf(nodes, nodes.length + partialPath.nodes.length);\n+    System.arraycopy(partialPath.nodes, 0, newNodes, len, partialPath.nodes.length);\n+    return new PartialPath(newNodes);\n+  }\n+\n+  /**\n+   * It will change nodes in this partial path\n+   * @param otherNodes nodes\n+   */\n+  public void concatPath(String[] otherNodes) {\n+    int len = nodes.length;\n+    this.nodes = Arrays.copyOf(nodes, nodes.length + otherNodes.length);\n+    System.arraycopy(otherNodes, 0, nodes, len, otherNodes.length);\n+  }\n+\n+  public PartialPath concatNode(String node) {\n+    String[] newPathNodes = Arrays.copyOf(nodes, nodes.length + 1);\n+    newPathNodes[newPathNodes.length - 1] = node;\n+    return new PartialPath(newPathNodes);\n+  }\n+\n+  public String[] getNodes() {\n+    return nodes;\n+  }\n+\n+  public String toString() {\n+    if (path != null) {\n+      return path;\n+    } else {\n+      StringBuilder s = new StringBuilder(nodes[0]);\n+      for (int i = 1; i < nodes.length; i++) {\n+        s.append(TsFileConstant.PATH_SEPARATOR);\n+        s.append(nodes[i]);\n+      }\n+      path = s.toString();\n+      return path;\n+    }\n+  }\n+\n+  @Override\n+  public boolean equals(Object obj) {\n+    if(!(obj instanceof PartialPath)) {\n+      return false;\n+    }\n+    String[] otherNodes = ((PartialPath) obj).getNodes();\n+    if( this.nodes.length != otherNodes.length) {\n+      return false;\n+    } else {\n+      for(int i = 0; i < this.nodes.length; i++) {\n+        if(!nodes[i].equals(otherNodes[i])) {\n+          return false;\n+        }\n+      }\n+     }\n+    return true;\n+  }\n+\n+  @Override\n+  public int hashCode() {\n+    return this.toString().hashCode();\n+  }\n+\n+  public String getLastNode() {\n+    return nodes[nodes.length - 1];\n+  }\n+\n+  public String getFirstNode() {\n+    return nodes[0];\n+  }\n+\n+  public String getPathWithoutLastNode() {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3Mjk1NzU3MQ=="}, "originalCommit": {"oid": "9b512a695178b66909b84ac605b368d27fb36ab8"}, "originalPosition": 123}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk1NjMyMDU5OnYy", "diffSide": "RIGHT", "path": "server/src/main/java/org/apache/iotdb/db/engine/StorageEngine.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOVQxMTozNToxNVrOHDDSXA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMFQxMTozODo0N1rOHD83jA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3Mjk2MTYyOA==", "bodyText": "This should be String device,because all the following usage of PartialPath is toString().", "url": "https://github.com/apache/iotdb/pull/1627#discussion_r472961628", "createdAt": "2020-08-19T11:35:15Z", "author": {"login": "qiaojialin"}, "path": "server/src/main/java/org/apache/iotdb/db/engine/StorageEngine.java", "diffHunk": "@@ -445,8 +446,8 @@ public void delete(String deviceId, String measurementId, long startTime, long e\n    */\n   public QueryDataSource query(SingleSeriesExpression seriesExpression, QueryContext context,\n       QueryFileManager filePathsManager)\n-      throws StorageEngineException, QueryProcessException {\n-    String deviceId = seriesExpression.getSeriesPath().getDevice();\n+      throws StorageEngineException, QueryProcessException, IllegalPathException {\n+    PartialPath deviceId = new PartialPath(seriesExpression.getSeriesPath().getDevice());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9b512a695178b66909b84ac605b368d27fb36ab8"}, "originalPosition": 124}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzkwNTAzNg==", "bodyText": "fixed", "url": "https://github.com/apache/iotdb/pull/1627#discussion_r473905036", "createdAt": "2020-08-20T11:38:47Z", "author": {"login": "Genius-pig"}, "path": "server/src/main/java/org/apache/iotdb/db/engine/StorageEngine.java", "diffHunk": "@@ -445,8 +446,8 @@ public void delete(String deviceId, String measurementId, long startTime, long e\n    */\n   public QueryDataSource query(SingleSeriesExpression seriesExpression, QueryContext context,\n       QueryFileManager filePathsManager)\n-      throws StorageEngineException, QueryProcessException {\n-    String deviceId = seriesExpression.getSeriesPath().getDevice();\n+      throws StorageEngineException, QueryProcessException, IllegalPathException {\n+    PartialPath deviceId = new PartialPath(seriesExpression.getSeriesPath().getDevice());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3Mjk2MTYyOA=="}, "originalCommit": {"oid": "9b512a695178b66909b84ac605b368d27fb36ab8"}, "originalPosition": 124}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk1NjQ4NTU3OnYy", "diffSide": "RIGHT", "path": "server/src/main/java/org/apache/iotdb/db/metadata/PartialPath.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOVQxMjoyMjo1MVrOHDE2JA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMFQxMTozODo1NVrOHD83yQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3Mjk4NzE3Mg==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              public Path toTSFilePath() {\n          \n          \n            \n              public Path toPath() {\n          \n      \n    \n    \n  \n\ntoTsFilePath makes people treat this as a file path", "url": "https://github.com/apache/iotdb/pull/1627#discussion_r472987172", "createdAt": "2020-08-19T12:22:51Z", "author": {"login": "qiaojialin"}, "path": "server/src/main/java/org/apache/iotdb/db/metadata/PartialPath.java", "diffHunk": "@@ -0,0 +1,173 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+package org.apache.iotdb.db.metadata;\n+\n+import java.util.Arrays;\n+import org.apache.iotdb.db.conf.IoTDBConstant;\n+import org.apache.iotdb.db.exception.metadata.IllegalPathException;\n+import org.apache.iotdb.tsfile.common.constant.TsFileConstant;\n+import org.apache.iotdb.tsfile.read.common.Path;\n+\n+/**\n+ * A prefix path, suffix path or fullPath generated from SQL\n+ */\n+public class PartialPath implements Comparable<PartialPath> {\n+\n+  private String[] nodes;\n+  private String path;\n+  private String pathWithoutLastNode;\n+  private String alias;\n+\n+  public PartialPath(String path) throws IllegalPathException {\n+    this.nodes = MetaUtils.splitPathToDetachedPath(path);\n+    this.path = path;\n+  }\n+\n+  public PartialPath(String[] partialNodes) {\n+    nodes = partialNodes;\n+  }\n+\n+  /**\n+   * it will return a new partial path\n+   * @param partialPath the path you want to concat\n+   * @return new partial path\n+   */\n+  public PartialPath concatPath(PartialPath partialPath) {\n+    int len = nodes.length;\n+    String[] newNodes = Arrays.copyOf(nodes, nodes.length + partialPath.nodes.length);\n+    System.arraycopy(partialPath.nodes, 0, newNodes, len, partialPath.nodes.length);\n+    return new PartialPath(newNodes);\n+  }\n+\n+  /**\n+   * It will change nodes in this partial path\n+   * @param otherNodes nodes\n+   */\n+  public void concatPath(String[] otherNodes) {\n+    int len = nodes.length;\n+    this.nodes = Arrays.copyOf(nodes, nodes.length + otherNodes.length);\n+    System.arraycopy(otherNodes, 0, nodes, len, otherNodes.length);\n+  }\n+\n+  public PartialPath concatNode(String node) {\n+    String[] newPathNodes = Arrays.copyOf(nodes, nodes.length + 1);\n+    newPathNodes[newPathNodes.length - 1] = node;\n+    return new PartialPath(newPathNodes);\n+  }\n+\n+  public String[] getNodes() {\n+    return nodes;\n+  }\n+\n+  public String toString() {\n+    if (path != null) {\n+      return path;\n+    } else {\n+      StringBuilder s = new StringBuilder(nodes[0]);\n+      for (int i = 1; i < nodes.length; i++) {\n+        s.append(TsFileConstant.PATH_SEPARATOR);\n+        s.append(nodes[i]);\n+      }\n+      path = s.toString();\n+      return path;\n+    }\n+  }\n+\n+  @Override\n+  public boolean equals(Object obj) {\n+    if(!(obj instanceof PartialPath)) {\n+      return false;\n+    }\n+    String[] otherNodes = ((PartialPath) obj).getNodes();\n+    if( this.nodes.length != otherNodes.length) {\n+      return false;\n+    } else {\n+      for(int i = 0; i < this.nodes.length; i++) {\n+        if(!nodes[i].equals(otherNodes[i])) {\n+          return false;\n+        }\n+      }\n+     }\n+    return true;\n+  }\n+\n+  @Override\n+  public int hashCode() {\n+    return this.toString().hashCode();\n+  }\n+\n+  public String getLastNode() {\n+    return nodes[nodes.length - 1];\n+  }\n+\n+  public String getFirstNode() {\n+    return nodes[0];\n+  }\n+\n+  public String getPathWithoutLastNode() {\n+    if (pathWithoutLastNode != null) {\n+      return pathWithoutLastNode;\n+    } else {\n+      if(nodes.length == 1) {\n+        return \"\";\n+      }\n+      StringBuilder s = new StringBuilder(nodes[0]);\n+      for (int i = 1; i < nodes.length - 1; i++) {\n+        s.append(TsFileConstant.PATH_SEPARATOR);\n+        s.append(nodes[i]);\n+      }\n+      pathWithoutLastNode = s.toString();\n+      return pathWithoutLastNode;\n+    }\n+  }\n+\n+  public void setAlias(String alias) {\n+    this.alias = alias;\n+  }\n+\n+  public String getPathWithoutLastNodeWithAlias() {\n+    return getPathWithoutLastNode() + IoTDBConstant.PATH_SEPARATOR + alias;\n+  }\n+\n+  public String getAlias() {\n+    return alias;\n+  }\n+\n+  public boolean startsWith(String[] otherNodes) {\n+    for(int i = 0; i < otherNodes.length; i++) {\n+      if(!nodes[i].equals(otherNodes[i])) {\n+        return false;\n+      }\n+    }\n+    return true;\n+  }\n+\n+  public Path toTSFilePath() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9b512a695178b66909b84ac605b368d27fb36ab8"}, "originalPosition": 161}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzkwNTA5Nw==", "bodyText": "fixed", "url": "https://github.com/apache/iotdb/pull/1627#discussion_r473905097", "createdAt": "2020-08-20T11:38:55Z", "author": {"login": "Genius-pig"}, "path": "server/src/main/java/org/apache/iotdb/db/metadata/PartialPath.java", "diffHunk": "@@ -0,0 +1,173 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+package org.apache.iotdb.db.metadata;\n+\n+import java.util.Arrays;\n+import org.apache.iotdb.db.conf.IoTDBConstant;\n+import org.apache.iotdb.db.exception.metadata.IllegalPathException;\n+import org.apache.iotdb.tsfile.common.constant.TsFileConstant;\n+import org.apache.iotdb.tsfile.read.common.Path;\n+\n+/**\n+ * A prefix path, suffix path or fullPath generated from SQL\n+ */\n+public class PartialPath implements Comparable<PartialPath> {\n+\n+  private String[] nodes;\n+  private String path;\n+  private String pathWithoutLastNode;\n+  private String alias;\n+\n+  public PartialPath(String path) throws IllegalPathException {\n+    this.nodes = MetaUtils.splitPathToDetachedPath(path);\n+    this.path = path;\n+  }\n+\n+  public PartialPath(String[] partialNodes) {\n+    nodes = partialNodes;\n+  }\n+\n+  /**\n+   * it will return a new partial path\n+   * @param partialPath the path you want to concat\n+   * @return new partial path\n+   */\n+  public PartialPath concatPath(PartialPath partialPath) {\n+    int len = nodes.length;\n+    String[] newNodes = Arrays.copyOf(nodes, nodes.length + partialPath.nodes.length);\n+    System.arraycopy(partialPath.nodes, 0, newNodes, len, partialPath.nodes.length);\n+    return new PartialPath(newNodes);\n+  }\n+\n+  /**\n+   * It will change nodes in this partial path\n+   * @param otherNodes nodes\n+   */\n+  public void concatPath(String[] otherNodes) {\n+    int len = nodes.length;\n+    this.nodes = Arrays.copyOf(nodes, nodes.length + otherNodes.length);\n+    System.arraycopy(otherNodes, 0, nodes, len, otherNodes.length);\n+  }\n+\n+  public PartialPath concatNode(String node) {\n+    String[] newPathNodes = Arrays.copyOf(nodes, nodes.length + 1);\n+    newPathNodes[newPathNodes.length - 1] = node;\n+    return new PartialPath(newPathNodes);\n+  }\n+\n+  public String[] getNodes() {\n+    return nodes;\n+  }\n+\n+  public String toString() {\n+    if (path != null) {\n+      return path;\n+    } else {\n+      StringBuilder s = new StringBuilder(nodes[0]);\n+      for (int i = 1; i < nodes.length; i++) {\n+        s.append(TsFileConstant.PATH_SEPARATOR);\n+        s.append(nodes[i]);\n+      }\n+      path = s.toString();\n+      return path;\n+    }\n+  }\n+\n+  @Override\n+  public boolean equals(Object obj) {\n+    if(!(obj instanceof PartialPath)) {\n+      return false;\n+    }\n+    String[] otherNodes = ((PartialPath) obj).getNodes();\n+    if( this.nodes.length != otherNodes.length) {\n+      return false;\n+    } else {\n+      for(int i = 0; i < this.nodes.length; i++) {\n+        if(!nodes[i].equals(otherNodes[i])) {\n+          return false;\n+        }\n+      }\n+     }\n+    return true;\n+  }\n+\n+  @Override\n+  public int hashCode() {\n+    return this.toString().hashCode();\n+  }\n+\n+  public String getLastNode() {\n+    return nodes[nodes.length - 1];\n+  }\n+\n+  public String getFirstNode() {\n+    return nodes[0];\n+  }\n+\n+  public String getPathWithoutLastNode() {\n+    if (pathWithoutLastNode != null) {\n+      return pathWithoutLastNode;\n+    } else {\n+      if(nodes.length == 1) {\n+        return \"\";\n+      }\n+      StringBuilder s = new StringBuilder(nodes[0]);\n+      for (int i = 1; i < nodes.length - 1; i++) {\n+        s.append(TsFileConstant.PATH_SEPARATOR);\n+        s.append(nodes[i]);\n+      }\n+      pathWithoutLastNode = s.toString();\n+      return pathWithoutLastNode;\n+    }\n+  }\n+\n+  public void setAlias(String alias) {\n+    this.alias = alias;\n+  }\n+\n+  public String getPathWithoutLastNodeWithAlias() {\n+    return getPathWithoutLastNode() + IoTDBConstant.PATH_SEPARATOR + alias;\n+  }\n+\n+  public String getAlias() {\n+    return alias;\n+  }\n+\n+  public boolean startsWith(String[] otherNodes) {\n+    for(int i = 0; i < otherNodes.length; i++) {\n+      if(!nodes[i].equals(otherNodes[i])) {\n+        return false;\n+      }\n+    }\n+    return true;\n+  }\n+\n+  public Path toTSFilePath() {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3Mjk4NzE3Mg=="}, "originalCommit": {"oid": "9b512a695178b66909b84ac605b368d27fb36ab8"}, "originalPosition": 161}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk1NjY5NDkzOnYy", "diffSide": "RIGHT", "path": "server/src/main/java/org/apache/iotdb/db/metadata/MTree.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOVQxMzoxNToxNFrOHDG1bA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMFQxMTozOToxMVrOHD84Uw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzAxOTc1Ng==", "bodyText": "recover this, leave this to another PR\uff0c The pair structure is not good also", "url": "https://github.com/apache/iotdb/pull/1627#discussion_r473019756", "createdAt": "2020-08-19T13:15:14Z", "author": {"login": "qiaojialin"}, "path": "server/src/main/java/org/apache/iotdb/db/metadata/MTree.java", "diffHunk": "@@ -671,11 +668,11 @@ private int getCountInGivenLevel(MNode node, int targetLevel) {\n    *\n    * <p>result: [name, alias, storage group, dataType, encoding, compression, offset]\n    */\n-  List<String[]> getAllMeasurementSchema(ShowTimeSeriesPlan plan) throws MetadataException {\n-    List<String[]> res;\n-    String[] nodes = MetaUtils.getNodeNames(plan.getPath().getFullPath());\n+  List<Pair<PartialPath, String[]>> getAllMeasurementSchema(ShowTimeSeriesPlan plan) throws MetadataException {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9b512a695178b66909b84ac605b368d27fb36ab8"}, "originalPosition": 401}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzkwNTIzNQ==", "bodyText": "OK", "url": "https://github.com/apache/iotdb/pull/1627#discussion_r473905235", "createdAt": "2020-08-20T11:39:11Z", "author": {"login": "Genius-pig"}, "path": "server/src/main/java/org/apache/iotdb/db/metadata/MTree.java", "diffHunk": "@@ -671,11 +668,11 @@ private int getCountInGivenLevel(MNode node, int targetLevel) {\n    *\n    * <p>result: [name, alias, storage group, dataType, encoding, compression, offset]\n    */\n-  List<String[]> getAllMeasurementSchema(ShowTimeSeriesPlan plan) throws MetadataException {\n-    List<String[]> res;\n-    String[] nodes = MetaUtils.getNodeNames(plan.getPath().getFullPath());\n+  List<Pair<PartialPath, String[]>> getAllMeasurementSchema(ShowTimeSeriesPlan plan) throws MetadataException {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzAxOTc1Ng=="}, "originalCommit": {"oid": "9b512a695178b66909b84ac605b368d27fb36ab8"}, "originalPosition": 401}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk1NjczNzk1OnYy", "diffSide": "RIGHT", "path": "server/src/main/java/org/apache/iotdb/db/qp/logical/crud/InOperator.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOVQxMzoyNDo0OFrOHDHPTg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMFQxMTozOToyNFrOHD843g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzAyNjM4Mg==", "bodyText": "If the PartialPath extends the Path, this is no need to change.", "url": "https://github.com/apache/iotdb/pull/1627#discussion_r473026382", "createdAt": "2020-08-19T13:24:48Z", "author": {"login": "qiaojialin"}, "path": "server/src/main/java/org/apache/iotdb/db/qp/logical/crud/InOperator.java", "diffHunk": "@@ -55,7 +56,7 @@\n    * @param path path\n    * @param values values\n    */\n-  public InOperator(int tokenIntType, Path path, boolean not, Set<String> values) {\n+  public InOperator(int tokenIntType, PartialPath path, boolean not, Set<String> values) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9b512a695178b66909b84ac605b368d27fb36ab8"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzkwNTM3NA==", "bodyText": "fixed", "url": "https://github.com/apache/iotdb/pull/1627#discussion_r473905374", "createdAt": "2020-08-20T11:39:24Z", "author": {"login": "Genius-pig"}, "path": "server/src/main/java/org/apache/iotdb/db/qp/logical/crud/InOperator.java", "diffHunk": "@@ -55,7 +56,7 @@\n    * @param path path\n    * @param values values\n    */\n-  public InOperator(int tokenIntType, Path path, boolean not, Set<String> values) {\n+  public InOperator(int tokenIntType, PartialPath path, boolean not, Set<String> values) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzAyNjM4Mg=="}, "originalCommit": {"oid": "9b512a695178b66909b84ac605b368d27fb36ab8"}, "originalPosition": 13}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk2Mjc0MDgzOnYy", "diffSide": "RIGHT", "path": "server/src/main/java/org/apache/iotdb/db/qp/logical/crud/InOperator.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMFQxNDowMjowMFrOHEDGWQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMVQwMToyNDo1MlrOHEYcUw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDAwNzEyOQ==", "bodyText": "No need to construct a Path", "url": "https://github.com/apache/iotdb/pull/1627#discussion_r474007129", "createdAt": "2020-08-20T14:02:00Z", "author": {"login": "qiaojialin"}, "path": "server/src/main/java/org/apache/iotdb/db/qp/logical/crud/InOperator.java", "diffHunk": "@@ -129,7 +130,7 @@ public void reverseFunc() {\n                   .endsWith(\"\\\"\")) ? new Binary(val.substring(1, val.length() - 1))\n                   : new Binary(val));\n         }\n-        ret = In.getUnaryExpression(singlePath, binaryValues, not);\n+        ret = In.getUnaryExpression(new Path(singlePath.getDevice(), singlePath.getMeasurement()), binaryValues, not);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e49ed0983858a513edbc843187c7276aea6e0879"}, "originalPosition": 72}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDM1NjgxOQ==", "bodyText": "fixed", "url": "https://github.com/apache/iotdb/pull/1627#discussion_r474356819", "createdAt": "2020-08-21T01:24:52Z", "author": {"login": "Genius-pig"}, "path": "server/src/main/java/org/apache/iotdb/db/qp/logical/crud/InOperator.java", "diffHunk": "@@ -129,7 +130,7 @@ public void reverseFunc() {\n                   .endsWith(\"\\\"\")) ? new Binary(val.substring(1, val.length() - 1))\n                   : new Binary(val));\n         }\n-        ret = In.getUnaryExpression(singlePath, binaryValues, not);\n+        ret = In.getUnaryExpression(new Path(singlePath.getDevice(), singlePath.getMeasurement()), binaryValues, not);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDAwNzEyOQ=="}, "originalCommit": {"oid": "e49ed0983858a513edbc843187c7276aea6e0879"}, "originalPosition": 72}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk2NjA1MjQ4OnYy", "diffSide": "RIGHT", "path": "server/src/main/java/org/apache/iotdb/db/conf/IoTDBConfig.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMVQwODozNzoyNFrOHEi4MQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMVQwOTo1NjozMVrOHEnM6w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDUyNzc5Mw==", "bodyText": "We support all nodes surrounded by double quotes now. Modify the comments and regular expressions. Then add some tests for it.", "url": "https://github.com/apache/iotdb/pull/1627#discussion_r474527793", "createdAt": "2020-08-21T08:37:24Z", "author": {"login": "Alima777"}, "path": "server/src/main/java/org/apache/iotdb/db/conf/IoTDBConfig.java", "diffHunk": "@@ -53,9 +53,9 @@\n   // e.g.,  .s1\n   private static final String NODE_MATCHER = \"[\" + PATH_SEPARATOR + \"]\" + ID_MATCHER;\n \n-  // for path like: root.sg1.d1.\"1.2.3\" or root.sg1.d1.'1.2.3', only occurs in the end of the path and only occurs once\n+  // for path like: root.sg1.d1.\"1.2.3\", only occurs in the end of the path and only occurs once\n   private static final String NODE_WITH_QUOTATION_MARK_MATCHER =\n-      \"[\" + PATH_SEPARATOR + \"][\\\"|\\']\" + ID_MATCHER + \"(\" + NODE_MATCHER + \")*[\\\"|\\']\";\n+      \"[\" + PATH_SEPARATOR + \"][\\\"]\" + ID_MATCHER + \"(\" + NODE_MATCHER + \")*[\\\"]\";\n   public static final Pattern PATH_PATTERN = Pattern", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bfc288be2c2f5f514bbb75f6320184dd19795448"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDU5ODYzNQ==", "bodyText": "fixed", "url": "https://github.com/apache/iotdb/pull/1627#discussion_r474598635", "createdAt": "2020-08-21T09:56:31Z", "author": {"login": "Genius-pig"}, "path": "server/src/main/java/org/apache/iotdb/db/conf/IoTDBConfig.java", "diffHunk": "@@ -53,9 +53,9 @@\n   // e.g.,  .s1\n   private static final String NODE_MATCHER = \"[\" + PATH_SEPARATOR + \"]\" + ID_MATCHER;\n \n-  // for path like: root.sg1.d1.\"1.2.3\" or root.sg1.d1.'1.2.3', only occurs in the end of the path and only occurs once\n+  // for path like: root.sg1.d1.\"1.2.3\", only occurs in the end of the path and only occurs once\n   private static final String NODE_WITH_QUOTATION_MARK_MATCHER =\n-      \"[\" + PATH_SEPARATOR + \"][\\\"|\\']\" + ID_MATCHER + \"(\" + NODE_MATCHER + \")*[\\\"|\\']\";\n+      \"[\" + PATH_SEPARATOR + \"][\\\"]\" + ID_MATCHER + \"(\" + NODE_MATCHER + \")*[\\\"]\";\n   public static final Pattern PATH_PATTERN = Pattern", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDUyNzc5Mw=="}, "originalCommit": {"oid": "bfc288be2c2f5f514bbb75f6320184dd19795448"}, "originalPosition": 9}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk2NjA2OTMzOnYy", "diffSide": "RIGHT", "path": "server/src/main/java/org/apache/iotdb/db/engine/StorageEngine.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMVQwODo0MDozMlrOHEjDDw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMVQxMDowMDo0OFrOHEnVVw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDUzMDU3NQ==", "bodyText": "storageGroup -> storageGroupPath is more intuitive.", "url": "https://github.com/apache/iotdb/pull/1627#discussion_r474530575", "createdAt": "2020-08-21T08:40:32Z", "author": {"login": "Alima777"}, "path": "server/src/main/java/org/apache/iotdb/db/engine/StorageEngine.java", "diffHunk": "@@ -270,31 +272,30 @@ public ServiceType getID() {\n     return ServiceType.STORAGE_ENGINE_SERVICE;\n   }\n \n-  public StorageGroupProcessor getProcessor(String path) throws StorageEngineException {\n-    String storageGroupName;\n+  public StorageGroupProcessor getProcessor(PartialPath path) throws StorageEngineException {\n+    PartialPath storageGroup;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bfc288be2c2f5f514bbb75f6320184dd19795448"}, "originalPosition": 38}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDYwMDc5MQ==", "bodyText": "I think only storageGroupName need to be renamed", "url": "https://github.com/apache/iotdb/pull/1627#discussion_r474600791", "createdAt": "2020-08-21T10:00:48Z", "author": {"login": "Genius-pig"}, "path": "server/src/main/java/org/apache/iotdb/db/engine/StorageEngine.java", "diffHunk": "@@ -270,31 +272,30 @@ public ServiceType getID() {\n     return ServiceType.STORAGE_ENGINE_SERVICE;\n   }\n \n-  public StorageGroupProcessor getProcessor(String path) throws StorageEngineException {\n-    String storageGroupName;\n+  public StorageGroupProcessor getProcessor(PartialPath path) throws StorageEngineException {\n+    PartialPath storageGroup;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDUzMDU3NQ=="}, "originalCommit": {"oid": "bfc288be2c2f5f514bbb75f6320184dd19795448"}, "originalPosition": 38}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk2NjA3Mzg3OnYy", "diffSide": "RIGHT", "path": "server/src/main/java/org/apache/iotdb/db/engine/StorageEngine.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMVQwODo0MToyNVrOHEjGJQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMVQwOTo1Njo1MFrOHEnNiQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDUzMTM2NQ==", "bodyText": "storageGroupName -> storageGroupPath", "url": "https://github.com/apache/iotdb/pull/1627#discussion_r474531365", "createdAt": "2020-08-21T08:41:25Z", "author": {"login": "Alima777"}, "path": "server/src/main/java/org/apache/iotdb/db/engine/StorageEngine.java", "diffHunk": "@@ -364,7 +365,7 @@ public void forceCloseAllProcessor() throws TsFileProcessorException {\n     }\n   }\n \n-  public void asyncCloseProcessor(String storageGroupName, boolean isSeq)\n+  public void asyncCloseProcessor(PartialPath storageGroupName, boolean isSeq)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bfc288be2c2f5f514bbb75f6320184dd19795448"}, "originalPosition": 81}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDU5ODc5Mw==", "bodyText": "fixed", "url": "https://github.com/apache/iotdb/pull/1627#discussion_r474598793", "createdAt": "2020-08-21T09:56:50Z", "author": {"login": "Genius-pig"}, "path": "server/src/main/java/org/apache/iotdb/db/engine/StorageEngine.java", "diffHunk": "@@ -364,7 +365,7 @@ public void forceCloseAllProcessor() throws TsFileProcessorException {\n     }\n   }\n \n-  public void asyncCloseProcessor(String storageGroupName, boolean isSeq)\n+  public void asyncCloseProcessor(PartialPath storageGroupName, boolean isSeq)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDUzMTM2NQ=="}, "originalCommit": {"oid": "bfc288be2c2f5f514bbb75f6320184dd19795448"}, "originalPosition": 81}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk2NjA3NjIyOnYy", "diffSide": "RIGHT", "path": "server/src/main/java/org/apache/iotdb/db/engine/StorageEngine.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMVQwODo0MTo1MFrOHEjHqA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMVQwOTo1Njo1NlrOHEnNug==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDUzMTc1Mg==", "bodyText": "Same as above", "url": "https://github.com/apache/iotdb/pull/1627#discussion_r474531752", "createdAt": "2020-08-21T08:41:50Z", "author": {"login": "Alima777"}, "path": "server/src/main/java/org/apache/iotdb/db/engine/StorageEngine.java", "diffHunk": "@@ -389,11 +390,11 @@ public void asyncCloseProcessor(String storageGroupName, boolean isSeq)\n         processor.writeUnlock();\n       }\n     } else {\n-      throw new StorageGroupNotSetException(storageGroupName);\n+      throw new StorageGroupNotSetException(storageGroupName.getFullPath());\n     }\n   }\n \n-  public void asyncCloseProcessor(String storageGroupName, long partitionId, boolean isSeq)\n+  public void asyncCloseProcessor(PartialPath storageGroupName, long partitionId, boolean isSeq)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bfc288be2c2f5f514bbb75f6320184dd19795448"}, "originalPosition": 95}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDU5ODg0Mg==", "bodyText": "fixed", "url": "https://github.com/apache/iotdb/pull/1627#discussion_r474598842", "createdAt": "2020-08-21T09:56:56Z", "author": {"login": "Genius-pig"}, "path": "server/src/main/java/org/apache/iotdb/db/engine/StorageEngine.java", "diffHunk": "@@ -389,11 +390,11 @@ public void asyncCloseProcessor(String storageGroupName, boolean isSeq)\n         processor.writeUnlock();\n       }\n     } else {\n-      throw new StorageGroupNotSetException(storageGroupName);\n+      throw new StorageGroupNotSetException(storageGroupName.getFullPath());\n     }\n   }\n \n-  public void asyncCloseProcessor(String storageGroupName, long partitionId, boolean isSeq)\n+  public void asyncCloseProcessor(PartialPath storageGroupName, long partitionId, boolean isSeq)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDUzMTc1Mg=="}, "originalCommit": {"oid": "bfc288be2c2f5f514bbb75f6320184dd19795448"}, "originalPosition": 95}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk2NjE0OTMxOnYy", "diffSide": "RIGHT", "path": "server/src/main/java/org/apache/iotdb/db/engine/StorageEngine.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMVQwODo1NDozOVrOHEj3Ig==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMVQwOTo1NzowNVrOHEnN_g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDU0MzkwNg==", "bodyText": "Many places kept the origin parameter name.  I will not sign every place.\nBascially, storageGroup or storageGroupName -> storageGroupPath is ok.", "url": "https://github.com/apache/iotdb/pull/1627#discussion_r474543906", "createdAt": "2020-08-21T08:54:39Z", "author": {"login": "Alima777"}, "path": "server/src/main/java/org/apache/iotdb/db/engine/StorageEngine.java", "diffHunk": "@@ -499,13 +501,13 @@ public void mergeAll(boolean fullMerge) throws StorageEngineException {\n    * delete all data files (both memory data and file on disk) in a storage group. It is used when\n    * there is no timeseries (which are all deleted) in this storage group)\n    */\n-  public void deleteAllDataFilesInOneStorageGroup(String storageGroupName) {\n+  public void deleteAllDataFilesInOneStorageGroup(PartialPath storageGroupName) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bfc288be2c2f5f514bbb75f6320184dd19795448"}, "originalPosition": 132}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDU5ODkxMA==", "bodyText": "fixed", "url": "https://github.com/apache/iotdb/pull/1627#discussion_r474598910", "createdAt": "2020-08-21T09:57:05Z", "author": {"login": "Genius-pig"}, "path": "server/src/main/java/org/apache/iotdb/db/engine/StorageEngine.java", "diffHunk": "@@ -499,13 +501,13 @@ public void mergeAll(boolean fullMerge) throws StorageEngineException {\n    * delete all data files (both memory data and file on disk) in a storage group. It is used when\n    * there is no timeseries (which are all deleted) in this storage group)\n    */\n-  public void deleteAllDataFilesInOneStorageGroup(String storageGroupName) {\n+  public void deleteAllDataFilesInOneStorageGroup(PartialPath storageGroupName) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDU0MzkwNg=="}, "originalCommit": {"oid": "bfc288be2c2f5f514bbb75f6320184dd19795448"}, "originalPosition": 132}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk2NjE2NjYxOnYy", "diffSide": "RIGHT", "path": "server/src/main/java/org/apache/iotdb/db/metadata/PartialPath.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMVQwODo1Nzo0MlrOHEkCGw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMlQwOTo1NTowNFrOHFEN7g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDU0NjcxNQ==", "bodyText": "Path and PartialPath are not in the same package now. I'm not sure it's ok.", "url": "https://github.com/apache/iotdb/pull/1627#discussion_r474546715", "createdAt": "2020-08-21T08:57:42Z", "author": {"login": "Alima777"}, "path": "server/src/main/java/org/apache/iotdb/db/metadata/PartialPath.java", "diffHunk": "@@ -0,0 +1,188 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+package org.apache.iotdb.db.metadata;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bfc288be2c2f5f514bbb75f6320184dd19795448"}, "originalPosition": 19}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDU5OTA3NQ==", "bodyText": "why should be in the same package?", "url": "https://github.com/apache/iotdb/pull/1627#discussion_r474599075", "createdAt": "2020-08-21T09:57:29Z", "author": {"login": "Genius-pig"}, "path": "server/src/main/java/org/apache/iotdb/db/metadata/PartialPath.java", "diffHunk": "@@ -0,0 +1,188 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+package org.apache.iotdb.db.metadata;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDU0NjcxNQ=="}, "originalCommit": {"oid": "bfc288be2c2f5f514bbb75f6320184dd19795448"}, "originalPosition": 19}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTA3NDAzMA==", "bodyText": "In my opinion, as a large project, to maintain it and keep it a better structure, the classes with the similar function are put in the same package is better.", "url": "https://github.com/apache/iotdb/pull/1627#discussion_r475074030", "createdAt": "2020-08-22T09:55:04Z", "author": {"login": "Alima777"}, "path": "server/src/main/java/org/apache/iotdb/db/metadata/PartialPath.java", "diffHunk": "@@ -0,0 +1,188 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+package org.apache.iotdb.db.metadata;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDU0NjcxNQ=="}, "originalCommit": {"oid": "bfc288be2c2f5f514bbb75f6320184dd19795448"}, "originalPosition": 19}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk2NjI5NzYxOnYy", "diffSide": "RIGHT", "path": "server/src/main/java/org/apache/iotdb/db/metadata/MManager.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMVQwOToyMToxNlrOHElUQQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMVQwOTo1Nzo0MVrOHEnO_g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDU2Nzc0NQ==", "bodyText": "storageGroupName -> storageGroupPath", "url": "https://github.com/apache/iotdb/pull/1627#discussion_r474567745", "createdAt": "2020-08-21T09:21:16Z", "author": {"login": "Alima777"}, "path": "server/src/main/java/org/apache/iotdb/db/metadata/MManager.java", "diffHunk": "@@ -371,12 +372,12 @@ public void createTimeseries(CreateTimeSeriesPlan plan) throws MetadataException\n   public void createTimeseries(CreateTimeSeriesPlan plan, long offset) throws MetadataException {\n     lock.writeLock().lock();\n     try {\n-      String path = plan.getPath().getFullPath();\n+      PartialPath path = plan.getPath();\n       SchemaUtils.checkDataTypeWithEncoding(plan.getDataType(), plan.getEncoding());\n       /*\n        * get the storage group with auto create schema\n        */\n-      String storageGroupName;\n+      PartialPath storageGroupName;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bfc288be2c2f5f514bbb75f6320184dd19795448"}, "originalPosition": 108}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDU5OTE2Ng==", "bodyText": "fixed", "url": "https://github.com/apache/iotdb/pull/1627#discussion_r474599166", "createdAt": "2020-08-21T09:57:41Z", "author": {"login": "Genius-pig"}, "path": "server/src/main/java/org/apache/iotdb/db/metadata/MManager.java", "diffHunk": "@@ -371,12 +372,12 @@ public void createTimeseries(CreateTimeSeriesPlan plan) throws MetadataException\n   public void createTimeseries(CreateTimeSeriesPlan plan, long offset) throws MetadataException {\n     lock.writeLock().lock();\n     try {\n-      String path = plan.getPath().getFullPath();\n+      PartialPath path = plan.getPath();\n       SchemaUtils.checkDataTypeWithEncoding(plan.getDataType(), plan.getEncoding());\n       /*\n        * get the storage group with auto create schema\n        */\n-      String storageGroupName;\n+      PartialPath storageGroupName;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDU2Nzc0NQ=="}, "originalCommit": {"oid": "bfc288be2c2f5f514bbb75f6320184dd19795448"}, "originalPosition": 108}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk2NjM2NzUwOnYy", "diffSide": "RIGHT", "path": "server/src/main/java/org/apache/iotdb/db/monitor/MonitorConstants.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMVQwOTozMzo1MVrOHEmBSg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMVQwOTo1ODoyN1rOHEnQmA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDU3OTI3NA==", "bodyText": "Why changing the access restrictions here?", "url": "https://github.com/apache/iotdb/pull/1627#discussion_r474579274", "createdAt": "2020-08-21T09:33:51Z", "author": {"login": "Alima777"}, "path": "server/src/main/java/org/apache/iotdb/db/monitor/MonitorConstants.java", "diffHunk": "@@ -40,12 +41,12 @@\n   public static final String FILE_SIZE_STORAGE_GROUP_NAME = STAT_STORAGE_GROUP_PREFIX\n       + MONITOR_PATH_SEPARATOR + FILE_SIZE;\n   // statistic for insert module\n-  static final String FILE_NODE_MANAGER_PATH = \"write.global\";\n+  private static final String FILE_NODE_MANAGER_PATH = \"write.global\";\n   public static final String FILE_NODE_PATH = \"write\";\n   /**\n    * Stat information.\n    */\n-  public static final String STAT_STORAGE_DELTA_NAME = STAT_STORAGE_GROUP_PREFIX\n+  static final String STAT_STORAGE_DELTA_NAME = STAT_STORAGE_GROUP_PREFIX", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bfc288be2c2f5f514bbb75f6320184dd19795448"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDU5OTU3Ng==", "bodyText": "The idea wants me to remove the public.", "url": "https://github.com/apache/iotdb/pull/1627#discussion_r474599576", "createdAt": "2020-08-21T09:58:27Z", "author": {"login": "Genius-pig"}, "path": "server/src/main/java/org/apache/iotdb/db/monitor/MonitorConstants.java", "diffHunk": "@@ -40,12 +41,12 @@\n   public static final String FILE_SIZE_STORAGE_GROUP_NAME = STAT_STORAGE_GROUP_PREFIX\n       + MONITOR_PATH_SEPARATOR + FILE_SIZE;\n   // statistic for insert module\n-  static final String FILE_NODE_MANAGER_PATH = \"write.global\";\n+  private static final String FILE_NODE_MANAGER_PATH = \"write.global\";\n   public static final String FILE_NODE_PATH = \"write\";\n   /**\n    * Stat information.\n    */\n-  public static final String STAT_STORAGE_DELTA_NAME = STAT_STORAGE_GROUP_PREFIX\n+  static final String STAT_STORAGE_DELTA_NAME = STAT_STORAGE_GROUP_PREFIX", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDU3OTI3NA=="}, "originalCommit": {"oid": "bfc288be2c2f5f514bbb75f6320184dd19795448"}, "originalPosition": 21}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk5NTUxNjMwOnYy", "diffSide": "RIGHT", "path": "server/src/main/java/org/apache/iotdb/db/engine/memtable/AbstractMemTable.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOFQxMTozNToyMlrOHI-P1Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOFQxMTozNToyMlrOHI-P1Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTE3MDUxNw==", "bodyText": "I think we can use PartialPath directly here. There is no need to transfer it to String. If so, you need to change the type of memTableMap in AbstractMemTable to Map<PartialPath, Map<String, IWritableMemChunk>> memTableMap.\nAnd by the way, i think you should rewrite the both hashCode and compareTo methods in PartialPath. We can compare each string in string arraynodes instead of calling the fullPath() method which will retain it in memory until the PartialPath is cleaned by GC.", "url": "https://github.com/apache/iotdb/pull/1627#discussion_r479170517", "createdAt": "2020-08-28T11:35:22Z", "author": {"login": "JackieTien97"}, "path": "server/src/main/java/org/apache/iotdb/db/engine/memtable/AbstractMemTable.java", "diffHunk": "@@ -108,7 +108,7 @@ public void insert(InsertRowPlan insertRowPlan) {\n       Object value = insertRowPlan.getValues()[i];\n       memSize += MemUtils.getRecordSize(insertRowPlan.getSchemas()[i].getType(), value);\n \n-      write(insertRowPlan.getDeviceId(), insertRowPlan.getMeasurements()[i],\n+      write(insertRowPlan.getDeviceId().getFullPath(), insertRowPlan.getMeasurements()[i],", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "be5e0fe4416eb6a7c0541779a7e377d81035c7c3"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk5NTU1NDg1OnYy", "diffSide": "RIGHT", "path": "server/src/main/java/org/apache/iotdb/db/engine/merge/task/MergeFileTask.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOFQxMTo0MDo1MFrOHI-ojw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOFQxNDo1Njo0MFrOHJJy1g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTE3Njg0Nw==", "bodyText": "Why here we need to copy it?", "url": "https://github.com/apache/iotdb/pull/1627#discussion_r479176847", "createdAt": "2020-08-28T11:40:50Z", "author": {"login": "JackieTien97"}, "path": "server/src/main/java/org/apache/iotdb/db/engine/merge/task/MergeFileTask.java", "diffHunk": "@@ -151,7 +152,10 @@ private void moveMergedToOld(TsFileResource seqFile) throws IOException {\n       TsFileIOWriter oldFileWriter = getOldFileWriter(seqFile);\n \n       // filter the chunks that have been merged\n-      oldFileWriter.filterChunks(context.getUnmergedChunkStartTimes().get(seqFile));\n+      oldFileWriter.filterChunks(\n+          context.getUnmergedChunkStartTimes().get(seqFile).entrySet().stream()\n+              .collect(Collectors.toMap(Entry::getKey, Map.Entry::getValue))\n+      );", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "be5e0fe4416eb6a7c0541779a7e377d81035c7c3"}, "originalPosition": 31}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTM1OTcwMg==", "bodyText": "fixed", "url": "https://github.com/apache/iotdb/pull/1627#discussion_r479359702", "createdAt": "2020-08-28T14:56:40Z", "author": {"login": "Genius-pig"}, "path": "server/src/main/java/org/apache/iotdb/db/engine/merge/task/MergeFileTask.java", "diffHunk": "@@ -151,7 +152,10 @@ private void moveMergedToOld(TsFileResource seqFile) throws IOException {\n       TsFileIOWriter oldFileWriter = getOldFileWriter(seqFile);\n \n       // filter the chunks that have been merged\n-      oldFileWriter.filterChunks(context.getUnmergedChunkStartTimes().get(seqFile));\n+      oldFileWriter.filterChunks(\n+          context.getUnmergedChunkStartTimes().get(seqFile).entrySet().stream()\n+              .collect(Collectors.toMap(Entry::getKey, Map.Entry::getValue))\n+      );", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTE3Njg0Nw=="}, "originalCommit": {"oid": "be5e0fe4416eb6a7c0541779a7e377d81035c7c3"}, "originalPosition": 31}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk5NTU3MTU0OnYy", "diffSide": "RIGHT", "path": "server/src/main/java/org/apache/iotdb/db/engine/storagegroup/StorageGroupProcessor.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOFQxMTo0MzoyNFrOHI-0Aw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOFQxMTo0MzoyNFrOHI-0Aw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTE3OTc3OQ==", "bodyText": "Same as above, I think we can use PartialPath directly.", "url": "https://github.com/apache/iotdb/pull/1627#discussion_r479179779", "createdAt": "2020-08-28T11:43:24Z", "author": {"login": "JackieTien97"}, "path": "server/src/main/java/org/apache/iotdb/db/engine/storagegroup/StorageGroupProcessor.java", "diffHunk": "@@ -736,7 +736,7 @@ public void insert(InsertRowPlan insertRowPlan) throws WriteProcessException {\n       // insert to sequence or unSequence file\n       insertToTsFileProcessor(insertRowPlan,\n           insertRowPlan.getTime() > partitionLatestFlushedTimeForEachDevice.get(timePartitionId)\n-              .getOrDefault(insertRowPlan.getDeviceId(), Long.MIN_VALUE));\n+              .getOrDefault(insertRowPlan.getDeviceId().getFullPath(), Long.MIN_VALUE));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "be5e0fe4416eb6a7c0541779a7e377d81035c7c3"}, "originalPosition": 21}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk5NTU5ODg4OnYy", "diffSide": "RIGHT", "path": "server/src/main/java/org/apache/iotdb/db/engine/storagegroup/TsFileProcessor.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOFQxMTo0NzoyMVrOHI_GPg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOFQxMTo0NzoyMVrOHI_GPg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTE4NDQ0Ng==", "bodyText": "Same as above, if we change the key's type of the map to PartialPath, we don't have to call the getFullPath() method.", "url": "https://github.com/apache/iotdb/pull/1627#discussion_r479184446", "createdAt": "2020-08-28T11:47:21Z", "author": {"login": "JackieTien97"}, "path": "server/src/main/java/org/apache/iotdb/db/engine/storagegroup/TsFileProcessor.java", "diffHunk": "@@ -216,11 +216,11 @@ public void insert(InsertRowPlan insertRowPlan) throws WriteProcessException {\n     }\n \n     // update start time of this memtable\n-    tsFileResource.updateStartTime(insertRowPlan.getDeviceId(), insertRowPlan.getTime());\n+    tsFileResource.updateStartTime(insertRowPlan.getDeviceId().getFullPath(), insertRowPlan.getTime());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "be5e0fe4416eb6a7c0541779a7e377d81035c7c3"}, "originalPosition": 5}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4655, "cost": 1, "resetAt": "2021-11-12T11:18:39Z"}}}