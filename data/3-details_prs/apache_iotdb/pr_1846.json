{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTA4MjE4Mzkx", "number": 1846, "title": "[IOTDB-872] Use system timezone in CLI (Session)", "bodyText": "Remove the default timezone in server side.\nUsing the system default time zone of each client to decide the time zone of server operation.", "createdAt": "2020-10-22T11:26:28Z", "url": "https://github.com/apache/iotdb/pull/1846", "merged": true, "mergeCommit": {"oid": "699998f8d16ee638f0154e8693e54fd6aef5ddde"}, "closed": true, "closedAt": "2020-10-29T03:29:35Z", "author": {"login": "Alima777"}, "timelineItems": {"totalCount": 20, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcMepfvgH2gAyNTA4MjE4MzkxOjI2M2I3ODM1ZTI1Yzk5MTRjNzNiY2JiODFjMDkxNzQxZGM1YjNjNGU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdXH22CAFqTUxOTI2ODI4OQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "263b7835e25c9914c73bcbb81c091741dc5b3c4e", "author": {"user": {"login": "qiaojialin", "name": "Jialin Qiao"}}, "url": "https://github.com/apache/iotdb/commit/263b7835e25c9914c73bcbb81c091741dc5b3c4e", "committedDate": "2020-03-11T03:35:39Z", "message": "Update docs/Documentation-CHN/UserGuide/5-Operation Manual/4-SQL Reference.md"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "63d5b09b4cc4f194bbd2ea083fda67b4c8c6c8be", "author": {"user": {"login": "qiaojialin", "name": "Jialin Qiao"}}, "url": "https://github.com/apache/iotdb/commit/63d5b09b4cc4f194bbd2ea083fda67b4c8c6c8be", "committedDate": "2020-03-11T03:35:46Z", "message": "Update docs/Documentation/UserGuide/5-Operation Manual/4-SQL Reference.md"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e705465f975fc8c36019ca3956558ec1231c0d6d", "author": {"user": {"login": "Alima777", "name": "Xiangwei Wei"}}, "url": "https://github.com/apache/iotdb/commit/e705465f975fc8c36019ca3956558ec1231c0d6d", "committedDate": "2020-10-08T06:45:01Z", "message": "Merge branch 'master' of https://github.com/apache/iotdb"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8636472a1f1c52dae952e5729635030459b4777f", "author": {"user": {"login": "Alima777", "name": "Xiangwei Wei"}}, "url": "https://github.com/apache/iotdb/commit/8636472a1f1c52dae952e5729635030459b4777f", "committedDate": "2020-10-22T11:25:01Z", "message": "modify session timezone"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6b120560a42dde2c6f48369e882c676aa201af1e", "author": {"user": {"login": "Alima777", "name": "Xiangwei Wei"}}, "url": "https://github.com/apache/iotdb/commit/6b120560a42dde2c6f48369e882c676aa201af1e", "committedDate": "2020-10-22T11:25:30Z", "message": "modify typo"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4a45fe55ec9ebff4b39fdf0b4b8c2bfd08c209a0", "author": {"user": {"login": "Alima777", "name": "Xiangwei Wei"}}, "url": "https://github.com/apache/iotdb/commit/4a45fe55ec9ebff4b39fdf0b4b8c2bfd08c209a0", "committedDate": "2020-10-22T11:58:28Z", "message": "modify session Constructor"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ce7b4f5d4b50d3b34b6c133f01c1cf4e935371ad", "author": {"user": {"login": "Alima777", "name": "Xiangwei Wei"}}, "url": "https://github.com/apache/iotdb/commit/ce7b4f5d4b50d3b34b6c133f01c1cf4e935371ad", "committedDate": "2020-10-22T12:03:06Z", "message": "modify typo"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6cd85e176958bc1d7b99164c24c88c10f624dac5", "author": {"user": {"login": "Alima777", "name": "Xiangwei Wei"}}, "url": "https://github.com/apache/iotdb/commit/6cd85e176958bc1d7b99164c24c88c10f624dac5", "committedDate": "2020-10-22T12:04:15Z", "message": "rename timezone"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "81079d18575dbd540c03eb5475184fb9cba65bea", "author": {"user": {"login": "Alima777", "name": "Xiangwei Wei"}}, "url": "https://github.com/apache/iotdb/commit/81079d18575dbd540c03eb5475184fb9cba65bea", "committedDate": "2020-10-22T12:23:23Z", "message": "string to zoneId"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4771a8ddcde3be096db0b3001b8e718369baf20e", "author": {"user": {"login": "Alima777", "name": "Xiangwei Wei"}}, "url": "https://github.com/apache/iotdb/commit/4771a8ddcde3be096db0b3001b8e718369baf20e", "committedDate": "2020-10-26T02:01:34Z", "message": "Merge pull request #2 from apache/master\n\nmerge master"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE2NjkzMjYy", "url": "https://github.com/apache/iotdb/pull/1846#pullrequestreview-516693262", "createdAt": "2020-10-26T11:37:46Z", "commit": {"oid": "81079d18575dbd540c03eb5475184fb9cba65bea"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yNlQxMTozNzo0NlrOHoLprA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yNlQxMTo0MDozMFrOHoLvHg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTg5NTk4MA==", "bodyText": "There is something wrong with the logic.\nIt should be the default value that the server stores when the client is not registered with the server.", "url": "https://github.com/apache/iotdb/pull/1846#discussion_r511895980", "createdAt": "2020-10-26T11:37:46Z", "author": {"login": "liutaohua"}, "path": "session/src/main/java/org/apache/iotdb/session/Session.java", "diffHunk": "@@ -916,23 +922,14 @@ public boolean checkTimeseriesExists(String path)\n     return result;\n   }\n \n-  private synchronized String getTimeZone()\n-      throws StatementExecutionException, IoTDBConnectionException {\n+  private synchronized String getTimeZone() {\n     if (zoneId != null) {\n       return zoneId.toString();\n     }\n-\n-    TSGetTimeZoneResp resp;\n-    try {\n-      resp = client.getTimeZone(sessionId);\n-    } catch (TException e) {\n-      throw new IoTDBConnectionException(e);\n-    }\n-    RpcUtils.verifySuccess(resp.getStatus());\n-    return resp.getTimeZone();\n+    return ZoneId.systemDefault().getId();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "81079d18575dbd540c03eb5475184fb9cba65bea"}, "originalPosition": 124}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTg5NzM3NA==", "bodyText": "There may be a bug here, because the value stored by the server does not necessarily change when an error is encountered, but the local cached zoneId does", "url": "https://github.com/apache/iotdb/pull/1846#discussion_r511897374", "createdAt": "2020-10-26T11:40:30Z", "author": {"login": "liutaohua"}, "path": "session/src/main/java/org/apache/iotdb/session/Session.java", "diffHunk": "@@ -916,23 +922,14 @@ public boolean checkTimeseriesExists(String path)\n     return result;\n   }\n \n-  private synchronized String getTimeZone()\n-      throws StatementExecutionException, IoTDBConnectionException {\n+  private synchronized String getTimeZone() {\n     if (zoneId != null) {\n       return zoneId.toString();\n     }\n-\n-    TSGetTimeZoneResp resp;\n-    try {\n-      resp = client.getTimeZone(sessionId);\n-    } catch (TException e) {\n-      throw new IoTDBConnectionException(e);\n-    }\n-    RpcUtils.verifySuccess(resp.getStatus());\n-    return resp.getTimeZone();\n+    return ZoneId.systemDefault().getId();\n   }\n \n-  private synchronized void setTimeZone(String zoneId)\n+  public synchronized void setTimeZone(String zoneId)\n       throws StatementExecutionException, IoTDBConnectionException {\n     TSSetTimeZoneReq req = new TSSetTimeZoneReq(sessionId, zoneId);\n     TSStatus resp;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "81079d18575dbd540c03eb5475184fb9cba65bea"}, "originalPosition": 131}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a1ab2c6903cdc7b0df4de8ab88e680061c8702cd", "author": {"user": {"login": "Alima777", "name": "Xiangwei Wei"}}, "url": "https://github.com/apache/iotdb/commit/a1ab2c6903cdc7b0df4de8ab88e680061c8702cd", "committedDate": "2020-10-26T11:53:23Z", "message": "Merge branch 'timezone' of github.com:Alima777/incubator-iotdb into timezone"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ade0b5929132e40bed2bd3cb49ef0b8f5ebf4b50", "author": {"user": {"login": "Alima777", "name": "Xiangwei Wei"}}, "url": "https://github.com/apache/iotdb/commit/ade0b5929132e40bed2bd3cb49ef0b8f5ebf4b50", "committedDate": "2020-10-26T14:26:23Z", "message": "remove timezone in server side"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "55f54a478a935120f7ee3894918b70897c7f49e5", "author": {"user": {"login": "Alima777", "name": "Xiangwei Wei"}}, "url": "https://github.com/apache/iotdb/commit/55f54a478a935120f7ee3894918b70897c7f49e5", "committedDate": "2020-10-26T14:27:25Z", "message": "modify getTimeZone()"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b37e419566cb91b455f78f4a6271102f149fe35c", "author": {"user": {"login": "Alima777", "name": "Xiangwei Wei"}}, "url": "https://github.com/apache/iotdb/commit/b37e419566cb91b455f78f4a6271102f149fe35c", "committedDate": "2020-10-26T14:47:44Z", "message": "recover some comments"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE3MzY5NDMw", "url": "https://github.com/apache/iotdb/pull/1846#pullrequestreview-517369430", "createdAt": "2020-10-27T06:00:27Z", "commit": {"oid": "b37e419566cb91b455f78f4a6271102f149fe35c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yN1QwNjowMDoyN1rOHosg2A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yN1QwNjowMDoyN1rOHosg2A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjQzNDM5Mg==", "bodyText": "So we have to fill a null to the constructor of SessionPool if we don't want to set timezone, right?\nI think we'd better don't change these tests and add an extra test of setting timezone.", "url": "https://github.com/apache/iotdb/pull/1846#discussion_r512434392", "createdAt": "2020-10-27T06:00:27Z", "author": {"login": "HTHou"}, "path": "session/src/test/java/org/apache/iotdb/session/pool/SessionPoolTest.java", "diffHunk": "@@ -163,7 +163,7 @@ private void correctQuery(SessionPool pool) {\n \n   @Test\n   public void tryIfTheServerIsRestart() {\n-    SessionPool pool = new SessionPool(\"127.0.0.1\", 6667, \"root\", \"root\", 3, 1, 6000, false);\n+    SessionPool pool = new SessionPool(\"127.0.0.1\", 6667, \"root\", \"root\", 3, 1, 6000, false, null);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b37e419566cb91b455f78f4a6271102f149fe35c"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE3MzY5NDU2", "url": "https://github.com/apache/iotdb/pull/1846#pullrequestreview-517369456", "createdAt": "2020-10-27T06:00:32Z", "commit": {"oid": "b37e419566cb91b455f78f4a6271102f149fe35c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yN1QwNjowMDozMlrOHosg7w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yN1QwNjowMDozMlrOHosg7w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjQzNDQxNQ==", "bodyText": "Please update thrift/rpc-changelist.md.", "url": "https://github.com/apache/iotdb/pull/1846#discussion_r512434415", "createdAt": "2020-10-27T06:00:32Z", "author": {"login": "HTHou"}, "path": "thrift/src/main/thrift/rpc.thrift", "diffHunk": "@@ -79,9 +79,10 @@ struct TSOpenSessionResp {\n // Open a session (connection) on the server against which operations may be executed.\n struct TSOpenSessionReq {\n   1: required TSProtocolVersion client_protocol = TSProtocolVersion.IOTDB_SERVICE_PROTOCOL_V3\n-  2: optional string username\n-  3: optional string password\n-  4: optional map<string, string> configuration\n+  2: required string zoneId\n+  3: optional string username\n+  4: optional string password\n+  5: optional map<string, string> configuration", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b37e419566cb91b455f78f4a6271102f149fe35c"}, "originalPosition": 10}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c52785142c0ab22047071bf8d081d6b06b109acf", "author": {"user": {"login": "Alima777", "name": "Xiangwei Wei"}}, "url": "https://github.com/apache/iotdb/commit/c52785142c0ab22047071bf8d081d6b06b109acf", "committedDate": "2020-10-27T10:47:40Z", "message": "modify rpc-changelist.md"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "16734bdde94cafeb26dca36c1324f0eb65240840", "author": {"user": {"login": "Alima777", "name": "Xiangwei Wei"}}, "url": "https://github.com/apache/iotdb/commit/16734bdde94cafeb26dca36c1324f0eb65240840", "committedDate": "2020-10-28T09:03:26Z", "message": "add timezone test"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE5MjY4Mjg5", "url": "https://github.com/apache/iotdb/pull/1846#pullrequestreview-519268289", "createdAt": "2020-10-29T01:26:44Z", "commit": {"oid": "16734bdde94cafeb26dca36c1324f0eb65240840"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3719, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}