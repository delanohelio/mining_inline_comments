{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE1MTk0OTQ5", "number": 1174, "title": "Concurrently write time partition", "bodyText": "use concurrently write time partition config to replace max memtable number in each storage group", "createdAt": "2020-05-08T11:48:15Z", "url": "https://github.com/apache/iotdb/pull/1174", "merged": true, "mergeCommit": {"oid": "6fe6501585223b633e5abf5060cf24618be23cc8"}, "closed": true, "closedAt": "2020-05-15T01:37:14Z", "author": {"login": "SilverNarcissus"}, "timelineItems": {"totalCount": 20, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcBMiFnAH2gAyNDE1MTk0OTQ5OmNlODQxZWZjZWM1NjJlZGNkODBjMzBmYmY4MzYxZjg5MmJlMGRiZjA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABchXs99gFqTQxMjI4NzM0MQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "ce841efcec562edcd80c30fbf8361f892be0dbf0", "author": {"user": {"login": "SilverNarcissus", "name": null}}, "url": "https://github.com/apache/iotdb/commit/ce841efcec562edcd80c30fbf8361f892be0dbf0", "committedDate": "2020-02-05T02:16:06Z", "message": "Merge branch 'master' of https://github.com/apache/incubator-iotdb"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c82abe4d67253a889a4dedbe18bf28bd9b62b921", "author": {"user": {"login": "SilverNarcissus", "name": null}}, "url": "https://github.com/apache/iotdb/commit/c82abe4d67253a889a4dedbe18bf28bd9b62b921", "committedDate": "2020-02-11T01:32:18Z", "message": "Merge branch 'master' of https://github.com/apache/incubator-iotdb"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "202e7fa8b36d8487e6a7b1f9b641786608c2891b", "author": {"user": {"login": "SilverNarcissus", "name": null}}, "url": "https://github.com/apache/iotdb/commit/202e7fa8b36d8487e6a7b1f9b641786608c2891b", "committedDate": "2020-02-17T01:19:37Z", "message": "Merge branch 'master' of https://github.com/apache/incubator-iotdb"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "610082b233713e76f2a8067724cb7dc3de60938e", "author": {"user": {"login": "SilverNarcissus", "name": null}}, "url": "https://github.com/apache/iotdb/commit/610082b233713e76f2a8067724cb7dc3de60938e", "committedDate": "2020-02-17T02:20:25Z", "message": "add time partition when recovery"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "829e6a883704bdbe0e6dcc34a6b3cdca4fd83ce4", "author": {"user": {"login": "SilverNarcissus", "name": null}}, "url": "https://github.com/apache/iotdb/commit/829e6a883704bdbe0e6dcc34a6b3cdca4fd83ce4", "committedDate": "2020-02-19T11:55:08Z", "message": "Merge branch 'master' of https://github.com/apache/incubator-iotdb"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "890566ed46eef36c6b2be09fc9bfa634f6c166bf", "author": {"user": {"login": "SilverNarcissus", "name": null}}, "url": "https://github.com/apache/iotdb/commit/890566ed46eef36c6b2be09fc9bfa634f6c166bf", "committedDate": "2020-02-26T08:23:14Z", "message": "Merge branch 'master' of https://github.com/apache/incubator-iotdb"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "45d9323493116511f1f2aeb5ce0d1707c4dc2ea6", "author": {"user": {"login": "SilverNarcissus", "name": null}}, "url": "https://github.com/apache/iotdb/commit/45d9323493116511f1f2aeb5ce0d1707c4dc2ea6", "committedDate": "2020-03-27T10:45:03Z", "message": "merge"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2f0465a32097202eda3422ab4bb7b362c6169f5c", "author": {"user": {"login": "SilverNarcissus", "name": null}}, "url": "https://github.com/apache/iotdb/commit/2f0465a32097202eda3422ab4bb7b362c6169f5c", "committedDate": "2020-03-27T10:45:59Z", "message": "fix deletion bug"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "693832e459d59baa365301dbbf6868eb8d7b6ab7", "author": {"user": {"login": "SilverNarcissus", "name": null}}, "url": "https://github.com/apache/iotdb/commit/693832e459d59baa365301dbbf6868eb8d7b6ab7", "committedDate": "2020-03-27T10:47:27Z", "message": "Revert \"fix deletion bug\"\n\nThis reverts commit 2f0465a32097202eda3422ab4bb7b362c6169f5c."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "275fe1816f1a7fa88f439af7ee3960730abd3a56", "author": {"user": {"login": "SilverNarcissus", "name": null}}, "url": "https://github.com/apache/iotdb/commit/275fe1816f1a7fa88f439af7ee3960730abd3a56", "committedDate": "2020-04-23T02:37:13Z", "message": "Merge branch 'master' of https://github.com/apache/incubator-iotdb"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "495eabb3b61dfb5d672c1e46168ecba02c2b42d4", "author": {"user": {"login": "SilverNarcissus", "name": null}}, "url": "https://github.com/apache/iotdb/commit/495eabb3b61dfb5d672c1e46168ecba02c2b42d4", "committedDate": "2020-05-01T02:57:34Z", "message": "Merge branch 'master' of https://github.com/apache/incubator-iotdb"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "24b3da2f2a9e14c89bf90f9488afc1cc2eab5ece", "author": {"user": {"login": "SilverNarcissus", "name": null}}, "url": "https://github.com/apache/iotdb/commit/24b3da2f2a9e14c89bf90f9488afc1cc2eab5ece", "committedDate": "2020-05-08T02:49:41Z", "message": "Merge branch 'master' of https://github.com/apache/incubator-iotdb"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "77677dea2a0005ff6aba512756395e63862f8e3e", "author": {"user": {"login": "SilverNarcissus", "name": null}}, "url": "https://github.com/apache/iotdb/commit/77677dea2a0005ff6aba512756395e63862f8e3e", "committedDate": "2020-05-08T03:15:42Z", "message": "init"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA4Njk3MjYx", "url": "https://github.com/apache/iotdb/pull/1174#pullrequestreview-408697261", "createdAt": "2020-05-10T01:42:39Z", "commit": {"oid": "77677dea2a0005ff6aba512756395e63862f8e3e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMFQwMTo0MjozOVrOGS_oXA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMFQwMTo0MjozOVrOGS_oXA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjU3MDA3Ng==", "bodyText": "format back", "url": "https://github.com/apache/iotdb/pull/1174#discussion_r422570076", "createdAt": "2020-05-10T01:42:39Z", "author": {"login": "qiaojialin"}, "path": "server/src/main/java/org/apache/iotdb/db/conf/adapter/IoTDBConfigDynamicAdapter.java", "diffHunk": "@@ -30,86 +30,70 @@\n  * This class is to dynamically adjust some important parameters of the system, determine the speed\n  * of MenTable brushing disk, the speed of file sealing and so on, with the continuous change of\n  * load in the process of system operation.\n- *\n+ * <p>\n  * There are three dynamically adjustable parameters: maxMemTableNum, memtableSize and\n  * tsFileSizeThreshold.\n- *\n+ * <p>\n  * 1. maxMemTableNum. This parameter represents the size of the MemTable available in the MemTable\n  * pool, which is closely related to the number of storage groups. When adding or deleting a storage\n  * group, the parameter also adds or deletes four MemTables. The reason why adding or deleting four\n  * MemTables is that when the system is running stably, the speed of the flush operation is faster\n  * than that of data writing, so one is used for the Flush process and the other is used for data\n  * writing. Otherwise, the system should limit the speed of data writing to maintain stability. And\n  * two for sequence data, two for unsequence data.\n- *\n+ * <p>\n  * 2. memtableSize. This parameter determines the threshold value for the MemTable in memory to be\n  * flushed into disk. When the system load increases, the parameter should be set smaller so that\n  * the data in memory can be flushed into disk as soon as possible.\n- *\n+ * <p>\n  * 3. tsFileSizeThreshold. This parameter determines the speed of the tsfile seal, and then\n  * determines the maximum size of metadata information maintained in memory. When the system load\n  * increases, the parameter should be smaller to seal the file as soon as possible, release the\n  * memory occupied by the corresponding metadata information as soon as possible.\n- *\n+ * <p>\n  * The following equation is used to adjust the dynamic parameters of the data:\n- *\n- * Abbreviation of parameters:\n- * 1 memtableSize: m\n- * 2 maxMemTableNum: Nm\n- * 3 maxSeriesNumberAmongStorageGroup: Ns\n- * 4 tsFileSizeThreshold: Sf\n- * 5 CompressionRatio: c\n- * 6 chunk metadata size: a\n- * 7 static memory: b\n- * 8 allocate memory for write: S\n- *\n- * The equation: m * Nm + Nm * Ns * Sf * a * c / m + b = S\n- * Namely: MemTable data memory size + chunk metadata memory size + static memory size = memory size for write\n- *\n+ * <p>\n+ * Abbreviation of parameters: 1 memtableSize: m 2 maxMemTableNum: Nm 3\n+ * maxSeriesNumberAmongStorageGroup: Ns 4 tsFileSizeThreshold: Sf 5 CompressionRatio: c 6 chunk\n+ * metadata size: a 7 static memory: b 8 allocate memory for write: S\n+ * <p>\n+ * The equation: m * Nm + Nm * Ns * Sf * a * c / m + b = S Namely: MemTable data memory size + chunk\n+ * metadata memory size + static memory size = memory size for write", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "77677dea2a0005ff6aba512756395e63862f8e3e"}, "originalPosition": 51}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d5f4b5f218064c042aba836e84a3e9c6b8e354e3", "author": {"user": {"login": "SilverNarcissus", "name": null}}, "url": "https://github.com/apache/iotdb/commit/d5f4b5f218064c042aba836e84a3e9c6b8e354e3", "committedDate": "2020-05-11T01:08:50Z", "message": "reformat"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dd2173c34eebad6d9bcec36ef5ef74e83391b5c6", "author": {"user": {"login": "SilverNarcissus", "name": null}}, "url": "https://github.com/apache/iotdb/commit/dd2173c34eebad6d9bcec36ef5ef74e83391b5c6", "committedDate": "2020-05-11T10:00:32Z", "message": "fix test"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEwNjc4MTU1", "url": "https://github.com/apache/iotdb/pull/1174#pullrequestreview-410678155", "createdAt": "2020-05-13T07:59:06Z", "commit": {"oid": "dd2173c34eebad6d9bcec36ef5ef74e83391b5c6"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QwNzo1OTowNlrOGUl3vA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QwNzo1OTowNlrOGUl3vA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDI0NTE4MA==", "bodyText": "why divide 4?", "url": "https://github.com/apache/iotdb/pull/1174#discussion_r424245180", "createdAt": "2020-05-13T07:59:06Z", "author": {"login": "jixuan1989"}, "path": "server/src/main/java/org/apache/iotdb/db/engine/storagegroup/TsFileProcessor.java", "diffHunk": "@@ -276,7 +275,7 @@ private long getMemtableSizeThresholdBasedOnSeriesNum() {\n       return config.getMemtableSizeThreshold();\n     }\n     long memTableSize = (long) (config.getMemtableSizeThreshold() * config.getMaxMemtableNumber()\n-        / IoTDBDescriptor.getInstance().getConfig().getMemtableNumInEachStorageGroup()\n+        / IoTDBDescriptor.getInstance().getConfig().getConcurrentWritingTimePartition() / 4", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dd2173c34eebad6d9bcec36ef5ef74e83391b5c6"}, "originalPosition": 13}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEwNjc5NDQ0", "url": "https://github.com/apache/iotdb/pull/1174#pullrequestreview-410679444", "createdAt": "2020-05-13T08:00:49Z", "commit": {"oid": "dd2173c34eebad6d9bcec36ef5ef74e83391b5c6"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QwODowMDo0OVrOGUl7sw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QwODowMDo0OVrOGUl7sw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDI0NjE5NQ==", "bodyText": "The same issue, set 4 as const and a reference from addOrDeleteStorageGroup()", "url": "https://github.com/apache/iotdb/pull/1174#discussion_r424246195", "createdAt": "2020-05-13T08:00:49Z", "author": {"login": "jixuan1989"}, "path": "server/src/test/java/org/apache/iotdb/db/conf/adapter/IoTDBConfigDynamicAdapterTest.java", "diffHunk": "@@ -66,7 +66,7 @@ public void addOrDeleteStorageGroup() throws ConfigAdjusterException {\n     for (int i = 1; i < 1000000; i++) {\n       try {\n         IoTDBConfigDynamicAdapter.getInstance().addOrDeleteStorageGroup(1);\n-        memTableNum += IoTDBDescriptor.getInstance().getConfig().getMemtableNumInEachStorageGroup();\n+        memTableNum += IoTDBDescriptor.getInstance().getConfig().getConcurrentWritingTimePartition() * 4 + 1;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dd2173c34eebad6d9bcec36ef5ef74e83391b5c6"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fdce56576e350e637e7ccde94bb2673974c78ca9", "author": {"user": {"login": "SilverNarcissus", "name": null}}, "url": "https://github.com/apache/iotdb/commit/fdce56576e350e637e7ccde94bb2673974c78ca9", "committedDate": "2020-05-13T12:08:29Z", "message": "fix bug"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEyMjg3MzQx", "url": "https://github.com/apache/iotdb/pull/1174#pullrequestreview-412287341", "createdAt": "2020-05-15T01:22:31Z", "commit": {"oid": "fdce56576e350e637e7ccde94bb2673974c78ca9"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3834, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}