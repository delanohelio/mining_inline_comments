{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzgyOTUzMTAz", "number": 877, "title": "add groupByExecutor main method doc", "bodyText": "", "createdAt": "2020-03-03T13:32:48Z", "url": "https://github.com/apache/iotdb/pull/877", "merged": true, "mergeCommit": {"oid": "b5a7227fdd9525b2451cef22f9e7e3a62ff191f4"}, "closed": true, "closedAt": "2020-03-03T15:12:55Z", "author": {"login": "liutaohua"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcKCYgRAH2gAyMzgyOTUzMTAzOmU5M2MzOGNhYjUxMzc2MTVlZGExNjVjMmVmYmUxM2E3NGU2MTU0YzM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcKDwszAH2gAyMzgyOTUzMTAzOmQ2YTY3ZjcyNjg1ZjdmMTJmZTI0YmJmYzhkMWYzZGY4YzMzNGYyM2Q=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "e93c38cab5137615eda165c2efbe13a74e6154c3", "author": {"user": null}, "url": "https://github.com/apache/iotdb/commit/e93c38cab5137615eda165c2efbe13a74e6154c3", "committedDate": "2020-03-03T13:31:54Z", "message": "add groupByExecutor main method doc"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY3OTg0MzI0", "url": "https://github.com/apache/iotdb/pull/877#pullrequestreview-367984324", "createdAt": "2020-03-03T13:40:20Z", "commit": {"oid": "e93c38cab5137615eda165c2efbe13a74e6154c3"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wM1QxMzo0MDoyMFrOFxGFYA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wM1QxMzo0MDoyMFrOFxGFYA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzAyNDIyNA==", "bodyText": "add a blank line before ```", "url": "https://github.com/apache/iotdb/pull/877#discussion_r387024224", "createdAt": "2020-03-03T13:40:20Z", "author": {"login": "qiaojialin"}, "path": "docs/Documentation-CHN/SystemDesign/5-DataQuery/5-GroupByQuery.md", "diffHunk": "@@ -111,17 +115,83 @@ private void calcFromBatch(BatchData batchData) throws IOException;\n //\u4f7f\u7528 Page \u6216 Chunk \u7684 Statistics \u4fe1\u606f\u76f4\u63a5\u8ba1\u7b97\u7ed3\u679c\n private void calcFromStatistics(Statistics statistics) throws QueryProcessException;\n \n-//\u4ece reader \u4e2d\u8bfb\u53d6\u6570\u636e\uff0c\u5e76\u8ba1\u7b97\n-private List<Pair<AggregateResult, Integer>> calcResult() throws IOException, QueryProcessException;\n-\n //\u6e05\u7a7a\u6240\u6709\u8ba1\u7b97\u7ed3\u679c\n private void resetAggregateResults();\n \n //\u904d\u5386\u5e76\u8ba1\u7b97 page \u4e2d\u7684\u6570\u636e\n private boolean readAndCalcFromPage() throws IOException, QueryProcessException;\n \n ```\n-`GroupByExecutor` \u4e2d\u56e0\u4e3a\u76f8\u540c `path` \u7684\u4e0d\u540c\u805a\u5408\u51fd\u6570\u4f7f\u7528\u7684\u6570\u636e\u662f\u76f8\u540c\u7684\uff0c\u6240\u4ee5 `calcFromBatch` \u65b9\u6cd5\u5c31\u662f\u5b8c\u6210\u904d\u5386\u6240\u6709\u805a\u5408\u51fd\u6570\u5bf9 `BatchData` \u7684\u8ba1\u7b97:\n+`GroupByExecutor` \u4e2d\u56e0\u4e3a\u76f8\u540c `path` \u7684\u4e0d\u540c\u805a\u5408\u51fd\u6570\u4f7f\u7528\u7684\u6570\u636e\u662f\u76f8\u540c\u7684\uff0c\u6240\u4ee5\u5728\u5165\u53e3\u65b9\u6cd5 `calcResult` \u4e2d\u8d1f\u8d23\u8bfb\u53d6\u8be5 `Path` \u7684\u6240\u6709\u6570\u636e,\n+\u53d6\u51fa\u6765\u7684\u6570\u636e\u518d\u8c03\u7528 `calcFromBatch` \u65b9\u6cd5\u5b8c\u6210\u904d\u5386\u6240\u6709\u805a\u5408\u51fd\u6570\u5bf9 `BatchData` \u7684\u8ba1\u7b97\u3002\n+\n+`calcResult` \u65b9\u6cd5\u7684\u4e3b\u8981\u903b\u8f91\uff1a\n+```", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e93c38cab5137615eda165c2efbe13a74e6154c3"}, "originalPosition": 30}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "657af6465d2aba2f14aa75f453c8f32b1fd623a0", "author": {"user": null}, "url": "https://github.com/apache/iotdb/commit/657af6465d2aba2f14aa75f453c8f32b1fd623a0", "committedDate": "2020-03-03T13:42:14Z", "message": "typo"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cd8131ba1464fc8e3fd5b74cb03fa4ecad633542", "author": {"user": null}, "url": "https://github.com/apache/iotdb/commit/cd8131ba1464fc8e3fd5b74cb03fa4ecad633542", "committedDate": "2020-03-03T13:43:00Z", "message": "typo"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7752cec26d28c26ec696c9a2ebcdb4392b1d0011", "author": {"user": null}, "url": "https://github.com/apache/iotdb/commit/7752cec26d28c26ec696c9a2ebcdb4392b1d0011", "committedDate": "2020-03-03T13:54:14Z", "message": "typo"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY4MDQ4NTMw", "url": "https://github.com/apache/iotdb/pull/877#pullrequestreview-368048530", "createdAt": "2020-03-03T14:57:10Z", "commit": {"oid": "7752cec26d28c26ec696c9a2ebcdb4392b1d0011"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wM1QxNDo1NzoxMFrOFxJOEA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wM1QxNDo1NzoxMFrOFxJOEA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzA3NTYwMA==", "bodyText": "\u52a0\u4e00\u4e2a\u8fd4\u56de\u503c\u7684\u4ecb\u7ecd", "url": "https://github.com/apache/iotdb/pull/877#discussion_r387075600", "createdAt": "2020-03-03T14:57:10Z", "author": {"login": "qiaojialin"}, "path": "docs/Documentation-CHN/SystemDesign/5-DataQuery/5-GroupByQuery.md", "diffHunk": "@@ -111,17 +114,87 @@ private void calcFromBatch(BatchData batchData) throws IOException;\n //\u4f7f\u7528 Page \u6216 Chunk \u7684 Statistics \u4fe1\u606f\u76f4\u63a5\u8ba1\u7b97\u7ed3\u679c\n private void calcFromStatistics(Statistics statistics) throws QueryProcessException;\n \n-//\u4ece reader \u4e2d\u8bfb\u53d6\u6570\u636e\uff0c\u5e76\u8ba1\u7b97\n-private List<Pair<AggregateResult, Integer>> calcResult() throws IOException, QueryProcessException;\n-\n //\u6e05\u7a7a\u6240\u6709\u8ba1\u7b97\u7ed3\u679c\n private void resetAggregateResults();\n \n //\u904d\u5386\u5e76\u8ba1\u7b97 page \u4e2d\u7684\u6570\u636e\n private boolean readAndCalcFromPage() throws IOException, QueryProcessException;\n \n ```\n-`GroupByExecutor` \u4e2d\u56e0\u4e3a\u76f8\u540c `path` \u7684\u4e0d\u540c\u805a\u5408\u51fd\u6570\u4f7f\u7528\u7684\u6570\u636e\u662f\u76f8\u540c\u7684\uff0c\u6240\u4ee5 `calcFromBatch` \u65b9\u6cd5\u5c31\u662f\u5b8c\u6210\u904d\u5386\u6240\u6709\u805a\u5408\u51fd\u6570\u5bf9 `BatchData` \u7684\u8ba1\u7b97:\n+\n+`GroupByExecutor` \u4e2d\u56e0\u4e3a\u76f8\u540c `path` \u7684\u4e0d\u540c\u805a\u5408\u51fd\u6570\u4f7f\u7528\u7684\u6570\u636e\u662f\u76f8\u540c\u7684\uff0c\u6240\u4ee5\u5728\u5165\u53e3\u65b9\u6cd5 `calcResult` \u4e2d\u8d1f\u8d23\u8bfb\u53d6\u8be5 `Path` \u7684\u6240\u6709\u6570\u636e,\n+\u53d6\u51fa\u6765\u7684\u6570\u636e\u518d\u8c03\u7528 `calcFromBatch` \u65b9\u6cd5\u5b8c\u6210\u904d\u5386\u6240\u6709\u805a\u5408\u51fd\u6570\u5bf9 `BatchData` \u7684\u8ba1\u7b97\u3002\n+\n+`calcResult` \u65b9\u6cd5\u7684\u4e3b\u8981\u903b\u8f91\uff1a\n+\n+```\n+//\u628a\u4e0a\u6b21\u9057\u7559\u7684\u6570\u636e\u5148\u505a\u8ba1\u7b97\uff0c\u5982\u679c\u80fd\u76f4\u63a5\u83b7\u5f97\u7ed3\u679c\u5c31\u7ed3\u675f\u8ba1\u7b97\n+if (calcFromCacheData()) {\n+    return results;\n+}\n+\n+//\u56e0\u4e3a\u4e00\u4e2achunk\u662f\u5305\u542b\u591a\u4e2apage\u7684\uff0c\u90a3\u4e48\u5fc5\u987b\u5148\u4f7f\u7528\u5b8c\u5f53\u524dchunk\u7684page\uff0c\u518d\u6253\u5f00\u4e0b\u4e00\u4e2achunk\n+if (readAndCalcFromPage()) {\n+    return results;\n+}\n+\n+//\u9057\u7559\u7684\u6570\u636e\u5982\u679c\u8ba1\u7b97\u5b8c\u4e86\u5c31\u8981\u6253\u5f00\u65b0\u7684chunk\u7ee7\u7eed\u8ba1\u7b97\n+while (reader.hasNextChunk()) {\n+    Statistics chunkStatistics = reader.currentChunkStatistics();\n+      // \u5224\u65ad\u80fd\u5426\u4f7f\u7528pageStatistics\uff0c\u5e76\u6267\u884c\u8ba1\u7b97\n+       ....\n+      // \u8df3\u8fc7\u5f53\u524dchunk\n+      reader.skipCurrentChunk();\n+      // \u5982\u679c\u5df2\u7ecf\u83b7\u53d6\u5230\u4e86\u6240\u6709\u7ed3\u679c\u5c31\u7ed3\u675f\u8ba1\u7b97\n+      if (isEndCalc()) {\n+        return true;\n+      }\n+      continue;\n+    }\n+    //\u5982\u679c\u4e0d\u80fd\u4f7f\u7528 chunkStatistics \u5c31\u9700\u8981\u4f7f\u7528page\u6570\u636e\u8ba1\u7b97\n+    if (readAndCalcFromPage()) {\n+      return results;\n+    }\n+}\n+```\n+\n+`readAndCalcFromPage` \u65b9\u6cd5\u662f\u4ece\u5f53\u524d\u6253\u5f00\u7684chunk\u4e2d\u83b7\u53d6page\u7684\u6570\u636e\uff0c\u5e76\u8ba1\u7b97\u805a\u5408\u7ed3\u679c\uff0c\u4e3b\u8981\u903b\u8f91\uff1a", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7752cec26d28c26ec696c9a2ebcdb4392b1d0011"}, "originalPosition": 62}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cffae6966f1788d26996b565e96b971bf61bd6df", "author": {"user": null}, "url": "https://github.com/apache/iotdb/commit/cffae6966f1788d26996b565e96b971bf61bd6df", "committedDate": "2020-03-03T14:57:54Z", "message": "typo"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY4MDUxODE3", "url": "https://github.com/apache/iotdb/pull/877#pullrequestreview-368051817", "createdAt": "2020-03-03T15:00:53Z", "commit": {"oid": "cffae6966f1788d26996b565e96b971bf61bd6df"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d6a67f72685f7f12fe24bbfc8d1f3df8c334f23d", "author": {"user": null}, "url": "https://github.com/apache/iotdb/commit/d6a67f72685f7f12fe24bbfc8d1f3df8c334f23d", "committedDate": "2020-03-03T15:08:14Z", "message": "add return description"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3150, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}