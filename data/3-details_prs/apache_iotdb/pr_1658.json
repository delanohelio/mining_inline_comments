{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDc1MzA1ODY1", "number": 1658, "title": "[IOTDB-839] Make Tablet api more friendly", "bodyText": "", "createdAt": "2020-08-28T09:51:22Z", "url": "https://github.com/apache/iotdb/pull/1658", "merged": true, "mergeCommit": {"oid": "afafc7909347548ff1e7f0b896cb4c56bce315f4"}, "closed": true, "closedAt": "2020-09-01T09:24:14Z", "author": {"login": "yanhongwangg"}, "timelineItems": {"totalCount": 19, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdDR0AeAH2gAyNDc1MzA1ODY1OmRjNDAzZDMwZmFhNTY1YTAyYzE2YzkyMzg2NTE2YjVmY2JlYTg0OWU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdEjcOFAFqTQ3OTUyOTg2Mg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "dc403d30faa565a02c16c92386516b5fcbea849e", "author": {"user": {"login": "yanhongwangg", "name": "yanhong wang"}}, "url": "https://github.com/apache/iotdb/commit/dc403d30faa565a02c16c92386516b5fcbea849e", "committedDate": "2020-08-28T09:44:12Z", "message": "IOTDB-839:Make Tablet api more friendly"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc3NjA0OTA4", "url": "https://github.com/apache/iotdb/pull/1658#pullrequestreview-477604908", "createdAt": "2020-08-28T10:02:50Z", "commit": {"oid": "dc403d30faa565a02c16c92386516b5fcbea849e"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOFQxMDowMjo1MVrOHI3lzg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOFQxMDowNjo0OFrOHI342A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTA2MTQ1NA==", "bodyText": "It's not a good way to get the index, measurements maybe very large. You should store the measurementSchema as a map", "url": "https://github.com/apache/iotdb/pull/1658#discussion_r479061454", "createdAt": "2020-08-28T10:02:51Z", "author": {"login": "mychaow"}, "path": "tsfile/src/main/java/org/apache/iotdb/tsfile/write/record/Tablet.java", "diffHunk": "@@ -81,6 +82,43 @@ public Tablet(String deviceId, List<MeasurementSchema> timeseries) {\n     this(deviceId, timeseries, DEFAULT_SIZE);\n   }\n \n+  public void addTimestamp(int rowIndex, long timestamp) {\n+    timestamps[rowIndex - 1] = timestamp;\n+  }\n+\n+  public void addValue(MeasurementSchema measurementSchema, int rowIndex, Object value) {\n+\n+    int indexOfValue = schemas.indexOf(measurementSchema);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dc403d30faa565a02c16c92386516b5fcbea849e"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTA2NDkwMw==", "bodyText": "what is the meaning of this line?", "url": "https://github.com/apache/iotdb/pull/1658#discussion_r479064903", "createdAt": "2020-08-28T10:05:39Z", "author": {"login": "mychaow"}, "path": "tsfile/src/main/java/org/apache/iotdb/tsfile/write/record/Tablet.java", "diffHunk": "@@ -81,6 +82,43 @@ public Tablet(String deviceId, List<MeasurementSchema> timeseries) {\n     this(deviceId, timeseries, DEFAULT_SIZE);\n   }\n \n+  public void addTimestamp(int rowIndex, long timestamp) {\n+    timestamps[rowIndex - 1] = timestamp;\n+  }\n+\n+  public void addValue(MeasurementSchema measurementSchema, int rowIndex, Object value) {\n+\n+    int indexOfValue = schemas.indexOf(measurementSchema);\n+    if (measurementSchema.getType() == INT64) {\n+      long[] sensor = (long[]) values[indexOfValue];\n+      sensor[rowIndex - 1] = (long) value;\n+      values[indexOfValue] = sensor;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dc403d30faa565a02c16c92386516b5fcbea849e"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTA2NjMyOA==", "bodyText": "rowIndex maybe starts with 0?", "url": "https://github.com/apache/iotdb/pull/1658#discussion_r479066328", "createdAt": "2020-08-28T10:06:48Z", "author": {"login": "mychaow"}, "path": "tsfile/src/main/java/org/apache/iotdb/tsfile/write/record/Tablet.java", "diffHunk": "@@ -81,6 +82,43 @@ public Tablet(String deviceId, List<MeasurementSchema> timeseries) {\n     this(deviceId, timeseries, DEFAULT_SIZE);\n   }\n \n+  public void addTimestamp(int rowIndex, long timestamp) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dc403d30faa565a02c16c92386516b5fcbea849e"}, "originalPosition": 12}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "178558ae0841033a5c3ab6a1d51f6dbce35e3caf", "author": {"user": {"login": "yanhongwangg", "name": "yanhong wang"}}, "url": "https://github.com/apache/iotdb/commit/178558ae0841033a5c3ab6a1d51f6dbce35e3caf", "committedDate": "2020-08-28T12:43:03Z", "message": "IOTDB-839:Add map in tablet to record measurement -> index"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ba862eff4807c7647835734846968c7692d5b61b", "author": {"user": {"login": "yanhongwangg", "name": "yanhong wang"}}, "url": "https://github.com/apache/iotdb/commit/ba862eff4807c7647835734846968c7692d5b61b", "committedDate": "2020-08-28T12:51:09Z", "message": "IOTDB-839:Add map in tablet to record measurement -> index"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc4MDkxMTc3", "url": "https://github.com/apache/iotdb/pull/1658#pullrequestreview-478091177", "createdAt": "2020-08-29T02:32:22Z", "commit": {"oid": "ba862eff4807c7647835734846968c7692d5b61b"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOVQwMjozMjoyMlrOHJYP0A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOVQwMjo0MDoxOVrOHJYSMg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTU5NjQ5Ng==", "bodyText": "switch (measurementSchema.getType())", "url": "https://github.com/apache/iotdb/pull/1658#discussion_r479596496", "createdAt": "2020-08-29T02:32:22Z", "author": {"login": "qiaojialin"}, "path": "tsfile/src/main/java/org/apache/iotdb/tsfile/write/record/Tablet.java", "diffHunk": "@@ -95,12 +103,48 @@ public Tablet(String deviceId, List<MeasurementSchema> schemas, int maxRowNumber\n     this.deviceId = deviceId;\n     this.schemas = schemas;\n     this.maxRowNumber = maxRowNumber;\n+    mschemawithindex=new HashMap<>();\n+\n+    for(int i=0;i<schemas.size();i++){\n+      mschemawithindex.put(schemas.get(i),i);\n+    }\n \n     createColumns();\n \n     reset();\n   }\n \n+  public void addTimestamp(int rowIndex, long timestamp) {\n+    timestamps[rowIndex] = timestamp;\n+  }\n+\n+  public void addValue(MeasurementSchema measurementSchema, int rowIndex, Object value) {\n+    int indexOfValue =mschemawithindex.get(measurementSchema);\n+\n+    if (measurementSchema.getType() == INT64) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ba862eff4807c7647835734846968c7692d5b61b"}, "originalPosition": 45}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTU5Njg3Ng==", "bodyText": "There is a java-google-style.xml under the root folder, import it as the default code style and format the code.\nIt should be something like this:\nfor(int i = 0; i < schemas.size(); i++){", "url": "https://github.com/apache/iotdb/pull/1658#discussion_r479596876", "createdAt": "2020-08-29T02:37:15Z", "author": {"login": "qiaojialin"}, "path": "tsfile/src/main/java/org/apache/iotdb/tsfile/write/record/Tablet.java", "diffHunk": "@@ -95,12 +103,48 @@ public Tablet(String deviceId, List<MeasurementSchema> schemas, int maxRowNumber\n     this.deviceId = deviceId;\n     this.schemas = schemas;\n     this.maxRowNumber = maxRowNumber;\n+    mschemawithindex=new HashMap<>();\n+\n+    for(int i=0;i<schemas.size();i++){", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ba862eff4807c7647835734846968c7692d5b61b"}, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTU5NzEwNg==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              public void addValue(MeasurementSchema measurementSchema, int rowIndex, Object value) {\n          \n          \n            \n              public void addValue(String measurement, int rowIndex, Object value) {\n          \n      \n    \n    \n  \n\nUsing measurement id may be more friendly to users.", "url": "https://github.com/apache/iotdb/pull/1658#discussion_r479597106", "createdAt": "2020-08-29T02:40:19Z", "author": {"login": "qiaojialin"}, "path": "tsfile/src/main/java/org/apache/iotdb/tsfile/write/record/Tablet.java", "diffHunk": "@@ -95,12 +103,48 @@ public Tablet(String deviceId, List<MeasurementSchema> schemas, int maxRowNumber\n     this.deviceId = deviceId;\n     this.schemas = schemas;\n     this.maxRowNumber = maxRowNumber;\n+    mschemawithindex=new HashMap<>();\n+\n+    for(int i=0;i<schemas.size();i++){\n+      mschemawithindex.put(schemas.get(i),i);\n+    }\n \n     createColumns();\n \n     reset();\n   }\n \n+  public void addTimestamp(int rowIndex, long timestamp) {\n+    timestamps[rowIndex] = timestamp;\n+  }\n+\n+  public void addValue(MeasurementSchema measurementSchema, int rowIndex, Object value) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ba862eff4807c7647835734846968c7692d5b61b"}, "originalPosition": 42}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc4MDkzMzQ3", "url": "https://github.com/apache/iotdb/pull/1658#pullrequestreview-478093347", "createdAt": "2020-08-29T03:11:55Z", "commit": {"oid": "ba862eff4807c7647835734846968c7692d5b61b"}, "state": "COMMENTED", "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOVQwMzoxMTo1NlrOHJYcvA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOVQwMzoyMDoxMVrOHJYffA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTU5OTgwNA==", "bodyText": "You should not delete the previous example, user also can use the previous way to add data.  You should add new code to show how to use.", "url": "https://github.com/apache/iotdb/pull/1658#discussion_r479599804", "createdAt": "2020-08-29T03:11:56Z", "author": {"login": "mychaow"}, "path": "example/session/src/main/java/org/apache/iotdb/SessionExample.java", "diffHunk": "@@ -247,15 +247,11 @@ private static void insertTablet() throws IoTDBConnectionException, StatementExe\n \n     Tablet tablet = new Tablet(\"root.sg1.d1\", schemaList, 100);\n \n-    long[] timestamps = tablet.timestamps;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ba862eff4807c7647835734846968c7692d5b61b"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTU5OTk4MA==", "bodyText": "It's not nesscessary to cast to long. You have done cast in the addValue.", "url": "https://github.com/apache/iotdb/pull/1658#discussion_r479599980", "createdAt": "2020-08-29T03:13:48Z", "author": {"login": "mychaow"}, "path": "example/session/src/main/java/org/apache/iotdb/SessionExample.java", "diffHunk": "@@ -247,15 +247,11 @@ private static void insertTablet() throws IoTDBConnectionException, StatementExe\n \n     Tablet tablet = new Tablet(\"root.sg1.d1\", schemaList, 100);\n \n-    long[] timestamps = tablet.timestamps;\n-    Object[] values = tablet.values;\n-\n     for (long time = 0; time < 100; time++) {\n-      int row = tablet.rowSize++;\n-      timestamps[row] = time;\n-      for (int i = 0; i < 3; i++) {\n-        long[] sensor = (long[]) values[i];\n-        sensor[row] = i;\n+      int rowIndex = tablet.rowSize++;\n+      tablet.addTimestamp(rowIndex, time);\n+      for (int s = 0; s < 3; s++) {\n+        tablet.addValue(schemaList.get(s), rowIndex, (long) s);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ba862eff4807c7647835734846968c7692d5b61b"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTYwMDI2Nw==", "bodyText": "same with the previous comment", "url": "https://github.com/apache/iotdb/pull/1658#discussion_r479600267", "createdAt": "2020-08-29T03:16:59Z", "author": {"login": "mychaow"}, "path": "session/src/test/java/org/apache/iotdb/session/IoTDBSessionIT.java", "diffHunk": "@@ -812,15 +811,11 @@ private void insertTabletTest1(String deviceId)\n \n     Tablet tablet = new Tablet(deviceId, schemaList, 100);\n \n-    long[] timestamps = tablet.timestamps;\n-    Object[] values = tablet.values;\n-\n     for (long time = 0; time < 100; time++) {\n-      int row = tablet.rowSize++;\n-      timestamps[row] = time;\n-      for (int i = 0; i < 3; i++) {\n-        long[] sensor = (long[]) values[i];\n-        sensor[row] = i;\n+      int rowIndex = tablet.rowSize++;\n+      tablet.addTimestamp(rowIndex, time);\n+      for (int s = 0; s < 3; s++) {\n+        tablet.addValue(schemaList.get(s), rowIndex, (long) s);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ba862eff4807c7647835734846968c7692d5b61b"}, "originalPosition": 35}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTYwMDQ3Ng==", "bodyText": "code should be\nfor (int i = 0; i < schemas.size(); i++) {}.  It's not wasteful to add blank in the code.", "url": "https://github.com/apache/iotdb/pull/1658#discussion_r479600476", "createdAt": "2020-08-29T03:19:53Z", "author": {"login": "mychaow"}, "path": "tsfile/src/main/java/org/apache/iotdb/tsfile/write/record/Tablet.java", "diffHunk": "@@ -95,12 +103,48 @@ public Tablet(String deviceId, List<MeasurementSchema> schemas, int maxRowNumber\n     this.deviceId = deviceId;\n     this.schemas = schemas;\n     this.maxRowNumber = maxRowNumber;\n+    mschemawithindex=new HashMap<>();\n+\n+    for(int i=0;i<schemas.size();i++){", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ba862eff4807c7647835734846968c7692d5b61b"}, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTYwMDUwOA==", "bodyText": "add blank", "url": "https://github.com/apache/iotdb/pull/1658#discussion_r479600508", "createdAt": "2020-08-29T03:20:11Z", "author": {"login": "mychaow"}, "path": "tsfile/src/main/java/org/apache/iotdb/tsfile/write/record/Tablet.java", "diffHunk": "@@ -95,12 +103,48 @@ public Tablet(String deviceId, List<MeasurementSchema> schemas, int maxRowNumber\n     this.deviceId = deviceId;\n     this.schemas = schemas;\n     this.maxRowNumber = maxRowNumber;\n+    mschemawithindex=new HashMap<>();\n+\n+    for(int i=0;i<schemas.size();i++){\n+      mschemawithindex.put(schemas.get(i),i);\n+    }\n \n     createColumns();\n \n     reset();\n   }\n \n+  public void addTimestamp(int rowIndex, long timestamp) {\n+    timestamps[rowIndex] = timestamp;\n+  }\n+\n+  public void addValue(MeasurementSchema measurementSchema, int rowIndex, Object value) {\n+    int indexOfValue =mschemawithindex.get(measurementSchema);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ba862eff4807c7647835734846968c7692d5b61b"}, "originalPosition": 43}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc4MDk1MjAw", "url": "https://github.com/apache/iotdb/pull/1658#pullrequestreview-478095200", "createdAt": "2020-08-29T03:48:01Z", "commit": {"oid": "ba862eff4807c7647835734846968c7692d5b61b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOVQwMzo0ODowMVrOHJYorA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOVQwMzo0ODowMVrOHJYorA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTYwMjg2MA==", "bodyText": "I think it's better to separate the rowIndex, the time column, and the value column, which would clearer to users.", "url": "https://github.com/apache/iotdb/pull/1658#discussion_r479602860", "createdAt": "2020-08-29T03:48:01Z", "author": {"login": "neuyilan"}, "path": "example/session/src/main/java/org/apache/iotdb/SessionExample.java", "diffHunk": "@@ -247,15 +247,11 @@ private static void insertTablet() throws IoTDBConnectionException, StatementExe\n \n     Tablet tablet = new Tablet(\"root.sg1.d1\", schemaList, 100);\n \n-    long[] timestamps = tablet.timestamps;\n-    Object[] values = tablet.values;\n-\n     for (long time = 0; time < 100; time++) {\n-      int row = tablet.rowSize++;\n-      timestamps[row] = time;\n-      for (int i = 0; i < 3; i++) {\n-        long[] sensor = (long[]) values[i];\n-        sensor[row] = i;\n+      int rowIndex = tablet.rowSize++;\n+      tablet.addTimestamp(rowIndex, time);\n+      for (int s = 0; s < 3; s++) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ba862eff4807c7647835734846968c7692d5b61b"}, "originalPosition": 15}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4f55869ade6e5d8823c0fd0ab01cbc87d15e9ee4", "author": {"user": {"login": "yanhongwangg", "name": "yanhong wang"}}, "url": "https://github.com/apache/iotdb/commit/4f55869ade6e5d8823c0fd0ab01cbc87d15e9ee4", "committedDate": "2020-08-29T09:54:14Z", "message": "IOTDB-839:Modify map in tablet to record measurementId -> index and code style"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc4MTE2NjYw", "url": "https://github.com/apache/iotdb/pull/1658#pullrequestreview-478116660", "createdAt": "2020-08-29T10:20:08Z", "commit": {"oid": "4f55869ade6e5d8823c0fd0ab01cbc87d15e9ee4"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOVQxMDoyMDowOVrOHJak3A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOVQxMDoyOToyMFrOHJanmw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTYzNDY1Mg==", "bodyText": "value always is initialize to be 0", "url": "https://github.com/apache/iotdb/pull/1658#discussion_r479634652", "createdAt": "2020-08-29T10:20:09Z", "author": {"login": "mychaow"}, "path": "session/src/test/java/org/apache/iotdb/session/IoTDBSessionIT.java", "diffHunk": "@@ -1087,15 +1086,13 @@ private void insertTabletTest2(String deviceId)\n \n     Tablet tablet = new Tablet(deviceId, schemaList, 256);\n \n-    long[] timestamps = tablet.timestamps;\n-    Object[] values = tablet.values;\n-\n     for (long time = 0; time < 1000; time++) {\n-      int row = tablet.rowSize++;\n-      timestamps[row] = time;\n-      for (int i = 0; i < 3; i++) {\n-        long[] sensor = (long[]) values[i];\n-        sensor[row] = i;\n+      int rowIndex = tablet.rowSize++;\n+      tablet.addTimestamp(rowIndex, time);\n+      for (int s = 0; s < 3; s++) {\n+        long value = 0;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4f55869ade6e5d8823c0fd0ab01cbc87d15e9ee4"}, "originalPosition": 59}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTYzNDczMA==", "bodyText": "same with previous", "url": "https://github.com/apache/iotdb/pull/1658#discussion_r479634730", "createdAt": "2020-08-29T10:21:08Z", "author": {"login": "mychaow"}, "path": "session/src/test/java/org/apache/iotdb/session/IoTDBSessionIT.java", "diffHunk": "@@ -1119,15 +1116,13 @@ private void insertTabletTest3(String deviceId)\n \n     Tablet tablet = new Tablet(deviceId, schemaList, 200);\n \n-    long[] timestamps = tablet.timestamps;\n-    Object[] values = tablet.values;\n-\n     for (long time = 500; time < 1500; time++) {\n-      int row = tablet.rowSize++;\n-      timestamps[row] = time;\n-      for (int i = 0; i < 3; i++) {\n-        long[] sensor = (long[]) values[i];\n-        sensor[row] = i;\n+      int rowIndex = tablet.rowSize++;\n+      tablet.addTimestamp(rowIndex, time);\n+      for (int s = 0; s < 3; s++) {\n+        long value = 0;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4f55869ade6e5d8823c0fd0ab01cbc87d15e9ee4"}, "originalPosition": 81}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTYzNTM1NQ==", "bodyText": "It's too ugly to create so many new variable names.\nyou could use {} in every case", "url": "https://github.com/apache/iotdb/pull/1658#discussion_r479635355", "createdAt": "2020-08-29T10:29:20Z", "author": {"login": "mychaow"}, "path": "tsfile/src/main/java/org/apache/iotdb/tsfile/write/record/Tablet.java", "diffHunk": "@@ -95,12 +102,56 @@ public Tablet(String deviceId, List<MeasurementSchema> schemas, int maxRowNumber\n     this.deviceId = deviceId;\n     this.schemas = schemas;\n     this.maxRowNumber = maxRowNumber;\n+    mschemawithindex = new HashMap<>();\n+\n+    for (int i = 0; i < schemas.size(); i++) {\n+      mschemawithindex.put(schemas.get(i).getMeasurementId(), i);\n+    }\n \n     createColumns();\n \n     reset();\n   }\n \n+  public void addTimestamp(int rowIndex, long timestamp) {\n+    timestamps[rowIndex] = timestamp;\n+  }\n+\n+  public void addValue(String measurementId, int rowIndex, Object value) {\n+    int indexOfValue = mschemawithindex.get(measurementId);\n+    MeasurementSchema measurementSchema = schemas.get(indexOfValue);\n+\n+    switch (measurementSchema.getType()) {\n+      case TEXT:\n+        Binary[] sensort = (Binary[]) values[indexOfValue];", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4f55869ade6e5d8823c0fd0ab01cbc87d15e9ee4"}, "originalPosition": 47}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4d43e7649cfc7cfae34b7708f96026c020b241ef", "author": {"user": {"login": "yanhongwangg", "name": "yanhong wang"}}, "url": "https://github.com/apache/iotdb/commit/4d43e7649cfc7cfae34b7708f96026c020b241ef", "committedDate": "2020-08-29T11:42:49Z", "message": "modify case to case{} in order to declare less variables"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ac36f614b3386087358e6e6b0de98fb7241f1064", "author": {"user": {"login": "yanhongwangg", "name": "yanhong wang"}}, "url": "https://github.com/apache/iotdb/commit/ac36f614b3386087358e6e6b0de98fb7241f1064", "committedDate": "2020-08-29T12:23:34Z", "message": "Put long value = 0 outside the loop"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc4MTI1NzU0", "url": "https://github.com/apache/iotdb/pull/1658#pullrequestreview-478125754", "createdAt": "2020-08-29T12:43:55Z", "commit": {"oid": "ac36f614b3386087358e6e6b0de98fb7241f1064"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOVQxMjo0Mzo1NVrOHJbRSA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOVQxMjo0Mzo1NVrOHJbRSA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTY0NjAyNA==", "bodyText": "mschemawithindex should be camel-case name, like mSchemaWithIndex.", "url": "https://github.com/apache/iotdb/pull/1658#discussion_r479646024", "createdAt": "2020-08-29T12:43:55Z", "author": {"login": "mychaow"}, "path": "tsfile/src/main/java/org/apache/iotdb/tsfile/write/record/Tablet.java", "diffHunk": "@@ -52,6 +54,11 @@\n    */\n   private List<MeasurementSchema> schemas;\n \n+  /**\n+   * measurementId->indexOf(measurementSchema)\n+   */\n+  private Map<String, Integer> mschemawithindex;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ac36f614b3386087358e6e6b0de98fb7241f1064"}, "originalPosition": 17}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "eee90347ba1a47a9001ffb518c7c13ab393aea74", "author": {"user": {"login": "yanhongwangg", "name": "yanhong wang"}}, "url": "https://github.com/apache/iotdb/commit/eee90347ba1a47a9001ffb518c7c13ab393aea74", "committedDate": "2020-08-29T12:54:20Z", "message": "modify mschemawithindex to mSchemaWithIndex"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc4MjcyNjUy", "url": "https://github.com/apache/iotdb/pull/1658#pullrequestreview-478272652", "createdAt": "2020-08-31T02:28:24Z", "commit": {"oid": "eee90347ba1a47a9001ffb518c7c13ab393aea74"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0zMVQwMjoyODoyNFrOHJoKmg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0zMVQwMzo1NzoyOFrOHJpRFg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTg1NzMwNg==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              private Map<String, Integer> mSchemaWithIndex;\n          \n          \n            \n              private Map<String, Integer> measurementIndex;", "url": "https://github.com/apache/iotdb/pull/1658#discussion_r479857306", "createdAt": "2020-08-31T02:28:24Z", "author": {"login": "qiaojialin"}, "path": "tsfile/src/main/java/org/apache/iotdb/tsfile/write/record/Tablet.java", "diffHunk": "@@ -52,6 +54,11 @@\n    */\n   private List<MeasurementSchema> schemas;\n \n+  /**\n+   * measurementId->indexOf(measurementSchema)\n+   */\n+  private Map<String, Integer> mSchemaWithIndex;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "eee90347ba1a47a9001ffb518c7c13ab393aea74"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTg3MDgzNA==", "bodyText": "this test lacks an assert. You can do a select count(*) query and assert", "url": "https://github.com/apache/iotdb/pull/1658#discussion_r479870834", "createdAt": "2020-08-31T03:35:14Z", "author": {"login": "qiaojialin"}, "path": "session/src/test/java/org/apache/iotdb/session/IoTDBSessionIT.java", "diffHunk": "@@ -622,6 +622,17 @@ public void TestSessionInterfacesWithDisabledWAL()\n       tablet.rowSize++;\n     }\n \n+    for (int time = 101; time <= 200; time++) {\n+      int rowIndex = time - 1;\n+      tablet.addTimestamp(rowIndex, time);\n+      long value = 0;\n+      for (int s = 0; s < 3; s++) {\n+        tablet.addValue(schemaList.get(s).getMeasurementId(), rowIndex, value);\n+        value++;\n+      }\n+      tablet.rowSize++;\n+    }\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "eee90347ba1a47a9001ffb518c7c13ab393aea74"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTg3NTM1MA==", "bodyText": "It's not intuitive where 14000 comes from.\nI feel that the IoTDBSessionIT is out of control gradually...\nIt's time to remove duplicated methods such as insertTabletTest1-2-3.\nBesides, there are some commented lines in test(), it should be cleaned.\nI create a jira issue:  https://issues.apache.org/jira/browse/IOTDB-856.\nBetter to fix it in this PR.", "url": "https://github.com/apache/iotdb/pull/1658#discussion_r479875350", "createdAt": "2020-08-31T03:57:28Z", "author": {"login": "qiaojialin"}, "path": "session/src/test/java/org/apache/iotdb/session/IoTDBSessionIT.java", "diffHunk": "@@ -1203,7 +1289,7 @@ private void queryForBatch() throws ClassNotFoundException, SQLException {\n       }\n       Assert.assertEquals(standard, resultStr.toString());\n       // d1 and d2 will align\n-      Assert.assertEquals(7000, count);\n+      Assert.assertEquals(14000, count);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "eee90347ba1a47a9001ffb518c7c13ab393aea74"}, "originalPosition": 162}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d74f5a345e9b247abcba9a9f625582c27b1807d5", "author": {"user": {"login": "yanhongwangg", "name": "yanhong wang"}}, "url": "https://github.com/apache/iotdb/commit/d74f5a345e9b247abcba9a9f625582c27b1807d5", "committedDate": "2020-08-31T06:50:24Z", "message": "Update tsfile/src/main/java/org/apache/iotdb/tsfile/write/record/Tablet.java\n\nCo-authored-by: Jialin Qiao <qjl16@mails.tsinghua.edu.cn>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "670020ef840e691c501106277e2f3a4244ac0356", "author": {"user": {"login": "yanhongwangg", "name": "yanhong wang"}}, "url": "https://github.com/apache/iotdb/commit/670020ef840e691c501106277e2f3a4244ac0356", "committedDate": "2020-08-31T06:56:11Z", "message": "Update Tablet.java"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc5NTE3NjIw", "url": "https://github.com/apache/iotdb/pull/1658#pullrequestreview-479517620", "createdAt": "2020-09-01T08:34:01Z", "commit": {"oid": "670020ef840e691c501106277e2f3a4244ac0356"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc5NTI1NTg5", "url": "https://github.com/apache/iotdb/pull/1658#pullrequestreview-479525589", "createdAt": "2020-09-01T08:44:44Z", "commit": {"oid": "670020ef840e691c501106277e2f3a4244ac0356"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc5NTI5ODYy", "url": "https://github.com/apache/iotdb/pull/1658#pullrequestreview-479529862", "createdAt": "2020-09-01T08:50:26Z", "commit": {"oid": "670020ef840e691c501106277e2f3a4244ac0356"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3426, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}