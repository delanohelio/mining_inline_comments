{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDgwNDA2OTgz", "number": 1692, "title": "fix some importcsv tool bug", "bodyText": "", "createdAt": "2020-09-05T03:15:10Z", "url": "https://github.com/apache/iotdb/pull/1692", "merged": true, "mergeCommit": {"oid": "d729f99c18760247136ffb6584993e1c70c96758"}, "closed": true, "closedAt": "2020-09-14T05:41:21Z", "author": {"login": "mychaow"}, "timelineItems": {"totalCount": 13, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdF0NHpgFqTQ4MzAzNTE2MA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdPyUNzAFqTUwMjYxNDY1MQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgzMDM1MTYw", "url": "https://github.com/apache/iotdb/pull/1692#pullrequestreview-483035160", "createdAt": "2020-09-05T06:34:35Z", "commit": {"oid": "39c28657d3d8ce5e66613394c51dd80ec6cbba02"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wNVQwNjozNDozNlrOHNgB4A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wNVQwNjozNDozNlrOHNgB4A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzkxODMwNA==", "bodyText": "can you add a comment to describe the structure of ResultSet?", "url": "https://github.com/apache/iotdb/pull/1692#discussion_r483918304", "createdAt": "2020-09-05T06:34:36Z", "author": {"login": "jixuan1989"}, "path": "cli/src/main/java/org/apache/iotdb/tool/ImportCsv.java", "diffHunk": "@@ -307,7 +307,7 @@ private static boolean queryDatabaseMeta(String[] strHeadInfo, File file, Buffer\n         ResultSet resultSet = statement.getResultSet();\n         try {\n           if (resultSet.next()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "39c28657d3d8ce5e66613394c51dd80ec6cbba02"}, "originalPosition": 3}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "454b2c6f9f7049669487751da61ccecc96699591", "author": {"user": {"login": "mychaow", "name": "chaow"}}, "url": "https://github.com/apache/iotdb/commit/454b2c6f9f7049669487751da61ccecc96699591", "committedDate": "2020-09-07T08:13:14Z", "message": "print output"}, "afterCommit": {"oid": "eace3a42f2dad44d7cc86f26c0c039e7a248e4d4", "author": {"user": {"login": "mychaow", "name": "chaow"}}, "url": "https://github.com/apache/iotdb/commit/eace3a42f2dad44d7cc86f26c0c039e7a248e4d4", "committedDate": "2020-09-07T09:13:19Z", "message": "print output"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "eace3a42f2dad44d7cc86f26c0c039e7a248e4d4", "author": {"user": {"login": "mychaow", "name": "chaow"}}, "url": "https://github.com/apache/iotdb/commit/eace3a42f2dad44d7cc86f26c0c039e7a248e4d4", "committedDate": "2020-09-07T09:13:19Z", "message": "print output"}, "afterCommit": {"oid": "13e5512d79637291318e2a796ad83d7077f59009", "author": {"user": {"login": "mychaow", "name": "chaow"}}, "url": "https://github.com/apache/iotdb/commit/13e5512d79637291318e2a796ad83d7077f59009", "committedDate": "2020-09-07T09:46:54Z", "message": "print output"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "836ef98256f80121cbac2a98bc6e8864144d77c2", "author": {"user": {"login": "mychaow", "name": "chaow"}}, "url": "https://github.com/apache/iotdb/commit/836ef98256f80121cbac2a98bc6e8864144d77c2", "committedDate": "2020-09-11T02:17:51Z", "message": "fix some importcsv tool bug"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "834b44fc8957f3f5eedbf4729582e684c1f577df", "author": {"user": {"login": "mychaow", "name": "chaow"}}, "url": "https://github.com/apache/iotdb/commit/834b44fc8957f3f5eedbf4729582e684c1f577df", "committedDate": "2020-09-11T02:17:51Z", "message": "add importCsvIT"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "22812962c03b6ddda045c3949549d4b533191d1d", "author": {"user": {"login": "mychaow", "name": "chaow"}}, "url": "https://github.com/apache/iotdb/commit/22812962c03b6ddda045c3949549d4b533191d1d", "committedDate": "2020-09-11T02:17:51Z", "message": "print output"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "13e5512d79637291318e2a796ad83d7077f59009", "author": {"user": {"login": "mychaow", "name": "chaow"}}, "url": "https://github.com/apache/iotdb/commit/13e5512d79637291318e2a796ad83d7077f59009", "committedDate": "2020-09-07T09:46:54Z", "message": "print output"}, "afterCommit": {"oid": "598fa8e088bb3f677726a2c76a910dcfde44a21f", "author": {"user": {"login": "mychaow", "name": "chaow"}}, "url": "https://github.com/apache/iotdb/commit/598fa8e088bb3f677726a2c76a910dcfde44a21f", "committedDate": "2020-09-11T02:21:07Z", "message": "generate csv when test"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg2NTEzODUx", "url": "https://github.com/apache/iotdb/pull/1692#pullrequestreview-486513851", "createdAt": "2020-09-11T06:44:44Z", "commit": {"oid": "598fa8e088bb3f677726a2c76a910dcfde44a21f"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMVQwNjo0NDo0NFrOHQQWKQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMVQwNjo0ODo1N1rOHQQdLA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjgwNzA4MQ==", "bodyText": "could you add some comment...  give some example", "url": "https://github.com/apache/iotdb/pull/1692#discussion_r486807081", "createdAt": "2020-09-11T06:44:44Z", "author": {"login": "qiaojialin"}, "path": "cli/src/main/java/org/apache/iotdb/tool/ImportCsv.java", "diffHunk": "@@ -378,7 +388,12 @@ private static String createOneSql(Map.Entry<String, ArrayList<Integer>> entry,\n         continue;\n       }\n       if (timeseriesToType.get(headInfo.get(colIndex.get(j))).equals(STRING_DATA_TYPE)) {\n-        sbd.append(\", \\'\").append(data[colIndex.get(j) + 1]).append(\"\\'\");\n+        if ((data[colIndex.get(j) + 1].startsWith(\"'\") && data[colIndex.get(j) + 1].endsWith(\"'\")) ||", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "598fa8e088bb3f677726a2c76a910dcfde44a21f"}, "originalPosition": 40}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjgwODcxOA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                List<String> outputList = new ArrayList<>();\n          \n          \n            \n                List<String> actualOutput = new ArrayList<>();", "url": "https://github.com/apache/iotdb/pull/1692#discussion_r486808718", "createdAt": "2020-09-11T06:48:36Z", "author": {"login": "qiaojialin"}, "path": "cross-tests/src/test/java/org/apache/iotdb/cross/tests/tools/importCsv/AbstractScript.java", "diffHunk": "@@ -0,0 +1,75 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+package org.apache.iotdb.cross.tests.tools.importCsv;\n+\n+import java.io.*;\n+import java.util.ArrayList;\n+import java.util.List;\n+import java.util.Properties;\n+\n+import static org.junit.Assert.assertEquals;\n+import static org.junit.Assert.assertTrue;\n+\n+public abstract class AbstractScript {\n+\n+  protected void testOutput(ProcessBuilder builder, String[] output) throws IOException {\n+    builder.redirectErrorStream(true);\n+    Process p = builder.start();\n+    BufferedReader r = new BufferedReader(new InputStreamReader(p.getInputStream()));\n+    String line;\n+    List<String> outputList = new ArrayList<>();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "598fa8e088bb3f677726a2c76a910dcfde44a21f"}, "originalPosition": 36}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjgwODg3Ng==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                  System.out.println(\"output:\" + output[i]);\n          \n          \n            \n                  System.out.println(\"outputList:\" + outputList.get(i));\n          \n          \n            \n                  System.out.println(\"expect:\" + output[i]);\n          \n          \n            \n                  System.out.println(\"actual:\" + outputList.get(i));\n          \n      \n    \n    \n  \n\nOr remove the print", "url": "https://github.com/apache/iotdb/pull/1692#discussion_r486808876", "createdAt": "2020-09-11T06:48:57Z", "author": {"login": "qiaojialin"}, "path": "cross-tests/src/test/java/org/apache/iotdb/cross/tests/tools/importCsv/AbstractScript.java", "diffHunk": "@@ -0,0 +1,75 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+package org.apache.iotdb.cross.tests.tools.importCsv;\n+\n+import java.io.*;\n+import java.util.ArrayList;\n+import java.util.List;\n+import java.util.Properties;\n+\n+import static org.junit.Assert.assertEquals;\n+import static org.junit.Assert.assertTrue;\n+\n+public abstract class AbstractScript {\n+\n+  protected void testOutput(ProcessBuilder builder, String[] output) throws IOException {\n+    builder.redirectErrorStream(true);\n+    Process p = builder.start();\n+    BufferedReader r = new BufferedReader(new InputStreamReader(p.getInputStream()));\n+    String line;\n+    List<String> outputList = new ArrayList<>();\n+    while (true) {\n+      line = r.readLine();\n+      if (line == null) {\n+        break;\n+      } else {\n+        outputList.add(line);\n+      }\n+    }\n+    r.close();\n+    p.destroy();\n+\n+    for (int i = 0; i < output.length; i++) {\n+      System.out.println(\"output:\" + output[i]);\n+      System.out.println(\"outputList:\" + outputList.get(i));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "598fa8e088bb3f677726a2c76a910dcfde44a21f"}, "originalPosition": 50}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "94bf6ebdceeee858bd1b3fff7af08c56c60e2b33", "author": {"user": {"login": "mychaow", "name": "chaow"}}, "url": "https://github.com/apache/iotdb/commit/94bf6ebdceeee858bd1b3fff7af08c56c60e2b33", "committedDate": "2020-09-11T08:04:31Z", "message": "generate csv when test"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "598fa8e088bb3f677726a2c76a910dcfde44a21f", "author": {"user": {"login": "mychaow", "name": "chaow"}}, "url": "https://github.com/apache/iotdb/commit/598fa8e088bb3f677726a2c76a910dcfde44a21f", "committedDate": "2020-09-11T02:21:07Z", "message": "generate csv when test"}, "afterCommit": {"oid": "94bf6ebdceeee858bd1b3fff7af08c56c60e2b33", "author": {"user": {"login": "mychaow", "name": "chaow"}}, "url": "https://github.com/apache/iotdb/commit/94bf6ebdceeee858bd1b3fff7af08c56c60e2b33", "committedDate": "2020-09-11T08:04:31Z", "message": "generate csv when test"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg2NzAzMTI3", "url": "https://github.com/apache/iotdb/pull/1692#pullrequestreview-486703127", "createdAt": "2020-09-11T10:50:20Z", "commit": {"oid": "94bf6ebdceeee858bd1b3fff7af08c56c60e2b33"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg3NDI4NTUy", "url": "https://github.com/apache/iotdb/pull/1692#pullrequestreview-487428552", "createdAt": "2020-09-14T05:41:10Z", "commit": {"oid": "94bf6ebdceeee858bd1b3fff7af08c56c60e2b33"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAyNjE0NjUx", "url": "https://github.com/apache/iotdb/pull/1692#pullrequestreview-502614651", "createdAt": "2020-10-06T06:23:00Z", "commit": {"oid": "94bf6ebdceeee858bd1b3fff7af08c56c60e2b33"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNlQwNjoyMzowMFrOHc3d_w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNlQwNjoyMzowMFrOHc3d_w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDAzMDk3NQ==", "bodyText": "Hi, the ImportCsvTestIT keeps failing occasionally in windows environment of Travis these days. @Genius-pig could also reproduce this failure in his local PC. Could you please have another check? I created an issue in JIRA : )", "url": "https://github.com/apache/iotdb/pull/1692#discussion_r500030975", "createdAt": "2020-10-06T06:23:00Z", "author": {"login": "samperson1997"}, "path": "cross-tests/src/test/java/org/apache/iotdb/cross/tests/tools/importCsv/AbstractScript.java", "diffHunk": "@@ -0,0 +1,73 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+package org.apache.iotdb.cross.tests.tools.importCsv;\n+\n+import java.io.*;\n+import java.util.ArrayList;\n+import java.util.List;\n+import java.util.Properties;\n+\n+import static org.junit.Assert.assertEquals;\n+import static org.junit.Assert.assertTrue;\n+\n+public abstract class AbstractScript {\n+\n+  protected void testOutput(ProcessBuilder builder, String[] output) throws IOException {\n+    builder.redirectErrorStream(true);\n+    Process p = builder.start();\n+    BufferedReader r = new BufferedReader(new InputStreamReader(p.getInputStream()));\n+    String line;\n+    List<String> actualOutput = new ArrayList<>();\n+    while (true) {\n+      line = r.readLine();\n+      if (line == null) {\n+        break;\n+      } else {\n+        actualOutput.add(line);\n+      }\n+    }\n+    r.close();\n+    p.destroy();\n+\n+    for (int i = 0; i < output.length; i++) {\n+      assertTrue(actualOutput.get(i).startsWith(output[i]));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "94bf6ebdceeee858bd1b3fff7af08c56c60e2b33"}, "originalPosition": 49}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3456, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}