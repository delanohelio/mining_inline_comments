{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDkxMDAxMzc1", "number": 1751, "title": "[IOTDB-902] Optimize max_time aggregation and fix order by time desc aggregation bug ", "bodyText": "This pr:\n\nFix some bugs of order by time desc.\nAdd more tests of order by time desc.\nOptimize the max_time and last_value aggregation process without value filter using descReader", "createdAt": "2020-09-22T14:56:45Z", "url": "https://github.com/apache/iotdb/pull/1751", "merged": true, "mergeCommit": {"oid": "0964b9558828e1b2bc2765cabbf511d4a87497e2"}, "closed": true, "closedAt": "2020-10-23T06:24:19Z", "author": {"login": "Alima777"}, "timelineItems": {"totalCount": 42, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdKDqOjgH2gAyNDkxMDAxMzc1OmZkNGYzZmUxNzJjNDFiNTlmNzVjMjFlMWEwY2IyZjkzNjk0YmViNGE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdVNCM-gFqTUxNTIzNDcyOQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "fd4f3fe172c41b59f75c21e1a0cb2f93694beb4a", "author": {"user": {"login": "Alima777", "name": "Xiangwei Wei"}}, "url": "https://github.com/apache/iotdb/commit/fd4f3fe172c41b59f75c21e1a0cb2f93694beb4a", "committedDate": "2020-09-18T11:12:19Z", "message": "seperate agg results as asc and desc"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "85acf093b250a657a16561cd1c4099622324aedc", "author": {"user": {"login": "Alima777", "name": "Xiangwei Wei"}}, "url": "https://github.com/apache/iotdb/commit/85acf093b250a657a16561cd1c4099622324aedc", "committedDate": "2020-09-18T12:24:51Z", "message": "fix aggregation desc bug"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9c126eae3bcc1e54ec88ceeca224b84b20ce84d4", "author": {"user": {"login": "Alima777", "name": "Xiangwei Wei"}}, "url": "https://github.com/apache/iotdb/commit/9c126eae3bcc1e54ec88ceeca224b84b20ce84d4", "committedDate": "2020-09-19T08:55:10Z", "message": "fix series reader bug"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1c88f9b43e650e28de5f147c01eff4b7bd5b2939", "author": {"user": {"login": "Alima777", "name": "Xiangwei Wei"}}, "url": "https://github.com/apache/iotdb/commit/1c88f9b43e650e28de5f147c01eff4b7bd5b2939", "committedDate": "2020-09-19T12:07:20Z", "message": "fix maxtimeaggrResult"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "88db34bdf453a16a1a8b0d8f0ed05c94a21050e2", "author": {"user": {"login": "Alima777", "name": "Xiangwei Wei"}}, "url": "https://github.com/apache/iotdb/commit/88db34bdf453a16a1a8b0d8f0ed05c94a21050e2", "committedDate": "2020-09-19T13:25:41Z", "message": "fix max last_value bug"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "af10d859ba5496e5fada285ba9c775fb3b4c78ad", "author": {"user": {"login": "Alima777", "name": "Xiangwei Wei"}}, "url": "https://github.com/apache/iotdb/commit/af10d859ba5496e5fada285ba9c775fb3b4c78ad", "committedDate": "2020-09-19T13:53:39Z", "message": "fix desc merge reader bug"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b0ddb4f0a9f1c102c3ba05db227b572db122c21f", "author": {"user": {"login": "Alima777", "name": "Xiangwei Wei"}}, "url": "https://github.com/apache/iotdb/commit/b0ddb4f0a9f1c102c3ba05db227b572db122c21f", "committedDate": "2020-09-22T06:15:30Z", "message": "add more desc tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "76aad30d937559fbd74c670d6379c3883402316f", "author": {"user": {"login": "Alima777", "name": "Xiangwei Wei"}}, "url": "https://github.com/apache/iotdb/commit/76aad30d937559fbd74c670d6379c3883402316f", "committedDate": "2020-09-22T14:53:45Z", "message": "fix bugs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5ab42f4e832c65b2667e4fa07e1fc523cc859bd5", "author": {"user": {"login": "Alima777", "name": "Xiangwei Wei"}}, "url": "https://github.com/apache/iotdb/commit/5ab42f4e832c65b2667e4fa07e1fc523cc859bd5", "committedDate": "2020-09-22T14:55:01Z", "message": "Merge branch 'aggOptimization' of https://github.com/Alima777/incubator-iotdb into aggOptimization"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8b68c49fc1636d73fc800e2a8efef732e45082c1", "author": {"user": {"login": "Alima777", "name": "Xiangwei Wei"}}, "url": "https://github.com/apache/iotdb/commit/8b68c49fc1636d73fc800e2a8efef732e45082c1", "committedDate": "2020-09-22T16:33:31Z", "message": "fix hasResult() bug"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a28bb1b8b76c676166538f113410667738f7b1a5", "author": {"user": {"login": "Alima777", "name": "Xiangwei Wei"}}, "url": "https://github.com/apache/iotdb/commit/a28bb1b8b76c676166538f113410667738f7b1a5", "committedDate": "2020-09-22T16:14:00Z", "message": "fix hasResult() bug"}, "afterCommit": {"oid": "8b68c49fc1636d73fc800e2a8efef732e45082c1", "author": {"user": {"login": "Alima777", "name": "Xiangwei Wei"}}, "url": "https://github.com/apache/iotdb/commit/8b68c49fc1636d73fc800e2a8efef732e45082c1", "committedDate": "2020-09-22T16:33:31Z", "message": "fix hasResult() bug"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f97f25db2e1aed2ff192f0c2a73e2309733051b3", "author": {"user": {"login": "Alima777", "name": "Xiangwei Wei"}}, "url": "https://github.com/apache/iotdb/commit/f97f25db2e1aed2ff192f0c2a73e2309733051b3", "committedDate": "2020-09-22T16:44:37Z", "message": "remove unused constraint"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1520a985d2b519777b10889b2ece45ec7b6b8e7b", "author": {"user": {"login": "Alima777", "name": "Xiangwei Wei"}}, "url": "https://github.com/apache/iotdb/commit/1520a985d2b519777b10889b2ece45ec7b6b8e7b", "committedDate": "2020-09-22T17:00:26Z", "message": "modify test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d528f98127570f0b63c4ad342ff92ed94fbd0da4", "author": {"user": {"login": "Alima777", "name": "Xiangwei Wei"}}, "url": "https://github.com/apache/iotdb/commit/d528f98127570f0b63c4ad342ff92ed94fbd0da4", "committedDate": "2020-09-23T02:17:34Z", "message": "fix first value bug"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3a0afeb943774796842f1e4d59a38fe97c5e9984", "author": {"user": {"login": "Alima777", "name": "Xiangwei Wei"}}, "url": "https://github.com/apache/iotdb/commit/3a0afeb943774796842f1e4d59a38fe97c5e9984", "committedDate": "2020-09-23T03:40:11Z", "message": "add aggregation tests and modift statistics method"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4ad290c05360317d7e929d79c45886e7f408d6e7", "author": {"user": {"login": "Alima777", "name": "Xiangwei Wei"}}, "url": "https://github.com/apache/iotdb/commit/4ad290c05360317d7e929d79c45886e7f408d6e7", "committedDate": "2020-09-23T11:30:45Z", "message": "modify parameter names"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f70941ecf15784f1c8d3076421a326c27a78f5b0", "author": {"user": {"login": "Alima777", "name": "Xiangwei Wei"}}, "url": "https://github.com/apache/iotdb/commit/f70941ecf15784f1c8d3076421a326c27a78f5b0", "committedDate": "2020-09-23T11:41:24Z", "message": "fix deserializeFrom bug"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0229fd7fb69e59403cd3f0f17bc9330e86e6f1a4", "author": {"user": {"login": "liutaohua", "name": "Dawei Liu"}}, "url": "https://github.com/apache/iotdb/commit/0229fd7fb69e59403cd3f0f17bc9330e86e6f1a4", "committedDate": "2020-09-23T16:08:45Z", "message": "adjust structure of AggrResult"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8eece91c0726a7abca6a0652a6f3bde23150395f", "author": {"user": {"login": "Alima777", "name": "Xiangwei Wei"}}, "url": "https://github.com/apache/iotdb/commit/8eece91c0726a7abca6a0652a6f3bde23150395f", "committedDate": "2020-09-24T02:04:28Z", "message": "add license and fix a little bug"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a9bbf3ff002b79e20ec9d20f8903ebbec5671090", "author": {"user": {"login": "Alima777", "name": "Xiangwei Wei"}}, "url": "https://github.com/apache/iotdb/commit/a9bbf3ff002b79e20ec9d20f8903ebbec5671090", "committedDate": "2020-09-24T02:54:02Z", "message": "add more tests with filter"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "122bc857f1d1da0b771bb45dd0c7ed35d594b18c", "author": {"user": {"login": "Alima777", "name": "Xiangwei Wei"}}, "url": "https://github.com/apache/iotdb/commit/122bc857f1d1da0b771bb45dd0c7ed35d594b18c", "committedDate": "2020-09-24T04:03:31Z", "message": "fix aggregation with value filter bug"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8a511c4b7c4d659d57f719cf3419153dde5b9ce3", "author": {"user": {"login": "Alima777", "name": "Xiangwei Wei"}}, "url": "https://github.com/apache/iotdb/commit/8a511c4b7c4d659d57f719cf3419153dde5b9ce3", "committedDate": "2020-09-24T04:31:19Z", "message": "optimize code structure"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6337c8cdc3b47925ea811e99b68ca32d7e8bbe9d", "author": {"user": {"login": "Alima777", "name": "Xiangwei Wei"}}, "url": "https://github.com/apache/iotdb/commit/6337c8cdc3b47925ea811e99b68ca32d7e8bbe9d", "committedDate": "2020-09-24T09:13:21Z", "message": "Merge branch 'aggOptimization' of https://github.com/Alima777/incubator-iotdb into aggOptimization"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cc7e33a29658e0994b2471f8baa4fdc55ddaa89a", "author": {"user": {"login": "liutaohua", "name": "Dawei Liu"}}, "url": "https://github.com/apache/iotdb/commit/cc7e33a29658e0994b2471f8baa4fdc55ddaa89a", "committedDate": "2020-09-24T12:30:24Z", "message": "del DescSeriesReaderByTimestamp"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d9b5b22beec96626499437844d634714f97735ee", "author": {"user": {"login": "liutaohua", "name": "Dawei Liu"}}, "url": "https://github.com/apache/iotdb/commit/d9b5b22beec96626499437844d634714f97735ee", "committedDate": "2020-09-25T08:17:24Z", "message": "1.add groupByFIll UT\n2.fix bug and optimize GroupByFillDataSet"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0d2bdc7ea67eef214ce7bf5198833c652423d471", "author": {"user": {"login": "liutaohua", "name": "Dawei Liu"}}, "url": "https://github.com/apache/iotdb/commit/0d2bdc7ea67eef214ce7bf5198833c652423d471", "committedDate": "2020-09-25T08:32:47Z", "message": "add some desc ut"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1d405c2b0189061c3bcba7124fe23c09c4db513c", "author": {"user": {"login": "Alima777", "name": "Xiangwei Wei"}}, "url": "https://github.com/apache/iotdb/commit/1d405c2b0189061c3bcba7124fe23c09c4db513c", "committedDate": "2020-09-25T11:35:35Z", "message": "delete some unused method"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8ca6f50429508472725a06b6a2cc6e0e1bab80c9", "author": {"user": {"login": "Alima777", "name": "Xiangwei Wei"}}, "url": "https://github.com/apache/iotdb/commit/8ca6f50429508472725a06b6a2cc6e0e1bab80c9", "committedDate": "2020-09-27T01:40:36Z", "message": "Merge branch 'aggOptimization' of https://github.com/Alima777/incubator-iotdb into aggOptimization"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d2052424338db54bf010ef9c6247935befa5a6dd", "author": {"user": {"login": "liutaohua", "name": "Dawei Liu"}}, "url": "https://github.com/apache/iotdb/commit/d2052424338db54bf010ef9c6247935befa5a6dd", "committedDate": "2020-09-27T13:45:53Z", "message": "add some desc IT"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "33b66364e04c5413e7b8b03971f011e4bdd6b5fc", "author": {"user": {"login": "Alima777", "name": "Xiangwei Wei"}}, "url": "https://github.com/apache/iotdb/commit/33b66364e04c5413e7b8b03971f011e4bdd6b5fc", "committedDate": "2020-09-29T02:07:35Z", "message": "delete some redundant tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8df3edc6c2b2f05b86310c1e037782ed7059b7fc", "author": {"user": {"login": "Alima777", "name": "Xiangwei Wei"}}, "url": "https://github.com/apache/iotdb/commit/8df3edc6c2b2f05b86310c1e037782ed7059b7fc", "committedDate": "2020-09-29T02:08:19Z", "message": "fix conflict"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "36f09b26ff0ff87a58e20e4a5072d171e9eaf2c6", "author": {"user": {"login": "Alima777", "name": "Xiangwei Wei"}}, "url": "https://github.com/apache/iotdb/commit/36f09b26ff0ff87a58e20e4a5072d171e9eaf2c6", "committedDate": "2020-09-29T03:05:18Z", "message": "fix some typo"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "819dcea1aefbc21ca280dd31e7958f317b61c92b", "author": {"user": {"login": "liutaohua", "name": "Dawei Liu"}}, "url": "https://github.com/apache/iotdb/commit/819dcea1aefbc21ca280dd31e7958f317b61c92b", "committedDate": "2020-09-29T09:20:19Z", "message": "remove duplicated code"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7200a1fa036bb7229c5d720341b05833e25087ce", "author": {"user": {"login": "Alima777", "name": "Xiangwei Wei"}}, "url": "https://github.com/apache/iotdb/commit/7200a1fa036bb7229c5d720341b05833e25087ce", "committedDate": "2020-09-30T14:08:40Z", "message": "rename hasResult -> hasCandidateResult"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5b7c939db938d237e7e3263af2b2ba95de158c7d", "author": {"user": {"login": "Alima777", "name": "Xiangwei Wei"}}, "url": "https://github.com/apache/iotdb/commit/5b7c939db938d237e7e3263af2b2ba95de158c7d", "committedDate": "2020-09-30T14:11:59Z", "message": "modify typo"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAyNjc5MjQ3", "url": "https://github.com/apache/iotdb/pull/1751#pullrequestreview-502679247", "createdAt": "2020-10-06T08:02:08Z", "commit": {"oid": "5b7c939db938d237e7e3263af2b2ba95de158c7d"}, "state": "COMMENTED", "comments": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNlQwODowMjowOFrOHc6eYw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNlQwODoyNToyMlrOHc7Wbw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDA4MDIyNw==", "bodyText": "I don't get the reason why do you remove this IT...", "url": "https://github.com/apache/iotdb/pull/1751#discussion_r500080227", "createdAt": "2020-10-06T08:02:08Z", "author": {"login": "HTHou"}, "path": "server/src/test/java/org/apache/iotdb/db/integration/IoTDBAggregationAlignByDeviceIT.java", "diffHunk": "@@ -1,113 +0,0 @@\n-/*\n- * Licensed to the Apache Software Foundation (ASF) under one\n- * or more contributor license agreements.  See the NOTICE file\n- * distributed with this work for additional information\n- * regarding copyright ownership.  The ASF licenses this file\n- * to you under the Apache License, Version 2.0 (the\n- * \"License\"); you may not use this file except in compliance\n- * with the License.  You may obtain a copy of the License at\n- *\n- *     http://www.apache.org/licenses/LICENSE-2.0\n- *\n- * Unless required by applicable law or agreed to in writing,\n- * software distributed under the License is distributed on an\n- * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n- * KIND, either express or implied.  See the License for the\n- * specific language governing permissions and limitations\n- * under the License.\n- */\n-package org.apache.iotdb.db.integration;\n-\n-import static org.apache.iotdb.db.constant.TestConstant.count;\n-import static org.junit.Assert.fail;\n-\n-import java.sql.Connection;\n-import java.sql.DriverManager;\n-import java.sql.ResultSet;\n-import java.sql.SQLException;\n-import java.sql.Statement;\n-import org.apache.iotdb.db.utils.EnvironmentUtils;\n-import org.apache.iotdb.jdbc.Config;\n-import org.junit.After;\n-import org.junit.Assert;\n-import org.junit.Before;\n-import org.junit.Test;\n-\n-public class IoTDBAggregationAlignByDeviceIT {\n-", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5b7c939db938d237e7e3263af2b2ba95de158c7d"}, "originalPosition": 37}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDA4Mzg4MQ==", "bodyText": "Better to use try with resource reduce code smell...", "url": "https://github.com/apache/iotdb/pull/1751#discussion_r500083881", "createdAt": "2020-10-06T08:08:16Z", "author": {"login": "HTHou"}, "path": "server/src/test/java/org/apache/iotdb/db/integration/IoTDBAggregationLargeDataIT.java", "diffHunk": "@@ -357,11 +438,11 @@ private void minMaxTimeAggreWithSingleFilterTest() throws ClassNotFoundException\n       try {\n         while (resultSet.next()) {\n           String ans = resultSet.getString(TIMESTAMP_STR) + \",\" +\n-                  resultSet.getString(min_time(d0s0)) + \",\" +\n-                  resultSet.getString(min_time(d0s1)) + \",\" +\n-                  resultSet.getString(min_time(d0s2)) +\n-                  \",\" + resultSet.getString(min_time(d0s3)) +\n-                  \",\" + resultSet.getString(min_time(d0s4));\n+              resultSet.getString(min_time(d0s0)) + \",\" +\n+              resultSet.getString(min_time(d0s1)) + \",\" +\n+              resultSet.getString(min_time(d0s2)) +\n+              \",\" + resultSet.getString(min_time(d0s3)) +\n+              \",\" + resultSet.getString(min_time(d0s4));\n           Assert.assertEquals(ans, retArray[cnt]);\n           cnt++;\n         }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5b7c939db938d237e7e3263af2b2ba95de158c7d"}, "originalPosition": 154}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDA4NDUzMw==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                  resultSet = statement.getResultSet();\n          \n          \n            \n                  try {\n          \n          \n            \n                    while (resultSet.next()) {\n          \n          \n            \n                      String ans =\n          \n          \n            \n                          resultSet.getString(TIMESTAMP_STR) + \",\" + resultSet.getString(max_time(d0s0))\n          \n          \n            \n                              + \",\" + resultSet.getString(max_time(d0s1)) + \",\" + resultSet\n          \n          \n            \n                              .getString(max_time(d0s2))\n          \n          \n            \n                              + \",\" + resultSet.getString(max_time(d0s3)) + \",\" + resultSet\n          \n          \n            \n                              .getString(max_time(d0s4));\n          \n          \n            \n                      Assert.assertEquals(ans, retArray[cnt]);\n          \n          \n            \n                      cnt++;\n          \n          \n            \n                    }\n          \n          \n            \n                    Assert.assertEquals(2, cnt);\n          \n          \n            \n                  } finally {\n          \n          \n            \n                    resultSet.close();\n          \n          \n            \n                  }\n          \n          \n            \n                  try (resultSet = statement.getResultSet()) {\n          \n          \n            \n                    while (resultSet.next()) {\n          \n          \n            \n                      String ans =\n          \n          \n            \n                          resultSet.getString(TIMESTAMP_STR) + \",\" + resultSet.getString(max_time(d0s0))\n          \n          \n            \n                              + \",\" + resultSet.getString(max_time(d0s1)) + \",\" + resultSet\n          \n          \n            \n                              .getString(max_time(d0s2))\n          \n          \n            \n                              + \",\" + resultSet.getString(max_time(d0s3)) + \",\" + resultSet\n          \n          \n            \n                              .getString(max_time(d0s4));\n          \n          \n            \n                      Assert.assertEquals(ans, retArray[cnt]);\n          \n          \n            \n                      cnt++;\n          \n          \n            \n                    }\n          \n          \n            \n                    Assert.assertEquals(2, cnt);\n          \n          \n            \n                  }", "url": "https://github.com/apache/iotdb/pull/1751#discussion_r500084533", "createdAt": "2020-10-06T08:09:26Z", "author": {"login": "HTHou"}, "path": "server/src/test/java/org/apache/iotdb/db/integration/IoTDBAggregationLargeDataIT.java", "diffHunk": "@@ -370,27 +451,70 @@ private void minMaxTimeAggreWithSingleFilterTest() throws ClassNotFoundException\n         resultSet.close();\n       }\n \n-      retArray = new String[]{\n-          \"0,3999,3999,3999,3599,100\"\n-      };\n       hasResultSet = statement.execute(\"select max_time(s0),max_time(s1),max_time(s2),\"\n           + \"max_time(s3),max_time(s4) from root.vehicle.d0 \" +\n           \"where s1 < 50000 and s1 != 100\");\n       Assert.assertTrue(hasResultSet);\n       resultSet = statement.getResultSet();\n+      try {\n+        while (resultSet.next()) {\n+          String ans =\n+              resultSet.getString(TIMESTAMP_STR) + \",\" + resultSet.getString(max_time(d0s0))\n+                  + \",\" + resultSet.getString(max_time(d0s1)) + \",\" + resultSet\n+                  .getString(max_time(d0s2))\n+                  + \",\" + resultSet.getString(max_time(d0s3)) + \",\" + resultSet\n+                  .getString(max_time(d0s4));\n+          Assert.assertEquals(ans, retArray[cnt]);\n+          cnt++;\n+        }\n+        Assert.assertEquals(2, cnt);\n+      } finally {\n+        resultSet.close();\n+      }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5b7c939db938d237e7e3263af2b2ba95de158c7d"}, "originalPosition": 181}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDA4NDg0Nw==", "bodyText": "Same as above", "url": "https://github.com/apache/iotdb/pull/1751#discussion_r500084847", "createdAt": "2020-10-06T08:09:57Z", "author": {"login": "HTHou"}, "path": "server/src/test/java/org/apache/iotdb/db/integration/IoTDBAggregationLargeDataIT.java", "diffHunk": "@@ -370,27 +451,70 @@ private void minMaxTimeAggreWithSingleFilterTest() throws ClassNotFoundException\n         resultSet.close();\n       }\n \n-      retArray = new String[]{\n-          \"0,3999,3999,3999,3599,100\"\n-      };\n       hasResultSet = statement.execute(\"select max_time(s0),max_time(s1),max_time(s2),\"\n           + \"max_time(s3),max_time(s4) from root.vehicle.d0 \" +\n           \"where s1 < 50000 and s1 != 100\");\n       Assert.assertTrue(hasResultSet);\n       resultSet = statement.getResultSet();\n+      try {\n+        while (resultSet.next()) {\n+          String ans =\n+              resultSet.getString(TIMESTAMP_STR) + \",\" + resultSet.getString(max_time(d0s0))\n+                  + \",\" + resultSet.getString(max_time(d0s1)) + \",\" + resultSet\n+                  .getString(max_time(d0s2))\n+                  + \",\" + resultSet.getString(max_time(d0s3)) + \",\" + resultSet\n+                  .getString(max_time(d0s4));\n+          Assert.assertEquals(ans, retArray[cnt]);\n+          cnt++;\n+        }\n+        Assert.assertEquals(2, cnt);\n+      } finally {\n+        resultSet.close();\n+      }\n+\n+      // keep the correctness of `order by time desc`\n+      hasResultSet = statement.execute(\n+          \"select min_time(s0),min_time(s1),min_time(s2),min_time(s3),min_time(s4)\" +\n+              \" from root.vehicle.d0 where s1 >= 0 order by time desc\");\n+      Assert.assertTrue(hasResultSet);\n+      resultSet = statement.getResultSet();\n       cnt = 0;\n       try {\n         while (resultSet.next()) {\n-          String ans = resultSet.getString(TIMESTAMP_STR) + \",\" + resultSet.getString(max_time(d0s0))\n-                  + \",\" + resultSet.getString(max_time(d0s1)) + \",\" + resultSet.getString(max_time(d0s2))\n-                  + \",\" + resultSet.getString(max_time(d0s3)) + \",\" + resultSet.getString(max_time(d0s4));\n+          String ans = resultSet.getString(TIMESTAMP_STR) + \",\" +\n+              resultSet.getString(min_time(d0s0)) + \",\" +\n+              resultSet.getString(min_time(d0s1)) + \",\" +\n+              resultSet.getString(min_time(d0s2)) +\n+              \",\" + resultSet.getString(min_time(d0s3)) +\n+              \",\" + resultSet.getString(min_time(d0s4));\n           Assert.assertEquals(ans, retArray[cnt]);\n           cnt++;\n         }\n         Assert.assertEquals(1, cnt);\n       } finally {\n         resultSet.close();\n       }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5b7c939db938d237e7e3263af2b2ba95de158c7d"}, "originalPosition": 207}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDA4NTA3OQ==", "bodyText": "Same...", "url": "https://github.com/apache/iotdb/pull/1751#discussion_r500085079", "createdAt": "2020-10-06T08:10:19Z", "author": {"login": "HTHou"}, "path": "server/src/test/java/org/apache/iotdb/db/integration/IoTDBAggregationLargeDataIT.java", "diffHunk": "@@ -370,27 +451,70 @@ private void minMaxTimeAggreWithSingleFilterTest() throws ClassNotFoundException\n         resultSet.close();\n       }\n \n-      retArray = new String[]{\n-          \"0,3999,3999,3999,3599,100\"\n-      };\n       hasResultSet = statement.execute(\"select max_time(s0),max_time(s1),max_time(s2),\"\n           + \"max_time(s3),max_time(s4) from root.vehicle.d0 \" +\n           \"where s1 < 50000 and s1 != 100\");\n       Assert.assertTrue(hasResultSet);\n       resultSet = statement.getResultSet();\n+      try {\n+        while (resultSet.next()) {\n+          String ans =\n+              resultSet.getString(TIMESTAMP_STR) + \",\" + resultSet.getString(max_time(d0s0))\n+                  + \",\" + resultSet.getString(max_time(d0s1)) + \",\" + resultSet\n+                  .getString(max_time(d0s2))\n+                  + \",\" + resultSet.getString(max_time(d0s3)) + \",\" + resultSet\n+                  .getString(max_time(d0s4));\n+          Assert.assertEquals(ans, retArray[cnt]);\n+          cnt++;\n+        }\n+        Assert.assertEquals(2, cnt);\n+      } finally {\n+        resultSet.close();\n+      }\n+\n+      // keep the correctness of `order by time desc`\n+      hasResultSet = statement.execute(\n+          \"select min_time(s0),min_time(s1),min_time(s2),min_time(s3),min_time(s4)\" +\n+              \" from root.vehicle.d0 where s1 >= 0 order by time desc\");\n+      Assert.assertTrue(hasResultSet);\n+      resultSet = statement.getResultSet();\n       cnt = 0;\n       try {\n         while (resultSet.next()) {\n-          String ans = resultSet.getString(TIMESTAMP_STR) + \",\" + resultSet.getString(max_time(d0s0))\n-                  + \",\" + resultSet.getString(max_time(d0s1)) + \",\" + resultSet.getString(max_time(d0s2))\n-                  + \",\" + resultSet.getString(max_time(d0s3)) + \",\" + resultSet.getString(max_time(d0s4));\n+          String ans = resultSet.getString(TIMESTAMP_STR) + \",\" +\n+              resultSet.getString(min_time(d0s0)) + \",\" +\n+              resultSet.getString(min_time(d0s1)) + \",\" +\n+              resultSet.getString(min_time(d0s2)) +\n+              \",\" + resultSet.getString(min_time(d0s3)) +\n+              \",\" + resultSet.getString(min_time(d0s4));\n           Assert.assertEquals(ans, retArray[cnt]);\n           cnt++;\n         }\n         Assert.assertEquals(1, cnt);\n       } finally {\n         resultSet.close();\n       }\n+\n+      hasResultSet = statement.execute(\"select max_time(s0),max_time(s1),max_time(s2),\"\n+          + \"max_time(s3),max_time(s4) from root.vehicle.d0 \" +\n+          \"where s1 < 50000 and s1 != 100 order by time desc\");\n+      Assert.assertTrue(hasResultSet);\n+      resultSet = statement.getResultSet();\n+      try {\n+        while (resultSet.next()) {\n+          String ans =\n+              resultSet.getString(TIMESTAMP_STR) + \",\" + resultSet.getString(max_time(d0s0))\n+                  + \",\" + resultSet.getString(max_time(d0s1)) + \",\" + resultSet\n+                  .getString(max_time(d0s2))\n+                  + \",\" + resultSet.getString(max_time(d0s3)) + \",\" + resultSet\n+                  .getString(max_time(d0s4));\n+          Assert.assertEquals(ans, retArray[cnt]);\n+          cnt++;\n+        }\n+        Assert.assertEquals(2, cnt);\n+      } finally {\n+        resultSet.close();\n+      }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5b7c939db938d237e7e3263af2b2ba95de158c7d"}, "originalPosition": 228}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDA4NTI2MA==", "bodyText": "Same...\nThere are a lot of try finally, better to fix them together.", "url": "https://github.com/apache/iotdb/pull/1751#discussion_r500085260", "createdAt": "2020-10-06T08:10:37Z", "author": {"login": "HTHou"}, "path": "server/src/test/java/org/apache/iotdb/db/integration/IoTDBAggregationLargeDataIT.java", "diffHunk": "@@ -416,12 +540,35 @@ private void minValueAggreWithSingleFilterTest() throws ClassNotFoundException,\n         try {\n           while (resultSet.next()) {\n             String ans =\n-                    resultSet.getString(TIMESTAMP_STR) + \",\" + resultSet.getString(min_value(d0s0))\n-                            + \",\" + resultSet.getString(min_value(d0s1)) + \",\" + resultSet\n-                            .getString(min_value(d0s2))\n-                            + \",\" + resultSet.getString(min_value(d0s3)) + \",\" + resultSet\n-                            .getString(min_value(d0s4));\n-            //System.out.println(\"============ \" + ans);\n+                resultSet.getString(TIMESTAMP_STR) + \",\" + resultSet.getString(min_value(d0s0))\n+                    + \",\" + resultSet.getString(min_value(d0s1)) + \",\" + resultSet\n+                    .getString(min_value(d0s2))\n+                    + \",\" + resultSet.getString(min_value(d0s3)) + \",\" + resultSet\n+                    .getString(min_value(d0s4));\n+            Assert.assertEquals(ans, retArray[cnt]);\n+            cnt++;\n+          }\n+          Assert.assertEquals(1, cnt);\n+        } finally {\n+          resultSet.close();\n+        }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5b7c939db938d237e7e3263af2b2ba95de158c7d"}, "originalPosition": 253}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDA4ODY4Mg==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    .getAggrResultByName(SQLConstant.AVG, TSDataType.DOUBLE,true);\n          \n          \n            \n                    .getAggrResultByName(SQLConstant.AVG, TSDataType.DOUBLE, true);", "url": "https://github.com/apache/iotdb/pull/1751#discussion_r500088682", "createdAt": "2020-10-06T08:16:17Z", "author": {"login": "HTHou"}, "path": "server/src/test/java/org/apache/iotdb/db/query/aggregation/AggregateResultTest.java", "diffHunk": "@@ -36,9 +36,9 @@\n   @Test\n   public void avgAggrResultTest() throws QueryProcessException, IOException {\n     AggregateResult avgAggrResult1 = AggregateResultFactory\n-        .getAggrResultByName(SQLConstant.AVG, TSDataType.DOUBLE);\n+        .getAggrResultByName(SQLConstant.AVG, TSDataType.DOUBLE,true);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5b7c939db938d237e7e3263af2b2ba95de158c7d"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDA4ODg0Mw==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    .getAggrResultByName(SQLConstant.AVG, TSDataType.DOUBLE,true);\n          \n          \n            \n                    .getAggrResultByName(SQLConstant.AVG, TSDataType.DOUBLE, true);", "url": "https://github.com/apache/iotdb/pull/1751#discussion_r500088843", "createdAt": "2020-10-06T08:16:32Z", "author": {"login": "HTHou"}, "path": "server/src/test/java/org/apache/iotdb/db/query/aggregation/AggregateResultTest.java", "diffHunk": "@@ -36,9 +36,9 @@\n   @Test\n   public void avgAggrResultTest() throws QueryProcessException, IOException {\n     AggregateResult avgAggrResult1 = AggregateResultFactory\n-        .getAggrResultByName(SQLConstant.AVG, TSDataType.DOUBLE);\n+        .getAggrResultByName(SQLConstant.AVG, TSDataType.DOUBLE,true);\n     AggregateResult avgAggrResult2 = AggregateResultFactory\n-        .getAggrResultByName(SQLConstant.AVG, TSDataType.DOUBLE);\n+        .getAggrResultByName(SQLConstant.AVG, TSDataType.DOUBLE,true);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5b7c939db938d237e7e3263af2b2ba95de158c7d"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDA4ODk3Mg==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    .getAggrResultByName(SQLConstant.MAX_VALUE, TSDataType.DOUBLE,true);\n          \n          \n            \n                    .getAggrResultByName(SQLConstant.MAX_VALUE, TSDataType.DOUBLE, true);", "url": "https://github.com/apache/iotdb/pull/1751#discussion_r500088972", "createdAt": "2020-10-06T08:16:45Z", "author": {"login": "HTHou"}, "path": "server/src/test/java/org/apache/iotdb/db/query/aggregation/AggregateResultTest.java", "diffHunk": "@@ -62,9 +62,9 @@ public void avgAggrResultTest() throws QueryProcessException, IOException {\n   @Test\n   public void maxValueAggrResultTest() throws QueryProcessException, IOException {\n     AggregateResult maxValueAggrResult1 = AggregateResultFactory\n-        .getAggrResultByName(SQLConstant.MAX_VALUE, TSDataType.DOUBLE);\n+        .getAggrResultByName(SQLConstant.MAX_VALUE, TSDataType.DOUBLE,true);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5b7c939db938d237e7e3263af2b2ba95de158c7d"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDA4OTA4Mg==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    .getAggrResultByName(SQLConstant.MAX_VALUE, TSDataType.DOUBLE,true);\n          \n          \n            \n                    .getAggrResultByName(SQLConstant.MAX_VALUE, TSDataType.DOUBLE, true);", "url": "https://github.com/apache/iotdb/pull/1751#discussion_r500089082", "createdAt": "2020-10-06T08:16:54Z", "author": {"login": "HTHou"}, "path": "server/src/test/java/org/apache/iotdb/db/query/aggregation/AggregateResultTest.java", "diffHunk": "@@ -62,9 +62,9 @@ public void avgAggrResultTest() throws QueryProcessException, IOException {\n   @Test\n   public void maxValueAggrResultTest() throws QueryProcessException, IOException {\n     AggregateResult maxValueAggrResult1 = AggregateResultFactory\n-        .getAggrResultByName(SQLConstant.MAX_VALUE, TSDataType.DOUBLE);\n+        .getAggrResultByName(SQLConstant.MAX_VALUE, TSDataType.DOUBLE,true);\n     AggregateResult maxValueAggrResult2 = AggregateResultFactory\n-        .getAggrResultByName(SQLConstant.MAX_VALUE, TSDataType.DOUBLE);\n+        .getAggrResultByName(SQLConstant.MAX_VALUE, TSDataType.DOUBLE,true);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5b7c939db938d237e7e3263af2b2ba95de158c7d"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDA5NDU3NQ==", "bodyText": "Change to < here?", "url": "https://github.com/apache/iotdb/pull/1751#discussion_r500094575", "createdAt": "2020-10-06T08:25:22Z", "author": {"login": "HTHou"}, "path": "tsfile/src/main/java/org/apache/iotdb/tsfile/read/filter/GroupByFilter.java", "diffHunk": "@@ -65,7 +65,7 @@ public boolean satisfyStartEndTime(long startTime, long endTime) {\n       return false;\n     else if (startTime <= this.startTime)\n       return true;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5b7c939db938d237e7e3263af2b2ba95de158c7d"}, "originalPosition": 16}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "417e82f9ca81944787374acadeacc4b1c1fa808d", "author": {"user": {"login": "Alima777", "name": "Xiangwei Wei"}}, "url": "https://github.com/apache/iotdb/commit/417e82f9ca81944787374acadeacc4b1c1fa808d", "committedDate": "2020-10-07T11:52:06Z", "message": "fix based on review"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d7c39d0396c67614bf53ea00bef143d033d24405", "author": {"user": {"login": "Alima777", "name": "Xiangwei Wei"}}, "url": "https://github.com/apache/iotdb/commit/d7c39d0396c67614bf53ea00bef143d033d24405", "committedDate": "2020-10-10T04:06:55Z", "message": "merge master"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dcaa37b5ff53062bb93a73b4dc97a3c94a6f6acd", "author": {"user": {"login": "Alima777", "name": "Xiangwei Wei"}}, "url": "https://github.com/apache/iotdb/commit/dcaa37b5ff53062bb93a73b4dc97a3c94a6f6acd", "committedDate": "2020-10-11T06:56:59Z", "message": "fix merge bug"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8f0374418e740afcac26f6128ea1c658aa14e835", "author": {"user": {"login": "Alima777", "name": "Xiangwei Wei"}}, "url": "https://github.com/apache/iotdb/commit/8f0374418e740afcac26f6128ea1c658aa14e835", "committedDate": "2020-10-22T12:14:59Z", "message": "fix conflict"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "de1cf147d51e99bb5d39d2c5c8f7ec63d62987da", "author": {"user": {"login": "Alima777", "name": "Xiangwei Wei"}}, "url": "https://github.com/apache/iotdb/commit/de1cf147d51e99bb5d39d2c5c8f7ec63d62987da", "committedDate": "2020-10-22T12:15:34Z", "message": "Merge branch 'aggOptimization' of https://github.com/Alima777/incubator-iotdb into aggOptimization"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE1MjM0NzI5", "url": "https://github.com/apache/iotdb/pull/1751#pullrequestreview-515234729", "createdAt": "2020-10-23T02:20:49Z", "commit": {"oid": "de1cf147d51e99bb5d39d2c5c8f7ec63d62987da"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3879, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}