{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc5OTYzNzYy", "number": 838, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yN1QwMToyMjo1NFrODjTUYg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yN1QwMTozMzoyN1rODjTbZw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM4MzQzMjY2OnYy", "diffSide": "RIGHT", "path": "jdbc/src/main/java/org/apache/iotdb/jdbc/IoTDBResultMetadata.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yN1QwMToyMjo1NFrOFvCQNw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yN1QwMTo0ODowMlrOFvCp_g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDg2NDMxMQ==", "bodyText": "What if columnInfoList is null? I think you can return 0 if it is null.", "url": "https://github.com/apache/iotdb/pull/838#discussion_r384864311", "createdAt": "2020-02-27T01:22:54Z", "author": {"login": "JackieTien97"}, "path": "jdbc/src/main/java/org/apache/iotdb/jdbc/IoTDBResultMetadata.java", "diffHunk": "@@ -59,10 +59,7 @@ public String getColumnClassName(int arg0) throws SQLException {\n   }\n \n   @Override\n-  public int getColumnCount() throws SQLException {\n-    if (columnInfoList == null || columnInfoList.isEmpty()) {\n-      throw new SQLException(\"No column exists\");\n-    }\n+  public int getColumnCount() {\n     return columnInfoList.size();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2ea5601fc405829a745585ef70c6ae81c940fb9d"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDg2ODY3MQ==", "bodyText": "I think it is okay to have null columnInfoList, which means some error occurs. If the size columnInfoList is 0, it means it is an empty list. What do you think?", "url": "https://github.com/apache/iotdb/pull/838#discussion_r384868671", "createdAt": "2020-02-27T01:39:40Z", "author": {"login": "samperson1997"}, "path": "jdbc/src/main/java/org/apache/iotdb/jdbc/IoTDBResultMetadata.java", "diffHunk": "@@ -59,10 +59,7 @@ public String getColumnClassName(int arg0) throws SQLException {\n   }\n \n   @Override\n-  public int getColumnCount() throws SQLException {\n-    if (columnInfoList == null || columnInfoList.isEmpty()) {\n-      throw new SQLException(\"No column exists\");\n-    }\n+  public int getColumnCount() {\n     return columnInfoList.size();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDg2NDMxMQ=="}, "originalCommit": {"oid": "2ea5601fc405829a745585ef70c6ae81c940fb9d"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDg3MDkxMA==", "bodyText": "Actually, in the normal process, this couldn't be null, but in case others set a null in the future, check null is better", "url": "https://github.com/apache/iotdb/pull/838#discussion_r384870910", "createdAt": "2020-02-27T01:48:02Z", "author": {"login": "qiaojialin"}, "path": "jdbc/src/main/java/org/apache/iotdb/jdbc/IoTDBResultMetadata.java", "diffHunk": "@@ -59,10 +59,7 @@ public String getColumnClassName(int arg0) throws SQLException {\n   }\n \n   @Override\n-  public int getColumnCount() throws SQLException {\n-    if (columnInfoList == null || columnInfoList.isEmpty()) {\n-      throw new SQLException(\"No column exists\");\n-    }\n+  public int getColumnCount() {\n     return columnInfoList.size();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDg2NDMxMQ=="}, "originalCommit": {"oid": "2ea5601fc405829a745585ef70c6ae81c940fb9d"}, "originalPosition": 9}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM4MzQzNTA2OnYy", "diffSide": "RIGHT", "path": "jdbc/src/test/java/org/apache/iotdb/jdbc/IoTDBResultMetadataTest.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yN1QwMToyNDoyM1rOFvCRwQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yN1QwMTo1NDo1MVrOFvCwyQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDg2NDcwNQ==", "bodyText": "If you also return 0 when it's null, like I suggested above, don't forget to change assert here.", "url": "https://github.com/apache/iotdb/pull/838#discussion_r384864705", "createdAt": "2020-02-27T01:24:23Z", "author": {"login": "JackieTien97"}, "path": "jdbc/src/test/java/org/apache/iotdb/jdbc/IoTDBResultMetadataTest.java", "diffHunk": "@@ -120,7 +124,7 @@ public void testGetColumnType() throws SQLException {\n     } catch (Exception e) {\n       flag = true;\n     }\n-    assertEquals(flag, true);\n+    assertTrue(flag);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2ea5601fc405829a745585ef70c6ae81c940fb9d"}, "originalPosition": 90}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDg3MjY0OQ==", "bodyText": "fixed", "url": "https://github.com/apache/iotdb/pull/838#discussion_r384872649", "createdAt": "2020-02-27T01:54:51Z", "author": {"login": "qiaojialin"}, "path": "jdbc/src/test/java/org/apache/iotdb/jdbc/IoTDBResultMetadataTest.java", "diffHunk": "@@ -120,7 +124,7 @@ public void testGetColumnType() throws SQLException {\n     } catch (Exception e) {\n       flag = true;\n     }\n-    assertEquals(flag, true);\n+    assertTrue(flag);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDg2NDcwNQ=="}, "originalCommit": {"oid": "2ea5601fc405829a745585ef70c6ae81c940fb9d"}, "originalPosition": 90}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM4MzQ0MjE5OnYy", "diffSide": "RIGHT", "path": "server/src/test/java/org/apache/iotdb/db/integration/IoTDBSimpleQueryTest.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yN1QwMToyODo1NlrOFvCWUQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yN1QwMTo1ODoxMFrOFvC0TQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDg2NTg3Mw==", "bodyText": "The comment here should be has an empty time column and device column", "url": "https://github.com/apache/iotdb/pull/838#discussion_r384865873", "createdAt": "2020-02-27T01:28:56Z", "author": {"login": "JackieTien97"}, "path": "server/src/test/java/org/apache/iotdb/db/integration/IoTDBSimpleQueryTest.java", "diffHunk": "@@ -41,6 +44,62 @@ public void tearDown() throws Exception {\n     EnvironmentUtils.cleanEnv();\n   }\n \n+  @Test\n+  public void testEmptyDataSet() throws SQLException, ClassNotFoundException {\n+    Class.forName(Config.JDBC_DRIVER_NAME);\n+    try(Connection connection = DriverManager\n+        .getConnection(Config.IOTDB_URL_PREFIX + \"127.0.0.1:6667/\", \"root\", \"root\");\n+        Statement statement = connection.createStatement()){\n+\n+      ResultSet resultSet = statement.executeQuery(\"select * from root\");\n+      // has an empty time column\n+      Assert.assertEquals(1, resultSet.getMetaData().getColumnCount());\n+      while(resultSet.next()) {\n+        fail();\n+      }\n+\n+      resultSet = statement.executeQuery(\n+          \"select count(*) from root where time >= 1 and time <= 100 group by ([0, 100), 20ms, 20ms)\");\n+      // has an empty time column\n+      Assert.assertEquals(1, resultSet.getMetaData().getColumnCount());\n+      while (resultSet.next()) {\n+        fail();\n+      }\n+\n+      resultSet = statement.executeQuery(\"select count(*) from root\");\n+      // has no column\n+      Assert.assertEquals(0, resultSet.getMetaData().getColumnCount());\n+      while(resultSet.next()) {\n+        fail();\n+      }\n+\n+      resultSet = statement.executeQuery(\"select * from root align by device\");\n+      // has time and device columns\n+      Assert.assertEquals(2, resultSet.getMetaData().getColumnCount());\n+      while(resultSet.next()) {\n+        fail();\n+      }\n+\n+      resultSet = statement.executeQuery(\"select count(*) from root align by device\");\n+      // has device column\n+      Assert.assertEquals(1, resultSet.getMetaData().getColumnCount());\n+      while(resultSet.next()) {\n+        fail();\n+      }\n+\n+      resultSet = statement.executeQuery(\n+          \"select count(*) from root where time >= 1 and time <= 100 \"\n+              + \"group by ([0, 100), 20ms, 20ms) align by device\");\n+      // has an empty time column\n+      Assert.assertEquals(2, resultSet.getMetaData().getColumnCount());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2ea5601fc405829a745585ef70c6ae81c940fb9d"}, "originalPosition": 68}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDg3MzU0OQ==", "bodyText": "fixed", "url": "https://github.com/apache/iotdb/pull/838#discussion_r384873549", "createdAt": "2020-02-27T01:58:10Z", "author": {"login": "qiaojialin"}, "path": "server/src/test/java/org/apache/iotdb/db/integration/IoTDBSimpleQueryTest.java", "diffHunk": "@@ -41,6 +44,62 @@ public void tearDown() throws Exception {\n     EnvironmentUtils.cleanEnv();\n   }\n \n+  @Test\n+  public void testEmptyDataSet() throws SQLException, ClassNotFoundException {\n+    Class.forName(Config.JDBC_DRIVER_NAME);\n+    try(Connection connection = DriverManager\n+        .getConnection(Config.IOTDB_URL_PREFIX + \"127.0.0.1:6667/\", \"root\", \"root\");\n+        Statement statement = connection.createStatement()){\n+\n+      ResultSet resultSet = statement.executeQuery(\"select * from root\");\n+      // has an empty time column\n+      Assert.assertEquals(1, resultSet.getMetaData().getColumnCount());\n+      while(resultSet.next()) {\n+        fail();\n+      }\n+\n+      resultSet = statement.executeQuery(\n+          \"select count(*) from root where time >= 1 and time <= 100 group by ([0, 100), 20ms, 20ms)\");\n+      // has an empty time column\n+      Assert.assertEquals(1, resultSet.getMetaData().getColumnCount());\n+      while (resultSet.next()) {\n+        fail();\n+      }\n+\n+      resultSet = statement.executeQuery(\"select count(*) from root\");\n+      // has no column\n+      Assert.assertEquals(0, resultSet.getMetaData().getColumnCount());\n+      while(resultSet.next()) {\n+        fail();\n+      }\n+\n+      resultSet = statement.executeQuery(\"select * from root align by device\");\n+      // has time and device columns\n+      Assert.assertEquals(2, resultSet.getMetaData().getColumnCount());\n+      while(resultSet.next()) {\n+        fail();\n+      }\n+\n+      resultSet = statement.executeQuery(\"select count(*) from root align by device\");\n+      // has device column\n+      Assert.assertEquals(1, resultSet.getMetaData().getColumnCount());\n+      while(resultSet.next()) {\n+        fail();\n+      }\n+\n+      resultSet = statement.executeQuery(\n+          \"select count(*) from root where time >= 1 and time <= 100 \"\n+              + \"group by ([0, 100), 20ms, 20ms) align by device\");\n+      // has an empty time column\n+      Assert.assertEquals(2, resultSet.getMetaData().getColumnCount());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDg2NTg3Mw=="}, "originalCommit": {"oid": "2ea5601fc405829a745585ef70c6ae81c940fb9d"}, "originalPosition": 68}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM4MzQ1MDYzOnYy", "diffSide": "RIGHT", "path": "server/src/main/java/org/apache/iotdb/db/qp/executor/PlanExecutor.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yN1QwMTozMzoyN1rOFvCbQw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yN1QwMjoyMDoxN1rOFvDK4A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDg2NzEzOQ==", "bodyText": "No need to do this change, the limit and offset are ignored in group by.", "url": "https://github.com/apache/iotdb/pull/838#discussion_r384867139", "createdAt": "2020-02-27T01:33:27Z", "author": {"login": "JackieTien97"}, "path": "server/src/main/java/org/apache/iotdb/db/qp/executor/PlanExecutor.java", "diffHunk": "@@ -228,9 +229,12 @@ private QueryDataSet processDataQuery(QueryPlan queryPlan, QueryContext context)\n     if (queryPlan instanceof AlignByDevicePlan) {\n       queryDataSet = new AlignByDeviceDataSet((AlignByDevicePlan) queryPlan, context, queryRouter);\n     } else {\n-      if (queryPlan instanceof GroupByPlan) {\n+      if (queryPlan.getPaths() == null || queryPlan.getPaths().isEmpty()) {\n+        // no time series are selected, return EmptyDataSet\n+        return new EmptyDataSet();\n+      } else if (queryPlan instanceof GroupByPlan) {\n         GroupByPlan groupByPlan = (GroupByPlan) queryPlan;\n-        return queryRouter.groupBy(groupByPlan, context);\n+        queryDataSet =  queryRouter.groupBy(groupByPlan, context);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2ea5601fc405829a745585ef70c6ae81c940fb9d"}, "originalPosition": 19}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDg2NzQ3MQ==", "bodyText": "Or you can add a JIRA to report this, actually in syntax, we support limit and offset in group by, but we just ignore these two in the code.", "url": "https://github.com/apache/iotdb/pull/838#discussion_r384867471", "createdAt": "2020-02-27T01:34:57Z", "author": {"login": "JackieTien97"}, "path": "server/src/main/java/org/apache/iotdb/db/qp/executor/PlanExecutor.java", "diffHunk": "@@ -228,9 +229,12 @@ private QueryDataSet processDataQuery(QueryPlan queryPlan, QueryContext context)\n     if (queryPlan instanceof AlignByDevicePlan) {\n       queryDataSet = new AlignByDeviceDataSet((AlignByDevicePlan) queryPlan, context, queryRouter);\n     } else {\n-      if (queryPlan instanceof GroupByPlan) {\n+      if (queryPlan.getPaths() == null || queryPlan.getPaths().isEmpty()) {\n+        // no time series are selected, return EmptyDataSet\n+        return new EmptyDataSet();\n+      } else if (queryPlan instanceof GroupByPlan) {\n         GroupByPlan groupByPlan = (GroupByPlan) queryPlan;\n-        return queryRouter.groupBy(groupByPlan, context);\n+        queryDataSet =  queryRouter.groupBy(groupByPlan, context);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDg2NzEzOQ=="}, "originalCommit": {"oid": "2ea5601fc405829a745585ef70c6ae81c940fb9d"}, "originalPosition": 19}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDg3OTMyOA==", "bodyText": "I updated the docs", "url": "https://github.com/apache/iotdb/pull/838#discussion_r384879328", "createdAt": "2020-02-27T02:20:17Z", "author": {"login": "qiaojialin"}, "path": "server/src/main/java/org/apache/iotdb/db/qp/executor/PlanExecutor.java", "diffHunk": "@@ -228,9 +229,12 @@ private QueryDataSet processDataQuery(QueryPlan queryPlan, QueryContext context)\n     if (queryPlan instanceof AlignByDevicePlan) {\n       queryDataSet = new AlignByDeviceDataSet((AlignByDevicePlan) queryPlan, context, queryRouter);\n     } else {\n-      if (queryPlan instanceof GroupByPlan) {\n+      if (queryPlan.getPaths() == null || queryPlan.getPaths().isEmpty()) {\n+        // no time series are selected, return EmptyDataSet\n+        return new EmptyDataSet();\n+      } else if (queryPlan instanceof GroupByPlan) {\n         GroupByPlan groupByPlan = (GroupByPlan) queryPlan;\n-        return queryRouter.groupBy(groupByPlan, context);\n+        queryDataSet =  queryRouter.groupBy(groupByPlan, context);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDg2NzEzOQ=="}, "originalCommit": {"oid": "2ea5601fc405829a745585ef70c6ae81c940fb9d"}, "originalPosition": 19}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 246, "cost": 1, "resetAt": "2021-11-12T09:44:50Z"}}}