{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY4MjgwNzc0", "number": 1624, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xNlQwMjo0Mjo0MVrOEYwn8Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xN1QxNDo0NTowNVrOEZE6dg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk0Mzk3OTM3OnYy", "diffSide": "RIGHT", "path": "tsfile/src/main/java/org/apache/iotdb/tsfile/write/writer/TsFileIOWriter.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xNlQwMjo0Mjo0MVrOHBPA1A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xNlQwMzoyNToyN1rOHBPMhA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTA1NjU5Ng==", "bodyText": "what's this for?", "url": "https://github.com/apache/iotdb/pull/1624#discussion_r471056596", "createdAt": "2020-08-16T02:42:41Z", "author": {"login": "qiaojialin"}, "path": "tsfile/src/main/java/org/apache/iotdb/tsfile/write/writer/TsFileIOWriter.java", "diffHunk": "@@ -335,6 +335,21 @@ public long getPos() throws IOException {\n     return deviceChunkMetadataMap;\n   }\n \n+  public void deleteMeasurementFromChunkGroupMetadataList(String deviceId, String measurementId) {\n+    for (ChunkGroupMetadata chunkGroupMetadata : chunkGroupMetadataList) {\n+      VersionUtils.applyVersion(chunkGroupMetadata.getChunkMetadataList(), versionInfo);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4006e0a4362bc999a67e7ffe4ed6b8b6e6ad9362"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTA1OTU4OA==", "bodyText": "Removed", "url": "https://github.com/apache/iotdb/pull/1624#discussion_r471059588", "createdAt": "2020-08-16T03:25:27Z", "author": {"login": "samperson1997"}, "path": "tsfile/src/main/java/org/apache/iotdb/tsfile/write/writer/TsFileIOWriter.java", "diffHunk": "@@ -335,6 +335,21 @@ public long getPos() throws IOException {\n     return deviceChunkMetadataMap;\n   }\n \n+  public void deleteMeasurementFromChunkGroupMetadataList(String deviceId, String measurementId) {\n+    for (ChunkGroupMetadata chunkGroupMetadata : chunkGroupMetadataList) {\n+      VersionUtils.applyVersion(chunkGroupMetadata.getChunkMetadataList(), versionInfo);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTA1NjU5Ng=="}, "originalCommit": {"oid": "4006e0a4362bc999a67e7ffe4ed6b8b6e6ad9362"}, "originalPosition": 6}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk0NzMwMzU4OnYy", "diffSide": "RIGHT", "path": "server/src/main/java/org/apache/iotdb/db/engine/storagegroup/TsFileProcessor.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xN1QxNDo0NTowNVrOHBr2NA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xN1QxNDo0NTowNVrOHBr2NA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTUyOTAxMg==", "bodyText": "this does not take effect?", "url": "https://github.com/apache/iotdb/pull/1624#discussion_r471529012", "createdAt": "2020-08-17T14:45:05Z", "author": {"login": "qiaojialin"}, "path": "server/src/main/java/org/apache/iotdb/db/engine/storagegroup/TsFileProcessor.java", "diffHunk": "@@ -244,6 +244,13 @@ public void deleteDataInMemory(Deletion deletion) {\n         workMemTable\n             .delete(deletion.getDevice(), deletion.getMeasurement(), deletion.getTimestamp());\n       }\n+\n+      // clear ChunkMetaData of the deleted timeseries\n+      if (deletion.getTimestamp() == Long.MAX_VALUE) {\n+        writer.deleteMeasurementFromChunkGroupMetadataList(deletion.getDevice(),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8d1dc85fe5c8d7f5a69303775f120f2da89065d8"}, "originalPosition": 7}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4651, "cost": 1, "resetAt": "2021-11-12T11:18:39Z"}}}