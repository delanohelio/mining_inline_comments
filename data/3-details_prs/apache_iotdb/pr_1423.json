{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQwNzI4OTIy", "number": 1423, "title": "[IOTDB-782] [Experimental] Clear mlog when creating snapshot", "bodyText": "Clear mlog.txt when creating snapshot, and thus avoid reading and skipping the lines which are already in mtree.snapshot.", "createdAt": "2020-06-26T18:32:09Z", "url": "https://github.com/apache/iotdb/pull/1423", "merged": true, "mergeCommit": {"oid": "a9e9c9763544f6c920f2512a7b821f468b4d1e4e"}, "closed": true, "closedAt": "2020-06-29T03:16:40Z", "author": {"login": "samperson1997"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcvkUywgH2gAyNDQwNzI4OTIyOjczYzA3ZjI1ZjYwN2Q0NjYyNDdkZmJiMThkMTc5NzMwOWQ3NGJiNjA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcv4Sv0gFqTQzODg2MjE2Ng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "73c07f25f607d466247dfbb18d1797309d74bb60", "author": {"user": {"login": "samperson1997", "name": "Zesong Sun"}}, "url": "https://github.com/apache/iotdb/commit/73c07f25f607d466247dfbb18d1797309d74bb60", "committedDate": "2020-06-28T03:59:49Z", "message": "Clear mlog when creating snapshot"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "463321f87b9098adc6e50176374943d0ccfd3525", "author": {"user": {"login": "samperson1997", "name": "Zesong Sun"}}, "url": "https://github.com/apache/iotdb/commit/463321f87b9098adc6e50176374943d0ccfd3525", "committedDate": "2020-06-26T18:27:29Z", "message": "[Experimental] Clear mlog when creating snapshot"}, "afterCommit": {"oid": "73c07f25f607d466247dfbb18d1797309d74bb60", "author": {"user": {"login": "samperson1997", "name": "Zesong Sun"}}, "url": "https://github.com/apache/iotdb/commit/73c07f25f607d466247dfbb18d1797309d74bb60", "committedDate": "2020-06-28T03:59:49Z", "message": "Clear mlog when creating snapshot"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "55f0d3454f51c8b2de6c41648638de4ee6b306d7", "author": {"user": {"login": "samperson1997", "name": "Zesong Sun"}}, "url": "https://github.com/apache/iotdb/commit/55f0d3454f51c8b2de6c41648638de4ee6b306d7", "committedDate": "2020-06-28T12:13:35Z", "message": "No need to serialize snapshotLineNumber\nAdd user guide and system design documents"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b798469c563386df70151ca9566a267da7da0bda", "author": {"user": {"login": "samperson1997", "name": "Zesong Sun"}}, "url": "https://github.com/apache/iotdb/commit/b798469c563386df70151ca9566a267da7da0bda", "committedDate": "2020-06-28T12:21:43Z", "message": "Fix typo"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8a78c46ba29c4391b6e18ddf0ed536529cbb5f4f", "author": {"user": {"login": "samperson1997", "name": "Zesong Sun"}}, "url": "https://github.com/apache/iotdb/commit/8a78c46ba29c4391b6e18ddf0ed536529cbb5f4f", "committedDate": "2020-06-28T15:34:53Z", "message": "Add more system design documents"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM4ODM2NDIw", "url": "https://github.com/apache/iotdb/pull/1423#pullrequestreview-438836420", "createdAt": "2020-06-29T01:18:08Z", "commit": {"oid": "8a78c46ba29c4391b6e18ddf0ed536529cbb5f4f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yOVQwMToxODowOVrOGqB_3A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yOVQwMToxODowOVrOGqB_3A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjcyNjEwOA==", "bodyText": "Maybe you should use file.getChannel().truncate(0) to clear mlog", "url": "https://github.com/apache/iotdb/pull/1423#discussion_r446726108", "createdAt": "2020-06-29T01:18:09Z", "author": {"login": "SilverNarcissus"}, "path": "server/src/main/java/org/apache/iotdb/db/metadata/MLogWriter.java", "diffHunk": "@@ -160,6 +162,14 @@ public static void upgradeMLog(String schemaDir, String logFileName) throws IOEx\n     FSFactoryProducer.getFSFactory().moveFile(tmpLogFile, logFile);\n   }\n \n+  public void clear() throws IOException {\n+    writer.close();\n+    Files.delete(logFile.toPath());\n+    FileWriter fileWriter = new FileWriter(logFile, true);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8a78c46ba29c4391b6e18ddf0ed536529cbb5f4f"}, "originalPosition": 32}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM4ODYyMTY2", "url": "https://github.com/apache/iotdb/pull/1423#pullrequestreview-438862166", "createdAt": "2020-06-29T03:15:41Z", "commit": {"oid": "8a78c46ba29c4391b6e18ddf0ed536529cbb5f4f"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3652, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}