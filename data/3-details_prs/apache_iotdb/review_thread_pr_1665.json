{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDc2NzkyMDU3", "number": 1665, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMlQwNzoxNzoxM1rOEfToFA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wNVQwODowMToyMlrOEglOZQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAxMjYyODY4OnYy", "diffSide": "RIGHT", "path": "server/src/main/java/org/apache/iotdb/db/writelog/recover/LogReplayer.java", "isResolved": false, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMlQwNzoxNzoxM1rOHLgCMA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wM1QxMTo1MjoxOVrOHMjCew==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTgyMTIzMg==", "bodyText": "add comment to explain the reason", "url": "https://github.com/apache/iotdb/pull/1665#discussion_r481821232", "createdAt": "2020-09-02T07:17:13Z", "author": {"login": "mychaow"}, "path": "server/src/main/java/org/apache/iotdb/db/writelog/recover/LogReplayer.java", "diffHunk": "@@ -164,11 +164,14 @@ private void replayInsert(InsertPlan plan) throws WriteProcessException, QueryPr\n     }\n     if (plan instanceof InsertRowPlan) {\n       InsertRowPlan tPlan = (InsertRowPlan) plan;\n+      ((InsertRowPlan) plan).setNeedInferType(false);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c818bd5bb9620d6d9797bbcc14640d6c3fcc7cfc"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Mjc1NzA2MQ==", "bodyText": "I think it will make others confused in the deserialization of InsertRowPlan. Cause that we should gurantee that the result of serialization and deserialization is the same, this set operation should be better in the here.", "url": "https://github.com/apache/iotdb/pull/1665#discussion_r482757061", "createdAt": "2020-09-03T07:13:55Z", "author": {"login": "mychaow"}, "path": "server/src/main/java/org/apache/iotdb/db/writelog/recover/LogReplayer.java", "diffHunk": "@@ -164,11 +164,14 @@ private void replayInsert(InsertPlan plan) throws WriteProcessException, QueryPr\n     }\n     if (plan instanceof InsertRowPlan) {\n       InsertRowPlan tPlan = (InsertRowPlan) plan;\n+      ((InsertRowPlan) plan).setNeedInferType(false);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTgyMTIzMg=="}, "originalCommit": {"oid": "c818bd5bb9620d6d9797bbcc14640d6c3fcc7cfc"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjgzNzY0OQ==", "bodyText": "+1", "url": "https://github.com/apache/iotdb/pull/1665#discussion_r482837649", "createdAt": "2020-09-03T09:25:40Z", "author": {"login": "qiaojialin"}, "path": "server/src/main/java/org/apache/iotdb/db/writelog/recover/LogReplayer.java", "diffHunk": "@@ -164,11 +164,14 @@ private void replayInsert(InsertPlan plan) throws WriteProcessException, QueryPr\n     }\n     if (plan instanceof InsertRowPlan) {\n       InsertRowPlan tPlan = (InsertRowPlan) plan;\n+      ((InsertRowPlan) plan).setNeedInferType(false);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTgyMTIzMg=="}, "originalCommit": {"oid": "c818bd5bb9620d6d9797bbcc14640d6c3fcc7cfc"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjkxOTAzNQ==", "bodyText": "Please put the ((InsertRowPlan) plan).setNeedInferType(false); into the deserialization of InsertRowPlan\n\nI think we should make the two function serialize(ByteBuffer) and Serialize(DataOutputStream)  have same action, so it's not a good way to setNeedInferType in deserialization.", "url": "https://github.com/apache/iotdb/pull/1665#discussion_r482919035", "createdAt": "2020-09-03T11:52:19Z", "author": {"login": "mychaow"}, "path": "server/src/main/java/org/apache/iotdb/db/writelog/recover/LogReplayer.java", "diffHunk": "@@ -164,11 +164,14 @@ private void replayInsert(InsertPlan plan) throws WriteProcessException, QueryPr\n     }\n     if (plan instanceof InsertRowPlan) {\n       InsertRowPlan tPlan = (InsertRowPlan) plan;\n+      ((InsertRowPlan) plan).setNeedInferType(false);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTgyMTIzMg=="}, "originalCommit": {"oid": "c818bd5bb9620d6d9797bbcc14640d6c3fcc7cfc"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAyNTk5NzgxOnYy", "diffSide": "RIGHT", "path": "server/src/main/java/org/apache/iotdb/db/writelog/recover/LogReplayer.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wNVQwODowMToyMlrOHNgb-Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wNVQxMToyMjo1OFrOHNhb3A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzkyNDk4NQ==", "bodyText": "seems setSchemasAndTransferType  has marked the related data point failed already.", "url": "https://github.com/apache/iotdb/pull/1665#discussion_r483924985", "createdAt": "2020-09-05T08:01:22Z", "author": {"login": "jixuan1989"}, "path": "server/src/main/java/org/apache/iotdb/db/writelog/recover/LogReplayer.java", "diffHunk": "@@ -164,11 +164,17 @@ private void replayInsert(InsertPlan plan) throws WriteProcessException, QueryPr\n     }\n     if (plan instanceof InsertRowPlan) {\n       InsertRowPlan tPlan = (InsertRowPlan) plan;\n+      //only infer type when users pass a String value\n+      //WAL already serializes the real data type, so no need to infer type\n+      ((InsertRowPlan) plan).setNeedInferType(false);\n       tPlan.setSchemasAndTransferType(schemas);\n+      //mark failed plan manually \n+      checkDataTypeAndMarkFailed(schemas, tPlan);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2d8e5b8cb3ba4bd0b39dabc684fdcb8628b09803"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzkzNTI1OA==", "bodyText": "Hi thank you for your review!\nHere i set plan.setNeedInferType(false)\nin setSchemasAndTransferType(schemas), it will only execute this.schemas = schemas\nit will not mark the data points as failed", "url": "https://github.com/apache/iotdb/pull/1665#discussion_r483935258", "createdAt": "2020-09-05T10:05:13Z", "author": {"login": "haimeiguo"}, "path": "server/src/main/java/org/apache/iotdb/db/writelog/recover/LogReplayer.java", "diffHunk": "@@ -164,11 +164,17 @@ private void replayInsert(InsertPlan plan) throws WriteProcessException, QueryPr\n     }\n     if (plan instanceof InsertRowPlan) {\n       InsertRowPlan tPlan = (InsertRowPlan) plan;\n+      //only infer type when users pass a String value\n+      //WAL already serializes the real data type, so no need to infer type\n+      ((InsertRowPlan) plan).setNeedInferType(false);\n       tPlan.setSchemasAndTransferType(schemas);\n+      //mark failed plan manually \n+      checkDataTypeAndMarkFailed(schemas, tPlan);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzkyNDk4NQ=="}, "originalCommit": {"oid": "2d8e5b8cb3ba4bd0b39dabc684fdcb8628b09803"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Mzk0MTM0MA==", "bodyText": "I see.", "url": "https://github.com/apache/iotdb/pull/1665#discussion_r483941340", "createdAt": "2020-09-05T11:22:58Z", "author": {"login": "jixuan1989"}, "path": "server/src/main/java/org/apache/iotdb/db/writelog/recover/LogReplayer.java", "diffHunk": "@@ -164,11 +164,17 @@ private void replayInsert(InsertPlan plan) throws WriteProcessException, QueryPr\n     }\n     if (plan instanceof InsertRowPlan) {\n       InsertRowPlan tPlan = (InsertRowPlan) plan;\n+      //only infer type when users pass a String value\n+      //WAL already serializes the real data type, so no need to infer type\n+      ((InsertRowPlan) plan).setNeedInferType(false);\n       tPlan.setSchemasAndTransferType(schemas);\n+      //mark failed plan manually \n+      checkDataTypeAndMarkFailed(schemas, tPlan);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzkyNDk4NQ=="}, "originalCommit": {"oid": "2d8e5b8cb3ba4bd0b39dabc684fdcb8628b09803"}, "originalPosition": 9}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4685, "cost": 1, "resetAt": "2021-11-12T11:18:39Z"}}}