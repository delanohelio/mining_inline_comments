{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg5NTg4NzQ2", "number": 916, "title": "fix execute flush command while inserting bug", "bodyText": "When calling flush command.\nStorageEngine call syncCloseAllTsFileProcessors for each StorageGroupProcessor.\nThen, there may be an insert, which causes a new TsFileResource to be added to the list.\nThen, StorageEngine call closeAllResource for each StorageGroupProcessor, the newly created resource is marked as closed but it is actually an empty file.\nWhen executing query, the file will be seen as a closed file and read TsFileMetadata, the error occurs.", "createdAt": "2020-03-17T02:40:31Z", "url": "https://github.com/apache/iotdb/pull/916", "merged": true, "mergeCommit": {"oid": "8681bb2d53c094086e8586a05959f5f5f8612896"}, "closed": true, "closedAt": "2020-03-17T05:46:40Z", "author": {"login": "qiaojialin"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcOZcK0gH2gAyMzg5NTg4NzQ2OjkzMDI3MzRiZmRjMmJmMDA5MmFiYWYzZjZhNWJiNDA2ODY0YTRmNjI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcOZ8bRgFqTM3NTcxNDM4Nw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "9302734bfdc2bf0092abaf3f6a5bb406864a4f62", "author": {"user": {"login": "qiaojialin", "name": "Jialin Qiao"}}, "url": "https://github.com/apache/iotdb/commit/9302734bfdc2bf0092abaf3f6a5bb406864a4f62", "committedDate": "2020-03-17T02:39:25Z", "message": "fix flush"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc1NzA3MjM0", "url": "https://github.com/apache/iotdb/pull/916#pullrequestreview-375707234", "createdAt": "2020-03-17T02:57:51Z", "commit": {"oid": "9302734bfdc2bf0092abaf3f6a5bb406864a4f62"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QwMjo1Nzo1MlrOF3MUZw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QwMjo1Nzo1MlrOF3MUZw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzQxNzgzMQ==", "bodyText": "Don't we have to close the file resources? Should we move it to syncCloseAllTsFileProcessors() instead of directly deleting it?", "url": "https://github.com/apache/iotdb/pull/916#discussion_r393417831", "createdAt": "2020-03-17T02:57:52Z", "author": {"login": "JackieTien97"}, "path": "server/src/main/java/org/apache/iotdb/db/engine/StorageEngine.java", "diffHunk": "@@ -303,9 +303,7 @@ public void insert(InsertPlan insertPlan)\n   public void syncCloseAllProcessor() {\n     logger.info(\"Start closing all storage group processor\");\n     for (StorageGroupProcessor processor : processorMap.values()) {\n-      processor.waitForAllCurrentTsFileProcessorsClosed();\n-      //TODO do we need to wait for all merging tasks to be finished here?\n-      processor.closeAllResources();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9302734bfdc2bf0092abaf3f6a5bb406864a4f62"}, "originalPosition": 6}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "51558bf3e8982e1a691117b3a9e032ba45afd6e1", "author": {"user": {"login": "qiaojialin", "name": "Jialin Qiao"}}, "url": "https://github.com/apache/iotdb/commit/51558bf3e8982e1a691117b3a9e032ba45afd6e1", "committedDate": "2020-03-17T03:05:26Z", "message": "enable write when executing flush command"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "04eceef6df3a870371f0305e2595d78990765ffb", "author": {"user": {"login": "qiaojialin", "name": "Jialin Qiao"}}, "url": "https://github.com/apache/iotdb/commit/04eceef6df3a870371f0305e2595d78990765ffb", "committedDate": "2020-03-17T03:07:29Z", "message": "rename closeUnsealedTsFileProcessor to closeUnsealedTsFileProcessorCallBack"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc1NzE0Mzg3", "url": "https://github.com/apache/iotdb/pull/916#pullrequestreview-375714387", "createdAt": "2020-03-17T03:14:39Z", "commit": {"oid": "04eceef6df3a870371f0305e2595d78990765ffb"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3002, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}