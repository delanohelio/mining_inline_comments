{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTM0ODYyOTU1", "number": 2222, "reviewThreads": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMFQwMTowMDowNFrOFDNwzw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xOFQwMjowMTo1MVrOFP03Eg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM4OTE1NTM1OnYy", "diffSide": "RIGHT", "path": "session/src/main/java/org/apache/iotdb/session/pool/SessionPool.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMFQwMTowMDowNFrOICwjHA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMFQwMjo0NzozOVrOICy_Ug==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTc2MzQ4NA==", "bodyText": "Where is this set?", "url": "https://github.com/apache/iotdb/pull/2222#discussion_r539763484", "createdAt": "2020-12-10T01:00:04Z", "author": {"login": "jt2594838"}, "path": "session/src/main/java/org/apache/iotdb/session/pool/SessionPool.java", "diffHunk": "@@ -75,6 +75,7 @@\n   private long timeout; //ms\n   private static int FINAL_RETRY = RETRY - 1;\n   private boolean enableCompression = false;\n+  private boolean enableCacheLeader = false;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "593d9ec8beb824fc9142fbea4bd40a47bb561a06"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTgwMzQ3NA==", "bodyText": "OK, I will add this interfance for SessionPool~", "url": "https://github.com/apache/iotdb/pull/2222#discussion_r539803474", "createdAt": "2020-12-10T02:47:39Z", "author": {"login": "LebronAl"}, "path": "session/src/main/java/org/apache/iotdb/session/pool/SessionPool.java", "diffHunk": "@@ -75,6 +75,7 @@\n   private long timeout; //ms\n   private static int FINAL_RETRY = RETRY - 1;\n   private boolean enableCompression = false;\n+  private boolean enableCacheLeader = false;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTc2MzQ4NA=="}, "originalCommit": {"oid": "593d9ec8beb824fc9142fbea4bd40a47bb561a06"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM5NTMzNjg1OnYy", "diffSide": "RIGHT", "path": "session/src/main/java/org/apache/iotdb/session/pool/SessionPool.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMVQwNDowODowNFrOIDoPng==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMVQxMjo1ODowMlrOID3rFw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDY3NTk5OA==", "bodyText": "false -> Config.DEFAULT_CACHE_LEADER_MODE", "url": "https://github.com/apache/iotdb/pull/2222#discussion_r540675998", "createdAt": "2020-12-11T04:08:04Z", "author": {"login": "jixuan1989"}, "path": "session/src/main/java/org/apache/iotdb/session/pool/SessionPool.java", "diffHunk": "@@ -74,29 +74,36 @@\n   private int fetchSize;\n   private long timeout; //ms\n   private static int FINAL_RETRY = RETRY - 1;\n-  private boolean enableCompression = false;\n+  private boolean enableCompression;\n+  private boolean enableCacheLeader;\n   private ZoneId zoneId;\n \n   private boolean closed;//whether the queue is closed.\n \n   public SessionPool(String ip, int port, String user, String password, int maxSize) {\n-    this(ip, port, user, password, maxSize, Config.DEFAULT_FETCH_SIZE, 60_000, false, null);\n+    this(ip, port, user, password, maxSize, Config.DEFAULT_FETCH_SIZE, 60_000, false, null, false);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "aff21fc6ad4df4c2e1fe02e30af9a224f66f1026"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDkyODc5MQ==", "bodyText": "OK", "url": "https://github.com/apache/iotdb/pull/2222#discussion_r540928791", "createdAt": "2020-12-11T12:58:02Z", "author": {"login": "LebronAl"}, "path": "session/src/main/java/org/apache/iotdb/session/pool/SessionPool.java", "diffHunk": "@@ -74,29 +74,36 @@\n   private int fetchSize;\n   private long timeout; //ms\n   private static int FINAL_RETRY = RETRY - 1;\n-  private boolean enableCompression = false;\n+  private boolean enableCompression;\n+  private boolean enableCacheLeader;\n   private ZoneId zoneId;\n \n   private boolean closed;//whether the queue is closed.\n \n   public SessionPool(String ip, int port, String user, String password, int maxSize) {\n-    this(ip, port, user, password, maxSize, Config.DEFAULT_FETCH_SIZE, 60_000, false, null);\n+    this(ip, port, user, password, maxSize, Config.DEFAULT_FETCH_SIZE, 60_000, false, null, false);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDY3NTk5OA=="}, "originalCommit": {"oid": "aff21fc6ad4df4c2e1fe02e30af9a224f66f1026"}, "originalPosition": 13}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM5NTMzNzE4OnYy", "diffSide": "RIGHT", "path": "session/src/main/java/org/apache/iotdb/session/pool/SessionPool.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMVQwNDowODowOVrOIDoPxQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMVQxMjo1ODoyOVrOID3sMg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDY3NjAzNw==", "bodyText": "false -> Config.DEFAULT_CACHE_LEADER_MODE", "url": "https://github.com/apache/iotdb/pull/2222#discussion_r540676037", "createdAt": "2020-12-11T04:08:09Z", "author": {"login": "jixuan1989"}, "path": "session/src/main/java/org/apache/iotdb/session/pool/SessionPool.java", "diffHunk": "@@ -74,29 +74,36 @@\n   private int fetchSize;\n   private long timeout; //ms\n   private static int FINAL_RETRY = RETRY - 1;\n-  private boolean enableCompression = false;\n+  private boolean enableCompression;\n+  private boolean enableCacheLeader;\n   private ZoneId zoneId;\n \n   private boolean closed;//whether the queue is closed.\n \n   public SessionPool(String ip, int port, String user, String password, int maxSize) {\n-    this(ip, port, user, password, maxSize, Config.DEFAULT_FETCH_SIZE, 60_000, false, null);\n+    this(ip, port, user, password, maxSize, Config.DEFAULT_FETCH_SIZE, 60_000, false, null, false);\n   }\n \n   public SessionPool(String ip, int port, String user, String password, int maxSize,\n       boolean enableCompression) {\n     this(ip, port, user, password, maxSize, Config.DEFAULT_FETCH_SIZE, 60_000, enableCompression,\n-        null);\n+        null, false);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "aff21fc6ad4df4c2e1fe02e30af9a224f66f1026"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDkyOTA3NA==", "bodyText": "OK", "url": "https://github.com/apache/iotdb/pull/2222#discussion_r540929074", "createdAt": "2020-12-11T12:58:29Z", "author": {"login": "LebronAl"}, "path": "session/src/main/java/org/apache/iotdb/session/pool/SessionPool.java", "diffHunk": "@@ -74,29 +74,36 @@\n   private int fetchSize;\n   private long timeout; //ms\n   private static int FINAL_RETRY = RETRY - 1;\n-  private boolean enableCompression = false;\n+  private boolean enableCompression;\n+  private boolean enableCacheLeader;\n   private ZoneId zoneId;\n \n   private boolean closed;//whether the queue is closed.\n \n   public SessionPool(String ip, int port, String user, String password, int maxSize) {\n-    this(ip, port, user, password, maxSize, Config.DEFAULT_FETCH_SIZE, 60_000, false, null);\n+    this(ip, port, user, password, maxSize, Config.DEFAULT_FETCH_SIZE, 60_000, false, null, false);\n   }\n \n   public SessionPool(String ip, int port, String user, String password, int maxSize,\n       boolean enableCompression) {\n     this(ip, port, user, password, maxSize, Config.DEFAULT_FETCH_SIZE, 60_000, enableCompression,\n-        null);\n+        null, false);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDY3NjAzNw=="}, "originalCommit": {"oid": "aff21fc6ad4df4c2e1fe02e30af9a224f66f1026"}, "originalPosition": 20}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM5NTMzNzQyOnYy", "diffSide": "RIGHT", "path": "session/src/main/java/org/apache/iotdb/session/pool/SessionPool.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMVQwNDowODoyM1rOIDoP8g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMVQxMjo1ODoxMFrOID3rZg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDY3NjA4Mg==", "bodyText": "false -> Config.DEFAULT_CACHE_LEADER_MODE", "url": "https://github.com/apache/iotdb/pull/2222#discussion_r540676082", "createdAt": "2020-12-11T04:08:23Z", "author": {"login": "jixuan1989"}, "path": "session/src/main/java/org/apache/iotdb/session/pool/SessionPool.java", "diffHunk": "@@ -74,29 +74,36 @@\n   private int fetchSize;\n   private long timeout; //ms\n   private static int FINAL_RETRY = RETRY - 1;\n-  private boolean enableCompression = false;\n+  private boolean enableCompression;\n+  private boolean enableCacheLeader;\n   private ZoneId zoneId;\n \n   private boolean closed;//whether the queue is closed.\n \n   public SessionPool(String ip, int port, String user, String password, int maxSize) {\n-    this(ip, port, user, password, maxSize, Config.DEFAULT_FETCH_SIZE, 60_000, false, null);\n+    this(ip, port, user, password, maxSize, Config.DEFAULT_FETCH_SIZE, 60_000, false, null, false);\n   }\n \n   public SessionPool(String ip, int port, String user, String password, int maxSize,\n       boolean enableCompression) {\n     this(ip, port, user, password, maxSize, Config.DEFAULT_FETCH_SIZE, 60_000, enableCompression,\n-        null);\n+        null, false);\n+  }\n+\n+  public SessionPool(String ip, int port, String user, String password, int maxSize,\n+      boolean enableCompression, boolean enableCacheLeader) {\n+    this(ip, port, user, password, maxSize, Config.DEFAULT_FETCH_SIZE, 60_000, enableCompression,\n+        null, enableCacheLeader);\n   }\n \n   public SessionPool(String ip, int port, String user, String password, int maxSize,\n       ZoneId zoneId) {\n-    this(ip, port, user, password, maxSize, Config.DEFAULT_FETCH_SIZE, 60_000, false, zoneId);\n+    this(ip, port, user, password, maxSize, Config.DEFAULT_FETCH_SIZE, 60_000, false, zoneId, false);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "aff21fc6ad4df4c2e1fe02e30af9a224f66f1026"}, "originalPosition": 32}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDkyODg3MA==", "bodyText": "OK", "url": "https://github.com/apache/iotdb/pull/2222#discussion_r540928870", "createdAt": "2020-12-11T12:58:10Z", "author": {"login": "LebronAl"}, "path": "session/src/main/java/org/apache/iotdb/session/pool/SessionPool.java", "diffHunk": "@@ -74,29 +74,36 @@\n   private int fetchSize;\n   private long timeout; //ms\n   private static int FINAL_RETRY = RETRY - 1;\n-  private boolean enableCompression = false;\n+  private boolean enableCompression;\n+  private boolean enableCacheLeader;\n   private ZoneId zoneId;\n \n   private boolean closed;//whether the queue is closed.\n \n   public SessionPool(String ip, int port, String user, String password, int maxSize) {\n-    this(ip, port, user, password, maxSize, Config.DEFAULT_FETCH_SIZE, 60_000, false, null);\n+    this(ip, port, user, password, maxSize, Config.DEFAULT_FETCH_SIZE, 60_000, false, null, false);\n   }\n \n   public SessionPool(String ip, int port, String user, String password, int maxSize,\n       boolean enableCompression) {\n     this(ip, port, user, password, maxSize, Config.DEFAULT_FETCH_SIZE, 60_000, enableCompression,\n-        null);\n+        null, false);\n+  }\n+\n+  public SessionPool(String ip, int port, String user, String password, int maxSize,\n+      boolean enableCompression, boolean enableCacheLeader) {\n+    this(ip, port, user, password, maxSize, Config.DEFAULT_FETCH_SIZE, 60_000, enableCompression,\n+        null, enableCacheLeader);\n   }\n \n   public SessionPool(String ip, int port, String user, String password, int maxSize,\n       ZoneId zoneId) {\n-    this(ip, port, user, password, maxSize, Config.DEFAULT_FETCH_SIZE, 60_000, false, zoneId);\n+    this(ip, port, user, password, maxSize, Config.DEFAULT_FETCH_SIZE, 60_000, false, zoneId, false);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDY3NjA4Mg=="}, "originalCommit": {"oid": "aff21fc6ad4df4c2e1fe02e30af9a224f66f1026"}, "originalPosition": 32}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM5NTMzODYxOnYy", "diffSide": "RIGHT", "path": "session/src/test/java/org/apache/iotdb/session/pool/SessionPoolTest.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMVQwNDowODo1NFrOIDoQkg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMVQxMjo1OTowMFrOID3tUw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDY3NjI0Mg==", "bodyText": "Is there some UT for set the enableCache as true?", "url": "https://github.com/apache/iotdb/pull/2222#discussion_r540676242", "createdAt": "2020-12-11T04:08:54Z", "author": {"login": "jixuan1989"}, "path": "session/src/test/java/org/apache/iotdb/session/pool/SessionPoolTest.java", "diffHunk": "@@ -164,7 +164,7 @@ private void correctQuery(SessionPool pool) {\n \n   @Test\n   public void tryIfTheServerIsRestart() {\n-    SessionPool pool = new SessionPool(\"127.0.0.1\", 6667, \"root\", \"root\", 3, 1, 6000, false, null);\n+    SessionPool pool = new SessionPool(\"127.0.0.1\", 6667, \"root\", \"root\", 3, 1, 6000, false, null, false);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "aff21fc6ad4df4c2e1fe02e30af9a224f66f1026"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDkyOTM2Mw==", "bodyText": "I will add UT for this laterly", "url": "https://github.com/apache/iotdb/pull/2222#discussion_r540929363", "createdAt": "2020-12-11T12:59:00Z", "author": {"login": "LebronAl"}, "path": "session/src/test/java/org/apache/iotdb/session/pool/SessionPoolTest.java", "diffHunk": "@@ -164,7 +164,7 @@ private void correctQuery(SessionPool pool) {\n \n   @Test\n   public void tryIfTheServerIsRestart() {\n-    SessionPool pool = new SessionPool(\"127.0.0.1\", 6667, \"root\", \"root\", 3, 1, 6000, false, null);\n+    SessionPool pool = new SessionPool(\"127.0.0.1\", 6667, \"root\", \"root\", 3, 1, 6000, false, null, false);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDY3NjI0Mg=="}, "originalCommit": {"oid": "aff21fc6ad4df4c2e1fe02e30af9a224f66f1026"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzUyMTM5MDI2OnYy", "diffSide": "RIGHT", "path": "session/src/main/java/org/apache/iotdb/session/SessionConnection.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xOFQwMjowMTo1MVrOIVXu9g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0yMlQwMjowODo0MlrOIYRoXA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1OTI3OTg2Mg==", "bodyText": "It would be better to use an annotation, and please format the code.", "url": "https://github.com/apache/iotdb/pull/2222#discussion_r559279862", "createdAt": "2021-01-18T02:01:51Z", "author": {"login": "jt2594838"}, "path": "session/src/main/java/org/apache/iotdb/session/SessionConnection.java", "diffHunk": "@@ -67,6 +67,9 @@\n   private ZoneId zoneId;\n   private EndPoint endPoint;\n \n+  //TestOnly\n+  public SessionConnection(){}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ac0ed556fd9a44481ae48793238bac9dcff8b705"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1OTMzNDA5MQ==", "bodyText": "Testonly's anonation is currently in the server module. The session module does not currently have a dependency on the server module, so I don't think it would be appropriate to introduce a dependency just for this purpose. As for creating a new testonly anotation in the session module, I think it's a bit redundant because it's the only one we've used so far. But if you think it's worth creating a new anonation in the Session Module, I'll do it. What your opinion?", "url": "https://github.com/apache/iotdb/pull/2222#discussion_r559334091", "createdAt": "2021-01-18T06:06:17Z", "author": {"login": "LebronAl"}, "path": "session/src/main/java/org/apache/iotdb/session/SessionConnection.java", "diffHunk": "@@ -67,6 +67,9 @@\n   private ZoneId zoneId;\n   private EndPoint endPoint;\n \n+  //TestOnly\n+  public SessionConnection(){}", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1OTI3OTg2Mg=="}, "originalCommit": {"oid": "ac0ed556fd9a44481ae48793238bac9dcff8b705"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MjMyNTU5Ng==", "bodyText": "That is the case, we can extract that into another module later.", "url": "https://github.com/apache/iotdb/pull/2222#discussion_r562325596", "createdAt": "2021-01-22T02:08:42Z", "author": {"login": "jt2594838"}, "path": "session/src/main/java/org/apache/iotdb/session/SessionConnection.java", "diffHunk": "@@ -67,6 +67,9 @@\n   private ZoneId zoneId;\n   private EndPoint endPoint;\n \n+  //TestOnly\n+  public SessionConnection(){}", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1OTI3OTg2Mg=="}, "originalCommit": {"oid": "ac0ed556fd9a44481ae48793238bac9dcff8b705"}, "originalPosition": 5}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 528, "cost": 1, "resetAt": "2021-11-12T09:44:50Z"}}}