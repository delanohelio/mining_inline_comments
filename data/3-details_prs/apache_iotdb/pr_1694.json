{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDgwNjc5OTEy", "number": 1694, "title": "[IOTDB-813] Show storage group under given path prefix", "bodyText": "", "createdAt": "2020-09-06T07:49:18Z", "url": "https://github.com/apache/iotdb/pull/1694", "merged": true, "mergeCommit": {"oid": "df250c3de4ba116baf5cb1f278e1dacffd60e114"}, "closed": true, "closedAt": "2020-09-07T06:08:25Z", "author": {"login": "yanhongwangg"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdGJXXhgH2gAyNDgwNjc5OTEyOjhjMWY1M2YwNzhjMTIxOWY4OTY3YmVkYzJiN2JhMGEwNjc2OTZkYjk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdGZBfRAH2gAyNDgwNjc5OTEyOjRhYWI4YmFkMTQzNzVmYzdhMWQ5MzcyYjU3NmI1Mzc1NTc4MTEyOGQ=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "8c1f53f078c1219f8967bedc2b7ba0a067696db9", "author": {"user": {"login": "yanhongwangg", "name": "yanhong wang"}}, "url": "https://github.com/apache/iotdb/commit/8c1f53f078c1219f8967bedc2b7ba0a067696db9", "committedDate": "2020-09-06T07:35:27Z", "message": "[IOTDB-813] Show storage group under given path prefix"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d77fa24f65db82eb33a02116a76b9212c21fcf3d", "author": {"user": {"login": "yanhongwangg", "name": "yanhong wang"}}, "url": "https://github.com/apache/iotdb/commit/d77fa24f65db82eb33a02116a76b9212c21fcf3d", "committedDate": "2020-09-06T07:42:42Z", "message": "[IOTDB-813] Show storage group under given path prefix"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgzMTM0MzA2", "url": "https://github.com/apache/iotdb/pull/1694#pullrequestreview-483134306", "createdAt": "2020-09-06T11:18:55Z", "commit": {"oid": "d77fa24f65db82eb33a02116a76b9212c21fcf3d"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wNlQxMToxODo1NVrOHNoe0A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wNlQxMToxODo1NVrOHNoe0A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDA1Njc4NA==", "bodyText": "Hi, please put these into one or two lines.", "url": "https://github.com/apache/iotdb/pull/1694#discussion_r484056784", "createdAt": "2020-09-06T11:18:55Z", "author": {"login": "qiaojialin"}, "path": "server/src/main/java/org/apache/iotdb/db/metadata/MTree.java", "diffHunk": "@@ -502,6 +502,54 @@ private void findStorageGroup(\n     return res;\n   }\n \n+  /**\n+   * Get all storage group under give path\n+   *\n+   * @return a list contains all storage group names under give path\n+   */\n+  List<PartialPath> getStorageGroupPaths(PartialPath prefixPath) throws MetadataException {\n+    String[] nodes = prefixPath.getNodes();\n+    if (nodes.length == 0 || !nodes[0].equals(root.getName())) {\n+      throw new IllegalPathException(prefixPath.getFullPath());\n+    }\n+    List<PartialPath> storageGroupPaths = new ArrayList<>();\n+    findStorageGroupPaths(root, nodes, 1, \"\", storageGroupPaths);\n+    return storageGroupPaths;\n+  }\n+\n+  /**\n+   * Traverse the MTree to match all storage group with prefix path.\n+   *\n+   * @param node              the current traversing node\n+   * @param nodes             split the prefix path with '.'\n+   * @param idx               the current index of array nodes\n+   * @param parent            current parent path\n+   * @param storageGroupPaths store all matched storage group names\n+   */\n+  private void findStorageGroupPaths(MNode node, String[] nodes, int idx, String parent,\n+      List<PartialPath> storageGroupPaths) {\n+    if (node instanceof StorageGroupMNode) {\n+      storageGroupPaths.add(node.getPartialPath());\n+      return;\n+    }\n+    String nodeReg = MetaUtils.getNodeRegByIdx(idx, nodes);\n+    if (!(PATH_WILDCARD).equals(nodeReg)) {\n+      if (node.hasChild(nodeReg)) {\n+        findStorageGroupPaths(\n+            node.getChild(nodeReg),\n+            nodes,\n+            idx + 1,\n+            parent + node.getName() + PATH_SEPARATOR,\n+            storageGroupPaths);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d77fa24f65db82eb33a02116a76b9212c21fcf3d"}, "originalPosition": 42}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4aab8bad14375fc7a1d9372b576b53755781128d", "author": {"user": {"login": "yanhongwangg", "name": "yanhong wang"}}, "url": "https://github.com/apache/iotdb/commit/4aab8bad14375fc7a1d9372b576b53755781128d", "committedDate": "2020-09-07T01:50:02Z", "message": "[IOTDB-813] Modify Mtree's format"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3462, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}