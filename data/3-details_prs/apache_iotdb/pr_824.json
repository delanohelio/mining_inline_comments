{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc2NjQ2MDQz", "number": 824, "title": "[IOTDB-503] Add checkTimeseriesExists for session", "bodyText": "In most scenarios, we should check whether timeseries already exists before creating, otherwise the following exception may be thrown from server:\n\u00a0\n\norg.apache.iotdb.db.exception.query.QueryProcessException: Timeseries [root.sg.d1.s1] already existorg.apache.iotdb.db.exception.query.QueryProcessException: Timeseries [root.sg.d1.s1] already exist at org.apache.iotdb.db.qp.executor.QueryProcessExecutor.createTimeSeries(QueryProcessExecutor.java:552) at org.apache.iotdb.db.qp.executor.QueryProcessExecutor.processNonQuery(QueryProcessExecutor.java:122) at org.apache.iotdb.db.service.TSServiceImpl.executeNonQuery(TSServiceImpl.java:1044) at org.apache.iotdb.db.service.TSServiceImpl.executePlan(TSServiceImpl.java:1387) at org.apache.iotdb.db.service.TSServiceImpl.createTimeseries(TSServiceImpl.java:1342) at org.apache.iotdb.service.rpc.thrift.TSIService$Processor$createTimeseries.getResult(TSIService.java:1953) at org.apache.iotdb.service.rpc.thrift.TSIService$Processor$createTimeseries.getResult(TSIService.java:1933) at org.apache.thrift.ProcessFunction.process(ProcessFunction.java:38) at org.apache.thrift.TBaseProcessor.process(TBaseProcessor.java:38) at org.apache.thrift.server.TThreadPoolServer$WorkerProcess.run(TThreadPoolServer.java:313) at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149) at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624) at java.lang.Thread.run(Thread.java:748)\n\n\u00a0The changes are as following:\n\nAdded method checkTimeseriesExists for org.apache.iotdb.session.Session\nUpdated the SessionExample", "createdAt": "2020-02-18T14:24:05Z", "url": "https://github.com/apache/iotdb/pull/824", "merged": true, "mergeCommit": {"oid": "0155009edd12929d9fecbc084ce7000dbd2ab7c2"}, "closed": true, "closedAt": "2020-02-20T04:35:38Z", "author": {"login": "vesense"}, "timelineItems": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcFipCbAH2gAyMzc2NjQ2MDQzOmQ3NGU2Y2JiMzI1ZjVmYmRhYzdlMDE5MzU2ZWI5NTNkY2FkNmE0Mjc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcGDembAFqTM2MTYyNzEwNA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "d74e6cbb325f5fbdac7e019356eb953dcad6a427", "author": {"user": {"login": "vesense", "name": "Xin Wang"}}, "url": "https://github.com/apache/iotdb/commit/d74e6cbb325f5fbdac7e019356eb953dcad6a427", "committedDate": "2020-02-18T14:17:18Z", "message": "[IOTDB-503] Add checkTimeseriesExists for session"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYwNDEzMzQ2", "url": "https://github.com/apache/iotdb/pull/824#pullrequestreview-360413346", "createdAt": "2020-02-18T15:06:15Z", "commit": {"oid": "d74e6cbb325f5fbdac7e019356eb953dcad6a427"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOFQxNTowNjoxNVrOFrF68A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOFQxNTowNjoxNVrOFrF68A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDczMDA5Ng==", "bodyText": "This is an interesting usage and it works...\nDo we need to add an RPC interface for checking whether a time series exist?", "url": "https://github.com/apache/iotdb/pull/824#discussion_r380730096", "createdAt": "2020-02-18T15:06:15Z", "author": {"login": "jixuan1989"}, "path": "session/src/main/java/org/apache/iotdb/session/Session.java", "diffHunk": "@@ -558,6 +558,15 @@ public TSStatus createTimeseries(String path, TSDataType dataType,\n     }\n   }\n \n+  public boolean checkTimeseriesExists(String path) throws IoTDBSessionException {\n+    checkPathValidity(path);\n+    try {\n+      return executeQueryStatement(String.format(\"SHOW TIMESERIES %s\", path)).hasNext();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d74e6cbb325f5fbdac7e019356eb953dcad6a427"}, "originalPosition": 7}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYxNjI3MTA0", "url": "https://github.com/apache/iotdb/pull/824#pullrequestreview-361627104", "createdAt": "2020-02-20T04:32:46Z", "commit": {"oid": "d74e6cbb325f5fbdac7e019356eb953dcad6a427"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3098, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}