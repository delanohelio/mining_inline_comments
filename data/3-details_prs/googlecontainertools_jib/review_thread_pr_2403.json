{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDAzMzgyMzk3", "number": 2403, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQwMzoyMTo0NVrODx5jCw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQwMzozODo0MlrODx5tig==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUzNjQ5Njc1OnYy", "diffSide": "RIGHT", "path": "jib-core/src/main/java/com/google/cloud/tools/jib/registry/credentials/DockerCredentialHelper.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQwMzoyMTo0NVrOGFoZMw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQxNDoxODoxMVrOGF77bQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODU1Nzg3NQ==", "bodyText": "Do you think we might compute this value and pass it into the class?  We're already computing it in DefaultCredentialRetrievers.", "url": "https://github.com/GoogleContainerTools/jib/pull/2403#discussion_r408557875", "createdAt": "2020-04-15T03:21:45Z", "author": {"login": "briandealwis"}, "path": "jib-core/src/main/java/com/google/cloud/tools/jib/registry/credentials/DockerCredentialHelper.java", "diffHunk": "@@ -88,10 +106,30 @@ public DockerCredentialHelper(String serverUrl, Path credentialHelper) {\n   public Credential retrieve()\n       throws IOException, CredentialHelperUnhandledServerUrlException,\n           CredentialHelperNotFoundException {\n+    boolean isWindows =\n+        systemProperties.getProperty(\"os.name\").toLowerCase(Locale.ENGLISH).contains(\"windows\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cae4389d0502934af6bf7b20a92e2733a8031ee4"}, "originalPosition": 46}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODg3NzkzMw==", "bodyText": "So I've looked into the chain, and it goes through\n\nDefaultCredentialRetrievers.asList()\nCredentialRetrieverFactory.dockerCredentialHelper(String)\nCredentialRetrieverFactory.dockerCredentialHelper(Path)\nCredentialRetrieverFactory.retrieveFromDockerCredentialHelper()\nDockerCredentialHelper.create() (which is DockerCredentialHelper::new)\n\nIt's a long chain. And I think some in the chain don't look reasonable to require passing isWindows in their method signature. Moreover, this is relatively simple code and can be done in a self-contained manner, I think this is OK.", "url": "https://github.com/GoogleContainerTools/jib/pull/2403#discussion_r408877933", "createdAt": "2020-04-15T14:18:11Z", "author": {"login": "chanseokoh"}, "path": "jib-core/src/main/java/com/google/cloud/tools/jib/registry/credentials/DockerCredentialHelper.java", "diffHunk": "@@ -88,10 +106,30 @@ public DockerCredentialHelper(String serverUrl, Path credentialHelper) {\n   public Credential retrieve()\n       throws IOException, CredentialHelperUnhandledServerUrlException,\n           CredentialHelperNotFoundException {\n+    boolean isWindows =\n+        systemProperties.getProperty(\"os.name\").toLowerCase(Locale.ENGLISH).contains(\"windows\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODU1Nzg3NQ=="}, "originalCommit": {"oid": "cae4389d0502934af6bf7b20a92e2733a8031ee4"}, "originalPosition": 46}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUzNjUxNTMyOnYy", "diffSide": "RIGHT", "path": "jib-core/src/main/java/com/google/cloud/tools/jib/registry/credentials/DockerCredentialHelper.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQwMzozMzowOFrOGFokHA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNlQxNjowNToyNFrOGGsjYQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODU2MDY2OA==", "bodyText": "If I recall correctly, .exe files have higher precedence over .cmd files.  It would be worth checking as it would simplify this code.", "url": "https://github.com/GoogleContainerTools/jib/pull/2403#discussion_r408560668", "createdAt": "2020-04-15T03:33:08Z", "author": {"login": "briandealwis"}, "path": "jib-core/src/main/java/com/google/cloud/tools/jib/registry/credentials/DockerCredentialHelper.java", "diffHunk": "@@ -88,10 +106,30 @@ public DockerCredentialHelper(String serverUrl, Path credentialHelper) {\n   public Credential retrieve()\n       throws IOException, CredentialHelperUnhandledServerUrlException,\n           CredentialHelperNotFoundException {\n+    boolean isWindows =\n+        systemProperties.getProperty(\"os.name\").toLowerCase(Locale.ENGLISH).contains(\"windows\");\n+    if (!isWindows || credentialHelper.toString().toLowerCase(Locale.ENGLISH).endsWith(\".cmd\")) {\n+      return retrieve(Arrays.asList(credentialHelper.toString(), \"get\"));\n+    }\n+\n+    try {\n+      return retrieve(Arrays.asList(credentialHelper.toString() + \".cmd\", \"get\"));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cae4389d0502934af6bf7b20a92e2733a8031ee4"}, "originalPosition": 52}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODg1MzgwMA==", "bodyText": "Other file extensions including .EXE just don't work, and I decided to keep it that way until we get a new report.\nFrom #2399 (comment):\n\nTherefore, it may be necessary to also try .EXE, .COM, .BAT, etc. However, we had not received a report until now, so I think I'll just try .CMD first and watch.", "url": "https://github.com/GoogleContainerTools/jib/pull/2403#discussion_r408853800", "createdAt": "2020-04-15T13:45:54Z", "author": {"login": "chanseokoh"}, "path": "jib-core/src/main/java/com/google/cloud/tools/jib/registry/credentials/DockerCredentialHelper.java", "diffHunk": "@@ -88,10 +106,30 @@ public DockerCredentialHelper(String serverUrl, Path credentialHelper) {\n   public Credential retrieve()\n       throws IOException, CredentialHelperUnhandledServerUrlException,\n           CredentialHelperNotFoundException {\n+    boolean isWindows =\n+        systemProperties.getProperty(\"os.name\").toLowerCase(Locale.ENGLISH).contains(\"windows\");\n+    if (!isWindows || credentialHelper.toString().toLowerCase(Locale.ENGLISH).endsWith(\".cmd\")) {\n+      return retrieve(Arrays.asList(credentialHelper.toString(), \"get\"));\n+    }\n+\n+    try {\n+      return retrieve(Arrays.asList(credentialHelper.toString() + \".cmd\", \"get\"));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODU2MDY2OA=="}, "originalCommit": {"oid": "cae4389d0502934af6bf7b20a92e2733a8031ee4"}, "originalPosition": 52}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTY3NDU5Mw==", "bodyText": "The current PR works, but on second thought, checking .exe will give a better error message if Jib can't find the binary. Otherwise, it'll be like \"some-helper.exe.cmd not found\" instead of \"some-helper.exe not found.\"", "url": "https://github.com/GoogleContainerTools/jib/pull/2403#discussion_r409674593", "createdAt": "2020-04-16T16:05:24Z", "author": {"login": "chanseokoh"}, "path": "jib-core/src/main/java/com/google/cloud/tools/jib/registry/credentials/DockerCredentialHelper.java", "diffHunk": "@@ -88,10 +106,30 @@ public DockerCredentialHelper(String serverUrl, Path credentialHelper) {\n   public Credential retrieve()\n       throws IOException, CredentialHelperUnhandledServerUrlException,\n           CredentialHelperNotFoundException {\n+    boolean isWindows =\n+        systemProperties.getProperty(\"os.name\").toLowerCase(Locale.ENGLISH).contains(\"windows\");\n+    if (!isWindows || credentialHelper.toString().toLowerCase(Locale.ENGLISH).endsWith(\".cmd\")) {\n+      return retrieve(Arrays.asList(credentialHelper.toString(), \"get\"));\n+    }\n+\n+    try {\n+      return retrieve(Arrays.asList(credentialHelper.toString() + \".cmd\", \"get\"));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODU2MDY2OA=="}, "originalCommit": {"oid": "cae4389d0502934af6bf7b20a92e2733a8031ee4"}, "originalPosition": 52}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUzNjUyMzYyOnYy", "diffSide": "RIGHT", "path": "jib-plugins-common/src/main/java/com/google/cloud/tools/jib/plugins/common/DefaultCredentialRetrievers.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQwMzozODo0MlrOGFoo_A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQxMzozNzozMVrOGF6DyQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODU2MTkxNg==", "bodyText": "Would it make sense to push this into DockerCredentialHelper or credentialRetrieverFactory.dockerCredentialHelper()?", "url": "https://github.com/GoogleContainerTools/jib/pull/2403#discussion_r408561916", "createdAt": "2020-04-15T03:38:42Z", "author": {"login": "briandealwis"}, "path": "jib-plugins-common/src/main/java/com/google/cloud/tools/jib/plugins/common/DefaultCredentialRetrievers.java", "diffHunk": "@@ -151,8 +152,11 @@ public DefaultCredentialRetrievers setCredentialHelper(@Nullable String credenti\n       // If credential helper contains file separator, treat as path; otherwise treat as suffix\n       if (credentialHelper.contains(FileSystems.getDefault().getSeparator())) {\n         if (!Files.exists(Paths.get(credentialHelper))) {\n-          throw new FileNotFoundException(\n-              \"Specified credential helper was not found: \" + credentialHelper);\n+          String osName = systemProperties.getProperty(\"os.name\").toLowerCase(Locale.ENGLISH);\n+          if (!osName.contains(\"windows\") || !Files.exists(Paths.get(credentialHelper + \".cmd\"))) {\n+            throw new FileNotFoundException(\n+                \"Specified credential helper was not found: \" + credentialHelper);\n+          }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cae4389d0502934af6bf7b20a92e2733a8031ee4"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODg0NzMwNQ==", "bodyText": "The logic here is interpreting the given configuration value ahead to determine if it is a full path or a credential helper suffix. This semantics is tightly coupled with how we defined the <credHelper> configuration, so it cannot make into jib-core.\nMoreover, DockerCredentialHelper by design doesn't do any pre-validation (including file checking); it is OK even if the credential helper binary doesn't exist or doesn't work when another credential retriever with a higher precedence provides working credentials in the end.", "url": "https://github.com/GoogleContainerTools/jib/pull/2403#discussion_r408847305", "createdAt": "2020-04-15T13:37:31Z", "author": {"login": "chanseokoh"}, "path": "jib-plugins-common/src/main/java/com/google/cloud/tools/jib/plugins/common/DefaultCredentialRetrievers.java", "diffHunk": "@@ -151,8 +152,11 @@ public DefaultCredentialRetrievers setCredentialHelper(@Nullable String credenti\n       // If credential helper contains file separator, treat as path; otherwise treat as suffix\n       if (credentialHelper.contains(FileSystems.getDefault().getSeparator())) {\n         if (!Files.exists(Paths.get(credentialHelper))) {\n-          throw new FileNotFoundException(\n-              \"Specified credential helper was not found: \" + credentialHelper);\n+          String osName = systemProperties.getProperty(\"os.name\").toLowerCase(Locale.ENGLISH);\n+          if (!osName.contains(\"windows\") || !Files.exists(Paths.get(credentialHelper + \".cmd\"))) {\n+            throw new FileNotFoundException(\n+                \"Specified credential helper was not found: \" + credentialHelper);\n+          }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODU2MTkxNg=="}, "originalCommit": {"oid": "cae4389d0502934af6bf7b20a92e2733a8031ee4"}, "originalPosition": 18}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 369, "cost": 1, "resetAt": "2021-11-12T19:05:54Z"}}}