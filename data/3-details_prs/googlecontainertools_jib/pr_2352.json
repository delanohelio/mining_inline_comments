{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzkxOTM2Njgy", "number": 2352, "title": "Push out project version setting to tool", "bodyText": "fixes #1716\nI think I also need this for #2350 (XYZ.class.getPackage() can return weird results if two jars use the same packaging [like com.google.cloud.tools.jib]) -- this is the source of the integration test error in that pr.", "createdAt": "2020-03-22T00:28:05Z", "url": "https://github.com/GoogleContainerTools/jib/pull/2352", "merged": true, "mergeCommit": {"oid": "196813099fa0294cfc70e72db59ade80ed33a7db"}, "closed": true, "closedAt": "2020-03-26T19:29:48Z", "author": {"login": "loosebazooka"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcP-qfIABqjMxNTIyMzM3MTg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcRgg5EgH2gAyMzkxOTM2NjgyOjIzZWFjYmU2NDNlN2QyZDBiNDQ5Yzk0ZGZkMTlkZjEwOWI1ZTYxMDM=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3799450e336a04bc86efbae55ee62e9f421f96eb", "author": {"user": {"login": "loosebazooka", "name": "Appu"}}, "url": "https://github.com/GoogleContainerTools/jib/commit/3799450e336a04bc86efbae55ee62e9f421f96eb", "committedDate": "2020-03-22T00:26:10Z", "message": "push out project version setting to tool"}, "afterCommit": {"oid": "ab4b99f1f548bac24e88ab767bbd02c006e6b6e9", "author": {"user": {"login": "loosebazooka", "name": "Appu"}}, "url": "https://github.com/GoogleContainerTools/jib/commit/ab4b99f1f548bac24e88ab767bbd02c006e6b6e9", "committedDate": "2020-03-22T00:35:09Z", "message": "push out project version setting to tool"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "08eff88dd12b8f030d643009081494c7ff237599", "author": {"user": {"login": "loosebazooka", "name": "Appu"}}, "url": "https://github.com/GoogleContainerTools/jib/commit/08eff88dd12b8f030d643009081494c7ff237599", "committedDate": "2020-03-22T04:34:56Z", "message": "push out project version setting to tool"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ab4b99f1f548bac24e88ab767bbd02c006e6b6e9", "author": {"user": {"login": "loosebazooka", "name": "Appu"}}, "url": "https://github.com/GoogleContainerTools/jib/commit/ab4b99f1f548bac24e88ab767bbd02c006e6b6e9", "committedDate": "2020-03-22T00:35:09Z", "message": "push out project version setting to tool"}, "afterCommit": {"oid": "08eff88dd12b8f030d643009081494c7ff237599", "author": {"user": {"login": "loosebazooka", "name": "Appu"}}, "url": "https://github.com/GoogleContainerTools/jib/commit/08eff88dd12b8f030d643009081494c7ff237599", "committedDate": "2020-03-22T04:34:56Z", "message": "push out project version setting to tool"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc5NTg0ODg3", "url": "https://github.com/GoogleContainerTools/jib/pull/2352#pullrequestreview-379584887", "createdAt": "2020-03-23T16:12:30Z", "commit": {"oid": "08eff88dd12b8f030d643009081494c7ff237599"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QxNjoxMjo0MlrOF6M2hg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QxNjoxNzo0MlrOF6NFvg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjU3MjI5NA==", "bodyText": "I am guessing the order of version and then name is to preserve the current behavior, but this ordering is really weird. The suffix string should be \"name version\". Ideally \"name/version\" to be compliant with the conventional format in User-Agent, but maybe we'll never able to fix #1067. If we have to preserve the current format, maybe we should set the suffix as \"jib \" + getToolVersion() + \" \" + getToolName() here.", "url": "https://github.com/GoogleContainerTools/jib/pull/2352#discussion_r396572294", "createdAt": "2020-03-23T16:12:42Z", "author": {"login": "chanseokoh"}, "path": "jib-core/src/main/java/com/google/cloud/tools/jib/configuration/BuildContext.java", "diffHunk": "@@ -500,7 +521,7 @@ public boolean getAlwaysCacheBaseImage() {\n               targetImageConfiguration.getImageRepository(),\n               baseImageConfiguration.getImageRepository(),\n               httpClient)\n-          .setUserAgentSuffix(getToolName());\n+          .setUserAgentSuffix(getToolVersion() + \" \" + getToolName());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "08eff88dd12b8f030d643009081494c7ff237599"}, "originalPosition": 75}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjU3MjYxNA==", "bodyText": "So related to my previous comment, I didn't like the current format jib 2.1.0 jib-maven-plugin, which should really be like jib-maven-plugin/2.1.0 jib-core/0.13.0-SNAPSHOT Google-HTTP-Java-Client/1.27.0. Maybe don't add jib here, but set it inside userAgentSuffix?", "url": "https://github.com/GoogleContainerTools/jib/pull/2352#discussion_r396572614", "createdAt": "2020-03-23T16:13:03Z", "author": {"login": "chanseokoh"}, "path": "jib-core/src/main/java/com/google/cloud/tools/jib/registry/RegistryClient.java", "diffHunk": "@@ -127,7 +126,7 @@ private String makeUserAgent() {\n         return \"\";\n       }\n \n-      StringBuilder userAgentBuilder = new StringBuilder(\"jib \").append(ProjectInfo.VERSION);\n+      StringBuilder userAgentBuilder = new StringBuilder(\"jib\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "08eff88dd12b8f030d643009081494c7ff237599"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjU3NjE5MA==", "bodyText": "It feels weird that the parameter is declared as @Nullable but passing a null causes an exception. Perhaps the caller should do Verify.verifyNotNull() before passing the argument.", "url": "https://github.com/GoogleContainerTools/jib/pull/2352#discussion_r396576190", "createdAt": "2020-03-23T16:17:42Z", "author": {"login": "chanseokoh"}, "path": "jib-maven-plugin/src/main/java/com/google/cloud/tools/jib/maven/MavenProjectProperties.java", "diffHunk": "@@ -82,18 +83,22 @@\n   /**\n    * Static factory method for {@link MavenProjectProperties}.\n    *\n+   * @param jibPluginDescriptor the jib-maven-plugin plugin descriptor\n    * @param project the {@link MavenProject} for the plugin.\n    * @param session the {@link MavenSession} for the plugin.\n    * @param log the Maven {@link Log} to log messages during Jib execution\n    * @param tempDirectoryProvider temporary directory provider\n    * @return a MavenProjectProperties from the given project and logger.\n    */\n   public static MavenProjectProperties getForProject(\n+      @Nullable PluginDescriptor jibPluginDescriptor,\n       MavenProject project,\n       MavenSession session,\n       Log log,\n       TempDirectoryProvider tempDirectoryProvider) {\n-    return new MavenProjectProperties(project, session, log, tempDirectoryProvider);\n+    Preconditions.checkNotNull(jibPluginDescriptor);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "08eff88dd12b8f030d643009081494c7ff237599"}, "originalPosition": 26}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "684e8f40f0fb4daa793a1ca1d301a474255e7d0f", "author": {"user": {"login": "loosebazooka", "name": "Appu"}}, "url": "https://github.com/GoogleContainerTools/jib/commit/684e8f40f0fb4daa793a1ca1d301a474255e7d0f", "committedDate": "2020-03-23T22:00:38Z", "message": "move null check earlier"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bade91d6df8d94f3a1bef2df3cba1689d1437b9f", "author": {"user": {"login": "loosebazooka", "name": "Appu"}}, "url": "https://github.com/GoogleContainerTools/jib/commit/bade91d6df8d94f3a1bef2df3cba1689d1437b9f", "committedDate": "2020-03-25T23:33:06Z", "message": "construct user agent string in build context"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgyMDIwNjIx", "url": "https://github.com/GoogleContainerTools/jib/pull/2352#pullrequestreview-382020621", "createdAt": "2020-03-26T13:44:08Z", "commit": {"oid": "bade91d6df8d94f3a1bef2df3cba1689d1437b9f"}, "state": "APPROVED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNlQxMzo0NDowOVrOF8HgwA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNlQxNDo1MToxMFrOF8KrhA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODU4MTk1Mg==", "bodyText": "\"Sets a the ...\" --> \"Sets the ...\"", "url": "https://github.com/GoogleContainerTools/jib/pull/2352#discussion_r398581952", "createdAt": "2020-03-26T13:44:09Z", "author": {"login": "chanseokoh"}, "path": "jib-core/src/main/java/com/google/cloud/tools/jib/registry/RegistryClient.java", "diffHunk": "@@ -89,13 +88,13 @@ public Factory setCredential(@Nullable Credential credential) {\n     }\n \n     /**\n-     * Sets a suffix to append to {@code User-Agent} headers. See {@link #makeUserAgent()}.\n+     * Sets a the value of {@code User-Agent} in headers for registry requests.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bade91d6df8d94f3a1bef2df3cba1689d1437b9f"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODYzMzMzNg==", "bodyText": "jib <version> <type> --> jib <toolVersion> <toolName>", "url": "https://github.com/GoogleContainerTools/jib/pull/2352#discussion_r398633336", "createdAt": "2020-03-26T14:50:29Z", "author": {"login": "chanseokoh"}, "path": "jib-core/src/main/java/com/google/cloud/tools/jib/configuration/BuildContext.java", "diffHunk": "@@ -521,4 +543,27 @@ public void close() throws IOException {\n     }\n     httpClient.shutDown();\n   }\n+\n+  /**\n+   * The {@code User-Agent} is in the form of {@code jib <version> <type>}. For example: {@code jib", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bade91d6df8d94f3a1bef2df3cba1689d1437b9f"}, "originalPosition": 102}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODYzMzg2MA==", "bodyText": "private static\nSo Gradle doesn't have something like PluginDescriptor?", "url": "https://github.com/GoogleContainerTools/jib/pull/2352#discussion_r398633860", "createdAt": "2020-03-26T14:51:10Z", "author": {"login": "chanseokoh"}, "path": "jib-gradle-plugin/src/main/java/com/google/cloud/tools/jib/gradle/GradleProjectProperties.java", "diffHunk": "@@ -69,6 +69,10 @@\n   /** Used to generate the User-Agent header and history metadata. */\n   private static final String TOOL_NAME = \"jib-gradle-plugin\";\n \n+  /** Used to generate the User-Agent header and history metadata and verify versions. */\n+  static final String TOOL_VERSION =", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bade91d6df8d94f3a1bef2df3cba1689d1437b9f"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "401887a29bc689d5ecb1a300f81d0a476968fea6", "author": {"user": {"login": "loosebazooka", "name": "Appu"}}, "url": "https://github.com/GoogleContainerTools/jib/commit/401887a29bc689d5ecb1a300f81d0a476968fea6", "committedDate": "2020-03-26T18:15:44Z", "message": "registry client accept null useragent + fixes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "23eacbe643e7d2d0b449c94dfd19df109b5e6103", "author": {"user": {"login": "loosebazooka", "name": "Appu"}}, "url": "https://github.com/GoogleContainerTools/jib/commit/23eacbe643e7d2d0b449c94dfd19df109b5e6103", "committedDate": "2020-03-26T18:35:41Z", "message": "undo the nullable removal for now"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 148, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}