{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTA5MzAyMjU1", "number": 2862, "reviewThreads": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yNlQxNDowNToyMFrOEx6otQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yNlQyMjozNDo0M1rOEyHRNQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIwNzc2MzczOnYy", "diffSide": "RIGHT", "path": "jib-cli/src/main/java/com/google/cloud/tools/jib/cli/jar/JarProcessor.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yNlQxNDowNToyMFrOHoRE_Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yNlQxNDowNToyMFrOHoRE_Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTk4NDg5Mw==", "bodyText": "I remember this used to be caught by the formatter. Maybe not anymore.\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n               * Compute the entrypoint for a standard jar in exploded mode.\n          \n          \n            \n               * Computes the entrypoint for a standard jar in exploded mode.", "url": "https://github.com/GoogleContainerTools/jib/pull/2862#discussion_r511984893", "createdAt": "2020-10-26T14:05:20Z", "author": {"login": "chanseokoh"}, "path": "jib-cli/src/main/java/com/google/cloud/tools/jib/cli/jar/JarProcessor.java", "diffHunk": "@@ -145,6 +149,42 @@ public static JarType determineJarType(Path jarPath) throws IOException {\n     return layers;\n   }\n \n+  /**\n+   * Compute the entrypoint for a standard jar in exploded mode.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7f4e83fdc2217d258ab9d3d4ba59ceff4759a90f"}, "originalPosition": 66}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIwNzc4MzkxOnYy", "diffSide": "RIGHT", "path": "jib-cli/src/test/java/com/google/cloud/tools/jib/cli/jar/JarProcessorTest.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yNlQxNDowOTo0NVrOHoRRzQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yNlQxNDowOTo0NVrOHoRRzQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTk4ODE3Mw==", "bodyText": "Just so you know, if you don't need a nested directory or multiple directories, you can use the root: temporaryFolder.getRoot().toPath().", "url": "https://github.com/GoogleContainerTools/jib/pull/2862#discussion_r511988173", "createdAt": "2020-10-26T14:09:45Z", "author": {"login": "chanseokoh"}, "path": "jib-cli/src/test/java/com/google/cloud/tools/jib/cli/jar/JarProcessorTest.java", "diffHunk": "@@ -281,4 +282,46 @@ public void testExplodeMode_standard_withoutClassPathInManifest_containsOnlyClas\n             AbsoluteUnixPath.get(\"/app/explodedJar/class1.class\"),\n             AbsoluteUnixPath.get(\"/app/explodedJar/class2.class\"));\n   }\n+\n+  @Test\n+  public void testExplodeMode_standard_computeEntrypoint_allLayersPresent()\n+      throws IOException, URISyntaxException {\n+    Path standardJar =\n+        Paths.get(Resources.getResource(STANDARD_JAR_WITH_CLASS_PATH_MANIFEST).toURI());\n+    Path destDir = temporaryFolder.newFolder().toPath();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7f4e83fdc2217d258ab9d3d4ba59ceff4759a90f"}, "originalPosition": 18}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIwNzc5MDY5OnYy", "diffSide": "RIGHT", "path": "jib-cli/src/main/java/com/google/cloud/tools/jib/cli/jar/JarProcessor.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yNlQxNDoxMToxMVrOHoRWHg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yNlQyMjoxNjoyN1rOHokbGA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTk4OTI3OA==", "bodyText": "Using _ is only accepted in test method names. computeEntrypointForExplodedStandard()?\nAnd I don't know who will require this method, but you should always double-checking if a method may have a narrower access scope. (Just don't habitually make everything public until necessary.)", "url": "https://github.com/GoogleContainerTools/jib/pull/2862#discussion_r511989278", "createdAt": "2020-10-26T14:11:11Z", "author": {"login": "chanseokoh"}, "path": "jib-cli/src/main/java/com/google/cloud/tools/jib/cli/jar/JarProcessor.java", "diffHunk": "@@ -145,6 +149,42 @@ public static JarType determineJarType(Path jarPath) throws IOException {\n     return layers;\n   }\n \n+  /**\n+   * Compute the entrypoint for a standard jar in exploded mode.\n+   *\n+   * @param jarPath path to jar file\n+   * @param tempDirPath path to temporary jib local directory\n+   * @param layers list of {@link FileEntriesLayer}\n+   * @return list of {@link String} representing entrypoint\n+   * @throws IOException if I/O error occurs when opening the jar file or if temporary directory\n+   *     provided doesn't exist\n+   * @throws IllegalArgumentException if main class is not found in the jar manifest\n+   */\n+  public static ImmutableList<String> computeEntrypoint_explodedStandard(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7f4e83fdc2217d258ab9d3d4ba59ceff4759a90f"}, "originalPosition": 76}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjMwMTg0OA==", "bodyText": "oops I keep mixing up the naming with python convention\nOh good point. Changed this method and explodeStandardJar to protected since they will be accessed from within the same package (specifically in the class that will be used to take a jar and convert it into a JibContainerBuilder -- next pr).", "url": "https://github.com/GoogleContainerTools/jib/pull/2862#discussion_r512301848", "createdAt": "2020-10-26T22:16:27Z", "author": {"login": "mpeddada1"}, "path": "jib-cli/src/main/java/com/google/cloud/tools/jib/cli/jar/JarProcessor.java", "diffHunk": "@@ -145,6 +149,42 @@ public static JarType determineJarType(Path jarPath) throws IOException {\n     return layers;\n   }\n \n+  /**\n+   * Compute the entrypoint for a standard jar in exploded mode.\n+   *\n+   * @param jarPath path to jar file\n+   * @param tempDirPath path to temporary jib local directory\n+   * @param layers list of {@link FileEntriesLayer}\n+   * @return list of {@link String} representing entrypoint\n+   * @throws IOException if I/O error occurs when opening the jar file or if temporary directory\n+   *     provided doesn't exist\n+   * @throws IllegalArgumentException if main class is not found in the jar manifest\n+   */\n+  public static ImmutableList<String> computeEntrypoint_explodedStandard(", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTk4OTI3OA=="}, "originalCommit": {"oid": "7f4e83fdc2217d258ab9d3d4ba59ceff4759a90f"}, "originalPosition": 76}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIwNzgxNDUwOnYy", "diffSide": "RIGHT", "path": "jib-cli/src/main/java/com/google/cloud/tools/jib/cli/jar/JarProcessor.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yNlQxNDoxNjoyNVrOHoRk1g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yNlQxNDoxNjoyNVrOHoRk1g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTk5MzA0Ng==", "bodyText": "I admit we don't have a good established policy around throwing, handling, and reporting exceptions and errors. We have not done well so far. But at least the situation for Jib CLI is not so grim, as it is not a library but a CLI. So I think throwing a runtime exception to crash for this type of errors is more or less acceptable.\nAnyways, what I wanted to say is that, I think it's fine to not specify IllegalStateException (or IllegalArgumentException). Also in the Javadoc.", "url": "https://github.com/GoogleContainerTools/jib/pull/2862#discussion_r511993046", "createdAt": "2020-10-26T14:16:25Z", "author": {"login": "chanseokoh"}, "path": "jib-cli/src/main/java/com/google/cloud/tools/jib/cli/jar/JarProcessor.java", "diffHunk": "@@ -145,6 +149,42 @@ public static JarType determineJarType(Path jarPath) throws IOException {\n     return layers;\n   }\n \n+  /**\n+   * Compute the entrypoint for a standard jar in exploded mode.\n+   *\n+   * @param jarPath path to jar file\n+   * @param tempDirPath path to temporary jib local directory\n+   * @param layers list of {@link FileEntriesLayer}\n+   * @return list of {@link String} representing entrypoint\n+   * @throws IOException if I/O error occurs when opening the jar file or if temporary directory\n+   *     provided doesn't exist\n+   * @throws IllegalArgumentException if main class is not found in the jar manifest\n+   */\n+  public static ImmutableList<String> computeEntrypoint_explodedStandard(\n+      Path jarPath, Path tempDirPath, List<FileEntriesLayer> layers)\n+      throws IOException, IllegalStateException {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7f4e83fdc2217d258ab9d3d4ba59ceff4759a90f"}, "originalPosition": 78}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIwNzgzMjQ1OnYy", "diffSide": "RIGHT", "path": "jib-cli/src/main/java/com/google/cloud/tools/jib/cli/jar/JarProcessor.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yNlQxNDoyMDoxOVrOHoRwAw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yNlQyMjoxNTo0MVrOHokZ3w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTk5NTkwNw==", "bodyText": "The CLI will crash with this message. And providing a clear message implying an actionable fix increases the chance of the user understanding and fixing the issue on their own, resulting in less frustrated getting-started experience (which is important to increase the chance of adoption). It also reduces our workload by reducing the likelyhood of multiple user opening the same issue.\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                  throw new IllegalArgumentException(\"Main-Class not found in jar's manifest.\");\n          \n          \n            \n                  throw new IllegalArgumentException(\"'Main-Class:' attribute to define an application main class not defined in the input JAR's manifest ('META-INF/MANIFEST.MF` in the JAR).\");", "url": "https://github.com/GoogleContainerTools/jib/pull/2862#discussion_r511995907", "createdAt": "2020-10-26T14:20:19Z", "author": {"login": "chanseokoh"}, "path": "jib-cli/src/main/java/com/google/cloud/tools/jib/cli/jar/JarProcessor.java", "diffHunk": "@@ -145,6 +149,42 @@ public static JarType determineJarType(Path jarPath) throws IOException {\n     return layers;\n   }\n \n+  /**\n+   * Compute the entrypoint for a standard jar in exploded mode.\n+   *\n+   * @param jarPath path to jar file\n+   * @param tempDirPath path to temporary jib local directory\n+   * @param layers list of {@link FileEntriesLayer}\n+   * @return list of {@link String} representing entrypoint\n+   * @throws IOException if I/O error occurs when opening the jar file or if temporary directory\n+   *     provided doesn't exist\n+   * @throws IllegalArgumentException if main class is not found in the jar manifest\n+   */\n+  public static ImmutableList<String> computeEntrypoint_explodedStandard(\n+      Path jarPath, Path tempDirPath, List<FileEntriesLayer> layers)\n+      throws IOException, IllegalStateException {\n+    Path localExplodedJarRoot = tempDirPath;\n+    ZipUtil.unzip(jarPath, localExplodedJarRoot);\n+\n+    String mainClass = null;\n+    try (JarFile jarFile = new JarFile(jarPath.toFile())) {\n+      mainClass = jarFile.getManifest().getMainAttributes().getValue(Attributes.Name.MAIN_CLASS);\n+    }\n+    if (mainClass == null) {\n+      throw new IllegalArgumentException(\"Main-Class not found in jar's manifest.\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7f4e83fdc2217d258ab9d3d4ba59ceff4759a90f"}, "originalPosition": 87}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjMwMTUzNQ==", "bodyText": "Ah you're right. Better error messaging is certainly helpful especially with something that causes the code to crash. Thanks.", "url": "https://github.com/GoogleContainerTools/jib/pull/2862#discussion_r512301535", "createdAt": "2020-10-26T22:15:41Z", "author": {"login": "mpeddada1"}, "path": "jib-cli/src/main/java/com/google/cloud/tools/jib/cli/jar/JarProcessor.java", "diffHunk": "@@ -145,6 +149,42 @@ public static JarType determineJarType(Path jarPath) throws IOException {\n     return layers;\n   }\n \n+  /**\n+   * Compute the entrypoint for a standard jar in exploded mode.\n+   *\n+   * @param jarPath path to jar file\n+   * @param tempDirPath path to temporary jib local directory\n+   * @param layers list of {@link FileEntriesLayer}\n+   * @return list of {@link String} representing entrypoint\n+   * @throws IOException if I/O error occurs when opening the jar file or if temporary directory\n+   *     provided doesn't exist\n+   * @throws IllegalArgumentException if main class is not found in the jar manifest\n+   */\n+  public static ImmutableList<String> computeEntrypoint_explodedStandard(\n+      Path jarPath, Path tempDirPath, List<FileEntriesLayer> layers)\n+      throws IOException, IllegalStateException {\n+    Path localExplodedJarRoot = tempDirPath;\n+    ZipUtil.unzip(jarPath, localExplodedJarRoot);\n+\n+    String mainClass = null;\n+    try (JarFile jarFile = new JarFile(jarPath.toFile())) {\n+      mainClass = jarFile.getManifest().getMainAttributes().getValue(Attributes.Name.MAIN_CLASS);\n+    }\n+    if (mainClass == null) {\n+      throw new IllegalArgumentException(\"Main-Class not found in jar's manifest.\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTk5NTkwNw=="}, "originalCommit": {"oid": "7f4e83fdc2217d258ab9d3d4ba59ceff4759a90f"}, "originalPosition": 87}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIwNzg4MTAzOnYy", "diffSide": "RIGHT", "path": "jib-cli/src/main/java/com/google/cloud/tools/jib/cli/jar/JarProcessor.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yNlQxNDoyOTo0NFrOHoSNUQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yNlQyMjoxODoyMlrOHokd8g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjAwMzQwOQ==", "bodyText": "At least this should be\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    classpath.add(APP_ROOT.resolve(\"dependencies\").toString());\n          \n          \n            \n                    classpath.add(APP_ROOT + \"/dependencies/*\");\n          \n      \n    \n    \n  \n\nJust so you know, there's an issue with the order of loading jars (like #1871 for Jib build plugins), but I think there's nothing we can do about it for a standard jar.", "url": "https://github.com/GoogleContainerTools/jib/pull/2862#discussion_r512003409", "createdAt": "2020-10-26T14:29:44Z", "author": {"login": "chanseokoh"}, "path": "jib-cli/src/main/java/com/google/cloud/tools/jib/cli/jar/JarProcessor.java", "diffHunk": "@@ -145,6 +149,42 @@ public static JarType determineJarType(Path jarPath) throws IOException {\n     return layers;\n   }\n \n+  /**\n+   * Compute the entrypoint for a standard jar in exploded mode.\n+   *\n+   * @param jarPath path to jar file\n+   * @param tempDirPath path to temporary jib local directory\n+   * @param layers list of {@link FileEntriesLayer}\n+   * @return list of {@link String} representing entrypoint\n+   * @throws IOException if I/O error occurs when opening the jar file or if temporary directory\n+   *     provided doesn't exist\n+   * @throws IllegalArgumentException if main class is not found in the jar manifest\n+   */\n+  public static ImmutableList<String> computeEntrypoint_explodedStandard(\n+      Path jarPath, Path tempDirPath, List<FileEntriesLayer> layers)\n+      throws IOException, IllegalStateException {\n+    Path localExplodedJarRoot = tempDirPath;\n+    ZipUtil.unzip(jarPath, localExplodedJarRoot);\n+\n+    String mainClass = null;\n+    try (JarFile jarFile = new JarFile(jarPath.toFile())) {\n+      mainClass = jarFile.getManifest().getMainAttributes().getValue(Attributes.Name.MAIN_CLASS);\n+    }\n+    if (mainClass == null) {\n+      throw new IllegalArgumentException(\"Main-Class not found in jar's manifest.\");\n+    }\n+    List<String> classpath = new ArrayList<>();\n+    for (FileEntriesLayer layer : layers) {\n+      if (layer.getName().equals(DEPENDENCIES) || layer.getName().equals(SNAPSHOT_DEPENDENCIES)) {\n+        classpath.add(APP_ROOT.resolve(\"dependencies\").toString());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7f4e83fdc2217d258ab9d3d4ba59ceff4759a90f"}, "originalPosition": 92}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjMwMjU3OA==", "bodyText": "is the ordering issue not a problem for a standard jar atm?", "url": "https://github.com/GoogleContainerTools/jib/pull/2862#discussion_r512302578", "createdAt": "2020-10-26T22:18:22Z", "author": {"login": "mpeddada1"}, "path": "jib-cli/src/main/java/com/google/cloud/tools/jib/cli/jar/JarProcessor.java", "diffHunk": "@@ -145,6 +149,42 @@ public static JarType determineJarType(Path jarPath) throws IOException {\n     return layers;\n   }\n \n+  /**\n+   * Compute the entrypoint for a standard jar in exploded mode.\n+   *\n+   * @param jarPath path to jar file\n+   * @param tempDirPath path to temporary jib local directory\n+   * @param layers list of {@link FileEntriesLayer}\n+   * @return list of {@link String} representing entrypoint\n+   * @throws IOException if I/O error occurs when opening the jar file or if temporary directory\n+   *     provided doesn't exist\n+   * @throws IllegalArgumentException if main class is not found in the jar manifest\n+   */\n+  public static ImmutableList<String> computeEntrypoint_explodedStandard(\n+      Path jarPath, Path tempDirPath, List<FileEntriesLayer> layers)\n+      throws IOException, IllegalStateException {\n+    Path localExplodedJarRoot = tempDirPath;\n+    ZipUtil.unzip(jarPath, localExplodedJarRoot);\n+\n+    String mainClass = null;\n+    try (JarFile jarFile = new JarFile(jarPath.toFile())) {\n+      mainClass = jarFile.getManifest().getMainAttributes().getValue(Attributes.Name.MAIN_CLASS);\n+    }\n+    if (mainClass == null) {\n+      throw new IllegalArgumentException(\"Main-Class not found in jar's manifest.\");\n+    }\n+    List<String> classpath = new ArrayList<>();\n+    for (FileEntriesLayer layer : layers) {\n+      if (layer.getName().equals(DEPENDENCIES) || layer.getName().equals(SNAPSHOT_DEPENDENCIES)) {\n+        classpath.add(APP_ROOT.resolve(\"dependencies\").toString());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjAwMzQwOQ=="}, "originalCommit": {"oid": "7f4e83fdc2217d258ab9d3d4ba59ceff4759a90f"}, "originalPosition": 92}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIwNzkwMzY3OnYy", "diffSide": "RIGHT", "path": "jib-cli/src/main/java/com/google/cloud/tools/jib/cli/jar/JarProcessor.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yNlQxNDozNDowN1rOHoSbDA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yNlQxNDozNDowN1rOHoSbDA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjAwNjkyNA==", "bodyText": "Considering the order of loading classes, explodedJar should come before dependencies. That said, how about going simple? It's okay to put a non-existing directory. I think the level of code reduction is worth.\nString classpath = APP_ROOT + \"/explodedJar:\" + APP_ROOT + \"/dependencies/*\";", "url": "https://github.com/GoogleContainerTools/jib/pull/2862#discussion_r512006924", "createdAt": "2020-10-26T14:34:07Z", "author": {"login": "chanseokoh"}, "path": "jib-cli/src/main/java/com/google/cloud/tools/jib/cli/jar/JarProcessor.java", "diffHunk": "@@ -145,6 +149,42 @@ public static JarType determineJarType(Path jarPath) throws IOException {\n     return layers;\n   }\n \n+  /**\n+   * Compute the entrypoint for a standard jar in exploded mode.\n+   *\n+   * @param jarPath path to jar file\n+   * @param tempDirPath path to temporary jib local directory\n+   * @param layers list of {@link FileEntriesLayer}\n+   * @return list of {@link String} representing entrypoint\n+   * @throws IOException if I/O error occurs when opening the jar file or if temporary directory\n+   *     provided doesn't exist\n+   * @throws IllegalArgumentException if main class is not found in the jar manifest\n+   */\n+  public static ImmutableList<String> computeEntrypoint_explodedStandard(\n+      Path jarPath, Path tempDirPath, List<FileEntriesLayer> layers)\n+      throws IOException, IllegalStateException {\n+    Path localExplodedJarRoot = tempDirPath;\n+    ZipUtil.unzip(jarPath, localExplodedJarRoot);\n+\n+    String mainClass = null;\n+    try (JarFile jarFile = new JarFile(jarPath.toFile())) {\n+      mainClass = jarFile.getManifest().getMainAttributes().getValue(Attributes.Name.MAIN_CLASS);\n+    }\n+    if (mainClass == null) {\n+      throw new IllegalArgumentException(\"Main-Class not found in jar's manifest.\");\n+    }\n+    List<String> classpath = new ArrayList<>();\n+    for (FileEntriesLayer layer : layers) {\n+      if (layer.getName().equals(DEPENDENCIES) || layer.getName().equals(SNAPSHOT_DEPENDENCIES)) {\n+        classpath.add(APP_ROOT.resolve(\"dependencies\").toString());\n+        break;\n+      }\n+    }\n+    classpath.add(APP_ROOT.resolve(\"explodedJar\").toString());\n+    String classPathString = String.join(\":\", classpath);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7f4e83fdc2217d258ab9d3d4ba59ceff4759a90f"}, "originalPosition": 97}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIwOTgxOTYyOnYy", "diffSide": "RIGHT", "path": "jib-cli/src/main/java/com/google/cloud/tools/jib/cli/jar/JarProcessor.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yNlQyMjoyOToxNVrOHokwsg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yNlQyMjoyOToxNVrOHokwsg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjMwNzM3OA==", "bodyText": "Perhaps this can be package-private?\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              protected static List<FileEntriesLayer> explodeStandardJar(Path jarPath, Path tempDirPath)\n          \n          \n            \n              static List<FileEntriesLayer> explodeStandardJar(Path jarPath, Path tempDirPath)\n          \n      \n    \n    \n  \n\nAnd if this needs to be package-private only to be able to call from tests (i.e., it should have been private if not for the tests), add @VisibleForTesting.", "url": "https://github.com/GoogleContainerTools/jib/pull/2862#discussion_r512307378", "createdAt": "2020-10-26T22:29:15Z", "author": {"login": "chanseokoh"}, "path": "jib-cli/src/main/java/com/google/cloud/tools/jib/cli/jar/JarProcessor.java", "diffHunk": "@@ -76,7 +81,7 @@ public static JarType determineJarType(Path jarPath) throws IOException {\n    * @throws IOException if I/O error occurs when opening the jar file or if temporary directory\n    *     provided doesn't exist\n    */\n-  public static List<FileEntriesLayer> explodeStandardJar(Path jarPath, Path tempDirPath)\n+  protected static List<FileEntriesLayer> explodeStandardJar(Path jarPath, Path tempDirPath)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f61293e5301784f83c8a86c8c87fbc7b1b187466"}, "originalPosition": 24}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIwOTgyNTY5OnYy", "diffSide": "RIGHT", "path": "jib-cli/src/main/java/com/google/cloud/tools/jib/cli/jar/JarProcessor.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yNlQyMjozMToyM1rOHok0Pg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yNlQyMjozMToyM1rOHok0Pg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjMwODI4Ng==", "bodyText": "Sorry, I think this reads better:\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                      \"`Main-Class:` attribute to define an application main class not defined in the input Jar's manifest (`META-INF/MANIFEST.MF` in the JAR).\");\n          \n          \n            \n                      \"`Main-Class:` attribute for an application main class not defined in the input Jar's manifest (`META-INF/MANIFEST.MF` in the Jar).\");", "url": "https://github.com/GoogleContainerTools/jib/pull/2862#discussion_r512308286", "createdAt": "2020-10-26T22:31:23Z", "author": {"login": "chanseokoh"}, "path": "jib-cli/src/main/java/com/google/cloud/tools/jib/cli/jar/JarProcessor.java", "diffHunk": "@@ -145,6 +149,33 @@ public static JarType determineJarType(Path jarPath) throws IOException {\n     return layers;\n   }\n \n+  /**\n+   * Computes the entrypoint for a standard jar in exploded mode.\n+   *\n+   * @param jarPath path to jar file\n+   * @param tempDirPath path to temporary jib local directory\n+   * @param layers list of {@link FileEntriesLayer}\n+   * @return list of {@link String} representing entrypoint\n+   * @throws IOException if I/O error occurs when opening the jar file or if temporary directory\n+   *     provided doesn't exist\n+   */\n+  protected static ImmutableList<String> computeEntrypointForExplodedStandard(\n+      Path jarPath, Path tempDirPath, List<FileEntriesLayer> layers) throws IOException {\n+    Path localExplodedJarRoot = tempDirPath;\n+    ZipUtil.unzip(jarPath, localExplodedJarRoot);\n+\n+    String mainClass = null;\n+    try (JarFile jarFile = new JarFile(jarPath.toFile())) {\n+      mainClass = jarFile.getManifest().getMainAttributes().getValue(Attributes.Name.MAIN_CLASS);\n+    }\n+    if (mainClass == null) {\n+      throw new IllegalArgumentException(\n+          \"`Main-Class:` attribute to define an application main class not defined in the input Jar's manifest (`META-INF/MANIFEST.MF` in the JAR).\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f61293e5301784f83c8a86c8c87fbc7b1b187466"}, "originalPosition": 95}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIwOTgyOTcwOnYy", "diffSide": "RIGHT", "path": "jib-cli/src/main/java/com/google/cloud/tools/jib/cli/jar/JarProcessor.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yNlQyMjozMzoxMVrOHok2ng==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yN1QxNDo0OTo0NFrOHpARbA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjMwODg5NA==", "bodyText": "Oh, actually, I remember unzipping a jar somewhere else too. Are we unzipping it multiple times? We should unzip only once for efficiency.", "url": "https://github.com/GoogleContainerTools/jib/pull/2862#discussion_r512308894", "createdAt": "2020-10-26T22:33:11Z", "author": {"login": "chanseokoh"}, "path": "jib-cli/src/main/java/com/google/cloud/tools/jib/cli/jar/JarProcessor.java", "diffHunk": "@@ -145,6 +149,33 @@ public static JarType determineJarType(Path jarPath) throws IOException {\n     return layers;\n   }\n \n+  /**\n+   * Computes the entrypoint for a standard jar in exploded mode.\n+   *\n+   * @param jarPath path to jar file\n+   * @param tempDirPath path to temporary jib local directory\n+   * @param layers list of {@link FileEntriesLayer}\n+   * @return list of {@link String} representing entrypoint\n+   * @throws IOException if I/O error occurs when opening the jar file or if temporary directory\n+   *     provided doesn't exist\n+   */\n+  protected static ImmutableList<String> computeEntrypointForExplodedStandard(\n+      Path jarPath, Path tempDirPath, List<FileEntriesLayer> layers) throws IOException {\n+    Path localExplodedJarRoot = tempDirPath;\n+    ZipUtil.unzip(jarPath, localExplodedJarRoot);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f61293e5301784f83c8a86c8c87fbc7b1b187466"}, "originalPosition": 87}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjY2NDczMw==", "bodyText": "Actually, I think there is no need to unzip a jar?", "url": "https://github.com/GoogleContainerTools/jib/pull/2862#discussion_r512664733", "createdAt": "2020-10-27T12:51:10Z", "author": {"login": "chanseokoh"}, "path": "jib-cli/src/main/java/com/google/cloud/tools/jib/cli/jar/JarProcessor.java", "diffHunk": "@@ -145,6 +149,33 @@ public static JarType determineJarType(Path jarPath) throws IOException {\n     return layers;\n   }\n \n+  /**\n+   * Computes the entrypoint for a standard jar in exploded mode.\n+   *\n+   * @param jarPath path to jar file\n+   * @param tempDirPath path to temporary jib local directory\n+   * @param layers list of {@link FileEntriesLayer}\n+   * @return list of {@link String} representing entrypoint\n+   * @throws IOException if I/O error occurs when opening the jar file or if temporary directory\n+   *     provided doesn't exist\n+   */\n+  protected static ImmutableList<String> computeEntrypointForExplodedStandard(\n+      Path jarPath, Path tempDirPath, List<FileEntriesLayer> layers) throws IOException {\n+    Path localExplodedJarRoot = tempDirPath;\n+    ZipUtil.unzip(jarPath, localExplodedJarRoot);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjMwODg5NA=="}, "originalCommit": {"oid": "f61293e5301784f83c8a86c8c87fbc7b1b187466"}, "originalPosition": 87}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjc1ODEyNA==", "bodyText": "Cleaned this up a bit.", "url": "https://github.com/GoogleContainerTools/jib/pull/2862#discussion_r512758124", "createdAt": "2020-10-27T14:49:44Z", "author": {"login": "mpeddada1"}, "path": "jib-cli/src/main/java/com/google/cloud/tools/jib/cli/jar/JarProcessor.java", "diffHunk": "@@ -145,6 +149,33 @@ public static JarType determineJarType(Path jarPath) throws IOException {\n     return layers;\n   }\n \n+  /**\n+   * Computes the entrypoint for a standard jar in exploded mode.\n+   *\n+   * @param jarPath path to jar file\n+   * @param tempDirPath path to temporary jib local directory\n+   * @param layers list of {@link FileEntriesLayer}\n+   * @return list of {@link String} representing entrypoint\n+   * @throws IOException if I/O error occurs when opening the jar file or if temporary directory\n+   *     provided doesn't exist\n+   */\n+  protected static ImmutableList<String> computeEntrypointForExplodedStandard(\n+      Path jarPath, Path tempDirPath, List<FileEntriesLayer> layers) throws IOException {\n+    Path localExplodedJarRoot = tempDirPath;\n+    ZipUtil.unzip(jarPath, localExplodedJarRoot);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjMwODg5NA=="}, "originalCommit": {"oid": "f61293e5301784f83c8a86c8c87fbc7b1b187466"}, "originalPosition": 87}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIwOTgzMzQ5OnYy", "diffSide": "RIGHT", "path": "jib-cli/src/main/java/com/google/cloud/tools/jib/cli/jar/JarProcessor.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yNlQyMjozNDo0M1rOHok4-g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yN1QxNDo0OToxNVrOHpAPxA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjMwOTQ5OA==", "bodyText": "Nit: I think this code block is super fast, so it's good to put everything in to the try-resource block.\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                try (JarFile jarFile = new JarFile(jarPath.toFile())) {\n          \n          \n            \n                  mainClass = jarFile.getManifest().getMainAttributes().getValue(Attributes.Name.MAIN_CLASS);\n          \n          \n            \n                }\n          \n          \n            \n                try (JarFile jarFile = new JarFile(jarPath.toFile())) {\n          \n          \n            \n                  String mainClass = jarFile.getManifest().getMainAttributes().getValue(Attributes.Name.MAIN_CLASS);\n          \n          \n            \n                  if (mainClass == null)\n          \n          \n            \n                  ...\n          \n          \n            \n                  return ...\n          \n          \n            \n                }", "url": "https://github.com/GoogleContainerTools/jib/pull/2862#discussion_r512309498", "createdAt": "2020-10-26T22:34:43Z", "author": {"login": "chanseokoh"}, "path": "jib-cli/src/main/java/com/google/cloud/tools/jib/cli/jar/JarProcessor.java", "diffHunk": "@@ -145,6 +149,33 @@ public static JarType determineJarType(Path jarPath) throws IOException {\n     return layers;\n   }\n \n+  /**\n+   * Computes the entrypoint for a standard jar in exploded mode.\n+   *\n+   * @param jarPath path to jar file\n+   * @param tempDirPath path to temporary jib local directory\n+   * @param layers list of {@link FileEntriesLayer}\n+   * @return list of {@link String} representing entrypoint\n+   * @throws IOException if I/O error occurs when opening the jar file or if temporary directory\n+   *     provided doesn't exist\n+   */\n+  protected static ImmutableList<String> computeEntrypointForExplodedStandard(\n+      Path jarPath, Path tempDirPath, List<FileEntriesLayer> layers) throws IOException {\n+    Path localExplodedJarRoot = tempDirPath;\n+    ZipUtil.unzip(jarPath, localExplodedJarRoot);\n+\n+    String mainClass = null;\n+    try (JarFile jarFile = new JarFile(jarPath.toFile())) {\n+      mainClass = jarFile.getManifest().getMainAttributes().getValue(Attributes.Name.MAIN_CLASS);\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f61293e5301784f83c8a86c8c87fbc7b1b187466"}, "originalPosition": 92}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjc1NzcwMA==", "bodyText": "Done.", "url": "https://github.com/GoogleContainerTools/jib/pull/2862#discussion_r512757700", "createdAt": "2020-10-27T14:49:15Z", "author": {"login": "mpeddada1"}, "path": "jib-cli/src/main/java/com/google/cloud/tools/jib/cli/jar/JarProcessor.java", "diffHunk": "@@ -145,6 +149,33 @@ public static JarType determineJarType(Path jarPath) throws IOException {\n     return layers;\n   }\n \n+  /**\n+   * Computes the entrypoint for a standard jar in exploded mode.\n+   *\n+   * @param jarPath path to jar file\n+   * @param tempDirPath path to temporary jib local directory\n+   * @param layers list of {@link FileEntriesLayer}\n+   * @return list of {@link String} representing entrypoint\n+   * @throws IOException if I/O error occurs when opening the jar file or if temporary directory\n+   *     provided doesn't exist\n+   */\n+  protected static ImmutableList<String> computeEntrypointForExplodedStandard(\n+      Path jarPath, Path tempDirPath, List<FileEntriesLayer> layers) throws IOException {\n+    Path localExplodedJarRoot = tempDirPath;\n+    ZipUtil.unzip(jarPath, localExplodedJarRoot);\n+\n+    String mainClass = null;\n+    try (JarFile jarFile = new JarFile(jarPath.toFile())) {\n+      mainClass = jarFile.getManifest().getMainAttributes().getValue(Attributes.Name.MAIN_CLASS);\n+    }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjMwOTQ5OA=="}, "originalCommit": {"oid": "f61293e5301784f83c8a86c8c87fbc7b1b187466"}, "originalPosition": 92}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4999, "cost": 1, "resetAt": "2021-11-12T20:28:25Z"}}}