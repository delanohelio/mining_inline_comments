{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE4NzgzMjQ4", "number": 2890, "title": "Fix ordering of options in Jib Cli", "bodyText": "Use mixins to share options between subcommands.\nUsage:\njib jar --target=<image-target> <my-jar>.jar\nor\njib --target=<image-target> jar <my-jar>.jar\nThis PR makes a few changes:\n\nIntroduces class that contains all the common cli options.\nAdds the common cli options to the subcommands with the help of the @Mixin annotation.\nMoves options that are specific to the build subcommand to Build.java(specifically, --context, --build-file and --parameter)\nCreates CredentialsForJarTest and CredentialsForBuildTest, which will be the same as CredentialsTest but for the subcommands.\nCreates ContainerizersForJarTest and ContainerizersForBuildTest instead of ContainerizersTest.\nCreates BuildTest and JarTest instead of JibCliTest.", "createdAt": "2020-11-10T21:46:55Z", "url": "https://github.com/GoogleContainerTools/jib/pull/2890", "merged": true, "mergeCommit": {"oid": "6979fbc15e1f2485ba29c3e1d4afb10998297b72"}, "closed": true, "closedAt": "2020-12-03T16:24:42Z", "author": {"login": "mpeddada1"}, "timelineItems": {"totalCount": 20, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdbQdDGAH2gAyNTE4NzgzMjQ4OjA4NzU1NjJiMTZkNTE1MDk0OGM5YTQzZDJiYmMyYjY3YjNjOGJmN2E=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdik1NtAFqTU0NDA2OTQ0NA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "0875562b16d5150948c9a43d2bbc2b67b3c8bf7a", "author": {"user": {"login": "mpeddada1", "name": "Mridula"}}, "url": "https://github.com/GoogleContainerTools/jib/commit/0875562b16d5150948c9a43d2bbc2b67b3c8bf7a", "committedDate": "2020-11-10T21:43:24Z", "message": "add scope to target option in order to be used by subcommand"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI4MjI0ODE5", "url": "https://github.com/GoogleContainerTools/jib/pull/2890#pullrequestreview-528224819", "createdAt": "2020-11-11T14:32:51Z", "commit": {"oid": "0875562b16d5150948c9a43d2bbc2b67b3c8bf7a"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "36df0f4184c2e8e0febe34c5a7d5742aa971701d", "author": {"user": {"login": "mpeddada1", "name": "Mridula"}}, "url": "https://github.com/GoogleContainerTools/jib/commit/36df0f4184c2e8e0febe34c5a7d5742aa971701d", "committedDate": "2020-11-11T15:24:04Z", "message": "Add scope for other parameters"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5a6f9488119e3f7457e85d76c4472bcf3ddc8369", "author": {"user": {"login": "mpeddada1", "name": "Mridula"}}, "url": "https://github.com/GoogleContainerTools/jib/commit/5a6f9488119e3f7457e85d76c4472bcf3ddc8369", "committedDate": "2020-11-11T15:34:03Z", "message": "add scope for additional tags option"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI4Mjg4NzI3", "url": "https://github.com/GoogleContainerTools/jib/pull/2890#pullrequestreview-528288727", "createdAt": "2020-11-11T15:41:50Z", "commit": {"oid": "5a6f9488119e3f7457e85d76c4472bcf3ddc8369"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMVQxNTo0MTo1MFrOHxSn2g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMVQxNTo0MTo1MFrOHxSn2g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTQ0NzM4Ng==", "bodyText": "Should we also move context, build-file and parameter to Build.java?", "url": "https://github.com/GoogleContainerTools/jib/pull/2890#discussion_r521447386", "createdAt": "2020-11-11T15:41:50Z", "author": {"login": "mpeddada1"}, "path": "jib-cli/src/main/java/com/google/cloud/tools/jib/cli/cli2/JibCli.java", "diffHunk": "@@ -83,7 +85,8 @@\n       required = true,\n       paramLabel = \"<target-image>\",\n       description =\n-          \"The destination image reference or jib style url,%nexamples:%n gcr.io/project/image,%n registry://image-ref,%n docker://image,%n tar://path\")\n+          \"The destination image reference or jib style url,%nexamples:%n gcr.io/project/image,%n registry://image-ref,%n docker://image,%n tar://path\",\n+      scope = CommandLine.ScopeType.INHERIT)\n   @SuppressWarnings(\"NullAway.Init\") // initialized by picocli\n   private String targetImage;\n ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5a6f9488119e3f7457e85d76c4472bcf3ddc8369"}, "originalPosition": 45}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fe2152da77e12777863db5ce3f6f20384c802c09", "author": {"user": {"login": "mpeddada1", "name": "Mridula"}}, "url": "https://github.com/GoogleContainerTools/jib/commit/fe2152da77e12777863db5ce3f6f20384c802c09", "committedDate": "2020-11-18T19:43:04Z", "message": "wip"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5772850174dc1bd08b4ab7980d0a626469dd05be", "author": {"user": {"login": "mpeddada1", "name": "Mridula"}}, "url": "https://github.com/GoogleContainerTools/jib/commit/5772850174dc1bd08b4ab7980d0a626469dd05be", "committedDate": "2020-11-18T23:38:51Z", "message": "wip"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8560e2e8283be6f5eb264f9d69cf6e80ed12d6cc", "author": {"user": {"login": "mpeddada1", "name": "Mridula"}}, "url": "https://github.com/GoogleContainerTools/jib/commit/8560e2e8283be6f5eb264f9d69cf6e80ed12d6cc", "committedDate": "2020-11-19T02:59:36Z", "message": "Move all common options to separate class and create separate tests for build and jar subcommands"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dd673820a1c5449b1292dbb1903dabebc1654734", "author": {"user": {"login": "mpeddada1", "name": "Mridula"}}, "url": "https://github.com/GoogleContainerTools/jib/commit/dd673820a1c5449b1292dbb1903dabebc1654734", "committedDate": "2020-11-19T03:09:31Z", "message": "Move all common options to separate class and create separate tests for build and jar subcommands"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5da0eab26164897e86e63aa986ba88d1a0c2ebe0", "author": {"user": {"login": "mpeddada1", "name": "Mridula"}}, "url": "https://github.com/GoogleContainerTools/jib/commit/5da0eab26164897e86e63aa986ba88d1a0c2ebe0", "committedDate": "2020-11-19T15:38:37Z", "message": "add tests for jar subcommand"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "92032c90b0fb633f9298abbd819c9a55ffd8d3eb", "author": {"user": {"login": "mpeddada1", "name": "Mridula"}}, "url": "https://github.com/GoogleContainerTools/jib/commit/92032c90b0fb633f9298abbd819c9a55ffd8d3eb", "committedDate": "2020-11-19T15:49:54Z", "message": "Pull in changes from master"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "aceff28d3102b091a2cf767e92fa3af986d8adb9", "author": {"user": {"login": "mpeddada1", "name": "Mridula"}}, "url": "https://github.com/GoogleContainerTools/jib/commit/aceff28d3102b091a2cf767e92fa3af986d8adb9", "committedDate": "2020-11-19T15:58:43Z", "message": "remove change to build.gradle"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fc35d4f7b3af15031be118f690af6e892a286a66", "author": {"user": {"login": "mpeddada1", "name": "Mridula"}}, "url": "https://github.com/GoogleContainerTools/jib/commit/fc35d4f7b3af15031be118f690af6e892a286a66", "committedDate": "2020-11-19T16:03:50Z", "message": "remove unused parameter"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1f5ea8093aa3893fc60d5e587920127264be4d5b", "author": {"user": {"login": "mpeddada1", "name": "Mridula"}}, "url": "https://github.com/GoogleContainerTools/jib/commit/1f5ea8093aa3893fc60d5e587920127264be4d5b", "committedDate": "2020-11-23T18:22:12Z", "message": "pull in changes from master"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQyMjY5NDM4", "url": "https://github.com/GoogleContainerTools/jib/pull/2890#pullrequestreview-542269438", "createdAt": "2020-12-01T20:28:12Z", "commit": {"oid": "1f5ea8093aa3893fc60d5e587920127264be4d5b"}, "state": "COMMENTED", "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wMVQyMDoyODoxMlrOH8-f6w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wMVQyMDozNToxMVrOH8-u8Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzcwMDU4Nw==", "bodyText": "Can this be private? Or @VisibleForTesting if required?", "url": "https://github.com/GoogleContainerTools/jib/pull/2890#discussion_r533700587", "createdAt": "2020-12-01T20:28:12Z", "author": {"login": "chanseokoh"}, "path": "jib-cli/src/main/java/com/google/cloud/tools/jib/cli/cli2/Build.java", "diffHunk": "@@ -38,24 +43,73 @@\n \n   @CommandLine.Spec private CommandSpec spec = CommandSpec.create();\n \n+  @CommandLine.Mixin\n+  @SuppressWarnings(\"NullAway.Init\") // initialized by picocli\n+  CommonCliOptions commonCliOptions;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1f5ea8093aa3893fc60d5e587920127264be4d5b"}, "originalPosition": 28}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzcwMzAzOQ==", "bodyText": "Maybe we can remove this field? JibCli doesn't have any options anymore, right?", "url": "https://github.com/GoogleContainerTools/jib/pull/2890#discussion_r533703039", "createdAt": "2020-12-01T20:32:35Z", "author": {"login": "chanseokoh"}, "path": "jib-cli/src/main/java/com/google/cloud/tools/jib/cli/cli2/Build.java", "diffHunk": "@@ -38,24 +43,73 @@\n \n   @CommandLine.Spec private CommandSpec spec = CommandSpec.create();\n \n+  @CommandLine.Mixin\n+  @SuppressWarnings(\"NullAway.Init\") // initialized by picocli\n+  CommonCliOptions commonCliOptions;\n+\n   @CommandLine.ParentCommand\n   @SuppressWarnings(\"NullAway.Init\") // initialized by picocli\n   protected JibCli globalOptions;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1f5ea8093aa3893fc60d5e587920127264be4d5b"}, "originalPosition": 32}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzcwMzY3Mw==", "bodyText": "commonCliOptions.validate()?", "url": "https://github.com/GoogleContainerTools/jib/pull/2890#discussion_r533703673", "createdAt": "2020-12-01T20:33:51Z", "author": {"login": "chanseokoh"}, "path": "jib-cli/src/main/java/com/google/cloud/tools/jib/cli/cli2/Build.java", "diffHunk": "@@ -38,24 +43,73 @@\n \n   @CommandLine.Spec private CommandSpec spec = CommandSpec.create();\n \n+  @CommandLine.Mixin\n+  @SuppressWarnings(\"NullAway.Init\") // initialized by picocli\n+  CommonCliOptions commonCliOptions;\n+\n   @CommandLine.ParentCommand\n   @SuppressWarnings(\"NullAway.Init\") // initialized by picocli\n   protected JibCli globalOptions;\n \n+  @CommandLine.Option(\n+      names = {\"-c\", \"--context\"},\n+      defaultValue = \".\",\n+      paramLabel = \"<project-root>\",\n+      description = \"The context root directory of the build (ex: path/to/my/build/things)\")\n+  @SuppressWarnings(\"NullAway.Init\") // initialized by picocli\n+  private Path contextRoot;\n+\n+  @CommandLine.Option(\n+      names = {\"-b\", \"--build-file\"},\n+      paramLabel = \"<build-file>\",\n+      description = \"The path to the build file (ex: path/to/other-jib.yaml)\")\n+  @SuppressWarnings(\"NullAway.Init\") // initialized by picocli\n+  private Path buildFile;\n+\n+  @CommandLine.Option(\n+      names = {\"-p\", \"--parameter\"},\n+      paramLabel = \"<name>=<value>\",\n+      description =\n+          \"templating parameter to inject into build file, replace $${<name>} with <value> (repeatable)\")\n+  @SuppressWarnings(\"NullAway.Init\") // initialized by picocli\n+  private Map<String, String> templateParameters = new HashMap<>();\n+\n+  public Path getContextRoot() {\n+    Verify.verifyNotNull(contextRoot);\n+    return contextRoot;\n+  }\n+\n+  /**\n+   * Returns a user configured Path to a buildfile and if none is configured returns jib.yaml in\n+   * {@link #getContextRoot()}.\n+   *\n+   * @return a path to a bulidfile\n+   */\n+  public Path getBuildFile() {\n+    if (buildFile == null) {\n+      return getContextRoot().resolve(\"jib.yaml\");\n+    }\n+    return buildFile;\n+  }\n+\n+  public Map<String, String> getTemplateParameters() {\n+    Verify.verifyNotNull(templateParameters);\n+    return templateParameters;\n+  }\n+\n   @Override\n   public Integer call() {\n-    globalOptions.validate();\n+    validate();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1f5ea8093aa3893fc60d5e587920127264be4d5b"}, "originalPosition": 83}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzcwMzg4MA==", "bodyText": "No need to duplicate the method if we call commonCliOptions.validate() above?", "url": "https://github.com/GoogleContainerTools/jib/pull/2890#discussion_r533703880", "createdAt": "2020-12-01T20:34:15Z", "author": {"login": "chanseokoh"}, "path": "jib-cli/src/main/java/com/google/cloud/tools/jib/cli/cli2/Build.java", "diffHunk": "@@ -86,4 +139,14 @@ public Integer call() {\n     }\n     return 0;\n   }\n+\n+  /** Validates parameters defined in this class that could not be done declaratively. */\n+  public void validate() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1f5ea8093aa3893fc60d5e587920127264be4d5b"}, "originalPosition": 125}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzcwNDI5OQ==", "bodyText": "private or @VisibleForTesting?", "url": "https://github.com/GoogleContainerTools/jib/pull/2890#discussion_r533704299", "createdAt": "2020-12-01T20:34:59Z", "author": {"login": "chanseokoh"}, "path": "jib-cli/src/main/java/com/google/cloud/tools/jib/cli/cli2/Jar.java", "diffHunk": "@@ -41,6 +43,10 @@\n   @SuppressWarnings(\"NullAway.Init\") // initialized by picocli\n   protected JibCli globalOptions;\n \n+  @CommandLine.Mixin\n+  @SuppressWarnings(\"NullAway.Init\") // initialized by picocli\n+  CommonCliOptions commonCliOptions;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1f5ea8093aa3893fc60d5e587920127264be4d5b"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzcwNDQzMw==", "bodyText": "ditto?", "url": "https://github.com/GoogleContainerTools/jib/pull/2890#discussion_r533704433", "createdAt": "2020-12-01T20:35:11Z", "author": {"login": "chanseokoh"}, "path": "jib-cli/src/main/java/com/google/cloud/tools/jib/cli/cli2/Jar.java", "diffHunk": "@@ -97,4 +103,14 @@ public Integer call() {\n     }\n     return 0;\n   }\n+\n+  /** Validates parameters defined in this class that could not be done declaratively. */\n+  public void validate() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1f5ea8093aa3893fc60d5e587920127264be4d5b"}, "originalPosition": 61}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e1d711576e3f18e939c4ad638605e91bf3dc4bfa", "author": {"user": {"login": "chanseokoh", "name": "Chanseok Oh"}}, "url": "https://github.com/GoogleContainerTools/jib/commit/e1d711576e3f18e939c4ad638605e91bf3dc4bfa", "committedDate": "2020-12-01T21:35:25Z", "message": "Simplify test code"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f50f0a1f1430db2750c1a49a368882d424224a32", "author": {"user": {"login": "mpeddada1", "name": "Mridula"}}, "url": "https://github.com/GoogleContainerTools/jib/commit/f50f0a1f1430db2750c1a49a368882d424224a32", "committedDate": "2020-12-02T22:03:14Z", "message": "adding VisibleForTesting and moving validate to commonclioptions"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1073046d9406d3f01298d7ffba2b6d2b38df3bcf", "author": {"user": {"login": "mpeddada1", "name": "Mridula"}}, "url": "https://github.com/GoogleContainerTools/jib/commit/1073046d9406d3f01298d7ffba2b6d2b38df3bcf", "committedDate": "2020-12-02T22:07:05Z", "message": "pull in changes from remote"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQzMzMyMjIw", "url": "https://github.com/GoogleContainerTools/jib/pull/2890#pullrequestreview-543332220", "createdAt": "2020-12-02T23:48:42Z", "commit": {"oid": "1073046d9406d3f01298d7ffba2b6d2b38df3bcf"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ0MDY5NDQ0", "url": "https://github.com/GoogleContainerTools/jib/pull/2890#pullrequestreview-544069444", "createdAt": "2020-12-03T15:25:22Z", "commit": {"oid": "1073046d9406d3f01298d7ffba2b6d2b38df3bcf"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4875, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}