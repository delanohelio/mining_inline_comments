{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzcwNTM5NDU2", "number": 2264, "title": "Check additional Docker config file paths ($HOME, .dockerconfigjson, and legacy .dockercfg)", "bodyText": "Fixes #2260.\nIn addition to the current\n\nSystem.get(\"user.home\")/.docker/config.json\n\nthis PR now searches for\n\nSystem.get(\"user.home\")/.docker/.dockerconfigjson\nSystem.get(\"user.home\")/.docker/.dockercfg (legacy format)\n$HOME/.docker/config.json\n$HOME/.docker/.dockerconfigjson\n$HOME/.docker/.dockercfg (legacy format)\n\n$HOME can be different from System.get(\"user.home\"), which is the case on GCB. For example, after this fix, we will be able to eventually remove passing -Duser.home=/home/builder in Skaffold (although recent Jib versions can populate Google ADC and thus will work without -Duser.home= on GCB).\nI learned that the legacy format was just the auths section of the new format. For example, suppose this is a new format file:\n{\n  \"auths\":{\n    \"some other registry\":{\"auth\":\"c29tZTpvdGhlcjphdXRo\"},\n    \"some registry\":{\"auth\":\"c29tZTphdXRo\",\"password\":\"ignored\"},\n    \"https://registry\":{\"auth\":\"dG9rZW4=\"},\n\n    \"example.com\":{\"auth\":\"blah blah\"}\n  },\n  \"credsStore\": ...,\n  \"credHelpers\": ...\n}\n\nAn example legacy file can be\n{\n  \"some other registry\":{\"auth\":\"c29tZTpvdGhlcjphdXRo\"},\n  \"some registry\":{\"auth\":\"c29tZTphdXRo\",\"password\":\"ignored\"},\n  \"https://registry\":{\"auth\":\"dG9rZW4=\"},\n\n  \"example.com\":{\"auth\":\"blah blah\"}\n}", "createdAt": "2020-02-03T21:49:42Z", "url": "https://github.com/GoogleContainerTools/jib/pull/2264", "merged": true, "mergeCommit": {"oid": "84933d528b4e4d445d88686e7c7db3945d6c896f"}, "closed": true, "closedAt": "2020-02-11T23:49:41Z", "author": {"login": "chanseokoh"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb_3mazAH2gAyMzcwNTM5NDU2OjE5MTNmZjE2YzU3YWYzYTY0YzZjYTk3Njc0NDU0NmNjNDY1ZmIxMmQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcDY_IcAFqTM1NzAyNTAzMQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "1913ff16c57af3a64c6ca976744546cc465fb12d", "author": {"user": {"login": "chanseokoh", "name": "Chanseok Oh"}}, "url": "https://github.com/GoogleContainerTools/jib/commit/1913ff16c57af3a64c6ca976744546cc465fb12d", "committedDate": "2020-01-31T23:18:54Z", "message": "wip"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8cab88b7b7be75512aa2852c4092adf235148b83", "author": {"user": {"login": "chanseokoh", "name": "Chanseok Oh"}}, "url": "https://github.com/GoogleContainerTools/jib/commit/8cab88b7b7be75512aa2852c4092adf235148b83", "committedDate": "2020-02-03T15:45:32Z", "message": "wip"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c58e975eeeb9ffd981e6a5566eccda7168807913", "author": {"user": {"login": "chanseokoh", "name": "Chanseok Oh"}}, "url": "https://github.com/GoogleContainerTools/jib/commit/c58e975eeeb9ffd981e6a5566eccda7168807913", "committedDate": "2020-02-03T21:05:10Z", "message": "wip"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5648e08bc5b9e767bfea051ae6b826b779e3fddc", "author": {"user": {"login": "chanseokoh", "name": "Chanseok Oh"}}, "url": "https://github.com/GoogleContainerTools/jib/commit/5648e08bc5b9e767bfea051ae6b826b779e3fddc", "committedDate": "2020-02-03T21:27:24Z", "message": "Search for .dockerconfigjson too"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUzODIzMjQ1", "url": "https://github.com/GoogleContainerTools/jib/pull/2264#pullrequestreview-353823245", "createdAt": "2020-02-05T15:47:27Z", "commit": {"oid": "5648e08bc5b9e767bfea051ae6b826b779e3fddc"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNVQxNTo0NzoyN1rOFl8z0g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNVQxNTo0NzoyN1rOFl8z0g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTMzNzkzOA==", "bodyText": "This was API'ish (I used it in Cram).  It would be nice to not break any users even if it wasn't officially API.", "url": "https://github.com/GoogleContainerTools/jib/pull/2264#discussion_r375337938", "createdAt": "2020-02-05T15:47:27Z", "author": {"login": "briandealwis"}, "path": "jib-core/src/main/java/com/google/cloud/tools/jib/frontend/CredentialRetrieverFactory.java", "diffHunk": "@@ -187,17 +187,6 @@ public CredentialRetriever wellKnownCredentialHelpers() {\n     };\n   }\n \n-  /**\n-   * Creates a new {@link CredentialRetriever} that tries to retrieve credentials from Docker config\n-   * (located at {@code $USER_HOME/.docker/config.json}).\n-   *\n-   * @return a new {@link CredentialRetriever}\n-   * @see DockerConfigCredentialRetriever\n-   */\n-  public CredentialRetriever dockerConfig() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5648e08bc5b9e767bfea051ae6b826b779e3fddc"}, "originalPosition": 11}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0e2623d787af22543f2172e44210cb2715635f01", "author": {"user": {"login": "chanseokoh", "name": "Chanseok Oh"}}, "url": "https://github.com/GoogleContainerTools/jib/commit/0e2623d787af22543f2172e44210cb2715635f01", "committedDate": "2020-02-05T17:22:55Z", "message": "Restore dockerConfig() API"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dfc96008f3c5c325fe6fc71a8ca0dfb29d0b1c4e", "author": {"user": {"login": "chanseokoh", "name": "Chanseok Oh"}}, "url": "https://github.com/GoogleContainerTools/jib/commit/dfc96008f3c5c325fe6fc71a8ca0dfb29d0b1c4e", "committedDate": "2020-02-05T17:27:51Z", "message": "typo"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU1NDM3MjQ1", "url": "https://github.com/GoogleContainerTools/jib/pull/2264#pullrequestreview-355437245", "createdAt": "2020-02-07T21:07:32Z", "commit": {"oid": "dfc96008f3c5c325fe6fc71a8ca0dfb29d0b1c4e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wN1QyMTowNzozMlrOFnKU0A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wN1QyMTowNzozMlrOFnKU0A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjYwNzk1Mg==", "bodyText": "potential value in adding comment here (or somewhere) that legacyConfigFormat = auths{} block of dockerConfig.", "url": "https://github.com/GoogleContainerTools/jib/pull/2264#discussion_r376607952", "createdAt": "2020-02-07T21:07:32Z", "author": {"login": "loosebazooka"}, "path": "jib-core/src/main/java/com/google/cloud/tools/jib/registry/credentials/DockerConfigCredentialRetriever.java", "diffHunk": "@@ -81,6 +85,20 @@ public Path getDockerConfigFile() {\n     if (!Files.exists(dockerConfigFile)) {\n       return Optional.empty();\n     }\n+\n+    if (legacyConfigFormat) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dfc96008f3c5c325fe6fc71a8ca0dfb29d0b1c4e"}, "originalPosition": 62}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dbf414581e6c2d0d53400d4e67efb7cb6d65d80c", "author": {"user": {"login": "chanseokoh", "name": "Chanseok Oh"}}, "url": "https://github.com/GoogleContainerTools/jib/commit/dbf414581e6c2d0d53400d4e67efb7cb6d65d80c", "committedDate": "2020-02-07T21:46:18Z", "message": "Add comment"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "43883f60e567f630d8ed7331c08bbca7a401afe6", "author": {"user": {"login": "chanseokoh", "name": "Chanseok Oh"}}, "url": "https://github.com/GoogleContainerTools/jib/commit/43883f60e567f630d8ed7331c08bbca7a401afe6", "committedDate": "2020-02-07T21:52:59Z", "message": "formatting"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU3MDI1MDMx", "url": "https://github.com/GoogleContainerTools/jib/pull/2264#pullrequestreview-357025031", "createdAt": "2020-02-11T21:54:32Z", "commit": {"oid": "43883f60e567f630d8ed7331c08bbca7a401afe6"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 332, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}