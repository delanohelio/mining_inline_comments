{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzU5MTU2ODg0", "number": 2212, "reviewThreads": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wNlQyMjoxNzo1M1rODWGj9Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wN1QyMToxMTo1M1rODWXs3g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI0NTAyNzczOnYy", "diffSide": "RIGHT", "path": "jib-maven-plugin/src/main/java/com/google/cloud/tools/jib/maven/MavenSettingsServerCredentials.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wNlQyMjoxNzo1M1rOFaq4vg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wN1QyMDoxOToxNVrOFbEsrQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzUwOTk1MA==", "bodyText": "It'd be nice if this server == null code could go into getServerFromMavenSettings", "url": "https://github.com/GoogleContainerTools/jib/pull/2212#discussion_r363509950", "createdAt": "2020-01-06T22:17:53Z", "author": {"login": "loosebazooka"}, "path": "jib-maven-plugin/src/main/java/com/google/cloud/tools/jib/maven/MavenSettingsServerCredentials.java", "diffHunk": "@@ -58,7 +59,7 @@\n   @Override\n   public Optional<AuthProperty> inferAuth(String registry) throws InferredAuthException {\n \n-    Server server = settings.getServer(registry);\n+    Server server = getServerFromMavenSettings(registry);\n     if (server == null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "86324f93e634e5363a36f9b0036510837e7d6dd1"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzkyODk0Ng==", "bodyText": "Could you elaborate? I can't see an option right now to implement that: There could, or could not be, a server returned.\nIf I switch this to use Optional, I would have to swap this out with an isPresent check instead to continue with the decryption below...", "url": "https://github.com/GoogleContainerTools/jib/pull/2212#discussion_r363928946", "createdAt": "2020-01-07T20:08:48Z", "author": {"login": "padyx"}, "path": "jib-maven-plugin/src/main/java/com/google/cloud/tools/jib/maven/MavenSettingsServerCredentials.java", "diffHunk": "@@ -58,7 +59,7 @@\n   @Override\n   public Optional<AuthProperty> inferAuth(String registry) throws InferredAuthException {\n \n-    Server server = settings.getServer(registry);\n+    Server server = getServerFromMavenSettings(registry);\n     if (server == null) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzUwOTk1MA=="}, "originalCommit": {"oid": "86324f93e634e5363a36f9b0036510837e7d6dd1"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzkzMjg0NQ==", "bodyText": "Makes sense. I think we can leave this null check here.", "url": "https://github.com/GoogleContainerTools/jib/pull/2212#discussion_r363932845", "createdAt": "2020-01-07T20:19:15Z", "author": {"login": "chanseokoh"}, "path": "jib-maven-plugin/src/main/java/com/google/cloud/tools/jib/maven/MavenSettingsServerCredentials.java", "diffHunk": "@@ -58,7 +59,7 @@\n   @Override\n   public Optional<AuthProperty> inferAuth(String registry) throws InferredAuthException {\n \n-    Server server = settings.getServer(registry);\n+    Server server = getServerFromMavenSettings(registry);\n     if (server == null) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzUwOTk1MA=="}, "originalCommit": {"oid": "86324f93e634e5363a36f9b0036510837e7d6dd1"}, "originalPosition": 14}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI0NzY5MDA2OnYy", "diffSide": "RIGHT", "path": "jib-maven-plugin/src/main/java/com/google/cloud/tools/jib/maven/MavenSettingsServerCredentials.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wN1QyMDoxMDozMVrOFbEf2Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wN1QyMDoxMDozMVrOFbEf2Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzkyOTU2MQ==", "bodyText": "You don't need this null check. We check nullability with NullAway, and unless the argument is marked with @Nullable, it is never null.", "url": "https://github.com/GoogleContainerTools/jib/pull/2212#discussion_r363929561", "createdAt": "2020-01-07T20:10:31Z", "author": {"login": "chanseokoh"}, "path": "jib-maven-plugin/src/main/java/com/google/cloud/tools/jib/maven/MavenSettingsServerCredentials.java", "diffHunk": "@@ -108,4 +109,23 @@ public String getPasswordDescriptor() {\n           }\n         });\n   }\n+\n+  @Nullable\n+  Server getServerFromMavenSettings(String registry) {\n+    // Find and remove port (if present)\n+    if (registry == null) {\n+      return null;\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b792049b2b01adb4504a9790e0d8587f62a430f9"}, "originalPosition": 27}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI0NzY5MDUxOnYy", "diffSide": "RIGHT", "path": "jib-maven-plugin/src/main/java/com/google/cloud/tools/jib/maven/MavenSettingsServerCredentials.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wN1QyMDoxMDo0MlrOFbEgHw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wN1QyMDoxMDo0MlrOFbEgHw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzkyOTYzMQ==", "bodyText": "Please add @VisibleForTesting.", "url": "https://github.com/GoogleContainerTools/jib/pull/2212#discussion_r363929631", "createdAt": "2020-01-07T20:10:42Z", "author": {"login": "chanseokoh"}, "path": "jib-maven-plugin/src/main/java/com/google/cloud/tools/jib/maven/MavenSettingsServerCredentials.java", "diffHunk": "@@ -108,4 +109,23 @@ public String getPasswordDescriptor() {\n           }\n         });\n   }\n+\n+  @Nullable", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b792049b2b01adb4504a9790e0d8587f62a430f9"}, "originalPosition": 22}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI0NzcwNjM1OnYy", "diffSide": "RIGHT", "path": "jib-maven-plugin/src/main/java/com/google/cloud/tools/jib/maven/MavenSettingsServerCredentials.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wN1QyMDoxNzoyOFrOFbEqGw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wN1QyMDoxNzoyOFrOFbEqGw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzkzMjE4Nw==", "bodyText": "I suggest\n    int index = registry.lastIndexOf(':');\n    if (index != -1) {\n      return settings.getServer(registry.substring(0, index));\n    }\n    return null;\nNo need to call settings.getServer() twice if nothing is configured.", "url": "https://github.com/GoogleContainerTools/jib/pull/2212#discussion_r363932187", "createdAt": "2020-01-07T20:17:28Z", "author": {"login": "chanseokoh"}, "path": "jib-maven-plugin/src/main/java/com/google/cloud/tools/jib/maven/MavenSettingsServerCredentials.java", "diffHunk": "@@ -108,4 +109,23 @@ public String getPasswordDescriptor() {\n           }\n         });\n   }\n+\n+  @Nullable\n+  Server getServerFromMavenSettings(String registry) {\n+    // Find and remove port (if present)\n+    if (registry == null) {\n+      return null;\n+    }\n+\n+    Server server = settings.getServer(registry);\n+    if (server != null) {\n+      return server;\n+    }\n+\n+    int index = registry.lastIndexOf(':');\n+    if (index != -1) {\n+      registry = registry.substring(0, index);\n+    }\n+    return settings.getServer(registry);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "165a9b2270c062066dca2fb786c5320780619ae8"}, "originalPosition": 38}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI0NzgzNTgyOnYy", "diffSide": "RIGHT", "path": "jib-maven-plugin/src/main/java/com/google/cloud/tools/jib/maven/MavenSettingsServerCredentials.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wN1QyMToxMTo1M1rOFbF6zQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOFQwMDowNzowM1rOFbJe2Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Mzk1Mjg0NQ==", "bodyText": "Oh, this comment is now confusing. Let's update and move this to line 123:\n// try without port\nint index = registry.lastIndexOf(':');\n(Sorry, I should have caught this earlier.)", "url": "https://github.com/GoogleContainerTools/jib/pull/2212#discussion_r363952845", "createdAt": "2020-01-07T21:11:53Z", "author": {"login": "chanseokoh"}, "path": "jib-maven-plugin/src/main/java/com/google/cloud/tools/jib/maven/MavenSettingsServerCredentials.java", "diffHunk": "@@ -108,4 +110,20 @@ public String getPasswordDescriptor() {\n           }\n         });\n   }\n+\n+  @Nullable\n+  @VisibleForTesting\n+  Server getServerFromMavenSettings(String registry) {\n+    // Find and remove port (if present)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c694ae17754b986ee13ac8df1c5bbce7856558b5"}, "originalPosition": 27}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDAxMTIyNQ==", "bodyText": "Never mind. I just did it myself.", "url": "https://github.com/GoogleContainerTools/jib/pull/2212#discussion_r364011225", "createdAt": "2020-01-08T00:07:03Z", "author": {"login": "chanseokoh"}, "path": "jib-maven-plugin/src/main/java/com/google/cloud/tools/jib/maven/MavenSettingsServerCredentials.java", "diffHunk": "@@ -108,4 +110,20 @@ public String getPasswordDescriptor() {\n           }\n         });\n   }\n+\n+  @Nullable\n+  @VisibleForTesting\n+  Server getServerFromMavenSettings(String registry) {\n+    // Find and remove port (if present)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Mzk1Mjg0NQ=="}, "originalCommit": {"oid": "c694ae17754b986ee13ac8df1c5bbce7856558b5"}, "originalPosition": 27}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 425, "cost": 1, "resetAt": "2021-11-12T19:05:54Z"}}}