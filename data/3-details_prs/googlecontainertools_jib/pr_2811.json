{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDk5NTc4MDg0", "number": 2811, "title": "Add (new) Jib Cli parameters in base command class.", "bodyText": "Initial implementation of #2787\ndoes not execute anything\nHere's what the help text looks like:\nUsage: jib [-hV] [--allow-insecure-registries] [--send-credentials-over-http]\n           [--application-cache=<cache-directory>] [-b=<build-file>]\n           [--base-image-cache=<cache-directory>] [-c=<project-root>]\n           [--name=<image-reference>] -t=<target-image> [--verbosity=<level>]\n           [--credential-helper=<credential-helper>]... [-p=<name>=<value>]...\n           [--tags=<tag>[,<tag>...]]... [[--username=<username> --password\n           [=<password>]] | [[--to-username=<username> --to-password\n           [=<password>]] [--from-username=<username> --from-password\n           [=<password>]]]] [@<filename>...]\nA tool for creating container images\n      [@<filename>...]      One or more argument files containing options.\n      --allow-insecure-registries\n                            Allow jib to communicate with registries over https\n      --application-cache=<cache-directory>\n                            A path to an application cache\n  -b, --build-file=<build-file>\n                            The path to the build file (ex: path/to/other-jib.\n                              yaml)\n      --base-image-cache=<cache-directory>\n                            A path to a base image cache\n  -c, --context=<project-root>\n                            The context root directory of the build (ex:\n                              path/to/my/build/things)\n      --credential-helper=<credential-helper>\n                            Add a credential helper, either a path to the\n                              helper, or a suffix for an executable named\n                              `docker-credential-<suffix>` (repeatable)\n      --from-password[=<password>]\n                            password for communicating with base image registry\n      --from-username=<username>\n                            username for communicating with base image registry\n  -h, --help                Show this help message and exit.\n      --name=<image-reference>\n                            The image reference to inject into the tar\n                              configuration (required when using --target tar:\n                              //...)\n  -p, --parameter=<name>=<value>\n                            templating parameter to inject into build file,\n                              replace ${<name>} with <value> (repeatable)\n      --password[=<password>]\n                            password for communicating with target/base image\n                              registry\n      --send-credentials-over-http\n                            Allow jib to communicate with registries over https\n  -t, --target=<target-image>\n                            The destination image reference or jib style url,\n                            examples:\n                             gcr.io/project/image,\n                             registry://image-ref,\n                             docker://image,\n                             tar://path\n      --tags=<tag>[,<tag>...]\n                            Additional tags for target image\n      --to-password[=<password>]\n                            password for communicating with target image\n                              registry\n      --to-username=<username>\n                            username for communicating with target image\n                              registry\n      --username=<username> username for communicating with target/base image\n                              registry\n  -V, --version             Print version information and exit.\n      --verbosity=<level>   set logging verbosity (error, warn, lifecycle\n                              (default), info, debug)", "createdAt": "2020-10-07T23:56:37Z", "url": "https://github.com/GoogleContainerTools/jib/pull/2811", "merged": true, "mergeCommit": {"oid": "9063a42a94ce55cedda147fb3473134a60720432"}, "closed": true, "closedAt": "2020-10-14T05:12:58Z", "author": {"login": "loosebazooka"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdQV_pcgBqjM4NTI5NDI5ODI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdSObLrAFqTUwNzc5NTg3OA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "fdef2d65d2fca9338cc784b60ec047cccd7a3531", "author": {"user": {"login": "loosebazooka", "name": "Appu"}}, "url": "https://github.com/GoogleContainerTools/jib/commit/fdef2d65d2fca9338cc784b60ec047cccd7a3531", "committedDate": "2020-10-07T23:54:43Z", "message": "Add (new) Jib Cli parameters in base command class."}, "afterCommit": {"oid": "070f6c32cdd633c330f4963323c749a6f2c84ebf", "author": {"user": {"login": "loosebazooka", "name": "Appu"}}, "url": "https://github.com/GoogleContainerTools/jib/commit/070f6c32cdd633c330f4963323c749a6f2c84ebf", "committedDate": "2020-10-07T23:57:20Z", "message": "Add (new) Jib Cli parameters in base command class."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA2NzA1ODcy", "url": "https://github.com/GoogleContainerTools/jib/pull/2811#pullrequestreview-506705872", "createdAt": "2020-10-12T15:11:03Z", "commit": {"oid": "97917975e106bea8886c770618c7943786cda533"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xMlQxNToxMTowNFrOHgCxtw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xMlQxNToxMTowNFrOHgCxtw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzM2MTk3NQ==", "bodyText": "How about doing something like this:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                try {\n          \n          \n            \n                  CommandLine.populateCommand(new JibCli(), \"\");\n          \n          \n            \n                  fail();\n          \n          \n            \n                } catch (CommandLine.MissingParameterException mpe) {\n          \n          \n            \n                  assertThat(mpe.getMessage()).isEqualTo(\"Missing required option: '--target=<target-image>'\");\n          \n          \n            \n                }\n          \n          \n            \n                MissingParameterExceptin mpe = assertThrows(MissingParameterException.class, () ->  CommandLine.populateCommand(new JibCli(), \"\"));\n          \n          \n            \n                assertThat(mpe).hasMessageThat().contains(\"Missing required option: '--target=<target-image>'\");", "url": "https://github.com/GoogleContainerTools/jib/pull/2811#discussion_r503361975", "createdAt": "2020-10-12T15:11:04Z", "author": {"login": "mpeddada1"}, "path": "jib-cli/src/test/java/com/google/cloud/tools/jib/cli/cli2/JibCliTest.java", "diffHunk": "@@ -0,0 +1,328 @@\n+/*\n+ * Copyright 2020 Google LLC.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not\n+ * use this file except in compliance with the License. You may obtain a copy of\n+ * the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+ * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n+ * License for the specific language governing permissions and limitations under\n+ * the License.\n+ */\n+\n+package com.google.cloud.tools.jib.cli.cli2;\n+\n+import static com.google.common.truth.Truth.assertThat;\n+import static com.google.common.truth.Truth8.assertThat;\n+import static org.junit.Assert.fail;\n+\n+import com.google.cloud.tools.jib.api.Credential;\n+import com.google.common.collect.ImmutableList;\n+import com.google.common.collect.ImmutableMap;\n+import java.nio.file.Paths;\n+import java.util.Arrays;\n+import java.util.Collection;\n+import org.junit.Test;\n+import org.junit.runner.RunWith;\n+import org.junit.runners.Parameterized;\n+import picocli.CommandLine;\n+\n+public class JibCliTest {\n+  @Test\n+  public void testParse_missingRequiredParams() {\n+    try {\n+      CommandLine.populateCommand(new JibCli(), \"\");\n+      fail();\n+    } catch (CommandLine.MissingParameterException mpe) {\n+      assertThat(mpe.getMessage()).isEqualTo(\"Missing required option: '--target=<target-image>'\");\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "97917975e106bea8886c770618c7943786cda533"}, "originalPosition": 42}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA2NzA4MDcw", "url": "https://github.com/GoogleContainerTools/jib/pull/2811#pullrequestreview-506708070", "createdAt": "2020-10-12T15:13:44Z", "commit": {"oid": "97917975e106bea8886c770618c7943786cda533"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xMlQxNToxMzo0NFrOHgC34w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xMlQxNToxMzo0NFrOHgC34w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzM2MzU1NQ==", "bodyText": "same here, with using assertThrows and assertThat().hasMessageThat().contains()", "url": "https://github.com/GoogleContainerTools/jib/pull/2811#discussion_r503363555", "createdAt": "2020-10-12T15:13:44Z", "author": {"login": "mpeddada1"}, "path": "jib-cli/src/test/java/com/google/cloud/tools/jib/cli/cli2/JibCliTest.java", "diffHunk": "@@ -0,0 +1,328 @@\n+/*\n+ * Copyright 2020 Google LLC.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not\n+ * use this file except in compliance with the License. You may obtain a copy of\n+ * the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+ * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n+ * License for the specific language governing permissions and limitations under\n+ * the License.\n+ */\n+\n+package com.google.cloud.tools.jib.cli.cli2;\n+\n+import static com.google.common.truth.Truth.assertThat;\n+import static com.google.common.truth.Truth8.assertThat;\n+import static org.junit.Assert.fail;\n+\n+import com.google.cloud.tools.jib.api.Credential;\n+import com.google.common.collect.ImmutableList;\n+import com.google.common.collect.ImmutableMap;\n+import java.nio.file.Paths;\n+import java.util.Arrays;\n+import java.util.Collection;\n+import org.junit.Test;\n+import org.junit.runner.RunWith;\n+import org.junit.runners.Parameterized;\n+import picocli.CommandLine;\n+\n+public class JibCliTest {\n+  @Test\n+  public void testParse_missingRequiredParams() {\n+    try {\n+      CommandLine.populateCommand(new JibCli(), \"\");\n+      fail();\n+    } catch (CommandLine.MissingParameterException mpe) {\n+      assertThat(mpe.getMessage()).isEqualTo(\"Missing required option: '--target=<target-image>'\");\n+    }\n+  }\n+\n+  @Test\n+  public void testParse_defaults() {\n+    JibCli jibCli = CommandLine.populateCommand(new JibCli(), \"-t\", \"test-image-ref\");\n+\n+    assertThat(jibCli.getTargetImage()).isEqualTo(\"test-image-ref\");\n+    assertThat(jibCli.getUsernamePassword()).isEmpty();\n+    assertThat(jibCli.getToUsernamePassword()).isEmpty();\n+    assertThat(jibCli.getFromUsernamePassword()).isEmpty();\n+    assertThat(jibCli.getCredentialHelpers()).isEmpty();\n+    assertThat(jibCli.getBuildFile()).isEqualTo(Paths.get(\"./jib.yaml\"));\n+    assertThat(jibCli.getContextRoot()).isEqualTo(Paths.get(\".\"));\n+    assertThat(jibCli.getTags()).isEmpty();\n+    assertThat(jibCli.getTemplateParameters()).isEmpty();\n+    assertThat(jibCli.getApplicationCache()).isEmpty();\n+    assertThat(jibCli.getBaseImageCache()).isEmpty();\n+    assertThat(jibCli.isAllowInsecureRegistries()).isFalse();\n+    assertThat(jibCli.isSendCredentialsOverHttp()).isFalse();\n+    assertThat(jibCli.getVerbosity()).isEqualTo(\"lifecycle\");\n+    assertThat(jibCli.isStacktrace()).isFalse();\n+    assertThat(jibCli.isHttpTrace()).isFalse();\n+    assertThat(jibCli.isSerialize()).isFalse();\n+  }\n+\n+  @Test\n+  public void testParse_shortFormParams() {\n+    JibCli jibCli =\n+        CommandLine.populateCommand(\n+            new JibCli(),\n+            \"-t\",\n+            \"test-image-ref\",\n+            \"-c\",\n+            \"test-context\",\n+            \"-b\",\n+            \"test-build-file\",\n+            \"-p\",\n+            \"param1=value1\",\n+            \"-p\",\n+            \"param2=value2\");\n+\n+    assertThat(jibCli.getTargetImage()).isEqualTo(\"test-image-ref\");\n+    assertThat(jibCli.getUsernamePassword()).isEmpty();\n+    assertThat(jibCli.getToUsernamePassword()).isEmpty();\n+    assertThat(jibCli.getFromUsernamePassword()).isEmpty();\n+    assertThat(jibCli.getCredentialHelpers()).isEmpty();\n+    assertThat(jibCli.getBuildFile()).isEqualTo(Paths.get(\"test-build-file\"));\n+    assertThat(jibCli.getContextRoot()).isEqualTo(Paths.get(\"test-context\"));\n+    assertThat(jibCli.getTags()).isEmpty();\n+    assertThat(jibCli.getTemplateParameters())\n+        .isEqualTo(ImmutableMap.of(\"param1\", \"value1\", \"param2\", \"value2\"));\n+    assertThat(jibCli.getApplicationCache()).isEmpty();\n+    assertThat(jibCli.getBaseImageCache()).isEmpty();\n+    assertThat(jibCli.isAllowInsecureRegistries()).isFalse();\n+    assertThat(jibCli.isSendCredentialsOverHttp()).isFalse();\n+    assertThat(jibCli.getVerbosity()).isEqualTo(\"lifecycle\");\n+    assertThat(jibCli.isStacktrace()).isFalse();\n+    assertThat(jibCli.isStacktrace()).isFalse();\n+    assertThat(jibCli.isHttpTrace()).isFalse();\n+    assertThat(jibCli.isSerialize()).isFalse();\n+  }\n+\n+  @Test\n+  public void testParse_longFormParams() {\n+    JibCli jibCli =\n+        CommandLine.populateCommand(\n+            new JibCli(),\n+            \"--target\",\n+            \"test-image-ref\",\n+            \"--context\",\n+            \"test-context\",\n+            \"--build-file\",\n+            \"test-build-file\",\n+            \"--parameter\",\n+            \"param1=value1\",\n+            \"--parameter\",\n+            \"param2=value2\",\n+            \"--credential-helper\",\n+            \"helper1\",\n+            \"--credential-helper\",\n+            \"helper2\",\n+            \"--tags\",\n+            \"tag1,tag2,tag3\",\n+            \"--allow-insecure-registries\",\n+            \"--send-credentials-over-http\",\n+            \"--application-cache\",\n+            \"test-application-cache\",\n+            \"--base-image-cache\",\n+            \"test-base-image-cache\",\n+            \"--verbosity\",\n+            \"info\",\n+            \"--stacktrace\",\n+            \"--http-trace\",\n+            \"--serialize\");\n+\n+    assertThat(jibCli.getTargetImage()).isEqualTo(\"test-image-ref\");\n+    assertThat(jibCli.getUsernamePassword()).isEmpty();\n+    assertThat(jibCli.getToUsernamePassword()).isEmpty();\n+    assertThat(jibCli.getFromUsernamePassword()).isEmpty();\n+    assertThat(jibCli.getCredentialHelpers()).isEqualTo(ImmutableList.of(\"helper1\", \"helper2\"));\n+    assertThat(jibCli.getBuildFile()).isEqualTo(Paths.get(\"test-build-file\"));\n+    assertThat(jibCli.getContextRoot()).isEqualTo(Paths.get(\"test-context\"));\n+    assertThat(jibCli.getTags()).isEqualTo(ImmutableList.of(\"tag1\", \"tag2\", \"tag3\"));\n+    assertThat(jibCli.getTemplateParameters())\n+        .isEqualTo(ImmutableMap.of(\"param1\", \"value1\", \"param2\", \"value2\"));\n+    assertThat(jibCli.getApplicationCache()).hasValue(Paths.get(\"test-application-cache\"));\n+    assertThat(jibCli.getBaseImageCache()).hasValue(Paths.get(\"test-base-image-cache\"));\n+    assertThat(jibCli.isAllowInsecureRegistries()).isTrue();\n+    assertThat(jibCli.isSendCredentialsOverHttp()).isTrue();\n+    assertThat(jibCli.getVerbosity()).isEqualTo(\"info\");\n+    assertThat(jibCli.isStacktrace()).isTrue();\n+    assertThat(jibCli.isHttpTrace()).isTrue();\n+    assertThat(jibCli.isSerialize()).isTrue();\n+  }\n+\n+  @Test\n+  public void testParse_buildFileDefaultForContext() {\n+    JibCli jibCli =\n+        CommandLine.populateCommand(\n+            new JibCli(), \"--target\", \"test-image-ref\", \"--context\", \"test-context\");\n+\n+    assertThat(jibCli.getBuildFile()).isEqualTo(Paths.get(\"test-context/jib.yaml\"));\n+    assertThat(jibCli.getContextRoot()).isEqualTo(Paths.get(\"test-context\"));\n+  }\n+\n+  @Test\n+  public void testParse_usernamePassword() {\n+    JibCli jibCli =\n+        CommandLine.populateCommand(\n+            new JibCli(),\n+            \"--target\",\n+            \"test-image-ref\",\n+            \"--username\",\n+            \"test-username\",\n+            \"--password\",\n+            \"test-password\");\n+\n+    assertThat(jibCli.getUsernamePassword())\n+        .hasValue(Credential.from(\"test-username\", \"test-password\"));\n+    assertThat(jibCli.getToUsernamePassword()).isEmpty();\n+    assertThat(jibCli.getFromUsernamePassword()).isEmpty();\n+  }\n+\n+  @Test\n+  public void testParse_toUsernamePassword() {\n+    JibCli jibCli =\n+        CommandLine.populateCommand(\n+            new JibCli(),\n+            \"--target\",\n+            \"test-image-ref\",\n+            \"--to-username\",\n+            \"test-username\",\n+            \"--to-password\",\n+            \"test-password\");\n+\n+    assertThat(jibCli.getToUsernamePassword())\n+        .hasValue(Credential.from(\"test-username\", \"test-password\"));\n+    assertThat(jibCli.getFromUsernamePassword()).isEmpty();\n+    assertThat(jibCli.getUsernamePassword()).isEmpty();\n+  }\n+\n+  @Test\n+  public void testParse_fromUsernamePassword() {\n+    JibCli jibCli =\n+        CommandLine.populateCommand(\n+            new JibCli(),\n+            \"--target\",\n+            \"test-image-ref\",\n+            \"--from-username\",\n+            \"test-username\",\n+            \"--from-password\",\n+            \"test-password\");\n+\n+    assertThat(jibCli.getFromUsernamePassword())\n+        .hasValue(Credential.from(\"test-username\", \"test-password\"));\n+    assertThat(jibCli.getToUsernamePassword()).isEmpty();\n+    assertThat(jibCli.getUsernamePassword()).isEmpty();\n+  }\n+\n+  @Test\n+  public void testParse_toAndFromUsernamePassword() {\n+    JibCli jibCli =\n+        CommandLine.populateCommand(\n+            new JibCli(),\n+            \"--target\",\n+            \"test-image-ref\",\n+            \"--to-username\",\n+            \"test-username-1\",\n+            \"--to-password\",\n+            \"test-password-1\",\n+            \"--from-username\",\n+            \"test-username-2\",\n+            \"--from-password\",\n+            \"test-password-2\");\n+\n+    assertThat(jibCli.getToUsernamePassword())\n+        .hasValue(Credential.from(\"test-username-1\", \"test-password-1\"));\n+    assertThat(jibCli.getFromUsernamePassword())\n+        .hasValue(Credential.from(\"test-username-2\", \"test-password-2\"));\n+    assertThat(jibCli.getUsernamePassword()).isEmpty();\n+  }\n+\n+  @RunWith(Parameterized.class)\n+  public static class UsernamePasswordBothRequired {\n+    @Parameterized.Parameters(name = \"{0},{1}\")\n+    public static Collection<Object[]> data() {\n+      return Arrays.asList(\n+          new Object[][] {\n+            {\"--username\", \"--password\"},\n+            {\"--to-username\", \"--to-password\"},\n+            {\"--from-username\", \"--from-password\"}\n+          });\n+    }\n+\n+    @Parameterized.Parameter(0)\n+    public String usernameField;\n+\n+    @Parameterized.Parameter(1)\n+    public String passwordField;\n+\n+    @Test\n+    public void testParse_usernameWithoutPassword() {\n+      try {\n+        CommandLine.populateCommand(\n+            new JibCli(), \"--target\", \"test-image-ref\", usernameField, \"test-username\");\n+        fail();\n+      } catch (CommandLine.MissingParameterException mpe) {\n+        assertThat(mpe.getMessage())\n+            .isEqualTo(\"Error: Missing required argument(s): \" + passwordField);\n+      }\n+    }\n+\n+    @Test\n+    public void testParse_passwordWithoutUsername() {\n+      try {\n+        CommandLine.populateCommand(\n+            new JibCli(), \"--target\", \"test-image-ref\", passwordField, \"test-password\");\n+        fail();\n+      } catch (CommandLine.MissingParameterException mpe) {\n+        assertThat(mpe.getMessage())\n+            .isEqualTo(\"Error: Missing required argument(s): \" + usernameField + \"=<username>\");\n+      }\n+    }\n+  }\n+\n+  @RunWith(Parameterized.class)\n+  public static class UsernamePasswordNotAllowedWithToAndFrom {\n+    @Parameterized.Parameters(name = \"{0},{1}\")\n+    public static Collection<Object[]> data() {\n+      return Arrays.asList(\n+          new Object[][] {\n+            {\"--to-username\", \"--to-password\"},\n+            {\"--from-username\", \"--from-password\"}\n+          });\n+    }\n+\n+    @Parameterized.Parameter(0)\n+    public String usernameField;\n+\n+    @Parameterized.Parameter(1)\n+    public String passwordField;\n+\n+    @Test\n+    public void testParse_usernameWithoutPassword() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "97917975e106bea8886c770618c7943786cda533"}, "originalPosition": 306}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA2NzE5NzI2", "url": "https://github.com/GoogleContainerTools/jib/pull/2811#pullrequestreview-506719726", "createdAt": "2020-10-12T15:28:16Z", "commit": {"oid": "97917975e106bea8886c770618c7943786cda533"}, "state": "COMMENTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xMlQxNToyODoxNlrOHgDarQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xMlQxNTo0NDoxMFrOHgD_Ag==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzM3MjQ2MQ==", "bodyText": "description incorrect", "url": "https://github.com/GoogleContainerTools/jib/pull/2811#discussion_r503372461", "createdAt": "2020-10-12T15:28:16Z", "author": {"login": "chanseokoh"}, "path": "jib-cli/src/main/java/com/google/cloud/tools/jib/cli/cli2/JibCli.java", "diffHunk": "@@ -0,0 +1,357 @@\n+/*\n+ * Copyright 2020 Google LLC.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not\n+ * use this file except in compliance with the License. You may obtain a copy of\n+ * the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+ * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n+ * License for the specific language governing permissions and limitations under\n+ * the License.\n+ */\n+\n+package com.google.cloud.tools.jib.cli.cli2;\n+\n+import com.google.cloud.tools.jib.api.Credential;\n+import com.google.common.base.Verify;\n+import java.nio.file.Path;\n+import java.util.ArrayList;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Optional;\n+import picocli.CommandLine;\n+import picocli.CommandLine.ArgGroup;\n+import picocli.CommandLine.Option;\n+\n+@CommandLine.Command(\n+    name = \"jib\",\n+    versionProvider = VersionInfo.class,\n+    mixinStandardHelpOptions = true,\n+    showAtFileInUsageHelp = true,\n+    synopsisSubcommandLabel = \"COMMAND\",\n+    description = \"A tool for creating container images\")\n+public class JibCli {\n+  @Option(\n+      names = \"--verbosity\",\n+      paramLabel = \"<level>\",\n+      defaultValue = \"lifecycle\",\n+      description = \"set logging verbosity (error, warn, lifecycle (default), info, debug)\")\n+  @SuppressWarnings(\"NullAway.Init\") // initialized by picocli\n+  private String verbosity;\n+\n+  // Hidden debug parameters\n+  @Option(names = \"--stacktrace\", hidden = true)\n+  @SuppressWarnings(\"NullAway.Init\") // initialized by picocli\n+  private boolean stacktrace;\n+\n+  @Option(names = \"--http-trace\", hidden = true)\n+  @SuppressWarnings(\"NullAway.Init\") // initialized by picocli\n+  private boolean httpTrace;\n+\n+  @Option(names = \"--serialize\", hidden = true)\n+  @SuppressWarnings(\"NullAway.Init\") // initialized by picocli\n+  private boolean serialize;\n+\n+  // Build Configuration\n+  @Option(\n+      names = {\"-t\", \"--target\"},\n+      required = true,\n+      paramLabel = \"<target-image>\",\n+      description =\n+          \"The destination image reference or jib style url,%nexamples:%n gcr.io/project/image,%n registry://image-ref,%n docker://image,%n tar://path\")\n+  @SuppressWarnings(\"NullAway.Init\") // initialized by picocli\n+  private String targetImage;\n+\n+  @Option(\n+      names = {\"-c\", \"--context\"},\n+      defaultValue = \".\",\n+      paramLabel = \"<project-root>\",\n+      description = \"The context root directory of the build (ex: path/to/my/build/things)\")\n+  @SuppressWarnings(\"NullAway.Init\") // initialized by picocli\n+  private Path contextRoot;\n+\n+  @Option(\n+      names = {\"-b\", \"--build-file\"},\n+      paramLabel = \"<build-file>\",\n+      description = \"The path to the build file (ex: path/to/other-jib.yaml)\")\n+  @SuppressWarnings(\"NullAway.Init\") // initialized by picocli\n+  private Path buildFile;\n+\n+  // unfortunately we cannot verify for --target=tar://... this is required, we must do this after\n+  // pico cli is done parsing\n+  @Option(\n+      names = \"--name\",\n+      paramLabel = \"<image-reference>\",\n+      description =\n+          \"The image reference to inject into the tar configuration (required when using --target tar://...)\")\n+  @SuppressWarnings(\"NullAway.Init\") // initialized by picocli\n+  private String name;\n+\n+  @Option(\n+      names = {\"-p\", \"--parameter\"},\n+      paramLabel = \"<name>=<value>\",\n+      description =\n+          \"templating parameter to inject into build file, replace $${<name>} with <value> (repeatable)\")\n+  @SuppressWarnings(\"NullAway.Init\") // initialized by picocli\n+  private Map<String, String> templateParameters = new HashMap<String, String>();\n+\n+  @Option(\n+      names = \"--tags\",\n+      paramLabel = \"<tag>\",\n+      split = \",\",\n+      description = \"Additional tags for target image\")\n+  @SuppressWarnings(\"NullAway.Init\") // initialized by picocli\n+  private List<String> tags = new ArrayList<String>();\n+\n+  @Option(\n+      names = \"--base-image-cache\",\n+      paramLabel = \"<cache-directory>\",\n+      description = \"A path to a base image cache\")\n+  @SuppressWarnings(\"NullAway.Init\") // initialized by picocli\n+  private Path baseImageCache;\n+\n+  @Option(\n+      names = \"--application-cache\",\n+      paramLabel = \"<cache-directory>\",\n+      description = \"A path to an application cache\")\n+  @SuppressWarnings(\"NullAway.Init\") // initialized by picocli\n+  private Path applicationCache;\n+\n+  // Auth/Security\n+  @Option(\n+      names = \"--allow-insecure-registries\",\n+      description = \"Allow jib to communicate with registries over https\")\n+  @SuppressWarnings(\"NullAway.Init\") // initialized by picocli\n+  private boolean allowInsecureRegistries;\n+\n+  @Option(\n+      names = \"--send-credentials-over-http\",\n+      description = \"Allow jib to communicate with registries over https\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "97917975e106bea8886c770618c7943786cda533"}, "originalPosition": 134}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzM3NzU1NQ==", "bodyText": "How about calling this --additional-tags?\nI've seen many occasions people put latest into <tags> unnecessarily. And actually our code can cause confusion too, as we call this getTags() at the front (as the param name is <tags>) and later getAdditionalTags(). BuildContext also has getAllTargetImageTags() and setAdditionalTargetImageTags() to distinguish them.", "url": "https://github.com/GoogleContainerTools/jib/pull/2811#discussion_r503377555", "createdAt": "2020-10-12T15:36:48Z", "author": {"login": "chanseokoh"}, "path": "jib-cli/src/main/java/com/google/cloud/tools/jib/cli/cli2/JibCli.java", "diffHunk": "@@ -0,0 +1,357 @@\n+/*\n+ * Copyright 2020 Google LLC.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not\n+ * use this file except in compliance with the License. You may obtain a copy of\n+ * the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+ * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n+ * License for the specific language governing permissions and limitations under\n+ * the License.\n+ */\n+\n+package com.google.cloud.tools.jib.cli.cli2;\n+\n+import com.google.cloud.tools.jib.api.Credential;\n+import com.google.common.base.Verify;\n+import java.nio.file.Path;\n+import java.util.ArrayList;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Optional;\n+import picocli.CommandLine;\n+import picocli.CommandLine.ArgGroup;\n+import picocli.CommandLine.Option;\n+\n+@CommandLine.Command(\n+    name = \"jib\",\n+    versionProvider = VersionInfo.class,\n+    mixinStandardHelpOptions = true,\n+    showAtFileInUsageHelp = true,\n+    synopsisSubcommandLabel = \"COMMAND\",\n+    description = \"A tool for creating container images\")\n+public class JibCli {\n+  @Option(\n+      names = \"--verbosity\",\n+      paramLabel = \"<level>\",\n+      defaultValue = \"lifecycle\",\n+      description = \"set logging verbosity (error, warn, lifecycle (default), info, debug)\")\n+  @SuppressWarnings(\"NullAway.Init\") // initialized by picocli\n+  private String verbosity;\n+\n+  // Hidden debug parameters\n+  @Option(names = \"--stacktrace\", hidden = true)\n+  @SuppressWarnings(\"NullAway.Init\") // initialized by picocli\n+  private boolean stacktrace;\n+\n+  @Option(names = \"--http-trace\", hidden = true)\n+  @SuppressWarnings(\"NullAway.Init\") // initialized by picocli\n+  private boolean httpTrace;\n+\n+  @Option(names = \"--serialize\", hidden = true)\n+  @SuppressWarnings(\"NullAway.Init\") // initialized by picocli\n+  private boolean serialize;\n+\n+  // Build Configuration\n+  @Option(\n+      names = {\"-t\", \"--target\"},\n+      required = true,\n+      paramLabel = \"<target-image>\",\n+      description =\n+          \"The destination image reference or jib style url,%nexamples:%n gcr.io/project/image,%n registry://image-ref,%n docker://image,%n tar://path\")\n+  @SuppressWarnings(\"NullAway.Init\") // initialized by picocli\n+  private String targetImage;\n+\n+  @Option(\n+      names = {\"-c\", \"--context\"},\n+      defaultValue = \".\",\n+      paramLabel = \"<project-root>\",\n+      description = \"The context root directory of the build (ex: path/to/my/build/things)\")\n+  @SuppressWarnings(\"NullAway.Init\") // initialized by picocli\n+  private Path contextRoot;\n+\n+  @Option(\n+      names = {\"-b\", \"--build-file\"},\n+      paramLabel = \"<build-file>\",\n+      description = \"The path to the build file (ex: path/to/other-jib.yaml)\")\n+  @SuppressWarnings(\"NullAway.Init\") // initialized by picocli\n+  private Path buildFile;\n+\n+  // unfortunately we cannot verify for --target=tar://... this is required, we must do this after\n+  // pico cli is done parsing\n+  @Option(\n+      names = \"--name\",\n+      paramLabel = \"<image-reference>\",\n+      description =\n+          \"The image reference to inject into the tar configuration (required when using --target tar://...)\")\n+  @SuppressWarnings(\"NullAway.Init\") // initialized by picocli\n+  private String name;\n+\n+  @Option(\n+      names = {\"-p\", \"--parameter\"},\n+      paramLabel = \"<name>=<value>\",\n+      description =\n+          \"templating parameter to inject into build file, replace $${<name>} with <value> (repeatable)\")\n+  @SuppressWarnings(\"NullAway.Init\") // initialized by picocli\n+  private Map<String, String> templateParameters = new HashMap<String, String>();\n+\n+  @Option(\n+      names = \"--tags\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "97917975e106bea8886c770618c7943786cda533"}, "originalPosition": 104}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzM4MDI2Mg==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n               * @return a optional Credential\n          \n          \n            \n               * @return an optional Credential", "url": "https://github.com/GoogleContainerTools/jib/pull/2811#discussion_r503380262", "createdAt": "2020-10-12T15:41:30Z", "author": {"login": "chanseokoh"}, "path": "jib-cli/src/main/java/com/google/cloud/tools/jib/cli/cli2/JibCli.java", "diffHunk": "@@ -0,0 +1,357 @@\n+/*\n+ * Copyright 2020 Google LLC.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not\n+ * use this file except in compliance with the License. You may obtain a copy of\n+ * the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+ * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n+ * License for the specific language governing permissions and limitations under\n+ * the License.\n+ */\n+\n+package com.google.cloud.tools.jib.cli.cli2;\n+\n+import com.google.cloud.tools.jib.api.Credential;\n+import com.google.common.base.Verify;\n+import java.nio.file.Path;\n+import java.util.ArrayList;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Optional;\n+import picocli.CommandLine;\n+import picocli.CommandLine.ArgGroup;\n+import picocli.CommandLine.Option;\n+\n+@CommandLine.Command(\n+    name = \"jib\",\n+    versionProvider = VersionInfo.class,\n+    mixinStandardHelpOptions = true,\n+    showAtFileInUsageHelp = true,\n+    synopsisSubcommandLabel = \"COMMAND\",\n+    description = \"A tool for creating container images\")\n+public class JibCli {\n+  @Option(\n+      names = \"--verbosity\",\n+      paramLabel = \"<level>\",\n+      defaultValue = \"lifecycle\",\n+      description = \"set logging verbosity (error, warn, lifecycle (default), info, debug)\")\n+  @SuppressWarnings(\"NullAway.Init\") // initialized by picocli\n+  private String verbosity;\n+\n+  // Hidden debug parameters\n+  @Option(names = \"--stacktrace\", hidden = true)\n+  @SuppressWarnings(\"NullAway.Init\") // initialized by picocli\n+  private boolean stacktrace;\n+\n+  @Option(names = \"--http-trace\", hidden = true)\n+  @SuppressWarnings(\"NullAway.Init\") // initialized by picocli\n+  private boolean httpTrace;\n+\n+  @Option(names = \"--serialize\", hidden = true)\n+  @SuppressWarnings(\"NullAway.Init\") // initialized by picocli\n+  private boolean serialize;\n+\n+  // Build Configuration\n+  @Option(\n+      names = {\"-t\", \"--target\"},\n+      required = true,\n+      paramLabel = \"<target-image>\",\n+      description =\n+          \"The destination image reference or jib style url,%nexamples:%n gcr.io/project/image,%n registry://image-ref,%n docker://image,%n tar://path\")\n+  @SuppressWarnings(\"NullAway.Init\") // initialized by picocli\n+  private String targetImage;\n+\n+  @Option(\n+      names = {\"-c\", \"--context\"},\n+      defaultValue = \".\",\n+      paramLabel = \"<project-root>\",\n+      description = \"The context root directory of the build (ex: path/to/my/build/things)\")\n+  @SuppressWarnings(\"NullAway.Init\") // initialized by picocli\n+  private Path contextRoot;\n+\n+  @Option(\n+      names = {\"-b\", \"--build-file\"},\n+      paramLabel = \"<build-file>\",\n+      description = \"The path to the build file (ex: path/to/other-jib.yaml)\")\n+  @SuppressWarnings(\"NullAway.Init\") // initialized by picocli\n+  private Path buildFile;\n+\n+  // unfortunately we cannot verify for --target=tar://... this is required, we must do this after\n+  // pico cli is done parsing\n+  @Option(\n+      names = \"--name\",\n+      paramLabel = \"<image-reference>\",\n+      description =\n+          \"The image reference to inject into the tar configuration (required when using --target tar://...)\")\n+  @SuppressWarnings(\"NullAway.Init\") // initialized by picocli\n+  private String name;\n+\n+  @Option(\n+      names = {\"-p\", \"--parameter\"},\n+      paramLabel = \"<name>=<value>\",\n+      description =\n+          \"templating parameter to inject into build file, replace $${<name>} with <value> (repeatable)\")\n+  @SuppressWarnings(\"NullAway.Init\") // initialized by picocli\n+  private Map<String, String> templateParameters = new HashMap<String, String>();\n+\n+  @Option(\n+      names = \"--tags\",\n+      paramLabel = \"<tag>\",\n+      split = \",\",\n+      description = \"Additional tags for target image\")\n+  @SuppressWarnings(\"NullAway.Init\") // initialized by picocli\n+  private List<String> tags = new ArrayList<String>();\n+\n+  @Option(\n+      names = \"--base-image-cache\",\n+      paramLabel = \"<cache-directory>\",\n+      description = \"A path to a base image cache\")\n+  @SuppressWarnings(\"NullAway.Init\") // initialized by picocli\n+  private Path baseImageCache;\n+\n+  @Option(\n+      names = \"--application-cache\",\n+      paramLabel = \"<cache-directory>\",\n+      description = \"A path to an application cache\")\n+  @SuppressWarnings(\"NullAway.Init\") // initialized by picocli\n+  private Path applicationCache;\n+\n+  // Auth/Security\n+  @Option(\n+      names = \"--allow-insecure-registries\",\n+      description = \"Allow jib to communicate with registries over https\")\n+  @SuppressWarnings(\"NullAway.Init\") // initialized by picocli\n+  private boolean allowInsecureRegistries;\n+\n+  @Option(\n+      names = \"--send-credentials-over-http\",\n+      description = \"Allow jib to communicate with registries over https\")\n+  @SuppressWarnings(\"NullAway.Init\") // initialized by picocli\n+  private boolean sendCredentialsOverHttp;\n+\n+  @Option(\n+      names = {\"--credential-helper\"},\n+      paramLabel = \"<credential-helper>\",\n+      description =\n+          \"Add a credential helper, either a path to the helper, or a suffix for an executable named `docker-credential-<suffix>` (repeatable)\")\n+  private List<String> credentialHelpers = new ArrayList<>();\n+\n+  @ArgGroup(exclusive = true)\n+  @SuppressWarnings(\"NullAway.Init\") // initialized by picocli\n+  private UsernamePassword usernamePassword;\n+\n+  private static class UsernamePassword {\n+    @ArgGroup(exclusive = false)\n+    @SuppressWarnings(\"NullAway.Init\") // initialized by picocli\n+    SingleUsernamePassword single;\n+\n+    @ArgGroup(exclusive = false)\n+    @SuppressWarnings(\"NullAway.Init\") // initialized by picocli\n+    MultiUsernamePassword multi;\n+  }\n+\n+  private static class MultiUsernamePassword {\n+    @ArgGroup(exclusive = false)\n+    @SuppressWarnings(\"NullAway.Init\") // initialized by picocli\n+    ToUsernamePassword to;\n+\n+    @ArgGroup(exclusive = false)\n+    @SuppressWarnings(\"NullAway.Init\") // initialized by picocli\n+    FromUsernamePassword from;\n+  }\n+\n+  private static class SingleUsernamePassword {\n+    @Option(\n+        names = \"--username\",\n+        required = true,\n+        description = \"username for communicating with target/base image registry\")\n+    @SuppressWarnings(\"NullAway.Init\") // initialized by picocli\n+    String username;\n+\n+    @Option(\n+        names = \"--password\",\n+        arity = \"0..1\",\n+        required = true,\n+        interactive = true,\n+        description = \"password for communicating with target/base image registry\")\n+    @SuppressWarnings(\"NullAway.Init\") // initialized by picocli\n+    String password;\n+  }\n+\n+  private static class ToUsernamePassword {\n+    @Option(\n+        names = \"--to-username\",\n+        required = true,\n+        description = \"username for communicating with target image registry\")\n+    @SuppressWarnings(\"NullAway.Init\") // initialized by picocli\n+    String username;\n+\n+    @Option(\n+        names = \"--to-password\",\n+        arity = \"0..1\",\n+        interactive = true,\n+        required = true,\n+        description = \"password for communicating with target image registry\")\n+    @SuppressWarnings(\"NullAway.Init\") // initialized by picocli\n+    String password;\n+  }\n+\n+  private static class FromUsernamePassword {\n+    @Option(\n+        names = \"--from-username\",\n+        required = true,\n+        description = \"username for communicating with base image registry\")\n+    @SuppressWarnings(\"NullAway.Init\") // initialized by picocli\n+    String username;\n+\n+    @Option(\n+        names = \"--from-password\",\n+        arity = \"0..1\",\n+        required = true,\n+        interactive = true,\n+        description = \"password for communicating with base image registry\")\n+    @SuppressWarnings(\"NullAway.Init\") // initialized by picocli\n+    String password;\n+  }\n+\n+  public String getVerbosity() {\n+    Verify.verifyNotNull(verbosity);\n+    return verbosity;\n+  }\n+\n+  public boolean isStacktrace() {\n+    return stacktrace;\n+  }\n+\n+  public String getTargetImage() {\n+    return targetImage;\n+  }\n+\n+  public Path getContextRoot() {\n+    Verify.verifyNotNull(contextRoot);\n+    return contextRoot;\n+  }\n+\n+  /**\n+   * Returns a user configured Path to a buildfile and if none is configured returns jib.yaml in\n+   * {@link #getContextRoot()}.\n+   *\n+   * @return a path to a bulidfile\n+   */\n+  public Path getBuildFile() {\n+    if (buildFile == null) {\n+      return getContextRoot().resolve(\"jib.yaml\");\n+    }\n+    return buildFile;\n+  }\n+\n+  public Map<String, String> getTemplateParameters() {\n+    Verify.verifyNotNull(templateParameters);\n+    return templateParameters;\n+  }\n+\n+  public List<String> getTags() {\n+    Verify.verifyNotNull(tags);\n+    return tags;\n+  }\n+\n+  public Optional<Path> getBaseImageCache() {\n+    return Optional.ofNullable(baseImageCache);\n+  }\n+\n+  public Optional<Path> getApplicationCache() {\n+    return Optional.ofNullable(applicationCache);\n+  }\n+\n+  public boolean isAllowInsecureRegistries() {\n+    return allowInsecureRegistries;\n+  }\n+\n+  public boolean isSendCredentialsOverHttp() {\n+    return sendCredentialsOverHttp;\n+  }\n+\n+  public List<String> getCredentialHelpers() {\n+    return credentialHelpers;\n+  }\n+\n+  public boolean isHttpTrace() {\n+    return httpTrace;\n+  }\n+\n+  public boolean isSerialize() {\n+    return serialize;\n+  }\n+\n+  public String getName() {\n+    return name;\n+  }\n+\n+  /**\n+   * If configured, returns a {@link Credential} created from user configured username/password.\n+   *\n+   * @return a optional Credential", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "97917975e106bea8886c770618c7943786cda533"}, "originalPosition": 299}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzM4MTc2Mg==", "bodyText": "QQ: what is this?", "url": "https://github.com/GoogleContainerTools/jib/pull/2811#discussion_r503381762", "createdAt": "2020-10-12T15:44:10Z", "author": {"login": "chanseokoh"}, "path": "jib-cli/src/main/java/com/google/cloud/tools/jib/cli/cli2/JibCli.java", "diffHunk": "@@ -0,0 +1,357 @@\n+/*\n+ * Copyright 2020 Google LLC.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not\n+ * use this file except in compliance with the License. You may obtain a copy of\n+ * the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+ * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n+ * License for the specific language governing permissions and limitations under\n+ * the License.\n+ */\n+\n+package com.google.cloud.tools.jib.cli.cli2;\n+\n+import com.google.cloud.tools.jib.api.Credential;\n+import com.google.common.base.Verify;\n+import java.nio.file.Path;\n+import java.util.ArrayList;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Optional;\n+import picocli.CommandLine;\n+import picocli.CommandLine.ArgGroup;\n+import picocli.CommandLine.Option;\n+\n+@CommandLine.Command(\n+    name = \"jib\",\n+    versionProvider = VersionInfo.class,\n+    mixinStandardHelpOptions = true,\n+    showAtFileInUsageHelp = true,\n+    synopsisSubcommandLabel = \"COMMAND\",\n+    description = \"A tool for creating container images\")\n+public class JibCli {\n+  @Option(\n+      names = \"--verbosity\",\n+      paramLabel = \"<level>\",\n+      defaultValue = \"lifecycle\",\n+      description = \"set logging verbosity (error, warn, lifecycle (default), info, debug)\")\n+  @SuppressWarnings(\"NullAway.Init\") // initialized by picocli\n+  private String verbosity;\n+\n+  // Hidden debug parameters\n+  @Option(names = \"--stacktrace\", hidden = true)\n+  @SuppressWarnings(\"NullAway.Init\") // initialized by picocli\n+  private boolean stacktrace;\n+\n+  @Option(names = \"--http-trace\", hidden = true)\n+  @SuppressWarnings(\"NullAway.Init\") // initialized by picocli\n+  private boolean httpTrace;\n+\n+  @Option(names = \"--serialize\", hidden = true)\n+  @SuppressWarnings(\"NullAway.Init\") // initialized by picocli\n+  private boolean serialize;\n+\n+  // Build Configuration\n+  @Option(\n+      names = {\"-t\", \"--target\"},\n+      required = true,\n+      paramLabel = \"<target-image>\",\n+      description =\n+          \"The destination image reference or jib style url,%nexamples:%n gcr.io/project/image,%n registry://image-ref,%n docker://image,%n tar://path\")\n+  @SuppressWarnings(\"NullAway.Init\") // initialized by picocli\n+  private String targetImage;\n+\n+  @Option(\n+      names = {\"-c\", \"--context\"},\n+      defaultValue = \".\",\n+      paramLabel = \"<project-root>\",\n+      description = \"The context root directory of the build (ex: path/to/my/build/things)\")\n+  @SuppressWarnings(\"NullAway.Init\") // initialized by picocli\n+  private Path contextRoot;\n+\n+  @Option(\n+      names = {\"-b\", \"--build-file\"},\n+      paramLabel = \"<build-file>\",\n+      description = \"The path to the build file (ex: path/to/other-jib.yaml)\")\n+  @SuppressWarnings(\"NullAway.Init\") // initialized by picocli\n+  private Path buildFile;\n+\n+  // unfortunately we cannot verify for --target=tar://... this is required, we must do this after\n+  // pico cli is done parsing\n+  @Option(\n+      names = \"--name\",\n+      paramLabel = \"<image-reference>\",\n+      description =\n+          \"The image reference to inject into the tar configuration (required when using --target tar://...)\")\n+  @SuppressWarnings(\"NullAway.Init\") // initialized by picocli\n+  private String name;\n+\n+  @Option(\n+      names = {\"-p\", \"--parameter\"},\n+      paramLabel = \"<name>=<value>\",\n+      description =\n+          \"templating parameter to inject into build file, replace $${<name>} with <value> (repeatable)\")\n+  @SuppressWarnings(\"NullAway.Init\") // initialized by picocli\n+  private Map<String, String> templateParameters = new HashMap<String, String>();\n+\n+  @Option(\n+      names = \"--tags\",\n+      paramLabel = \"<tag>\",\n+      split = \",\",\n+      description = \"Additional tags for target image\")\n+  @SuppressWarnings(\"NullAway.Init\") // initialized by picocli\n+  private List<String> tags = new ArrayList<String>();\n+\n+  @Option(\n+      names = \"--base-image-cache\",\n+      paramLabel = \"<cache-directory>\",\n+      description = \"A path to a base image cache\")\n+  @SuppressWarnings(\"NullAway.Init\") // initialized by picocli\n+  private Path baseImageCache;\n+\n+  @Option(\n+      names = \"--application-cache\",\n+      paramLabel = \"<cache-directory>\",\n+      description = \"A path to an application cache\")\n+  @SuppressWarnings(\"NullAway.Init\") // initialized by picocli\n+  private Path applicationCache;\n+\n+  // Auth/Security\n+  @Option(\n+      names = \"--allow-insecure-registries\",\n+      description = \"Allow jib to communicate with registries over https\")\n+  @SuppressWarnings(\"NullAway.Init\") // initialized by picocli\n+  private boolean allowInsecureRegistries;\n+\n+  @Option(\n+      names = \"--send-credentials-over-http\",\n+      description = \"Allow jib to communicate with registries over https\")\n+  @SuppressWarnings(\"NullAway.Init\") // initialized by picocli\n+  private boolean sendCredentialsOverHttp;\n+\n+  @Option(\n+      names = {\"--credential-helper\"},\n+      paramLabel = \"<credential-helper>\",\n+      description =\n+          \"Add a credential helper, either a path to the helper, or a suffix for an executable named `docker-credential-<suffix>` (repeatable)\")\n+  private List<String> credentialHelpers = new ArrayList<>();\n+\n+  @ArgGroup(exclusive = true)\n+  @SuppressWarnings(\"NullAway.Init\") // initialized by picocli\n+  private UsernamePassword usernamePassword;\n+\n+  private static class UsernamePassword {\n+    @ArgGroup(exclusive = false)\n+    @SuppressWarnings(\"NullAway.Init\") // initialized by picocli\n+    SingleUsernamePassword single;\n+\n+    @ArgGroup(exclusive = false)\n+    @SuppressWarnings(\"NullAway.Init\") // initialized by picocli\n+    MultiUsernamePassword multi;\n+  }\n+\n+  private static class MultiUsernamePassword {\n+    @ArgGroup(exclusive = false)\n+    @SuppressWarnings(\"NullAway.Init\") // initialized by picocli\n+    ToUsernamePassword to;\n+\n+    @ArgGroup(exclusive = false)\n+    @SuppressWarnings(\"NullAway.Init\") // initialized by picocli\n+    FromUsernamePassword from;\n+  }\n+\n+  private static class SingleUsernamePassword {\n+    @Option(\n+        names = \"--username\",\n+        required = true,\n+        description = \"username for communicating with target/base image registry\")\n+    @SuppressWarnings(\"NullAway.Init\") // initialized by picocli\n+    String username;\n+\n+    @Option(\n+        names = \"--password\",\n+        arity = \"0..1\",\n+        required = true,\n+        interactive = true,\n+        description = \"password for communicating with target/base image registry\")\n+    @SuppressWarnings(\"NullAway.Init\") // initialized by picocli\n+    String password;\n+  }\n+\n+  private static class ToUsernamePassword {\n+    @Option(\n+        names = \"--to-username\",\n+        required = true,\n+        description = \"username for communicating with target image registry\")\n+    @SuppressWarnings(\"NullAway.Init\") // initialized by picocli\n+    String username;\n+\n+    @Option(\n+        names = \"--to-password\",\n+        arity = \"0..1\",\n+        interactive = true,\n+        required = true,\n+        description = \"password for communicating with target image registry\")\n+    @SuppressWarnings(\"NullAway.Init\") // initialized by picocli\n+    String password;\n+  }\n+\n+  private static class FromUsernamePassword {\n+    @Option(\n+        names = \"--from-username\",\n+        required = true,\n+        description = \"username for communicating with base image registry\")\n+    @SuppressWarnings(\"NullAway.Init\") // initialized by picocli\n+    String username;\n+\n+    @Option(\n+        names = \"--from-password\",\n+        arity = \"0..1\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "97917975e106bea8886c770618c7943786cda533"}, "originalPosition": 215}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c6389163851cb37783d208b71fe9649449495fd1", "author": {"user": {"login": "loosebazooka", "name": "Appu"}}, "url": "https://github.com/GoogleContainerTools/jib/commit/c6389163851cb37783d208b71fe9649449495fd1", "committedDate": "2020-10-12T21:04:03Z", "message": "Add (new) Jib Cli parameters in base command class."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "94d266692542a58642ef7cb7e8f536ad59bc8482", "author": {"user": {"login": "loosebazooka", "name": "Appu"}}, "url": "https://github.com/GoogleContainerTools/jib/commit/94d266692542a58642ef7cb7e8f536ad59bc8482", "committedDate": "2020-10-12T21:04:44Z", "message": "Change to getters, use optional"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d19f77900b5f6d9fe001e3ee2d278890365306f3", "author": {"user": {"login": "loosebazooka", "name": "Appu"}}, "url": "https://github.com/GoogleContainerTools/jib/commit/d19f77900b5f6d9fe001e3ee2d278890365306f3", "committedDate": "2020-10-12T21:04:45Z", "message": "descriptions, assertions, tag to additional-tags"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "21da556c53342bf56515173bf16f5ecef083c5e2", "author": {"user": {"login": "loosebazooka", "name": "Appu"}}, "url": "https://github.com/GoogleContainerTools/jib/commit/21da556c53342bf56515173bf16f5ecef083c5e2", "committedDate": "2020-10-12T20:56:22Z", "message": "Merge branch 'master' into new-cli-params"}, "afterCommit": {"oid": "d19f77900b5f6d9fe001e3ee2d278890365306f3", "author": {"user": {"login": "loosebazooka", "name": "Appu"}}, "url": "https://github.com/GoogleContainerTools/jib/commit/d19f77900b5f6d9fe001e3ee2d278890365306f3", "committedDate": "2020-10-12T21:04:45Z", "message": "descriptions, assertions, tag to additional-tags"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA3NzkwNzQx", "url": "https://github.com/GoogleContainerTools/jib/pull/2811#pullrequestreview-507790741", "createdAt": "2020-10-13T20:12:05Z", "commit": {"oid": "d19f77900b5f6d9fe001e3ee2d278890365306f3"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xM1QyMDoxMjowNVrOHg3kOQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xM1QyMDoxMjowNVrOHg3kOQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDIyNjg3Mw==", "bodyText": "Oh, it's nice that they have an interactive password option.", "url": "https://github.com/GoogleContainerTools/jib/pull/2811#discussion_r504226873", "createdAt": "2020-10-13T20:12:05Z", "author": {"login": "chanseokoh"}, "path": "jib-cli/src/main/java/com/google/cloud/tools/jib/cli/cli2/JibCli.java", "diffHunk": "@@ -0,0 +1,357 @@\n+/*\n+ * Copyright 2020 Google LLC.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not\n+ * use this file except in compliance with the License. You may obtain a copy of\n+ * the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+ * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n+ * License for the specific language governing permissions and limitations under\n+ * the License.\n+ */\n+\n+package com.google.cloud.tools.jib.cli.cli2;\n+\n+import com.google.cloud.tools.jib.api.Credential;\n+import com.google.common.base.Verify;\n+import java.nio.file.Path;\n+import java.util.ArrayList;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Optional;\n+import picocli.CommandLine;\n+import picocli.CommandLine.ArgGroup;\n+import picocli.CommandLine.Option;\n+\n+@CommandLine.Command(\n+    name = \"jib\",\n+    versionProvider = VersionInfo.class,\n+    mixinStandardHelpOptions = true,\n+    showAtFileInUsageHelp = true,\n+    synopsisSubcommandLabel = \"COMMAND\",\n+    description = \"A tool for creating container images\")\n+public class JibCli {\n+  @Option(\n+      names = \"--verbosity\",\n+      paramLabel = \"<level>\",\n+      defaultValue = \"lifecycle\",\n+      description = \"set logging verbosity (error, warn, lifecycle (default), info, debug)\")\n+  @SuppressWarnings(\"NullAway.Init\") // initialized by picocli\n+  private String verbosity;\n+\n+  // Hidden debug parameters\n+  @Option(names = \"--stacktrace\", hidden = true)\n+  @SuppressWarnings(\"NullAway.Init\") // initialized by picocli\n+  private boolean stacktrace;\n+\n+  @Option(names = \"--http-trace\", hidden = true)\n+  @SuppressWarnings(\"NullAway.Init\") // initialized by picocli\n+  private boolean httpTrace;\n+\n+  @Option(names = \"--serialize\", hidden = true)\n+  @SuppressWarnings(\"NullAway.Init\") // initialized by picocli\n+  private boolean serialize;\n+\n+  // Build Configuration\n+  @Option(\n+      names = {\"-t\", \"--target\"},\n+      required = true,\n+      paramLabel = \"<target-image>\",\n+      description =\n+          \"The destination image reference or jib style url,%nexamples:%n gcr.io/project/image,%n registry://image-ref,%n docker://image,%n tar://path\")\n+  @SuppressWarnings(\"NullAway.Init\") // initialized by picocli\n+  private String targetImage;\n+\n+  @Option(\n+      names = {\"-c\", \"--context\"},\n+      defaultValue = \".\",\n+      paramLabel = \"<project-root>\",\n+      description = \"The context root directory of the build (ex: path/to/my/build/things)\")\n+  @SuppressWarnings(\"NullAway.Init\") // initialized by picocli\n+  private Path contextRoot;\n+\n+  @Option(\n+      names = {\"-b\", \"--build-file\"},\n+      paramLabel = \"<build-file>\",\n+      description = \"The path to the build file (ex: path/to/other-jib.yaml)\")\n+  @SuppressWarnings(\"NullAway.Init\") // initialized by picocli\n+  private Path buildFile;\n+\n+  // unfortunately we cannot verify for --target=tar://... this is required, we must do this after\n+  // pico cli is done parsing\n+  @Option(\n+      names = \"--name\",\n+      paramLabel = \"<image-reference>\",\n+      description =\n+          \"The image reference to inject into the tar configuration (required when using --target tar://...)\")\n+  @SuppressWarnings(\"NullAway.Init\") // initialized by picocli\n+  private String name;\n+\n+  @Option(\n+      names = {\"-p\", \"--parameter\"},\n+      paramLabel = \"<name>=<value>\",\n+      description =\n+          \"templating parameter to inject into build file, replace $${<name>} with <value> (repeatable)\")\n+  @SuppressWarnings(\"NullAway.Init\") // initialized by picocli\n+  private Map<String, String> templateParameters = new HashMap<String, String>();\n+\n+  @Option(\n+      names = \"--tags\",\n+      paramLabel = \"<tag>\",\n+      split = \",\",\n+      description = \"Additional tags for target image\")\n+  @SuppressWarnings(\"NullAway.Init\") // initialized by picocli\n+  private List<String> tags = new ArrayList<String>();\n+\n+  @Option(\n+      names = \"--base-image-cache\",\n+      paramLabel = \"<cache-directory>\",\n+      description = \"A path to a base image cache\")\n+  @SuppressWarnings(\"NullAway.Init\") // initialized by picocli\n+  private Path baseImageCache;\n+\n+  @Option(\n+      names = \"--application-cache\",\n+      paramLabel = \"<cache-directory>\",\n+      description = \"A path to an application cache\")\n+  @SuppressWarnings(\"NullAway.Init\") // initialized by picocli\n+  private Path applicationCache;\n+\n+  // Auth/Security\n+  @Option(\n+      names = \"--allow-insecure-registries\",\n+      description = \"Allow jib to communicate with registries over https\")\n+  @SuppressWarnings(\"NullAway.Init\") // initialized by picocli\n+  private boolean allowInsecureRegistries;\n+\n+  @Option(\n+      names = \"--send-credentials-over-http\",\n+      description = \"Allow jib to communicate with registries over https\")\n+  @SuppressWarnings(\"NullAway.Init\") // initialized by picocli\n+  private boolean sendCredentialsOverHttp;\n+\n+  @Option(\n+      names = {\"--credential-helper\"},\n+      paramLabel = \"<credential-helper>\",\n+      description =\n+          \"Add a credential helper, either a path to the helper, or a suffix for an executable named `docker-credential-<suffix>` (repeatable)\")\n+  private List<String> credentialHelpers = new ArrayList<>();\n+\n+  @ArgGroup(exclusive = true)\n+  @SuppressWarnings(\"NullAway.Init\") // initialized by picocli\n+  private UsernamePassword usernamePassword;\n+\n+  private static class UsernamePassword {\n+    @ArgGroup(exclusive = false)\n+    @SuppressWarnings(\"NullAway.Init\") // initialized by picocli\n+    SingleUsernamePassword single;\n+\n+    @ArgGroup(exclusive = false)\n+    @SuppressWarnings(\"NullAway.Init\") // initialized by picocli\n+    MultiUsernamePassword multi;\n+  }\n+\n+  private static class MultiUsernamePassword {\n+    @ArgGroup(exclusive = false)\n+    @SuppressWarnings(\"NullAway.Init\") // initialized by picocli\n+    ToUsernamePassword to;\n+\n+    @ArgGroup(exclusive = false)\n+    @SuppressWarnings(\"NullAway.Init\") // initialized by picocli\n+    FromUsernamePassword from;\n+  }\n+\n+  private static class SingleUsernamePassword {\n+    @Option(\n+        names = \"--username\",\n+        required = true,\n+        description = \"username for communicating with target/base image registry\")\n+    @SuppressWarnings(\"NullAway.Init\") // initialized by picocli\n+    String username;\n+\n+    @Option(\n+        names = \"--password\",\n+        arity = \"0..1\",\n+        required = true,\n+        interactive = true,\n+        description = \"password for communicating with target/base image registry\")\n+    @SuppressWarnings(\"NullAway.Init\") // initialized by picocli\n+    String password;\n+  }\n+\n+  private static class ToUsernamePassword {\n+    @Option(\n+        names = \"--to-username\",\n+        required = true,\n+        description = \"username for communicating with target image registry\")\n+    @SuppressWarnings(\"NullAway.Init\") // initialized by picocli\n+    String username;\n+\n+    @Option(\n+        names = \"--to-password\",\n+        arity = \"0..1\",\n+        interactive = true,\n+        required = true,\n+        description = \"password for communicating with target image registry\")\n+    @SuppressWarnings(\"NullAway.Init\") // initialized by picocli\n+    String password;\n+  }\n+\n+  private static class FromUsernamePassword {\n+    @Option(\n+        names = \"--from-username\",\n+        required = true,\n+        description = \"username for communicating with base image registry\")\n+    @SuppressWarnings(\"NullAway.Init\") // initialized by picocli\n+    String username;\n+\n+    @Option(\n+        names = \"--from-password\",\n+        arity = \"0..1\",", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzM4MTc2Mg=="}, "originalCommit": {"oid": "97917975e106bea8886c770618c7943786cda533"}, "originalPosition": 215}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA3Nzk1ODc4", "url": "https://github.com/GoogleContainerTools/jib/pull/2811#pullrequestreview-507795878", "createdAt": "2020-10-13T20:16:15Z", "commit": {"oid": "d19f77900b5f6d9fe001e3ee2d278890365306f3"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4799, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}