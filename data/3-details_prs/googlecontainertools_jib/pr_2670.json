{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY0MjA4MDE5", "number": 2670, "title": "Update FAQ and plugin reference docs about selecting base image platform from a manifest list", "bodyText": "Should be merge only after releasing Jib 2.5.0.\nThe FAQ needs to be correct and helpful, as we show the link to the FAQ in our Jib error message if Jib was unable to find a matching platform. @louismurerwa", "createdAt": "2020-08-06T18:57:57Z", "url": "https://github.com/GoogleContainerTools/jib/pull/2670", "merged": true, "mergeCommit": {"oid": "2cf0cca23e2db5334dcf6285b68d7ddc48a8d850"}, "closed": true, "closedAt": "2020-08-07T20:02:32Z", "author": {"login": "chanseokoh"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc8UfeSgH2gAyNDY0MjA4MDE5OjUxMmMyMWUwZTIwMjQ3YTBmZmUxNjU2ZTgyOGFkZjFlMjMzNzUzZjI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc8p1fGAH2gAyNDY0MjA4MDE5OmMxMzkzNTZhZGM4NDhiOWVkNGJiODQzODhiZDIyNWIxOWE2ZjdjNTg=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "512c21e0e20247a0ffe1656e828adf1e233753f2", "author": {"user": {"login": "chanseokoh", "name": "Chanseok Oh"}}, "url": "https://github.com/GoogleContainerTools/jib/commit/512c21e0e20247a0ffe1656e828adf1e233753f2", "committedDate": "2020-08-06T18:54:01Z", "message": "Update FAQ about specifying a base image platform"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2277db302fe14ed5e9bcd03461156e2eff896d49", "author": {"user": {"login": "chanseokoh", "name": "Chanseok Oh"}}, "url": "https://github.com/GoogleContainerTools/jib/commit/2277db302fe14ed5e9bcd03461156e2eff896d49", "committedDate": "2020-08-06T18:55:05Z", "message": "Update doc"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYyNzk1Mzkw", "url": "https://github.com/GoogleContainerTools/jib/pull/2670#pullrequestreview-462795390", "createdAt": "2020-08-06T18:59:56Z", "commit": {"oid": "2277db302fe14ed5e9bcd03461156e2eff896d49"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQxODo1OTo1NlrOG9AZFg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQxODo1OTo1NlrOG9AZFg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjYyMjc0Mg==", "bodyText": "@louismurerwa what happens as of now if the user is currently specifying a manifest (as opposed to a manifest list) of a non-default platform with Jib 2.4.0 and upgrades to 2.5.0? Will it fail or just shows a warning?", "url": "https://github.com/GoogleContainerTools/jib/pull/2670#discussion_r466622742", "createdAt": "2020-08-06T18:59:56Z", "author": {"login": "chanseokoh"}, "path": "docs/faq.md", "diffHunk": "@@ -469,18 +469,46 @@ To inspect the image that is produced from the build using Docker, you can use c\n \n ### How do I specify a platform in the manifest list (or OCI index) of a base image?\n \n-By design, if the target image reference is a [manifest list](https://docs.docker.com/registry/spec/manifest-v2-2/#manifest-list), Jib will always select an image for the platform `amd64/linux`. If you need to specify a different image from a manifest list you must specify the digest for the platform you are targeting.\n+Jib 2.5.0 added an _incubating feature_ that provides limited support for selecting a base image with the desired platform from a manifest list. For example,\n \n-To view a manifest, [enable experimental docker CLI](https://docs.docker.com/engine/reference/commandline/cli/#experimental-features) features and then run the [manifest inspect](https://docs.docker.com/engine/reference/commandline/manifest_inspect/) command.\n+```xml\n+  <from>\n+    <image>... image reference to a manifest list ...</image>\n+    <platforms>\n+      <platform>\n+        <architecture>arm64</architecture>\n+        <os>linux</os>\n+      </platform>\n+    </platforms>\n+  </from>\n ```\n-$ docker manifest inspect openjdk:8\n+\n+```gradle\n+jib.from {\n+  image = '... image reference to a manifest list ...'\n+  platforms {\n+    platform {\n+      architecture = 'arm64'\n+      os = 'linux'\n+    }\n+  }\n+}\n ```\n \n-You can then inspect the output for the specific image you want (in this example an image for the platform `arm64/linux`)\n-```java\n+The default platform is \"amd64/linux\" if not specified, whose behavior is backward-compatible.\n+\n+As an incubating feature, there are certain limitations:\n+- OCI image indices are not supported (as opposed to Docker manifest lists).\n+- Supports specifying only one platform.\n+- Only `architecture` and `os` are supported. If there are multiple base images with given architecture and os, the first image will be selected.\n+\n+Make sure to specify a manifest _list_ in `<from><image>` (whether by a tag name or a digest (`@sha256:...`)). For troubleshooting, you may want to check what platforms a manifest list contains. To view a manifest, [enable experimental docker CLI](https://docs.docker.com/engine/reference/commandline/cli/#experimental-features) features and then run the [manifest inspect](https://docs.docker.com/engine/reference/commandline/manifest_inspect/) command.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2277db302fe14ed5e9bcd03461156e2eff896d49"}, "originalPosition": 42}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fdddf46321a0a23976c78de7daab560c159643dd", "author": {"user": {"login": "chanseokoh", "name": "Chanseok Oh"}}, "url": "https://github.com/GoogleContainerTools/jib/commit/fdddf46321a0a23976c78de7daab560c159643dd", "committedDate": "2020-08-06T19:56:03Z", "message": "Add jib.from.platforms reference doc"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ea1efabba558bf6341de6104dbf86733ecf7dae7", "author": {"user": {"login": "chanseokoh", "name": "Chanseok Oh"}}, "url": "https://github.com/GoogleContainerTools/jib/commit/ea1efabba558bf6341de6104dbf86733ecf7dae7", "committedDate": "2020-08-06T20:00:05Z", "message": "consistency"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYzNTY2OTIw", "url": "https://github.com/GoogleContainerTools/jib/pull/2670#pullrequestreview-463566920", "createdAt": "2020-08-07T19:39:19Z", "commit": {"oid": "ea1efabba558bf6341de6104dbf86733ecf7dae7"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wN1QxOTozOToxOVrOG9ltTg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wN1QxOTozOToxOVrOG9ltTg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzIzNDEyNg==", "bodyText": "Updating this line to ->\nOnly architecture and os are supported. If there are multiple base images with given architecture and os in the manifest list, the first image will be selected.", "url": "https://github.com/GoogleContainerTools/jib/pull/2670#discussion_r467234126", "createdAt": "2020-08-07T19:39:19Z", "author": {"login": "louismurerwa"}, "path": "docs/faq.md", "diffHunk": "@@ -469,18 +469,46 @@ To inspect the image that is produced from the build using Docker, you can use c\n \n ### How do I specify a platform in the manifest list (or OCI index) of a base image?\n \n-By design, if the target image reference is a [manifest list](https://docs.docker.com/registry/spec/manifest-v2-2/#manifest-list), Jib will always select an image for the platform `amd64/linux`. If you need to specify a different image from a manifest list you must specify the digest for the platform you are targeting.\n+Jib 2.5.0 added an _incubating feature_ that provides limited support for selecting a base image with the desired platform from a manifest list. For example,\n \n-To view a manifest, [enable experimental docker CLI](https://docs.docker.com/engine/reference/commandline/cli/#experimental-features) features and then run the [manifest inspect](https://docs.docker.com/engine/reference/commandline/manifest_inspect/) command.\n+```xml\n+  <from>\n+    <image>... image reference to a manifest list ...</image>\n+    <platforms>\n+      <platform>\n+        <architecture>arm64</architecture>\n+        <os>linux</os>\n+      </platform>\n+    </platforms>\n+  </from>\n ```\n-$ docker manifest inspect openjdk:8\n+\n+```gradle\n+jib.from {\n+  image = '... image reference to a manifest list ...'\n+  platforms {\n+    platform {\n+      architecture = 'arm64'\n+      os = 'linux'\n+    }\n+  }\n+}\n ```\n \n-You can then inspect the output for the specific image you want (in this example an image for the platform `arm64/linux`)\n-```java\n+The default platform is \"amd64/linux\" if not specified, whose behavior is backward-compatible.\n+\n+As an incubating feature, there are certain limitations:\n+- OCI image indices are not supported (as opposed to Docker manifest lists).\n+- Supports specifying only one platform.\n+- Only `architecture` and `os` are supported. If there are multiple base images with given architecture and os, the first image will be selected.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ea1efabba558bf6341de6104dbf86733ecf7dae7"}, "originalPosition": 40}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYzNTcwNDc5", "url": "https://github.com/GoogleContainerTools/jib/pull/2670#pullrequestreview-463570479", "createdAt": "2020-08-07T19:46:02Z", "commit": {"oid": "ea1efabba558bf6341de6104dbf86733ecf7dae7"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c139356adc848b9ed4bb84388bd225b19a6f7c58", "author": {"user": {"login": "chanseokoh", "name": "Chanseok Oh"}}, "url": "https://github.com/GoogleContainerTools/jib/commit/c139356adc848b9ed4bb84388bd225b19a6f7c58", "committedDate": "2020-08-07T19:46:04Z", "message": "\"If the base image manifest list contains multiple images with the given architecture and os, the first image will be selected.\""}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4940, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}