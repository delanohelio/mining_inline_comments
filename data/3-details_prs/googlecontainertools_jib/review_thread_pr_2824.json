{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTAzNjIzNjkw", "number": 2824, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNFQyMTozNTowMFrOEtq5gA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNFQyMjo1NDo0MFrOEts8PQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE2MzI0MjI0OnYy", "diffSide": "RIGHT", "path": "jib-core/src/main/java/com/google/cloud/tools/jib/registry/AbstractManifestPuller.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNFQyMTozNTowMFrOHhl35A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNFQyMTozNTowMFrOHhl35A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDk4NTU3Mg==", "bodyText": "Could we add a test for this exception?", "url": "https://github.com/GoogleContainerTools/jib/pull/2824#discussion_r504985572", "createdAt": "2020-10-14T21:35:00Z", "author": {"login": "mpeddada1"}, "path": "jib-core/src/main/java/com/google/cloud/tools/jib/registry/AbstractManifestPuller.java", "diffHunk": "@@ -145,15 +147,29 @@ private T getManifestTemplateFromJson(String jsonString)\n     }\n     if (schemaVersion == 2) {\n       // 'schemaVersion' of 2 can be either Docker V2.2 or OCI.\n-      String mediaType = node.get(\"mediaType\").asText();\n-      if (V22ManifestTemplate.MANIFEST_MEDIA_TYPE.equals(mediaType)) {\n-        return manifestTemplateClass.cast(\n-            JsonTemplateMapper.readJson(jsonString, V22ManifestTemplate.class));\n+      JsonNode mediaTypeNode = node.get(\"mediaType\");\n+      if (mediaTypeNode == null) { // not Docker, hence OCI\n+        if (node.get(\"manifests\") != null) {\n+          return manifestTemplateClass.cast(\n+              JsonTemplateMapper.readJson(jsonString, OciIndexTemplate.class));\n+        }\n+        if (node.get(\"config\") != null) {\n+          return manifestTemplateClass.cast(\n+              JsonTemplateMapper.readJson(jsonString, OciManifestTemplate.class));\n+        }\n+        throw new UnknownManifestFormatException(\n+            \"'schemaVersion' is 2, but neither 'manifests' nor 'config' exists\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "37cf8959b592ea8b33fd0a9c754e7f8bed6380da"}, "originalPosition": 35}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE2MzU3NjkzOnYy", "diffSide": "RIGHT", "path": "jib-core/src/main/java/com/google/cloud/tools/jib/registry/AbstractManifestPuller.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNFQyMjo1NDo0MFrOHhpWfg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNVQxNDo1NTo0MlrOHiMAnw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTA0MjU1OA==", "bodyText": "Do we even accept OciIndexTemplate?", "url": "https://github.com/GoogleContainerTools/jib/pull/2824#discussion_r505042558", "createdAt": "2020-10-14T22:54:40Z", "author": {"login": "loosebazooka"}, "path": "jib-core/src/main/java/com/google/cloud/tools/jib/registry/AbstractManifestPuller.java", "diffHunk": "@@ -145,15 +147,29 @@ private T getManifestTemplateFromJson(String jsonString)\n     }\n     if (schemaVersion == 2) {\n       // 'schemaVersion' of 2 can be either Docker V2.2 or OCI.\n-      String mediaType = node.get(\"mediaType\").asText();\n-      if (V22ManifestTemplate.MANIFEST_MEDIA_TYPE.equals(mediaType)) {\n-        return manifestTemplateClass.cast(\n-            JsonTemplateMapper.readJson(jsonString, V22ManifestTemplate.class));\n+      JsonNode mediaTypeNode = node.get(\"mediaType\");\n+      if (mediaTypeNode == null) { // not Docker, hence OCI\n+        if (node.get(\"manifests\") != null) {\n+          return manifestTemplateClass.cast(\n+              JsonTemplateMapper.readJson(jsonString, OciIndexTemplate.class));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2d8d3814a6c1b2ee64d0847e7c0f5dd5377bd2b4"}, "originalPosition": 28}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTYxMDM5OQ==", "bodyText": "Not yet ( getAccept() doesn't list OCI index). But I'm making this part future proof.", "url": "https://github.com/GoogleContainerTools/jib/pull/2824#discussion_r505610399", "createdAt": "2020-10-15T14:55:42Z", "author": {"login": "chanseokoh"}, "path": "jib-core/src/main/java/com/google/cloud/tools/jib/registry/AbstractManifestPuller.java", "diffHunk": "@@ -145,15 +147,29 @@ private T getManifestTemplateFromJson(String jsonString)\n     }\n     if (schemaVersion == 2) {\n       // 'schemaVersion' of 2 can be either Docker V2.2 or OCI.\n-      String mediaType = node.get(\"mediaType\").asText();\n-      if (V22ManifestTemplate.MANIFEST_MEDIA_TYPE.equals(mediaType)) {\n-        return manifestTemplateClass.cast(\n-            JsonTemplateMapper.readJson(jsonString, V22ManifestTemplate.class));\n+      JsonNode mediaTypeNode = node.get(\"mediaType\");\n+      if (mediaTypeNode == null) { // not Docker, hence OCI\n+        if (node.get(\"manifests\") != null) {\n+          return manifestTemplateClass.cast(\n+              JsonTemplateMapper.readJson(jsonString, OciIndexTemplate.class));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTA0MjU1OA=="}, "originalCommit": {"oid": "2d8d3814a6c1b2ee64d0847e7c0f5dd5377bd2b4"}, "originalPosition": 28}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4962, "cost": 1, "resetAt": "2021-11-12T20:28:25Z"}}}