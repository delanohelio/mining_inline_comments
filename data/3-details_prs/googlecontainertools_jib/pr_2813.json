{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTAwNzY4NDc4", "number": 2813, "title": "Implement explode mode for regular jar.", "bodyText": "This will be used to explode a jar and create three layers on the container for classes, resources and dependencies.\nPart of #2796", "createdAt": "2020-10-09T19:01:01Z", "url": "https://github.com/GoogleContainerTools/jib/pull/2813", "merged": true, "mergeCommit": {"oid": "d12437c05ab8b11ed7988b411db9f034a8a38968"}, "closed": true, "closedAt": "2020-10-19T15:52:39Z", "author": {"login": "mpeddada1"}, "timelineItems": {"totalCount": 48, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdQq3R6gH2gAyNTAwNzY4NDc4OjFkNDAwMTgyZWY4MDRiMzIzZGQxMTE3YmRmZTk3OTllYzQ2ZmRhNDA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdUFtUogH2gAyNTAwNzY4NDc4OjczMTIyODVlYWEyNTY0M2UwNTBjZTA2YTI2MGI0NjkwNWE0ZjcwNmM=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "1d400182ef804b323dd1117bdfe9799ec46fda40", "author": {"user": {"login": "mpeddada1", "name": "Mridula"}}, "url": "https://github.com/GoogleContainerTools/jib/commit/1d400182ef804b323dd1117bdfe9799ec46fda40", "committedDate": "2020-10-09T00:16:25Z", "message": "Implement explodedMode for regular jar"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dc70872f5e1c6f0e619777ffd3ef2aa0103e6487", "author": {"user": {"login": "mpeddada1", "name": "Mridula"}}, "url": "https://github.com/GoogleContainerTools/jib/commit/dc70872f5e1c6f0e619777ffd3ef2aa0103e6487", "committedDate": "2020-10-09T18:50:53Z", "message": "fix explodeMode to maintain original project structure"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ebf91a14fd8caf8a061bec98c5de922500c922fd", "author": {"user": {"login": "mpeddada1", "name": "Mridula"}}, "url": "https://github.com/GoogleContainerTools/jib/commit/ebf91a14fd8caf8a061bec98c5de922500c922fd", "committedDate": "2020-10-09T18:55:21Z", "message": "minor javadoc changes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9a4f4e36251fd4fb8306b5c2e21a6c7fec13cd05", "author": {"user": {"login": "mpeddada1", "name": "Mridula"}}, "url": "https://github.com/GoogleContainerTools/jib/commit/9a4f4e36251fd4fb8306b5c2e21a6c7fec13cd05", "committedDate": "2020-10-09T18:56:32Z", "message": "small comment change"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6e0b6dd862db2703518ee2c9d6e5ec669717e521", "author": {"user": {"login": "mpeddada1", "name": "Mridula"}}, "url": "https://github.com/GoogleContainerTools/jib/commit/6e0b6dd862db2703518ee2c9d6e5ec669717e521", "committedDate": "2020-10-09T18:58:26Z", "message": "change variable name"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "26b6478acc9dbda08db223c7337d4e32b14cf20e", "author": {"user": {"login": "mpeddada1", "name": "Mridula"}}, "url": "https://github.com/GoogleContainerTools/jib/commit/26b6478acc9dbda08db223c7337d4e32b14cf20e", "committedDate": "2020-10-09T20:09:16Z", "message": "fix tests"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA1OTYwNjYz", "url": "https://github.com/GoogleContainerTools/jib/pull/2813#pullrequestreview-505960663", "createdAt": "2020-10-09T20:10:18Z", "commit": {"oid": "6e0b6dd862db2703518ee2c9d6e5ec669717e521"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA1OTgwMTQz", "url": "https://github.com/GoogleContainerTools/jib/pull/2813#pullrequestreview-505980143", "createdAt": "2020-10-09T20:47:56Z", "commit": {"oid": "26b6478acc9dbda08db223c7337d4e32b14cf20e"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOVQyMDo0Nzo1NlrOHfYL7Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOVQyMDo1NDo1OVrOHfYWjw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjY2NDE3Mw==", "bodyText": "This should remain an instance variable (non-static), scoped and limited only to each individual instance. static means a global variable shared by every instance of JavaContainerBuilder.", "url": "https://github.com/GoogleContainerTools/jib/pull/2813#discussion_r502664173", "createdAt": "2020-10-09T20:47:56Z", "author": {"login": "chanseokoh"}, "path": "jib-core/src/main/java/com/google/cloud/tools/jib/api/JavaContainerBuilder.java", "diffHunk": "@@ -204,7 +204,7 @@ public static JavaContainerBuilder from(TarImage tarImage) {\n   private RelativeUnixPath dependenciesDestination = RelativeUnixPath.get(\"libs\");\n   private RelativeUnixPath othersDestination = RelativeUnixPath.get(\"classpath\");\n   @Nullable private String mainClass;\n-  private ModificationTimeProvider modificationTimeProvider =\n+  private static ModificationTimeProvider modificationTimeProvider =", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "26b6478acc9dbda08db223c7337d4e32b14cf20e"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjY2NTI2Mg==", "bodyText": "Should remain an instance method.\nAnd note JavaContainerBuilder is a public API. Probably we don't want to expose this internal helper method.\nJust asking: did we decide to use JavaContainerBuilder instead of JibContainerBuilder for some reason? It's fine if JavaContainerBuilder works, but just saying I believe it's a bit curated and limiting.", "url": "https://github.com/GoogleContainerTools/jib/pull/2813#discussion_r502665262", "createdAt": "2020-10-09T20:50:43Z", "author": {"login": "chanseokoh"}, "path": "jib-core/src/main/java/com/google/cloud/tools/jib/api/JavaContainerBuilder.java", "diffHunk": "@@ -691,7 +700,18 @@ private void addFileToLayer(\n     layerBuilders.get(layerType).addEntry(sourceFile, pathInContainer, modificationTime);\n   }\n \n-  private void addDirectoryContentsToLayer(\n+  /**\n+   * Adds the contents of a directory to a {@link FileEntriesLayer.Builder}.\n+   *\n+   * @param layerBuilders map that keeps track of all layers, with the key being the layer type and\n+   *     value being a {@link FileEntriesLayer.Builder}.\n+   * @param layerType the layer type.\n+   * @param sourceRoot path to root directory.\n+   * @param pathFilter predicate to filter the files by.\n+   * @param basePathInContainer base path in container.\n+   * @throws IOException if I/O error occurs when opening the directory.\n+   */\n+  public static void addDirectoryContentsToLayer(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "26b6478acc9dbda08db223c7337d4e32b14cf20e"}, "originalPosition": 43}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjY2Njg5NQ==", "bodyText": "Ditto.\nWe need to think twice before making this part of the public API surface.", "url": "https://github.com/GoogleContainerTools/jib/pull/2813#discussion_r502666895", "createdAt": "2020-10-09T20:54:59Z", "author": {"login": "chanseokoh"}, "path": "jib-core/src/main/java/com/google/cloud/tools/jib/api/JavaContainerBuilder.java", "diffHunk": "@@ -679,7 +679,16 @@ private JavaContainerBuilder addDirectory(\n     return this;\n   }\n \n-  private void addFileToLayer(\n+  /**\n+   * Adds a file to a {@link FileEntriesLayer.Builder}.\n+   *\n+   * @param layerBuilders map that keeps track of all layers, with the key being the layer type and\n+   *     value being a {@link FileEntriesLayer.Builder}.\n+   * @param layerType the layer type.\n+   * @param sourceFile the source file path.\n+   * @param pathInContainer path in container.\n+   */\n+  public static void addFileToLayer(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "26b6478acc9dbda08db223c7337d4e32b14cf20e"}, "originalPosition": 23}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "526b425f6440727a3240e7adf3f8eb0a6eab1a7a", "author": {"user": {"login": "mpeddada1", "name": "Mridula"}}, "url": "https://github.com/GoogleContainerTools/jib/commit/526b425f6440727a3240e7adf3f8eb0a6eab1a7a", "committedDate": "2020-10-12T15:18:16Z", "message": "revert previous change to tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5d78affc24d2005e86cb5a814a901705a26b128f", "author": {"user": {"login": "mpeddada1", "name": "Mridula"}}, "url": "https://github.com/GoogleContainerTools/jib/commit/5d78affc24d2005e86cb5a814a901705a26b128f", "committedDate": "2020-10-12T20:50:58Z", "message": "add helper to JarProcessor to filter out files and revert changes to JavaContainerBuilder"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "23468559fb5788cc90dbddc258d9a2bd067ef5f0", "author": {"user": {"login": "mpeddada1", "name": "Mridula"}}, "url": "https://github.com/GoogleContainerTools/jib/commit/23468559fb5788cc90dbddc258d9a2bd067ef5f0", "committedDate": "2020-10-12T20:54:01Z", "message": "fix comment"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c91beab0fd63c7d3b892d9d0f80b806adc46b3b3", "author": {"user": {"login": "mpeddada1", "name": "Mridula"}}, "url": "https://github.com/GoogleContainerTools/jib/commit/c91beab0fd63c7d3b892d9d0f80b806adc46b3b3", "committedDate": "2020-10-12T20:55:24Z", "message": "remove plugins-commons from build.gradle"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7bf52426136503a4d8d3ee78d89dd941047869ec", "author": {"user": {"login": "mpeddada1", "name": "Mridula"}}, "url": "https://github.com/GoogleContainerTools/jib/commit/7bf52426136503a4d8d3ee78d89dd941047869ec", "committedDate": "2020-10-12T22:02:02Z", "message": "fixes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7d71cef391d7938e266f965ea8eea4f1e0ac097d", "author": {"user": {"login": "mpeddada1", "name": "Mridula"}}, "url": "https://github.com/GoogleContainerTools/jib/commit/7d71cef391d7938e266f965ea8eea4f1e0ac097d", "committedDate": "2020-10-12T23:01:36Z", "message": "use Files.walk instead of DirectoryWalker"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "66a3a8971f8af614e8a801f3cf4c1649067d8bd9", "author": {"user": {"login": "mpeddada1", "name": "Mridula"}}, "url": "https://github.com/GoogleContainerTools/jib/commit/66a3a8971f8af614e8a801f3cf4c1649067d8bd9", "committedDate": "2020-10-12T23:35:08Z", "message": "sort by natural order"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4573240eac41dbff95c2ec9b3cba2c0f368c94a3", "author": {"user": {"login": "mpeddada1", "name": "Mridula"}}, "url": "https://github.com/GoogleContainerTools/jib/commit/4573240eac41dbff95c2ec9b3cba2c0f368c94a3", "committedDate": "2020-10-12T23:50:20Z", "message": "testing without sorting"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b63b03ebc914dab9c6ab03bd72b5ea28d5e5ab2d", "author": {"user": {"login": "mpeddada1", "name": "Mridula"}}, "url": "https://github.com/GoogleContainerTools/jib/commit/b63b03ebc914dab9c6ab03bd72b5ea28d5e5ab2d", "committedDate": "2020-10-13T02:36:54Z", "message": "assert on path.toString()"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1cd59871045df47e63f87520b7fd1c1c37906c6a", "author": {"user": {"login": "mpeddada1", "name": "Mridula"}}, "url": "https://github.com/GoogleContainerTools/jib/commit/1cd59871045df47e63f87520b7fd1c1c37906c6a", "committedDate": "2020-10-13T03:04:17Z", "message": "order file paths by string values and test on order"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "743b6294feb5e925ee1f5239d84f4463865a632d", "author": {"user": {"login": "mpeddada1", "name": "Mridula"}}, "url": "https://github.com/GoogleContainerTools/jib/commit/743b6294feb5e925ee1f5239d84f4463865a632d", "committedDate": "2020-10-13T03:19:06Z", "message": "clean up tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a93c515fd498cb4fdca3e3386148645fe9188cb1", "author": {"user": {"login": "mpeddada1", "name": "Mridula"}}, "url": "https://github.com/GoogleContainerTools/jib/commit/a93c515fd498cb4fdca3e3386148645fe9188cb1", "committedDate": "2020-10-13T03:20:08Z", "message": "formatting"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA3NjQyMzE4", "url": "https://github.com/GoogleContainerTools/jib/pull/2813#pullrequestreview-507642318", "createdAt": "2020-10-13T16:48:38Z", "commit": {"oid": "a93c515fd498cb4fdca3e3386148645fe9188cb1"}, "state": "COMMENTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xM1QxNjo0ODozOFrOHgwZLw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xM1QxNjo1Mzo1OFrOHgwlxQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDEwOTM1OQ==", "bodyText": "I think this should be configurable and if not then use a temporary directory.\nPotentially we could have a jib local build directory that we can pass in.", "url": "https://github.com/GoogleContainerTools/jib/pull/2813#discussion_r504109359", "createdAt": "2020-10-13T16:48:38Z", "author": {"login": "loosebazooka"}, "path": "jib-cli/src/main/java/com/google/cloud/tools/jib/cli/jar/JarProcessor.java", "diffHunk": "@@ -49,4 +66,88 @@ public static JarType determineJarType(Path jarPath) throws IOException {\n     }\n     return JarType.STANDARD;\n   }\n+\n+  /**\n+   * Explode jar and create three layers for classes, resources and dependencies on container.\n+   *\n+   * @param jarPath path to jar file.\n+   * @return list of {@link FileEntriesLayer}.\n+   * @throws IOException if I/O error occurs when opening the file.\n+   */\n+  public static List<FileEntriesLayer> explodeStandardJar(Path jarPath) throws IOException {\n+    TempDirectoryProvider tempDirectoryProvider = new TempDirectoryProvider();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a93c515fd498cb4fdca3e3386148645fe9188cb1"}, "originalPosition": 43}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDExMTY1Nw==", "bodyText": "\"Class-Path\" -> Attributes.Name.CLASS_PATH", "url": "https://github.com/GoogleContainerTools/jib/pull/2813#discussion_r504111657", "createdAt": "2020-10-13T16:52:19Z", "author": {"login": "loosebazooka"}, "path": "jib-cli/src/main/java/com/google/cloud/tools/jib/cli/jar/JarProcessor.java", "diffHunk": "@@ -49,4 +66,88 @@ public static JarType determineJarType(Path jarPath) throws IOException {\n     }\n     return JarType.STANDARD;\n   }\n+\n+  /**\n+   * Explode jar and create three layers for classes, resources and dependencies on container.\n+   *\n+   * @param jarPath path to jar file.\n+   * @return list of {@link FileEntriesLayer}.\n+   * @throws IOException if I/O error occurs when opening the file.\n+   */\n+  public static List<FileEntriesLayer> explodeStandardJar(Path jarPath) throws IOException {\n+    TempDirectoryProvider tempDirectoryProvider = new TempDirectoryProvider();\n+    Path tempDirectoryPath = tempDirectoryProvider.newDirectory();\n+    ZipUtil.unzip(jarPath, tempDirectoryPath);\n+\n+    List<FileEntriesLayer> layers = new ArrayList<>();\n+    Predicate<Path> isClassFile = path -> path.getFileName().toString().endsWith(\".class\");\n+    Predicate<Path> isResourceFile = path -> !path.getFileName().toString().endsWith(\".class\");\n+\n+    // Determine class and resource files in the directory containing jar contents and create\n+    // FileEntriesLayer for each type of layer (class or resource), while maintaining the\n+    // file's original project structure.\n+    FileEntriesLayer classesLayer =\n+        addDirectoryContentsToLayer(\n+                FileEntriesLayer.builder(),\n+                tempDirectoryPath,\n+                isClassFile,\n+                APP_ROOT.resolve(RelativeUnixPath.get(\"explodedJar\")))\n+            .setName(\"Classes\")\n+            .build();\n+    FileEntriesLayer resourcesLayer =\n+        addDirectoryContentsToLayer(\n+                FileEntriesLayer.builder(),\n+                tempDirectoryPath,\n+                isResourceFile,\n+                APP_ROOT.resolve(RelativeUnixPath.get(\"explodedJar\")))\n+            .setName(\"Resources\")\n+            .build();\n+\n+    // Get dependencies from Class-Path in the jar's manifest and create a FileEntriesLayer.Builder\n+    // with these dependencies as entries.\n+    List<Path> dependencies = new ArrayList<>();\n+    JarFile jarFile = new JarFile(jarPath.toFile());\n+    String classPath = jarFile.getManifest().getMainAttributes().getValue(\"Class-Path\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a93c515fd498cb4fdca3e3386148645fe9188cb1"}, "originalPosition": 75}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDExMjEzMQ==", "bodyText": "\" \" -> \"//s+\" for handling any kind of white space\nI might also do classPath.trim() ?", "url": "https://github.com/GoogleContainerTools/jib/pull/2813#discussion_r504112131", "createdAt": "2020-10-13T16:53:10Z", "author": {"login": "loosebazooka"}, "path": "jib-cli/src/main/java/com/google/cloud/tools/jib/cli/jar/JarProcessor.java", "diffHunk": "@@ -49,4 +66,88 @@ public static JarType determineJarType(Path jarPath) throws IOException {\n     }\n     return JarType.STANDARD;\n   }\n+\n+  /**\n+   * Explode jar and create three layers for classes, resources and dependencies on container.\n+   *\n+   * @param jarPath path to jar file.\n+   * @return list of {@link FileEntriesLayer}.\n+   * @throws IOException if I/O error occurs when opening the file.\n+   */\n+  public static List<FileEntriesLayer> explodeStandardJar(Path jarPath) throws IOException {\n+    TempDirectoryProvider tempDirectoryProvider = new TempDirectoryProvider();\n+    Path tempDirectoryPath = tempDirectoryProvider.newDirectory();\n+    ZipUtil.unzip(jarPath, tempDirectoryPath);\n+\n+    List<FileEntriesLayer> layers = new ArrayList<>();\n+    Predicate<Path> isClassFile = path -> path.getFileName().toString().endsWith(\".class\");\n+    Predicate<Path> isResourceFile = path -> !path.getFileName().toString().endsWith(\".class\");\n+\n+    // Determine class and resource files in the directory containing jar contents and create\n+    // FileEntriesLayer for each type of layer (class or resource), while maintaining the\n+    // file's original project structure.\n+    FileEntriesLayer classesLayer =\n+        addDirectoryContentsToLayer(\n+                FileEntriesLayer.builder(),\n+                tempDirectoryPath,\n+                isClassFile,\n+                APP_ROOT.resolve(RelativeUnixPath.get(\"explodedJar\")))\n+            .setName(\"Classes\")\n+            .build();\n+    FileEntriesLayer resourcesLayer =\n+        addDirectoryContentsToLayer(\n+                FileEntriesLayer.builder(),\n+                tempDirectoryPath,\n+                isResourceFile,\n+                APP_ROOT.resolve(RelativeUnixPath.get(\"explodedJar\")))\n+            .setName(\"Resources\")\n+            .build();\n+\n+    // Get dependencies from Class-Path in the jar's manifest and create a FileEntriesLayer.Builder\n+    // with these dependencies as entries.\n+    List<Path> dependencies = new ArrayList<>();\n+    JarFile jarFile = new JarFile(jarPath.toFile());\n+    String classPath = jarFile.getManifest().getMainAttributes().getValue(\"Class-Path\");\n+    if (classPath != null) {\n+      for (String dependency : Splitter.on(\" \").split(classPath)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a93c515fd498cb4fdca3e3386148645fe9188cb1"}, "originalPosition": 77}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDExMjU4MQ==", "bodyText": "Do we have to fail here? Would this code path also handle the shaded jar style jars (which may not have Class-Path entries)?", "url": "https://github.com/GoogleContainerTools/jib/pull/2813#discussion_r504112581", "createdAt": "2020-10-13T16:53:58Z", "author": {"login": "loosebazooka"}, "path": "jib-cli/src/main/java/com/google/cloud/tools/jib/cli/jar/JarProcessor.java", "diffHunk": "@@ -49,4 +66,88 @@ public static JarType determineJarType(Path jarPath) throws IOException {\n     }\n     return JarType.STANDARD;\n   }\n+\n+  /**\n+   * Explode jar and create three layers for classes, resources and dependencies on container.\n+   *\n+   * @param jarPath path to jar file.\n+   * @return list of {@link FileEntriesLayer}.\n+   * @throws IOException if I/O error occurs when opening the file.\n+   */\n+  public static List<FileEntriesLayer> explodeStandardJar(Path jarPath) throws IOException {\n+    TempDirectoryProvider tempDirectoryProvider = new TempDirectoryProvider();\n+    Path tempDirectoryPath = tempDirectoryProvider.newDirectory();\n+    ZipUtil.unzip(jarPath, tempDirectoryPath);\n+\n+    List<FileEntriesLayer> layers = new ArrayList<>();\n+    Predicate<Path> isClassFile = path -> path.getFileName().toString().endsWith(\".class\");\n+    Predicate<Path> isResourceFile = path -> !path.getFileName().toString().endsWith(\".class\");\n+\n+    // Determine class and resource files in the directory containing jar contents and create\n+    // FileEntriesLayer for each type of layer (class or resource), while maintaining the\n+    // file's original project structure.\n+    FileEntriesLayer classesLayer =\n+        addDirectoryContentsToLayer(\n+                FileEntriesLayer.builder(),\n+                tempDirectoryPath,\n+                isClassFile,\n+                APP_ROOT.resolve(RelativeUnixPath.get(\"explodedJar\")))\n+            .setName(\"Classes\")\n+            .build();\n+    FileEntriesLayer resourcesLayer =\n+        addDirectoryContentsToLayer(\n+                FileEntriesLayer.builder(),\n+                tempDirectoryPath,\n+                isResourceFile,\n+                APP_ROOT.resolve(RelativeUnixPath.get(\"explodedJar\")))\n+            .setName(\"Resources\")\n+            .build();\n+\n+    // Get dependencies from Class-Path in the jar's manifest and create a FileEntriesLayer.Builder\n+    // with these dependencies as entries.\n+    List<Path> dependencies = new ArrayList<>();\n+    JarFile jarFile = new JarFile(jarPath.toFile());\n+    String classPath = jarFile.getManifest().getMainAttributes().getValue(\"Class-Path\");\n+    if (classPath != null) {\n+      for (String dependency : Splitter.on(\" \").split(classPath)) {\n+        Path depPath = Paths.get(dependency);\n+        dependencies.add(depPath);\n+      }\n+    } else {\n+      throw new IllegalStateException(\"Class path is not specified.\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a93c515fd498cb4fdca3e3386148645fe9188cb1"}, "originalPosition": 82}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "228b09bab5e51d4372521e57558ad2ecce3e06b4", "author": {"user": {"login": "mpeddada1", "name": "Mridula"}}, "url": "https://github.com/GoogleContainerTools/jib/commit/228b09bab5e51d4372521e57558ad2ecce3e06b4", "committedDate": "2020-10-13T19:52:40Z", "message": "try with just sorted()"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0fb8d571fd7f4dd5d1bca72ef0c2479e96590415", "author": {"user": {"login": "mpeddada1", "name": "Mridula"}}, "url": "https://github.com/GoogleContainerTools/jib/commit/0fb8d571fd7f4dd5d1bca72ef0c2479e96590415", "committedDate": "2020-10-13T20:18:29Z", "message": "use DirectoryWalker and don't check ordering"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA3ODA4NjE0", "url": "https://github.com/GoogleContainerTools/jib/pull/2813#pullrequestreview-507808614", "createdAt": "2020-10-13T20:35:50Z", "commit": {"oid": "0fb8d571fd7f4dd5d1bca72ef0c2479e96590415"}, "state": "COMMENTED", "comments": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xM1QyMDozNTo1MFrOHg4ilA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xM1QyMToxMzo1MlrOHg5tvw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDI0MjgzNg==", "bodyText": "Also FYI: generally speaking, we should close Closeable classes like TempDirectoryProvider, e.g., using a try-resource block.", "url": "https://github.com/GoogleContainerTools/jib/pull/2813#discussion_r504242836", "createdAt": "2020-10-13T20:35:50Z", "author": {"login": "chanseokoh"}, "path": "jib-cli/src/main/java/com/google/cloud/tools/jib/cli/jar/JarProcessor.java", "diffHunk": "@@ -49,4 +66,88 @@ public static JarType determineJarType(Path jarPath) throws IOException {\n     }\n     return JarType.STANDARD;\n   }\n+\n+  /**\n+   * Explode jar and create three layers for classes, resources and dependencies on container.\n+   *\n+   * @param jarPath path to jar file.\n+   * @return list of {@link FileEntriesLayer}.\n+   * @throws IOException if I/O error occurs when opening the file.\n+   */\n+  public static List<FileEntriesLayer> explodeStandardJar(Path jarPath) throws IOException {\n+    TempDirectoryProvider tempDirectoryProvider = new TempDirectoryProvider();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDEwOTM1OQ=="}, "originalCommit": {"oid": "a93c515fd498cb4fdca3e3386148645fe9188cb1"}, "originalPosition": 43}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDI0MzYyNQ==", "bodyText": "Another option is ... isResrouceFile = isClassFile.negate(), which I think works better in this case.", "url": "https://github.com/GoogleContainerTools/jib/pull/2813#discussion_r504243625", "createdAt": "2020-10-13T20:37:19Z", "author": {"login": "chanseokoh"}, "path": "jib-cli/src/main/java/com/google/cloud/tools/jib/cli/jar/JarProcessor.java", "diffHunk": "@@ -49,4 +64,85 @@ public static JarType determineJarType(Path jarPath) throws IOException {\n     }\n     return JarType.STANDARD;\n   }\n+\n+  /**\n+   * Explode jar and create three layers for classes, resources and dependencies on container.\n+   *\n+   * @param jarPath path to jar file.\n+   * @return list of {@link FileEntriesLayer}.\n+   * @throws IOException if I/O error occurs when opening the file.\n+   */\n+  public static List<FileEntriesLayer> explodeStandardJar(Path jarPath) throws IOException {\n+    TempDirectoryProvider tempDirectoryProvider = new TempDirectoryProvider();\n+    Path tempDirectoryPath = tempDirectoryProvider.newDirectory();\n+    ZipUtil.unzip(jarPath, tempDirectoryPath);\n+\n+    List<FileEntriesLayer> layers = new ArrayList<>();\n+    Predicate<Path> isClassFile = path -> path.getFileName().toString().endsWith(\".class\");\n+    Predicate<Path> isResourceFile = path -> !path.getFileName().toString().endsWith(\".class\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0fb8d571fd7f4dd5d1bca72ef0c2479e96590415"}, "originalPosition": 47}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDI0NDk5NA==", "bodyText": "How about \"explodedJarRoot\" or \"localExplodedJarRoot\"? tempDirectoryPath gives the impression that it's a directory for a callee to use as a temp storage.", "url": "https://github.com/GoogleContainerTools/jib/pull/2813#discussion_r504244994", "createdAt": "2020-10-13T20:39:56Z", "author": {"login": "chanseokoh"}, "path": "jib-cli/src/main/java/com/google/cloud/tools/jib/cli/jar/JarProcessor.java", "diffHunk": "@@ -49,4 +64,85 @@ public static JarType determineJarType(Path jarPath) throws IOException {\n     }\n     return JarType.STANDARD;\n   }\n+\n+  /**\n+   * Explode jar and create three layers for classes, resources and dependencies on container.\n+   *\n+   * @param jarPath path to jar file.\n+   * @return list of {@link FileEntriesLayer}.\n+   * @throws IOException if I/O error occurs when opening the file.\n+   */\n+  public static List<FileEntriesLayer> explodeStandardJar(Path jarPath) throws IOException {\n+    TempDirectoryProvider tempDirectoryProvider = new TempDirectoryProvider();\n+    Path tempDirectoryPath = tempDirectoryProvider.newDirectory();\n+    ZipUtil.unzip(jarPath, tempDirectoryPath);\n+\n+    List<FileEntriesLayer> layers = new ArrayList<>();\n+    Predicate<Path> isClassFile = path -> path.getFileName().toString().endsWith(\".class\");\n+    Predicate<Path> isResourceFile = path -> !path.getFileName().toString().endsWith(\".class\");\n+\n+    // Determine class and resource files in the directory containing jar contents and create\n+    // FileEntriesLayer for each type of layer (class or resource), while maintaining the\n+    // file's original project structure.\n+    FileEntriesLayer classesLayer =\n+        addDirectoryContentsToLayer(\n+                FileEntriesLayer.builder(),\n+                tempDirectoryPath,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0fb8d571fd7f4dd5d1bca72ef0c2479e96590415"}, "originalPosition": 55}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDI1NjM4Mg==", "bodyText": "May be a good idea. For example, here, I see people saying like\n\ntwo spaces immediately following Class-Path:, a space at the end of [each] line, and one before each line, and finally an extra new-line at the end did the trick.\n\nalthough I'm not sure if the Java API handles all these whitespaces correctly. Worth checking anyway.", "url": "https://github.com/GoogleContainerTools/jib/pull/2813#discussion_r504256382", "createdAt": "2020-10-13T21:02:05Z", "author": {"login": "chanseokoh"}, "path": "jib-cli/src/main/java/com/google/cloud/tools/jib/cli/jar/JarProcessor.java", "diffHunk": "@@ -49,4 +66,88 @@ public static JarType determineJarType(Path jarPath) throws IOException {\n     }\n     return JarType.STANDARD;\n   }\n+\n+  /**\n+   * Explode jar and create three layers for classes, resources and dependencies on container.\n+   *\n+   * @param jarPath path to jar file.\n+   * @return list of {@link FileEntriesLayer}.\n+   * @throws IOException if I/O error occurs when opening the file.\n+   */\n+  public static List<FileEntriesLayer> explodeStandardJar(Path jarPath) throws IOException {\n+    TempDirectoryProvider tempDirectoryProvider = new TempDirectoryProvider();\n+    Path tempDirectoryPath = tempDirectoryProvider.newDirectory();\n+    ZipUtil.unzip(jarPath, tempDirectoryPath);\n+\n+    List<FileEntriesLayer> layers = new ArrayList<>();\n+    Predicate<Path> isClassFile = path -> path.getFileName().toString().endsWith(\".class\");\n+    Predicate<Path> isResourceFile = path -> !path.getFileName().toString().endsWith(\".class\");\n+\n+    // Determine class and resource files in the directory containing jar contents and create\n+    // FileEntriesLayer for each type of layer (class or resource), while maintaining the\n+    // file's original project structure.\n+    FileEntriesLayer classesLayer =\n+        addDirectoryContentsToLayer(\n+                FileEntriesLayer.builder(),\n+                tempDirectoryPath,\n+                isClassFile,\n+                APP_ROOT.resolve(RelativeUnixPath.get(\"explodedJar\")))\n+            .setName(\"Classes\")\n+            .build();\n+    FileEntriesLayer resourcesLayer =\n+        addDirectoryContentsToLayer(\n+                FileEntriesLayer.builder(),\n+                tempDirectoryPath,\n+                isResourceFile,\n+                APP_ROOT.resolve(RelativeUnixPath.get(\"explodedJar\")))\n+            .setName(\"Resources\")\n+            .build();\n+\n+    // Get dependencies from Class-Path in the jar's manifest and create a FileEntriesLayer.Builder\n+    // with these dependencies as entries.\n+    List<Path> dependencies = new ArrayList<>();\n+    JarFile jarFile = new JarFile(jarPath.toFile());\n+    String classPath = jarFile.getManifest().getMainAttributes().getValue(\"Class-Path\");\n+    if (classPath != null) {\n+      for (String dependency : Splitter.on(\" \").split(classPath)) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDExMjEzMQ=="}, "originalCommit": {"oid": "a93c515fd498cb4fdca3e3386148645fe9188cb1"}, "originalPosition": 77}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDI1NzQwMA==", "bodyText": "super nit:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    dependencies.add(depPath);\n          \n          \n            \n                    dependencies.add(Paths.get(dependency));\n          \n      \n    \n    \n  \n\nJust FYI, another way is\n.splitToList().stream().map(Paths::get).collect(Collectors.toList());", "url": "https://github.com/GoogleContainerTools/jib/pull/2813#discussion_r504257400", "createdAt": "2020-10-13T21:04:18Z", "author": {"login": "chanseokoh"}, "path": "jib-cli/src/main/java/com/google/cloud/tools/jib/cli/jar/JarProcessor.java", "diffHunk": "@@ -49,4 +64,85 @@ public static JarType determineJarType(Path jarPath) throws IOException {\n     }\n     return JarType.STANDARD;\n   }\n+\n+  /**\n+   * Explode jar and create three layers for classes, resources and dependencies on container.\n+   *\n+   * @param jarPath path to jar file.\n+   * @return list of {@link FileEntriesLayer}.\n+   * @throws IOException if I/O error occurs when opening the file.\n+   */\n+  public static List<FileEntriesLayer> explodeStandardJar(Path jarPath) throws IOException {\n+    TempDirectoryProvider tempDirectoryProvider = new TempDirectoryProvider();\n+    Path tempDirectoryPath = tempDirectoryProvider.newDirectory();\n+    ZipUtil.unzip(jarPath, tempDirectoryPath);\n+\n+    List<FileEntriesLayer> layers = new ArrayList<>();\n+    Predicate<Path> isClassFile = path -> path.getFileName().toString().endsWith(\".class\");\n+    Predicate<Path> isResourceFile = path -> !path.getFileName().toString().endsWith(\".class\");\n+\n+    // Determine class and resource files in the directory containing jar contents and create\n+    // FileEntriesLayer for each type of layer (class or resource), while maintaining the\n+    // file's original project structure.\n+    FileEntriesLayer classesLayer =\n+        addDirectoryContentsToLayer(\n+                FileEntriesLayer.builder(),\n+                tempDirectoryPath,\n+                isClassFile,\n+                APP_ROOT.resolve(RelativeUnixPath.get(\"explodedJar\")))\n+            .setName(\"Classes\")\n+            .build();\n+    FileEntriesLayer resourcesLayer =\n+        addDirectoryContentsToLayer(\n+                FileEntriesLayer.builder(),\n+                tempDirectoryPath,\n+                isResourceFile,\n+                APP_ROOT.resolve(RelativeUnixPath.get(\"explodedJar\")))\n+            .setName(\"Resources\")\n+            .build();\n+\n+    // Get dependencies from Class-Path in the jar's manifest and create a FileEntriesLayer.Builder\n+    // with these dependencies as entries.\n+    List<Path> dependencies = new ArrayList<>();\n+    JarFile jarFile = new JarFile(jarPath.toFile());\n+    String classPath = jarFile.getManifest().getMainAttributes().getValue(\"Class-Path\");\n+    if (classPath != null) {\n+      for (String dependency : Splitter.on(\" \").split(classPath)) {\n+        Path depPath = Paths.get(dependency);\n+        dependencies.add(depPath);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0fb8d571fd7f4dd5d1bca72ef0c2479e96590415"}, "originalPosition": 77}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDI2MDExNg==", "bodyText": "I believe we customarily put the most frequently changing layers at the bottom (needs to double-check). So perhaps\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                layers.add(classesLayer);\n          \n          \n            \n                layers.add(resourcesLayer);\n          \n          \n            \n                layers.add(dependenciesLayerBuilder.build());\n          \n          \n            \n                layers.add(dependenciesLayerBuilder.build());\n          \n          \n            \n                layers.add(resourcesLayer);\n          \n          \n            \n                layers.add(classesLayer);", "url": "https://github.com/GoogleContainerTools/jib/pull/2813#discussion_r504260116", "createdAt": "2020-10-13T21:09:53Z", "author": {"login": "chanseokoh"}, "path": "jib-cli/src/main/java/com/google/cloud/tools/jib/cli/jar/JarProcessor.java", "diffHunk": "@@ -49,4 +64,85 @@ public static JarType determineJarType(Path jarPath) throws IOException {\n     }\n     return JarType.STANDARD;\n   }\n+\n+  /**\n+   * Explode jar and create three layers for classes, resources and dependencies on container.\n+   *\n+   * @param jarPath path to jar file.\n+   * @return list of {@link FileEntriesLayer}.\n+   * @throws IOException if I/O error occurs when opening the file.\n+   */\n+  public static List<FileEntriesLayer> explodeStandardJar(Path jarPath) throws IOException {\n+    TempDirectoryProvider tempDirectoryProvider = new TempDirectoryProvider();\n+    Path tempDirectoryPath = tempDirectoryProvider.newDirectory();\n+    ZipUtil.unzip(jarPath, tempDirectoryPath);\n+\n+    List<FileEntriesLayer> layers = new ArrayList<>();\n+    Predicate<Path> isClassFile = path -> path.getFileName().toString().endsWith(\".class\");\n+    Predicate<Path> isResourceFile = path -> !path.getFileName().toString().endsWith(\".class\");\n+\n+    // Determine class and resource files in the directory containing jar contents and create\n+    // FileEntriesLayer for each type of layer (class or resource), while maintaining the\n+    // file's original project structure.\n+    FileEntriesLayer classesLayer =\n+        addDirectoryContentsToLayer(\n+                FileEntriesLayer.builder(),\n+                tempDirectoryPath,\n+                isClassFile,\n+                APP_ROOT.resolve(RelativeUnixPath.get(\"explodedJar\")))\n+            .setName(\"Classes\")\n+            .build();\n+    FileEntriesLayer resourcesLayer =\n+        addDirectoryContentsToLayer(\n+                FileEntriesLayer.builder(),\n+                tempDirectoryPath,\n+                isResourceFile,\n+                APP_ROOT.resolve(RelativeUnixPath.get(\"explodedJar\")))\n+            .setName(\"Resources\")\n+            .build();\n+\n+    // Get dependencies from Class-Path in the jar's manifest and create a FileEntriesLayer.Builder\n+    // with these dependencies as entries.\n+    List<Path> dependencies = new ArrayList<>();\n+    JarFile jarFile = new JarFile(jarPath.toFile());\n+    String classPath = jarFile.getManifest().getMainAttributes().getValue(\"Class-Path\");\n+    if (classPath != null) {\n+      for (String dependency : Splitter.on(\" \").split(classPath)) {\n+        Path depPath = Paths.get(dependency);\n+        dependencies.add(depPath);\n+      }\n+    } else {\n+      throw new IllegalStateException(\"Class path is not specified.\");\n+    }\n+    FileEntriesLayer.Builder dependenciesLayerBuilder = FileEntriesLayer.builder();\n+    dependencies.forEach(\n+        path ->\n+            dependenciesLayerBuilder.addEntry(\n+                path, APP_ROOT.resolve(RelativeUnixPath.get(\"dependencies\")).resolve(path)));\n+    dependenciesLayerBuilder.setName(\"Dependencies\");\n+\n+    layers.add(classesLayer);\n+    layers.add(resourcesLayer);\n+    layers.add(dependenciesLayerBuilder.build());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0fb8d571fd7f4dd5d1bca72ef0c2479e96590415"}, "originalPosition": 91}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDI2MDg1Mw==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              private static final String STANDARD_RESOURCE_DIR_WITH_CP = \"jar/standard/standardJarWithCp.jar\";\n          \n          \n            \n              private static final String STANDARD_JAR_WITH_CLASS_PATH_MANIFEST = \"jar/standard/standardJarWithCp.jar\";\n          \n      \n    \n    \n  \n\nAlso applies to other constants.", "url": "https://github.com/GoogleContainerTools/jib/pull/2813#discussion_r504260853", "createdAt": "2020-10-13T21:11:13Z", "author": {"login": "chanseokoh"}, "path": "jib-cli/src/test/java/com/google/cloud/tools/jib/cli/jar/JarProcessorTest.java", "diffHunk": "@@ -18,17 +18,24 @@\n \n import static com.google.common.truth.Truth.assertThat;\n \n+import com.google.cloud.tools.jib.api.buildplan.AbsoluteUnixPath;\n+import com.google.cloud.tools.jib.api.buildplan.FileEntriesLayer;\n+import com.google.cloud.tools.jib.api.buildplan.FileEntry;\n import com.google.cloud.tools.jib.cli.jar.JarProcessor.JarType;\n+import com.google.common.collect.ImmutableList;\n import com.google.common.io.Resources;\n import java.io.IOException;\n import java.net.URISyntaxException;\n import java.nio.file.Path;\n import java.nio.file.Paths;\n+import java.util.List;\n+import java.util.stream.Collectors;\n import org.junit.Test;\n \n public class JarProcessorTest {\n \n   private static final String SPRING_BOOT_RESOURCE_DIR = \"jar/springboot/springboot_sample.jar\";\n+  private static final String STANDARD_RESOURCE_DIR_WITH_CP = \"jar/standard/standardJarWithCp.jar\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0fb8d571fd7f4dd5d1bca72ef0c2479e96590415"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDI2MTU5Ng==", "bodyText": "Assert before attempting layers.get(2). Otherwise, for example, if the code base accidentally changes to produce only two layer, we'll hit an index-out-of-bound error when attempting .get(2).", "url": "https://github.com/GoogleContainerTools/jib/pull/2813#discussion_r504261596", "createdAt": "2020-10-13T21:12:53Z", "author": {"login": "chanseokoh"}, "path": "jib-cli/src/test/java/com/google/cloud/tools/jib/cli/jar/JarProcessorTest.java", "diffHunk": "@@ -44,4 +51,77 @@ public void testDetermineJarType_standard() throws IOException, URISyntaxExcepti\n     JarType jarType = JarProcessor.determineJarType(standardJar);\n     assertThat(jarType).isEqualTo(JarType.STANDARD);\n   }\n+\n+  @Test\n+  public void testExplodeMode_standard() throws IOException, URISyntaxException {\n+    Path standardJar = Paths.get(Resources.getResource(STANDARD_RESOURCE_DIR_WITH_CP).toURI());\n+    List<FileEntriesLayer> layers = JarProcessor.explodeStandardJar(standardJar);\n+    FileEntriesLayer classesLayer = layers.get(0);\n+    FileEntriesLayer resourcesLayer = layers.get(1);\n+    FileEntriesLayer dependenciesLayer = layers.get(2);\n+\n+    assertThat(layers.size()).isEqualTo(3);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0fb8d571fd7f4dd5d1bca72ef0c2479e96590415"}, "originalPosition": 38}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDI2MTkwNQ==", "bodyText": "I guess no need to assert the size when using .containsExactly?", "url": "https://github.com/GoogleContainerTools/jib/pull/2813#discussion_r504261905", "createdAt": "2020-10-13T21:13:31Z", "author": {"login": "chanseokoh"}, "path": "jib-cli/src/test/java/com/google/cloud/tools/jib/cli/jar/JarProcessorTest.java", "diffHunk": "@@ -44,4 +51,77 @@ public void testDetermineJarType_standard() throws IOException, URISyntaxExcepti\n     JarType jarType = JarProcessor.determineJarType(standardJar);\n     assertThat(jarType).isEqualTo(JarType.STANDARD);\n   }\n+\n+  @Test\n+  public void testExplodeMode_standard() throws IOException, URISyntaxException {\n+    Path standardJar = Paths.get(Resources.getResource(STANDARD_RESOURCE_DIR_WITH_CP).toURI());\n+    List<FileEntriesLayer> layers = JarProcessor.explodeStandardJar(standardJar);\n+    FileEntriesLayer classesLayer = layers.get(0);\n+    FileEntriesLayer resourcesLayer = layers.get(1);\n+    FileEntriesLayer dependenciesLayer = layers.get(2);\n+\n+    assertThat(layers.size()).isEqualTo(3);\n+\n+    // Validate classes layer.\n+    // TODO: Validate order of file paths once\n+    // https://github.com/GoogleContainerTools/jib/issues/2821 is fixed.\n+    assertThat(classesLayer.getEntries().size()).isEqualTo(10);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0fb8d571fd7f4dd5d1bca72ef0c2479e96590415"}, "originalPosition": 43}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDI2MjAwOQ==", "bodyText": "Ditto?", "url": "https://github.com/GoogleContainerTools/jib/pull/2813#discussion_r504262009", "createdAt": "2020-10-13T21:13:45Z", "author": {"login": "chanseokoh"}, "path": "jib-cli/src/test/java/com/google/cloud/tools/jib/cli/jar/JarProcessorTest.java", "diffHunk": "@@ -44,4 +51,77 @@ public void testDetermineJarType_standard() throws IOException, URISyntaxExcepti\n     JarType jarType = JarProcessor.determineJarType(standardJar);\n     assertThat(jarType).isEqualTo(JarType.STANDARD);\n   }\n+\n+  @Test\n+  public void testExplodeMode_standard() throws IOException, URISyntaxException {\n+    Path standardJar = Paths.get(Resources.getResource(STANDARD_RESOURCE_DIR_WITH_CP).toURI());\n+    List<FileEntriesLayer> layers = JarProcessor.explodeStandardJar(standardJar);\n+    FileEntriesLayer classesLayer = layers.get(0);\n+    FileEntriesLayer resourcesLayer = layers.get(1);\n+    FileEntriesLayer dependenciesLayer = layers.get(2);\n+\n+    assertThat(layers.size()).isEqualTo(3);\n+\n+    // Validate classes layer.\n+    // TODO: Validate order of file paths once\n+    // https://github.com/GoogleContainerTools/jib/issues/2821 is fixed.\n+    assertThat(classesLayer.getEntries().size()).isEqualTo(10);\n+    assertThat(classesLayer.getName()).isEqualTo(\"Classes\");\n+    List<AbsoluteUnixPath> actualClassesPaths =\n+        classesLayer\n+            .getEntries()\n+            .stream()\n+            .map(FileEntry::getExtractionPath)\n+            .collect(Collectors.toList());\n+    assertThat(actualClassesPaths)\n+        .containsExactly(\n+            AbsoluteUnixPath.get(\"/app/explodedJar/META-INF\"),\n+            AbsoluteUnixPath.get(\"/app/explodedJar/class5.class\"),\n+            AbsoluteUnixPath.get(\"/app/explodedJar/directory1\"),\n+            AbsoluteUnixPath.get(\"/app/explodedJar/directory1/class1.class\"),\n+            AbsoluteUnixPath.get(\"/app/explodedJar/directory1/class2.class\"),\n+            AbsoluteUnixPath.get(\"/app/explodedJar/directory2\"),\n+            AbsoluteUnixPath.get(\"/app/explodedJar/directory2/class4.class\"),\n+            AbsoluteUnixPath.get(\"/app/explodedJar/directory2/directory3\"),\n+            AbsoluteUnixPath.get(\"/app/explodedJar/directory2/directory3/class3.class\"),\n+            AbsoluteUnixPath.get(\"/app/explodedJar/directory4\"));\n+\n+    // Validate resources layer.\n+    // TODO: Validate order of file paths once\n+    // https://github.com/GoogleContainerTools/jib/issues/2821 is fixed.\n+    assertThat(resourcesLayer.getEntries().size()).isEqualTo(9);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0fb8d571fd7f4dd5d1bca72ef0c2479e96590415"}, "originalPosition": 67}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDI2MjA3OQ==", "bodyText": "Ditto?", "url": "https://github.com/GoogleContainerTools/jib/pull/2813#discussion_r504262079", "createdAt": "2020-10-13T21:13:52Z", "author": {"login": "chanseokoh"}, "path": "jib-cli/src/test/java/com/google/cloud/tools/jib/cli/jar/JarProcessorTest.java", "diffHunk": "@@ -44,4 +51,77 @@ public void testDetermineJarType_standard() throws IOException, URISyntaxExcepti\n     JarType jarType = JarProcessor.determineJarType(standardJar);\n     assertThat(jarType).isEqualTo(JarType.STANDARD);\n   }\n+\n+  @Test\n+  public void testExplodeMode_standard() throws IOException, URISyntaxException {\n+    Path standardJar = Paths.get(Resources.getResource(STANDARD_RESOURCE_DIR_WITH_CP).toURI());\n+    List<FileEntriesLayer> layers = JarProcessor.explodeStandardJar(standardJar);\n+    FileEntriesLayer classesLayer = layers.get(0);\n+    FileEntriesLayer resourcesLayer = layers.get(1);\n+    FileEntriesLayer dependenciesLayer = layers.get(2);\n+\n+    assertThat(layers.size()).isEqualTo(3);\n+\n+    // Validate classes layer.\n+    // TODO: Validate order of file paths once\n+    // https://github.com/GoogleContainerTools/jib/issues/2821 is fixed.\n+    assertThat(classesLayer.getEntries().size()).isEqualTo(10);\n+    assertThat(classesLayer.getName()).isEqualTo(\"Classes\");\n+    List<AbsoluteUnixPath> actualClassesPaths =\n+        classesLayer\n+            .getEntries()\n+            .stream()\n+            .map(FileEntry::getExtractionPath)\n+            .collect(Collectors.toList());\n+    assertThat(actualClassesPaths)\n+        .containsExactly(\n+            AbsoluteUnixPath.get(\"/app/explodedJar/META-INF\"),\n+            AbsoluteUnixPath.get(\"/app/explodedJar/class5.class\"),\n+            AbsoluteUnixPath.get(\"/app/explodedJar/directory1\"),\n+            AbsoluteUnixPath.get(\"/app/explodedJar/directory1/class1.class\"),\n+            AbsoluteUnixPath.get(\"/app/explodedJar/directory1/class2.class\"),\n+            AbsoluteUnixPath.get(\"/app/explodedJar/directory2\"),\n+            AbsoluteUnixPath.get(\"/app/explodedJar/directory2/class4.class\"),\n+            AbsoluteUnixPath.get(\"/app/explodedJar/directory2/directory3\"),\n+            AbsoluteUnixPath.get(\"/app/explodedJar/directory2/directory3/class3.class\"),\n+            AbsoluteUnixPath.get(\"/app/explodedJar/directory4\"));\n+\n+    // Validate resources layer.\n+    // TODO: Validate order of file paths once\n+    // https://github.com/GoogleContainerTools/jib/issues/2821 is fixed.\n+    assertThat(resourcesLayer.getEntries().size()).isEqualTo(9);\n+    assertThat(resourcesLayer.getName()).isEqualTo(\"Resources\");\n+    List<AbsoluteUnixPath> actualResourcesPaths =\n+        resourcesLayer\n+            .getEntries()\n+            .stream()\n+            .map(FileEntry::getExtractionPath)\n+            .collect(Collectors.toList());\n+    assertThat(actualResourcesPaths)\n+        .containsExactly(\n+            AbsoluteUnixPath.get(\"/app/explodedJar/META-INF/\"),\n+            AbsoluteUnixPath.get(\"/app/explodedJar/META-INF/MANIFEST.MF\"),\n+            AbsoluteUnixPath.get(\"/app/explodedJar/directory1\"),\n+            AbsoluteUnixPath.get(\"/app/explodedJar/directory1/resource1.txt\"),\n+            AbsoluteUnixPath.get(\"/app/explodedJar/directory2\"),\n+            AbsoluteUnixPath.get(\"/app/explodedJar/directory2/directory3\"),\n+            AbsoluteUnixPath.get(\"/app/explodedJar/directory2/directory3/resource2.sql\"),\n+            AbsoluteUnixPath.get(\"/app/explodedJar/directory4\"),\n+            AbsoluteUnixPath.get(\"/app/explodedJar/directory4/resource3.txt\"));\n+\n+    // Validate dependencies layer.\n+    assertThat(dependenciesLayer.getEntries().size()).isEqualTo(3);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0fb8d571fd7f4dd5d1bca72ef0c2479e96590415"}, "originalPosition": 88}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "72e7d8ea5e49280fb07df2dd15d8d51fe1ca65bf", "author": {"user": {"login": "mpeddada1", "name": "Mridula"}}, "url": "https://github.com/GoogleContainerTools/jib/commit/72e7d8ea5e49280fb07df2dd15d8d51fe1ca65bf", "committedDate": "2020-10-14T14:13:27Z", "message": "addressing comment suggestions. Code style fixes, custom temp directory path, add jar file with classpath being more spaced out"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA4NDI3NjQx", "url": "https://github.com/GoogleContainerTools/jib/pull/2813#pullrequestreview-508427641", "createdAt": "2020-10-14T14:46:43Z", "commit": {"oid": "72e7d8ea5e49280fb07df2dd15d8d51fe1ca65bf"}, "state": "COMMENTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNFQxNDo0Njo0M1rOHhW0JQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNFQxNDo1MzoxMFrOHhXIBg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDczODg1Mw==", "bodyText": "Once a Closeable class is closed, it's permanently shutdown and not usable. So you should put the entire code that needs to use localExplodedJarRoot into the try-resource block.", "url": "https://github.com/GoogleContainerTools/jib/pull/2813#discussion_r504738853", "createdAt": "2020-10-14T14:46:43Z", "author": {"login": "chanseokoh"}, "path": "jib-cli/src/main/java/com/google/cloud/tools/jib/cli/jar/JarProcessor.java", "diffHunk": "@@ -49,4 +67,97 @@ public static JarType determineJarType(Path jarPath) throws IOException {\n     }\n     return JarType.STANDARD;\n   }\n+\n+  /**\n+   * Explode jar and create three layers for classes, resources and dependencies on container.\n+   *\n+   * @param jarPath path to jar file.\n+   * @param tempDirPath path to temporary jib local directory to use.\n+   * @return list of {@link FileEntriesLayer}.\n+   * @throws IOException if I/O error occurs when opening the jar file or if the directory for the\n+   *     temporary directory path provided, doesn't exist.\n+   */\n+  public static List<FileEntriesLayer> explodeStandardJar(Path jarPath, @Nullable Path tempDirPath)\n+      throws IOException {\n+    Path localExplodedJarRoot;\n+    if (tempDirPath == null) {\n+      try (TempDirectoryProvider tempDirectoryProvider = new TempDirectoryProvider()) {\n+        localExplodedJarRoot = tempDirectoryProvider.newDirectory();\n+      }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "72e7d8ea5e49280fb07df2dd15d8d51fe1ca65bf"}, "originalPosition": 51}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDc0MDA2NQ==", "bodyText": "Minor point, but Jib build plugins use non-capitalized name \"classes\" (as defined in JavaContainerBuilder.LayerType).", "url": "https://github.com/GoogleContainerTools/jib/pull/2813#discussion_r504740065", "createdAt": "2020-10-14T14:48:20Z", "author": {"login": "chanseokoh"}, "path": "jib-cli/src/main/java/com/google/cloud/tools/jib/cli/jar/JarProcessor.java", "diffHunk": "@@ -49,4 +67,97 @@ public static JarType determineJarType(Path jarPath) throws IOException {\n     }\n     return JarType.STANDARD;\n   }\n+\n+  /**\n+   * Explode jar and create three layers for classes, resources and dependencies on container.\n+   *\n+   * @param jarPath path to jar file.\n+   * @param tempDirPath path to temporary jib local directory to use.\n+   * @return list of {@link FileEntriesLayer}.\n+   * @throws IOException if I/O error occurs when opening the jar file or if the directory for the\n+   *     temporary directory path provided, doesn't exist.\n+   */\n+  public static List<FileEntriesLayer> explodeStandardJar(Path jarPath, @Nullable Path tempDirPath)\n+      throws IOException {\n+    Path localExplodedJarRoot;\n+    if (tempDirPath == null) {\n+      try (TempDirectoryProvider tempDirectoryProvider = new TempDirectoryProvider()) {\n+        localExplodedJarRoot = tempDirectoryProvider.newDirectory();\n+      }\n+    } else {\n+      localExplodedJarRoot = tempDirPath;\n+    }\n+    ZipUtil.unzip(jarPath, localExplodedJarRoot);\n+\n+    List<FileEntriesLayer> layers = new ArrayList<>();\n+    Predicate<Path> isClassFile = path -> path.getFileName().toString().endsWith(\".class\");\n+    Predicate<Path> isResourceFile = isClassFile.negate();\n+\n+    // Determine class and resource files in the directory containing jar contents and create\n+    // FileEntriesLayer for each type of layer (class or resource), while maintaining the\n+    // file's original project structure.\n+    FileEntriesLayer classesLayer =\n+        addDirectoryContentsToLayer(\n+                FileEntriesLayer.builder(),\n+                localExplodedJarRoot,\n+                isClassFile,\n+                APP_ROOT.resolve(RelativeUnixPath.get(\"explodedJar\")))\n+            .setName(\"Classes\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "72e7d8ea5e49280fb07df2dd15d8d51fe1ca65bf"}, "originalPosition": 70}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDc0MDE0MA==", "bodyText": "ditto", "url": "https://github.com/GoogleContainerTools/jib/pull/2813#discussion_r504740140", "createdAt": "2020-10-14T14:48:26Z", "author": {"login": "chanseokoh"}, "path": "jib-cli/src/main/java/com/google/cloud/tools/jib/cli/jar/JarProcessor.java", "diffHunk": "@@ -49,4 +67,97 @@ public static JarType determineJarType(Path jarPath) throws IOException {\n     }\n     return JarType.STANDARD;\n   }\n+\n+  /**\n+   * Explode jar and create three layers for classes, resources and dependencies on container.\n+   *\n+   * @param jarPath path to jar file.\n+   * @param tempDirPath path to temporary jib local directory to use.\n+   * @return list of {@link FileEntriesLayer}.\n+   * @throws IOException if I/O error occurs when opening the jar file or if the directory for the\n+   *     temporary directory path provided, doesn't exist.\n+   */\n+  public static List<FileEntriesLayer> explodeStandardJar(Path jarPath, @Nullable Path tempDirPath)\n+      throws IOException {\n+    Path localExplodedJarRoot;\n+    if (tempDirPath == null) {\n+      try (TempDirectoryProvider tempDirectoryProvider = new TempDirectoryProvider()) {\n+        localExplodedJarRoot = tempDirectoryProvider.newDirectory();\n+      }\n+    } else {\n+      localExplodedJarRoot = tempDirPath;\n+    }\n+    ZipUtil.unzip(jarPath, localExplodedJarRoot);\n+\n+    List<FileEntriesLayer> layers = new ArrayList<>();\n+    Predicate<Path> isClassFile = path -> path.getFileName().toString().endsWith(\".class\");\n+    Predicate<Path> isResourceFile = isClassFile.negate();\n+\n+    // Determine class and resource files in the directory containing jar contents and create\n+    // FileEntriesLayer for each type of layer (class or resource), while maintaining the\n+    // file's original project structure.\n+    FileEntriesLayer classesLayer =\n+        addDirectoryContentsToLayer(\n+                FileEntriesLayer.builder(),\n+                localExplodedJarRoot,\n+                isClassFile,\n+                APP_ROOT.resolve(RelativeUnixPath.get(\"explodedJar\")))\n+            .setName(\"Classes\")\n+            .build();\n+    FileEntriesLayer resourcesLayer =\n+        addDirectoryContentsToLayer(\n+                FileEntriesLayer.builder(),\n+                localExplodedJarRoot,\n+                isResourceFile,\n+                APP_ROOT.resolve(RelativeUnixPath.get(\"explodedJar\")))\n+            .setName(\"Resources\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "72e7d8ea5e49280fb07df2dd15d8d51fe1ca65bf"}, "originalPosition": 78}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDc0Mzk0Mg==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              private static final String SPRING_BOOT_RESOURCE_DIR = \"jar/springboot/springboot_sample.jar\";\n          \n          \n            \n              private static final String STANDARD_JAR_WITH_CLASS_PATH_MANIFEST =\n          \n          \n            \n                  \"jar/standard/standardJarWithClassPath.jar\";\n          \n          \n            \n              private static final String STANDARD_RESOURCE_DIR = \"jar/standard/standardJar.jar\";\n          \n          \n            \n              private static final String SPRING_BOOT_JAR = \"jar/springboot/springboot_sample.jar\";\n          \n          \n            \n              private static final String STANDARD_JAR_WITH_CLASS_PATH_MANIFEST =\n          \n          \n            \n                  \"jar/standard/standardJarWithClassPath.jar\";\n          \n          \n            \n              private static final String STANDARD_JAR = \"jar/standard/standardJar.jar\";", "url": "https://github.com/GoogleContainerTools/jib/pull/2813#discussion_r504743942", "createdAt": "2020-10-14T14:53:10Z", "author": {"login": "chanseokoh"}, "path": "jib-cli/src/test/java/com/google/cloud/tools/jib/cli/jar/JarProcessorTest.java", "diffHunk": "@@ -18,17 +18,25 @@\n \n import static com.google.common.truth.Truth.assertThat;\n \n+import com.google.cloud.tools.jib.api.buildplan.AbsoluteUnixPath;\n+import com.google.cloud.tools.jib.api.buildplan.FileEntriesLayer;\n+import com.google.cloud.tools.jib.api.buildplan.FileEntry;\n import com.google.cloud.tools.jib.cli.jar.JarProcessor.JarType;\n+import com.google.common.collect.ImmutableList;\n import com.google.common.io.Resources;\n import java.io.IOException;\n import java.net.URISyntaxException;\n import java.nio.file.Path;\n import java.nio.file.Paths;\n+import java.util.List;\n+import java.util.stream.Collectors;\n import org.junit.Test;\n \n public class JarProcessorTest {\n \n   private static final String SPRING_BOOT_RESOURCE_DIR = \"jar/springboot/springboot_sample.jar\";\n+  private static final String STANDARD_JAR_WITH_CLASS_PATH_MANIFEST =\n+      \"jar/standard/standardJarWithClassPath.jar\";\n   private static final String STANDARD_RESOURCE_DIR = \"jar/standard/standardJar.jar\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "72e7d8ea5e49280fb07df2dd15d8d51fe1ca65bf"}, "originalPosition": 23}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8ffc0b2bf21e99f27431f2ccff7ccfda6c55b39a", "author": {"user": {"login": "mpeddada1", "name": "Mridula"}}, "url": "https://github.com/GoogleContainerTools/jib/commit/8ffc0b2bf21e99f27431f2ccff7ccfda6c55b39a", "committedDate": "2020-10-14T15:17:47Z", "message": "remove exception for when no class-path is present and add tests to check for empty dep layer"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA4NDc5OTQy", "url": "https://github.com/GoogleContainerTools/jib/pull/2813#pullrequestreview-508479942", "createdAt": "2020-10-14T15:38:10Z", "commit": {"oid": "8ffc0b2bf21e99f27431f2ccff7ccfda6c55b39a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNFQxNTozODoxMVrOHhZQug==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNFQxNTozODoxMVrOHhZQug==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDc3ODkzOA==", "bodyText": "You can remove this else branch if you initialize the variable on line 118 like List<Path> dependencies = new ArrayList<>();.\nHow about skipping adding the dependencies layer if it's empty? To be fair, it shouldn't matter, because I believe jib-core will drop any empty layers. But we can be conservative at this level too.", "url": "https://github.com/GoogleContainerTools/jib/pull/2813#discussion_r504778938", "createdAt": "2020-10-14T15:38:11Z", "author": {"login": "chanseokoh"}, "path": "jib-cli/src/main/java/com/google/cloud/tools/jib/cli/jar/JarProcessor.java", "diffHunk": "@@ -49,4 +67,97 @@ public static JarType determineJarType(Path jarPath) throws IOException {\n     }\n     return JarType.STANDARD;\n   }\n+\n+  /**\n+   * Explode jar and create three layers for classes, resources and dependencies on container.\n+   *\n+   * @param jarPath path to jar file.\n+   * @param tempDirPath path to temporary jib local directory to use.\n+   * @return list of {@link FileEntriesLayer}.\n+   * @throws IOException if I/O error occurs when opening the jar file or if the directory for the\n+   *     temporary directory path provided, doesn't exist.\n+   */\n+  public static List<FileEntriesLayer> explodeStandardJar(Path jarPath, @Nullable Path tempDirPath)\n+      throws IOException {\n+    Path localExplodedJarRoot;\n+    if (tempDirPath == null) {\n+      try (TempDirectoryProvider tempDirectoryProvider = new TempDirectoryProvider()) {\n+        localExplodedJarRoot = tempDirectoryProvider.newDirectory();\n+      }\n+    } else {\n+      localExplodedJarRoot = tempDirPath;\n+    }\n+    ZipUtil.unzip(jarPath, localExplodedJarRoot);\n+\n+    List<FileEntriesLayer> layers = new ArrayList<>();\n+    Predicate<Path> isClassFile = path -> path.getFileName().toString().endsWith(\".class\");\n+    Predicate<Path> isResourceFile = isClassFile.negate();\n+\n+    // Determine class and resource files in the directory containing jar contents and create\n+    // FileEntriesLayer for each type of layer (class or resource), while maintaining the\n+    // file's original project structure.\n+    FileEntriesLayer classesLayer =\n+        addDirectoryContentsToLayer(\n+                FileEntriesLayer.builder(),\n+                localExplodedJarRoot,\n+                isClassFile,\n+                APP_ROOT.resolve(RelativeUnixPath.get(\"explodedJar\")))\n+            .setName(\"Classes\")\n+            .build();\n+    FileEntriesLayer resourcesLayer =\n+        addDirectoryContentsToLayer(\n+                FileEntriesLayer.builder(),\n+                localExplodedJarRoot,\n+                isResourceFile,\n+                APP_ROOT.resolve(RelativeUnixPath.get(\"explodedJar\")))\n+            .setName(\"Resources\")\n+            .build();\n+\n+    // Get dependencies from Class-Path in the jar's manifest and create a FileEntriesLayer.Builder\n+    // with these dependencies as entries.\n+    List<Path> dependencies;\n+    JarFile jarFile = new JarFile(jarPath.toFile());\n+    String classPath =\n+        jarFile.getManifest().getMainAttributes().getValue(Attributes.Name.CLASS_PATH);\n+    if (classPath != null) {\n+      dependencies =\n+          Splitter.onPattern(\"\\\\s+\")\n+              .splitToList(classPath.trim())\n+              .stream()\n+              .map(Paths::get)\n+              .collect(Collectors.toList());\n+    } else {\n+      dependencies = new ArrayList<>();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8ffc0b2bf21e99f27431f2ccff7ccfda6c55b39a"}, "originalPosition": 95}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cf08ae3f4fad3abac160e2c71e48b482a361f54e", "author": {"user": {"login": "mpeddada1", "name": "Mridula"}}, "url": "https://github.com/GoogleContainerTools/jib/commit/cf08ae3f4fad3abac160e2c71e48b482a361f54e", "committedDate": "2020-10-14T17:29:31Z", "message": "modify variable names, fix try-resource block, don't add dep layer if class-pathnot provided"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a1982be77724b1762c1260688789b9d034c31102", "author": {"user": {"login": "mpeddada1", "name": "Mridula"}}, "url": "https://github.com/GoogleContainerTools/jib/commit/a1982be77724b1762c1260688789b9d034c31102", "committedDate": "2020-10-14T17:39:18Z", "message": "refactoring"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA4NTgzOTg0", "url": "https://github.com/GoogleContainerTools/jib/pull/2813#pullrequestreview-508583984", "createdAt": "2020-10-14T17:41:57Z", "commit": {"oid": "a1982be77724b1762c1260688789b9d034c31102"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNFQxNzo0MTo1N1rOHheGpw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNFQxNzo1NjozM1rOHhepGw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDg1ODI3OQ==", "bodyText": "I think an enum is unnecessary if this is only to define layer names. It looks okay to me to use the string literals in the code as before.", "url": "https://github.com/GoogleContainerTools/jib/pull/2813#discussion_r504858279", "createdAt": "2020-10-14T17:41:57Z", "author": {"login": "chanseokoh"}, "path": "jib-cli/src/main/java/com/google/cloud/tools/jib/cli/jar/JarProcessor.java", "diffHunk": "@@ -35,6 +54,29 @@\n     SPRING_BOOT;\n   }\n \n+  /** Represents the different types of layers. */\n+  @VisibleForTesting\n+  public enum ExplodedModeLayerType {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a1982be77724b1762c1260688789b9d034c31102"}, "originalPosition": 38}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDg2NjQzMg==", "bodyText": "Oh! I realized there's a problem. When TempDirectoryProvider is closed, all the contents (i.e., exploded jar) will be cleaned up. That is, nothing left when exiting the method. However, tar creating happens far later in jib-core. I guess this method should just use tempDirPath (should not be @Nullable), unless the method opts to use a system temp directory. Since the method can accept tempDirPath, maybe we should just use it.\nAnd how about tempDirPath --> tempDirectory?", "url": "https://github.com/GoogleContainerTools/jib/pull/2813#discussion_r504866432", "createdAt": "2020-10-14T17:55:24Z", "author": {"login": "chanseokoh"}, "path": "jib-cli/src/main/java/com/google/cloud/tools/jib/cli/jar/JarProcessor.java", "diffHunk": "@@ -49,4 +91,92 @@ public static JarType determineJarType(Path jarPath) throws IOException {\n     }\n     return JarType.STANDARD;\n   }\n+\n+  /**\n+   * Explode jar and create three layers for classes, resources and dependencies on container.\n+   *\n+   * @param jarPath path to jar file.\n+   * @param tempDirPath path to temporary jib local directory to use.\n+   * @return list of {@link FileEntriesLayer}.\n+   * @throws IOException if I/O error occurs when opening the jar file or if the directory for the\n+   *     temporary directory path provided doesn't exist.\n+   */\n+  public static List<FileEntriesLayer> explodeStandardJar(Path jarPath, @Nullable Path tempDirPath)\n+      throws IOException {\n+    Path localExplodedJarRoot = tempDirPath;\n+    try (TempDirectoryProvider tempDirectoryProvider = new TempDirectoryProvider()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a1982be77724b1762c1260688789b9d034c31102"}, "originalPosition": 79}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDg2NzA5OQ==", "bodyText": "Nit: can chain ...builder().setName(\"dependencies\").", "url": "https://github.com/GoogleContainerTools/jib/pull/2813#discussion_r504867099", "createdAt": "2020-10-14T17:56:33Z", "author": {"login": "chanseokoh"}, "path": "jib-cli/src/main/java/com/google/cloud/tools/jib/cli/jar/JarProcessor.java", "diffHunk": "@@ -49,4 +91,92 @@ public static JarType determineJarType(Path jarPath) throws IOException {\n     }\n     return JarType.STANDARD;\n   }\n+\n+  /**\n+   * Explode jar and create three layers for classes, resources and dependencies on container.\n+   *\n+   * @param jarPath path to jar file.\n+   * @param tempDirPath path to temporary jib local directory to use.\n+   * @return list of {@link FileEntriesLayer}.\n+   * @throws IOException if I/O error occurs when opening the jar file or if the directory for the\n+   *     temporary directory path provided doesn't exist.\n+   */\n+  public static List<FileEntriesLayer> explodeStandardJar(Path jarPath, @Nullable Path tempDirPath)\n+      throws IOException {\n+    Path localExplodedJarRoot = tempDirPath;\n+    try (TempDirectoryProvider tempDirectoryProvider = new TempDirectoryProvider()) {\n+      if (localExplodedJarRoot == null) {\n+        localExplodedJarRoot = tempDirectoryProvider.newDirectory();\n+      }\n+      ZipUtil.unzip(jarPath, localExplodedJarRoot);\n+\n+      List<FileEntriesLayer> layers = new ArrayList<>();\n+      Predicate<Path> isClassFile = path -> path.getFileName().toString().endsWith(\".class\");\n+      Predicate<Path> isResourceFile = isClassFile.negate();\n+\n+      // Determine class and resource files in the directory containing jar contents and create\n+      // FileEntriesLayer for each type of layer (class or resource), while maintaining the\n+      // file's original project structure.\n+      FileEntriesLayer classesLayer =\n+          addDirectoryContentsToLayer(\n+                  FileEntriesLayer.builder(),\n+                  localExplodedJarRoot,\n+                  isClassFile,\n+                  APP_ROOT.resolve(RelativeUnixPath.get(\"explodedJar\")))\n+              .setName(ExplodedModeLayerType.CLASSES.getName())\n+              .build();\n+      FileEntriesLayer resourcesLayer =\n+          addDirectoryContentsToLayer(\n+                  FileEntriesLayer.builder(),\n+                  localExplodedJarRoot,\n+                  isResourceFile,\n+                  APP_ROOT.resolve(RelativeUnixPath.get(\"explodedJar\")))\n+              .setName(ExplodedModeLayerType.RESOURCES.getName())\n+              .build();\n+\n+      // Get dependencies from Class-Path in the jar's manifest and create a\n+      // FileEntriesLayer.Builder with these dependencies as entries. If Class-Path in the jar's\n+      // manifest is not present then skip adding a dependencies layer.\n+      JarFile jarFile = new JarFile(jarPath.toFile());\n+      String classPath =\n+          jarFile.getManifest().getMainAttributes().getValue(Attributes.Name.CLASS_PATH);\n+      if (classPath != null) {\n+        List<Path> dependencies =\n+            Splitter.onPattern(\"\\\\s+\")\n+                .splitToList(classPath.trim())\n+                .stream()\n+                .map(Paths::get)\n+                .collect(Collectors.toList());\n+        FileEntriesLayer.Builder dependenciesLayerBuilder = FileEntriesLayer.builder();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a1982be77724b1762c1260688789b9d034c31102"}, "originalPosition": 122}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b9cbf0963da6b09eac263444c59d0e603aed295e", "author": {"user": {"login": "mpeddada1", "name": "Mridula"}}, "url": "https://github.com/GoogleContainerTools/jib/commit/b9cbf0963da6b09eac263444c59d0e603aed295e", "committedDate": "2020-10-14T21:02:37Z", "message": "use provided directory in explodeStandardJar"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bde748299f75ee27f87905093bc26a6b8e845faf", "author": {"user": {"login": "mpeddada1", "name": "Mridula"}}, "url": "https://github.com/GoogleContainerTools/jib/commit/bde748299f75ee27f87905093bc26a6b8e845faf", "committedDate": "2020-10-14T22:51:46Z", "message": "empty commit to trigger builds"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA4ODAxODA0", "url": "https://github.com/GoogleContainerTools/jib/pull/2813#pullrequestreview-508801804", "createdAt": "2020-10-14T22:03:03Z", "commit": {"oid": "b9cbf0963da6b09eac263444c59d0e603aed295e"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNFQyMjowMzowNFrOHhnAmA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNFQyMjowNDo0MlrOHhnFcw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTAwNDE4NA==", "bodyText": "what about a jar that contains no resources?", "url": "https://github.com/GoogleContainerTools/jib/pull/2813#discussion_r505004184", "createdAt": "2020-10-14T22:03:04Z", "author": {"login": "loosebazooka"}, "path": "jib-cli/src/main/java/com/google/cloud/tools/jib/cli/jar/JarProcessor.java", "diffHunk": "@@ -49,4 +65,88 @@ public static JarType determineJarType(Path jarPath) throws IOException {\n     }\n     return JarType.STANDARD;\n   }\n+\n+  /**\n+   * Explode jar and create three layers for classes, resources and dependencies on container.\n+   *\n+   * @param jarPath path to jar file.\n+   * @param tempDirPath path to temporary jib local directory to use.\n+   * @return list of {@link FileEntriesLayer}.\n+   * @throws IOException if I/O error occurs when opening the jar file or if the directory for the\n+   *     temporary directory path provided doesn't exist.\n+   */\n+  public static List<FileEntriesLayer> explodeStandardJar(Path jarPath, Path tempDirPath)\n+      throws IOException {\n+    Path localExplodedJarRoot = tempDirPath;\n+\n+    ZipUtil.unzip(jarPath, localExplodedJarRoot);\n+\n+    List<FileEntriesLayer> layers = new ArrayList<>();\n+    Predicate<Path> isClassFile = path -> path.getFileName().toString().endsWith(\".class\");\n+    Predicate<Path> isResourceFile = isClassFile.negate();\n+\n+    // Determine class and resource files in the directory containing jar contents and create\n+    // FileEntriesLayer for each type of layer (class or resource), while maintaining the\n+    // file's original project structure.\n+    FileEntriesLayer classesLayer =\n+        addDirectoryContentsToLayer(\n+                FileEntriesLayer.builder(),\n+                localExplodedJarRoot,\n+                isClassFile,\n+                APP_ROOT.resolve(RelativeUnixPath.get(\"explodedJar\")))\n+            .setName(\"classes\")\n+            .build();\n+    FileEntriesLayer resourcesLayer =", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b9cbf0963da6b09eac263444c59d0e603aed295e"}, "originalPosition": 64}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTAwNTQyNw==", "bodyText": "Perhaps I should've brought this up before, I'm also curious if we should persist the MANIFEST.MF after exploding the jar. That manifest only applies when using a Jar. Does it make sense to filter it out when building container layers?", "url": "https://github.com/GoogleContainerTools/jib/pull/2813#discussion_r505005427", "createdAt": "2020-10-14T22:04:42Z", "author": {"login": "loosebazooka"}, "path": "jib-cli/src/main/java/com/google/cloud/tools/jib/cli/jar/JarProcessor.java", "diffHunk": "@@ -49,4 +65,88 @@ public static JarType determineJarType(Path jarPath) throws IOException {\n     }\n     return JarType.STANDARD;\n   }\n+\n+  /**\n+   * Explode jar and create three layers for classes, resources and dependencies on container.\n+   *\n+   * @param jarPath path to jar file.\n+   * @param tempDirPath path to temporary jib local directory to use.\n+   * @return list of {@link FileEntriesLayer}.\n+   * @throws IOException if I/O error occurs when opening the jar file or if the directory for the\n+   *     temporary directory path provided doesn't exist.\n+   */\n+  public static List<FileEntriesLayer> explodeStandardJar(Path jarPath, Path tempDirPath)\n+      throws IOException {\n+    Path localExplodedJarRoot = tempDirPath;\n+\n+    ZipUtil.unzip(jarPath, localExplodedJarRoot);\n+\n+    List<FileEntriesLayer> layers = new ArrayList<>();\n+    Predicate<Path> isClassFile = path -> path.getFileName().toString().endsWith(\".class\");\n+    Predicate<Path> isResourceFile = isClassFile.negate();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b9cbf0963da6b09eac263444c59d0e603aed295e"}, "originalPosition": 51}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA5NjkxOTIz", "url": "https://github.com/GoogleContainerTools/jib/pull/2813#pullrequestreview-509691923", "createdAt": "2020-10-15T19:15:18Z", "commit": {"oid": "bde748299f75ee27f87905093bc26a6b8e845faf"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNVQxOToxNToxOFrOHiWZ4g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNVQxOToxNToxOFrOHiWZ4g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTc4MDcwNg==", "bodyText": "Any reason not using @Rule public final TemporaryFolder as we do in other tests?", "url": "https://github.com/GoogleContainerTools/jib/pull/2813#discussion_r505780706", "createdAt": "2020-10-15T19:15:18Z", "author": {"login": "chanseokoh"}, "path": "jib-cli/src/test/java/com/google/cloud/tools/jib/cli/jar/JarProcessorTest.java", "diffHunk": "@@ -18,30 +18,181 @@\n \n import static com.google.common.truth.Truth.assertThat;\n \n+import com.google.cloud.tools.jib.api.buildplan.AbsoluteUnixPath;\n+import com.google.cloud.tools.jib.api.buildplan.FileEntriesLayer;\n+import com.google.cloud.tools.jib.api.buildplan.FileEntry;\n import com.google.cloud.tools.jib.cli.jar.JarProcessor.JarType;\n+import com.google.common.collect.ImmutableList;\n+import com.google.common.io.Files;\n import com.google.common.io.Resources;\n+import java.io.File;\n import java.io.IOException;\n import java.net.URISyntaxException;\n import java.nio.file.Path;\n import java.nio.file.Paths;\n+import java.util.List;\n+import java.util.stream.Collectors;\n import org.junit.Test;\n \n public class JarProcessorTest {\n \n-  private static final String SPRING_BOOT_RESOURCE_DIR = \"jar/springboot/springboot_sample.jar\";\n-  private static final String STANDARD_RESOURCE_DIR = \"jar/standard/standardJar.jar\";\n+  private static final String SPRING_BOOT_JAR = \"jar/springboot/springboot_sample.jar\";\n+  private static final String STANDARD_JAR_WITH_CLASS_PATH_MANIFEST =\n+      \"jar/standard/standardJarWithClassPath.jar\";\n+  private static final String STANDARD_JAR_WITHOUT_CLASS_PATH_MANIFEST =\n+      \"jar/standard/standardJarWithoutClassPath.jar\";\n+  private static final String STANDARD_JAR = \"jar/standard/standardJar.jar\";\n \n   @Test\n   public void testDetermineJarType_springBoot() throws IOException, URISyntaxException {\n-    Path springBootJar = Paths.get(Resources.getResource(SPRING_BOOT_RESOURCE_DIR).toURI());\n+    Path springBootJar = Paths.get(Resources.getResource(SPRING_BOOT_JAR).toURI());\n     JarType jarType = JarProcessor.determineJarType(springBootJar);\n     assertThat(jarType).isEqualTo(JarType.SPRING_BOOT);\n   }\n \n   @Test\n   public void testDetermineJarType_standard() throws IOException, URISyntaxException {\n-    Path standardJar = Paths.get(Resources.getResource(STANDARD_RESOURCE_DIR).toURI());\n+    Path standardJar = Paths.get(Resources.getResource(STANDARD_JAR).toURI());\n     JarType jarType = JarProcessor.determineJarType(standardJar);\n     assertThat(jarType).isEqualTo(JarType.STANDARD);\n   }\n+\n+  @Test\n+  public void testExplodeMode_standard_withClassPathInManifest()\n+      throws IOException, URISyntaxException {\n+    Path standardJar =\n+        Paths.get(Resources.getResource(STANDARD_JAR_WITH_CLASS_PATH_MANIFEST).toURI());\n+    File tempDirectory = Files.createTempDir();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bde748299f75ee27f87905093bc26a6b8e845faf"}, "originalPosition": 52}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1120f058707c739fa3ae6b52f568223cfd6b4614", "author": {"user": {"login": "mpeddada1", "name": "Mridula"}}, "url": "https://github.com/GoogleContainerTools/jib/commit/1120f058707c739fa3ae6b52f568223cfd6b4614", "committedDate": "2020-10-16T17:04:50Z", "message": "Use TemporaryFolder and add test for jar with only .class files"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "636726a3d6e829d34c9267ec3558180e56cbce7d", "author": {"user": {"login": "mpeddada1", "name": "Mridula"}}, "url": "https://github.com/GoogleContainerTools/jib/commit/636726a3d6e829d34c9267ec3558180e56cbce7d", "committedDate": "2020-10-16T18:05:54Z", "message": "add test for empty jar"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "33e1f3a10a809c1d4a92935ee9d4455bb26391bc", "author": {"user": {"login": "mpeddada1", "name": "Mridula"}}, "url": "https://github.com/GoogleContainerTools/jib/commit/33e1f3a10a809c1d4a92935ee9d4455bb26391bc", "committedDate": "2020-10-16T18:52:49Z", "message": "formatting"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8e28f2bb53663ba30c5ec1f2840ec4a29c57ef50", "author": {"user": {"login": "mpeddada1", "name": "Mridula"}}, "url": "https://github.com/GoogleContainerTools/jib/commit/8e28f2bb53663ba30c5ec1f2840ec4a29c57ef50", "committedDate": "2020-10-16T19:48:17Z", "message": "cleaning up"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7adbee46cd82b4589229ffbfcae731665b452a4b", "author": {"user": {"login": "mpeddada1", "name": "Mridula"}}, "url": "https://github.com/GoogleContainerTools/jib/commit/7adbee46cd82b4589229ffbfcae731665b452a4b", "committedDate": "2020-10-16T19:51:21Z", "message": "remove unnecessary spacing"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTEwNzkyMTA3", "url": "https://github.com/GoogleContainerTools/jib/pull/2813#pullrequestreview-510792107", "createdAt": "2020-10-16T20:53:49Z", "commit": {"oid": "7adbee46cd82b4589229ffbfcae731665b452a4b"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNlQyMDo1Mzo0OVrOHjPgsA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNlQyMDo1ODo0MFrOHjPoVg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjcxNjMzNg==", "bodyText": "Sorry, looking at this again, maybe this doesn't need to accept a builder. It can create it locally. That said, it can accept a layer name instead? For example,\nprivate static FileEntriesLayer createLayerFromDirectoryContents(String layerName, ...) {\n  FileEntriesLayer.Builder builder = FileEntriesLayer.builder().setName(layerName);\n  new DirectoryWalker(...)...;\n  return builder.build();\n}\nWDYT?", "url": "https://github.com/GoogleContainerTools/jib/pull/2813#discussion_r506716336", "createdAt": "2020-10-16T20:53:49Z", "author": {"login": "chanseokoh"}, "path": "jib-cli/src/main/java/com/google/cloud/tools/jib/cli/jar/JarProcessor.java", "diffHunk": "@@ -49,4 +65,86 @@ public static JarType determineJarType(Path jarPath) throws IOException {\n     }\n     return JarType.STANDARD;\n   }\n+\n+  /**\n+   * Explode jar and create three layers for classes, resources and dependencies on container.\n+   *\n+   * @param jarPath path to jar file.\n+   * @param tempDirPath path to temporary jib local directory.\n+   * @return list of {@link FileEntriesLayer}.\n+   * @throws IOException if I/O error occurs when opening the jar file or if temporary directory\n+   *     provided doesn't exist.\n+   */\n+  public static List<FileEntriesLayer> explodeStandardJar(Path jarPath, Path tempDirPath)\n+      throws IOException {\n+    Path localExplodedJarRoot = tempDirPath;\n+    ZipUtil.unzip(jarPath, localExplodedJarRoot);\n+    List<FileEntriesLayer> layers = new ArrayList<>();\n+    Predicate<Path> isClassFile = path -> path.getFileName().toString().endsWith(\".class\");\n+    Predicate<Path> isResourceFile = isClassFile.negate();\n+\n+    // Determine class and resource files in the directory containing jar contents and create\n+    // FileEntriesLayer for each type of layer (classes or resources), while maintaining the\n+    // file's original project structure.\n+    FileEntriesLayer classesLayer =\n+        addDirectoryContentsToLayer(\n+                FileEntriesLayer.builder(),\n+                localExplodedJarRoot,\n+                isClassFile,\n+                APP_ROOT.resolve(RelativeUnixPath.get(\"explodedJar\")))\n+            .setName(\"classes\")\n+            .build();\n+    FileEntriesLayer resourcesLayer =\n+        addDirectoryContentsToLayer(\n+                FileEntriesLayer.builder(),\n+                localExplodedJarRoot,\n+                isResourceFile,\n+                APP_ROOT.resolve(RelativeUnixPath.get(\"explodedJar\")))\n+            .setName(\"resources\")\n+            .build();\n+\n+    // Get dependencies from Class-Path in the jar's manifest and add a layer with these\n+    // dependencies as entries. If Class-Path in the jar's manifest is not present then skip adding\n+    // a dependencies layer.\n+    JarFile jarFile = new JarFile(jarPath.toFile());\n+    String classPath =\n+        jarFile.getManifest().getMainAttributes().getValue(Attributes.Name.CLASS_PATH);\n+    if (classPath != null) {\n+      List<Path> dependencies =\n+          Splitter.onPattern(\"\\\\s+\")\n+              .splitToList(classPath.trim())\n+              .stream()\n+              .map(Paths::get)\n+              .collect(Collectors.toList());\n+      FileEntriesLayer.Builder dependenciesLayerBuilder =\n+          FileEntriesLayer.builder().setName(\"dependencies\");\n+      dependencies.forEach(\n+          path ->\n+              dependenciesLayerBuilder.addEntry(\n+                  path, APP_ROOT.resolve(RelativeUnixPath.get(\"dependencies\")).resolve(path)));\n+      layers.add(dependenciesLayerBuilder.build());\n+    }\n+\n+    layers.add(resourcesLayer);\n+    layers.add(classesLayer);\n+    return layers;\n+  }\n+\n+  private static FileEntriesLayer.Builder addDirectoryContentsToLayer(\n+      FileEntriesLayer.Builder builder,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7adbee46cd82b4589229ffbfcae731665b452a4b"}, "originalPosition": 108}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjcxNzc3Ng==", "bodyText": "super nit: I think this comment is obvious enough to be removed.", "url": "https://github.com/GoogleContainerTools/jib/pull/2813#discussion_r506717776", "createdAt": "2020-10-16T20:57:23Z", "author": {"login": "chanseokoh"}, "path": "jib-cli/src/test/java/com/google/cloud/tools/jib/cli/jar/JarProcessorTest.java", "diffHunk": "@@ -18,30 +18,260 @@\n \n import static com.google.common.truth.Truth.assertThat;\n \n+import com.google.cloud.tools.jib.api.buildplan.AbsoluteUnixPath;\n+import com.google.cloud.tools.jib.api.buildplan.FileEntriesLayer;\n+import com.google.cloud.tools.jib.api.buildplan.FileEntry;\n import com.google.cloud.tools.jib.cli.jar.JarProcessor.JarType;\n+import com.google.common.collect.ImmutableList;\n import com.google.common.io.Resources;\n import java.io.IOException;\n import java.net.URISyntaxException;\n import java.nio.file.Path;\n import java.nio.file.Paths;\n+import java.util.List;\n+import java.util.stream.Collectors;\n+import org.junit.Rule;\n import org.junit.Test;\n+import org.junit.rules.TemporaryFolder;\n \n public class JarProcessorTest {\n \n-  private static final String SPRING_BOOT_RESOURCE_DIR = \"jar/springboot/springboot_sample.jar\";\n-  private static final String STANDARD_RESOURCE_DIR = \"jar/standard/standardJar.jar\";\n+  private static final String SPRING_BOOT_JAR = \"jar/springboot/springboot_sample.jar\";\n+  private static final String STANDARD_JAR_WITH_CLASS_PATH_MANIFEST =\n+      \"jar/standard/standardJarWithClassPath.jar\";\n+  private static final String STANDARD_JAR_WITHOUT_CLASS_PATH_MANIFEST =\n+      \"jar/standard/standardJarWithoutClassPath.jar\";\n+  private static final String STANDARD_JAR_WITH_ONLY_CLASSES =\n+      \"jar/standard/standardJarWithOnlyClasses.jar\";\n+  private static final String STANDARD_JAR_EMPTY = \"jar/standard/emptyStandardJar.jar\";\n+\n+  @Rule public final TemporaryFolder temporaryFolder = new TemporaryFolder();\n \n   @Test\n   public void testDetermineJarType_springBoot() throws IOException, URISyntaxException {\n-    Path springBootJar = Paths.get(Resources.getResource(SPRING_BOOT_RESOURCE_DIR).toURI());\n+    Path springBootJar = Paths.get(Resources.getResource(SPRING_BOOT_JAR).toURI());\n     JarType jarType = JarProcessor.determineJarType(springBootJar);\n     assertThat(jarType).isEqualTo(JarType.SPRING_BOOT);\n   }\n \n   @Test\n   public void testDetermineJarType_standard() throws IOException, URISyntaxException {\n-    Path standardJar = Paths.get(Resources.getResource(STANDARD_RESOURCE_DIR).toURI());\n+    Path standardJar = Paths.get(Resources.getResource(STANDARD_JAR_EMPTY).toURI());\n     JarType jarType = JarProcessor.determineJarType(standardJar);\n     assertThat(jarType).isEqualTo(JarType.STANDARD);\n   }\n+\n+  @Test\n+  public void testExplodeMode_standard_emptyJar() throws IOException, URISyntaxException {\n+    Path standardJar = Paths.get(Resources.getResource(STANDARD_JAR_EMPTY).toURI());\n+    Path destDir = temporaryFolder.newFolder().toPath();\n+    List<FileEntriesLayer> layers = JarProcessor.explodeStandardJar(standardJar, destDir);\n+\n+    // Validate that only two layers are created.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7adbee46cd82b4589229ffbfcae731665b452a4b"}, "originalPosition": 57}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjcxODI5NA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n               * Explode jar and create three layers for classes, resources and dependencies on container.\n          \n          \n            \n               * Explodes jar and create three layers for classes, resources and dependencies on container.\n          \n      \n    \n    \n  \n\nand we don't put a period for @param, @return and such, but honestly, I didn't care.", "url": "https://github.com/GoogleContainerTools/jib/pull/2813#discussion_r506718294", "createdAt": "2020-10-16T20:58:40Z", "author": {"login": "chanseokoh"}, "path": "jib-cli/src/main/java/com/google/cloud/tools/jib/cli/jar/JarProcessor.java", "diffHunk": "@@ -49,4 +65,86 @@ public static JarType determineJarType(Path jarPath) throws IOException {\n     }\n     return JarType.STANDARD;\n   }\n+\n+  /**\n+   * Explode jar and create three layers for classes, resources and dependencies on container.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7adbee46cd82b4589229ffbfcae731665b452a4b"}, "originalPosition": 44}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "79de6abf149de89cdcfedde93d15584913799986", "author": {"user": {"login": "mpeddada1", "name": "Mridula"}}, "url": "https://github.com/GoogleContainerTools/jib/commit/79de6abf149de89cdcfedde93d15584913799986", "committedDate": "2020-10-19T14:04:26Z", "message": "refactor helper and modify javadoc"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6fbca0c89941108aa6a5c0e9f27a6d02b701af69", "author": {"user": {"login": "mpeddada1", "name": "Mridula"}}, "url": "https://github.com/GoogleContainerTools/jib/commit/6fbca0c89941108aa6a5c0e9f27a6d02b701af69", "committedDate": "2020-10-19T14:16:45Z", "message": "moving code for initializing classes and resources layers down"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTExODEyOTA4", "url": "https://github.com/GoogleContainerTools/jib/pull/2813#pullrequestreview-511812908", "createdAt": "2020-10-19T14:18:09Z", "commit": {"oid": "6fbca0c89941108aa6a5c0e9f27a6d02b701af69"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a5631b788e18e5df00f4714b965261f670cbeff6", "author": {"user": {"login": "mpeddada1", "name": "Mridula"}}, "url": "https://github.com/GoogleContainerTools/jib/commit/a5631b788e18e5df00f4714b965261f670cbeff6", "committedDate": "2020-10-19T14:33:11Z", "message": "empty commit to trigger builds"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3af8340ef97325590ecee494231704250a6eed27", "author": {"user": {"login": "mpeddada1", "name": "Mridula"}}, "url": "https://github.com/GoogleContainerTools/jib/commit/3af8340ef97325590ecee494231704250a6eed27", "committedDate": "2020-10-19T14:52:20Z", "message": "minor comment change"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f7758e1b53b58c0076416bb853ed869302728501", "author": {"user": {"login": "mpeddada1", "name": "Mridula"}}, "url": "https://github.com/GoogleContainerTools/jib/commit/f7758e1b53b58c0076416bb853ed869302728501", "committedDate": "2020-10-19T14:56:42Z", "message": "empty commit to trigger builds"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7312285eaa25643e050ce06a260b46905a4f706c", "author": {"user": {"login": "mpeddada1", "name": "Mridula"}}, "url": "https://github.com/GoogleContainerTools/jib/commit/7312285eaa25643e050ce06a260b46905a4f706c", "committedDate": "2020-10-19T15:14:45Z", "message": "empty commit to trigger builds"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4805, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}