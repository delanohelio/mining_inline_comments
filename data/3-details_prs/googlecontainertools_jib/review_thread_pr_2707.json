{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY5NTU3NjU4", "number": 2707, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMFQwMDo1NjoxNlrOEaPunw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMFQwMToxMDo1NVrOEaQDxA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk1OTU2MTI3OnYy", "diffSide": "RIGHT", "path": "jib-core/src/main/java/com/google/cloud/tools/jib/image/json/ManifestAndConfigTemplate.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMFQwMDo1NjoxNlrOHDjhyg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMFQxMzozOToyNVrOHEBsBQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzQ4OTg2Ng==", "bodyText": "Do we need to persist a V21 manifest? Don't we do conversions of this to V22?", "url": "https://github.com/GoogleContainerTools/jib/pull/2707#discussion_r473489866", "createdAt": "2020-08-20T00:56:16Z", "author": {"login": "loosebazooka"}, "path": "jib-core/src/main/java/com/google/cloud/tools/jib/image/json/ManifestAndConfigTemplate.java", "diffHunk": "@@ -16,16 +16,32 @@\n \n package com.google.cloud.tools.jib.image.json;\n \n-import java.util.Optional;\n+import com.fasterxml.jackson.annotation.JsonSubTypes;\n+import com.fasterxml.jackson.annotation.JsonTypeInfo;\n+import com.google.cloud.tools.jib.json.JsonTemplate;\n import javax.annotation.Nullable;\n \n /** Stores a manifest and container config. */\n-public class ManifestAndConfig {\n+public class ManifestAndConfigTemplate implements JsonTemplate {\n \n-  private final ManifestTemplate manifest;\n-  @Nullable private final ContainerConfigurationTemplate config;\n+  @JsonTypeInfo(\n+      use = JsonTypeInfo.Id.CLASS,\n+      include = JsonTypeInfo.As.PROPERTY,\n+      property = \"@class\")\n+  @JsonSubTypes({\n+    @JsonSubTypes.Type(value = OciManifestTemplate.class),\n+    @JsonSubTypes.Type(value = V21ManifestTemplate.class),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a53417dd8f1fc9808d3b0edae23f2b09001582e0"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3Mzk4NDAwNQ==", "bodyText": "We don't actually do a JSON-to-JSON conversion. We are currently persisting V21ManifestTemplate in the cache.\nIt's just that we can properly instantiate a Java Image instance from both V21 and V22.", "url": "https://github.com/GoogleContainerTools/jib/pull/2707#discussion_r473984005", "createdAt": "2020-08-20T13:39:25Z", "author": {"login": "chanseokoh"}, "path": "jib-core/src/main/java/com/google/cloud/tools/jib/image/json/ManifestAndConfigTemplate.java", "diffHunk": "@@ -16,16 +16,32 @@\n \n package com.google.cloud.tools.jib.image.json;\n \n-import java.util.Optional;\n+import com.fasterxml.jackson.annotation.JsonSubTypes;\n+import com.fasterxml.jackson.annotation.JsonTypeInfo;\n+import com.google.cloud.tools.jib.json.JsonTemplate;\n import javax.annotation.Nullable;\n \n /** Stores a manifest and container config. */\n-public class ManifestAndConfig {\n+public class ManifestAndConfigTemplate implements JsonTemplate {\n \n-  private final ManifestTemplate manifest;\n-  @Nullable private final ContainerConfigurationTemplate config;\n+  @JsonTypeInfo(\n+      use = JsonTypeInfo.Id.CLASS,\n+      include = JsonTypeInfo.As.PROPERTY,\n+      property = \"@class\")\n+  @JsonSubTypes({\n+    @JsonSubTypes.Type(value = OciManifestTemplate.class),\n+    @JsonSubTypes.Type(value = V21ManifestTemplate.class),", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzQ4OTg2Ng=="}, "originalCommit": {"oid": "a53417dd8f1fc9808d3b0edae23f2b09001582e0"}, "originalPosition": 22}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk1OTYxNTQwOnYy", "diffSide": "RIGHT", "path": "jib-core/src/main/java/com/google/cloud/tools/jib/cache/CacheStorageReader.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMFQwMToxMDo1NVrOHDkG1A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMFQxMzo0MjowNlrOHEB4Aw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzQ5OTM0OA==", "bodyText": "It seems strange that we would generate a JsonTemplate type from separately parsed out jsonTemplates? Is this something that we would need to change eventually?\nCan we go directly to ManifestAndConfigTemplate directly from file?", "url": "https://github.com/GoogleContainerTools/jib/pull/2707#discussion_r473499348", "createdAt": "2020-08-20T01:10:55Z", "author": {"login": "loosebazooka"}, "path": "jib-core/src/main/java/com/google/cloud/tools/jib/cache/CacheStorageReader.java", "diffHunk": "@@ -110,7 +110,7 @@\n \n       if (schemaVersion == 1) {\n         return Optional.of(\n-            new ManifestAndConfig(\n+            new ManifestAndConfigTemplate(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a53417dd8f1fc9808d3b0edae23f2b09001582e0"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3Mzk4NzA3NQ==", "bodyText": "In the next PR, all of these parsing and conversion operations will be gone, and this retrieveMetadata() will directly de-serialize and return ImageMetadataTemplate without any processing.", "url": "https://github.com/GoogleContainerTools/jib/pull/2707#discussion_r473987075", "createdAt": "2020-08-20T13:42:06Z", "author": {"login": "chanseokoh"}, "path": "jib-core/src/main/java/com/google/cloud/tools/jib/cache/CacheStorageReader.java", "diffHunk": "@@ -110,7 +110,7 @@\n \n       if (schemaVersion == 1) {\n         return Optional.of(\n-            new ManifestAndConfig(\n+            new ManifestAndConfigTemplate(", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzQ5OTM0OA=="}, "originalCommit": {"oid": "a53417dd8f1fc9808d3b0edae23f2b09001582e0"}, "originalPosition": 23}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 135, "cost": 1, "resetAt": "2021-11-12T19:05:54Z"}}}