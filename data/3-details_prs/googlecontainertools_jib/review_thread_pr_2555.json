{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQyMTEzOTU4", "number": 2555, "reviewThreads": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0zMFQxNTozODowNlrOEKKCEw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMVQxNToxNjowN1rOEKjbaw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc5MDg1NTg3OnYy", "diffSide": "RIGHT", "path": "jib-core/src/test/java/com/google/cloud/tools/jib/registry/RegistryClientTest.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0zMFQxNTozODowNlrOGrCaAQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0zMFQxNTo0OTozNlrOGrC6OQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Nzc4MTM3Nw==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                String imageTag = \"testIMage\";\n          \n      \n    \n    \n  \n\nI think we can just specify this string when calling pullManifest(...).", "url": "https://github.com/GoogleContainerTools/jib/pull/2555#discussion_r447781377", "createdAt": "2020-06-30T15:38:06Z", "author": {"login": "chanseokoh"}, "path": "jib-core/src/test/java/com/google/cloud/tools/jib/registry/RegistryClientTest.java", "diffHunk": "@@ -211,6 +211,29 @@ public void testConfigureBasicAuth()\n         registry.getInputRead(), CoreMatchers.containsString(\"Authorization: Basic dXNlcjpwYXNz\"));\n   }\n \n+  @Test\n+  public void testPullManifest()\n+      throws IOException, InterruptedException, GeneralSecurityException, URISyntaxException,\n+          RegistryException {\n+    String imageTag = \"testIMage\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7fa9e567bf18a2675cb45b89661f617699f89d13"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Nzc4OTYyNQ==", "bodyText": "Done", "url": "https://github.com/GoogleContainerTools/jib/pull/2555#discussion_r447789625", "createdAt": "2020-06-30T15:49:36Z", "author": {"login": "louismurerwa"}, "path": "jib-core/src/test/java/com/google/cloud/tools/jib/registry/RegistryClientTest.java", "diffHunk": "@@ -211,6 +211,29 @@ public void testConfigureBasicAuth()\n         registry.getInputRead(), CoreMatchers.containsString(\"Authorization: Basic dXNlcjpwYXNz\"));\n   }\n \n+  @Test\n+  public void testPullManifest()\n+      throws IOException, InterruptedException, GeneralSecurityException, URISyntaxException,\n+          RegistryException {\n+    String imageTag = \"testIMage\";", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Nzc4MTM3Nw=="}, "originalCommit": {"oid": "7fa9e567bf18a2675cb45b89661f617699f89d13"}, "originalPosition": 8}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc5MDg1Nzk1OnYy", "diffSide": "RIGHT", "path": "jib-core/src/test/java/com/google/cloud/tools/jib/registry/RegistryClientTest.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0zMFQxNTozODozNlrOGrCbXw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0zMFQxNTo0OTo1OVrOGrC7Tw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Nzc4MTcyNw==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                ManifestAndDigest<?> manifestAndDigest = registryClient.pullManifest(imageTag);\n          \n          \n            \n                ManifestAndDigest<?> manifestAndDigest = registryClient.pullManifest(\"image-tag\");", "url": "https://github.com/GoogleContainerTools/jib/pull/2555#discussion_r447781727", "createdAt": "2020-06-30T15:38:36Z", "author": {"login": "chanseokoh"}, "path": "jib-core/src/test/java/com/google/cloud/tools/jib/registry/RegistryClientTest.java", "diffHunk": "@@ -211,6 +211,29 @@ public void testConfigureBasicAuth()\n         registry.getInputRead(), CoreMatchers.containsString(\"Authorization: Basic dXNlcjpwYXNz\"));\n   }\n \n+  @Test\n+  public void testPullManifest()\n+      throws IOException, InterruptedException, GeneralSecurityException, URISyntaxException,\n+          RegistryException {\n+    String imageTag = \"testIMage\";\n+    String manifestResponse =\n+        \"HTTP/1.1 200 OK\\nContent-Length: 307\\n\\n{\\n\"\n+            + \"    \\\"schemaVersion\\\": 2,\\n\"\n+            + \"    \\\"mediaType\\\": \\\"application/vnd.docker.distribution.manifest.v2+json\\\",\\n\"\n+            + \"    \\\"config\\\": {\\n\"\n+            + \"        \\\"mediaType\\\": \\\"application/vnd.docker.container.image.v1+json\\\",\\n\"\n+            + \"        \\\"size\\\": 7023,\\n\"\n+            + \"        \\\"digest\\\": \\\"sha256:b5b2b2c507a0944348e0303114d8d93aaaa081732b86451d9bce1f432a537bc7\\\"\\n\"\n+            + \"    }\\n\"\n+            + \"}\";\n+\n+    registry = new TestWebServer(false, Arrays.asList(manifestResponse), 1);\n+    RegistryClient registryClient = createRegistryClient(null);\n+\n+    ManifestAndDigest<?> manifestAndDigest = registryClient.pullManifest(imageTag);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7fa9e567bf18a2675cb45b89661f617699f89d13"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Nzc4OTkwMw==", "bodyText": "Done", "url": "https://github.com/GoogleContainerTools/jib/pull/2555#discussion_r447789903", "createdAt": "2020-06-30T15:49:59Z", "author": {"login": "louismurerwa"}, "path": "jib-core/src/test/java/com/google/cloud/tools/jib/registry/RegistryClientTest.java", "diffHunk": "@@ -211,6 +211,29 @@ public void testConfigureBasicAuth()\n         registry.getInputRead(), CoreMatchers.containsString(\"Authorization: Basic dXNlcjpwYXNz\"));\n   }\n \n+  @Test\n+  public void testPullManifest()\n+      throws IOException, InterruptedException, GeneralSecurityException, URISyntaxException,\n+          RegistryException {\n+    String imageTag = \"testIMage\";\n+    String manifestResponse =\n+        \"HTTP/1.1 200 OK\\nContent-Length: 307\\n\\n{\\n\"\n+            + \"    \\\"schemaVersion\\\": 2,\\n\"\n+            + \"    \\\"mediaType\\\": \\\"application/vnd.docker.distribution.manifest.v2+json\\\",\\n\"\n+            + \"    \\\"config\\\": {\\n\"\n+            + \"        \\\"mediaType\\\": \\\"application/vnd.docker.container.image.v1+json\\\",\\n\"\n+            + \"        \\\"size\\\": 7023,\\n\"\n+            + \"        \\\"digest\\\": \\\"sha256:b5b2b2c507a0944348e0303114d8d93aaaa081732b86451d9bce1f432a537bc7\\\"\\n\"\n+            + \"    }\\n\"\n+            + \"}\";\n+\n+    registry = new TestWebServer(false, Arrays.asList(manifestResponse), 1);\n+    RegistryClient registryClient = createRegistryClient(null);\n+\n+    ManifestAndDigest<?> manifestAndDigest = registryClient.pullManifest(imageTag);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Nzc4MTcyNw=="}, "originalCommit": {"oid": "7fa9e567bf18a2675cb45b89661f617699f89d13"}, "originalPosition": 23}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc5MDg4MTExOnYy", "diffSide": "RIGHT", "path": "jib-core/src/test/java/com/google/cloud/tools/jib/registry/RegistryClientTest.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0zMFQxNTo0Mzo1OFrOGrCp8g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0zMFQxNzoxODoxN1rOGrGq_A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Nzc4NTQ1OA==", "bodyText": "Instead of this, let's verify the details with the returned manifest (getManifest()) + digest (getDigest()).\nThe manifest in this case would be of type V22ManifestTemplate. So you could\nAssert.assertTrue(manifestAndDigest.getManifest() instanceof V22ManifestTemplate);\nV22ManifestTemplate manifest = (V22ManifestTemplate) manifestAndDigest.getManifest();\nAssert.assertEquals(2, manifest.getSchemaVersion());\nAssert.assertEquals(7023, manifest.getContainerConfiguration().getSize());\n... // you can do more checks\nLikewise, you'll be able to verify values in the returned digest.\nassertEquaus(\"sha256:...\", manifest.getDigest().toString());\n...", "url": "https://github.com/GoogleContainerTools/jib/pull/2555#discussion_r447785458", "createdAt": "2020-06-30T15:43:58Z", "author": {"login": "chanseokoh"}, "path": "jib-core/src/test/java/com/google/cloud/tools/jib/registry/RegistryClientTest.java", "diffHunk": "@@ -211,6 +211,29 @@ public void testConfigureBasicAuth()\n         registry.getInputRead(), CoreMatchers.containsString(\"Authorization: Basic dXNlcjpwYXNz\"));\n   }\n \n+  @Test\n+  public void testPullManifest()\n+      throws IOException, InterruptedException, GeneralSecurityException, URISyntaxException,\n+          RegistryException {\n+    String imageTag = \"testIMage\";\n+    String manifestResponse =\n+        \"HTTP/1.1 200 OK\\nContent-Length: 307\\n\\n{\\n\"\n+            + \"    \\\"schemaVersion\\\": 2,\\n\"\n+            + \"    \\\"mediaType\\\": \\\"application/vnd.docker.distribution.manifest.v2+json\\\",\\n\"\n+            + \"    \\\"config\\\": {\\n\"\n+            + \"        \\\"mediaType\\\": \\\"application/vnd.docker.container.image.v1+json\\\",\\n\"\n+            + \"        \\\"size\\\": 7023,\\n\"\n+            + \"        \\\"digest\\\": \\\"sha256:b5b2b2c507a0944348e0303114d8d93aaaa081732b86451d9bce1f432a537bc7\\\"\\n\"\n+            + \"    }\\n\"\n+            + \"}\";\n+\n+    registry = new TestWebServer(false, Arrays.asList(manifestResponse), 1);\n+    RegistryClient registryClient = createRegistryClient(null);\n+\n+    ManifestAndDigest<?> manifestAndDigest = registryClient.pullManifest(imageTag);\n+    Assert.assertEquals(66, manifestAndDigest.getManifest().toString().length());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7fa9e567bf18a2675cb45b89661f617699f89d13"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Nzc5MTY0Ng==", "bodyText": "This is a good suggestion.This enables us to confirm that this is the actual manifest we intended to receive.", "url": "https://github.com/GoogleContainerTools/jib/pull/2555#discussion_r447791646", "createdAt": "2020-06-30T15:52:07Z", "author": {"login": "louismurerwa"}, "path": "jib-core/src/test/java/com/google/cloud/tools/jib/registry/RegistryClientTest.java", "diffHunk": "@@ -211,6 +211,29 @@ public void testConfigureBasicAuth()\n         registry.getInputRead(), CoreMatchers.containsString(\"Authorization: Basic dXNlcjpwYXNz\"));\n   }\n \n+  @Test\n+  public void testPullManifest()\n+      throws IOException, InterruptedException, GeneralSecurityException, URISyntaxException,\n+          RegistryException {\n+    String imageTag = \"testIMage\";\n+    String manifestResponse =\n+        \"HTTP/1.1 200 OK\\nContent-Length: 307\\n\\n{\\n\"\n+            + \"    \\\"schemaVersion\\\": 2,\\n\"\n+            + \"    \\\"mediaType\\\": \\\"application/vnd.docker.distribution.manifest.v2+json\\\",\\n\"\n+            + \"    \\\"config\\\": {\\n\"\n+            + \"        \\\"mediaType\\\": \\\"application/vnd.docker.container.image.v1+json\\\",\\n\"\n+            + \"        \\\"size\\\": 7023,\\n\"\n+            + \"        \\\"digest\\\": \\\"sha256:b5b2b2c507a0944348e0303114d8d93aaaa081732b86451d9bce1f432a537bc7\\\"\\n\"\n+            + \"    }\\n\"\n+            + \"}\";\n+\n+    registry = new TestWebServer(false, Arrays.asList(manifestResponse), 1);\n+    RegistryClient registryClient = createRegistryClient(null);\n+\n+    ManifestAndDigest<?> manifestAndDigest = registryClient.pullManifest(imageTag);\n+    Assert.assertEquals(66, manifestAndDigest.getManifest().toString().length());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Nzc4NTQ1OA=="}, "originalCommit": {"oid": "7fa9e567bf18a2675cb45b89661f617699f89d13"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Nzg1MTI2MA==", "bodyText": "Exactly!", "url": "https://github.com/GoogleContainerTools/jib/pull/2555#discussion_r447851260", "createdAt": "2020-06-30T17:18:17Z", "author": {"login": "chanseokoh"}, "path": "jib-core/src/test/java/com/google/cloud/tools/jib/registry/RegistryClientTest.java", "diffHunk": "@@ -211,6 +211,29 @@ public void testConfigureBasicAuth()\n         registry.getInputRead(), CoreMatchers.containsString(\"Authorization: Basic dXNlcjpwYXNz\"));\n   }\n \n+  @Test\n+  public void testPullManifest()\n+      throws IOException, InterruptedException, GeneralSecurityException, URISyntaxException,\n+          RegistryException {\n+    String imageTag = \"testIMage\";\n+    String manifestResponse =\n+        \"HTTP/1.1 200 OK\\nContent-Length: 307\\n\\n{\\n\"\n+            + \"    \\\"schemaVersion\\\": 2,\\n\"\n+            + \"    \\\"mediaType\\\": \\\"application/vnd.docker.distribution.manifest.v2+json\\\",\\n\"\n+            + \"    \\\"config\\\": {\\n\"\n+            + \"        \\\"mediaType\\\": \\\"application/vnd.docker.container.image.v1+json\\\",\\n\"\n+            + \"        \\\"size\\\": 7023,\\n\"\n+            + \"        \\\"digest\\\": \\\"sha256:b5b2b2c507a0944348e0303114d8d93aaaa081732b86451d9bce1f432a537bc7\\\"\\n\"\n+            + \"    }\\n\"\n+            + \"}\";\n+\n+    registry = new TestWebServer(false, Arrays.asList(manifestResponse), 1);\n+    RegistryClient registryClient = createRegistryClient(null);\n+\n+    ManifestAndDigest<?> manifestAndDigest = registryClient.pullManifest(imageTag);\n+    Assert.assertEquals(66, manifestAndDigest.getManifest().toString().length());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Nzc4NTQ1OA=="}, "originalCommit": {"oid": "7fa9e567bf18a2675cb45b89661f617699f89d13"}, "originalPosition": 24}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc5MTI5MzQ2OnYy", "diffSide": "RIGHT", "path": "jib-core/src/test/java/com/google/cloud/tools/jib/registry/RegistryClientTest.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0zMFQxNzoxNToyM1rOGrGkVQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0zMFQxNzozOTowNlrOGrHg-Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Nzg0OTU1Nw==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                // verify details of the returned manifest\n          \n          \n            \n                Assert.assertTrue(manifestAndDigest.getManifest() instanceof V22ManifestTemplate);\n          \n      \n    \n    \n  \n\nCheck the instance here before force-casting below so that in case it's not of V22ManifestTemplate, the test doesn't crash with ClassCastException.\nAnd we can skip trivial comments.", "url": "https://github.com/GoogleContainerTools/jib/pull/2555#discussion_r447849557", "createdAt": "2020-06-30T17:15:23Z", "author": {"login": "chanseokoh"}, "path": "jib-core/src/test/java/com/google/cloud/tools/jib/registry/RegistryClientTest.java", "diffHunk": "@@ -211,6 +212,37 @@ public void testConfigureBasicAuth()\n         registry.getInputRead(), CoreMatchers.containsString(\"Authorization: Basic dXNlcjpwYXNz\"));\n   }\n \n+  @Test\n+  public void testPullManifest()\n+      throws IOException, InterruptedException, GeneralSecurityException, URISyntaxException,\n+          RegistryException {\n+    String manifestResponse =\n+        \"HTTP/1.1 200 OK\\nContent-Length: 307\\n\\n{\\n\"\n+            + \"    \\\"schemaVersion\\\": 2,\\n\"\n+            + \"    \\\"mediaType\\\": \\\"application/vnd.docker.distribution.manifest.v2+json\\\",\\n\"\n+            + \"    \\\"config\\\": {\\n\"\n+            + \"        \\\"mediaType\\\": \\\"application/vnd.docker.container.image.v1+json\\\",\\n\"\n+            + \"        \\\"size\\\": 7023,\\n\"\n+            + \"        \\\"digest\\\": \\\"sha256:b5b2b2c507a0944348e0303114d8d93aaaa081732b86451d9bce1f432a537bc7\\\"\\n\"\n+            + \"    }\\n\"\n+            + \"}\";\n+\n+    registry = new TestWebServer(false, Arrays.asList(manifestResponse), 1);\n+    RegistryClient registryClient = createRegistryClient(null);\n+    ManifestAndDigest<?> manifestAndDigest = registryClient.pullManifest(\"image-tag\");\n+\n+    // verify details of the returned manifest", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c45f59691669fe50bf870576409157c5f66f8a59"}, "originalPosition": 31}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Nzg2NTA4MQ==", "bodyText": "Done !! This a clever way of avoiding type an object which is not of V22ManifestTemplate.", "url": "https://github.com/GoogleContainerTools/jib/pull/2555#discussion_r447865081", "createdAt": "2020-06-30T17:39:06Z", "author": {"login": "louismurerwa"}, "path": "jib-core/src/test/java/com/google/cloud/tools/jib/registry/RegistryClientTest.java", "diffHunk": "@@ -211,6 +212,37 @@ public void testConfigureBasicAuth()\n         registry.getInputRead(), CoreMatchers.containsString(\"Authorization: Basic dXNlcjpwYXNz\"));\n   }\n \n+  @Test\n+  public void testPullManifest()\n+      throws IOException, InterruptedException, GeneralSecurityException, URISyntaxException,\n+          RegistryException {\n+    String manifestResponse =\n+        \"HTTP/1.1 200 OK\\nContent-Length: 307\\n\\n{\\n\"\n+            + \"    \\\"schemaVersion\\\": 2,\\n\"\n+            + \"    \\\"mediaType\\\": \\\"application/vnd.docker.distribution.manifest.v2+json\\\",\\n\"\n+            + \"    \\\"config\\\": {\\n\"\n+            + \"        \\\"mediaType\\\": \\\"application/vnd.docker.container.image.v1+json\\\",\\n\"\n+            + \"        \\\"size\\\": 7023,\\n\"\n+            + \"        \\\"digest\\\": \\\"sha256:b5b2b2c507a0944348e0303114d8d93aaaa081732b86451d9bce1f432a537bc7\\\"\\n\"\n+            + \"    }\\n\"\n+            + \"}\";\n+\n+    registry = new TestWebServer(false, Arrays.asList(manifestResponse), 1);\n+    RegistryClient registryClient = createRegistryClient(null);\n+    ManifestAndDigest<?> manifestAndDigest = registryClient.pullManifest(\"image-tag\");\n+\n+    // verify details of the returned manifest", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Nzg0OTU1Nw=="}, "originalCommit": {"oid": "c45f59691669fe50bf870576409157c5f66f8a59"}, "originalPosition": 31}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc5MTI5OTI2OnYy", "diffSide": "RIGHT", "path": "jib-core/src/test/java/com/google/cloud/tools/jib/registry/RegistryClientTest.java", "isResolved": true, "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0zMFQxNzoxNjo1NVrOGrGn4Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0zMFQxNzo1NTo0MFrOGrIHGA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Nzg1MDQ2NQ==", "bodyText": "As I said before, could you also verify manifestAndDigest.getDigest().toString()?", "url": "https://github.com/GoogleContainerTools/jib/pull/2555#discussion_r447850465", "createdAt": "2020-06-30T17:16:55Z", "author": {"login": "chanseokoh"}, "path": "jib-core/src/test/java/com/google/cloud/tools/jib/registry/RegistryClientTest.java", "diffHunk": "@@ -211,6 +212,37 @@ public void testConfigureBasicAuth()\n         registry.getInputRead(), CoreMatchers.containsString(\"Authorization: Basic dXNlcjpwYXNz\"));\n   }\n \n+  @Test\n+  public void testPullManifest()\n+      throws IOException, InterruptedException, GeneralSecurityException, URISyntaxException,\n+          RegistryException {\n+    String manifestResponse =\n+        \"HTTP/1.1 200 OK\\nContent-Length: 307\\n\\n{\\n\"\n+            + \"    \\\"schemaVersion\\\": 2,\\n\"\n+            + \"    \\\"mediaType\\\": \\\"application/vnd.docker.distribution.manifest.v2+json\\\",\\n\"\n+            + \"    \\\"config\\\": {\\n\"\n+            + \"        \\\"mediaType\\\": \\\"application/vnd.docker.container.image.v1+json\\\",\\n\"\n+            + \"        \\\"size\\\": 7023,\\n\"\n+            + \"        \\\"digest\\\": \\\"sha256:b5b2b2c507a0944348e0303114d8d93aaaa081732b86451d9bce1f432a537bc7\\\"\\n\"\n+            + \"    }\\n\"\n+            + \"}\";\n+\n+    registry = new TestWebServer(false, Arrays.asList(manifestResponse), 1);\n+    RegistryClient registryClient = createRegistryClient(null);\n+    ManifestAndDigest<?> manifestAndDigest = registryClient.pullManifest(\"image-tag\");\n+\n+    // verify details of the returned manifest\n+    V22ManifestTemplate manifest = (V22ManifestTemplate) manifestAndDigest.getManifest();\n+    Assert.assertEquals(2, manifest.getSchemaVersion());\n+    Assert.assertEquals(\n+        \"application/vnd.docker.distribution.manifest.v2+json\", manifest.getManifestMediaType());\n+    Assert.assertEquals(\n+        \"sha256:b5b2b2c507a0944348e0303114d8d93aaaa081732b86451d9bce1f432a537bc7\",\n+        manifest.getContainerConfiguration().getDigest().toString());\n+    Assert.assertEquals(7023, manifest.getContainerConfiguration().getSize());\n+    Assert.assertTrue(manifestAndDigest.getManifest() instanceof V22ManifestTemplate);\n+  }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f03f79cf6ea8de6dac5c6b3aa90a3af1bbcca531"}, "originalPosition": 41}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Nzg1NDMxMQ==", "bodyText": "The manifest file itself doesn't contain a digest in this instance.The digest is in the config file so thats why I used manifest.getContainerConfiguration().getDigest().toString()).I will use the manifestAndDigest.getDigest().toString() when dealing with a manifest list.", "url": "https://github.com/GoogleContainerTools/jib/pull/2555#discussion_r447854311", "createdAt": "2020-06-30T17:23:02Z", "author": {"login": "louismurerwa"}, "path": "jib-core/src/test/java/com/google/cloud/tools/jib/registry/RegistryClientTest.java", "diffHunk": "@@ -211,6 +212,37 @@ public void testConfigureBasicAuth()\n         registry.getInputRead(), CoreMatchers.containsString(\"Authorization: Basic dXNlcjpwYXNz\"));\n   }\n \n+  @Test\n+  public void testPullManifest()\n+      throws IOException, InterruptedException, GeneralSecurityException, URISyntaxException,\n+          RegistryException {\n+    String manifestResponse =\n+        \"HTTP/1.1 200 OK\\nContent-Length: 307\\n\\n{\\n\"\n+            + \"    \\\"schemaVersion\\\": 2,\\n\"\n+            + \"    \\\"mediaType\\\": \\\"application/vnd.docker.distribution.manifest.v2+json\\\",\\n\"\n+            + \"    \\\"config\\\": {\\n\"\n+            + \"        \\\"mediaType\\\": \\\"application/vnd.docker.container.image.v1+json\\\",\\n\"\n+            + \"        \\\"size\\\": 7023,\\n\"\n+            + \"        \\\"digest\\\": \\\"sha256:b5b2b2c507a0944348e0303114d8d93aaaa081732b86451d9bce1f432a537bc7\\\"\\n\"\n+            + \"    }\\n\"\n+            + \"}\";\n+\n+    registry = new TestWebServer(false, Arrays.asList(manifestResponse), 1);\n+    RegistryClient registryClient = createRegistryClient(null);\n+    ManifestAndDigest<?> manifestAndDigest = registryClient.pullManifest(\"image-tag\");\n+\n+    // verify details of the returned manifest\n+    V22ManifestTemplate manifest = (V22ManifestTemplate) manifestAndDigest.getManifest();\n+    Assert.assertEquals(2, manifest.getSchemaVersion());\n+    Assert.assertEquals(\n+        \"application/vnd.docker.distribution.manifest.v2+json\", manifest.getManifestMediaType());\n+    Assert.assertEquals(\n+        \"sha256:b5b2b2c507a0944348e0303114d8d93aaaa081732b86451d9bce1f432a537bc7\",\n+        manifest.getContainerConfiguration().getDigest().toString());\n+    Assert.assertEquals(7023, manifest.getContainerConfiguration().getSize());\n+    Assert.assertTrue(manifestAndDigest.getManifest() instanceof V22ManifestTemplate);\n+  }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Nzg1MDQ2NQ=="}, "originalCommit": {"oid": "f03f79cf6ea8de6dac5c6b3aa90a3af1bbcca531"}, "originalPosition": 41}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Nzg1ODE0OA==", "bodyText": "Oh! There's another test I forget to mention. Testing if pullManifest() is hitting the correct registry API endpoint for fetching a manifest.\nTestWebServer has getInputRead(), which will return all the input pullManifest() has sent through the low-level HTTP protocol. If you check the return value of TestWebServer.getInputRead(), it will contain a line like this:\nGET /v2/foo/bar/manifests/image-tag .... So you can have\nAssert.assertThat(registry.getInputRead(), CoreMatchers.containsString(\"GET ...\"));", "url": "https://github.com/GoogleContainerTools/jib/pull/2555#discussion_r447858148", "createdAt": "2020-06-30T17:28:24Z", "author": {"login": "chanseokoh"}, "path": "jib-core/src/test/java/com/google/cloud/tools/jib/registry/RegistryClientTest.java", "diffHunk": "@@ -211,6 +212,37 @@ public void testConfigureBasicAuth()\n         registry.getInputRead(), CoreMatchers.containsString(\"Authorization: Basic dXNlcjpwYXNz\"));\n   }\n \n+  @Test\n+  public void testPullManifest()\n+      throws IOException, InterruptedException, GeneralSecurityException, URISyntaxException,\n+          RegistryException {\n+    String manifestResponse =\n+        \"HTTP/1.1 200 OK\\nContent-Length: 307\\n\\n{\\n\"\n+            + \"    \\\"schemaVersion\\\": 2,\\n\"\n+            + \"    \\\"mediaType\\\": \\\"application/vnd.docker.distribution.manifest.v2+json\\\",\\n\"\n+            + \"    \\\"config\\\": {\\n\"\n+            + \"        \\\"mediaType\\\": \\\"application/vnd.docker.container.image.v1+json\\\",\\n\"\n+            + \"        \\\"size\\\": 7023,\\n\"\n+            + \"        \\\"digest\\\": \\\"sha256:b5b2b2c507a0944348e0303114d8d93aaaa081732b86451d9bce1f432a537bc7\\\"\\n\"\n+            + \"    }\\n\"\n+            + \"}\";\n+\n+    registry = new TestWebServer(false, Arrays.asList(manifestResponse), 1);\n+    RegistryClient registryClient = createRegistryClient(null);\n+    ManifestAndDigest<?> manifestAndDigest = registryClient.pullManifest(\"image-tag\");\n+\n+    // verify details of the returned manifest\n+    V22ManifestTemplate manifest = (V22ManifestTemplate) manifestAndDigest.getManifest();\n+    Assert.assertEquals(2, manifest.getSchemaVersion());\n+    Assert.assertEquals(\n+        \"application/vnd.docker.distribution.manifest.v2+json\", manifest.getManifestMediaType());\n+    Assert.assertEquals(\n+        \"sha256:b5b2b2c507a0944348e0303114d8d93aaaa081732b86451d9bce1f432a537bc7\",\n+        manifest.getContainerConfiguration().getDigest().toString());\n+    Assert.assertEquals(7023, manifest.getContainerConfiguration().getSize());\n+    Assert.assertTrue(manifestAndDigest.getManifest() instanceof V22ManifestTemplate);\n+  }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Nzg1MDQ2NQ=="}, "originalCommit": {"oid": "f03f79cf6ea8de6dac5c6b3aa90a3af1bbcca531"}, "originalPosition": 41}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Nzg2NzE5NA==", "bodyText": "manifest.getContainerConfiguration().getDigest().toString() is the SHA256 hash of the test JSON input. (For example, if you change the content of the JSON, say, \"size\": 7023 to \"size\": 98, the hash will change as well.) It's worth checking if pullManifest() is correctly computing the digest.", "url": "https://github.com/GoogleContainerTools/jib/pull/2555#discussion_r447867194", "createdAt": "2020-06-30T17:42:36Z", "author": {"login": "chanseokoh"}, "path": "jib-core/src/test/java/com/google/cloud/tools/jib/registry/RegistryClientTest.java", "diffHunk": "@@ -211,6 +212,37 @@ public void testConfigureBasicAuth()\n         registry.getInputRead(), CoreMatchers.containsString(\"Authorization: Basic dXNlcjpwYXNz\"));\n   }\n \n+  @Test\n+  public void testPullManifest()\n+      throws IOException, InterruptedException, GeneralSecurityException, URISyntaxException,\n+          RegistryException {\n+    String manifestResponse =\n+        \"HTTP/1.1 200 OK\\nContent-Length: 307\\n\\n{\\n\"\n+            + \"    \\\"schemaVersion\\\": 2,\\n\"\n+            + \"    \\\"mediaType\\\": \\\"application/vnd.docker.distribution.manifest.v2+json\\\",\\n\"\n+            + \"    \\\"config\\\": {\\n\"\n+            + \"        \\\"mediaType\\\": \\\"application/vnd.docker.container.image.v1+json\\\",\\n\"\n+            + \"        \\\"size\\\": 7023,\\n\"\n+            + \"        \\\"digest\\\": \\\"sha256:b5b2b2c507a0944348e0303114d8d93aaaa081732b86451d9bce1f432a537bc7\\\"\\n\"\n+            + \"    }\\n\"\n+            + \"}\";\n+\n+    registry = new TestWebServer(false, Arrays.asList(manifestResponse), 1);\n+    RegistryClient registryClient = createRegistryClient(null);\n+    ManifestAndDigest<?> manifestAndDigest = registryClient.pullManifest(\"image-tag\");\n+\n+    // verify details of the returned manifest\n+    V22ManifestTemplate manifest = (V22ManifestTemplate) manifestAndDigest.getManifest();\n+    Assert.assertEquals(2, manifest.getSchemaVersion());\n+    Assert.assertEquals(\n+        \"application/vnd.docker.distribution.manifest.v2+json\", manifest.getManifestMediaType());\n+    Assert.assertEquals(\n+        \"sha256:b5b2b2c507a0944348e0303114d8d93aaaa081732b86451d9bce1f432a537bc7\",\n+        manifest.getContainerConfiguration().getDigest().toString());\n+    Assert.assertEquals(7023, manifest.getContainerConfiguration().getSize());\n+    Assert.assertTrue(manifestAndDigest.getManifest() instanceof V22ManifestTemplate);\n+  }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Nzg1MDQ2NQ=="}, "originalCommit": {"oid": "f03f79cf6ea8de6dac5c6b3aa90a3af1bbcca531"}, "originalPosition": 41}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Nzg3NDg0MA==", "bodyText": "I see what you mean !! Done.", "url": "https://github.com/GoogleContainerTools/jib/pull/2555#discussion_r447874840", "createdAt": "2020-06-30T17:55:40Z", "author": {"login": "louismurerwa"}, "path": "jib-core/src/test/java/com/google/cloud/tools/jib/registry/RegistryClientTest.java", "diffHunk": "@@ -211,6 +212,37 @@ public void testConfigureBasicAuth()\n         registry.getInputRead(), CoreMatchers.containsString(\"Authorization: Basic dXNlcjpwYXNz\"));\n   }\n \n+  @Test\n+  public void testPullManifest()\n+      throws IOException, InterruptedException, GeneralSecurityException, URISyntaxException,\n+          RegistryException {\n+    String manifestResponse =\n+        \"HTTP/1.1 200 OK\\nContent-Length: 307\\n\\n{\\n\"\n+            + \"    \\\"schemaVersion\\\": 2,\\n\"\n+            + \"    \\\"mediaType\\\": \\\"application/vnd.docker.distribution.manifest.v2+json\\\",\\n\"\n+            + \"    \\\"config\\\": {\\n\"\n+            + \"        \\\"mediaType\\\": \\\"application/vnd.docker.container.image.v1+json\\\",\\n\"\n+            + \"        \\\"size\\\": 7023,\\n\"\n+            + \"        \\\"digest\\\": \\\"sha256:b5b2b2c507a0944348e0303114d8d93aaaa081732b86451d9bce1f432a537bc7\\\"\\n\"\n+            + \"    }\\n\"\n+            + \"}\";\n+\n+    registry = new TestWebServer(false, Arrays.asList(manifestResponse), 1);\n+    RegistryClient registryClient = createRegistryClient(null);\n+    ManifestAndDigest<?> manifestAndDigest = registryClient.pullManifest(\"image-tag\");\n+\n+    // verify details of the returned manifest\n+    V22ManifestTemplate manifest = (V22ManifestTemplate) manifestAndDigest.getManifest();\n+    Assert.assertEquals(2, manifest.getSchemaVersion());\n+    Assert.assertEquals(\n+        \"application/vnd.docker.distribution.manifest.v2+json\", manifest.getManifestMediaType());\n+    Assert.assertEquals(\n+        \"sha256:b5b2b2c507a0944348e0303114d8d93aaaa081732b86451d9bce1f432a537bc7\",\n+        manifest.getContainerConfiguration().getDigest().toString());\n+    Assert.assertEquals(7023, manifest.getContainerConfiguration().getSize());\n+    Assert.assertTrue(manifestAndDigest.getManifest() instanceof V22ManifestTemplate);\n+  }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Nzg1MDQ2NQ=="}, "originalCommit": {"oid": "f03f79cf6ea8de6dac5c6b3aa90a3af1bbcca531"}, "originalPosition": 41}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc5MTUzNjcyOnYy", "diffSide": "RIGHT", "path": "jib-core/src/test/java/com/google/cloud/tools/jib/registry/RegistryClientTest.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0zMFQxODoxNzozMlrOGrI5UA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0zMFQxODo1NzoxMlrOGrKU8w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Nzg4NzY5Ng==", "bodyText": "nit: HTTP/1.1 refers to an HTTP protocol version that can change (e.g., when the underlying HTTP client library we use changes the HTTP version), so let's remove it.\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    CoreMatchers.containsString(\"GET /v2/foo/bar/manifests/image-tag HTTP/1.1\"));\n          \n          \n            \n                    CoreMatchers.containsString(\"GET /v2/foo/bar/manifests/image-tag \"));", "url": "https://github.com/GoogleContainerTools/jib/pull/2555#discussion_r447887696", "createdAt": "2020-06-30T18:17:32Z", "author": {"login": "chanseokoh"}, "path": "jib-core/src/test/java/com/google/cloud/tools/jib/registry/RegistryClientTest.java", "diffHunk": "@@ -211,6 +212,42 @@ public void testConfigureBasicAuth()\n         registry.getInputRead(), CoreMatchers.containsString(\"Authorization: Basic dXNlcjpwYXNz\"));\n   }\n \n+  @Test\n+  public void testPullManifest()\n+      throws IOException, InterruptedException, GeneralSecurityException, URISyntaxException,\n+          RegistryException {\n+    String manifestResponse =\n+        \"HTTP/1.1 200 OK\\nContent-Length: 307\\n\\n{\\n\"\n+            + \"    \\\"schemaVersion\\\": 2,\\n\"\n+            + \"    \\\"mediaType\\\": \\\"application/vnd.docker.distribution.manifest.v2+json\\\",\\n\"\n+            + \"    \\\"config\\\": {\\n\"\n+            + \"        \\\"mediaType\\\": \\\"application/vnd.docker.container.image.v1+json\\\",\\n\"\n+            + \"        \\\"size\\\": 7023,\\n\"\n+            + \"        \\\"digest\\\": \\\"sha256:b5b2b2c507a0944348e0303114d8d93aaaa081732b86451d9bce1f432a537bc7\\\"\\n\"\n+            + \"    }\\n\"\n+            + \"}\";\n+\n+    registry = new TestWebServer(false, Arrays.asList(manifestResponse), 1);\n+    RegistryClient registryClient = createRegistryClient(null);\n+    ManifestAndDigest<?> manifestAndDigest = registryClient.pullManifest(\"image-tag\");\n+\n+    Assert.assertEquals(\n+        \"sha256:6b61466eabab6e5ffb68ae2bd9b85c789225540c2ac54ea1f71eb327588e8946\",\n+        manifestAndDigest.getDigest().toString());\n+    Assert.assertTrue(manifestAndDigest.getManifest() instanceof V22ManifestTemplate);\n+    V22ManifestTemplate manifest = (V22ManifestTemplate) manifestAndDigest.getManifest();\n+    Assert.assertEquals(2, manifest.getSchemaVersion());\n+    Assert.assertEquals(\n+        \"application/vnd.docker.distribution.manifest.v2+json\", manifest.getManifestMediaType());\n+    Assert.assertEquals(\n+        \"sha256:b5b2b2c507a0944348e0303114d8d93aaaa081732b86451d9bce1f432a537bc7\",\n+        manifest.getContainerConfiguration().getDigest().toString());\n+    Assert.assertEquals(7023, manifest.getContainerConfiguration().getSize());\n+    Assert.assertThat(\n+        registry.getInputRead(),\n+        CoreMatchers.containsString(\"GET /v2/foo/bar/manifests/image-tag HTTP/1.1\"));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "45ead22e5206cc31ba1e0d992007c0171fcdfa52"}, "originalPosition": 45}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzkxMTE1NQ==", "bodyText": "I see !! Done.", "url": "https://github.com/GoogleContainerTools/jib/pull/2555#discussion_r447911155", "createdAt": "2020-06-30T18:57:12Z", "author": {"login": "louismurerwa"}, "path": "jib-core/src/test/java/com/google/cloud/tools/jib/registry/RegistryClientTest.java", "diffHunk": "@@ -211,6 +212,42 @@ public void testConfigureBasicAuth()\n         registry.getInputRead(), CoreMatchers.containsString(\"Authorization: Basic dXNlcjpwYXNz\"));\n   }\n \n+  @Test\n+  public void testPullManifest()\n+      throws IOException, InterruptedException, GeneralSecurityException, URISyntaxException,\n+          RegistryException {\n+    String manifestResponse =\n+        \"HTTP/1.1 200 OK\\nContent-Length: 307\\n\\n{\\n\"\n+            + \"    \\\"schemaVersion\\\": 2,\\n\"\n+            + \"    \\\"mediaType\\\": \\\"application/vnd.docker.distribution.manifest.v2+json\\\",\\n\"\n+            + \"    \\\"config\\\": {\\n\"\n+            + \"        \\\"mediaType\\\": \\\"application/vnd.docker.container.image.v1+json\\\",\\n\"\n+            + \"        \\\"size\\\": 7023,\\n\"\n+            + \"        \\\"digest\\\": \\\"sha256:b5b2b2c507a0944348e0303114d8d93aaaa081732b86451d9bce1f432a537bc7\\\"\\n\"\n+            + \"    }\\n\"\n+            + \"}\";\n+\n+    registry = new TestWebServer(false, Arrays.asList(manifestResponse), 1);\n+    RegistryClient registryClient = createRegistryClient(null);\n+    ManifestAndDigest<?> manifestAndDigest = registryClient.pullManifest(\"image-tag\");\n+\n+    Assert.assertEquals(\n+        \"sha256:6b61466eabab6e5ffb68ae2bd9b85c789225540c2ac54ea1f71eb327588e8946\",\n+        manifestAndDigest.getDigest().toString());\n+    Assert.assertTrue(manifestAndDigest.getManifest() instanceof V22ManifestTemplate);\n+    V22ManifestTemplate manifest = (V22ManifestTemplate) manifestAndDigest.getManifest();\n+    Assert.assertEquals(2, manifest.getSchemaVersion());\n+    Assert.assertEquals(\n+        \"application/vnd.docker.distribution.manifest.v2+json\", manifest.getManifestMediaType());\n+    Assert.assertEquals(\n+        \"sha256:b5b2b2c507a0944348e0303114d8d93aaaa081732b86451d9bce1f432a537bc7\",\n+        manifest.getContainerConfiguration().getDigest().toString());\n+    Assert.assertEquals(7023, manifest.getContainerConfiguration().getSize());\n+    Assert.assertThat(\n+        registry.getInputRead(),\n+        CoreMatchers.containsString(\"GET /v2/foo/bar/manifests/image-tag HTTP/1.1\"));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Nzg4NzY5Ng=="}, "originalCommit": {"oid": "45ead22e5206cc31ba1e0d992007c0171fcdfa52"}, "originalPosition": 45}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc5MjI5MjA2OnYy", "diffSide": "RIGHT", "path": "jib-core/src/test/java/com/google/cloud/tools/jib/registry/RegistryClientTest.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0zMFQyMjowODo1NVrOGrQL_Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMVQxNTo1MzoyMVrOGrrzYw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODAwNzE2NQ==", "bodyText": "nit: put a newline after this for better readability (separating the manifest checks and the endpoint check.)", "url": "https://github.com/GoogleContainerTools/jib/pull/2555#discussion_r448007165", "createdAt": "2020-06-30T22:08:55Z", "author": {"login": "chanseokoh"}, "path": "jib-core/src/test/java/com/google/cloud/tools/jib/registry/RegistryClientTest.java", "diffHunk": "@@ -211,6 +212,42 @@ public void testConfigureBasicAuth()\n         registry.getInputRead(), CoreMatchers.containsString(\"Authorization: Basic dXNlcjpwYXNz\"));\n   }\n \n+  @Test\n+  public void testPullManifest()\n+      throws IOException, InterruptedException, GeneralSecurityException, URISyntaxException,\n+          RegistryException {\n+    String manifestResponse =\n+        \"HTTP/1.1 200 OK\\nContent-Length: 307\\n\\n{\\n\"\n+            + \"    \\\"schemaVersion\\\": 2,\\n\"\n+            + \"    \\\"mediaType\\\": \\\"application/vnd.docker.distribution.manifest.v2+json\\\",\\n\"\n+            + \"    \\\"config\\\": {\\n\"\n+            + \"        \\\"mediaType\\\": \\\"application/vnd.docker.container.image.v1+json\\\",\\n\"\n+            + \"        \\\"size\\\": 7023,\\n\"\n+            + \"        \\\"digest\\\": \\\"sha256:b5b2b2c507a0944348e0303114d8d93aaaa081732b86451d9bce1f432a537bc7\\\"\\n\"\n+            + \"    }\\n\"\n+            + \"}\";\n+\n+    registry = new TestWebServer(false, Arrays.asList(manifestResponse), 1);\n+    RegistryClient registryClient = createRegistryClient(null);\n+    ManifestAndDigest<?> manifestAndDigest = registryClient.pullManifest(\"image-tag\");\n+\n+    Assert.assertEquals(\n+        \"sha256:6b61466eabab6e5ffb68ae2bd9b85c789225540c2ac54ea1f71eb327588e8946\",\n+        manifestAndDigest.getDigest().toString());\n+    Assert.assertTrue(manifestAndDigest.getManifest() instanceof V22ManifestTemplate);\n+    V22ManifestTemplate manifest = (V22ManifestTemplate) manifestAndDigest.getManifest();\n+    Assert.assertEquals(2, manifest.getSchemaVersion());\n+    Assert.assertEquals(\n+        \"application/vnd.docker.distribution.manifest.v2+json\", manifest.getManifestMediaType());\n+    Assert.assertEquals(\n+        \"sha256:b5b2b2c507a0944348e0303114d8d93aaaa081732b86451d9bce1f432a537bc7\",\n+        manifest.getContainerConfiguration().getDigest().toString());\n+    Assert.assertEquals(7023, manifest.getContainerConfiguration().getSize());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "449f4675b39f182043badd50347a2ee7616f1e0e"}, "originalPosition": 42}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODQ1OTYxOQ==", "bodyText": "I had missed this one .Done.", "url": "https://github.com/GoogleContainerTools/jib/pull/2555#discussion_r448459619", "createdAt": "2020-07-01T15:53:21Z", "author": {"login": "louismurerwa"}, "path": "jib-core/src/test/java/com/google/cloud/tools/jib/registry/RegistryClientTest.java", "diffHunk": "@@ -211,6 +212,42 @@ public void testConfigureBasicAuth()\n         registry.getInputRead(), CoreMatchers.containsString(\"Authorization: Basic dXNlcjpwYXNz\"));\n   }\n \n+  @Test\n+  public void testPullManifest()\n+      throws IOException, InterruptedException, GeneralSecurityException, URISyntaxException,\n+          RegistryException {\n+    String manifestResponse =\n+        \"HTTP/1.1 200 OK\\nContent-Length: 307\\n\\n{\\n\"\n+            + \"    \\\"schemaVersion\\\": 2,\\n\"\n+            + \"    \\\"mediaType\\\": \\\"application/vnd.docker.distribution.manifest.v2+json\\\",\\n\"\n+            + \"    \\\"config\\\": {\\n\"\n+            + \"        \\\"mediaType\\\": \\\"application/vnd.docker.container.image.v1+json\\\",\\n\"\n+            + \"        \\\"size\\\": 7023,\\n\"\n+            + \"        \\\"digest\\\": \\\"sha256:b5b2b2c507a0944348e0303114d8d93aaaa081732b86451d9bce1f432a537bc7\\\"\\n\"\n+            + \"    }\\n\"\n+            + \"}\";\n+\n+    registry = new TestWebServer(false, Arrays.asList(manifestResponse), 1);\n+    RegistryClient registryClient = createRegistryClient(null);\n+    ManifestAndDigest<?> manifestAndDigest = registryClient.pullManifest(\"image-tag\");\n+\n+    Assert.assertEquals(\n+        \"sha256:6b61466eabab6e5ffb68ae2bd9b85c789225540c2ac54ea1f71eb327588e8946\",\n+        manifestAndDigest.getDigest().toString());\n+    Assert.assertTrue(manifestAndDigest.getManifest() instanceof V22ManifestTemplate);\n+    V22ManifestTemplate manifest = (V22ManifestTemplate) manifestAndDigest.getManifest();\n+    Assert.assertEquals(2, manifest.getSchemaVersion());\n+    Assert.assertEquals(\n+        \"application/vnd.docker.distribution.manifest.v2+json\", manifest.getManifestMediaType());\n+    Assert.assertEquals(\n+        \"sha256:b5b2b2c507a0944348e0303114d8d93aaaa081732b86451d9bce1f432a537bc7\",\n+        manifest.getContainerConfiguration().getDigest().toString());\n+    Assert.assertEquals(7023, manifest.getContainerConfiguration().getSize());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODAwNzE2NQ=="}, "originalCommit": {"oid": "449f4675b39f182043badd50347a2ee7616f1e0e"}, "originalPosition": 42}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc5MjI5Mzg3OnYy", "diffSide": "RIGHT", "path": "jib-core/src/test/java/com/google/cloud/tools/jib/registry/RegistryClientTest.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0zMFQyMjowOToyMVrOGrQM9A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMVQxNTo1NDowN1rOGrr1Qg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODAwNzQxMg==", "bodyText": "nit: ditto. Let's put a newline after this.", "url": "https://github.com/GoogleContainerTools/jib/pull/2555#discussion_r448007412", "createdAt": "2020-06-30T22:09:21Z", "author": {"login": "chanseokoh"}, "path": "jib-core/src/test/java/com/google/cloud/tools/jib/registry/RegistryClientTest.java", "diffHunk": "@@ -211,6 +212,42 @@ public void testConfigureBasicAuth()\n         registry.getInputRead(), CoreMatchers.containsString(\"Authorization: Basic dXNlcjpwYXNz\"));\n   }\n \n+  @Test\n+  public void testPullManifest()\n+      throws IOException, InterruptedException, GeneralSecurityException, URISyntaxException,\n+          RegistryException {\n+    String manifestResponse =\n+        \"HTTP/1.1 200 OK\\nContent-Length: 307\\n\\n{\\n\"\n+            + \"    \\\"schemaVersion\\\": 2,\\n\"\n+            + \"    \\\"mediaType\\\": \\\"application/vnd.docker.distribution.manifest.v2+json\\\",\\n\"\n+            + \"    \\\"config\\\": {\\n\"\n+            + \"        \\\"mediaType\\\": \\\"application/vnd.docker.container.image.v1+json\\\",\\n\"\n+            + \"        \\\"size\\\": 7023,\\n\"\n+            + \"        \\\"digest\\\": \\\"sha256:b5b2b2c507a0944348e0303114d8d93aaaa081732b86451d9bce1f432a537bc7\\\"\\n\"\n+            + \"    }\\n\"\n+            + \"}\";\n+\n+    registry = new TestWebServer(false, Arrays.asList(manifestResponse), 1);\n+    RegistryClient registryClient = createRegistryClient(null);\n+    ManifestAndDigest<?> manifestAndDigest = registryClient.pullManifest(\"image-tag\");\n+\n+    Assert.assertEquals(\n+        \"sha256:6b61466eabab6e5ffb68ae2bd9b85c789225540c2ac54ea1f71eb327588e8946\",\n+        manifestAndDigest.getDigest().toString());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "449f4675b39f182043badd50347a2ee7616f1e0e"}, "originalPosition": 33}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODQ2MDA5OA==", "bodyText": "Done", "url": "https://github.com/GoogleContainerTools/jib/pull/2555#discussion_r448460098", "createdAt": "2020-07-01T15:54:07Z", "author": {"login": "louismurerwa"}, "path": "jib-core/src/test/java/com/google/cloud/tools/jib/registry/RegistryClientTest.java", "diffHunk": "@@ -211,6 +212,42 @@ public void testConfigureBasicAuth()\n         registry.getInputRead(), CoreMatchers.containsString(\"Authorization: Basic dXNlcjpwYXNz\"));\n   }\n \n+  @Test\n+  public void testPullManifest()\n+      throws IOException, InterruptedException, GeneralSecurityException, URISyntaxException,\n+          RegistryException {\n+    String manifestResponse =\n+        \"HTTP/1.1 200 OK\\nContent-Length: 307\\n\\n{\\n\"\n+            + \"    \\\"schemaVersion\\\": 2,\\n\"\n+            + \"    \\\"mediaType\\\": \\\"application/vnd.docker.distribution.manifest.v2+json\\\",\\n\"\n+            + \"    \\\"config\\\": {\\n\"\n+            + \"        \\\"mediaType\\\": \\\"application/vnd.docker.container.image.v1+json\\\",\\n\"\n+            + \"        \\\"size\\\": 7023,\\n\"\n+            + \"        \\\"digest\\\": \\\"sha256:b5b2b2c507a0944348e0303114d8d93aaaa081732b86451d9bce1f432a537bc7\\\"\\n\"\n+            + \"    }\\n\"\n+            + \"}\";\n+\n+    registry = new TestWebServer(false, Arrays.asList(manifestResponse), 1);\n+    RegistryClient registryClient = createRegistryClient(null);\n+    ManifestAndDigest<?> manifestAndDigest = registryClient.pullManifest(\"image-tag\");\n+\n+    Assert.assertEquals(\n+        \"sha256:6b61466eabab6e5ffb68ae2bd9b85c789225540c2ac54ea1f71eb327588e8946\",\n+        manifestAndDigest.getDigest().toString());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODAwNzQxMg=="}, "originalCommit": {"oid": "449f4675b39f182043badd50347a2ee7616f1e0e"}, "originalPosition": 33}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc5NTAxMjE4OnYy", "diffSide": "RIGHT", "path": "jib-core/src/test/java/com/google/cloud/tools/jib/registry/RegistryClientTest.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMVQxNToxNTowMVrOGrqSrQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMVQxNTozODozN1rOGrrPPQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODQzNDg2MQ==", "bodyText": "getDigestsForPlatform() returns a List object. For complex objects that have multiple other objects/fields/values, often their toString() is more or less an internal/debug string representation of the objects. That is, theoretically the string form generated by List.toString() is not canonical and may change in future Java versions. For verifying the elements in a list, you would rather do\nassertEquals(\n    Arrays.asList(\"sha256:e692418e4cbaf90ca69d05a66403747baa33ee08806650b51fab815ad7fc331f\"), \n    manifestList.getDigestsForPlatform(\"amd64\", \"linux\"));", "url": "https://github.com/GoogleContainerTools/jib/pull/2555#discussion_r448434861", "createdAt": "2020-07-01T15:15:01Z", "author": {"login": "chanseokoh"}, "path": "jib-core/src/test/java/com/google/cloud/tools/jib/registry/RegistryClientTest.java", "diffHunk": "@@ -211,6 +213,82 @@ public void testConfigureBasicAuth()\n         registry.getInputRead(), CoreMatchers.containsString(\"Authorization: Basic dXNlcjpwYXNz\"));\n   }\n \n+  @Test\n+  public void testPullManifest()\n+      throws IOException, InterruptedException, GeneralSecurityException, URISyntaxException,\n+          RegistryException {\n+    String manifestResponse =\n+        \"HTTP/1.1 200 OK\\nContent-Length: 307\\n\\n{\\n\"\n+            + \"    \\\"schemaVersion\\\": 2,\\n\"\n+            + \"    \\\"mediaType\\\": \\\"application/vnd.docker.distribution.manifest.v2+json\\\",\\n\"\n+            + \"    \\\"config\\\": {\\n\"\n+            + \"        \\\"mediaType\\\": \\\"application/vnd.docker.container.image.v1+json\\\",\\n\"\n+            + \"        \\\"size\\\": 7023,\\n\"\n+            + \"        \\\"digest\\\": \\\"sha256:b5b2b2c507a0944348e0303114d8d93aaaa081732b86451d9bce1f432a537bc7\\\"\\n\"\n+            + \"    }\\n\"\n+            + \"}\";\n+\n+    registry = new TestWebServer(false, Arrays.asList(manifestResponse), 1);\n+    RegistryClient registryClient = createRegistryClient(null);\n+    ManifestAndDigest<?> manifestAndDigest = registryClient.pullManifest(\"image-tag\");\n+\n+    Assert.assertEquals(\n+        \"sha256:6b61466eabab6e5ffb68ae2bd9b85c789225540c2ac54ea1f71eb327588e8946\",\n+        manifestAndDigest.getDigest().toString());\n+    Assert.assertTrue(manifestAndDigest.getManifest() instanceof V22ManifestTemplate);\n+    V22ManifestTemplate manifest = (V22ManifestTemplate) manifestAndDigest.getManifest();\n+    Assert.assertEquals(2, manifest.getSchemaVersion());\n+    Assert.assertEquals(\n+        \"application/vnd.docker.distribution.manifest.v2+json\", manifest.getManifestMediaType());\n+    Assert.assertEquals(\n+        \"sha256:b5b2b2c507a0944348e0303114d8d93aaaa081732b86451d9bce1f432a537bc7\",\n+        manifest.getContainerConfiguration().getDigest().toString());\n+    Assert.assertEquals(7023, manifest.getContainerConfiguration().getSize());\n+    Assert.assertThat(\n+        registry.getInputRead(),\n+        CoreMatchers.containsString(\"GET /v2/foo/bar/manifests/image-tag \"));\n+  }\n+\n+  @Test\n+  public void testPullManifest_manifestList()\n+      throws IOException, InterruptedException, GeneralSecurityException, URISyntaxException,\n+          RegistryException {\n+    String manifestResponse =\n+        \"HTTP/1.1 200 OK\\nContent-Length: 403\\n\\n{\\n\"\n+            + \"  \\\"schemaVersion\\\": 2,\\n\"\n+            + \"  \\\"mediaType\\\": \\\"application/vnd.docker.distribution.manifest.list.v2+json\\\",\\n\"\n+            + \"  \\\"manifests\\\": [\\n\"\n+            + \"    {\\n\"\n+            + \"      \\\"mediaType\\\": \\\"application/vnd.docker.distribution.manifest.v2+json\\\",\\n\"\n+            + \"      \\\"size\\\": 7143,\\n\"\n+            + \"      \\\"digest\\\": \\\"sha256:e692418e4cbaf90ca69d05a66403747baa33ee08806650b51fab815ad7fc331f\\\",\\n\"\n+            + \"      \\\"platform\\\": {\\n\"\n+            + \"        \\\"architecture\\\": \\\"amd64\\\",\\n\"\n+            + \"        \\\"os\\\": \\\"linux\\\"\\n\"\n+            + \"      }\\n\"\n+            + \"    }\\n\"\n+            + \"  ]\\n\"\n+            + \"}\";\n+\n+    registry = new TestWebServer(false, Arrays.asList(manifestResponse), 1);\n+    RegistryClient registryClient = createRegistryClient(null);\n+    ManifestAndDigest<?> manifestAndDigest = registryClient.pullManifest(\"image-tag\");\n+\n+    Assert.assertEquals(\n+        \"sha256:a340fa38667f765f8cfd79d4bc684ec8a6f48cdd63abfe36e109f4125ee38488\",\n+        manifestAndDigest.getDigest().toString());\n+    Assert.assertTrue(manifestAndDigest.getManifest() instanceof V22ManifestListTemplate);\n+    V22ManifestListTemplate manifestList =\n+        (V22ManifestListTemplate) manifestAndDigest.getManifest();\n+    Assert.assertEquals(2, manifestList.getSchemaVersion());\n+    Assert.assertEquals(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "66801367a69a3d32e6351740581e8f2d102827dd"}, "originalPosition": 81}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODQ1MDM2NQ==", "bodyText": "done", "url": "https://github.com/GoogleContainerTools/jib/pull/2555#discussion_r448450365", "createdAt": "2020-07-01T15:38:37Z", "author": {"login": "louismurerwa"}, "path": "jib-core/src/test/java/com/google/cloud/tools/jib/registry/RegistryClientTest.java", "diffHunk": "@@ -211,6 +213,82 @@ public void testConfigureBasicAuth()\n         registry.getInputRead(), CoreMatchers.containsString(\"Authorization: Basic dXNlcjpwYXNz\"));\n   }\n \n+  @Test\n+  public void testPullManifest()\n+      throws IOException, InterruptedException, GeneralSecurityException, URISyntaxException,\n+          RegistryException {\n+    String manifestResponse =\n+        \"HTTP/1.1 200 OK\\nContent-Length: 307\\n\\n{\\n\"\n+            + \"    \\\"schemaVersion\\\": 2,\\n\"\n+            + \"    \\\"mediaType\\\": \\\"application/vnd.docker.distribution.manifest.v2+json\\\",\\n\"\n+            + \"    \\\"config\\\": {\\n\"\n+            + \"        \\\"mediaType\\\": \\\"application/vnd.docker.container.image.v1+json\\\",\\n\"\n+            + \"        \\\"size\\\": 7023,\\n\"\n+            + \"        \\\"digest\\\": \\\"sha256:b5b2b2c507a0944348e0303114d8d93aaaa081732b86451d9bce1f432a537bc7\\\"\\n\"\n+            + \"    }\\n\"\n+            + \"}\";\n+\n+    registry = new TestWebServer(false, Arrays.asList(manifestResponse), 1);\n+    RegistryClient registryClient = createRegistryClient(null);\n+    ManifestAndDigest<?> manifestAndDigest = registryClient.pullManifest(\"image-tag\");\n+\n+    Assert.assertEquals(\n+        \"sha256:6b61466eabab6e5ffb68ae2bd9b85c789225540c2ac54ea1f71eb327588e8946\",\n+        manifestAndDigest.getDigest().toString());\n+    Assert.assertTrue(manifestAndDigest.getManifest() instanceof V22ManifestTemplate);\n+    V22ManifestTemplate manifest = (V22ManifestTemplate) manifestAndDigest.getManifest();\n+    Assert.assertEquals(2, manifest.getSchemaVersion());\n+    Assert.assertEquals(\n+        \"application/vnd.docker.distribution.manifest.v2+json\", manifest.getManifestMediaType());\n+    Assert.assertEquals(\n+        \"sha256:b5b2b2c507a0944348e0303114d8d93aaaa081732b86451d9bce1f432a537bc7\",\n+        manifest.getContainerConfiguration().getDigest().toString());\n+    Assert.assertEquals(7023, manifest.getContainerConfiguration().getSize());\n+    Assert.assertThat(\n+        registry.getInputRead(),\n+        CoreMatchers.containsString(\"GET /v2/foo/bar/manifests/image-tag \"));\n+  }\n+\n+  @Test\n+  public void testPullManifest_manifestList()\n+      throws IOException, InterruptedException, GeneralSecurityException, URISyntaxException,\n+          RegistryException {\n+    String manifestResponse =\n+        \"HTTP/1.1 200 OK\\nContent-Length: 403\\n\\n{\\n\"\n+            + \"  \\\"schemaVersion\\\": 2,\\n\"\n+            + \"  \\\"mediaType\\\": \\\"application/vnd.docker.distribution.manifest.list.v2+json\\\",\\n\"\n+            + \"  \\\"manifests\\\": [\\n\"\n+            + \"    {\\n\"\n+            + \"      \\\"mediaType\\\": \\\"application/vnd.docker.distribution.manifest.v2+json\\\",\\n\"\n+            + \"      \\\"size\\\": 7143,\\n\"\n+            + \"      \\\"digest\\\": \\\"sha256:e692418e4cbaf90ca69d05a66403747baa33ee08806650b51fab815ad7fc331f\\\",\\n\"\n+            + \"      \\\"platform\\\": {\\n\"\n+            + \"        \\\"architecture\\\": \\\"amd64\\\",\\n\"\n+            + \"        \\\"os\\\": \\\"linux\\\"\\n\"\n+            + \"      }\\n\"\n+            + \"    }\\n\"\n+            + \"  ]\\n\"\n+            + \"}\";\n+\n+    registry = new TestWebServer(false, Arrays.asList(manifestResponse), 1);\n+    RegistryClient registryClient = createRegistryClient(null);\n+    ManifestAndDigest<?> manifestAndDigest = registryClient.pullManifest(\"image-tag\");\n+\n+    Assert.assertEquals(\n+        \"sha256:a340fa38667f765f8cfd79d4bc684ec8a6f48cdd63abfe36e109f4125ee38488\",\n+        manifestAndDigest.getDigest().toString());\n+    Assert.assertTrue(manifestAndDigest.getManifest() instanceof V22ManifestListTemplate);\n+    V22ManifestListTemplate manifestList =\n+        (V22ManifestListTemplate) manifestAndDigest.getManifest();\n+    Assert.assertEquals(2, manifestList.getSchemaVersion());\n+    Assert.assertEquals(", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODQzNDg2MQ=="}, "originalCommit": {"oid": "66801367a69a3d32e6351740581e8f2d102827dd"}, "originalPosition": 81}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc5NTAxNTczOnYy", "diffSide": "RIGHT", "path": "jib-core/src/test/java/com/google/cloud/tools/jib/registry/RegistryClientTest.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMVQxNToxNTo0N1rOGrqU4g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMVQxNTozODowNVrOGrrOGQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODQzNTQyNg==", "bodyText": "nit: ditto. Let's put a newline after this.", "url": "https://github.com/GoogleContainerTools/jib/pull/2555#discussion_r448435426", "createdAt": "2020-07-01T15:15:47Z", "author": {"login": "chanseokoh"}, "path": "jib-core/src/test/java/com/google/cloud/tools/jib/registry/RegistryClientTest.java", "diffHunk": "@@ -211,6 +213,82 @@ public void testConfigureBasicAuth()\n         registry.getInputRead(), CoreMatchers.containsString(\"Authorization: Basic dXNlcjpwYXNz\"));\n   }\n \n+  @Test\n+  public void testPullManifest()\n+      throws IOException, InterruptedException, GeneralSecurityException, URISyntaxException,\n+          RegistryException {\n+    String manifestResponse =\n+        \"HTTP/1.1 200 OK\\nContent-Length: 307\\n\\n{\\n\"\n+            + \"    \\\"schemaVersion\\\": 2,\\n\"\n+            + \"    \\\"mediaType\\\": \\\"application/vnd.docker.distribution.manifest.v2+json\\\",\\n\"\n+            + \"    \\\"config\\\": {\\n\"\n+            + \"        \\\"mediaType\\\": \\\"application/vnd.docker.container.image.v1+json\\\",\\n\"\n+            + \"        \\\"size\\\": 7023,\\n\"\n+            + \"        \\\"digest\\\": \\\"sha256:b5b2b2c507a0944348e0303114d8d93aaaa081732b86451d9bce1f432a537bc7\\\"\\n\"\n+            + \"    }\\n\"\n+            + \"}\";\n+\n+    registry = new TestWebServer(false, Arrays.asList(manifestResponse), 1);\n+    RegistryClient registryClient = createRegistryClient(null);\n+    ManifestAndDigest<?> manifestAndDigest = registryClient.pullManifest(\"image-tag\");\n+\n+    Assert.assertEquals(\n+        \"sha256:6b61466eabab6e5ffb68ae2bd9b85c789225540c2ac54ea1f71eb327588e8946\",\n+        manifestAndDigest.getDigest().toString());\n+    Assert.assertTrue(manifestAndDigest.getManifest() instanceof V22ManifestTemplate);\n+    V22ManifestTemplate manifest = (V22ManifestTemplate) manifestAndDigest.getManifest();\n+    Assert.assertEquals(2, manifest.getSchemaVersion());\n+    Assert.assertEquals(\n+        \"application/vnd.docker.distribution.manifest.v2+json\", manifest.getManifestMediaType());\n+    Assert.assertEquals(\n+        \"sha256:b5b2b2c507a0944348e0303114d8d93aaaa081732b86451d9bce1f432a537bc7\",\n+        manifest.getContainerConfiguration().getDigest().toString());\n+    Assert.assertEquals(7023, manifest.getContainerConfiguration().getSize());\n+    Assert.assertThat(\n+        registry.getInputRead(),\n+        CoreMatchers.containsString(\"GET /v2/foo/bar/manifests/image-tag \"));\n+  }\n+\n+  @Test\n+  public void testPullManifest_manifestList()\n+      throws IOException, InterruptedException, GeneralSecurityException, URISyntaxException,\n+          RegistryException {\n+    String manifestResponse =\n+        \"HTTP/1.1 200 OK\\nContent-Length: 403\\n\\n{\\n\"\n+            + \"  \\\"schemaVersion\\\": 2,\\n\"\n+            + \"  \\\"mediaType\\\": \\\"application/vnd.docker.distribution.manifest.list.v2+json\\\",\\n\"\n+            + \"  \\\"manifests\\\": [\\n\"\n+            + \"    {\\n\"\n+            + \"      \\\"mediaType\\\": \\\"application/vnd.docker.distribution.manifest.v2+json\\\",\\n\"\n+            + \"      \\\"size\\\": 7143,\\n\"\n+            + \"      \\\"digest\\\": \\\"sha256:e692418e4cbaf90ca69d05a66403747baa33ee08806650b51fab815ad7fc331f\\\",\\n\"\n+            + \"      \\\"platform\\\": {\\n\"\n+            + \"        \\\"architecture\\\": \\\"amd64\\\",\\n\"\n+            + \"        \\\"os\\\": \\\"linux\\\"\\n\"\n+            + \"      }\\n\"\n+            + \"    }\\n\"\n+            + \"  ]\\n\"\n+            + \"}\";\n+\n+    registry = new TestWebServer(false, Arrays.asList(manifestResponse), 1);\n+    RegistryClient registryClient = createRegistryClient(null);\n+    ManifestAndDigest<?> manifestAndDigest = registryClient.pullManifest(\"image-tag\");\n+\n+    Assert.assertEquals(\n+        \"sha256:a340fa38667f765f8cfd79d4bc684ec8a6f48cdd63abfe36e109f4125ee38488\",\n+        manifestAndDigest.getDigest().toString());\n+    Assert.assertTrue(manifestAndDigest.getManifest() instanceof V22ManifestListTemplate);\n+    V22ManifestListTemplate manifestList =\n+        (V22ManifestListTemplate) manifestAndDigest.getManifest();\n+    Assert.assertEquals(2, manifestList.getSchemaVersion());\n+    Assert.assertEquals(\n+        \"[sha256:e692418e4cbaf90ca69d05a66403747baa33ee08806650b51fab815ad7fc331f]\",\n+        manifestList.getDigestsForPlatform(\"amd64\", \"linux\").toString());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "66801367a69a3d32e6351740581e8f2d102827dd"}, "originalPosition": 83}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODQ1MDA3Mw==", "bodyText": "done", "url": "https://github.com/GoogleContainerTools/jib/pull/2555#discussion_r448450073", "createdAt": "2020-07-01T15:38:05Z", "author": {"login": "louismurerwa"}, "path": "jib-core/src/test/java/com/google/cloud/tools/jib/registry/RegistryClientTest.java", "diffHunk": "@@ -211,6 +213,82 @@ public void testConfigureBasicAuth()\n         registry.getInputRead(), CoreMatchers.containsString(\"Authorization: Basic dXNlcjpwYXNz\"));\n   }\n \n+  @Test\n+  public void testPullManifest()\n+      throws IOException, InterruptedException, GeneralSecurityException, URISyntaxException,\n+          RegistryException {\n+    String manifestResponse =\n+        \"HTTP/1.1 200 OK\\nContent-Length: 307\\n\\n{\\n\"\n+            + \"    \\\"schemaVersion\\\": 2,\\n\"\n+            + \"    \\\"mediaType\\\": \\\"application/vnd.docker.distribution.manifest.v2+json\\\",\\n\"\n+            + \"    \\\"config\\\": {\\n\"\n+            + \"        \\\"mediaType\\\": \\\"application/vnd.docker.container.image.v1+json\\\",\\n\"\n+            + \"        \\\"size\\\": 7023,\\n\"\n+            + \"        \\\"digest\\\": \\\"sha256:b5b2b2c507a0944348e0303114d8d93aaaa081732b86451d9bce1f432a537bc7\\\"\\n\"\n+            + \"    }\\n\"\n+            + \"}\";\n+\n+    registry = new TestWebServer(false, Arrays.asList(manifestResponse), 1);\n+    RegistryClient registryClient = createRegistryClient(null);\n+    ManifestAndDigest<?> manifestAndDigest = registryClient.pullManifest(\"image-tag\");\n+\n+    Assert.assertEquals(\n+        \"sha256:6b61466eabab6e5ffb68ae2bd9b85c789225540c2ac54ea1f71eb327588e8946\",\n+        manifestAndDigest.getDigest().toString());\n+    Assert.assertTrue(manifestAndDigest.getManifest() instanceof V22ManifestTemplate);\n+    V22ManifestTemplate manifest = (V22ManifestTemplate) manifestAndDigest.getManifest();\n+    Assert.assertEquals(2, manifest.getSchemaVersion());\n+    Assert.assertEquals(\n+        \"application/vnd.docker.distribution.manifest.v2+json\", manifest.getManifestMediaType());\n+    Assert.assertEquals(\n+        \"sha256:b5b2b2c507a0944348e0303114d8d93aaaa081732b86451d9bce1f432a537bc7\",\n+        manifest.getContainerConfiguration().getDigest().toString());\n+    Assert.assertEquals(7023, manifest.getContainerConfiguration().getSize());\n+    Assert.assertThat(\n+        registry.getInputRead(),\n+        CoreMatchers.containsString(\"GET /v2/foo/bar/manifests/image-tag \"));\n+  }\n+\n+  @Test\n+  public void testPullManifest_manifestList()\n+      throws IOException, InterruptedException, GeneralSecurityException, URISyntaxException,\n+          RegistryException {\n+    String manifestResponse =\n+        \"HTTP/1.1 200 OK\\nContent-Length: 403\\n\\n{\\n\"\n+            + \"  \\\"schemaVersion\\\": 2,\\n\"\n+            + \"  \\\"mediaType\\\": \\\"application/vnd.docker.distribution.manifest.list.v2+json\\\",\\n\"\n+            + \"  \\\"manifests\\\": [\\n\"\n+            + \"    {\\n\"\n+            + \"      \\\"mediaType\\\": \\\"application/vnd.docker.distribution.manifest.v2+json\\\",\\n\"\n+            + \"      \\\"size\\\": 7143,\\n\"\n+            + \"      \\\"digest\\\": \\\"sha256:e692418e4cbaf90ca69d05a66403747baa33ee08806650b51fab815ad7fc331f\\\",\\n\"\n+            + \"      \\\"platform\\\": {\\n\"\n+            + \"        \\\"architecture\\\": \\\"amd64\\\",\\n\"\n+            + \"        \\\"os\\\": \\\"linux\\\"\\n\"\n+            + \"      }\\n\"\n+            + \"    }\\n\"\n+            + \"  ]\\n\"\n+            + \"}\";\n+\n+    registry = new TestWebServer(false, Arrays.asList(manifestResponse), 1);\n+    RegistryClient registryClient = createRegistryClient(null);\n+    ManifestAndDigest<?> manifestAndDigest = registryClient.pullManifest(\"image-tag\");\n+\n+    Assert.assertEquals(\n+        \"sha256:a340fa38667f765f8cfd79d4bc684ec8a6f48cdd63abfe36e109f4125ee38488\",\n+        manifestAndDigest.getDigest().toString());\n+    Assert.assertTrue(manifestAndDigest.getManifest() instanceof V22ManifestListTemplate);\n+    V22ManifestListTemplate manifestList =\n+        (V22ManifestListTemplate) manifestAndDigest.getManifest();\n+    Assert.assertEquals(2, manifestList.getSchemaVersion());\n+    Assert.assertEquals(\n+        \"[sha256:e692418e4cbaf90ca69d05a66403747baa33ee08806650b51fab815ad7fc331f]\",\n+        manifestList.getDigestsForPlatform(\"amd64\", \"linux\").toString());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODQzNTQyNg=="}, "originalCommit": {"oid": "66801367a69a3d32e6351740581e8f2d102827dd"}, "originalPosition": 83}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc5NTAxNjc1OnYy", "diffSide": "RIGHT", "path": "jib-core/src/test/java/com/google/cloud/tools/jib/registry/RegistryClientTest.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMVQxNToxNjowN1rOGrqVng==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMVQxNTozODoxNFrOGrrOZw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODQzNTYxNA==", "bodyText": "nit: ditto. Let's put a newline after this.", "url": "https://github.com/GoogleContainerTools/jib/pull/2555#discussion_r448435614", "createdAt": "2020-07-01T15:16:07Z", "author": {"login": "chanseokoh"}, "path": "jib-core/src/test/java/com/google/cloud/tools/jib/registry/RegistryClientTest.java", "diffHunk": "@@ -211,6 +213,82 @@ public void testConfigureBasicAuth()\n         registry.getInputRead(), CoreMatchers.containsString(\"Authorization: Basic dXNlcjpwYXNz\"));\n   }\n \n+  @Test\n+  public void testPullManifest()\n+      throws IOException, InterruptedException, GeneralSecurityException, URISyntaxException,\n+          RegistryException {\n+    String manifestResponse =\n+        \"HTTP/1.1 200 OK\\nContent-Length: 307\\n\\n{\\n\"\n+            + \"    \\\"schemaVersion\\\": 2,\\n\"\n+            + \"    \\\"mediaType\\\": \\\"application/vnd.docker.distribution.manifest.v2+json\\\",\\n\"\n+            + \"    \\\"config\\\": {\\n\"\n+            + \"        \\\"mediaType\\\": \\\"application/vnd.docker.container.image.v1+json\\\",\\n\"\n+            + \"        \\\"size\\\": 7023,\\n\"\n+            + \"        \\\"digest\\\": \\\"sha256:b5b2b2c507a0944348e0303114d8d93aaaa081732b86451d9bce1f432a537bc7\\\"\\n\"\n+            + \"    }\\n\"\n+            + \"}\";\n+\n+    registry = new TestWebServer(false, Arrays.asList(manifestResponse), 1);\n+    RegistryClient registryClient = createRegistryClient(null);\n+    ManifestAndDigest<?> manifestAndDigest = registryClient.pullManifest(\"image-tag\");\n+\n+    Assert.assertEquals(\n+        \"sha256:6b61466eabab6e5ffb68ae2bd9b85c789225540c2ac54ea1f71eb327588e8946\",\n+        manifestAndDigest.getDigest().toString());\n+    Assert.assertTrue(manifestAndDigest.getManifest() instanceof V22ManifestTemplate);\n+    V22ManifestTemplate manifest = (V22ManifestTemplate) manifestAndDigest.getManifest();\n+    Assert.assertEquals(2, manifest.getSchemaVersion());\n+    Assert.assertEquals(\n+        \"application/vnd.docker.distribution.manifest.v2+json\", manifest.getManifestMediaType());\n+    Assert.assertEquals(\n+        \"sha256:b5b2b2c507a0944348e0303114d8d93aaaa081732b86451d9bce1f432a537bc7\",\n+        manifest.getContainerConfiguration().getDigest().toString());\n+    Assert.assertEquals(7023, manifest.getContainerConfiguration().getSize());\n+    Assert.assertThat(\n+        registry.getInputRead(),\n+        CoreMatchers.containsString(\"GET /v2/foo/bar/manifests/image-tag \"));\n+  }\n+\n+  @Test\n+  public void testPullManifest_manifestList()\n+      throws IOException, InterruptedException, GeneralSecurityException, URISyntaxException,\n+          RegistryException {\n+    String manifestResponse =\n+        \"HTTP/1.1 200 OK\\nContent-Length: 403\\n\\n{\\n\"\n+            + \"  \\\"schemaVersion\\\": 2,\\n\"\n+            + \"  \\\"mediaType\\\": \\\"application/vnd.docker.distribution.manifest.list.v2+json\\\",\\n\"\n+            + \"  \\\"manifests\\\": [\\n\"\n+            + \"    {\\n\"\n+            + \"      \\\"mediaType\\\": \\\"application/vnd.docker.distribution.manifest.v2+json\\\",\\n\"\n+            + \"      \\\"size\\\": 7143,\\n\"\n+            + \"      \\\"digest\\\": \\\"sha256:e692418e4cbaf90ca69d05a66403747baa33ee08806650b51fab815ad7fc331f\\\",\\n\"\n+            + \"      \\\"platform\\\": {\\n\"\n+            + \"        \\\"architecture\\\": \\\"amd64\\\",\\n\"\n+            + \"        \\\"os\\\": \\\"linux\\\"\\n\"\n+            + \"      }\\n\"\n+            + \"    }\\n\"\n+            + \"  ]\\n\"\n+            + \"}\";\n+\n+    registry = new TestWebServer(false, Arrays.asList(manifestResponse), 1);\n+    RegistryClient registryClient = createRegistryClient(null);\n+    ManifestAndDigest<?> manifestAndDigest = registryClient.pullManifest(\"image-tag\");\n+\n+    Assert.assertEquals(\n+        \"sha256:a340fa38667f765f8cfd79d4bc684ec8a6f48cdd63abfe36e109f4125ee38488\",\n+        manifestAndDigest.getDigest().toString());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "66801367a69a3d32e6351740581e8f2d102827dd"}, "originalPosition": 76}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODQ1MDE1MQ==", "bodyText": "done", "url": "https://github.com/GoogleContainerTools/jib/pull/2555#discussion_r448450151", "createdAt": "2020-07-01T15:38:14Z", "author": {"login": "louismurerwa"}, "path": "jib-core/src/test/java/com/google/cloud/tools/jib/registry/RegistryClientTest.java", "diffHunk": "@@ -211,6 +213,82 @@ public void testConfigureBasicAuth()\n         registry.getInputRead(), CoreMatchers.containsString(\"Authorization: Basic dXNlcjpwYXNz\"));\n   }\n \n+  @Test\n+  public void testPullManifest()\n+      throws IOException, InterruptedException, GeneralSecurityException, URISyntaxException,\n+          RegistryException {\n+    String manifestResponse =\n+        \"HTTP/1.1 200 OK\\nContent-Length: 307\\n\\n{\\n\"\n+            + \"    \\\"schemaVersion\\\": 2,\\n\"\n+            + \"    \\\"mediaType\\\": \\\"application/vnd.docker.distribution.manifest.v2+json\\\",\\n\"\n+            + \"    \\\"config\\\": {\\n\"\n+            + \"        \\\"mediaType\\\": \\\"application/vnd.docker.container.image.v1+json\\\",\\n\"\n+            + \"        \\\"size\\\": 7023,\\n\"\n+            + \"        \\\"digest\\\": \\\"sha256:b5b2b2c507a0944348e0303114d8d93aaaa081732b86451d9bce1f432a537bc7\\\"\\n\"\n+            + \"    }\\n\"\n+            + \"}\";\n+\n+    registry = new TestWebServer(false, Arrays.asList(manifestResponse), 1);\n+    RegistryClient registryClient = createRegistryClient(null);\n+    ManifestAndDigest<?> manifestAndDigest = registryClient.pullManifest(\"image-tag\");\n+\n+    Assert.assertEquals(\n+        \"sha256:6b61466eabab6e5ffb68ae2bd9b85c789225540c2ac54ea1f71eb327588e8946\",\n+        manifestAndDigest.getDigest().toString());\n+    Assert.assertTrue(manifestAndDigest.getManifest() instanceof V22ManifestTemplate);\n+    V22ManifestTemplate manifest = (V22ManifestTemplate) manifestAndDigest.getManifest();\n+    Assert.assertEquals(2, manifest.getSchemaVersion());\n+    Assert.assertEquals(\n+        \"application/vnd.docker.distribution.manifest.v2+json\", manifest.getManifestMediaType());\n+    Assert.assertEquals(\n+        \"sha256:b5b2b2c507a0944348e0303114d8d93aaaa081732b86451d9bce1f432a537bc7\",\n+        manifest.getContainerConfiguration().getDigest().toString());\n+    Assert.assertEquals(7023, manifest.getContainerConfiguration().getSize());\n+    Assert.assertThat(\n+        registry.getInputRead(),\n+        CoreMatchers.containsString(\"GET /v2/foo/bar/manifests/image-tag \"));\n+  }\n+\n+  @Test\n+  public void testPullManifest_manifestList()\n+      throws IOException, InterruptedException, GeneralSecurityException, URISyntaxException,\n+          RegistryException {\n+    String manifestResponse =\n+        \"HTTP/1.1 200 OK\\nContent-Length: 403\\n\\n{\\n\"\n+            + \"  \\\"schemaVersion\\\": 2,\\n\"\n+            + \"  \\\"mediaType\\\": \\\"application/vnd.docker.distribution.manifest.list.v2+json\\\",\\n\"\n+            + \"  \\\"manifests\\\": [\\n\"\n+            + \"    {\\n\"\n+            + \"      \\\"mediaType\\\": \\\"application/vnd.docker.distribution.manifest.v2+json\\\",\\n\"\n+            + \"      \\\"size\\\": 7143,\\n\"\n+            + \"      \\\"digest\\\": \\\"sha256:e692418e4cbaf90ca69d05a66403747baa33ee08806650b51fab815ad7fc331f\\\",\\n\"\n+            + \"      \\\"platform\\\": {\\n\"\n+            + \"        \\\"architecture\\\": \\\"amd64\\\",\\n\"\n+            + \"        \\\"os\\\": \\\"linux\\\"\\n\"\n+            + \"      }\\n\"\n+            + \"    }\\n\"\n+            + \"  ]\\n\"\n+            + \"}\";\n+\n+    registry = new TestWebServer(false, Arrays.asList(manifestResponse), 1);\n+    RegistryClient registryClient = createRegistryClient(null);\n+    ManifestAndDigest<?> manifestAndDigest = registryClient.pullManifest(\"image-tag\");\n+\n+    Assert.assertEquals(\n+        \"sha256:a340fa38667f765f8cfd79d4bc684ec8a6f48cdd63abfe36e109f4125ee38488\",\n+        manifestAndDigest.getDigest().toString());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODQzNTYxNA=="}, "originalCommit": {"oid": "66801367a69a3d32e6351740581e8f2d102827dd"}, "originalPosition": 76}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 225, "cost": 1, "resetAt": "2021-11-12T19:05:54Z"}}}