{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg5OTY4MDg1", "number": 2337, "title": "Migrate deprecated LayerConfiguration and LayerEntry usage", "bodyText": "Continuing the work for the Jib extension framework.\nRefactored our codebase to use the new classes in the \"Build Plan\" project.\nI'll add CHANGELOG in a later PR.", "createdAt": "2020-03-17T17:14:45Z", "url": "https://github.com/GoogleContainerTools/jib/pull/2337", "merged": true, "mergeCommit": {"oid": "27c7f7b0e5963add20f7cda09e5eb746323ba27b"}, "closed": true, "closedAt": "2020-03-18T22:32:58Z", "author": {"login": "chanseokoh"}, "timelineItems": {"totalCount": 27, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcOPcgWAH2gAyMzg5OTY4MDg1OmVmZGM0YjQwODUwZDYxN2U2NjVjOTllMDVmNWVkNmJhMjk3MTJhOGI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcO-VRLAH2gAyMzg5OTY4MDg1OmZiZTM5OGFlNjEwYWMyYmJhZTdlMWY2NjQyN2VkYmJmYjYyYjQwYTU=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "efdc4b40850d617e665c99e05f5ed6ba29712a8b", "author": {"user": {"login": "chanseokoh", "name": "Chanseok Oh"}}, "url": "https://github.com/GoogleContainerTools/jib/commit/efdc4b40850d617e665c99e05f5ed6ba29712a8b", "committedDate": "2020-03-16T15:00:44Z", "message": "Move build-plan packages"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "28e9f356fed0e9a1d2689081b11999468a6fb510", "author": {"user": {"login": "chanseokoh", "name": "Chanseok Oh"}}, "url": "https://github.com/GoogleContainerTools/jib/commit/28e9f356fed0e9a1d2689081b11999468a6fb510", "committedDate": "2020-03-16T16:03:04Z", "message": "Migrate to buildplan API classes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "151478d212c57d73d3e56b8988638292c0b086c2", "author": {"user": {"login": "chanseokoh", "name": "Chanseok Oh"}}, "url": "https://github.com/GoogleContainerTools/jib/commit/151478d212c57d73d3e56b8988638292c0b086c2", "committedDate": "2020-03-16T16:11:15Z", "message": "Fix code format"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ec87824c1b2ff3c1c48fc2b9635937f1a3f00072", "author": {"user": {"login": "chanseokoh", "name": "Chanseok Oh"}}, "url": "https://github.com/GoogleContainerTools/jib/commit/ec87824c1b2ff3c1c48fc2b9635937f1a3f00072", "committedDate": "2020-03-16T16:41:57Z", "message": "wip"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6529d4546d08b4804dd759a5dd785a8864a58a80", "author": {"user": {"login": "chanseokoh", "name": "Chanseok Oh"}}, "url": "https://github.com/GoogleContainerTools/jib/commit/6529d4546d08b4804dd759a5dd785a8864a58a80", "committedDate": "2020-03-16T21:18:50Z", "message": "Merge branch 'master' into migrate-core-classes-in-jib-core"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b228223fbca0b4d10488e544c2e49c317eec7556", "author": {"user": {"login": "chanseokoh", "name": "Chanseok Oh"}}, "url": "https://github.com/GoogleContainerTools/jib/commit/b228223fbca0b4d10488e544c2e49c317eec7556", "committedDate": "2020-03-16T21:25:35Z", "message": "Fix tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ed4c2c0cccf7c16306c79e5c5fa9085abfb53409", "author": {"user": {"login": "chanseokoh", "name": "Chanseok Oh"}}, "url": "https://github.com/GoogleContainerTools/jib/commit/ed4c2c0cccf7c16306c79e5c5fa9085abfb53409", "committedDate": "2020-03-16T21:29:24Z", "message": "More migration"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c9b2153990263e62ec0cf6ba439acb0b3950b41a", "author": {"user": {"login": "chanseokoh", "name": "Chanseok Oh"}}, "url": "https://github.com/GoogleContainerTools/jib/commit/c9b2153990263e62ec0cf6ba439acb0b3950b41a", "committedDate": "2020-03-16T21:37:57Z", "message": "format"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "231889fad7f5c3c6a56deb0c4a3aafb3a9301906", "author": {"user": {"login": "chanseokoh", "name": "Chanseok Oh"}}, "url": "https://github.com/GoogleContainerTools/jib/commit/231889fad7f5c3c6a56deb0c4a3aafb3a9301906", "committedDate": "2020-03-16T21:53:33Z", "message": "sourceProject(':jib-build-plan') in jib-gradle-plugin"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1f3b9bb821cbebf8c55f3bce952cafb51740b4ee", "author": {"user": {"login": "chanseokoh", "name": "Chanseok Oh"}}, "url": "https://github.com/GoogleContainerTools/jib/commit/1f3b9bb821cbebf8c55f3bce952cafb51740b4ee", "committedDate": "2020-03-16T22:04:08Z", "message": "Consistency"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5994eb27a806ddb7d75d2cd828162bff46dea355", "author": {"user": {"login": "chanseokoh", "name": "Chanseok Oh"}}, "url": "https://github.com/GoogleContainerTools/jib/commit/5994eb27a806ddb7d75d2cd828162bff46dea355", "committedDate": "2020-03-16T22:49:54Z", "message": "Deprecate LayerConfiguration and LayerEntry"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "94e8adee09baf0cfd363f61f5b7aa8e255a3457c", "author": {"user": {"login": "chanseokoh", "name": "Chanseok Oh"}}, "url": "https://github.com/GoogleContainerTools/jib/commit/94e8adee09baf0cfd363f61f5b7aa8e255a3457c", "committedDate": "2020-03-16T23:45:33Z", "message": "Complete migration"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "607dd7fff384c41cc3437b076cf19f6337738251", "author": {"user": {"login": "chanseokoh", "name": "Chanseok Oh"}}, "url": "https://github.com/GoogleContainerTools/jib/commit/607dd7fff384c41cc3437b076cf19f6337738251", "committedDate": "2020-03-16T23:46:33Z", "message": "CHANGELOG"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "eeea488488e42a905a23d4b2af562dcef1ee5289", "author": {"user": {"login": "chanseokoh", "name": "Chanseok Oh"}}, "url": "https://github.com/GoogleContainerTools/jib/commit/eeea488488e42a905a23d4b2af562dcef1ee5289", "committedDate": "2020-03-16T23:56:37Z", "message": "More migration"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cef70b05b322b5f9fdd00e6ce5b100f03971f555", "author": {"user": {"login": "chanseokoh", "name": "Chanseok Oh"}}, "url": "https://github.com/GoogleContainerTools/jib/commit/cef70b05b322b5f9fdd00e6ce5b100f03971f555", "committedDate": "2020-03-17T00:00:28Z", "message": "Fix Javadoc"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dcd201a4bc7e364278556adce0eb881048a2dfdb", "author": {"user": {"login": "chanseokoh", "name": "Chanseok Oh"}}, "url": "https://github.com/GoogleContainerTools/jib/commit/dcd201a4bc7e364278556adce0eb881048a2dfdb", "committedDate": "2020-03-17T14:44:01Z", "message": "Merge remote-tracking branch 'origin/master' into migrate-LayerConfiguration-LayerEntry"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "55ed121dc7cc2fa16d11d93d568dc6622c8eaf95", "author": {"user": {"login": "chanseokoh", "name": "Chanseok Oh"}}, "url": "https://github.com/GoogleContainerTools/jib/commit/55ed121dc7cc2fa16d11d93d568dc6622c8eaf95", "committedDate": "2020-03-17T14:48:16Z", "message": "Refactor"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "62f1e35cb827c618aa0eaf1bf6cca6dda59cd8b5", "author": {"user": {"login": "chanseokoh", "name": "Chanseok Oh"}}, "url": "https://github.com/GoogleContainerTools/jib/commit/62f1e35cb827c618aa0eaf1bf6cca6dda59cd8b5", "committedDate": "2020-03-17T14:50:41Z", "message": "Merge branch 'migrate-LayerConfiguration-LayerEntry' into migrate-LayerConfiguration-LayerEntry-complete"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "21e0254c7b006083eb5c241425fff692b491d399", "author": {"user": {"login": "chanseokoh", "name": "Chanseok Oh"}}, "url": "https://github.com/GoogleContainerTools/jib/commit/21e0254c7b006083eb5c241425fff692b491d399", "committedDate": "2020-03-17T14:53:36Z", "message": "Refactor 2"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "737e7947428edbbaf36ccaacd79c7d34fa740cec", "author": {"user": {"login": "chanseokoh", "name": "Chanseok Oh"}}, "url": "https://github.com/GoogleContainerTools/jib/commit/737e7947428edbbaf36ccaacd79c7d34fa740cec", "committedDate": "2020-03-17T14:59:07Z", "message": "Refactor 3"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "216fb4340eb3d527c4133614be449acbd336aa6e", "author": {"user": {"login": "chanseokoh", "name": "Chanseok Oh"}}, "url": "https://github.com/GoogleContainerTools/jib/commit/216fb4340eb3d527c4133614be449acbd336aa6e", "committedDate": "2020-03-17T15:29:50Z", "message": "Merge branch 'migrate-LayerConfiguration-LayerEntry' into migrate-LayerConfiguration-LayerEntry-complete"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ce28c53404a1a1a8eafce06123112f6880a2bbb4", "author": {"user": {"login": "chanseokoh", "name": "Chanseok Oh"}}, "url": "https://github.com/GoogleContainerTools/jib/commit/ce28c53404a1a1a8eafce06123112f6880a2bbb4", "committedDate": "2020-03-17T17:12:13Z", "message": "More changes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "afa869b0f47d11e4a5a801633a59bc4b48f72880", "author": {"user": {"login": "chanseokoh", "name": "Chanseok Oh"}}, "url": "https://github.com/GoogleContainerTools/jib/commit/afa869b0f47d11e4a5a801633a59bc4b48f72880", "committedDate": "2020-03-17T18:08:20Z", "message": "Revert CHANGELOG"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2de418f1252fd2630cadee6a7a42e7a81018f8c2", "author": {"user": {"login": "chanseokoh", "name": "Chanseok Oh"}}, "url": "https://github.com/GoogleContainerTools/jib/commit/2de418f1252fd2630cadee6a7a42e7a81018f8c2", "committedDate": "2020-03-17T19:38:47Z", "message": "Merge remote-tracking branch 'origin/master' into migrate-LayerConfiguration-LayerEntry-complete"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "df357893136a8176419c1efd3943db6b8ef49863", "author": {"user": {"login": "chanseokoh", "name": "Chanseok Oh"}}, "url": "https://github.com/GoogleContainerTools/jib/commit/df357893136a8176419c1efd3943db6b8ef49863", "committedDate": "2020-03-17T19:38:55Z", "message": "Merge branch 'migrate-LayerConfiguration-LayerEntry-complete' of https://github.com/GoogleContainerTools/jib into migrate-LayerConfiguration-LayerEntry-complete"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc3MjIzMjYx", "url": "https://github.com/GoogleContainerTools/jib/pull/2337#pullrequestreview-377223261", "createdAt": "2020-03-18T20:47:50Z", "commit": {"oid": "df357893136a8176419c1efd3943db6b8ef49863"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOFQyMDo0Nzo1MFrOF4WTbg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOFQyMDo0Nzo1MFrOF4WTbg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDYyOTk5OA==", "bodyText": "should this call setFileEntriesLayers with the final result of the stream.collect?", "url": "https://github.com/GoogleContainerTools/jib/pull/2337#discussion_r394629998", "createdAt": "2020-03-18T20:47:50Z", "author": {"login": "loosebazooka"}, "path": "jib-core/src/main/java/com/google/cloud/tools/jib/api/JibContainerBuilder.java", "diffHunk": "@@ -167,36 +170,82 @@ public JibContainerBuilder addLayer(List<Path> files, String pathInContainer) th\n   /**\n    * Adds a layer (defined by a {@link LayerConfiguration}).\n    *\n+   * <p>Deprecated. Use {@link #addFileEntriesLayer(FileEntriesLayer)}.\n+   *\n    * @param layerConfiguration the {@link LayerConfiguration}\n    * @return this\n    */\n+  @Deprecated\n   public JibContainerBuilder addLayer(LayerConfiguration layerConfiguration) {\n-    layerConfigurations.add(layerConfiguration);\n+    layerConfigurations.add(layerConfiguration.toFileEntriesLayer());\n+    return this;\n+  }\n+\n+  /**\n+   * Adds a layer (defined by a {@link FileEntriesLayer}).\n+   *\n+   * @param layer the {@link FileEntriesLayer}\n+   * @return this\n+   */\n+  public JibContainerBuilder addFileEntriesLayer(FileEntriesLayer layer) {\n+    layerConfigurations.add(layer);\n     return this;\n   }\n \n   /**\n    * Sets the layers (defined by a list of {@link LayerConfiguration}s). This replaces any\n    * previously-added layers.\n    *\n+   * <p>Deprecated. Use {@link #setFileEntriesLayers(List)}.\n+   *\n    * @param layerConfigurations the list of {@link LayerConfiguration}s\n    * @return this\n    */\n+  @Deprecated\n   public JibContainerBuilder setLayers(List<LayerConfiguration> layerConfigurations) {\n-    this.layerConfigurations = new ArrayList<>(layerConfigurations);\n+    this.layerConfigurations =\n+        layerConfigurations\n+            .stream()\n+            .map(LayerConfiguration::toFileEntriesLayer)\n+            .collect(Collectors.toList());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "df357893136a8176419c1efd3943db6b8ef49863"}, "originalPosition": 86}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fbe398ae610ac2bbae7e1f66427edbbfb62b40a5", "author": {"user": {"login": "chanseokoh", "name": "Chanseok Oh"}}, "url": "https://github.com/GoogleContainerTools/jib/commit/fbe398ae610ac2bbae7e1f66427edbbfb62b40a5", "committedDate": "2020-03-18T21:38:22Z", "message": "Call new function from deprecated one"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 405, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}