{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTEwMzQxODA5", "number": 2866, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yN1QwNjowNDo1NlrOEyMdNQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQxODo0MToyNFrOE0gWXw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIxMDY4MzQxOnYy", "diffSide": "RIGHT", "path": "jib-core/src/main/java/com/google/cloud/tools/jib/global/JibSystemProperties.java", "isResolved": false, "comments": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yN1QwNjowNDo1NlrOHosl3w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yN1QxNTozNjoyMFrOHpCsNA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjQzNTY3OQ==", "bodyText": "I realize this is a draft, but I'm not super fond of this name. I sometimes think preserveClasspathOrder is a decent name, but i'm not sure.", "url": "https://github.com/GoogleContainerTools/jib/pull/2866#discussion_r512435679", "createdAt": "2020-10-27T06:04:56Z", "author": {"login": "loosebazooka"}, "path": "jib-core/src/main/java/com/google/cloud/tools/jib/global/JibSystemProperties.java", "diffHunk": "@@ -32,10 +33,12 @@\n   public static final String SEND_CREDENTIALS_OVER_HTTP = \"sendCredentialsOverHttp\";\n   public static final String SERIALIZE = \"jib.serialize\";\n \n-  private static final String DISABLE_USER_AGENT = \"_JIB_DISABLE_USER_AGENT\";\n-\n   @VisibleForTesting public static final String SKIP_EXISTING_IMAGES = \"jib.skipExistingImages\";\n \n+  @VisibleForTesting\n+  static final String USE_WILDCARD_FOR_DEPENDENCY_CLASSPATH =\n+      \"jib.useWildcardForDependencyClasspath\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "17308cb290ba03b22106e44a12359726fe9554cd"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjcyODk2OQ==", "bodyText": "Sounds good. And this made me realize that JibSystemProperties is for jib-core. The property should be in jib-plugins-common.", "url": "https://github.com/GoogleContainerTools/jib/pull/2866#discussion_r512728969", "createdAt": "2020-10-27T14:15:59Z", "author": {"login": "chanseokoh"}, "path": "jib-core/src/main/java/com/google/cloud/tools/jib/global/JibSystemProperties.java", "diffHunk": "@@ -32,10 +33,12 @@\n   public static final String SEND_CREDENTIALS_OVER_HTTP = \"sendCredentialsOverHttp\";\n   public static final String SERIALIZE = \"jib.serialize\";\n \n-  private static final String DISABLE_USER_AGENT = \"_JIB_DISABLE_USER_AGENT\";\n-\n   @VisibleForTesting public static final String SKIP_EXISTING_IMAGES = \"jib.skipExistingImages\";\n \n+  @VisibleForTesting\n+  static final String USE_WILDCARD_FOR_DEPENDENCY_CLASSPATH =\n+      \"jib.useWildcardForDependencyClasspath\";", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjQzNTY3OQ=="}, "originalCommit": {"oid": "17308cb290ba03b22106e44a12359726fe9554cd"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjc0MTU5NA==", "bodyText": "I think it's natural to negate the name, such as noClasspathOrderPreserving. The PropertyNames class only defines property names, and Boolean.getBoolean() doesn't have a way to return true as default (which I think makes sense to avoid confusion).", "url": "https://github.com/GoogleContainerTools/jib/pull/2866#discussion_r512741594", "createdAt": "2020-10-27T14:30:19Z", "author": {"login": "chanseokoh"}, "path": "jib-core/src/main/java/com/google/cloud/tools/jib/global/JibSystemProperties.java", "diffHunk": "@@ -32,10 +33,12 @@\n   public static final String SEND_CREDENTIALS_OVER_HTTP = \"sendCredentialsOverHttp\";\n   public static final String SERIALIZE = \"jib.serialize\";\n \n-  private static final String DISABLE_USER_AGENT = \"_JIB_DISABLE_USER_AGENT\";\n-\n   @VisibleForTesting public static final String SKIP_EXISTING_IMAGES = \"jib.skipExistingImages\";\n \n+  @VisibleForTesting\n+  static final String USE_WILDCARD_FOR_DEPENDENCY_CLASSPATH =\n+      \"jib.useWildcardForDependencyClasspath\";", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjQzNTY3OQ=="}, "originalCommit": {"oid": "17308cb290ba03b22106e44a12359726fe9554cd"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjc1MDEwNg==", "bodyText": "Hrmm.. maybe in that case, your naming makes more sense. useClasspathWildcard is similar but shorter?\nAlso any idea if we would include this as a config option rather than system property?", "url": "https://github.com/GoogleContainerTools/jib/pull/2866#discussion_r512750106", "createdAt": "2020-10-27T14:40:26Z", "author": {"login": "loosebazooka"}, "path": "jib-core/src/main/java/com/google/cloud/tools/jib/global/JibSystemProperties.java", "diffHunk": "@@ -32,10 +33,12 @@\n   public static final String SEND_CREDENTIALS_OVER_HTTP = \"sendCredentialsOverHttp\";\n   public static final String SERIALIZE = \"jib.serialize\";\n \n-  private static final String DISABLE_USER_AGENT = \"_JIB_DISABLE_USER_AGENT\";\n-\n   @VisibleForTesting public static final String SKIP_EXISTING_IMAGES = \"jib.skipExistingImages\";\n \n+  @VisibleForTesting\n+  static final String USE_WILDCARD_FOR_DEPENDENCY_CLASSPATH =\n+      \"jib.useWildcardForDependencyClasspath\";", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjQzNTY3OQ=="}, "originalCommit": {"oid": "17308cb290ba03b22106e44a12359726fe9554cd"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjc1MTI1MQ==", "bodyText": "Actually maybe the full name is necessary", "url": "https://github.com/GoogleContainerTools/jib/pull/2866#discussion_r512751251", "createdAt": "2020-10-27T14:41:44Z", "author": {"login": "loosebazooka"}, "path": "jib-core/src/main/java/com/google/cloud/tools/jib/global/JibSystemProperties.java", "diffHunk": "@@ -32,10 +33,12 @@\n   public static final String SEND_CREDENTIALS_OVER_HTTP = \"sendCredentialsOverHttp\";\n   public static final String SERIALIZE = \"jib.serialize\";\n \n-  private static final String DISABLE_USER_AGENT = \"_JIB_DISABLE_USER_AGENT\";\n-\n   @VisibleForTesting public static final String SKIP_EXISTING_IMAGES = \"jib.skipExistingImages\";\n \n+  @VisibleForTesting\n+  static final String USE_WILDCARD_FOR_DEPENDENCY_CLASSPATH =\n+      \"jib.useWildcardForDependencyClasspath\";", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjQzNTY3OQ=="}, "originalCommit": {"oid": "17308cb290ba03b22106e44a12359726fe9554cd"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjc5MDA4Ng==", "bodyText": "The idea was to have the flag as a temporary escape hatch that will go away soon once we don't get any report from the user. But I think I was too naive. Previous I speculated that we don't have to worry about the argument length limit (#2733 (comment), #2471 (comment)). However, after searching \"argument list too long\" on the Internet today, I completely lost my previous confidence. Now I think the length limit is real and this change is not safe. For example: gradle/gradle#5754.\nSo it would be safer to have this as an opt-in feature. But that's really really unfortunate, because issues from a different library order are very cryptic and difficult to identify the cause. I really wish Java 8 supported the @-argument file feature.\nAnyways, if we do this, now I think we should have it as a config option (and additionally a system property). But the question as to whether we expand it by default or not remains.\nBut ideally, for Java 9+, I think we should really use the @-argument file feature; we can always preserve the classpath order while never hitting the system argument length limit. This is going to be a lot bigger change.\nIn sum, perhaps\n\nJava 9+: always use a @-argument file. (preserveClasspathOrder is irrelevant.)\nJava <=8: expand or not based on preserveClasspathOrder. Not decisive on if it should be true by default.", "url": "https://github.com/GoogleContainerTools/jib/pull/2866#discussion_r512790086", "createdAt": "2020-10-27T15:27:01Z", "author": {"login": "chanseokoh"}, "path": "jib-core/src/main/java/com/google/cloud/tools/jib/global/JibSystemProperties.java", "diffHunk": "@@ -32,10 +33,12 @@\n   public static final String SEND_CREDENTIALS_OVER_HTTP = \"sendCredentialsOverHttp\";\n   public static final String SERIALIZE = \"jib.serialize\";\n \n-  private static final String DISABLE_USER_AGENT = \"_JIB_DISABLE_USER_AGENT\";\n-\n   @VisibleForTesting public static final String SKIP_EXISTING_IMAGES = \"jib.skipExistingImages\";\n \n+  @VisibleForTesting\n+  static final String USE_WILDCARD_FOR_DEPENDENCY_CLASSPATH =\n+      \"jib.useWildcardForDependencyClasspath\";", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjQzNTY3OQ=="}, "originalCommit": {"oid": "17308cb290ba03b22106e44a12359726fe9554cd"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjc5Nzc0OA==", "bodyText": "I think false by default works (as it is the current behavior) for java8-", "url": "https://github.com/GoogleContainerTools/jib/pull/2866#discussion_r512797748", "createdAt": "2020-10-27T15:36:20Z", "author": {"login": "loosebazooka"}, "path": "jib-core/src/main/java/com/google/cloud/tools/jib/global/JibSystemProperties.java", "diffHunk": "@@ -32,10 +33,12 @@\n   public static final String SEND_CREDENTIALS_OVER_HTTP = \"sendCredentialsOverHttp\";\n   public static final String SERIALIZE = \"jib.serialize\";\n \n-  private static final String DISABLE_USER_AGENT = \"_JIB_DISABLE_USER_AGENT\";\n-\n   @VisibleForTesting public static final String SKIP_EXISTING_IMAGES = \"jib.skipExistingImages\";\n \n+  @VisibleForTesting\n+  static final String USE_WILDCARD_FOR_DEPENDENCY_CLASSPATH =\n+      \"jib.useWildcardForDependencyClasspath\";", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjQzNTY3OQ=="}, "originalCommit": {"oid": "17308cb290ba03b22106e44a12359726fe9554cd"}, "originalPosition": 18}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIzNDkxNDIzOnYy", "diffSide": "RIGHT", "path": "jib-maven-plugin/src/main/java/com/google/cloud/tools/jib/maven/MavenProjectProperties.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQxODo0MToyNFrOHsRMgg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQxOTowMTowMVrOHsR1Dw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjE4MTEyMg==", "bodyText": "GradleProjectProperties also checks if the dependency is a jar whereas this does not. Is this intentional?", "url": "https://github.com/GoogleContainerTools/jib/pull/2866#discussion_r516181122", "createdAt": "2020-11-02T18:41:24Z", "author": {"login": "mpeddada1"}, "path": "jib-maven-plugin/src/main/java/com/google/cloud/tools/jib/maven/MavenProjectProperties.java", "diffHunk": "@@ -350,6 +350,15 @@ public JibContainerBuilder createJibContainerBuilder(\n     return new DirectoryWalker(Paths.get(project.getBuild().getOutputDirectory())).walk().asList();\n   }\n \n+  @Override\n+  public List<Path> getDependencies() {\n+    return project\n+        .getArtifacts()\n+        .stream()\n+        .map(artifact -> artifact.getFile().toPath())", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2881777513a255e1ce29ff8892dceafcbcc2aed6"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjE4OTIzMg==", "bodyText": "Good point. I am not sure if all the artifacts from project.getArtifacts() will always be .jar files, but I think usually they will be .jar files for typical Java projects.\nI've checked the MavenProjectProperties code gain, and I can tell at least that we always put all the files from project.getArtifacts() into /app/libs. (All of them are added as dependencies and only them.)\n\n  \n    \n      jib/jib-maven-plugin/src/main/java/com/google/cloud/tools/jib/maven/MavenProjectProperties.java\n    \n    \n        Lines 291 to 299\n      in\n      a720aa1\n    \n    \n    \n    \n\n        \n          \n           Map<LayerType, List<Path>> classifiedDependencies = \n        \n\n        \n          \n               classifyDependencies(project.getArtifacts(), getProjectDependencies()); \n        \n\n        \n          \n            \n        \n\n        \n          \n           javaContainerBuilder.addDependencies( \n        \n\n        \n          \n               Preconditions.checkNotNull(classifiedDependencies.get(LayerType.DEPENDENCIES))); \n        \n\n        \n          \n           javaContainerBuilder.addSnapshotDependencies( \n        \n\n        \n          \n               Preconditions.checkNotNull(classifiedDependencies.get(LayerType.SNAPSHOT_DEPENDENCIES))); \n        \n\n        \n          \n           javaContainerBuilder.addProjectDependencies( \n        \n\n        \n          \n               Preconditions.checkNotNull(classifiedDependencies.get(LayerType.PROJECT_DEPENDENCIES))); \n        \n    \n  \n\n\n(classifyDependencies(...) classifies project.getArtifacts() into project, snapshot, and third-party dependencies.)\nSo, doing this should match the actual dependencies we put.", "url": "https://github.com/GoogleContainerTools/jib/pull/2866#discussion_r516189232", "createdAt": "2020-11-02T18:56:40Z", "author": {"login": "chanseokoh"}, "path": "jib-maven-plugin/src/main/java/com/google/cloud/tools/jib/maven/MavenProjectProperties.java", "diffHunk": "@@ -350,6 +350,15 @@ public JibContainerBuilder createJibContainerBuilder(\n     return new DirectoryWalker(Paths.get(project.getBuild().getOutputDirectory())).walk().asList();\n   }\n \n+  @Override\n+  public List<Path> getDependencies() {\n+    return project\n+        .getArtifacts()\n+        .stream()\n+        .map(artifact -> artifact.getFile().toPath())", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjE4MTEyMg=="}, "originalCommit": {"oid": "2881777513a255e1ce29ff8892dceafcbcc2aed6"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjE5MTUwMw==", "bodyText": "And for Gradle, checking .jar is a bit different behavior to obtain dependencies than we current do in GradleProjectProperties.createJibContainerBuilder(); it doesn't strictly follow the logic there. However, I think this should work.", "url": "https://github.com/GoogleContainerTools/jib/pull/2866#discussion_r516191503", "createdAt": "2020-11-02T19:01:01Z", "author": {"login": "chanseokoh"}, "path": "jib-maven-plugin/src/main/java/com/google/cloud/tools/jib/maven/MavenProjectProperties.java", "diffHunk": "@@ -350,6 +350,15 @@ public JibContainerBuilder createJibContainerBuilder(\n     return new DirectoryWalker(Paths.get(project.getBuild().getOutputDirectory())).walk().asList();\n   }\n \n+  @Override\n+  public List<Path> getDependencies() {\n+    return project\n+        .getArtifacts()\n+        .stream()\n+        .map(artifact -> artifact.getFile().toPath())", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjE4MTEyMg=="}, "originalCommit": {"oid": "2881777513a255e1ce29ff8892dceafcbcc2aed6"}, "originalPosition": 9}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1, "cost": 1, "resetAt": "2021-11-12T19:05:54Z"}}}