{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg2MzQ2MjYw", "number": 1572, "title": "Event execution deduplication interval", "bodyText": "As per #1536, in order to clean up the event execution data from Redis, we can set the time to live for those records.\nBecause of the dyno-queue implementation of reading pre-fetched ids from the local shards, there can be a chance that the duplicate event messages be delivered to the event processors in case of a multi-node conductor deployment. So workflow.event.execution.peristence.ttl.seconds property is introduced and the event execution keys are expired from Redis beyond this provided time interval.  This property can act as a deduplication window in subscribers analogous to the SQS deduplication window on the publisher side.", "createdAt": "2020-03-10T20:23:43Z", "url": "https://github.com/Netflix/conductor/pull/1572", "merged": true, "mergeCommit": {"oid": "5913b17d30614f6b7a833da3940f108b0fba5d82"}, "closed": true, "closedAt": "2020-03-24T06:21:23Z", "author": {"login": "mdepak"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcKyTOxgH2gAyMzg2MzQ2MjYwOjQ5Y2VlZjEwOTVhNWVmMGU2OTU0OTQyZWZmZWMwZDlmM2ZjNTNiMzU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcQszs_AFqTM4MDAyNTQ4Nw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "49ceef1095a5ef0e6954942effec0d9f3fc53b35", "author": {"user": {"login": "mdepak", "name": "Deepak Mahudeswaran"}}, "url": "https://github.com/Netflix/conductor/commit/49ceef1095a5ef0e6954942effec0d9f3fc53b35", "committedDate": "2020-03-05T21:21:35Z", "message": "Added event execution keys ttl to support a event de-duplication window"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "650c8aebcb28d7a559d4d6af8c40b296af54032b", "author": {"user": {"login": "mdepak", "name": "Deepak Mahudeswaran"}}, "url": "https://github.com/Netflix/conductor/commit/650c8aebcb28d7a559d4d6af8c40b296af54032b", "committedDate": "2020-03-05T22:09:24Z", "message": "Fix unit tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2b336127e88d67678e6445890fcc6e68c3cfba0b", "author": {"user": {"login": "mdepak", "name": "Deepak Mahudeswaran"}}, "url": "https://github.com/Netflix/conductor/commit/2b336127e88d67678e6445890fcc6e68c3cfba0b", "committedDate": "2020-03-10T20:08:01Z", "message": "Minor formatting"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "da3db3cc1132f6997cd3e3acc174aa5104ae46f8", "author": {"user": {"login": "mdepak", "name": "Deepak Mahudeswaran"}}, "url": "https://github.com/Netflix/conductor/commit/da3db3cc1132f6997cd3e3acc174aa5104ae46f8", "committedDate": "2020-03-16T04:19:44Z", "message": "Merge remote-tracking branch 'upstream/dev' into event-execution-deduplication-interval\n\n# Conflicts:\n#\tcassandra-persistence/src/main/java/com/netflix/conductor/dao/cassandra/CassandraExecutionDAO.java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0dd2ea1b77a54845fca65499ef2f50e534279d7c", "author": {"user": {"login": "mdepak", "name": "Deepak Mahudeswaran"}}, "url": "https://github.com/Netflix/conductor/commit/0dd2ea1b77a54845fca65499ef2f50e534279d7c", "committedDate": "2020-03-16T06:02:47Z", "message": "Minor refactoring"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc5OTEyNzkw", "url": "https://github.com/Netflix/conductor/pull/1572#pullrequestreview-379912790", "createdAt": "2020-03-23T23:56:52Z", "commit": {"oid": "0dd2ea1b77a54845fca65499ef2f50e534279d7c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QyMzo1Njo1MlrOF6cgLw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QyMzo1Njo1MlrOF6cgLw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjgyODcxOQ==", "bodyText": "Please update method name to indexEventExecution to avoid confusion.", "url": "https://github.com/Netflix/conductor/pull/1572#discussion_r396828719", "createdAt": "2020-03-23T23:56:52Z", "author": {"login": "apanicker-nflx"}, "path": "core/src/main/java/com/netflix/conductor/core/orchestration/ExecutionDAOFacade.java", "diffHunk": "@@ -387,18 +387,21 @@ public void updateTaskLastPoll(String taskName, String domain, String workerId)\n      */\n     public boolean addEventExecution(EventExecution eventExecution) {\n         boolean added = executionDAO.addEventExecution(eventExecution);\n+\n         if (added) {\n-            if (config.enableAsyncIndexing()) {\n-                indexDAO.asyncAddEventExecution(eventExecution);\n-            } else {\n-                indexDAO.addEventExecution(eventExecution);\n-            }\n+            addEventExecutionIndex(eventExecution);\n         }\n+\n         return added;\n     }\n \n     public void updateEventExecution(EventExecution eventExecution) {\n         executionDAO.updateEventExecution(eventExecution);\n+        addEventExecutionIndex(eventExecution);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0dd2ea1b77a54845fca65499ef2f50e534279d7c"}, "originalPosition": 19}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1dabe0098ada3cd6babd589fd2715e9aaeec0d51", "author": {"user": {"login": "mdepak", "name": "Deepak Mahudeswaran"}}, "url": "https://github.com/Netflix/conductor/commit/1dabe0098ada3cd6babd589fd2715e9aaeec0d51", "committedDate": "2020-03-24T00:51:56Z", "message": "Incorporate review comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "65f323ea33f41266a9481b56c4cdbab76a25c24b", "author": {"user": {"login": "mdepak", "name": "Deepak Mahudeswaran"}}, "url": "https://github.com/Netflix/conductor/commit/65f323ea33f41266a9481b56c4cdbab76a25c24b", "committedDate": "2020-03-24T00:54:42Z", "message": "Merge branch 'dev' into event-execution-deduplication-interval"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgwMDI1NDg3", "url": "https://github.com/Netflix/conductor/pull/1572#pullrequestreview-380025487", "createdAt": "2020-03-24T06:21:10Z", "commit": {"oid": "65f323ea33f41266a9481b56c4cdbab76a25c24b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 857, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}