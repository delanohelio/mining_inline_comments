{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDEzODgyODU0", "number": 1671, "title": "Fix the issue with ParametersUtils where input map is mutated", "bodyText": "", "createdAt": "2020-05-06T05:18:22Z", "url": "https://github.com/Netflix/conductor/pull/1671", "merged": true, "mergeCommit": {"oid": "dc4df89963d5cda0482c08b3c26035dd3441867f"}, "closed": true, "closedAt": "2020-05-12T20:15:48Z", "author": {"login": "cyzhao"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcehu8QgFqTQwNjMxMDA3OA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABceqbkSAFqTQwNjczMTA0Ng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA2MzEwMDc4", "url": "https://github.com/Netflix/conductor/pull/1671#pullrequestreview-406310078", "createdAt": "2020-05-06T05:21:57Z", "commit": {"oid": "abad6dcb72cbec6d0cd263ab23977ba63a05696c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNlQwNToyMTo1N1rOGREZFQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNlQwNToyMTo1N1rOGREZFQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDU1MDkzMw==", "bodyText": "This block of code is where the previous fix falls apart, the new test I added fails without the new fix.", "url": "https://github.com/Netflix/conductor/pull/1671#discussion_r420550933", "createdAt": "2020-05-06T05:21:57Z", "author": {"login": "cyzhao"}, "path": "core/src/main/java/com/netflix/conductor/core/execution/ParametersUtils.java", "diffHunk": "@@ -161,23 +161,23 @@ public Object replace(String paramString) {\n \n     @SuppressWarnings(\"unchecked\")\n     private Map<String, Object> replace(Map<String, Object> input, DocumentContext documentContext, String taskId) {\n+        Map<String, Object> result = new HashMap<>();\n         for (Entry<String, Object> e : input.entrySet()) {\n+            Object newValue;\n             Object value = e.getValue();\n             if (value instanceof String) {\n-                Object replaced = replaceVariables(value.toString(), documentContext, taskId);\n-                e.setValue(replaced);\n+                newValue = replaceVariables(value.toString(), documentContext, taskId);\n             } else if (value instanceof Map) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "abad6dcb72cbec6d0cd263ab23977ba63a05696c"}, "originalPosition": 21}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "abad6dcb72cbec6d0cd263ab23977ba63a05696c", "author": {"user": {"login": "cyzhao", "name": "Charles Zhao"}}, "url": "https://github.com/Netflix/conductor/commit/abad6dcb72cbec6d0cd263ab23977ba63a05696c", "committedDate": "2020-05-06T05:17:35Z", "message": "Fix the issue with ParametersUtils where input map is mutated"}, "afterCommit": {"oid": "96f2bf6c70662d52601b80e3312949a8e249769b", "author": {"user": {"login": "cyzhao", "name": "Charles Zhao"}}, "url": "https://github.com/Netflix/conductor/commit/96f2bf6c70662d52601b80e3312949a8e249769b", "committedDate": "2020-05-06T06:35:28Z", "message": "Fix the issue with ParametersUtils where input map is mutated"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ae08202af5783b937e0f9a1efff9a0a3ea83b343", "author": {"user": {"login": "cyzhao", "name": "Charles Zhao"}}, "url": "https://github.com/Netflix/conductor/commit/ae08202af5783b937e0f9a1efff9a0a3ea83b343", "committedDate": "2020-05-06T07:59:36Z", "message": "Fix the issue with ParametersUtils where input map is mutated"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "96f2bf6c70662d52601b80e3312949a8e249769b", "author": {"user": {"login": "cyzhao", "name": "Charles Zhao"}}, "url": "https://github.com/Netflix/conductor/commit/96f2bf6c70662d52601b80e3312949a8e249769b", "committedDate": "2020-05-06T06:35:28Z", "message": "Fix the issue with ParametersUtils where input map is mutated"}, "afterCommit": {"oid": "ae08202af5783b937e0f9a1efff9a0a3ea83b343", "author": {"user": {"login": "cyzhao", "name": "Charles Zhao"}}, "url": "https://github.com/Netflix/conductor/commit/ae08202af5783b937e0f9a1efff9a0a3ea83b343", "committedDate": "2020-05-06T07:59:36Z", "message": "Fix the issue with ParametersUtils where input map is mutated"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA2NzI0OTc3", "url": "https://github.com/Netflix/conductor/pull/1671#pullrequestreview-406724977", "createdAt": "2020-05-06T15:23:42Z", "commit": {"oid": "ae08202af5783b937e0f9a1efff9a0a3ea83b343"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA2NzMxMDQ2", "url": "https://github.com/Netflix/conductor/pull/1671#pullrequestreview-406731046", "createdAt": "2020-05-06T15:29:56Z", "commit": {"oid": "ae08202af5783b937e0f9a1efff9a0a3ea83b343"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 778, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}