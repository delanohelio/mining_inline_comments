{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDU3OTc1MzI2", "number": 1810, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOFQxODo0MToyNVrOES8JWA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOFQxODo1Mzo0NFrOES8aOQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg4Mjk1MjU2OnYy", "diffSide": "RIGHT", "path": "client/src/main/java/com/netflix/conductor/client/automator/TaskPollExecutor.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOFQxODo0MToyNVrOG4ZpBg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOFQyMToxMTozN1rOG4fDHQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTc5MzU0Mg==", "bodyText": "When the intention is to cast the returned Object to String why not just return a String ?", "url": "https://github.com/Netflix/conductor/pull/1810#discussion_r461793542", "createdAt": "2020-07-28T18:41:25Z", "author": {"login": "pctreddy"}, "path": "client/src/main/java/com/netflix/conductor/client/automator/TaskPollExecutor.java", "diffHunk": "@@ -244,4 +249,11 @@ private void handleException(Throwable t, TaskResult result, Worker worker, Task\n \n         updateWithRetry(updateRetryCount, task, result, worker);\n     }\n+\n+    private Object getDomainForTask(String taskType) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "28c0fac6b5baaa73afec82c6de3b58a245afbf6e"}, "originalPosition": 43}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTgwNDIzNw==", "bodyText": "Having the taskDomains set to an empty collection during construction either in this class or in the builder as a default value:\npublic static class Builder {\n        private String workerNamePrefix = \"workflow-worker-\";\n        private int sleepWhenRetry = 500;\n        private int updateRetryCount = 3;\n        private int threadCount = -1;\n        private Iterable<Worker> workers;\n        private EurekaClient eurekaClient;\n        private TaskClient taskClient;\n        private Map<String/*taskType*/, String/*domain*/> taskToDomain = new HashMap<>();\n\nwill eliminate the need for this method and check for nulls and empty.", "url": "https://github.com/Netflix/conductor/pull/1810#discussion_r461804237", "createdAt": "2020-07-28T19:00:17Z", "author": {"login": "pctreddy"}, "path": "client/src/main/java/com/netflix/conductor/client/automator/TaskPollExecutor.java", "diffHunk": "@@ -244,4 +249,11 @@ private void handleException(Throwable t, TaskResult result, Worker worker, Task\n \n         updateWithRetry(updateRetryCount, task, result, worker);\n     }\n+\n+    private Object getDomainForTask(String taskType) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTc5MzU0Mg=="}, "originalCommit": {"oid": "28c0fac6b5baaa73afec82c6de3b58a245afbf6e"}, "originalPosition": 43}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTg4MjE0MQ==", "bodyText": "Thats a great idea.", "url": "https://github.com/Netflix/conductor/pull/1810#discussion_r461882141", "createdAt": "2020-07-28T21:11:37Z", "author": {"login": "apanicker-nflx"}, "path": "client/src/main/java/com/netflix/conductor/client/automator/TaskPollExecutor.java", "diffHunk": "@@ -244,4 +249,11 @@ private void handleException(Throwable t, TaskResult result, Worker worker, Task\n \n         updateWithRetry(updateRetryCount, task, result, worker);\n     }\n+\n+    private Object getDomainForTask(String taskType) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTc5MzU0Mg=="}, "originalCommit": {"oid": "28c0fac6b5baaa73afec82c6de3b58a245afbf6e"}, "originalPosition": 43}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg4Mjk5NTc3OnYy", "diffSide": "RIGHT", "path": "client/src/main/java/com/netflix/conductor/client/automator/TaskPollExecutor.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOFQxODo1Mzo0NFrOG4aD6w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOFQxODo1Mzo0NFrOG4aD6w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTgwMDQyNw==", "bodyText": "if the method getDomainForTask is changed to return a String instead of a Object, the use of optional can be simplified:\nString taskType = Optional.ofNullable(PropertyFactory.getString(taskType, DOMAIN, null))\n                    .orElseGet(() -> Optional.ofNullable(PropertyFactory.getString(ALL_WORKERS, DOMAIN, null))\n                            .orElse(getDomainForTask(taskType));", "url": "https://github.com/Netflix/conductor/pull/1810#discussion_r461800427", "createdAt": "2020-07-28T18:53:44Z", "author": {"login": "pctreddy"}, "path": "client/src/main/java/com/netflix/conductor/client/automator/TaskPollExecutor.java", "diffHunk": "@@ -94,7 +97,9 @@ void pollAndExecute(Worker worker) {\n \n             String taskType = worker.getTaskDefName();\n             String domain = Optional.ofNullable(PropertyFactory.getString(taskType, DOMAIN, null))\n-                .orElse(PropertyFactory.getString(ALL_WORKERS, DOMAIN, null));\n+                .orElseGet(() -> Optional.ofNullable(PropertyFactory.getString(ALL_WORKERS, DOMAIN, null))\n+                    .orElseGet(() -> Optional.ofNullable(getDomainForTask(taskType)).map(Object::toString)\n+                        .orElse(null)));\n ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "28c0fac6b5baaa73afec82c6de3b58a245afbf6e"}, "originalPosition": 35}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4233, "cost": 1, "resetAt": "2021-11-12T20:28:25Z"}}}