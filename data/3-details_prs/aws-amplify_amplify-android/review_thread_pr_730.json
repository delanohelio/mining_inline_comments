{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY4NDM3MzMy", "number": 730, "reviewThreads": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMFQwNTowMDowNlrOEaTfiQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOVQxOTowNzoyNlrOEd_ykw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk2MDE3ODAxOnYy", "diffSide": "RIGHT", "path": "aws-api-appsync/src/main/java/com/amplifyframework/api/aws/SelectionSet.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMFQwNTowMDowNlrOHDpnYg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMFQwNTowMDowNlrOHDpnYg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzU4OTYwMg==", "bodyText": "If possible, please avoid single letter variable names. They're hard to search for with tooling. For this one, maybe fieldContainerClazz?", "url": "https://github.com/aws-amplify/amplify-android/pull/730#discussion_r473589602", "createdAt": "2020-08-20T05:00:06Z", "author": {"login": "jamesonwilliams"}, "path": "aws-api-appsync/src/main/java/com/amplifyframework/api/aws/SelectionSet.java", "diffHunk": "@@ -246,5 +252,75 @@ private SelectionSet wrapPagination(SelectionSet node) {\n             }\n             return result;\n         }\n+\n+        /**\n+         * We handle customType fields differently as DEPTH does not apply here.\n+         * @param clazz class we wish to build selection set for\n+         * @return\n+         */\n+        private Set<SelectionSet> getNestedCustomTypeFields(Class<?> clazz) {\n+            Set<SelectionSet> result = new HashSet<>();\n+            for (Field field : findFieldsIn(clazz)) {\n+                String fieldName = field.getName();\n+                if (isCustomType(field)) {\n+                    result.add(new SelectionSet(fieldName, getNestedCustomTypeFields(getClassForField(field))));\n+                } else {\n+                    result.add(new SelectionSet(fieldName, null));\n+                }\n+            }\n+            return result;\n+        }\n+\n+        /**\n+         * Helper for finding fields in a class.\n+         * @param clazz class we wish to introspect\n+         * @return\n+         */\n+        private List<Field> findFieldsIn(@NonNull Class<?> clazz) {\n+            final List<Field> fields = new ArrayList<>();\n+            Class<?> c = clazz;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c4f10f8cf97206ac2b3750f8fab29447eebfa7a3"}, "originalPosition": 58}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk2MDE3OTE5OnYy", "diffSide": "RIGHT", "path": "aws-api-appsync/src/main/java/com/amplifyframework/api/aws/SelectionSet.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMFQwNTowMDozMFrOHDpoFg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMFQwNTowMDozMFrOHDpoFg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzU4OTc4Mg==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    static boolean isCustomType(@NonNull Field field) {\n          \n          \n            \n                    private static boolean isCustomType(@NonNull Field field) {", "url": "https://github.com/aws-amplify/amplify-android/pull/730#discussion_r473589782", "createdAt": "2020-08-20T05:00:30Z", "author": {"login": "jamesonwilliams"}, "path": "aws-api-appsync/src/main/java/com/amplifyframework/api/aws/SelectionSet.java", "diffHunk": "@@ -246,5 +252,75 @@ private SelectionSet wrapPagination(SelectionSet node) {\n             }\n             return result;\n         }\n+\n+        /**\n+         * We handle customType fields differently as DEPTH does not apply here.\n+         * @param clazz class we wish to build selection set for\n+         * @return\n+         */\n+        private Set<SelectionSet> getNestedCustomTypeFields(Class<?> clazz) {\n+            Set<SelectionSet> result = new HashSet<>();\n+            for (Field field : findFieldsIn(clazz)) {\n+                String fieldName = field.getName();\n+                if (isCustomType(field)) {\n+                    result.add(new SelectionSet(fieldName, getNestedCustomTypeFields(getClassForField(field))));\n+                } else {\n+                    result.add(new SelectionSet(fieldName, null));\n+                }\n+            }\n+            return result;\n+        }\n+\n+        /**\n+         * Helper for finding fields in a class.\n+         * @param clazz class we wish to introspect\n+         * @return\n+         */\n+        private List<Field> findFieldsIn(@NonNull Class<?> clazz) {\n+            final List<Field> fields = new ArrayList<>();\n+            Class<?> c = clazz;\n+            while (c != null) {\n+                for (Field field : c.getDeclaredFields()) {\n+                    fields.add(field);\n+                }\n+                c = c.getSuperclass();\n+            }\n+            Collections.sort(fields, Comparator.comparing(Field::getName));\n+            return Immutable.of(fields);\n+        }\n+\n+        /**\n+         * Helper to determine if field is a custom type. If custom types we need to build nested selection set.\n+         * @param field field we wish to check\n+         * @return\n+         */\n+        static boolean isCustomType(@NonNull Field field) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c4f10f8cf97206ac2b3750f8fab29447eebfa7a3"}, "originalPosition": 74}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk2MDE4Mjc4OnYy", "diffSide": "RIGHT", "path": "aws-api-appsync/src/main/java/com/amplifyframework/api/aws/SelectionSet.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMFQwNTowMTozMFrOHDpqTg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMFQwNTowMTozMFrOHDpqTg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzU5MDM1MA==", "bodyText": "There is a FieldFinder utility class which I believe is supposed do something like this? You could feel free to update/augment it, if it doesn't currently meet your needs.", "url": "https://github.com/aws-amplify/amplify-android/pull/730#discussion_r473590350", "createdAt": "2020-08-20T05:01:30Z", "author": {"login": "jamesonwilliams"}, "path": "aws-api-appsync/src/main/java/com/amplifyframework/api/aws/SelectionSet.java", "diffHunk": "@@ -246,5 +252,75 @@ private SelectionSet wrapPagination(SelectionSet node) {\n             }\n             return result;\n         }\n+\n+        /**\n+         * We handle customType fields differently as DEPTH does not apply here.\n+         * @param clazz class we wish to build selection set for\n+         * @return\n+         */\n+        private Set<SelectionSet> getNestedCustomTypeFields(Class<?> clazz) {\n+            Set<SelectionSet> result = new HashSet<>();\n+            for (Field field : findFieldsIn(clazz)) {\n+                String fieldName = field.getName();\n+                if (isCustomType(field)) {\n+                    result.add(new SelectionSet(fieldName, getNestedCustomTypeFields(getClassForField(field))));\n+                } else {\n+                    result.add(new SelectionSet(fieldName, null));\n+                }\n+            }\n+            return result;\n+        }\n+\n+        /**\n+         * Helper for finding fields in a class.\n+         * @param clazz class we wish to introspect\n+         * @return\n+         */\n+        private List<Field> findFieldsIn(@NonNull Class<?> clazz) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c4f10f8cf97206ac2b3750f8fab29447eebfa7a3"}, "originalPosition": 56}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk4NTk0MzE3OnYy", "diffSide": "RIGHT", "path": "aws-datastore/src/test/java/com/amplifyframework/datastore/appsync/AppSyncRequestFactoryTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNlQyMTo1NDo0NFrOHHfFhw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNlQyMTo1NDo0NFrOHHfFhw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzYxMTM5OQ==", "bodyText": ":-D", "url": "https://github.com/aws-amplify/amplify-android/pull/730#discussion_r477611399", "createdAt": "2020-08-26T21:54:44Z", "author": {"login": "jamesonwilliams"}, "path": "aws-datastore/src/test/java/com/amplifyframework/datastore/appsync/AppSyncRequestFactoryTest.java", "diffHunk": "@@ -161,7 +214,7 @@ public void validateSubscriptionGenerationOnUpdatePost() throws DataStoreExcepti\n     }\n \n     /**\n-     * Validates generation of a GraphQL document which requests a subscription for updates\n+     * Validates generation of a GraphQL document which requests a subscription for deletes.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c4f10f8cf97206ac2b3750f8fab29447eebfa7a3"}, "originalPosition": 93}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk4NTk0MzY3OnYy", "diffSide": "RIGHT", "path": "aws-datastore/src/test/java/com/amplifyframework/datastore/appsync/AppSyncRequestFactoryTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNlQyMTo1NDo1M1rOHHfFzw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNlQyMTo1NDo1M1rOHHfFzw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzYxMTQ3MQ==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change", "url": "https://github.com/aws-amplify/amplify-android/pull/730#discussion_r477611471", "createdAt": "2020-08-26T21:54:53Z", "author": {"login": "jamesonwilliams"}, "path": "aws-datastore/src/test/java/com/amplifyframework/datastore/appsync/AppSyncRequestFactoryTest.java", "diffHunk": "@@ -195,4 +248,49 @@ public void validateMutationGenerationOnCreateComment() throws DataStoreExceptio\n \n         );\n     }\n+\n+    /**\n+     * Validates creation of a \"create a model\" request for nested custom type.\n+     * @throws DataStoreException On failure to interrogate the model fields.\n+     * @throws JSONException from JSONAssert.assertEquals.\n+     */\n+    @Test\n+    public void validateMutationGenerationOnCreateNestedCustomType() throws DataStoreException, JSONException {\n+        JSONAssert.assertEquals(\n+                Resources.readAsString(\"create-parent-request.txt\"),\n+                AppSyncRequestFactory.buildCreationRequest(buildTestParentModel()).getContent(),\n+                true\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c4f10f8cf97206ac2b3750f8fab29447eebfa7a3"}, "originalPosition": 113}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk4NTk0NzE5OnYy", "diffSide": "RIGHT", "path": "testmodels/src/main/java/com/amplifyframework/testmodels/parenting/schema.graphql", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNlQyMTo1NjowMFrOHHfH1A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOVQwNTozODoxMVrOHJZJWQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzYxMTk4OA==", "bodyText": "Can you align the formatting in this file, so all blocks use all +2 or all +4? (What do the other .graphql files in the code base currently use?)", "url": "https://github.com/aws-amplify/amplify-android/pull/730#discussion_r477611988", "createdAt": "2020-08-26T21:56:00Z", "author": {"login": "jamesonwilliams"}, "path": "testmodels/src/main/java/com/amplifyframework/testmodels/parenting/schema.graphql", "diffHunk": "@@ -0,0 +1,25 @@\n+type Parent @model {\n+  id: ID!\n+  name: String!\n+  address: Address!\n+  children: [Child]\n+}\n+\n+type Child {\n+\tname: String!", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c4f10f8cf97206ac2b3750f8fab29447eebfa7a3"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTYxMTIyNQ==", "bodyText": "2", "url": "https://github.com/aws-amplify/amplify-android/pull/730#discussion_r479611225", "createdAt": "2020-08-29T05:38:11Z", "author": {"login": "saltonmassally"}, "path": "testmodels/src/main/java/com/amplifyframework/testmodels/parenting/schema.graphql", "diffHunk": "@@ -0,0 +1,25 @@\n+type Parent @model {\n+  id: ID!\n+  name: String!\n+  address: Address!\n+  children: [Child]\n+}\n+\n+type Child {\n+\tname: String!", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzYxMTk4OA=="}, "originalCommit": {"oid": "c4f10f8cf97206ac2b3750f8fab29447eebfa7a3"}, "originalPosition": 9}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk5ODg5Mjk5OnYy", "diffSide": "LEFT", "path": "core/src/main/java/com/amplifyframework/util/FieldFinder.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOVQxOTowNzoyNlrOHJdWcw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOVQxOTowNzoyNlrOHJdWcw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTY4MDExNQ==", "bodyText": "Oh, ha, it was already a single letter variable. \ud83d\ude0a  Thanks for improving it.", "url": "https://github.com/aws-amplify/amplify-android/pull/730#discussion_r479680115", "createdAt": "2020-08-29T19:07:26Z", "author": {"login": "jamesonwilliams"}, "path": "core/src/main/java/com/amplifyframework/util/FieldFinder.java", "diffHunk": "@@ -45,21 +46,40 @@ private FieldFinder() {\n      * @return set of fields\n      */\n     @NonNull\n-    public static List<Field> findFieldsIn(@NonNull Class<?> clazz) {\n+    public static List<Field> findModelFieldsIn(@NonNull Class<?> clazz) {\n         final List<Field> fields = new ArrayList<>();\n-        Class<?> c = clazz;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d39e734912f0c346e7a33f2acb600632b7c2ea53"}, "originalPosition": 15}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1178, "cost": 1, "resetAt": "2021-11-12T09:44:50Z"}}}