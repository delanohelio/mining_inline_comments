{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTA5MjM5NDc0", "number": 926, "title": "fix(api): Add owner field to selection set if implicitly defined", "bodyText": "This PR fixes a bug where subscriptions will not be received at all for the schema below.    The fix is to modify the request for mutations to include the owner field to the selection set.  This ensures that when the mutation is broadcast out to the subscription listeners, the owner field will be hydrated, so it won't be filtered out, because it will be able to validate that the user is authorized to view this object.\ntype Post @model @auth(rules: [{ allow: owner }])\n{\n  id: ID!\n  title: String!\n}\n\nBy submitting this pull request, I confirm that my contribution is made under the terms of the Apache 2.0 license.", "createdAt": "2020-10-23T22:11:17Z", "url": "https://github.com/aws-amplify/amplify-android/pull/926", "merged": true, "mergeCommit": {"oid": "98e31334f899bcfbdc2cb045d19af21668c280ff"}, "closed": true, "closedAt": "2020-10-26T18:17:55Z", "author": {"login": "richardmcclellan"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdVd96ZgH2gAyNTA5MjM5NDc0OjdmM2Y1MGE1ZDI5NWRjNTgxMGRkYzcxYjhiNDRjOWQxYTVhNmRmNzE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdWXIzWABqjM5MjE3MzE1Nzk=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "7f3f50a5d295dc5810ddc71b8b44c9d1a5a6df71", "author": {"user": {"login": "richardmcclellan", "name": "Richard McClellan"}}, "url": "https://github.com/aws-amplify/amplify-android/commit/7f3f50a5d295dc5810ddc71b8b44c9d1a5a6df71", "committedDate": "2020-10-23T22:04:31Z", "message": "fix(api): Add owner field to selection set if implicitly defined"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE2MDQ0MzUy", "url": "https://github.com/aws-amplify/amplify-android/pull/926#pullrequestreview-516044352", "createdAt": "2020-10-23T22:32:54Z", "commit": {"oid": "7f3f50a5d295dc5810ddc71b8b44c9d1a5a6df71"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE2NTI3NDg4", "url": "https://github.com/aws-amplify/amplify-android/pull/926#pullrequestreview-516527488", "createdAt": "2020-10-26T07:48:17Z", "commit": {"oid": "7f3f50a5d295dc5810ddc71b8b44c9d1a5a6df71"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yNlQwNzo0ODoxN1rOHoD0Ng==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yNlQwNzo0ODoxN1rOHoD0Ng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTc2NzYwNg==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                                    result.add(new SelectionSet(authRule.getOwnerFieldOrDefault(), null));\n          \n          \n            \n                                    result.add(new SelectionSet(authRule.getOwnerFieldOrDefault(), Collections.emptySet()));", "url": "https://github.com/aws-amplify/amplify-android/pull/926#discussion_r511767606", "createdAt": "2020-10-26T07:48:17Z", "author": {"login": "jamesonwilliams"}, "path": "aws-api-appsync/src/main/java/com/amplifyframework/api/aws/SelectionSet.java", "diffHunk": "@@ -244,6 +246,12 @@ private SelectionSet wrapPagination(SelectionSet node) {\n                 } else {\n                     result.add(new SelectionSet(fieldName, null));\n                 }\n+                for (AuthRule authRule : schema.getAuthRules()) {\n+                    if (AuthStrategy.OWNER.equals(authRule.getAuthStrategy())) {\n+                        result.add(new SelectionSet(authRule.getOwnerFieldOrDefault(), null));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7f3f50a5d295dc5810ddc71b8b44c9d1a5a6df71"}, "originalPosition": 15}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "acd797ec70c253d103b0879582dbfa84aaf9cdbc", "author": {"user": {"login": "richardmcclellan", "name": "Richard McClellan"}}, "url": "https://github.com/aws-amplify/amplify-android/commit/acd797ec70c253d103b0879582dbfa84aaf9cdbc", "committedDate": "2020-10-26T16:40:43Z", "message": "Require SelectionSet.nodes to be nonnull"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": {"oid": "acd797ec70c253d103b0879582dbfa84aaf9cdbc", "author": {"user": {"login": "richardmcclellan", "name": "Richard McClellan"}}, "url": "https://github.com/aws-amplify/amplify-android/commit/acd797ec70c253d103b0879582dbfa84aaf9cdbc", "committedDate": "2020-10-26T16:40:43Z", "message": "Require SelectionSet.nodes to be nonnull"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1780, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}