{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDcwMjkxNjg1", "number": 738, "title": "feat(aws-auth-cognito): implement device tracking", "bodyText": "Issue #, if available:\nDescription of changes:\nAdd rememberDevice(), forgetDevice(), and fetchDevices() in the Auth category\nBy submitting this pull request, I confirm that my contribution is made under the terms of the Apache 2.0 license.", "createdAt": "2020-08-19T16:49:11Z", "url": "https://github.com/aws-amplify/amplify-android/pull/738", "merged": true, "mergeCommit": {"oid": "4a26d73da70872963f396fecae23a5227f530254"}, "closed": true, "closedAt": "2020-08-24T17:07:17Z", "author": {"login": "raphkim"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdAY4YAAH2gAyNDcwMjkxNjg1OjAyNTVkOTYyZWQwOTUzYWFkZDI2MjAyYTZkZTc5NTUzNTMzYTgxYTY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdCFMv4AFqTQ3MzY2MjI4NQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "0255d962ed0953aadd26202a6de79553533a81a6", "author": {"user": {"login": "raphkim", "name": "Raphael Kim"}}, "url": "https://github.com/aws-amplify/amplify-android/commit/0255d962ed0953aadd26202a6de79553533a81a6", "committedDate": "2020-08-19T10:16:32Z", "message": "feat(aws-auth-cognito): implement device tracking"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2c06a0553b4ca21fb307d17886041d3b92d1e6b9", "author": {"user": {"login": "raphkim", "name": "Raphael Kim"}}, "url": "https://github.com/aws-amplify/amplify-android/commit/2c06a0553b4ca21fb307d17886041d3b92d1e6b9", "committedDate": "2020-08-19T10:16:52Z", "message": "Merge branch 'main' of https://github.com/aws-amplify/amplify-android into auth-device"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "907572b89595236707a5126f4d300abbab1c5f6c", "author": {"user": {"login": "raphkim", "name": "Raphael Kim"}}, "url": "https://github.com/aws-amplify/amplify-android/commit/907572b89595236707a5126f4d300abbab1c5f6c", "committedDate": "2020-08-19T16:48:27Z", "message": "Add more synchronous methods"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDcwNzAwMTk4", "url": "https://github.com/aws-amplify/amplify-android/pull/738#pullrequestreview-470700198", "createdAt": "2020-08-19T17:43:52Z", "commit": {"oid": "907572b89595236707a5126f4d300abbab1c5f6c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOVQxNzo0Mzo1MlrOHDSnBQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOVQxNzo0Mzo1MlrOHDSnBQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzIxMjY3Nw==", "bodyText": "Did you verify we can't get the device names from AWSMobileClient?", "url": "https://github.com/aws-amplify/amplify-android/pull/738#discussion_r473212677", "createdAt": "2020-08-19T17:43:52Z", "author": {"login": "TrekSoft"}, "path": "aws-auth-cognito/src/main/java/com/amplifyframework/auth/cognito/AWSCognitoAuthPlugin.java", "diffHunk": "@@ -510,6 +515,99 @@ public void onError(Exception exception) {\n         }\n     }\n \n+    @Override\n+    public void rememberDevice(\n+            @NonNull Action onSuccess,\n+            @NonNull Consumer<AuthException> onException\n+    ) {\n+        awsMobileClient.getDeviceOperations().updateStatus(true, new Callback<Void>() {\n+            @Override\n+            public void onResult(Void result) {\n+                onSuccess.call();\n+            }\n+\n+            @Override\n+            public void onError(Exception exception) {\n+                onException.accept(new AuthException(\n+                        \"An error occurred while remembering a device\",\n+                        exception,\n+                        \"See attached exception for more details\"\n+                ));\n+            }\n+        });\n+    }\n+\n+    @Override\n+    public void forgetDevice(\n+            @NonNull Action onSuccess,\n+            @NonNull Consumer<AuthException> onException\n+    ) {\n+        awsMobileClient.getDeviceOperations().forget(new Callback<Void>() {\n+            @Override\n+            public void onResult(Void result) {\n+                onSuccess.call();\n+            }\n+\n+            @Override\n+            public void onError(Exception exception) {\n+                onException.accept(new AuthException(\n+                        \"An error occurred while forgetting a device\",\n+                        exception,\n+                        \"See attached exception for more details\"\n+                ));\n+            }\n+        });\n+    }\n+\n+    @Override\n+    public void forgetDevice(\n+            @NonNull AuthDevice device,\n+            @NonNull Action onSuccess,\n+            @NonNull Consumer<AuthException> onException\n+    ) {\n+        awsMobileClient.getDeviceOperations().forget(device.getDeviceId(), new Callback<Void>() {\n+            @Override\n+            public void onResult(Void result) {\n+                onSuccess.call();\n+            }\n+\n+            @Override\n+            public void onError(Exception exception) {\n+                onException.accept(new AuthException(\n+                        \"An error occurred while forgetting a device\",\n+                        exception,\n+                        \"See attached exception for more details\"\n+                ));\n+            }\n+        });\n+    }\n+\n+    @Override\n+    public void fetchDevices(\n+            @NonNull Consumer<List<AuthDevice>> onSuccess,\n+            @NonNull Consumer<AuthException> onException\n+    ) {\n+        awsMobileClient.getDeviceOperations().list(new Callback<ListDevicesResult>() {\n+            @Override\n+            public void onResult(ListDevicesResult result) {\n+                List<AuthDevice> devices = new ArrayList<>();\n+                for (Device device : result.getDevices()) {\n+                    devices.add(AuthDevice.fromId(device.getDeviceKey()));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "907572b89595236707a5126f4d300abbab1c5f6c"}, "originalPosition": 111}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDcwNzAwNTA3", "url": "https://github.com/aws-amplify/amplify-android/pull/738#pullrequestreview-470700507", "createdAt": "2020-08-19T17:44:19Z", "commit": {"oid": "907572b89595236707a5126f4d300abbab1c5f6c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDcxMTgwNzA0", "url": "https://github.com/aws-amplify/amplify-android/pull/738#pullrequestreview-471180704", "createdAt": "2020-08-20T04:18:58Z", "commit": {"oid": "907572b89595236707a5126f4d300abbab1c5f6c"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMFQwNDoxODo1OFrOHDo-HQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMFQwNDozMDoxN1rOHDpImw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzU3OTAzNw==", "bodyText": "Passing the dummy new Object() into the Await util is okay. But you don't need to return it.\nSuccess can be == doesn't throw an exception.\nI'd update this for every method that uses this pattern.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                /**\n          \n          \n            \n                 * Forgets the current device synchronously.\n          \n          \n            \n                 * @param device Auth device to forget\n          \n          \n            \n                 * @return Dummy object - just indicates it completed successfully\n          \n          \n            \n                 * @throws AuthException exception\n          \n          \n            \n                 */\n          \n          \n            \n                public Object forgetDevice(@NonNull AuthDevice device) throws AuthException {\n          \n          \n            \n                    return Await.<Object, AuthException>result(AUTH_OPERATION_TIMEOUT_MS, (onResult, onError) ->\n          \n          \n            \n                            asyncDelegate.forgetDevice(device, () -> onResult.accept(new Object()), onError)\n          \n          \n            \n                    );\n          \n          \n            \n                }\n          \n          \n            \n                /**\n          \n          \n            \n                 * Forgets the current device.\n          \n          \n            \n                 * @param device Auth device to forget\n          \n          \n            \n                 * @throws AuthException On failure to forget the provided device\n          \n          \n            \n                 */\n          \n          \n            \n                public void forgetDevice(@NonNull AuthDevice device) throws AuthException {\n          \n          \n            \n                    Await.<Object, AuthException>result(AUTH_OPERATION_TIMEOUT_MS, (onResult, onError) ->\n          \n          \n            \n                            asyncDelegate.forgetDevice(device, () -> onResult.accept(new Object()), onError)\n          \n          \n            \n                    );\n          \n          \n            \n                }", "url": "https://github.com/aws-amplify/amplify-android/pull/738#discussion_r473579037", "createdAt": "2020-08-20T04:18:58Z", "author": {"login": "jamesonwilliams"}, "path": "testutils/src/main/java/com/amplifyframework/testutils/sync/SynchronousAuth.java", "diffHunk": "@@ -252,11 +254,52 @@ public Object confirmResetPassword(\n      */\n     @NonNull\n     public AuthSession fetchAuthSession() throws AuthException {\n-        return Await.<AuthSession, AuthException>result(AUTH_OPERATION_TIMEOUT_MS, (onResult, onError) ->\n-                asyncDelegate.fetchAuthSession(onResult, onError)\n+        return Await.result(AUTH_OPERATION_TIMEOUT_MS, asyncDelegate::fetchAuthSession);\n+    }\n+\n+    /**\n+     * Remembers current device synchronously.\n+     * @return Dummy object - just indicates it completed successfully\n+     * @throws AuthException exception\n+     */\n+    public Object rememberDevice() throws AuthException {\n+        return Await.<Object, AuthException>result(AUTH_OPERATION_TIMEOUT_MS, (onResult, onError) ->\n+                asyncDelegate.rememberDevice(() -> onResult.accept(new Object()), onError)\n+        );\n+    }\n+\n+    /**\n+     * Forgets the current device synchronously.\n+     * @return Dummy object - just indicates it completed successfully\n+     * @throws AuthException exception\n+     */\n+    public Object forgetDevice() throws AuthException {\n+        return Await.<Object, AuthException>result(AUTH_OPERATION_TIMEOUT_MS, (onResult, onError) ->\n+                asyncDelegate.forgetDevice(() -> onResult.accept(new Object()), onError)\n+        );\n+    }\n+\n+    /**\n+     * Forgets the current device synchronously.\n+     * @param device Auth device to forget\n+     * @return Dummy object - just indicates it completed successfully\n+     * @throws AuthException exception\n+     */\n+    public Object forgetDevice(@NonNull AuthDevice device) throws AuthException {\n+        return Await.<Object, AuthException>result(AUTH_OPERATION_TIMEOUT_MS, (onResult, onError) ->\n+                asyncDelegate.forgetDevice(device, () -> onResult.accept(new Object()), onError)\n         );\n     }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "907572b89595236707a5126f4d300abbab1c5f6c"}, "originalPosition": 57}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzU4MDI4MA==", "bodyText": "Naming: this should be forgetCurrentDevice(), to clearly distinguish it from forgetDevice(AuthDevice specificDevice). I would not compromise the naming just to match iOS. We should ask the iOS team to update their name if they're not using this, too.", "url": "https://github.com/aws-amplify/amplify-android/pull/738#discussion_r473580280", "createdAt": "2020-08-20T04:24:26Z", "author": {"login": "jamesonwilliams"}, "path": "testutils/src/main/java/com/amplifyframework/testutils/sync/SynchronousAuth.java", "diffHunk": "@@ -252,11 +254,52 @@ public Object confirmResetPassword(\n      */\n     @NonNull\n     public AuthSession fetchAuthSession() throws AuthException {\n-        return Await.<AuthSession, AuthException>result(AUTH_OPERATION_TIMEOUT_MS, (onResult, onError) ->\n-                asyncDelegate.fetchAuthSession(onResult, onError)\n+        return Await.result(AUTH_OPERATION_TIMEOUT_MS, asyncDelegate::fetchAuthSession);\n+    }\n+\n+    /**\n+     * Remembers current device synchronously.\n+     * @return Dummy object - just indicates it completed successfully\n+     * @throws AuthException exception\n+     */\n+    public Object rememberDevice() throws AuthException {\n+        return Await.<Object, AuthException>result(AUTH_OPERATION_TIMEOUT_MS, (onResult, onError) ->\n+                asyncDelegate.rememberDevice(() -> onResult.accept(new Object()), onError)\n+        );\n+    }\n+\n+    /**\n+     * Forgets the current device synchronously.\n+     * @return Dummy object - just indicates it completed successfully\n+     * @throws AuthException exception\n+     */\n+    public Object forgetDevice() throws AuthException {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "907572b89595236707a5126f4d300abbab1c5f6c"}, "originalPosition": 41}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzU4MDQ2Ng==", "bodyText": "Since we have a forceDevice(AuthDevice specificDevice), I suggest that we call this rememberCurrentDevice(). (Same for Rx bindings, of course, as well.)", "url": "https://github.com/aws-amplify/amplify-android/pull/738#discussion_r473580466", "createdAt": "2020-08-20T04:25:15Z", "author": {"login": "jamesonwilliams"}, "path": "testutils/src/main/java/com/amplifyframework/testutils/sync/SynchronousAuth.java", "diffHunk": "@@ -252,11 +254,52 @@ public Object confirmResetPassword(\n      */\n     @NonNull\n     public AuthSession fetchAuthSession() throws AuthException {\n-        return Await.<AuthSession, AuthException>result(AUTH_OPERATION_TIMEOUT_MS, (onResult, onError) ->\n-                asyncDelegate.fetchAuthSession(onResult, onError)\n+        return Await.result(AUTH_OPERATION_TIMEOUT_MS, asyncDelegate::fetchAuthSession);\n+    }\n+\n+    /**\n+     * Remembers current device synchronously.\n+     * @return Dummy object - just indicates it completed successfully\n+     * @throws AuthException exception\n+     */\n+    public Object rememberDevice() throws AuthException {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "907572b89595236707a5126f4d300abbab1c5f6c"}, "originalPosition": 30}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzU4MTcyMw==", "bodyText": "Extra parens\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    return toSingle((delegate::fetchDevices));\n          \n          \n            \n                    return toSingle(delegate::fetchDevices);", "url": "https://github.com/aws-amplify/amplify-android/pull/738#discussion_r473581723", "createdAt": "2020-08-20T04:30:17Z", "author": {"login": "jamesonwilliams"}, "path": "rxbindings/src/main/java/com/amplifyframework/rx/RxAuthBinding.java", "diffHunk": "@@ -126,6 +128,26 @@ public void handleWebUISignInResponse(Intent intent) {\n         return toSingle(delegate::fetchAuthSession);\n     }\n \n+    @Override\n+    public Completable rememberDevice() {\n+        return toCompletable(delegate::rememberDevice);\n+    }\n+\n+    @Override\n+    public Completable forgetDevice() {\n+        return toCompletable(delegate::forgetDevice);\n+    }\n+\n+    @Override\n+    public Completable forgetDevice(@NonNull AuthDevice device) {\n+        return toCompletable((onComplete, onError) -> delegate.forgetDevice(device, onComplete, onError));\n+    }\n+\n+    @Override\n+    public Single<List<AuthDevice>> fetchDevices() {\n+        return toSingle((delegate::fetchDevices));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "907572b89595236707a5126f4d300abbab1c5f6c"}, "originalPosition": 37}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9f6bd22f773ac1a34489e9ace56c184dbfa63b87", "author": {"user": {"login": "raphkim", "name": "Raphael Kim"}}, "url": "https://github.com/aws-amplify/amplify-android/commit/9f6bd22f773ac1a34489e9ace56c184dbfa63b87", "committedDate": "2020-08-23T20:44:28Z", "message": "pr suggestions from jameson"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4983a72c056a2be5878fc79e98934a58302c5e91", "author": {"user": {"login": "raphkim", "name": "Raphael Kim"}}, "url": "https://github.com/aws-amplify/amplify-android/commit/4983a72c056a2be5878fc79e98934a58302c5e91", "committedDate": "2020-08-23T21:10:54Z", "message": "add component test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e5a3667f004c970b0973bf314fd334fce8bb0713", "author": {"user": {"login": "raphkim", "name": "Raphael Kim"}}, "url": "https://github.com/aws-amplify/amplify-android/commit/e5a3667f004c970b0973bf314fd334fce8bb0713", "committedDate": "2020-08-24T08:18:28Z", "message": "add rxbindings test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "180033bfd2dc1034d98fa151175a5175a26a4320", "author": {"user": {"login": "raphkim", "name": "Raphael Kim"}}, "url": "https://github.com/aws-amplify/amplify-android/commit/180033bfd2dc1034d98fa151175a5175a26a4320", "committedDate": "2020-08-24T15:57:53Z", "message": "checkstyle fixup"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDczNjYyMjg1", "url": "https://github.com/aws-amplify/amplify-android/pull/738#pullrequestreview-473662285", "createdAt": "2020-08-24T16:28:32Z", "commit": {"oid": "180033bfd2dc1034d98fa151175a5175a26a4320"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1972, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}