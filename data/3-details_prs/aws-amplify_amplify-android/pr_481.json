{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE5MjgzNzc4", "number": 481, "title": "Add text and label configuration", "bodyText": "Issue #, if available:\nDescription of changes:\n\ncelebrity detection configuration is now taken into account (used to be always enabled even when explicitly turned off in the configuration)\nadd \"identifyText\" configuration\nadd \"identifyLabels\" configuration\nadd default behavior for passing in IdentifyActionType#DETECT_TEXT instead of TextFormatType enum (previously triggered error callback)\nadd default behavior for passing in IdentifyActionType#DETECT_LABELS instead of LabelType enum (previously triggered error callback)\n\nBy submitting this pull request, I confirm that my contribution is made under the terms of the Apache 2.0 license.", "createdAt": "2020-05-18T06:19:06Z", "url": "https://github.com/aws-amplify/amplify-android/pull/481", "merged": true, "mergeCommit": {"oid": "b3f98588c3cc0c304629719573312bc26a0d1461"}, "closed": true, "closedAt": "2020-05-18T17:29:59Z", "author": {"login": "raphkim"}, "timelineItems": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABciZqpdgH2gAyNDE5MjgzNzc4OmNiYWI0ZjcxOTYyMWM4NTA1MTE0YTE2MGExZjlhMjhlZDljMTdmOGM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcibCpTAFqTQxMzM0MTEzOQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "cbab4f719621c8505114a160a1f9a28ed9c17f8c", "author": {"user": {"login": "raphkim", "name": "Raphael Kim"}}, "url": "https://github.com/aws-amplify/amplify-android/commit/cbab4f719621c8505114a160a1f9a28ed9c17f8c", "committedDate": "2020-05-18T06:13:43Z", "message": "Add text and label configuration"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEzMzQxMTM5", "url": "https://github.com/aws-amplify/amplify-android/pull/481#pullrequestreview-413341139", "createdAt": "2020-05-18T07:40:12Z", "commit": {"oid": "cbab4f719621c8505114a160a1f9a28ed9c17f8c"}, "state": "APPROVED", "comments": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOFQwNzo0MDoxMlrOGWq9KA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOFQwNzo0OToyNVrOGWrQCw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjQyNTY0MA==", "bodyText": "/md This already lives immediately under an \"identify\", right? Can it just be:\n    \"identify\": {\n        \"labels\": {\n        }\n    }\n\ninstead of :\n    \"identfiy\": {\n        \"identifyLabels\": {\n        }\n    }", "url": "https://github.com/aws-amplify/amplify-android/pull/481#discussion_r426425640", "createdAt": "2020-05-18T07:40:12Z", "author": {"login": "jamesonwilliams"}, "path": "aws-predictions/src/main/java/com/amplifyframework/predictions/aws/configuration/IdentifyLabelsConfiguration.java", "diffHunk": "@@ -0,0 +1,83 @@\n+/*\n+ * Copyright 2020 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *  http://aws.amazon.com/apache2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ * permissions and limitations under the License.\n+ */\n+\n+package com.amplifyframework.predictions.aws.configuration;\n+\n+import androidx.annotation.NonNull;\n+import androidx.annotation.Nullable;\n+\n+import com.amplifyframework.predictions.aws.NetworkPolicy;\n+import com.amplifyframework.predictions.models.LabelType;\n+\n+import org.json.JSONException;\n+import org.json.JSONObject;\n+\n+/**\n+ * Configures the behavior for identifying labels.\n+ */\n+public final class IdentifyLabelsConfiguration {\n+    private static final String CONFIG_NAME = \"identifyLabels\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cbab4f719621c8505114a160a1f9a28ed9c17f8c"}, "originalPosition": 31}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjQyNjEyNQ==", "bodyText": "This is weird, having one of these in a const, and the other not. I'd stick with a single approach, whichever you choose.", "url": "https://github.com/aws-amplify/amplify-android/pull/481#discussion_r426426125", "createdAt": "2020-05-18T07:41:08Z", "author": {"login": "jamesonwilliams"}, "path": "aws-predictions/src/main/java/com/amplifyframework/predictions/aws/configuration/IdentifyLabelsConfiguration.java", "diffHunk": "@@ -0,0 +1,83 @@\n+/*\n+ * Copyright 2020 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *  http://aws.amazon.com/apache2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ * permissions and limitations under the License.\n+ */\n+\n+package com.amplifyframework.predictions.aws.configuration;\n+\n+import androidx.annotation.NonNull;\n+import androidx.annotation.Nullable;\n+\n+import com.amplifyframework.predictions.aws.NetworkPolicy;\n+import com.amplifyframework.predictions.models.LabelType;\n+\n+import org.json.JSONException;\n+import org.json.JSONObject;\n+\n+/**\n+ * Configures the behavior for identifying labels.\n+ */\n+public final class IdentifyLabelsConfiguration {\n+    private static final String CONFIG_NAME = \"identifyLabels\";\n+    private final LabelType type;\n+    private final NetworkPolicy networkPolicy;\n+\n+    private IdentifyLabelsConfiguration(\n+            LabelType type,\n+            NetworkPolicy networkPolicy\n+    ) {\n+        this.type = type;\n+        this.networkPolicy = networkPolicy;\n+    }\n+\n+    /**\n+     * Construct an instance of {@link IdentifyLabelsConfiguration} from\n+     * plugin configuration JSON object.\n+     * @param configurationJson the plugin configuration\n+     * @return the configuration for label identification\n+     * @throws JSONException if identify configuration is malformed\n+     */\n+    @Nullable\n+    public static IdentifyLabelsConfiguration fromJson(@NonNull JSONObject configurationJson) throws JSONException {\n+        if (!configurationJson.has(CONFIG_NAME)) {\n+            return null;\n+        }\n+\n+        JSONObject identifyLabelsJson = configurationJson.getJSONObject(CONFIG_NAME);\n+        String typeString = identifyLabelsJson.getString(\"type\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cbab4f719621c8505114a160a1f9a28ed9c17f8c"}, "originalPosition": 57}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjQyNzgwOA==", "bodyText": "Under what conditions is it valuable to provide a non-LabelType object, here? I see later you have some control flow around a ClassCastException.", "url": "https://github.com/aws-amplify/amplify-android/pull/481#discussion_r426427808", "createdAt": "2020-05-18T07:44:23Z", "author": {"login": "jamesonwilliams"}, "path": "aws-predictions/src/main/java/com/amplifyframework/predictions/aws/service/AWSPredictionsService.java", "diffHunk": "@@ -104,12 +107,19 @@ public void translate(\n      * @param onError triggered upon encountering error\n      */\n     public void detectLabels(\n-            @NonNull LabelType type,\n+            @NonNull IdentifyAction type,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cbab4f719621c8505114a160a1f9a28ed9c17f8c"}, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjQyODA2MA==", "bodyText": "But why?", "url": "https://github.com/aws-amplify/amplify-android/pull/481#discussion_r426428060", "createdAt": "2020-05-18T07:44:53Z", "author": {"login": "jamesonwilliams"}, "path": "aws-predictions/src/main/java/com/amplifyframework/predictions/aws/service/AWSPredictionsService.java", "diffHunk": "@@ -184,6 +195,32 @@ public void comprehend(\n         comprehendService.comprehend(text, onSuccess, onError);\n     }\n \n+    /**\n+     * If {@link IdentifyAction} is an instance of {@link LabelType} and\n+     * cast if true. Otherwise check configuration for default action type.\n+     * Throw if label detection is not configured.\n+     */\n+    private LabelType getLabelType(IdentifyAction actionType) throws PredictionsException {\n+        try {\n+            return (LabelType) actionType;\n+        } catch (ClassCastException error) {\n+            return configuration.getIdentifyLabelsConfiguration().getType();\n+        }\n+    }\n+\n+    /**\n+     * If {@link IdentifyAction} is an instance of {@link TextFormatType} and\n+     * cast if true. Otherwise check configuration for default action type.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cbab4f719621c8505114a160a1f9a28ed9c17f8c"}, "originalPosition": 118}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjQyODkwNw==", "bodyText": "How about, \"Celebrity detection has not been configured.\" Disabled sounds more like it has been turned off explicitly, or is has been made unavailable by policy.", "url": "https://github.com/aws-amplify/amplify-android/pull/481#discussion_r426428907", "createdAt": "2020-05-18T07:46:31Z", "author": {"login": "jamesonwilliams"}, "path": "aws-predictions/src/main/java/com/amplifyframework/predictions/aws/service/AWSRekognitionService.java", "diffHunk": "@@ -133,9 +133,19 @@ void recognizeCelebrities(\n             @NonNull Consumer<IdentifyResult> onSuccess,\n             @NonNull Consumer<PredictionsException> onError\n     ) {\n+        final IdentifyEntitiesConfiguration config;\n         try {\n-            List<CelebrityDetails> celebrities = detectCelebrities(imageData);\n-            onSuccess.accept(IdentifyCelebritiesResult.fromCelebrities(celebrities));\n+            config = pluginConfiguration.getIdentifyEntitiesConfiguration();\n+            if (config.isCelebrityDetectionEnabled()) {\n+                List<CelebrityDetails> celebrities = detectCelebrities(imageData);\n+                onSuccess.accept(IdentifyCelebritiesResult.fromCelebrities(celebrities));\n+            } else {\n+                onError.accept(new PredictionsException(\"Celebrity detection is disabled.\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cbab4f719621c8505114a160a1f9a28ed9c17f8c"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjQyOTA4MA==", "bodyText": "This is a great recovery suggestion.", "url": "https://github.com/aws-amplify/amplify-android/pull/481#discussion_r426429080", "createdAt": "2020-05-18T07:46:51Z", "author": {"login": "jamesonwilliams"}, "path": "aws-predictions/src/main/java/com/amplifyframework/predictions/aws/service/AWSRekognitionService.java", "diffHunk": "@@ -133,9 +133,19 @@ void recognizeCelebrities(\n             @NonNull Consumer<IdentifyResult> onSuccess,\n             @NonNull Consumer<PredictionsException> onError\n     ) {\n+        final IdentifyEntitiesConfiguration config;\n         try {\n-            List<CelebrityDetails> celebrities = detectCelebrities(imageData);\n-            onSuccess.accept(IdentifyCelebritiesResult.fromCelebrities(celebrities));\n+            config = pluginConfiguration.getIdentifyEntitiesConfiguration();\n+            if (config.isCelebrityDetectionEnabled()) {\n+                List<CelebrityDetails> celebrities = detectCelebrities(imageData);\n+                onSuccess.accept(IdentifyCelebritiesResult.fromCelebrities(celebrities));\n+            } else {\n+                onError.accept(new PredictionsException(\"Celebrity detection is disabled.\",\n+                        \"Please enable celebrity detection via Amplify CLI. This feature \" +\n+                                \"should be accessible by running `amplify update predictions` \" +\n+                                \"in the console and updating entities detection resource with \" +\n+                                \"advanced configuration setting.\"));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cbab4f719621c8505114a160a1f9a28ed9c17f8c"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjQyOTk1MA==", "bodyText": "{\n    ...\n    \"convert\": {\n        \"textToSpeech\": {\n        }\n    }\n    ...\n}", "url": "https://github.com/aws-amplify/amplify-android/pull/481#discussion_r426429950", "createdAt": "2020-05-18T07:48:28Z", "author": {"login": "jamesonwilliams"}, "path": "aws-predictions/src/test/resources/configuration-with-text-to-speech.json", "diffHunk": "@@ -0,0 +1,11 @@\n+{\n+  \"defaultRegion\": \"us-west-1\",\n+  \"convert\": {\n+    \"speechGenerator\": {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cbab4f719621c8505114a160a1f9a28ed9c17f8c"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjQzMDIyNw==", "bodyText": "{\n    \"identify\": {\n        \"text\": {\n        }\n    }\n}", "url": "https://github.com/aws-amplify/amplify-android/pull/481#discussion_r426430227", "createdAt": "2020-05-18T07:48:58Z", "author": {"login": "jamesonwilliams"}, "path": "aws-predictions/src/test/resources/configuration-with-identify-text.json", "diffHunk": "@@ -0,0 +1,10 @@\n+{\n+  \"defaultRegion\": \"us-west-1\",\n+  \"identify\": {\n+    \"identifyText\": {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cbab4f719621c8505114a160a1f9a28ed9c17f8c"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjQzMDQ3NQ==", "bodyText": "{\n    \"identify\": {\n        \"labels\": {\n        }\n    }\n}", "url": "https://github.com/aws-amplify/amplify-android/pull/481#discussion_r426430475", "createdAt": "2020-05-18T07:49:25Z", "author": {"login": "jamesonwilliams"}, "path": "aws-predictions/src/test/resources/configuration-with-identify-labels.json", "diffHunk": "@@ -0,0 +1,10 @@\n+{\n+  \"defaultRegion\": \"us-west-1\",\n+  \"identify\": {\n+    \"identifyLabels\": {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cbab4f719621c8505114a160a1f9a28ed9c17f8c"}, "originalPosition": 4}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2503, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}