{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQwNjc3MTg2", "number": 608, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQyMDoyMjoxOFrOEJQV2g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQyMDoyNTo1OVrOEJQZVg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc4MTQwMzc4OnYy", "diffSide": "RIGHT", "path": ".circleci/config.yml", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQyMDoyMjoxOFrOGptoqQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQyMzo1NTozNVrOGpxeVg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjM5MjQ4OQ==", "bodyText": "So this might change more than we expected. Should we vendor this? What's the right (and secure) way? @jamesonwilliams", "url": "https://github.com/aws-amplify/amplify-android/pull/608#discussion_r446392489", "createdAt": "2020-06-26T20:22:18Z", "author": {"login": "jpignata"}, "path": ".circleci/config.yml", "diffHunk": "@@ -118,15 +118,15 @@ jobs:\n             .circleci/copy-configs\n       - run:\n           name: Run integration test\n-          command: .circleci/retry.sh 3 ./gradlew connectedDebugAndroidTest --no-daemon\n+          command: .circleci/run-integration-tests.sh\n       - run:\n           name: Store coverage data\n           command: |\n               .circleci/retry.sh 3 ./gradlew jacocoFullReport --no-daemon\n               tmp_file=\"$(mktemp)\"\n               curl -s https://codecov.io/bash > \"$tmp_file\"\n               actual_hash=\"$(cat $tmp_file | cksum | cut -f 1 -d\\ )\"\n-              expected_hash='2175291078'\n+              expected_hash='261829867'", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9f2d18d8d5a01482cc83498a8d2d52c612e50543"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjQ0NTU4Mg==", "bodyText": "Yeah, I had that thought too.  I went ahead and copied it into our repo for now.  The downside is it will probably require manual updates, but not sure of another option that is safe.", "url": "https://github.com/aws-amplify/amplify-android/pull/608#discussion_r446445582", "createdAt": "2020-06-26T23:03:41Z", "author": {"login": "richardmcclellan"}, "path": ".circleci/config.yml", "diffHunk": "@@ -118,15 +118,15 @@ jobs:\n             .circleci/copy-configs\n       - run:\n           name: Run integration test\n-          command: .circleci/retry.sh 3 ./gradlew connectedDebugAndroidTest --no-daemon\n+          command: .circleci/run-integration-tests.sh\n       - run:\n           name: Store coverage data\n           command: |\n               .circleci/retry.sh 3 ./gradlew jacocoFullReport --no-daemon\n               tmp_file=\"$(mktemp)\"\n               curl -s https://codecov.io/bash > \"$tmp_file\"\n               actual_hash=\"$(cat $tmp_file | cksum | cut -f 1 -d\\ )\"\n-              expected_hash='2175291078'\n+              expected_hash='261829867'", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjM5MjQ4OQ=="}, "originalCommit": {"oid": "9f2d18d8d5a01482cc83498a8d2d52c612e50543"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjQ1NTM4Mg==", "bodyText": "I made a separate PR for this: #609", "url": "https://github.com/aws-amplify/amplify-android/pull/608#discussion_r446455382", "createdAt": "2020-06-26T23:55:35Z", "author": {"login": "richardmcclellan"}, "path": ".circleci/config.yml", "diffHunk": "@@ -118,15 +118,15 @@ jobs:\n             .circleci/copy-configs\n       - run:\n           name: Run integration test\n-          command: .circleci/retry.sh 3 ./gradlew connectedDebugAndroidTest --no-daemon\n+          command: .circleci/run-integration-tests.sh\n       - run:\n           name: Store coverage data\n           command: |\n               .circleci/retry.sh 3 ./gradlew jacocoFullReport --no-daemon\n               tmp_file=\"$(mktemp)\"\n               curl -s https://codecov.io/bash > \"$tmp_file\"\n               actual_hash=\"$(cat $tmp_file | cksum | cut -f 1 -d\\ )\"\n-              expected_hash='2175291078'\n+              expected_hash='261829867'", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjM5MjQ4OQ=="}, "originalCommit": {"oid": "9f2d18d8d5a01482cc83498a8d2d52c612e50543"}, "originalPosition": 14}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc4MTQxMDAzOnYy", "diffSide": "RIGHT", "path": ".circleci/retry.sh", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQyMDoyNDo1MlrOGptsog==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQyMjo0NDo0MFrOGpwm-A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjM5MzUwNg==", "bodyText": "I know this wasn't your code, but I think you need parentheses here. See shellcheck's wiki. Might be a good thing to run on shell scripts we modify.", "url": "https://github.com/aws-amplify/amplify-android/pull/608#discussion_r446393506", "createdAt": "2020-06-26T20:24:52Z", "author": {"login": "jpignata"}, "path": ".circleci/retry.sh", "diffHunk": "@@ -1,23 +1,25 @@\n #!/bin/bash\n # Usage: retry.sh <max_tries> <command to run>\n \n+tag=\"RETRY\"\n readonly max_tries=$1\n readonly command=\"${@: 2}\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9f2d18d8d5a01482cc83498a8d2d52c612e50543"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjQ0MTIwOA==", "bodyText": "It is my code actually, I'm just not an expert with bash scripts :).  Thanks for sharing the shellcheck tool - I just used it to verify the problem and confirm a fix!", "url": "https://github.com/aws-amplify/amplify-android/pull/608#discussion_r446441208", "createdAt": "2020-06-26T22:44:40Z", "author": {"login": "richardmcclellan"}, "path": ".circleci/retry.sh", "diffHunk": "@@ -1,23 +1,25 @@\n #!/bin/bash\n # Usage: retry.sh <max_tries> <command to run>\n \n+tag=\"RETRY\"\n readonly max_tries=$1\n readonly command=\"${@: 2}\"", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjM5MzUwNg=="}, "originalCommit": {"oid": "9f2d18d8d5a01482cc83498a8d2d52c612e50543"}, "originalPosition": 6}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc4MTQxMjcwOnYy", "diffSide": "RIGHT", "path": ".circleci/run-integration-tests.sh", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQyMDoyNTo1OVrOGptuZQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQyMjo0NDowMVrOGpwmUA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjM5Mzk1Nw==", "bodyText": "Nit: missing double quotes on the variable", "url": "https://github.com/aws-amplify/amplify-android/pull/608#discussion_r446393957", "createdAt": "2020-06-26T20:25:59Z", "author": {"login": "jpignata"}, "path": ".circleci/run-integration-tests.sh", "diffHunk": "@@ -0,0 +1,22 @@\n+#!/bin/bash\n+\n+tag=\"RUN_INTEGRATION_TESTS\"\n+return_code=0\n+\n+# List all available gradle tasks, grep for the integration test tasks, and then use cut to strip the task description\n+# and just return the name of the task, one for each module (e.g. aws-api:connectedDebugAndroidTest)\n+tasks=($(./gradlew tasks --all | grep connectedDebugAndroidTest | cut -d \" \" -f 1))\n+\n+# Run the integration tests for each module.  Make up to 3 attempts on each module before failing.\n+for task in \"${tasks[@]}\"; do\n+  echo \"$tag: Starting $task\"\n+  .circleci/retry.sh 3 ./gradlew $task --no-daemon", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9f2d18d8d5a01482cc83498a8d2d52c612e50543"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjQ0MTA0MA==", "bodyText": "Fixed!", "url": "https://github.com/aws-amplify/amplify-android/pull/608#discussion_r446441040", "createdAt": "2020-06-26T22:44:01Z", "author": {"login": "richardmcclellan"}, "path": ".circleci/run-integration-tests.sh", "diffHunk": "@@ -0,0 +1,22 @@\n+#!/bin/bash\n+\n+tag=\"RUN_INTEGRATION_TESTS\"\n+return_code=0\n+\n+# List all available gradle tasks, grep for the integration test tasks, and then use cut to strip the task description\n+# and just return the name of the task, one for each module (e.g. aws-api:connectedDebugAndroidTest)\n+tasks=($(./gradlew tasks --all | grep connectedDebugAndroidTest | cut -d \" \" -f 1))\n+\n+# Run the integration tests for each module.  Make up to 3 attempts on each module before failing.\n+for task in \"${tasks[@]}\"; do\n+  echo \"$tag: Starting $task\"\n+  .circleci/retry.sh 3 ./gradlew $task --no-daemon", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjM5Mzk1Nw=="}, "originalCommit": {"oid": "9f2d18d8d5a01482cc83498a8d2d52c612e50543"}, "originalPosition": 13}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1055, "cost": 1, "resetAt": "2021-11-12T09:44:50Z"}}}