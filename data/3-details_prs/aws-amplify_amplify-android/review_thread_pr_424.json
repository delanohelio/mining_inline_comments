{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDEzMzM4NTE4", "number": 424, "reviewThreads": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNVQwNzo1OToxOFrOD5Sx1Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNVQxOToyODoyNVrOD5jCAw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYxNDAzMDkzOnYy", "diffSide": "RIGHT", "path": "testmodels/src/main/java/com/amplifyframework/testmodels/meeting/Meeting.java", "isResolved": true, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNVQwNzo1OToxOFrOGQeZSQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNVQyMDoyMTowMVrOGQ6ErA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTkyODM5Mw==", "bodyText": "Does this change need to be relayed to the CLI team again?", "url": "https://github.com/aws-amplify/amplify-android/pull/424#discussion_r419928393", "createdAt": "2020-05-05T07:59:18Z", "author": {"login": "raphkim"}, "path": "testmodels/src/main/java/com/amplifyframework/testmodels/meeting/Meeting.java", "diffHunk": "@@ -31,7 +31,7 @@\n     private final @ModelField(targetType=\"AWSDate\") AWSDate date;\n     private final @ModelField(targetType=\"AWSDateTime\") AWSDateTime dateTime;\n     private final @ModelField(targetType=\"AWSTime\") AWSTime time;\n-    private final @ModelField(targetType=\"AWSTimestamp\") Date timestamp;\n+    private final @ModelField(targetType=\"AWSTimestamp\") AWSTimestamp timestamp;", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDMxMTcyOQ==", "bodyText": "It would, yea.\nThanks for the call-out. Lest we forget to do this!", "url": "https://github.com/aws-amplify/amplify-android/pull/424#discussion_r420311729", "createdAt": "2020-05-05T18:16:02Z", "author": {"login": "jamesonwilliams"}, "path": "testmodels/src/main/java/com/amplifyframework/testmodels/meeting/Meeting.java", "diffHunk": "@@ -31,7 +31,7 @@\n     private final @ModelField(targetType=\"AWSDate\") AWSDate date;\n     private final @ModelField(targetType=\"AWSDateTime\") AWSDateTime dateTime;\n     private final @ModelField(targetType=\"AWSTime\") AWSTime time;\n-    private final @ModelField(targetType=\"AWSTimestamp\") Date timestamp;\n+    private final @ModelField(targetType=\"AWSTimestamp\") AWSTimestamp timestamp;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTkyODM5Mw=="}, "originalCommit": null, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDM1ODMwNA==", "bodyText": "Is this for compat with existing integration tests, or are you thinking this should be the ultimate design?\nOn one hand, my thought was that AWSTimestamp should map directly to java.util.Date because:\n\nThe data itself can be represented completely by java.util.Date\nSimpler developer experience to have a way to have a java.util.Date object on the model itself, since it eliminates the need to call a getDate() conversion method or something before they can actually use it.\n\nOn the other hand, having our own AWSTimestamp is more congruent with AWSTime, AWSDateTime, AWSDate.\nI guess what I'm saying is I don't feel that strongly one way or the other.   What were your thoughts?", "url": "https://github.com/aws-amplify/amplify-android/pull/424#discussion_r420358304", "createdAt": "2020-05-05T19:37:08Z", "author": {"login": "richardmcclellan"}, "path": "testmodels/src/main/java/com/amplifyframework/testmodels/meeting/Meeting.java", "diffHunk": "@@ -31,7 +31,7 @@\n     private final @ModelField(targetType=\"AWSDate\") AWSDate date;\n     private final @ModelField(targetType=\"AWSDateTime\") AWSDateTime dateTime;\n     private final @ModelField(targetType=\"AWSTime\") AWSTime time;\n-    private final @ModelField(targetType=\"AWSTimestamp\") Date timestamp;\n+    private final @ModelField(targetType=\"AWSTimestamp\") AWSTimestamp timestamp;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTkyODM5Mw=="}, "originalCommit": null, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDM4MTg2OA==", "bodyText": "To document our offline conversation, we agreed on these as the right trade-offs.\nWe should confirm with @drochetti, but believe that the developer has no path to create a java.util.Date in a non-model type. So, if our models also don't create java.util.Date, they would not be part of the system.\nSo, the AWSTimestamp could be okay for now.\nThis does allow us to re-visit what to do with Date in the future, too, I guess.", "url": "https://github.com/aws-amplify/amplify-android/pull/424#discussion_r420381868", "createdAt": "2020-05-05T20:21:01Z", "author": {"login": "jamesonwilliams"}, "path": "testmodels/src/main/java/com/amplifyframework/testmodels/meeting/Meeting.java", "diffHunk": "@@ -31,7 +31,7 @@\n     private final @ModelField(targetType=\"AWSDate\") AWSDate date;\n     private final @ModelField(targetType=\"AWSDateTime\") AWSDateTime dateTime;\n     private final @ModelField(targetType=\"AWSTime\") AWSTime time;\n-    private final @ModelField(targetType=\"AWSTimestamp\") Date timestamp;\n+    private final @ModelField(targetType=\"AWSTimestamp\") AWSTimestamp timestamp;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTkyODM5Mw=="}, "originalCommit": null, "originalPosition": 25}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYxNDA0MTE0OnYy", "diffSide": "RIGHT", "path": "core/src/main/java/com/amplifyframework/core/model/AWSTimestamp.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNVQwODowMjozMFrOGQefuA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNVQxOTozMzoyN1rOGQ4hLA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTkzMDA0MA==", "bodyText": "I think it would be helpful to provide additional constructors like\npublic AWSTimestamp(Date date);\npublic AWSTimestamp(String text);\n\nI think we should try to strongly associate Date with our new formats since it is what the customers are likely more familiar with. Our other AWS temporal datatypes are already coupled with Date if I remember correctly.", "url": "https://github.com/aws-amplify/amplify-android/pull/424#discussion_r419930040", "createdAt": "2020-05-05T08:02:30Z", "author": {"login": "raphkim"}, "path": "core/src/main/java/com/amplifyframework/core/model/AWSTimestamp.java", "diffHunk": "@@ -0,0 +1,60 @@\n+/*\n+ * Copyright 2020 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *  http://aws.amazon.com/apache2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ * permissions and limitations under the License.\n+ */\n+\n+package com.amplifyframework.core.model;\n+\n+/**\n+ * The AWSTimestamp scalar type represents the number of seconds that have elapsed\n+ * since 1970-01-01T00:00Z. Timestamps are serialized and deserialized as numbers.\n+ * Negative values are also accepted and these represent the number of seconds\n+ * til 1970-01-01T00:00Z.\n+ */\n+public final class AWSTimestamp {", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDMxMjg4MQ==", "bodyText": "Good idea, will do", "url": "https://github.com/aws-amplify/amplify-android/pull/424#discussion_r420312881", "createdAt": "2020-05-05T18:17:50Z", "author": {"login": "jamesonwilliams"}, "path": "core/src/main/java/com/amplifyframework/core/model/AWSTimestamp.java", "diffHunk": "@@ -0,0 +1,60 @@\n+/*\n+ * Copyright 2020 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *  http://aws.amazon.com/apache2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ * permissions and limitations under the License.\n+ */\n+\n+package com.amplifyframework.core.model;\n+\n+/**\n+ * The AWSTimestamp scalar type represents the number of seconds that have elapsed\n+ * since 1970-01-01T00:00Z. Timestamps are serialized and deserialized as numbers.\n+ * Negative values are also accepted and these represent the number of seconds\n+ * til 1970-01-01T00:00Z.\n+ */\n+public final class AWSTimestamp {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTkzMDA0MA=="}, "originalCommit": null, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDM1NjM5Ng==", "bodyText": "I ended up with:\n// \"now\"\nAWSTimestamp timestamp = new AWSTimestamp();\n\n// Any date\nAWSTimestamp timestamp = new AWSTimestamp(new Date());\n\n// An amount of time since the epoch\nAWSTimestamp timestamp = new AWSTimestamp(5_000L, TimeUnit.MILLISECONDS);", "url": "https://github.com/aws-amplify/amplify-android/pull/424#discussion_r420356396", "createdAt": "2020-05-05T19:33:27Z", "author": {"login": "jamesonwilliams"}, "path": "core/src/main/java/com/amplifyframework/core/model/AWSTimestamp.java", "diffHunk": "@@ -0,0 +1,60 @@\n+/*\n+ * Copyright 2020 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *  http://aws.amazon.com/apache2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ * permissions and limitations under the License.\n+ */\n+\n+package com.amplifyframework.core.model;\n+\n+/**\n+ * The AWSTimestamp scalar type represents the number of seconds that have elapsed\n+ * since 1970-01-01T00:00Z. Timestamps are serialized and deserialized as numbers.\n+ * Negative values are also accepted and these represent the number of seconds\n+ * til 1970-01-01T00:00Z.\n+ */\n+public final class AWSTimestamp {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTkzMDA0MA=="}, "originalCommit": null, "originalPosition": 24}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYxNDA0MTcwOnYy", "diffSide": "RIGHT", "path": "build.gradle", "isResolved": true, "comments": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNVQwODowMjo0MVrOGQegEw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNVQxOTo0NzoyMlrOGQ4-tg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTkzMDEzMQ==", "bodyText": "wooo", "url": "https://github.com/aws-amplify/amplify-android/pull/424#discussion_r419930131", "createdAt": "2020-05-05T08:02:41Z", "author": {"login": "raphkim"}, "path": "build.gradle", "diffHunk": "@@ -98,6 +99,7 @@ private void configureAndroidLibrary(Project project) {\n         compileSdkVersion rootProject.ext.compileSdkVersion\n \n         defaultConfig {\n+            multiDexEnabled true", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDMxMjk0NA==", "bodyText": "Eh, ~sorta, haha :-D", "url": "https://github.com/aws-amplify/amplify-android/pull/424#discussion_r420312944", "createdAt": "2020-05-05T18:17:58Z", "author": {"login": "jamesonwilliams"}, "path": "build.gradle", "diffHunk": "@@ -98,6 +99,7 @@ private void configureAndroidLibrary(Project project) {\n         compileSdkVersion rootProject.ext.compileSdkVersion\n \n         defaultConfig {\n+            multiDexEnabled true", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTkzMDEzMQ=="}, "originalCommit": null, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDMxNzIzMA==", "bodyText": "At one point this error got brought up early on in my discussion with VB (when discussing extensively overloading our API methods for convenience), but we dismissed it because 60k is A LOT. At the time, we didn't think we would be adding a direct dependency on a third-party framework...", "url": "https://github.com/aws-amplify/amplify-android/pull/424#discussion_r420317230", "createdAt": "2020-05-05T18:25:13Z", "author": {"login": "raphkim"}, "path": "build.gradle", "diffHunk": "@@ -98,6 +99,7 @@ private void configureAndroidLibrary(Project project) {\n         compileSdkVersion rootProject.ext.compileSdkVersion\n \n         defaultConfig {\n+            multiDexEnabled true", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTkzMDEzMQ=="}, "originalCommit": null, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDM1NTcwMw==", "bodyText": "Yea, we'd be busy coding to get to 65,536 ourselves. The vast majority of these come from our dependencies.", "url": "https://github.com/aws-amplify/amplify-android/pull/424#discussion_r420355703", "createdAt": "2020-05-05T19:32:10Z", "author": {"login": "jamesonwilliams"}, "path": "build.gradle", "diffHunk": "@@ -98,6 +99,7 @@ private void configureAndroidLibrary(Project project) {\n         compileSdkVersion rootProject.ext.compileSdkVersion\n \n         defaultConfig {\n+            multiDexEnabled true", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTkzMDEzMQ=="}, "originalCommit": null, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDM1ODk1MQ==", "bodyText": "Do you think this was due to the addition of the threeten library?  That would be unfortunate :/", "url": "https://github.com/aws-amplify/amplify-android/pull/424#discussion_r420358951", "createdAt": "2020-05-05T19:38:25Z", "author": {"login": "richardmcclellan"}, "path": "build.gradle", "diffHunk": "@@ -98,6 +99,7 @@ private void configureAndroidLibrary(Project project) {\n         compileSdkVersion rootProject.ext.compileSdkVersion\n \n         defaultConfig {\n+            multiDexEnabled true", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTkzMDEzMQ=="}, "originalCommit": null, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDM2MzM2OA==", "bodyText": "I think after we agreed to add rxJava as a core dependency, we already set a precedent. From that point on, going over the limit was kind of inevitable, so I wouldn't blame it on any particular library", "url": "https://github.com/aws-amplify/amplify-android/pull/424#discussion_r420363368", "createdAt": "2020-05-05T19:46:14Z", "author": {"login": "raphkim"}, "path": "build.gradle", "diffHunk": "@@ -98,6 +99,7 @@ private void configureAndroidLibrary(Project project) {\n         compileSdkVersion rootProject.ext.compileSdkVersion\n \n         defaultConfig {\n+            multiDexEnabled true", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTkzMDEzMQ=="}, "originalCommit": null, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDM2Mzk1OA==", "bodyText": "John had run this over the weekend - https://github.com/KeepSafe/dexcount-gradle-plugin\nThat probably added a few, but it definitely wasn't one of the big offenders. OkHttp and RxJava alone are almost half of it.", "url": "https://github.com/aws-amplify/amplify-android/pull/424#discussion_r420363958", "createdAt": "2020-05-05T19:47:22Z", "author": {"login": "jamesonwilliams"}, "path": "build.gradle", "diffHunk": "@@ -98,6 +99,7 @@ private void configureAndroidLibrary(Project project) {\n         compileSdkVersion rootProject.ext.compileSdkVersion\n \n         defaultConfig {\n+            multiDexEnabled true", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTkzMDEzMQ=="}, "originalCommit": null, "originalPosition": 12}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYxNDA0MzM2OnYy", "diffSide": "RIGHT", "path": "aws-storage-s3/src/androidTest/java/com/amplifyframework/storage/s3/AWSS3StorageUploadTest.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNVQwODowMzoxMFrOGQehIA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNVQxODoyMjo1OVrOGQ2DEQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTkzMDQwMA==", "bodyText": "hmm is this an oxymoron? lol", "url": "https://github.com/aws-amplify/amplify-android/pull/424#discussion_r419930400", "createdAt": "2020-05-05T08:03:10Z", "author": {"login": "raphkim"}, "path": "aws-storage-s3/src/androidTest/java/com/amplifyframework/storage/s3/AWSS3StorageUploadTest.java", "diffHunk": "@@ -195,6 +196,7 @@ public void testUploadFileIsCancelable() throws Exception {\n      *         completed successfully before timeout\n      */\n     @Test\n+    @Ignore(\"This test is failing reliably.\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDMxMzI5OQ==", "bodyText": "Haha yea. Actually, sorry, this @Ignore message is not setting a good example. It should have a bit more. Will update.", "url": "https://github.com/aws-amplify/amplify-android/pull/424#discussion_r420313299", "createdAt": "2020-05-05T18:18:30Z", "author": {"login": "jamesonwilliams"}, "path": "aws-storage-s3/src/androidTest/java/com/amplifyframework/storage/s3/AWSS3StorageUploadTest.java", "diffHunk": "@@ -195,6 +196,7 @@ public void testUploadFileIsCancelable() throws Exception {\n      *         completed successfully before timeout\n      */\n     @Test\n+    @Ignore(\"This test is failing reliably.\")", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTkzMDQwMA=="}, "originalCommit": null, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDMxNTkyMQ==", "bodyText": "haha I thought it was a funny message because \"prone-to-failure\" vs \"reliability\".\nI think the reason for @Ignore is sufficient with this already, so need to fix", "url": "https://github.com/aws-amplify/amplify-android/pull/424#discussion_r420315921", "createdAt": "2020-05-05T18:22:59Z", "author": {"login": "raphkim"}, "path": "aws-storage-s3/src/androidTest/java/com/amplifyframework/storage/s3/AWSS3StorageUploadTest.java", "diffHunk": "@@ -195,6 +196,7 @@ public void testUploadFileIsCancelable() throws Exception {\n      *         completed successfully before timeout\n      */\n     @Test\n+    @Ignore(\"This test is failing reliably.\")", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTkzMDQwMA=="}, "originalCommit": null, "originalPosition": 12}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYxNDA0OTQ2OnYy", "diffSide": "RIGHT", "path": "aws-api/src/main/java/com/amplifyframework/api/aws/GsonListDeserializer.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNVQwODowNDo0MlrOGQekrg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNVQxODoyMTo0M1rOGQ2AZg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTkzMTMxMA==", "bodyText": "2020", "url": "https://github.com/aws-amplify/amplify-android/pull/424#discussion_r419931310", "createdAt": "2020-05-05T08:04:42Z", "author": {"login": "raphkim"}, "path": "aws-api/src/main/java/com/amplifyframework/api/aws/GsonListDeserializer.java", "diffHunk": "@@ -0,0 +1,80 @@\n+/*\n+ * Copyright 2019 Amazon.com, Inc. or its affiliates. All Rights Reserved.", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 2}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDMxMzUwMw==", "bodyText": "This file was actually from 2019. It was removed only for a few days.", "url": "https://github.com/aws-amplify/amplify-android/pull/424#discussion_r420313503", "createdAt": "2020-05-05T18:18:49Z", "author": {"login": "jamesonwilliams"}, "path": "aws-api/src/main/java/com/amplifyframework/api/aws/GsonListDeserializer.java", "diffHunk": "@@ -0,0 +1,80 @@\n+/*\n+ * Copyright 2019 Amazon.com, Inc. or its affiliates. All Rights Reserved.", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTkzMTMxMA=="}, "originalCommit": null, "originalPosition": 2}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDMxNTIzOA==", "bodyText": "makes sense! Go on ahead then :)", "url": "https://github.com/aws-amplify/amplify-android/pull/424#discussion_r420315238", "createdAt": "2020-05-05T18:21:43Z", "author": {"login": "raphkim"}, "path": "aws-api/src/main/java/com/amplifyframework/api/aws/GsonListDeserializer.java", "diffHunk": "@@ -0,0 +1,80 @@\n+/*\n+ * Copyright 2019 Amazon.com, Inc. or its affiliates. All Rights Reserved.", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTkzMTMxMA=="}, "originalCommit": null, "originalPosition": 2}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYxNjY0NjU5OnYy", "diffSide": "RIGHT", "path": "aws-api/src/main/java/com/amplifyframework/api/aws/GsonListDeserializer.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNVQxOToxNDo0MFrOGQ34ew==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNVQyMjozMzowN1rOGQ9_aQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDM0NTk3OQ==", "bodyText": "Strangely I could have sworn this deserializer was not actually used, and instead the logic for deserializing the \"items\" array was handled in GsonGraphQLResponseFactory.\nI'm guessing there's a use case that I'm not familiar with yet - I'll take a closer look at the integration tests today to try and understand this further.", "url": "https://github.com/aws-amplify/amplify-android/pull/424#discussion_r420345979", "createdAt": "2020-05-05T19:14:40Z", "author": {"login": "richardmcclellan"}, "path": "aws-api/src/main/java/com/amplifyframework/api/aws/GsonListDeserializer.java", "diffHunk": "@@ -0,0 +1,80 @@\n+/*\n+ * Copyright 2019 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *  http://aws.amazon.com/apache2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ * permissions and limitations under the License.\n+ */\n+\n+package com.amplifyframework.api.aws;\n+\n+import com.google.gson.Gson;\n+import com.google.gson.JsonArray;\n+import com.google.gson.JsonDeserializationContext;\n+import com.google.gson.JsonDeserializer;\n+import com.google.gson.JsonElement;\n+import com.google.gson.JsonObject;\n+import com.google.gson.JsonParseException;\n+\n+import java.lang.reflect.ParameterizedType;\n+import java.lang.reflect.Type;\n+import java.util.ArrayList;\n+import java.util.Collections;\n+import java.util.List;\n+\n+/**\n+ * Custom list deserializer since some lists come back not as an array of the items but as an object which contains\n+ * an items property with the list of items and a nextToken property for pagination purposes.\n+ */\n+final class GsonListDeserializer implements JsonDeserializer<List<Object>> {", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 36}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDM2NDUzNQ==", "bodyText": "I was surprised by this, too. I was pretty sure we have some unit tests that contain listed items. Not sure where the discrepancy is coming from!", "url": "https://github.com/aws-amplify/amplify-android/pull/424#discussion_r420364535", "createdAt": "2020-05-05T19:48:31Z", "author": {"login": "jamesonwilliams"}, "path": "aws-api/src/main/java/com/amplifyframework/api/aws/GsonListDeserializer.java", "diffHunk": "@@ -0,0 +1,80 @@\n+/*\n+ * Copyright 2019 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *  http://aws.amazon.com/apache2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ * permissions and limitations under the License.\n+ */\n+\n+package com.amplifyframework.api.aws;\n+\n+import com.google.gson.Gson;\n+import com.google.gson.JsonArray;\n+import com.google.gson.JsonDeserializationContext;\n+import com.google.gson.JsonDeserializer;\n+import com.google.gson.JsonElement;\n+import com.google.gson.JsonObject;\n+import com.google.gson.JsonParseException;\n+\n+import java.lang.reflect.ParameterizedType;\n+import java.lang.reflect.Type;\n+import java.util.ArrayList;\n+import java.util.Collections;\n+import java.util.List;\n+\n+/**\n+ * Custom list deserializer since some lists come back not as an array of the items but as an object which contains\n+ * an items property with the list of items and a nextToken property for pagination purposes.\n+ */\n+final class GsonListDeserializer implements JsonDeserializer<List<Object>> {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDM0NTk3OQ=="}, "originalCommit": null, "originalPosition": 36}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDQ0NjA1Nw==", "bodyText": "Ok, I figured this out.\nbuildSingleArrayResponse automatically skips the \"items\" level before parsing it with Gson.\nbuildSingleItemResponse does not, so it relies on GsonListDeserializer.\nI guess that means we have no unit tests for buildSingleItemResponse, so definitely something to add at some point.", "url": "https://github.com/aws-amplify/amplify-android/pull/424#discussion_r420446057", "createdAt": "2020-05-05T22:33:07Z", "author": {"login": "richardmcclellan"}, "path": "aws-api/src/main/java/com/amplifyframework/api/aws/GsonListDeserializer.java", "diffHunk": "@@ -0,0 +1,80 @@\n+/*\n+ * Copyright 2019 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *  http://aws.amazon.com/apache2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ * permissions and limitations under the License.\n+ */\n+\n+package com.amplifyframework.api.aws;\n+\n+import com.google.gson.Gson;\n+import com.google.gson.JsonArray;\n+import com.google.gson.JsonDeserializationContext;\n+import com.google.gson.JsonDeserializer;\n+import com.google.gson.JsonElement;\n+import com.google.gson.JsonObject;\n+import com.google.gson.JsonParseException;\n+\n+import java.lang.reflect.ParameterizedType;\n+import java.lang.reflect.Type;\n+import java.util.ArrayList;\n+import java.util.Collections;\n+import java.util.List;\n+\n+/**\n+ * Custom list deserializer since some lists come back not as an array of the items but as an object which contains\n+ * an items property with the list of items and a nextToken property for pagination purposes.\n+ */\n+final class GsonListDeserializer implements JsonDeserializer<List<Object>> {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDM0NTk3OQ=="}, "originalCommit": null, "originalPosition": 36}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYxNjY5Mzc5OnYy", "diffSide": "RIGHT", "path": "aws-api/src/main/java/com/amplifyframework/api/aws/GsonListDeserializer.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNVQxOToyODoyNVrOGQ4Wcw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNVQyMDozNjo0NFrOGQ6lFg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDM1MzY1MQ==", "bodyText": "Injecting these into the constructor is a pretty good approach, but I think a better is to use the JsonDeserializationContext that is already passed in.\nInstead of:\nlistGson.fromJson(item, clazz)\n\nuse:\ncontext.deserialize(item, clazz)\n\nAnd instead of:\nsingleGson.fromJson(json, typeOfT)\n\nuse (you have to iterate through the array manually rather than just deserializing json itself to avoid endless recursion):\nList<Object> items = new ArrayList();\nfor(JsonElement item : json.getAsJsonArray()) {\n    items.add(context.deserialize(item, clazz);\n}\nreturn items;\n\nTwo main benefits to this approach:\n\nNo dependencies at all\nYou are guaranteed to be using the same Gson instance that was provided to deserialize the root node.", "url": "https://github.com/aws-amplify/amplify-android/pull/424#discussion_r420353651", "createdAt": "2020-05-05T19:28:25Z", "author": {"login": "richardmcclellan"}, "path": "aws-api/src/main/java/com/amplifyframework/api/aws/GsonListDeserializer.java", "diffHunk": "@@ -0,0 +1,80 @@\n+/*\n+ * Copyright 2019 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *  http://aws.amazon.com/apache2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ * permissions and limitations under the License.\n+ */\n+\n+package com.amplifyframework.api.aws;\n+\n+import com.google.gson.Gson;\n+import com.google.gson.JsonArray;\n+import com.google.gson.JsonDeserializationContext;\n+import com.google.gson.JsonDeserializer;\n+import com.google.gson.JsonElement;\n+import com.google.gson.JsonObject;\n+import com.google.gson.JsonParseException;\n+\n+import java.lang.reflect.ParameterizedType;\n+import java.lang.reflect.Type;\n+import java.util.ArrayList;\n+import java.util.Collections;\n+import java.util.List;\n+\n+/**\n+ * Custom list deserializer since some lists come back not as an array of the items but as an object which contains\n+ * an items property with the list of items and a nextToken property for pagination purposes.\n+ */\n+final class GsonListDeserializer implements JsonDeserializer<List<Object>> {\n+    private final Gson singleGson;\n+    private final Gson listGson;\n+\n+    GsonListDeserializer() {\n+        this.singleGson = GsonFactory.create();\n+        this.listGson = GsonFactory.create(Collections.singletonMap(List.class, this));", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 42}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDM5MDE2Ng==", "bodyText": "Awesome!! Thanks. (We implemented this together on call. Pushing update now.)", "url": "https://github.com/aws-amplify/amplify-android/pull/424#discussion_r420390166", "createdAt": "2020-05-05T20:36:44Z", "author": {"login": "jamesonwilliams"}, "path": "aws-api/src/main/java/com/amplifyframework/api/aws/GsonListDeserializer.java", "diffHunk": "@@ -0,0 +1,80 @@\n+/*\n+ * Copyright 2019 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *  http://aws.amazon.com/apache2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ * permissions and limitations under the License.\n+ */\n+\n+package com.amplifyframework.api.aws;\n+\n+import com.google.gson.Gson;\n+import com.google.gson.JsonArray;\n+import com.google.gson.JsonDeserializationContext;\n+import com.google.gson.JsonDeserializer;\n+import com.google.gson.JsonElement;\n+import com.google.gson.JsonObject;\n+import com.google.gson.JsonParseException;\n+\n+import java.lang.reflect.ParameterizedType;\n+import java.lang.reflect.Type;\n+import java.util.ArrayList;\n+import java.util.Collections;\n+import java.util.List;\n+\n+/**\n+ * Custom list deserializer since some lists come back not as an array of the items but as an object which contains\n+ * an items property with the list of items and a nextToken property for pagination purposes.\n+ */\n+final class GsonListDeserializer implements JsonDeserializer<List<Object>> {\n+    private final Gson singleGson;\n+    private final Gson listGson;\n+\n+    GsonListDeserializer() {\n+        this.singleGson = GsonFactory.create();\n+        this.listGson = GsonFactory.create(Collections.singletonMap(List.class, this));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDM1MzY1MQ=="}, "originalCommit": null, "originalPosition": 42}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1492, "cost": 1, "resetAt": "2021-11-12T09:44:50Z"}}}