{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDc5OTU5Mjgy", "number": 801, "title": "Revert \"Revert \"fix(aws-datastore): selection set for nested custom types (#730)\" (#777)\"", "bodyText": "This reverts commit fbef1e8.\nThis PR is to add back @saltonmassally 's support for non-model types.    This functionality was originally added in #730, but reverted in #777 because the integration tests were failing due to incomplete support for Temporal types, but this support was just added in #783.\nBy submitting this pull request, I confirm that my contribution is made under the terms of the Apache 2.0 license.", "createdAt": "2020-09-04T18:30:34Z", "url": "https://github.com/aws-amplify/amplify-android/pull/801", "merged": true, "mergeCommit": {"oid": "55077a72a1509496359b394d18ae003fce5cbe0c"}, "closed": true, "closedAt": "2020-09-04T20:05:36Z", "author": {"login": "richardmcclellan"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdFo8BQgH2gAyNDc5OTU5MjgyOjc0OGFlNjAxYjc1NzI1NWYyNjdhNjJiMGJjYmFhM2JiNDk3MTZhZDc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdFq4KkgFqTQ4MjkxMzE5OQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "748ae601b757255f267a62b0bcbaa3bb49716ad7", "author": {"user": {"login": "richardmcclellan", "name": "Richard McClellan"}}, "url": "https://github.com/aws-amplify/amplify-android/commit/748ae601b757255f267a62b0bcbaa3bb49716ad7", "committedDate": "2020-09-04T17:48:37Z", "message": "Revert \"Revert \"fix(aws-datastore): selection set for nested custom types (#730)\" (#777)\"\n\nThis reverts commit fbef1e8f9ccfb25e140bbb5199d018b016499958."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgyODcwMjk2", "url": "https://github.com/aws-amplify/amplify-android/pull/801#pullrequestreview-482870296", "createdAt": "2020-09-04T18:35:37Z", "commit": {"oid": "748ae601b757255f267a62b0bcbaa3bb49716ad7"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wNFQxODozNTozN1rOHNYIGg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wNFQxODozNTozN1rOHNYIGg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Mzc4ODgyNg==", "bodyText": "@saltonmassally, @richardmcclellan, @jamesonwilliams I know this wasn't flagged on the original PR but just wanted to double check we're good changing this public method name since it would be a breaking change if anyone was currently using it?", "url": "https://github.com/aws-amplify/amplify-android/pull/801#discussion_r483788826", "createdAt": "2020-09-04T18:35:37Z", "author": {"login": "TrekSoft"}, "path": "core/src/main/java/com/amplifyframework/util/FieldFinder.java", "diffHunk": "@@ -45,21 +46,40 @@ private FieldFinder() {\n      * @return set of fields\n      */\n     @NonNull\n-    public static List<Field> findFieldsIn(@NonNull Class<?> clazz) {\n+    public static List<Field> findModelFieldsIn(@NonNull Class<?> clazz) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "748ae601b757255f267a62b0bcbaa3bb49716ad7"}, "originalPosition": 13}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgyOTA2Mjg3", "url": "https://github.com/aws-amplify/amplify-android/pull/801#pullrequestreview-482906287", "createdAt": "2020-09-04T19:49:24Z", "commit": null, "state": "COMMENTED", "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wNFQxOTo0OToyNFrOHNZ3rQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wNFQxOTo1MDo1M1rOHNZ5yw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzgxNzM4OQ==", "bodyText": "No one should be using our FieldFinder; it's an internal utility in the context of the project.", "url": "https://github.com/aws-amplify/amplify-android/pull/801#discussion_r483817389", "createdAt": "2020-09-04T19:49:24Z", "author": {"login": "jamesonwilliams"}, "path": "core/src/main/java/com/amplifyframework/util/FieldFinder.java", "diffHunk": "@@ -45,21 +46,40 @@ private FieldFinder() {\n      * @return set of fields\n      */\n     @NonNull\n-    public static List<Field> findFieldsIn(@NonNull Class<?> clazz) {\n+    public static List<Field> findModelFieldsIn(@NonNull Class<?> clazz) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Mzc4ODgyNg=="}, "originalCommit": {"oid": "748ae601b757255f267a62b0bcbaa3bb49716ad7"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzgxNzU4Mw==", "bodyText": "Are these different?", "url": "https://github.com/aws-amplify/amplify-android/pull/801#discussion_r483817583", "createdAt": "2020-09-04T19:49:58Z", "author": {"login": "jamesonwilliams"}, "path": "core/src/main/java/com/amplifyframework/util/FieldFinder.java", "diffHunk": "@@ -39,44 +40,52 @@ private FieldFinder() {\n     }\n \n     /**\n-     * Get a set of all the fields of a class that are\n-     * annotated with {@link ModelField} annotation.\n+     * Get a set of all the fields of a class that are annotated with {@link ModelField} annotation.\n+     *\n+     * @deprecated Use {@link #findModelFieldsIn} instead.\n+     * @param clazz the Class object.\n+     * @return set of fields.\n+     */\n+    @NonNull\n+    @Deprecated\n+    public static List<Field> findFieldsIn(@NonNull Class<?> clazz) {\n+        return findModelFieldsIn(clazz);\n+    }\n+\n+    /**\n+     * Get a set of all the fields of a class that are annotated with {@link ModelField} annotation.\n      *\n      * @param clazz the Class object.\n      * @return set of fields\n      */\n     @NonNull\n     public static List<Field> findModelFieldsIn(@NonNull Class<?> clazz) {\n-        final List<Field> fields = new ArrayList<>();\n-        Class<?> fieldContainerClazz = clazz;\n-        while (fieldContainerClazz != null) {\n-            for (Field field : fieldContainerClazz.getDeclaredFields()) {\n-                if (field.isAnnotationPresent(ModelField.class)) {\n-                    fields.add(field);\n-                }\n-            }\n-            fieldContainerClazz = fieldContainerClazz.getSuperclass();\n-        }\n-        Collections.sort(fields, (o1, o2) -> o1.getName().compareTo(o2.getName()));\n-        return Immutable.of(fields);\n+        return findFieldsIn(clazz, field -> field.isAnnotationPresent(ModelField.class));\n     }\n \n     /**\n-     * Helper for finding all fields in a class without limiting limiting to {@link ModelField}.\n+     * Helper for finding all fields in a class without limiting to {@link ModelField}.\n      * @param clazz clazz the Class object.\n      * @return set of fields\n      */\n     @NonNull\n     public static List<Field> findAllFieldsIn(@NonNull Class<?> clazz) {\n+        return findFieldsIn(clazz, field -> true);\n+    }\n+\n+    @NonNull\n+    private static List<Field> findFieldsIn(@NonNull Class<?> clazz, Predicate<Field> predicate) {\n         final List<Field> fields = new ArrayList<>();\n         Class<?> fieldContainerClazz = clazz;\n         while (fieldContainerClazz != null) {\n             for (Field field : fieldContainerClazz.getDeclaredFields()) {\n-                fields.add(field);\n+                if(predicate.test(field)) {\n+                    fields.add(field);\n+                }\n             }\n             fieldContainerClazz = fieldContainerClazz.getSuperclass();\n         }\n-        Collections.sort(fields, Comparator.comparing(Field::getName));\n+        Collections.sort(fields, (o1, o2) -> o1.getName().compareTo(o2.getName()));", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 84}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzgxNzY1Ng==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                            if(predicate.test(field)) {\n          \n          \n            \n                            if (predicate.test(field)) {", "url": "https://github.com/aws-amplify/amplify-android/pull/801#discussion_r483817656", "createdAt": "2020-09-04T19:50:07Z", "author": {"login": "jamesonwilliams"}, "path": "core/src/main/java/com/amplifyframework/util/FieldFinder.java", "diffHunk": "@@ -39,44 +40,52 @@ private FieldFinder() {\n     }\n \n     /**\n-     * Get a set of all the fields of a class that are\n-     * annotated with {@link ModelField} annotation.\n+     * Get a set of all the fields of a class that are annotated with {@link ModelField} annotation.\n+     *\n+     * @deprecated Use {@link #findModelFieldsIn} instead.\n+     * @param clazz the Class object.\n+     * @return set of fields.\n+     */\n+    @NonNull\n+    @Deprecated\n+    public static List<Field> findFieldsIn(@NonNull Class<?> clazz) {\n+        return findModelFieldsIn(clazz);\n+    }\n+\n+    /**\n+     * Get a set of all the fields of a class that are annotated with {@link ModelField} annotation.\n      *\n      * @param clazz the Class object.\n      * @return set of fields\n      */\n     @NonNull\n     public static List<Field> findModelFieldsIn(@NonNull Class<?> clazz) {\n-        final List<Field> fields = new ArrayList<>();\n-        Class<?> fieldContainerClazz = clazz;\n-        while (fieldContainerClazz != null) {\n-            for (Field field : fieldContainerClazz.getDeclaredFields()) {\n-                if (field.isAnnotationPresent(ModelField.class)) {\n-                    fields.add(field);\n-                }\n-            }\n-            fieldContainerClazz = fieldContainerClazz.getSuperclass();\n-        }\n-        Collections.sort(fields, (o1, o2) -> o1.getName().compareTo(o2.getName()));\n-        return Immutable.of(fields);\n+        return findFieldsIn(clazz, field -> field.isAnnotationPresent(ModelField.class));\n     }\n \n     /**\n-     * Helper for finding all fields in a class without limiting limiting to {@link ModelField}.\n+     * Helper for finding all fields in a class without limiting to {@link ModelField}.\n      * @param clazz clazz the Class object.\n      * @return set of fields\n      */\n     @NonNull\n     public static List<Field> findAllFieldsIn(@NonNull Class<?> clazz) {\n+        return findFieldsIn(clazz, field -> true);\n+    }\n+\n+    @NonNull\n+    private static List<Field> findFieldsIn(@NonNull Class<?> clazz, Predicate<Field> predicate) {\n         final List<Field> fields = new ArrayList<>();\n         Class<?> fieldContainerClazz = clazz;\n         while (fieldContainerClazz != null) {\n             for (Field field : fieldContainerClazz.getDeclaredFields()) {\n-                fields.add(field);\n+                if(predicate.test(field)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 77}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzgxNzc4Nw==", "bodyText": "Suggested change", "url": "https://github.com/aws-amplify/amplify-android/pull/801#discussion_r483817787", "createdAt": "2020-09-04T19:50:30Z", "author": {"login": "jamesonwilliams"}, "path": "core/src/main/java/com/amplifyframework/util/FieldFinder.java", "diffHunk": "@@ -17,15 +17,16 @@\n \n import androidx.annotation.NonNull;\n import androidx.annotation.Nullable;\n+import androidx.core.util.Predicate;\n \n import com.amplifyframework.core.model.annotations.ModelField;\n \n import java.lang.reflect.Field;\n import java.util.ArrayList;\n import java.util.Collections;\n-import java.util.Comparator;\n import java.util.List;\n \n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzgxNzkzMQ==", "bodyText": "We have various functional interfaces like this defined in our own library, I think. Should we use AndroidX's? Or one of ours?", "url": "https://github.com/aws-amplify/amplify-android/pull/801#discussion_r483817931", "createdAt": "2020-09-04T19:50:53Z", "author": {"login": "jamesonwilliams"}, "path": "core/src/main/java/com/amplifyframework/util/FieldFinder.java", "diffHunk": "@@ -17,15 +17,16 @@\n \n import androidx.annotation.NonNull;\n import androidx.annotation.Nullable;\n+import androidx.core.util.Predicate;", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 4}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": {"oid": "748ae601b757255f267a62b0bcbaa3bb49716ad7", "author": {"user": {"login": "richardmcclellan", "name": "Richard McClellan"}}, "url": "https://github.com/aws-amplify/amplify-android/commit/748ae601b757255f267a62b0bcbaa3bb49716ad7", "committedDate": "2020-09-04T17:48:37Z", "message": "Revert \"Revert \"fix(aws-datastore): selection set for nested custom types (#730)\" (#777)\"\n\nThis reverts commit fbef1e8f9ccfb25e140bbb5199d018b016499958."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgyOTEzMTk5", "url": "https://github.com/aws-amplify/amplify-android/pull/801#pullrequestreview-482913199", "createdAt": "2020-09-04T20:04:13Z", "commit": {"oid": "748ae601b757255f267a62b0bcbaa3bb49716ad7"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1676, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}