{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA1MzExMzcw", "number": 383, "title": "Adds forgotPassword/confirmForgotPassword", "bodyText": "https://quip-amazon.com/V550Arr1aKJN/Amplify-Auth-Category-Interface#KVW9CAtlT6x\nBy submitting this pull request, I confirm that my contribution is made under the terms of the Apache 2.0 license.", "createdAt": "2020-04-17T19:50:33Z", "url": "https://github.com/aws-amplify/amplify-android/pull/383", "merged": true, "mergeCommit": {"oid": "3721ce58d280fd4f907b4d9a2ea3bcd01e95b043"}, "closed": true, "closedAt": "2020-04-17T20:20:54Z", "author": {"login": "TrekSoft"}, "timelineItems": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcYmwA1AH2gAyNDA1MzExMzcwOmYwZDliYjdlZTAwZjhjNzc4M2NiNTljYzYxMTg3ZmJlYmU0ZTQ1MjU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcYm4JVgFqTM5NTczMjg4Mw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "f0d9bb7ee00f8c7783cb59cc61187fbebe4e4525", "author": {"user": {"login": "TrekSoft", "name": "David Daudelin"}}, "url": "https://github.com/aws-amplify/amplify-android/commit/f0d9bb7ee00f8c7783cb59cc61187fbebe4e4525", "committedDate": "2020-04-17T19:49:06Z", "message": "Adds forgotPassword/confirmForgotPassword"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk1NzMyODgz", "url": "https://github.com/aws-amplify/amplify-android/pull/383#pullrequestreview-395732883", "createdAt": "2020-04-17T19:53:47Z", "commit": {"oid": "f0d9bb7ee00f8c7783cb59cc61187fbebe4e4525"}, "state": "APPROVED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xN1QxOTo1Mzo0OFrOGHbL_A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xN1QxOTo1NzozMlrOGHbSTQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDQzODY1Mg==", "bodyText": "How come you don't pass back convertCodeDeliveryDetails(result.getParameters()) here too? Doesn't contain any valuable info?", "url": "https://github.com/aws-amplify/amplify-android/pull/383#discussion_r410438652", "createdAt": "2020-04-17T19:53:48Z", "author": {"login": "jamesonwilliams"}, "path": "aws-auth-cognito/src/main/java/com/amplifyframework/auth/cognito/AWSCognitoAuthPlugin.java", "diffHunk": "@@ -367,22 +370,88 @@ public void onResult(UserStateDetails result) {\n \n                 @Override\n                 public void onError(Exception exception) {\n-                    onError.accept(new AuthException(\n+                    onException.accept(new AuthException(\n                             \"An error occurred while attempting to retrieve your user details\",\n                             exception,\n                             \"See attached exception for more details\"\n                     ));\n                 }\n             });\n         } catch (Throwable exception) {\n-            onError.accept(new AuthException(\n+            onException.accept(new AuthException(\n                     \"An error occurred fetching authorization details for the current user\",\n                     exception,\n                     \"See attached exception for more details\"\n             ));\n         }\n     }\n \n+    @Override\n+    public void forgotPassword(\n+            @NonNull String username,\n+            @NonNull Consumer<AuthCodeDeliveryDetails> onSuccess,\n+            @NonNull Consumer<AuthException> onException\n+    ) {\n+        AWSMobileClient.getInstance().forgotPassword(username, new Callback<ForgotPasswordResult>() {\n+            @Override\n+            public void onResult(ForgotPasswordResult result) {\n+                if (result.getState().equals(ForgotPasswordState.CONFIRMATION_CODE)) {\n+                    onSuccess.accept(convertCodeDeliveryDetails(result.getParameters()));\n+                } else {\n+                    onException.accept(new AuthException(\n+                            \"Received an unsupported response after triggering password recovery: \" + result.getState(),\n+                            \"This is almost certainly a bug. Please report it as an issue in our GitHub repo.\"\n+                    ));\n+                }\n+            }\n+\n+            @Override\n+            public void onError(Exception exception) {\n+                onException.accept(new AuthException(\n+                        \"An error occurred triggering password recovery\",\n+                        exception,\n+                        \"See attached exception for more details\"\n+                ));\n+            }\n+        });\n+    }\n+\n+    @Override\n+    public void confirmForgotPassword(\n+            @NonNull String newPassword,\n+            @NonNull String confirmationCode,\n+            @NonNull Action onSuccess,\n+            @NonNull Consumer<AuthException> onException\n+    ) {\n+        AWSMobileClient.getInstance().confirmForgotPassword(\n+            newPassword,\n+            confirmationCode,\n+            new Callback<ForgotPasswordResult>() {\n+                @Override\n+                public void onResult(ForgotPasswordResult result) {\n+                    if (result.getState().equals(ForgotPasswordState.DONE)) {\n+                        onSuccess.call();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f0d9bb7ee00f8c7783cb59cc61187fbebe4e4525"}, "originalPosition": 106}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDQzOTQ4OQ==", "bodyText": "For both places, maybe:\n@param username A login identifier e.g. `awsuser22`; or, could be an email or phone number, depending on configuration", "url": "https://github.com/aws-amplify/amplify-android/pull/383#discussion_r410439489", "createdAt": "2020-04-17T19:55:43Z", "author": {"login": "jamesonwilliams"}, "path": "core/src/main/java/com/amplifyframework/auth/AuthCategoryBehavior.java", "diffHunk": "@@ -33,7 +34,7 @@\n      * Creates a new user account with the specified username and password.\n      * Can also pass in user attributes to associate with the user through\n      * the options object.\n-     * @param username This can be a typical username, email, phone number, etc.\n+     * @param username This can be a typical username, email, phone number, etc. depending on the configuration", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f0d9bb7ee00f8c7783cb59cc61187fbebe4e4525"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDQ0MDI2OQ==", "bodyText": "and the confirmation code that came from (where does it come from)?", "url": "https://github.com/aws-amplify/amplify-android/pull/383#discussion_r410440269", "createdAt": "2020-04-17T19:57:32Z", "author": {"login": "jamesonwilliams"}, "path": "core/src/main/java/com/amplifyframework/auth/AuthCategoryBehavior.java", "diffHunk": "@@ -154,4 +155,28 @@ void signInWithFacebook(\n     void fetchAuthSession(\n             @NonNull Consumer<AuthSession> onSuccess,\n             @NonNull Consumer<AuthException> onError);\n+\n+    /**\n+     * Trigger password recovery for the given username.\n+     * @param username This can be a typical username, email, phone number, etc. depending on the configuration\n+     * @param onSuccess Success callback\n+     * @param onError Error callback\n+     */\n+    void forgotPassword(\n+            @NonNull String username,\n+            @NonNull Consumer<AuthCodeDeliveryDetails> onSuccess,\n+            @NonNull Consumer<AuthException> onError);\n+\n+    /**\n+     * Complete password recovery process by inputting user's desired new password and confirmation code.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f0d9bb7ee00f8c7783cb59cc61187fbebe4e4525"}, "originalPosition": 34}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2701, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}