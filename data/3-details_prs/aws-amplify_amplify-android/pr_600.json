{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQwMTk4NjY4", "number": 600, "title": "fix(aws-api): Fix path with leading slash breaking REST", "bodyText": "Issue #, if available:\nDescription of changes:\n\nRe-enable the REST API integration tests that were previously turned off.\nREST URL constructor will now strip leading slashes in provided path to avoid the following OkHttp behavior:\n\n\n\nIf pathSegments starts with a slash, the resulting URL will have empty path segment.\n\n\n\n\n\nBy submitting this pull request, I confirm that my contribution is made under the terms of the Apache 2.0 license.", "createdAt": "2020-06-25T18:52:45Z", "url": "https://github.com/aws-amplify/amplify-android/pull/600", "merged": true, "mergeCommit": {"oid": "bb1431748f54fb2cf7bda2e98354cd46fc444402"}, "closed": true, "closedAt": "2020-06-29T17:38:51Z", "author": {"login": "raphkim"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcupYg-gH2gAyNDQwMTk4NjY4Ojg2NWFjNzIyYTM1OTE3NzAxN2YwYmIzMTM4Yzg5MzMyMTMyOWY3Njc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcu4SmgAFqTQzNzk0NTY1Nw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "865ac722a359177017f0bb3138c893321329f767", "author": {"user": {"login": "raphkim", "name": "Raphael Kim"}}, "url": "https://github.com/aws-amplify/amplify-android/commit/865ac722a359177017f0bb3138c893321329f767", "committedDate": "2020-06-25T07:19:29Z", "message": "Re-enable REST API tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "60d00ec02b871e3a9d212b4c3bfdad9570d0c350", "author": {"user": {"login": "raphkim", "name": "Raphael Kim"}}, "url": "https://github.com/aws-amplify/amplify-android/commit/60d00ec02b871e3a9d212b4c3bfdad9570d0c350", "committedDate": "2020-06-25T18:02:45Z", "message": "Strip leading slashes in path"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "59537bcc8ecd0b4c776dee916f6ee5bdaf8b94a1", "author": {"user": {"login": "raphkim", "name": "Raphael Kim"}}, "url": "https://github.com/aws-amplify/amplify-android/commit/59537bcc8ecd0b4c776dee916f6ee5bdaf8b94a1", "committedDate": "2020-06-25T18:40:51Z", "message": "Adjust test for new slash behavior"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a7b430867aaa0541b9eea75cfeb9391edc41d6c1", "author": {"user": {"login": "raphkim", "name": "Raphael Kim"}}, "url": "https://github.com/aws-amplify/amplify-android/commit/a7b430867aaa0541b9eea75cfeb9391edc41d6c1", "committedDate": "2020-06-25T18:57:36Z", "message": "Checkstyle + whitespace"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM3OTQ1NjU3", "url": "https://github.com/aws-amplify/amplify-android/pull/600#pullrequestreview-437945657", "createdAt": "2020-06-26T00:35:57Z", "commit": {"oid": "a7b430867aaa0541b9eea75cfeb9391edc41d6c1"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQwMDozNTo1OFrOGpQLOw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQwMDo0MDo0MVrOGpQPpg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTkwOTgxOQ==", "bodyText": "Suggestion for readability (eschew regular expression):\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    return path.replaceAll(\"^[\\\\\\\\/]+\", \"\");\n          \n          \n            \n                    if (path.startsWith(\"/\") || path.startsWith(\"\\\\\")) {\n          \n          \n            \n                        return path.substring(1);\n          \n          \n            \n                    }\n          \n          \n            \n                    \n          \n          \n            \n                    return path;", "url": "https://github.com/aws-amplify/amplify-android/pull/600#discussion_r445909819", "createdAt": "2020-06-26T00:35:58Z", "author": {"login": "jpignata"}, "path": "aws-api/src/main/java/com/amplifyframework/api/aws/utils/RestRequestFactory.java", "diffHunk": "@@ -125,12 +129,20 @@ public static Request createRequest(\n     private static void populateBody(\n             Request.Builder builder,\n             byte[] data,\n-            BodyCreationStrategy strategy) {\n+            BodyCreationStrategy strategy\n+    ) {\n         if (data != null) {\n             strategy.buildRequest(builder, data);\n         }\n     }\n \n+    // Segment separator can be either '/' or '\\'.\n+    // HttpUrl.Builder assumes an empty URL if path segments\n+    // begin with either character. Strip them before appending.\n+    private static String stripLeadingSlashes(final String path) {\n+        return path.replaceAll(\"^[\\\\\\\\/]+\", \"\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a7b430867aaa0541b9eea75cfeb9391edc41d6c1"}, "originalPosition": 39}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTkxMDk1MA==", "bodyText": "Why is this invalid? No scheme?", "url": "https://github.com/aws-amplify/amplify-android/pull/600#discussion_r445910950", "createdAt": "2020-06-26T00:40:41Z", "author": {"login": "jpignata"}, "path": "aws-api/src/test/java/com/amplifyframework/api/aws/utils/RestRequestFactoryTest.java", "diffHunk": "@@ -83,9 +97,9 @@ public void createValidURLWithQuery() throws MalformedURLException {\n      * @throws MalformedURLException Should throw since the URL is invalid.\n      */\n     @Test(expected = MalformedURLException.class)\n-    public void createInValidURL() throws MalformedURLException {\n+    public void createInvalidURL() throws MalformedURLException {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a7b430867aaa0541b9eea75cfeb9391edc41d6c1"}, "originalPosition": 52}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1832, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}