{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDIzNTI1ODgz", "number": 534, "title": "Show build outputs and unit test results in CircleCI Web UI", "bodyText": "Now, there is content in the CircleCI run's \"Tests\"  tab:\n\nNow, there is content in the CircleCI \"Artifacts\" Tab:\n\n\nCurrently we are not able to see the outputs of unit tests that run in CircleCI.\nTo enable this, we need to package test results into a fake directory structure that CircleCI expects.\n\nBy submitting this pull request, I confirm that my contribution is made under the terms of the Apache 2.0 license.", "createdAt": "2020-05-27T00:01:08Z", "url": "https://github.com/aws-amplify/amplify-android/pull/534", "merged": true, "mergeCommit": {"oid": "6bdfa04a777f8831d91a454f19696c72b9a78dcc"}, "closed": true, "closedAt": "2020-05-28T22:13:31Z", "author": {"login": "jamesonwilliams"}, "timelineItems": {"totalCount": 14, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABclNy6DgBqjMzNzU4NTM4NDY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcl0WFeAH2gAyNDIzNTI1ODgzOjQ1OTQ4N2MzZTkxNGJlNDNmMjRkYmYwMGUxZDk2M2QxZDZlZjBjZTM=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "PullRequestCommit", "commit": {"oid": "4b7a15137e20d336c52d04fc4da509d7f9427c0c", "author": {"user": {"login": "jamesonwilliams", "name": "Jameson Williams"}}, "url": "https://github.com/aws-amplify/amplify-android/commit/4b7a15137e20d336c52d04fc4da509d7f9427c0c", "committedDate": "2020-05-27T01:46:36Z", "message": "Integrate Build and Unit Test Outputs to CircleCI Console\n\n1. Aggregate jUnit test results into a `test-results` directory. Inform\n   CircleCI of this directory, so that it can report the results of a\n   unit test run.\n\n2. Bundle all build artifacts into a tarball, so that they can be\n   inspected."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": {"oid": "4b7a15137e20d336c52d04fc4da509d7f9427c0c", "author": {"user": {"login": "jamesonwilliams", "name": "Jameson Williams"}}, "url": "https://github.com/aws-amplify/amplify-android/commit/4b7a15137e20d336c52d04fc4da509d7f9427c0c", "committedDate": "2020-05-27T01:46:36Z", "message": "Integrate Build and Unit Test Outputs to CircleCI Console\n\n1. Aggregate jUnit test results into a `test-results` directory. Inform\n   CircleCI of this directory, so that it can report the results of a\n   unit test run.\n\n2. Bundle all build artifacts into a tarball, so that they can be\n   inspected."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIwMTk5Nzk4", "url": "https://github.com/aws-amplify/amplify-android/pull/534#pullrequestreview-420199798", "createdAt": "2020-05-28T14:57:43Z", "commit": {"oid": "4b7a15137e20d336c52d04fc4da509d7f9427c0c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIwNDc5ODI5", "url": "https://github.com/aws-amplify/amplify-android/pull/534#pullrequestreview-420479829", "createdAt": "2020-05-28T20:47:59Z", "commit": {"oid": "4b7a15137e20d336c52d04fc4da509d7f9427c0c"}, "state": "APPROVED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOFQyMDo0Nzo1OVrOGcGKNQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOFQyMDo1MzoxM1rOGcGUcA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjExNDIyOQ==", "bodyText": "mkdir -p would be slightly more robust in that it a) will make the full tree if the spec happens to need it, and b) won't fail if the directory suddenly starts to exist between the test and the mkdir command.", "url": "https://github.com/aws-amplify/amplify-android/pull/534#discussion_r432114229", "createdAt": "2020-05-28T20:47:59Z", "author": {"login": "palpatim"}, "path": ".circleci/aggregate-build-artifacts.sh", "diffHunk": "@@ -0,0 +1,31 @@\n+#!/bin/bash\n+\n+set -e \n+\n+modules_with_build_trees() {\n+   for item in *; do\n+       if [ -d \"$item/build\" ]; then\n+           echo \"$item\"\n+       fi\n+   done\n+}\n+readonly modules=($(modules_with_build_trees))\n+readonly current_dir=\"$(pwd)\"\n+readonly aggregation_dir=\"build-artifacts\"\n+\n+if [ ! -d \"$aggregation_dir\" ]; then\n+    mkdir \"$aggregation_dir\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4b7a15137e20d336c52d04fc4da509d7f9427c0c"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjExNjY1NQ==", "bodyText": "As above, maybe mkdir -p?", "url": "https://github.com/aws-amplify/amplify-android/pull/534#discussion_r432116655", "createdAt": "2020-05-28T20:52:55Z", "author": {"login": "palpatim"}, "path": ".circleci/aggregate-test-results.sh", "diffHunk": "@@ -0,0 +1,32 @@\n+#!/bin/bash\n+\n+set -e\n+\n+readonly circle_ci_storage_dir='test-results'\n+readonly cur_dir=$(pwd)\n+readonly junit_xmls_path='build/test-results/testDebugUnitTest'\n+\n+[ -z \"$1\" ] && echo \"Usage: $0 <workdir_path>\" >&2 && exit 1\n+\n+module_test_results() {\n+    for item in *; do\n+        if [ -d \"$item/$junit_xmls_path\" ]; then\n+            echo $item\n+        fi\n+    done\n+}\n+readonly test_results_dirs=($(module_test_results))\n+\n+if [ ! -d $circle_ci_storage_dir ]; then\n+    mkdir $circle_ci_storage_dir", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4b7a15137e20d336c52d04fc4da509d7f9427c0c"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjExNjg0OA==", "bodyText": "I assume the aggregate-build-artifacts takes the place of publishing to local maven?", "url": "https://github.com/aws-amplify/amplify-android/pull/534#discussion_r432116848", "createdAt": "2020-05-28T20:53:13Z", "author": {"login": "palpatim"}, "path": ".circleci/config.yml", "diffHunk": "@@ -90,12 +90,14 @@ jobs:\n       - generate_gradle_wrapper\n       - run:\n           name: Build the project\n-          command: bash gradlew build\n-      - run:\n-          name: Publish the project to local maven\n-          command: bash gradlew publishToMavenLocal", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4b7a15137e20d336c52d04fc4da509d7f9427c0c"}, "originalPosition": 7}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5c5e5589e1038a020bfcd6af0a5f2fb566da31f6", "author": {"user": {"login": "jamesonwilliams", "name": "Jameson Williams"}}, "url": "https://github.com/aws-amplify/amplify-android/commit/5c5e5589e1038a020bfcd6af0a5f2fb566da31f6", "committedDate": "2020-05-28T20:58:20Z", "message": "Merge remote-tracking branch 'origin/master' into aggregate_test_results"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "459487c3e914be43f24dbf00e1d963d1d6ef0ce3", "author": {"user": {"login": "jamesonwilliams", "name": "Jameson Williams"}}, "url": "https://github.com/aws-amplify/amplify-android/commit/459487c3e914be43f24dbf00e1d963d1d6ef0ce3", "committedDate": "2020-05-28T21:00:28Z", "message": "Use mkdir -p instead of checking if the directories are created first"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2574, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}