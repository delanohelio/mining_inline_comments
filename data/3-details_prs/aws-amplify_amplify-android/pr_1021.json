{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTMxMjczMzcw", "number": 1021, "title": "fix(aws-datastore): null modelName in OutboxMutationProcessed", "bodyText": "When the MutationProcessor successfully processes an item from the\nMutation Outbox, it will publish an OutboxMutationProcessed event to the\nHub.\nThe AppSync response itself contains no information about what type of\nmodel has just been published. That information is only available before\nmaking the request.\nAs a consequence, we cannot inspect the model name from the AppSync\nresponse, and instead, we should pull it out of the MutationProcessor's\nrequest context.\nTo validate this fix, the various instrumentation tests are updated to\nuse the getModelName() code path on the OutboxMutationProcessed event.\nResolves: #1012\nBy submitting this pull request, I confirm that my contribution is made under the terms of the Apache 2.0 license.", "createdAt": "2020-12-02T20:32:15Z", "url": "https://github.com/aws-amplify/amplify-android/pull/1021", "merged": true, "mergeCommit": {"oid": "5732b167bee4c7abb3f5c814de6a4732412895c5"}, "closed": true, "closedAt": "2020-12-02T21:10:37Z", "author": {"login": "jamesonwilliams"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdiUnJLgH2gAyNTMxMjczMzcwOjg5OWQ2ZGUyMzJkYmFmZGJmNjViYjhiM2M0YjUxYTJkYjY4ZmRhOTE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdiVEYRgFqTU0MzIzNDcyNA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "899d6de232dbafdbf65bb8b3c4b51a2db68fda91", "author": {"user": {"login": "jamesonwilliams", "name": "Jameson Williams"}}, "url": "https://github.com/aws-amplify/amplify-android/commit/899d6de232dbafdbf65bb8b3c4b51a2db68fda91", "committedDate": "2020-12-02T20:31:31Z", "message": "fix(aws-datastore): null modelName in OutboxMutationProcessed\n\nWhen the MutationProcessor successfully processes an item from the\nMutation Outbox, it will publish an OutboxMutationProcessed event to the\nHub.\n\nThe AppSync response itself contains no infromation about *what type* of\nmodel has just been published. That information is only available before\nmaking the request.\n\nAs a consequence, we cannot inspect the modelName from the AppSync\nresponse, and instead, we should pull it out of the MutationProcessor's\nrequest context.\n\nTo validate this fix, the various instrumentation tests are updated to\nuse the getModelName() code path on the OutboxMutationProcessed event.\n\nResolves: https://github.com/aws-amplify/amplify-android/issues/1012"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQzMjE0NjEy", "url": "https://github.com/aws-amplify/amplify-android/pull/1021#pullrequestreview-543214612", "createdAt": "2020-12-02T20:33:58Z", "commit": {"oid": "899d6de232dbafdbf65bb8b3c4b51a2db68fda91"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wMlQyMDozMzo1OFrOH9tDLA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wMlQyMDozMzo1OFrOH9tDLA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDQ2MzI3Ng==", "bodyText": "This line is the actual fix. Everything else is just wiring or test changes.", "url": "https://github.com/aws-amplify/amplify-android/pull/1021#discussion_r534463276", "createdAt": "2020-12-02T20:33:58Z", "author": {"login": "jamesonwilliams"}, "path": "aws-datastore/src/main/java/com/amplifyframework/datastore/syncengine/MutationProcessor.java", "diffHunk": "@@ -141,7 +141,10 @@ private Completable drainMutationOutbox() {\n                     // if there are outstanding mutations in the outbox.\n                     mutationOutbox.remove(mutationOutboxItem.getMutationId())\n                         .andThen(merger.merge(modelWithMetadata))\n-                        .doOnComplete(() -> announceMutationProcessed(modelWithMetadata))\n+                        .doOnComplete(() -> {\n+                            String modelName = mutationOutboxItem.getModelSchema().getName();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "899d6de232dbafdbf65bb8b3c4b51a2db68fda91"}, "originalPosition": 6}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQzMjI1MjYy", "url": "https://github.com/aws-amplify/amplify-android/pull/1021#pullrequestreview-543225262", "createdAt": "2020-12-02T20:49:43Z", "commit": {"oid": "899d6de232dbafdbf65bb8b3c4b51a2db68fda91"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQzMjM0NzI0", "url": "https://github.com/aws-amplify/amplify-android/pull/1021#pullrequestreview-543234724", "createdAt": "2020-12-02T21:03:27Z", "commit": {"oid": "899d6de232dbafdbf65bb8b3c4b51a2db68fda91"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3338, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}