{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA1MzExMzcw", "number": 383, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xN1QxOTo1Mzo0OFrODzBteQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xN1QxOTo1NzozMlrODzBxRA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU0ODMxOTkzOnYy", "diffSide": "RIGHT", "path": "aws-auth-cognito/src/main/java/com/amplifyframework/auth/cognito/AWSCognitoAuthPlugin.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xN1QxOTo1Mzo0OFrOGHbL_A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xN1QyMTozNzo0MFrOGHd1Qw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDQzODY1Mg==", "bodyText": "How come you don't pass back convertCodeDeliveryDetails(result.getParameters()) here too? Doesn't contain any valuable info?", "url": "https://github.com/aws-amplify/amplify-android/pull/383#discussion_r410438652", "createdAt": "2020-04-17T19:53:48Z", "author": {"login": "jamesonwilliams"}, "path": "aws-auth-cognito/src/main/java/com/amplifyframework/auth/cognito/AWSCognitoAuthPlugin.java", "diffHunk": "@@ -367,22 +370,88 @@ public void onResult(UserStateDetails result) {\n \n                 @Override\n                 public void onError(Exception exception) {\n-                    onError.accept(new AuthException(\n+                    onException.accept(new AuthException(\n                             \"An error occurred while attempting to retrieve your user details\",\n                             exception,\n                             \"See attached exception for more details\"\n                     ));\n                 }\n             });\n         } catch (Throwable exception) {\n-            onError.accept(new AuthException(\n+            onException.accept(new AuthException(\n                     \"An error occurred fetching authorization details for the current user\",\n                     exception,\n                     \"See attached exception for more details\"\n             ));\n         }\n     }\n \n+    @Override\n+    public void forgotPassword(\n+            @NonNull String username,\n+            @NonNull Consumer<AuthCodeDeliveryDetails> onSuccess,\n+            @NonNull Consumer<AuthException> onException\n+    ) {\n+        AWSMobileClient.getInstance().forgotPassword(username, new Callback<ForgotPasswordResult>() {\n+            @Override\n+            public void onResult(ForgotPasswordResult result) {\n+                if (result.getState().equals(ForgotPasswordState.CONFIRMATION_CODE)) {\n+                    onSuccess.accept(convertCodeDeliveryDetails(result.getParameters()));\n+                } else {\n+                    onException.accept(new AuthException(\n+                            \"Received an unsupported response after triggering password recovery: \" + result.getState(),\n+                            \"This is almost certainly a bug. Please report it as an issue in our GitHub repo.\"\n+                    ));\n+                }\n+            }\n+\n+            @Override\n+            public void onError(Exception exception) {\n+                onException.accept(new AuthException(\n+                        \"An error occurred triggering password recovery\",\n+                        exception,\n+                        \"See attached exception for more details\"\n+                ));\n+            }\n+        });\n+    }\n+\n+    @Override\n+    public void confirmForgotPassword(\n+            @NonNull String newPassword,\n+            @NonNull String confirmationCode,\n+            @NonNull Action onSuccess,\n+            @NonNull Consumer<AuthException> onException\n+    ) {\n+        AWSMobileClient.getInstance().confirmForgotPassword(\n+            newPassword,\n+            confirmationCode,\n+            new Callback<ForgotPasswordResult>() {\n+                @Override\n+                public void onResult(ForgotPasswordResult result) {\n+                    if (result.getState().equals(ForgotPasswordState.DONE)) {\n+                        onSuccess.call();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f0d9bb7ee00f8c7783cb59cc61187fbebe4e4525"}, "originalPosition": 106}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDQ0NDA4MQ==", "bodyText": "Yeah no it's a messed up implementation in AWSMobileClient where there's only one legitimate value which is Done and everything else is empty or an error. :P", "url": "https://github.com/aws-amplify/amplify-android/pull/383#discussion_r410444081", "createdAt": "2020-04-17T20:06:13Z", "author": {"login": "TrekSoft"}, "path": "aws-auth-cognito/src/main/java/com/amplifyframework/auth/cognito/AWSCognitoAuthPlugin.java", "diffHunk": "@@ -367,22 +370,88 @@ public void onResult(UserStateDetails result) {\n \n                 @Override\n                 public void onError(Exception exception) {\n-                    onError.accept(new AuthException(\n+                    onException.accept(new AuthException(\n                             \"An error occurred while attempting to retrieve your user details\",\n                             exception,\n                             \"See attached exception for more details\"\n                     ));\n                 }\n             });\n         } catch (Throwable exception) {\n-            onError.accept(new AuthException(\n+            onException.accept(new AuthException(\n                     \"An error occurred fetching authorization details for the current user\",\n                     exception,\n                     \"See attached exception for more details\"\n             ));\n         }\n     }\n \n+    @Override\n+    public void forgotPassword(\n+            @NonNull String username,\n+            @NonNull Consumer<AuthCodeDeliveryDetails> onSuccess,\n+            @NonNull Consumer<AuthException> onException\n+    ) {\n+        AWSMobileClient.getInstance().forgotPassword(username, new Callback<ForgotPasswordResult>() {\n+            @Override\n+            public void onResult(ForgotPasswordResult result) {\n+                if (result.getState().equals(ForgotPasswordState.CONFIRMATION_CODE)) {\n+                    onSuccess.accept(convertCodeDeliveryDetails(result.getParameters()));\n+                } else {\n+                    onException.accept(new AuthException(\n+                            \"Received an unsupported response after triggering password recovery: \" + result.getState(),\n+                            \"This is almost certainly a bug. Please report it as an issue in our GitHub repo.\"\n+                    ));\n+                }\n+            }\n+\n+            @Override\n+            public void onError(Exception exception) {\n+                onException.accept(new AuthException(\n+                        \"An error occurred triggering password recovery\",\n+                        exception,\n+                        \"See attached exception for more details\"\n+                ));\n+            }\n+        });\n+    }\n+\n+    @Override\n+    public void confirmForgotPassword(\n+            @NonNull String newPassword,\n+            @NonNull String confirmationCode,\n+            @NonNull Action onSuccess,\n+            @NonNull Consumer<AuthException> onException\n+    ) {\n+        AWSMobileClient.getInstance().confirmForgotPassword(\n+            newPassword,\n+            confirmationCode,\n+            new Callback<ForgotPasswordResult>() {\n+                @Override\n+                public void onResult(ForgotPasswordResult result) {\n+                    if (result.getState().equals(ForgotPasswordState.DONE)) {\n+                        onSuccess.call();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDQzODY1Mg=="}, "originalCommit": {"oid": "f0d9bb7ee00f8c7783cb59cc61187fbebe4e4525"}, "originalPosition": 106}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDQ4MTk4Nw==", "bodyText": "Haha oh alright!", "url": "https://github.com/aws-amplify/amplify-android/pull/383#discussion_r410481987", "createdAt": "2020-04-17T21:37:40Z", "author": {"login": "jamesonwilliams"}, "path": "aws-auth-cognito/src/main/java/com/amplifyframework/auth/cognito/AWSCognitoAuthPlugin.java", "diffHunk": "@@ -367,22 +370,88 @@ public void onResult(UserStateDetails result) {\n \n                 @Override\n                 public void onError(Exception exception) {\n-                    onError.accept(new AuthException(\n+                    onException.accept(new AuthException(\n                             \"An error occurred while attempting to retrieve your user details\",\n                             exception,\n                             \"See attached exception for more details\"\n                     ));\n                 }\n             });\n         } catch (Throwable exception) {\n-            onError.accept(new AuthException(\n+            onException.accept(new AuthException(\n                     \"An error occurred fetching authorization details for the current user\",\n                     exception,\n                     \"See attached exception for more details\"\n             ));\n         }\n     }\n \n+    @Override\n+    public void forgotPassword(\n+            @NonNull String username,\n+            @NonNull Consumer<AuthCodeDeliveryDetails> onSuccess,\n+            @NonNull Consumer<AuthException> onException\n+    ) {\n+        AWSMobileClient.getInstance().forgotPassword(username, new Callback<ForgotPasswordResult>() {\n+            @Override\n+            public void onResult(ForgotPasswordResult result) {\n+                if (result.getState().equals(ForgotPasswordState.CONFIRMATION_CODE)) {\n+                    onSuccess.accept(convertCodeDeliveryDetails(result.getParameters()));\n+                } else {\n+                    onException.accept(new AuthException(\n+                            \"Received an unsupported response after triggering password recovery: \" + result.getState(),\n+                            \"This is almost certainly a bug. Please report it as an issue in our GitHub repo.\"\n+                    ));\n+                }\n+            }\n+\n+            @Override\n+            public void onError(Exception exception) {\n+                onException.accept(new AuthException(\n+                        \"An error occurred triggering password recovery\",\n+                        exception,\n+                        \"See attached exception for more details\"\n+                ));\n+            }\n+        });\n+    }\n+\n+    @Override\n+    public void confirmForgotPassword(\n+            @NonNull String newPassword,\n+            @NonNull String confirmationCode,\n+            @NonNull Action onSuccess,\n+            @NonNull Consumer<AuthException> onException\n+    ) {\n+        AWSMobileClient.getInstance().confirmForgotPassword(\n+            newPassword,\n+            confirmationCode,\n+            new Callback<ForgotPasswordResult>() {\n+                @Override\n+                public void onResult(ForgotPasswordResult result) {\n+                    if (result.getState().equals(ForgotPasswordState.DONE)) {\n+                        onSuccess.call();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDQzODY1Mg=="}, "originalCommit": {"oid": "f0d9bb7ee00f8c7783cb59cc61187fbebe4e4525"}, "originalPosition": 106}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU0ODMyNTE2OnYy", "diffSide": "RIGHT", "path": "core/src/main/java/com/amplifyframework/auth/AuthCategoryBehavior.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xN1QxOTo1NTo0M1rOGHbPQQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xN1QyMDoyMDoxM1rOGHb5lg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDQzOTQ4OQ==", "bodyText": "For both places, maybe:\n@param username A login identifier e.g. `awsuser22`; or, could be an email or phone number, depending on configuration", "url": "https://github.com/aws-amplify/amplify-android/pull/383#discussion_r410439489", "createdAt": "2020-04-17T19:55:43Z", "author": {"login": "jamesonwilliams"}, "path": "core/src/main/java/com/amplifyframework/auth/AuthCategoryBehavior.java", "diffHunk": "@@ -33,7 +34,7 @@\n      * Creates a new user account with the specified username and password.\n      * Can also pass in user attributes to associate with the user through\n      * the options object.\n-     * @param username This can be a typical username, email, phone number, etc.\n+     * @param username This can be a typical username, email, phone number, etc. depending on the configuration", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f0d9bb7ee00f8c7783cb59cc61187fbebe4e4525"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDQ1MDMyNg==", "bodyText": "Sure, will add this in the next round", "url": "https://github.com/aws-amplify/amplify-android/pull/383#discussion_r410450326", "createdAt": "2020-04-17T20:20:13Z", "author": {"login": "TrekSoft"}, "path": "core/src/main/java/com/amplifyframework/auth/AuthCategoryBehavior.java", "diffHunk": "@@ -33,7 +34,7 @@\n      * Creates a new user account with the specified username and password.\n      * Can also pass in user attributes to associate with the user through\n      * the options object.\n-     * @param username This can be a typical username, email, phone number, etc.\n+     * @param username This can be a typical username, email, phone number, etc. depending on the configuration", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDQzOTQ4OQ=="}, "originalCommit": {"oid": "f0d9bb7ee00f8c7783cb59cc61187fbebe4e4525"}, "originalPosition": 13}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU0ODMyOTY0OnYy", "diffSide": "RIGHT", "path": "core/src/main/java/com/amplifyframework/auth/AuthCategoryBehavior.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xN1QxOTo1NzozMlrOGHbSTQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xN1QyMDoyMDoyNVrOGHb6Hg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDQ0MDI2OQ==", "bodyText": "and the confirmation code that came from (where does it come from)?", "url": "https://github.com/aws-amplify/amplify-android/pull/383#discussion_r410440269", "createdAt": "2020-04-17T19:57:32Z", "author": {"login": "jamesonwilliams"}, "path": "core/src/main/java/com/amplifyframework/auth/AuthCategoryBehavior.java", "diffHunk": "@@ -154,4 +155,28 @@ void signInWithFacebook(\n     void fetchAuthSession(\n             @NonNull Consumer<AuthSession> onSuccess,\n             @NonNull Consumer<AuthException> onError);\n+\n+    /**\n+     * Trigger password recovery for the given username.\n+     * @param username This can be a typical username, email, phone number, etc. depending on the configuration\n+     * @param onSuccess Success callback\n+     * @param onError Error callback\n+     */\n+    void forgotPassword(\n+            @NonNull String username,\n+            @NonNull Consumer<AuthCodeDeliveryDetails> onSuccess,\n+            @NonNull Consumer<AuthException> onError);\n+\n+    /**\n+     * Complete password recovery process by inputting user's desired new password and confirmation code.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f0d9bb7ee00f8c7783cb59cc61187fbebe4e4525"}, "originalPosition": 34}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDQ1MDQ2Mg==", "bodyText": "It depends how it's configured so I think I'll leave it as is.", "url": "https://github.com/aws-amplify/amplify-android/pull/383#discussion_r410450462", "createdAt": "2020-04-17T20:20:25Z", "author": {"login": "TrekSoft"}, "path": "core/src/main/java/com/amplifyframework/auth/AuthCategoryBehavior.java", "diffHunk": "@@ -154,4 +155,28 @@ void signInWithFacebook(\n     void fetchAuthSession(\n             @NonNull Consumer<AuthSession> onSuccess,\n             @NonNull Consumer<AuthException> onError);\n+\n+    /**\n+     * Trigger password recovery for the given username.\n+     * @param username This can be a typical username, email, phone number, etc. depending on the configuration\n+     * @param onSuccess Success callback\n+     * @param onError Error callback\n+     */\n+    void forgotPassword(\n+            @NonNull String username,\n+            @NonNull Consumer<AuthCodeDeliveryDetails> onSuccess,\n+            @NonNull Consumer<AuthException> onError);\n+\n+    /**\n+     * Complete password recovery process by inputting user's desired new password and confirmation code.", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDQ0MDI2OQ=="}, "originalCommit": {"oid": "f0d9bb7ee00f8c7783cb59cc61187fbebe4e4525"}, "originalPosition": 34}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1428, "cost": 1, "resetAt": "2021-11-12T09:44:50Z"}}}