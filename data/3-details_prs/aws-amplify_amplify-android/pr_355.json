{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDAwMDM0Njg4", "number": 355, "title": "[aws-storage-s3] Test against StorageCategory not Amplify", "bodyText": "Amplify is a process-wide singleton, that can be configured only once.\nIt maintains state until the process dies. This is true of its reference\nto the Amplify.Storage category (and its plugins) as well.\nThis is a brittle way to test the functionality of storage. Better is to\ncreate fresh instances of the StorageCategory, and run assertions\nagainst them.\nBy submitting this pull request, I confirm that my contribution is made under the terms of the Apache 2.0 license.", "createdAt": "2020-04-07T04:46:04Z", "url": "https://github.com/aws-amplify/amplify-android/pull/355", "merged": true, "mergeCommit": {"oid": "5fa10873a4277c19787fa31d961ff5535ad7bd67"}, "closed": true, "closedAt": "2020-04-07T17:22:50Z", "author": {"login": "jamesonwilliams"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcVL50WABqjMyMDgxNzE1MTI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcVWOkbgFqTM4OTMwODIzNA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "PullRequestCommit", "commit": {"oid": "deec96fe64c90e0ae8fb5d372be7d8e17ad623b3", "author": {"user": {"login": "jamesonwilliams", "name": "Jameson Williams"}}, "url": "https://github.com/aws-amplify/amplify-android/commit/deec96fe64c90e0ae8fb5d372be7d8e17ad623b3", "committedDate": "2020-04-07T04:53:26Z", "message": "[aws-storage-s3] Test against StorageCategory not Amplify\n\nAmplify is a process-wide singleton, that can be configured only once.\nIt maintains state until the process dies. This is true of its reference\nto the Amplify.Storage category (and its pluings) as well.\n\nThis is a brittle way to test the functionality of storage. Better is to\ncreate fresh instances of the StorageCategory, and run assertions\nagainst them."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": {"oid": "deec96fe64c90e0ae8fb5d372be7d8e17ad623b3", "author": {"user": {"login": "jamesonwilliams", "name": "Jameson Williams"}}, "url": "https://github.com/aws-amplify/amplify-android/commit/deec96fe64c90e0ae8fb5d372be7d8e17ad623b3", "committedDate": "2020-04-07T04:53:26Z", "message": "[aws-storage-s3] Test against StorageCategory not Amplify\n\nAmplify is a process-wide singleton, that can be configured only once.\nIt maintains state until the process dies. This is true of its reference\nto the Amplify.Storage category (and its pluings) as well.\n\nThis is a brittle way to test the functionality of storage. Better is to\ncreate fresh instances of the StorageCategory, and run assertions\nagainst them."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg4ODk0Mzcy", "url": "https://github.com/aws-amplify/amplify-android/pull/355#pullrequestreview-388894372", "createdAt": "2020-04-07T08:26:44Z", "commit": {"oid": "deec96fe64c90e0ae8fb5d372be7d8e17ad623b3"}, "state": "DISMISSED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wN1QwODoyNjo0NFrOGB4lKQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wN1QwODozMjozMVrOGB4zYQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDYyODc3Nw==", "bodyText": "nit: Not sure if it's a convention that is documented somewhere, but I think context is always the first argument if it is required. It already bothers me that our configure methods break this pattern haha.", "url": "https://github.com/aws-amplify/amplify-android/pull/355#discussion_r404628777", "createdAt": "2020-04-07T08:26:44Z", "author": {"login": "raphkim"}, "path": "aws-storage-s3/src/androidTest/java/com/amplifyframework/storage/s3/TestStorageCategory.java", "diffHunk": "@@ -0,0 +1,56 @@\n+/*\n+ * Copyright 2020 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *  http://aws.amazon.com/apache2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ * permissions and limitations under the License.\n+ */\n+\n+package com.amplifyframework.storage.s3;\n+\n+import android.content.Context;\n+import androidx.annotation.NonNull;\n+import androidx.annotation.RawRes;\n+\n+import com.amplifyframework.AmplifyException;\n+import com.amplifyframework.core.AmplifyConfiguration;\n+import com.amplifyframework.core.category.CategoryConfiguration;\n+import com.amplifyframework.core.category.CategoryType;\n+import com.amplifyframework.storage.StorageCategory;\n+\n+import java.util.Objects;\n+\n+/**\n+ * Factory for creating {@link StorageCategory} instance suitable for test.\n+ */\n+final class TestStorageCategory {\n+    private TestStorageCategory() {}\n+\n+    /**\n+     * Creates an instance of {@link StorageCategory} using the provided configuration resource.\n+     * @param resourceId Android resource ID for a configuration file\n+     * @param context Android Context\n+     * @return A StorageCategory instance using the provided configuration\n+     */\n+    static StorageCategory create(@RawRes int resourceId, @NonNull Context context) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "deec96fe64c90e0ae8fb5d372be7d8e17ad623b3"}, "originalPosition": 42}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDYzMDMzMg==", "bodyText": "Hmm, I guess having smaller default value is fine since SynchronousStorage does allow timeout override for especially long operations (e.g. large file upload)", "url": "https://github.com/aws-amplify/amplify-android/pull/355#discussion_r404630332", "createdAt": "2020-04-07T08:29:06Z", "author": {"login": "raphkim"}, "path": "testutils/src/main/java/com/amplifyframework/testutils/sync/SynchronousStorage.java", "diffHunk": "@@ -38,25 +40,33 @@\n  * code, where we want to make a series of sequential assertions after\n  * performing various operations.\n  */\n-@SuppressWarnings(\"unused\")\n public final class SynchronousStorage {\n-    // 5 seconds seemed to be insufficient to reliably cover both initial auth calls + storage network ops\n-    private static final long STORAGE_OPERATION_TIMEOUT_MS = TimeUnit.SECONDS.toMillis(10);\n+    private static final long STORAGE_OPERATION_TIMEOUT_MS = TimeUnit.SECONDS.toMillis(5);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "deec96fe64c90e0ae8fb5d372be7d8e17ad623b3"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDYzMTY0Mg==", "bodyText": "nit: context as first parameter?", "url": "https://github.com/aws-amplify/amplify-android/pull/355#discussion_r404631642", "createdAt": "2020-04-07T08:31:13Z", "author": {"login": "raphkim"}, "path": "aws-storage-s3/src/androidTest/java/com/amplifyframework/storage/s3/UserCredentials.java", "diffHunk": "@@ -0,0 +1,172 @@\n+/*\n+ * Copyright 2020 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *  http://aws.amazon.com/apache2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ * permissions and limitations under the License.\n+ */\n+\n+package com.amplifyframework.storage.s3;\n+\n+import android.content.Context;\n+import androidx.annotation.NonNull;\n+import androidx.annotation.RawRes;\n+import androidx.core.util.ObjectsCompat;\n+\n+import com.amplifyframework.testutils.Resources;\n+import com.amplifyframework.util.Immutable;\n+\n+import org.json.JSONArray;\n+import org.json.JSONException;\n+import org.json.JSONObject;\n+\n+import java.util.ArrayList;\n+import java.util.HashMap;\n+import java.util.Iterator;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Objects;\n+\n+final class UserCredentials implements Iterable<UserCredentials.Credential> {\n+    private static final String CREDENTIALS_RESOURCE_NAME = \"credentials\";\n+    private final List<Credential> credentials;\n+\n+    private UserCredentials(List<Credential> credentials) {\n+        this.credentials = credentials;\n+    }\n+\n+    static UserCredentials create(@NonNull IdentityIdSource identityIdSource, @NonNull Context context) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "deec96fe64c90e0ae8fb5d372be7d8e17ad623b3"}, "originalPosition": 45}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDYzMjQxNw==", "bodyText": "this is clean, and likely reusable for other categories like API :)\nAs far as I know, we lack tests for testing schemas that contain @auth", "url": "https://github.com/aws-amplify/amplify-android/pull/355#discussion_r404632417", "createdAt": "2020-04-07T08:32:31Z", "author": {"login": "raphkim"}, "path": "aws-storage-s3/src/androidTest/java/com/amplifyframework/storage/s3/UserCredentials.java", "diffHunk": "@@ -0,0 +1,172 @@\n+/*\n+ * Copyright 2020 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *  http://aws.amazon.com/apache2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ * permissions and limitations under the License.\n+ */\n+\n+package com.amplifyframework.storage.s3;\n+\n+import android.content.Context;\n+import androidx.annotation.NonNull;\n+import androidx.annotation.RawRes;\n+import androidx.core.util.ObjectsCompat;\n+\n+import com.amplifyframework.testutils.Resources;\n+import com.amplifyframework.util.Immutable;\n+\n+import org.json.JSONArray;\n+import org.json.JSONException;\n+import org.json.JSONObject;\n+\n+import java.util.ArrayList;\n+import java.util.HashMap;\n+import java.util.Iterator;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Objects;\n+\n+final class UserCredentials implements Iterable<UserCredentials.Credential> {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "deec96fe64c90e0ae8fb5d372be7d8e17ad623b3"}, "originalPosition": 37}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8c34bfc0a87dfaa162f556cd2ec651c8b346bdbd", "author": {"user": {"login": "jamesonwilliams", "name": "Jameson Williams"}}, "url": "https://github.com/aws-amplify/amplify-android/commit/8c34bfc0a87dfaa162f556cd2ec651c8b346bdbd", "committedDate": "2020-04-07T14:25:50Z", "message": "Address Raph's PR feedback"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": {"oid": "8c34bfc0a87dfaa162f556cd2ec651c8b346bdbd", "author": {"user": {"login": "jamesonwilliams", "name": "Jameson Williams"}}, "url": "https://github.com/aws-amplify/amplify-android/commit/8c34bfc0a87dfaa162f556cd2ec651c8b346bdbd", "committedDate": "2020-04-07T14:25:50Z", "message": "Address Raph's PR feedback"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg5MzA4MjM0", "url": "https://github.com/aws-amplify/amplify-android/pull/355#pullrequestreview-389308234", "createdAt": "2020-04-07T16:52:19Z", "commit": {"oid": "8c34bfc0a87dfaa162f556cd2ec651c8b346bdbd"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2661, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}