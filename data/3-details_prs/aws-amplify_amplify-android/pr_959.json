{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTIwODUzMzEw", "number": 959, "title": "feat(datastore) selective sync", "bodyText": "This PR adds the selective sync feature to DataStore, which consists of the following parts:\n\nConfiguration: Clients configure a DataStoreSyncExpression, which can resolve a QueryPredicate.\nSync: Sync requests sent to AppSync include this QueryPredicate, so that data is filtered out server side.\nSubscriptions:  AppSync's subscription operation does not currently support a filter argument, so this PR filters out incoming subscriptions that don't match the predicate on the client side.  In the future, if AppSync adds this, we can switch to server-side filtering, which will help reduce network traffic on the subscription socket.\nRuntime Modification: Clients can force a re-evaluation of their DataStoreSyncExpression at runtime by calling DataStore.stop(), DataStore.start(), if they wish to modify the filter to obtain a different set of data.\n\nDX:\nAmplify.addPlugin(new AWSDataStorePlugin(DataStoreConfiguration.builder()\n    .syncExpression(Blog.class, () -> Blog.NAME.equals(\"foo\"))\n    .syncExpression(Post.class, () -> Post.TITLE.beginsWith(\"bar\"))\n    .syncExpression(Comment.class, () -> Comment.CONTENT.contains(\"baz\"))\n    .build()));\nAmplify.configure(context);\n\nBy submitting this pull request, I confirm that my contribution is made under the terms of the Apache 2.0 license.", "createdAt": "2020-11-13T21:09:50Z", "url": "https://github.com/aws-amplify/amplify-android/pull/959", "merged": true, "mergeCommit": {"oid": "0f8dcdc0032dbb4d8a7953ad4f6381268f1205ca"}, "closed": true, "closedAt": "2020-11-18T20:44:02Z", "author": {"login": "richardmcclellan"}, "timelineItems": {"totalCount": 17, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdcOAdKgFqTUzMDQyMDAwOA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdd0TydgFqTUzMzg1NTM1OQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMwNDIwMDA4", "url": "https://github.com/aws-amplify/amplify-android/pull/959#pullrequestreview-530420008", "createdAt": "2020-11-13T21:15:00Z", "commit": null, "state": "APPROVED", "comments": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xM1QyMToxNTowMFrOHy_yJA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xM1QyMToyNDo0OFrOHzADPQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzIzNTg3Ng==", "bodyText": "Perhaps:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                 * Returns a QueryPredicate that should be used to filter the data that is synced.\n          \n          \n            \n                 * @param modelClass Class of the {@link Model}.\n          \n          \n            \n                 * @return a QueryPredicate that should be used to filter the data that is synced.\n          \n          \n            \n                 * Returns a QueryPredicate that should be used to filter data received from AppSync,\n          \n          \n            \n                 * either during a base sync or over the real-time subscription.\n          \n          \n            \n                 * @param modelClass Class of the {@link Model}.\n          \n          \n            \n                 * @return a QueryPredicate that should be used to filter the data received from AppSync", "url": "https://github.com/aws-amplify/amplify-android/pull/959#discussion_r523235876", "createdAt": "2020-11-13T21:15:00Z", "author": {"login": "jamesonwilliams"}, "path": "aws-datastore/src/main/java/com/amplifyframework/datastore/DataStoreConfiguration.java", "diffHunk": "@@ -175,6 +176,29 @@ public Integer getSyncPageSize() {\n         return this.syncPageSize;\n     }\n \n+    /**\n+     * Returns a QueryPredicate that should be used to filter the data that is synced.\n+     * @param modelClass Class of the {@link Model}.\n+     * @return a QueryPredicate that should be used to filter the data that is synced.", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 56}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzIzNjM2Ng==", "bodyText": "If you have the one above, do you need this Map-returning one, as well?", "url": "https://github.com/aws-amplify/amplify-android/pull/959#discussion_r523236366", "createdAt": "2020-11-13T21:16:05Z", "author": {"login": "jamesonwilliams"}, "path": "aws-datastore/src/main/java/com/amplifyframework/datastore/DataStoreConfiguration.java", "diffHunk": "@@ -175,6 +176,29 @@ public Integer getSyncPageSize() {\n         return this.syncPageSize;\n     }\n \n+    /**\n+     * Returns a QueryPredicate that should be used to filter the data that is synced.\n+     * @param modelClass Class of the {@link Model}.\n+     * @return a QueryPredicate that should be used to filter the data that is synced.\n+     */\n+    @NonNull\n+    public QueryPredicate getSyncQueryPredicate(Class<? extends Model> modelClass) {\n+        DataStoreSyncExpression expression = syncExpressions.get(modelClass);\n+        if (expression != null) {\n+            return expression.resolvePredicate();\n+        }\n+        return QueryPredicates.all();\n+    }\n+\n+    /**\n+     * Returns the Map of all {@link DataStoreSyncExpression}s used for filtering the data that is synced.\n+     * @return the Map of all {@link DataStoreSyncExpression}s used for filtering the data that is synced.\n+     */\n+    @NonNull\n+    public Map<Class<? extends Model>, DataStoreSyncExpression> getSyncExpressions() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 72}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzIzNzA1NQ==", "bodyText": "From the PR description:\n\nRuntime Modification: Clients can force a re-evaluation of their DataStoreSyncExpression at runtime by calling DataStore.stop(), DataStore.start(), if they wish to modify the filter to obtain a different set of data.\n\nHowever, if I need to provide the sync expressions before calling Amplify.configure(...), how could I change the expressions later? (Perhaps the sync expression itself has to be dynamic?)", "url": "https://github.com/aws-amplify/amplify-android/pull/959#discussion_r523237055", "createdAt": "2020-11-13T21:17:39Z", "author": {"login": "jamesonwilliams"}, "path": "aws-datastore/src/main/java/com/amplifyframework/datastore/DataStoreConfiguration.java", "diffHunk": "@@ -305,6 +339,23 @@ public Builder syncPageSize(@IntRange(from = 0) Integer syncPageSize) {\n             return Builder.this;\n         }\n \n+        /**\n+         * Sets a sync expression for a particular model to filter which data is synced locally.  The expression\n+         * is evaluated each time DataStore is started.  The QueryPredicate is applied on both sync and subscriptions.", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 132}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzIzNzM3MQ==", "bodyText": "Arguably, it could live under .syncengine? It's sort of both a sync-thing, and a top-level-user-provided-thing.", "url": "https://github.com/aws-amplify/amplify-android/pull/959#discussion_r523237371", "createdAt": "2020-11-13T21:18:30Z", "author": {"login": "jamesonwilliams"}, "path": "aws-datastore/src/main/java/com/amplifyframework/datastore/DataStoreSyncExpression.java", "diffHunk": "@@ -0,0 +1,36 @@\n+/*\n+ * Copyright 2020 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *  http://aws.amazon.com/apache2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ * permissions and limitations under the License.\n+ */\n+\n+package com.amplifyframework.datastore;", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzIzODMxNA==", "bodyText": "If you're able to get it from the ModelSchemaRegistry, instead, that would prevent another reflection over the model class. Alternately, modelClass.getSimpleName() probably does the trick, too.", "url": "https://github.com/aws-amplify/amplify-android/pull/959#discussion_r523238314", "createdAt": "2020-11-13T21:20:30Z", "author": {"login": "jamesonwilliams"}, "path": "aws-datastore/src/main/java/com/amplifyframework/datastore/appsync/AppSyncRequestFactory.java", "diffHunk": "@@ -97,7 +98,11 @@ private AppSyncRequestFactory() {}\n             if (limit != null) {\n                 builder.variable(\"limit\", \"Int\", limit);\n             }\n-\n+            if (!QueryPredicates.all().equals(predicate)) {\n+                String modelName = ModelSchema.fromModelClass(modelClass).getName();", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzIzOTAzMQ==", "bodyText": "As sort of a philosophical point, I'd argue the non-null checks should be in the build(), not in the private constructor. It is to say \"We won't even attempt construction of the object, if user-provided options foo, bar, are null.\"", "url": "https://github.com/aws-amplify/amplify-android/pull/959#discussion_r523239031", "createdAt": "2020-11-13T21:22:10Z", "author": {"login": "jamesonwilliams"}, "path": "aws-datastore/src/main/java/com/amplifyframework/datastore/syncengine/SubscriptionProcessor.java", "diffHunk": "@@ -66,23 +68,20 @@\n     private final AppSync appSync;\n     private final ModelProvider modelProvider;\n     private final Merger merger;\n+    private final DataStoreConfigurationProvider dataStoreConfigurationProvider;\n     private final CompositeDisposable ongoingOperationsDisposable;\n     private final long adjustedTimeoutSeconds;\n     private ReplaySubject<SubscriptionEvent<? extends Model>> buffer;\n \n     /**\n      * Constructs a new SubscriptionProcessor.\n-     * @param appSync An App Sync endpoint from which to receive subscription events\n-     * @param modelProvider The processor will subscribe to changes for these types of models\n-     * @param merger A merger, to apply data back into local storage\n+     * @param builder A SubscriptionProcessor Builder.\n      */\n-    SubscriptionProcessor(\n-            @NonNull AppSync appSync,\n-            @NonNull ModelProvider modelProvider,\n-            @NonNull Merger merger) {\n-        this.appSync = Objects.requireNonNull(appSync);\n-        this.modelProvider = Objects.requireNonNull(modelProvider);\n-        this.merger = Objects.requireNonNull(merger);\n+    private SubscriptionProcessor(Builder builder) {\n+        this.appSync = Objects.requireNonNull(builder.appSync);", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 35}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzIzOTMyMw==", "bodyText": "Suggested change", "url": "https://github.com/aws-amplify/amplify-android/pull/959#discussion_r523239323", "createdAt": "2020-11-13T21:22:52Z", "author": {"login": "jamesonwilliams"}, "path": "aws-datastore/src/main/java/com/amplifyframework/datastore/syncengine/SubscriptionProcessor.java", "diffHunk": "@@ -299,4 +310,75 @@ static SubscriptionMethod subscriptionMethodFor(\n                 @NonNull Action onComplete\n         );\n     }\n+\n+    /**\n+     * Builds instances of {@link SubscriptionProcessor}s.\n+     */\n+    public static final class Builder implements AppSyncStep, ModelProviderStep, MergerStep,\n+            DataStoreConfigurationProviderStep, BuildStep {\n+        private AppSync appSync;\n+        private ModelProvider modelProvider;\n+        private Merger merger;\n+        private DataStoreConfigurationProvider dataStoreConfigurationProvider;\n+\n+        @NonNull\n+        @Override\n+        public ModelProviderStep appSync(@NonNull AppSync appSync) {\n+            this.appSync = Objects.requireNonNull(appSync);\n+            return Builder.this;\n+        }\n+\n+        @NonNull\n+        @Override\n+        public MergerStep modelProvider(@NonNull ModelProvider modelProvider) {\n+            this.modelProvider = Objects.requireNonNull(modelProvider);\n+            return Builder.this;\n+        }\n+\n+        @NonNull\n+        @Override\n+        public DataStoreConfigurationProviderStep merger(@NonNull Merger merger) {\n+            this.merger = Objects.requireNonNull(merger);\n+            return Builder.this;\n+        }\n+\n+        @NonNull\n+        @Override\n+        public BuildStep dataStoreConfigurationProvider(DataStoreConfigurationProvider dataStoreConfigurationProvider) {\n+            this.dataStoreConfigurationProvider = dataStoreConfigurationProvider;\n+            return Builder.this;\n+        }\n+\n+        @NonNull\n+        @Override\n+        public SubscriptionProcessor build() {\n+            return new SubscriptionProcessor(this);\n+        }\n+    }\n+\n+    interface AppSyncStep {\n+        @NonNull\n+        ModelProviderStep appSync(@NonNull AppSync appSync);\n+    }\n+\n+    interface ModelProviderStep {\n+        @NonNull\n+        MergerStep modelProvider(@NonNull ModelProvider modelProvider);\n+    }\n+\n+    interface MergerStep {\n+        @NonNull\n+        DataStoreConfigurationProviderStep merger(@NonNull Merger merger);\n+    }\n+\n+    interface DataStoreConfigurationProviderStep {\n+        @NonNull\n+        BuildStep dataStoreConfigurationProvider(DataStoreConfigurationProvider dataStoreConfiguration);\n+    }\n+\n+    interface BuildStep {\n+        @NonNull\n+        SubscriptionProcessor build();\n+    }\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 151}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzIzOTg3NQ==", "bodyText": "The RandomString.string() would have the same behavior here, but it reads like \"oh, the value of the ID isn't important for the test, so long as it's there.\"", "url": "https://github.com/aws-amplify/amplify-android/pull/959#discussion_r523239875", "createdAt": "2020-11-13T21:24:00Z", "author": {"login": "jamesonwilliams"}, "path": "aws-datastore/src/test/java/com/amplifyframework/datastore/DataStoreConfigurationTest.java", "diffHunk": "@@ -96,11 +100,13 @@ public void testDefaultOverriddenFromConfigurationAndObject() throws JSONExcepti\n         DummyConflictHandler dummyConflictHandler = new DummyConflictHandler();\n         DataStoreErrorHandler errorHandler = DefaultDataStoreErrorHandler.instance();\n \n+        DataStoreSyncExpression syncExpression = () -> BlogOwner.ID.beginsWith(\"a\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 42}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzI0MDI1Mw==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    this.subscriptionProcessor = SubscriptionProcessor.builder().appSync(appSync)\n          \n          \n            \n                            .modelProvider(modelProvider)\n          \n          \n            \n                    this.subscriptionProcessor = SubscriptionProcessor.builder()\n          \n          \n            \n                            .appSync(appSync)\n          \n          \n            \n                            .modelProvider(modelProvider)", "url": "https://github.com/aws-amplify/amplify-android/pull/959#discussion_r523240253", "createdAt": "2020-11-13T21:24:48Z", "author": {"login": "jamesonwilliams"}, "path": "aws-datastore/src/test/java/com/amplifyframework/datastore/syncengine/SubscriptionProcessorTest.java", "diffHunk": "@@ -84,7 +86,13 @@ public void setup() throws AmplifyException {\n         this.models = sortedModels(modelProvider);\n         this.appSync = mock(AppSync.class);\n         this.merger = mock(Merger.class);\n-        this.subscriptionProcessor = new SubscriptionProcessor(appSync, modelProvider, merger);\n+        this.subscriptionProcessor = SubscriptionProcessor.builder().appSync(appSync)\n+                .modelProvider(modelProvider)", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 22}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7b54ee44b526e1fb55f45079482644ed87889559", "author": {"user": {"login": "richardmcclellan", "name": "Richard McClellan"}}, "url": "https://github.com/aws-amplify/amplify-android/commit/7b54ee44b526e1fb55f45079482644ed87889559", "committedDate": "2020-11-16T17:50:39Z", "message": "feat(datastore) selective sync"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "091940f85c361bb338252269caf6b257365b0bba", "author": {"user": {"login": "richardmcclellan", "name": "Richard McClellan"}}, "url": "https://github.com/aws-amplify/amplify-android/commit/091940f85c361bb338252269caf6b257365b0bba", "committedDate": "2020-11-16T17:50:39Z", "message": "Update aws-datastore/src/main/java/com/amplifyframework/datastore/DataStoreConfiguration.java\n\nCo-authored-by: Jameson Williams <jhwill@amazon.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "556f46b825212a0b5a0eb0747809561b6a6378a0", "author": {"user": {"login": "richardmcclellan", "name": "Richard McClellan"}}, "url": "https://github.com/aws-amplify/amplify-android/commit/556f46b825212a0b5a0eb0747809561b6a6378a0", "committedDate": "2020-11-16T17:50:40Z", "message": "Update aws-datastore/src/main/java/com/amplifyframework/datastore/syncengine/SubscriptionProcessor.java\n\nCo-authored-by: Jameson Williams <jhwill@amazon.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "933765a3d0819d08cdc0863cf96a33fbbd2165ff", "author": {"user": {"login": "richardmcclellan", "name": "Richard McClellan"}}, "url": "https://github.com/aws-amplify/amplify-android/commit/933765a3d0819d08cdc0863cf96a33fbbd2165ff", "committedDate": "2020-11-16T17:50:40Z", "message": "Update aws-datastore/src/test/java/com/amplifyframework/datastore/syncengine/SubscriptionProcessorTest.java\n\nCo-authored-by: Jameson Williams <jhwill@amazon.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "680f10fb995e5ed15a15d864c250eda975e5ac7e", "author": {"user": {"login": "richardmcclellan", "name": "Richard McClellan"}}, "url": "https://github.com/aws-amplify/amplify-android/commit/680f10fb995e5ed15a15d864c250eda975e5ac7e", "committedDate": "2020-11-16T17:50:40Z", "message": "Address PR feedback"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": {"oid": "680f10fb995e5ed15a15d864c250eda975e5ac7e", "author": {"user": {"login": "richardmcclellan", "name": "Richard McClellan"}}, "url": "https://github.com/aws-amplify/amplify-android/commit/680f10fb995e5ed15a15d864c250eda975e5ac7e", "committedDate": "2020-11-16T17:50:40Z", "message": "Address PR feedback"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7ec0f5ac27ec396168887283a5bd15fe23449e1b", "author": {"user": {"login": "richardmcclellan", "name": "Richard McClellan"}}, "url": "https://github.com/aws-amplify/amplify-android/commit/7ec0f5ac27ec396168887283a5bd15fe23449e1b", "committedDate": "2020-11-16T20:09:49Z", "message": "Fix merge conflict"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMxODAwMjAw", "url": "https://github.com/aws-amplify/amplify-android/pull/959#pullrequestreview-531800200", "createdAt": "2020-11-16T21:37:48Z", "commit": null, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNlQyMTozNzo0OFrOH0T-fg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNlQyMTozNzo0OFrOH0T-fg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDYxNTI5NA==", "bodyText": "Can you make this a map from model name to sync expression, Map<String, DataStoreSyncExpression>? This would be more likely to work for Flutter, if/when that gets implemented in amplify-flutter.", "url": "https://github.com/aws-amplify/amplify-android/pull/959#discussion_r524615294", "createdAt": "2020-11-16T21:37:48Z", "author": {"login": "jamesonwilliams"}, "path": "aws-datastore/src/main/java/com/amplifyframework/datastore/DataStoreConfiguration.java", "diffHunk": "@@ -44,21 +50,16 @@\n     private final DataStoreConflictHandler conflictHandler;\n     private final Integer syncMaxRecords;\n     private final Integer syncPageSize;\n-    private Long syncIntervalInMinutes;\n-\n-    private DataStoreConfiguration(\n-            DataStoreErrorHandler errorHandler,\n-            DataStoreConflictHandler conflictHandler,\n-            Long syncIntervalInMinutes,\n-            Integer syncMaxRecords,\n-            Integer syncPageSize) {\n-        this.errorHandler = errorHandler;\n-        this.conflictHandler = conflictHandler;\n-        this.syncMaxRecords = syncMaxRecords;\n-        this.syncPageSize = syncPageSize;\n-        if (syncIntervalInMinutes != null) {\n-            this.syncIntervalInMinutes = syncIntervalInMinutes;\n-        }\n+    private final Map<Class<? extends Model>, DataStoreSyncExpression> syncExpressions;", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 36}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMxODAxNjQ4", "url": "https://github.com/aws-amplify/amplify-android/pull/959#pullrequestreview-531801648", "createdAt": "2020-11-16T21:40:02Z", "commit": null, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNlQyMTo0MDowMlrOH0UINQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNlQyMTo0MDowMlrOH0UINQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDYxNzc4MQ==", "bodyText": "If you do the String modelName instead of the Class<? extends Model> modelClass, could be just modelSchema.getName()", "url": "https://github.com/aws-amplify/amplify-android/pull/959#discussion_r524617781", "createdAt": "2020-11-16T21:40:02Z", "author": {"login": "jamesonwilliams"}, "path": "aws-datastore/src/main/java/com/amplifyframework/datastore/syncengine/SubscriptionProcessor.java", "diffHunk": "@@ -206,6 +213,11 @@ private boolean isUnauthorizedException(DataStoreException exception) {\n         .subscribeOn(Schedulers.io())\n         .observeOn(Schedulers.io())\n         .map(SubscriptionProcessor::unwrapResponse)\n+        .filter(modelWithMetadata -> {\n+            Class<? extends Model> clazz = modelSchema.getModelClass();", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 71}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMxODAyNTc3", "url": "https://github.com/aws-amplify/amplify-android/pull/959#pullrequestreview-531802577", "createdAt": "2020-11-16T21:40:55Z", "commit": null, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": {"oid": "7ec0f5ac27ec396168887283a5bd15fe23449e1b", "author": {"user": {"login": "richardmcclellan", "name": "Richard McClellan"}}, "url": "https://github.com/aws-amplify/amplify-android/commit/7ec0f5ac27ec396168887283a5bd15fe23449e1b", "committedDate": "2020-11-16T20:09:49Z", "message": "Fix merge conflict"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b165be7ee0a90b020e76d517b8a63a8837f57d5a", "author": {"user": {"login": "richardmcclellan", "name": "Richard McClellan"}}, "url": "https://github.com/aws-amplify/amplify-android/commit/b165be7ee0a90b020e76d517b8a63a8837f57d5a", "committedDate": "2020-11-16T23:30:16Z", "message": "Change modelClass to modelName to more easily support hybrid platforms"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMyMDYyNjA5", "url": "https://github.com/aws-amplify/amplify-android/pull/959#pullrequestreview-532062609", "createdAt": "2020-11-17T06:51:39Z", "commit": {"oid": "b165be7ee0a90b020e76d517b8a63a8837f57d5a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "721048fccf04ccb3c5c908c40806223d4cff0a06", "author": {"user": {"login": "richardmcclellan", "name": "Richard McClellan"}}, "url": "https://github.com/aws-amplify/amplify-android/commit/721048fccf04ccb3c5c908c40806223d4cff0a06", "committedDate": "2020-11-17T20:17:21Z", "message": "Only evaluate DataStoreSyncExpressions on DataStore.start"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMzODU0NDE3", "url": "https://github.com/aws-amplify/amplify-android/pull/959#pullrequestreview-533854417", "createdAt": "2020-11-18T20:36:20Z", "commit": {"oid": "721048fccf04ccb3c5c908c40806223d4cff0a06"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOFQyMDozNjoyMFrOH2BJmg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOFQyMDozNjoyMFrOH2BJmg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjQwMzk5NA==", "bodyText": "Not that this matters or is worth changing but is there a reason you switched from passing in params to passing in the Builder instance? We do the opposite elsewhere in the code.", "url": "https://github.com/aws-amplify/amplify-android/pull/959#discussion_r526403994", "createdAt": "2020-11-18T20:36:20Z", "author": {"login": "TrekSoft"}, "path": "aws-datastore/src/main/java/com/amplifyframework/datastore/syncengine/SyncProcessor.java", "diffHunk": "@@ -69,20 +69,16 @@\n     private final Merger merger;\n     private final DataStoreConfigurationProvider dataStoreConfigurationProvider;\n     private final String[] modelNames;\n-\n-    private SyncProcessor(\n-            ModelProvider modelProvider,\n-            ModelSchemaRegistry modelSchemaRegistry,\n-            SyncTimeRegistry syncTimeRegistry,\n-            AppSync appSync,\n-            Merger merger,\n-            DataStoreConfigurationProvider dataStoreConfigurationProvider) {\n-        this.modelProvider = Objects.requireNonNull(modelProvider);\n-        this.modelSchemaRegistry = Objects.requireNonNull(modelSchemaRegistry);\n-        this.syncTimeRegistry = Objects.requireNonNull(syncTimeRegistry);\n-        this.appSync = Objects.requireNonNull(appSync);\n-        this.merger = Objects.requireNonNull(merger);\n-        this.dataStoreConfigurationProvider = dataStoreConfigurationProvider;\n+    private final QueryPredicateProvider queryPredicateProvider;\n+\n+    private SyncProcessor(Builder builder) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "721048fccf04ccb3c5c908c40806223d4cff0a06"}, "originalPosition": 20}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMzODU1MzU5", "url": "https://github.com/aws-amplify/amplify-android/pull/959#pullrequestreview-533855359", "createdAt": "2020-11-18T20:37:43Z", "commit": {"oid": "721048fccf04ccb3c5c908c40806223d4cff0a06"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3312, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}