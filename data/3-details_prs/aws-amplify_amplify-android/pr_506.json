{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDIxNTc4MTk2", "number": 506, "title": "Integrates Auth with Predictions, Updates Sign Out, Disables AWS Logs", "bodyText": "Integrates Auth with Predictions\nUpdates SignOut to do local by default with an option to explicitly sign out globally which will fail if the device is offline and fall back to local if a global sign out was first done on another device.\nDisables AWS logs to remove some of the confusing clutter in LogCat (AWSMobileClient still does it's own logs which is very annoying).\n\nBy submitting this pull request, I confirm that my contribution is made under the terms of the Apache 2.0 license.", "createdAt": "2020-05-21T20:48:32Z", "url": "https://github.com/aws-amplify/amplify-android/pull/506", "merged": true, "mergeCommit": {"oid": "a4a76634dd1a3aaeb8a3f31c7b62334c91adbcea"}, "closed": true, "closedAt": "2020-05-21T23:00:18Z", "author": {"login": "TrekSoft"}, "timelineItems": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcjj5t0gH2gAyNDIxNTc4MTk2OmJmNTQyYmMxMDA1YzcwZTBkZjhiMmRmODE1OTA2NzhhNGQxYzY4OGQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcjsnyngFqTQxNjQ4NTI1NQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "bf542bc1005c70e0df8b2df81590678a4d1c688d", "author": {"user": {"login": "TrekSoft", "name": "David Daudelin"}}, "url": "https://github.com/aws-amplify/amplify-android/commit/bf542bc1005c70e0df8b2df81590678a4d1c688d", "committedDate": "2020-05-21T20:43:09Z", "message": "Integrates Auth with Predictions, Updates Sign Out, Disables AWS Logs"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE2NTM4OTQy", "url": "https://github.com/aws-amplify/amplify-android/pull/506#pullrequestreview-416538942", "createdAt": "2020-05-21T22:36:43Z", "commit": {"oid": "bf542bc1005c70e0df8b2df81590678a4d1c688d"}, "state": "APPROVED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMVQyMjozNjo0M1rOGZFLTw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMVQyMjo0MjozOFrOGZFSOg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODk1MjM5OQ==", "bodyText": "I do wonder idly if we could do a kludge a thing where we listen to the logs and reply them all as DEBUG.  A bad idea for later maybe.", "url": "https://github.com/aws-amplify/amplify-android/pull/506#discussion_r428952399", "createdAt": "2020-05-21T22:36:43Z", "author": {"login": "jpignata"}, "path": "aws-auth-cognito/src/main/java/com/amplifyframework/auth/cognito/AWSCognitoAuthPlugin.java", "diffHunk": "@@ -119,6 +123,7 @@ public void configure(\n     ) throws AuthException {\n         final CountDownLatch latch = new CountDownLatch(1);\n         final AtomicReference<Exception> asyncException = new AtomicReference<>();\n+        LogFactory.setLevel(LogFactory.Level.OFF);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bf542bc1005c70e0df8b2df81590678a4d1c688d"}, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODk1MzY4Nw==", "bodyText": "Copypasta.", "url": "https://github.com/aws-amplify/amplify-android/pull/506#discussion_r428953687", "createdAt": "2020-05-21T22:40:56Z", "author": {"login": "jpignata"}, "path": "aws-predictions/src/main/java/com/amplifyframework/predictions/aws/AWSPredictionsPlugin.java", "diffHunk": "@@ -79,7 +91,26 @@ public String getPluginKey() {\n     @Override\n     public void configure(JSONObject pluginConfiguration, @NonNull Context context) throws PredictionsException {\n         this.configuration = AWSPredictionsPluginConfiguration.fromJson(pluginConfiguration);\n-        this.predictionsService = new AWSPredictionsService(configuration);\n+\n+        AWSCredentialsProvider credentialsProvider;\n+\n+        if (credentialsProviderOverride != null) {\n+            credentialsProvider = credentialsProviderOverride;\n+        } else {\n+            try {\n+                credentialsProvider =\n+                        (AWSMobileClient) Amplify.Auth.getPlugin(AUTH_DEPENDENCY_PLUGIN_KEY).getEscapeHatch();\n+            } catch (IllegalStateException exception) {\n+                throw new PredictionsException(\n+                        \"AWSPredictionsPlugin depends on AWSCognitoAuthPlugin but it is currently missing\",\n+                        exception,\n+                        \"Before configuring Amplify, be sure to add AWSPredictionsPlugin same as you added \" +\n+                                \"AWSPinpointAnalyticsPlugin.\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bf542bc1005c70e0df8b2df81590678a4d1c688d"}, "originalPosition": 65}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODk1NDE3MA==", "bodyText": "This formatting seems curious?", "url": "https://github.com/aws-amplify/amplify-android/pull/506#discussion_r428954170", "createdAt": "2020-05-21T22:42:38Z", "author": {"login": "jpignata"}, "path": "core/src/main/java/com/amplifyframework/auth/options/AuthSignOutOptions.java", "diffHunk": "@@ -0,0 +1,143 @@\n+/*\n+ * Copyright 2020 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *  http://aws.amazon.com/apache2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ * permissions and limitations under the License.\n+ */\n+\n+package com.amplifyframework.auth.options;\n+\n+import androidx.annotation.NonNull;\n+import androidx.core.util.ObjectsCompat;\n+\n+/**\n+ * Advanced options for signing out.\n+ */\n+public class AuthSignOutOptions {\n+    private final boolean globalSignOut;\n+\n+    /**\n+     * Advanced options for signing up.\n+     * @param globalSignOut Sign out of all devices\n+     */\n+    protected AuthSignOutOptions(\n+            boolean globalSignOut", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bf542bc1005c70e0df8b2df81590678a4d1c688d"}, "originalPosition": 32}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE2NDg1MjU1", "url": "https://github.com/aws-amplify/amplify-android/pull/506#pullrequestreview-416485255", "createdAt": "2020-05-21T20:55:11Z", "commit": {"oid": "bf542bc1005c70e0df8b2df81590678a4d1c688d"}, "state": "APPROVED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMVQyMDo1NToxMVrOGZCi2g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMlQwNjo1MjowM1rOGZMiyA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODkwOTI3NA==", "bodyText": "\"AWSPredictionsPlugin\"", "url": "https://github.com/aws-amplify/amplify-android/pull/506#discussion_r428909274", "createdAt": "2020-05-21T20:55:11Z", "author": {"login": "raphkim"}, "path": "aws-predictions/src/main/java/com/amplifyframework/predictions/aws/AWSPredictionsPlugin.java", "diffHunk": "@@ -79,7 +91,26 @@ public String getPluginKey() {\n     @Override\n     public void configure(JSONObject pluginConfiguration, @NonNull Context context) throws PredictionsException {\n         this.configuration = AWSPredictionsPluginConfiguration.fromJson(pluginConfiguration);\n-        this.predictionsService = new AWSPredictionsService(configuration);\n+\n+        AWSCredentialsProvider credentialsProvider;\n+\n+        if (credentialsProviderOverride != null) {\n+            credentialsProvider = credentialsProviderOverride;\n+        } else {\n+            try {\n+                credentialsProvider =\n+                        (AWSMobileClient) Amplify.Auth.getPlugin(AUTH_DEPENDENCY_PLUGIN_KEY).getEscapeHatch();\n+            } catch (IllegalStateException exception) {\n+                throw new PredictionsException(\n+                        \"AWSPredictionsPlugin depends on AWSCognitoAuthPlugin but it is currently missing\",\n+                        exception,\n+                        \"Before configuring Amplify, be sure to add AWSPredictionsPlugin same as you added \" +\n+                                \"AWSPinpointAnalyticsPlugin.\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bf542bc1005c70e0df8b2df81590678a4d1c688d"}, "originalPosition": 65}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODkxMDczNw==", "bodyText": "i think the general pattern should be\npublic AWSPredictionsPlugin() {\n    this(null);\n}\n\n@VisibleForTesting\nAWSPredictionsPlugin(AWSCredentialsProvider provider) {\n    ...\n}\n\nSo that credentialsProviderOverride is explicitly assigned in both cases.", "url": "https://github.com/aws-amplify/amplify-android/pull/506#discussion_r428910737", "createdAt": "2020-05-21T20:58:06Z", "author": {"login": "raphkim"}, "path": "aws-predictions/src/main/java/com/amplifyframework/predictions/aws/AWSPredictionsPlugin.java", "diffHunk": "@@ -70,6 +76,12 @@ public AWSPredictionsPlugin() {\n         this.executorService = Executors.newCachedThreadPool();\n     }\n \n+    @VisibleForTesting\n+    AWSPredictionsPlugin(AWSCredentialsProvider credentialsProviderOverride) {\n+        this();\n+        this.credentialsProviderOverride = credentialsProviderOverride;\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bf542bc1005c70e0df8b2df81590678a4d1c688d"}, "originalPosition": 41}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODkxMTQ1Ng==", "bodyText": "nit: punctuation\n\"AWSPredictionsPlugin depends on AWSCognitoAuthPlugin, but it is currently missing.\"", "url": "https://github.com/aws-amplify/amplify-android/pull/506#discussion_r428911456", "createdAt": "2020-05-21T20:59:27Z", "author": {"login": "raphkim"}, "path": "aws-predictions/src/main/java/com/amplifyframework/predictions/aws/AWSPredictionsPlugin.java", "diffHunk": "@@ -79,7 +91,26 @@ public String getPluginKey() {\n     @Override\n     public void configure(JSONObject pluginConfiguration, @NonNull Context context) throws PredictionsException {\n         this.configuration = AWSPredictionsPluginConfiguration.fromJson(pluginConfiguration);\n-        this.predictionsService = new AWSPredictionsService(configuration);\n+\n+        AWSCredentialsProvider credentialsProvider;\n+\n+        if (credentialsProviderOverride != null) {\n+            credentialsProvider = credentialsProviderOverride;\n+        } else {\n+            try {\n+                credentialsProvider =\n+                        (AWSMobileClient) Amplify.Auth.getPlugin(AUTH_DEPENDENCY_PLUGIN_KEY).getEscapeHatch();\n+            } catch (IllegalStateException exception) {\n+                throw new PredictionsException(\n+                        \"AWSPredictionsPlugin depends on AWSCognitoAuthPlugin but it is currently missing\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bf542bc1005c70e0df8b2df81590678a4d1c688d"}, "originalPosition": 62}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTA3MzA5Ng==", "bodyText": "Is this for turning off mobile client logs?", "url": "https://github.com/aws-amplify/amplify-android/pull/506#discussion_r429073096", "createdAt": "2020-05-22T06:52:03Z", "author": {"login": "raphkim"}, "path": "aws-auth-cognito/src/main/java/com/amplifyframework/auth/cognito/AWSCognitoAuthPlugin.java", "diffHunk": "@@ -119,6 +123,7 @@ public void configure(\n     ) throws AuthException {\n         final CountDownLatch latch = new CountDownLatch(1);\n         final AtomicReference<Exception> asyncException = new AtomicReference<>();\n+        LogFactory.setLevel(LogFactory.Level.OFF);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bf542bc1005c70e0df8b2df81590678a4d1c688d"}, "originalPosition": 29}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2548, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}