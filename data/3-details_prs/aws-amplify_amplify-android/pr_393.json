{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA3NTA1OTY2", "number": 393, "title": "Adds getCurrentUser and changePassword", "bodyText": "Adds getCurrentUser and changePassword\nFixes exception handling in the configure method\nUpdates signInWithSocial to have proper result object\nUpdates result objects to be extendable since plugins may very well have extra information they want to include in their result objects.\n\nBy submitting this pull request, I confirm that my contribution is made under the terms of the Apache 2.0 license.", "createdAt": "2020-04-22T19:47:51Z", "url": "https://github.com/aws-amplify/amplify-android/pull/393", "merged": true, "mergeCommit": {"oid": "1eddef05ac7f72b4cd5e864e8d49cae403f0d034"}, "closed": true, "closedAt": "2020-04-29T18:20:37Z", "author": {"login": "TrekSoft"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcZlgO6gH2gAyNDA3NTA1OTY2OmViNzkwYzNhNTA4Yzk1M2JmNTRhYmE0OThlMWY3NjRlM2MxOWE5MzA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABccbl37AFqTQwMjg2NjE3OQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "eb790c3a508c953bf54aba498e1f764e3c19a930", "author": {"user": {"login": "TrekSoft", "name": "David Daudelin"}}, "url": "https://github.com/aws-amplify/amplify-android/commit/eb790c3a508c953bf54aba498e1f764e3c19a930", "committedDate": "2020-04-20T20:55:53Z", "message": "Adds social sign in"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c1b72bd853beea221bba65a1104381e45b033cfe", "author": {"user": {"login": "TrekSoft", "name": "David Daudelin"}}, "url": "https://github.com/aws-amplify/amplify-android/commit/c1b72bd853beea221bba65a1104381e45b033cfe", "committedDate": "2020-04-22T19:39:08Z", "message": "Adds getCurrentUser and changePassword"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "223ab75339254a2f5437f360b64b8f22bef5327c", "author": {"user": {"login": "TrekSoft", "name": "David Daudelin"}}, "url": "https://github.com/aws-amplify/amplify-android/commit/223ab75339254a2f5437f360b64b8f22bef5327c", "committedDate": "2020-04-22T19:43:08Z", "message": "Merge branch 'AuthCategory' into ddaudeli/GetAuthUser"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk5Mzg0MzU3", "url": "https://github.com/aws-amplify/amplify-android/pull/393#pullrequestreview-399384357", "createdAt": "2020-04-23T18:52:22Z", "commit": {"oid": "223ab75339254a2f5437f360b64b8f22bef5327c"}, "state": "COMMENTED", "comments": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yM1QxODo1MjoyM1rOGK3KVQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yM1QxOToyNToyNlrOGK4bLw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDA0MjcwOQ==", "bodyText": "It's always better to write these as KnownNotNull.VALUE.equals(itCouldMaybeByNull) In the case of enum values, prefer to put them on the left of the .equals(...).", "url": "https://github.com/aws-amplify/amplify-android/pull/393#discussion_r414042709", "createdAt": "2020-04-23T18:52:23Z", "author": {"login": "jamesonwilliams"}, "path": "aws-auth-cognito/src/main/java/com/amplifyframework/auth/cognito/AWSCognitoAuthPlugin.java", "diffHunk": "@@ -69,35 +76,64 @@ public String getPluginKey() {\n     public void configure(\n             @NonNull JSONObject pluginConfiguration,\n             @NonNull Context context\n-    ) throws AmplifyException {\n+    ) throws AuthException {\n         final CountDownLatch latch = new CountDownLatch(1);\n+        final AsyncResult<Exception> asyncException = new AsyncResult<>();\n \n         AWSMobileClient.getInstance().initialize(\n             context,\n             new AWSConfiguration(pluginConfiguration),\n             new Callback<UserStateDetails>() {\n                 @Override\n                 public void onResult(UserStateDetails result) {\n-                    latch.countDown();\n+                    if (result.getUserState().equals(UserState.SIGNED_IN)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "223ab75339254a2f5437f360b64b8f22bef5327c"}, "originalPosition": 50}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDA0NDc1Mg==", "bodyText": "As a comment on software construction - this looks mostly the same as an java.util.concurrent.AtomicReference.\nMore on the design sign, though, this might be a problematic construct. If actor A is writing to this, and actor B is reading from it, how will actor B know when to read? Even though you have an isSet(), actor B might ask at the wrong time.\nTo that point, the construct is inherently racy, which is why Java makes the AtomicReference as a thread-safe utility in the concurrency package.\nOne of the reasons Rx is popular for async programming is that it provides a way to chain together asynchronous work that depends on other asynchronous work.\nI think the point of the AyncResult here is to decouple a chain of async work, from some synchronous work. But as above, this will destroy the dependency relationship, some event/trigger that notifies another component that the value state has changed.", "url": "https://github.com/aws-amplify/amplify-android/pull/393#discussion_r414044752", "createdAt": "2020-04-23T18:55:43Z", "author": {"login": "jamesonwilliams"}, "path": "core/src/main/java/com/amplifyframework/util/AsyncResult.java", "diffHunk": "@@ -0,0 +1,55 @@\n+/*\n+ * Copyright 2020 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *  http://aws.amazon.com/apache2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ * permissions and limitations under the License.\n+ */\n+\n+package com.amplifyframework.util;\n+\n+import androidx.annotation.NonNull;\n+import androidx.annotation.Nullable;\n+\n+/**\n+ * A simple class which starts empty and will indicate if it's ever been set with a value and if so, what that value is.\n+ * @param <T> The type of result stored in this object.\n+ */\n+public class AsyncResult<T> {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "223ab75339254a2f5437f360b64b8f22bef5327c"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDA0ODg2NA==", "bodyText": "In the JavaDoc, can you qualify what \"completely\" means, here? Does it mean successful completion of any sign-in challenges, and (something about that validation data object?)", "url": "https://github.com/aws-amplify/amplify-android/pull/393#discussion_r414048864", "createdAt": "2020-04-23T19:01:51Z", "author": {"login": "jamesonwilliams"}, "path": "core/src/main/java/com/amplifyframework/auth/result/AuthSocialSignInResult.java", "diffHunk": "@@ -0,0 +1,76 @@\n+/*\n+ * Copyright 2020 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *  http://aws.amazon.com/apache2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ * permissions and limitations under the License.\n+ */\n+\n+package com.amplifyframework.auth.result;\n+\n+import androidx.core.util.ObjectsCompat;\n+\n+public class AuthSocialSignInResult {\n+    private final boolean isSignedIn;\n+\n+    /**\n+     * Wraps the result of a sign in operation.\n+     * @param isSignedIn true if the user is now completely signed in, false otherwise\n+     */\n+    public AuthSocialSignInResult(boolean isSignedIn) {\n+        this.isSignedIn = isSignedIn;\n+    }\n+\n+    /**\n+     * True if the user is now completely signed in, false otherwise.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "223ab75339254a2f5437f360b64b8f22bef5327c"}, "originalPosition": 32}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDA1MDI0OQ==", "bodyText": "When would someone extend this? Can you suggest a use case in a class-level JavaDoc? Or, alternately, add final to close the class?\nHow come we AuthSocialSignInResult needs to be distinct from just an AuthSignInResult?", "url": "https://github.com/aws-amplify/amplify-android/pull/393#discussion_r414050249", "createdAt": "2020-04-23T19:04:08Z", "author": {"login": "jamesonwilliams"}, "path": "core/src/main/java/com/amplifyframework/auth/result/AuthSocialSignInResult.java", "diffHunk": "@@ -0,0 +1,76 @@\n+/*\n+ * Copyright 2020 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *  http://aws.amazon.com/apache2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ * permissions and limitations under the License.\n+ */\n+\n+package com.amplifyframework.auth.result;\n+\n+import androidx.core.util.ObjectsCompat;\n+\n+public class AuthSocialSignInResult {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "223ab75339254a2f5437f360b64b8f22bef5327c"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDA1MjM2Mw==", "bodyText": "Nothing in this PR actually extends it, though, right? Why open it?", "url": "https://github.com/aws-amplify/amplify-android/pull/393#discussion_r414052363", "createdAt": "2020-04-23T19:07:29Z", "author": {"login": "jamesonwilliams"}, "path": "core/src/main/java/com/amplifyframework/auth/result/AuthSignUpResult.java", "diffHunk": "@@ -19,7 +19,7 @@\n \n import com.amplifyframework.auth.AuthCodeDeliveryDetails;\n \n-public final class AuthSignUpResult {\n+public class AuthSignUpResult {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "223ab75339254a2f5437f360b64b8f22bef5327c"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDA1MjY5Mg==", "bodyText": "Why open?", "url": "https://github.com/aws-amplify/amplify-android/pull/393#discussion_r414052692", "createdAt": "2020-04-23T19:08:01Z", "author": {"login": "jamesonwilliams"}, "path": "core/src/main/java/com/amplifyframework/auth/result/AuthSignInResult.java", "diffHunk": "@@ -20,7 +20,7 @@\n import com.amplifyframework.auth.AuthCodeDeliveryDetails;\n import com.amplifyframework.auth.AuthSignInState;\n \n-public final class AuthSignInResult {\n+public class AuthSignInResult {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "223ab75339254a2f5437f360b64b8f22bef5327c"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDA1ODE4Nw==", "bodyText": "If AuthUser is a valid working user, and then changePassword(...) is called and fails, then AuthUser is no longer a valid working user. This might have significance to the auth system, and to the app that integrates it. How can other components come to know that that AuthUser no longer has a valid password? Only by attempting to use the instance?\nThis also makes it look like there's one auth, and it mutates. Is that the case? If so, should you make this a singleton? If so, you could end up with an access pattern like Amplify.Auth.User.changePassword(...) which is certainly very readable, anyway.\nInstead of making an abstract class, and allowing an implementer to add a variety of customizations onto this class, you could accomodate the changePassword(...) by accepting a ChangePasswordStrategy into the constructor of the final AuthUser. e.g.,\n@FunctionalInterface interface ChangePasswordStrategy {\n    void changePassword(String oldPass, String newPass, Action onSuccess, Consumer<AuthException> onFailure);\n}", "url": "https://github.com/aws-amplify/amplify-android/pull/393#discussion_r414058187", "createdAt": "2020-04-23T19:16:49Z", "author": {"login": "jamesonwilliams"}, "path": "core/src/main/java/com/amplifyframework/auth/AuthUser.java", "diffHunk": "@@ -52,6 +55,24 @@ public String getUsername() {\n         return username;\n     }\n \n+    /**\n+     * Interface for changing the password of an existing user.\n+     * @param oldPassword The user's existing password\n+     * @param newPassword The new password desired on the user account\n+     * @param onSuccess Success callback\n+     * @param onError Error callback\n+     */\n+    public abstract void changePassword(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "223ab75339254a2f5437f360b64b8f22bef5327c"}, "originalPosition": 27}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDA1OTEyMg==", "bodyText": "final", "url": "https://github.com/aws-amplify/amplify-android/pull/393#discussion_r414059122", "createdAt": "2020-04-23T19:18:23Z", "author": {"login": "jamesonwilliams"}, "path": "aws-auth-cognito/src/main/java/com/amplifyframework/auth/cognito/AWSCognitoAuthUser.java", "diffHunk": "@@ -0,0 +1,72 @@\n+/*\n+ * Copyright 2020 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *  http://aws.amazon.com/apache2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ * permissions and limitations under the License.\n+ */\n+\n+package com.amplifyframework.auth.cognito;\n+\n+import androidx.annotation.NonNull;\n+import androidx.core.util.Consumer;\n+\n+import com.amplifyframework.auth.AuthException;\n+import com.amplifyframework.auth.AuthUser;\n+import com.amplifyframework.core.Action;\n+\n+import com.amazonaws.mobile.client.AWSMobileClient;\n+import com.amazonaws.mobile.client.Callback;\n+\n+import java.util.Objects;\n+\n+public final class AWSCognitoAuthUser extends AuthUser {\n+    private AWSMobileClient client;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "223ab75339254a2f5437f360b64b8f22bef5327c"}, "originalPosition": 31}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDA2MjQ5NQ==", "bodyText": "We had agreed to put this in configure(...) since we read the code and it looked like it was only doing configuration.\nThis current PR is adding initialization logic into the callback, though. We should split that out into the initialize() hook.", "url": "https://github.com/aws-amplify/amplify-android/pull/393#discussion_r414062495", "createdAt": "2020-04-23T19:23:57Z", "author": {"login": "jamesonwilliams"}, "path": "aws-auth-cognito/src/main/java/com/amplifyframework/auth/cognito/AWSCognitoAuthPlugin.java", "diffHunk": "@@ -69,35 +76,64 @@ public String getPluginKey() {\n     public void configure(\n             @NonNull JSONObject pluginConfiguration,\n             @NonNull Context context\n-    ) throws AmplifyException {\n+    ) throws AuthException {\n         final CountDownLatch latch = new CountDownLatch(1);\n+        final AsyncResult<Exception> asyncException = new AsyncResult<>();\n \n         AWSMobileClient.getInstance().initialize(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "223ab75339254a2f5437f360b64b8f22bef5327c"}, "originalPosition": 43}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDA2MzQwNw==", "bodyText": "The three exceptions being created from within this try are all very similar. Think of some ways you can create one error, and throw it if any of the scenarios arrise.", "url": "https://github.com/aws-amplify/amplify-android/pull/393#discussion_r414063407", "createdAt": "2020-04-23T19:25:26Z", "author": {"login": "jamesonwilliams"}, "path": "aws-auth-cognito/src/main/java/com/amplifyframework/auth/cognito/AWSCognitoAuthPlugin.java", "diffHunk": "@@ -69,35 +76,64 @@ public String getPluginKey() {\n     public void configure(\n             @NonNull JSONObject pluginConfiguration,\n             @NonNull Context context\n-    ) throws AmplifyException {\n+    ) throws AuthException {\n         final CountDownLatch latch = new CountDownLatch(1);\n+        final AsyncResult<Exception> asyncException = new AsyncResult<>();\n \n         AWSMobileClient.getInstance().initialize(\n             context,\n             new AWSConfiguration(pluginConfiguration),\n             new Callback<UserStateDetails>() {\n                 @Override\n                 public void onResult(UserStateDetails result) {\n-                    latch.countDown();\n+                    if (result.getUserState().equals(UserState.SIGNED_IN)) {\n+                        fetchAndSetUserId(() -> latch.countDown());\n+                    } else {\n+                        userId = null;\n+                        latch.countDown();\n+                    }\n+\n+                    AWSMobileClient.getInstance().addUserStateListener(userStateDetails -> {\n+                        switch (userStateDetails.getUserState()) {\n+                            case SIGNED_IN:\n+                                fetchAndSetUserId(() -> { /* No response needed */ });\n+                                break;\n+                            default:\n+                                userId = null;\n+                        }\n+                    });\n                 }\n \n                 @Override\n                 public void onError(Exception error) {\n-                    throw new IllegalStateException(\"Failed to instantiate AWSMobileClient\", error);\n+                    asyncException.set(error);\n+                    latch.countDown();\n                 }\n             }\n         );\n \n         try {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "223ab75339254a2f5437f360b64b8f22bef5327c"}, "originalPosition": 77}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7dca3ac8777e2661fe0bf042679052029fa4f357", "author": {"user": {"login": "TrekSoft", "name": "David Daudelin"}}, "url": "https://github.com/aws-amplify/amplify-android/commit/7dca3ac8777e2661fe0bf042679052029fa4f357", "committedDate": "2020-04-24T16:33:55Z", "message": "Initial addressing of PR comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "20a6e0320ba2d4bb001ff0d7f52295b16728926c", "author": {"user": {"login": "TrekSoft", "name": "David Daudelin"}}, "url": "https://github.com/aws-amplify/amplify-android/commit/20a6e0320ba2d4bb001ff0d7f52295b16728926c", "committedDate": "2020-04-28T19:34:03Z", "message": "Additional PR feedback addressed"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c0cbe30b81bc0048ff5f8c10f92bba02a6335bf2", "author": {"user": {"login": "TrekSoft", "name": "David Daudelin"}}, "url": "https://github.com/aws-amplify/amplify-android/commit/c0cbe30b81bc0048ff5f8c10f92bba02a6335bf2", "committedDate": "2020-04-28T19:35:58Z", "message": "Removes unused variable"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAyODY2MTc5", "url": "https://github.com/aws-amplify/amplify-android/pull/393#pullrequestreview-402866179", "createdAt": "2020-04-29T17:04:46Z", "commit": {"oid": "c0cbe30b81bc0048ff5f8c10f92bba02a6335bf2"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2712, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}