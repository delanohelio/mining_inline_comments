{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY2MjIzOTkz", "number": 716, "title": "feature(datastore) Trigger network-related hub events", "bodyText": "Description of changes:\nTrigger the following Hub events:\n\nsubscriptionsEstablished: triggered from the SubscriptionProcessor after all subscriptions start.\nready: triggered from the Orchestrator when it reaches its target state. This seemed to be the most appropriate place for it because it will trigger the event after StorageObserver starts (when no API is configured) or after all the remote sync processes start (if API is configured)\nnetworkStatus: Triggered when the DataStore plugin receives a Hub event on the API channel indicating network connectivity changes (more below).\n\nIn order to trigger a meaningful networkStatus event from DataStore, I'm leveraging connectivity events triggered by the OkHttpClient. This is done by implementing an EventListener and triggering a HubEvent on the API channel when the listener changes status.\nIt might make sense to look at the changes by module in the following order:\n\ncore\napi\ndatastore\n\nBy submitting this pull request, I confirm that my contribution is made under the terms of the Apache 2.0 license.", "createdAt": "2020-08-11T16:41:10Z", "url": "https://github.com/aws-amplify/amplify-android/pull/716", "merged": true, "mergeCommit": {"oid": "4a8f1f043d8f50172c4acc4766436cd922d8d08f"}, "closed": true, "closedAt": "2020-08-14T20:12:10Z", "author": {"login": "rjuliano"}, "timelineItems": {"totalCount": 26, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc9oyGJgH2gAyNDY2MjIzOTkzOjlmYjQ5ZGU4ZDk3MGJlOTA0NmJjNmJlNjJmNThjOTY1Yzg2NzJiMzk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc-6XTYAFqTQ2Nzg0NzY0MQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "9fb49de8d970be9046bc6be62f58c965c8672b39", "author": {"user": {"login": "rjuliano", "name": "Rafael Juliano"}}, "url": "https://github.com/aws-amplify/amplify-android/commit/9fb49de8d970be9046bc6be62f58c965c8672b39", "committedDate": "2020-08-10T21:06:23Z", "message": "DataStore ready and subscriptionsEstablished events"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b076c8159941dbe59ecde01ade7c78e5063a785d", "author": {"user": {"login": "rjuliano", "name": "Rafael Juliano"}}, "url": "https://github.com/aws-amplify/amplify-android/commit/b076c8159941dbe59ecde01ade7c78e5063a785d", "committedDate": "2020-08-11T01:27:42Z", "message": "Merge branch 'main' into rjuliano/ds-net-hub-events"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3a20c2e049bb37378fdca950e0722becd44303cd", "author": {"user": {"login": "rjuliano", "name": "Rafael Juliano"}}, "url": "https://github.com/aws-amplify/amplify-android/commit/3a20c2e049bb37378fdca950e0722becd44303cd", "committedDate": "2020-08-11T16:25:46Z", "message": "Added networkStatus event"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "59da7325267e20ce9d091e2423c3a5828ab716d1", "author": {"user": {"login": "rjuliano", "name": "Rafael Juliano"}}, "url": "https://github.com/aws-amplify/amplify-android/commit/59da7325267e20ce9d091e2423c3a5828ab716d1", "committedDate": "2020-08-11T17:33:33Z", "message": "Adding basic tests for event objects"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY1NjQ1NjQw", "url": "https://github.com/aws-amplify/amplify-android/pull/716#pullrequestreview-465645640", "createdAt": "2020-08-12T07:11:23Z", "commit": {"oid": "59da7325267e20ce9d091e2423c3a5828ab716d1"}, "state": "COMMENTED", "comments": {"totalCount": 13, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMlQwNzoxMToyNFrOG_UnQg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMlQwNzo0MTozOVrOG_VkOQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTA1MTIwMg==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                private final class ApiConnectionEventListener extends EventListener {\n          \n          \n            \n                private static final class ApiConnectionEventListener extends EventListener {", "url": "https://github.com/aws-amplify/amplify-android/pull/716#discussion_r469051202", "createdAt": "2020-08-12T07:11:24Z", "author": {"login": "jamesonwilliams"}, "path": "aws-api/src/main/java/com/amplifyframework/api/aws/AWSApiPlugin.java", "diffHunk": "@@ -732,4 +748,43 @@ public int hashCode() {\n             return result;\n         }\n     }\n+\n+    /**\n+     * This class implements OkHttp's {@link EventListener}. Its main purpose\n+     * is to listen to network-related events reported by the http client and trigger\n+     * a Hub event if necessary.\n+     */\n+    private final class ApiConnectionEventListener extends EventListener {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "59da7325267e20ce9d091e2423c3a5828ab716d1"}, "originalPosition": 69}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTA1MTI4Mw==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    private AtomicReference<ApiEndpointStatus> currentNetworkStatus;\n          \n          \n            \n                    private final AtomicReference<ApiEndpointStatus> currentNetworkStatus;", "url": "https://github.com/aws-amplify/amplify-android/pull/716#discussion_r469051283", "createdAt": "2020-08-12T07:11:34Z", "author": {"login": "jamesonwilliams"}, "path": "aws-api/src/main/java/com/amplifyframework/api/aws/AWSApiPlugin.java", "diffHunk": "@@ -732,4 +748,43 @@ public int hashCode() {\n             return result;\n         }\n     }\n+\n+    /**\n+     * This class implements OkHttp's {@link EventListener}. Its main purpose\n+     * is to listen to network-related events reported by the http client and trigger\n+     * a Hub event if necessary.\n+     */\n+    private final class ApiConnectionEventListener extends EventListener {\n+        private AtomicReference<ApiEndpointStatus> currentNetworkStatus;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "59da7325267e20ce9d091e2423c3a5828ab716d1"}, "originalPosition": 70}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTA1MTk4OA==", "bodyText": "You call currentNetworkStatus.get() twice here, without any synchronization guards, it appears. What happens if the value changes between the two calls?\n\nDo you need to add syncrhonization primitives?\nYou can defend by making one .get(), caching the result, and then using the cached result in both locations.", "url": "https://github.com/aws-amplify/amplify-android/pull/716#discussion_r469051988", "createdAt": "2020-08-12T07:13:00Z", "author": {"login": "jamesonwilliams"}, "path": "aws-api/src/main/java/com/amplifyframework/api/aws/AWSApiPlugin.java", "diffHunk": "@@ -732,4 +748,43 @@ public int hashCode() {\n             return result;\n         }\n     }\n+\n+    /**\n+     * This class implements OkHttp's {@link EventListener}. Its main purpose\n+     * is to listen to network-related events reported by the http client and trigger\n+     * a Hub event if necessary.\n+     */\n+    private final class ApiConnectionEventListener extends EventListener {\n+        private AtomicReference<ApiEndpointStatus> currentNetworkStatus;\n+\n+        ApiConnectionEventListener() {\n+            currentNetworkStatus = new AtomicReference<>(ApiEndpointStatus.UNKOWN);\n+        }\n+\n+        @Override\n+        public void connectFailed(@NotNull Call call,\n+                                  @NotNull InetSocketAddress inetSocketAddress,\n+                                  @NotNull Proxy proxy,\n+                                  @Nullable Protocol protocol,\n+                                  @NotNull IOException ioe) {\n+            super.connectFailed(call, inetSocketAddress, proxy, protocol, ioe);\n+            triggerEventIfStatusChanged(currentNetworkStatus.getAndSet(ApiEndpointStatus.NOT_REACHABLE));\n+        }\n+\n+        @Override\n+        public void connectionAcquired(@NotNull Call call, @NotNull Connection connection) {\n+            super.connectionAcquired(call, connection);\n+            triggerEventIfStatusChanged(currentNetworkStatus.getAndSet(ApiEndpointStatus.REACHABLE));\n+        }\n+\n+        private void triggerEventIfStatusChanged(@NonNull ApiEndpointStatus previousStatus) {\n+            if (!previousStatus.equals(currentNetworkStatus.get())) {\n+                ApiEndpointStatusChangeEvent eventData =\n+                    new ApiEndpointStatusChangeEvent(currentNetworkStatus.get(), previousStatus);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "59da7325267e20ce9d091e2423c3a5828ab716d1"}, "originalPosition": 95}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTA1MzA4NQ==", "bodyText": "In a microservice I did a couple years back, I found a pattern where you can add behaviors to an enum. In that case, I would do like Metrics.SOME_SERVICE_CRAP_HAPPENED.report().\nBut, you could use a similar mechanism here, potentially. Maybe something like:\nApiEndpointStatus.UNKNOWN.announce();\nAnd then have the hub broadcast logic contained inside the enum itself.", "url": "https://github.com/aws-amplify/amplify-android/pull/716#discussion_r469053085", "createdAt": "2020-08-12T07:15:10Z", "author": {"login": "jamesonwilliams"}, "path": "aws-api/src/main/java/com/amplifyframework/api/aws/AWSApiPlugin.java", "diffHunk": "@@ -732,4 +748,43 @@ public int hashCode() {\n             return result;\n         }\n     }\n+\n+    /**", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "59da7325267e20ce9d091e2423c3a5828ab716d1"}, "originalPosition": 64}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTA1NDU4MA==", "bodyText": "I used to have a convenient method on the HubAccumulator that allowed you to just get the first one. like takeOne(), it was called. Should we include an awaitFirst() to simplify the List return type? Maybe not. Just sayin'.", "url": "https://github.com/aws-amplify/amplify-android/pull/716#discussion_r469054580", "createdAt": "2020-08-12T07:18:09Z", "author": {"login": "jamesonwilliams"}, "path": "aws-api/src/test/java/com/amplifyframework/api/aws/AWSApiPluginTest.java", "diffHunk": "@@ -246,6 +255,13 @@ public void graphQlMutationGetsResponse() throws JSONException, ApiException {\n \n         // Assert that the expected response was received\n         assertEquals(expectedName, actualResponse.getData().getName());\n+\n+        // Verify that the expected hub event fired.\n+        List<HubEvent<?>> events = networkStatusObserver.await();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "59da7325267e20ce9d091e2423c3a5828ab716d1"}, "originalPosition": 49}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTA1Njc0NQ==", "bodyText": "Aha!\nWe have this unfortunate situation with Hub right now, where we have to cast the data type.\nI wonder if instead we can include a factory on the event structure, like:\nApiEndpointStatusChangedEvent event = ApiEndpointStatusChangedEvent.fromEvent(events.get(0));\nOr, very similar:\nApiEndpointStatuChangedEvent event = ApiEndpointStatusChangedEvent.from(events.get(0).getData());\nThis would at least pull the cast into our own code where we can do it safely, without the customer needing to worry about it.\nImpl might start off looking like an equals(....) almost:\npublic static ApiEndpointStatusChangedEvent from(Object someBlob) {\n    if (!(someBlob instanceof ApiEndpointStatuChangedEvent)) {\n        throw BadNewsBearsError(\"Shucks!\");\n    }\n    ... etc. validate fields,\n    return new ApiEndpointStatusChangeEvent(..., ...);\n}", "url": "https://github.com/aws-amplify/amplify-android/pull/716#discussion_r469056745", "createdAt": "2020-08-12T07:22:21Z", "author": {"login": "jamesonwilliams"}, "path": "aws-api/src/test/java/com/amplifyframework/api/aws/AWSApiPluginTest.java", "diffHunk": "@@ -246,6 +255,13 @@ public void graphQlMutationGetsResponse() throws JSONException, ApiException {\n \n         // Assert that the expected response was received\n         assertEquals(expectedName, actualResponse.getData().getName());\n+\n+        // Verify that the expected hub event fired.\n+        List<HubEvent<?>> events = networkStatusObserver.await();\n+        assertTrue(events.size() > 0);\n+        assertTrue(events.get(0).getData() instanceof ApiEndpointStatusChangeEvent);\n+        ApiEndpointStatusChangeEvent eventData = (ApiEndpointStatusChangeEvent) events.get(0).getData();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "59da7325267e20ce9d091e2423c3a5828ab716d1"}, "originalPosition": 52}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTA1NzkyNA==", "bodyText": "Can you shuffle this off to a helper class, and then do a thin integration to the plugin with like\nNetworkStatusMonitor.enable();\n\nOr something like that?\nAlso, does this need to be int the constructor? Or could it go down into the configure(...) or initialize(...) hooks? Which is the most appropriate lifecycle hook for this?", "url": "https://github.com/aws-amplify/amplify-android/pull/716#discussion_r469057924", "createdAt": "2020-08-12T07:24:40Z", "author": {"login": "jamesonwilliams"}, "path": "aws-datastore/src/main/java/com/amplifyframework/datastore/AWSDataStorePlugin.java", "diffHunk": "@@ -98,6 +103,20 @@ private AWSDataStorePlugin(\n             () -> api.getPlugins().isEmpty() ? Orchestrator.Mode.LOCAL_ONLY : Orchestrator.Mode.SYNC_VIA_API\n         );\n         this.userProvidedConfiguration = userProvidedConfiguration;\n+\n+        // Listen for API_ENDPOINT_STATUS_CHANGED to be emitted by the API and trigger\n+        // the DataStore NETWORK_STATUS event accordingly.\n+        Amplify.Hub.subscribe(HubChannel.API, hubEvent -> {\n+            return ApiChannelEventName.API_ENDPOINT_STATUS_CHANGED.name().equals(hubEvent.getName());\n+        }, hubEvent -> {\n+                if (hubEvent.getData() instanceof ApiEndpointStatusChangeEvent) {\n+                    ApiEndpointStatusChangeEvent eventData = (ApiEndpointStatusChangeEvent) hubEvent.getData();\n+                    boolean isActive = ApiEndpointStatus.REACHABLE.equals(eventData.getCurrentStatus());\n+                    Amplify.Hub.publish(HubChannel.DATASTORE,\n+                        HubEvent.create(DataStoreChannelEventName.NETWORK_STATUS, new NetworkStatusEvent(isActive))\n+                    );\n+                }\n+            });", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "59da7325267e20ce9d091e2423c3a5828ab716d1"}, "originalPosition": 42}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTA2MzAzOA==", "bodyText": "You've got a mechanism repeated four times -- it's a signal to make it a data problem, instead:\nList<DataStoreChannelEventName> expectedEventNames = Arrays.asList(\n    DataStoreChannelEventName.REMOTE_SYNC_STARTED,\n    DataStoreChannelEventName.READY,\n    DataStoreChannelEventName.SUBSCRIPTIONS_ESTABLISHED,\n    DataStoreChannelEventName.NETWORK_STATUS\n);\nMap<DataStoreChannelEventName, HubAccumulator> accums = new HashMap<>();\nfor (DataStoreChannelEventName eventName : eventNames) {\n    HubAccumulator accum = HubAccumulator.create(HubChannel.STORAGE, eventName, 1);\n    accums.add(accum);\n    accum.start();\n}\nOr actually -- for extra credit, we could make a MultipleHubAccumulator utility, to get some of this boilerplate out of the test class itself.\nIt could accept a  LinkedHashMap (to mandate and ordering in which to call await(). And have a usage pattenr like this:\n// It's like a list of events, in order. Allows duplicates by Integer value > 1\n// HubEvent1 --> 1 time\n// HubEvent2 --> 1 time\n// HubEvent1 --> 5 times\n// etc.\nLinkedHashMap<HubEvent<?>, Integer> tape = new LinkedHashMap<>();\nMultiHubAccumulator accum = MultiHubAccumulator.create(tape);\n\naccum.start();\n\naccum.await(); // Waits for the entire \"tape\" to play.", "url": "https://github.com/aws-amplify/amplify-android/pull/716#discussion_r469063038", "createdAt": "2020-08-12T07:34:28Z", "author": {"login": "jamesonwilliams"}, "path": "aws-datastore/src/test/java/com/amplifyframework/datastore/AWSDataStorePluginTest.java", "diffHunk": "@@ -132,14 +139,27 @@ public void configureAndInitializeInApiMode() throws JSONException, AmplifyExcep\n         HubAccumulator orchestratorInitObserver =\n             HubAccumulator.create(HubChannel.DATASTORE, DataStoreChannelEventName.REMOTE_SYNC_STARTED, 1)\n                 .start();\n+        HubAccumulator dataStoreReadyObserver =\n+            HubAccumulator.create(HubChannel.DATASTORE, DataStoreChannelEventName.READY, 1)\n+                .start();\n+        HubAccumulator subscriptionsEstablishedObserver =\n+            HubAccumulator.create(HubChannel.DATASTORE, DataStoreChannelEventName.SUBSCRIPTIONS_ESTABLISHED, 1)\n+                .start();\n+        HubAccumulator networkStatusObserver =\n+            HubAccumulator.create(HubChannel.DATASTORE, DataStoreChannelEventName.NETWORK_STATUS, 1)\n+                .start();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "59da7325267e20ce9d091e2423c3a5828ab716d1"}, "originalPosition": 42}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTA2NDEwMQ==", "bodyText": "You could play a game here like:\nApiEndpointStatuChangeEvent eventData =\n    ApiEndpointStatus.REACHABLE.changeTo(ApiEndpiontStatus.UNKNOWN);\nBasically, add afactory method to the enum, that has the ability to generate the change events. It knows the \"from\" based on what is being invoked, and it knows the \"to\", if we pass that as an argument.", "url": "https://github.com/aws-amplify/amplify-android/pull/716#discussion_r469064101", "createdAt": "2020-08-12T07:36:28Z", "author": {"login": "jamesonwilliams"}, "path": "aws-datastore/src/test/java/com/amplifyframework/datastore/AWSDataStorePluginTest.java", "diffHunk": "@@ -306,8 +326,16 @@ private ApiCategory mockApiCategoryWithGraphQlApi() throws AmplifyException {\n         when(mockApiPlugin.getPluginKey()).thenReturn(MOCK_API_PLUGIN_NAME);\n         when(mockApiPlugin.getCategoryType()).thenReturn(CategoryType.API);\n \n+        ApiEndpointStatusChangeEvent eventData =\n+            new ApiEndpointStatusChangeEvent(ApiEndpointStatusChangeEvent.ApiEndpointStatus.REACHABLE,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "59da7325267e20ce9d091e2423c3a5828ab716d1"}, "originalPosition": 63}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTA2NDQ2NA==", "bodyText": "What kinds of status changes are these? Like, we are able to reach it or not?", "url": "https://github.com/aws-amplify/amplify-android/pull/716#discussion_r469064464", "createdAt": "2020-08-12T07:37:11Z", "author": {"login": "jamesonwilliams"}, "path": "core/src/main/java/com/amplifyframework/api/ApiChannelEventName.java", "diffHunk": "@@ -0,0 +1,32 @@\n+/*\n+ * Copyright 2020 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *  http://aws.amazon.com/apache2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ * permissions and limitations under the License.\n+ */\n+\n+package com.amplifyframework.api;\n+\n+import com.amplifyframework.hub.HubCategory;\n+import com.amplifyframework.hub.HubChannel;\n+import com.amplifyframework.hub.HubEvent;\n+\n+/**\n+ * An enumeration of the names of events relating the the {@link ApiCategory},\n+ * that are published via {@link HubCategory#publish(HubChannel, HubEvent)} on the\n+ * {@link HubChannel#API} channel.\n+ */\n+public enum ApiChannelEventName {\n+    /**\n+     * The status of the remote API endpoint has changed.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "59da7325267e20ce9d091e2423c3a5828ab716d1"}, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTA2NDgxMw==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                 * Notifies if the network is active or not.\n          \n          \n            \n                 * Indicates that the network is active or not.", "url": "https://github.com/aws-amplify/amplify-android/pull/716#discussion_r469064813", "createdAt": "2020-08-12T07:37:52Z", "author": {"login": "jamesonwilliams"}, "path": "core/src/main/java/com/amplifyframework/datastore/DataStoreChannelEventName.java", "diffHunk": "@@ -52,7 +52,23 @@\n     /**\n      * The remote synchonization processes stopped.\n      */\n-    REMOTE_SYNC_STOPPED(\"remote_sync_stopped\");\n+    REMOTE_SYNC_STOPPED(\"remote_sync_stopped\"),\n+\n+    /**\n+     * Notifies if the network is active or not.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "59da7325267e20ce9d091e2423c3a5828ab716d1"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTA2NTE3Mw==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    int result = Boolean.valueOf(active).hashCode();\n          \n          \n            \n                    return result;\n          \n          \n            \n                    return Boolean.valueOf(active).hashCode();", "url": "https://github.com/aws-amplify/amplify-android/pull/716#discussion_r469065173", "createdAt": "2020-08-12T07:38:34Z", "author": {"login": "jamesonwilliams"}, "path": "core/src/main/java/com/amplifyframework/datastore/events/NetworkStatusEvent.java", "diffHunk": "@@ -0,0 +1,68 @@\n+/*\n+ * Copyright 2020 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *  http://aws.amazon.com/apache2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ * permissions and limitations under the License.\n+ */\n+\n+package com.amplifyframework.datastore.events;\n+\n+import androidx.annotation.NonNull;\n+import androidx.annotation.Nullable;\n+import androidx.core.util.ObjectsCompat;\n+\n+/**\n+ * Event payload for the {@link com.amplifyframework.datastore.DataStoreChannelEventName#NETWORK_STATUS} event.\n+ */\n+public final class NetworkStatusEvent {\n+    private final boolean active;\n+\n+    /**\n+     * Constructs a {@link NetworkStatusEvent} object.\n+     * @param isActive True if connection is active, false otherwise.\n+     */\n+    public NetworkStatusEvent(boolean isActive) {\n+        this.active = isActive;\n+    }\n+\n+    /**\n+     * Getter for the active field.\n+     * @return The value of the active field.\n+     */\n+    public boolean getActive() {\n+        return active;\n+    }\n+\n+    @Override\n+    public int hashCode() {\n+        int result = Boolean.valueOf(active).hashCode();\n+        return result;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "59da7325267e20ce9d091e2423c3a5828ab716d1"}, "originalPosition": 47}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTA2NjgwOQ==", "bodyText": "Personally I agree with you that these are useful types of tests. However, I recently changed how I do this test, of the hashCode(). Rarely will anyone ever call hashCode(). Perhaps they will if they are writing their own, higher level hashCode(), and include one of these types in it. But more often, they'll probably try to use it in a collection. So like:\nPossibleSaneHashObject one = new PossiblySaneHashObject();\nPossibleSaneHashObject two = new PossiblySaneHashObject();\nSet<PossiblySaneHashObject> set = new HashSet<>();\nset.add(one);\nset.add(two);\nassertEquals(1, set.size());\nThis is straight-up pedantry at this point, feel free to ignore \ud83d\ude06", "url": "https://github.com/aws-amplify/amplify-android/pull/716#discussion_r469066809", "createdAt": "2020-08-12T07:41:39Z", "author": {"login": "jamesonwilliams"}, "path": "core/src/test/java/com/amplifyframework/hub/HubEventDataObjectsTest.java", "diffHunk": "@@ -0,0 +1,78 @@\n+/*\n+ * Copyright 2020 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *  http://aws.amazon.com/apache2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ * permissions and limitations under the License.\n+ */\n+\n+package com.amplifyframework.hub;\n+\n+import com.amplifyframework.api.events.ApiEndpointStatusChangeEvent;\n+import com.amplifyframework.api.events.ApiEndpointStatusChangeEvent.ApiEndpointStatus;\n+import com.amplifyframework.datastore.events.NetworkStatusEvent;\n+\n+import org.junit.Test;\n+import org.junit.runner.RunWith;\n+import org.robolectric.RobolectricTestRunner;\n+\n+import static org.junit.Assert.assertEquals;\n+import static org.junit.Assert.assertFalse;\n+import static org.junit.Assert.assertNotEquals;\n+\n+/**\n+ * Test basic operations of objects used as Hub event payloads.\n+ */\n+@RunWith(RobolectricTestRunner.class)\n+public class HubEventDataObjectsTest {\n+\n+    /**\n+     * Verify {@link NetworkStatusEvent} behavior.\n+     */\n+    @Test\n+    public void verifyNetworkStatus() {\n+        NetworkStatusEvent status1 = new NetworkStatusEvent(true);\n+        NetworkStatusEvent status2 = new NetworkStatusEvent(false);\n+        NetworkStatusEvent status3 = new NetworkStatusEvent(true);\n+\n+        assertNotEquals(status1, status2);\n+        assertEquals(status1, status3);\n+\n+        assertNotEquals(status1.hashCode(), status2.hashCode());\n+        assertEquals(status1.hashCode(), status3.hashCode());\n+        assertFalse(status1 == status3);\n+\n+        assertNotEquals(status1.toString(), status2.toString());\n+        assertEquals(status1.toString(), status3.toString());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "59da7325267e20ce9d091e2423c3a5828ab716d1"}, "originalPosition": 53}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "88b1384d7a5db652c58ec4fdba1766d4bce0b5ff", "author": {"user": {"login": "rjuliano", "name": "Rafael Juliano"}}, "url": "https://github.com/aws-amplify/amplify-android/commit/88b1384d7a5db652c58ec4fdba1766d4bce0b5ff", "committedDate": "2020-08-12T12:05:47Z", "message": "Merge remote-tracking branch 'origin/main' into rjuliano/ds-net-hub-events"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "72b83176061c43e9a168f1f7081206a490c9e4b3", "author": {"user": {"login": "rjuliano", "name": "Rafael Juliano"}}, "url": "https://github.com/aws-amplify/amplify-android/commit/72b83176061c43e9a168f1f7081206a490c9e4b3", "committedDate": "2020-08-12T13:17:13Z", "message": "Apply suggestions from code review\n\nCo-authored-by: Jameson Williams <jhwill@amazon.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ce4b1bee8a0978224bfeb8a40c7e5f2be9da0408", "author": {"user": {"login": "rjuliano", "name": "Rafael Juliano"}}, "url": "https://github.com/aws-amplify/amplify-android/commit/ce4b1bee8a0978224bfeb8a40c7e5f2be9da0408", "committedDate": "2020-08-12T15:58:02Z", "message": "Add method to publish msg from ApiEndpointStatus"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8d9042c52441f6ecbf8df8619731246ac86738b0", "author": {"user": {"login": "rjuliano", "name": "Rafael Juliano"}}, "url": "https://github.com/aws-amplify/amplify-android/commit/8d9042c52441f6ecbf8df8619731246ac86738b0", "committedDate": "2020-08-12T19:17:34Z", "message": "Added awaitFirst API to accumulator"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "37438d4083eea977fc62805b1b2d72fc4e476fac", "author": {"user": {"login": "rjuliano", "name": "Rafael Juliano"}}, "url": "https://github.com/aws-amplify/amplify-android/commit/37438d4083eea977fc62805b1b2d72fc4e476fac", "committedDate": "2020-08-12T19:55:46Z", "message": "Cleaned up event object tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "abbd32ebb3150e09c4c0388133252cd1ab9096c5", "author": {"user": {"login": "rjuliano", "name": "Rafael Juliano"}}, "url": "https://github.com/aws-amplify/amplify-android/commit/abbd32ebb3150e09c4c0388133252cd1ab9096c5", "committedDate": "2020-08-12T20:07:19Z", "message": "Created ObjectValidatorUtils"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ff58aa28345f7addc94ce508df79a6d214d3ae91", "author": {"user": {"login": "rjuliano", "name": "Rafael Juliano"}}, "url": "https://github.com/aws-amplify/amplify-android/commit/ff58aa28345f7addc94ce508df79a6d214d3ae91", "committedDate": "2020-08-12T20:24:10Z", "message": "Update javadoc for API_ENDPOINT_STATUS_CHANGED"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY2MzI5NTM0", "url": "https://github.com/aws-amplify/amplify-android/pull/716#pullrequestreview-466329534", "createdAt": "2020-08-12T22:51:50Z", "commit": {"oid": "ff58aa28345f7addc94ce508df79a6d214d3ae91"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMlQyMjo1MTo1MFrOG_1iAw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMlQyMjo1MTo1MFrOG_1iAw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTU5MDUzMQ==", "bodyText": "Oops, we want the androidx one here, I believe.\nOkHttp uses the JetBrains annotations on its APIs, and so this probably got added when you implemented an OkHttp interface, right?\nFor better or worse, I have been swapping such annotations, as I encounter them, into the AndroidX ones.\nOkHttp is itself a vanilla Java library, so they can't depend on the AndroidX annotations.\nI feel emotionally that these annotations ought to have better support for Android Studio / Android Lint / Kotlin interop. However, I don't know it any scientifically backed objective way. \ud83d\ude06", "url": "https://github.com/aws-amplify/amplify-android/pull/716#discussion_r469590531", "createdAt": "2020-08-12T22:51:50Z", "author": {"login": "jamesonwilliams"}, "path": "aws-api/src/main/java/com/amplifyframework/api/aws/AWSApiPlugin.java", "diffHunk": "@@ -44,8 +45,12 @@\n import com.amplifyframework.core.model.ModelOperation;\n import com.amplifyframework.util.UserAgent;\n \n+import org.jetbrains.annotations.NotNull;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ff58aa28345f7addc94ce508df79a6d214d3ae91"}, "originalPosition": 12}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY2MzMwODA0", "url": "https://github.com/aws-amplify/amplify-android/pull/716#pullrequestreview-466330804", "createdAt": "2020-08-12T22:55:11Z", "commit": {"oid": "ff58aa28345f7addc94ce508df79a6d214d3ae91"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMlQyMjo1NToxMVrOG_1mrQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMlQyMjo1OTo1MlrOG_1sqQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTU5MTcyNQ==", "bodyText": "I was hoping we could just reuse the latch -- is it possible? I don't think it makes sense to have multiple ones.", "url": "https://github.com/aws-amplify/amplify-android/pull/716#discussion_r469591725", "createdAt": "2020-08-12T22:55:11Z", "author": {"login": "jamesonwilliams"}, "path": "testutils/src/main/java/com/amplifyframework/testutils/HubAccumulator.java", "diffHunk": "@@ -44,12 +44,14 @@\n     private final long quantity;\n     private final CopyOnWriteArrayList<HubEvent<?>> events;\n     private final AtomicReference<SubscriptionToken> token;\n+    private final CountDownLatch firstItemLatch;\n \n     private HubAccumulator(\n             @NonNull HubChannel channel, @NonNull HubEventFilter filter, int quantity) {\n         this.channel = channel;\n         this.filter = filter;\n         this.latch = new CountDownLatch(quantity);\n+        this.firstItemLatch = new CountDownLatch(1);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ff58aa28345f7addc94ce508df79a6d214d3ae91"}, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTU5MjkxMg==", "bodyText": "Okay, cool. This looks like a good general purpose testutil.\nGripes about naming (classic jhwill@):\n\nLet's drop the Utils\nFrom the method it contains, maybe EqualsToStringHashValidator is a reasonable name? It's kinda long, but it's very clear and narrow in its utility:", "url": "https://github.com/aws-amplify/amplify-android/pull/716#discussion_r469592912", "createdAt": "2020-08-12T22:58:47Z", "author": {"login": "jamesonwilliams"}, "path": "testutils/src/main/java/com/amplifyframework/testutils/ObjectValidatorUtils.java", "diffHunk": "@@ -0,0 +1,67 @@\n+/*\n+ * Copyright 2020 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *  http://aws.amazon.com/apache2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ * permissions and limitations under the License.\n+ */\n+\n+package com.amplifyframework.testutils;\n+\n+import org.junit.Assert;\n+\n+import java.util.HashSet;\n+import java.util.Set;\n+\n+/**\n+ * Utility class that can be used to test core\n+ * Object behavior of a class that implements its own\n+ * equals, hashCode and toString methods.\n+ */\n+public final class ObjectValidatorUtils {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ff58aa28345f7addc94ce508df79a6d214d3ae91"}, "originalPosition": 28}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTU5MzI1Nw==", "bodyText": "Assuming this is contained EqualsToStringHashValidator, then maybe:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                public static <T> void assertCoreObjectBehavior(T subject1, T suject2, T subject3ThatEqualsSubject1) {\n          \n          \n            \n                public static <T> void validate(T reference, T equalsReference, T notEqualsReference) {", "url": "https://github.com/aws-amplify/amplify-android/pull/716#discussion_r469593257", "createdAt": "2020-08-12T22:59:52Z", "author": {"login": "jamesonwilliams"}, "path": "testutils/src/main/java/com/amplifyframework/testutils/ObjectValidatorUtils.java", "diffHunk": "@@ -0,0 +1,67 @@\n+/*\n+ * Copyright 2020 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *  http://aws.amazon.com/apache2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ * permissions and limitations under the License.\n+ */\n+\n+package com.amplifyframework.testutils;\n+\n+import org.junit.Assert;\n+\n+import java.util.HashSet;\n+import java.util.Set;\n+\n+/**\n+ * Utility class that can be used to test core\n+ * Object behavior of a class that implements its own\n+ * equals, hashCode and toString methods.\n+ */\n+public final class ObjectValidatorUtils {\n+\n+    /**\n+     * Hidding default constructor of utility class.\n+     */\n+    private ObjectValidatorUtils() {}\n+\n+    /**\n+     * Function to make some basic assertions as it related to the\n+     * proper implementation of equals, hashCode and toString.\n+     * @param subject1 An instance of T\n+     * @param suject2 An instance of T that is not equal to subject1.\n+     * @param subject3ThatEqualsSubject1 An instance of T such that when passed as\n+     *                                   a parameter to subject1.equals, will return true.\n+     * @param <T> The type being tested.\n+     */\n+    public static <T> void assertCoreObjectBehavior(T subject1, T suject2, T subject3ThatEqualsSubject1) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ff58aa28345f7addc94ce508df79a6d214d3ae91"}, "originalPosition": 44}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f9a451b13a0b30496eb455feb0c322edb94fd518", "author": {"user": {"login": "rjuliano", "name": "Rafael Juliano"}}, "url": "https://github.com/aws-amplify/amplify-android/commit/f9a451b13a0b30496eb455feb0c322edb94fd518", "committedDate": "2020-08-12T23:42:57Z", "message": "Renamed util class"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3fd8eba32c304c532e46827b2d7a33aedfa3d0d1", "author": {"user": {"login": "rjuliano", "name": "Rafael Juliano"}}, "url": "https://github.com/aws-amplify/amplify-android/commit/3fd8eba32c304c532e46827b2d7a33aedfa3d0d1", "committedDate": "2020-08-13T19:13:28Z", "message": "Refactored event types"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "173dafabcad5c45b4ab73fe577707eb4941bfa7f", "author": {"user": {"login": "rjuliano", "name": "Rafael Juliano"}}, "url": "https://github.com/aws-amplify/amplify-android/commit/173dafabcad5c45b4ab73fe577707eb4941bfa7f", "committedDate": "2020-08-13T19:32:50Z", "message": "Moved monitoring logic into a method"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "82225bf6b859996783e9dd41c7344f12c1c22ad2", "author": {"user": {"login": "rjuliano", "name": "Rafael Juliano"}}, "url": "https://github.com/aws-amplify/amplify-android/commit/82225bf6b859996783e9dd41c7344f12c1c22ad2", "committedDate": "2020-08-13T19:46:02Z", "message": "Remove separate latch for awaitFirst"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e15206e7b4e498fd100a2cd001f1d9d8cfec718c", "author": {"user": {"login": "rjuliano", "name": "Rafael Juliano"}}, "url": "https://github.com/aws-amplify/amplify-android/commit/e15206e7b4e498fd100a2cd001f1d9d8cfec718c", "committedDate": "2020-08-13T19:49:05Z", "message": "Remove references to NotNull annotation"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY3MjU5MTc4", "url": "https://github.com/aws-amplify/amplify-android/pull/716#pullrequestreview-467259178", "createdAt": "2020-08-14T01:49:38Z", "commit": {"oid": "e15206e7b4e498fd100a2cd001f1d9d8cfec718c"}, "state": "APPROVED", "comments": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xNFQwMTo0OTozOFrOHAk66w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xNFQwMTo1NDo1MFrOHAk_qA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDM2Njk1NQ==", "bodyText": "We have full liberty to add a new publish(...) method, if you would like to, as well!\nMaybe like:\n<E extends Enum<E>> void publish(HubChannel channel, Enum<E> eventName) {\n    publish(channel, HubEvent.create(eventName));\n}\nA small optimization to reduce some boiler plate. I've already baked in some Enum<E> type mumbo-jumbo elsewhere around the Hub APIs.", "url": "https://github.com/aws-amplify/amplify-android/pull/716#discussion_r470366955", "createdAt": "2020-08-14T01:49:38Z", "author": {"login": "jamesonwilliams"}, "path": "aws-datastore/src/main/java/com/amplifyframework/datastore/syncengine/SubscriptionProcessor.java", "diffHunk": "@@ -119,6 +122,8 @@ synchronized void startSubscriptions() {\n             return;\n         }\n         if (subscriptionsStarted) {\n+            Amplify.Hub.publish(HubChannel.DATASTORE,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e15206e7b4e498fd100a2cd001f1d9d8cfec718c"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDM2NzExOA==", "bodyText": "Should this go into api.events?", "url": "https://github.com/aws-amplify/amplify-android/pull/716#discussion_r470367118", "createdAt": "2020-08-14T01:50:20Z", "author": {"login": "jamesonwilliams"}, "path": "core/src/main/java/com/amplifyframework/api/ApiChannelEventName.java", "diffHunk": "@@ -0,0 +1,38 @@\n+/*\n+ * Copyright 2020 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *  http://aws.amazon.com/apache2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ * permissions and limitations under the License.\n+ */\n+\n+package com.amplifyframework.api;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e15206e7b4e498fd100a2cd001f1d9d8cfec718c"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDM2NzIzNg==", "bodyText": "Ooooooh :-D", "url": "https://github.com/aws-amplify/amplify-android/pull/716#discussion_r470367236", "createdAt": "2020-08-14T01:50:50Z", "author": {"login": "jamesonwilliams"}, "path": "core/src/main/java/com/amplifyframework/api/events/ApiEndpointStatusChangeEvent.java", "diffHunk": "@@ -0,0 +1,144 @@\n+/*\n+ * Copyright 2020 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *  http://aws.amazon.com/apache2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ * permissions and limitations under the License.\n+ */\n+\n+package com.amplifyframework.api.events;\n+\n+import androidx.annotation.NonNull;\n+import androidx.annotation.Nullable;\n+import androidx.core.util.ObjectsCompat;\n+\n+import com.amplifyframework.AmplifyException;\n+import com.amplifyframework.api.ApiChannelEventName;\n+import com.amplifyframework.hub.HubChannel;\n+import com.amplifyframework.hub.HubEvent;\n+\n+/**\n+ * This class represents the hub event payload for\n+ * {@link com.amplifyframework.api.ApiChannelEventName#API_ENDPOINT_STATUS_CHANGED}.\n+ */\n+public final class ApiEndpointStatusChangeEvent implements HubEvent.Data<ApiEndpointStatusChangeEvent> {\n+    private final ApiEndpointStatus currentStatus;\n+    private final ApiEndpointStatus previousStatus;\n+\n+    /**\n+     * Constructs a new {@link ApiEndpointStatusChangeEvent} object.\n+     * @param currentStatus The current status of the endpoint.\n+     * @param previousStatus the previous status of the endpoint.\n+     */\n+    public ApiEndpointStatusChangeEvent(ApiEndpointStatus currentStatus, ApiEndpointStatus previousStatus) {\n+        this.currentStatus = currentStatus;\n+        this.previousStatus = previousStatus;\n+    }\n+\n+    /**\n+     * Getter that returns the value of the {@link ApiEndpointStatusChangeEvent#currentStatus} field.\n+     * @return The value of {@link ApiEndpointStatusChangeEvent#currentStatus} field.\n+     */\n+    public ApiEndpointStatus getCurrentStatus() {\n+        return currentStatus;\n+    }\n+\n+    /**\n+     * Getter that returns the value of the {@link ApiEndpointStatusChangeEvent#previousStatus} field.\n+     * @return The value of {@link ApiEndpointStatusChangeEvent#previousStatus} field.\n+     */\n+    public ApiEndpointStatus getPreviousStatus() {\n+        return previousStatus;\n+    }\n+\n+    @Override\n+    public int hashCode() {\n+        int result = currentStatus != null ? currentStatus.hashCode() : 0;\n+        result = 31 * result + (previousStatus != null ? previousStatus.hashCode() : 0);\n+        return result;\n+    }\n+\n+    @Override\n+    public boolean equals(@Nullable Object thatObject) {\n+        if (this == thatObject) {\n+            return true;\n+        }\n+        if (thatObject == null || getClass() != thatObject.getClass()) {\n+            return false;\n+        }\n+\n+        ApiEndpointStatusChangeEvent that = (ApiEndpointStatusChangeEvent) thatObject;\n+\n+        if (!ObjectsCompat.equals(currentStatus, that.currentStatus)) {\n+            return false;\n+        }\n+        return ObjectsCompat.equals(previousStatus, that.previousStatus);\n+    }\n+\n+    @NonNull\n+    @Override\n+    public String toString() {\n+        return \"ApiEndpointStatusChangeEvent{\" +\n+            \"currentStatus=\" + currentStatus +\n+            \", previousStatus=\" + previousStatus +\n+            \"}\";\n+    }\n+\n+    @Override\n+    public HubEvent<ApiEndpointStatusChangeEvent> toHubEvent() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e15206e7b4e498fd100a2cd001f1d9d8cfec718c"}, "originalPosition": 95}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDM2NzM0Nw==", "bodyText": "To keep the noise down for the reader, maybe:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    String expectedClassName = ApiEndpointStatusChangeEvent.class.getName();\n          \n          \n            \n                    String expectedClassName = ApiEndpointStatusChangeEvent.class.getSimpleName();\n          \n      \n    \n    \n  \n\n?", "url": "https://github.com/aws-amplify/amplify-android/pull/716#discussion_r470367347", "createdAt": "2020-08-14T01:51:24Z", "author": {"login": "jamesonwilliams"}, "path": "core/src/main/java/com/amplifyframework/api/events/ApiEndpointStatusChangeEvent.java", "diffHunk": "@@ -0,0 +1,144 @@\n+/*\n+ * Copyright 2020 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *  http://aws.amazon.com/apache2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ * permissions and limitations under the License.\n+ */\n+\n+package com.amplifyframework.api.events;\n+\n+import androidx.annotation.NonNull;\n+import androidx.annotation.Nullable;\n+import androidx.core.util.ObjectsCompat;\n+\n+import com.amplifyframework.AmplifyException;\n+import com.amplifyframework.api.ApiChannelEventName;\n+import com.amplifyframework.hub.HubChannel;\n+import com.amplifyframework.hub.HubEvent;\n+\n+/**\n+ * This class represents the hub event payload for\n+ * {@link com.amplifyframework.api.ApiChannelEventName#API_ENDPOINT_STATUS_CHANGED}.\n+ */\n+public final class ApiEndpointStatusChangeEvent implements HubEvent.Data<ApiEndpointStatusChangeEvent> {\n+    private final ApiEndpointStatus currentStatus;\n+    private final ApiEndpointStatus previousStatus;\n+\n+    /**\n+     * Constructs a new {@link ApiEndpointStatusChangeEvent} object.\n+     * @param currentStatus The current status of the endpoint.\n+     * @param previousStatus the previous status of the endpoint.\n+     */\n+    public ApiEndpointStatusChangeEvent(ApiEndpointStatus currentStatus, ApiEndpointStatus previousStatus) {\n+        this.currentStatus = currentStatus;\n+        this.previousStatus = previousStatus;\n+    }\n+\n+    /**\n+     * Getter that returns the value of the {@link ApiEndpointStatusChangeEvent#currentStatus} field.\n+     * @return The value of {@link ApiEndpointStatusChangeEvent#currentStatus} field.\n+     */\n+    public ApiEndpointStatus getCurrentStatus() {\n+        return currentStatus;\n+    }\n+\n+    /**\n+     * Getter that returns the value of the {@link ApiEndpointStatusChangeEvent#previousStatus} field.\n+     * @return The value of {@link ApiEndpointStatusChangeEvent#previousStatus} field.\n+     */\n+    public ApiEndpointStatus getPreviousStatus() {\n+        return previousStatus;\n+    }\n+\n+    @Override\n+    public int hashCode() {\n+        int result = currentStatus != null ? currentStatus.hashCode() : 0;\n+        result = 31 * result + (previousStatus != null ? previousStatus.hashCode() : 0);\n+        return result;\n+    }\n+\n+    @Override\n+    public boolean equals(@Nullable Object thatObject) {\n+        if (this == thatObject) {\n+            return true;\n+        }\n+        if (thatObject == null || getClass() != thatObject.getClass()) {\n+            return false;\n+        }\n+\n+        ApiEndpointStatusChangeEvent that = (ApiEndpointStatusChangeEvent) thatObject;\n+\n+        if (!ObjectsCompat.equals(currentStatus, that.currentStatus)) {\n+            return false;\n+        }\n+        return ObjectsCompat.equals(previousStatus, that.previousStatus);\n+    }\n+\n+    @NonNull\n+    @Override\n+    public String toString() {\n+        return \"ApiEndpointStatusChangeEvent{\" +\n+            \"currentStatus=\" + currentStatus +\n+            \", previousStatus=\" + previousStatus +\n+            \"}\";\n+    }\n+\n+    @Override\n+    public HubEvent<ApiEndpointStatusChangeEvent> toHubEvent() {\n+        return HubEvent.create(ApiChannelEventName.API_ENDPOINT_STATUS_CHANGED, this);\n+    }\n+\n+    /**\n+     * Factory method that attempts to cast the data field of the\n+     * {@link HubEvent} object as an instance of {@link ApiEndpointStatusChangeEvent}.\n+     * @param hubEvent An instance of {@link HubEvent}\n+     * @return An instance of {@link ApiEndpointStatusChangeEvent}.\n+     * @throws AmplifyException If unable to cast to the target type.\n+     */\n+    public static ApiEndpointStatusChangeEvent from(HubEvent<?> hubEvent) throws AmplifyException {\n+        if (hubEvent.getData() instanceof ApiEndpointStatusChangeEvent) {\n+            return (ApiEndpointStatusChangeEvent) hubEvent.getData();\n+        }\n+        String expectedClassName = ApiEndpointStatusChangeEvent.class.getName();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e15206e7b4e498fd100a2cd001f1d9d8cfec718c"}, "originalPosition": 110}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDM2NzQ1MQ==", "bodyText": "ooooh :-D", "url": "https://github.com/aws-amplify/amplify-android/pull/716#discussion_r470367451", "createdAt": "2020-08-14T01:51:49Z", "author": {"login": "jamesonwilliams"}, "path": "core/src/main/java/com/amplifyframework/datastore/events/NetworkStatusEvent.java", "diffHunk": "@@ -0,0 +1,127 @@\n+/*\n+ * Copyright 2020 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *  http://aws.amazon.com/apache2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ * permissions and limitations under the License.\n+ */\n+\n+package com.amplifyframework.datastore.events;\n+\n+import androidx.annotation.NonNull;\n+import androidx.annotation.Nullable;\n+import androidx.core.util.ObjectsCompat;\n+\n+import com.amplifyframework.AmplifyException;\n+import com.amplifyframework.api.ApiChannelEventName;\n+import com.amplifyframework.api.events.ApiEndpointStatusChangeEvent;\n+import com.amplifyframework.api.events.ApiEndpointStatusChangeEvent.ApiEndpointStatus;\n+import com.amplifyframework.core.Amplify;\n+import com.amplifyframework.datastore.DataStoreChannelEventName;\n+import com.amplifyframework.hub.HubChannel;\n+import com.amplifyframework.hub.HubEvent;\n+import com.amplifyframework.logging.Logger;\n+\n+/**\n+ * Event payload for the {@link com.amplifyframework.datastore.DataStoreChannelEventName#NETWORK_STATUS} event.\n+ */\n+public final class NetworkStatusEvent implements HubEvent.Data<NetworkStatusEvent> {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e15206e7b4e498fd100a2cd001f1d9d8cfec718c"}, "originalPosition": 35}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDM2Nzc3OQ==", "bodyText": "Does this belong in the NetworkStatusEvent, or in some external NetworkStatusMontior.start() utility class? I don't feel strongly either way I guess. If push came to shove I think I probably would have written it the second way, but this is also cool, and it is well coupled.", "url": "https://github.com/aws-amplify/amplify-android/pull/716#discussion_r470367779", "createdAt": "2020-08-14T01:53:09Z", "author": {"login": "jamesonwilliams"}, "path": "core/src/main/java/com/amplifyframework/datastore/events/NetworkStatusEvent.java", "diffHunk": "@@ -0,0 +1,127 @@\n+/*\n+ * Copyright 2020 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *  http://aws.amazon.com/apache2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ * permissions and limitations under the License.\n+ */\n+\n+package com.amplifyframework.datastore.events;\n+\n+import androidx.annotation.NonNull;\n+import androidx.annotation.Nullable;\n+import androidx.core.util.ObjectsCompat;\n+\n+import com.amplifyframework.AmplifyException;\n+import com.amplifyframework.api.ApiChannelEventName;\n+import com.amplifyframework.api.events.ApiEndpointStatusChangeEvent;\n+import com.amplifyframework.api.events.ApiEndpointStatusChangeEvent.ApiEndpointStatus;\n+import com.amplifyframework.core.Amplify;\n+import com.amplifyframework.datastore.DataStoreChannelEventName;\n+import com.amplifyframework.hub.HubChannel;\n+import com.amplifyframework.hub.HubEvent;\n+import com.amplifyframework.logging.Logger;\n+\n+/**\n+ * Event payload for the {@link com.amplifyframework.datastore.DataStoreChannelEventName#NETWORK_STATUS} event.\n+ */\n+public final class NetworkStatusEvent implements HubEvent.Data<NetworkStatusEvent> {\n+    private static final Logger LOG = Amplify.Logging.forNamespace(\"amplify:aws-datastore\");\n+    private final boolean active;\n+\n+    /**\n+     * Constructs a {@link NetworkStatusEvent} object.\n+     * @param isActive True if connection is active, false otherwise.\n+     */\n+    public NetworkStatusEvent(boolean isActive) {\n+        this.active = isActive;\n+    }\n+\n+    /**\n+     * Getter for the active field.\n+     * @return The value of the active field.\n+     */\n+    public boolean getActive() {\n+        return active;\n+    }\n+\n+    @Override\n+    public int hashCode() {\n+        return Boolean.valueOf(active).hashCode();\n+    }\n+\n+    @Override\n+    public boolean equals(@Nullable Object thatObject) {\n+        if (this == thatObject) {\n+            return true;\n+        }\n+        if (thatObject == null || getClass() != thatObject.getClass()) {\n+            return false;\n+        }\n+\n+        NetworkStatusEvent that = (NetworkStatusEvent) thatObject;\n+        return ObjectsCompat.equals(active, that.active);\n+    }\n+\n+    @NonNull\n+    @Override\n+    public String toString() {\n+        return \"NetworkStatus{active=\" + active + \"}\";\n+    }\n+\n+    @Override\n+    public HubEvent<NetworkStatusEvent> toHubEvent() {\n+        return HubEvent.create(DataStoreChannelEventName.NETWORK_STATUS, this);\n+    }\n+\n+    /**\n+     * Factory method that attempts to cast the data field of the\n+     * {@link HubEvent} object as an instance of {@link NetworkStatusEvent}.\n+     * @param hubEvent An instance of {@link HubEvent}\n+     * @return An instance of {@link NetworkStatusEvent}.\n+     * @throws AmplifyException If unable to cast to the target type.\n+     */\n+    public static NetworkStatusEvent from(HubEvent<?> hubEvent) throws AmplifyException {\n+        if (!(hubEvent.getData() instanceof NetworkStatusEvent)) {\n+            return (NetworkStatusEvent) hubEvent.getData();\n+        }\n+        String expectedClassName = NetworkStatusEvent.class.getName();\n+        throw new AmplifyException(\"Unable to cast event data from \" + expectedClassName,\n+                                   \"Ensure that the event payload is of type \" + expectedClassName);\n+    }\n+\n+    /**\n+     * Factory method that transforms an instance of\n+     * {@link ApiEndpointStatusChangeEvent} into an instance of {@link NetworkStatusEvent}.\n+     * @param apiEvent An instance of {@link ApiEndpointStatusChangeEvent}\n+     * @return An instance of {@link NetworkStatusEvent}.\n+     */\n+    public static NetworkStatusEvent from(ApiEndpointStatusChangeEvent apiEvent) {\n+        boolean isActive = ApiEndpointStatus.REACHABLE.equals(apiEvent.getCurrentStatus());\n+        return new NetworkStatusEvent(isActive);\n+    }\n+\n+    /**\n+     * Start listening for API_ENDPOINT_STATUS_CHANGED to be emitted by the API and trigger\n+     * the DataStore NETWORK_STATUS event accordingly.\n+     */\n+    public static void monitor() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e15206e7b4e498fd100a2cd001f1d9d8cfec718c"}, "originalPosition": 115}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDM2ODE2OA==", "bodyText": "Eh, I feel iffy about binding Amplifly, here. I like the intention of this utility method though. Could you instead have it like:\npublic void publish(@NonNull HubChannel toChannel, @NonNull HubCategoryBehavior usignHubInstance) {\n    usingHubInstance.publish(channel, this);\n}\n?", "url": "https://github.com/aws-amplify/amplify-android/pull/716#discussion_r470368168", "createdAt": "2020-08-14T01:54:50Z", "author": {"login": "jamesonwilliams"}, "path": "core/src/main/java/com/amplifyframework/hub/HubEvent.java", "diffHunk": "@@ -125,6 +127,14 @@ public UUID getId() {\n         return uuid;\n     }\n \n+    /**\n+     * Publish the instance of the {@link HubEvent} to Amplify Hub.\n+     * @param channel The channel to publish the event to.\n+     */\n+    public void publish(@NonNull HubChannel channel) {\n+        Amplify.Hub.publish(channel, this);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e15206e7b4e498fd100a2cd001f1d9d8cfec718c"}, "originalPosition": 18}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "be348c2f5d7b645643fa394714a4bbfd8ecf488e", "author": {"user": {"login": "rjuliano", "name": "Rafael Juliano"}}, "url": "https://github.com/aws-amplify/amplify-android/commit/be348c2f5d7b645643fa394714a4bbfd8ecf488e", "committedDate": "2020-08-14T12:12:12Z", "message": "Replace *transitionFrom with transitionTo"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1ccfdf842a4b3c1b70116ce9e3a65bdacbc3ba8f", "author": {"user": {"login": "rjuliano", "name": "Rafael Juliano"}}, "url": "https://github.com/aws-amplify/amplify-android/commit/1ccfdf842a4b3c1b70116ce9e3a65bdacbc3ba8f", "committedDate": "2020-08-14T12:15:20Z", "message": "Update core/src/main/java/com/amplifyframework/api/events/ApiEndpointStatusChangeEvent.java\n\nCo-authored-by: Jameson Williams <jhwill@amazon.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8ea89317cf2284267cb430ccf56d0d55d6d07a3c", "author": {"user": {"login": "rjuliano", "name": "Rafael Juliano"}}, "url": "https://github.com/aws-amplify/amplify-android/commit/8ea89317cf2284267cb430ccf56d0d55d6d07a3c", "committedDate": "2020-08-14T12:30:31Z", "message": "Moved network monitoring into datastore"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2648257cd699319e7b413a947088408396f8e58d", "author": {"user": {"login": "rjuliano", "name": "Rafael Juliano"}}, "url": "https://github.com/aws-amplify/amplify-android/commit/2648257cd699319e7b413a947088408396f8e58d", "committedDate": "2020-08-14T12:31:06Z", "message": "Merge branch 'rjuliano/ds-net-hub-events' of github.com:aws-amplify/amplify-android into rjuliano/ds-net-hub-events"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "49fa70967cef859c02599060bb2ea003281aef4a", "author": {"user": {"login": "rjuliano", "name": "Rafael Juliano"}}, "url": "https://github.com/aws-amplify/amplify-android/commit/49fa70967cef859c02599060bb2ea003281aef4a", "committedDate": "2020-08-14T18:05:05Z", "message": "Add factory method for strongly-typed subscribers"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY3ODQ3NjQx", "url": "https://github.com/aws-amplify/amplify-android/pull/716#pullrequestreview-467847641", "createdAt": "2020-08-14T20:09:20Z", "commit": {"oid": "49fa70967cef859c02599060bb2ea003281aef4a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1940, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}