{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDIwNDU3OTcz", "number": 491, "title": "[aws-datastore] Permit multiple mutations per model ID", "bodyText": "In order to support conditional outgoing mutations, we need to allow\nmultiple mutations to exist in the queue at the same time.\nThis means there is no longer a notion of a single \"pre-existing\nmutation\" for a model ID, there are n-many such.\nAll the same, we will concern the first match in the queue, when we\nenact business logic about the outbox state.\nBy submitting this pull request, I confirm that my contribution is made under the terms of the Apache 2.0 license.", "createdAt": "2020-05-20T01:49:11Z", "url": "https://github.com/aws-amplify/amplify-android/pull/491", "merged": true, "mergeCommit": {"oid": "ac76fdfdc9b68337e2f10a4d206f466837f7b242"}, "closed": true, "closedAt": "2020-05-20T02:29:51Z", "author": {"login": "jamesonwilliams"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABci_CS5AH2gAyNDIwNDU3OTczOmViY2Y5ODYxYTQyNmY5N2IzNDU2YmYzMTIwYWI1YjIyMDRiZjIwNmM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABci_pX3gH2gAyNDIwNDU3OTczOjlhN2U1MDlkNDQ5ZDY1NTZmYWY2YjkyZjVhOTgwZTIzNTc2N2E3MjM=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "ebcf9861a426f97b3456bf3120ab5b2204bf206c", "author": {"user": {"login": "jamesonwilliams", "name": "Jameson Williams"}}, "url": "https://github.com/aws-amplify/amplify-android/commit/ebcf9861a426f97b3456bf3120ab5b2204bf206c", "committedDate": "2020-05-20T01:46:02Z", "message": "[aws-datastore] Permit multiple mutations per model ID\n\nIn order to support conditional outgoing mutations, we need to allow\nmultiple mutations to exist in the queue at the same time.\n\nThis means there is no longer a notion of a single \"pre-existing\nmutation\" for a model ID, there are n-many such.\n\nAll the same, we will concern the _first_ match in the queue, when we\nenact business logic about the outbox state."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE0OTM4NjM2", "url": "https://github.com/aws-amplify/amplify-android/pull/491#pullrequestreview-414938636", "createdAt": "2020-05-20T01:50:40Z", "commit": {"oid": "ebcf9861a426f97b3456bf3120ab5b2204bf206c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE0OTM5NTIw", "url": "https://github.com/aws-amplify/amplify-android/pull/491#pullrequestreview-414939520", "createdAt": "2020-05-20T01:53:43Z", "commit": {"oid": "ebcf9861a426f97b3456bf3120ab5b2204bf206c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE0OTQyNjQ0", "url": "https://github.com/aws-amplify/amplify-android/pull/491#pullrequestreview-414942644", "createdAt": "2020-05-20T02:03:23Z", "commit": {"oid": "ebcf9861a426f97b3456bf3120ab5b2204bf206c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE0OTQ5NDY1", "url": "https://github.com/aws-amplify/amplify-android/pull/491#pullrequestreview-414949465", "createdAt": "2020-05-20T02:25:55Z", "commit": {"oid": "ebcf9861a426f97b3456bf3120ab5b2204bf206c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMFQwMjoyNTo1NlrOGX5G2g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMFQwMjoyNTo1NlrOGX5G2g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzcwNjA3NA==", "bodyText": "Ah crap this was supposed to say copyOfBuilder, to keep the old ID. Need to validate before push.", "url": "https://github.com/aws-amplify/amplify-android/pull/491#discussion_r427706074", "createdAt": "2020-05-20T02:25:56Z", "author": {"login": "jamesonwilliams"}, "path": "aws-datastore/src/test/java/com/amplifyframework/datastore/syncengine/PersistentMutationOutboxTest.java", "diffHunk": "@@ -650,12 +655,40 @@ public void enqueueEventPostedWhenNewOutboxItemAdded() {\n         mutationOutbox.enqueue(PendingMutation.deletion(BlogOwner.builder()\n             .name(\"Tony Swanson\")\n             .build(), BlogOwner.class\n-        )).blockingAwait();\n+        )).blockingAwait(TIMEOUT_MS, TimeUnit.MILLISECONDS);\n \n         // Assert: we got an event!\n         eventsObserver.awaitCount(1)\n             .assertNoErrors()\n             .assertNotTerminated()\n             .assertValue(OutboxEvent.CONTENT_AVAILABLE);\n     }\n+\n+    /**\n+     * If the queue contains multiple items, then\n+     * {@link PersistentMutationOutbox#nextMutationForModelId(String)}\n+     * returns the first one.\n+     * @throws DataStoreException On failure to arrange content into storage\n+     */\n+    @Test\n+    public void nextItemForModelIdReturnsFirstEnqueued() throws DataStoreException {\n+        BlogOwner originalJoe = BlogOwner.builder()\n+            .name(\"Joe Swanson\")\n+            .build();\n+        PendingMutation<BlogOwner> firstMutation = PendingMutation.update(originalJoe, BlogOwner.class);\n+        storage.save(originalJoe, converter.toRecord(firstMutation));\n+\n+        BlogOwner updatedJoe = BlogOwner.builder()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ebcf9861a426f97b3456bf3120ab5b2204bf206c"}, "originalPosition": 169}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9a7e509d449d6556faf6b92f5a980e235767a723", "author": {"user": {"login": "jamesonwilliams", "name": "Jameson Williams"}}, "url": "https://github.com/aws-amplify/amplify-android/commit/9a7e509d449d6556faf6b92f5a980e235767a723", "committedDate": "2020-05-20T02:28:43Z", "message": "fixup"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2517, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}