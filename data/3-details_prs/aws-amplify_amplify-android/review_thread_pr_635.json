{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ3NzI0ODM1", "number": 635, "reviewThreads": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMVQwNjo0MzoxOVrOENecfg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNFQxODozMToyN1rOEOYYIA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgyNTY1NzU4OnYy", "diffSide": "RIGHT", "path": "core/src/main/java/com/amplifyframework/util/Wrap.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMVQwNjo0MzoxOVrOGwK8GQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xM1QyMDowNzoxMVrOGw376A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzE2NDA1Nw==", "bodyText": "Oh okay, I got this after a second. This is cool.\nMight help to illustrate by adding this into the comment, like:\n<indent>{\n<indent><margin><original>\n<indent>}", "url": "https://github.com/aws-amplify/amplify-android/pull/635#discussion_r453164057", "createdAt": "2020-07-11T06:43:19Z", "author": {"login": "jamesonwilliams"}, "path": "core/src/main/java/com/amplifyframework/util/Wrap.java", "diffHunk": "@@ -66,6 +67,21 @@ public static String inBraces(@Nullable String original) {\n         return \"{\" + original + \"}\";\n     }\n \n+    /**", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0d7a032475bc52c840fd7cb46f3bf43272f7684a"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzkwMTI4OA==", "bodyText": "Good idea.  It's actually like this:\n<space>{\n<margin><indent><original>\n<margin>}\n\nI'll update the comment!", "url": "https://github.com/aws-amplify/amplify-android/pull/635#discussion_r453901288", "createdAt": "2020-07-13T20:07:11Z", "author": {"login": "richardmcclellan"}, "path": "core/src/main/java/com/amplifyframework/util/Wrap.java", "diffHunk": "@@ -66,6 +67,21 @@ public static String inBraces(@Nullable String original) {\n         return \"{\" + original + \"}\";\n     }\n \n+    /**", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzE2NDA1Nw=="}, "originalCommit": {"oid": "0d7a032475bc52c840fd7cb46f3bf43272f7684a"}, "originalPosition": 12}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgyNTY2MDU4OnYy", "diffSide": "RIGHT", "path": "aws-api/src/main/java/com/amplifyframework/api/aws/GsonGraphQLResponseFactory.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMVQwNjo0Nzo1OFrOGwK9bg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xM1QyMDo0MTowNVrOGw5C6A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzE2NDM5OA==", "bodyText": "Is this needed?", "url": "https://github.com/aws-amplify/amplify-android/pull/635#discussion_r453164398", "createdAt": "2020-07-11T06:47:58Z", "author": {"login": "jamesonwilliams"}, "path": "aws-api/src/main/java/com/amplifyframework/api/aws/GsonGraphQLResponseFactory.java", "diffHunk": "@@ -19,6 +19,7 @@\n \n import com.amplifyframework.AmplifyException;\n import com.amplifyframework.api.ApiException;\n+import com.amplifyframework.api.aws.appsync.AppSyncGraphQLRequest;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0d7a032475bc52c840fd7cb46f3bf43272f7684a"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzkxOTQ2NA==", "bodyText": "When I moved AppSyncGraphQLRequest to the aws-api-appsync module, I moved it into an appsync sub package, but thinking about it now, I don't think there's really a reason to do that.  I will move everything in the api.aws.appsync package to api.aws.", "url": "https://github.com/aws-amplify/amplify-android/pull/635#discussion_r453919464", "createdAt": "2020-07-13T20:41:05Z", "author": {"login": "richardmcclellan"}, "path": "aws-api/src/main/java/com/amplifyframework/api/aws/GsonGraphQLResponseFactory.java", "diffHunk": "@@ -19,6 +19,7 @@\n \n import com.amplifyframework.AmplifyException;\n import com.amplifyframework.api.ApiException;\n+import com.amplifyframework.api.aws.appsync.AppSyncGraphQLRequest;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzE2NDM5OA=="}, "originalCommit": {"oid": "0d7a032475bc52c840fd7cb46f3bf43272f7684a"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgyNTY2MDY0OnYy", "diffSide": "RIGHT", "path": "aws-api/src/main/java/com/amplifyframework/api/aws/AppSyncPaginatedResultDeserializer.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMVQwNjo0ODowNVrOGwK9dQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xM1QyMDo0MToxNlrOGw5DVQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzE2NDQwNQ==", "bodyText": "Needed?", "url": "https://github.com/aws-amplify/amplify-android/pull/635#discussion_r453164405", "createdAt": "2020-07-11T06:48:05Z", "author": {"login": "jamesonwilliams"}, "path": "aws-api/src/main/java/com/amplifyframework/api/aws/AppSyncPaginatedResultDeserializer.java", "diffHunk": "@@ -15,6 +15,7 @@\n \n package com.amplifyframework.api.aws;\n \n+import com.amplifyframework.api.aws.appsync.AppSyncGraphQLRequest;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0d7a032475bc52c840fd7cb46f3bf43272f7684a"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzkxOTU3Mw==", "bodyText": "Will move, as mentioned in previous comment.", "url": "https://github.com/aws-amplify/amplify-android/pull/635#discussion_r453919573", "createdAt": "2020-07-13T20:41:16Z", "author": {"login": "richardmcclellan"}, "path": "aws-api/src/main/java/com/amplifyframework/api/aws/AppSyncPaginatedResultDeserializer.java", "diffHunk": "@@ -15,6 +15,7 @@\n \n package com.amplifyframework.api.aws;\n \n+import com.amplifyframework.api.aws.appsync.AppSyncGraphQLRequest;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzE2NDQwNQ=="}, "originalCommit": {"oid": "0d7a032475bc52c840fd7cb46f3bf43272f7684a"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgyNTY2MTQ0OnYy", "diffSide": "RIGHT", "path": "aws-api/src/main/java/com/amplifyframework/api/aws/AWSApiPlugin.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMVQwNjo0OTozN1rOGwK91g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMVQwNjo0OTozN1rOGwK91g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzE2NDUwMg==", "bodyText": "Instead of mutating the request, can you create a new copy, with the owner field re-populated?\ne.g.\nGIzmo newGizmo = oldGizmo.newBuilder().setSpinnerWidgetActive(true).build();", "url": "https://github.com/aws-amplify/amplify-android/pull/635#discussion_r453164502", "createdAt": "2020-07-11T06:49:37Z", "author": {"login": "jamesonwilliams"}, "path": "aws-api/src/main/java/com/amplifyframework/api/aws/AWSApiPlugin.java", "diffHunk": "@@ -260,11 +261,9 @@ public void configure(\n         if (graphQLRequest instanceof AppSyncGraphQLRequest) {\n             try {\n                 AppSyncGraphQLRequest<R> request = (AppSyncGraphQLRequest<R>) graphQLRequest;\n-                CognitoUserPoolsAuthProvider cognitoProvider = authProvider.getCognitoUserPoolsAuthProvider();\n-                if (cognitoProvider == null) {\n-                    cognitoProvider = new DefaultCognitoUserPoolsAuthProvider();\n+                if (request.isOwnerArgumentRequired()) {\n+                    request.setOwner(getUsername());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0d7a032475bc52c840fd7cb46f3bf43272f7684a"}, "originalPosition": 16}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgyNTY2MjA1OnYy", "diffSide": "RIGHT", "path": "aws-api-appsync/src/test/java/com/amplifyframework/api/aws/appsync/SelectionSetTest.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMVQwNjo1MDozNVrOGwK-Ig==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xM1QyMDo0Njo1NVrOGw5PRw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzE2NDU3OA==", "bodyText": "I think these are already running at 28, aren't they? There should be a robolectric.properties somewhere under src/test, that sets the sdk target for all the test suites.", "url": "https://github.com/aws-amplify/amplify-android/pull/635#discussion_r453164578", "createdAt": "2020-07-11T06:50:35Z", "author": {"login": "jamesonwilliams"}, "path": "aws-api-appsync/src/test/java/com/amplifyframework/api/aws/appsync/SelectionSetTest.java", "diffHunk": "@@ -33,8 +34,13 @@\n      * @throws AmplifyException if a ModelSchema can't be derived from Post.class\n      */\n     @Test\n+    @Config(sdk = 28)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0d7a032475bc52c840fd7cb46f3bf43272f7684a"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzkyMjYzMQ==", "bodyText": "Ahh, this is a new module, and I hadn't added a robolectric.properties file yet.  Just added one, and removed this annotation.", "url": "https://github.com/aws-amplify/amplify-android/pull/635#discussion_r453922631", "createdAt": "2020-07-13T20:46:55Z", "author": {"login": "richardmcclellan"}, "path": "aws-api-appsync/src/test/java/com/amplifyframework/api/aws/appsync/SelectionSetTest.java", "diffHunk": "@@ -33,8 +34,13 @@\n      * @throws AmplifyException if a ModelSchema can't be derived from Post.class\n      */\n     @Test\n+    @Config(sdk = 28)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzE2NDU3OA=="}, "originalCommit": {"oid": "0d7a032475bc52c840fd7cb46f3bf43272f7684a"}, "originalPosition": 21}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgyNTY2MjM5OnYy", "diffSide": "RIGHT", "path": "aws-api-appsync/src/test/java/com/amplifyframework/api/aws/appsync/AppSyncGraphQLRequestTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMVQwNjo1MDo1NVrOGwK-SQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMVQwNjo1MDo1NVrOGwK-SQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzE2NDYxNw==", "bodyText": "(Copy of builder / immutable comment, here too)", "url": "https://github.com/aws-amplify/amplify-android/pull/635#discussion_r453164617", "createdAt": "2020-07-11T06:50:55Z", "author": {"login": "jamesonwilliams"}, "path": "aws-api-appsync/src/test/java/com/amplifyframework/api/aws/appsync/AppSyncGraphQLRequestTest.java", "diffHunk": "@@ -120,9 +105,12 @@ private boolean isOwnerArgumentAdded(Class<? extends Model> clazz, OperationType\n         AppSyncGraphQLRequest<Model> request = AppSyncGraphQLRequest.builder()\n                 .modelClass(clazz)\n                 .operationType(operationType)\n+                .requestOptions(new DefaultGraphQLRequestOptions())\n                 .responseType(clazz)\n                 .build();\n-        request.setOwner(authProvider);\n+        if (request.isOwnerArgumentRequired()) {\n+            request.setOwner(\"johndoe\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0d7a032475bc52c840fd7cb46f3bf43272f7684a"}, "originalPosition": 48}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgyNTY2MzI3OnYy", "diffSide": "RIGHT", "path": "aws-api-appsync/src/main/java/com/amplifyframework/api/aws/appsync/SelectionSet.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMVQwNjo1Mjo0MVrOGwK-sA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xM1QyMDo1MTo1NFrOGw5Zcw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzE2NDcyMA==", "bodyText": "@Override\n\n\nPassing thought -- I wonder if we should have made an explicit buildGraphQlDocument() or something. toString() can often just have a pretty-print of the object state, which isn't necessarily in any particular standard form. Not really a big deal.", "url": "https://github.com/aws-amplify/amplify-android/pull/635#discussion_r453164720", "createdAt": "2020-07-11T06:52:41Z", "author": {"login": "jamesonwilliams"}, "path": "aws-api-appsync/src/main/java/com/amplifyframework/api/aws/appsync/SelectionSet.java", "diffHunk": "@@ -87,6 +91,15 @@ public SelectionSet(String value, Set<SelectionSet> nodes) {\n      */\n     @Override\n     public String toString() {\n+        return toString(\"\");\n+    }\n+\n+    /**\n+     * Generates the String value of the SelectionSet for a GraphQL query document.\n+     * @param margin a margin with which to prefix each field of the selection set.\n+     * @return String value of the SelectionSet for a GraphQL query document.\n+     */\n+    public String toString(String margin) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0d7a032475bc52c840fd7cb46f3bf43272f7684a"}, "originalPosition": 50}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzkyNTIzNQ==", "bodyText": "@Override\n\n\nI do have @OverRide on the toString() method, but this is toString(String margin), so it's not overriding anything.\n\nPassing thought -- I wonder if we should have made an explicit buildGraphQlDocument() or something. toString() can often just have a pretty-print of the object state, which isn't necessarily in any particular standard form. Not really a big deal.\n\nI thought about this too.  But I decided to just use toString() because I would still need to override toString() anyway to provide a useful description for debugging purposes, and toString() would just end up calling buildGraphQlDocument() anyway.", "url": "https://github.com/aws-amplify/amplify-android/pull/635#discussion_r453925235", "createdAt": "2020-07-13T20:51:54Z", "author": {"login": "richardmcclellan"}, "path": "aws-api-appsync/src/main/java/com/amplifyframework/api/aws/appsync/SelectionSet.java", "diffHunk": "@@ -87,6 +91,15 @@ public SelectionSet(String value, Set<SelectionSet> nodes) {\n      */\n     @Override\n     public String toString() {\n+        return toString(\"\");\n+    }\n+\n+    /**\n+     * Generates the String value of the SelectionSet for a GraphQL query document.\n+     * @param margin a margin with which to prefix each field of the selection set.\n+     * @return String value of the SelectionSet for a GraphQL query document.\n+     */\n+    public String toString(String margin) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzE2NDcyMA=="}, "originalCommit": {"oid": "0d7a032475bc52c840fd7cb46f3bf43272f7684a"}, "originalPosition": 50}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgyNTY2NjE5OnYy", "diffSide": "RIGHT", "path": "aws-api-appsync/src/main/java/com/amplifyframework/api/aws/appsync/GraphQLRequestOptions.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMVQwNjo1NjoxOVrOGwK__A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMVQwNjo1NjoxOVrOGwK__A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzE2NTA1Mg==", "bodyText": "You could use an enum for this, to help disambiguate the meaning of the boolean, and save some chars in this long-winded java method name, perhaps?\nHere is one such idea -- can still use iteration:\nLeafSelectionBehavior leafSelectionBehavior();\nwith:\nenum LeafSelectionBehavior {\n    JUST_ID,\n    ALL_FIELDS\n}", "url": "https://github.com/aws-amplify/amplify-android/pull/635#discussion_r453165052", "createdAt": "2020-07-11T06:56:19Z", "author": {"login": "jamesonwilliams"}, "path": "aws-api-appsync/src/main/java/com/amplifyframework/api/aws/appsync/GraphQLRequestOptions.java", "diffHunk": "@@ -0,0 +1,66 @@\n+/*\n+ * Copyright 2020 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *  http://aws.amazon.com/apache2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ * permissions and limitations under the License.\n+ */\n+\n+package com.amplifyframework.api.aws.appsync;\n+\n+import com.amplifyframework.core.model.Model;\n+\n+import java.util.List;\n+\n+/**\n+ * Options to be provided to a {@link AppSyncGraphQLRequest.Builder}.  When provisioning an AppSync API, there are some\n+ * key differences in the way the GraphQL operations are generated depending on whether DataStore is enabled.  For\n+ * example, _deleted, _lastChangedAt, and _version fields are added to each {@link Model} when using DataStore, but not\n+ * when using API, which means a GraphQLRequest should request these fields only if DataStore is enabled.  This options\n+ * object encapsulates these differences to help build the {@link AppSyncGraphQLRequest}.\n+ */\n+public interface GraphQLRequestOptions {\n+\n+    /**\n+     * Returns list of fields to be requested when the response type is a list of {@link Model} objects.\n+     * Examples: \"nextToken\",  \"startedAt\".\n+     *\n+     * @return list of pagination fields.\n+     */\n+    List<String> paginationFields();\n+\n+    /**\n+     * Returns list of metadata fields that should be requested for a {@link Model}.\n+     * Examples:  \"_deleted\", \"_lastChangedAt\", \"_version\".\n+     *\n+     * @return list of metadata fields\n+     */\n+    List<String> modelMetaFields();\n+\n+    /**\n+     * Returns name of field that should wrap {@link Model} fields.\n+     * Example: \"items\".\n+     *\n+     * @return name of field that should wrap {@link Model} fields.\n+     */\n+    String listField();\n+\n+    /**\n+     * Returns the maximum depth to traverse a {@link Model} when building the {@link SelectionSet}.\n+     * @return the maximum depth to traverse a {@link Model} when building the {@link SelectionSet}.\n+     */\n+    int maxDepth();\n+\n+    /**\n+     * Returns whether to request all fields or only the id field for leaf nodes when building the {@link SelectionSet}.\n+     * @return whether to request all fields or only the id field for leaf nodes when building the {@link SelectionSet}.\n+     */\n+    boolean onlyRequestIdForLeafSelectionSetNodes();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0d7a032475bc52c840fd7cb46f3bf43272f7684a"}, "originalPosition": 65}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgyNTY2Njg3OnYy", "diffSide": "RIGHT", "path": "aws-api-appsync/src/main/java/com/amplifyframework/api/aws/appsync/AppSyncGraphQLRequest.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMVQwNjo1Nzo0NVrOGwLAUg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xM1QxOToxNjo0MlrOGw2TQg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzE2NTEzOA==", "bodyText": "Can we get this in the builder, somehow, to keep the class immutable?", "url": "https://github.com/aws-amplify/amplify-android/pull/635#discussion_r453165138", "createdAt": "2020-07-11T06:57:45Z", "author": {"login": "jamesonwilliams"}, "path": "aws-api-appsync/src/main/java/com/amplifyframework/api/aws/appsync/AppSyncGraphQLRequest.java", "diffHunk": "@@ -107,33 +105,29 @@ public void setVariable(String key, String type, String value) {\n     }\n \n     /**\n-     * Used to add owner argument from authProvider if needed.\n-     * @param authProvider CognitoUserPoolsAuthProvider for obtaining the username to set as the owner field.\n-     * @throws ApiException if request requires owner argument and authProvider or authProvider.getUsername() is null.\n+     * Returns whether owner argument is required for this request based on the model's {@link AuthRule}s.\n+     * @return whether owner argument is required for this request based on the model's {@link AuthRule}s.\n      */\n-    public void setOwner(CognitoUserPoolsAuthProvider authProvider) throws ApiException {\n+    public boolean isOwnerArgumentRequired() {\n         for (AuthRule authRule : modelSchema.getAuthRules()) {\n             if (isOwnerArgumentRequired(authRule)) {\n-                setVariable(authRule.getOwnerFieldOrDefault(), \"String!\", getUsername(authProvider));\n+                return true;\n             }\n         }\n+        return false;\n     }\n \n-    private String getUsername(CognitoUserPoolsAuthProvider authProvider) throws ApiException {\n-        if (authProvider == null) {\n-            throw new ApiException(\n-                    \"Attempted to subscribe to a model with owner based authorization without a Cognito provider\",\n-                    \"Did you add the AWSCognitoAuthPlugin to Amplify before configuring it?\"\n-            );\n-        }\n-        String username = authProvider.getUsername();\n-        if (username == null) {\n-            throw new ApiException(\n-                    \"Attempted to subscribe to a model with owner based authorization without a username\",\n-                    \"Make sure that a user is logged in before subscribing to a model with owner based auth\"\n-            );\n+    /**\n+     * Used to add owner argument from authProvider if needed.\n+     * @param owner username from CognitoUserPoolsAuthProvider to set as the owner field.\n+     * @throws ApiException if request requires owner argument and authProvider or authProvider.getUsername() is null.\n+     */\n+    public void setOwner(String owner) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0d7a032475bc52c840fd7cb46f3bf43272f7684a"}, "originalPosition": 81}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mzg3NDQ5OA==", "bodyText": "I tried to figure out a way to do that, but there's no good way to do it, without making breaking changes to public interfaces.\nCustomers use the ModelSubscription factory to create a GraphQLRequest object, and then pass it to Amplify.API.subscribe(...).    Then, in AWSApiPlugin, I call setOwner to add the username input.   The factory cannot do this unfortunately because it doesn't have a reference to the CognitoUserPoolsProvider.  Only the AWSApiPlugin has this reference.", "url": "https://github.com/aws-amplify/amplify-android/pull/635#discussion_r453874498", "createdAt": "2020-07-13T19:16:42Z", "author": {"login": "richardmcclellan"}, "path": "aws-api-appsync/src/main/java/com/amplifyframework/api/aws/appsync/AppSyncGraphQLRequest.java", "diffHunk": "@@ -107,33 +105,29 @@ public void setVariable(String key, String type, String value) {\n     }\n \n     /**\n-     * Used to add owner argument from authProvider if needed.\n-     * @param authProvider CognitoUserPoolsAuthProvider for obtaining the username to set as the owner field.\n-     * @throws ApiException if request requires owner argument and authProvider or authProvider.getUsername() is null.\n+     * Returns whether owner argument is required for this request based on the model's {@link AuthRule}s.\n+     * @return whether owner argument is required for this request based on the model's {@link AuthRule}s.\n      */\n-    public void setOwner(CognitoUserPoolsAuthProvider authProvider) throws ApiException {\n+    public boolean isOwnerArgumentRequired() {\n         for (AuthRule authRule : modelSchema.getAuthRules()) {\n             if (isOwnerArgumentRequired(authRule)) {\n-                setVariable(authRule.getOwnerFieldOrDefault(), \"String!\", getUsername(authProvider));\n+                return true;\n             }\n         }\n+        return false;\n     }\n \n-    private String getUsername(CognitoUserPoolsAuthProvider authProvider) throws ApiException {\n-        if (authProvider == null) {\n-            throw new ApiException(\n-                    \"Attempted to subscribe to a model with owner based authorization without a Cognito provider\",\n-                    \"Did you add the AWSCognitoAuthPlugin to Amplify before configuring it?\"\n-            );\n-        }\n-        String username = authProvider.getUsername();\n-        if (username == null) {\n-            throw new ApiException(\n-                    \"Attempted to subscribe to a model with owner based authorization without a username\",\n-                    \"Make sure that a user is logged in before subscribing to a model with owner based auth\"\n-            );\n+    /**\n+     * Used to add owner argument from authProvider if needed.\n+     * @param owner username from CognitoUserPoolsAuthProvider to set as the owner field.\n+     * @throws ApiException if request requires owner argument and authProvider or authProvider.getUsername() is null.\n+     */\n+    public void setOwner(String owner) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzE2NTEzOA=="}, "originalCommit": {"oid": "0d7a032475bc52c840fd7cb46f3bf43272f7684a"}, "originalPosition": 81}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgzNTE0Mjg0OnYy", "diffSide": "RIGHT", "path": "aws-api-appsync/src/main/java/com/amplifyframework/api/aws/AppSyncGraphQLRequest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNFQxODoyOTo1NVrOGxgHfA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNFQxODoyOTo1NVrOGxgHfA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDU1OTYxMg==", "bodyText": "Ought these to be Immutable.of(build.variables) and Immutable.of(builder.variableTypes)?", "url": "https://github.com/aws-amplify/amplify-android/pull/635#discussion_r454559612", "createdAt": "2020-07-14T18:29:55Z", "author": {"login": "jamesonwilliams"}, "path": "aws-api-appsync/src/main/java/com/amplifyframework/api/aws/AppSyncGraphQLRequest.java", "diffHunk": "@@ -60,97 +51,34 @@\n      * Constructor for AppSyncGraphQLRequest.\n      * @throw AmplifyException if a ModelSchema can't be derived from the provided model class\n      */\n-    private AppSyncGraphQLRequest(Builder builder) throws AmplifyException {\n+    private AppSyncGraphQLRequest(Builder builder) {\n         super(builder.responseType, new GsonVariablesSerializer());\n-        this.modelSchema = ModelSchema.fromModelClass(builder.modelClass);\n-        this.selectionSet = SelectionSet.Factory.fromModelClass(builder.modelClass,\n-                builder.operationType,\n-                DEFAULT_DEPTH);\n-        this.operationType = builder.operationType;\n+        this.modelSchema = builder.modelSchema;\n+        this.operation = builder.operation;\n+        this.selectionSet = builder.selectionSet;\n         this.variables = builder.variables;\n         this.variableTypes = builder.variableTypes;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b5ec44646c7081e80a321a2533a56686a132b2ab"}, "originalPosition": 47}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgzNTE0NjAyOnYy", "diffSide": "RIGHT", "path": "aws-api-appsync/src/main/java/com/amplifyframework/api/aws/GraphQLRequestOptions.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNFQxODozMDozNlrOGxgJPg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNFQxODozMDozNlrOGxgJPg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDU2MDA2Mg==", "bodyText": "Can you mark the non-primitive return types as @NonNull (or, if it is the case, @Nullable)?", "url": "https://github.com/aws-amplify/amplify-android/pull/635#discussion_r454560062", "createdAt": "2020-07-14T18:30:36Z", "author": {"login": "jamesonwilliams"}, "path": "aws-api-appsync/src/main/java/com/amplifyframework/api/aws/GraphQLRequestOptions.java", "diffHunk": "@@ -0,0 +1,66 @@\n+/*\n+ * Copyright 2020 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *  http://aws.amazon.com/apache2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ * permissions and limitations under the License.\n+ */\n+\n+package com.amplifyframework.api.aws;\n+\n+import com.amplifyframework.core.model.Model;\n+\n+import java.util.List;\n+\n+/**\n+ * Options to be provided to a {@link AppSyncGraphQLRequest.Builder}.  When provisioning an AppSync API, there are some\n+ * key differences in the way the GraphQL operations are generated depending on whether DataStore is enabled.  For\n+ * example, _deleted, _lastChangedAt, and _version fields are added to each {@link Model} when using DataStore, but not\n+ * when using API, which means a GraphQLRequest should request these fields only if DataStore is enabled.  This options\n+ * object encapsulates these differences to help build the {@link AppSyncGraphQLRequest}.\n+ */\n+public interface GraphQLRequestOptions {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b5ec44646c7081e80a321a2533a56686a132b2ab"}, "originalPosition": 29}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgzNTE0OTEyOnYy", "diffSide": "RIGHT", "path": "aws-api-appsync/src/test/java/com/amplifyframework/api/aws/DefaultGraphQLRequestOptions.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNFQxODozMToyN1rOGxgLKg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNFQxODozMToyN1rOGxgLKg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDU2MDU1NA==", "bodyText": "Collections.singletonList(...)", "url": "https://github.com/aws-amplify/amplify-android/pull/635#discussion_r454560554", "createdAt": "2020-07-14T18:31:27Z", "author": {"login": "jamesonwilliams"}, "path": "aws-api-appsync/src/test/java/com/amplifyframework/api/aws/DefaultGraphQLRequestOptions.java", "diffHunk": "@@ -0,0 +1,50 @@\n+/*\n+ * Copyright 2020 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *  http://aws.amazon.com/apache2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ * permissions and limitations under the License.\n+ */\n+\n+package com.amplifyframework.api.aws;\n+\n+import java.util.Arrays;\n+import java.util.Collections;\n+import java.util.List;\n+\n+public final class DefaultGraphQLRequestOptions implements GraphQLRequestOptions {\n+    private static final String ITEMS_KEY = \"items\";\n+    private static final String NEXT_TOKEN_KEY = \"nextToken\";\n+\n+    @Override\n+    public List<String> paginationFields() {\n+        return Arrays.asList(NEXT_TOKEN_KEY);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b5ec44646c7081e80a321a2533a56686a132b2ab"}, "originalPosition": 28}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1088, "cost": 1, "resetAt": "2021-11-12T09:44:50Z"}}}