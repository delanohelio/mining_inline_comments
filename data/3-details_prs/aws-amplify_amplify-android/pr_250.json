{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY4MzQ5Mzg1", "number": 250, "title": "Category tweaks", "bodyText": "By submitting this pull request, I confirm that my contribution is made under the terms of the Apache 2.0 license.", "createdAt": "2020-01-29T03:14:45Z", "url": "https://github.com/aws-amplify/amplify-android/pull/250", "merged": true, "mergeCommit": {"oid": "4c07221d9eb4a38f4306175297263367b800f178"}, "closed": true, "closedAt": "2020-02-17T16:14:50Z", "author": {"login": "jamesonwilliams"}, "timelineItems": {"totalCount": 14, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb_faRvgFqTM1MTA3MDMwNA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcFPtaegH2gAyMzY4MzQ5Mzg1OjEyOTRlZDMwZmM3OWU5MmY2MDQ2ODU4MjFmZDU5NjAyYmI4N2RjYTQ=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUxMDcwMzA0", "url": "https://github.com/aws-amplify/amplify-android/pull/250#pullrequestreview-351070304", "createdAt": "2020-01-30T19:07:55Z", "commit": {"oid": "933556349e7ee1399904fa086e746c8a54f2d636"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0zMFQxOTowNzo1NVrOFj2hww==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0zMFQxOTowNzo1NVrOFj2hww==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzEzNzg1OQ==", "bodyText": "We discussed a bug about this :)\nShould have validateConfigured() and throwIfConfigured() separately to clearly indicate two validation cases", "url": "https://github.com/aws-amplify/amplify-android/pull/250#discussion_r373137859", "createdAt": "2020-01-30T19:07:55Z", "author": {"login": "raphkim"}, "path": "core/src/main/java/com/amplifyframework/core/category/Category.java", "diffHunk": "@@ -167,35 +162,56 @@ public final P getPlugin(@NonNull final String pluginKey) {\n      */\n     @NonNull\n     public final Set<P> getPlugins() {\n-        return new HashSet<>(plugins.values());\n+        return Immutable.of(new HashSet<>(plugins.values()));\n     }\n \n     /**\n      * Obtain the registered plugin for this category.\n      * @return The only registered plugin for this category\n      * @throws IllegalStateException\n      *         If the category is not configured, or if there are no\n-     *         plugins associated to the category\n+     *         plugins associated to the category, or if Amplify has not\n+     *         been configured\n      */\n     @NonNull\n-    protected final P getSelectedPlugin() {\n-        if (!isConfigured) {\n-            throw new IllegalStateException(\"This category is not yet configured.\" +\n-                    \"Make sure you added it with Amplify.addPlugin and then called Amplify.config\");\n+    protected final P getSelectedPlugin() throws IllegalStateException {\n+        try {\n+            validateConfigurationState(ConfigurationState.CONFIGURED);\n+        } catch (AmplifyException amplifyException) {\n+            // Every category behavior calls getSelectedPlugin(), so we can't realistically\n+            // ask each one to catch a (checked) AmplifyException.\n+            throw new IllegalStateException(amplifyException);\n         }\n+\n         if (plugins.isEmpty()) {\n             throw new IllegalStateException(\n-                    \"Tried to get a plugin but that plugin was not present.\" +\n-                    \"Check if the plugin was added originally or perhaps was already removed.\"\n+                \"Tried to get a plugin but that plugin was not present. \" +\n+                \"Check if the plugin was added originally or perhaps was already removed.\"\n             );\n-        }\n-        if (plugins.size() > 1) {\n+        } else if (plugins.size() > 1) {\n             throw new IllegalStateException(\n-                    \"Tried to get a default plugin but there are more than one to choose from in this category.\" +\n-                    \"Call getPlugin(pluginKey) to choose the specific plugin you want to use in this case.\"\n+                \"Tried to get a default plugin but there are more than one to choose from in this category. \" +\n+                \"Call getPlugin(pluginKey) to choose the specific plugin you want to use in this case.\"\n             );\n         }\n \n         return getPlugins().iterator().next();\n     }\n+\n+    private void validateConfigurationState(ConfigurationState targetState) throws AmplifyException {\n+        synchronized (configurationState) {\n+            if (!configurationState.get().equals(targetState)) {\n+                throw new AmplifyException(\n+                    \"Amplify was already configured.\",\n+                    \"Be sure to only call Amplify.configure once\"\n+                );\n+            }\n+        }\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "933556349e7ee1399904fa086e746c8a54f2d636"}, "originalPosition": 183}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUxMDcxMjc5", "url": "https://github.com/aws-amplify/amplify-android/pull/250#pullrequestreview-351071279", "createdAt": "2020-01-30T19:09:26Z", "commit": {"oid": "933556349e7ee1399904fa086e746c8a54f2d636"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "933556349e7ee1399904fa086e746c8a54f2d636", "author": {"user": {"login": "jamesonwilliams", "name": "Jameson Williams"}}, "url": "https://github.com/aws-amplify/amplify-android/commit/933556349e7ee1399904fa086e746c8a54f2d636", "committedDate": "2020-01-28T06:44:54Z", "message": "Merge remote-tracking branch 'origin/master' into category"}, "afterCommit": null}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "PullRequestCommit", "commit": {"oid": "0c46ab6d17685a1a11cf8bd43eab58badc3f0301", "author": {"user": {"login": "jamesonwilliams", "name": "Jameson Williams"}}, "url": "https://github.com/aws-amplify/amplify-android/commit/0c46ab6d17685a1a11cf8bd43eab58badc3f0301", "committedDate": "2020-02-03T21:41:40Z", "message": "[core] unit tests and tweaks for Category"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": {"oid": "0c46ab6d17685a1a11cf8bd43eab58badc3f0301", "author": {"user": {"login": "jamesonwilliams", "name": "Jameson Williams"}}, "url": "https://github.com/aws-amplify/amplify-android/commit/0c46ab6d17685a1a11cf8bd43eab58badc3f0301", "committedDate": "2020-02-03T21:41:40Z", "message": "[core] unit tests and tweaks for Category"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUzOTc1NTk1", "url": "https://github.com/aws-amplify/amplify-android/pull/250#pullrequestreview-353975595", "createdAt": "2020-02-05T19:19:41Z", "commit": {"oid": "0c46ab6d17685a1a11cf8bd43eab58badc3f0301"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNVQxOToxOTo0MlrOFmEDkQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNVQxOToxOTo0MlrOFmEDkQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTQ1NjY1Nw==", "bodyText": "isn't this just\nif (!isConfigured()) {\n    throw ...\n}\n\n?", "url": "https://github.com/aws-amplify/amplify-android/pull/250#discussion_r375456657", "createdAt": "2020-02-05T19:19:42Z", "author": {"login": "raphkim"}, "path": "core/src/main/java/com/amplifyframework/core/category/Category.java", "diffHunk": "@@ -167,35 +176,46 @@ public final P getPlugin(@NonNull final String pluginKey) {\n      */\n     @NonNull\n     public final Set<P> getPlugins() {\n-        return new HashSet<>(plugins.values());\n+        return Immutable.of(new HashSet<>(plugins.values()));\n     }\n \n     /**\n      * Obtain the registered plugin for this category.\n      * @return The only registered plugin for this category\n      * @throws IllegalStateException\n      *         If the category is not configured, or if there are no\n-     *         plugins associated to the category\n+     *         plugins associated to the category, or if Amplify has not\n+     *         been configured\n      */\n     @NonNull\n-    protected final P getSelectedPlugin() {\n-        if (!isConfigured) {\n-            throw new IllegalStateException(\"This category is not yet configured.\" +\n-                    \"Make sure you added it with Amplify.addPlugin and then called Amplify.config\");\n+    protected final P getSelectedPlugin() throws IllegalStateException {\n+        synchronized (configurationState) {\n+            if (!ConfigurationState.CONFIGURED.equals(configurationState.get())) {\n+                throw new IllegalStateException(\n+                    \"Category \" + getCategoryType() + \" is not configured. \" +\n+                    \"Ensure that you have configured the category before trying to use it.\"\n+                );\n+            }\n         }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0c46ab6d17685a1a11cf8bd43eab58badc3f0301"}, "originalPosition": 165}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUzOTc1NjQz", "url": "https://github.com/aws-amplify/amplify-android/pull/250#pullrequestreview-353975643", "createdAt": "2020-02-05T19:19:47Z", "commit": {"oid": "0c46ab6d17685a1a11cf8bd43eab58badc3f0301"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3059b2585bc7825c155425fda0395e2ceaca0a17", "author": {"user": {"login": "jamesonwilliams", "name": "Jameson Williams"}}, "url": "https://github.com/aws-amplify/amplify-android/commit/3059b2585bc7825c155425fda0395e2ceaca0a17", "committedDate": "2020-02-16T06:09:51Z", "message": "Merge remote-tracking branch 'origin/master' into category_tweaks"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5418eb1360ada4fbc32f23fa8eddb848ae3d875f", "author": {"user": {"login": "jamesonwilliams", "name": "Jameson Williams"}}, "url": "https://github.com/aws-amplify/amplify-android/commit/5418eb1360ada4fbc32f23fa8eddb848ae3d875f", "committedDate": "2020-02-16T06:14:03Z", "message": "Address Raph's feedback"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU5ODM3Nzcy", "url": "https://github.com/aws-amplify/amplify-android/pull/250#pullrequestreview-359837772", "createdAt": "2020-02-17T16:00:00Z", "commit": {"oid": "5418eb1360ada4fbc32f23fa8eddb848ae3d875f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xN1QxNjowMDowMVrOFqpWbA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xN1QxNjowMDowMVrOFqpWbA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDI2MTk5Ng==", "bodyText": "What's the benefit to specifying the runtime exception in the method header? Also, that won't force calling methods to catch/throw it will it?", "url": "https://github.com/aws-amplify/amplify-android/pull/250#discussion_r380261996", "createdAt": "2020-02-17T16:00:01Z", "author": {"login": "TrekSoft"}, "path": "core/src/main/java/com/amplifyframework/core/category/Category.java", "diffHunk": "@@ -146,17 +153,17 @@ public final void removePlugin(@NonNull P plugin) {\n      * Retrieve a plugin by its key.\n      * @param pluginKey A key that identifies a plugin implementation\n      * @return The plugin object associated to pluginKey, if registered\n-     * @throws IllegalStateException If there is no plugin with the given key\n+     * @throws IllegalStateException If the requested plugin does not exist\n      */\n     @NonNull\n-    public final P getPlugin(@NonNull final String pluginKey) {\n+    public final P getPlugin(@NonNull final String pluginKey) throws IllegalStateException {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5418eb1360ada4fbc32f23fa8eddb848ae3d875f"}, "originalPosition": 118}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU5ODM4MzQx", "url": "https://github.com/aws-amplify/amplify-android/pull/250#pullrequestreview-359838341", "createdAt": "2020-02-17T16:00:50Z", "commit": {"oid": "5418eb1360ada4fbc32f23fa8eddb848ae3d875f"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1294ed30fc79e92f604685821fd59602bb87dca4", "author": {"user": {"login": "jamesonwilliams", "name": "Jameson Williams"}}, "url": "https://github.com/aws-amplify/amplify-android/commit/1294ed30fc79e92f604685821fd59602bb87dca4", "committedDate": "2020-02-17T16:13:53Z", "message": "Merge branch 'master' into category_tweaks"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2811, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}