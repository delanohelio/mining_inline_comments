{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTEwMTgxNzcw", "number": 930, "reviewThreads": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yNlQxNzo0NDoxMlrOEyBENg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yN1QxNToxMTo1OFrOEyZyKQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIwODgxNzE4OnYy", "diffSide": "RIGHT", "path": "aws-api/src/main/java/com/amplifyframework/api/aws/AWSApiPlugin.java", "isResolved": true, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yNlQxNzo0NDoxMlrOHobSHw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yNlQyMDozNzo1OVrOHohbrg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjE1MjA5NQ==", "bodyText": "The data type here is starting to look like a poor-man's data structure. Does it make sense to create a class ReadAuthorizedGroups, to encapsulate the data?", "url": "https://github.com/aws-amplify/amplify-android/pull/930#discussion_r512152095", "createdAt": "2020-10-26T17:44:12Z", "author": {"login": "jamesonwilliams"}, "path": "aws-api/src/main/java/com/amplifyframework/api/aws/AWSApiPlugin.java", "diffHunk": "@@ -291,7 +292,7 @@ public String getVersion() {\n             try {\n                 AppSyncGraphQLRequest<R> appSyncRequest = (AppSyncGraphQLRequest<R>) request;\n                 AuthRule ownerRuleWithReadRestriction = null;\n-                ArrayList<String> readAuthorizedGroups = new ArrayList<>();\n+                Map<String, List<String>> readAuthorizedGroupsMap = new HashMap<>();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "902bb379f6a2fd2e60c5796cabb19849dfab3f69"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjE1NzQ4NA==", "bodyText": "poor-man's data structure.\n\n\ud83e\udd23  yep that's exactly right. I can do that, but I think that \"map of lists\" is a common enough data structure that it is passable as is. I think the gains from creating an entirely new class for this will be very little in terms of readability and intuitiveness. what do you think?", "url": "https://github.com/aws-amplify/amplify-android/pull/930#discussion_r512157484", "createdAt": "2020-10-26T17:52:18Z", "author": {"login": "raphkim"}, "path": "aws-api/src/main/java/com/amplifyframework/api/aws/AWSApiPlugin.java", "diffHunk": "@@ -291,7 +292,7 @@ public String getVersion() {\n             try {\n                 AppSyncGraphQLRequest<R> appSyncRequest = (AppSyncGraphQLRequest<R>) request;\n                 AuthRule ownerRuleWithReadRestriction = null;\n-                ArrayList<String> readAuthorizedGroups = new ArrayList<>();\n+                Map<String, List<String>> readAuthorizedGroupsMap = new HashMap<>();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjE1MjA5NQ=="}, "originalCommit": {"oid": "902bb379f6a2fd2e60c5796cabb19849dfab3f69"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjE3MTA5Mg==", "bodyText": "Yea, it's not a big deal either way. Up to you. The benefit of doing the class is that you'll get to give a semantic label to the key and to the values. Looking at this readAuthorizedGroupsMap right now, I'm not certain what the key is, until I scroll down and look at the impl.", "url": "https://github.com/aws-amplify/amplify-android/pull/930#discussion_r512171092", "createdAt": "2020-10-26T18:14:22Z", "author": {"login": "jamesonwilliams"}, "path": "aws-api/src/main/java/com/amplifyframework/api/aws/AWSApiPlugin.java", "diffHunk": "@@ -291,7 +292,7 @@ public String getVersion() {\n             try {\n                 AppSyncGraphQLRequest<R> appSyncRequest = (AppSyncGraphQLRequest<R>) request;\n                 AuthRule ownerRuleWithReadRestriction = null;\n-                ArrayList<String> readAuthorizedGroups = new ArrayList<>();\n+                Map<String, List<String>> readAuthorizedGroupsMap = new HashMap<>();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjE1MjA5NQ=="}, "originalCommit": {"oid": "902bb379f6a2fd2e60c5796cabb19849dfab3f69"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjI1Mjg0Ng==", "bodyText": "Yeah I feel the benefit to seeing right away the structure of the data from the map outweighs the benefit of creating a custom class for naming purposes.", "url": "https://github.com/aws-amplify/amplify-android/pull/930#discussion_r512252846", "createdAt": "2020-10-26T20:37:59Z", "author": {"login": "TrekSoft"}, "path": "aws-api/src/main/java/com/amplifyframework/api/aws/AWSApiPlugin.java", "diffHunk": "@@ -291,7 +292,7 @@ public String getVersion() {\n             try {\n                 AppSyncGraphQLRequest<R> appSyncRequest = (AppSyncGraphQLRequest<R>) request;\n                 AuthRule ownerRuleWithReadRestriction = null;\n-                ArrayList<String> readAuthorizedGroups = new ArrayList<>();\n+                Map<String, List<String>> readAuthorizedGroupsMap = new HashMap<>();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjE1MjA5NQ=="}, "originalCommit": {"oid": "902bb379f6a2fd2e60c5796cabb19849dfab3f69"}, "originalPosition": 13}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIwODgyMDY1OnYy", "diffSide": "RIGHT", "path": "aws-api/src/main/java/com/amplifyframework/api/aws/AWSApiPlugin.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yNlQxNzo0NDo1N1rOHobUGA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yNlQxODoxMjo0OFrOHocYyA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjE1MjYwMA==", "bodyText": "How can we carve more of this logic out of the AWSApiPlugin?", "url": "https://github.com/aws-amplify/amplify-android/pull/930#discussion_r512152600", "createdAt": "2020-10-26T17:44:57Z", "author": {"login": "jamesonwilliams"}, "path": "aws-api/src/main/java/com/amplifyframework/api/aws/AWSApiPlugin.java", "diffHunk": "@@ -361,65 +363,61 @@ private boolean isReadRestrictingOwner(AuthRule authRule) {\n \n     private boolean isReadRestrictingStaticGroup(AuthRule authRule) {\n         return AuthStrategy.GROUPS.equals(authRule.getAuthStrategy())\n-            && authRule.getGroups() != null && !authRule.getGroups().isEmpty()\n+            && !authRule.getGroups().isEmpty()\n             && authRule.getOperationsOrDefault().contains(ModelOperation.READ);\n     }\n \n     private String getIdentityValue(String identityClaim, AuthorizationType authType) throws ApiException {\n-        String identityValue = null;\n-\n         try {\n-            identityValue = CognitoJWTParser\n+            return CognitoJWTParser\n                     .getPayload(getAuthToken(authType))\n                     .getString(identityClaim);\n         } catch (JSONException | CognitoParameterInvalidException error) {\n-            // Could not read identity value from the token...\n-            // Exception will be thrown so do nothing for now\n-        }\n-\n-        if (identityValue == null || identityValue.isEmpty()) {\n             throw new ApiException(\n-                    \"Attempted to subscribe to a model with owner based authorization without \" + identityClaim + \" \" +\n-                    \"which was specified (or defaulted to) as the identity claim.\",\n+                    \"Attempted to subscribe to a model with owner-based authorization without \" + identityClaim + \" \" +\n+                            \"which was specified (or defaulted to) as the identity claim.\",\n                     \"If you did not specify a custom identityClaim in your schema, make sure you are logged in. If \" +\n                             \"you did, check that the value you specified in your schema is present in the access key.\"\n             );\n         }\n-\n-        return identityValue;\n     }\n \n-    private ArrayList<String> getUserGroups(AuthorizationType authType) throws ApiException {\n-        // Custom groups claim isn't supported yet.\n-        if (!AuthorizationType.AMAZON_COGNITO_USER_POOLS.equals(authType)) {\n-            throw new ApiException(\"Custom groups claim is not supported yet.\",\n-                    \"Please use Amazon Cognito User Pools to authorize your API.\");\n-        }\n-\n+    private ArrayList<String> getUserGroups(String groupClaim, AuthorizationType authType) throws ApiException {\n         ArrayList<String> groups = new ArrayList<>();\n-        final String GROUPS_KEY = \"cognito:groups\";\n-\n         try {\n-            JSONObject accessToken = CognitoJWTParser.getPayload(getAuthToken(authType));\n-\n-            if (accessToken.has(GROUPS_KEY)) {\n-                JSONArray jsonGroups = accessToken.getJSONArray(GROUPS_KEY);\n-\n-                for (int i = 0; i < jsonGroups.length(); i++) {\n-                    groups.add(jsonGroups.getString(i));\n+            JSONObject accessToken = CognitoJWTParser\n+                    .getPayload(getAuthToken(authType));\n+            if (accessToken.has(groupClaim)) {\n+                JSONArray jsonGroups = accessToken.getJSONArray(groupClaim);\n+                for (int index = 0; index < jsonGroups.length(); index++) {\n+                    groups.add(jsonGroups.getString(index));\n                 }\n             }\n         } catch (JSONException | CognitoParameterInvalidException error) {\n             throw new ApiException(\n-                    \"Failed to parse groups from auth rule.\",\n-                    error,\n-                    \"This should never happen - see attached exception for more details and report to us on GitHub.\"\n+                    \"Failed to parse group claim from the token.\",\n+                    AmplifyException.REPORT_BUG_TO_AWS_SUGGESTION\n             );\n         }\n \n         return groups;\n     }\n \n+    private boolean userNotInReadRestrictingGroups(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "902bb379f6a2fd2e60c5796cabb19849dfab3f69"}, "originalPosition": 139}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjE1ODMzOQ==", "bodyText": "this will have to be merge-conflicted in my other PR, ugh. This helper method will definitely not live in the plugin code for long.", "url": "https://github.com/aws-amplify/amplify-android/pull/930#discussion_r512158339", "createdAt": "2020-10-26T17:53:45Z", "author": {"login": "raphkim"}, "path": "aws-api/src/main/java/com/amplifyframework/api/aws/AWSApiPlugin.java", "diffHunk": "@@ -361,65 +363,61 @@ private boolean isReadRestrictingOwner(AuthRule authRule) {\n \n     private boolean isReadRestrictingStaticGroup(AuthRule authRule) {\n         return AuthStrategy.GROUPS.equals(authRule.getAuthStrategy())\n-            && authRule.getGroups() != null && !authRule.getGroups().isEmpty()\n+            && !authRule.getGroups().isEmpty()\n             && authRule.getOperationsOrDefault().contains(ModelOperation.READ);\n     }\n \n     private String getIdentityValue(String identityClaim, AuthorizationType authType) throws ApiException {\n-        String identityValue = null;\n-\n         try {\n-            identityValue = CognitoJWTParser\n+            return CognitoJWTParser\n                     .getPayload(getAuthToken(authType))\n                     .getString(identityClaim);\n         } catch (JSONException | CognitoParameterInvalidException error) {\n-            // Could not read identity value from the token...\n-            // Exception will be thrown so do nothing for now\n-        }\n-\n-        if (identityValue == null || identityValue.isEmpty()) {\n             throw new ApiException(\n-                    \"Attempted to subscribe to a model with owner based authorization without \" + identityClaim + \" \" +\n-                    \"which was specified (or defaulted to) as the identity claim.\",\n+                    \"Attempted to subscribe to a model with owner-based authorization without \" + identityClaim + \" \" +\n+                            \"which was specified (or defaulted to) as the identity claim.\",\n                     \"If you did not specify a custom identityClaim in your schema, make sure you are logged in. If \" +\n                             \"you did, check that the value you specified in your schema is present in the access key.\"\n             );\n         }\n-\n-        return identityValue;\n     }\n \n-    private ArrayList<String> getUserGroups(AuthorizationType authType) throws ApiException {\n-        // Custom groups claim isn't supported yet.\n-        if (!AuthorizationType.AMAZON_COGNITO_USER_POOLS.equals(authType)) {\n-            throw new ApiException(\"Custom groups claim is not supported yet.\",\n-                    \"Please use Amazon Cognito User Pools to authorize your API.\");\n-        }\n-\n+    private ArrayList<String> getUserGroups(String groupClaim, AuthorizationType authType) throws ApiException {\n         ArrayList<String> groups = new ArrayList<>();\n-        final String GROUPS_KEY = \"cognito:groups\";\n-\n         try {\n-            JSONObject accessToken = CognitoJWTParser.getPayload(getAuthToken(authType));\n-\n-            if (accessToken.has(GROUPS_KEY)) {\n-                JSONArray jsonGroups = accessToken.getJSONArray(GROUPS_KEY);\n-\n-                for (int i = 0; i < jsonGroups.length(); i++) {\n-                    groups.add(jsonGroups.getString(i));\n+            JSONObject accessToken = CognitoJWTParser\n+                    .getPayload(getAuthToken(authType));\n+            if (accessToken.has(groupClaim)) {\n+                JSONArray jsonGroups = accessToken.getJSONArray(groupClaim);\n+                for (int index = 0; index < jsonGroups.length(); index++) {\n+                    groups.add(jsonGroups.getString(index));\n                 }\n             }\n         } catch (JSONException | CognitoParameterInvalidException error) {\n             throw new ApiException(\n-                    \"Failed to parse groups from auth rule.\",\n-                    error,\n-                    \"This should never happen - see attached exception for more details and report to us on GitHub.\"\n+                    \"Failed to parse group claim from the token.\",\n+                    AmplifyException.REPORT_BUG_TO_AWS_SUGGESTION\n             );\n         }\n \n         return groups;\n     }\n \n+    private boolean userNotInReadRestrictingGroups(", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjE1MjYwMA=="}, "originalCommit": {"oid": "902bb379f6a2fd2e60c5796cabb19849dfab3f69"}, "originalPosition": 139}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjE3MDE4NA==", "bodyText": "Ah right, I forgot that wasn't in, yet. I was like \"damn, I thought we moved some of this out already...\"\nSounds good. I remember you saying you'd rebase that one onto this. That plan works.", "url": "https://github.com/aws-amplify/amplify-android/pull/930#discussion_r512170184", "createdAt": "2020-10-26T18:12:48Z", "author": {"login": "jamesonwilliams"}, "path": "aws-api/src/main/java/com/amplifyframework/api/aws/AWSApiPlugin.java", "diffHunk": "@@ -361,65 +363,61 @@ private boolean isReadRestrictingOwner(AuthRule authRule) {\n \n     private boolean isReadRestrictingStaticGroup(AuthRule authRule) {\n         return AuthStrategy.GROUPS.equals(authRule.getAuthStrategy())\n-            && authRule.getGroups() != null && !authRule.getGroups().isEmpty()\n+            && !authRule.getGroups().isEmpty()\n             && authRule.getOperationsOrDefault().contains(ModelOperation.READ);\n     }\n \n     private String getIdentityValue(String identityClaim, AuthorizationType authType) throws ApiException {\n-        String identityValue = null;\n-\n         try {\n-            identityValue = CognitoJWTParser\n+            return CognitoJWTParser\n                     .getPayload(getAuthToken(authType))\n                     .getString(identityClaim);\n         } catch (JSONException | CognitoParameterInvalidException error) {\n-            // Could not read identity value from the token...\n-            // Exception will be thrown so do nothing for now\n-        }\n-\n-        if (identityValue == null || identityValue.isEmpty()) {\n             throw new ApiException(\n-                    \"Attempted to subscribe to a model with owner based authorization without \" + identityClaim + \" \" +\n-                    \"which was specified (or defaulted to) as the identity claim.\",\n+                    \"Attempted to subscribe to a model with owner-based authorization without \" + identityClaim + \" \" +\n+                            \"which was specified (or defaulted to) as the identity claim.\",\n                     \"If you did not specify a custom identityClaim in your schema, make sure you are logged in. If \" +\n                             \"you did, check that the value you specified in your schema is present in the access key.\"\n             );\n         }\n-\n-        return identityValue;\n     }\n \n-    private ArrayList<String> getUserGroups(AuthorizationType authType) throws ApiException {\n-        // Custom groups claim isn't supported yet.\n-        if (!AuthorizationType.AMAZON_COGNITO_USER_POOLS.equals(authType)) {\n-            throw new ApiException(\"Custom groups claim is not supported yet.\",\n-                    \"Please use Amazon Cognito User Pools to authorize your API.\");\n-        }\n-\n+    private ArrayList<String> getUserGroups(String groupClaim, AuthorizationType authType) throws ApiException {\n         ArrayList<String> groups = new ArrayList<>();\n-        final String GROUPS_KEY = \"cognito:groups\";\n-\n         try {\n-            JSONObject accessToken = CognitoJWTParser.getPayload(getAuthToken(authType));\n-\n-            if (accessToken.has(GROUPS_KEY)) {\n-                JSONArray jsonGroups = accessToken.getJSONArray(GROUPS_KEY);\n-\n-                for (int i = 0; i < jsonGroups.length(); i++) {\n-                    groups.add(jsonGroups.getString(i));\n+            JSONObject accessToken = CognitoJWTParser\n+                    .getPayload(getAuthToken(authType));\n+            if (accessToken.has(groupClaim)) {\n+                JSONArray jsonGroups = accessToken.getJSONArray(groupClaim);\n+                for (int index = 0; index < jsonGroups.length(); index++) {\n+                    groups.add(jsonGroups.getString(index));\n                 }\n             }\n         } catch (JSONException | CognitoParameterInvalidException error) {\n             throw new ApiException(\n-                    \"Failed to parse groups from auth rule.\",\n-                    error,\n-                    \"This should never happen - see attached exception for more details and report to us on GitHub.\"\n+                    \"Failed to parse group claim from the token.\",\n+                    AmplifyException.REPORT_BUG_TO_AWS_SUGGESTION\n             );\n         }\n \n         return groups;\n     }\n \n+    private boolean userNotInReadRestrictingGroups(", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjE1MjYwMA=="}, "originalCommit": {"oid": "902bb379f6a2fd2e60c5796cabb19849dfab3f69"}, "originalPosition": 139}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIwODgyNjMxOnYy", "diffSide": "RIGHT", "path": "aws-api/src/test/java/com/amplifyframework/api/aws/auth/OwnerBasedAuthTest.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yNlQxNzo0NjowN1rOHobXaw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yNlQxNzo1NDozOVrOHobs7Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjE1MzQ1MQ==", "bodyText": "How are group A and B different? Can  you give semantic names, PRIVILEGED_GROUP, NO_ACCESS_GROUP Or ALICE_GROUP and BOB_GROUP, with a little comment about the security relationship between Alice and Bob?", "url": "https://github.com/aws-amplify/amplify-android/pull/930#discussion_r512153451", "createdAt": "2020-10-26T17:46:07Z", "author": {"login": "jamesonwilliams"}, "path": "aws-api/src/test/java/com/amplifyframework/api/aws/auth/OwnerBasedAuthTest.java", "diffHunk": "@@ -68,6 +68,9 @@\n     private static final String GRAPHQL_API_WITH_COGNITO = \"graphQlApi_cognito\";\n     private static final String GRAPHQL_API_WITH_OIDC = \"graphQlApi_oidc\";\n \n+    private static final String GROUP_A = \"http://myapp1.com/claims/groups\";\n+    private static final String GROUP_B = \"http://myapp2.com/claims/groups\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "902bb379f6a2fd2e60c5796cabb19849dfab3f69"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjE1ODk1Nw==", "bodyText": "This actually doesn't get used at the moment, but snuck its way in the PR... I'll take out the unused items from the unit test.", "url": "https://github.com/aws-amplify/amplify-android/pull/930#discussion_r512158957", "createdAt": "2020-10-26T17:54:39Z", "author": {"login": "raphkim"}, "path": "aws-api/src/test/java/com/amplifyframework/api/aws/auth/OwnerBasedAuthTest.java", "diffHunk": "@@ -68,6 +68,9 @@\n     private static final String GRAPHQL_API_WITH_COGNITO = \"graphQlApi_cognito\";\n     private static final String GRAPHQL_API_WITH_OIDC = \"graphQlApi_oidc\";\n \n+    private static final String GROUP_A = \"http://myapp1.com/claims/groups\";\n+    private static final String GROUP_B = \"http://myapp2.com/claims/groups\";", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjE1MzQ1MQ=="}, "originalCommit": {"oid": "902bb379f6a2fd2e60c5796cabb19849dfab3f69"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIwOTQ3ODE2OnYy", "diffSide": "RIGHT", "path": "aws-api/src/main/java/com/amplifyframework/api/aws/AWSApiPlugin.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yNlQyMDo0Mjo1NlrOHohmBg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOFQyMDozNzoyOFrOHp8eSQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjI1NTQ5NA==", "bodyText": "Why remove the null check?", "url": "https://github.com/aws-amplify/amplify-android/pull/930#discussion_r512255494", "createdAt": "2020-10-26T20:42:56Z", "author": {"login": "TrekSoft"}, "path": "aws-api/src/main/java/com/amplifyframework/api/aws/AWSApiPlugin.java", "diffHunk": "@@ -361,65 +363,61 @@ private boolean isReadRestrictingOwner(AuthRule authRule) {\n \n     private boolean isReadRestrictingStaticGroup(AuthRule authRule) {\n         return AuthStrategy.GROUPS.equals(authRule.getAuthStrategy())\n-            && authRule.getGroups() != null && !authRule.getGroups().isEmpty()\n+            && !authRule.getGroups().isEmpty()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "902bb379f6a2fd2e60c5796cabb19849dfab3f69"}, "originalPosition": 68}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzc0NDQ1Nw==", "bodyText": "It's redundant because AuthRule#getGroups() explicitly has @NonNull return value :)", "url": "https://github.com/aws-amplify/amplify-android/pull/930#discussion_r513744457", "createdAt": "2020-10-28T20:37:28Z", "author": {"login": "raphkim"}, "path": "aws-api/src/main/java/com/amplifyframework/api/aws/AWSApiPlugin.java", "diffHunk": "@@ -361,65 +363,61 @@ private boolean isReadRestrictingOwner(AuthRule authRule) {\n \n     private boolean isReadRestrictingStaticGroup(AuthRule authRule) {\n         return AuthStrategy.GROUPS.equals(authRule.getAuthStrategy())\n-            && authRule.getGroups() != null && !authRule.getGroups().isEmpty()\n+            && !authRule.getGroups().isEmpty()", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjI1NTQ5NA=="}, "originalCommit": {"oid": "902bb379f6a2fd2e60c5796cabb19849dfab3f69"}, "originalPosition": 68}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIxMjg2Njk3OnYy", "diffSide": "LEFT", "path": "aws-api/src/main/java/com/amplifyframework/api/aws/AWSApiPlugin.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yN1QxNToxMTo1OFrOHpBb8w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOFQyMTowMDoyNVrOHp9PEA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjc3NzIwMw==", "bodyText": "The reason this was done the way it was is because an error won't be thrown if the identityClaim key is present but empty. And it seemed to make sense to throw the error in that case.", "url": "https://github.com/aws-amplify/amplify-android/pull/930#discussion_r512777203", "createdAt": "2020-10-27T15:11:58Z", "author": {"login": "TrekSoft"}, "path": "aws-api/src/main/java/com/amplifyframework/api/aws/AWSApiPlugin.java", "diffHunk": "@@ -361,65 +363,61 @@ private boolean isReadRestrictingOwner(AuthRule authRule) {\n \n     private boolean isReadRestrictingStaticGroup(AuthRule authRule) {\n         return AuthStrategy.GROUPS.equals(authRule.getAuthStrategy())\n-            && authRule.getGroups() != null && !authRule.getGroups().isEmpty()\n+            && !authRule.getGroups().isEmpty()\n             && authRule.getOperationsOrDefault().contains(ModelOperation.READ);\n     }\n \n     private String getIdentityValue(String identityClaim, AuthorizationType authType) throws ApiException {\n-        String identityValue = null;\n-\n         try {\n-            identityValue = CognitoJWTParser\n+            return CognitoJWTParser\n                     .getPayload(getAuthToken(authType))\n                     .getString(identityClaim);\n         } catch (JSONException | CognitoParameterInvalidException error) {\n-            // Could not read identity value from the token...\n-            // Exception will be thrown so do nothing for now\n-        }\n-\n-        if (identityValue == null || identityValue.isEmpty()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "902bb379f6a2fd2e60c5796cabb19849dfab3f69"}, "originalPosition": 85}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzc1MzIwMQ==", "bodyText": "i don't think that's something that should be caught in the client side. It should be treated the same as having an incorrect/non-existent username, which should be caught by the server.", "url": "https://github.com/aws-amplify/amplify-android/pull/930#discussion_r513753201", "createdAt": "2020-10-28T20:54:01Z", "author": {"login": "raphkim"}, "path": "aws-api/src/main/java/com/amplifyframework/api/aws/AWSApiPlugin.java", "diffHunk": "@@ -361,65 +363,61 @@ private boolean isReadRestrictingOwner(AuthRule authRule) {\n \n     private boolean isReadRestrictingStaticGroup(AuthRule authRule) {\n         return AuthStrategy.GROUPS.equals(authRule.getAuthStrategy())\n-            && authRule.getGroups() != null && !authRule.getGroups().isEmpty()\n+            && !authRule.getGroups().isEmpty()\n             && authRule.getOperationsOrDefault().contains(ModelOperation.READ);\n     }\n \n     private String getIdentityValue(String identityClaim, AuthorizationType authType) throws ApiException {\n-        String identityValue = null;\n-\n         try {\n-            identityValue = CognitoJWTParser\n+            return CognitoJWTParser\n                     .getPayload(getAuthToken(authType))\n                     .getString(identityClaim);\n         } catch (JSONException | CognitoParameterInvalidException error) {\n-            // Could not read identity value from the token...\n-            // Exception will be thrown so do nothing for now\n-        }\n-\n-        if (identityValue == null || identityValue.isEmpty()) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjc3NzIwMw=="}, "originalCommit": {"oid": "902bb379f6a2fd2e60c5796cabb19849dfab3f69"}, "originalPosition": 85}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzc1Njk0NA==", "bodyText": "Fair enough", "url": "https://github.com/aws-amplify/amplify-android/pull/930#discussion_r513756944", "createdAt": "2020-10-28T21:00:25Z", "author": {"login": "TrekSoft"}, "path": "aws-api/src/main/java/com/amplifyframework/api/aws/AWSApiPlugin.java", "diffHunk": "@@ -361,65 +363,61 @@ private boolean isReadRestrictingOwner(AuthRule authRule) {\n \n     private boolean isReadRestrictingStaticGroup(AuthRule authRule) {\n         return AuthStrategy.GROUPS.equals(authRule.getAuthStrategy())\n-            && authRule.getGroups() != null && !authRule.getGroups().isEmpty()\n+            && !authRule.getGroups().isEmpty()\n             && authRule.getOperationsOrDefault().contains(ModelOperation.READ);\n     }\n \n     private String getIdentityValue(String identityClaim, AuthorizationType authType) throws ApiException {\n-        String identityValue = null;\n-\n         try {\n-            identityValue = CognitoJWTParser\n+            return CognitoJWTParser\n                     .getPayload(getAuthToken(authType))\n                     .getString(identityClaim);\n         } catch (JSONException | CognitoParameterInvalidException error) {\n-            // Could not read identity value from the token...\n-            // Exception will be thrown so do nothing for now\n-        }\n-\n-        if (identityValue == null || identityValue.isEmpty()) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjc3NzIwMw=="}, "originalCommit": {"oid": "902bb379f6a2fd2e60c5796cabb19849dfab3f69"}, "originalPosition": 85}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 999, "cost": 1, "resetAt": "2021-11-12T09:44:50Z"}}}