{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzcxMTcyMDA5", "number": 87, "title": "Made RCA Sqlite retention configurable with config file", "bodyText": "*Description of changes: RCA file retention made configurable using rca config\nBy submitting this pull request, I confirm that my contribution is made under the terms of the Apache 2.0 license.", "createdAt": "2020-02-05T04:02:44Z", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/87", "merged": true, "mergeCommit": {"oid": "a097e4df18ca9e86454743e0fbbf050823f2b156"}, "closed": true, "closedAt": "2020-02-05T21:17:21Z", "author": {"login": "palashhedau"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcBN_zqAH2gAyMzcxMTcyMDA5OjI2MWZkNTUzZTQ1ZDQ5MDUzYmE0ZmI1MThjYTFhNzM1MmU4ODNkNGY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcBcNAIgFqTM1NDAxOTkxNA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "261fd553e45d49053ba4fb518ca1a7352e883d4f", "author": {"user": null}, "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/commit/261fd553e45d49053ba4fb518ca1a7352e883d4f", "committedDate": "2020-02-05T03:58:28Z", "message": "Made RCA Sqlite retention configurable with config file"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "644505ebde0d1acd075e32e0b739f5ccda7b403b", "author": {"user": null}, "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/commit/644505ebde0d1acd075e32e0b739f5ccda7b403b", "committedDate": "2020-02-05T18:44:13Z", "message": "Fixed checkstyle"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUzOTg0ODI0", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/87#pullrequestreview-353984824", "createdAt": "2020-02-05T19:33:41Z", "commit": {"oid": "644505ebde0d1acd075e32e0b739f5ccda7b403b"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNVQxOTozMzo0MVrOFmEg4g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNVQxOTo0NjoxNlrOFmE6dA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTQ2NDE2Mg==", "bodyText": "can we make it screaming snake case for final fields ?", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/87#discussion_r375464162", "createdAt": "2020-02-05T19:33:41Z", "author": {"login": "yojs"}, "path": "src/main/java/com/amazon/opendistro/elasticsearch/performanceanalyzer/rca/persistence/PersistorBase.java", "diffHunk": "@@ -48,11 +51,12 @@\n   protected String filenameParam;\n   protected String dbProtocol;\n   private static final int FILE_ROTATION_PERIOD_SECS = 3600;\n-  private static final int SQLITE_FILES_TO_KEEP = 5;\n+  private final int storageFileRetentionCount;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "644505ebde0d1acd075e32e0b739f5ccda7b403b"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTQ3MDcwOA==", "bodyText": "The default constructor takes the current time new Date()", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/87#discussion_r375470708", "createdAt": "2020-02-05T19:46:16Z", "author": {"login": "yojs"}, "path": "src/main/java/com/amazon/opendistro/elasticsearch/performanceanalyzer/rca/persistence/PersistorBase.java", "diffHunk": "@@ -122,14 +134,26 @@ public synchronized void openNewDBFile() throws SQLException {\n     createNewDSLContext();\n   }\n \n+  /**\n+   * This method check if there is a need to delete old sqlite files and create a new one.\n+   * Ideally we will be using new sqlite files at the start of every hour, ideally the whenever the\n+   * function write is called for the first time in that very hour\n+   */\n   public synchronized void rotateDBIfRequired() throws ParseException, SQLException {\n-    Date currTimeMs = new Date(System.currentTimeMillis());\n-    if ((currTimeMs.getTime() - this.fileCreateTime.getTime()) / 1000 > FILE_ROTATION_PERIOD_SECS) {\n+    LocalDateTime currentLocalDateTime = getLocalDateTimeFromDateObj(new Date(System.currentTimeMillis()));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "644505ebde0d1acd075e32e0b739f5ccda7b403b"}, "originalPosition": 52}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8450f180af17b0c16a1e9553052e223b93a1d953", "author": {"user": null}, "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/commit/8450f180af17b0c16a1e9553052e223b93a1d953", "committedDate": "2020-02-05T20:24:25Z", "message": "Fixes - Minor Bug and variable names"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9e102e04f6dec6ec69aa596c62db6f3eaf5e91de", "author": {"user": null}, "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/commit/9e102e04f6dec6ec69aa596c62db6f3eaf5e91de", "committedDate": "2020-02-05T20:26:55Z", "message": "Merge branch 'palash-rca-sqlite-merge' of github.com:opendistro-for-elasticsearch/performance-analyzer-rca into palash-rca-sqlite-merge"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU0MDE5OTE0", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/87#pullrequestreview-354019914", "createdAt": "2020-02-05T20:31:33Z", "commit": {"oid": "9e102e04f6dec6ec69aa596c62db6f3eaf5e91de"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1140, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}