{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDAwNDg2NjQ2", "number": 135, "title": "Added unit tests for rca.samplers and rca.util", "bodyText": "Issue #, if available: 51\nDescription of changes:\n\nChanged visibility of a few variables and methods to allow for testing\nAdded ability to create new NodeDetails elements to the ClusterDetailsEventProcessorTestHelper class\n\nTests:\n\nRcaEnabledSamplerTest: Basic test which verified the construction and sampling behavior of the uut\nModified NodeStateManagerTest to not rely on mocks\nAdded the RcaStateSamplersTest which does basic constructor coverage. We can't ignore this package, so this test is minor, but necessary for improved coverage\nAdded the ClusterUtilsTest which verifies ClusterUtils behavior\n\nCode coverage percentage for this patch: 93% for rca.samplers\n89% for rca.util\nBy submitting this pull request, I confirm that my contribution is made under the terms of the Apache 2.0 license.", "createdAt": "2020-04-07T20:30:14Z", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/135", "merged": true, "mergeCommit": {"oid": "090ce0a7f86a51ad0d83bb10b227392409344c02"}, "closed": true, "closedAt": "2020-04-23T20:33:14Z", "author": {"login": "sidheart"}, "timelineItems": {"totalCount": 13, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcWDo9OAFqTM5MTE1MzIxNw==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcaisR3gFqTM5OTQ0MTEzNA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkxMTUzMjE3", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/135#pullrequestreview-391153217", "createdAt": "2020-04-09T21:44:28Z", "commit": {"oid": "70c92cf809c7c0399a4e760bdec5d00f5fec4f63"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOVQyMTo0NDoyOVrOGDqgTw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOVQyMTo0NDoyOVrOGDqgTw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjQ5NTMxMQ==", "bodyText": "I would suggest we don't use static classes or initializes as much as possible.\nThe thing is your UT framework initializes once. If you set something in a static object in one of the tests, it stays there (unless explicitly reset after the tests pass). This can cause weird behaviors in your tests based on the order they execute etc.\nIf we can remove them, it will be great.", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/135#discussion_r406495311", "createdAt": "2020-04-09T21:44:29Z", "author": {"login": "yojs"}, "path": "src/main/java/com/amazon/opendistro/elasticsearch/performanceanalyzer/rca/ControllerUtil.java", "diffHunk": "@@ -0,0 +1,21 @@\n+package com.amazon.opendistro.elasticsearch.performanceanalyzer.rca;\n+\n+/**\n+ * ControllerUtil is a singleton which provides visibility into {@link RcaController}'s state\n+ */\n+public class ControllerUtil {\n+    public static final ControllerUtil API = new ControllerUtil();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "70c92cf809c7c0399a4e760bdec5d00f5fec4f63"}, "originalPosition": 7}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "70c92cf809c7c0399a4e760bdec5d00f5fec4f63", "author": {"user": null}, "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/commit/70c92cf809c7c0399a4e760bdec5d00f5fec4f63", "committedDate": "2020-04-07T20:26:06Z", "message": "Added unit tests for the rca.util package\n\nThis required a few structural changes:\n- ClusterDetailsEventProcessor and ClusterUtils are now singletons\ninstead of exposing logic through static methods\n- ControllerUtil is a new singleton class which allows RcaController to\nmodify the isRcaEnabled state variable and allows clients to read this\nvolatile variable\n- Classes affected by the changes above have been modified and their\nunit tests have been updated."}, "afterCommit": {"oid": "ae79386ecc6188920a62005b558d3c68f1cb7bbe", "author": {"user": null}, "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/commit/ae79386ecc6188920a62005b558d3c68f1cb7bbe", "committedDate": "2020-04-14T18:43:15Z", "message": "Added unit tests for the rca.util package\n\nThis required a few structural changes:\n- ClusterDetailsEventProcessor and ClusterUtils are now singletons\ninstead of exposing logic through static methods\n- Classes affected by the changes above have been modified and their\nunit tests have been updated."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk0MTgwNDg4", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/135#pullrequestreview-394180488", "createdAt": "2020-04-15T22:32:25Z", "commit": {"oid": "ae79386ecc6188920a62005b558d3c68f1cb7bbe"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQyMjozMjoyNVrOGGN6Sw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQyMjozMjoyNVrOGGN6Sw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTE3MjU1NQ==", "bodyText": "We discussed that we will remove this new dependency, right ?", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/135#discussion_r409172555", "createdAt": "2020-04-15T22:32:25Z", "author": {"login": "yojs"}, "path": "build.gradle", "diffHunk": "@@ -230,11 +230,14 @@ dependencies {\n     compile group: 'org.apache.logging.log4j', name: 'log4j-core', version: '2.13.0'\n     compile group: 'org.apache.commons', name: 'commons-lang3', version: '3.9'\n     compile group: 'commons-io', name: 'commons-io', version: '2.3'\n+    compile 'org.projectlombok:lombok:1.18.12'\n     implementation 'io.grpc:grpc-netty-shaded:1.25.0'\n     implementation 'io.grpc:grpc-protobuf:1.25.0'\n     implementation 'io.grpc:grpc-stub:1.25.0'\n     implementation 'javax.annotation:javax.annotation-api:1.3.2'\n \n+    annotationProcessor 'org.projectlombok:lombok:1.18.12'", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ae79386ecc6188920a62005b558d3c68f1cb7bbe"}, "originalPosition": 10}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ae79386ecc6188920a62005b558d3c68f1cb7bbe", "author": {"user": null}, "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/commit/ae79386ecc6188920a62005b558d3c68f1cb7bbe", "committedDate": "2020-04-14T18:43:15Z", "message": "Added unit tests for the rca.util package\n\nThis required a few structural changes:\n- ClusterDetailsEventProcessor and ClusterUtils are now singletons\ninstead of exposing logic through static methods\n- Classes affected by the changes above have been modified and their\nunit tests have been updated."}, "afterCommit": {"oid": "027277c1a6b563ebb6dceafe922d28fde78b266e", "author": {"user": null}, "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/commit/027277c1a6b563ebb6dceafe922d28fde78b266e", "committedDate": "2020-04-21T20:54:43Z", "message": "Added unit tests for the rca.util package\n\nThis required a few structural changes:\n- ClusterDetailsEventProcessor and ClusterUtils are now singletons\ninstead of exposing logic through static methods\n- Classes affected by the changes above have been modified and their\nunit tests have been updated."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "027277c1a6b563ebb6dceafe922d28fde78b266e", "author": {"user": null}, "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/commit/027277c1a6b563ebb6dceafe922d28fde78b266e", "committedDate": "2020-04-21T20:54:43Z", "message": "Added unit tests for the rca.util package\n\nThis required a few structural changes:\n- ClusterDetailsEventProcessor and ClusterUtils are now singletons\ninstead of exposing logic through static methods\n- Classes affected by the changes above have been modified and their\nunit tests have been updated."}, "afterCommit": {"oid": "136ae39c8aede3b1fa001e2869a27ade948f7404", "author": {"user": null}, "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/commit/136ae39c8aede3b1fa001e2869a27ade948f7404", "committedDate": "2020-04-21T21:11:13Z", "message": "Added unit tests for the rca.util package\n\nThis required a few structural changes:\n- ClusterDetailsEventProcessor and ClusterUtils are now singletons\ninstead of exposing logic through static methods\n- Classes affected by the changes above have been modified and their\nunit tests have been updated."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "136ae39c8aede3b1fa001e2869a27ade948f7404", "author": {"user": null}, "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/commit/136ae39c8aede3b1fa001e2869a27ade948f7404", "committedDate": "2020-04-21T21:11:13Z", "message": "Added unit tests for the rca.util package\n\nThis required a few structural changes:\n- ClusterDetailsEventProcessor and ClusterUtils are now singletons\ninstead of exposing logic through static methods\n- Classes affected by the changes above have been modified and their\nunit tests have been updated."}, "afterCommit": {"oid": "f0bfef0e01245d3fa4a8b6a49a464c6e5236150e", "author": {"user": null}, "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/commit/f0bfef0e01245d3fa4a8b6a49a464c6e5236150e", "committedDate": "2020-04-21T21:40:55Z", "message": "Added unit tests for the rca.util package\n\nThis required a few structural changes:\n- ClusterDetailsEventProcessor and ClusterUtils are now singletons\ninstead of exposing logic through static methods\n- Classes affected by the changes above have been modified and their\nunit tests have been updated."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f0bfef0e01245d3fa4a8b6a49a464c6e5236150e", "author": {"user": null}, "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/commit/f0bfef0e01245d3fa4a8b6a49a464c6e5236150e", "committedDate": "2020-04-21T21:40:55Z", "message": "Added unit tests for the rca.util package\n\nThis required a few structural changes:\n- ClusterDetailsEventProcessor and ClusterUtils are now singletons\ninstead of exposing logic through static methods\n- Classes affected by the changes above have been modified and their\nunit tests have been updated."}, "afterCommit": {"oid": "6cea02050caa4e979bff98d52453ee5d13aec746", "author": {"user": null}, "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/commit/6cea02050caa4e979bff98d52453ee5d13aec746", "committedDate": "2020-04-21T21:51:40Z", "message": "Added unit tests for the rca.util package\n\nThis required a few structural changes:\n- ClusterDetailsEventProcessor and ClusterUtils are now singletons\ninstead of exposing logic through static methods\n- Classes affected by the changes above have been modified and their\nunit tests have been updated."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk4NDczMjEx", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/135#pullrequestreview-398473211", "createdAt": "2020-04-22T18:40:20Z", "commit": {"oid": "6cea02050caa4e979bff98d52453ee5d13aec746"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMlQxODo0MDoyMVrOGKFYfg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMlQxODo0MDoyMVrOGKFYfg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzIyNzEzNA==", "bodyText": "We don't need to add a constructor specifically for testing purpose. you can work around this by using a utility function API provided by another unit test. (createNodeDetailsMetrics)", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/135#discussion_r413227134", "createdAt": "2020-04-22T18:40:21Z", "author": {"login": "rguo-aws"}, "path": "src/main/java/com/amazon/opendistro/elasticsearch/performanceanalyzer/reader/ClusterDetailsEventProcessor.java", "diffHunk": "@@ -125,11 +132,27 @@ public static NodeDetails getCurrentNodeDetails() {\n \n   public static class NodeDetails {\n \n-    private String id;\n-    private String hostAddress;\n-    private String role;\n+    private final String id;\n+    private final String hostAddress;\n+    private final String role;\n     private Boolean isMasterNode;\n \n+    /**\n+     * This constructor is provided expressly for testing purposes. In general, NodeDetails should only be\n+     * retrieved through method calls such as {@link ClusterDetailsEventProcessor#getCurrentNodeDetails()}\n+     * @param id The node's id\n+     * @param hostAddress The host's address\n+     * @param role The node's role e.g. data-node\n+     * @param isMasterNode Whether or not the node is a master node\n+     */\n+    @VisibleForTesting\n+    public NodeDetails(String id, String hostAddress, String role, Boolean isMasterNode) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6cea02050caa4e979bff98d52453ee5d13aec746"}, "originalPosition": 84}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6cea02050caa4e979bff98d52453ee5d13aec746", "author": {"user": null}, "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/commit/6cea02050caa4e979bff98d52453ee5d13aec746", "committedDate": "2020-04-21T21:51:40Z", "message": "Added unit tests for the rca.util package\n\nThis required a few structural changes:\n- ClusterDetailsEventProcessor and ClusterUtils are now singletons\ninstead of exposing logic through static methods\n- Classes affected by the changes above have been modified and their\nunit tests have been updated."}, "afterCommit": {"oid": "a9a1668b4b30cc2a76b366a52f065b4d0569f550", "author": {"user": null}, "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/commit/a9a1668b4b30cc2a76b366a52f065b4d0569f550", "committedDate": "2020-04-22T20:09:28Z", "message": "Added unit tests for the rca.util and rca.samplers packages"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk4NjE2MzMw", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/135#pullrequestreview-398616330", "createdAt": "2020-04-22T21:51:40Z", "commit": {"oid": "a9a1668b4b30cc2a76b366a52f065b4d0569f550"}, "state": "APPROVED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMlQyMTo1MTo0MFrOGKNYRg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMlQyMTo1NToyMVrOGKNfMA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzM1ODE1MA==", "bodyText": "should we make all the arguments final ?", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/135#discussion_r413358150", "createdAt": "2020-04-22T21:51:40Z", "author": {"login": "yojs"}, "path": "src/test/java/com/amazon/opendistro/elasticsearch/performanceanalyzer/reader/ClusterDetailsEventProcessorTestHelper.java", "diffHunk": "@@ -33,6 +34,11 @@ public void addNodeDetails(String nodeId, String address, boolean isMasterNode)\n     nodeDetails.add(createNodeDetailsMetrics(nodeId, address, isMasterNode));\n   }\n \n+  public static ClusterDetailsEventProcessor.NodeDetails newNodeDetails(String nodeId, String address,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a9a1668b4b30cc2a76b366a52f065b4d0569f550"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzM1ODQ5MA==", "bodyText": "We added this, but are we using this ?", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/135#discussion_r413358490", "createdAt": "2020-04-22T21:52:21Z", "author": {"login": "yojs"}, "path": "src/main/java/com/amazon/opendistro/elasticsearch/performanceanalyzer/reader/ClusterDetailsEventProcessor.java", "diffHunk": "@@ -20,6 +20,7 @@\n import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.RcaControllerHelper;\n import com.amazon.opendistro.elasticsearch.performanceanalyzer.reader_writer_shared.Event;\n import com.amazon.opendistro.elasticsearch.performanceanalyzer.util.JsonConverter;\n+import com.google.common.annotations.VisibleForTesting;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a9a1668b4b30cc2a76b366a52f065b4d0569f550"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzM1ODcwMA==", "bodyText": "Maybe we can remove this file from change list ?", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/135#discussion_r413358700", "createdAt": "2020-04-22T21:52:51Z", "author": {"login": "yojs"}, "path": "src/main/java/com/amazon/opendistro/elasticsearch/performanceanalyzer/reader/ClusterDetailsEventProcessor.java", "diffHunk": "@@ -29,6 +30,7 @@\n import java.util.Set;\n import java.util.stream.Collectors;\n import javax.annotation.Nullable;\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a9a1668b4b30cc2a76b366a52f065b4d0569f550"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzM1OTkyMA==", "bodyText": "I would expect this to return a boolean :)", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/135#discussion_r413359920", "createdAt": "2020-04-22T21:55:21Z", "author": {"login": "yojs"}, "path": "src/main/java/com/amazon/opendistro/elasticsearch/performanceanalyzer/rca/samplers/RcaEnabledSampler.java", "diffHunk": "@@ -29,12 +30,12 @@ public void sample(SampleAggregator sampleCollector) {\n     sampleCollector.updateStat(RcaRuntimeMetrics.RCA_ENABLED, \"\", isRcaEnabled());\n   }\n \n-  private int isRcaEnabled() {\n+  @VisibleForTesting\n+  int isRcaEnabled() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a9a1668b4b30cc2a76b366a52f065b4d0569f550"}, "originalPosition": 14}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "37662c45d9b24ada0bda9b3d390ef901d564432c", "author": {"user": null}, "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/commit/37662c45d9b24ada0bda9b3d390ef901d564432c", "committedDate": "2020-04-23T05:26:04Z", "message": "Added unit tests for the rca.util and rca.samplers packages"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a9a1668b4b30cc2a76b366a52f065b4d0569f550", "author": {"user": null}, "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/commit/a9a1668b4b30cc2a76b366a52f065b4d0569f550", "committedDate": "2020-04-22T20:09:28Z", "message": "Added unit tests for the rca.util and rca.samplers packages"}, "afterCommit": {"oid": "37662c45d9b24ada0bda9b3d390ef901d564432c", "author": {"user": null}, "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/commit/37662c45d9b24ada0bda9b3d390ef901d564432c", "committedDate": "2020-04-23T05:26:04Z", "message": "Added unit tests for the rca.util and rca.samplers packages"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk5NDQxMTM0", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/135#pullrequestreview-399441134", "createdAt": "2020-04-23T20:13:16Z", "commit": {"oid": "37662c45d9b24ada0bda9b3d390ef901d564432c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1187, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}