{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDk3MzkzNzMw", "number": 452, "title": "Bucketized Sliding Window with Alarm Monitors", "bodyText": "This change adds a bucketized sliding window implementation.\nThe BucketizedSlidingWindow provides a SlidingWindow that can aggregate all inserts within a configured time range, (BUCKET_WINDOW_SIZE), into a single data point.\nFurther, the bucketized sliding windows are used to create an alarm monitor for jvm actions.\nTests: Added unit tests\nIf new tests are added, how long do the new ones take to complete\nBy submitting this pull request, I confirm that my contribution is made under the terms of the Apache 2.0 license.", "createdAt": "2020-10-04T08:02:30Z", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/452", "merged": true, "mergeCommit": {"oid": "6db5dd9be09cf27b915d3d355cd779ae5d3a2bb5"}, "closed": true, "closedAt": "2020-10-07T22:04:19Z", "author": {"login": "vigyasharma"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdPsSKxAFqTUwMjQ4MjgzMQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdQT0A7AFqTUwNDI3ODgwMQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAyNDgyODMx", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/452#pullrequestreview-502482831", "createdAt": "2020-10-05T23:14:04Z", "commit": {"oid": "68ad86a29854c49a70808a82aa5616e17947bcc7"}, "state": "DISMISSED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNVQyMzoxNDowNFrOHcwxeA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNVQyMzoxNDowNFrOHcwxeA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTkyMTI3Mg==", "bodyText": "nit: If you convert this to milliseconds, you get a much simpler comparison on line 40", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/452#discussion_r499921272", "createdAt": "2020-10-05T23:14:04Z", "author": {"login": "sidheart"}, "path": "src/main/java/com/amazon/opendistro/elasticsearch/performanceanalyzer/rca/framework/api/aggregators/BucketizedSlidingWindow.java", "diffHunk": "@@ -0,0 +1,72 @@\n+/*\n+ * Copyright 2020 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ * permissions and limitations under the License.\n+ */\n+\n+package com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.framework.api.aggregators;\n+\n+import java.util.concurrent.TimeUnit;\n+\n+/**\n+ * The BucketizedSlidingWindow provides a SlidingWindow implementation that can aggregate all\n+ * inserts within a configured time range, BUCKET_WINDOW_SIZE, into a single data point.\n+ *\n+ * <p>All data within a single bucket window time range is summed by default.\n+ */\n+public class BucketizedSlidingWindow extends SlidingWindow<SlidingWindowData> {\n+\n+  private final long BUCKET_WINDOW_SIZE;\n+\n+  public BucketizedSlidingWindow(int SLIDING_WINDOW_SIZE, int BUCKET_WINDOW_SIZE, TimeUnit timeUnit) {\n+    super(SLIDING_WINDOW_SIZE, timeUnit);\n+    assert BUCKET_WINDOW_SIZE < SLIDING_WINDOW_SIZE : \"BucketWindow size should be less than SlidingWindow size\";\n+    this.BUCKET_WINDOW_SIZE = timeUnit.toSeconds(BUCKET_WINDOW_SIZE);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "68ad86a29854c49a70808a82aa5616e17947bcc7"}, "originalPosition": 33}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAzMjA0ODk4", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/452#pullrequestreview-503204898", "createdAt": "2020-10-06T17:35:28Z", "commit": {"oid": "68ad86a29854c49a70808a82aa5616e17947bcc7"}, "state": "DISMISSED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNlQxNzozNToyOVrOHdStow==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNlQxNzo0MDowMlrOHdS3zw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDQ3NzM0Nw==", "bodyText": "nit: interface methods are public by default", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/452#discussion_r500477347", "createdAt": "2020-10-06T17:35:29Z", "author": {"login": "ktkrg"}, "path": "src/main/java/com/amazon/opendistro/elasticsearch/performanceanalyzer/decisionmaker/deciders/AlarmMonitor.java", "diffHunk": "@@ -0,0 +1,42 @@\n+/*\n+ * Copyright 2020 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ * permissions and limitations under the License.\n+ */\n+\n+package com.amazon.opendistro.elasticsearch.performanceanalyzer.decisionmaker.deciders;\n+\n+/**\n+ * AlarmMonitor evaluates and maintains the state of an alarm.\n+ *\n+ * <p>An alarm can either be healthy or unhealthy.\n+ */\n+public interface AlarmMonitor {\n+\n+  /**\n+   * Invoked whenever an issue needs to be recorded with the monitor\n+   * @param timeStamp Issue timestamp in millis\n+   * @param value Issues can be recorded with an intensity value\n+   */\n+  public void recordIssue(long timeStamp, double value);\n+\n+  public default void recordIssue() {\n+    recordIssue(System.currentTimeMillis(), 1);\n+  }\n+\n+  /**\n+   * State of the alarm\n+   * @return true if alarm is in healthy state, false otherwise\n+   */\n+  public boolean isHealthy();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "68ad86a29854c49a70808a82aa5616e17947bcc7"}, "originalPosition": 40}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDQ3OTk1MQ==", "bodyText": "These values can be the defaults. We should also have these as constructor params so that someday if we wanted to change thresholds for a particular JVM action, we don't need to extend this just to set different thresholds. What do you think?", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/452#discussion_r500479951", "createdAt": "2020-10-06T17:40:02Z", "author": {"login": "ktkrg"}, "path": "src/main/java/com/amazon/opendistro/elasticsearch/performanceanalyzer/decisionmaker/deciders/jvm/JvmActionsAlarmMonitor.java", "diffHunk": "@@ -0,0 +1,80 @@\n+/*\n+ * Copyright 2020 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ * permissions and limitations under the License.\n+ */\n+\n+package com.amazon.opendistro.elasticsearch.performanceanalyzer.decisionmaker.deciders.jvm;\n+\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.decisionmaker.deciders.AlarmMonitor;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.framework.api.aggregators.BucketizedSlidingWindow;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.framework.api.aggregators.SlidingWindowData;\n+import com.google.common.annotations.VisibleForTesting;\n+import java.util.concurrent.TimeUnit;\n+\n+public class JvmActionsAlarmMonitor implements AlarmMonitor {\n+\n+  public static final int DAY_BREACH_THRESHOLD = 5;\n+  public static final int WEEK_BREACH_THRESHOLD = 2;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "68ad86a29854c49a70808a82aa5616e17947bcc7"}, "originalPosition": 27}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "def6414f9c7f74d753c52c0cb17cdadfd5fefa40", "author": {"user": {"login": "vigyasharma", "name": "Vigya Sharma"}}, "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/commit/def6414f9c7f74d753c52c0cb17cdadfd5fefa40", "committedDate": "2020-10-07T20:22:16Z", "message": "Bucketized sliding window impl."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6d341a18dbd80f4a8173f0ba545503b290601da4", "author": {"user": {"login": "vigyasharma", "name": "Vigya Sharma"}}, "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/commit/6d341a18dbd80f4a8173f0ba545503b290601da4", "committedDate": "2020-10-07T20:22:16Z", "message": "jvm action monitor and bucketized sliding window tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "df243220b39b9d6bb302fe9da66d55f91cac52a4", "author": {"user": {"login": "vigyasharma", "name": "Vigya Sharma"}}, "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/commit/df243220b39b9d6bb302fe9da66d55f91cac52a4", "committedDate": "2020-10-07T20:22:16Z", "message": "Jvm action alarm monitor tests and bug fixes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ea50f540f7ba982bcb264a85b3ec91a5b12a2b86", "author": {"user": {"login": "vigyasharma", "name": "Vigya Sharma"}}, "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/commit/ea50f540f7ba982bcb264a85b3ec91a5b12a2b86", "committedDate": "2020-10-07T20:22:16Z", "message": "Checkstyle error fix"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e772bff0a9bb0e922ffa2983bd4bbbf2cff472d6", "author": {"user": {"login": "vigyasharma", "name": "Vigya Sharma"}}, "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/commit/e772bff0a9bb0e922ffa2983bd4bbbf2cff472d6", "committedDate": "2020-10-07T20:22:16Z", "message": "Honor bucket window size via [start, end) inclusion range"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9d6667850d895ff05e7df21271cf908d731000cb", "author": {"user": {"login": "vigyasharma", "name": "Vigya Sharma"}}, "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/commit/9d6667850d895ff05e7df21271cf908d731000cb", "committedDate": "2020-10-07T20:22:16Z", "message": "Addressed PR comments"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "50516d83f4e891b4850e886a6c5e3bc08107ca8c", "author": {"user": {"login": "vigyasharma", "name": "Vigya Sharma"}}, "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/commit/50516d83f4e891b4850e886a6c5e3bc08107ca8c", "committedDate": "2020-10-07T20:21:08Z", "message": "Addressed PR comments"}, "afterCommit": {"oid": "9d6667850d895ff05e7df21271cf908d731000cb", "author": {"user": {"login": "vigyasharma", "name": "Vigya Sharma"}}, "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/commit/9d6667850d895ff05e7df21271cf908d731000cb", "committedDate": "2020-10-07T20:22:16Z", "message": "Addressed PR comments"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA0MjY4Nzcz", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/452#pullrequestreview-504268773", "createdAt": "2020-10-07T21:08:42Z", "commit": {"oid": "9d6667850d895ff05e7df21271cf908d731000cb"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA0Mjc4ODAx", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/452#pullrequestreview-504278801", "createdAt": "2020-10-07T21:25:02Z", "commit": {"oid": "9d6667850d895ff05e7df21271cf908d731000cb"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 956, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}