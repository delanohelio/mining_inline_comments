{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDEwOTQ0Njk4", "number": 173, "title": "Adding NPE Fix during RCA controller start up", "bodyText": "Issue #, if available: #172\nDescription of changes:\n\nAdded the rcaConf null check under readAndUpdateMutesRcas()\nMoved the invocation of readAndUpdateMutesRcas() to after rcaConf initialization and rcaScheduler restart in updateRcaState()\n\nTests: Added a UT to check the NPE condition for rcaConf\nCode coverage percentage for this patch:\nBy submitting this pull request, I confirm that my contribution is made under the terms of the Apache 2.0 license.", "createdAt": "2020-04-29T20:46:42Z", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/173", "merged": true, "mergeCommit": {"oid": "aac305427e6cecfa7432b003bf039a65dc9cfc65"}, "closed": true, "closedAt": "2020-04-29T22:54:00Z", "author": {"login": "khushbr"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcceuloAH2gAyNDEwOTQ0Njk4OjUwNzRkNjhlMGFkMmIxMTkwNTVmNGU5NjQ1ZWY0ZDRiYjY2NWUyMTA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABccglPYAFqTQwMzA5NTYxOQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "5074d68e0ad2b119055f4e9645ef4d4bb665e210", "author": {"user": {"login": "khushbr", "name": "Khushboo Rajput"}}, "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/commit/5074d68e0ad2b119055f4e9645ef4d4bb665e210", "committedDate": "2020-04-29T20:44:00Z", "message": "Adding NPE Fix during RCA controller start up"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAzMDMwNjA3", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/173#pullrequestreview-403030607", "createdAt": "2020-04-29T20:53:33Z", "commit": {"oid": "5074d68e0ad2b119055f4e9645ef4d4bb665e210"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOVQyMDo1MzozNFrOGOQkrQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOVQyMDo1MzozNFrOGOQkrQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzYwNDc4MQ==", "bodyText": "In what case can this be null ? This shouldn't ever be null. RCA system depends on this config. Scheduler etc. cannot even start when this is null.", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/173#discussion_r417604781", "createdAt": "2020-04-29T20:53:34Z", "author": {"login": "yojs"}, "path": "src/main/java/com/amazon/opendistro/elasticsearch/performanceanalyzer/rca/RcaController.java", "diffHunk": "@@ -276,6 +276,11 @@ private void readRcaEnabledFromConf() {\n    * <p>In case all the RCAs in param value are incorrect, return without any update.\n    */\n   private void readAndUpdateMutesRcas() {\n+    if (rcaConf == null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5074d68e0ad2b119055f4e9645ef4d4bb665e210"}, "originalPosition": 30}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAzMDQxMjk0", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/173#pullrequestreview-403041294", "createdAt": "2020-04-29T21:09:20Z", "commit": {"oid": "5074d68e0ad2b119055f4e9645ef4d4bb665e210"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOVQyMTowOToyMFrOGORFxA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOVQyMTowOToyMFrOGORFxA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzYxMzI1Mg==", "bodyText": "This call has to be before updateRcaState as updateRcaState starts the scheduler. The scheduler is started, then it might start its run anytime. Therefore, in theory, it might execute the muted RCA node before coming around to it. Therefore, my suggestion, is move this call before updateRcaState this will also require adjusting the call to rcaConf = RcaControllerHelper.pickRcaConfForRole(currentRole);", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/173#discussion_r417613252", "createdAt": "2020-04-29T21:09:20Z", "author": {"login": "yojs"}, "path": "src/main/java/com/amazon/opendistro/elasticsearch/performanceanalyzer/rca/RcaController.java", "diffHunk": "@@ -225,6 +225,12 @@ public void run() {\n         }\n         updateRcaState();\n \n+        // If RCA is enabled, update Analysis graph with Muted RCAs value\n+        if (rcaEnabled) {\n+          LOG.debug(\"Updating Analysis Graph with Muted RCAs\");\n+          readAndUpdateMutesRcas();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5074d68e0ad2b119055f4e9645ef4d4bb665e210"}, "originalPosition": 7}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a4915daec8bb43a0ed06a75fe220e059a8f35283", "author": {"user": {"login": "khushbr", "name": "Khushboo Rajput"}}, "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/commit/a4915daec8bb43a0ed06a75fe220e059a8f35283", "committedDate": "2020-04-29T22:31:56Z", "message": "Addressing PR comments"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAzMDg3NTg3", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/173#pullrequestreview-403087587", "createdAt": "2020-04-29T22:34:59Z", "commit": {"oid": "a4915daec8bb43a0ed06a75fe220e059a8f35283"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOVQyMjozNDo1OVrOGOTdyw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOVQyMjozNDo1OVrOGOTdyw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzY1MjE3MQ==", "bodyText": "You might want to emit a metric here. If we really expect never for this to happen, then we should emit a domain level metric and add it to the dashboard.", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/173#discussion_r417652171", "createdAt": "2020-04-29T22:34:59Z", "author": {"login": "yojs"}, "path": "src/main/java/com/amazon/opendistro/elasticsearch/performanceanalyzer/rca/RcaController.java", "diffHunk": "@@ -297,11 +297,11 @@ private void readAndUpdateMutesRcas() {\n \n         LOG.info(\"Updating the muted RCA Graph to : {}\", rcasForMute);\n         Stats.getInstance().updateMutedGraphNodes(rcasForMute);\n-      } catch (Exception e) {\n-        LOG.error(\"Couldn't read/update the muted RCAs.\", e);\n       }\n+      lastModifiedTimeInMillisInMemory = lastModifiedTimeInMillisOnDisk;\n+    } catch (Exception e) {\n+        LOG.error(\"Couldn't read/update the muted RCAs.\", e);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a4915daec8bb43a0ed06a75fe220e059a8f35283"}, "originalPosition": 61}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAzMDk1NjE5", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/173#pullrequestreview-403095619", "createdAt": "2020-04-29T22:53:36Z", "commit": {"oid": "a4915daec8bb43a0ed06a75fe220e059a8f35283"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1230, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}