{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTQwNzA1MDMz", "number": 539, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNVQyMjo0MTozM1rOFF11aQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNVQyMjo0MTozM1rOFF11aQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQxNjY5MjI1OnYy", "diffSide": "RIGHT", "path": "src/main/java/com/amazon/opendistro/elasticsearch/performanceanalyzer/net/GRPCConnectionManager.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNVQyMjo0MTozM1rOIGjQuw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNVQyMjo1NDowOVrOIGjpgg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Mzc0MDA5MQ==", "bodyText": "do we also want to add deadline for rpc call ?\nAnd I also notice that maxRetryAttempts() is marked as experimental. is it going to be an issue to use it inprod ?", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/539#discussion_r543740091", "createdAt": "2020-12-15T22:41:33Z", "author": {"login": "rguo-aws"}, "path": "src/main/java/com/amazon/opendistro/elasticsearch/performanceanalyzer/net/GRPCConnectionManager.java", "diffHunk": "@@ -175,10 +173,12 @@ private int getPortFromHost(final InstanceDetails remoteHost) {\n   }\n \n   private ManagedChannel buildInsecureChannel(final InstanceDetails remoteHost) {\n-    return ManagedChannelBuilder.forAddress(\n-            remoteHost.getInstanceIp().toString(),\n-            getPortFromHost(remoteHost)\n-    ).usePlaintext().build();\n+    return ManagedChannelBuilder.forAddress(remoteHost.getInstanceIp().toString(),\n+        getPortFromHost(remoteHost))\n+                                .usePlaintext()\n+                                .enableRetry()\n+                                .maxRetryAttempts(MAX_RETRY_ATTEMPTS)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3b658ce001b1ad34df52faf168f2fb45d1914b9d"}, "originalPosition": 44}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Mzc0NjQzNA==", "bodyText": "Deadlines for RPC - We use streaming calls, and deadlines aren't applicable to long lived streaming calls. I don't think there is a simple way to enforce deadlines per message. If we were using a blocking call/unary rpc, then we can add a deadline for it.\nBoth the enableRetry() and maxRetryAttempts() are marked experimental because of a different reason - its dependency on service config apis. We will consume those when we implement application level retries.", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/539#discussion_r543746434", "createdAt": "2020-12-15T22:54:09Z", "author": {"login": "ktkrg"}, "path": "src/main/java/com/amazon/opendistro/elasticsearch/performanceanalyzer/net/GRPCConnectionManager.java", "diffHunk": "@@ -175,10 +173,12 @@ private int getPortFromHost(final InstanceDetails remoteHost) {\n   }\n \n   private ManagedChannel buildInsecureChannel(final InstanceDetails remoteHost) {\n-    return ManagedChannelBuilder.forAddress(\n-            remoteHost.getInstanceIp().toString(),\n-            getPortFromHost(remoteHost)\n-    ).usePlaintext().build();\n+    return ManagedChannelBuilder.forAddress(remoteHost.getInstanceIp().toString(),\n+        getPortFromHost(remoteHost))\n+                                .usePlaintext()\n+                                .enableRetry()\n+                                .maxRetryAttempts(MAX_RETRY_ATTEMPTS)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Mzc0MDA5MQ=="}, "originalCommit": {"oid": "3b658ce001b1ad34df52faf168f2fb45d1914b9d"}, "originalPosition": 44}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2291, "cost": 1, "resetAt": "2021-11-12T20:44:06Z"}}}