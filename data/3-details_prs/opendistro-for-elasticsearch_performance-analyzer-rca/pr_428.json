{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDg4ODQzMzE1", "number": 428, "title": "Add cache clear action in JVM decider", "bodyText": "Fixes #:\nDescription of changes:\nAdd cache clear action in JVM decider. This action will be issued when the heap usage(after full GC) is above 90%. The default cool off period of this action is 30 mins\nTests:\ncreated unit tests for this action type\nBy submitting this pull request, I confirm that my contribution is made under the terms of the Apache 2.0 license.", "createdAt": "2020-09-17T18:09:55Z", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/428", "merged": true, "mergeCommit": {"oid": "4eadc4e766329f9a4b76a139f4b216def04d224d"}, "closed": true, "closedAt": "2020-09-18T17:42:54Z", "author": {"login": "rguo-aws"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdJ04-dgH2gAyNDg4ODQzMzE1Ojk2MGZmYWIzNTY0ZWExMjRhY2M4NWVhYTMzYzk3OTYzODQzOGQ0NjE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdKJOZegFqTQ5MTY2MjIzNA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "960ffab3564ea124acc85eaa33c979638438d461", "author": {"user": {"login": "rguo-aws", "name": "Ruizhen Guo"}}, "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/commit/960ffab3564ea124acc85eaa33c979638438d461", "committedDate": "2020-09-17T17:59:51Z", "message": "Add cache clear action"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fa4a461b901ca7ae7834bf4dcd3715faf6e01e71", "author": {"user": {"login": "rguo-aws", "name": "Ruizhen Guo"}}, "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/commit/fa4a461b901ca7ae7834bf4dcd3715faf6e01e71", "committedDate": "2020-09-17T18:10:50Z", "message": "Fix check style"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkwODY5Njk2", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/428#pullrequestreview-490869696", "createdAt": "2020-09-17T18:20:28Z", "commit": {"oid": "fa4a461b901ca7ae7834bf4dcd3715faf6e01e71"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xN1QxODoyMDoyOVrOHTvmow==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xN1QxODoyODozOFrOHTv4bw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDQ2NDkzMQ==", "bodyText": "nit: same line?", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/428#discussion_r490464931", "createdAt": "2020-09-17T18:20:29Z", "author": {"login": "vigyasharma"}, "path": "src/main/java/com/amazon/opendistro/elasticsearch/performanceanalyzer/decisionmaker/deciders/jvm/old_gen/LevelThreeActionBuilder.java", "diffHunk": "@@ -117,31 +113,28 @@ private void addSearchQueueAction() {\n         .stepSize(stepSize * actionBuilderConfig.searchQueueStepSize())\n         .build();\n     if (action.isActionable()) {\n-      queueActionMap.put(ResourceEnum.SEARCH_THREADPOOL, action);\n+      actions.add(action);\n     }\n   }\n \n-\n-  private void registerActions() {\n-    addFieldDataCacheAction();\n-    addShardRequestCacheAction();\n-    addSearchQueueAction();\n-    addWriteQueueAction();\n+  private void addCacheClearAction() {\n+    CacheClearAction action = CacheClearAction\n+        .newBuilder(appContext).build();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fa4a461b901ca7ae7834bf4dcd3715faf6e01e71"}, "originalPosition": 88}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDQ2OTQ4Nw==", "bodyText": "Will this action increase CPU pressure? Although, since this is an SoS action, we want it to go through and not get punted due to an existing high CPU metric. So it's probably okay to not include that as an impact (also may not always increase CPU if the cache items were not really being used).", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/428#discussion_r490469487", "createdAt": "2020-09-17T18:28:38Z", "author": {"login": "vigyasharma"}, "path": "src/main/java/com/amazon/opendistro/elasticsearch/performanceanalyzer/decisionmaker/actions/CacheClearAction.java", "diffHunk": "@@ -0,0 +1,123 @@\n+/*\n+ * Copyright 2020 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ *  permissions and limitations under the License.\n+ */\n+\n+package com.amazon.opendistro.elasticsearch.performanceanalyzer.decisionmaker.actions;\n+\n+import static com.amazon.opendistro.elasticsearch.performanceanalyzer.decisionmaker.actions.ImpactVector.Dimension.HEAP;\n+\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.AppContext;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.store.rca.cluster.NodeKey;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.concurrent.TimeUnit;\n+import java.util.stream.Collectors;\n+\n+public class CacheClearAction extends SuppressibleAction {\n+  public static final String NAME = \"CacheClear\";\n+\n+  private final long coolOffPeriodInMillis;\n+  private final boolean canUpdate;\n+  private final List<NodeKey> impactedNodes;\n+\n+  public CacheClearAction(final AppContext appContext,\n+      final long coolOffPeriodInMillis,\n+      final boolean canUpdate) {\n+    super(appContext);\n+    this.coolOffPeriodInMillis = coolOffPeriodInMillis;\n+    this.canUpdate = canUpdate;\n+    this.impactedNodes = appContext.getDataNodeInstances()\n+        .stream()\n+        .map(ins -> new NodeKey(ins.getInstanceId(), ins.getInstanceIp()))\n+        .collect(Collectors.toList());\n+  }\n+\n+  @Override\n+  public String name() {\n+    return NAME;\n+  }\n+\n+  @Override\n+  public boolean canUpdate() {\n+    return canUpdate;\n+  }\n+\n+  @Override\n+  public long coolOffPeriodInMillis() {\n+    return coolOffPeriodInMillis;\n+  }\n+\n+  @Override\n+  public List<NodeKey> impactedNodes() {\n+    return impactedNodes;\n+  }\n+\n+  @Override\n+  public Map<NodeKey, ImpactVector> impact() {\n+    Map<NodeKey, ImpactVector> impactedMap = new HashMap<>();\n+    impactedNodes.forEach(node -> {\n+          ImpactVector impactVector = new ImpactVector();\n+          impactVector.decreasesPressure(HEAP);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fa4a461b901ca7ae7834bf4dcd3715faf6e01e71"}, "originalPosition": 72}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkxNjYyMjM0", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/428#pullrequestreview-491662234", "createdAt": "2020-09-18T17:41:21Z", "commit": {"oid": "fa4a461b901ca7ae7834bf4dcd3715faf6e01e71"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 916, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}