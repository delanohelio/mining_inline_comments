{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDYwMTQ2MTE2", "number": 325, "reviewThreads": {"totalCount": 23, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQyMTo0NjozN1rOEWAOVw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wN1QxODo1NDowMlrOEWUg2A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkxNTA3Nzk5OnYy", "diffSide": "RIGHT", "path": "src/test/resources/rca/rca_elected_master.conf", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQyMTo0NjozN1rOG9FVeg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wN1QwMToyMjo0MVrOG9JVug==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjcwMzczOA==", "bodyText": "Same as above", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/325#discussion_r466703738", "createdAt": "2020-08-06T21:46:37Z", "author": {"login": "khushbr"}, "path": "src/test/resources/rca/rca_elected_master.conf", "diffHunk": "@@ -73,6 +73,8 @@\n   },\n \n   \"muted-rcas\": \"\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "35c416d2ddb7b44388affd197ba6842fab6d4d72"}, "originalPosition": 3}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Njc2OTMzOA==", "bodyText": "Done.", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/325#discussion_r466769338", "createdAt": "2020-08-07T01:22:41Z", "author": {"login": "ktkrg"}, "path": "src/test/resources/rca/rca_elected_master.conf", "diffHunk": "@@ -73,6 +73,8 @@\n   },\n \n   \"muted-rcas\": \"\",", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjcwMzczOA=="}, "originalCommit": {"oid": "35c416d2ddb7b44388affd197ba6842fab6d4d72"}, "originalPosition": 3}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkxNTA3OTEwOnYy", "diffSide": "RIGHT", "path": "src/test/resources/rca/rca.conf", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQyMTo0NzowMVrOG9FWHg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wN1QwMToyMjo0NFrOG9JVxw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjcwMzkwMg==", "bodyText": "It would be nice if you can fix this to \"muted-rcas\": [],", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/325#discussion_r466703902", "createdAt": "2020-08-06T21:47:01Z", "author": {"login": "khushbr"}, "path": "src/test/resources/rca/rca.conf", "diffHunk": "@@ -63,6 +63,8 @@\n   },\n \n   \"muted-rcas\": \"\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "35c416d2ddb7b44388affd197ba6842fab6d4d72"}, "originalPosition": 3}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Njc2OTM1MQ==", "bodyText": "Done.", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/325#discussion_r466769351", "createdAt": "2020-08-07T01:22:44Z", "author": {"login": "ktkrg"}, "path": "src/test/resources/rca/rca.conf", "diffHunk": "@@ -63,6 +63,8 @@\n   },\n \n   \"muted-rcas\": \"\",", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjcwMzkwMg=="}, "originalCommit": {"oid": "35c416d2ddb7b44388affd197ba6842fab6d4d72"}, "originalPosition": 3}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkxNTA4MjYyOnYy", "diffSide": "RIGHT", "path": "src/test/java/com/amazon/opendistro/elasticsearch/performanceanalyzer/net/GRPCTest.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQyMTo0ODoyNFrOG9FYXA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wN1QwMToyMjo0N1rOG9JV3g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjcwNDQ3Ng==", "bodyText": "Unused Import?", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/325#discussion_r466704476", "createdAt": "2020-08-06T21:48:24Z", "author": {"login": "khushbr"}, "path": "src/test/java/com/amazon/opendistro/elasticsearch/performanceanalyzer/net/GRPCTest.java", "diffHunk": "@@ -17,6 +17,7 @@\n import org.apache.logging.log4j.Logger;\n import org.junit.AfterClass;\n import org.junit.BeforeClass;\n+import org.junit.Ignore;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "35c416d2ddb7b44388affd197ba6842fab6d4d72"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Njc2OTM3NA==", "bodyText": "removed.", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/325#discussion_r466769374", "createdAt": "2020-08-07T01:22:47Z", "author": {"login": "ktkrg"}, "path": "src/test/java/com/amazon/opendistro/elasticsearch/performanceanalyzer/net/GRPCTest.java", "diffHunk": "@@ -17,6 +17,7 @@\n import org.apache.logging.log4j.Logger;\n import org.junit.AfterClass;\n import org.junit.BeforeClass;\n+import org.junit.Ignore;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjcwNDQ3Ng=="}, "originalCommit": {"oid": "35c416d2ddb7b44388affd197ba6842fab6d4d72"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkxNTA4OTg2OnYy", "diffSide": "RIGHT", "path": "src/main/java/com/amazon/opendistro/elasticsearch/performanceanalyzer/config/overrides/ConfigOverridesWrapper.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQyMTo1MDo1N1rOG9Fc3Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wN1QwMToyMjo0OVrOG9JV6Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjcwNTYyOQ==", "bodyText": "Use @VisibleForTesting annotation here?", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/325#discussion_r466705629", "createdAt": "2020-08-06T21:50:57Z", "author": {"login": "khushbr"}, "path": "src/main/java/com/amazon/opendistro/elasticsearch/performanceanalyzer/config/overrides/ConfigOverridesWrapper.java", "diffHunk": "@@ -15,13 +15,29 @@\n \n package com.amazon.opendistro.elasticsearch.performanceanalyzer.config.overrides;\n \n+import com.fasterxml.jackson.databind.ObjectMapper;\n+\n /**\n  * Class responsible for holding the latest config overrides across the cluster.\n  */\n public class ConfigOverridesWrapper {\n \n     private volatile ConfigOverrides currentClusterConfigOverrides;\n     private volatile long lastUpdatedTimestamp;\n+    private final ObjectMapper mapper;\n+\n+    public ConfigOverridesWrapper() {\n+        this(new ObjectMapper());\n+    }\n+\n+    /**\n+     * Ctor used only for unit test purposes.\n+     * @param mapper The object mapper instance.\n+     */\n+    public ConfigOverridesWrapper(final ObjectMapper mapper) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "35c416d2ddb7b44388affd197ba6842fab6d4d72"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Njc2OTM4NQ==", "bodyText": "Done.", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/325#discussion_r466769385", "createdAt": "2020-08-07T01:22:49Z", "author": {"login": "ktkrg"}, "path": "src/main/java/com/amazon/opendistro/elasticsearch/performanceanalyzer/config/overrides/ConfigOverridesWrapper.java", "diffHunk": "@@ -15,13 +15,29 @@\n \n package com.amazon.opendistro.elasticsearch.performanceanalyzer.config.overrides;\n \n+import com.fasterxml.jackson.databind.ObjectMapper;\n+\n /**\n  * Class responsible for holding the latest config overrides across the cluster.\n  */\n public class ConfigOverridesWrapper {\n \n     private volatile ConfigOverrides currentClusterConfigOverrides;\n     private volatile long lastUpdatedTimestamp;\n+    private final ObjectMapper mapper;\n+\n+    public ConfigOverridesWrapper() {\n+        this(new ObjectMapper());\n+    }\n+\n+    /**\n+     * Ctor used only for unit test purposes.\n+     * @param mapper The object mapper instance.\n+     */\n+    public ConfigOverridesWrapper(final ObjectMapper mapper) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjcwNTYyOQ=="}, "originalCommit": {"oid": "35c416d2ddb7b44388affd197ba6842fab6d4d72"}, "originalPosition": 23}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkxNTE2MjU3OnYy", "diffSide": "RIGHT", "path": "src/main/java/com/amazon/opendistro/elasticsearch/performanceanalyzer/decisionmaker/actions/ModifyQueueCapacityAction.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQyMjoyMTozN1rOG9GJaQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wN1QwMToyMjo1M1rOG9JV9Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjcxNzAzMw==", "bodyText": "Like the previous naming better.\nCan we use shouldUpdate or a better name perhaps ?", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/325#discussion_r466717033", "createdAt": "2020-08-06T22:21:37Z", "author": {"login": "khushbr"}, "path": "src/main/java/com/amazon/opendistro/elasticsearch/performanceanalyzer/decisionmaker/actions/ModifyQueueCapacityAction.java", "diffHunk": "@@ -56,7 +56,7 @@ public String name() {\n   }\n \n   @Override\n-  public boolean isActionable() {\n+  public boolean isValid() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "35c416d2ddb7b44388affd197ba6842fab6d4d72"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Njc2OTM5Nw==", "bodyText": "I liked the previous one better too, the problem was isActionable() makes sense for an action and in this case I wanted to enforce the muted-ness check in the isActionable() so that isActionable() can return false if the action is muted. The only way to do that is to override the method in an abstract class and make the method final and provide a hook for the action implementations to tell if they can perform some updates to the system(what they were doing in the original isActionable() method).\nChanged it to canUpdate().", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/325#discussion_r466769397", "createdAt": "2020-08-07T01:22:53Z", "author": {"login": "ktkrg"}, "path": "src/main/java/com/amazon/opendistro/elasticsearch/performanceanalyzer/decisionmaker/actions/ModifyQueueCapacityAction.java", "diffHunk": "@@ -56,7 +56,7 @@ public String name() {\n   }\n \n   @Override\n-  public boolean isActionable() {\n+  public boolean isValid() {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjcxNzAzMw=="}, "originalCommit": {"oid": "35c416d2ddb7b44388affd197ba6842fab6d4d72"}, "originalPosition": 14}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkxNTE2ODY5OnYy", "diffSide": "RIGHT", "path": "src/main/java/com/amazon/opendistro/elasticsearch/performanceanalyzer/rca/RcaController.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQyMjoyNDoyMFrOG9GNAA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wN1QwMToyMjo1OVrOG9JWDA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjcxNzk1Mg==", "bodyText": "update to readAndUpdateMutedComponentsDuringStart to follow the same naming pattern as readAndUpdateMutedComponents ?", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/325#discussion_r466717952", "createdAt": "2020-08-06T22:24:20Z", "author": {"login": "khushbr"}, "path": "src/main/java/com/amazon/opendistro/elasticsearch/performanceanalyzer/rca/RcaController.java", "diffHunk": "@@ -319,26 +319,66 @@ private void readRcaEnabledFromConf() {\n         });\n   }\n \n-  private void readAndUpdateMutesRcasDuringStart() {\n+  private void readAndUpdateMutedRcasDuringStart() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "35c416d2ddb7b44388affd197ba6842fab6d4d72"}, "originalPosition": 52}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Njc2OTQyMA==", "bodyText": "Done.", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/325#discussion_r466769420", "createdAt": "2020-08-07T01:22:59Z", "author": {"login": "ktkrg"}, "path": "src/main/java/com/amazon/opendistro/elasticsearch/performanceanalyzer/rca/RcaController.java", "diffHunk": "@@ -319,26 +319,66 @@ private void readRcaEnabledFromConf() {\n         });\n   }\n \n-  private void readAndUpdateMutesRcasDuringStart() {\n+  private void readAndUpdateMutedRcasDuringStart() {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjcxNzk1Mg=="}, "originalCommit": {"oid": "35c416d2ddb7b44388affd197ba6842fab6d4d72"}, "originalPosition": 52}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkxNTE5NDI3OnYy", "diffSide": "RIGHT", "path": "src/main/java/com/amazon/opendistro/elasticsearch/performanceanalyzer/rca/RcaController.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQyMjozNTo0MFrOG9GcPA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQyMzo1MjowMVrOG9H4hg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjcyMTg1Mg==", "bodyText": "Are we performing any validation on the input actions provided for muting?", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/325#discussion_r466721852", "createdAt": "2020-08-06T22:35:40Z", "author": {"login": "khushbr"}, "path": "src/main/java/com/amazon/opendistro/elasticsearch/performanceanalyzer/rca/RcaController.java", "diffHunk": "@@ -319,26 +319,66 @@ private void readRcaEnabledFromConf() {\n         });\n   }\n \n-  private void readAndUpdateMutesRcasDuringStart() {\n+  private void readAndUpdateMutedRcasDuringStart() {\n+    /* We have an edge case where both `readAndUpdateMutedComponents()` and `readAndUpdateMutedRcasDuringStart()`\n+     * can try to update the muted Rca list back to back, reading rca.conf twice. This will happen when rca\n+     * was turned off and then on.\n+     *\n+     * <p> `readAndUpdateMutedRcasDuringStart()` should only be read at the start of the process, when\n+     * RCA graph is not constructed and we cannot validate the new new muted RCAs. For any other update\n+     * to the muted list, the periodic rca.conf update checker will take care of it.\n+     *\n+     */\n+    if (lastModifiedTimeInMillisInMemory == 0) {\n+      updateMutedComponents();\n+    }\n+  }\n+\n+  private boolean updateMutedComponents() {\n     try {\n-      /* We have an edge case where both `readAndUpdateMutesRcas()` and `readAndUpdateMutesRcasDuringStart()`\n-       * can try to update the muted Rca list back to back, reading rca.conf twice. This will happen when rca\n-       * was turned off and then on.\n-       *\n-       * <p> `readAndUpdateMutesRcasDuringStart()` should only be read at the start of the process, when\n-       * RCA graph is not constructed and we cannot validate the new new muted RCAs. For any other update\n-       * to the muted list, the periodic rca.conf update checker will take care of it.\n-       *\n-       */\n-      if (lastModifiedTimeInMillisInMemory == 0) {\n-        Set<String> rcasForMute = new HashSet<>(rcaConf.getMutedRcaList());\n-        Stats.getInstance().updateMutedGraphNodes(rcasForMute);\n-        LOG.info(\"Updated the muted RCA Graph to : {}\", rcaConf.getMutedRcaList());\n+      if (ConnectedComponent.getNodeNames().isEmpty()) {\n+        LOG.info(\"Analysis graph not initialized/has been reset; returning.\");\n+        return false;\n       }\n+\n+      Set<String> actionsForMute = new HashSet<>(rcaConf.getMutedActionList());\n+\n+      Set<String> graphNodesForMute = new HashSet<>();\n+      graphNodesForMute.addAll(rcaConf.getMutedRcaList());\n+      graphNodesForMute.addAll(rcaConf.getMutedDeciderList());\n+      LOG.info(\"Graph nodes provided for muting : {}\", graphNodesForMute);\n+      LOG.info(\"Actions provided for muting: {}\", actionsForMute);\n+\n+      // Update rcasForMute to retain only valid RCAs\n+      graphNodesForMute.retainAll(ConnectedComponent.getNodeNames());\n+\n+      // If rcasForMute post validation is empty but neither rcaConf.getMutedRcaList() nor\n+      // rcaConf.getMutedDeciderList() are empty all the input RCAs/deciders are incorrect.\n+      if (graphNodesForMute.isEmpty()\n+          && (!rcaConf.getMutedRcaList().isEmpty() || !rcaConf.getMutedDeciderList().isEmpty())) {\n+        if (lastModifiedTimeInMillisInMemory == 0) {\n+          LOG.error(\n+              \"Removing Incorrect RCA(s): {} provided before RCA Scheduler start. Valid RCAs: {}.\",\n+              rcaConf.getMutedRcaList(), ConnectedComponent.getNodeNames());\n+\n+        } else {\n+          LOG.error(\"Incorrect RCA(s): {}, cannot be muted. Valid RCAs: {}, Muted RCAs: {}\",\n+              rcaConf.getMutedRcaList(), ConnectedComponent.getNodeNames(),\n+              Stats.getInstance().getMutedGraphNodes());\n+          return false;\n+        }\n+      }\n+\n+      LOG.info(\"Updating the muted graph nodes to : {}\", graphNodesForMute);\n+      Stats.getInstance().updateMutedGraphNodes(graphNodesForMute);\n+      Stats.getInstance().updateMutedActions(actionsForMute);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "35c416d2ddb7b44388affd197ba6842fab6d4d72"}, "originalPosition": 117}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Njc0NTQ3OA==", "bodyText": "No, we don't have a registry of available actions to check the input against. As such, it'll just stay in the conf if an invalid string is provided.", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/325#discussion_r466745478", "createdAt": "2020-08-06T23:52:01Z", "author": {"login": "ktkrg"}, "path": "src/main/java/com/amazon/opendistro/elasticsearch/performanceanalyzer/rca/RcaController.java", "diffHunk": "@@ -319,26 +319,66 @@ private void readRcaEnabledFromConf() {\n         });\n   }\n \n-  private void readAndUpdateMutesRcasDuringStart() {\n+  private void readAndUpdateMutedRcasDuringStart() {\n+    /* We have an edge case where both `readAndUpdateMutedComponents()` and `readAndUpdateMutedRcasDuringStart()`\n+     * can try to update the muted Rca list back to back, reading rca.conf twice. This will happen when rca\n+     * was turned off and then on.\n+     *\n+     * <p> `readAndUpdateMutedRcasDuringStart()` should only be read at the start of the process, when\n+     * RCA graph is not constructed and we cannot validate the new new muted RCAs. For any other update\n+     * to the muted list, the periodic rca.conf update checker will take care of it.\n+     *\n+     */\n+    if (lastModifiedTimeInMillisInMemory == 0) {\n+      updateMutedComponents();\n+    }\n+  }\n+\n+  private boolean updateMutedComponents() {\n     try {\n-      /* We have an edge case where both `readAndUpdateMutesRcas()` and `readAndUpdateMutesRcasDuringStart()`\n-       * can try to update the muted Rca list back to back, reading rca.conf twice. This will happen when rca\n-       * was turned off and then on.\n-       *\n-       * <p> `readAndUpdateMutesRcasDuringStart()` should only be read at the start of the process, when\n-       * RCA graph is not constructed and we cannot validate the new new muted RCAs. For any other update\n-       * to the muted list, the periodic rca.conf update checker will take care of it.\n-       *\n-       */\n-      if (lastModifiedTimeInMillisInMemory == 0) {\n-        Set<String> rcasForMute = new HashSet<>(rcaConf.getMutedRcaList());\n-        Stats.getInstance().updateMutedGraphNodes(rcasForMute);\n-        LOG.info(\"Updated the muted RCA Graph to : {}\", rcaConf.getMutedRcaList());\n+      if (ConnectedComponent.getNodeNames().isEmpty()) {\n+        LOG.info(\"Analysis graph not initialized/has been reset; returning.\");\n+        return false;\n       }\n+\n+      Set<String> actionsForMute = new HashSet<>(rcaConf.getMutedActionList());\n+\n+      Set<String> graphNodesForMute = new HashSet<>();\n+      graphNodesForMute.addAll(rcaConf.getMutedRcaList());\n+      graphNodesForMute.addAll(rcaConf.getMutedDeciderList());\n+      LOG.info(\"Graph nodes provided for muting : {}\", graphNodesForMute);\n+      LOG.info(\"Actions provided for muting: {}\", actionsForMute);\n+\n+      // Update rcasForMute to retain only valid RCAs\n+      graphNodesForMute.retainAll(ConnectedComponent.getNodeNames());\n+\n+      // If rcasForMute post validation is empty but neither rcaConf.getMutedRcaList() nor\n+      // rcaConf.getMutedDeciderList() are empty all the input RCAs/deciders are incorrect.\n+      if (graphNodesForMute.isEmpty()\n+          && (!rcaConf.getMutedRcaList().isEmpty() || !rcaConf.getMutedDeciderList().isEmpty())) {\n+        if (lastModifiedTimeInMillisInMemory == 0) {\n+          LOG.error(\n+              \"Removing Incorrect RCA(s): {} provided before RCA Scheduler start. Valid RCAs: {}.\",\n+              rcaConf.getMutedRcaList(), ConnectedComponent.getNodeNames());\n+\n+        } else {\n+          LOG.error(\"Incorrect RCA(s): {}, cannot be muted. Valid RCAs: {}, Muted RCAs: {}\",\n+              rcaConf.getMutedRcaList(), ConnectedComponent.getNodeNames(),\n+              Stats.getInstance().getMutedGraphNodes());\n+          return false;\n+        }\n+      }\n+\n+      LOG.info(\"Updating the muted graph nodes to : {}\", graphNodesForMute);\n+      Stats.getInstance().updateMutedGraphNodes(graphNodesForMute);\n+      Stats.getInstance().updateMutedActions(actionsForMute);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjcyMTg1Mg=="}, "originalCommit": {"oid": "35c416d2ddb7b44388affd197ba6842fab6d4d72"}, "originalPosition": 117}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkxNTE5NTI3OnYy", "diffSide": "RIGHT", "path": "src/main/java/com/amazon/opendistro/elasticsearch/performanceanalyzer/rca/RcaController.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQyMjozNjoxNFrOG9Gc4A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wN1QwMToyMzowM1rOG9JWGA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjcyMjAxNg==", "bodyText": "Update the metrics name RCA_MUTE_ERROR_METRIC here?", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/325#discussion_r466722016", "createdAt": "2020-08-06T22:36:14Z", "author": {"login": "khushbr"}, "path": "src/main/java/com/amazon/opendistro/elasticsearch/performanceanalyzer/rca/RcaController.java", "diffHunk": "@@ -319,26 +319,66 @@ private void readRcaEnabledFromConf() {\n         });\n   }\n \n-  private void readAndUpdateMutesRcasDuringStart() {\n+  private void readAndUpdateMutedRcasDuringStart() {\n+    /* We have an edge case where both `readAndUpdateMutedComponents()` and `readAndUpdateMutedRcasDuringStart()`\n+     * can try to update the muted Rca list back to back, reading rca.conf twice. This will happen when rca\n+     * was turned off and then on.\n+     *\n+     * <p> `readAndUpdateMutedRcasDuringStart()` should only be read at the start of the process, when\n+     * RCA graph is not constructed and we cannot validate the new new muted RCAs. For any other update\n+     * to the muted list, the periodic rca.conf update checker will take care of it.\n+     *\n+     */\n+    if (lastModifiedTimeInMillisInMemory == 0) {\n+      updateMutedComponents();\n+    }\n+  }\n+\n+  private boolean updateMutedComponents() {\n     try {\n-      /* We have an edge case where both `readAndUpdateMutesRcas()` and `readAndUpdateMutesRcasDuringStart()`\n-       * can try to update the muted Rca list back to back, reading rca.conf twice. This will happen when rca\n-       * was turned off and then on.\n-       *\n-       * <p> `readAndUpdateMutesRcasDuringStart()` should only be read at the start of the process, when\n-       * RCA graph is not constructed and we cannot validate the new new muted RCAs. For any other update\n-       * to the muted list, the periodic rca.conf update checker will take care of it.\n-       *\n-       */\n-      if (lastModifiedTimeInMillisInMemory == 0) {\n-        Set<String> rcasForMute = new HashSet<>(rcaConf.getMutedRcaList());\n-        Stats.getInstance().updateMutedGraphNodes(rcasForMute);\n-        LOG.info(\"Updated the muted RCA Graph to : {}\", rcaConf.getMutedRcaList());\n+      if (ConnectedComponent.getNodeNames().isEmpty()) {\n+        LOG.info(\"Analysis graph not initialized/has been reset; returning.\");\n+        return false;\n       }\n+\n+      Set<String> actionsForMute = new HashSet<>(rcaConf.getMutedActionList());\n+\n+      Set<String> graphNodesForMute = new HashSet<>();\n+      graphNodesForMute.addAll(rcaConf.getMutedRcaList());\n+      graphNodesForMute.addAll(rcaConf.getMutedDeciderList());\n+      LOG.info(\"Graph nodes provided for muting : {}\", graphNodesForMute);\n+      LOG.info(\"Actions provided for muting: {}\", actionsForMute);\n+\n+      // Update rcasForMute to retain only valid RCAs\n+      graphNodesForMute.retainAll(ConnectedComponent.getNodeNames());\n+\n+      // If rcasForMute post validation is empty but neither rcaConf.getMutedRcaList() nor\n+      // rcaConf.getMutedDeciderList() are empty all the input RCAs/deciders are incorrect.\n+      if (graphNodesForMute.isEmpty()\n+          && (!rcaConf.getMutedRcaList().isEmpty() || !rcaConf.getMutedDeciderList().isEmpty())) {\n+        if (lastModifiedTimeInMillisInMemory == 0) {\n+          LOG.error(\n+              \"Removing Incorrect RCA(s): {} provided before RCA Scheduler start. Valid RCAs: {}.\",\n+              rcaConf.getMutedRcaList(), ConnectedComponent.getNodeNames());\n+\n+        } else {\n+          LOG.error(\"Incorrect RCA(s): {}, cannot be muted. Valid RCAs: {}, Muted RCAs: {}\",\n+              rcaConf.getMutedRcaList(), ConnectedComponent.getNodeNames(),\n+              Stats.getInstance().getMutedGraphNodes());\n+          return false;\n+        }\n+      }\n+\n+      LOG.info(\"Updating the muted graph nodes to : {}\", graphNodesForMute);\n+      Stats.getInstance().updateMutedGraphNodes(graphNodesForMute);\n+      Stats.getInstance().updateMutedActions(actionsForMute);\n     } catch (Exception e) {\n-      LOG.error(\"Couldn't read/update the muted RCAs during start()\", e);\n+      LOG.error(\"Couldn't read/update the muted RCAs\", e);\n       StatsCollector.instance().logMetric(RCA_MUTE_ERROR_METRIC);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "35c416d2ddb7b44388affd197ba6842fab6d4d72"}, "originalPosition": 121}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Njc2OTQzMg==", "bodyText": "Updated to MUTE_ERROR_METRIC.", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/325#discussion_r466769432", "createdAt": "2020-08-07T01:23:03Z", "author": {"login": "ktkrg"}, "path": "src/main/java/com/amazon/opendistro/elasticsearch/performanceanalyzer/rca/RcaController.java", "diffHunk": "@@ -319,26 +319,66 @@ private void readRcaEnabledFromConf() {\n         });\n   }\n \n-  private void readAndUpdateMutesRcasDuringStart() {\n+  private void readAndUpdateMutedRcasDuringStart() {\n+    /* We have an edge case where both `readAndUpdateMutedComponents()` and `readAndUpdateMutedRcasDuringStart()`\n+     * can try to update the muted Rca list back to back, reading rca.conf twice. This will happen when rca\n+     * was turned off and then on.\n+     *\n+     * <p> `readAndUpdateMutedRcasDuringStart()` should only be read at the start of the process, when\n+     * RCA graph is not constructed and we cannot validate the new new muted RCAs. For any other update\n+     * to the muted list, the periodic rca.conf update checker will take care of it.\n+     *\n+     */\n+    if (lastModifiedTimeInMillisInMemory == 0) {\n+      updateMutedComponents();\n+    }\n+  }\n+\n+  private boolean updateMutedComponents() {\n     try {\n-      /* We have an edge case where both `readAndUpdateMutesRcas()` and `readAndUpdateMutesRcasDuringStart()`\n-       * can try to update the muted Rca list back to back, reading rca.conf twice. This will happen when rca\n-       * was turned off and then on.\n-       *\n-       * <p> `readAndUpdateMutesRcasDuringStart()` should only be read at the start of the process, when\n-       * RCA graph is not constructed and we cannot validate the new new muted RCAs. For any other update\n-       * to the muted list, the periodic rca.conf update checker will take care of it.\n-       *\n-       */\n-      if (lastModifiedTimeInMillisInMemory == 0) {\n-        Set<String> rcasForMute = new HashSet<>(rcaConf.getMutedRcaList());\n-        Stats.getInstance().updateMutedGraphNodes(rcasForMute);\n-        LOG.info(\"Updated the muted RCA Graph to : {}\", rcaConf.getMutedRcaList());\n+      if (ConnectedComponent.getNodeNames().isEmpty()) {\n+        LOG.info(\"Analysis graph not initialized/has been reset; returning.\");\n+        return false;\n       }\n+\n+      Set<String> actionsForMute = new HashSet<>(rcaConf.getMutedActionList());\n+\n+      Set<String> graphNodesForMute = new HashSet<>();\n+      graphNodesForMute.addAll(rcaConf.getMutedRcaList());\n+      graphNodesForMute.addAll(rcaConf.getMutedDeciderList());\n+      LOG.info(\"Graph nodes provided for muting : {}\", graphNodesForMute);\n+      LOG.info(\"Actions provided for muting: {}\", actionsForMute);\n+\n+      // Update rcasForMute to retain only valid RCAs\n+      graphNodesForMute.retainAll(ConnectedComponent.getNodeNames());\n+\n+      // If rcasForMute post validation is empty but neither rcaConf.getMutedRcaList() nor\n+      // rcaConf.getMutedDeciderList() are empty all the input RCAs/deciders are incorrect.\n+      if (graphNodesForMute.isEmpty()\n+          && (!rcaConf.getMutedRcaList().isEmpty() || !rcaConf.getMutedDeciderList().isEmpty())) {\n+        if (lastModifiedTimeInMillisInMemory == 0) {\n+          LOG.error(\n+              \"Removing Incorrect RCA(s): {} provided before RCA Scheduler start. Valid RCAs: {}.\",\n+              rcaConf.getMutedRcaList(), ConnectedComponent.getNodeNames());\n+\n+        } else {\n+          LOG.error(\"Incorrect RCA(s): {}, cannot be muted. Valid RCAs: {}, Muted RCAs: {}\",\n+              rcaConf.getMutedRcaList(), ConnectedComponent.getNodeNames(),\n+              Stats.getInstance().getMutedGraphNodes());\n+          return false;\n+        }\n+      }\n+\n+      LOG.info(\"Updating the muted graph nodes to : {}\", graphNodesForMute);\n+      Stats.getInstance().updateMutedGraphNodes(graphNodesForMute);\n+      Stats.getInstance().updateMutedActions(actionsForMute);\n     } catch (Exception e) {\n-      LOG.error(\"Couldn't read/update the muted RCAs during start()\", e);\n+      LOG.error(\"Couldn't read/update the muted RCAs\", e);\n       StatsCollector.instance().logMetric(RCA_MUTE_ERROR_METRIC);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjcyMjAxNg=="}, "originalCommit": {"oid": "35c416d2ddb7b44388affd197ba6842fab6d4d72"}, "originalPosition": 121}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkxNTIwMzEwOnYy", "diffSide": "RIGHT", "path": "src/main/java/com/amazon/opendistro/elasticsearch/performanceanalyzer/rca/framework/core/ConfJsonWrapper.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQyMjo0MDowNVrOG9Gh3A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wN1QwMToyMzowNlrOG9JWIA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjcyMzI5Mg==", "bodyText": "nit: Can we move this declaration to Line 48", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/325#discussion_r466723292", "createdAt": "2020-08-06T22:40:05Z", "author": {"login": "khushbr"}, "path": "src/main/java/com/amazon/opendistro/elasticsearch/performanceanalyzer/rca/framework/core/ConfJsonWrapper.java", "diffHunk": "@@ -44,6 +45,10 @@\n   private final List<String> mutedRcaList;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "35c416d2ddb7b44388affd197ba6842fab6d4d72"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Njc2OTQ0MA==", "bodyText": "Done.", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/325#discussion_r466769440", "createdAt": "2020-08-07T01:23:06Z", "author": {"login": "ktkrg"}, "path": "src/main/java/com/amazon/opendistro/elasticsearch/performanceanalyzer/rca/framework/core/ConfJsonWrapper.java", "diffHunk": "@@ -44,6 +45,10 @@\n   private final List<String> mutedRcaList;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjcyMzI5Mg=="}, "originalCommit": {"oid": "35c416d2ddb7b44388affd197ba6842fab6d4d72"}, "originalPosition": 18}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkxNTI1Nzk3OnYy", "diffSide": "RIGHT", "path": "src/main/java/com/amazon/opendistro/elasticsearch/performanceanalyzer/config/overrides/ConfigOverridesApplier.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQyMzowNTo0NlrOG9HC8w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wN1QwMToyMzowOVrOG9JWLg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjczMTc2Mw==", "bodyText": "Do we need DEBUG level log statements here for the components removed and similarly for below, added to muted components?", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/325#discussion_r466731763", "createdAt": "2020-08-06T23:05:46Z", "author": {"login": "khushbr"}, "path": "src/main/java/com/amazon/opendistro/elasticsearch/performanceanalyzer/config/overrides/ConfigOverridesApplier.java", "diffHunk": "@@ -0,0 +1,117 @@\n+/*\n+ * Copyright 2020 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ * permissions and limitations under the License.\n+ */\n+\n+package com.amazon.opendistro.elasticsearch.performanceanalyzer.config.overrides;\n+\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.PerformanceAnalyzerApp;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.framework.core.RcaConf;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.reader.ClusterDetailsEventProcessor;\n+import java.io.IOException;\n+import java.util.HashSet;\n+import java.util.Set;\n+import org.apache.commons.lang3.math.NumberUtils;\n+import org.apache.logging.log4j.LogManager;\n+import org.apache.logging.log4j.Logger;\n+\n+/**\n+ * Class the manages applying the various overrides for RCAs, deciders, and action nodes as\n+ * written by the NodeDetails collector and read by the {@link ClusterDetailsEventProcessor}\n+ */\n+public class ConfigOverridesApplier {\n+\n+  private static final Logger LOG = LogManager.getLogger(ConfigOverridesApplier.class);\n+  private volatile long lastAppliedTimestamp;\n+\n+  public void applyOverride(final String overridesJson, final String lastUpdatedTimestampString) {\n+    if (!valid(overridesJson, lastUpdatedTimestampString)) {\n+      LOG.warn(\"Received invalid overrides or timestamp. Overrides json: {}, last updated \"\n+          + \"timestamp: {}\", overridesJson, lastAppliedTimestamp);\n+      return;\n+    }\n+\n+    try {\n+      long lastUpdatedTimestamp = Long.parseLong(lastUpdatedTimestampString);\n+      LOG.debug(\"Last updated(writer): {}, Last applied(reader): {}\", lastUpdatedTimestamp,\n+          lastAppliedTimestamp);\n+      if (lastUpdatedTimestamp > lastAppliedTimestamp) {\n+        apply(ConfigOverridesHelper.deserialize(overridesJson));\n+      } else {\n+        LOG.debug(\"Not applying override. Last updated timestamp {} is behind last applied \"\n+            + \"timestamp {}\", lastUpdatedTimestamp, lastAppliedTimestamp);\n+      }\n+    } catch (IOException ioe) {\n+      LOG.error(\"Unable to deserialize overrides JSON:\" + overridesJson, ioe);\n+    }\n+  }\n+\n+  private void apply(final ConfigOverrides overrides) {\n+    if (PerformanceAnalyzerApp.getRcaController() != null && PerformanceAnalyzerApp.getRcaController().isRcaEnabled()) {\n+      LOG.info(\"Applying overrides: {}\", overrides.getEnable().getRcas());\n+      RcaConf rcaConf = PerformanceAnalyzerApp.getRcaController().getRcaConf();\n+      if (rcaConf != null) {\n+        Set<String> currentMutedRcaSet = new HashSet<>(rcaConf.getMutedRcaList());\n+        Set<String> currentMutedDeciderSet = new HashSet<>(rcaConf.getMutedDeciderList());\n+        Set<String> currentMutedActionSet = new HashSet<>(rcaConf.getMutedActionList());\n+        // check and remove any nodes that are in the disabled list that were enabled just now.\n+        if (overrides.getEnable() != null) {\n+          if (overrides.getEnable().getRcas() != null) {\n+            currentMutedRcaSet.removeAll(overrides.getEnable().getRcas());\n+          }\n+          if (overrides.getEnable().getDeciders() != null) {\n+            currentMutedDeciderSet.removeAll(overrides.getEnable().getDeciders());\n+          }\n+          if (overrides.getEnable().getActions() != null) {\n+            currentMutedActionSet.removeAll(overrides.getEnable().getActions());\n+          }\n+        }\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "35c416d2ddb7b44388affd197ba6842fab6d4d72"}, "originalPosition": 79}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Njc2OTQ1NA==", "bodyText": "Added.", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/325#discussion_r466769454", "createdAt": "2020-08-07T01:23:09Z", "author": {"login": "ktkrg"}, "path": "src/main/java/com/amazon/opendistro/elasticsearch/performanceanalyzer/config/overrides/ConfigOverridesApplier.java", "diffHunk": "@@ -0,0 +1,117 @@\n+/*\n+ * Copyright 2020 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ * permissions and limitations under the License.\n+ */\n+\n+package com.amazon.opendistro.elasticsearch.performanceanalyzer.config.overrides;\n+\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.PerformanceAnalyzerApp;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.framework.core.RcaConf;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.reader.ClusterDetailsEventProcessor;\n+import java.io.IOException;\n+import java.util.HashSet;\n+import java.util.Set;\n+import org.apache.commons.lang3.math.NumberUtils;\n+import org.apache.logging.log4j.LogManager;\n+import org.apache.logging.log4j.Logger;\n+\n+/**\n+ * Class the manages applying the various overrides for RCAs, deciders, and action nodes as\n+ * written by the NodeDetails collector and read by the {@link ClusterDetailsEventProcessor}\n+ */\n+public class ConfigOverridesApplier {\n+\n+  private static final Logger LOG = LogManager.getLogger(ConfigOverridesApplier.class);\n+  private volatile long lastAppliedTimestamp;\n+\n+  public void applyOverride(final String overridesJson, final String lastUpdatedTimestampString) {\n+    if (!valid(overridesJson, lastUpdatedTimestampString)) {\n+      LOG.warn(\"Received invalid overrides or timestamp. Overrides json: {}, last updated \"\n+          + \"timestamp: {}\", overridesJson, lastAppliedTimestamp);\n+      return;\n+    }\n+\n+    try {\n+      long lastUpdatedTimestamp = Long.parseLong(lastUpdatedTimestampString);\n+      LOG.debug(\"Last updated(writer): {}, Last applied(reader): {}\", lastUpdatedTimestamp,\n+          lastAppliedTimestamp);\n+      if (lastUpdatedTimestamp > lastAppliedTimestamp) {\n+        apply(ConfigOverridesHelper.deserialize(overridesJson));\n+      } else {\n+        LOG.debug(\"Not applying override. Last updated timestamp {} is behind last applied \"\n+            + \"timestamp {}\", lastUpdatedTimestamp, lastAppliedTimestamp);\n+      }\n+    } catch (IOException ioe) {\n+      LOG.error(\"Unable to deserialize overrides JSON:\" + overridesJson, ioe);\n+    }\n+  }\n+\n+  private void apply(final ConfigOverrides overrides) {\n+    if (PerformanceAnalyzerApp.getRcaController() != null && PerformanceAnalyzerApp.getRcaController().isRcaEnabled()) {\n+      LOG.info(\"Applying overrides: {}\", overrides.getEnable().getRcas());\n+      RcaConf rcaConf = PerformanceAnalyzerApp.getRcaController().getRcaConf();\n+      if (rcaConf != null) {\n+        Set<String> currentMutedRcaSet = new HashSet<>(rcaConf.getMutedRcaList());\n+        Set<String> currentMutedDeciderSet = new HashSet<>(rcaConf.getMutedDeciderList());\n+        Set<String> currentMutedActionSet = new HashSet<>(rcaConf.getMutedActionList());\n+        // check and remove any nodes that are in the disabled list that were enabled just now.\n+        if (overrides.getEnable() != null) {\n+          if (overrides.getEnable().getRcas() != null) {\n+            currentMutedRcaSet.removeAll(overrides.getEnable().getRcas());\n+          }\n+          if (overrides.getEnable().getDeciders() != null) {\n+            currentMutedDeciderSet.removeAll(overrides.getEnable().getDeciders());\n+          }\n+          if (overrides.getEnable().getActions() != null) {\n+            currentMutedActionSet.removeAll(overrides.getEnable().getActions());\n+          }\n+        }\n+", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjczMTc2Mw=="}, "originalCommit": {"oid": "35c416d2ddb7b44388affd197ba6842fab6d4d72"}, "originalPosition": 79}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkxNTQ1Njk4OnYy", "diffSide": "RIGHT", "path": "src/main/java/com/amazon/opendistro/elasticsearch/performanceanalyzer/config/overrides/ConfigOverridesApplier.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wN1QwMDo1MToyOFrOG9I18g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wN1QwNDo1NDoyOVrOG9McOw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Njc2MTIwMg==", "bodyText": "I don't think this needs to be volatile as the only readers are tests. Volatile is bad for performance. Let's remove the class member variables.", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/325#discussion_r466761202", "createdAt": "2020-08-07T00:51:28Z", "author": {"login": "yojs"}, "path": "src/main/java/com/amazon/opendistro/elasticsearch/performanceanalyzer/config/overrides/ConfigOverridesApplier.java", "diffHunk": "@@ -0,0 +1,117 @@\n+/*\n+ * Copyright 2020 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ * permissions and limitations under the License.\n+ */\n+\n+package com.amazon.opendistro.elasticsearch.performanceanalyzer.config.overrides;\n+\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.PerformanceAnalyzerApp;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.framework.core.RcaConf;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.reader.ClusterDetailsEventProcessor;\n+import java.io.IOException;\n+import java.util.HashSet;\n+import java.util.Set;\n+import org.apache.commons.lang3.math.NumberUtils;\n+import org.apache.logging.log4j.LogManager;\n+import org.apache.logging.log4j.Logger;\n+\n+/**\n+ * Class the manages applying the various overrides for RCAs, deciders, and action nodes as\n+ * written by the NodeDetails collector and read by the {@link ClusterDetailsEventProcessor}\n+ */\n+public class ConfigOverridesApplier {\n+\n+  private static final Logger LOG = LogManager.getLogger(ConfigOverridesApplier.class);\n+  private volatile long lastAppliedTimestamp;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "35c416d2ddb7b44388affd197ba6842fab6d4d72"}, "originalPosition": 35}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjgyMDE1NQ==", "bodyText": "removed.", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/325#discussion_r466820155", "createdAt": "2020-08-07T04:54:29Z", "author": {"login": "ktkrg"}, "path": "src/main/java/com/amazon/opendistro/elasticsearch/performanceanalyzer/config/overrides/ConfigOverridesApplier.java", "diffHunk": "@@ -0,0 +1,117 @@\n+/*\n+ * Copyright 2020 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ * permissions and limitations under the License.\n+ */\n+\n+package com.amazon.opendistro.elasticsearch.performanceanalyzer.config.overrides;\n+\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.PerformanceAnalyzerApp;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.framework.core.RcaConf;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.reader.ClusterDetailsEventProcessor;\n+import java.io.IOException;\n+import java.util.HashSet;\n+import java.util.Set;\n+import org.apache.commons.lang3.math.NumberUtils;\n+import org.apache.logging.log4j.LogManager;\n+import org.apache.logging.log4j.Logger;\n+\n+/**\n+ * Class the manages applying the various overrides for RCAs, deciders, and action nodes as\n+ * written by the NodeDetails collector and read by the {@link ClusterDetailsEventProcessor}\n+ */\n+public class ConfigOverridesApplier {\n+\n+  private static final Logger LOG = LogManager.getLogger(ConfigOverridesApplier.class);\n+  private volatile long lastAppliedTimestamp;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Njc2MTIwMg=="}, "originalCommit": {"oid": "35c416d2ddb7b44388affd197ba6842fab6d4d72"}, "originalPosition": 35}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkxNTQ2MDkxOnYy", "diffSide": "RIGHT", "path": "src/main/java/com/amazon/opendistro/elasticsearch/performanceanalyzer/reader/ClusterDetailsEventProcessor.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wN1QwMDo1Mzo1M1rOG9I4Rg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wN1QxNjo1Njo1NlrOG9hFUw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Njc2MTc5OA==", "bodyText": "This file used to be a json object per line. It would be nice if we can keep that and push the override timestamp inside as follows:\n{\"overrides\": {\"enabled\": {}, \"disabled\": {}}, ts:54674895}", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/325#discussion_r466761798", "createdAt": "2020-08-07T00:53:53Z", "author": {"login": "yojs"}, "path": "src/main/java/com/amazon/opendistro/elasticsearch/performanceanalyzer/reader/ClusterDetailsEventProcessor.java", "diffHunk": "@@ -75,15 +87,18 @@ public void processEvent(Event event) {\n \n     // An example node_metrics data is something like this for a two node cluster:\n     // {\"current_time\":1566414001749}\n+    // 1566414001749", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "35c416d2ddb7b44388affd197ba6842fab6d4d72"}, "originalPosition": 39}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjgyMDE3NA==", "bodyText": "This needs a change in the plugin as well. Will follow up with a separate PR for this.", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/325#discussion_r466820174", "createdAt": "2020-08-07T04:54:33Z", "author": {"login": "ktkrg"}, "path": "src/main/java/com/amazon/opendistro/elasticsearch/performanceanalyzer/reader/ClusterDetailsEventProcessor.java", "diffHunk": "@@ -75,15 +87,18 @@ public void processEvent(Event event) {\n \n     // An example node_metrics data is something like this for a two node cluster:\n     // {\"current_time\":1566414001749}\n+    // 1566414001749", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Njc2MTc5OA=="}, "originalCommit": {"oid": "35c416d2ddb7b44388affd197ba6842fab6d4d72"}, "originalPosition": 39}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzE1ODM1NQ==", "bodyText": "cool. But let's change it.", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/325#discussion_r467158355", "createdAt": "2020-08-07T16:56:56Z", "author": {"login": "yojs"}, "path": "src/main/java/com/amazon/opendistro/elasticsearch/performanceanalyzer/reader/ClusterDetailsEventProcessor.java", "diffHunk": "@@ -75,15 +87,18 @@ public void processEvent(Event event) {\n \n     // An example node_metrics data is something like this for a two node cluster:\n     // {\"current_time\":1566414001749}\n+    // 1566414001749", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Njc2MTc5OA=="}, "originalCommit": {"oid": "35c416d2ddb7b44388affd197ba6842fab6d4d72"}, "originalPosition": 39}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkxNTQ4NjM2OnYy", "diffSide": "RIGHT", "path": "src/main/java/com/amazon/opendistro/elasticsearch/performanceanalyzer/rca/framework/core/Stats.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wN1QwMTowODoyNFrOG9JGuA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wN1QwNDo1NDozNlrOG9McZA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Njc2NTQ5Ng==", "bodyText": "It would be nice if we don't add code to this class anymore and in future, we just deprecate it. Adding anything to this class restricts us to have a uniform view of things across all virtualInstances during RCA-IT and we won't be able to test things like nodes running different versions of graphs and different muted rca as such.\nwe have this new kid in the block to pass around things - appContext. Any chance we can use it ?", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/325#discussion_r466765496", "createdAt": "2020-08-07T01:08:24Z", "author": {"login": "yojs"}, "path": "src/main/java/com/amazon/opendistro/elasticsearch/performanceanalyzer/rca/framework/core/Stats.java", "diffHunk": "@@ -29,6 +30,7 @@\n   private Map<Integer, ConnectedComponent> graphs;\n \n   private Set<String> mutedGraphNodes;\n+  private Set<String> mutedActions;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "35c416d2ddb7b44388affd197ba6842fab6d4d72"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjgyMDE5Ng==", "bodyText": "yup, using it now.", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/325#discussion_r466820196", "createdAt": "2020-08-07T04:54:36Z", "author": {"login": "ktkrg"}, "path": "src/main/java/com/amazon/opendistro/elasticsearch/performanceanalyzer/rca/framework/core/Stats.java", "diffHunk": "@@ -29,6 +30,7 @@\n   private Map<Integer, ConnectedComponent> graphs;\n \n   private Set<String> mutedGraphNodes;\n+  private Set<String> mutedActions;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Njc2NTQ5Ng=="}, "originalCommit": {"oid": "35c416d2ddb7b44388affd197ba6842fab6d4d72"}, "originalPosition": 12}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkxNTQ5OTk1OnYy", "diffSide": "RIGHT", "path": "src/main/java/com/amazon/opendistro/elasticsearch/performanceanalyzer/reader/ClusterDetailsEventProcessor.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wN1QwMToxNTo1MlrOG9JOdw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wN1QwNDo1NDozOVrOG9Mcbw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Njc2NzQ3OQ==", "bodyText": "This is not valid json: we are missing a } in the end", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/325#discussion_r466767479", "createdAt": "2020-08-07T01:15:52Z", "author": {"login": "yojs"}, "path": "src/main/java/com/amazon/opendistro/elasticsearch/performanceanalyzer/reader/ClusterDetailsEventProcessor.java", "diffHunk": "@@ -75,15 +87,18 @@ public void processEvent(Event event) {\n \n     // An example node_metrics data is something like this for a two node cluster:\n     // {\"current_time\":1566414001749}\n+    // 1566414001749\n     // {\"overrides\": {\"enabled\": {}, \"disabled\": {}}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "35c416d2ddb7b44388affd197ba6842fab6d4d72"}, "originalPosition": 40}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjgyMDIwNw==", "bodyText": "Added.", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/325#discussion_r466820207", "createdAt": "2020-08-07T04:54:39Z", "author": {"login": "ktkrg"}, "path": "src/main/java/com/amazon/opendistro/elasticsearch/performanceanalyzer/reader/ClusterDetailsEventProcessor.java", "diffHunk": "@@ -75,15 +87,18 @@ public void processEvent(Event event) {\n \n     // An example node_metrics data is something like this for a two node cluster:\n     // {\"current_time\":1566414001749}\n+    // 1566414001749\n     // {\"overrides\": {\"enabled\": {}, \"disabled\": {}}", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Njc2NzQ3OQ=="}, "originalCommit": {"oid": "35c416d2ddb7b44388affd197ba6842fab6d4d72"}, "originalPosition": 40}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkxNTUwODExOnYy", "diffSide": "RIGHT", "path": "src/main/java/com/amazon/opendistro/elasticsearch/performanceanalyzer/config/overrides/ConfigOverridesApplier.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wN1QwMToyMDoxNVrOG9JTIg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wN1QwNDo1NDo0MlrOG9Mcdg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Njc2ODY3NA==", "bodyText": "Do we want to handle parse exception ?", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/325#discussion_r466768674", "createdAt": "2020-08-07T01:20:15Z", "author": {"login": "yojs"}, "path": "src/main/java/com/amazon/opendistro/elasticsearch/performanceanalyzer/config/overrides/ConfigOverridesApplier.java", "diffHunk": "@@ -0,0 +1,117 @@\n+/*\n+ * Copyright 2020 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ * permissions and limitations under the License.\n+ */\n+\n+package com.amazon.opendistro.elasticsearch.performanceanalyzer.config.overrides;\n+\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.PerformanceAnalyzerApp;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.framework.core.RcaConf;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.reader.ClusterDetailsEventProcessor;\n+import java.io.IOException;\n+import java.util.HashSet;\n+import java.util.Set;\n+import org.apache.commons.lang3.math.NumberUtils;\n+import org.apache.logging.log4j.LogManager;\n+import org.apache.logging.log4j.Logger;\n+\n+/**\n+ * Class the manages applying the various overrides for RCAs, deciders, and action nodes as\n+ * written by the NodeDetails collector and read by the {@link ClusterDetailsEventProcessor}\n+ */\n+public class ConfigOverridesApplier {\n+\n+  private static final Logger LOG = LogManager.getLogger(ConfigOverridesApplier.class);\n+  private volatile long lastAppliedTimestamp;\n+\n+  public void applyOverride(final String overridesJson, final String lastUpdatedTimestampString) {\n+    if (!valid(overridesJson, lastUpdatedTimestampString)) {\n+      LOG.warn(\"Received invalid overrides or timestamp. Overrides json: {}, last updated \"\n+          + \"timestamp: {}\", overridesJson, lastAppliedTimestamp);\n+      return;\n+    }\n+\n+    try {\n+      long lastUpdatedTimestamp = Long.parseLong(lastUpdatedTimestampString);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "35c416d2ddb7b44388affd197ba6842fab6d4d72"}, "originalPosition": 45}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjgyMDIxNA==", "bodyText": "Handling now.", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/325#discussion_r466820214", "createdAt": "2020-08-07T04:54:42Z", "author": {"login": "ktkrg"}, "path": "src/main/java/com/amazon/opendistro/elasticsearch/performanceanalyzer/config/overrides/ConfigOverridesApplier.java", "diffHunk": "@@ -0,0 +1,117 @@\n+/*\n+ * Copyright 2020 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ * permissions and limitations under the License.\n+ */\n+\n+package com.amazon.opendistro.elasticsearch.performanceanalyzer.config.overrides;\n+\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.PerformanceAnalyzerApp;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.framework.core.RcaConf;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.reader.ClusterDetailsEventProcessor;\n+import java.io.IOException;\n+import java.util.HashSet;\n+import java.util.Set;\n+import org.apache.commons.lang3.math.NumberUtils;\n+import org.apache.logging.log4j.LogManager;\n+import org.apache.logging.log4j.Logger;\n+\n+/**\n+ * Class the manages applying the various overrides for RCAs, deciders, and action nodes as\n+ * written by the NodeDetails collector and read by the {@link ClusterDetailsEventProcessor}\n+ */\n+public class ConfigOverridesApplier {\n+\n+  private static final Logger LOG = LogManager.getLogger(ConfigOverridesApplier.class);\n+  private volatile long lastAppliedTimestamp;\n+\n+  public void applyOverride(final String overridesJson, final String lastUpdatedTimestampString) {\n+    if (!valid(overridesJson, lastUpdatedTimestampString)) {\n+      LOG.warn(\"Received invalid overrides or timestamp. Overrides json: {}, last updated \"\n+          + \"timestamp: {}\", overridesJson, lastAppliedTimestamp);\n+      return;\n+    }\n+\n+    try {\n+      long lastUpdatedTimestamp = Long.parseLong(lastUpdatedTimestampString);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Njc2ODY3NA=="}, "originalCommit": {"oid": "35c416d2ddb7b44388affd197ba6842fab6d4d72"}, "originalPosition": 45}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkxNTUxNTMwOnYy", "diffSide": "RIGHT", "path": "src/main/java/com/amazon/opendistro/elasticsearch/performanceanalyzer/config/overrides/ConfigOverridesApplier.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wN1QwMToyNDoyN1rOG9JXcg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wN1QwNDo1NDo0N1rOG9Mcjw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Njc2OTc3OA==", "bodyText": "The callers of this are the test methods. Let's add a VisibleForTesting annotation.", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/325#discussion_r466769778", "createdAt": "2020-08-07T01:24:27Z", "author": {"login": "yojs"}, "path": "src/main/java/com/amazon/opendistro/elasticsearch/performanceanalyzer/config/overrides/ConfigOverridesApplier.java", "diffHunk": "@@ -0,0 +1,117 @@\n+/*\n+ * Copyright 2020 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ * permissions and limitations under the License.\n+ */\n+\n+package com.amazon.opendistro.elasticsearch.performanceanalyzer.config.overrides;\n+\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.PerformanceAnalyzerApp;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.framework.core.RcaConf;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.reader.ClusterDetailsEventProcessor;\n+import java.io.IOException;\n+import java.util.HashSet;\n+import java.util.Set;\n+import org.apache.commons.lang3.math.NumberUtils;\n+import org.apache.logging.log4j.LogManager;\n+import org.apache.logging.log4j.Logger;\n+\n+/**\n+ * Class the manages applying the various overrides for RCAs, deciders, and action nodes as\n+ * written by the NodeDetails collector and read by the {@link ClusterDetailsEventProcessor}\n+ */\n+public class ConfigOverridesApplier {\n+\n+  private static final Logger LOG = LogManager.getLogger(ConfigOverridesApplier.class);\n+  private volatile long lastAppliedTimestamp;\n+\n+  public void applyOverride(final String overridesJson, final String lastUpdatedTimestampString) {\n+    if (!valid(overridesJson, lastUpdatedTimestampString)) {\n+      LOG.warn(\"Received invalid overrides or timestamp. Overrides json: {}, last updated \"\n+          + \"timestamp: {}\", overridesJson, lastAppliedTimestamp);\n+      return;\n+    }\n+\n+    try {\n+      long lastUpdatedTimestamp = Long.parseLong(lastUpdatedTimestampString);\n+      LOG.debug(\"Last updated(writer): {}, Last applied(reader): {}\", lastUpdatedTimestamp,\n+          lastAppliedTimestamp);\n+      if (lastUpdatedTimestamp > lastAppliedTimestamp) {\n+        apply(ConfigOverridesHelper.deserialize(overridesJson));\n+      } else {\n+        LOG.debug(\"Not applying override. Last updated timestamp {} is behind last applied \"\n+            + \"timestamp {}\", lastUpdatedTimestamp, lastAppliedTimestamp);\n+      }\n+    } catch (IOException ioe) {\n+      LOG.error(\"Unable to deserialize overrides JSON:\" + overridesJson, ioe);\n+    }\n+  }\n+\n+  private void apply(final ConfigOverrides overrides) {\n+    if (PerformanceAnalyzerApp.getRcaController() != null && PerformanceAnalyzerApp.getRcaController().isRcaEnabled()) {\n+      LOG.info(\"Applying overrides: {}\", overrides.getEnable().getRcas());\n+      RcaConf rcaConf = PerformanceAnalyzerApp.getRcaController().getRcaConf();\n+      if (rcaConf != null) {\n+        Set<String> currentMutedRcaSet = new HashSet<>(rcaConf.getMutedRcaList());\n+        Set<String> currentMutedDeciderSet = new HashSet<>(rcaConf.getMutedDeciderList());\n+        Set<String> currentMutedActionSet = new HashSet<>(rcaConf.getMutedActionList());\n+        // check and remove any nodes that are in the disabled list that were enabled just now.\n+        if (overrides.getEnable() != null) {\n+          if (overrides.getEnable().getRcas() != null) {\n+            currentMutedRcaSet.removeAll(overrides.getEnable().getRcas());\n+          }\n+          if (overrides.getEnable().getDeciders() != null) {\n+            currentMutedDeciderSet.removeAll(overrides.getEnable().getDeciders());\n+          }\n+          if (overrides.getEnable().getActions() != null) {\n+            currentMutedActionSet.removeAll(overrides.getEnable().getActions());\n+          }\n+        }\n+\n+        // union the remaining already disabled nodes with the new set of disabled nodes.\n+        if (overrides.getDisable() != null) {\n+          if (overrides.getDisable().getRcas() != null) {\n+            currentMutedRcaSet.addAll(overrides.getDisable().getRcas());\n+          }\n+          if (overrides.getDisable().getDeciders() != null) {\n+            currentMutedDeciderSet.addAll(overrides.getDisable().getDeciders());\n+          }\n+          if (overrides.getDisable().getActions() != null) {\n+            currentMutedActionSet.addAll(overrides.getDisable().getActions());\n+          }\n+        }\n+        rcaConf.updateRcaConf(currentMutedRcaSet, currentMutedDeciderSet, currentMutedActionSet);\n+        setLastAppliedTimestamp(System.currentTimeMillis());\n+      }\n+    }\n+  }\n+\n+  private boolean valid(final String overridesJson, final String timestamp) {\n+    if (overridesJson == null || timestamp == null) {\n+      return false;\n+    }\n+\n+    if (overridesJson.isEmpty() || timestamp.isEmpty()) {\n+      return false;\n+    }\n+\n+    return NumberUtils.isCreatable(timestamp);\n+  }\n+\n+  public long getLastAppliedTimestamp() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "35c416d2ddb7b44388affd197ba6842fab6d4d72"}, "originalPosition": 110}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjgyMDIzOQ==", "bodyText": "done.", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/325#discussion_r466820239", "createdAt": "2020-08-07T04:54:47Z", "author": {"login": "ktkrg"}, "path": "src/main/java/com/amazon/opendistro/elasticsearch/performanceanalyzer/config/overrides/ConfigOverridesApplier.java", "diffHunk": "@@ -0,0 +1,117 @@\n+/*\n+ * Copyright 2020 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ * permissions and limitations under the License.\n+ */\n+\n+package com.amazon.opendistro.elasticsearch.performanceanalyzer.config.overrides;\n+\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.PerformanceAnalyzerApp;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.framework.core.RcaConf;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.reader.ClusterDetailsEventProcessor;\n+import java.io.IOException;\n+import java.util.HashSet;\n+import java.util.Set;\n+import org.apache.commons.lang3.math.NumberUtils;\n+import org.apache.logging.log4j.LogManager;\n+import org.apache.logging.log4j.Logger;\n+\n+/**\n+ * Class the manages applying the various overrides for RCAs, deciders, and action nodes as\n+ * written by the NodeDetails collector and read by the {@link ClusterDetailsEventProcessor}\n+ */\n+public class ConfigOverridesApplier {\n+\n+  private static final Logger LOG = LogManager.getLogger(ConfigOverridesApplier.class);\n+  private volatile long lastAppliedTimestamp;\n+\n+  public void applyOverride(final String overridesJson, final String lastUpdatedTimestampString) {\n+    if (!valid(overridesJson, lastUpdatedTimestampString)) {\n+      LOG.warn(\"Received invalid overrides or timestamp. Overrides json: {}, last updated \"\n+          + \"timestamp: {}\", overridesJson, lastAppliedTimestamp);\n+      return;\n+    }\n+\n+    try {\n+      long lastUpdatedTimestamp = Long.parseLong(lastUpdatedTimestampString);\n+      LOG.debug(\"Last updated(writer): {}, Last applied(reader): {}\", lastUpdatedTimestamp,\n+          lastAppliedTimestamp);\n+      if (lastUpdatedTimestamp > lastAppliedTimestamp) {\n+        apply(ConfigOverridesHelper.deserialize(overridesJson));\n+      } else {\n+        LOG.debug(\"Not applying override. Last updated timestamp {} is behind last applied \"\n+            + \"timestamp {}\", lastUpdatedTimestamp, lastAppliedTimestamp);\n+      }\n+    } catch (IOException ioe) {\n+      LOG.error(\"Unable to deserialize overrides JSON:\" + overridesJson, ioe);\n+    }\n+  }\n+\n+  private void apply(final ConfigOverrides overrides) {\n+    if (PerformanceAnalyzerApp.getRcaController() != null && PerformanceAnalyzerApp.getRcaController().isRcaEnabled()) {\n+      LOG.info(\"Applying overrides: {}\", overrides.getEnable().getRcas());\n+      RcaConf rcaConf = PerformanceAnalyzerApp.getRcaController().getRcaConf();\n+      if (rcaConf != null) {\n+        Set<String> currentMutedRcaSet = new HashSet<>(rcaConf.getMutedRcaList());\n+        Set<String> currentMutedDeciderSet = new HashSet<>(rcaConf.getMutedDeciderList());\n+        Set<String> currentMutedActionSet = new HashSet<>(rcaConf.getMutedActionList());\n+        // check and remove any nodes that are in the disabled list that were enabled just now.\n+        if (overrides.getEnable() != null) {\n+          if (overrides.getEnable().getRcas() != null) {\n+            currentMutedRcaSet.removeAll(overrides.getEnable().getRcas());\n+          }\n+          if (overrides.getEnable().getDeciders() != null) {\n+            currentMutedDeciderSet.removeAll(overrides.getEnable().getDeciders());\n+          }\n+          if (overrides.getEnable().getActions() != null) {\n+            currentMutedActionSet.removeAll(overrides.getEnable().getActions());\n+          }\n+        }\n+\n+        // union the remaining already disabled nodes with the new set of disabled nodes.\n+        if (overrides.getDisable() != null) {\n+          if (overrides.getDisable().getRcas() != null) {\n+            currentMutedRcaSet.addAll(overrides.getDisable().getRcas());\n+          }\n+          if (overrides.getDisable().getDeciders() != null) {\n+            currentMutedDeciderSet.addAll(overrides.getDisable().getDeciders());\n+          }\n+          if (overrides.getDisable().getActions() != null) {\n+            currentMutedActionSet.addAll(overrides.getDisable().getActions());\n+          }\n+        }\n+        rcaConf.updateRcaConf(currentMutedRcaSet, currentMutedDeciderSet, currentMutedActionSet);\n+        setLastAppliedTimestamp(System.currentTimeMillis());\n+      }\n+    }\n+  }\n+\n+  private boolean valid(final String overridesJson, final String timestamp) {\n+    if (overridesJson == null || timestamp == null) {\n+      return false;\n+    }\n+\n+    if (overridesJson.isEmpty() || timestamp.isEmpty()) {\n+      return false;\n+    }\n+\n+    return NumberUtils.isCreatable(timestamp);\n+  }\n+\n+  public long getLastAppliedTimestamp() {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Njc2OTc3OA=="}, "originalCommit": {"oid": "35c416d2ddb7b44388affd197ba6842fab6d4d72"}, "originalPosition": 110}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkxNTUyNzE3OnYy", "diffSide": "RIGHT", "path": "src/main/java/com/amazon/opendistro/elasticsearch/performanceanalyzer/config/overrides/ConfigOverridesApplier.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wN1QwMTozMTowNFrOG9JePw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wN1QwNDo1NTowNVrOG9Mc9Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Njc3MTUxOQ==", "bodyText": "Should we get the list of rca.conf from the RcaControllerHelper and apply to all three of them ? If the node role changes, then the muting will be invalidated.\nAny changes that you make to the static set of objects in PerformanceAnalyzerApp may not be tested using RCA-IT.", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/325#discussion_r466771519", "createdAt": "2020-08-07T01:31:04Z", "author": {"login": "yojs"}, "path": "src/main/java/com/amazon/opendistro/elasticsearch/performanceanalyzer/config/overrides/ConfigOverridesApplier.java", "diffHunk": "@@ -0,0 +1,117 @@\n+/*\n+ * Copyright 2020 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ * permissions and limitations under the License.\n+ */\n+\n+package com.amazon.opendistro.elasticsearch.performanceanalyzer.config.overrides;\n+\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.PerformanceAnalyzerApp;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.framework.core.RcaConf;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.reader.ClusterDetailsEventProcessor;\n+import java.io.IOException;\n+import java.util.HashSet;\n+import java.util.Set;\n+import org.apache.commons.lang3.math.NumberUtils;\n+import org.apache.logging.log4j.LogManager;\n+import org.apache.logging.log4j.Logger;\n+\n+/**\n+ * Class the manages applying the various overrides for RCAs, deciders, and action nodes as\n+ * written by the NodeDetails collector and read by the {@link ClusterDetailsEventProcessor}\n+ */\n+public class ConfigOverridesApplier {\n+\n+  private static final Logger LOG = LogManager.getLogger(ConfigOverridesApplier.class);\n+  private volatile long lastAppliedTimestamp;\n+\n+  public void applyOverride(final String overridesJson, final String lastUpdatedTimestampString) {\n+    if (!valid(overridesJson, lastUpdatedTimestampString)) {\n+      LOG.warn(\"Received invalid overrides or timestamp. Overrides json: {}, last updated \"\n+          + \"timestamp: {}\", overridesJson, lastAppliedTimestamp);\n+      return;\n+    }\n+\n+    try {\n+      long lastUpdatedTimestamp = Long.parseLong(lastUpdatedTimestampString);\n+      LOG.debug(\"Last updated(writer): {}, Last applied(reader): {}\", lastUpdatedTimestamp,\n+          lastAppliedTimestamp);\n+      if (lastUpdatedTimestamp > lastAppliedTimestamp) {\n+        apply(ConfigOverridesHelper.deserialize(overridesJson));\n+      } else {\n+        LOG.debug(\"Not applying override. Last updated timestamp {} is behind last applied \"\n+            + \"timestamp {}\", lastUpdatedTimestamp, lastAppliedTimestamp);\n+      }\n+    } catch (IOException ioe) {\n+      LOG.error(\"Unable to deserialize overrides JSON:\" + overridesJson, ioe);\n+    }\n+  }\n+\n+  private void apply(final ConfigOverrides overrides) {\n+    if (PerformanceAnalyzerApp.getRcaController() != null && PerformanceAnalyzerApp.getRcaController().isRcaEnabled()) {\n+      LOG.info(\"Applying overrides: {}\", overrides.getEnable().getRcas());\n+      RcaConf rcaConf = PerformanceAnalyzerApp.getRcaController().getRcaConf();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "35c416d2ddb7b44388affd197ba6842fab6d4d72"}, "originalPosition": 62}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjgyMDM0MQ==", "bodyText": "Good catch! updating all conf files now.", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/325#discussion_r466820341", "createdAt": "2020-08-07T04:55:05Z", "author": {"login": "ktkrg"}, "path": "src/main/java/com/amazon/opendistro/elasticsearch/performanceanalyzer/config/overrides/ConfigOverridesApplier.java", "diffHunk": "@@ -0,0 +1,117 @@\n+/*\n+ * Copyright 2020 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ * permissions and limitations under the License.\n+ */\n+\n+package com.amazon.opendistro.elasticsearch.performanceanalyzer.config.overrides;\n+\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.PerformanceAnalyzerApp;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.framework.core.RcaConf;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.reader.ClusterDetailsEventProcessor;\n+import java.io.IOException;\n+import java.util.HashSet;\n+import java.util.Set;\n+import org.apache.commons.lang3.math.NumberUtils;\n+import org.apache.logging.log4j.LogManager;\n+import org.apache.logging.log4j.Logger;\n+\n+/**\n+ * Class the manages applying the various overrides for RCAs, deciders, and action nodes as\n+ * written by the NodeDetails collector and read by the {@link ClusterDetailsEventProcessor}\n+ */\n+public class ConfigOverridesApplier {\n+\n+  private static final Logger LOG = LogManager.getLogger(ConfigOverridesApplier.class);\n+  private volatile long lastAppliedTimestamp;\n+\n+  public void applyOverride(final String overridesJson, final String lastUpdatedTimestampString) {\n+    if (!valid(overridesJson, lastUpdatedTimestampString)) {\n+      LOG.warn(\"Received invalid overrides or timestamp. Overrides json: {}, last updated \"\n+          + \"timestamp: {}\", overridesJson, lastAppliedTimestamp);\n+      return;\n+    }\n+\n+    try {\n+      long lastUpdatedTimestamp = Long.parseLong(lastUpdatedTimestampString);\n+      LOG.debug(\"Last updated(writer): {}, Last applied(reader): {}\", lastUpdatedTimestamp,\n+          lastAppliedTimestamp);\n+      if (lastUpdatedTimestamp > lastAppliedTimestamp) {\n+        apply(ConfigOverridesHelper.deserialize(overridesJson));\n+      } else {\n+        LOG.debug(\"Not applying override. Last updated timestamp {} is behind last applied \"\n+            + \"timestamp {}\", lastUpdatedTimestamp, lastAppliedTimestamp);\n+      }\n+    } catch (IOException ioe) {\n+      LOG.error(\"Unable to deserialize overrides JSON:\" + overridesJson, ioe);\n+    }\n+  }\n+\n+  private void apply(final ConfigOverrides overrides) {\n+    if (PerformanceAnalyzerApp.getRcaController() != null && PerformanceAnalyzerApp.getRcaController().isRcaEnabled()) {\n+      LOG.info(\"Applying overrides: {}\", overrides.getEnable().getRcas());\n+      RcaConf rcaConf = PerformanceAnalyzerApp.getRcaController().getRcaConf();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Njc3MTUxOQ=="}, "originalCommit": {"oid": "35c416d2ddb7b44388affd197ba6842fab6d4d72"}, "originalPosition": 62}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkxNTUzMzcyOnYy", "diffSide": "RIGHT", "path": "src/main/java/com/amazon/opendistro/elasticsearch/performanceanalyzer/rca/framework/core/RcaConf.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wN1QwMTozNDozM1rOG9Jh7w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wN1QwNDo1NTowOFrOG9Mc_w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Njc3MjQ2Mw==", "bodyText": "can we move this to the line above ?", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/325#discussion_r466772463", "createdAt": "2020-08-07T01:34:33Z", "author": {"login": "yojs"}, "path": "src/main/java/com/amazon/opendistro/elasticsearch/performanceanalyzer/rca/framework/core/RcaConf.java", "diffHunk": "@@ -155,21 +187,56 @@ public CacheDeciderConfig getCacheDeciderConfig() {\n       if (conf.getRcaConfigSettings() != null\n           && conf.getRcaConfigSettings().containsKey(rcaName)\n           && conf.getRcaConfigSettings().get(rcaName) != null) {\n-        rcaObj = (Map<String, Object>)conf.getRcaConfigSettings().get(rcaName);\n+        rcaObj = (Map<String, Object>) conf.getRcaConfigSettings().get(rcaName);\n       }\n \n       if (rcaObj != null\n           && rcaObj.containsKey(key)\n           && rcaObj.get(key) != null) {\n         setting = clazz.cast(rcaObj.get(key));\n       }\n-    }\n-    catch (ClassCastException ne) {\n+    } catch (ClassCastException ne) {\n       LOG.error(\"rca.conf contains value in invalid format, trace : {}\", ne.getMessage());\n     }\n     return setting;\n   }\n \n+  public void updateRcaConf(final Set<String> mutedRcas, final Set<String> mutedDeciders,\n+      final Set<String> mutedActions) {\n+    String updatedPath = this.configFileLoc + \".updated\";\n+    try (final FileInputStream originalFileInputStream = new FileInputStream(this.configFileLoc);\n+        final Scanner scanner = new Scanner(originalFileInputStream, StandardCharsets.UTF_8.name());\n+        final FileOutputStream updatedFileOutputStream = new FileOutputStream(updatedPath)\n+    ) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "35c416d2ddb7b44388affd197ba6842fab6d4d72"}, "originalPosition": 123}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjgyMDM1MQ==", "bodyText": "done.", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/325#discussion_r466820351", "createdAt": "2020-08-07T04:55:08Z", "author": {"login": "ktkrg"}, "path": "src/main/java/com/amazon/opendistro/elasticsearch/performanceanalyzer/rca/framework/core/RcaConf.java", "diffHunk": "@@ -155,21 +187,56 @@ public CacheDeciderConfig getCacheDeciderConfig() {\n       if (conf.getRcaConfigSettings() != null\n           && conf.getRcaConfigSettings().containsKey(rcaName)\n           && conf.getRcaConfigSettings().get(rcaName) != null) {\n-        rcaObj = (Map<String, Object>)conf.getRcaConfigSettings().get(rcaName);\n+        rcaObj = (Map<String, Object>) conf.getRcaConfigSettings().get(rcaName);\n       }\n \n       if (rcaObj != null\n           && rcaObj.containsKey(key)\n           && rcaObj.get(key) != null) {\n         setting = clazz.cast(rcaObj.get(key));\n       }\n-    }\n-    catch (ClassCastException ne) {\n+    } catch (ClassCastException ne) {\n       LOG.error(\"rca.conf contains value in invalid format, trace : {}\", ne.getMessage());\n     }\n     return setting;\n   }\n \n+  public void updateRcaConf(final Set<String> mutedRcas, final Set<String> mutedDeciders,\n+      final Set<String> mutedActions) {\n+    String updatedPath = this.configFileLoc + \".updated\";\n+    try (final FileInputStream originalFileInputStream = new FileInputStream(this.configFileLoc);\n+        final Scanner scanner = new Scanner(originalFileInputStream, StandardCharsets.UTF_8.name());\n+        final FileOutputStream updatedFileOutputStream = new FileOutputStream(updatedPath)\n+    ) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Njc3MjQ2Mw=="}, "originalCommit": {"oid": "35c416d2ddb7b44388affd197ba6842fab6d4d72"}, "originalPosition": 123}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkxNTU0MjIxOnYy", "diffSide": "RIGHT", "path": "src/main/java/com/amazon/opendistro/elasticsearch/performanceanalyzer/reader/ClusterDetailsEventProcessor.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wN1QwMTozOToyNFrOG9Jmzw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wN1QwNDo1NToxOFrOG9MdMA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Njc3MzcxMQ==", "bodyText": "Maybe we don't need to pass ConfigOverridesApplier as a constructor. No state is kept in it. It reads the config and applies it to the rca.conf. Maybe we can just use it as a helper static class ?", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/325#discussion_r466773711", "createdAt": "2020-08-07T01:39:24Z", "author": {"login": "yojs"}, "path": "src/main/java/com/amazon/opendistro/elasticsearch/performanceanalyzer/reader/ClusterDetailsEventProcessor.java", "diffHunk": "@@ -41,7 +42,15 @@\n    */\n   private volatile ImmutableList<NodeDetails> nodesDetails = null;\n \n-  public ClusterDetailsEventProcessor() {}\n+  private final ConfigOverridesApplier overridesApplier;\n+\n+  public ClusterDetailsEventProcessor() {\n+    this(new ConfigOverridesApplier());\n+  }\n+\n+  public ClusterDetailsEventProcessor(final ConfigOverridesApplier overridesApplier) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "35c416d2ddb7b44388affd197ba6842fab6d4d72"}, "originalPosition": 19}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjgyMDQwMA==", "bodyText": "It does keep the lastAppliedTimestamp as an instance variable and uses that to check if the config overrides string received from the ClusterDetailsEventProcessor. Making it a static helper will make all the consumers see the same value of last applied time(in an IT for example).", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/325#discussion_r466820400", "createdAt": "2020-08-07T04:55:18Z", "author": {"login": "ktkrg"}, "path": "src/main/java/com/amazon/opendistro/elasticsearch/performanceanalyzer/reader/ClusterDetailsEventProcessor.java", "diffHunk": "@@ -41,7 +42,15 @@\n    */\n   private volatile ImmutableList<NodeDetails> nodesDetails = null;\n \n-  public ClusterDetailsEventProcessor() {}\n+  private final ConfigOverridesApplier overridesApplier;\n+\n+  public ClusterDetailsEventProcessor() {\n+    this(new ConfigOverridesApplier());\n+  }\n+\n+  public ClusterDetailsEventProcessor(final ConfigOverridesApplier overridesApplier) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Njc3MzcxMQ=="}, "originalCommit": {"oid": "35c416d2ddb7b44388affd197ba6842fab6d4d72"}, "originalPosition": 19}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkxODEzNTEzOnYy", "diffSide": "RIGHT", "path": "src/main/java/com/amazon/opendistro/elasticsearch/performanceanalyzer/config/overrides/ConfigOverridesApplier.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wN1QxNzoyNDoxMlrOG9h6Eg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wN1QxNzoyNDoxMlrOG9h6Eg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzE3MTg1OA==", "bodyText": "We should be applying change when someone calls the API or at startup, which shouldn't be that many. Should we make it info logs ? Or add a metric.", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/325#discussion_r467171858", "createdAt": "2020-08-07T17:24:12Z", "author": {"login": "yojs"}, "path": "src/main/java/com/amazon/opendistro/elasticsearch/performanceanalyzer/config/overrides/ConfigOverridesApplier.java", "diffHunk": "@@ -0,0 +1,127 @@\n+/*\n+ * Copyright 2020 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ * permissions and limitations under the License.\n+ */\n+\n+package com.amazon.opendistro.elasticsearch.performanceanalyzer.config.overrides;\n+\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.PerformanceAnalyzerApp;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.framework.core.RcaConf;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.reader.ClusterDetailsEventProcessor;\n+import com.google.common.annotations.VisibleForTesting;\n+import java.io.IOException;\n+import java.util.HashSet;\n+import java.util.Set;\n+import org.apache.commons.lang3.math.NumberUtils;\n+import org.apache.logging.log4j.LogManager;\n+import org.apache.logging.log4j.Logger;\n+\n+/**\n+ * Class the manages applying the various overrides for RCAs, deciders, and action nodes as\n+ * written by the NodeDetails collector and read by the {@link ClusterDetailsEventProcessor}\n+ */\n+public class ConfigOverridesApplier {\n+\n+  private static final Logger LOG = LogManager.getLogger(ConfigOverridesApplier.class);\n+  private long lastAppliedTimestamp;\n+\n+  public void applyOverride(final String overridesJson, final String lastUpdatedTimestampString) {\n+    if (!valid(overridesJson, lastUpdatedTimestampString)) {\n+      LOG.warn(\"Received invalid overrides or timestamp. Overrides json: {}, last updated \"\n+          + \"timestamp: {}\", overridesJson, lastAppliedTimestamp);\n+      return;\n+    }\n+\n+    try {\n+      long lastUpdatedTimestamp = Long.parseLong(lastUpdatedTimestampString);\n+      LOG.debug(\"Last updated(writer): {}, Last applied(reader): {}\", lastUpdatedTimestamp,\n+          lastAppliedTimestamp);\n+      if (lastUpdatedTimestamp > lastAppliedTimestamp) {\n+        apply(ConfigOverridesHelper.deserialize(overridesJson));\n+      } else {\n+        LOG.debug(\"Not applying override. Last updated timestamp {} is behind last applied \"\n+            + \"timestamp {}\", lastUpdatedTimestamp, lastAppliedTimestamp);\n+      }\n+    } catch (IOException ioe) {\n+      LOG.error(\"Unable to deserialize overrides JSON:\" + overridesJson, ioe);\n+    } catch (NumberFormatException nfe) {\n+      LOG.error(\"Unable to parse the lastUpdatedTimestamp {} string as a number.\",\n+          lastUpdatedTimestampString, nfe);\n+    }\n+  }\n+\n+  private void apply(final ConfigOverrides overrides) {\n+    if (PerformanceAnalyzerApp.getRcaController() != null && PerformanceAnalyzerApp.getRcaController().isRcaEnabled()) {\n+      LOG.info(\"Applying overrides: {}\", overrides.getEnable().getRcas());\n+      RcaConf rcaConf = PerformanceAnalyzerApp.getRcaController().getRcaConf();\n+      if (rcaConf != null) {\n+        Set<String> currentMutedRcaSet = new HashSet<>(rcaConf.getMutedRcaList());\n+        Set<String> currentMutedDeciderSet = new HashSet<>(rcaConf.getMutedDeciderList());\n+        Set<String> currentMutedActionSet = new HashSet<>(rcaConf.getMutedActionList());\n+        // check and remove any nodes that are in the disabled list that were enabled just now.\n+        if (overrides.getEnable() != null) {\n+          if (overrides.getEnable().getRcas() != null) {\n+            currentMutedRcaSet.removeAll(overrides.getEnable().getRcas());\n+          }\n+          if (overrides.getEnable().getDeciders() != null) {\n+            currentMutedDeciderSet.removeAll(overrides.getEnable().getDeciders());\n+          }\n+          if (overrides.getEnable().getActions() != null) {\n+            currentMutedActionSet.removeAll(overrides.getEnable().getActions());\n+          }\n+        }\n+\n+        // union the remaining already disabled nodes with the new set of disabled nodes.\n+        if (overrides.getDisable() != null) {\n+          if (overrides.getDisable().getRcas() != null) {\n+            currentMutedRcaSet.addAll(overrides.getDisable().getRcas());\n+          }\n+          if (overrides.getDisable().getDeciders() != null) {\n+            currentMutedDeciderSet.addAll(overrides.getDisable().getDeciders());\n+          }\n+          if (overrides.getDisable().getActions() != null) {\n+            currentMutedActionSet.addAll(overrides.getDisable().getActions());\n+          }\n+        }\n+\n+        LOG.debug(\"New set of muted rcas: {}\", currentMutedRcaSet);\n+        LOG.debug(\"New set of muted deciders: {}\", currentMutedDeciderSet);\n+        LOG.debug(\"New set of muted actions: {}\", currentMutedActionSet);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "300dcc5a24bf2ce73182e64cf0fb332baa48e25d"}, "originalPosition": 99}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkxODIxOTc3OnYy", "diffSide": "RIGHT", "path": "src/main/java/com/amazon/opendistro/elasticsearch/performanceanalyzer/config/overrides/ConfigOverridesApplier.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wN1QxNzo1MToxMlrOG9iuCg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wN1QxODo0MTozMFrOG9kJsA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzE4NTE2Mg==", "bodyText": "Now we are updating three rca.conf files. updateAllRcaConfFiles has a void return type. What happens if it succeeded on a subset of files but not all? We will still update lastAppliedTimestamp and never look back until someone makes a change again. So, should we make lastAppliedTimestamp return true when writes on all three files succeed and and then only update the lastAppliedTimestamp. If not, then we will retry again on the next run and eventually all three files will be updated or we likely have a disk corruption or disk full issues. thoughts ?", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/325#discussion_r467185162", "createdAt": "2020-08-07T17:51:12Z", "author": {"login": "yojs"}, "path": "src/main/java/com/amazon/opendistro/elasticsearch/performanceanalyzer/config/overrides/ConfigOverridesApplier.java", "diffHunk": "@@ -0,0 +1,127 @@\n+/*\n+ * Copyright 2020 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ * permissions and limitations under the License.\n+ */\n+\n+package com.amazon.opendistro.elasticsearch.performanceanalyzer.config.overrides;\n+\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.PerformanceAnalyzerApp;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.framework.core.RcaConf;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.reader.ClusterDetailsEventProcessor;\n+import com.google.common.annotations.VisibleForTesting;\n+import java.io.IOException;\n+import java.util.HashSet;\n+import java.util.Set;\n+import org.apache.commons.lang3.math.NumberUtils;\n+import org.apache.logging.log4j.LogManager;\n+import org.apache.logging.log4j.Logger;\n+\n+/**\n+ * Class the manages applying the various overrides for RCAs, deciders, and action nodes as\n+ * written by the NodeDetails collector and read by the {@link ClusterDetailsEventProcessor}\n+ */\n+public class ConfigOverridesApplier {\n+\n+  private static final Logger LOG = LogManager.getLogger(ConfigOverridesApplier.class);\n+  private long lastAppliedTimestamp;\n+\n+  public void applyOverride(final String overridesJson, final String lastUpdatedTimestampString) {\n+    if (!valid(overridesJson, lastUpdatedTimestampString)) {\n+      LOG.warn(\"Received invalid overrides or timestamp. Overrides json: {}, last updated \"\n+          + \"timestamp: {}\", overridesJson, lastAppliedTimestamp);\n+      return;\n+    }\n+\n+    try {\n+      long lastUpdatedTimestamp = Long.parseLong(lastUpdatedTimestampString);\n+      LOG.debug(\"Last updated(writer): {}, Last applied(reader): {}\", lastUpdatedTimestamp,\n+          lastAppliedTimestamp);\n+      if (lastUpdatedTimestamp > lastAppliedTimestamp) {\n+        apply(ConfigOverridesHelper.deserialize(overridesJson));\n+      } else {\n+        LOG.debug(\"Not applying override. Last updated timestamp {} is behind last applied \"\n+            + \"timestamp {}\", lastUpdatedTimestamp, lastAppliedTimestamp);\n+      }\n+    } catch (IOException ioe) {\n+      LOG.error(\"Unable to deserialize overrides JSON:\" + overridesJson, ioe);\n+    } catch (NumberFormatException nfe) {\n+      LOG.error(\"Unable to parse the lastUpdatedTimestamp {} string as a number.\",\n+          lastUpdatedTimestampString, nfe);\n+    }\n+  }\n+\n+  private void apply(final ConfigOverrides overrides) {\n+    if (PerformanceAnalyzerApp.getRcaController() != null && PerformanceAnalyzerApp.getRcaController().isRcaEnabled()) {\n+      LOG.info(\"Applying overrides: {}\", overrides.getEnable().getRcas());\n+      RcaConf rcaConf = PerformanceAnalyzerApp.getRcaController().getRcaConf();\n+      if (rcaConf != null) {\n+        Set<String> currentMutedRcaSet = new HashSet<>(rcaConf.getMutedRcaList());\n+        Set<String> currentMutedDeciderSet = new HashSet<>(rcaConf.getMutedDeciderList());\n+        Set<String> currentMutedActionSet = new HashSet<>(rcaConf.getMutedActionList());\n+        // check and remove any nodes that are in the disabled list that were enabled just now.\n+        if (overrides.getEnable() != null) {\n+          if (overrides.getEnable().getRcas() != null) {\n+            currentMutedRcaSet.removeAll(overrides.getEnable().getRcas());\n+          }\n+          if (overrides.getEnable().getDeciders() != null) {\n+            currentMutedDeciderSet.removeAll(overrides.getEnable().getDeciders());\n+          }\n+          if (overrides.getEnable().getActions() != null) {\n+            currentMutedActionSet.removeAll(overrides.getEnable().getActions());\n+          }\n+        }\n+\n+        // union the remaining already disabled nodes with the new set of disabled nodes.\n+        if (overrides.getDisable() != null) {\n+          if (overrides.getDisable().getRcas() != null) {\n+            currentMutedRcaSet.addAll(overrides.getDisable().getRcas());\n+          }\n+          if (overrides.getDisable().getDeciders() != null) {\n+            currentMutedDeciderSet.addAll(overrides.getDisable().getDeciders());\n+          }\n+          if (overrides.getDisable().getActions() != null) {\n+            currentMutedActionSet.addAll(overrides.getDisable().getActions());\n+          }\n+        }\n+\n+        LOG.debug(\"New set of muted rcas: {}\", currentMutedRcaSet);\n+        LOG.debug(\"New set of muted deciders: {}\", currentMutedDeciderSet);\n+        LOG.debug(\"New set of muted actions: {}\", currentMutedActionSet);\n+        rcaConf.updateAllRcaConfFiles(currentMutedRcaSet, currentMutedDeciderSet, currentMutedActionSet);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "300dcc5a24bf2ce73182e64cf0fb332baa48e25d"}, "originalPosition": 100}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzIwODYyNA==", "bodyText": "That's a good point! I'm checking all three updates before updating the lastAppliedTimestamp.\nI'm also emitting a metric if we fail to update an rca conf file. If we end up in a state where we can't do these file system changes, I think we should be failing in more places than just this, so yea, it's probably ok to do the timestamp update only if all three succeed.", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/325#discussion_r467208624", "createdAt": "2020-08-07T18:41:30Z", "author": {"login": "ktkrg"}, "path": "src/main/java/com/amazon/opendistro/elasticsearch/performanceanalyzer/config/overrides/ConfigOverridesApplier.java", "diffHunk": "@@ -0,0 +1,127 @@\n+/*\n+ * Copyright 2020 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ * permissions and limitations under the License.\n+ */\n+\n+package com.amazon.opendistro.elasticsearch.performanceanalyzer.config.overrides;\n+\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.PerformanceAnalyzerApp;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.framework.core.RcaConf;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.reader.ClusterDetailsEventProcessor;\n+import com.google.common.annotations.VisibleForTesting;\n+import java.io.IOException;\n+import java.util.HashSet;\n+import java.util.Set;\n+import org.apache.commons.lang3.math.NumberUtils;\n+import org.apache.logging.log4j.LogManager;\n+import org.apache.logging.log4j.Logger;\n+\n+/**\n+ * Class the manages applying the various overrides for RCAs, deciders, and action nodes as\n+ * written by the NodeDetails collector and read by the {@link ClusterDetailsEventProcessor}\n+ */\n+public class ConfigOverridesApplier {\n+\n+  private static final Logger LOG = LogManager.getLogger(ConfigOverridesApplier.class);\n+  private long lastAppliedTimestamp;\n+\n+  public void applyOverride(final String overridesJson, final String lastUpdatedTimestampString) {\n+    if (!valid(overridesJson, lastUpdatedTimestampString)) {\n+      LOG.warn(\"Received invalid overrides or timestamp. Overrides json: {}, last updated \"\n+          + \"timestamp: {}\", overridesJson, lastAppliedTimestamp);\n+      return;\n+    }\n+\n+    try {\n+      long lastUpdatedTimestamp = Long.parseLong(lastUpdatedTimestampString);\n+      LOG.debug(\"Last updated(writer): {}, Last applied(reader): {}\", lastUpdatedTimestamp,\n+          lastAppliedTimestamp);\n+      if (lastUpdatedTimestamp > lastAppliedTimestamp) {\n+        apply(ConfigOverridesHelper.deserialize(overridesJson));\n+      } else {\n+        LOG.debug(\"Not applying override. Last updated timestamp {} is behind last applied \"\n+            + \"timestamp {}\", lastUpdatedTimestamp, lastAppliedTimestamp);\n+      }\n+    } catch (IOException ioe) {\n+      LOG.error(\"Unable to deserialize overrides JSON:\" + overridesJson, ioe);\n+    } catch (NumberFormatException nfe) {\n+      LOG.error(\"Unable to parse the lastUpdatedTimestamp {} string as a number.\",\n+          lastUpdatedTimestampString, nfe);\n+    }\n+  }\n+\n+  private void apply(final ConfigOverrides overrides) {\n+    if (PerformanceAnalyzerApp.getRcaController() != null && PerformanceAnalyzerApp.getRcaController().isRcaEnabled()) {\n+      LOG.info(\"Applying overrides: {}\", overrides.getEnable().getRcas());\n+      RcaConf rcaConf = PerformanceAnalyzerApp.getRcaController().getRcaConf();\n+      if (rcaConf != null) {\n+        Set<String> currentMutedRcaSet = new HashSet<>(rcaConf.getMutedRcaList());\n+        Set<String> currentMutedDeciderSet = new HashSet<>(rcaConf.getMutedDeciderList());\n+        Set<String> currentMutedActionSet = new HashSet<>(rcaConf.getMutedActionList());\n+        // check and remove any nodes that are in the disabled list that were enabled just now.\n+        if (overrides.getEnable() != null) {\n+          if (overrides.getEnable().getRcas() != null) {\n+            currentMutedRcaSet.removeAll(overrides.getEnable().getRcas());\n+          }\n+          if (overrides.getEnable().getDeciders() != null) {\n+            currentMutedDeciderSet.removeAll(overrides.getEnable().getDeciders());\n+          }\n+          if (overrides.getEnable().getActions() != null) {\n+            currentMutedActionSet.removeAll(overrides.getEnable().getActions());\n+          }\n+        }\n+\n+        // union the remaining already disabled nodes with the new set of disabled nodes.\n+        if (overrides.getDisable() != null) {\n+          if (overrides.getDisable().getRcas() != null) {\n+            currentMutedRcaSet.addAll(overrides.getDisable().getRcas());\n+          }\n+          if (overrides.getDisable().getDeciders() != null) {\n+            currentMutedDeciderSet.addAll(overrides.getDisable().getDeciders());\n+          }\n+          if (overrides.getDisable().getActions() != null) {\n+            currentMutedActionSet.addAll(overrides.getDisable().getActions());\n+          }\n+        }\n+\n+        LOG.debug(\"New set of muted rcas: {}\", currentMutedRcaSet);\n+        LOG.debug(\"New set of muted deciders: {}\", currentMutedDeciderSet);\n+        LOG.debug(\"New set of muted actions: {}\", currentMutedActionSet);\n+        rcaConf.updateAllRcaConfFiles(currentMutedRcaSet, currentMutedDeciderSet, currentMutedActionSet);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzE4NTE2Mg=="}, "originalCommit": {"oid": "300dcc5a24bf2ce73182e64cf0fb332baa48e25d"}, "originalPosition": 100}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkxODIyNzExOnYy", "diffSide": "RIGHT", "path": "src/main/java/com/amazon/opendistro/elasticsearch/performanceanalyzer/AppContext.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wN1QxNzo1MzozNlrOG9iyjA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wN1QxODozMDowMFrOG9j19w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzE4NjMxNg==", "bodyText": "The RCAController thread updates this but it is read by the SchedulerTask threads. We should make this volatile", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/325#discussion_r467186316", "createdAt": "2020-08-07T17:53:36Z", "author": {"login": "yojs"}, "path": "src/main/java/com/amazon/opendistro/elasticsearch/performanceanalyzer/AppContext.java", "diffHunk": "@@ -39,10 +40,12 @@\n   // initiate a node config cache within each AppContext space\n   // to store node config settings from ES\n   private final NodeConfigCache nodeConfigCache;\n+  private Set<String> mutedActions;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "300dcc5a24bf2ce73182e64cf0fb332baa48e25d"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzIwMzU3NQ==", "bodyText": "Done.", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/325#discussion_r467203575", "createdAt": "2020-08-07T18:30:00Z", "author": {"login": "ktkrg"}, "path": "src/main/java/com/amazon/opendistro/elasticsearch/performanceanalyzer/AppContext.java", "diffHunk": "@@ -39,10 +40,12 @@\n   // initiate a node config cache within each AppContext space\n   // to store node config settings from ES\n   private final NodeConfigCache nodeConfigCache;\n+  private Set<String> mutedActions;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzE4NjMxNg=="}, "originalCommit": {"oid": "300dcc5a24bf2ce73182e64cf0fb332baa48e25d"}, "originalPosition": 12}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkxODQwMjE2OnYy", "diffSide": "RIGHT", "path": "src/main/java/com/amazon/opendistro/elasticsearch/performanceanalyzer/rca/framework/core/RcaConf.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wN1QxODo1NDowMlrOG9kfWg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wN1QxODo1NDowMlrOG9kfWg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzIxNDE3MA==", "bodyText": "You can use the new metric framework. There your metric can also tell you which file erred out ?", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/325#discussion_r467214170", "createdAt": "2020-08-07T18:54:02Z", "author": {"login": "yojs"}, "path": "src/main/java/com/amazon/opendistro/elasticsearch/performanceanalyzer/rca/framework/core/RcaConf.java", "diffHunk": "@@ -202,17 +203,24 @@ public CacheDeciderConfig getCacheDeciderConfig() {\n     return setting;\n   }\n \n-  public void updateAllRcaConfFiles(final Set<String> mutedRcas, final Set<String> mutedDeciders,\n+  public boolean updateAllRcaConfFiles(final Set<String> mutedRcas, final Set<String> mutedDeciders,\n       final Set<String> mutedActions) {\n+    boolean updateStatus = true;\n     // update all rca.conf files\n     List<String> rcaConfFiles = RcaControllerHelper.getAllConfFilePaths();\n-\n     for (String confFilePath : rcaConfFiles) {\n-      updateRcaConf(confFilePath, mutedRcas, mutedDeciders, mutedActions);\n+      updateStatus = updateRcaConf(confFilePath, mutedRcas, mutedDeciders,\n+        mutedActions);\n+      if (!updateStatus) {\n+        LOG.error(\"Failed to update the conf file at path: {}\", confFilePath);\n+        StatsCollector.instance().logMetric(RcaConsts.WRITE_UPDATED_RCA_CONF_ERROR);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "556b52773d461f6ca03a23f8c0af5c62c4dd2483"}, "originalPosition": 41}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2322, "cost": 1, "resetAt": "2021-11-12T20:44:06Z"}}}