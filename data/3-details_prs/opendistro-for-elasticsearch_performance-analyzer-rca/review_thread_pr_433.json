{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDkxMjEwODk4", "number": 433, "reviewThreads": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yM1QwMDowODowNVrOEmToJA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yM1QwMDo0ODowOFrOEmUEdQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA4NjAyOTE2OnYy", "diffSide": "RIGHT", "path": "src/main/java/com/amazon/opendistro/elasticsearch/performanceanalyzer/decisionmaker/deciders/Publisher.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yM1QwMDowODowNVrOHWQeyQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yM1QwMToyMjowOFrOHWRtPw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzEwMDc0NQ==", "bodyText": "It might be a good idea to add javadocs for all public methods.", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/433#discussion_r493100745", "createdAt": "2020-09-23T00:08:05Z", "author": {"login": "yojs"}, "path": "src/main/java/com/amazon/opendistro/elasticsearch/performanceanalyzer/decisionmaker/deciders/Publisher.java", "diffHunk": "@@ -55,7 +56,11 @@ public Publisher(int evalIntervalSeconds, Collator collator) {\n \n   @Override\n   public EmptyFlowUnit operate() {\n-    // TODO: Need to add dampening, avoidance, state persistence etc.\n+    return new EmptyFlowUnit(Instant.now().toEpochMilli());\n+  }\n+\n+  public void compute(FlowUnitOperationArgWrapper args) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f0e83e4e111edcbdcdd275ecc5cd6d63200c4273"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzEyMDgzMQ==", "bodyText": "Added javadoc", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/433#discussion_r493120831", "createdAt": "2020-09-23T01:22:08Z", "author": {"login": "sruti1312"}, "path": "src/main/java/com/amazon/opendistro/elasticsearch/performanceanalyzer/decisionmaker/deciders/Publisher.java", "diffHunk": "@@ -55,7 +56,11 @@ public Publisher(int evalIntervalSeconds, Collator collator) {\n \n   @Override\n   public EmptyFlowUnit operate() {\n-    // TODO: Need to add dampening, avoidance, state persistence etc.\n+    return new EmptyFlowUnit(Instant.now().toEpochMilli());\n+  }\n+\n+  public void compute(FlowUnitOperationArgWrapper args) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzEwMDc0NQ=="}, "originalCommit": {"oid": "f0e83e4e111edcbdcdd275ecc5cd6d63200c4273"}, "originalPosition": 16}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA4NjAzMDcwOnYy", "diffSide": "RIGHT", "path": "src/main/java/com/amazon/opendistro/elasticsearch/performanceanalyzer/decisionmaker/deciders/Publisher.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yM1QwMDowODo1OVrOHWQfsg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yM1QwMToxMTo1NFrOHWRgxA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzEwMDk3OA==", "bodyText": "Maybe we want to verify that the size is 1 ?", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/433#discussion_r493100978", "createdAt": "2020-09-23T00:08:59Z", "author": {"login": "yojs"}, "path": "src/main/java/com/amazon/opendistro/elasticsearch/performanceanalyzer/decisionmaker/deciders/Publisher.java", "diffHunk": "@@ -55,7 +56,11 @@ public Publisher(int evalIntervalSeconds, Collator collator) {\n \n   @Override\n   public EmptyFlowUnit operate() {\n-    // TODO: Need to add dampening, avoidance, state persistence etc.\n+    return new EmptyFlowUnit(Instant.now().toEpochMilli());\n+  }\n+\n+  public void compute(FlowUnitOperationArgWrapper args) {\n+    // TODO: Need to add dampening, avoidance etc.\n     Decision decision = collator.getFlowUnits().get(0);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f0e83e4e111edcbdcdd275ecc5cd6d63200c4273"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzExNzYzNg==", "bodyText": "Added a check.", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/433#discussion_r493117636", "createdAt": "2020-09-23T01:11:54Z", "author": {"login": "sruti1312"}, "path": "src/main/java/com/amazon/opendistro/elasticsearch/performanceanalyzer/decisionmaker/deciders/Publisher.java", "diffHunk": "@@ -55,7 +56,11 @@ public Publisher(int evalIntervalSeconds, Collator collator) {\n \n   @Override\n   public EmptyFlowUnit operate() {\n-    // TODO: Need to add dampening, avoidance, state persistence etc.\n+    return new EmptyFlowUnit(Instant.now().toEpochMilli());\n+  }\n+\n+  public void compute(FlowUnitOperationArgWrapper args) {\n+    // TODO: Need to add dampening, avoidance etc.\n     Decision decision = collator.getFlowUnits().get(0);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzEwMDk3OA=="}, "originalCommit": {"oid": "f0e83e4e111edcbdcdd275ecc5cd6d63200c4273"}, "originalPosition": 18}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA4NjAzNjg3OnYy", "diffSide": "RIGHT", "path": "src/main/java/com/amazon/opendistro/elasticsearch/performanceanalyzer/rca/framework/metrics/RcaRuntimeMetrics.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yM1QwMDoxMTo1OVrOHWQjTQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yM1QwMDoxMTo1OVrOHWQjTQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzEwMTkwMQ==", "bodyText": "Awesome ! Thanks for adding these metrics", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/433#discussion_r493101901", "createdAt": "2020-09-23T00:11:59Z", "author": {"login": "yojs"}, "path": "src/main/java/com/amazon/opendistro/elasticsearch/performanceanalyzer/rca/framework/metrics/RcaRuntimeMetrics.java", "diffHunk": "@@ -43,7 +43,12 @@\n    * Metric tracking if RCA is enabled or disabled. We write a 0 if RCA is disabled and 1 if it is\n    * enabled.\n    */\n-  RCA_ENABLED(\"RcaEnabled\", \"count\", Collections.singletonList(Statistics.SAMPLE));\n+  RCA_ENABLED(\"RcaEnabled\", \"count\", Collections.singletonList(Statistics.SAMPLE)),\n+\n+  /**\n+   * Metric tracking the actions published by the publisher that are persisted in sqlite.\n+   */\n+  ACTIONS_PUBLISHED(\"ActionsPublished\", \"namedCount\", Collections.singletonList(Statistics.NAMED_COUNTERS));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f0e83e4e111edcbdcdd275ecc5cd6d63200c4273"}, "originalPosition": 10}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA4NjA3MzU2OnYy", "diffSide": "RIGHT", "path": "src/main/java/com/amazon/opendistro/elasticsearch/performanceanalyzer/rca/persistence/PublisherEventsPersistor.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yM1QwMDozMTo1N1rOHWQ4Tg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yM1QwMTowOTo0MlrOHWRevw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzEwNzI3OA==", "bodyText": "Maybe this.name() is a redundant dimension for this metric as it does not change from action to action. Do we want to capture the name of the Action we wanted to persist ?", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/433#discussion_r493107278", "createdAt": "2020-09-23T00:31:57Z", "author": {"login": "yojs"}, "path": "src/main/java/com/amazon/opendistro/elasticsearch/performanceanalyzer/rca/persistence/PublisherEventsPersistor.java", "diffHunk": "@@ -0,0 +1,80 @@\n+/*\n+ * Copyright 2020 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ * permissions and limitations under the License.\n+ */\n+\n+package com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.persistence;\n+\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.PerformanceAnalyzerApp;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.decisionmaker.actions.Action;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.framework.metrics.ExceptionsAndErrors;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.framework.metrics.RcaRuntimeMetrics;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.persistence.actions.PersistedAction;\n+import java.time.Instant;\n+import java.util.stream.Collectors;\n+\n+import org.apache.logging.log4j.LogManager;\n+import org.apache.logging.log4j.Logger;\n+\n+/**\n+ * A listener that persists all actions published by the publisher to rca.sqlite\n+ */\n+public class PublisherEventsPersistor {\n+    public static final String NAME = \"publisher_events_persistor\";\n+    private static final Logger LOG = LogManager.getLogger(PublisherEventsPersistor.class);\n+\n+    private final Persistable persistable;\n+\n+    public PublisherEventsPersistor(final Persistable persistable) {\n+        this.persistable = persistable;\n+    }\n+\n+    public void persistAction(final Action action) {\n+        long timestamp = Instant.now().toEpochMilli();\n+        if (persistable != null) {\n+            LOG.debug(\"Action: [{}] published to persistor publisher.\", action.name());\n+            PerformanceAnalyzerApp.RCA_RUNTIME_METRICS_AGGREGATOR.updateStat(\n+                    RcaRuntimeMetrics.ACTIONS_PUBLISHED, action.name(), 1);\n+            if (action.impactedNodes() != null) {\n+                final String nodeIds = action.impactedNodes().stream()\n+                                        .map(n -> n.getNodeId().toString())\n+                                        .collect(Collectors.joining(\",\", \"{\", \"}\"));\n+                final String nodeIps = action.impactedNodes().stream()\n+                                         .map(n -> n.getHostAddress().toString())\n+                                         .collect(Collectors.joining(\",\", \"{\", \"}\"));\n+                final PersistedAction actionsSummary = new PersistedAction();\n+                actionsSummary.setActionName(action.name());\n+                actionsSummary.setNodeIds(nodeIds);\n+                actionsSummary.setNodeIps(nodeIps);\n+                actionsSummary.setActionable(action.isActionable());\n+                actionsSummary.setCoolOffPeriod(action.coolOffPeriodInMillis());\n+                actionsSummary.setMuted(action.isMuted());\n+                actionsSummary.setSummary(action.summary());\n+                actionsSummary.setTimestamp(timestamp);\n+                try {\n+                    persistable.write(actionsSummary);\n+                } catch (Exception e) {\n+                    LOG.error(\"Unable to write publisher events to sqlite\", e);\n+                    PerformanceAnalyzerApp.ERRORS_AND_EXCEPTIONS_AGGREGATOR.updateStat(\n+                            ExceptionsAndErrors.EXCEPTION_IN_PERSIST, this.name(), 1);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f0e83e4e111edcbdcdd275ecc5cd6d63200c4273"}, "originalPosition": 69}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzExNzExOQ==", "bodyText": "Right. Modified.", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/433#discussion_r493117119", "createdAt": "2020-09-23T01:09:42Z", "author": {"login": "sruti1312"}, "path": "src/main/java/com/amazon/opendistro/elasticsearch/performanceanalyzer/rca/persistence/PublisherEventsPersistor.java", "diffHunk": "@@ -0,0 +1,80 @@\n+/*\n+ * Copyright 2020 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ * permissions and limitations under the License.\n+ */\n+\n+package com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.persistence;\n+\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.PerformanceAnalyzerApp;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.decisionmaker.actions.Action;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.framework.metrics.ExceptionsAndErrors;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.framework.metrics.RcaRuntimeMetrics;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.persistence.actions.PersistedAction;\n+import java.time.Instant;\n+import java.util.stream.Collectors;\n+\n+import org.apache.logging.log4j.LogManager;\n+import org.apache.logging.log4j.Logger;\n+\n+/**\n+ * A listener that persists all actions published by the publisher to rca.sqlite\n+ */\n+public class PublisherEventsPersistor {\n+    public static final String NAME = \"publisher_events_persistor\";\n+    private static final Logger LOG = LogManager.getLogger(PublisherEventsPersistor.class);\n+\n+    private final Persistable persistable;\n+\n+    public PublisherEventsPersistor(final Persistable persistable) {\n+        this.persistable = persistable;\n+    }\n+\n+    public void persistAction(final Action action) {\n+        long timestamp = Instant.now().toEpochMilli();\n+        if (persistable != null) {\n+            LOG.debug(\"Action: [{}] published to persistor publisher.\", action.name());\n+            PerformanceAnalyzerApp.RCA_RUNTIME_METRICS_AGGREGATOR.updateStat(\n+                    RcaRuntimeMetrics.ACTIONS_PUBLISHED, action.name(), 1);\n+            if (action.impactedNodes() != null) {\n+                final String nodeIds = action.impactedNodes().stream()\n+                                        .map(n -> n.getNodeId().toString())\n+                                        .collect(Collectors.joining(\",\", \"{\", \"}\"));\n+                final String nodeIps = action.impactedNodes().stream()\n+                                         .map(n -> n.getHostAddress().toString())\n+                                         .collect(Collectors.joining(\",\", \"{\", \"}\"));\n+                final PersistedAction actionsSummary = new PersistedAction();\n+                actionsSummary.setActionName(action.name());\n+                actionsSummary.setNodeIds(nodeIds);\n+                actionsSummary.setNodeIps(nodeIps);\n+                actionsSummary.setActionable(action.isActionable());\n+                actionsSummary.setCoolOffPeriod(action.coolOffPeriodInMillis());\n+                actionsSummary.setMuted(action.isMuted());\n+                actionsSummary.setSummary(action.summary());\n+                actionsSummary.setTimestamp(timestamp);\n+                try {\n+                    persistable.write(actionsSummary);\n+                } catch (Exception e) {\n+                    LOG.error(\"Unable to write publisher events to sqlite\", e);\n+                    PerformanceAnalyzerApp.ERRORS_AND_EXCEPTIONS_AGGREGATOR.updateStat(\n+                            ExceptionsAndErrors.EXCEPTION_IN_PERSIST, this.name(), 1);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzEwNzI3OA=="}, "originalCommit": {"oid": "f0e83e4e111edcbdcdd275ecc5cd6d63200c4273"}, "originalPosition": 69}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA4NjA4NjQ5OnYy", "diffSide": "RIGHT", "path": "src/main/java/com/amazon/opendistro/elasticsearch/performanceanalyzer/rca/persistence/PublisherEventsPersistor.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yM1QwMDozOToxMlrOHWQ_og==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yM1QwMTowOToyMFrOHWRebA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzEwOTE1NA==", "bodyText": "Because persistable is assigned in the constructor and this is declared final, maybe we can do something like Objects.requireNonNull in the constructor and remove the if else here ?", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/433#discussion_r493109154", "createdAt": "2020-09-23T00:39:12Z", "author": {"login": "yojs"}, "path": "src/main/java/com/amazon/opendistro/elasticsearch/performanceanalyzer/rca/persistence/PublisherEventsPersistor.java", "diffHunk": "@@ -0,0 +1,80 @@\n+/*\n+ * Copyright 2020 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ * permissions and limitations under the License.\n+ */\n+\n+package com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.persistence;\n+\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.PerformanceAnalyzerApp;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.decisionmaker.actions.Action;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.framework.metrics.ExceptionsAndErrors;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.framework.metrics.RcaRuntimeMetrics;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.persistence.actions.PersistedAction;\n+import java.time.Instant;\n+import java.util.stream.Collectors;\n+\n+import org.apache.logging.log4j.LogManager;\n+import org.apache.logging.log4j.Logger;\n+\n+/**\n+ * A listener that persists all actions published by the publisher to rca.sqlite\n+ */\n+public class PublisherEventsPersistor {\n+    public static final String NAME = \"publisher_events_persistor\";\n+    private static final Logger LOG = LogManager.getLogger(PublisherEventsPersistor.class);\n+\n+    private final Persistable persistable;\n+\n+    public PublisherEventsPersistor(final Persistable persistable) {\n+        this.persistable = persistable;\n+    }\n+\n+    public void persistAction(final Action action) {\n+        long timestamp = Instant.now().toEpochMilli();\n+        if (persistable != null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f0e83e4e111edcbdcdd275ecc5cd6d63200c4273"}, "originalPosition": 44}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzExNzAzNg==", "bodyText": "Right. Modified.", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/433#discussion_r493117036", "createdAt": "2020-09-23T01:09:20Z", "author": {"login": "sruti1312"}, "path": "src/main/java/com/amazon/opendistro/elasticsearch/performanceanalyzer/rca/persistence/PublisherEventsPersistor.java", "diffHunk": "@@ -0,0 +1,80 @@\n+/*\n+ * Copyright 2020 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ * permissions and limitations under the License.\n+ */\n+\n+package com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.persistence;\n+\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.PerformanceAnalyzerApp;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.decisionmaker.actions.Action;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.framework.metrics.ExceptionsAndErrors;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.framework.metrics.RcaRuntimeMetrics;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.persistence.actions.PersistedAction;\n+import java.time.Instant;\n+import java.util.stream.Collectors;\n+\n+import org.apache.logging.log4j.LogManager;\n+import org.apache.logging.log4j.Logger;\n+\n+/**\n+ * A listener that persists all actions published by the publisher to rca.sqlite\n+ */\n+public class PublisherEventsPersistor {\n+    public static final String NAME = \"publisher_events_persistor\";\n+    private static final Logger LOG = LogManager.getLogger(PublisherEventsPersistor.class);\n+\n+    private final Persistable persistable;\n+\n+    public PublisherEventsPersistor(final Persistable persistable) {\n+        this.persistable = persistable;\n+    }\n+\n+    public void persistAction(final Action action) {\n+        long timestamp = Instant.now().toEpochMilli();\n+        if (persistable != null) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzEwOTE1NA=="}, "originalCommit": {"oid": "f0e83e4e111edcbdcdd275ecc5cd6d63200c4273"}, "originalPosition": 44}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA4NjEwMTY1OnYy", "diffSide": "RIGHT", "path": "src/main/java/com/amazon/opendistro/elasticsearch/performanceanalyzer/rca/persistence/actions/PersistedAction.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yM1QwMDo0ODowOFrOHWRInQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yM1QwMTowNTo0MlrOHWRa4Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzExMTQ1Mw==", "bodyText": "nit: should we make this a nested static class in PublisherEventsPersistor ?", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/433#discussion_r493111453", "createdAt": "2020-09-23T00:48:08Z", "author": {"login": "vigyasharma"}, "path": "src/main/java/com/amazon/opendistro/elasticsearch/performanceanalyzer/rca/persistence/actions/PersistedAction.java", "diffHunk": "@@ -0,0 +1,94 @@\n+package com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.persistence.actions;\n+\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.persistence.ValueColumn;\n+\n+import org.apache.logging.log4j.LogManager;\n+import org.apache.logging.log4j.Logger;\n+\n+/**\n+ * Action summary that can be persisted in SQL\n+ *\n+ * <p>Table name : PersistedAction\n+ *\n+ * <p>schema :\n+ * | id(primary key) |     actionName       |   timestamp       |       nodeIds          |\n+ * |      1          | ModifyQueueCapacity  |  1599257910923    |   node1, node2         |\n+ * |        nodeIps         | actionable | coolOffPeriod    |  muted    |   summary         |\n+ * | 127.0.0.1, 127.0.0.2   |  1         |  300             |   0       | actionSummary     |\n+ */\n+public class PersistedAction {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f0e83e4e111edcbdcdd275ecc5cd6d63200c4273"}, "originalPosition": 19}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzExNjEyOQ==", "bodyText": "During read(), the persistable (object used to persist things in sqlite) needs this class as it returns s Class type object.\nIt is better to have this to support write and read.", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/433#discussion_r493116129", "createdAt": "2020-09-23T01:05:42Z", "author": {"login": "sruti1312"}, "path": "src/main/java/com/amazon/opendistro/elasticsearch/performanceanalyzer/rca/persistence/actions/PersistedAction.java", "diffHunk": "@@ -0,0 +1,94 @@\n+package com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.persistence.actions;\n+\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.rca.persistence.ValueColumn;\n+\n+import org.apache.logging.log4j.LogManager;\n+import org.apache.logging.log4j.Logger;\n+\n+/**\n+ * Action summary that can be persisted in SQL\n+ *\n+ * <p>Table name : PersistedAction\n+ *\n+ * <p>schema :\n+ * | id(primary key) |     actionName       |   timestamp       |       nodeIds          |\n+ * |      1          | ModifyQueueCapacity  |  1599257910923    |   node1, node2         |\n+ * |        nodeIps         | actionable | coolOffPeriod    |  muted    |   summary         |\n+ * | 127.0.0.1, 127.0.0.2   |  1         |  300             |   0       | actionSummary     |\n+ */\n+public class PersistedAction {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzExMTQ1Mw=="}, "originalCommit": {"oid": "f0e83e4e111edcbdcdd275ecc5cd6d63200c4273"}, "originalPosition": 19}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2393, "cost": 1, "resetAt": "2021-11-12T20:44:06Z"}}}