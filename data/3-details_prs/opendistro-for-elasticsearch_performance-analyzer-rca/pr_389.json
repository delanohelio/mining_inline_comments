{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDcwNTY2ODI3", "number": 389, "title": "Use absolute path for configFilePath", "bodyText": "Description of changes:\nUse absolute path for configFilePath instead of relativePath.\nIn case file does not exist, pa does not startup.\nTests:\nSpun a docker and tested.\nBy submitting this pull request, I confirm that my contribution is made under the terms of the Apache 2.0 license.", "createdAt": "2020-08-20T02:25:02Z", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/389", "merged": true, "mergeCommit": {"oid": "3dbb8e7e8ac74767fee152df4e6f8beb32923151"}, "closed": true, "closedAt": "2020-08-21T21:27:37Z", "author": {"login": "sruti1312"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdAlLJhAH2gAyNDcwNTY2ODI3OjE0MjVjYjM2ODBmNDg3NzEzZmUzYTAyYzNhYTAzYTljYzFiN2U4NzM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdBLaZigFqTQ3MjgyMDc2NA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "1425cb3680f487713fe3a02c3aa03a9cc1b7e873", "author": {"user": {"login": "sruti1312", "name": "Sruti Parthiban"}}, "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/commit/1425cb3680f487713fe3a02c3aa03a9cc1b7e873", "committedDate": "2020-08-20T00:35:54Z", "message": "Use absolute path for configFilePath"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6f20fd778a53626f6436eebf801a50641f67f2af", "author": {"user": {"login": "sruti1312", "name": "Sruti Parthiban"}}, "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/commit/6f20fd778a53626f6436eebf801a50641f67f2af", "committedDate": "2020-08-20T02:21:26Z", "message": "Disable pa with invalid config"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDcxMjg2NDcy", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/389#pullrequestreview-471286472", "createdAt": "2020-08-20T06:39:55Z", "commit": {"oid": "6f20fd778a53626f6436eebf801a50641f67f2af"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMFQwNjozOTo1NVrOHDtjeg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMFQwNjozOTo1NVrOHDtjeg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzY1NDEzOA==", "bodyText": "Does the process also exit with error at this point or is it just stalled? We should exit with error.", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/389#discussion_r473654138", "createdAt": "2020-08-20T06:39:55Z", "author": {"login": "vigyasharma"}, "path": "src/main/java/com/amazon/opendistro/elasticsearch/performanceanalyzer/PerformanceAnalyzerApp.java", "diffHunk": "@@ -107,21 +107,26 @@ public static void main(String[] args) {\n         (MetricsConfiguration.CONFIG_MAP.get(StatsCollector.class).samplingInterval) / 2,\n         TimeUnit.MILLISECONDS);\n     PluginSettings settings = PluginSettings.instance();\n-    StatsCollector.STATS_TYPE = \"agent-stats-metadata\";\n-    METRIC_COLLECTOR_EXECUTOR.addScheduledMetricCollector(StatsCollector.instance());\n-    StatsCollector.instance().addDefaultExceptionCode(StatExceptionCode.READER_RESTART_PROCESSING);\n-    METRIC_COLLECTOR_EXECUTOR.setEnabled(true);\n-    METRIC_COLLECTOR_EXECUTOR.start();\n-\n-    final GRPCConnectionManager connectionManager = new GRPCConnectionManager(\n-        settings.getHttpsEnabled());\n-    final ClientServers clientServers = createClientServers(connectionManager, appContext);\n-    startErrorHandlingThread(THREAD_PROVIDER, exceptionQueue);\n-\n-    startReaderThread(appContext, THREAD_PROVIDER);\n-    startGrpcServerThread(clientServers.getNetServer(), THREAD_PROVIDER);\n-    startWebServerThread(clientServers.getHttpServer(), THREAD_PROVIDER);\n-    startRcaTopLevelThread(clientServers, connectionManager, appContext, THREAD_PROVIDER);\n+    if (ConfigStatus.INSTANCE.haveValidConfig()) {\n+      StatsCollector.STATS_TYPE = \"agent-stats-metadata\";\n+      METRIC_COLLECTOR_EXECUTOR.addScheduledMetricCollector(StatsCollector.instance());\n+      StatsCollector.instance()\n+          .addDefaultExceptionCode(StatExceptionCode.READER_RESTART_PROCESSING);\n+      METRIC_COLLECTOR_EXECUTOR.setEnabled(true);\n+      METRIC_COLLECTOR_EXECUTOR.start();\n+\n+      final GRPCConnectionManager connectionManager =\n+          new GRPCConnectionManager(settings.getHttpsEnabled());\n+      final ClientServers clientServers = createClientServers(connectionManager, appContext);\n+      startErrorHandlingThread(THREAD_PROVIDER, exceptionQueue);\n+\n+      startReaderThread(appContext, THREAD_PROVIDER);\n+      startGrpcServerThread(clientServers.getNetServer(), THREAD_PROVIDER);\n+      startWebServerThread(clientServers.getHttpServer(), THREAD_PROVIDER);\n+      startRcaTopLevelThread(clientServers, connectionManager, appContext, THREAD_PROVIDER);\n+    } else {\n+      LOG.error(\"Performance analyzer app stopped due to invalid config status.\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6f20fd778a53626f6436eebf801a50641f67f2af"}, "originalPosition": 37}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDcxMjg2NjQy", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/389#pullrequestreview-471286642", "createdAt": "2020-08-20T06:40:13Z", "commit": {"oid": "6f20fd778a53626f6436eebf801a50641f67f2af"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDcxODIzNzE5", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/389#pullrequestreview-471823719", "createdAt": "2020-08-20T17:13:28Z", "commit": {"oid": "6f20fd778a53626f6436eebf801a50641f67f2af"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMFQxNzoxMzoyOFrOHELnDg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMFQxNzoxMzoyOFrOHELnDg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDE0NjU3NA==", "bodyText": "Move lines 105-108 into it if (ConfigStatus...) block so that we don't start any threads if we don't have a valid config. Can you also return -1 or some error code in that case and verify that the program exits when the config is invalid?\nYou should be able to do this with a simple test that executes PerformanceAnalyzerApp.main(...) and checks that the return code is the error code.", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/389#discussion_r474146574", "createdAt": "2020-08-20T17:13:28Z", "author": {"login": "sidheart"}, "path": "src/main/java/com/amazon/opendistro/elasticsearch/performanceanalyzer/PerformanceAnalyzerApp.java", "diffHunk": "@@ -107,21 +107,26 @@ public static void main(String[] args) {\n         (MetricsConfiguration.CONFIG_MAP.get(StatsCollector.class).samplingInterval) / 2,\n         TimeUnit.MILLISECONDS);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6f20fd778a53626f6436eebf801a50641f67f2af"}, "originalPosition": 2}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "46ed2ee68bb070c90910bf5ff44df804c41adc2a", "author": {"user": {"login": "sruti1312", "name": "Sruti Parthiban"}}, "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/commit/46ed2ee68bb070c90910bf5ff44df804c41adc2a", "committedDate": "2020-08-21T20:59:33Z", "message": "Address PR comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "234c7b58f8e065573c8966c78337b0cea494491c", "author": {"user": {"login": "sruti1312", "name": "Sruti Parthiban"}}, "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/commit/234c7b58f8e065573c8966c78337b0cea494491c", "committedDate": "2020-08-21T21:04:38Z", "message": "Log to StatsCollector"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDcyODIwNzY0", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/389#pullrequestreview-472820764", "createdAt": "2020-08-21T21:08:57Z", "commit": {"oid": "234c7b58f8e065573c8966c78337b0cea494491c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 890, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}