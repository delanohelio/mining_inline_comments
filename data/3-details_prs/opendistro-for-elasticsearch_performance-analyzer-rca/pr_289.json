{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDUwOTI4MTQ2", "number": 289, "title": "Reading Decider Action Priorities from YML", "bodyText": "Issue #: #288\nDescription of changes: Provide a list of action priorities for each decider. Read from yml and consume it in each decider\nTests: Manual testing in progress.\nBy submitting this pull request, I confirm that my contribution is made under the terms of the Apache 2.0 license.", "createdAt": "2020-07-17T08:50:14Z", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/289", "merged": true, "mergeCommit": {"oid": "b3783f945092e9239883c757dfc2b44db7fb309d"}, "closed": true, "closedAt": "2020-07-24T21:54:44Z", "author": {"login": "aditjind"}, "timelineItems": {"totalCount": 18, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc1vuyvgH2gAyNDUwOTI4MTQ2OjRmYmE4OGZlMDExNGU4MDFmNzU0NjVlNzMxOTRmYTZlNzk2ZWE5OGU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc4KSA1AFqTQ1NTE3NTAwNg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "4fba88fe0114e801f75465e73194fa6e796ea98e", "author": {"user": {"login": "aditjind", "name": "Aditya Jindal"}}, "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/commit/4fba88fe0114e801f75465e73194fa6e796ea98e", "committedDate": "2020-07-17T08:40:43Z", "message": "Reading Decider Action Priorities from YML"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "273d788740505025fb350c3649b8dab8f9a00027", "author": {"user": {"login": "aditjind", "name": "Aditya Jindal"}}, "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/commit/273d788740505025fb350c3649b8dab8f9a00027", "committedDate": "2020-07-17T22:50:00Z", "message": "Fixing Checkstyle Errors"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUxMDI1Nzcz", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/289#pullrequestreview-451025773", "createdAt": "2020-07-18T02:58:06Z", "commit": {"oid": "273d788740505025fb350c3649b8dab8f9a00027"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xOFQwMjo1ODowNlrOGzlNtw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xOFQwMzowODo0M1rOGzlQ2Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Njc0MDI3OQ==", "bodyText": "Let's move yml file name to a constant that can be changed for tests", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/289#discussion_r456740279", "createdAt": "2020-07-18T02:58:06Z", "author": {"login": "vigyasharma"}, "path": "src/main/java/com/amazon/opendistro/elasticsearch/performanceanalyzer/decisionmaker/ConfigReader.java", "diffHunk": "@@ -0,0 +1,22 @@\n+package com.amazon.opendistro.elasticsearch.performanceanalyzer.decisionmaker;\n+\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.decisionmaker.deciders.Decider;\n+import com.fasterxml.jackson.databind.ObjectMapper;\n+import com.fasterxml.jackson.dataformat.yaml.YAMLFactory;\n+import java.io.File;\n+import java.util.ArrayList;\n+import java.util.HashMap;\n+\n+public class ConfigReader {\n+    public static HashMap<Decider, ArrayList<String>> getDeciderActionPriorityOrder() {\n+        ObjectMapper mapper = new ObjectMapper(new YAMLFactory());\n+        HashMap<Decider, ArrayList<String>> deciderActionPriorityOrder = null;\n+        try {\n+            deciderActionPriorityOrder = mapper.readValue(new File(\"deciderConfig.yml\"), HashMap.class);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "273d788740505025fb350c3649b8dab8f9a00027"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Njc0MDUwNA==", "bodyText": "We want to use decider and action names (NAME field, also returned by name()) instead of class names. This lets us refer to these names directly at different places in the code.", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/289#discussion_r456740504", "createdAt": "2020-07-18T03:00:49Z", "author": {"login": "vigyasharma"}, "path": "src/main/java/com/amazon/opendistro/elasticsearch/performanceanalyzer/decisionmaker/deciderConfig.yml", "diffHunk": "@@ -0,0 +1,12 @@\n+# Order of action priorities\n+# Loaded to a map of Decider and action priorities\n+# action priorities are given as a list\n+# priority order is decreasing in nature.\n+---\n+deciderActionPriorityOrder:\n+  QueueHealthDecider:\n+    - ModifyQueueCapacityAction", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "273d788740505025fb350c3649b8dab8f9a00027"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Njc0MDU3Ng==", "bodyText": "Looks like the yml is read and created each time someone fetches action priority. How about parsing and storing it ones, during load/init?", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/289#discussion_r456740576", "createdAt": "2020-07-18T03:01:52Z", "author": {"login": "vigyasharma"}, "path": "src/main/java/com/amazon/opendistro/elasticsearch/performanceanalyzer/decisionmaker/ConfigReader.java", "diffHunk": "@@ -0,0 +1,22 @@\n+package com.amazon.opendistro.elasticsearch.performanceanalyzer.decisionmaker;\n+\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.decisionmaker.deciders.Decider;\n+import com.fasterxml.jackson.databind.ObjectMapper;\n+import com.fasterxml.jackson.dataformat.yaml.YAMLFactory;\n+import java.io.File;\n+import java.util.ArrayList;\n+import java.util.HashMap;\n+\n+public class ConfigReader {\n+    public static HashMap<Decider, ArrayList<String>> getDeciderActionPriorityOrder() {\n+        ObjectMapper mapper = new ObjectMapper(new YAMLFactory());\n+        HashMap<Decider, ArrayList<String>> deciderActionPriorityOrder = null;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "273d788740505025fb350c3649b8dab8f9a00027"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Njc0MDY3OQ==", "bodyText": "Use NAME instead of this.getClass().getName()", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/289#discussion_r456740679", "createdAt": "2020-07-18T03:03:30Z", "author": {"login": "vigyasharma"}, "path": "src/main/java/com/amazon/opendistro/elasticsearch/performanceanalyzer/decisionmaker/deciders/QueueHealthDecider.java", "diffHunk": "@@ -81,8 +81,8 @@ public Decision operate() {\n   }\n \n   private void configureActionPriority() {\n-    // TODO: Input from user configured yml\n-    this.actionsByUserPriority.add(ModifyQueueCapacityAction.NAME);\n+    ArrayList<String> actionPriority = getDeciderActionPriorityOrder(this.getClass().getName());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "273d788740505025fb350c3649b8dab8f9a00027"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Njc0MDcyNQ==", "bodyText": "If ConfigReader can store the priority hashmap in memory, then each decider doesn't need to store it. Config reader can expose the getter methods", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/289#discussion_r456740725", "createdAt": "2020-07-18T03:04:18Z", "author": {"login": "vigyasharma"}, "path": "src/main/java/com/amazon/opendistro/elasticsearch/performanceanalyzer/decisionmaker/deciders/Decider.java", "diffHunk": "@@ -41,10 +45,12 @@\n \n   private static final Logger LOG = LogManager.getLogger(Decider.class);\n   protected final int decisionFrequency; // Measured in terms of number of evaluationIntervalPeriods\n+  private final HashMap<Decider, ArrayList<String>> deciderActionPriorityOrder;\n \n   public Decider(long evalIntervalSeconds, int decisionFrequency) {\n     super(0, evalIntervalSeconds);\n     this.decisionFrequency = decisionFrequency;\n+    this.deciderActionPriorityOrder = ConfigReader.getDeciderActionPriorityOrder();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "273d788740505025fb350c3649b8dab8f9a00027"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Njc0MDczNw==", "bodyText": "nit: rename to something specific to action priorities?", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/289#discussion_r456740737", "createdAt": "2020-07-18T03:04:47Z", "author": {"login": "vigyasharma"}, "path": "src/main/java/com/amazon/opendistro/elasticsearch/performanceanalyzer/decisionmaker/ConfigReader.java", "diffHunk": "@@ -0,0 +1,22 @@\n+package com.amazon.opendistro.elasticsearch.performanceanalyzer.decisionmaker;\n+\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.decisionmaker.deciders.Decider;\n+import com.fasterxml.jackson.databind.ObjectMapper;\n+import com.fasterxml.jackson.dataformat.yaml.YAMLFactory;\n+import java.io.File;\n+import java.util.ArrayList;\n+import java.util.HashMap;\n+\n+public class ConfigReader {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "273d788740505025fb350c3649b8dab8f9a00027"}, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Njc0MTA4MQ==", "bodyText": "Where will this yml be present on a deployed cluster? It cant be within the jar, users need to be able to replace it without building jars. Is that possible with current implementation? I think we should also have a path configuration which can be passed as jvm args in case users need to change its default location.", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/289#discussion_r456741081", "createdAt": "2020-07-18T03:08:43Z", "author": {"login": "vigyasharma"}, "path": "src/main/java/com/amazon/opendistro/elasticsearch/performanceanalyzer/decisionmaker/deciderConfig.yml", "diffHunk": "@@ -0,0 +1,12 @@\n+# Order of action priorities", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "273d788740505025fb350c3649b8dab8f9a00027"}, "originalPosition": 1}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUxNzY5MjE3", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/289#pullrequestreview-451769217", "createdAt": "2020-07-20T16:29:02Z", "commit": {"oid": "273d788740505025fb350c3649b8dab8f9a00027"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQxNjoyOTowMlrOG0WBVg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQxNjoyOTowMlrOG0WBVg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzUzOTkyNg==", "bodyText": "Is there any specific reason to from from YML instead of JSON ? All RCA related configs are stored in JSON file and why do we want to switch to a different format in decision maker ?", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/289#discussion_r457539926", "createdAt": "2020-07-20T16:29:02Z", "author": {"login": "rguo-aws"}, "path": "src/main/java/com/amazon/opendistro/elasticsearch/performanceanalyzer/decisionmaker/ConfigReader.java", "diffHunk": "@@ -0,0 +1,22 @@\n+package com.amazon.opendistro.elasticsearch.performanceanalyzer.decisionmaker;\n+\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.decisionmaker.deciders.Decider;\n+import com.fasterxml.jackson.databind.ObjectMapper;\n+import com.fasterxml.jackson.dataformat.yaml.YAMLFactory;\n+import java.io.File;\n+import java.util.ArrayList;\n+import java.util.HashMap;\n+\n+public class ConfigReader {\n+    public static HashMap<Decider, ArrayList<String>> getDeciderActionPriorityOrder() {\n+        ObjectMapper mapper = new ObjectMapper(new YAMLFactory());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "273d788740505025fb350c3649b8dab8f9a00027"}, "originalPosition": 12}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUxNzY5NzA1", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/289#pullrequestreview-451769705", "createdAt": "2020-07-20T16:29:37Z", "commit": {"oid": "273d788740505025fb350c3649b8dab8f9a00027"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQxNjoyOTozN1rOG0WC2Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQxNjoyOTozN1rOG0WC2Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzU0MDMxMw==", "bodyText": "Add an error  log here ?", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/289#discussion_r457540313", "createdAt": "2020-07-20T16:29:37Z", "author": {"login": "rguo-aws"}, "path": "src/main/java/com/amazon/opendistro/elasticsearch/performanceanalyzer/decisionmaker/ConfigReader.java", "diffHunk": "@@ -0,0 +1,22 @@\n+package com.amazon.opendistro.elasticsearch.performanceanalyzer.decisionmaker;\n+\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.decisionmaker.deciders.Decider;\n+import com.fasterxml.jackson.databind.ObjectMapper;\n+import com.fasterxml.jackson.dataformat.yaml.YAMLFactory;\n+import java.io.File;\n+import java.util.ArrayList;\n+import java.util.HashMap;\n+\n+public class ConfigReader {\n+    public static HashMap<Decider, ArrayList<String>> getDeciderActionPriorityOrder() {\n+        ObjectMapper mapper = new ObjectMapper(new YAMLFactory());\n+        HashMap<Decider, ArrayList<String>> deciderActionPriorityOrder = null;\n+        try {\n+            deciderActionPriorityOrder = mapper.readValue(new File(\"deciderConfig.yml\"), HashMap.class);\n+            return deciderActionPriorityOrder;\n+        } catch (Exception e) {\n+            e.printStackTrace();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "273d788740505025fb350c3649b8dab8f9a00027"}, "originalPosition": 18}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUxNzcwMzg5", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/289#pullrequestreview-451770389", "createdAt": "2020-07-20T16:30:28Z", "commit": {"oid": "273d788740505025fb350c3649b8dab8f9a00027"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQxNjozMDoyOVrOG0WFDQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQxNjozMDoyOVrOG0WFDQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzU0MDg3Nw==", "bodyText": "this return statement seems to be redundant", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/289#discussion_r457540877", "createdAt": "2020-07-20T16:30:29Z", "author": {"login": "rguo-aws"}, "path": "src/main/java/com/amazon/opendistro/elasticsearch/performanceanalyzer/decisionmaker/ConfigReader.java", "diffHunk": "@@ -0,0 +1,22 @@\n+package com.amazon.opendistro.elasticsearch.performanceanalyzer.decisionmaker;\n+\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.decisionmaker.deciders.Decider;\n+import com.fasterxml.jackson.databind.ObjectMapper;\n+import com.fasterxml.jackson.dataformat.yaml.YAMLFactory;\n+import java.io.File;\n+import java.util.ArrayList;\n+import java.util.HashMap;\n+\n+public class ConfigReader {\n+    public static HashMap<Decider, ArrayList<String>> getDeciderActionPriorityOrder() {\n+        ObjectMapper mapper = new ObjectMapper(new YAMLFactory());\n+        HashMap<Decider, ArrayList<String>> deciderActionPriorityOrder = null;\n+        try {\n+            deciderActionPriorityOrder = mapper.readValue(new File(\"deciderConfig.yml\"), HashMap.class);\n+            return deciderActionPriorityOrder;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "273d788740505025fb350c3649b8dab8f9a00027"}, "originalPosition": 16}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUxNzcwODY0", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/289#pullrequestreview-451770864", "createdAt": "2020-07-20T16:31:05Z", "commit": {"oid": "273d788740505025fb350c3649b8dab8f9a00027"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQxNjozMTowNVrOG0WGog==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQxNjozMTowNVrOG0WGog==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzU0MTI4Mg==", "bodyText": "Can we add Nullable annotation to this function ?", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/289#discussion_r457541282", "createdAt": "2020-07-20T16:31:05Z", "author": {"login": "rguo-aws"}, "path": "src/main/java/com/amazon/opendistro/elasticsearch/performanceanalyzer/decisionmaker/ConfigReader.java", "diffHunk": "@@ -0,0 +1,22 @@\n+package com.amazon.opendistro.elasticsearch.performanceanalyzer.decisionmaker;\n+\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.decisionmaker.deciders.Decider;\n+import com.fasterxml.jackson.databind.ObjectMapper;\n+import com.fasterxml.jackson.dataformat.yaml.YAMLFactory;\n+import java.io.File;\n+import java.util.ArrayList;\n+import java.util.HashMap;\n+\n+public class ConfigReader {\n+    public static HashMap<Decider, ArrayList<String>> getDeciderActionPriorityOrder() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "273d788740505025fb350c3649b8dab8f9a00027"}, "originalPosition": 11}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fac8c085e230483f62dc7ffc7023f47fc3eea4a9", "author": {"user": {"login": "aditjind", "name": "Aditya Jindal"}}, "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/commit/fac8c085e230483f62dc7ffc7023f47fc3eea4a9", "committedDate": "2020-07-20T21:45:42Z", "message": "Addressing PR Comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7cbfc2a152542087d87e0344f989b84561f9d26b", "author": {"user": {"login": "aditjind", "name": "Aditya Jindal"}}, "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/commit/7cbfc2a152542087d87e0344f989b84561f9d26b", "committedDate": "2020-07-20T21:50:24Z", "message": "Addressing PR Comments"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUyMDM1OTk1", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/289#pullrequestreview-452035995", "createdAt": "2020-07-20T23:57:10Z", "commit": {"oid": "7cbfc2a152542087d87e0344f989b84561f9d26b"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQyMzo1NzoxMFrOG0jPcA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQwMDoxMToxMVrOG0jfkw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Nzc1NjUyOA==", "bodyText": "nit: add newline at end of file", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/289#discussion_r457756528", "createdAt": "2020-07-20T23:57:10Z", "author": {"login": "vigyasharma"}, "path": "pa_config/deciderConfig.yml", "diffHunk": "@@ -0,0 +1,9 @@\n+# Order of action priorities\n+# Loaded to a map of Decider and action priorities\n+# action priorities are given as a list\n+# priority order is decreasing in nature.\n+---\n+queue_health:\n+  - modify_queue_capacity\n+cache_health:\n+  - modify_cache_capacity", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7cbfc2a152542087d87e0344f989b84561f9d26b"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Nzc1NzYyMQ==", "bodyText": "Is this is the right way to provide file path for configuration files? What is the current directory here for ./...?\nPlease see how path has been specified for rca.conf in RcaConsts.java and change accordingly.", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/289#discussion_r457757621", "createdAt": "2020-07-21T00:00:51Z", "author": {"login": "vigyasharma"}, "path": "src/main/java/com/amazon/opendistro/elasticsearch/performanceanalyzer/decisionmaker/ConfigReader.java", "diffHunk": "@@ -0,0 +1,36 @@\n+package com.amazon.opendistro.elasticsearch.performanceanalyzer.decisionmaker;\n+\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.decisionmaker.deciders.Decider;\n+import com.fasterxml.jackson.databind.ObjectMapper;\n+import com.fasterxml.jackson.dataformat.yaml.YAMLFactory;\n+import java.io.File;\n+import java.util.ArrayList;\n+import java.util.HashMap;\n+import org.apache.logging.log4j.LogManager;\n+import org.apache.logging.log4j.Logger;\n+\n+public class ConfigReader {\n+    private static final Logger LOG = LogManager.getLogger(ConfigReader.class);\n+    private static HashMap<Decider, ArrayList<String>> deciderActionPriorityOrder;\n+\n+    public static final String CONFIG_FILE_PATH = \"./pa_config/deciderConfig.yml\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7cbfc2a152542087d87e0344f989b84561f9d26b"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Nzc1NzgwNw==", "bodyText": "The constructor can take path as input to support test cases with different config files.", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/289#discussion_r457757807", "createdAt": "2020-07-21T00:01:25Z", "author": {"login": "vigyasharma"}, "path": "src/main/java/com/amazon/opendistro/elasticsearch/performanceanalyzer/decisionmaker/ConfigReader.java", "diffHunk": "@@ -0,0 +1,36 @@\n+package com.amazon.opendistro.elasticsearch.performanceanalyzer.decisionmaker;\n+\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.decisionmaker.deciders.Decider;\n+import com.fasterxml.jackson.databind.ObjectMapper;\n+import com.fasterxml.jackson.dataformat.yaml.YAMLFactory;\n+import java.io.File;\n+import java.util.ArrayList;\n+import java.util.HashMap;\n+import org.apache.logging.log4j.LogManager;\n+import org.apache.logging.log4j.Logger;\n+\n+public class ConfigReader {\n+    private static final Logger LOG = LogManager.getLogger(ConfigReader.class);\n+    private static HashMap<Decider, ArrayList<String>> deciderActionPriorityOrder;\n+\n+    public static final String CONFIG_FILE_PATH = \"./pa_config/deciderConfig.yml\";\n+\n+    public ConfigReader() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7cbfc2a152542087d87e0344f989b84561f9d26b"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Nzc1OTcwNg==", "bodyText": "I think we should limit this one to only action priorities, to keep it simple to read. Configuration values could go into rca.conf along with other config values. But you can take a call on that if you think there are other decider level configs that should belong here.\nAlso, if you want to make it generic you (at least) need another level of hierarchy in the yml, right?", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/289#discussion_r457759706", "createdAt": "2020-07-21T00:08:00Z", "author": {"login": "vigyasharma"}, "path": "src/main/java/com/amazon/opendistro/elasticsearch/performanceanalyzer/decisionmaker/ConfigReader.java", "diffHunk": "@@ -0,0 +1,22 @@\n+package com.amazon.opendistro.elasticsearch.performanceanalyzer.decisionmaker;\n+\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.decisionmaker.deciders.Decider;\n+import com.fasterxml.jackson.databind.ObjectMapper;\n+import com.fasterxml.jackson.dataformat.yaml.YAMLFactory;\n+import java.io.File;\n+import java.util.ArrayList;\n+import java.util.HashMap;\n+\n+public class ConfigReader {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Njc0MDczNw=="}, "originalCommit": {"oid": "273d788740505025fb350c3649b8dab8f9a00027"}, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Nzc2MDE1NA==", "bodyText": "This will also not work with the generic decider config file you mentioned. Let us just restrict it to an action_priorities file only", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/289#discussion_r457760154", "createdAt": "2020-07-21T00:09:28Z", "author": {"login": "vigyasharma"}, "path": "src/main/java/com/amazon/opendistro/elasticsearch/performanceanalyzer/decisionmaker/ConfigReader.java", "diffHunk": "@@ -0,0 +1,36 @@\n+package com.amazon.opendistro.elasticsearch.performanceanalyzer.decisionmaker;\n+\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.decisionmaker.deciders.Decider;\n+import com.fasterxml.jackson.databind.ObjectMapper;\n+import com.fasterxml.jackson.dataformat.yaml.YAMLFactory;\n+import java.io.File;\n+import java.util.ArrayList;\n+import java.util.HashMap;\n+import org.apache.logging.log4j.LogManager;\n+import org.apache.logging.log4j.Logger;\n+\n+public class ConfigReader {\n+    private static final Logger LOG = LogManager.getLogger(ConfigReader.class);\n+    private static HashMap<Decider, ArrayList<String>> deciderActionPriorityOrder;\n+\n+    public static final String CONFIG_FILE_PATH = \"./pa_config/deciderConfig.yml\";\n+\n+    public ConfigReader() {\n+        this.deciderActionPriorityOrder = null;\n+    }\n+\n+    public static void updateDeciderActionPriorityOrder() {\n+        ObjectMapper mapper = new ObjectMapper(new YAMLFactory());\n+        try {\n+            deciderActionPriorityOrder = mapper.readValue(new File(CONFIG_FILE_PATH), HashMap.class);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7cbfc2a152542087d87e0344f989b84561f9d26b"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Nzc2MDY1OQ==", "bodyText": "Handle NPE here?", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/289#discussion_r457760659", "createdAt": "2020-07-21T00:11:11Z", "author": {"login": "vigyasharma"}, "path": "src/main/java/com/amazon/opendistro/elasticsearch/performanceanalyzer/decisionmaker/ConfigReader.java", "diffHunk": "@@ -0,0 +1,36 @@\n+package com.amazon.opendistro.elasticsearch.performanceanalyzer.decisionmaker;\n+\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.decisionmaker.deciders.Decider;\n+import com.fasterxml.jackson.databind.ObjectMapper;\n+import com.fasterxml.jackson.dataformat.yaml.YAMLFactory;\n+import java.io.File;\n+import java.util.ArrayList;\n+import java.util.HashMap;\n+import org.apache.logging.log4j.LogManager;\n+import org.apache.logging.log4j.Logger;\n+\n+public class ConfigReader {\n+    private static final Logger LOG = LogManager.getLogger(ConfigReader.class);\n+    private static HashMap<Decider, ArrayList<String>> deciderActionPriorityOrder;\n+\n+    public static final String CONFIG_FILE_PATH = \"./pa_config/deciderConfig.yml\";\n+\n+    public ConfigReader() {\n+        this.deciderActionPriorityOrder = null;\n+    }\n+\n+    public static void updateDeciderActionPriorityOrder() {\n+        ObjectMapper mapper = new ObjectMapper(new YAMLFactory());\n+        try {\n+            deciderActionPriorityOrder = mapper.readValue(new File(CONFIG_FILE_PATH), HashMap.class);\n+        } catch (Exception e) {\n+            LOG.error(\"Could not read the Decider Config File\");\n+            e.printStackTrace();\n+        }\n+        return;\n+    }\n+\n+    public static ArrayList<String> getActionPriorityOrder(String decider) {\n+        return deciderActionPriorityOrder.get(decider);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7cbfc2a152542087d87e0344f989b84561f9d26b"}, "originalPosition": 34}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d6947ace46ebaebe1633582f6ba65346f61f9cc3", "author": {"user": {"login": "aditjind", "name": "Aditya Jindal"}}, "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/commit/d6947ace46ebaebe1633582f6ba65346f61f9cc3", "committedDate": "2020-07-21T21:06:24Z", "message": "Adressing PR Comments x2"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "587dd5050d24719993c61068102b57ee69429c19", "author": {"user": {"login": "aditjind", "name": "Aditya Jindal"}}, "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/commit/587dd5050d24719993c61068102b57ee69429c19", "committedDate": "2020-07-21T21:10:29Z", "message": "Removing Extra Line"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "19893634221efc0bcaea0f3cdd4e2377a5e13c97", "author": {"user": {"login": "aditjind", "name": "Aditya Jindal"}}, "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/commit/19893634221efc0bcaea0f3cdd4e2377a5e13c97", "committedDate": "2020-07-21T21:50:24Z", "message": "Renaming Files"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "510a2170cb136d760ac370c0305ba42d47e25a5f", "author": {"user": {"login": "aditjind", "name": "Aditya Jindal"}}, "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/commit/510a2170cb136d760ac370c0305ba42d47e25a5f", "committedDate": "2020-07-21T22:46:32Z", "message": "Updating Jackson Data format Version"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUzODU1MDA4", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/289#pullrequestreview-453855008", "createdAt": "2020-07-23T06:08:07Z", "commit": {"oid": "510a2170cb136d760ac370c0305ba42d47e25a5f"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yM1QwNjowODowN1rOG19Q3Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yM1QwNjowODowN1rOG19Q3Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTIzMTQ1Mw==", "bodyText": "nit: we can merge these lines", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/289#discussion_r459231453", "createdAt": "2020-07-23T06:08:07Z", "author": {"login": "vigyasharma"}, "path": "src/main/java/com/amazon/opendistro/elasticsearch/performanceanalyzer/decisionmaker/deciders/QueueHealthDecider.java", "diffHunk": "@@ -81,8 +80,8 @@ public Decision operate() {\n   }\n \n   private void configureActionPriority() {\n-    // TODO: Input from user configured yml\n-    this.actionsByUserPriority.add(ModifyQueueCapacityAction.NAME);\n+    ArrayList<String> actionPriority = DeciderActionPriorityReader.getActionPriorityOrder(name());\n+    actionsByUserPriority = actionPriority;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "510a2170cb136d760ac370c0305ba42d47e25a5f"}, "originalPosition": 30}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU0NTc5Nzc0", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/289#pullrequestreview-454579774", "createdAt": "2020-07-24T00:34:05Z", "commit": {"oid": "510a2170cb136d760ac370c0305ba42d47e25a5f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yNFQwMDozNDowNlrOG2f-2A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yNFQwMDozNDowNlrOG2f-2A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTgwMDI4MA==", "bodyText": "let's try to move this reader to somewhere else as it is clearly not part of the RCA graph.", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/289#discussion_r459800280", "createdAt": "2020-07-24T00:34:06Z", "author": {"login": "rguo-aws"}, "path": "src/main/java/com/amazon/opendistro/elasticsearch/performanceanalyzer/rca/store/ElasticSearchAnalysisGraph.java", "diffHunk": "@@ -175,6 +177,10 @@ public void construct() {\n     queueRejectionClusterRca.addAllUpstreams(Collections.singletonList(queueRejectionNodeRca));\n     queueRejectionClusterRca.addTag(TAG_AGGREGATE_UPSTREAM, LOCUS_DATA_NODE);\n \n+    // Upload the config from YAML into memory.\n+    DeciderActionPriorityReader reader = new DeciderActionPriorityReader(DECIDER_ACTION_PRIORITIES_PATH);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "510a2170cb136d760ac370c0305ba42d47e25a5f"}, "originalPosition": 20}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7148b66aaadb932948581124168ad4d597aa9db0", "author": {"user": {"login": "aditjind", "name": "Aditya Jindal"}}, "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/commit/7148b66aaadb932948581124168ad4d597aa9db0", "committedDate": "2020-07-24T01:19:45Z", "message": "Addressing PR Comments"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU1MTc1MDA2", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/289#pullrequestreview-455175006", "createdAt": "2020-07-24T20:44:34Z", "commit": {"oid": "7148b66aaadb932948581124168ad4d597aa9db0"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1092, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}