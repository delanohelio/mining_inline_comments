{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTQwNzA1MDMz", "number": 539, "title": "Add basic retry mechanism for clients", "bodyText": "Fixes #:\nDescription of changes:\nAdds a simple retry mechanism for the grpc clients to retry connection failures.\nThis only retries connection failures. A generic mechanism to handle application level failures and retry them will need more investigation into when a stream should be rebuilt vs rpc being retried without re-establishment and will be added in a subsequent PR.\nTests:\nTested on a docker container by changing port on one node and live debugging on another node to make sure 2 additional calls were made from the grpc client lib.\nIf new tests are added, how long do the new ones take to complete\nBy submitting this pull request, I confirm that my contribution is made under the terms of the Apache 2.0 license.", "createdAt": "2020-12-15T20:48:23Z", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/539", "merged": true, "mergeCommit": {"oid": "a9c00214235da9fbcb1569179410fb854f626d33"}, "closed": true, "closedAt": "2020-12-15T22:54:56Z", "author": {"login": "ktkrg"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdmf0R1gH2gAyNTQwNzA1MDMzOjNiNjU4Y2UwMDFiMWFkMzRkZjUyZmFmMTY4ZjJmYjQ1ZDE5MTRiOWQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdmiRfXAFqTU1MzAxNjM2MQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "3b658ce001b1ad34df52faf168f2fb45d1914b9d", "author": {"user": {"login": "ktkrg", "name": "Karthik Kumarguru"}}, "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/commit/3b658ce001b1ad34df52faf168f2fb45d1914b9d", "committedDate": "2020-12-15T19:50:31Z", "message": "Add basic retry mechanism for clients"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUyODcwOTY2", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/539#pullrequestreview-552870966", "createdAt": "2020-12-15T21:04:34Z", "commit": {"oid": "3b658ce001b1ad34df52faf168f2fb45d1914b9d"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUzMDA4ODg0", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/539#pullrequestreview-553008884", "createdAt": "2020-12-15T22:35:58Z", "commit": {"oid": "3b658ce001b1ad34df52faf168f2fb45d1914b9d"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUzMDE2MzYx", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/539#pullrequestreview-553016361", "createdAt": "2020-12-15T22:41:33Z", "commit": {"oid": "3b658ce001b1ad34df52faf168f2fb45d1914b9d"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNVQyMjo0MTozM1rOIGjQuw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNVQyMjo0MTozM1rOIGjQuw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Mzc0MDA5MQ==", "bodyText": "do we also want to add deadline for rpc call ?\nAnd I also notice that maxRetryAttempts() is marked as experimental. is it going to be an issue to use it inprod ?", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/539#discussion_r543740091", "createdAt": "2020-12-15T22:41:33Z", "author": {"login": "rguo-aws"}, "path": "src/main/java/com/amazon/opendistro/elasticsearch/performanceanalyzer/net/GRPCConnectionManager.java", "diffHunk": "@@ -175,10 +173,12 @@ private int getPortFromHost(final InstanceDetails remoteHost) {\n   }\n \n   private ManagedChannel buildInsecureChannel(final InstanceDetails remoteHost) {\n-    return ManagedChannelBuilder.forAddress(\n-            remoteHost.getInstanceIp().toString(),\n-            getPortFromHost(remoteHost)\n-    ).usePlaintext().build();\n+    return ManagedChannelBuilder.forAddress(remoteHost.getInstanceIp().toString(),\n+        getPortFromHost(remoteHost))\n+                                .usePlaintext()\n+                                .enableRetry()\n+                                .maxRetryAttempts(MAX_RETRY_ATTEMPTS)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3b658ce001b1ad34df52faf168f2fb45d1914b9d"}, "originalPosition": 44}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 826, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}