{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDgyMjUzODA4", "number": 414, "title": "Add unit tests for JVM decider", "bodyText": "Fixes #:\n#409\nDescription of changes:\n\nAdd unit test for JVM decider and relevant decision making modules\nFix minor bugs found when writing unite tests\n\nTests:\nBy submitting this pull request, I confirm that my contribution is made under the terms of the Apache 2.0 license.", "createdAt": "2020-09-08T19:36:01Z", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/414", "merged": true, "mergeCommit": {"oid": "5944249a93f2709b849a3afb993f0cde840960a1"}, "closed": true, "closedAt": "2020-09-10T23:16:36Z", "author": {"login": "rguo-aws"}, "timelineItems": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdG8lXhAH2gAyNDgyMjUzODA4OjYyOTFmOGMzYWM1NTgwMGI0MDM5MTcyNTNhZDlmMmRiYzRmZTJlZGY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdHog0IgFqTQ4NjM1MzUwNA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "6291f8c3ac55800b403917253ad9f2dbc4fe2edf", "author": {"user": {"login": "rguo-aws", "name": "Ruizhen Guo"}}, "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/commit/6291f8c3ac55800b403917253ad9f2dbc4fe2edf", "committedDate": "2020-09-08T19:15:54Z", "message": "Add unit tests for JVM decider"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cd53c6019ebe7ba3c492ab29dc1bcd5d4ecaf13b", "author": {"user": {"login": "rguo-aws", "name": "Ruizhen Guo"}}, "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/commit/cd53c6019ebe7ba3c492ab29dc1bcd5d4ecaf13b", "committedDate": "2020-09-08T19:41:29Z", "message": "Merge remote-tracking branch 'origin' into rguo-jvm-decider-ut"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8993fe78e18717ffa873e523f1d21419e14d0c26", "author": {"user": {"login": "rguo-aws", "name": "Ruizhen Guo"}}, "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/commit/8993fe78e18717ffa873e523f1d21419e14d0c26", "committedDate": "2020-09-08T22:28:00Z", "message": "Fix checkstyle"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg0NTUwNDQ2", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/414#pullrequestreview-484550446", "createdAt": "2020-09-08T23:00:55Z", "commit": {"oid": "8993fe78e18717ffa873e523f1d21419e14d0c26"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOFQyMzowMDo1NVrOHOwxxg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOFQyMzowMDo1NVrOHOwxxg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTI0MTI4Ng==", "bodyText": "What happens when there are more than 2 workload type. If we dont want them in a list, can we use numbers to denote their priority? Also can you update the comment if we are changing it", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/414#discussion_r485241286", "createdAt": "2020-09-08T23:00:55Z", "author": {"login": "sruti1312"}, "path": "src/main/java/com/amazon/opendistro/elasticsearch/performanceanalyzer/decisionmaker/deciders/configs/DeciderConfig.java", "diffHunk": "@@ -26,7 +24,8 @@\n  *     // Decreasing order of priority for the type of workload we can expect on the cluster.\n  *     // Priority order in the list goes from most expected to the lease expected workload type.\n  *     \"workload-type\": {\n- *       \"priority-order\": [\"ingest\", \"search\"]\n+ *       \"prefer-ingest\": true,\n+ *       \"prefer-search\": false", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8993fe78e18717ffa873e523f1d21419e14d0c26"}, "originalPosition": 20}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg1MjkwMjg0", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/414#pullrequestreview-485290284", "createdAt": "2020-09-09T18:31:14Z", "commit": {"oid": "8993fe78e18717ffa873e523f1d21419e14d0c26"}, "state": "COMMENTED", "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOVQxODozMToxNFrOHPUqTA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOVQxODozODo1N1rOHPU6Qw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTgyOTE5Ng==", "bodyText": "step count will be a part of cacheSettingConfig right? Is there a reason why we are moving to actionConfig?\nWill it be common parameter for cache and queue?", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/414#discussion_r485829196", "createdAt": "2020-09-09T18:31:14Z", "author": {"login": "sruti1312"}, "path": "src/main/java/com/amazon/opendistro/elasticsearch/performanceanalyzer/decisionmaker/actions/configs/CacheActionConfig.java", "diffHunk": "@@ -68,7 +68,7 @@ public CacheActionConfig(RcaConf conf) {\n     cacheSettingsConfig = new NestedConfig(\"cache-settings\", actionConfig);\n     fieldDataCacheConfig = new FieldDataCacheConfig(cacheSettingsConfig);\n     shardRequestCacheConfig = new ShardRequestCacheConfig(cacheSettingsConfig);\n-    totalStepCount = new Config<>(TOTAL_STEP_COUNT_CONFIG_NAME, cacheSettingsConfig.getValue(),\n+    totalStepCount = new Config<>(TOTAL_STEP_COUNT_CONFIG_NAME, actionConfig,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8993fe78e18717ffa873e523f1d21419e14d0c26"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTgyOTMwOA==", "bodyText": "same as above", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/414#discussion_r485829308", "createdAt": "2020-09-09T18:31:26Z", "author": {"login": "sruti1312"}, "path": "src/main/java/com/amazon/opendistro/elasticsearch/performanceanalyzer/decisionmaker/actions/configs/QueueActionConfig.java", "diffHunk": "@@ -67,7 +67,7 @@ public QueueActionConfig(RcaConf conf) {\n     queueSettingsConfig = new NestedConfig(\"queue-settings\", actionConfig);\n     searchQueueConfig = new SearchQueueConfig(queueSettingsConfig);\n     writeQueueConfig = new WriteQueueConfig(queueSettingsConfig);\n-    totalStepCount = new Config<>(TOTAL_STEP_COUNT_CONFIG_NAME, queueSettingsConfig.getValue(),\n+    totalStepCount = new Config<>(TOTAL_STEP_COUNT_CONFIG_NAME, actionConfig,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8993fe78e18717ffa873e523f1d21419e14d0c26"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTgyOTg5NA==", "bodyText": "We might need to update this comment right?", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/414#discussion_r485829894", "createdAt": "2020-09-09T18:32:35Z", "author": {"login": "sruti1312"}, "path": "src/main/java/com/amazon/opendistro/elasticsearch/performanceanalyzer/decisionmaker/deciders/configs/DeciderConfig.java", "diffHunk": "@@ -26,7 +24,8 @@\n  *     // Decreasing order of priority for the type of workload we can expect on the cluster.\n  *     // Priority order in the list goes from most expected to the lease expected workload type.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8993fe78e18717ffa873e523f1d21419e14d0c26"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTgzMDkyOQ==", "bodyText": "This is confusing. I notice you have changed to use actionConfig. In that case this should be outside queue-settings block right?", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/414#discussion_r485830929", "createdAt": "2020-09-09T18:34:32Z", "author": {"login": "sruti1312"}, "path": "src/main/java/com/amazon/opendistro/elasticsearch/performanceanalyzer/decisionmaker/actions/configs/QueueActionConfig.java", "diffHunk": "@@ -36,7 +36,7 @@\n  *       \"total-step-count\": 20,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8993fe78e18717ffa873e523f1d21419e14d0c26"}, "originalPosition": 1}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTgzMzI4Mw==", "bodyText": "As we are using this in test, can we rename to DeciderActionParserUtil or put it under util folder?\nThis can avoid confusion between src files and test files", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/414#discussion_r485833283", "createdAt": "2020-09-09T18:38:57Z", "author": {"login": "sruti1312"}, "path": "src/test/java/com/amazon/opendistro/elasticsearch/performanceanalyzer/decisionmaker/deciders/DeciderActionParser.java", "diffHunk": "@@ -0,0 +1,64 @@\n+/*\n+ * Copyright 2020 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ * permissions and limitations under the License.\n+ */\n+\n+package com.amazon.opendistro.elasticsearch.performanceanalyzer.decisionmaker.deciders;\n+\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.decisionmaker.actions.Action;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.decisionmaker.actions.ModifyCacheMaxSizeAction;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.decisionmaker.actions.ModifyQueueCapacityAction;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.grpc.ResourceEnum;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+\n+public class DeciderActionParser {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8993fe78e18717ffa873e523f1d21419e14d0c26"}, "originalPosition": 26}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg1MzAyNDE3", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/414#pullrequestreview-485302417", "createdAt": "2020-09-09T18:49:19Z", "commit": {"oid": "8993fe78e18717ffa873e523f1d21419e14d0c26"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg1NDYyNjI1", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/414#pullrequestreview-485462625", "createdAt": "2020-09-09T23:11:12Z", "commit": {"oid": "8993fe78e18717ffa873e523f1d21419e14d0c26"}, "state": "DISMISSED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOVQyMzoxMToxMlrOHPdUNg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOVQyMzoxMToxMlrOHPdUNg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTk3MDk5OA==", "bodyText": "+1", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/414#discussion_r485970998", "createdAt": "2020-09-09T23:11:12Z", "author": {"login": "sidheart"}, "path": "src/test/java/com/amazon/opendistro/elasticsearch/performanceanalyzer/decisionmaker/deciders/DeciderActionParser.java", "diffHunk": "@@ -0,0 +1,64 @@\n+/*\n+ * Copyright 2020 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ * permissions and limitations under the License.\n+ */\n+\n+package com.amazon.opendistro.elasticsearch.performanceanalyzer.decisionmaker.deciders;\n+\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.decisionmaker.actions.Action;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.decisionmaker.actions.ModifyCacheMaxSizeAction;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.decisionmaker.actions.ModifyQueueCapacityAction;\n+import com.amazon.opendistro.elasticsearch.performanceanalyzer.grpc.ResourceEnum;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+\n+public class DeciderActionParser {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTgzMzI4Mw=="}, "originalCommit": {"oid": "8993fe78e18717ffa873e523f1d21419e14d0c26"}, "originalPosition": 26}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f6816e2fdddbb778f9bb0b9c124fcf1a7fcad5a2", "author": {"user": {"login": "rguo-aws", "name": "Ruizhen Guo"}}, "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/commit/f6816e2fdddbb778f9bb0b9c124fcf1a7fcad5a2", "committedDate": "2020-09-10T19:43:48Z", "message": "Address PR comments"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg2Mjc4NjUx", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/414#pullrequestreview-486278651", "createdAt": "2020-09-10T20:17:33Z", "commit": {"oid": "f6816e2fdddbb778f9bb0b9c124fcf1a7fcad5a2"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMFQyMDoxNzozM1rOHQEOxg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMFQyMDoxNzozM1rOHQEOxg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjYwODU4Mg==", "bodyText": "As per your comment\nstep count is indeed part of the cacheSettingConfig. But here we need to pass the parent Map<> object as a parameter in the constructor of the Config class\nIn that case this step count might need to be inside the cache-settings block right?", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/414#discussion_r486608582", "createdAt": "2020-09-10T20:17:33Z", "author": {"login": "sruti1312"}, "path": "src/test/java/com/amazon/opendistro/elasticsearch/performanceanalyzer/decisionmaker/actions/configs/CacheActionConfigTest.java", "diffHunk": "@@ -105,4 +105,48 @@ public void testInvalidCacheType() throws Exception {\n     CacheActionConfig cacheActionConfig = new CacheActionConfig(conf);\n     cacheActionConfig.getThresholdConfig(ResourceEnum.SEARCH_THREADPOOL).upperBound();\n   }\n+\n+  @Test\n+  public void testGetStepSize() throws Exception {\n+    String configStr =\n+        \"{\"\n+          + \"\\\"action-config-settings\\\": { \"\n+              + \"\\\"cache-settings\\\": { \"\n+                  + \"\\\"fielddata\\\": { \"\n+                      + \"\\\"upper-bound\\\": 0.8, \"\n+                      + \"\\\"lower-bound\\\": 0.2 \"\n+                  + \"}, \"\n+                  + \"\\\"shard-request\\\": { \"\n+                      + \"\\\"upper-bound\\\": 0.08, \"\n+                      + \"\\\"lower-bound\\\": 0.01 \"\n+                  + \"} \"\n+              + \"} \"\n+          + \"} \"\n+      + \"}\";\n+    RcaConf conf = new RcaConf();\n+    conf.readConfigFromString(configStr);\n+    CacheActionConfig cacheActionConfig = new CacheActionConfig(conf);\n+    assertEquals(0.03, cacheActionConfig.getStepSize(ResourceEnum.FIELD_DATA_CACHE), 0.0001);\n+    assertEquals(0.0035, cacheActionConfig.getStepSize(ResourceEnum.SHARD_REQUEST_CACHE), 0.0001);\n+    configStr =\n+        \"{\"\n+          + \"\\\"action-config-settings\\\": { \"\n+              + \"\\\"total-step-count\\\": 5,\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f6816e2fdddbb778f9bb0b9c124fcf1a7fcad5a2"}, "originalPosition": 30}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "be12af77c189d05d335b78b0f5dd053f98655f21", "author": {"user": {"login": "rguo-aws", "name": "Ruizhen Guo"}}, "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/commit/be12af77c189d05d335b78b0f5dd053f98655f21", "committedDate": "2020-09-10T20:50:31Z", "message": "Address more PR comments"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg2MzE3MjU3", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/414#pullrequestreview-486317257", "createdAt": "2020-09-10T21:17:56Z", "commit": {"oid": "be12af77c189d05d335b78b0f5dd053f98655f21"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg2MzUzNTA0", "url": "https://github.com/opendistro-for-elasticsearch/performance-analyzer-rca/pull/414#pullrequestreview-486353504", "createdAt": "2020-09-10T22:26:45Z", "commit": {"oid": "be12af77c189d05d335b78b0f5dd053f98655f21"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 913, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}