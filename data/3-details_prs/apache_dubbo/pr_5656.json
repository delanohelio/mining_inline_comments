{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzYzMDg3Njk3", "number": 5656, "title": "[DUBBO-4288]: simple workaround to make shutdown hook work again when DubboBootstrap is not used", "bodyText": "What is the purpose of the change\nFor backward compatibility.\nIn 2.7.5, the shutdown hook doesn't work if app is directly based on ServiceConfig API or ReferenceConfig  API. This problem is found when I look into #4288.\nBrief changelog\nXXXXX\nVerifying this change\nXXXXX\nFollow this checklist to help us incorporate your contribution quickly and easily:\n\n Make sure there is a GITHUB_issue field for the change (usually before you start working on it). Trivial changes like typos do not require a GITHUB issue. Your pull request should address just this issue, without pulling in other changes - one PR resolves one issue.\n Format the pull request title like [Dubbo-XXX] Fix UnknownException when host config not exist #XXX. Each commit in the pull request should have a meaningful subject line and body.\n Write a pull request description that is detailed enough to understand what the pull request does, how, and why.\n Write necessary unit-test to verify your logic correction, more mock a little better when cross module dependency exist. If the new feature or significant change is committed, please remember to add sample in dubbo samples project.\n Run mvn clean install -DskipTests=false & mvn clean test-compile failsafe:integration-test to make sure unit-test and integration-test pass.\n If this contribution is large, please follow the Software Donation Guide.", "createdAt": "2020-01-15T11:21:17Z", "url": "https://github.com/apache/dubbo/pull/5656", "merged": true, "mergeCommit": {"oid": "14f62f20da9933a234c3d2a07d67644be78f2b5f"}, "closed": true, "closedAt": "2020-01-19T02:24:16Z", "author": {"login": "beiwei30"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb6jtMvgH2gAyMzYzMDg3Njk3Ojc0MTMwMTg3YTdjYzczNjZjNTEyMTlhNDdhZmZlMmNkMmFjYzRhMDk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABb7IouXgH2gAyMzYzMDg3Njk3OjIxYzBhZTIwYTcwMzliODlkNGI4ZmRkMDZhZmE2ODhlOWU0ZjhhMzM=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "74130187a7cc7366c51219a47affe2cd2acc4a09", "author": {"user": {"login": "beiwei30", "name": "Ian Luo"}}, "url": "https://github.com/apache/dubbo/commit/74130187a7cc7366c51219a47affe2cd2acc4a09", "committedDate": "2020-01-15T11:18:35Z", "message": "issue4288: simple workaround to make shutdown hook work again when DubboBootstrap is not used"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQzMTgxMjMz", "url": "https://github.com/apache/dubbo/pull/5656#pullrequestreview-343181233", "createdAt": "2020-01-15T12:23:00Z", "commit": {"oid": "74130187a7cc7366c51219a47affe2cd2acc4a09"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNVQxMjoyMzowMFrOFd2lrQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNVQxMjoyMzowMFrOFd2lrQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Njg0NzQwNQ==", "bodyText": "If DubboBootstrap is enabled, will it also register the DubboShutdownHook and repeatedly call these destroy operations?", "url": "https://github.com/apache/dubbo/pull/5656#discussion_r366847405", "createdAt": "2020-01-15T12:23:00Z", "author": {"login": "CodingSinger"}, "path": "dubbo-config/dubbo-config-api/src/main/java/org/apache/dubbo/config/DubboShutdownHook.java", "diffHunk": "@@ -91,6 +92,11 @@ public void register() {\n             DubboShutdownHook dubboShutdownHook = getDubboShutdownHook();\n             Runtime.getRuntime().addShutdownHook(dubboShutdownHook);\n             dispatch(new DubboShutdownHookRegisteredEvent(dubboShutdownHook));\n+            ShutdownHookCallbacks.INSTANCE.addCallback(() -> {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "74130187a7cc7366c51219a47affe2cd2acc4a09"}, "originalPosition": 12}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "22aca75bed4c6d155a60eb74899c05156e197447", "author": {"user": {"login": "beiwei30", "name": "Ian Luo"}}, "url": "https://github.com/apache/dubbo/commit/22aca75bed4c6d155a60eb74899c05156e197447", "committedDate": "2020-01-16T02:25:56Z", "message": "introduce destroyAll() method"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "81cf28b3b200b25199af103352e2836097025f77", "author": {"user": {"login": "beiwei30", "name": "Ian Luo"}}, "url": "https://github.com/apache/dubbo/commit/81cf28b3b200b25199af103352e2836097025f77", "committedDate": "2020-01-16T04:37:38Z", "message": "make ReferenceConfig and ServiceConfig do not depend on DubboBootstrap any longer"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "81481a1e5a0a39e818136124dade46b30f0fbb68", "author": {"user": {"login": "beiwei30", "name": "Ian Luo"}}, "url": "https://github.com/apache/dubbo/commit/81481a1e5a0a39e818136124dade46b30f0fbb68", "committedDate": "2020-01-16T07:06:17Z", "message": "cannot remove DubboBootstrap for now, need to revisit it in the next release"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bbdd108b19319a882333389a32290b5bda7de557", "author": {"user": {"login": "beiwei30", "name": "Ian Luo"}}, "url": "https://github.com/apache/dubbo/commit/bbdd108b19319a882333389a32290b5bda7de557", "committedDate": "2020-01-16T07:08:54Z", "message": "no need to create default monitor for now"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "21c0ae20a7039b89d4b8fdd06afa688e9e4f8a33", "author": {"user": {"login": "beiwei30", "name": "Ian Luo"}}, "url": "https://github.com/apache/dubbo/commit/21c0ae20a7039b89d4b8fdd06afa688e9e4f8a33", "committedDate": "2020-01-17T06:20:11Z", "message": "Merge branch 'master' into issue4288"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2160, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}