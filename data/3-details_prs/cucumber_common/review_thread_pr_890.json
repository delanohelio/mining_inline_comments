{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzcxOTk3Mjcx", "number": 890, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNlQxNjo0ODowMFrODdwSaQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMlQwODowNToyN1rODfFEew==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMyNTI2NDQxOnYy", "diffSide": "RIGHT", "path": "cucumber-expressions/java/src/main/java/io/cucumber/cucumberexpressions/UndefinedParameterTypeExpression.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNlQxNjo0ODowMFrOFmiY0A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNlQxNjo0ODozMlrOFmiaIg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTk1MzYxNg==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            public class UndefinedParameterTypeExpression implements Expression {\n          \n          \n            \n            final class UndefinedParameterTypeExpression implements Expression {", "url": "https://github.com/cucumber/common/pull/890#discussion_r375953616", "createdAt": "2020-02-06T16:48:00Z", "author": {"login": "mpkorstanje"}, "path": "cucumber-expressions/java/src/main/java/io/cucumber/cucumberexpressions/UndefinedParameterTypeExpression.java", "diffHunk": "@@ -0,0 +1,28 @@\n+package io.cucumber.cucumberexpressions;\n+\n+import java.lang.reflect.Type;\n+import java.util.List;\n+import java.util.regex.Pattern;\n+\n+public class UndefinedParameterTypeExpression implements Expression {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "31e2a659057178e60046a6c7714f06c812e32db2"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTk1Mzk1NA==", "bodyText": "Don't forget CucumberExpression and RegularExpression.", "url": "https://github.com/cucumber/common/pull/890#discussion_r375953954", "createdAt": "2020-02-06T16:48:32Z", "author": {"login": "mpkorstanje"}, "path": "cucumber-expressions/java/src/main/java/io/cucumber/cucumberexpressions/UndefinedParameterTypeExpression.java", "diffHunk": "@@ -0,0 +1,28 @@\n+package io.cucumber.cucumberexpressions;\n+\n+import java.lang.reflect.Type;\n+import java.util.List;\n+import java.util.regex.Pattern;\n+\n+public class UndefinedParameterTypeExpression implements Expression {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTk1MzYxNg=="}, "originalCommit": {"oid": "31e2a659057178e60046a6c7714f06c812e32db2"}, "originalPosition": 7}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMyNTI4NjQ0OnYy", "diffSide": "RIGHT", "path": "cucumber-expressions/java/src/main/java/io/cucumber/cucumberexpressions/ExpressionFactory.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNlQxNjo1Mzo0OVrOFmimdg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNlQxNjo1NDo1MVrOFmiovQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTk1NzExMA==", "bodyText": "We're using exceptions for control flow. Might be worth extracting some of the code in the CucumberExpression to the factory instead of throwing the exception and then catching it.", "url": "https://github.com/cucumber/common/pull/890#discussion_r375957110", "createdAt": "2020-02-06T16:53:49Z", "author": {"login": "mpkorstanje"}, "path": "cucumber-expressions/java/src/main/java/io/cucumber/cucumberexpressions/ExpressionFactory.java", "diffHunk": "@@ -31,7 +31,15 @@ public Expression createExpression(String expressionString) {\n         if (m.find()) {\n             return new RegularExpression(Pattern.compile(m.group(1)), parameterTypeRegistry);\n         }\n-        return new CucumberExpression(expressionString, parameterTypeRegistry);\n+        return createCucumberExpression(expressionString);\n+    }\n+\n+    private Expression createCucumberExpression(String expressionString) {\n+        try {\n+            return new CucumberExpression(expressionString, parameterTypeRegistry);\n+        } catch (UndefinedParameterTypeException e) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "31e2a659057178e60046a6c7714f06c812e32db2"}, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTk1NzY5Mw==", "bodyText": "Yeah I had the same thought.", "url": "https://github.com/cucumber/common/pull/890#discussion_r375957693", "createdAt": "2020-02-06T16:54:51Z", "author": {"login": "aslakhellesoy"}, "path": "cucumber-expressions/java/src/main/java/io/cucumber/cucumberexpressions/ExpressionFactory.java", "diffHunk": "@@ -31,7 +31,15 @@ public Expression createExpression(String expressionString) {\n         if (m.find()) {\n             return new RegularExpression(Pattern.compile(m.group(1)), parameterTypeRegistry);\n         }\n-        return new CucumberExpression(expressionString, parameterTypeRegistry);\n+        return createCucumberExpression(expressionString);\n+    }\n+\n+    private Expression createCucumberExpression(String expressionString) {\n+        try {\n+            return new CucumberExpression(expressionString, parameterTypeRegistry);\n+        } catch (UndefinedParameterTypeException e) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTk1NzExMA=="}, "originalCommit": {"oid": "31e2a659057178e60046a6c7714f06c812e32db2"}, "originalPosition": 11}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMzODA4NTA2OnYy", "diffSide": "RIGHT", "path": "messages/dotnet/messages.proto", "isResolved": false, "comments": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMVQyMjowMDowMlrOFoavWQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMlQxMToxNTowNlrOFoqukg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzkyNTQ2NQ==", "bodyText": "Implementation wise I would suggest adding a result object to the TestRunFinished event with the undefined parameter type exception rather then adding it here. That way consumers of the ndjson can easily see why the test run failed. Comparable to TestCaseFinished.", "url": "https://github.com/cucumber/common/pull/890#discussion_r377925465", "createdAt": "2020-02-11T22:00:02Z", "author": {"login": "mpkorstanje"}, "path": "messages/dotnet/messages.proto", "diffHunk": "@@ -68,6 +68,7 @@ message Envelope {\n     StepDefinition step_definition = 25;\n     Hook hook = 26;\n     ParameterType parameter_type = 27;\n+    UndefinedParameterType undefined_parameter_type = 28;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b5c0c7b763ebc1e9940cdb019a5b75a2ebd4c78d"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzkyNzA0NA==", "bodyText": "That's assuming I can convince you to go for option 1.", "url": "https://github.com/cucumber/common/pull/890#discussion_r377927044", "createdAt": "2020-02-11T22:03:40Z", "author": {"login": "mpkorstanje"}, "path": "messages/dotnet/messages.proto", "diffHunk": "@@ -68,6 +68,7 @@ message Envelope {\n     StepDefinition step_definition = 25;\n     Hook hook = 26;\n     ParameterType parameter_type = 27;\n+    UndefinedParameterType undefined_parameter_type = 28;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzkyNTQ2NQ=="}, "originalCommit": {"oid": "b5c0c7b763ebc1e9940cdb019a5b75a2ebd4c78d"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Nzk2NzIxNg==", "bodyText": "There may be multiple undefined parameter types, so if we bundle that into TestRunFinished it would have to be a repeated field. Maybe that's ok, but we could also send it as individual messages like the current code in this PR does. I don't think that would be a problem.", "url": "https://github.com/cucumber/common/pull/890#discussion_r377967216", "createdAt": "2020-02-11T23:48:28Z", "author": {"login": "aslakhellesoy"}, "path": "messages/dotnet/messages.proto", "diffHunk": "@@ -68,6 +68,7 @@ message Envelope {\n     StepDefinition step_definition = 25;\n     Hook hook = 26;\n     ParameterType parameter_type = 27;\n+    UndefinedParameterType undefined_parameter_type = 28;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzkyNTQ2NQ=="}, "originalCommit": {"oid": "b5c0c7b763ebc1e9940cdb019a5b75a2ebd4c78d"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODE2MzEzMw==", "bodyText": "It does make it more complex to know if a run failed or passed. In the absence of any test results consumers would now have to know that undefined parameter type messages are in fact failures and not merely a special kind of step definition.\nI would also have good use case for a more generic result field in TestRunFinished. Undefined parameter types are but one reason why Cucumber can fail to startup. For example the DI container may fail to initialize, invalid regexes, errors while instantiating the glue, ect.", "url": "https://github.com/cucumber/common/pull/890#discussion_r378163133", "createdAt": "2020-02-12T10:28:18Z", "author": {"login": "mpkorstanje"}, "path": "messages/dotnet/messages.proto", "diffHunk": "@@ -68,6 +68,7 @@ message Envelope {\n     StepDefinition step_definition = 25;\n     Hook hook = 26;\n     ParameterType parameter_type = 27;\n+    UndefinedParameterType undefined_parameter_type = 28;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzkyNTQ2NQ=="}, "originalCommit": {"oid": "b5c0c7b763ebc1e9940cdb019a5b75a2ebd4c78d"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODE2MzcyMQ==", "bodyText": "I could also use the result  field in TestRunFinished to store the results of BeforeAll and AfterAll hooks should they fail.", "url": "https://github.com/cucumber/common/pull/890#discussion_r378163721", "createdAt": "2020-02-12T10:29:16Z", "author": {"login": "mpkorstanje"}, "path": "messages/dotnet/messages.proto", "diffHunk": "@@ -68,6 +68,7 @@ message Envelope {\n     StepDefinition step_definition = 25;\n     Hook hook = 26;\n     ParameterType parameter_type = 27;\n+    UndefinedParameterType undefined_parameter_type = 28;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzkyNTQ2NQ=="}, "originalCommit": {"oid": "b5c0c7b763ebc1e9940cdb019a5b75a2ebd4c78d"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODE3NjA1MA==", "bodyText": "The front-end should print snippets for all undefined parameter types. In order to do that, we'd have to embed all the UndefinedParameterType messages in TestRunFinished.\nAs you point out there can be many reasons a test run fails, and we need to be able to distinguish between them. How about this:\nmessage TestRunFinished {\n  bool success = 1;\n  Timestamp timestamp = 2;\n  // Error message. Can be a stack trace from a failed `BeforeAll` or `AfterAll`.\n  // If there are undefined parameter types, the message is simply \"There were undefined parameter types\", and the `undefinedParameterTypes` field will have the details\n  string message = 3;\n  repeated UndefinedParameterType undefinedParameterTypes = 4;\n}\nIt's tempting to embed TestResult in TestRunFinished, but it's really a TestStepResult, so I think we should rename it.\nWDYT?", "url": "https://github.com/cucumber/common/pull/890#discussion_r378176050", "createdAt": "2020-02-12T10:52:30Z", "author": {"login": "aslakhellesoy"}, "path": "messages/dotnet/messages.proto", "diffHunk": "@@ -68,6 +68,7 @@ message Envelope {\n     StepDefinition step_definition = 25;\n     Hook hook = 26;\n     ParameterType parameter_type = 27;\n+    UndefinedParameterType undefined_parameter_type = 28;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzkyNTQ2NQ=="}, "originalCommit": {"oid": "b5c0c7b763ebc1e9940cdb019a5b75a2ebd4c78d"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODE4MTY4OA==", "bodyText": "How about:\n\n\nUndefined Parameter Types should fail the build. So TestRunFinished.success = false and include a message about the missing parameter type.\n\n\nThen we define TestRunFinished:\n\n\nmessage TestRunFinished {\n  bool success = 1;\n  Timestamp timestamp = 2;\n  // Error message. Can be a stack trace from a failed `BeforeAll` or `AfterAll`.\n  // If there are undefined parameter types, the message is simply \"There were undefined parameter types\", and the `undefinedParameterTypes` field will have the details\n  string message = 3;\n}\n\n\nUndefinedParameterType as a seperate message for specialized reporters that print snippets.", "url": "https://github.com/cucumber/common/pull/890#discussion_r378181688", "createdAt": "2020-02-12T11:03:18Z", "author": {"login": "mpkorstanje"}, "path": "messages/dotnet/messages.proto", "diffHunk": "@@ -68,6 +68,7 @@ message Envelope {\n     StepDefinition step_definition = 25;\n     Hook hook = 26;\n     ParameterType parameter_type = 27;\n+    UndefinedParameterType undefined_parameter_type = 28;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzkyNTQ2NQ=="}, "originalCommit": {"oid": "b5c0c7b763ebc1e9940cdb019a5b75a2ebd4c78d"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODE4MzExOA==", "bodyText": "The error message should include a message about the undefined parameter types (plural)\n\n\nAgree!\n\n\nAgree!\n\n\nSo if I simply add message to TestRunFinished we can merge this, right?", "url": "https://github.com/cucumber/common/pull/890#discussion_r378183118", "createdAt": "2020-02-12T11:06:10Z", "author": {"login": "aslakhellesoy"}, "path": "messages/dotnet/messages.proto", "diffHunk": "@@ -68,6 +68,7 @@ message Envelope {\n     StepDefinition step_definition = 25;\n     Hook hook = 26;\n     ParameterType parameter_type = 27;\n+    UndefinedParameterType undefined_parameter_type = 28;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzkyNTQ2NQ=="}, "originalCommit": {"oid": "b5c0c7b763ebc1e9940cdb019a5b75a2ebd4c78d"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODE4NzA4Mw==", "bodyText": "Yes! That is workable! Please make it a new major version too.", "url": "https://github.com/cucumber/common/pull/890#discussion_r378187083", "createdAt": "2020-02-12T11:14:24Z", "author": {"login": "mpkorstanje"}, "path": "messages/dotnet/messages.proto", "diffHunk": "@@ -68,6 +68,7 @@ message Envelope {\n     StepDefinition step_definition = 25;\n     Hook hook = 26;\n     ParameterType parameter_type = 27;\n+    UndefinedParameterType undefined_parameter_type = 28;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzkyNTQ2NQ=="}, "originalCommit": {"oid": "b5c0c7b763ebc1e9940cdb019a5b75a2ebd4c78d"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODE4NzQxMA==", "bodyText": "Will do - and I'll rename TestResult to TestStepResult as well, because that's what it is.", "url": "https://github.com/cucumber/common/pull/890#discussion_r378187410", "createdAt": "2020-02-12T11:15:06Z", "author": {"login": "aslakhellesoy"}, "path": "messages/dotnet/messages.proto", "diffHunk": "@@ -68,6 +68,7 @@ message Envelope {\n     StepDefinition step_definition = 25;\n     Hook hook = 26;\n     ParameterType parameter_type = 27;\n+    UndefinedParameterType undefined_parameter_type = 28;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzkyNTQ2NQ=="}, "originalCommit": {"oid": "b5c0c7b763ebc1e9940cdb019a5b75a2ebd4c78d"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMzOTE1NTE1OnYy", "diffSide": "RIGHT", "path": "compatibility-kit/javascript/features/parameter-types/parameter-types.ts", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMlQwODowNToyN1rOFokz3Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMlQxNTowNjoyNVrOFoyKqA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODA5MDQ2MQ==", "bodyText": "I know we have the {x} test in rspec for ruby, but do these tests need copying elsewhere, or does the CCK function like the golden tests?", "url": "https://github.com/cucumber/common/pull/890#discussion_r378090461", "createdAt": "2020-02-12T08:05:27Z", "author": {"login": "luke-hill"}, "path": "compatibility-kit/javascript/features/parameter-types/parameter-types.ts", "diffHunk": "@@ -21,3 +21,8 @@ Given('{flight} has been delayed {int} minutes', function(\n   assert.equal(flight.to, 'CDG')\n   assert.equal(delay, 45)\n })\n+\n+// eslint-disable-next-line @typescript-eslint/no-unused-vars\n+Given('{airport} is closed because of a strike', function(airport) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b5c0c7b763ebc1e9940cdb019a5b75a2ebd4c78d"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODMwOTI4OA==", "bodyText": "The CCK defines golden ndjson files by running the features against fake-cucumber. We don't require other Cucumber implementations to produce identical files, but the files they produce should be consumable by the json-formatter and html-formatter.", "url": "https://github.com/cucumber/common/pull/890#discussion_r378309288", "createdAt": "2020-02-12T15:06:25Z", "author": {"login": "aslakhellesoy"}, "path": "compatibility-kit/javascript/features/parameter-types/parameter-types.ts", "diffHunk": "@@ -21,3 +21,8 @@ Given('{flight} has been delayed {int} minutes', function(\n   assert.equal(flight.to, 'CDG')\n   assert.equal(delay, 45)\n })\n+\n+// eslint-disable-next-line @typescript-eslint/no-unused-vars\n+Given('{airport} is closed because of a strike', function(airport) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODA5MDQ2MQ=="}, "originalCommit": {"oid": "b5c0c7b763ebc1e9940cdb019a5b75a2ebd4c78d"}, "originalPosition": 6}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 770, "cost": 1, "resetAt": "2021-11-12T11:57:46Z"}}}