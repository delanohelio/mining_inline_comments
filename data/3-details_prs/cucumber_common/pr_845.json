{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzYwMDc5MTQ2", "number": 845, "title": "Add gherkin query in Ruby", "bodyText": "Summary\nLike this was done in Gherkin-JS, this PR adds a simple GherkinQuery object that provides the Location objects of various AST nodes found in GherkinDocument message after parsing.\nAlso, it raises an exception when we iterate more than once on the messages. If we don't do so, we may end up with multiple AST node objects representing the same part of the Gherkin feature but with different IDs.\nThis object will likely grow in the future (for example for finding the original PickleStep location), but this should already be enough to be used in cucumber-ruby(-core).\nMaybe more will be added to this PR or in other ones when needed.\nHow Has This Been Tested?\nWith Unit tests\nScreenshots (if appropriate):\nTypes of changes\n\n\n Bug fix (non-breaking change which fixes an issue).\n New feature (non-breaking change which adds functionality).\n Breaking change (fix or feature that would cause existing functionality to not work as expected).\n\nChecklist:\n\n\n\n The change has been ported to Java.\n The change has been ported to Ruby.\n The change has been ported to JavaScript.\n The change has been ported to Go.\n The change has been ported to .NET.\n I've added tests for my code.\n My change requires a change to the documentation.\n I have updated the documentation accordingly.", "createdAt": "2020-01-07T16:52:29Z", "url": "https://github.com/cucumber/common/pull/845", "merged": true, "mergeCommit": {"oid": "b8c9b57aa757be3ea08ca670adbb4261b6f13d2e"}, "closed": true, "closedAt": "2020-01-09T10:25:49Z", "author": {"login": "vincent-psarga"}, "timelineItems": {"totalCount": 13, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb4ClpSgH2gAyMzYwMDc5MTQ2OmU3MWM1MWZkMDRlODQ3NGYyNjM4MDVmZTA3NTA2MmY3YjljZmIyYWE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABb4nWnIgFqTM0MDQyMDc1Ng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "e71c51fd04e8474f263805fe075062f7b9cfb2aa", "author": {"user": {"login": "vincent-psarga", "name": "Vincent"}}, "url": "https://github.com/cucumber/common/commit/e71c51fd04e8474f263805fe075062f7b9cfb2aa", "committedDate": "2020-01-07T15:35:37Z", "message": "Raise an exception when messages are iterated/generated twice\n\nThis avoid generating the mesages twice, getting different IDs in the AST and so on."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0aad9ac7f69f40855378a6b316726ccab20cebc8", "author": {"user": {"login": "vincent-psarga", "name": "Vincent"}}, "url": "https://github.com/cucumber/common/commit/0aad9ac7f69f40855378a6b316726ccab20cebc8", "committedDate": "2020-01-07T16:44:48Z", "message": "Add GherkinQuery object to query location of AST objects based on IDs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5eeb702457dc5d33e4b087c5247710b63d893ef3", "author": {"user": {"login": "vincent-psarga", "name": "Vincent"}}, "url": "https://github.com/cucumber/common/commit/5eeb702457dc5d33e4b087c5247710b63d893ef3", "committedDate": "2020-01-08T08:59:28Z", "message": "Retro-compatibility fix for older Rubys"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzM5NzQ2NTEz", "url": "https://github.com/cucumber/common/pull/845#pullrequestreview-339746513", "createdAt": "2020-01-08T09:44:15Z", "commit": {"oid": "5eeb702457dc5d33e4b087c5247710b63d893ef3"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOFQwOTo0NDoxNVrOFbRdfQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOFQwOTo0NDoxOVrOFbRdmA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDE0MTk0OQ==", "bodyText": "are these methods \"synched up\" across all implementations. If they are that's cool. If not traditionally we would drop get_ and set_ prefixes in methods.", "url": "https://github.com/cucumber/common/pull/845#discussion_r364141949", "createdAt": "2020-01-08T09:44:15Z", "author": {"login": "luke-hill"}, "path": "gherkin/ruby/lib/gherkin/gherkin_query.rb", "diffHunk": "@@ -0,0 +1,54 @@\n+module Gherkin\n+  class Query\n+    def initialize\n+      @ast_node_locations = {}\n+    end\n+\n+    def update(message)\n+      update_feature(message.gherkin_document.feature) if message.gherkin_document\n+    end\n+\n+    def get_location(ast_node_id)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5eeb702457dc5d33e4b087c5247710b63d893ef3"}, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDE0MTk3Ng==", "bodyText": "traditionally errors in ruby all end in error (I'm aware that there are existing ones here that don't), so it's not a biggie if you don't fix", "url": "https://github.com/cucumber/common/pull/845#discussion_r364141976", "createdAt": "2020-01-08T09:44:19Z", "author": {"login": "luke-hill"}, "path": "gherkin/ruby/lib/gherkin/errors.rb", "diffHunk": "@@ -1,5 +1,7 @@\n module Gherkin\n   class ParserError < StandardError; end\n+  class AstNodeNotLocatedException < Exception; end", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5eeb702457dc5d33e4b087c5247710b63d893ef3"}, "originalPosition": 3}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzM5Nzc5ODI3", "url": "https://github.com/cucumber/common/pull/845#pullrequestreview-339779827", "createdAt": "2020-01-08T10:41:10Z", "commit": {"oid": "5eeb702457dc5d33e4b087c5247710b63d893ef3"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOFQxMDo0MToxMFrOFbTA9g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOFQxMDo0MjoxM1rOFbTCog==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDE2NzQxNA==", "bodyText": "Custom exceptions should extend from StandardError. Never extend Exception.", "url": "https://github.com/cucumber/common/pull/845#discussion_r364167414", "createdAt": "2020-01-08T10:41:10Z", "author": {"login": "aslakhellesoy"}, "path": "gherkin/ruby/lib/gherkin/errors.rb", "diffHunk": "@@ -1,5 +1,7 @@\n module Gherkin\n   class ParserError < StandardError; end\n+  class AstNodeNotLocatedException < Exception; end", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDE0MTk3Ng=="}, "originalCommit": {"oid": "5eeb702457dc5d33e4b087c5247710b63d893ef3"}, "originalPosition": 3}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDE2Nzg0Mg==", "bodyText": "We aim to have a consistent API between implementations, but I still think we should be idiomatic. Please change to location.", "url": "https://github.com/cucumber/common/pull/845#discussion_r364167842", "createdAt": "2020-01-08T10:42:13Z", "author": {"login": "aslakhellesoy"}, "path": "gherkin/ruby/lib/gherkin/gherkin_query.rb", "diffHunk": "@@ -0,0 +1,54 @@\n+module Gherkin\n+  class Query\n+    def initialize\n+      @ast_node_locations = {}\n+    end\n+\n+    def update(message)\n+      update_feature(message.gherkin_document.feature) if message.gherkin_document\n+    end\n+\n+    def get_location(ast_node_id)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDE0MTk0OQ=="}, "originalCommit": {"oid": "5eeb702457dc5d33e4b087c5247710b63d893ef3"}, "originalPosition": 11}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzM5ODAyNDU1", "url": "https://github.com/cucumber/common/pull/845#pullrequestreview-339802455", "createdAt": "2020-01-08T11:26:18Z", "commit": {"oid": "5eeb702457dc5d33e4b087c5247710b63d893ef3"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOFQxMToyNjoxOFrOFbUElQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOFQxMToyNjoxOFrOFbUElQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDE4NDcyNQ==", "bodyText": "Rename the file to query.rb", "url": "https://github.com/cucumber/common/pull/845#discussion_r364184725", "createdAt": "2020-01-08T11:26:18Z", "author": {"login": "aslakhellesoy"}, "path": "gherkin/ruby/lib/gherkin/gherkin_query.rb", "diffHunk": "@@ -0,0 +1,54 @@\n+module Gherkin\n+  class Query", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5eeb702457dc5d33e4b087c5247710b63d893ef3"}, "originalPosition": 2}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9d29216f7751231961909dc2c8d8427824e10b05", "author": {"user": {"login": "vincent-psarga", "name": "Vincent"}}, "url": "https://github.com/cucumber/common/commit/9d29216f7751231961909dc2c8d8427824e10b05", "committedDate": "2020-01-08T12:50:44Z", "message": "GherkinQuery: can get location of an examples row"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "aa5fa1c75f4b8eb53c10c686c3e47e56d2eb2251", "author": {"user": {"login": "vincent-psarga", "name": "Vincent"}}, "url": "https://github.com/cucumber/common/commit/aa5fa1c75f4b8eb53c10c686c3e47e56d2eb2251", "committedDate": "2020-01-08T12:53:31Z", "message": "Rename gherkin_query as query"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "455fe803f5473c8613b6830a7eb57b6b4bbc5525", "author": {"user": {"login": "vincent-psarga", "name": "Vincent"}}, "url": "https://github.com/cucumber/common/commit/455fe803f5473c8613b6830a7eb57b6b4bbc5525", "committedDate": "2020-01-08T12:54:52Z", "message": "Query.get_location is now Query.location"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bca74886b6775f5ed7cb7821973f460813a7b67c", "author": {"user": {"login": "vincent-psarga", "name": "Vincent"}}, "url": "https://github.com/cucumber/common/commit/bca74886b6775f5ed7cb7821973f460813a7b67c", "committedDate": "2020-01-08T12:55:34Z", "message": "AstNodeNotLocatedException now inherits from StandardError"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b451b1c19dc148cf0f0a5b7ad73d2890399af8f6", "author": {"user": {"login": "vincent-psarga", "name": "Vincent"}}, "url": "https://github.com/cucumber/common/commit/b451b1c19dc148cf0f0a5b7ad73d2890399af8f6", "committedDate": "2020-01-08T12:59:10Z", "message": "Update Changelog"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6830f503087ebdd1c16ed30cecd210a5eb18aca6", "author": {"user": {"login": "vincent-psarga", "name": "Vincent"}}, "url": "https://github.com/cucumber/common/commit/6830f503087ebdd1c16ed30cecd210a5eb18aca6", "committedDate": "2020-01-08T13:46:39Z", "message": "Add #argument_location to find location of a step argument"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQwNDIwNzU2", "url": "https://github.com/cucumber/common/pull/845#pullrequestreview-340420756", "createdAt": "2020-01-09T10:25:41Z", "commit": {"oid": "6830f503087ebdd1c16ed30cecd210a5eb18aca6"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3056, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}