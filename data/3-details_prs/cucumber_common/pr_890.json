{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzcxOTk3Mjcx", "number": 890, "title": "UndefinedParameterType message", "bodyText": "Summary\nAvoid exceptions when step definitions are defined referencing undefined parameter types.\nDetails\nIf ExpressionFactory attempts to instantiate a CucumberExpression and that fails because the expression string references an undefined parameter type, instantiate an UndefinedParameterTypeExpression instead.\nThis is a null-object, which matches no strings. It can be used in step definitions, but those step definitions will never execute, because the expression matches nothing.\nMotivation and Context\nInstantiating a CucumberExpression with a string referencing an undefined parameter type throws an exception. This causes Cucumber to abort without running anything.\nWe don't want a single bad step definition to throw everything off.\nWe'll also need a new mechanism to notify that their expression is bad (or that they need to define a parameter type), but that is beyond the scope of this PR.\nOne way to prepare for that is to add a #getUndefinedParameterTypeNames() => Set<String> method to Expression. We can collect all of these and put them in Cucumber Messages somewhere - immediately or at the end of a run.\nHow Has This Been Tested?\nUnit tests\nTypes of changes\n\n\n Bug fix (non-breaking change which fixes an issue).\n New feature (non-breaking change which adds functionality).\n Breaking change (fix or feature that would cause existing functionality to not work as expected).\n\nChecklist:\n\n\n\n The change has been ported to Java.\n The change has been ported to Ruby.\n The change has been ported to JavaScript.\n The change has been ported to Go.\n The change has been ported to .NET.\n I've added tests for my code.\n My change requires a change to the documentation.\n I have updated the documentation accordingly.\n I have updated the CHANGELOG accordingly.", "createdAt": "2020-02-06T16:35:53Z", "url": "https://github.com/cucumber/common/pull/890", "merged": true, "mergeCommit": {"oid": "250a29820166c1a8654bf525c6a0eeb468cb67a5"}, "closed": true, "closedAt": "2020-02-12T18:37:46Z", "author": {"login": "aslakhellesoy"}, "timelineItems": {"totalCount": 18, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcBs9xXAH2gAyMzcxOTk3MjcxOmQyYjY5MTJkMThjM2QzMTZmMzI2MzMzODI4NzBjNTVkZjI2NjZlZmE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcDppXsgH2gAyMzcxOTk3MjcxOjRiYWY2MmRmODdmNWM5NDZlYmVjYzkxZjM0YTQxMWY2MTAxZGUxYWI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "d2b6912d18c3d316f32633382870c55df2666efa", "author": {"user": {"login": "aslakhellesoy", "name": "Aslak Helles\u00f8y"}}, "url": "https://github.com/cucumber/common/commit/d2b6912d18c3d316f32633382870c55df2666efa", "committedDate": "2020-02-06T16:03:18Z", "message": "Add UndefinedParameterTypeExpression.ts and ExpressionFactory.ts"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7c4b93f157b4e381a2136a4b01fe9d0ee1318b78", "author": {"user": {"login": "aslakhellesoy", "name": "Aslak Helles\u00f8y"}}, "url": "https://github.com/cucumber/common/commit/7c4b93f157b4e381a2136a4b01fe9d0ee1318b78", "committedDate": "2020-02-06T16:25:17Z", "message": "Return UndefinedParameterTypeExpression when a parameter type is undefined."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "31e2a659057178e60046a6c7714f06c812e32db2", "author": {"user": {"login": "aslakhellesoy", "name": "Aslak Helles\u00f8y"}}, "url": "https://github.com/cucumber/common/commit/31e2a659057178e60046a6c7714f06c812e32db2", "committedDate": "2020-02-06T16:38:07Z", "message": "Update Changelog"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU0NjA2NjQy", "url": "https://github.com/cucumber/common/pull/890#pullrequestreview-354606642", "createdAt": "2020-02-06T16:48:00Z", "commit": {"oid": "31e2a659057178e60046a6c7714f06c812e32db2"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNlQxNjo0ODowMFrOFmiY0A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNlQxNjo0ODowMFrOFmiY0A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTk1MzYxNg==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            public class UndefinedParameterTypeExpression implements Expression {\n          \n          \n            \n            final class UndefinedParameterTypeExpression implements Expression {", "url": "https://github.com/cucumber/common/pull/890#discussion_r375953616", "createdAt": "2020-02-06T16:48:00Z", "author": {"login": "mpkorstanje"}, "path": "cucumber-expressions/java/src/main/java/io/cucumber/cucumberexpressions/UndefinedParameterTypeExpression.java", "diffHunk": "@@ -0,0 +1,28 @@\n+package io.cucumber.cucumberexpressions;\n+\n+import java.lang.reflect.Type;\n+import java.util.List;\n+import java.util.regex.Pattern;\n+\n+public class UndefinedParameterTypeExpression implements Expression {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "31e2a659057178e60046a6c7714f06c812e32db2"}, "originalPosition": 7}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU0NjExMjA4", "url": "https://github.com/cucumber/common/pull/890#pullrequestreview-354611208", "createdAt": "2020-02-06T16:53:49Z", "commit": {"oid": "31e2a659057178e60046a6c7714f06c812e32db2"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNlQxNjo1Mzo0OVrOFmimdg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNlQxNjo1Mzo0OVrOFmimdg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTk1NzExMA==", "bodyText": "We're using exceptions for control flow. Might be worth extracting some of the code in the CucumberExpression to the factory instead of throwing the exception and then catching it.", "url": "https://github.com/cucumber/common/pull/890#discussion_r375957110", "createdAt": "2020-02-06T16:53:49Z", "author": {"login": "mpkorstanje"}, "path": "cucumber-expressions/java/src/main/java/io/cucumber/cucumberexpressions/ExpressionFactory.java", "diffHunk": "@@ -31,7 +31,15 @@ public Expression createExpression(String expressionString) {\n         if (m.find()) {\n             return new RegularExpression(Pattern.compile(m.group(1)), parameterTypeRegistry);\n         }\n-        return new CucumberExpression(expressionString, parameterTypeRegistry);\n+        return createCucumberExpression(expressionString);\n+    }\n+\n+    private Expression createCucumberExpression(String expressionString) {\n+        try {\n+            return new CucumberExpression(expressionString, parameterTypeRegistry);\n+        } catch (UndefinedParameterTypeException e) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "31e2a659057178e60046a6c7714f06c812e32db2"}, "originalPosition": 11}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "391d5794b171c318119b94ec89cc5bb0b25800f9", "author": {"user": {"login": "aslakhellesoy", "name": "Aslak Helles\u00f8y"}}, "url": "https://github.com/cucumber/common/commit/391d5794b171c318119b94ec89cc5bb0b25800f9", "committedDate": "2020-02-06T17:00:57Z", "message": "Add UndefinedParameterTypeExpression.rb and ExpressionFactory.rb"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a8ad34f56e4f6a0b6749802e6ca8577bf859c4f0", "author": {"user": {"login": "aslakhellesoy", "name": "Aslak Helles\u00f8y"}}, "url": "https://github.com/cucumber/common/commit/a8ad34f56e4f6a0b6749802e6ca8577bf859c4f0", "committedDate": "2020-02-06T17:05:25Z", "message": "CucumberExpression and RegularExpression are no longer part of the public API."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "68579571ccd0bb90e6403b486b29253994200963", "author": {"user": {"login": "aslakhellesoy", "name": "Aslak Helles\u00f8y"}}, "url": "https://github.com/cucumber/common/commit/68579571ccd0bb90e6403b486b29253994200963", "committedDate": "2020-02-06T17:34:37Z", "message": "NewCucumberExpression returns an UndefinedParameterTypeExpression for undefined parameter types"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6862884b90f18b404f24ef0d3e1bc2d357a4511c", "author": {"user": {"login": "aslakhellesoy", "name": "Aslak Helles\u00f8y"}}, "url": "https://github.com/cucumber/common/commit/6862884b90f18b404f24ef0d3e1bc2d357a4511c", "committedDate": "2020-02-06T17:37:28Z", "message": "Update changelog"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "80c2f22b8e36aa9e50703cb8bf0cd106cf480f4f", "author": {"user": {"login": "aslakhellesoy", "name": "Aslak Helles\u00f8y"}}, "url": "https://github.com/cucumber/common/commit/80c2f22b8e36aa9e50703cb8bf0cd106cf480f4f", "committedDate": "2020-02-06T17:47:10Z", "message": "Remove CucumberExpression and RegularExpression from public JavaScript API"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "005615fde5c7824a5cbf7862c5ba8355507b2db0", "author": {"user": {"login": "aslakhellesoy", "name": "Aslak Helles\u00f8y"}}, "url": "https://github.com/cucumber/common/commit/005615fde5c7824a5cbf7862c5ba8355507b2db0", "committedDate": "2020-02-06T18:17:51Z", "message": "Add getUndefinedParameterTypeNames"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c058193ec0548accf50b97048df061fb81ed11eb", "author": {"user": {"login": "aslakhellesoy", "name": "Aslak Helles\u00f8y"}}, "url": "https://github.com/cucumber/common/commit/c058193ec0548accf50b97048df061fb81ed11eb", "committedDate": "2020-02-11T14:12:46Z", "message": "Revert adding of UndefinedParameterTypeExpression"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "36f0fccd192927d8aaa2f58b2d08167180a61c67", "author": {"user": {"login": "aslakhellesoy", "name": "Aslak Helles\u00f8y"}}, "url": "https://github.com/cucumber/common/commit/36f0fccd192927d8aaa2f58b2d08167180a61c67", "committedDate": "2020-02-11T14:13:06Z", "message": "Merge remote-tracking branch 'origin/master' into undefined-parameter-type-expression"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8d7a73b4d305360d90cf7a7f459deb78a8d59720", "author": {"user": {"login": "aslakhellesoy", "name": "Aslak Helles\u00f8y"}}, "url": "https://github.com/cucumber/common/commit/8d7a73b4d305360d90cf7a7f459deb78a8d59720", "committedDate": "2020-02-11T14:27:09Z", "message": "Update changelog"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b5c0c7b763ebc1e9940cdb019a5b75a2ebd4c78d", "author": {"user": {"login": "aslakhellesoy", "name": "Aslak Helles\u00f8y"}}, "url": "https://github.com/cucumber/common/commit/b5c0c7b763ebc1e9940cdb019a5b75a2ebd4c78d", "committedDate": "2020-02-11T15:44:19Z", "message": "Update cucumber-react"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU3MDI4MzU3", "url": "https://github.com/cucumber/common/pull/890#pullrequestreview-357028357", "createdAt": "2020-02-11T22:00:02Z", "commit": {"oid": "b5c0c7b763ebc1e9940cdb019a5b75a2ebd4c78d"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMVQyMjowMDowMlrOFoavWQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMVQyMjowMDowMlrOFoavWQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzkyNTQ2NQ==", "bodyText": "Implementation wise I would suggest adding a result object to the TestRunFinished event with the undefined parameter type exception rather then adding it here. That way consumers of the ndjson can easily see why the test run failed. Comparable to TestCaseFinished.", "url": "https://github.com/cucumber/common/pull/890#discussion_r377925465", "createdAt": "2020-02-11T22:00:02Z", "author": {"login": "mpkorstanje"}, "path": "messages/dotnet/messages.proto", "diffHunk": "@@ -68,6 +68,7 @@ message Envelope {\n     StepDefinition step_definition = 25;\n     Hook hook = 26;\n     ParameterType parameter_type = 27;\n+    UndefinedParameterType undefined_parameter_type = 28;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b5c0c7b763ebc1e9940cdb019a5b75a2ebd4c78d"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU3MjUwMDg2", "url": "https://github.com/cucumber/common/pull/890#pullrequestreview-357250086", "createdAt": "2020-02-12T08:05:27Z", "commit": {"oid": "b5c0c7b763ebc1e9940cdb019a5b75a2ebd4c78d"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMlQwODowNToyN1rOFokz3Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMlQwODowNToyN1rOFokz3Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODA5MDQ2MQ==", "bodyText": "I know we have the {x} test in rspec for ruby, but do these tests need copying elsewhere, or does the CCK function like the golden tests?", "url": "https://github.com/cucumber/common/pull/890#discussion_r378090461", "createdAt": "2020-02-12T08:05:27Z", "author": {"login": "luke-hill"}, "path": "compatibility-kit/javascript/features/parameter-types/parameter-types.ts", "diffHunk": "@@ -21,3 +21,8 @@ Given('{flight} has been delayed {int} minutes', function(\n   assert.equal(flight.to, 'CDG')\n   assert.equal(delay, 45)\n })\n+\n+// eslint-disable-next-line @typescript-eslint/no-unused-vars\n+Given('{airport} is closed because of a strike', function(airport) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b5c0c7b763ebc1e9940cdb019a5b75a2ebd4c78d"}, "originalPosition": 6}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4baf62df87f5c946ebecc91f34a411f6101de1ab", "author": {"user": {"login": "aslakhellesoy", "name": "Aslak Helles\u00f8y"}}, "url": "https://github.com/cucumber/common/commit/4baf62df87f5c946ebecc91f34a411f6101de1ab", "committedDate": "2020-02-12T17:19:09Z", "message": "Rename TestResult to TestStepResult"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3067, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}