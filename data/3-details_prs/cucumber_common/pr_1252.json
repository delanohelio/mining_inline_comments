{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTIzOTMwNDM4", "number": 1252, "title": "include offending line in error message", "bodyText": "When the NDJSON stream contains lines that are not valid JSON, we want the error to include the line to make it easier to diagnose the problem.", "createdAt": "2020-11-19T12:53:01Z", "url": "https://github.com/cucumber/common/pull/1252", "merged": true, "mergeCommit": {"oid": "dc5bd422614c323da84d6f3898a6524e0156fc19"}, "closed": true, "closedAt": "2020-11-19T14:01:33Z", "author": {"login": "aslakhellesoy"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdeCO9ngH2gAyNTIzOTMwNDM4OmQ0YjMyMjE1MTNiMzhkMTNiNTYzMTE5NzM1NWNhOWRkMjI4NWRhODE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdeDO9UgH2gAyNTIzOTMwNDM4OjEwNGRjOTEzZTEwZmI3NTA3YjNmMmMyYzViMDc2NzcxNDZkZTZiZTg=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "d4b3221513b38d13b5631197355ca9dd2285da81", "author": {"user": {"login": "aslakhellesoy", "name": "Aslak Helles\u00f8y"}}, "url": "https://github.com/cucumber/common/commit/d4b3221513b38d13b5631197355ca9dd2285da81", "committedDate": "2020-11-19T12:51:07Z", "message": "include offending line in error message"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "47c65c0880a0758562e16e252137f36fd2735edc", "author": {"user": {"login": "aslakhellesoy", "name": "Aslak Helles\u00f8y"}}, "url": "https://github.com/cucumber/common/commit/47c65c0880a0758562e16e252137f36fd2735edc", "committedDate": "2020-11-19T13:27:34Z", "message": "Fix JavaScript impl"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM0NDQ3NzI2", "url": "https://github.com/cucumber/common/pull/1252#pullrequestreview-534447726", "createdAt": "2020-11-19T13:33:02Z", "commit": {"oid": "47c65c0880a0758562e16e252137f36fd2735edc"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQxMzozMzowM1rOH2eiXQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQxMzozMzowM1rOH2eiXQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjg4NTQ2OQ==", "bodyText": "Perhaps also include the original error and stack trace? That way we know what the parser was complaining about.", "url": "https://github.com/cucumber/common/pull/1252#discussion_r526885469", "createdAt": "2020-11-19T13:33:03Z", "author": {"login": "mpkorstanje"}, "path": "messages/javascript/src/NdjsonToMessageStream.ts", "diffHunk": "@@ -43,7 +43,7 @@ export default class NdjsonToMessageStream<T> extends Transform {\n         const object = JSON.parse(this.buffer)\n         this.push(this.fromObject(object))\n       } catch (err) {\n-        return callback(err)\n+        return callback(new Error(`Not JSONs: ${this.buffer}`))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "47c65c0880a0758562e16e252137f36fd2735edc"}, "originalPosition": 14}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ef84fd895f200e5bedd5a1ae4d150b97eaa86326", "author": {"user": {"login": "aslakhellesoy", "name": "Aslak Helles\u00f8y"}}, "url": "https://github.com/cucumber/common/commit/ef84fd895f200e5bedd5a1ae4d150b97eaa86326", "committedDate": "2020-11-19T13:55:05Z", "message": "Merge branch 'master' into messages-include-line-in-error"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM0NDY4Njg0", "url": "https://github.com/cucumber/common/pull/1252#pullrequestreview-534468684", "createdAt": "2020-11-19T13:56:37Z", "commit": {"oid": "ef84fd895f200e5bedd5a1ae4d150b97eaa86326"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQxMzo1NjozN1rOH2fxTA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQxMzo1NjozN1rOH2fxTA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjkwNTY3Ng==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                                    throw new RuntimeException(String.format(\"Not JSON: %s\", line));\n          \n          \n            \n                                    throw new RuntimeException(String.format(\"Not JSON: %s\", line), e);", "url": "https://github.com/cucumber/common/pull/1252#discussion_r526905676", "createdAt": "2020-11-19T13:56:37Z", "author": {"login": "mpkorstanje"}, "path": "messages/java/src/main/java/io/cucumber/messages/NdjsonToMessageIterable.java", "diffHunk": "@@ -37,7 +38,11 @@ public boolean hasNext() {\n                         return hasNext();\n                     }\n                     Messages.Envelope.Builder builder = Messages.Envelope.newBuilder();\n-                    JSON_PARSER.merge(line, builder);\n+                    try {\n+                        JSON_PARSER.merge(line, builder);\n+                    } catch(InvalidProtocolBufferException e) {\n+                        throw new RuntimeException(String.format(\"Not JSON: %s\", line));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ef84fd895f200e5bedd5a1ae4d150b97eaa86326"}, "originalPosition": 15}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "104dc913e10fb7507b3f2c2c5b07677146de6be8", "author": {"user": {"login": "aslakhellesoy", "name": "Aslak Helles\u00f8y"}}, "url": "https://github.com/cucumber/common/commit/104dc913e10fb7507b3f2c2c5b07677146de6be8", "committedDate": "2020-11-19T14:01:01Z", "message": "Update messages/java/src/main/java/io/cucumber/messages/NdjsonToMessageIterable.java\n\nCo-authored-by: M.P. Korstanje <mpkorstanje@users.noreply.github.com>"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2995, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}