{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM3MTAwMTgx", "number": 2820, "title": "Add `@ServiceName` annotation for annotated service", "bodyText": "Motivation:\nRequestLog.serviceName() is introduced in #2780\nTo override the service name in an annotated service, @ServiceName annotation would be useful.\nSee #2809\nModifications:\n\nAdd @ServiceName annotation for an annotated service class and method.\n\nmethod annotation has a higher priority than class annotation.\n\n\nUpdate documentation\n\nResult:\nYou can now override the default service with @ServiceName annotation in the annotated services.\nFixes #2809", "createdAt": "2020-06-19T13:24:18Z", "url": "https://github.com/line/armeria/pull/2820", "merged": true, "mergeCommit": {"oid": "2259bf06019bc37b71662def60a60c01449aab11"}, "closed": true, "closedAt": "2020-06-22T06:56:44Z", "author": {"login": "ikhoon"}, "timelineItems": {"totalCount": 15, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcsy_7nAH2gAyNDM3MTAwMTgxOjE3M2RlMzMwMWIzNjk0YTMxNTNlN2MwZGVkMjhiYjc5MmM0ZmRjMmE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABctrOVdgFqTQzNDY0NjEwMw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "173de3301b3694a3153e7c0ded28bb792c4fdc2a", "author": {"user": {"login": "ikhoon", "name": "Ikhun Um"}}, "url": "https://github.com/line/armeria/commit/173de3301b3694a3153e7c0ded28bb792c4fdc2a", "committedDate": "2020-06-19T13:23:50Z", "message": "Add `@ServiceName` annotation for annotated service\n\nMotivation:\n\n`RequestLog.serviceName()` is introduced in #2780\nTo override the service name in an annotated service, `@ServiceName` annotation would be useful.\nSee #2809\n\nModifications:\n\n- Add `@ServiceName` annotation for an annotated service class and method.\n  - method annotation has a higher priority than class annotation.\n- Update documentation\n\nResult:\n\nYou can now override the default service with `@ServiceName` annotation in annotated services."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3ec80c49425fc18db2d81178f220cacd59b64586", "author": {"user": {"login": "ikhoon", "name": "Ikhun Um"}}, "url": "https://github.com/line/armeria/commit/3ec80c49425fc18db2d81178f220cacd59b64586", "committedDate": "2020-06-19T13:30:34Z", "message": "Update Javadoc"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a54387ac29600d1a401093222f8fea5cd768f6a7", "author": {"user": {"login": "ikhoon", "name": "Ikhun Um"}}, "url": "https://github.com/line/armeria/commit/a54387ac29600d1a401093222f8fea5cd768f6a7", "committedDate": "2020-06-19T13:27:27Z", "message": "Update Javadoc"}, "afterCommit": {"oid": "3ec80c49425fc18db2d81178f220cacd59b64586", "author": {"user": {"login": "ikhoon", "name": "Ikhun Um"}}, "url": "https://github.com/line/armeria/commit/3ec80c49425fc18db2d81178f220cacd59b64586", "committedDate": "2020-06-19T13:30:34Z", "message": "Update Javadoc"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "046e5b94c2dbc64502fac1dee1546f7d0932c5b9", "author": {"user": {"login": "ikhoon", "name": "Ikhun Um"}}, "url": "https://github.com/line/armeria/commit/046e5b94c2dbc64502fac1dee1546f7d0932c5b9", "committedDate": "2020-06-19T13:32:14Z", "message": "Clean up"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM0MDg5ODMw", "url": "https://github.com/line/armeria/pull/2820#pullrequestreview-434089830", "createdAt": "2020-06-19T13:46:05Z", "commit": {"oid": "046e5b94c2dbc64502fac1dee1546f7d0932c5b9"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOVQxMzo0NjowNlrOGmVadw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOVQxMzo0ODoxMVrOGmVe1g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Mjg0OTkxMQ==", "bodyText": ".equals()?\nHow about using ensureAvailability(RequestLogProperty.NAME).serviceName()?", "url": "https://github.com/line/armeria/pull/2820#discussion_r442849911", "createdAt": "2020-06-19T13:46:06Z", "author": {"login": "trustin"}, "path": "core/src/main/java/com/linecorp/armeria/server/annotation/ServiceName.java", "diffHunk": "@@ -0,0 +1,61 @@\n+/*\n+ * Copyright 2020 LINE Corporation\n+ *\n+ * LINE Corporation licenses this file to you under the Apache License,\n+ * version 2.0 (the \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at:\n+ *\n+ *   https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+ * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n+ * License for the specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package com.linecorp.armeria.server.annotation;\n+\n+import java.lang.annotation.ElementType;\n+import java.lang.annotation.Retention;\n+import java.lang.annotation.RetentionPolicy;\n+import java.lang.annotation.Target;\n+\n+/**\n+ * Annotation for service name that is often used as a meter tag or distributed trace's span name.\n+ * You can override the default service name by annotating a class or method with {@link ServiceName}.\n+ * For example:<pre>{@code\n+ * > public class MyService {\n+ * >     @Get(\"/\")\n+ * >     public String get(ServiceRequestContext ctx) {\n+ * >         // The default service name\n+ * >         assert ctx.log().partial().serviceName() == MyService.class.getName();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "046e5b94c2dbc64502fac1dee1546f7d0932c5b9"}, "originalPosition": 32}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Mjg1MDYxMQ==", "bodyText": "?\nCould you check if the above example (assert ctx.log().partial().serviceName() == \"my-service\";) really works here? If not, please update them to use whenComplete().thenApply() which is the recommended way.", "url": "https://github.com/line/armeria/pull/2820#discussion_r442850611", "createdAt": "2020-06-19T13:47:23Z", "author": {"login": "trustin"}, "path": "core/src/test/java/com/linecorp/armeria/internal/server/annotation/AnnotatedServiceRequestLogNameTest.java", "diffHunk": "@@ -82,4 +75,56 @@ void logNameShouldBeSetOnEarlyFailure() throws Exception {\n         assertThat(log.name()).isEqualTo(\"bar\");\n         assertThat(log.responseHeaders().status()).isEqualTo(HttpStatus.INTERNAL_SERVER_ERROR);\n     }\n+\n+    @Test\n+    void defaultServiceName() throws Exception {\n+        WebClient.of(server.httpUri()).get(\"/ok\").aggregate().join();\n+\n+        final RequestLog log = logs.take().whenComplete().join();\n+        assertThat(log.serviceName()).isEqualTo(FooService.class.getName());\n+    }\n+\n+    @Test\n+    void customServiceNameWithClass() throws Exception {\n+        WebClient.of(server.httpUri()).get(\"/serviceName/foo\").aggregate().join();\n+\n+        final RequestLog log = logs.take().whenComplete().join();\n+        assertThat(log.serviceName()).isEqualTo(\"MyBarService\");\n+    }\n+\n+    @Test\n+    void customServiceNameWithMethod() throws Exception {\n+        WebClient.of(server.httpUri()).get(\"/serviceName/bar\").aggregate().join();\n+\n+        final RequestLog log = logs.take().whenComplete().join();\n+        assertThat(log.serviceName()).isEqualTo(\"SecuredBarService\");\n+    }\n+\n+    private static class FooService {\n+        @Get(\"/ok\")\n+        public String foo() {\n+            return \"OK\";\n+        }\n+\n+        @Get(\"/fail_early\")\n+        public String bar() {\n+            return \"Not OK\";\n+        }\n+    }\n+\n+    @ServiceName(\"MyBarService\")\n+    private static class BarService {\n+        @Get(\"/foo\")\n+        public String foo() {\n+            return \"OK\";\n+        }\n+\n+        @ServiceName(\"SecuredBarService\")\n+        @Get(\"/bar\")\n+        public String secured(ServiceRequestContext ctx) {\n+            ctx.log();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "046e5b94c2dbc64502fac1dee1546f7d0932c5b9"}, "originalPosition": 81}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Mjg1MTAzMA==", "bodyText": "armeria.dev/docs/...", "url": "https://github.com/line/armeria/pull/2820#discussion_r442851030", "createdAt": "2020-06-19T13:48:11Z", "author": {"login": "trustin"}, "path": "site/src/pages/docs/server-annotated-service.mdx", "diffHunk": "@@ -1373,5 +1373,41 @@ public class MyAnnotatedService {\n     public HttpResponse update() { ... }\n }\n ```\n+\n+## Specifying the default service name\n+\n+The default name of service that served a request is the innermost class name of an annotated service.\n+The service name is often used as a meter tag or distributed trace's span name.\n+If you want to customize the default service name, then you can override the name by annotating\n+a class or method with <type://@ServiceName>.\n+\n+For example:\n+\n+```java\n+public class MyService {\n+    @Get(\"/\")\n+    public String get(ServiceRequestContext ctx) {\n+        assert ctx.log().partial().serviceName() == MyService.class.getName();\n+    }\n+}\n+\n+@ServiceName(\"my-service\")\n+public class MyService {\n+    @Get(\"/\")\n+    public String get(ServiceRequestContext ctx) {\n+        assert ctx.log().partial().serviceName() == \"my-service\";\n+    }\n+\n+    @ServiceName(\"my-post-service\")\n+    @Post(\"/\")\n+    public String post(ServiceRequestContext ctx) {\n+        assert ctx.log().partial().serviceName() == \"my-post-service\";\n+    }\n+}\n+```\n+\n+Please refer to\n+[Request properties](https://line.github.io/armeria/docs/advanced-structured-logging#request-properties)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "046e5b94c2dbc64502fac1dee1546f7d0932c5b9"}, "originalPosition": 38}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ec7b269b0ceaa54558c9f8212d6ba9d1a262ea63", "author": {"user": {"login": "ikhoon", "name": "Ikhun Um"}}, "url": "https://github.com/line/armeria/commit/ec7b269b0ceaa54558c9f8212d6ba9d1a262ea63", "committedDate": "2020-06-19T15:16:14Z", "message": "Update documetation and add test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1aa2d5486e9fa12cbc423346ad2e83f743aa38fb", "author": {"user": {"login": "ikhoon", "name": "Ikhun Um"}}, "url": "https://github.com/line/armeria/commit/1aa2d5486e9fa12cbc423346ad2e83f743aa38fb", "committedDate": "2020-06-19T15:21:09Z", "message": "Add assertion"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8dd5f6edb65b0fa4b9f4d43ddaedde7bd9d5dfc9", "author": {"user": {"login": "ikhoon", "name": "Ikhun Um"}}, "url": "https://github.com/line/armeria/commit/8dd5f6edb65b0fa4b9f4d43ddaedde7bd9d5dfc9", "committedDate": "2020-06-19T15:25:22Z", "message": "Checkstyle"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4b1063eb3ca80bf5f9ceb8da69ec4f56ade59e42", "author": {"user": {"login": "ikhoon", "name": "Ikhun Um"}}, "url": "https://github.com/line/armeria/commit/4b1063eb3ca80bf5f9ceb8da69ec4f56ade59e42", "committedDate": "2020-06-19T15:27:46Z", "message": "Cleanup"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "28b7834ff9422f10fc9eef04abce5cbf740f4cfa", "author": {"user": {"login": "ikhoon", "name": "Ikhun Um"}}, "url": "https://github.com/line/armeria/commit/28b7834ff9422f10fc9eef04abce5cbf740f4cfa", "committedDate": "2020-06-19T16:13:12Z", "message": "Add availability-of-properties link"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM0MzY0NjQ2", "url": "https://github.com/line/armeria/pull/2820#pullrequestreview-434364646", "createdAt": "2020-06-19T22:19:05Z", "commit": {"oid": "28b7834ff9422f10fc9eef04abce5cbf740f4cfa"}, "state": "COMMENTED", "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOVQyMjoxOTowNlrOGmidBQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOVQyMjoyNjoyNlrOGmijZQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzA2MzU1Nw==", "bodyText": "Better using AnnotationUtil: https://github.com/line/armeria/blob/master/core/src/main/java/com/linecorp/armeria/internal/server/annotation/AnnotationUtil.java", "url": "https://github.com/line/armeria/pull/2820#discussion_r443063557", "createdAt": "2020-06-19T22:19:06Z", "author": {"login": "trustin"}, "path": "core/src/main/java/com/linecorp/armeria/internal/server/annotation/AnnotatedService.java", "diffHunk": "@@ -141,6 +143,16 @@\n             responseType = ResponseType.OTHER_OBJECTS;\n         }\n \n+        ServiceName serviceName = method.getAnnotation(ServiceName.class);\n+        if (serviceName == null) {\n+            serviceName = object.getClass().getAnnotation(ServiceName.class);\n+        }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "28b7834ff9422f10fc9eef04abce5cbf740f4cfa"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzA2MzY1OQ==", "bodyText": "How about breaking the line before .serviceName()?", "url": "https://github.com/line/armeria/pull/2820#discussion_r443063659", "createdAt": "2020-06-19T22:19:41Z", "author": {"login": "trustin"}, "path": "core/src/main/java/com/linecorp/armeria/server/annotation/ServiceName.java", "diffHunk": "@@ -0,0 +1,64 @@\n+/*\n+ * Copyright 2020 LINE Corporation\n+ *\n+ * LINE Corporation licenses this file to you under the Apache License,\n+ * version 2.0 (the \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at:\n+ *\n+ *   https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+ * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n+ * License for the specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package com.linecorp.armeria.server.annotation;\n+\n+import java.lang.annotation.ElementType;\n+import java.lang.annotation.Retention;\n+import java.lang.annotation.RetentionPolicy;\n+import java.lang.annotation.Target;\n+\n+/**\n+ * Annotation for service name that is often used as a meter tag or distributed trace's span name.\n+ * You can override the default service name by annotating a class or method with {@link ServiceName}.\n+ * For example:<pre>{@code\n+ * > public class MyService {\n+ * >     @Get(\"/\")\n+ * >     public String get(ServiceRequestContext ctx) {\n+ * >         // The default service name\n+ * >         assert ctx.log().ensureAvailable(RequestLogProperty.NAME).serviceName()\n+ * >                   .equals(MyService.class.getName());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "28b7834ff9422f10fc9eef04abce5cbf740f4cfa"}, "originalPosition": 33}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzA2NDM2MA==", "bodyText": "I think this is too much to be a tip. How about moving/merging it to advanced-structured-logging?", "url": "https://github.com/line/armeria/pull/2820#discussion_r443064360", "createdAt": "2020-06-19T22:22:48Z", "author": {"login": "trustin"}, "path": "site/src/pages/docs/server-annotated-service.mdx", "diffHunk": "@@ -1373,5 +1373,80 @@ public class MyAnnotatedService {\n     public HttpResponse update() { ... }\n }\n ```\n+\n+## Specifying the default service name\n+\n+The default name of an annotated service which served a request is the innermost class name.\n+The service name is often used as a meter tag or distributed trace's span name.\n+If you want to customize the default service name, then you can override the name by annotating\n+a class or method with <type://@ServiceName> like the below:\n+\n+```java\n+public class MyService {\n+    @Get(\"/\")\n+    public String get(ServiceRequestContext ctx) {\n+        assert ctx.log().ensureAvailable(RequestLogProperty.NAME).serviceName()\n+                  .equals(MyService.class.getName());\n+    }\n+}\n+\n+// Override the default service name by the class annotation\n+@ServiceName(\"my-service\")\n+public class MyService {\n+    @Get(\"/\")\n+    public String get(ServiceRequestContext ctx) {\n+        assert ctx.log().ensureAvailable(RequestLogProperty.NAME).serviceName()\n+                  .equals(\"my-service\");\n+    }\n+\n+    // Override the default service name by the method annotation\n+    @ServiceName(\"my-post-service\")\n+    @Post(\"/\")\n+    public String post(ServiceRequestContext ctx) {\n+        assert ctx.log().ensureAvailable(RequestLogProperty.NAME).serviceName()\n+                  .equals(\"my-post-service\");\n+    }\n+}\n+\n+// Or the default name could get overridden programmatically using a decorator.\n+ServerBuilder sb = Server.builder();\n+sb.annotatedService(\"/\", new MyService(), service -> {\n+    return service.decorate((delegate, ctx, req) -> {\n+        ctx.logBuilder().name(\"my-decorated-service\", ctx.method().name());\n+        return delegate.serve(ctx, req);\n+    });\n+});\n+```\n+\n+<Tip>\n+\n+Note that <type://RequestOnlyLog#name()> is safely accessed using\n+`ctx.log().ensureAvailable(RequestLogProperty.NAME)` only in your annotated service method.\n+Generally, it is recommended to use <type://RequestLogAccess#whenComplete()>.\n+Please see [Availability of properties](https://armeria.dev/docs/advanced-structured-logging#availability-of-properties)\n+before using it.\n+\n+If you access <type://RequestOnlyLog#name()> in a decorator or <type://HttpService>, you should use\n+<type://RequestLogAccess#whenComplete()> or <type://RequestLogAccess#whenAvailable(RequestLogProperty)>\n+with <type://RequestLogProperty#NAME>.\n+\n+```java\n+ServiceRequestContext ctx = ...\n+// Simply wait until a log is completed\n+ctx.log().whenComplete().thenApply(log -> {\n+    String serviceName = log.serviceName();\n+    ...\n+})\n+// If you are only interested in RequestOnlyLog.name()\n+ctx.log().whenAvailable(RequestLogProperty.NAME).thenApply(log -> {\n+    String serviceName = log.serviceName();\n+    ...\n+})\n+```\n+\n+</Tip>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "28b7834ff9422f10fc9eef04abce5cbf740f4cfa"}, "originalPosition": 75}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzA2NDYwNA==", "bodyText": "'the service name' may be enough.", "url": "https://github.com/line/armeria/pull/2820#discussion_r443064604", "createdAt": "2020-06-19T22:23:48Z", "author": {"login": "trustin"}, "path": "site/src/pages/docs/server-annotated-service.mdx", "diffHunk": "@@ -1373,5 +1373,80 @@ public class MyAnnotatedService {\n     public HttpResponse update() { ... }\n }\n ```\n+\n+## Specifying the default service name", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "28b7834ff9422f10fc9eef04abce5cbf740f4cfa"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzA2NTAyNQ==", "bodyText": "A service name is a human-readable string that is often used as a meter tag or distributed trace's span name. By default, an annotated service uses its class name as its service name. You can override it by annotating a client or method with ... like the following:", "url": "https://github.com/line/armeria/pull/2820#discussion_r443065025", "createdAt": "2020-06-19T22:25:37Z", "author": {"login": "trustin"}, "path": "site/src/pages/docs/server-annotated-service.mdx", "diffHunk": "@@ -1373,5 +1373,80 @@ public class MyAnnotatedService {\n     public HttpResponse update() { ... }\n }\n ```\n+\n+## Specifying the default service name\n+\n+The default name of an annotated service which served a request is the innermost class name.\n+The service name is often used as a meter tag or distributed trace's span name.\n+If you want to customize the default service name, then you can override the name by annotating\n+a class or method with <type://@ServiceName> like the below:", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "28b7834ff9422f10fc9eef04abce5cbf740f4cfa"}, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzA2NTE4OQ==", "bodyText": "You don't need to use the full URL. /docs/.... will be enough IIRC.", "url": "https://github.com/line/armeria/pull/2820#discussion_r443065189", "createdAt": "2020-06-19T22:26:26Z", "author": {"login": "trustin"}, "path": "site/src/pages/docs/server-annotated-service.mdx", "diffHunk": "@@ -1373,5 +1373,80 @@ public class MyAnnotatedService {\n     public HttpResponse update() { ... }\n }\n ```\n+\n+## Specifying the default service name\n+\n+The default name of an annotated service which served a request is the innermost class name.\n+The service name is often used as a meter tag or distributed trace's span name.\n+If you want to customize the default service name, then you can override the name by annotating\n+a class or method with <type://@ServiceName> like the below:\n+\n+```java\n+public class MyService {\n+    @Get(\"/\")\n+    public String get(ServiceRequestContext ctx) {\n+        assert ctx.log().ensureAvailable(RequestLogProperty.NAME).serviceName()\n+                  .equals(MyService.class.getName());\n+    }\n+}\n+\n+// Override the default service name by the class annotation\n+@ServiceName(\"my-service\")\n+public class MyService {\n+    @Get(\"/\")\n+    public String get(ServiceRequestContext ctx) {\n+        assert ctx.log().ensureAvailable(RequestLogProperty.NAME).serviceName()\n+                  .equals(\"my-service\");\n+    }\n+\n+    // Override the default service name by the method annotation\n+    @ServiceName(\"my-post-service\")\n+    @Post(\"/\")\n+    public String post(ServiceRequestContext ctx) {\n+        assert ctx.log().ensureAvailable(RequestLogProperty.NAME).serviceName()\n+                  .equals(\"my-post-service\");\n+    }\n+}\n+\n+// Or the default name could get overridden programmatically using a decorator.\n+ServerBuilder sb = Server.builder();\n+sb.annotatedService(\"/\", new MyService(), service -> {\n+    return service.decorate((delegate, ctx, req) -> {\n+        ctx.logBuilder().name(\"my-decorated-service\", ctx.method().name());\n+        return delegate.serve(ctx, req);\n+    });\n+});\n+```\n+\n+<Tip>\n+\n+Note that <type://RequestOnlyLog#name()> is safely accessed using\n+`ctx.log().ensureAvailable(RequestLogProperty.NAME)` only in your annotated service method.\n+Generally, it is recommended to use <type://RequestLogAccess#whenComplete()>.\n+Please see [Availability of properties](https://armeria.dev/docs/advanced-structured-logging#availability-of-properties)\n+before using it.\n+\n+If you access <type://RequestOnlyLog#name()> in a decorator or <type://HttpService>, you should use\n+<type://RequestLogAccess#whenComplete()> or <type://RequestLogAccess#whenAvailable(RequestLogProperty)>\n+with <type://RequestLogProperty#NAME>.\n+\n+```java\n+ServiceRequestContext ctx = ...\n+// Simply wait until a log is completed\n+ctx.log().whenComplete().thenApply(log -> {\n+    String serviceName = log.serviceName();\n+    ...\n+})\n+// If you are only interested in RequestOnlyLog.name()\n+ctx.log().whenAvailable(RequestLogProperty.NAME).thenApply(log -> {\n+    String serviceName = log.serviceName();\n+    ...\n+})\n+```\n+\n+</Tip>\n+\n+Please refer to [Request properties](https://armeria.dev/docs/advanced-structured-logging#request-properties)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "28b7834ff9422f10fc9eef04abce5cbf740f4cfa"}, "originalPosition": 77}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "357f125db2a2ab1e8062aa89f6fd2ae738abab37", "author": {"user": {"login": "ikhoon", "name": "Ikhun Um"}}, "url": "https://github.com/line/armeria/commit/357f125db2a2ab1e8062aa89f6fd2ae738abab37", "committedDate": "2020-06-20T03:13:24Z", "message": "Address comments by @trustin / Use AnnotationUtil and update doc"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d119fafbcad412da3f44c4d4a0e71f5bf3cdd793", "author": {"user": {"login": "ikhoon", "name": "Ikhun Um"}}, "url": "https://github.com/line/armeria/commit/d119fafbcad412da3f44c4d4a0e71f5bf3cdd793", "committedDate": "2020-06-20T03:24:44Z", "message": "Update Javadoc"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM0NTY2MTg5", "url": "https://github.com/line/armeria/pull/2820#pullrequestreview-434566189", "createdAt": "2020-06-22T02:15:54Z", "commit": {"oid": "d119fafbcad412da3f44c4d4a0e71f5bf3cdd793"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM0NjQ2MTAz", "url": "https://github.com/line/armeria/pull/2820#pullrequestreview-434646103", "createdAt": "2020-06-22T06:54:15Z", "commit": {"oid": "d119fafbcad412da3f44c4d4a0e71f5bf3cdd793"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 254, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}