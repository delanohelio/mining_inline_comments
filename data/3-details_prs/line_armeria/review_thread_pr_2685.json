{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDEyNDEzOTEw", "number": 2685, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNFQwODowMjo0MVrOD44yhg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNlQwMzowNToyN1rOD5pzKw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYwOTc3Mjg2OnYy", "diffSide": "RIGHT", "path": "grpc-protocol/src/main/java/com/linecorp/armeria/common/grpc/protocol/ArmeriaMessageDeframer.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNFQwODowMjo0MVrOGP2MKg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNFQwOTowOToxNFrOGP4O7A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTI2OTY3NA==", "bodyText": "Is this necessary?", "url": "https://github.com/line/armeria/pull/2685#discussion_r419269674", "createdAt": "2020-05-04T08:02:41Z", "author": {"login": "minwoox"}, "path": "grpc-protocol/src/main/java/com/linecorp/armeria/common/grpc/protocol/ArmeriaMessageDeframer.java", "diffHunk": "@@ -317,6 +317,7 @@ public void close() {\n                 unprocessed.forEach(ByteBuf::release);\n             } finally {\n                 unprocessed = null;\n+                closeWhenComplete = false;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b4e69db528762b06e9047b430a02eee902143967"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTI5ODI4MQ==", "bodyText": "Technically, we don't need it now. I added this line for integrity. It seems weird to me that both isClosed() and isClosing() return true. \ud83d\ude05", "url": "https://github.com/line/armeria/pull/2685#discussion_r419298281", "createdAt": "2020-05-04T08:59:21Z", "author": {"login": "ikhoon"}, "path": "grpc-protocol/src/main/java/com/linecorp/armeria/common/grpc/protocol/ArmeriaMessageDeframer.java", "diffHunk": "@@ -317,6 +317,7 @@ public void close() {\n                 unprocessed.forEach(ByteBuf::release);\n             } finally {\n                 unprocessed = null;\n+                closeWhenComplete = false;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTI2OTY3NA=="}, "originalCommit": {"oid": "b4e69db528762b06e9047b430a02eee902143967"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTMwMzE0OA==", "bodyText": "OK, SGTM.", "url": "https://github.com/line/armeria/pull/2685#discussion_r419303148", "createdAt": "2020-05-04T09:09:14Z", "author": {"login": "minwoox"}, "path": "grpc-protocol/src/main/java/com/linecorp/armeria/common/grpc/protocol/ArmeriaMessageDeframer.java", "diffHunk": "@@ -317,6 +317,7 @@ public void close() {\n                 unprocessed.forEach(ByteBuf::release);\n             } finally {\n                 unprocessed = null;\n+                closeWhenComplete = false;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTI2OTY3NA=="}, "originalCommit": {"oid": "b4e69db528762b06e9047b430a02eee902143967"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYwOTc3NjU3OnYy", "diffSide": "RIGHT", "path": "grpc/src/main/java/com/linecorp/armeria/internal/common/grpc/HttpStreamReader.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNFQwODowMzo1N1rOGP2OZA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNFQwODo1Mjo1NlrOGP3u7w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTI3MDI0NA==", "bodyText": "Can we handle this without using BiFunction?", "url": "https://github.com/line/armeria/pull/2685#discussion_r419270244", "createdAt": "2020-05-04T08:03:57Z", "author": {"login": "minwoox"}, "path": "grpc/src/main/java/com/linecorp/armeria/internal/common/grpc/HttpStreamReader.java", "diffHunk": "@@ -166,12 +166,12 @@ public void onNext(HttpObject obj) {\n \n     @Override\n     public void onError(Throwable cause) {\n-        // Handled by accept() below.\n+        // Handled by apply() below.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b4e69db528762b06e9047b430a02eee902143967"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTI5NDk1OQ==", "bodyText": "I've tried, but some tests failed. \ud83d\ude05\nLet me fix this another PR.", "url": "https://github.com/line/armeria/pull/2685#discussion_r419294959", "createdAt": "2020-05-04T08:52:56Z", "author": {"login": "ikhoon"}, "path": "grpc/src/main/java/com/linecorp/armeria/internal/common/grpc/HttpStreamReader.java", "diffHunk": "@@ -166,12 +166,12 @@ public void onNext(HttpObject obj) {\n \n     @Override\n     public void onError(Throwable cause) {\n-        // Handled by accept() below.\n+        // Handled by apply() below.", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTI3MDI0NA=="}, "originalCommit": {"oid": "b4e69db528762b06e9047b430a02eee902143967"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYxNzgwMjY3OnYy", "diffSide": "RIGHT", "path": "grpc-protocol/src/main/java/com/linecorp/armeria/common/grpc/protocol/ArmeriaMessageDeframer.java", "isResolved": true, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNlQwMzowNToyN1rOGRCmNg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNlQwNjowMTozN1rOGRFCKA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDUyMTUyNg==", "bodyText": "isClosing() in other API often implies that it will return true after it's closed. How about renaming it to something else? e.g. needsToCloseWhenComplete()?", "url": "https://github.com/line/armeria/pull/2685#discussion_r420521526", "createdAt": "2020-05-06T03:05:27Z", "author": {"login": "trustin"}, "path": "grpc-protocol/src/main/java/com/linecorp/armeria/common/grpc/protocol/ArmeriaMessageDeframer.java", "diffHunk": "@@ -325,6 +326,13 @@ public void close() {\n         }\n     }\n \n+    /**\n+     * Indicates whether or not this deframer is closing.\n+     */\n+    public boolean isClosing() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b4e69db528762b06e9047b430a02eee902143967"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDUyNDI1NA==", "bodyText": "I think in that case we can just change it to return true even when closed. @ikhoon intentionally made the behavior this way but it isn't required #2685 (comment) Don't think we need to make the name of the method longer", "url": "https://github.com/line/armeria/pull/2685#discussion_r420524254", "createdAt": "2020-05-06T03:18:54Z", "author": {"login": "anuraaga"}, "path": "grpc-protocol/src/main/java/com/linecorp/armeria/common/grpc/protocol/ArmeriaMessageDeframer.java", "diffHunk": "@@ -325,6 +326,13 @@ public void close() {\n         }\n     }\n \n+    /**\n+     * Indicates whether or not this deframer is closing.\n+     */\n+    public boolean isClosing() {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDUyMTUyNg=="}, "originalCommit": {"oid": "b4e69db528762b06e9047b430a02eee902143967"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDUyNTE5Mw==", "bodyText": "I didn't know that isClosing() returns true in our API. \ud83d\ude05\nLet me remove the line setting closeWhenComplete to false", "url": "https://github.com/line/armeria/pull/2685#discussion_r420525193", "createdAt": "2020-05-06T03:23:48Z", "author": {"login": "ikhoon"}, "path": "grpc-protocol/src/main/java/com/linecorp/armeria/common/grpc/protocol/ArmeriaMessageDeframer.java", "diffHunk": "@@ -325,6 +326,13 @@ public void close() {\n         }\n     }\n \n+    /**\n+     * Indicates whether or not this deframer is closing.\n+     */\n+    public boolean isClosing() {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDUyMTUyNg=="}, "originalCommit": {"oid": "b4e69db528762b06e9047b430a02eee902143967"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDU2MTQ0OA==", "bodyText": "SGTM", "url": "https://github.com/line/armeria/pull/2685#discussion_r420561448", "createdAt": "2020-05-06T06:01:37Z", "author": {"login": "trustin"}, "path": "grpc-protocol/src/main/java/com/linecorp/armeria/common/grpc/protocol/ArmeriaMessageDeframer.java", "diffHunk": "@@ -325,6 +326,13 @@ public void close() {\n         }\n     }\n \n+    /**\n+     * Indicates whether or not this deframer is closing.\n+     */\n+    public boolean isClosing() {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDUyMTUyNg=="}, "originalCommit": {"oid": "b4e69db528762b06e9047b430a02eee902143967"}, "originalPosition": 15}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2544, "cost": 1, "resetAt": "2021-11-12T20:44:06Z"}}}