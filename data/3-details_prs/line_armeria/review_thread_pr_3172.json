{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE5MTgzMzkw", "number": 3172, "reviewThreads": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNlQwOToxMzo1N1rOE5Vk4Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQwNzowNzoyOFrOE65ziw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI4NTU3NzkzOnYy", "diffSide": "RIGHT", "path": "core/src/main/java/com/linecorp/armeria/internal/common/util/SslContextUtil.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNlQwOToxMzo1N1rOHzut8A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNlQwOToxMzo1N1rOHzut8A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDAwNDg0OA==", "bodyText": "BAD_HTTP2_CIPHERS", "url": "https://github.com/line/armeria/pull/3172#discussion_r524004848", "createdAt": "2020-11-16T09:13:57Z", "author": {"login": "trustin"}, "path": "core/src/main/java/com/linecorp/armeria/internal/common/util/SslContextUtil.java", "diffHunk": "@@ -184,7 +187,8 @@ private static void validateHttp2Ciphers(Set<String> ciphers) {\n     }\n \n     // https://httpwg.org/specs/rfc7540.html#BadCipherSuites\n-    private static final Set<String> HTTP2_BLACKLISTED_CIPHERS =\n+    @VisibleForTesting\n+    static final Set<String> HTTP2_BLACKLISTED_CIPHERS =", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "47016ac9ed6fdd9fc679763014b5e02a1b3de4fc"}, "originalPosition": 25}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI4NTU4MjAzOnYy", "diffSide": "RIGHT", "path": "core/src/test/java/com/linecorp/armeria/internal/common/util/SslContextUtilTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNlQwOToxNDozMlrOHzuwXQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNlQwOToxNDozMlrOHzuwXQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDAwNTQ2OQ==", "bodyText": "getBadCipher()?", "url": "https://github.com/line/armeria/pull/3172#discussion_r524005469", "createdAt": "2020-11-16T09:14:32Z", "author": {"login": "trustin"}, "path": "core/src/test/java/com/linecorp/armeria/internal/common/util/SslContextUtilTest.java", "diffHunk": "@@ -48,4 +59,51 @@ void jdkSsl() {\n             assertThat(supportedProtocols).contains(\"TLSv1.2\");\n         }\n     }\n+\n+    @Test\n+    void unsafeTlsCiphers() {\n+        final String cipher = getBlackListedCipher();\n+        assumeThat(cipher).isNotNull();\n+\n+        assertThatThrownBy(() -> {\n+            final ClientFactory factory =\n+                    ClientFactory.builder()\n+                                 .tlsCustomizer(builder -> builder.ciphers(ImmutableList.of(cipher)))\n+                                 .build();\n+            factory.closeAsync();\n+        }).isInstanceOf(IllegalStateException.class)\n+          .hasMessageContaining(\"Attempting to configure a server or HTTP/2 client without\");\n+\n+        final ClientFactory factory =\n+                ClientFactory.builder()\n+                             .tlsAllowUnsafeCiphers(true)\n+                             .tlsCustomizer(builder -> builder.ciphers(ImmutableList.of(cipher)))\n+                             .build();\n+        factory.closeAsync();\n+    }\n+\n+    @Nullable\n+    private static String getBlackListedCipher() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "47016ac9ed6fdd9fc679763014b5e02a1b3de4fc"}, "originalPosition": 58}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI5MTIwNDAzOnYy", "diffSide": "RIGHT", "path": "core/src/main/java/com/linecorp/armeria/client/ClientFactoryBuilder.java", "isResolved": false, "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xN1QwNjo1NjoyNVrOH0mn9Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xN1QwNzoxMToyOFrOH0m9Yw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDkyMDgyMQ==", "bodyText": "Could you use disallowed instead of block?", "url": "https://github.com/line/armeria/pull/3172#discussion_r524920821", "createdAt": "2020-11-17T06:56:25Z", "author": {"login": "minwoox"}, "path": "core/src/main/java/com/linecorp/armeria/client/ClientFactoryBuilder.java", "diffHunk": "@@ -300,6 +300,20 @@ public ClientFactoryBuilder tlsCustomizer(Consumer<? super SslContextBuilder> tl\n         return this;\n     }\n \n+    /**\n+     * Sets whether to allow\n+     * <a href=\"https://tools.ietf.org/html/rfc7540#appendix-A\">TLS 1.2 Cipher Suite Block List</a>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "aa044b583bd59467d0e244ce99354cd9a0eed2f4"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDkyMTU0OQ==", "bodyText": "Sets whether to allow the bad cipher suites listed in <a href=\"...\">RFC7540</a>. ?", "url": "https://github.com/line/armeria/pull/3172#discussion_r524921549", "createdAt": "2020-11-17T06:58:28Z", "author": {"login": "trustin"}, "path": "core/src/main/java/com/linecorp/armeria/client/ClientFactoryBuilder.java", "diffHunk": "@@ -300,6 +300,20 @@ public ClientFactoryBuilder tlsCustomizer(Consumer<? super SslContextBuilder> tl\n         return this;\n     }\n \n+    /**\n+     * Sets whether to allow\n+     * <a href=\"https://tools.ietf.org/html/rfc7540#appendix-A\">TLS 1.2 Cipher Suite Block List</a>", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDkyMDgyMQ=="}, "originalCommit": {"oid": "aa044b583bd59467d0e244ce99354cd9a0eed2f4"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDkyNTIyMw==", "bodyText": "Ah that's better \ud83d\ude04", "url": "https://github.com/line/armeria/pull/3172#discussion_r524925223", "createdAt": "2020-11-17T07:08:34Z", "author": {"login": "minwoox"}, "path": "core/src/main/java/com/linecorp/armeria/client/ClientFactoryBuilder.java", "diffHunk": "@@ -300,6 +300,20 @@ public ClientFactoryBuilder tlsCustomizer(Consumer<? super SslContextBuilder> tl\n         return this;\n     }\n \n+    /**\n+     * Sets whether to allow\n+     * <a href=\"https://tools.ietf.org/html/rfc7540#appendix-A\">TLS 1.2 Cipher Suite Block List</a>", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDkyMDgyMQ=="}, "originalCommit": {"oid": "aa044b583bd59467d0e244ce99354cd9a0eed2f4"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDkyNjE4Mg==", "bodyText": "Maybe just Allows the bad cipher ...", "url": "https://github.com/line/armeria/pull/3172#discussion_r524926182", "createdAt": "2020-11-17T07:11:05Z", "author": {"login": "trustin"}, "path": "core/src/main/java/com/linecorp/armeria/client/ClientFactoryBuilder.java", "diffHunk": "@@ -300,6 +300,20 @@ public ClientFactoryBuilder tlsCustomizer(Consumer<? super SslContextBuilder> tl\n         return this;\n     }\n \n+    /**\n+     * Sets whether to allow\n+     * <a href=\"https://tools.ietf.org/html/rfc7540#appendix-A\">TLS 1.2 Cipher Suite Block List</a>", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDkyMDgyMQ=="}, "originalCommit": {"oid": "aa044b583bd59467d0e244ce99354cd9a0eed2f4"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDkyNjMwNw==", "bodyText": "(and some warning message if we didn't add one yet)", "url": "https://github.com/line/armeria/pull/3172#discussion_r524926307", "createdAt": "2020-11-17T07:11:28Z", "author": {"login": "trustin"}, "path": "core/src/main/java/com/linecorp/armeria/client/ClientFactoryBuilder.java", "diffHunk": "@@ -300,6 +300,20 @@ public ClientFactoryBuilder tlsCustomizer(Consumer<? super SslContextBuilder> tl\n         return this;\n     }\n \n+    /**\n+     * Sets whether to allow\n+     * <a href=\"https://tools.ietf.org/html/rfc7540#appendix-A\">TLS 1.2 Cipher Suite Block List</a>", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDkyMDgyMQ=="}, "originalCommit": {"oid": "aa044b583bd59467d0e244ce99354cd9a0eed2f4"}, "originalPosition": 6}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMwMTk4Mzg5OnYy", "diffSide": "RIGHT", "path": "core/src/main/java/com/linecorp/armeria/client/ClientFactoryBuilder.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQwNzowMToyOVrOH2PNGQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQwNzowMToyOVrOH2PNGQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjYzNDI2NQ==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                 * Allow the bad cipher suites listed in\n          \n          \n            \n                 * Allows the bad cipher suites listed in", "url": "https://github.com/line/armeria/pull/3172#discussion_r526634265", "createdAt": "2020-11-19T07:01:29Z", "author": {"login": "trustin"}, "path": "core/src/main/java/com/linecorp/armeria/client/ClientFactoryBuilder.java", "diffHunk": "@@ -300,6 +300,19 @@ public ClientFactoryBuilder tlsCustomizer(Consumer<? super SslContextBuilder> tl\n         return this;\n     }\n \n+    /**\n+     * Allow the bad cipher suites listed in", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "baef82b176915cc8e6d2a0489c6b4b93a8cde108"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMwMTk5NjIyOnYy", "diffSide": "RIGHT", "path": "core/src/main/java/com/linecorp/armeria/client/ClientFactoryBuilder.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQwNzowNjozNFrOH2PUYQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQwNzowNjozNFrOH2PUYQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjYzNjEyOQ==", "bodyText": "I'm not sure what 'meet minimum security requirements' means clearly. We should convey the message that explicitly discourages its use.\nHow about:\n<p>Note that enabling this option increases the security risk of your connection.\nUse it only when you must communicate with a legacy system that does not support\nsecure cipher suites. See ... for more information", "url": "https://github.com/line/armeria/pull/3172#discussion_r526636129", "createdAt": "2020-11-19T07:06:34Z", "author": {"login": "trustin"}, "path": "core/src/main/java/com/linecorp/armeria/client/ClientFactoryBuilder.java", "diffHunk": "@@ -300,6 +300,19 @@ public ClientFactoryBuilder tlsCustomizer(Consumer<? super SslContextBuilder> tl\n         return this;\n     }\n \n+    /**\n+     * Allow the bad cipher suites listed in\n+     * <a href=\"https://tools.ietf.org/html/rfc7540#appendix-A\">RFC7540</a> for TLS handshake.\n+     *\n+     * <p>Note that the bad cipher suites do not meet minimum security requirements.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "baef82b176915cc8e6d2a0489c6b4b93a8cde108"}, "originalPosition": 8}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMwMTk5OTAwOnYy", "diffSide": "RIGHT", "path": "core/src/main/java/com/linecorp/armeria/client/ClientFactoryOptions.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQwNzowNzoxOFrOH2PV0Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQwNzowNzoxOFrOH2PV0Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjYzNjQ5Nw==", "bodyText": "Ditto", "url": "https://github.com/line/armeria/pull/3172#discussion_r526636497", "createdAt": "2020-11-19T07:07:18Z", "author": {"login": "trustin"}, "path": "core/src/main/java/com/linecorp/armeria/client/ClientFactoryOptions.java", "diffHunk": "@@ -78,6 +78,17 @@\n     public static final ClientFactoryOption<Consumer<? super SslContextBuilder>> TLS_CUSTOMIZER =\n             ClientFactoryOption.define(\"TLS_CUSTOMIZER\", b -> { /* no-op */ });\n \n+    /**\n+     * Whether to allow the bad cipher suites listed in\n+     * <a href=\"https://tools.ietf.org/html/rfc7540#appendix-A\">RFC7540</a> for TLS handshake.\n+     *\n+     * <p>Note that the blocked cipher suites do not meet minimum security requirements.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "baef82b176915cc8e6d2a0489c6b4b93a8cde108"}, "originalPosition": 8}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMwMTk5OTQ3OnYy", "diffSide": "RIGHT", "path": "core/src/main/java/com/linecorp/armeria/client/ClientFactoryOptions.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQwNzowNzoyOFrOH2PWCg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQwNzowNzoyOFrOH2PWCg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjYzNjU1NA==", "bodyText": "Ditto", "url": "https://github.com/line/armeria/pull/3172#discussion_r526636554", "createdAt": "2020-11-19T07:07:28Z", "author": {"login": "trustin"}, "path": "core/src/main/java/com/linecorp/armeria/client/ClientFactoryOptions.java", "diffHunk": "@@ -446,4 +457,16 @@ public MeterRegistry meterRegistry() {\n     public ProxyConfigSelector proxyConfigSelector() {\n         return get(PROXY_CONFIG_SELECTOR);\n     }\n+\n+    /**\n+     * Returns whether to allow the bad cipher suites listed in\n+     * <a href=\"https://tools.ietf.org/html/rfc7540#appendix-A\">RFC7540</a> for TLS handshake.\n+     *\n+     * <p>Note that the bad cipher suites do not meet minimum security requirements.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "baef82b176915cc8e6d2a0489c6b4b93a8cde108"}, "originalPosition": 27}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2028, "cost": 1, "resetAt": "2021-11-12T20:44:06Z"}}}