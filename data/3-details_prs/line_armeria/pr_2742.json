{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDIyNTQ4Njc5", "number": 2742, "title": "Guarantee backward compatibility with Micrometer 1.3.x", "bodyText": "Motivation:\nA user might use Armeria 0.99.x with Micrometer 1.3.x.\nWe should guarantee that works.\nModifications:\n\nAdd test module which covers the compatiblity with Micrometer 1.3.9\n\nResult:\n\nYou can now use Armeria 0.99.6 with Micrometer 1.3.x", "createdAt": "2020-05-25T05:14:39Z", "url": "https://github.com/line/armeria/pull/2742", "merged": true, "mergeCommit": {"oid": "8d3b23774fa3980b365980176449d03a00560967"}, "closed": true, "closedAt": "2020-05-26T01:29:01Z", "author": {"login": "minwoox"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcko1PtgH2gAyNDIyNTQ4Njc5OjU4N2IyNzgyMDVjZWM5MmJmMWM3NjJmMTRhYmI4M2QzN2RhMjc1NTQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABck6WBNAFqTQxNzkxOTU1OQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "587b278205cec92bf1c762f14abb83d37da27554", "author": {"user": {"login": "minwoox", "name": "minux"}}, "url": "https://github.com/line/armeria/commit/587b278205cec92bf1c762f14abb83d37da27554", "committedDate": "2020-05-25T05:01:43Z", "message": "Guarantee backward compatibility with Micrometer 1.3.x\nMotivation:\nA user might uses Armeria 0.99.x with Micrometer 1.3.x.\nWe should guarantee that works.\n\nModifications:\n- Add test module which covers the compatibilty with Micrometer 1.3.9\n\nResult:\n- You can now use Armeria 0.99.6 with Micrometer 1.3.x"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE3NDY3NTA4", "url": "https://github.com/line/armeria/pull/2742#pullrequestreview-417467508", "createdAt": "2020-05-25T05:45:51Z", "commit": {"oid": "587b278205cec92bf1c762f14abb83d37da27554"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNVQwNTo0NTo1MVrOGZ1SWw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNVQwNTo0NTo1MVrOGZ1SWw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTc0MDYzNQ==", "bodyText": "nit: I'm not strong here, but could be inlined?\nprivate static final boolean MICROMETER_1_5 = !ReflectionUtils.getMethods(Builder.class, method ->\n        method != null && \"serviceLevelObjectives\".equals(method.getName())).isEmpty();", "url": "https://github.com/line/armeria/pull/2742#discussion_r429740635", "createdAt": "2020-05-25T05:45:51Z", "author": {"login": "ikhoon"}, "path": "core/src/main/java/com/linecorp/armeria/common/metric/MoreMeters.java", "diffHunk": "@@ -38,8 +45,22 @@\n  */\n public final class MoreMeters {\n \n+    private static final Logger logger = LoggerFactory.getLogger(MoreMeters.class);\n+\n     private static final double[] PERCENTILES = { 0, 0.5, 0.75, 0.9, 0.95, 0.98, 0.99, 0.999, 1.0 };\n \n+    private static final boolean MICROMETER_1_5;\n+\n+    static {\n+        final Set<Method> methods = ReflectionUtils.getMethods(Builder.class, method ->\n+                method != null && \"serviceLevelObjectives\".equals(method.getName()));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "587b278205cec92bf1c762f14abb83d37da27554"}, "originalPosition": 34}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE3NDY3NzI3", "url": "https://github.com/line/armeria/pull/2742#pullrequestreview-417467727", "createdAt": "2020-05-25T05:46:31Z", "commit": {"oid": "587b278205cec92bf1c762f14abb83d37da27554"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNVQwNTo0NjozMVrOGZ1S9A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNVQwNTo1Mjo0MFrOGZ1YoQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTc0MDc4OA==", "bodyText": "This test is better than nothing, but I wonder if it's not hard to collect all our **MetricsIntegrationTest for this check.", "url": "https://github.com/line/armeria/pull/2742#discussion_r429740788", "createdAt": "2020-05-25T05:46:31Z", "author": {"login": "anuraaga"}, "path": "it/micrometer1.3/build.gradle", "diffHunk": "@@ -0,0 +1,12 @@\n+dependencies {\n+    [ 'micrometer-core', 'micrometer-registry-prometheus' ].each {\n+        implementation(\"io.micrometer:$it\") {\n+            version {\n+                // Will fail the build if the override doesn't work\n+                strictly '1.3.9'\n+            }\n+        }\n+    }\n+}\n+\n+tasks.compileTestJava.source \"${rootProject.projectDir}/core/src/test/java/com/linecorp/armeria/internal/common/metric/RequestMetricSupportTest.java\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "587b278205cec92bf1c762f14abb83d37da27554"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTc0MjI0MQ==", "bodyText": "Can you add a TODO with a link to the issue to clean this up?", "url": "https://github.com/line/armeria/pull/2742#discussion_r429742241", "createdAt": "2020-05-25T05:52:40Z", "author": {"login": "anuraaga"}, "path": "core/src/main/java/com/linecorp/armeria/common/metric/MoreMeters.java", "diffHunk": "@@ -38,8 +45,22 @@\n  */\n public final class MoreMeters {\n \n+    private static final Logger logger = LoggerFactory.getLogger(MoreMeters.class);\n+\n     private static final double[] PERCENTILES = { 0, 0.5, 0.75, 0.9, 0.95, 0.98, 0.99, 0.999, 1.0 };\n \n+    private static final boolean MICROMETER_1_5;\n+\n+    static {\n+        final Set<Method> methods = ReflectionUtils.getMethods(Builder.class, method ->", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "587b278205cec92bf1c762f14abb83d37da27554"}, "originalPosition": 33}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5490fbfb184c2439f26e50084d3c98479da23646", "author": {"user": {"login": "minwoox", "name": "minux"}}, "url": "https://github.com/line/armeria/commit/5490fbfb184c2439f26e50084d3c98479da23646", "committedDate": "2020-05-26T00:03:23Z", "message": "Tests *MetricsIntegrationsTest as well"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6f892e726559c88b58642e35cce851cf511283cc", "author": {"user": {"login": "minwoox", "name": "minux"}}, "url": "https://github.com/line/armeria/commit/6f892e726559c88b58642e35cce851cf511283cc", "committedDate": "2020-05-26T01:06:52Z", "message": "Remove unused"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f1d340e7712caa47bd31b850ab363b7b26e3c13f", "author": {"user": {"login": "minwoox", "name": "minux"}}, "url": "https://github.com/line/armeria/commit/f1d340e7712caa47bd31b850ab363b7b26e3c13f", "committedDate": "2020-05-26T01:11:11Z", "message": "Remove unused import"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE3OTE2NTc2", "url": "https://github.com/line/armeria/pull/2742#pullrequestreview-417916576", "createdAt": "2020-05-26T01:11:43Z", "commit": {"oid": "f1d340e7712caa47bd31b850ab363b7b26e3c13f"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE3OTE5NTU5", "url": "https://github.com/line/armeria/pull/2742#pullrequestreview-417919559", "createdAt": "2020-05-26T01:25:54Z", "commit": {"oid": "f1d340e7712caa47bd31b850ab363b7b26e3c13f"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 559, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}