{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE3ODA3MDI0", "number": 3166, "title": "Fix route decorator evaluation order", "bodyText": "Motivation:\nRelated #3160\nModifications:\n\nIn the case of route decorator router, modified to be created as SequentialRouter\nModified to insert the route decorator forward when adding\nModified order to configureServerWithArmeriaSettings\nModified test\n\nAnnotatedServiceRequestLogNameTest\nContentPreviewingServiceTest\nRouteDecoratingTest\n\n\nModified javadoc of RouteDecoratingService\n\nResult:\n\nCorrect route decorator evaluation order\nFixed #3160", "createdAt": "2020-11-09T14:34:26Z", "url": "https://github.com/line/armeria/pull/3166", "merged": true, "mergeCommit": {"oid": "ded8d82ca57851b9d993b2b013863afa28ffc64c"}, "closed": true, "closedAt": "2020-11-25T07:59:51Z", "author": {"login": "heowc"}, "timelineItems": {"totalCount": 15, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABda1nzxgH2gAyNTE3ODA3MDI0OmE1ZGZjNTZhMGRmZjg5YTVjYzhkOWE1YzA0NWE5OGUwNGJjYzg2YjI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdeU6cXAH2gAyNTE3ODA3MDI0OjgzM2M2MzQ2YzgyZDg0MzQ2YjM5MDU2YTlmODA5MmMzMDdhZWRhYTU=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "a5dfc56a0dff89a5cc8d9a5c045a98e04bcc86b2", "author": {"user": {"login": "heowc", "name": "WonChul Heo"}}, "url": "https://github.com/line/armeria/commit/a5dfc56a0dff89a5cc8d9a5c045a98e04bcc86b2", "committedDate": "2020-11-09T14:27:43Z", "message": "Fix route decorator evaluation order"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ce82ebfe0977eaca33cb9eaac305535036648e3f", "author": {"user": {"login": "heowc", "name": "WonChul Heo"}}, "url": "https://github.com/line/armeria/commit/ce82ebfe0977eaca33cb9eaac305535036648e3f", "committedDate": "2020-11-10T09:53:26Z", "message": "Fix order `configureServerWithArmeriaSettings`"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "31c00bec6c842a3139547fb8fa9fbff81daaf60b", "author": {"user": {"login": "heowc", "name": "WonChul Heo"}}, "url": "https://github.com/line/armeria/commit/31c00bec6c842a3139547fb8fa9fbff81daaf60b", "committedDate": "2020-11-10T09:53:37Z", "message": "Fix test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a10bea7da1ebfe0bdbfe72738ff3e7b7a61a5ecd", "author": {"user": {"login": "heowc", "name": "WonChul Heo"}}, "url": "https://github.com/line/armeria/commit/a10bea7da1ebfe0bdbfe72738ff3e7b7a61a5ecd", "committedDate": "2020-11-12T01:19:18Z", "message": "Replace `ArrayList` to `LinkedList`"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bdcff46cf373d5fbb97a02dd53490ada5d47a2dc", "author": {"user": {"login": "heowc", "name": "WonChul Heo"}}, "url": "https://github.com/line/armeria/commit/bdcff46cf373d5fbb97a02dd53490ada5d47a2dc", "committedDate": "2020-11-12T11:13:49Z", "message": "Refactor"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMxMTE5NzY0", "url": "https://github.com/line/armeria/pull/3166#pullrequestreview-531119764", "createdAt": "2020-11-16T08:54:21Z", "commit": {"oid": "bdcff46cf373d5fbb97a02dd53490ada5d47a2dc"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNlQwODo1NDoyMlrOHztauQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNlQwODo1NToyM1rOHztfNQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzk4MzU0NQ==", "bodyText": "Shouldn't we update the decorator ordering instead of updating the test parameters? Returning public on .../private/... doesn't sound right to me.", "url": "https://github.com/line/armeria/pull/3166#discussion_r523983545", "createdAt": "2020-11-16T08:54:22Z", "author": {"login": "trustin"}, "path": "core/src/test/java/com/linecorp/armeria/server/RouteDecoratingTest.java", "diffHunk": "@@ -187,7 +187,7 @@ void decorateInOrder(String path, List<Integer> orders) {\n             \"/api/admin/1, , 401, \",\n             \"/assets/index.html, , 200, \",\n             \"/assets/resources/index.html, , 200, public\",\n-            \"/assets/resources/private/profile.jpg, , 200, private\",\n+            \"/assets/resources/private/profile.jpg, , 200, public\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bdcff46cf373d5fbb97a02dd53490ada5d47a2dc"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzk4NDY5Mw==", "bodyText": "How about moving this sentence before .decorator() for readability?", "url": "https://github.com/line/armeria/pull/3166#discussion_r523984693", "createdAt": "2020-11-16T08:55:23Z", "author": {"login": "trustin"}, "path": "core/src/test/java/com/linecorp/armeria/server/logging/ContentPreviewingServiceTest.java", "diffHunk": "@@ -71,16 +71,16 @@ protected void configure(ServerBuilder sb) throws Exception {\n                            return HttpResponse.of(responseHeaders,\n                                                   HttpData.ofUtf8(\"Hello \" + aggregated.contentUtf8() + '!'));\n                        }));\n+            sb.decorator(\"/beforeEncoding\", ContentPreviewingService.newDecorator(100));\n             sb.decorator(\"/beforeEncoding\", EncodingService.builder()\n                                                            .minBytesToForceChunkedEncoding(1)\n                                                            .newDecorator());\n-            sb.decorator(\"/beforeEncoding\", ContentPreviewingService.newDecorator(100));\n             sb.service(\"/beforeEncoding\", httpService);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bdcff46cf373d5fbb97a02dd53490ada5d47a2dc"}, "originalPosition": 9}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "229bf1f02623084414a6b32f0b1e4bd5bccd61b6", "author": {"user": {"login": "heowc", "name": "WonChul Heo"}}, "url": "https://github.com/line/armeria/commit/229bf1f02623084414a6b32f0b1e4bd5bccd61b6", "committedDate": "2020-11-16T09:45:58Z", "message": "Address comments by @trustin"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMxMTYxMTYx", "url": "https://github.com/line/armeria/pull/3166#pullrequestreview-531161161", "createdAt": "2020-11-16T09:48:31Z", "commit": {"oid": "229bf1f02623084414a6b32f0b1e4bd5bccd61b6"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMzMDg4NTcx", "url": "https://github.com/line/armeria/pull/3166#pullrequestreview-533088571", "createdAt": "2020-11-18T04:02:47Z", "commit": {"oid": "229bf1f02623084414a6b32f0b1e4bd5bccd61b6"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOFQwNDowMjo0OFrOH1aK0g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOFQwNDowMjo0OFrOH1aK0g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTc2NTMzMA==", "bodyText": "How about using LinkedList.addFirst(...)?\nCould you add The specified decorator(s) is/are executed in reverse order of the insertion. to the Javadoc of ServerBuilder.decorator(...) and VirtualHostBuilder.decorator(...)?", "url": "https://github.com/line/armeria/pull/3166#discussion_r525765330", "createdAt": "2020-11-18T04:02:48Z", "author": {"login": "ikhoon"}, "path": "core/src/main/java/com/linecorp/armeria/server/VirtualHostBuilder.java", "diffHunk": "@@ -591,7 +592,7 @@ VirtualHostBuilder addServiceConfigSetters(ServiceConfigSetters serviceConfigSet\n     }\n \n     VirtualHostBuilder addRouteDecoratingService(RouteDecoratingService routeDecoratingService) {\n-        routeDecoratingServices.add(routeDecoratingService);\n+        routeDecoratingServices.add(0, routeDecoratingService);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "229bf1f02623084414a6b32f0b1e4bd5bccd61b6"}, "originalPosition": 22}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fcbced63ff421f17489c19173f24423017b9c0ce", "author": {"user": {"login": "heowc", "name": "WonChul Heo"}}, "url": "https://github.com/line/armeria/commit/fcbced63ff421f17489c19173f24423017b9c0ce", "committedDate": "2020-11-18T13:26:31Z", "message": "Address comments by @ikhoon"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4c2812cd57216e71aa3de8ed1dcfdd6aa3eb6022", "author": {"user": {"login": "heowc", "name": "WonChul Heo"}}, "url": "https://github.com/line/armeria/commit/4c2812cd57216e71aa3de8ed1dcfdd6aa3eb6022", "committedDate": "2020-11-18T14:32:16Z", "message": "Address comments by @ikhoon"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM0MDI2MTQw", "url": "https://github.com/line/armeria/pull/3166#pullrequestreview-534026140", "createdAt": "2020-11-19T02:07:37Z", "commit": {"oid": "4c2812cd57216e71aa3de8ed1dcfdd6aa3eb6022"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM0MDQ0MTYz", "url": "https://github.com/line/armeria/pull/3166#pullrequestreview-534044163", "createdAt": "2020-11-19T02:58:17Z", "commit": {"oid": "4c2812cd57216e71aa3de8ed1dcfdd6aa3eb6022"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "deabd4f160e7c3b2a313aa3ae8d7b606a7932fdf", "author": {"user": {"login": "heowc", "name": "WonChul Heo"}}, "url": "https://github.com/line/armeria/commit/deabd4f160e7c3b2a313aa3ae8d7b606a7932fdf", "committedDate": "2020-11-20T10:11:42Z", "message": "Fix javadoc"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "833c6346c82d84346b39056a9f8092c307aedaa5", "author": {"user": {"login": "heowc", "name": "WonChul Heo"}}, "url": "https://github.com/line/armeria/commit/833c6346c82d84346b39056a9f8092c307aedaa5", "committedDate": "2020-11-20T10:36:54Z", "message": "Address comments by @minwoox"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4811, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}