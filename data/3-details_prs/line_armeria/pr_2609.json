{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzkwNDk2NjUx", "number": 2609, "title": "Wrap ProxyConnectException with UnprocessedRequestException", "bodyText": "Fixes #2601\nMotivation\nBefore proxy connection is successfully negotiated, all writes are pending and not sent.\nThis signifies proxy negotiation failure is safely retry-able.\nModification\nIgnore ProxyConnectException  due to write failure in HttpRequestSubscriber.\nWrap ProxyConnectException in HttpSessionHandler. exceptionCaught", "createdAt": "2020-03-18T15:15:06Z", "url": "https://github.com/line/armeria/pull/2609", "merged": true, "mergeCommit": {"oid": "6d21bfd5d5ac863d7d68420873190b4dc5f8f018"}, "closed": true, "closedAt": "2020-03-23T02:00:31Z", "author": {"login": "jrhee17"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcPMpKXAH2gAyMzkwNDk2NjUxOjQyY2NhZDhiMGM5OTJlMzI2ZjFlNWQ4ZTcyMzIyNWY4YzE0NzIyNTE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcPg6HPgFqTM3ODUwMjk4NQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "42ccad8b0c992e326f1e5d8e723225f8c1472251", "author": {"user": {"login": "jrhee17", "name": "jrhee17"}}, "url": "https://github.com/line/armeria/commit/42ccad8b0c992e326f1e5d8e723225f8c1472251", "committedDate": "2020-03-19T14:18:46Z", "message": "try wrapping e in HttpSessionHandler"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "fc969cdd16c5c65ab425ac16757ac35c0b806aef", "author": {"user": {"login": "jrhee17", "name": "jrhee17"}}, "url": "https://github.com/line/armeria/commit/fc969cdd16c5c65ab425ac16757ac35c0b806aef", "committedDate": "2020-03-18T14:45:21Z", "message": "very quick and naive fix from HttpRequestSubscriber"}, "afterCommit": {"oid": "42ccad8b0c992e326f1e5d8e723225f8c1472251", "author": {"user": {"login": "jrhee17", "name": "jrhee17"}}, "url": "https://github.com/line/armeria/commit/42ccad8b0c992e326f1e5d8e723225f8c1472251", "committedDate": "2020-03-19T14:18:46Z", "message": "try wrapping e in HttpSessionHandler"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc3ODQwODUw", "url": "https://github.com/line/armeria/pull/2609#pullrequestreview-377840850", "createdAt": "2020-03-19T15:37:31Z", "commit": {"oid": "42ccad8b0c992e326f1e5d8e723225f8c1472251"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOVQxNTozNzozMlrOF40P_w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOVQxNTozNzozMlrOF40P_w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTEyMDYzOQ==", "bodyText": "Looks like a good place!", "url": "https://github.com/line/armeria/pull/2609#discussion_r395120639", "createdAt": "2020-03-19T15:37:32Z", "author": {"login": "trustin"}, "path": "core/src/main/java/com/linecorp/armeria/client/HttpSessionHandler.java", "diffHunk": "@@ -350,6 +351,10 @@ public void channelInactive(ChannelHandlerContext ctx) throws Exception {\n \n     @Override\n     public void exceptionCaught(ChannelHandlerContext ctx, Throwable cause) throws Exception {\n+        if (cause instanceof ProxyConnectException) {\n+            setPendingException(ctx, new UnprocessedRequestException(cause));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "42ccad8b0c992e326f1e5d8e723225f8c1472251"}, "originalPosition": 13}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc3ODQxNjEw", "url": "https://github.com/line/armeria/pull/2609#pullrequestreview-377841610", "createdAt": "2020-03-19T15:38:17Z", "commit": {"oid": "42ccad8b0c992e326f1e5d8e723225f8c1472251"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOVQxNTozODoxOFrOF40SXQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOVQxNTozODoxOFrOF40SXQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTEyMTI0NQ==", "bodyText": "Could you add some comment? e.g.\n// ProxyConnectException is handled by HttpSessionHandler.exceptionCaught().", "url": "https://github.com/line/armeria/pull/2609#discussion_r395121245", "createdAt": "2020-03-19T15:38:18Z", "author": {"login": "trustin"}, "path": "core/src/main/java/com/linecorp/armeria/client/HttpRequestSubscriber.java", "diffHunk": "@@ -334,6 +335,10 @@ private void cancelSubscription() {\n     }\n \n     private void failAndReset(Throwable cause) {\n+        if (cause instanceof ProxyConnectException) {\n+            return;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "42ccad8b0c992e326f1e5d8e723225f8c1472251"}, "originalPosition": 13}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc4MjQ0OTA3", "url": "https://github.com/line/armeria/pull/2609#pullrequestreview-378244907", "createdAt": "2020-03-20T05:52:10Z", "commit": {"oid": "42ccad8b0c992e326f1e5d8e723225f8c1472251"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7d38111d310afcf1f5c9177e0c5c9f8f7c8c323b", "author": {"user": {"login": "jrhee17", "name": "jrhee17"}}, "url": "https://github.com/line/armeria/commit/7d38111d310afcf1f5c9177e0c5c9f8f7c8c323b", "committedDate": "2020-03-20T12:14:01Z", "message": "add comment specifying where ProxyConnectionEvent is handled"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc4NDk4NjM3", "url": "https://github.com/line/armeria/pull/2609#pullrequestreview-378498637", "createdAt": "2020-03-20T13:50:11Z", "commit": {"oid": "7d38111d310afcf1f5c9177e0c5c9f8f7c8c323b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc4NTAyOTg1", "url": "https://github.com/line/armeria/pull/2609#pullrequestreview-378502985", "createdAt": "2020-03-20T13:55:23Z", "commit": {"oid": "7d38111d310afcf1f5c9177e0c5c9f8f7c8c323b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 710, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}