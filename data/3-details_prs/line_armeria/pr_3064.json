{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDg4MDM0Njk3", "number": 3064, "title": "Fix a bug where wrong exception is propagated to WebFlux `WebClient`", "bodyText": "Motivation:\nCurrently, we propagate the exception from the HttpRequest to WebFlux WebClient.\nHowever, this causes some unexpected behavior such as propagating CancelledSubscriptionException\ninstead FailFastException when RetyringClient is used.\nWe should rather propagate the exception of HttpResponse.\nModification:\n\nProgate the exception from HttpResponse not from HttpRequest.\n\nResult:\n\nYou now see the proper exception from WebFlux WebClient.", "createdAt": "2020-09-16T14:34:36Z", "url": "https://github.com/line/armeria/pull/3064", "merged": true, "mergeCommit": {"oid": "82ec61d557afc0182150821781ca760321a04bce"}, "closed": true, "closedAt": "2020-09-20T14:08:51Z", "author": {"login": "minwoox"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdJdVdBAH2gAyNDg4MDM0Njk3OjYwMGNmMTBkOWFhMTM4ZGVkZjllOTVkMWJiZDFlNGQ1NzU0NDY4ZjM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdKvYVqAFqTQ5MjE5NzM5Mw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "600cf10d9aa138dedf9e95d1bbd1e4d5754468f3", "author": {"user": {"login": "minwoox", "name": "minux"}}, "url": "https://github.com/line/armeria/commit/600cf10d9aa138dedf9e95d1bbd1e4d5754468f3", "committedDate": "2020-09-16T14:33:14Z", "message": "Fix a bug where wrong exception is propagated to WebFlux `WebClient`\nMotivation:\nCurrently, we propagate the exception from the `HttpRequest` to WebFlux `WebClent`.\nHowever, this causes some unexpected behaviour such as progating `CancelledSubscriptionException`\ninstead `FailFastException` when `RetyringClient` is used.\nWe should rather propgate the exception from `HttpResponse`.\n\nModification:\n- Progate the exception from `HttpResponse` not from `HttpRequest`.\n\nResult:\n- You now see the proper exception from WebFlux `WebClient`."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkwMjYwMDE0", "url": "https://github.com/line/armeria/pull/3064#pullrequestreview-490260014", "createdAt": "2020-09-17T05:48:26Z", "commit": {"oid": "600cf10d9aa138dedf9e95d1bbd1e4d5754468f3"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xN1QwNTo0ODoyNlrOHTSUyQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xN1QwNTo0ODoyNlrOHTSUyQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTk4NTIyNQ==", "bodyText": "Don't we need to complete Mono lazily? If then, how about?\nMono.fromFuture(request.whenComplete())\n    .onErrorResume(unused -> Mono.empty())", "url": "https://github.com/line/armeria/pull/3064#discussion_r489985225", "createdAt": "2020-09-17T05:48:26Z", "author": {"login": "ikhoon"}, "path": "spring/boot2-webflux-autoconfigure/src/main/java/com/linecorp/armeria/spring/web/reactive/ArmeriaClientHttpRequest.java", "diffHunk": "@@ -141,7 +141,7 @@ public DataBufferFactory bufferFactory() {\n             assert request == null : request;\n             request = supplier.get();\n             future.complete(client.execute(request));\n-            return Mono.fromFuture(request.whenComplete());\n+            return Mono.empty();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "600cf10d9aa138dedf9e95d1bbd1e4d5754468f3"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkxMDg5NjA4", "url": "https://github.com/line/armeria/pull/3064#pullrequestreview-491089608", "createdAt": "2020-09-18T01:24:26Z", "commit": {"oid": "600cf10d9aa138dedf9e95d1bbd1e4d5754468f3"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkyMTk3Mzkz", "url": "https://github.com/line/armeria/pull/3064#pullrequestreview-492197393", "createdAt": "2020-09-20T14:08:36Z", "commit": {"oid": "600cf10d9aa138dedf9e95d1bbd1e4d5754468f3"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4659, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}