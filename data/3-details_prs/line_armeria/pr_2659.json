{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDAxNTIwNTE5", "number": 2659, "title": "Add `Server.blockUntilShutdown()`", "bodyText": "Hello, I tried to solve this easy issue, any comments are  welcome.", "createdAt": "2020-04-09T16:23:17Z", "url": "https://github.com/line/armeria/pull/2659", "merged": true, "mergeCommit": {"oid": "f6df6925eb5e4a641ab14e085f9c8619d2fa94d9"}, "closed": true, "closedAt": "2020-04-24T10:19:15Z", "author": {"login": "Charliocat"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcV-6mogH2gAyNDAxNTIwNTE5OjdhZjBkNGFhYTA1MTQ2NzBlNGI5MjYzNjA1ZWY2YWRhYjAwNjQ2OTk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcassO5gFqTM5OTcxODE5OA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "7af0d4aaa0514670e4b9263605ef6adab0064699", "author": {"user": {"login": "Charliocat", "name": null}}, "url": "https://github.com/line/armeria/commit/7af0d4aaa0514670e4b9263605ef6adab0064699", "committedDate": "2020-04-09T16:16:37Z", "message": "added build unitl shutdown method"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkxNzYzMDQw", "url": "https://github.com/line/armeria/pull/2659#pullrequestreview-391763040", "createdAt": "2020-04-11T12:38:08Z", "commit": {"oid": "7af0d4aaa0514670e4b9263605ef6adab0064699"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xMVQxMjozODowOFrOGEM60A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xMVQxMjo0NjozMVrOGEM-Fg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzA1OTE1Mg==", "bodyText": "I think we don't need to return an object here. How about making the return type void?", "url": "https://github.com/line/armeria/pull/2659#discussion_r407059152", "createdAt": "2020-04-11T12:38:08Z", "author": {"login": "ikhoon"}, "path": "core/src/main/java/com/linecorp/armeria/server/Server.java", "diffHunk": "@@ -328,6 +328,14 @@ public int numConnections() {\n         return connectionLimitingHandler.numConnections();\n     }\n \n+    /**\n+     * Returns the result of {@link CompletableFuture} which is completed after the {@link #close()} or\n+     * {@link #closeAsync()} operation is completed.\n+     */\n+    public Object blockUntilShutdown() throws Exception {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7af0d4aaa0514670e4b9263605ef6adab0064699"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzA1OTk5MA==", "bodyText": "It would be nice to add a test that registers a ServerListener to the test server and could check serverStopped(...) serverStopping(...) was invoked.", "url": "https://github.com/line/armeria/pull/2659#discussion_r407059990", "createdAt": "2020-04-11T12:46:31Z", "author": {"login": "ikhoon"}, "path": "core/src/main/java/com/linecorp/armeria/server/Server.java", "diffHunk": "@@ -328,6 +328,14 @@ public int numConnections() {\n         return connectionLimitingHandler.numConnections();\n     }\n \n+    /**\n+     * Returns the result of {@link CompletableFuture} which is completed after the {@link #close()} or\n+     * {@link #closeAsync()} operation is completed.\n+     */\n+    public Object blockUntilShutdown() throws Exception {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzA1OTE1Mg=="}, "originalCommit": {"oid": "7af0d4aaa0514670e4b9263605ef6adab0064699"}, "originalPosition": 8}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ac1dcc252fc0578afd9da83b4ec706de72563a71", "author": {"user": {"login": "Charliocat", "name": null}}, "url": "https://github.com/line/armeria/commit/ac1dcc252fc0578afd9da83b4ec706de72563a71", "committedDate": "2020-04-17T08:57:28Z", "message": "return void and new test"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk2MjY0MDYw", "url": "https://github.com/line/armeria/pull/2659#pullrequestreview-396264060", "createdAt": "2020-04-20T08:57:47Z", "commit": {"oid": "ac1dcc252fc0578afd9da83b4ec706de72563a71"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMFQwODo1Nzo0N1rOGIKRNQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMFQwODo1Nzo0N1rOGIKRNQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTIxMDAzNw==", "bodyText": "Could you use more specific throws clause? e.g. throws InterruptedException, ...", "url": "https://github.com/line/armeria/pull/2659#discussion_r411210037", "createdAt": "2020-04-20T08:57:47Z", "author": {"login": "trustin"}, "path": "core/src/main/java/com/linecorp/armeria/server/Server.java", "diffHunk": "@@ -328,6 +328,14 @@ public int numConnections() {\n         return connectionLimitingHandler.numConnections();\n     }\n \n+    /**\n+     * Waits until the result of {@link CompletableFuture} which is completed after the {@link #close()} or\n+     * {@link #closeAsync()} operation is completed.\n+     */\n+    public void blockUntilShutdown() throws Exception {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ac1dcc252fc0578afd9da83b4ec706de72563a71"}, "originalPosition": 8}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "32af1c7a83d8a8e7c7f6c3808f49dd8896382a72", "author": {"user": {"login": "Charliocat", "name": null}}, "url": "https://github.com/line/armeria/commit/32af1c7a83d8a8e7c7f6c3808f49dd8896382a72", "committedDate": "2020-04-20T17:53:11Z", "message": "change to specific exceptions"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk2OTkzMDE5", "url": "https://github.com/line/armeria/pull/2659#pullrequestreview-396993019", "createdAt": "2020-04-21T05:17:30Z", "commit": {"oid": "32af1c7a83d8a8e7c7f6c3808f49dd8896382a72"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk3Nzg0MjEx", "url": "https://github.com/line/armeria/pull/2659#pullrequestreview-397784211", "createdAt": "2020-04-22T01:39:09Z", "commit": {"oid": "32af1c7a83d8a8e7c7f6c3808f49dd8896382a72"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMlQwMTozOTowOVrOGJfd2Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMlQwMTozOTowOVrOGJfd2Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjYwNTkxMw==", "bodyText": "After thinking a little bit, how about catching ExecutionException and turning it into CompletionException? i.e.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                public void blockUntilShutdown() throws ExecutionException, InterruptedException {\n          \n          \n            \n                    whenClosed().get();\n          \n          \n            \n                }\n          \n          \n            \n                public void blockUntilShutdown() throws InterruptedException {\n          \n          \n            \n                    try {\n          \n          \n            \n                        whenClosed().get();\n          \n          \n            \n                    } catch (ExecutionException e) {\n          \n          \n            \n                        throw new CompletionException(e.toString(), Exceptions.peel(e));\n          \n          \n            \n                    }\n          \n          \n            \n                }\n          \n      \n    \n    \n  \n\n.. because we do not usually use ExecutionException in our API.", "url": "https://github.com/line/armeria/pull/2659#discussion_r412605913", "createdAt": "2020-04-22T01:39:09Z", "author": {"login": "trustin"}, "path": "core/src/main/java/com/linecorp/armeria/server/Server.java", "diffHunk": "@@ -332,7 +333,7 @@ public int numConnections() {\n      * Waits until the result of {@link CompletableFuture} which is completed after the {@link #close()} or\n      * {@link #closeAsync()} operation is completed.\n      */\n-    public void blockUntilShutdown() throws Exception {\n+    public void blockUntilShutdown() throws ExecutionException, InterruptedException {\n         whenClosed().get();\n     }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "32af1c7a83d8a8e7c7f6c3808f49dd8896382a72"}, "originalPosition": 15}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b0e95866d82ad7049477e0001088248a558a7fa9", "author": {"user": {"login": "Charliocat", "name": null}}, "url": "https://github.com/line/armeria/commit/b0e95866d82ad7049477e0001088248a558a7fa9", "committedDate": "2020-04-22T20:25:38Z", "message": "wrapped ExecutionException to CompletionException"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk5NjE1NTkx", "url": "https://github.com/line/armeria/pull/2659#pullrequestreview-399615591", "createdAt": "2020-04-24T03:27:26Z", "commit": {"oid": "b0e95866d82ad7049477e0001088248a558a7fa9"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a51ece4add2c5c81db4dc0d2d160920bc598cb3d", "author": {"user": {"login": "trustin", "name": "Trustin Lee"}}, "url": "https://github.com/line/armeria/commit/a51ece4add2c5c81db4dc0d2d160920bc598cb3d", "committedDate": "2020-04-24T03:28:28Z", "message": "Checkstyle"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk5NzE4MTk4", "url": "https://github.com/line/armeria/pull/2659#pullrequestreview-399718198", "createdAt": "2020-04-24T07:52:15Z", "commit": {"oid": "a51ece4add2c5c81db4dc0d2d160920bc598cb3d"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 772, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}