{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDU5MjcwOTc5", "number": 2950, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQxNTowMjowMVrOETuCpw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wM1QwOToyNzoxNVrOEUiKOg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg5MTEyNzQzOnYy", "diffSide": "RIGHT", "path": "examples/grpc-kotlin/src/main/kotlin/example/armeria/grpc/kotlin/HelloServiceImpl.kt", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQxNTowMjowMVrOG5nGoA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQxNTowOToxNlrOG5naQQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzA2MjY4OA==", "bodyText": "3000?", "url": "https://github.com/line/armeria/pull/2950#discussion_r463062688", "createdAt": "2020-07-30T15:02:01Z", "author": {"login": "trustin"}, "path": "examples/grpc-kotlin/src/main/kotlin/example/armeria/grpc/kotlin/HelloServiceImpl.kt", "diffHunk": "@@ -47,7 +47,22 @@ class HelloServiceImpl : HelloServiceGrpcKt.HelloServiceCoroutineImplBase(Dispat\n      */\n     override suspend fun blockingHello(request: HelloRequest): HelloReply = withArmeriaBlockingContext {\n         try { // Simulate a blocking API call.\n-            Thread.sleep(3000)\n+            Thread.sleep(10)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "eb4e892c88f7b832a8ced34ed2ce3b91ace4ec94"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzA2NzcxMw==", "bodyText": "Oops! \ud83d\ude31", "url": "https://github.com/line/armeria/pull/2950#discussion_r463067713", "createdAt": "2020-07-30T15:09:16Z", "author": {"login": "ikhoon"}, "path": "examples/grpc-kotlin/src/main/kotlin/example/armeria/grpc/kotlin/HelloServiceImpl.kt", "diffHunk": "@@ -47,7 +47,22 @@ class HelloServiceImpl : HelloServiceGrpcKt.HelloServiceCoroutineImplBase(Dispat\n      */\n     override suspend fun blockingHello(request: HelloRequest): HelloReply = withArmeriaBlockingContext {\n         try { // Simulate a blocking API call.\n-            Thread.sleep(3000)\n+            Thread.sleep(10)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzA2MjY4OA=="}, "originalCommit": {"oid": "eb4e892c88f7b832a8ced34ed2ce3b91ace4ec94"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg5MTIyNjcyOnYy", "diffSide": "RIGHT", "path": "examples/grpc-kotlin/src/test/kotlin/example/armeria/grpc/kotlin/HelloServiceTest.kt", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQxNToyNDowNVrOG5oEQA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQxNToyNDowNVrOG5oEQA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzA3ODQ2NA==", "bodyText": "Could remove the empty line", "url": "https://github.com/line/armeria/pull/2950#discussion_r463078464", "createdAt": "2020-07-30T15:24:05Z", "author": {"login": "trustin"}, "path": "examples/grpc-kotlin/src/test/kotlin/example/armeria/grpc/kotlin/HelloServiceTest.kt", "diffHunk": "@@ -52,6 +53,23 @@ class HelloServiceTest {\n         }\n     }\n \n+    @ParameterizedTest\n+    @MethodSource(\"uris\")\n+    fun parallelReplyFromServerSideBlockingCall(uri: String) {\n+        runBlocking {\n+            val helloService = Clients.newClient(uri, HelloServiceCoroutineStub::class.java)\n+            repeat(30) {\n+                launch {\n+                    val message = helloService.shortBlockingHello(\n+                        HelloRequest.newBuilder().setName(\"$it Armeria\").build()\n+                    ).message\n+                    assertThat(message).isEqualTo(\"Hello, $it Armeria!\")\n+                }\n+            }\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "034a76e98209f6958c34e4cc505f948fd4449994"}, "originalPosition": 25}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg5OTY2NjUwOnYy", "diffSide": "RIGHT", "path": "grpc-protocol/src/main/java/com/linecorp/armeria/common/grpc/protocol/ArmeriaMessageDeframer.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wM1QwOToyNzoxNVrOG6yh-w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wM1QxMTo1MDoyOVrOG62iJQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDI5ODQ5MQ==", "bodyText": "Shouldn't we do this after cleanup the resources? which means at the end of this method?", "url": "https://github.com/line/armeria/pull/2950#discussion_r464298491", "createdAt": "2020-08-03T09:27:15Z", "author": {"login": "minwoox"}, "path": "grpc-protocol/src/main/java/com/linecorp/armeria/common/grpc/protocol/ArmeriaMessageDeframer.java", "diffHunk": "@@ -317,6 +328,12 @@ public void closeWhenComplete() {\n      */\n     @Override\n     public void close() {\n+        if (whenClosed == null) {\n+            whenClosed = CLOSED_FUTURE;\n+        } else {\n+            whenClosed.doComplete();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2dc2cb2389c4dc3581ad2b2d7cbbc6d34434391f"}, "originalPosition": 46}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDM2NDA2OQ==", "bodyText": "Fixed. :-)", "url": "https://github.com/line/armeria/pull/2950#discussion_r464364069", "createdAt": "2020-08-03T11:50:29Z", "author": {"login": "ikhoon"}, "path": "grpc-protocol/src/main/java/com/linecorp/armeria/common/grpc/protocol/ArmeriaMessageDeframer.java", "diffHunk": "@@ -317,6 +328,12 @@ public void closeWhenComplete() {\n      */\n     @Override\n     public void close() {\n+        if (whenClosed == null) {\n+            whenClosed = CLOSED_FUTURE;\n+        } else {\n+            whenClosed.doComplete();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDI5ODQ5MQ=="}, "originalCommit": {"oid": "2dc2cb2389c4dc3581ad2b2d7cbbc6d34434391f"}, "originalPosition": 46}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2158, "cost": 1, "resetAt": "2021-11-12T20:44:06Z"}}}