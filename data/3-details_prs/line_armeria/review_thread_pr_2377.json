{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzU5NDU5MDYy", "number": 2377, "reviewThreads": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wNlQwOToyNDo0M1rODV7EWQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wNlQxMDo0MzoxM1rODV8OHw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI0MzE0NDU3OnYy", "diffSide": "RIGHT", "path": "core/src/main/java/com/linecorp/armeria/server/ServiceRequestContext.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wNlQwOToyNDo0M1rOFaY0tA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wNlQwOTozNjowMVrOFaZEtw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzIxNDAwNA==", "bodyText": "Space after :?", "url": "https://github.com/line/armeria/pull/2377#discussion_r363214004", "createdAt": "2020-01-06T09:24:43Z", "author": {"login": "trustin"}, "path": "core/src/main/java/com/linecorp/armeria/server/ServiceRequestContext.java", "diffHunk": "@@ -61,33 +60,54 @@\n \n     /**\n      * Returns the server-side context of the {@link Request} that is being handled in the current thread.\n+     * If the context is a {@link ClientRequestContext}, {@link ClientRequestContext#root()} is returned.\n      *\n      * @throws IllegalStateException if the context is unavailable in the current thread or\n-     *                               the current context is not a {@link ServiceRequestContext}.\n+     *                               the current context is a {@link ClientRequestContext} and\n+     *                               {@link ClientRequestContext#root()} is {@code null}\n      */\n     static ServiceRequestContext current() {\n         final RequestContext ctx = RequestContext.current();\n-        checkState(ctx instanceof ServiceRequestContext,\n-                   \"The current context is not a server-side context: %s\", ctx);\n-        return (ServiceRequestContext) ctx;\n+        if (ctx instanceof ServiceRequestContext) {\n+            return (ServiceRequestContext) ctx;\n+        }\n+\n+        final ServiceRequestContext root = ((ClientRequestContext) ctx).root();\n+        if (root != null) {\n+            return root;\n+        }\n+\n+        throw new IllegalStateException(\n+                \"The current context is not a server-side context and does not have a root \" +\n+                \"which means that the context is not invoked by a server request. ctx:\" + ctx);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "19db059b595f580af5351512a27cd8cca380b3a9"}, "originalPosition": 35}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzIxODEwMw==", "bodyText": "Oops~ \ud83d\ude05", "url": "https://github.com/line/armeria/pull/2377#discussion_r363218103", "createdAt": "2020-01-06T09:36:01Z", "author": {"login": "minwoox"}, "path": "core/src/main/java/com/linecorp/armeria/server/ServiceRequestContext.java", "diffHunk": "@@ -61,33 +60,54 @@\n \n     /**\n      * Returns the server-side context of the {@link Request} that is being handled in the current thread.\n+     * If the context is a {@link ClientRequestContext}, {@link ClientRequestContext#root()} is returned.\n      *\n      * @throws IllegalStateException if the context is unavailable in the current thread or\n-     *                               the current context is not a {@link ServiceRequestContext}.\n+     *                               the current context is a {@link ClientRequestContext} and\n+     *                               {@link ClientRequestContext#root()} is {@code null}\n      */\n     static ServiceRequestContext current() {\n         final RequestContext ctx = RequestContext.current();\n-        checkState(ctx instanceof ServiceRequestContext,\n-                   \"The current context is not a server-side context: %s\", ctx);\n-        return (ServiceRequestContext) ctx;\n+        if (ctx instanceof ServiceRequestContext) {\n+            return (ServiceRequestContext) ctx;\n+        }\n+\n+        final ServiceRequestContext root = ((ClientRequestContext) ctx).root();\n+        if (root != null) {\n+            return root;\n+        }\n+\n+        throw new IllegalStateException(\n+                \"The current context is not a server-side context and does not have a root \" +\n+                \"which means that the context is not invoked by a server request. ctx:\" + ctx);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzIxNDAwNA=="}, "originalCommit": {"oid": "19db059b595f580af5351512a27cd8cca380b3a9"}, "originalPosition": 35}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI0MzE0NTEwOnYy", "diffSide": "RIGHT", "path": "core/src/main/java/com/linecorp/armeria/server/ServiceRequestContext.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wNlQwOToyNDo1N1rOFaY1BQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wNlQwOToyNDo1N1rOFaY1BQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzIxNDA4NQ==", "bodyText": "Ditto", "url": "https://github.com/line/armeria/pull/2377#discussion_r363214085", "createdAt": "2020-01-06T09:24:57Z", "author": {"login": "trustin"}, "path": "core/src/main/java/com/linecorp/armeria/server/ServiceRequestContext.java", "diffHunk": "@@ -61,33 +60,54 @@\n \n     /**\n      * Returns the server-side context of the {@link Request} that is being handled in the current thread.\n+     * If the context is a {@link ClientRequestContext}, {@link ClientRequestContext#root()} is returned.\n      *\n      * @throws IllegalStateException if the context is unavailable in the current thread or\n-     *                               the current context is not a {@link ServiceRequestContext}.\n+     *                               the current context is a {@link ClientRequestContext} and\n+     *                               {@link ClientRequestContext#root()} is {@code null}\n      */\n     static ServiceRequestContext current() {\n         final RequestContext ctx = RequestContext.current();\n-        checkState(ctx instanceof ServiceRequestContext,\n-                   \"The current context is not a server-side context: %s\", ctx);\n-        return (ServiceRequestContext) ctx;\n+        if (ctx instanceof ServiceRequestContext) {\n+            return (ServiceRequestContext) ctx;\n+        }\n+\n+        final ServiceRequestContext root = ((ClientRequestContext) ctx).root();\n+        if (root != null) {\n+            return root;\n+        }\n+\n+        throw new IllegalStateException(\n+                \"The current context is not a server-side context and does not have a root \" +\n+                \"which means that the context is not invoked by a server request. ctx:\" + ctx);\n     }\n \n     /**\n      * Returns the server-side context of the {@link Request} that is being handled in the current thread.\n+     * If the context is a {@link ClientRequestContext}, {@link ClientRequestContext#root()} is returned.\n      *\n      * @return the {@link ServiceRequestContext} available in the current thread,\n      *         or {@code null} if unavailable.\n-     * @throws IllegalStateException if the current context is not a {@link ServiceRequestContext}.\n      */\n     @Nullable\n     static ServiceRequestContext currentOrNull() {\n         final RequestContext ctx = RequestContext.currentOrNull();\n         if (ctx == null) {\n             return null;\n         }\n-        checkState(ctx instanceof ServiceRequestContext,\n-                   \"The current context is not a server-side context: %s\", ctx);\n-        return (ServiceRequestContext) ctx;\n+\n+        if (ctx instanceof ServiceRequestContext) {\n+            return (ServiceRequestContext) ctx;\n+        }\n+\n+        final ServiceRequestContext root = ((ClientRequestContext) ctx).root();\n+        if (root != null) {\n+            return root;\n+        }\n+\n+        throw new IllegalStateException(\n+                \"The current context is not a server-side context and does not have a root \" +\n+                \"which means that the context is not invoked by a server request. ctx:\" + ctx);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "19db059b595f580af5351512a27cd8cca380b3a9"}, "originalPosition": 67}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI0MzIzNDYwOnYy", "diffSide": "RIGHT", "path": "core/src/test/java/com/linecorp/armeria/server/ServiceRequestContextTest.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wNlQxMDowMTozMVrOFaZp8A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wNlQxMDoyMDowM1rOFaaEFw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzIyNzYzMg==", "bodyText": "I think we can add readability and some documentation by asserting ClientRequestContext.current and RequestContext.current too.", "url": "https://github.com/line/armeria/pull/2377#discussion_r363227632", "createdAt": "2020-01-06T10:01:31Z", "author": {"login": "anuraaga"}, "path": "core/src/test/java/com/linecorp/armeria/server/ServiceRequestContextTest.java", "diffHunk": "@@ -67,6 +72,11 @@ void currentOrNull() {\n         try (SafeCloseable unused = ctx.push()) {\n             assertThat(onEnterExitStack).hasSize(1);\n             assertThat(ServiceRequestContext.currentOrNull()).isSameAs(ctx);\n+            try (SafeCloseable unused1 = clientRequestContext().push()) {\n+                assertThat(onEnterExitStack).hasSize(2);\n+                assertThat(ServiceRequestContext.currentOrNull()).isSameAs(ctx);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "70e7de6b7666c94ebe72391fa7bccad3b6dd274d"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzIzNDMyNw==", "bodyText": "That's a good suggestion. Let me add it.", "url": "https://github.com/line/armeria/pull/2377#discussion_r363234327", "createdAt": "2020-01-06T10:20:03Z", "author": {"login": "minwoox"}, "path": "core/src/test/java/com/linecorp/armeria/server/ServiceRequestContextTest.java", "diffHunk": "@@ -67,6 +72,11 @@ void currentOrNull() {\n         try (SafeCloseable unused = ctx.push()) {\n             assertThat(onEnterExitStack).hasSize(1);\n             assertThat(ServiceRequestContext.currentOrNull()).isSameAs(ctx);\n+            try (SafeCloseable unused1 = clientRequestContext().push()) {\n+                assertThat(onEnterExitStack).hasSize(2);\n+                assertThat(ServiceRequestContext.currentOrNull()).isSameAs(ctx);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzIyNzYzMg=="}, "originalCommit": {"oid": "70e7de6b7666c94ebe72391fa7bccad3b6dd274d"}, "originalPosition": 18}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI0MzIzNzM5OnYy", "diffSide": "RIGHT", "path": "core/src/test/java/com/linecorp/armeria/server/ServiceRequestContextTest.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wNlQxMDowMjozM1rOFaZrfw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wNlQxMDoyMDoyNlrOFaaEvw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzIyODAzMQ==", "bodyText": "I think these tests are too loose, and especially with the double-stack, the new test code is not testing anything interesting - we only assert that any context is mounted and mapped, but it may not necessarily be the right context. c == ctx ? \"foo\" : \"bar\"? Or add/read attributes? Not sure which is less tedious.", "url": "https://github.com/line/armeria/pull/2377#discussion_r363228031", "createdAt": "2020-01-06T10:02:33Z", "author": {"login": "anuraaga"}, "path": "core/src/test/java/com/linecorp/armeria/server/ServiceRequestContextTest.java", "diffHunk": "@@ -87,6 +97,12 @@ void mapCurrent() {\n             assertThat(onEnterExitStack).hasSize(1);\n             assertThat(ServiceRequestContext.mapCurrent(c -> \"foo\", () -> \"bar\")).isEqualTo(\"foo\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "70e7de6b7666c94ebe72391fa7bccad3b6dd274d"}, "originalPosition": 26}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzIzNDQ5NQ==", "bodyText": "That's a good point. c == ctx ? \"foo\" : \"bar\" is fine for me. Thanks!", "url": "https://github.com/line/armeria/pull/2377#discussion_r363234495", "createdAt": "2020-01-06T10:20:26Z", "author": {"login": "minwoox"}, "path": "core/src/test/java/com/linecorp/armeria/server/ServiceRequestContextTest.java", "diffHunk": "@@ -87,6 +97,12 @@ void mapCurrent() {\n             assertThat(onEnterExitStack).hasSize(1);\n             assertThat(ServiceRequestContext.mapCurrent(c -> \"foo\", () -> \"bar\")).isEqualTo(\"foo\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzIyODAzMQ=="}, "originalCommit": {"oid": "70e7de6b7666c94ebe72391fa7bccad3b6dd274d"}, "originalPosition": 26}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI0MzMzMzQzOnYy", "diffSide": "RIGHT", "path": "core/src/main/java/com/linecorp/armeria/server/ServiceRequestContext.java", "isResolved": false, "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wNlQxMDo0MzoxM1rOFaakUA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wNlQxMToyMDo0MlrOFabSMw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzI0MjU3Ng==", "bodyText": "nit: The Javadoc said the current context is a {@link ClientRequestContext} and. Don't we need to synchronize this too or revert the Javadoc?", "url": "https://github.com/line/armeria/pull/2377#discussion_r363242576", "createdAt": "2020-01-06T10:43:13Z", "author": {"login": "ikhoon"}, "path": "core/src/main/java/com/linecorp/armeria/server/ServiceRequestContext.java", "diffHunk": "@@ -61,33 +60,54 @@\n \n     /**\n      * Returns the server-side context of the {@link Request} that is being handled in the current thread.\n+     * If the context is a {@link ClientRequestContext}, {@link ClientRequestContext#root()} is returned.\n      *\n      * @throws IllegalStateException if the context is unavailable in the current thread or\n-     *                               the current context is not a {@link ServiceRequestContext}.\n+     *                               the current context is a {@link ClientRequestContext} and\n+     *                               {@link ClientRequestContext#root()} is {@code null}\n      */\n     static ServiceRequestContext current() {\n         final RequestContext ctx = RequestContext.current();\n-        checkState(ctx instanceof ServiceRequestContext,\n-                   \"The current context is not a server-side context: %s\", ctx);\n-        return (ServiceRequestContext) ctx;\n+        if (ctx instanceof ServiceRequestContext) {\n+            return (ServiceRequestContext) ctx;\n+        }\n+\n+        final ServiceRequestContext root = ((ClientRequestContext) ctx).root();\n+        if (root != null) {\n+            return root;\n+        }\n+\n+        throw new IllegalStateException(\n+                \"The current context is not a server-side context and does not have a root \" +", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cecb5108d202ef4b7ac4231060d73955de1531d5"}, "originalPosition": 34}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzI1MDg5NQ==", "bodyText": "I synced it. \ud83d\ude04", "url": "https://github.com/line/armeria/pull/2377#discussion_r363250895", "createdAt": "2020-01-06T11:09:19Z", "author": {"login": "minwoox"}, "path": "core/src/main/java/com/linecorp/armeria/server/ServiceRequestContext.java", "diffHunk": "@@ -61,33 +60,54 @@\n \n     /**\n      * Returns the server-side context of the {@link Request} that is being handled in the current thread.\n+     * If the context is a {@link ClientRequestContext}, {@link ClientRequestContext#root()} is returned.\n      *\n      * @throws IllegalStateException if the context is unavailable in the current thread or\n-     *                               the current context is not a {@link ServiceRequestContext}.\n+     *                               the current context is a {@link ClientRequestContext} and\n+     *                               {@link ClientRequestContext#root()} is {@code null}\n      */\n     static ServiceRequestContext current() {\n         final RequestContext ctx = RequestContext.current();\n-        checkState(ctx instanceof ServiceRequestContext,\n-                   \"The current context is not a server-side context: %s\", ctx);\n-        return (ServiceRequestContext) ctx;\n+        if (ctx instanceof ServiceRequestContext) {\n+            return (ServiceRequestContext) ctx;\n+        }\n+\n+        final ServiceRequestContext root = ((ClientRequestContext) ctx).root();\n+        if (root != null) {\n+            return root;\n+        }\n+\n+        throw new IllegalStateException(\n+                \"The current context is not a server-side context and does not have a root \" +", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzI0MjU3Ng=="}, "originalCommit": {"oid": "cecb5108d202ef4b7ac4231060d73955de1531d5"}, "originalPosition": 34}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzI1MjE1NA==", "bodyText": "Well let me revert this, because the context is not a client request context as well. It could be a fakeContext in a unit test.", "url": "https://github.com/line/armeria/pull/2377#discussion_r363252154", "createdAt": "2020-01-06T11:13:19Z", "author": {"login": "minwoox"}, "path": "core/src/main/java/com/linecorp/armeria/server/ServiceRequestContext.java", "diffHunk": "@@ -61,33 +60,54 @@\n \n     /**\n      * Returns the server-side context of the {@link Request} that is being handled in the current thread.\n+     * If the context is a {@link ClientRequestContext}, {@link ClientRequestContext#root()} is returned.\n      *\n      * @throws IllegalStateException if the context is unavailable in the current thread or\n-     *                               the current context is not a {@link ServiceRequestContext}.\n+     *                               the current context is a {@link ClientRequestContext} and\n+     *                               {@link ClientRequestContext#root()} is {@code null}\n      */\n     static ServiceRequestContext current() {\n         final RequestContext ctx = RequestContext.current();\n-        checkState(ctx instanceof ServiceRequestContext,\n-                   \"The current context is not a server-side context: %s\", ctx);\n-        return (ServiceRequestContext) ctx;\n+        if (ctx instanceof ServiceRequestContext) {\n+            return (ServiceRequestContext) ctx;\n+        }\n+\n+        final ServiceRequestContext root = ((ClientRequestContext) ctx).root();\n+        if (root != null) {\n+            return root;\n+        }\n+\n+        throw new IllegalStateException(\n+                \"The current context is not a server-side context and does not have a root \" +", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzI0MjU3Ng=="}, "originalCommit": {"oid": "cecb5108d202ef4b7ac4231060d73955de1531d5"}, "originalPosition": 34}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzI1MjI2Mg==", "bodyText": "In that case, the Javadoc still makes sense I guess.", "url": "https://github.com/line/armeria/pull/2377#discussion_r363252262", "createdAt": "2020-01-06T11:13:42Z", "author": {"login": "minwoox"}, "path": "core/src/main/java/com/linecorp/armeria/server/ServiceRequestContext.java", "diffHunk": "@@ -61,33 +60,54 @@\n \n     /**\n      * Returns the server-side context of the {@link Request} that is being handled in the current thread.\n+     * If the context is a {@link ClientRequestContext}, {@link ClientRequestContext#root()} is returned.\n      *\n      * @throws IllegalStateException if the context is unavailable in the current thread or\n-     *                               the current context is not a {@link ServiceRequestContext}.\n+     *                               the current context is a {@link ClientRequestContext} and\n+     *                               {@link ClientRequestContext#root()} is {@code null}\n      */\n     static ServiceRequestContext current() {\n         final RequestContext ctx = RequestContext.current();\n-        checkState(ctx instanceof ServiceRequestContext,\n-                   \"The current context is not a server-side context: %s\", ctx);\n-        return (ServiceRequestContext) ctx;\n+        if (ctx instanceof ServiceRequestContext) {\n+            return (ServiceRequestContext) ctx;\n+        }\n+\n+        final ServiceRequestContext root = ((ClientRequestContext) ctx).root();\n+        if (root != null) {\n+            return root;\n+        }\n+\n+        throw new IllegalStateException(\n+                \"The current context is not a server-side context and does not have a root \" +", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzI0MjU3Ng=="}, "originalCommit": {"oid": "cecb5108d202ef4b7ac4231060d73955de1531d5"}, "originalPosition": 34}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzI1NDMyMw==", "bodyText": "Ah, I misunderstood. Let revert this. :-)", "url": "https://github.com/line/armeria/pull/2377#discussion_r363254323", "createdAt": "2020-01-06T11:20:42Z", "author": {"login": "ikhoon"}, "path": "core/src/main/java/com/linecorp/armeria/server/ServiceRequestContext.java", "diffHunk": "@@ -61,33 +60,54 @@\n \n     /**\n      * Returns the server-side context of the {@link Request} that is being handled in the current thread.\n+     * If the context is a {@link ClientRequestContext}, {@link ClientRequestContext#root()} is returned.\n      *\n      * @throws IllegalStateException if the context is unavailable in the current thread or\n-     *                               the current context is not a {@link ServiceRequestContext}.\n+     *                               the current context is a {@link ClientRequestContext} and\n+     *                               {@link ClientRequestContext#root()} is {@code null}\n      */\n     static ServiceRequestContext current() {\n         final RequestContext ctx = RequestContext.current();\n-        checkState(ctx instanceof ServiceRequestContext,\n-                   \"The current context is not a server-side context: %s\", ctx);\n-        return (ServiceRequestContext) ctx;\n+        if (ctx instanceof ServiceRequestContext) {\n+            return (ServiceRequestContext) ctx;\n+        }\n+\n+        final ServiceRequestContext root = ((ClientRequestContext) ctx).root();\n+        if (root != null) {\n+            return root;\n+        }\n+\n+        throw new IllegalStateException(\n+                \"The current context is not a server-side context and does not have a root \" +", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzI0MjU3Ng=="}, "originalCommit": {"oid": "cecb5108d202ef4b7ac4231060d73955de1531d5"}, "originalPosition": 34}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2879, "cost": 1, "resetAt": "2021-11-12T20:44:06Z"}}}