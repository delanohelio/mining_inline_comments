{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzcxODg1MDM0", "number": 2464, "title": "Fix a bug where making IPv6 DnsQuestion when it's not supported", "bodyText": "Motivation:\nIf there's no network interfaces that support IPv6, we must not send a DNS query for that.\nModification:\n\nCheck the network interfaces in DnsAddressEndpointGourp not to make IPv6 DNS query.\nIgnore link-local IPv6 addresses which may exist even on a machine without IPv6 network.\n\nResult:\n\nDnsAddressEndpointGourp does not send DNS queries for AAAA when IPv6 is not available.", "createdAt": "2020-02-06T12:57:03Z", "url": "https://github.com/line/armeria/pull/2464", "merged": true, "mergeCommit": {"oid": "8ef3a8c8650ab13704826519c7c25a9a43331184"}, "closed": true, "closedAt": "2020-02-07T08:34:52Z", "author": {"login": "minwoox"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcBqSvEgH2gAyMzcxODg1MDM0OjU3MTdkYzBkN2YwNmZhYmU0YzdkZDBmNDg5NGJlZjE2NTBkN2JjY2U=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcB7AVLAFqTM1NDk5MjU2OQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "5717dc0d7f06fabe4c7dd0f4894bef1650d7bcce", "author": {"user": {"login": "minwoox", "name": "minux"}}, "url": "https://github.com/line/armeria/commit/5717dc0d7f06fabe4c7dd0f4894bef1650d7bcce", "committedDate": "2020-02-06T12:56:29Z", "message": "Fix a bug where making IPv6 DnsQuestion when it's not supported\nMotivation:\nIf there's no network interfaces which support IPv6, we must not send a dns query for that.\n\nModification:\n- Check the network interfaces in `DnsAddressEndpointGourp` not to make IPv6 dns query.\n\nResult:\n- Close #2444 perhaps?"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU0NDQ4NTgz", "url": "https://github.com/line/armeria/pull/2464#pullrequestreview-354448583", "createdAt": "2020-02-06T13:30:37Z", "commit": {"oid": "5717dc0d7f06fabe4c7dd0f4894bef1650d7bcce"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU0NDg2MjQx", "url": "https://github.com/line/armeria/pull/2464#pullrequestreview-354486241", "createdAt": "2020-02-06T14:23:34Z", "commit": {"oid": "5717dc0d7f06fabe4c7dd0f4894bef1650d7bcce"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNlQxNDoyMzozNFrOFmcx-w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNlQxNDoyMzozNFrOFmcx-w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTg2MTc1NQ==", "bodyText": "I think this code has been around for a long time - does it mean it's not a regression? It seems like it used to work though, but possibly an interaction with something else rather than a regression. Just want to check.", "url": "https://github.com/line/armeria/pull/2464#discussion_r375861755", "createdAt": "2020-02-06T14:23:34Z", "author": {"login": "anuraaga"}, "path": "core/src/main/java/com/linecorp/armeria/client/endpoint/dns/DnsAddressEndpointGroup.java", "diffHunk": "@@ -105,7 +106,7 @@ public static DnsAddressEndpointGroupBuilder builder(String hostname) {\n             String hostname, @Nullable ResolvedAddressTypes resolvedAddressTypes) {\n \n         if (resolvedAddressTypes == null) {\n-            if (NetUtil.isIpV4StackPreferred()) {\n+            if (NetUtil.isIpV4StackPreferred() || !anyInterfaceSupportsIpV6()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5717dc0d7f06fabe4c7dd0f4894bef1650d7bcce"}, "originalPosition": 13}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU0NTE3MjU2", "url": "https://github.com/line/armeria/pull/2464#pullrequestreview-354517256", "createdAt": "2020-02-06T15:01:50Z", "commit": {"oid": "5717dc0d7f06fabe4c7dd0f4894bef1650d7bcce"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "54eecb92e93459abccc7046d633ad57dcc4c141a", "author": {"user": {"login": "minwoox", "name": "minux"}}, "url": "https://github.com/line/armeria/commit/54eecb92e93459abccc7046d633ad57dcc4c141a", "committedDate": "2020-02-07T08:19:25Z", "message": "Add more conditions to check for IPv6"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU0OTkyNTY5", "url": "https://github.com/line/armeria/pull/2464#pullrequestreview-354992569", "createdAt": "2020-02-07T08:24:18Z", "commit": {"oid": "54eecb92e93459abccc7046d633ad57dcc4c141a"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wN1QwODoyNDoxOFrOFm1YFQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wN1QwODoyNDoxOFrOFm1YFQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjI2NDcyNQ==", "bodyText": "Yeah let's try", "url": "https://github.com/line/armeria/pull/2464#discussion_r376264725", "createdAt": "2020-02-07T08:24:18Z", "author": {"login": "anuraaga"}, "path": "core/src/main/java/com/linecorp/armeria/client/endpoint/dns/DnsAddressEndpointGroup.java", "diffHunk": "@@ -105,7 +106,7 @@ public static DnsAddressEndpointGroupBuilder builder(String hostname) {\n             String hostname, @Nullable ResolvedAddressTypes resolvedAddressTypes) {\n \n         if (resolvedAddressTypes == null) {\n-            if (NetUtil.isIpV4StackPreferred()) {\n+            if (NetUtil.isIpV4StackPreferred() || !anyInterfaceSupportsIpV6()) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTg2MTc1NQ=="}, "originalCommit": {"oid": "5717dc0d7f06fabe4c7dd0f4894bef1650d7bcce"}, "originalPosition": 13}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 978, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}