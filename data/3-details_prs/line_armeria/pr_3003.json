{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY5OTAyMjQz", "number": 3003, "title": "Abide by Reactive Streams spec 3.6 in FixedStreamMessage", "bodyText": "Motivation:\nAfter a Subscription has been cancelled, Subscription.request(n) should be NOPs.\nhttps://github.com/reactive-streams/reactive-streams-jvm#3.6\nHowever OneElementFixedStreamMessage throws AssertionError by the following condition.\n\n  \n    \n      armeria/core/src/main/java/com/linecorp/armeria/common/stream/OneElementFixedStreamMessage.java\n    \n    \n         Line 69\n      in\n      744098d\n    \n    \n    \n    \n\n        \n          \n           assert obj != null; \n        \n    \n  \n\n\nModifications:\n\nIgnore additional Subscription.request(n) signals\nwhen the stream has been closed already in FixedStreamMessage.\n\nResult:\n\nOneElementFixedStreamMessage does not throw AssertionError anymore\nwhen receiving Subscription.request(n) signal.", "createdAt": "2020-08-19T03:45:20Z", "url": "https://github.com/line/armeria/pull/3003", "merged": true, "mergeCommit": {"oid": "36d1f2e9a12ebac4cab5636aecdf958b1945d815"}, "closed": true, "closedAt": "2020-08-19T13:08:33Z", "author": {"login": "ikhoon"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdATEZXAH2gAyNDY5OTAyMjQzOjY3ZDNhMGMzYmQ0NGVkMjBiMDQ4NzI5ODBlZmRhYjcwZDFjYTJiMDg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdAbOUrgFqTQ3MDQzMTMxNg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "67d3a0c3bd44ed20b04872980efdab70d1ca2b08", "author": {"user": {"login": "ikhoon", "name": "Ikhun Um"}}, "url": "https://github.com/line/armeria/commit/67d3a0c3bd44ed20b04872980efdab70d1ca2b08", "committedDate": "2020-08-19T03:30:14Z", "message": "Abide by Reactive Streams spec 3.6 in FixedStreamMessage\n\nMotivation:\n\nAfter a Subscription has been cancelled, `Subscription.request(n)` should be NOPs.\nhttps://github.com/reactive-streams/reactive-streams-jvm#3.6\n\nHowever `OneElementFixedStreamMessage` throws `AssertionError` by the following condition.\nhttps://github.com/line/armeria/blob/744098d4ed83a65c6668fd863afebae14f5e2a1c/core/src/main/java/com/linecorp/armeria/common/stream/OneElementFixedStreamMessage.java#L69\n\nModifications:\n\n- Ignore additional `Subscripiton.request(n)` signals\n  when the stream has been cancelled already in FixedStreamMessage.\n\nResult:\n\n- `OneElementFixedStreamMessage` does not throw `AssertionError` anymore\n  when receiving `Subscription.request(n)` signal."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c95c0970d7289aafbf167208c532c4e4ebad6fb0", "author": {"user": {"login": "ikhoon", "name": "Ikhun Um"}}, "url": "https://github.com/line/armeria/commit/c95c0970d7289aafbf167208c532c4e4ebad6fb0", "committedDate": "2020-08-19T03:46:46Z", "message": "Add guard"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDcwMTQ0Nzc5", "url": "https://github.com/line/armeria/pull/3003#pullrequestreview-470144779", "createdAt": "2020-08-19T05:56:41Z", "commit": {"oid": "c95c0970d7289aafbf167208c532c4e4ebad6fb0"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOVQwNTo1Njo0MVrOHC1V7g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOVQwNTo1Njo0MVrOHC1V7g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjczMzE2Ng==", "bodyText": "Is this necessary? Can we just check if closeEvent is null?", "url": "https://github.com/line/armeria/pull/3003#discussion_r472733166", "createdAt": "2020-08-19T05:56:41Z", "author": {"login": "trustin"}, "path": "core/src/main/java/com/linecorp/armeria/common/stream/FixedStreamMessage.java", "diffHunk": "@@ -50,6 +50,7 @@\n     private volatile CloseEvent closeEvent;\n \n     private int requested;\n+    private volatile boolean cancelled;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c95c0970d7289aafbf167208c532c4e4ebad6fb0"}, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "24e944ad49bf73573f9d89298d39424bf8d5914e", "author": {"user": {"login": "ikhoon", "name": "Ikhun Um"}}, "url": "https://github.com/line/armeria/commit/24e944ad49bf73573f9d89298d39424bf8d5914e", "committedDate": "2020-08-19T12:19:52Z", "message": "Use closeEvent instead"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1183b59e3720817501877590ef885a88627419d4", "author": {"user": {"login": "ikhoon", "name": "Ikhun Um"}}, "url": "https://github.com/line/armeria/commit/1183b59e3720817501877590ef885a88627419d4", "committedDate": "2020-08-19T12:30:40Z", "message": "Clean up"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDcwNDEyMDMx", "url": "https://github.com/line/armeria/pull/3003#pullrequestreview-470412031", "createdAt": "2020-08-19T12:36:26Z", "commit": {"oid": "1183b59e3720817501877590ef885a88627419d4"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "aea2d432f759c6ea0f768d060dcc4e539782cd07", "author": {"user": {"login": "ikhoon", "name": "Ikhun Um"}}, "url": "https://github.com/line/armeria/commit/aea2d432f759c6ea0f768d060dcc4e539782cd07", "committedDate": "2020-08-19T12:46:45Z", "message": "Remove null check in cleanup"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDcwNDMxMzE2", "url": "https://github.com/line/armeria/pull/3003#pullrequestreview-470431316", "createdAt": "2020-08-19T13:00:19Z", "commit": {"oid": "aea2d432f759c6ea0f768d060dcc4e539782cd07"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 91, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}