{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc3MjI5Mzk3", "number": 2516, "reviewThreads": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMFQwNjowNTo1NVrODhZFXw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMFQxNDo1MjowOVrODhjgUA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM2MzQwNTc1OnYy", "diffSide": "RIGHT", "path": "core/src/main/java/com/linecorp/armeria/client/AbstractClientOptionsBuilder.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMFQwNjowNTo1NVrOFsGfEw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMFQwOToxODozMFrOFsLpAg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTc4NzkyMw==", "bodyText": "This is not very efficient because we have to do a lookup for each option. How about making AbstractOptions implement Iterable<AbstractOptionValue>?\npublic abstract class AbstractOptions<T extends AbstractOptionValue<?, ?>>\n        implements Iterable<T>", "url": "https://github.com/line/armeria/pull/2516#discussion_r381787923", "createdAt": "2020-02-20T06:05:55Z", "author": {"login": "trustin"}, "path": "core/src/main/java/com/linecorp/armeria/client/AbstractClientOptionsBuilder.java", "diffHunk": "@@ -60,7 +60,12 @@ protected AbstractClientOptionsBuilder(ClientOptions options) {\n      */\n     public AbstractClientOptionsBuilder options(ClientOptions options) {\n         requireNonNull(options, \"options\");\n-        options.asMap().values().forEach(this::option);\n+        for (ClientOption<Object> option : options.options()) {\n+            final Object value = options.getOrNull(option, false);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a1dbb8d3401f14ba12c48f0e397dd437c3320ac9"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTg3MjM4Ng==", "bodyText": "That sounds good. \ud83d\udc4d", "url": "https://github.com/line/armeria/pull/2516#discussion_r381872386", "createdAt": "2020-02-20T09:18:30Z", "author": {"login": "ikhoon"}, "path": "core/src/main/java/com/linecorp/armeria/client/AbstractClientOptionsBuilder.java", "diffHunk": "@@ -60,7 +60,12 @@ protected AbstractClientOptionsBuilder(ClientOptions options) {\n      */\n     public AbstractClientOptionsBuilder options(ClientOptions options) {\n         requireNonNull(options, \"options\");\n-        options.asMap().values().forEach(this::option);\n+        for (ClientOption<Object> option : options.options()) {\n+            final Object value = options.getOrNull(option, false);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTc4NzkyMw=="}, "originalCommit": {"oid": "a1dbb8d3401f14ba12c48f0e397dd437c3320ac9"}, "originalPosition": 6}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM2NTA1NzM0OnYy", "diffSide": "RIGHT", "path": "core/src/main/java/com/linecorp/armeria/client/ClientFactoryOptions.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMFQxNDozOTozMlrOFsV2xg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMFQxNDozOTozMlrOFsV2xg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjAzOTc1MA==", "bodyText": "Returns an empty singleton {@link ClientFactoryOptions}.", "url": "https://github.com/line/armeria/pull/2516#discussion_r382039750", "createdAt": "2020-02-20T14:39:32Z", "author": {"login": "trustin"}, "path": "core/src/main/java/com/linecorp/armeria/client/ClientFactoryOptions.java", "diffHunk": "@@ -99,13 +99,16 @@\n             ClientFactoryOption.METER_REGISTRY.newValue(Metrics.globalRegistry)\n     };\n \n-    private static final ClientFactoryOptions DEFAULT = new ClientFactoryOptions(DEFAULT_OPTIONS);\n+    @VisibleForTesting\n+    static final ClientFactoryOptions DEFAULT = new ClientFactoryOptions(DEFAULT_OPTIONS);\n+\n+    private static final ClientFactoryOptions EMPTY = new ClientFactoryOptions();\n \n     /**\n      * The default {@link ClientFactoryOptions}.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "21c4072289cdf8038c68f6f827254e403c3c70cb"}, "originalPosition": 36}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM2NTA3OTgwOnYy", "diffSide": "RIGHT", "path": "core/src/main/java/com/linecorp/armeria/common/util/AbstractOptions.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMFQxNDo0NDoyM1rOFsWD-g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMFQxNDo0NDoyM1rOFsWD-g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjA0MzEzMA==", "bodyText": "Could we make sure first and second have the same type parameter?\nMissing Javadoc", "url": "https://github.com/line/armeria/pull/2516#discussion_r382043130", "createdAt": "2020-02-20T14:44:23Z", "author": {"login": "trustin"}, "path": "core/src/main/java/com/linecorp/armeria/common/util/AbstractOptions.java", "diffHunk": "@@ -19,31 +19,60 @@\n \n import java.util.Arrays;\n import java.util.Collection;\n-import java.util.Collections;\n import java.util.IdentityHashMap;\n+import java.util.Iterator;\n import java.util.Map;\n import java.util.NoSuchElementException;\n \n import javax.annotation.Nullable;\n \n+import com.google.common.collect.Iterators;\n+\n /**\n  * A set of configuration options and their respective values.\n  *\n  * @see AbstractOption\n  * @see AbstractOptionValue\n  */\n-public abstract class AbstractOptions {\n+public abstract class AbstractOptions<T extends AbstractOptionValue<?, ?>> implements Iterable<T> {\n+\n+    protected static <V> V get(AbstractOptions<?> first, AbstractOptions<?> second, AbstractOption<V> option) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "21c4072289cdf8038c68f6f827254e403c3c70cb"}, "originalPosition": 23}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM2NTA4Njk0OnYy", "diffSide": "RIGHT", "path": "core/src/main/java/com/linecorp/armeria/common/util/AbstractOptions.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMFQxNDo0NjowNVrOFsWIGQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMFQxNDo0NjowNVrOFsWIGQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjA0NDE4NQ==", "bodyText": "Not necessarily part of this PR, but how about rewriting this method with MoreObjects.toStringHelper?", "url": "https://github.com/line/armeria/pull/2516#discussion_r382044185", "createdAt": "2020-02-20T14:46:05Z", "author": {"login": "trustin"}, "path": "core/src/main/java/com/linecorp/armeria/common/util/AbstractOptions.java", "diffHunk": "@@ -188,37 +201,14 @@ protected AbstractOptions(AbstractOptions baseOptions, AbstractOptions additiona\n         return optionValue != null ? optionValue.value() : null;\n     }\n \n-    /**\n-     * Returns the value of the specified {@code option}.\n-     *\n-     * @param <O> the type of the option\n-     * @param <V> the type of the value\n-     * @return the value of the specified {@code option}. {@code defaultValue} if there's no such option.\n-     */\n-    protected final <O extends AbstractOption<V>, V> V getOrElse0(O option, V defaultValue) {\n-        requireNonNull(defaultValue, \"defaultValue\");\n-        final V value = getOrNull0(option);\n-        if (value != null) {\n-            return value;\n-        } else {\n-            return defaultValue;\n-        }\n-    }\n-\n-    /**\n-     * Returns the {@link Map} whose key is {@link AbstractOption} and value is {@link AbstractOptionValue}.\n-     *\n-     * @param <K> the type of the options\n-     * @param <V> the type of the option values\n-     */\n-    @SuppressWarnings(\"unchecked\")\n-    protected final <K extends AbstractOption<?>, V extends AbstractOptionValue<K, ?>> Map<K, V> asMap0() {\n-        return Collections.unmodifiableMap((Map<? extends K, ? extends V>) valueMap);\n+    @Override\n+    public Iterator<T> iterator() {\n+        return Iterators.unmodifiableIterator(valueMap.values().iterator());\n     }\n \n     @Override\n     public String toString() {\n-        return toString(asMap0().values());\n+        return toString(valueMap.values());\n     }\n \n     static String toString(Collection<?> values) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "21c4072289cdf8038c68f6f827254e403c3c70cb"}, "originalPosition": 207}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM2NTA5NTY3OnYy", "diffSide": "RIGHT", "path": "core/src/test/java/com/linecorp/armeria/client/ClientFactoryOptionsTest.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMFQxNDo0ODowNFrOFsWNhA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMFQxNTowMToyMlrOFsWw1g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjA0NTU3Mg==", "bodyText": "Could use: https://joel-costigliola.github.io/assertj/core/api/org/assertj/core/api/AbstractIterableAssert.html#isEmpty() ?", "url": "https://github.com/line/armeria/pull/2516#discussion_r382045572", "createdAt": "2020-02-20T14:48:04Z", "author": {"login": "trustin"}, "path": "core/src/test/java/com/linecorp/armeria/client/ClientFactoryOptionsTest.java", "diffHunk": "@@ -0,0 +1,133 @@\n+/*\n+ * Copyright 2020 LINE Corporation\n+ *\n+ * LINE Corporation licenses this file to you under the Apache License,\n+ * version 2.0 (the \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at:\n+ *\n+ *   https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+ * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n+ * License for the specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package com.linecorp.armeria.client;\n+\n+import static com.google.common.collect.ImmutableSet.toImmutableSet;\n+import static com.linecorp.armeria.client.ClientFactoryOption.ADDRESS_RESOLVER_GROUP_FACTORY;\n+import static com.linecorp.armeria.client.ClientFactoryOption.CHANNEL_OPTIONS;\n+import static com.linecorp.armeria.client.ClientFactoryOption.CONNECTION_POOL_LISTENER;\n+import static com.linecorp.armeria.client.ClientFactoryOption.EVENT_LOOP_SCHEDULER_FACTORY;\n+import static com.linecorp.armeria.client.ClientFactoryOption.HTTP1_MAX_CHUNK_SIZE;\n+import static com.linecorp.armeria.client.ClientFactoryOption.HTTP1_MAX_HEADER_SIZE;\n+import static com.linecorp.armeria.client.ClientFactoryOption.HTTP1_MAX_INITIAL_LINE_LENGTH;\n+import static com.linecorp.armeria.client.ClientFactoryOption.HTTP2_INITIAL_CONNECTION_WINDOW_SIZE;\n+import static com.linecorp.armeria.client.ClientFactoryOption.HTTP2_INITIAL_STREAM_WINDOW_SIZE;\n+import static com.linecorp.armeria.client.ClientFactoryOption.HTTP2_MAX_FRAME_SIZE;\n+import static com.linecorp.armeria.client.ClientFactoryOption.HTTP2_MAX_HEADER_LIST_SIZE;\n+import static com.linecorp.armeria.client.ClientFactoryOption.IDLE_TIMEOUT_MILLIS;\n+import static com.linecorp.armeria.client.ClientFactoryOption.METER_REGISTRY;\n+import static com.linecorp.armeria.client.ClientFactoryOption.SHUTDOWN_WORKER_GROUP_ON_CLOSE;\n+import static com.linecorp.armeria.client.ClientFactoryOption.USE_HTTP1_PIPELINING;\n+import static com.linecorp.armeria.client.ClientFactoryOption.USE_HTTP2_PREFACE;\n+import static com.linecorp.armeria.client.ClientFactoryOption.WORKER_GROUP;\n+import static com.linecorp.armeria.client.ClientOptionsTest.getAllPublicStaticFinal;\n+import static org.assertj.core.api.Assertions.assertThat;\n+import static org.junit.jupiter.params.provider.Arguments.arguments;\n+\n+import java.net.InetSocketAddress;\n+import java.util.Set;\n+import java.util.concurrent.TimeUnit;\n+import java.util.function.Function;\n+import java.util.stream.Stream;\n+\n+import org.junit.jupiter.api.AfterAll;\n+import org.junit.jupiter.api.BeforeAll;\n+import org.junit.jupiter.api.Test;\n+import org.junit.jupiter.api.extension.ExtensionContext;\n+import org.junit.jupiter.params.ParameterizedTest;\n+import org.junit.jupiter.params.provider.Arguments;\n+import org.junit.jupiter.params.provider.ArgumentsProvider;\n+import org.junit.jupiter.params.provider.ArgumentsSource;\n+\n+import com.google.common.collect.ImmutableList;\n+import com.google.common.collect.ImmutableMap;\n+import com.google.common.collect.Iterables;\n+import com.google.common.collect.Streams;\n+import com.google.common.util.concurrent.MoreExecutors;\n+\n+import com.linecorp.armeria.common.util.AbstractOptionValue;\n+import com.linecorp.armeria.common.util.EventLoopGroups;\n+\n+import io.micrometer.core.instrument.Metrics;\n+import io.netty.channel.EventLoopGroup;\n+import io.netty.resolver.AddressResolverGroup;\n+\n+class ClientFactoryOptionsTest {\n+\n+    static EventLoopGroup executors;\n+\n+    @BeforeAll\n+    static void setUp() {\n+        executors = EventLoopGroups.newEventLoopGroup(1);\n+    }\n+\n+    @AfterAll\n+    static void tearDown() {\n+        assertThat(MoreExecutors.shutdownAndAwaitTermination(executors, 10, TimeUnit.SECONDS)).isTrue();\n+    }\n+\n+    @Test\n+    void allDefaultOptionsArePresent() throws Exception {\n+        @SuppressWarnings(\"rawtypes\")\n+        final Set<ClientFactoryOption> options = getAllPublicStaticFinal(ClientFactoryOption.class);\n+        final Set<ClientFactoryOption<?>> defaults = Streams.stream(ClientFactoryOptions.DEFAULT)\n+                                                            .map(AbstractOptionValue::option)\n+                                                            .collect(toImmutableSet());\n+\n+        assertThat(defaults).isEqualTo(options);\n+        assertThat(Iterables.size(ClientFactoryOptions.of())).isZero();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "21c4072289cdf8038c68f6f827254e403c3c70cb"}, "originalPosition": 92}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjA1NDYxNA==", "bodyText": "Oh, Nice tip!", "url": "https://github.com/line/armeria/pull/2516#discussion_r382054614", "createdAt": "2020-02-20T15:01:22Z", "author": {"login": "ikhoon"}, "path": "core/src/test/java/com/linecorp/armeria/client/ClientFactoryOptionsTest.java", "diffHunk": "@@ -0,0 +1,133 @@\n+/*\n+ * Copyright 2020 LINE Corporation\n+ *\n+ * LINE Corporation licenses this file to you under the Apache License,\n+ * version 2.0 (the \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at:\n+ *\n+ *   https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+ * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n+ * License for the specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package com.linecorp.armeria.client;\n+\n+import static com.google.common.collect.ImmutableSet.toImmutableSet;\n+import static com.linecorp.armeria.client.ClientFactoryOption.ADDRESS_RESOLVER_GROUP_FACTORY;\n+import static com.linecorp.armeria.client.ClientFactoryOption.CHANNEL_OPTIONS;\n+import static com.linecorp.armeria.client.ClientFactoryOption.CONNECTION_POOL_LISTENER;\n+import static com.linecorp.armeria.client.ClientFactoryOption.EVENT_LOOP_SCHEDULER_FACTORY;\n+import static com.linecorp.armeria.client.ClientFactoryOption.HTTP1_MAX_CHUNK_SIZE;\n+import static com.linecorp.armeria.client.ClientFactoryOption.HTTP1_MAX_HEADER_SIZE;\n+import static com.linecorp.armeria.client.ClientFactoryOption.HTTP1_MAX_INITIAL_LINE_LENGTH;\n+import static com.linecorp.armeria.client.ClientFactoryOption.HTTP2_INITIAL_CONNECTION_WINDOW_SIZE;\n+import static com.linecorp.armeria.client.ClientFactoryOption.HTTP2_INITIAL_STREAM_WINDOW_SIZE;\n+import static com.linecorp.armeria.client.ClientFactoryOption.HTTP2_MAX_FRAME_SIZE;\n+import static com.linecorp.armeria.client.ClientFactoryOption.HTTP2_MAX_HEADER_LIST_SIZE;\n+import static com.linecorp.armeria.client.ClientFactoryOption.IDLE_TIMEOUT_MILLIS;\n+import static com.linecorp.armeria.client.ClientFactoryOption.METER_REGISTRY;\n+import static com.linecorp.armeria.client.ClientFactoryOption.SHUTDOWN_WORKER_GROUP_ON_CLOSE;\n+import static com.linecorp.armeria.client.ClientFactoryOption.USE_HTTP1_PIPELINING;\n+import static com.linecorp.armeria.client.ClientFactoryOption.USE_HTTP2_PREFACE;\n+import static com.linecorp.armeria.client.ClientFactoryOption.WORKER_GROUP;\n+import static com.linecorp.armeria.client.ClientOptionsTest.getAllPublicStaticFinal;\n+import static org.assertj.core.api.Assertions.assertThat;\n+import static org.junit.jupiter.params.provider.Arguments.arguments;\n+\n+import java.net.InetSocketAddress;\n+import java.util.Set;\n+import java.util.concurrent.TimeUnit;\n+import java.util.function.Function;\n+import java.util.stream.Stream;\n+\n+import org.junit.jupiter.api.AfterAll;\n+import org.junit.jupiter.api.BeforeAll;\n+import org.junit.jupiter.api.Test;\n+import org.junit.jupiter.api.extension.ExtensionContext;\n+import org.junit.jupiter.params.ParameterizedTest;\n+import org.junit.jupiter.params.provider.Arguments;\n+import org.junit.jupiter.params.provider.ArgumentsProvider;\n+import org.junit.jupiter.params.provider.ArgumentsSource;\n+\n+import com.google.common.collect.ImmutableList;\n+import com.google.common.collect.ImmutableMap;\n+import com.google.common.collect.Iterables;\n+import com.google.common.collect.Streams;\n+import com.google.common.util.concurrent.MoreExecutors;\n+\n+import com.linecorp.armeria.common.util.AbstractOptionValue;\n+import com.linecorp.armeria.common.util.EventLoopGroups;\n+\n+import io.micrometer.core.instrument.Metrics;\n+import io.netty.channel.EventLoopGroup;\n+import io.netty.resolver.AddressResolverGroup;\n+\n+class ClientFactoryOptionsTest {\n+\n+    static EventLoopGroup executors;\n+\n+    @BeforeAll\n+    static void setUp() {\n+        executors = EventLoopGroups.newEventLoopGroup(1);\n+    }\n+\n+    @AfterAll\n+    static void tearDown() {\n+        assertThat(MoreExecutors.shutdownAndAwaitTermination(executors, 10, TimeUnit.SECONDS)).isTrue();\n+    }\n+\n+    @Test\n+    void allDefaultOptionsArePresent() throws Exception {\n+        @SuppressWarnings(\"rawtypes\")\n+        final Set<ClientFactoryOption> options = getAllPublicStaticFinal(ClientFactoryOption.class);\n+        final Set<ClientFactoryOption<?>> defaults = Streams.stream(ClientFactoryOptions.DEFAULT)\n+                                                            .map(AbstractOptionValue::option)\n+                                                            .collect(toImmutableSet());\n+\n+        assertThat(defaults).isEqualTo(options);\n+        assertThat(Iterables.size(ClientFactoryOptions.of())).isZero();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjA0NTU3Mg=="}, "originalCommit": {"oid": "21c4072289cdf8038c68f6f827254e403c3c70cb"}, "originalPosition": 92}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM2NTEwMjk3OnYy", "diffSide": "RIGHT", "path": "core/src/test/java/com/linecorp/armeria/client/WebClientBuilderTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMFQxNDo0OTo0MlrOFsWRwQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMFQxNDo0OTo0MlrOFsWRwQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjA0NjY1Nw==", "bodyText": "Indentation", "url": "https://github.com/line/armeria/pull/2516#discussion_r382046657", "createdAt": "2020-02-20T14:49:42Z", "author": {"login": "trustin"}, "path": "core/src/test/java/com/linecorp/armeria/client/WebClientBuilderTest.java", "diffHunk": "@@ -0,0 +1,87 @@\n+/*\n+ * Copyright 2020 LINE Corporation\n+ *\n+ * LINE Corporation licenses this file to you under the Apache License,\n+ * version 2.0 (the \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at:\n+ *\n+ *   https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+ * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n+ * License for the specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package com.linecorp.armeria.client;\n+\n+import static org.assertj.core.api.Assertions.assertThat;\n+\n+import org.junit.jupiter.api.Test;\n+\n+class WebClientBuilderTest {\n+\n+    @Test\n+    void keepCustomFactory() {\n+        final ClientFactory factory = ClientFactory.builder()\n+                                                   .option(ClientFactoryOption.HTTP1_MAX_CHUNK_SIZE, 100)\n+                                                   .build();\n+        final ClientOptions options = ClientOptions.of(ClientOption.RESPONSE_TIMEOUT_MILLIS.newValue(200L));\n+        final WebClient webClient = WebClient.builder(\"http://foo\")\n+                                             .factory(factory)\n+                                             .options(options)\n+                                             .build();\n+\n+        final ClientOptions clientOptions = webClient.options();\n+        assertThat(clientOptions.get(ClientOption.RESPONSE_TIMEOUT_MILLIS)).isEqualTo(200);\n+        final ClientFactory clientFactory = clientOptions.factory();\n+        assertThat(clientFactory.options().get(ClientFactoryOption.HTTP1_MAX_CHUNK_SIZE)).isEqualTo(100);\n+    }\n+\n+    @Test\n+    void keepLastFactory_by_options() {\n+        final ClientFactory optionClientFactory = ClientFactory.builder()\n+                                                    .option(ClientFactoryOption.HTTP1_MAX_CHUNK_SIZE, 200)\n+                                                    .build();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "21c4072289cdf8038c68f6f827254e403c3c70cb"}, "originalPosition": 46}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM2NTEwNDg1OnYy", "diffSide": "RIGHT", "path": "core/src/test/java/com/linecorp/armeria/client/WebClientBuilderTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMFQxNDo1MDoxMFrOFsWS9Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMFQxNDo1MDoxMFrOFsWS9Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjA0Njk2NQ==", "bodyText": "Indentation", "url": "https://github.com/line/armeria/pull/2516#discussion_r382046965", "createdAt": "2020-02-20T14:50:10Z", "author": {"login": "trustin"}, "path": "core/src/test/java/com/linecorp/armeria/client/WebClientBuilderTest.java", "diffHunk": "@@ -0,0 +1,87 @@\n+/*\n+ * Copyright 2020 LINE Corporation\n+ *\n+ * LINE Corporation licenses this file to you under the Apache License,\n+ * version 2.0 (the \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at:\n+ *\n+ *   https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+ * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n+ * License for the specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package com.linecorp.armeria.client;\n+\n+import static org.assertj.core.api.Assertions.assertThat;\n+\n+import org.junit.jupiter.api.Test;\n+\n+class WebClientBuilderTest {\n+\n+    @Test\n+    void keepCustomFactory() {\n+        final ClientFactory factory = ClientFactory.builder()\n+                                                   .option(ClientFactoryOption.HTTP1_MAX_CHUNK_SIZE, 100)\n+                                                   .build();\n+        final ClientOptions options = ClientOptions.of(ClientOption.RESPONSE_TIMEOUT_MILLIS.newValue(200L));\n+        final WebClient webClient = WebClient.builder(\"http://foo\")\n+                                             .factory(factory)\n+                                             .options(options)\n+                                             .build();\n+\n+        final ClientOptions clientOptions = webClient.options();\n+        assertThat(clientOptions.get(ClientOption.RESPONSE_TIMEOUT_MILLIS)).isEqualTo(200);\n+        final ClientFactory clientFactory = clientOptions.factory();\n+        assertThat(clientFactory.options().get(ClientFactoryOption.HTTP1_MAX_CHUNK_SIZE)).isEqualTo(100);\n+    }\n+\n+    @Test\n+    void keepLastFactory_by_options() {\n+        final ClientFactory optionClientFactory = ClientFactory.builder()\n+                                                    .option(ClientFactoryOption.HTTP1_MAX_CHUNK_SIZE, 200)\n+                                                    .build();\n+        final ClientOptions options = ClientOptions.of(ClientOption.RESPONSE_TIMEOUT_MILLIS.newValue(200L),\n+                                                       ClientOption.FACTORY.newValue(optionClientFactory));\n+\n+        final ClientFactory factory = ClientFactory.builder()\n+                                                    .option(ClientFactoryOption.HTTP1_MAX_CHUNK_SIZE, 100)\n+                                                    .build();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "21c4072289cdf8038c68f6f827254e403c3c70cb"}, "originalPosition": 52}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM2NTEwNTU3OnYy", "diffSide": "RIGHT", "path": "core/src/test/java/com/linecorp/armeria/client/WebClientBuilderTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMFQxNDo1MDoyMlrOFsWTbw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMFQxNDo1MDoyMlrOFsWTbw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjA0NzA4Nw==", "bodyText": "Indentation", "url": "https://github.com/line/armeria/pull/2516#discussion_r382047087", "createdAt": "2020-02-20T14:50:22Z", "author": {"login": "trustin"}, "path": "core/src/test/java/com/linecorp/armeria/client/WebClientBuilderTest.java", "diffHunk": "@@ -0,0 +1,87 @@\n+/*\n+ * Copyright 2020 LINE Corporation\n+ *\n+ * LINE Corporation licenses this file to you under the Apache License,\n+ * version 2.0 (the \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at:\n+ *\n+ *   https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+ * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n+ * License for the specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package com.linecorp.armeria.client;\n+\n+import static org.assertj.core.api.Assertions.assertThat;\n+\n+import org.junit.jupiter.api.Test;\n+\n+class WebClientBuilderTest {\n+\n+    @Test\n+    void keepCustomFactory() {\n+        final ClientFactory factory = ClientFactory.builder()\n+                                                   .option(ClientFactoryOption.HTTP1_MAX_CHUNK_SIZE, 100)\n+                                                   .build();\n+        final ClientOptions options = ClientOptions.of(ClientOption.RESPONSE_TIMEOUT_MILLIS.newValue(200L));\n+        final WebClient webClient = WebClient.builder(\"http://foo\")\n+                                             .factory(factory)\n+                                             .options(options)\n+                                             .build();\n+\n+        final ClientOptions clientOptions = webClient.options();\n+        assertThat(clientOptions.get(ClientOption.RESPONSE_TIMEOUT_MILLIS)).isEqualTo(200);\n+        final ClientFactory clientFactory = clientOptions.factory();\n+        assertThat(clientFactory.options().get(ClientFactoryOption.HTTP1_MAX_CHUNK_SIZE)).isEqualTo(100);\n+    }\n+\n+    @Test\n+    void keepLastFactory_by_options() {\n+        final ClientFactory optionClientFactory = ClientFactory.builder()\n+                                                    .option(ClientFactoryOption.HTTP1_MAX_CHUNK_SIZE, 200)\n+                                                    .build();\n+        final ClientOptions options = ClientOptions.of(ClientOption.RESPONSE_TIMEOUT_MILLIS.newValue(200L),\n+                                                       ClientOption.FACTORY.newValue(optionClientFactory));\n+\n+        final ClientFactory factory = ClientFactory.builder()\n+                                                    .option(ClientFactoryOption.HTTP1_MAX_CHUNK_SIZE, 100)\n+                                                    .build();\n+\n+        final WebClient webClient = WebClient.builder(\"http://foo\")\n+                                             .factory(factory)\n+                                             .options(options)\n+                                             .build();\n+\n+        final ClientOptions clientOptions = webClient.options();\n+        assertThat(clientOptions.get(ClientOption.RESPONSE_TIMEOUT_MILLIS)).isEqualTo(200);\n+        final ClientFactory clientFactory = clientOptions.factory();\n+        assertThat(clientFactory.options().get(ClientFactoryOption.HTTP1_MAX_CHUNK_SIZE)).isEqualTo(200);\n+    }\n+\n+    @Test\n+    void keepLastFactory_by_factory() {\n+        final ClientFactory optionClientFactory = ClientFactory.builder()\n+                                                    .option(ClientFactoryOption.HTTP1_MAX_CHUNK_SIZE, 200)\n+                                                    .build();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "21c4072289cdf8038c68f6f827254e403c3c70cb"}, "originalPosition": 69}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM2NTEwNjAxOnYy", "diffSide": "RIGHT", "path": "core/src/test/java/com/linecorp/armeria/client/WebClientBuilderTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMFQxNDo1MDoyOFrOFsWTsw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMFQxNDo1MDoyOFrOFsWTsw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjA0NzE1NQ==", "bodyText": "Indentation", "url": "https://github.com/line/armeria/pull/2516#discussion_r382047155", "createdAt": "2020-02-20T14:50:28Z", "author": {"login": "trustin"}, "path": "core/src/test/java/com/linecorp/armeria/client/WebClientBuilderTest.java", "diffHunk": "@@ -0,0 +1,87 @@\n+/*\n+ * Copyright 2020 LINE Corporation\n+ *\n+ * LINE Corporation licenses this file to you under the Apache License,\n+ * version 2.0 (the \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at:\n+ *\n+ *   https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+ * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n+ * License for the specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package com.linecorp.armeria.client;\n+\n+import static org.assertj.core.api.Assertions.assertThat;\n+\n+import org.junit.jupiter.api.Test;\n+\n+class WebClientBuilderTest {\n+\n+    @Test\n+    void keepCustomFactory() {\n+        final ClientFactory factory = ClientFactory.builder()\n+                                                   .option(ClientFactoryOption.HTTP1_MAX_CHUNK_SIZE, 100)\n+                                                   .build();\n+        final ClientOptions options = ClientOptions.of(ClientOption.RESPONSE_TIMEOUT_MILLIS.newValue(200L));\n+        final WebClient webClient = WebClient.builder(\"http://foo\")\n+                                             .factory(factory)\n+                                             .options(options)\n+                                             .build();\n+\n+        final ClientOptions clientOptions = webClient.options();\n+        assertThat(clientOptions.get(ClientOption.RESPONSE_TIMEOUT_MILLIS)).isEqualTo(200);\n+        final ClientFactory clientFactory = clientOptions.factory();\n+        assertThat(clientFactory.options().get(ClientFactoryOption.HTTP1_MAX_CHUNK_SIZE)).isEqualTo(100);\n+    }\n+\n+    @Test\n+    void keepLastFactory_by_options() {\n+        final ClientFactory optionClientFactory = ClientFactory.builder()\n+                                                    .option(ClientFactoryOption.HTTP1_MAX_CHUNK_SIZE, 200)\n+                                                    .build();\n+        final ClientOptions options = ClientOptions.of(ClientOption.RESPONSE_TIMEOUT_MILLIS.newValue(200L),\n+                                                       ClientOption.FACTORY.newValue(optionClientFactory));\n+\n+        final ClientFactory factory = ClientFactory.builder()\n+                                                    .option(ClientFactoryOption.HTTP1_MAX_CHUNK_SIZE, 100)\n+                                                    .build();\n+\n+        final WebClient webClient = WebClient.builder(\"http://foo\")\n+                                             .factory(factory)\n+                                             .options(options)\n+                                             .build();\n+\n+        final ClientOptions clientOptions = webClient.options();\n+        assertThat(clientOptions.get(ClientOption.RESPONSE_TIMEOUT_MILLIS)).isEqualTo(200);\n+        final ClientFactory clientFactory = clientOptions.factory();\n+        assertThat(clientFactory.options().get(ClientFactoryOption.HTTP1_MAX_CHUNK_SIZE)).isEqualTo(200);\n+    }\n+\n+    @Test\n+    void keepLastFactory_by_factory() {\n+        final ClientFactory optionClientFactory = ClientFactory.builder()\n+                                                    .option(ClientFactoryOption.HTTP1_MAX_CHUNK_SIZE, 200)\n+                                                    .build();\n+        final ClientOptions options = ClientOptions.of(ClientOption.RESPONSE_TIMEOUT_MILLIS.newValue(200L),\n+                                                       ClientOption.FACTORY.newValue(optionClientFactory));\n+\n+        final ClientFactory factory = ClientFactory.builder()\n+                                                    .option(ClientFactoryOption.HTTP1_MAX_CHUNK_SIZE, 100)\n+                                                    .build();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "21c4072289cdf8038c68f6f827254e403c3c70cb"}, "originalPosition": 75}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM2NTExMjI4OnYy", "diffSide": "RIGHT", "path": "core/src/main/java/com/linecorp/armeria/client/ClientFactoryOptions.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMFQxNDo1MTo1NVrOFsWXnQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMFQxNDo1ODoxNlrOFsWoaQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjA0ODE1Nw==", "bodyText": "Unused?", "url": "https://github.com/line/armeria/pull/2516#discussion_r382048157", "createdAt": "2020-02-20T14:51:55Z", "author": {"login": "trustin"}, "path": "core/src/main/java/com/linecorp/armeria/client/ClientFactoryOptions.java", "diffHunk": "@@ -223,7 +226,16 @@ private ClientFactoryOptions(ClientFactoryOptions baseOptions,\n      */\n     @Nullable\n     public <T> T getOrNull(ClientFactoryOption<T> option) {\n-        return getOrNull0(option);\n+        return getOrNull(this, DEFAULT, option);\n+    }\n+\n+    @Nullable\n+    <T> T getOrNull(ClientFactoryOption<T> option, boolean includeDefault) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "21c4072289cdf8038c68f6f827254e403c3c70cb"}, "originalPosition": 62}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjA1MjQ1Nw==", "bodyText": "Oops..", "url": "https://github.com/line/armeria/pull/2516#discussion_r382052457", "createdAt": "2020-02-20T14:58:16Z", "author": {"login": "ikhoon"}, "path": "core/src/main/java/com/linecorp/armeria/client/ClientFactoryOptions.java", "diffHunk": "@@ -223,7 +226,16 @@ private ClientFactoryOptions(ClientFactoryOptions baseOptions,\n      */\n     @Nullable\n     public <T> T getOrNull(ClientFactoryOption<T> option) {\n-        return getOrNull0(option);\n+        return getOrNull(this, DEFAULT, option);\n+    }\n+\n+    @Nullable\n+    <T> T getOrNull(ClientFactoryOption<T> option, boolean includeDefault) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjA0ODE1Nw=="}, "originalCommit": {"oid": "21c4072289cdf8038c68f6f827254e403c3c70cb"}, "originalPosition": 62}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM2NTExMzEyOnYy", "diffSide": "RIGHT", "path": "core/src/main/java/com/linecorp/armeria/client/ClientOptions.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMFQxNDo1MjowOVrOFsWYLg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMFQxNDo1MjowOVrOFsWYLg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjA0ODMwMg==", "bodyText": "Unused?", "url": "https://github.com/line/armeria/pull/2516#discussion_r382048302", "createdAt": "2020-02-20T14:52:09Z", "author": {"login": "trustin"}, "path": "core/src/main/java/com/linecorp/armeria/client/ClientOptions.java", "diffHunk": "@@ -262,7 +254,16 @@ private ClientOptions(ClientOptions baseOptions, ClientOptions additionalOptions\n      */\n     @Nullable\n     public <T> T getOrNull(ClientOption<T> option) {\n-        return getOrNull0(option);\n+        return getOrNull(this, DEFAULT, option);\n+    }\n+\n+    @Nullable\n+    <T> T getOrNull(ClientOption<T> option, boolean includeDefault) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "21c4072289cdf8038c68f6f827254e403c3c70cb"}, "originalPosition": 121}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2677, "cost": 1, "resetAt": "2021-11-12T20:44:06Z"}}}