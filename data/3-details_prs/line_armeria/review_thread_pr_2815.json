{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM2MzM2MjQ3", "number": 2815, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOFQwOToyNDowOFrOEGq_hQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOFQxMjo1NTozNVrOEGvPVQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc1NDMxMzAxOnYy", "diffSide": "RIGHT", "path": "core/src/main/java/com/linecorp/armeria/internal/server/ResponseConversionUtil.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOFQwOToyNDowOFrOGlnIbg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOFQxMzowOToyMFrOGlug6g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjA5MTYzMA==", "bodyText": "Question: Don't we need to check whether writer is open like we did in onError(...)?", "url": "https://github.com/line/armeria/pull/2815#discussion_r442091630", "createdAt": "2020-06-18T09:24:08Z", "author": {"login": "ikhoon"}, "path": "core/src/main/java/com/linecorp/armeria/internal/server/ResponseConversionUtil.java", "diffHunk": "@@ -227,7 +227,12 @@ public void onNext(T value) {\n                     subscription.request(1);\n                 });\n             } catch (Exception e) {\n-                onError(e);\n+                try {\n+                    writer.close(e);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "af2df0254bcd2577343e0a4e4a15f0dfaa88fe20"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjIxMjU4Ng==", "bodyText": "I think it's okay just to call it because we checked it at line 214.", "url": "https://github.com/line/armeria/pull/2815#discussion_r442212586", "createdAt": "2020-06-18T13:09:20Z", "author": {"login": "minwoox"}, "path": "core/src/main/java/com/linecorp/armeria/internal/server/ResponseConversionUtil.java", "diffHunk": "@@ -227,7 +227,12 @@ public void onNext(T value) {\n                     subscription.request(1);\n                 });\n             } catch (Exception e) {\n-                onError(e);\n+                try {\n+                    writer.close(e);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjA5MTYzMA=="}, "originalCommit": {"oid": "af2df0254bcd2577343e0a4e4a15f0dfaa88fe20"}, "originalPosition": 6}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc1NTAwODg1OnYy", "diffSide": "RIGHT", "path": "core/src/main/java/com/linecorp/armeria/internal/server/ResponseConversionUtil.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOFQxMjo1NTozNVrOGlt_2A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOFQxMzowODoxMlrOGlueJQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjIwNDEyMA==", "bodyText": "try...catch and throwIfFatal(...)?", "url": "https://github.com/line/armeria/pull/2815#discussion_r442204120", "createdAt": "2020-06-18T12:55:35Z", "author": {"login": "ikhoon"}, "path": "core/src/main/java/com/linecorp/armeria/internal/server/ResponseConversionUtil.java", "diffHunk": "@@ -236,14 +241,7 @@ public void onError(Throwable cause) {\n             if (!writer.isOpen()) {\n                 return;\n             }\n-            try {\n-                writer.close(cause);\n-            } catch (Exception e) {\n-                // 'subscription.cancel()' would be called by the close future listener of the writer,\n-                // so we call it when we failed to close the writer.\n-                assert subscription != null;\n-                subscription.cancel();\n-            }\n+            writer.close(cause);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "defa548af5cd017e620d2c8a798741d5353b4872"}, "originalPosition": 26}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjIxMTg3Nw==", "bodyText": "try...catch and throwIfFatal(...)?\n\nIt's done by the caller such as:\nhttps://github.com/line/armeria/blob/master/core/src/main/java/com/linecorp/armeria/common/stream/AbstractStreamMessage.java#L165", "url": "https://github.com/line/armeria/pull/2815#discussion_r442211877", "createdAt": "2020-06-18T13:08:12Z", "author": {"login": "minwoox"}, "path": "core/src/main/java/com/linecorp/armeria/internal/server/ResponseConversionUtil.java", "diffHunk": "@@ -236,14 +241,7 @@ public void onError(Throwable cause) {\n             if (!writer.isOpen()) {\n                 return;\n             }\n-            try {\n-                writer.close(cause);\n-            } catch (Exception e) {\n-                // 'subscription.cancel()' would be called by the close future listener of the writer,\n-                // so we call it when we failed to close the writer.\n-                assert subscription != null;\n-                subscription.cancel();\n-            }\n+            writer.close(cause);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjIwNDEyMA=="}, "originalCommit": {"oid": "defa548af5cd017e620d2c8a798741d5353b4872"}, "originalPosition": 26}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2364, "cost": 1, "resetAt": "2021-11-12T20:44:06Z"}}}