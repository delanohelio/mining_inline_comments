{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY1MjY3Nzc5", "number": 2985, "title": "Fix a bug where HAProxy server handler throws `NPE` if an address fam\u2026", "bodyText": "\u2026ily is AF_UNSPEC\nReported by @cj848\nMotivation:\nArmeria HAProxy handler considers that a HAProxyMessage contains address information.\nHowever, if the address family is AF_UNSPEC, the addresses are null always.\nFrom the HAProxy spec, the receiver can accept the connection or reject it.\nThere seems to be no harm ignoring the addresses information.\nModifications:\n\nIgnore proxied addresses information if its address family is AF_UNSPEC\n\nResult:\n\nHAProxy handler does not throw a NullPointerException anymore.\nFixes #2984", "createdAt": "2020-08-10T04:35:40Z", "url": "https://github.com/line/armeria/pull/2985", "merged": true, "mergeCommit": {"oid": "22158f5aacda66cf70d17079480fb29f07fca6e7"}, "closed": true, "closedAt": "2020-08-12T04:08:38Z", "author": {"login": "ikhoon"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc9amG0gH2gAyNDY1MjY3Nzc5Ojg3MGQ4Y2M0YzJkY2ZhOTRjOTg3OTRhN2Q3ZDkyYWQwYmEzODVjY2U=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc9zlWYgH2gAyNDY1MjY3Nzc5OjExNjUyMDU1MTJiOWJjOTVmMzEzYjJkOTk3YzFkN2Q1OTZjOTc2MGI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "870d8cc4c2dcfa94c98794a7d7d92ad0ba385cce", "author": {"user": {"login": "ikhoon", "name": "Ikhun Um"}}, "url": "https://github.com/line/armeria/commit/870d8cc4c2dcfa94c98794a7d7d92ad0ba385cce", "committedDate": "2020-08-10T04:34:37Z", "message": "Fix a bug where HAProxy server handler throws `NPE` if an address family is `AF_UNSPEC`\n\nMotivation:\n\nArmeria HAProxy handler considers that a HAProxyMessage contains addresses information.\nHowever, if the address family is `AF_UNSPEC`, the addresses are null always.\nFrom the HAProxy spec, the receiver can accept the connection or reject it.\nThere seems to be no harm ignoring the addresses information.\n\nModifications:\n\n- Ignore proxied addresses information if AddressFamily is `AF_UNSPEC`\n\nResult:\n\n- HAProxy handler does not throw NullPointerException anymore.\n- Fixes #2984"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYzOTY4Nzcx", "url": "https://github.com/line/armeria/pull/2985#pullrequestreview-463968771", "createdAt": "2020-08-10T05:48:38Z", "commit": {"oid": "870d8cc4c2dcfa94c98794a7d7d92ad0ba385cce"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f028cc0be90a2e4726dc49049377908ed3cf3b97", "author": {"user": {"login": "ikhoon", "name": "Ikhun Um"}}, "url": "https://github.com/line/armeria/commit/f028cc0be90a2e4726dc49049377908ed3cf3b97", "committedDate": "2020-08-10T05:54:58Z", "message": "Fix checkstyle"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY0MDAzMTk5", "url": "https://github.com/line/armeria/pull/2985#pullrequestreview-464003199", "createdAt": "2020-08-10T07:21:58Z", "commit": {"oid": "f028cc0be90a2e4726dc49049377908ed3cf3b97"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMFQwNzoyMTo1OFrOG-DvtQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMFQwNzoyMTo1OFrOG-DvtQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzcyNjI2MQ==", "bodyText": "should we also ignore AF_UNIX as well?\n^ Ignore this, an UnknownHostException will be thrown which seems reasonable \ud83d\udc4d", "url": "https://github.com/line/armeria/pull/2985#discussion_r467726261", "createdAt": "2020-08-10T07:21:58Z", "author": {"login": "jrhee17"}, "path": "core/src/main/java/com/linecorp/armeria/server/HttpServerPipelineConfigurator.java", "diffHunk": "@@ -370,14 +371,20 @@ protected void decode(ChannelHandlerContext ctx, HAProxyMessage msg, List<Object\n                              msg.destinationAddress(), msg.destinationPort(),\n                              proxiedCandidates);\n             }\n+\n+            final ProxiedAddresses proxiedAddresses;\n+            if (msg.proxiedProtocol().addressFamily() == AddressFamily.AF_UNSPEC) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f028cc0be90a2e4726dc49049377908ed3cf3b97"}, "originalPosition": 14}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY0MTE1NDY3", "url": "https://github.com/line/armeria/pull/2985#pullrequestreview-464115467", "createdAt": "2020-08-10T10:28:44Z", "commit": {"oid": "f028cc0be90a2e4726dc49049377908ed3cf3b97"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1165205512b9bc95f313b2d997c1d7d596c9760b", "author": {"user": {"login": "ikhoon", "name": "Ikhun Um"}}, "url": "https://github.com/line/armeria/commit/1165205512b9bc95f313b2d997c1d7d596c9760b", "committedDate": "2020-08-11T09:41:25Z", "message": "Release HAProxyMessage in test"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 45, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}