{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQxMjYyNTA1", "number": 2850, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yOVQwNzo0ODo1N1rOEJkyVw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yOVQwODowNjo1NFrOEJlLjg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc4NDc1MzUxOnYy", "diffSide": "RIGHT", "path": "core/src/main/java/com/linecorp/armeria/client/DefaultClientRequestContext.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yOVQwNzo0ODo1N1rOGqIpNg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yOVQwNzo1NDoyNlrOGqI1Zw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjgzNDk5OA==", "bodyText": "Could just call .remove() without .contains()", "url": "https://github.com/line/armeria/pull/2850#discussion_r446834998", "createdAt": "2020-06-29T07:48:57Z", "author": {"login": "trustin"}, "path": "core/src/main/java/com/linecorp/armeria/client/DefaultClientRequestContext.java", "diffHunk": "@@ -269,9 +271,12 @@ private void autoFillSchemeAndAuthority() {\n         final RequestHeaders headers = req.headers();\n         final String authority = endpoint != null ? endpoint.authority() : \"UNKNOWN\";\n         if (headers.scheme() == null || !authority.equals(headers.authority())) {\n-            unsafeUpdateRequest(req.withHeaders(headers.toBuilder()\n-                                                       .authority(authority)\n-                                                       .scheme(sessionProtocol())));\n+            final RequestHeadersBuilder headersBuilder =\n+                    headers.toBuilder().authority(authority).scheme(sessionProtocol());\n+            if (headersBuilder.contains(HttpHeaderNames.HOST)) {\n+                headersBuilder.remove(HttpHeaderNames.HOST);\n+            }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "54b436dd914dbe8293e26abe9c8ef02ffc17c9d7"}, "originalPosition": 27}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjgzODExOQ==", "bodyText": "Thanks fixed. \ud83d\ude09", "url": "https://github.com/line/armeria/pull/2850#discussion_r446838119", "createdAt": "2020-06-29T07:54:26Z", "author": {"login": "minwoox"}, "path": "core/src/main/java/com/linecorp/armeria/client/DefaultClientRequestContext.java", "diffHunk": "@@ -269,9 +271,12 @@ private void autoFillSchemeAndAuthority() {\n         final RequestHeaders headers = req.headers();\n         final String authority = endpoint != null ? endpoint.authority() : \"UNKNOWN\";\n         if (headers.scheme() == null || !authority.equals(headers.authority())) {\n-            unsafeUpdateRequest(req.withHeaders(headers.toBuilder()\n-                                                       .authority(authority)\n-                                                       .scheme(sessionProtocol())));\n+            final RequestHeadersBuilder headersBuilder =\n+                    headers.toBuilder().authority(authority).scheme(sessionProtocol());\n+            if (headersBuilder.contains(HttpHeaderNames.HOST)) {\n+                headersBuilder.remove(HttpHeaderNames.HOST);\n+            }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjgzNDk5OA=="}, "originalCommit": {"oid": "54b436dd914dbe8293e26abe9c8ef02ffc17c9d7"}, "originalPosition": 27}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc4NDgxODA2OnYy", "diffSide": "RIGHT", "path": "core/src/main/java/com/linecorp/armeria/internal/common/ArmeriaHttpUtil.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yOVQwODowNjo1NFrOGqJP-Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yOVQwODozNDo0N1rOGqKNtQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Njg0NDkyMQ==", "bodyText": "TODO(minwoox)?", "url": "https://github.com/line/armeria/pull/2850#discussion_r446844921", "createdAt": "2020-06-29T08:06:54Z", "author": {"login": "trustin"}, "path": "core/src/main/java/com/linecorp/armeria/internal/common/ArmeriaHttpUtil.java", "diffHunk": "@@ -676,6 +672,18 @@ public static void toArmeria(io.netty.handler.codec.http.HttpHeaders inHeaders,\n         }\n     }\n \n+    // Use Netty's validation logic once https://github.com/netty/netty/pull/10380 is merged.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "32f4ea6ac70396e04e8cdbb365aaf2445f39366b"}, "originalPosition": 70}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Njg2MDcyNQ==", "bodyText": "Fixed. \ud83d\ude09", "url": "https://github.com/line/armeria/pull/2850#discussion_r446860725", "createdAt": "2020-06-29T08:34:47Z", "author": {"login": "minwoox"}, "path": "core/src/main/java/com/linecorp/armeria/internal/common/ArmeriaHttpUtil.java", "diffHunk": "@@ -676,6 +672,18 @@ public static void toArmeria(io.netty.handler.codec.http.HttpHeaders inHeaders,\n         }\n     }\n \n+    // Use Netty's validation logic once https://github.com/netty/netty/pull/10380 is merged.", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Njg0NDkyMQ=="}, "originalCommit": {"oid": "32f4ea6ac70396e04e8cdbb365aaf2445f39366b"}, "originalPosition": 70}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2450, "cost": 1, "resetAt": "2021-11-12T20:44:06Z"}}}