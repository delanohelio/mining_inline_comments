{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDk3NjcyMDI0", "number": 3098, "title": "Fix a bug where a request is sent with an empty `:path` pseudo-header.", "bodyText": "Motivation:\nWhen a request is sent with absolute URI that does not contrains path,\nvar client = WebClient.of();\nclient.get(\"https://google.com\").aggregate();\nthen the request is failed with:\nCaused by: com.linecorp.armeria.common.stream.ClosedStreamException: received a RST_STREAM frame: PROTOCOL_ERROR\n\nThe request is rejected by remote peers because it has an empty :path pseudo-header.\nFrom the HTTP/2 spec,\n\nThis pseudo-header field MUST NOT be empty for \"http\" or \"https\"\nURIs; \"http\" or \"https\" URIs that do not contain a path component\nMUST include a value of '/'.\n\nModifications:\n\nSet path to / if it is empty\n\nResults:\nArmeria client sets the default path(/) properly if it is empty.", "createdAt": "2020-10-05T08:04:22Z", "url": "https://github.com/line/armeria/pull/3098", "merged": true, "mergeCommit": {"oid": "afddbe6098359f2d40e1bbcb39fa6519858ca576"}, "closed": true, "closedAt": "2020-10-13T10:31:09Z", "author": {"login": "ikhoon"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdPfJFqgH2gAyNDk3NjcyMDI0OmZmMmQyY2I0NTZkYjE1MzZiODA0NGE3NzA5ZWJiYTc2MTBjOGMyMGU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdSGDK_AFqTUwNzI5Mjc2Mw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "ff2d2cb456db1536b8044a7709ebba7610c8c20e", "author": {"user": {"login": "ikhoon", "name": "Ikhun Um"}}, "url": "https://github.com/line/armeria/commit/ff2d2cb456db1536b8044a7709ebba7610c8c20e", "committedDate": "2020-10-05T08:03:05Z", "message": "Fix a bug where a request is sent with an empty `:path` pseudo-header.\n\nMotivation:\n\nWhen a request is sent with absolute URI that does not contrains path,\n```java\nvar client = WebClient.of();\nclient.get(\"https://google.com\").aggregate();\n```\n\nthen the request is failed with:\n```\nCaused by: com.linecorp.armeria.common.stream.ClosedStreamException: received a RST_STREAM frame: PROTOCOL_ERROR\n```\n\nThe request is rejected by remote peers because it has an empty `:path` pseudo-header.\nFrom the [HTTP/2 spec](https://tools.ietf.org/html/rfc7540#section-8.1.2.3),\n> This pseudo-header field MUST NOT be empty for \"http\" or \"https\"\n  URIs; \"http\" or \"https\" URIs that do not contain a path component\n  MUST include a value of '/'.\n\nMotifications:\n\n- Set path to `/` if it is empty\n\nResults:\n\nArmeria client sets default path(`\\`) properly if it is empty."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAxOTE4MTAz", "url": "https://github.com/line/armeria/pull/3098#pullrequestreview-501918103", "createdAt": "2020-10-05T10:24:50Z", "commit": {"oid": "ff2d2cb456db1536b8044a7709ebba7610c8c20e"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA0NjQxODc1", "url": "https://github.com/line/armeria/pull/3098#pullrequestreview-504641875", "createdAt": "2020-10-08T10:27:55Z", "commit": {"oid": "ff2d2cb456db1536b8044a7709ebba7610c8c20e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOFQxMDoyNzo1NVrOHeYGHA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOFQxMDoyNzo1NVrOHeYGHA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTYxNDEwOA==", "bodyText": "Should we optimize like this:\nif (String.isNullOrEmpty(path)) {\n    path = query == null ? \"/\" : \"/?\" + query;\n} else if (query != null) {\n    path = path + '?' + query;\n}", "url": "https://github.com/line/armeria/pull/3098#discussion_r501614108", "createdAt": "2020-10-08T10:27:55Z", "author": {"login": "trustin"}, "path": "core/src/main/java/com/linecorp/armeria/client/DefaultWebClient.java", "diffHunk": "@@ -69,7 +71,10 @@ public HttpResponse execute(HttpRequest req) {\n \n             final Endpoint endpoint = Endpoint.parse(uri.getAuthority());\n             final String query = uri.getRawQuery();\n-            final String path = uri.getRawPath();\n+            String path = uri.getRawPath();\n+            if (Strings.isNullOrEmpty(path)) {\n+                path = \"/\";\n+            }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ff2d2cb456db1536b8044a7709ebba7610c8c20e"}, "originalPosition": 17}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b9f9627d25a49a9c3d8f47a5e2ee462785aa7939", "author": {"user": {"login": "ikhoon", "name": "Ikhun Um"}}, "url": "https://github.com/line/armeria/commit/b9f9627d25a49a9c3d8f47a5e2ee462785aa7939", "committedDate": "2020-10-08T15:56:01Z", "message": "Address comments by @trustin"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA3MjkyNzYz", "url": "https://github.com/line/armeria/pull/3098#pullrequestreview-507292763", "createdAt": "2020-10-13T10:30:46Z", "commit": {"oid": "b9f9627d25a49a9c3d8f47a5e2ee462785aa7939"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4709, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}