{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTExNDYxODQ4", "number": 3144, "title": "Allow user to configure `HealthCheckService` in Spring integration", "bodyText": "Motivation\n\n#3130\nSpring Boot users can only set path of the HealthCheckService. They can't set response, updatable or others.\n\nResult\n\nAllow users to configure the HealthCheckService by registering HealthCheckServiceConfigurator beans:\n@Bean\npublic HealthCheckServiceConfigurator healthCheckServiceConfigurator() {\n    return builder -> builder.updatable(true);\n}\n\nOf course HealthCheckService is enabled only if ArmeriaSettings#healthCheckPath is not null or empty.\nClose #3130", "createdAt": "2020-10-28T11:04:09Z", "url": "https://github.com/line/armeria/pull/3144", "merged": true, "mergeCommit": {"oid": "5753180c9753b9b38ad4b2c940cacbb4dfaccc49"}, "closed": true, "closedAt": "2020-10-30T11:09:40Z", "author": {"login": "ghkim3221"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdW7ZsdAH2gAyNTExNDYxODQ4OmE0OTdkMDU2MTk0NTU5OGNlYTRiZjQ0MjlkNTBlNDM2M2QzZWU1MjQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdXkx07AFqTUyMDU2NzY0NQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "a497d0561945598cea4bf4429d50e4363d3ee524", "author": {"user": {"login": "ghkim3221", "name": "Gihwan Kim"}}, "url": "https://github.com/line/armeria/commit/a497d0561945598cea4bf4429d50e4363d3ee524", "committedDate": "2020-10-28T10:56:02Z", "message": "Allow user to configure `HealthCheckService` in Spring integration"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE4NTg2MjE2", "url": "https://github.com/line/armeria/pull/3144#pullrequestreview-518586216", "createdAt": "2020-10-28T12:00:46Z", "commit": {"oid": "a497d0561945598cea4bf4429d50e4363d3ee524"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOFQxMjowMDo0NlrOHpmq1A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOFQxMjowMDo0NlrOHpmq1A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzM4NzIyMA==", "bodyText": "Other Armeria configurators for Spring do not extend Ordered.\nDo we need to apply Ordered to others?\nAny thought? @heowc", "url": "https://github.com/line/armeria/pull/3144#discussion_r513387220", "createdAt": "2020-10-28T12:00:46Z", "author": {"login": "ikhoon"}, "path": "spring/boot2-autoconfigure/src/main/java/com/linecorp/armeria/spring/HealthCheckServiceConfigurator.java", "diffHunk": "@@ -0,0 +1,51 @@\n+/*\n+ * Copyright 2020 LINE Corporation\n+ *\n+ * LINE Corporation licenses this file to you under the Apache License,\n+ * version 2.0 (the \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at:\n+ *\n+ *   https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+ * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n+ * License for the specific language governing permissions and limitations\n+ * under the License.\n+ */\n+package com.linecorp.armeria.spring;\n+\n+import org.springframework.context.annotation.Bean;\n+import org.springframework.core.Ordered;\n+import org.springframework.core.annotation.AnnotationAwareOrderComparator;\n+import org.springframework.core.annotation.Order;\n+\n+import com.linecorp.armeria.server.healthcheck.HealthCheckService;\n+import com.linecorp.armeria.server.healthcheck.HealthCheckServiceBuilder;\n+\n+/**\n+ * Interface used to configure a {@link HealthCheckService} on the default armeria server.\n+ */\n+@FunctionalInterface\n+public interface HealthCheckServiceConfigurator extends Ordered {\n+\n+    /**\n+     * Configures the {@link HealthCheckService} using the specified {@link HealthCheckServiceBuilder}.\n+     */\n+    void configure(HealthCheckServiceBuilder healthCheckServiceBuilder);\n+\n+    /**\n+     * Returns the evaluation order of this configurator. A user can specify the order with an {@link Order}\n+     * annotation when defining a bean with a {@link Bean} annotation.\n+     *\n+     * <p>Note that the default value of the {@link Order} annotation is {@link Ordered#LOWEST_PRECEDENCE}\n+     * which equals to {@link Integer#MAX_VALUE}, but it is overridden to {@code 0} by this default method.\n+     *\n+     * @see Ordered#LOWEST_PRECEDENCE\n+     * @see Ordered#HIGHEST_PRECEDENCE\n+     * @see AnnotationAwareOrderComparator\n+     */\n+    default int getOrder() {\n+        return 0;\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a497d0561945598cea4bf4429d50e4363d3ee524"}, "originalPosition": 50}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE4NzAwMTk3", "url": "https://github.com/line/armeria/pull/3144#pullrequestreview-518700197", "createdAt": "2020-10-28T14:08:55Z", "commit": {"oid": "a497d0561945598cea4bf4429d50e4363d3ee524"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOFQxNDowODo1NVrOHpr5fw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOFQxNDowODo1NVrOHpr5fw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzQ3Mjg5NQ==", "bodyText": "How about leaving a warn message if healthCheckPath is empty and healthCheckServiceConfigurators is not empty such as:\nlogger.warn(\"{}s exist but they are disabled by the empty 'health-check-path' property. configurations: {}\", \n        HealthCheckServiceConfigurator.class.getSimpleName(), healthCheckServiceConfigurators);", "url": "https://github.com/line/armeria/pull/3144#discussion_r513472895", "createdAt": "2020-10-28T14:08:55Z", "author": {"login": "ikhoon"}, "path": "spring/boot2-autoconfigure/src/main/java/com/linecorp/armeria/internal/spring/ArmeriaConfigurationUtil.java", "diffHunk": "@@ -102,7 +109,9 @@ public static void configureServerWithArmeriaSettings(ServerBuilder server, Arme\n \n         final String healthCheckPath = settings.getHealthCheckPath();\n         if (!Strings.isNullOrEmpty(healthCheckPath)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a497d0561945598cea4bf4429d50e4363d3ee524"}, "originalPosition": 43}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE5MzE2MTc3", "url": "https://github.com/line/armeria/pull/3144#pullrequestreview-519316177", "createdAt": "2020-10-29T03:56:31Z", "commit": {"oid": "a497d0561945598cea4bf4429d50e4363d3ee524"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOVQwMzo1NjozMlrOHqIRYw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOVQwMzo1NjozMlrOHqIRYw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzkzNzc2Mw==", "bodyText": "missing @Override", "url": "https://github.com/line/armeria/pull/3144#discussion_r513937763", "createdAt": "2020-10-29T03:56:32Z", "author": {"login": "minwoox"}, "path": "spring/boot2-autoconfigure/src/main/java/com/linecorp/armeria/spring/HealthCheckServiceConfigurator.java", "diffHunk": "@@ -0,0 +1,51 @@\n+/*\n+ * Copyright 2020 LINE Corporation\n+ *\n+ * LINE Corporation licenses this file to you under the Apache License,\n+ * version 2.0 (the \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at:\n+ *\n+ *   https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+ * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n+ * License for the specific language governing permissions and limitations\n+ * under the License.\n+ */\n+package com.linecorp.armeria.spring;\n+\n+import org.springframework.context.annotation.Bean;\n+import org.springframework.core.Ordered;\n+import org.springframework.core.annotation.AnnotationAwareOrderComparator;\n+import org.springframework.core.annotation.Order;\n+\n+import com.linecorp.armeria.server.healthcheck.HealthCheckService;\n+import com.linecorp.armeria.server.healthcheck.HealthCheckServiceBuilder;\n+\n+/**\n+ * Interface used to configure a {@link HealthCheckService} on the default armeria server.\n+ */\n+@FunctionalInterface\n+public interface HealthCheckServiceConfigurator extends Ordered {\n+\n+    /**\n+     * Configures the {@link HealthCheckService} using the specified {@link HealthCheckServiceBuilder}.\n+     */\n+    void configure(HealthCheckServiceBuilder healthCheckServiceBuilder);\n+\n+    /**\n+     * Returns the evaluation order of this configurator. A user can specify the order with an {@link Order}\n+     * annotation when defining a bean with a {@link Bean} annotation.\n+     *\n+     * <p>Note that the default value of the {@link Order} annotation is {@link Ordered#LOWEST_PRECEDENCE}\n+     * which equals to {@link Integer#MAX_VALUE}, but it is overridden to {@code 0} by this default method.\n+     *\n+     * @see Ordered#LOWEST_PRECEDENCE\n+     * @see Ordered#HIGHEST_PRECEDENCE\n+     * @see AnnotationAwareOrderComparator\n+     */\n+    default int getOrder() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a497d0561945598cea4bf4429d50e4363d3ee524"}, "originalPosition": 48}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2f4aae2b55e479de1fe0ef574add724379785860", "author": {"user": {"login": "ghkim3221", "name": "Gihwan Kim"}}, "url": "https://github.com/line/armeria/commit/2f4aae2b55e479de1fe0ef574add724379785860", "committedDate": "2020-10-29T04:30:09Z", "message": "Leave warning message when configurators exist but health check is disabled"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3ec02bb14e37e89e57b6b50e77bcc7a4e8e19eee", "author": {"user": {"login": "ghkim3221", "name": "Gihwan Kim"}}, "url": "https://github.com/line/armeria/commit/3ec02bb14e37e89e57b6b50e77bcc7a4e8e19eee", "committedDate": "2020-10-29T04:31:42Z", "message": "Add missing `@Override`"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2d29860a1000741fde344c1d44a2beb35d78b481", "author": {"user": {"login": "ghkim3221", "name": "Gihwan Kim"}}, "url": "https://github.com/line/armeria/commit/2d29860a1000741fde344c1d44a2beb35d78b481", "committedDate": "2020-10-29T05:03:42Z", "message": "Fix checkstyle"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIwNTY3NjQ1", "url": "https://github.com/line/armeria/pull/3144#pullrequestreview-520567645", "createdAt": "2020-10-30T11:08:30Z", "commit": {"oid": "2d29860a1000741fde344c1d44a2beb35d78b481"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4782, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}