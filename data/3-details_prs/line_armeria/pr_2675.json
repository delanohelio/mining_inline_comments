{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA3NzMyMzY4", "number": 2675, "title": "Distinguish initialization and state changes of circuit breaker", "bodyText": "Motivation:\nGeneral purpose to use CircuitBreakerListener is to be notified when circuit breaker is open or re-close. In that aspect, first CLOSED event on onStateChanged() seems confused.\nModification:\nAdd onInitialized() to the CircuitBreakerListener.", "createdAt": "2020-04-23T07:28:25Z", "url": "https://github.com/line/armeria/pull/2675", "merged": true, "mergeCommit": {"oid": "a9544c21e9a60b9bc689eab4a6c7094b4e67e16f"}, "closed": true, "closedAt": "2020-04-28T03:31:31Z", "author": {"login": "ghkim3221"}, "timelineItems": {"totalCount": 14, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcaXnkcgH2gAyNDA3NzMyMzY4OjE0YzhjYTYwZmQzMTAzNjYwNTg5MGViYzUyYmQ0MzM5ODExYWQ4NTk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcb7OAUAFqTQwMTQ3MDc0OA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "14c8ca60fd31036605890ebc52bd4339811ad859", "author": {"user": {"login": "ghkim3221", "name": "Gihwan Kim"}}, "url": "https://github.com/line/armeria/commit/14c8ca60fd31036605890ebc52bd4339811ad859", "committedDate": "2020-04-23T07:19:09Z", "message": "Distinguish initialization and state changes of circuit breaker"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk4ODMzODAz", "url": "https://github.com/line/armeria/pull/2675#pullrequestreview-398833803", "createdAt": "2020-04-23T07:36:35Z", "commit": {"oid": "14c8ca60fd31036605890ebc52bd4339811ad859"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yM1QwNzozNjozNlrOGKbBcw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yM1QwNzozNjo0MlrOGKbBtQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzU4MTY4Mw==", "bodyText": "a -> an", "url": "https://github.com/line/armeria/pull/2675#discussion_r413581683", "createdAt": "2020-04-23T07:36:36Z", "author": {"login": "minwoox"}, "path": "core/src/main/java/com/linecorp/armeria/client/circuitbreaker/NonBlockingCircuitBreaker.java", "diffHunk": "@@ -176,6 +176,17 @@ private void logStateTransition(CircuitState circuitState, @Nullable EventCount\n         }\n     }\n \n+    private void notifyInitialized() {\n+        config.listeners().forEach(listener -> {\n+            try {\n+                listener.onInitialized(name());\n+            } catch (Throwable t) {\n+                logger.warn(\"An error occurred when notifying a Initialized event\", t);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "14c8ca60fd31036605890ebc52bd4339811ad859"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzU4MTc0OQ==", "bodyText": "Let's add a little description that the state is Closed when this is invoked.", "url": "https://github.com/line/armeria/pull/2675#discussion_r413581749", "createdAt": "2020-04-23T07:36:42Z", "author": {"login": "minwoox"}, "path": "core/src/main/java/com/linecorp/armeria/client/circuitbreaker/CircuitBreakerListener.java", "diffHunk": "@@ -21,6 +21,11 @@\n  */\n public interface CircuitBreakerListener {\n \n+    /**\n+     * Invoked when the circuit breaker is initialized.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "14c8ca60fd31036605890ebc52bd4339811ad859"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4e58ceae3865fd97c26d911dffbca0c3dfbf1de1", "author": {"user": {"login": "ghkim3221", "name": "Gihwan Kim"}}, "url": "https://github.com/line/armeria/commit/4e58ceae3865fd97c26d911dffbca0c3dfbf1de1", "committedDate": "2020-04-23T07:39:42Z", "message": "Fix and add test cases"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4a01dc51ab121f3466d5a4c6d104a3e6d0b48788", "author": {"user": {"login": "ghkim3221", "name": "Gihwan Kim"}}, "url": "https://github.com/line/armeria/commit/4a01dc51ab121f3466d5a4c6d104a3e6d0b48788", "committedDate": "2020-04-23T07:39:49Z", "message": "Fix typo"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "af46dfdf5de335804f216967571da0da994cba61", "author": {"user": {"login": "ghkim3221", "name": "Gihwan Kim"}}, "url": "https://github.com/line/armeria/commit/af46dfdf5de335804f216967571da0da994cba61", "committedDate": "2020-04-23T07:43:31Z", "message": "Add little description that initial state is always CLOSED"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "22f8b985d58f5996cb2c0ea8c88d34d281666c5b", "author": {"user": {"login": "ghkim3221", "name": "Gihwan Kim"}}, "url": "https://github.com/line/armeria/commit/22f8b985d58f5996cb2c0ea8c88d34d281666c5b", "committedDate": "2020-04-23T08:11:54Z", "message": "Add default method"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5c10cd892858c7cd98a2c98f745a87877247bfda", "author": {"user": {"login": "ghkim3221", "name": "Gihwan Kim"}}, "url": "https://github.com/line/armeria/commit/5c10cd892858c7cd98a2c98f745a87877247bfda", "committedDate": "2020-04-23T08:16:33Z", "message": "Revert onInitialized in metrics"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk4OTUwODk5", "url": "https://github.com/line/armeria/pull/2675#pullrequestreview-398950899", "createdAt": "2020-04-23T10:06:25Z", "commit": {"oid": "5c10cd892858c7cd98a2c98f745a87877247bfda"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yM1QxMDowNjoyNVrOGKhZ2Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yM1QxMDowNjo0MVrOGKhakQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzY4NjIzMw==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                 * Initial state is always CLOSED.\n          \n          \n            \n                 * The initial state is always {@link CircuitState.CLOSED}.", "url": "https://github.com/line/armeria/pull/2675#discussion_r413686233", "createdAt": "2020-04-23T10:06:25Z", "author": {"login": "ikhoon"}, "path": "core/src/main/java/com/linecorp/armeria/client/circuitbreaker/CircuitBreakerListener.java", "diffHunk": "@@ -21,6 +21,14 @@\n  */\n public interface CircuitBreakerListener {\n \n+    /**\n+     * Invoked when the circuit breaker is initialized.\n+     * Initial state is always CLOSED.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5c10cd892858c7cd98a2c98f745a87877247bfda"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzY4NjQxNw==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                public void onInitialized(String circuitBreakerName) throws Exception { }\n          \n          \n            \n                public void onInitialized(String circuitBreakerName) throws Exception {}", "url": "https://github.com/line/armeria/pull/2675#discussion_r413686417", "createdAt": "2020-04-23T10:06:41Z", "author": {"login": "ikhoon"}, "path": "core/src/main/java/com/linecorp/armeria/client/circuitbreaker/CircuitBreakerListenerAdapter.java", "diffHunk": "@@ -22,6 +22,9 @@\n  */\n public class CircuitBreakerListenerAdapter implements CircuitBreakerListener {\n \n+    @Override\n+    public void onInitialized(String circuitBreakerName) throws Exception { }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5c10cd892858c7cd98a2c98f745a87877247bfda"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "63d5f107a61310b164bff3c5933de82ce170246b", "author": {"user": {"login": "ghkim3221", "name": "Gihwan Kim"}}, "url": "https://github.com/line/armeria/commit/63d5f107a61310b164bff3c5933de82ce170246b", "committedDate": "2020-04-23T11:43:16Z", "message": "Apply suggestions"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk5NTc2OTAy", "url": "https://github.com/line/armeria/pull/2675#pullrequestreview-399576902", "createdAt": "2020-04-24T01:09:03Z", "commit": {"oid": "63d5f107a61310b164bff3c5933de82ce170246b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk5NjE0MDQ5", "url": "https://github.com/line/armeria/pull/2675#pullrequestreview-399614049", "createdAt": "2020-04-24T03:21:30Z", "commit": {"oid": "63d5f107a61310b164bff3c5933de82ce170246b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yNFQwMzoyMTozMFrOGLEm-Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yNFQwMzoyMTozMFrOGLEm-Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDI2MzAzMw==", "bodyText": "How about adding CircuitState initialState as the second parameter, so that we can have a different type of circuit, which starts at HALF_OPEN or OPEN?", "url": "https://github.com/line/armeria/pull/2675#discussion_r414263033", "createdAt": "2020-04-24T03:21:30Z", "author": {"login": "trustin"}, "path": "core/src/main/java/com/linecorp/armeria/client/circuitbreaker/CircuitBreakerListener.java", "diffHunk": "@@ -21,6 +21,14 @@\n  */\n public interface CircuitBreakerListener {\n \n+    /**\n+     * Invoked when the circuit breaker is initialized.\n+     * The initial state is always {@link CircuitState.CLOSED}.\n+     */\n+    default void onInitialized(String circuitBreakerName) throws Exception {\n+        onStateChanged(circuitBreakerName, CircuitState.CLOSED);\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "63d5f107a61310b164bff3c5933de82ce170246b"}, "originalPosition": 10}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7ae4232803d2cc5e1cc80e1a51a40ad9651b0ce5", "author": {"user": {"login": "ghkim3221", "name": "Gihwan Kim"}}, "url": "https://github.com/line/armeria/commit/7ae4232803d2cc5e1cc80e1a51a40ad9651b0ce5", "committedDate": "2020-04-27T02:16:43Z", "message": "Add initialState parameter for generality"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAwNzA3OTkz", "url": "https://github.com/line/armeria/pull/2675#pullrequestreview-400707993", "createdAt": "2020-04-27T07:53:50Z", "commit": {"oid": "7ae4232803d2cc5e1cc80e1a51a40ad9651b0ce5"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAxNDcwNzQ4", "url": "https://github.com/line/armeria/pull/2675#pullrequestreview-401470748", "createdAt": "2020-04-28T03:21:44Z", "commit": {"oid": "7ae4232803d2cc5e1cc80e1a51a40ad9651b0ce5"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 398, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}