{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM2MzM2MjQ3", "number": 2815, "title": "Abide by the rule Reactive Streams 2.3", "bodyText": "Some of the subscribers violated Reactive Stremas 2.3 which is:\nSubscriber.onComplete() and Subscriber.onError(Throwable t) MUST NOT call any methods on the Subscription or the Publisher.\nhttps://github.com/reactive-streams/reactive-streams-jvm#2.3\nCo-authored-by: ikhoon ih.pert@gmail.com", "createdAt": "2020-06-18T09:09:36Z", "url": "https://github.com/line/armeria/pull/2815", "merged": true, "mergeCommit": {"oid": "8ab8ca94538541edbb42c843f6b5c1e2a3cc954f"}, "closed": true, "closedAt": "2020-06-19T02:49:26Z", "author": {"login": "minwoox"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcsawgmAH2gAyNDM2MzM2MjQ3OmFmMmRmMDI1NGJjZDI1NzczNDNlMGE0ZTRhMTVmMGRmYWE4OGZlMjA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcsp6ragFqTQzMzc2OTI1Nw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "af2df0254bcd2577343e0a4e4a15f0dfaa88fe20", "author": {"user": {"login": "minwoox", "name": "minux"}}, "url": "https://github.com/line/armeria/commit/af2df0254bcd2577343e0a4e4a15f0dfaa88fe20", "committedDate": "2020-06-18T09:09:16Z", "message": "Abide by the rule Reactive Streams 2.3\nSome of the subscribers violated Reactive Stremas 2.3 which is:\n`Subscriber.onComplete()` and `Subscriber.onError(Throwable t)` MUST NOT call any methods on the `Subscription` or the `Publisher`.\n\nhttps://github.com/reactive-streams/reactive-streams-jvm#2.3\n\nCo-authored-by: ikhoon <ih.pert@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "defa548af5cd017e620d2c8a798741d5353b4872", "author": {"user": {"login": "minwoox", "name": "minux"}}, "url": "https://github.com/line/armeria/commit/defa548af5cd017e620d2c8a798741d5353b4872", "committedDate": "2020-06-18T12:23:54Z", "message": "Add final"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMzMTAwODQw", "url": "https://github.com/line/armeria/pull/2815#pullrequestreview-433100840", "createdAt": "2020-06-18T09:24:08Z", "commit": {"oid": "af2df0254bcd2577343e0a4e4a15f0dfaa88fe20"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOFQwOToyNDowOFrOGlnIbg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOFQxMjo1NTozNVrOGlt_2A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjA5MTYzMA==", "bodyText": "Question: Don't we need to check whether writer is open like we did in onError(...)?", "url": "https://github.com/line/armeria/pull/2815#discussion_r442091630", "createdAt": "2020-06-18T09:24:08Z", "author": {"login": "ikhoon"}, "path": "core/src/main/java/com/linecorp/armeria/internal/server/ResponseConversionUtil.java", "diffHunk": "@@ -227,7 +227,12 @@ public void onNext(T value) {\n                     subscription.request(1);\n                 });\n             } catch (Exception e) {\n-                onError(e);\n+                try {\n+                    writer.close(e);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "af2df0254bcd2577343e0a4e4a15f0dfaa88fe20"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjIwNDEyMA==", "bodyText": "try...catch and throwIfFatal(...)?", "url": "https://github.com/line/armeria/pull/2815#discussion_r442204120", "createdAt": "2020-06-18T12:55:35Z", "author": {"login": "ikhoon"}, "path": "core/src/main/java/com/linecorp/armeria/internal/server/ResponseConversionUtil.java", "diffHunk": "@@ -236,14 +241,7 @@ public void onError(Throwable cause) {\n             if (!writer.isOpen()) {\n                 return;\n             }\n-            try {\n-                writer.close(cause);\n-            } catch (Exception e) {\n-                // 'subscription.cancel()' would be called by the close future listener of the writer,\n-                // so we call it when we failed to close the writer.\n-                assert subscription != null;\n-                subscription.cancel();\n-            }\n+            writer.close(cause);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "defa548af5cd017e620d2c8a798741d5353b4872"}, "originalPosition": 26}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMzMjc3NDkw", "url": "https://github.com/line/armeria/pull/2815#pullrequestreview-433277490", "createdAt": "2020-06-18T13:23:21Z", "commit": {"oid": "defa548af5cd017e620d2c8a798741d5353b4872"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMzNzY5MjU3", "url": "https://github.com/line/armeria/pull/2815#pullrequestreview-433769257", "createdAt": "2020-06-19T02:48:57Z", "commit": {"oid": "defa548af5cd017e620d2c8a798741d5353b4872"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 238, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}