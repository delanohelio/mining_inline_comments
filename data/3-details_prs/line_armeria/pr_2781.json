{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDI4OTA0NzMw", "number": 2781, "title": "Logback <exports> tag does not work", "bodyText": "Motivations:\nNow, <exports> tag like the following does not work.\n<exports>remote.ip, remote.port, attrs.baz:com.example.AttrKeys#BAZ</exports>\nModifications:\n\nfix RequestContextExportingAppender#setExports\n\nbased on https://github.com/okue/armeria/blob/bdecd1e8826b80e8dd76c63714979fb7480ecfe9/logback/src/main/java/com/linecorp/armeria/common/logback/RequestContextExportingAppender.java#L199\n\n\nadd a testcase for <exports>...</exports>", "createdAt": "2020-06-06T01:32:07Z", "url": "https://github.com/line/armeria/pull/2781", "merged": true, "mergeCommit": {"oid": "e43e1933e2b768096f7351e906415d0263b670a4"}, "closed": true, "closedAt": "2020-06-09T12:11:53Z", "author": {"login": "okue"}, "timelineItems": {"totalCount": 15, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcoc6sLAH2gAyNDI4OTA0NzMwOjVkNzI4NzBlYTMzYzMwZTYyYWE4MmIxMGFjZTc2MDVmZmFjNmRjMzc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcpg5pHAFqTQyNjkxMTExMQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "5d72870ea33c30e62aa82b10ace7605ffac6dc37", "author": {"user": {"login": "okue", "name": "Okue"}}, "url": "https://github.com/line/armeria/commit/5d72870ea33c30e62aa82b10ace7605ffac6dc37", "committedDate": "2020-06-06T01:24:30Z", "message": "Fix RequestContextExportingAppender#setExports"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "de7072443f3e9f600b26adbb766317f14836fc32", "author": {"user": {"login": "okue", "name": "Okue"}}, "url": "https://github.com/line/armeria/commit/de7072443f3e9f600b26adbb766317f14836fc32", "committedDate": "2020-06-06T01:24:44Z", "message": "Add test for <exports> tag"}, "afterCommit": {"oid": "4316a3fcab5f985a8b090a003618e58ac5f263c7", "author": {"user": {"login": "okue", "name": "Okue"}}, "url": "https://github.com/line/armeria/commit/4316a3fcab5f985a8b090a003618e58ac5f263c7", "committedDate": "2020-06-06T01:53:46Z", "message": "Add test for <exports> tag"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4316a3fcab5f985a8b090a003618e58ac5f263c7", "author": {"user": {"login": "okue", "name": "Okue"}}, "url": "https://github.com/line/armeria/commit/4316a3fcab5f985a8b090a003618e58ac5f263c7", "committedDate": "2020-06-06T01:53:46Z", "message": "Add test for <exports> tag"}, "afterCommit": {"oid": "04da57d8f484f5c1816b58f8d48222ef955b6a88", "author": {"user": {"login": "okue", "name": "Okue"}}, "url": "https://github.com/line/armeria/commit/04da57d8f484f5c1816b58f8d48222ef955b6a88", "committedDate": "2020-06-06T01:57:03Z", "message": "Add test for <exports> tag"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI1NzA0MzQ0", "url": "https://github.com/line/armeria/pull/2781#pullrequestreview-425704344", "createdAt": "2020-06-06T02:03:04Z", "commit": {"oid": "04da57d8f484f5c1816b58f8d48222ef955b6a88"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNlQwMjowMzowNFrOGgBOjg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNlQwMjowMzowNFrOGgBOjg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjIyNzcyNg==", "bodyText": "Not related to this PR, could you add a checkArguments that checks mdfKeys is non-empty?", "url": "https://github.com/line/armeria/pull/2781#discussion_r436227726", "createdAt": "2020-06-06T02:03:04Z", "author": {"login": "ikhoon"}, "path": "logback/src/main/java/com/linecorp/armeria/common/logback/RequestContextExportingAppender.java", "diffHunk": "@@ -144,7 +145,7 @@ public void setExport(String mdcKey) {\n      */\n     public void setExports(String mdcKeys) {\n         requireNonNull(mdcKeys, \"mdcKeys\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "04da57d8f484f5c1816b58f8d48222ef955b6a88"}, "originalPosition": 11}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "28bd436e44b4eebd40f93ad8bb4faabdc0481f58", "author": {"user": {"login": "okue", "name": "Okue"}}, "url": "https://github.com/line/armeria/commit/28bd436e44b4eebd40f93ad8bb4faabdc0481f58", "committedDate": "2020-06-06T02:20:07Z", "message": "Add test for <exports> tag"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "04da57d8f484f5c1816b58f8d48222ef955b6a88", "author": {"user": {"login": "okue", "name": "Okue"}}, "url": "https://github.com/line/armeria/commit/04da57d8f484f5c1816b58f8d48222ef955b6a88", "committedDate": "2020-06-06T01:57:03Z", "message": "Add test for <exports> tag"}, "afterCommit": {"oid": "28bd436e44b4eebd40f93ad8bb4faabdc0481f58", "author": {"user": {"login": "okue", "name": "Okue"}}, "url": "https://github.com/line/armeria/commit/28bd436e44b4eebd40f93ad8bb4faabdc0481f58", "committedDate": "2020-06-06T02:20:07Z", "message": "Add test for <exports> tag"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI1NzQ5ODIz", "url": "https://github.com/line/armeria/pull/2781#pullrequestreview-425749823", "createdAt": "2020-06-06T15:54:38Z", "commit": {"oid": "28bd436e44b4eebd40f93ad8bb4faabdc0481f58"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNlQxNTo1NDozOVrOGgEXmA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNlQxNTo1NDozOVrOGgEXmA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjI3OTE5Mg==", "bodyText": "I think we could optimize this when mdcKeys.split(\",\").length == 1.", "url": "https://github.com/line/armeria/pull/2781#discussion_r436279192", "createdAt": "2020-06-06T15:54:39Z", "author": {"login": "ikhoon"}, "path": "logback/src/main/java/com/linecorp/armeria/common/logback/RequestContextExportingAppender.java", "diffHunk": "@@ -144,7 +147,8 @@ public void setExport(String mdcKey) {\n      */\n     public void setExports(String mdcKeys) {\n         requireNonNull(mdcKeys, \"mdcKeys\");\n-        builder.addKeyPattern(mdcKeys);\n+        checkArgument(!mdcKeys.isEmpty(), \"mdcKeys must not be empty\");\n+        Arrays.stream(mdcKeys.split(\",\")).map(String::trim).forEach(builder::addKeyPattern);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "28bd436e44b4eebd40f93ad8bb4faabdc0481f58"}, "originalPosition": 26}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI1ODg1MzY2", "url": "https://github.com/line/armeria/pull/2781#pullrequestreview-425885366", "createdAt": "2020-06-08T02:31:20Z", "commit": {"oid": "28bd436e44b4eebd40f93ad8bb4faabdc0481f58"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI1OTQwNzcy", "url": "https://github.com/line/armeria/pull/2781#pullrequestreview-425940772", "createdAt": "2020-06-08T06:21:55Z", "commit": {"oid": "ab8e780f33aeb5007ff8072232282fb4b0fdea5f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOFQwNjoyMTo1NVrOGgQfkA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOFQwNjoyMTo1NVrOGgQfkA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjQ3Nzg0MA==", "bodyText": "How about checking after splitting?", "url": "https://github.com/line/armeria/pull/2781#discussion_r436477840", "createdAt": "2020-06-08T06:21:55Z", "author": {"login": "trustin"}, "path": "logback/src/main/java/com/linecorp/armeria/common/logback/RequestContextExportingAppender.java", "diffHunk": "@@ -144,7 +149,8 @@ public void setExport(String mdcKey) {\n      */\n     public void setExports(String mdcKeys) {\n         requireNonNull(mdcKeys, \"mdcKeys\");\n-        builder.addKeyPattern(mdcKeys);\n+        checkArgument(!mdcKeys.isEmpty(), \"mdcKeys must not be empty\");\n+        KEY_SPLITTER.split(mdcKeys).forEach(builder::addKeyPattern);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ab8e780f33aeb5007ff8072232282fb4b0fdea5f"}, "originalPosition": 39}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ab8e780f33aeb5007ff8072232282fb4b0fdea5f", "author": {"user": {"login": "okue", "name": "Okue"}}, "url": "https://github.com/line/armeria/commit/ab8e780f33aeb5007ff8072232282fb4b0fdea5f", "committedDate": "2020-06-08T06:16:57Z", "message": "Use guava splitter"}, "afterCommit": {"oid": "d84c87589a4b206fab02dbc66abe693d8e48c040", "author": {"user": {"login": "okue", "name": "Okue"}}, "url": "https://github.com/line/armeria/commit/d84c87589a4b206fab02dbc66abe693d8e48c040", "committedDate": "2020-06-08T06:31:53Z", "message": "Improve splitting the comma-separated MDC keys"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d84c87589a4b206fab02dbc66abe693d8e48c040", "author": {"user": {"login": "okue", "name": "Okue"}}, "url": "https://github.com/line/armeria/commit/d84c87589a4b206fab02dbc66abe693d8e48c040", "committedDate": "2020-06-08T06:31:53Z", "message": "Improve splitting the comma-separated MDC keys"}, "afterCommit": {"oid": "cd26ae4e0e1ef050804d6edc30e9b10c090f748a", "author": {"user": {"login": "okue", "name": "Okue"}}, "url": "https://github.com/line/armeria/commit/cd26ae4e0e1ef050804d6edc30e9b10c090f748a", "committedDate": "2020-06-08T06:39:33Z", "message": "Improve splitting the comma-separated MDC keys"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "07607bc231cbfb8ee4f368b60a67253e048a343e", "author": {"user": {"login": "okue", "name": "Okue"}}, "url": "https://github.com/line/armeria/commit/07607bc231cbfb8ee4f368b60a67253e048a343e", "committedDate": "2020-06-08T06:41:41Z", "message": "Improve splitting comma-sepalated mdc keys"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "cd26ae4e0e1ef050804d6edc30e9b10c090f748a", "author": {"user": {"login": "okue", "name": "Okue"}}, "url": "https://github.com/line/armeria/commit/cd26ae4e0e1ef050804d6edc30e9b10c090f748a", "committedDate": "2020-06-08T06:39:33Z", "message": "Improve splitting the comma-separated MDC keys"}, "afterCommit": {"oid": "07607bc231cbfb8ee4f368b60a67253e048a343e", "author": {"user": {"login": "okue", "name": "Okue"}}, "url": "https://github.com/line/armeria/commit/07607bc231cbfb8ee4f368b60a67253e048a343e", "committedDate": "2020-06-08T06:41:41Z", "message": "Improve splitting comma-sepalated mdc keys"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI2ODEwNTAz", "url": "https://github.com/line/armeria/pull/2781#pullrequestreview-426810503", "createdAt": "2020-06-09T06:00:39Z", "commit": {"oid": "07607bc231cbfb8ee4f368b60a67253e048a343e"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI2OTExMTEx", "url": "https://github.com/line/armeria/pull/2781#pullrequestreview-426911111", "createdAt": "2020-06-09T08:36:54Z", "commit": {"oid": "07607bc231cbfb8ee4f368b60a67253e048a343e"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 186, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}