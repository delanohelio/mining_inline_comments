{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzU4NTQ3NjIw", "number": 2359, "title": "Make sure to close `HttpResponseWriter` and release content", "bodyText": "Motivation:\nHttpResponseWriter.close(AggregatedHttpResponse) and StreamWriter.close(Object)\nraise an exception when 1) a user gave an invalid input or 2) the stream\nis closed already while writing.\nSuch behavior can lead to a stream left open or a content left\nunreleased.\nModifications:\n\nDeprecate StreamWriter.close(Object) which has an ambiguous\ncontract.\nAlways close the stream for close(AggregatedHttpResponse) and its\ncousins in HttpResponseWriter.\nUse tryWrite() and close() instead of close(Object) in our code.\n\nResult:\n\nLess leak\nLess ambiguity", "createdAt": "2020-01-02T04:05:06Z", "url": "https://github.com/line/armeria/pull/2359", "merged": true, "mergeCommit": {"oid": "1ce514094cedb052a34ab27e534d817c3e3adb1f"}, "closed": true, "closedAt": "2020-01-02T06:49:14Z", "author": {"login": "trustin"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb2RpU_AH2gAyMzU4NTQ3NjIwOjA3Y2Q0ZjA0MWE4ZjBkZDhhMWJmZjY3NzYyY2VhM2EwNjdjNWIzYjc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABb2T7rMgFqTMzNzU0MzI5OA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "07cd4f041a8f0dd8a1bff67762cea3a067c5b3b7", "author": {"user": {"login": "trustin", "name": "Trustin Lee"}}, "url": "https://github.com/line/armeria/commit/07cd4f041a8f0dd8a1bff67762cea3a067c5b3b7", "committedDate": "2020-01-02T04:00:22Z", "message": "Make sure to close `HttpResponseWriter` and release content\n\nMotivation:\n\n`HttpResponseWriter.close(AggregatedHttpResponse)` and `StreamWriter.close(Object)`\nraise an exception when 1) a user gave an invalid input or 2) the stream\nis closed already while writing.\n\nSuch behavior can lead to a stream left open or a content left\nunreleased.\n\nModifications:\n\n- Deprecate `StreamWriter.close(Object)` which has an ambiguous\n  contract.\n- Always close the stream for `close(AggregatedHttpResponse)` and its\n  cousins in `HttpResponseWriter`.\n- Use `tryWrite()` and `close()` instead of `close(Object)` in our code.\n\nResult:\n\n- Less leak\n- Less ambiguity"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzM3NTM1NDEw", "url": "https://github.com/line/armeria/pull/2359#pullrequestreview-337535410", "createdAt": "2020-01-02T05:35:04Z", "commit": {"oid": "07cd4f041a8f0dd8a1bff67762cea3a067c5b3b7"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wMlQwNTozNTowNFrOFZlkDA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wMlQwNTozNTowNFrOFZlkDA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MjM3NDE1Ng==", "bodyText": "Don't we need to update this as well?\n    try {\n        write(obj);\n    } finally {\n        close();\n    }", "url": "https://github.com/line/armeria/pull/2359#discussion_r362374156", "createdAt": "2020-01-02T05:35:04Z", "author": {"login": "minwoox"}, "path": "core/src/main/java/com/linecorp/armeria/common/stream/StreamWriter.java", "diffHunk": "@@ -132,8 +133,15 @@ default boolean tryWrite(Supplier<? extends T> o) {\n     void close(Throwable cause);\n \n     /**\n-     * Writes the given object and closes the stream successfully.\n+     * Writes the given object and closes the stream successfully. The written object will be transferred to\n+     * the {@link Subscriber}.\n+     *\n+     * @throws ClosedPublisherException if the stream was already closed.\n+     * @see <a href=\"#reference-counted\">Life cycle of reference-counted objects</a>\n+     *\n+     * @deprecated Use {@link #tryWrite(Object)} and {@link #close()}.\n      */\n+    @Deprecated\n     default void close(T obj) {\n         write(obj);\n         close();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "07cd4f041a8f0dd8a1bff67762cea3a067c5b3b7"}, "originalPosition": 24}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8b0b5fe4d474a48578e2ff14e923b1f62ba0a068", "author": {"user": {"login": "trustin", "name": "Trustin Lee"}}, "url": "https://github.com/line/armeria/commit/8b0b5fe4d474a48578e2ff14e923b1f62ba0a068", "committedDate": "2020-01-02T05:46:47Z", "message": "Add tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e56ea42dd31b8026f211c88485f1fd15c770cd7d", "author": {"user": {"login": "trustin", "name": "Trustin Lee"}}, "url": "https://github.com/line/armeria/commit/e56ea42dd31b8026f211c88485f1fd15c770cd7d", "committedDate": "2020-01-02T05:48:34Z", "message": "Address the comment from @minwoox"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzM3NTQzMjk4", "url": "https://github.com/line/armeria/pull/2359#pullrequestreview-337543298", "createdAt": "2020-01-02T06:40:13Z", "commit": {"oid": "e56ea42dd31b8026f211c88485f1fd15c770cd7d"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1028, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}