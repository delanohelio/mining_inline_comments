{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc2MTYxMDE3", "number": 2500, "title": "Clean up `ClientUtil`", "bodyText": "Realized that we already fail the request-side in\nDefaultClientRequestContext.init() and failEarly(), which allowed me\nto clean up 5c6ac9a a little bit more.\nAlso rearranged DefaultClientRequestContext.failEarly() so that abort()\nis called before log completion, like we did in ClientUtil.fail(), for\nconsistency.\nRelated: #2499", "createdAt": "2020-02-17T14:18:00Z", "url": "https://github.com/line/armeria/pull/2500", "merged": true, "mergeCommit": {"oid": "c991d7eaa8ff1cffc24f87a8d771d7d23c230130"}, "closed": true, "closedAt": "2020-02-17T15:33:23Z", "author": {"login": "trustin"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcFOAmnAH2gAyMzc2MTYxMDE3Ojc5ZDY5YzRlOTc3Yjk1MWY5YzljNjM4MGZiMmQzYmRmZjE0YTQzM2I=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcFO4jqgH2gAyMzc2MTYxMDE3OjFjN2JkZjk2ZjU0N2FkYWZkYWI4ZWIxZmM3Mjk4NjY5MjFmYTg3ODI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "79d69c4e977b951f9c9c6380fb2d3bdff14a433b", "author": {"user": {"login": "trustin", "name": "Trustin Lee"}}, "url": "https://github.com/line/armeria/commit/79d69c4e977b951f9c9c6380fb2d3bdff14a433b", "committedDate": "2020-02-17T14:15:02Z", "message": "Clean up `ClientUtil`\n\nRealized that we already fail the request-side in\n`DefaultClientRequestContext.init()` and `failEarly()`, which allowed me\nto clean up 5c6ac9a77bc303729dbf640c7a0763571f8395b3 a little bit more.\n\nRelated: #2499"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU5NzY3MjMy", "url": "https://github.com/line/armeria/pull/2500#pullrequestreview-359767232", "createdAt": "2020-02-17T14:19:22Z", "commit": {"oid": "79d69c4e977b951f9c9c6380fb2d3bdff14a433b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xN1QxNDoxOToyMlrOFqmCBQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xN1QxNDoxOToyMlrOFqmCBQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDIwNzYyMQ==", "bodyText": "This rearrangement is to make abort() is called before log completion, like we did in ClientUtil.fail(), for consistency.", "url": "https://github.com/line/armeria/pull/2500#discussion_r380207621", "createdAt": "2020-02-17T14:19:22Z", "author": {"login": "trustin"}, "path": "core/src/main/java/com/linecorp/armeria/client/DefaultClientRequestContext.java", "diffHunk": "@@ -257,16 +257,16 @@ private void runThreadLocalContextCustomizers() {\n     }\n \n     private void failEarly(Throwable cause) {\n-        final RequestLogBuilder logBuilder = logBuilder();\n-        final UnprocessedRequestException wrapped = new UnprocessedRequestException(cause);\n-        logBuilder.endRequest(wrapped);\n-        logBuilder.endResponse(wrapped);\n-\n         final HttpRequest req = request();\n         if (req != null) {\n             autoFillSchemeAndAuthority();\n             req.abort(cause);\n         }\n+\n+        final RequestLogBuilder logBuilder = logBuilder();\n+        final UnprocessedRequestException wrapped = new UnprocessedRequestException(cause);\n+        logBuilder.endRequest(wrapped);\n+        logBuilder.endResponse(wrapped);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "79d69c4e977b951f9c9c6380fb2d3bdff14a433b"}, "originalPosition": 18}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU5Nzc4MzI3", "url": "https://github.com/line/armeria/pull/2500#pullrequestreview-359778327", "createdAt": "2020-02-17T14:35:12Z", "commit": {"oid": "79d69c4e977b951f9c9c6380fb2d3bdff14a433b"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xN1QxNDozNToxM1rOFqmi7w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xN1QxNDozNToxM1rOFqmi7w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDIxNjA0Nw==", "bodyText": "nit:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    requireNonNull(fallbackResponseFactory, \"fallback\");\n          \n          \n            \n                    requireNonNull(fallbackResponseFactory, \"fallbackResponseFactory\");", "url": "https://github.com/line/armeria/pull/2500#discussion_r380216047", "createdAt": "2020-02-17T14:35:13Z", "author": {"login": "ikhoon"}, "path": "core/src/main/java/com/linecorp/armeria/internal/client/ClientUtil.java", "diffHunk": "@@ -79,16 +88,17 @@ private static EndpointGroup mapEndpoint(ClientRequestContext ctx, EndpointGroup\n \n     public static <I extends Request, O extends Response, U extends Client<I, O>>\n     O executeWithFallback(U delegate, ClientRequestContext ctx,\n-                          BiFunction<ClientRequestContext, Throwable, O> fallback) {\n+                          BiFunction<ClientRequestContext, Throwable, O> fallbackResponseFactory) {\n \n         requireNonNull(delegate, \"delegate\");\n         requireNonNull(ctx, \"ctx\");\n-        requireNonNull(fallback, \"fallback\");\n+        requireNonNull(fallbackResponseFactory, \"fallback\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "79d69c4e977b951f9c9c6380fb2d3bdff14a433b"}, "originalPosition": 82}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1c7bdf96f547adafdab8eb1fc729866921fa8782", "author": {"user": {"login": "trustin", "name": "Trustin Lee"}}, "url": "https://github.com/line/armeria/commit/1c7bdf96f547adafdab8eb1fc729866921fa8782", "committedDate": "2020-02-17T15:16:09Z", "message": "Update core/src/main/java/com/linecorp/armeria/internal/client/ClientUtil.java\n\nCo-Authored-By: Ikhun Um <ih.pert@gmail.com>"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1005, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}