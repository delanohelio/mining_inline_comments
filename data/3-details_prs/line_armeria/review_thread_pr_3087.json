{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDkzOTk3ODE5", "number": 3087, "reviewThreads": {"totalCount": 20, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOFQxMDozMzo1OFrOEoBRBw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNFQxNDoxODoxMlrOEtgfFQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEwMzk5MjM5OnYy", "diffSide": "RIGHT", "path": "core/src/main/java/com/linecorp/armeria/server/decoding/DecodingService.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOFQxMDozMzo1OFrOHY328g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOFQxMDo0NjozMlrOHY4QJg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTg0MzA1OA==", "bodyText": "Oops... this is client module. \ud83d\ude31 \ud83e\udd14\nIt is not natural to use client-side code on server-side.", "url": "https://github.com/line/armeria/pull/3087#discussion_r495843058", "createdAt": "2020-09-28T10:33:58Z", "author": {"login": "ikhoon"}, "path": "core/src/main/java/com/linecorp/armeria/server/decoding/DecodingService.java", "diffHunk": "@@ -0,0 +1,66 @@\n+/*\n+ * Copyright 2020 LINE Corporation\n+ *\n+ * LINE Corporation licenses this file to you under the Apache License,\n+ * version 2.0 (the \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at:\n+ *\n+ *   https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+ * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n+ * License for the specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package com.linecorp.armeria.server.decoding;\n+\n+import static com.google.common.collect.ImmutableMap.toImmutableMap;\n+\n+import java.util.Map;\n+import java.util.function.Function;\n+\n+import com.google.common.collect.ImmutableList;\n+import com.google.common.collect.Streams;\n+\n+import com.linecorp.armeria.client.encoding.StreamDecoderFactory;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8dd3c3041b02cb5596cf03853660cb7e6f5ed713"}, "originalPosition": 27}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTg0OTUxMA==", "bodyText": "I also think StreamDecoderFactory class move from client to common...but I don't do this because i'm not a main contributer", "url": "https://github.com/line/armeria/pull/3087#discussion_r495849510", "createdAt": "2020-09-28T10:46:32Z", "author": {"login": "joonhaeng"}, "path": "core/src/main/java/com/linecorp/armeria/server/decoding/DecodingService.java", "diffHunk": "@@ -0,0 +1,66 @@\n+/*\n+ * Copyright 2020 LINE Corporation\n+ *\n+ * LINE Corporation licenses this file to you under the Apache License,\n+ * version 2.0 (the \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at:\n+ *\n+ *   https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+ * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n+ * License for the specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package com.linecorp.armeria.server.decoding;\n+\n+import static com.google.common.collect.ImmutableMap.toImmutableMap;\n+\n+import java.util.Map;\n+import java.util.function.Function;\n+\n+import com.google.common.collect.ImmutableList;\n+import com.google.common.collect.Streams;\n+\n+import com.linecorp.armeria.client.encoding.StreamDecoderFactory;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTg0MzA1OA=="}, "originalCommit": {"oid": "8dd3c3041b02cb5596cf03853660cb7e6f5ed713"}, "originalPosition": 27}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEwMzk5OTMxOnYy", "diffSide": "RIGHT", "path": "core/src/main/java/com/linecorp/armeria/server/decoding/HttpDecodedRequest.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOFQxMDozNTo1OVrOHY368A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOFQxMDo1MjozOVrOHY4b0Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTg0NDA4MA==", "bodyText": "Could remove public and add final?", "url": "https://github.com/line/armeria/pull/3087#discussion_r495844080", "createdAt": "2020-09-28T10:35:59Z", "author": {"login": "ikhoon"}, "path": "core/src/main/java/com/linecorp/armeria/server/decoding/HttpDecodedRequest.java", "diffHunk": "@@ -0,0 +1,91 @@\n+/*\n+ * Copyright 2020 LINE Corporation\n+ *\n+ * LINE Corporation licenses this file to you under the Apache License,\n+ * version 2.0 (the \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at:\n+ *\n+ *   https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+ * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n+ * License for the specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package com.linecorp.armeria.server.decoding;\n+\n+import java.util.Map;\n+\n+import javax.annotation.Nullable;\n+\n+import org.reactivestreams.Subscriber;\n+\n+import com.google.common.base.Ascii;\n+\n+import com.linecorp.armeria.client.encoding.StreamDecoder;\n+import com.linecorp.armeria.client.encoding.StreamDecoderFactory;\n+import com.linecorp.armeria.common.FilteredHttpRequest;\n+import com.linecorp.armeria.common.HttpData;\n+import com.linecorp.armeria.common.HttpHeaderNames;\n+import com.linecorp.armeria.common.HttpObject;\n+import com.linecorp.armeria.common.HttpRequest;\n+\n+import io.netty.buffer.ByteBufAllocator;\n+\n+/**\n+ * A {@link FilteredHttpRequest} that applies HTTP decoding to {@link HttpObject}s as they are published.\n+ */\n+public class HttpDecodedRequest extends FilteredHttpRequest {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8dd3c3041b02cb5596cf03853660cb7e6f5ed713"}, "originalPosition": 40}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTg1MjQ5Nw==", "bodyText": "fix it!", "url": "https://github.com/line/armeria/pull/3087#discussion_r495852497", "createdAt": "2020-09-28T10:52:39Z", "author": {"login": "joonhaeng"}, "path": "core/src/main/java/com/linecorp/armeria/server/decoding/HttpDecodedRequest.java", "diffHunk": "@@ -0,0 +1,91 @@\n+/*\n+ * Copyright 2020 LINE Corporation\n+ *\n+ * LINE Corporation licenses this file to you under the Apache License,\n+ * version 2.0 (the \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at:\n+ *\n+ *   https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+ * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n+ * License for the specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package com.linecorp.armeria.server.decoding;\n+\n+import java.util.Map;\n+\n+import javax.annotation.Nullable;\n+\n+import org.reactivestreams.Subscriber;\n+\n+import com.google.common.base.Ascii;\n+\n+import com.linecorp.armeria.client.encoding.StreamDecoder;\n+import com.linecorp.armeria.client.encoding.StreamDecoderFactory;\n+import com.linecorp.armeria.common.FilteredHttpRequest;\n+import com.linecorp.armeria.common.HttpData;\n+import com.linecorp.armeria.common.HttpHeaderNames;\n+import com.linecorp.armeria.common.HttpObject;\n+import com.linecorp.armeria.common.HttpRequest;\n+\n+import io.netty.buffer.ByteBufAllocator;\n+\n+/**\n+ * A {@link FilteredHttpRequest} that applies HTTP decoding to {@link HttpObject}s as they are published.\n+ */\n+public class HttpDecodedRequest extends FilteredHttpRequest {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTg0NDA4MA=="}, "originalCommit": {"oid": "8dd3c3041b02cb5596cf03853660cb7e6f5ed713"}, "originalPosition": 40}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEwNDAwMjEzOnYy", "diffSide": "RIGHT", "path": "core/src/main/java/com/linecorp/armeria/server/decoding/DecodingService.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOFQxMDozNjo1M1rOHY38ow==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOFQxMDo1Mjo0MlrOHY4b9A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTg0NDUxNQ==", "bodyText": "Add final?", "url": "https://github.com/line/armeria/pull/3087#discussion_r495844515", "createdAt": "2020-09-28T10:36:53Z", "author": {"login": "ikhoon"}, "path": "core/src/main/java/com/linecorp/armeria/server/decoding/DecodingService.java", "diffHunk": "@@ -0,0 +1,66 @@\n+/*\n+ * Copyright 2020 LINE Corporation\n+ *\n+ * LINE Corporation licenses this file to you under the Apache License,\n+ * version 2.0 (the \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at:\n+ *\n+ *   https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+ * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n+ * License for the specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package com.linecorp.armeria.server.decoding;\n+\n+import static com.google.common.collect.ImmutableMap.toImmutableMap;\n+\n+import java.util.Map;\n+import java.util.function.Function;\n+\n+import com.google.common.collect.ImmutableList;\n+import com.google.common.collect.Streams;\n+\n+import com.linecorp.armeria.client.encoding.StreamDecoderFactory;\n+import com.linecorp.armeria.common.HttpRequest;\n+import com.linecorp.armeria.common.HttpResponse;\n+import com.linecorp.armeria.server.DecoratingService;\n+import com.linecorp.armeria.server.HttpService;\n+import com.linecorp.armeria.server.ServiceRequestContext;\n+import com.linecorp.armeria.server.SimpleDecoratingHttpService;\n+\n+/**\n+ * A {@link DecoratingService} that requests and decodes HTTP encoding (e.g., gzip) that has been applied to the\n+ * content of an {@link HttpRequest}.\n+ */\n+public class DecodingService extends SimpleDecoratingHttpService {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8dd3c3041b02cb5596cf03853660cb7e6f5ed713"}, "originalPosition": 39}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTg1MjUzMg==", "bodyText": "fix it!", "url": "https://github.com/line/armeria/pull/3087#discussion_r495852532", "createdAt": "2020-09-28T10:52:42Z", "author": {"login": "joonhaeng"}, "path": "core/src/main/java/com/linecorp/armeria/server/decoding/DecodingService.java", "diffHunk": "@@ -0,0 +1,66 @@\n+/*\n+ * Copyright 2020 LINE Corporation\n+ *\n+ * LINE Corporation licenses this file to you under the Apache License,\n+ * version 2.0 (the \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at:\n+ *\n+ *   https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+ * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n+ * License for the specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package com.linecorp.armeria.server.decoding;\n+\n+import static com.google.common.collect.ImmutableMap.toImmutableMap;\n+\n+import java.util.Map;\n+import java.util.function.Function;\n+\n+import com.google.common.collect.ImmutableList;\n+import com.google.common.collect.Streams;\n+\n+import com.linecorp.armeria.client.encoding.StreamDecoderFactory;\n+import com.linecorp.armeria.common.HttpRequest;\n+import com.linecorp.armeria.common.HttpResponse;\n+import com.linecorp.armeria.server.DecoratingService;\n+import com.linecorp.armeria.server.HttpService;\n+import com.linecorp.armeria.server.ServiceRequestContext;\n+import com.linecorp.armeria.server.SimpleDecoratingHttpService;\n+\n+/**\n+ * A {@link DecoratingService} that requests and decodes HTTP encoding (e.g., gzip) that has been applied to the\n+ * content of an {@link HttpRequest}.\n+ */\n+public class DecodingService extends SimpleDecoratingHttpService {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTg0NDUxNQ=="}, "originalCommit": {"oid": "8dd3c3041b02cb5596cf03853660cb7e6f5ed713"}, "originalPosition": 39}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEwNDAwNjIyOnYy", "diffSide": "RIGHT", "path": "core/src/main/java/com/linecorp/armeria/server/decoding/DecodingService.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOFQxMDozODoxMFrOHY3-_g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOFQxMDo1Mjo0NlrOHY4cBQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTg0NTExOA==", "bodyText": "Could be private?", "url": "https://github.com/line/armeria/pull/3087#discussion_r495845118", "createdAt": "2020-09-28T10:38:10Z", "author": {"login": "ikhoon"}, "path": "core/src/main/java/com/linecorp/armeria/server/decoding/DecodingService.java", "diffHunk": "@@ -0,0 +1,66 @@\n+/*\n+ * Copyright 2020 LINE Corporation\n+ *\n+ * LINE Corporation licenses this file to you under the Apache License,\n+ * version 2.0 (the \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at:\n+ *\n+ *   https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+ * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n+ * License for the specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package com.linecorp.armeria.server.decoding;\n+\n+import static com.google.common.collect.ImmutableMap.toImmutableMap;\n+\n+import java.util.Map;\n+import java.util.function.Function;\n+\n+import com.google.common.collect.ImmutableList;\n+import com.google.common.collect.Streams;\n+\n+import com.linecorp.armeria.client.encoding.StreamDecoderFactory;\n+import com.linecorp.armeria.common.HttpRequest;\n+import com.linecorp.armeria.common.HttpResponse;\n+import com.linecorp.armeria.server.DecoratingService;\n+import com.linecorp.armeria.server.HttpService;\n+import com.linecorp.armeria.server.ServiceRequestContext;\n+import com.linecorp.armeria.server.SimpleDecoratingHttpService;\n+\n+/**\n+ * A {@link DecoratingService} that requests and decodes HTTP encoding (e.g., gzip) that has been applied to the\n+ * content of an {@link HttpRequest}.\n+ */\n+public class DecodingService extends SimpleDecoratingHttpService {\n+\n+    /**\n+     * Creates a new {@link DecodingService} decorator with the default encodings of 'gzip' and 'deflate'.\n+     */\n+    public static Function<? super HttpService, DecodingService> newDecorator() {\n+        return delegate -> new DecodingService(delegate, ImmutableList\n+                .of(StreamDecoderFactory.gzip(), StreamDecoderFactory.deflate()));\n+    }\n+\n+    private final Map<String, StreamDecoderFactory> decoderFactories;\n+\n+    /**\n+     * Creates a new instance that decorates the specified {@link HttpService} with the provided decoders.\n+     */\n+    protected DecodingService(HttpService delegate, Iterable<? extends StreamDecoderFactory> decoderFactories) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8dd3c3041b02cb5596cf03853660cb7e6f5ed713"}, "originalPosition": 54}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTg1MjU0OQ==", "bodyText": "fix it!", "url": "https://github.com/line/armeria/pull/3087#discussion_r495852549", "createdAt": "2020-09-28T10:52:46Z", "author": {"login": "joonhaeng"}, "path": "core/src/main/java/com/linecorp/armeria/server/decoding/DecodingService.java", "diffHunk": "@@ -0,0 +1,66 @@\n+/*\n+ * Copyright 2020 LINE Corporation\n+ *\n+ * LINE Corporation licenses this file to you under the Apache License,\n+ * version 2.0 (the \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at:\n+ *\n+ *   https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+ * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n+ * License for the specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package com.linecorp.armeria.server.decoding;\n+\n+import static com.google.common.collect.ImmutableMap.toImmutableMap;\n+\n+import java.util.Map;\n+import java.util.function.Function;\n+\n+import com.google.common.collect.ImmutableList;\n+import com.google.common.collect.Streams;\n+\n+import com.linecorp.armeria.client.encoding.StreamDecoderFactory;\n+import com.linecorp.armeria.common.HttpRequest;\n+import com.linecorp.armeria.common.HttpResponse;\n+import com.linecorp.armeria.server.DecoratingService;\n+import com.linecorp.armeria.server.HttpService;\n+import com.linecorp.armeria.server.ServiceRequestContext;\n+import com.linecorp.armeria.server.SimpleDecoratingHttpService;\n+\n+/**\n+ * A {@link DecoratingService} that requests and decodes HTTP encoding (e.g., gzip) that has been applied to the\n+ * content of an {@link HttpRequest}.\n+ */\n+public class DecodingService extends SimpleDecoratingHttpService {\n+\n+    /**\n+     * Creates a new {@link DecodingService} decorator with the default encodings of 'gzip' and 'deflate'.\n+     */\n+    public static Function<? super HttpService, DecodingService> newDecorator() {\n+        return delegate -> new DecodingService(delegate, ImmutableList\n+                .of(StreamDecoderFactory.gzip(), StreamDecoderFactory.deflate()));\n+    }\n+\n+    private final Map<String, StreamDecoderFactory> decoderFactories;\n+\n+    /**\n+     * Creates a new instance that decorates the specified {@link HttpService} with the provided decoders.\n+     */\n+    protected DecodingService(HttpService delegate, Iterable<? extends StreamDecoderFactory> decoderFactories) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTg0NTExOA=="}, "originalCommit": {"oid": "8dd3c3041b02cb5596cf03853660cb7e6f5ed713"}, "originalPosition": 54}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEwNDAyMTIyOnYy", "diffSide": "RIGHT", "path": "core/src/main/java/com/linecorp/armeria/server/decoding/DecodingService.java", "isResolved": true, "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOFQxMDo0MjoyMFrOHY4Hpg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQwNzoxMjo0NFrOHZd84A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTg0NzMzNA==", "bodyText": "Users might want to customize StreamDecoderFactorys.\nThe following factories would be useful for that case.\n\n  \n    \n      armeria/core/src/main/java/com/linecorp/armeria/client/encoding/DecodingClient.java\n    \n    \n        Lines 51 to 62\n      in\n      eb33d2b\n    \n    \n    \n    \n\n        \n          \n               public static Function<? super HttpClient, DecodingClient> \n        \n\n        \n          \n               newDecorator(StreamDecoderFactory... decoderFactories) { \n        \n\n        \n          \n                   return newDecorator(ImmutableList.copyOf(decoderFactories)); \n        \n\n        \n          \n               } \n        \n\n        \n          \n            \n        \n\n        \n          \n               /** \n        \n\n        \n          \n                * Creates a new {@link DecodingClient} decorator with the specified {@link StreamDecoderFactory}s. \n        \n\n        \n          \n                */ \n        \n\n        \n          \n               public static Function<? super HttpClient, DecodingClient> newDecorator( \n        \n\n        \n          \n                       Iterable<? extends StreamDecoderFactory> decoderFactories) { \n        \n\n        \n          \n                   return client -> new DecodingClient(client, decoderFactories); \n        \n\n        \n          \n               } \n        \n    \n  \n\n\nBy the way, We need to discuss StreamDecoderFactory issue before going further.", "url": "https://github.com/line/armeria/pull/3087#discussion_r495847334", "createdAt": "2020-09-28T10:42:20Z", "author": {"login": "ikhoon"}, "path": "core/src/main/java/com/linecorp/armeria/server/decoding/DecodingService.java", "diffHunk": "@@ -0,0 +1,66 @@\n+/*\n+ * Copyright 2020 LINE Corporation\n+ *\n+ * LINE Corporation licenses this file to you under the Apache License,\n+ * version 2.0 (the \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at:\n+ *\n+ *   https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+ * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n+ * License for the specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package com.linecorp.armeria.server.decoding;\n+\n+import static com.google.common.collect.ImmutableMap.toImmutableMap;\n+\n+import java.util.Map;\n+import java.util.function.Function;\n+\n+import com.google.common.collect.ImmutableList;\n+import com.google.common.collect.Streams;\n+\n+import com.linecorp.armeria.client.encoding.StreamDecoderFactory;\n+import com.linecorp.armeria.common.HttpRequest;\n+import com.linecorp.armeria.common.HttpResponse;\n+import com.linecorp.armeria.server.DecoratingService;\n+import com.linecorp.armeria.server.HttpService;\n+import com.linecorp.armeria.server.ServiceRequestContext;\n+import com.linecorp.armeria.server.SimpleDecoratingHttpService;\n+\n+/**\n+ * A {@link DecoratingService} that requests and decodes HTTP encoding (e.g., gzip) that has been applied to the\n+ * content of an {@link HttpRequest}.\n+ */\n+public class DecodingService extends SimpleDecoratingHttpService {\n+\n+    /**\n+     * Creates a new {@link DecodingService} decorator with the default encodings of 'gzip' and 'deflate'.\n+     */\n+    public static Function<? super HttpService, DecodingService> newDecorator() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8dd3c3041b02cb5596cf03853660cb7e6f5ed713"}, "originalPosition": 44}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTg1NjY0Mw==", "bodyText": "In my opinion, StreamDecoderFactory, StreamDecoderFactories and ZlibStreamDecoder package need to move from com.linecorp.armeria.client.encoding to com.linecorp.armeria.common because roles are not tied to the client. but this action bring many class changes.", "url": "https://github.com/line/armeria/pull/3087#discussion_r495856643", "createdAt": "2020-09-28T11:01:22Z", "author": {"login": "joonhaeng"}, "path": "core/src/main/java/com/linecorp/armeria/server/decoding/DecodingService.java", "diffHunk": "@@ -0,0 +1,66 @@\n+/*\n+ * Copyright 2020 LINE Corporation\n+ *\n+ * LINE Corporation licenses this file to you under the Apache License,\n+ * version 2.0 (the \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at:\n+ *\n+ *   https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+ * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n+ * License for the specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package com.linecorp.armeria.server.decoding;\n+\n+import static com.google.common.collect.ImmutableMap.toImmutableMap;\n+\n+import java.util.Map;\n+import java.util.function.Function;\n+\n+import com.google.common.collect.ImmutableList;\n+import com.google.common.collect.Streams;\n+\n+import com.linecorp.armeria.client.encoding.StreamDecoderFactory;\n+import com.linecorp.armeria.common.HttpRequest;\n+import com.linecorp.armeria.common.HttpResponse;\n+import com.linecorp.armeria.server.DecoratingService;\n+import com.linecorp.armeria.server.HttpService;\n+import com.linecorp.armeria.server.ServiceRequestContext;\n+import com.linecorp.armeria.server.SimpleDecoratingHttpService;\n+\n+/**\n+ * A {@link DecoratingService} that requests and decodes HTTP encoding (e.g., gzip) that has been applied to the\n+ * content of an {@link HttpRequest}.\n+ */\n+public class DecodingService extends SimpleDecoratingHttpService {\n+\n+    /**\n+     * Creates a new {@link DecodingService} decorator with the default encodings of 'gzip' and 'deflate'.\n+     */\n+    public static Function<? super HttpService, DecodingService> newDecorator() {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTg0NzMzNA=="}, "originalCommit": {"oid": "8dd3c3041b02cb5596cf03853660cb7e6f5ed713"}, "originalPosition": 44}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTg3NjIwMw==", "bodyText": "To avoid breaking changes, how about?\n\nDeprecate client.encoding required in server-side too.\nCopy the code to common.encoding", "url": "https://github.com/line/armeria/pull/3087#discussion_r495876203", "createdAt": "2020-09-28T11:41:52Z", "author": {"login": "ikhoon"}, "path": "core/src/main/java/com/linecorp/armeria/server/decoding/DecodingService.java", "diffHunk": "@@ -0,0 +1,66 @@\n+/*\n+ * Copyright 2020 LINE Corporation\n+ *\n+ * LINE Corporation licenses this file to you under the Apache License,\n+ * version 2.0 (the \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at:\n+ *\n+ *   https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+ * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n+ * License for the specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package com.linecorp.armeria.server.decoding;\n+\n+import static com.google.common.collect.ImmutableMap.toImmutableMap;\n+\n+import java.util.Map;\n+import java.util.function.Function;\n+\n+import com.google.common.collect.ImmutableList;\n+import com.google.common.collect.Streams;\n+\n+import com.linecorp.armeria.client.encoding.StreamDecoderFactory;\n+import com.linecorp.armeria.common.HttpRequest;\n+import com.linecorp.armeria.common.HttpResponse;\n+import com.linecorp.armeria.server.DecoratingService;\n+import com.linecorp.armeria.server.HttpService;\n+import com.linecorp.armeria.server.ServiceRequestContext;\n+import com.linecorp.armeria.server.SimpleDecoratingHttpService;\n+\n+/**\n+ * A {@link DecoratingService} that requests and decodes HTTP encoding (e.g., gzip) that has been applied to the\n+ * content of an {@link HttpRequest}.\n+ */\n+public class DecodingService extends SimpleDecoratingHttpService {\n+\n+    /**\n+     * Creates a new {@link DecodingService} decorator with the default encodings of 'gzip' and 'deflate'.\n+     */\n+    public static Function<? super HttpService, DecodingService> newDecorator() {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTg0NzMzNA=="}, "originalCommit": {"oid": "8dd3c3041b02cb5596cf03853660cb7e6f5ed713"}, "originalPosition": 44}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTg4MDIzNQ==", "bodyText": "That's a good idea. Can I do that?", "url": "https://github.com/line/armeria/pull/3087#discussion_r495880235", "createdAt": "2020-09-28T11:50:12Z", "author": {"login": "joonhaeng"}, "path": "core/src/main/java/com/linecorp/armeria/server/decoding/DecodingService.java", "diffHunk": "@@ -0,0 +1,66 @@\n+/*\n+ * Copyright 2020 LINE Corporation\n+ *\n+ * LINE Corporation licenses this file to you under the Apache License,\n+ * version 2.0 (the \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at:\n+ *\n+ *   https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+ * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n+ * License for the specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package com.linecorp.armeria.server.decoding;\n+\n+import static com.google.common.collect.ImmutableMap.toImmutableMap;\n+\n+import java.util.Map;\n+import java.util.function.Function;\n+\n+import com.google.common.collect.ImmutableList;\n+import com.google.common.collect.Streams;\n+\n+import com.linecorp.armeria.client.encoding.StreamDecoderFactory;\n+import com.linecorp.armeria.common.HttpRequest;\n+import com.linecorp.armeria.common.HttpResponse;\n+import com.linecorp.armeria.server.DecoratingService;\n+import com.linecorp.armeria.server.HttpService;\n+import com.linecorp.armeria.server.ServiceRequestContext;\n+import com.linecorp.armeria.server.SimpleDecoratingHttpService;\n+\n+/**\n+ * A {@link DecoratingService} that requests and decodes HTTP encoding (e.g., gzip) that has been applied to the\n+ * content of an {@link HttpRequest}.\n+ */\n+public class DecodingService extends SimpleDecoratingHttpService {\n+\n+    /**\n+     * Creates a new {@link DecodingService} decorator with the default encodings of 'gzip' and 'deflate'.\n+     */\n+    public static Function<? super HttpService, DecodingService> newDecorator() {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTg0NzMzNA=="}, "originalCommit": {"oid": "8dd3c3041b02cb5596cf03853660cb7e6f5ed713"}, "originalPosition": 44}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjMzODUyNg==", "bodyText": "Sure! Please do that. \ud83d\ude4f", "url": "https://github.com/line/armeria/pull/3087#discussion_r496338526", "createdAt": "2020-09-29T02:16:28Z", "author": {"login": "ikhoon"}, "path": "core/src/main/java/com/linecorp/armeria/server/decoding/DecodingService.java", "diffHunk": "@@ -0,0 +1,66 @@\n+/*\n+ * Copyright 2020 LINE Corporation\n+ *\n+ * LINE Corporation licenses this file to you under the Apache License,\n+ * version 2.0 (the \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at:\n+ *\n+ *   https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+ * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n+ * License for the specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package com.linecorp.armeria.server.decoding;\n+\n+import static com.google.common.collect.ImmutableMap.toImmutableMap;\n+\n+import java.util.Map;\n+import java.util.function.Function;\n+\n+import com.google.common.collect.ImmutableList;\n+import com.google.common.collect.Streams;\n+\n+import com.linecorp.armeria.client.encoding.StreamDecoderFactory;\n+import com.linecorp.armeria.common.HttpRequest;\n+import com.linecorp.armeria.common.HttpResponse;\n+import com.linecorp.armeria.server.DecoratingService;\n+import com.linecorp.armeria.server.HttpService;\n+import com.linecorp.armeria.server.ServiceRequestContext;\n+import com.linecorp.armeria.server.SimpleDecoratingHttpService;\n+\n+/**\n+ * A {@link DecoratingService} that requests and decodes HTTP encoding (e.g., gzip) that has been applied to the\n+ * content of an {@link HttpRequest}.\n+ */\n+public class DecodingService extends SimpleDecoratingHttpService {\n+\n+    /**\n+     * Creates a new {@link DecodingService} decorator with the default encodings of 'gzip' and 'deflate'.\n+     */\n+    public static Function<? super HttpService, DecodingService> newDecorator() {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTg0NzMzNA=="}, "originalCommit": {"oid": "8dd3c3041b02cb5596cf03853660cb7e6f5ed713"}, "originalPosition": 44}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjQ2NzE2OA==", "bodyText": "I just finished it and pushed.", "url": "https://github.com/line/armeria/pull/3087#discussion_r496467168", "createdAt": "2020-09-29T07:12:44Z", "author": {"login": "joonhaeng"}, "path": "core/src/main/java/com/linecorp/armeria/server/decoding/DecodingService.java", "diffHunk": "@@ -0,0 +1,66 @@\n+/*\n+ * Copyright 2020 LINE Corporation\n+ *\n+ * LINE Corporation licenses this file to you under the Apache License,\n+ * version 2.0 (the \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at:\n+ *\n+ *   https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+ * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n+ * License for the specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package com.linecorp.armeria.server.decoding;\n+\n+import static com.google.common.collect.ImmutableMap.toImmutableMap;\n+\n+import java.util.Map;\n+import java.util.function.Function;\n+\n+import com.google.common.collect.ImmutableList;\n+import com.google.common.collect.Streams;\n+\n+import com.linecorp.armeria.client.encoding.StreamDecoderFactory;\n+import com.linecorp.armeria.common.HttpRequest;\n+import com.linecorp.armeria.common.HttpResponse;\n+import com.linecorp.armeria.server.DecoratingService;\n+import com.linecorp.armeria.server.HttpService;\n+import com.linecorp.armeria.server.ServiceRequestContext;\n+import com.linecorp.armeria.server.SimpleDecoratingHttpService;\n+\n+/**\n+ * A {@link DecoratingService} that requests and decodes HTTP encoding (e.g., gzip) that has been applied to the\n+ * content of an {@link HttpRequest}.\n+ */\n+public class DecodingService extends SimpleDecoratingHttpService {\n+\n+    /**\n+     * Creates a new {@link DecodingService} decorator with the default encodings of 'gzip' and 'deflate'.\n+     */\n+    public static Function<? super HttpService, DecodingService> newDecorator() {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTg0NzMzNA=="}, "originalCommit": {"oid": "8dd3c3041b02cb5596cf03853660cb7e6f5ed713"}, "originalPosition": 44}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEwNzE3MzEyOnYy", "diffSide": "RIGHT", "path": "core/src/test/java/com/linecorp/armeria/server/decoding/DecodingServiceTest.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQwMjowNToxMlrOHZV7gw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMVQxNDoyMToxMFrOHbMxDw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjMzNTc0Nw==", "bodyText": "And how about adding EncodingClient for the completing data flow - compressing by client and decompressing by server?\nYou can do that this PR or in the following PR. \ud83d\ude09", "url": "https://github.com/line/armeria/pull/3087#discussion_r496335747", "createdAt": "2020-09-29T02:05:12Z", "author": {"login": "ikhoon"}, "path": "core/src/test/java/com/linecorp/armeria/server/decoding/DecodingServiceTest.java", "diffHunk": "@@ -0,0 +1,100 @@\n+/*\n+ * Copyright 2020 LINE Corporation\n+ *\n+ * LINE Corporation licenses this file to you under the Apache License,\n+ * version 2.0 (the \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at:\n+ *\n+ *   https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+ * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n+ * License for the specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package com.linecorp.armeria.server.decoding;\n+\n+import static org.assertj.core.api.Assertions.assertThat;\n+\n+import java.io.ByteArrayOutputStream;\n+import java.io.IOException;\n+import java.nio.charset.StandardCharsets;\n+import java.util.zip.DeflaterOutputStream;\n+import java.util.zip.GZIPOutputStream;\n+\n+import org.junit.jupiter.api.Test;\n+import org.junit.jupiter.api.extension.RegisterExtension;\n+\n+import com.linecorp.armeria.client.WebClient;\n+import com.linecorp.armeria.common.HttpData;\n+import com.linecorp.armeria.common.HttpHeaderNames;\n+import com.linecorp.armeria.common.HttpMethod;\n+import com.linecorp.armeria.common.HttpResponse;\n+import com.linecorp.armeria.common.HttpStatus;\n+import com.linecorp.armeria.common.MediaType;\n+import com.linecorp.armeria.common.RequestHeaders;\n+import com.linecorp.armeria.common.ResponseHeaders;\n+import com.linecorp.armeria.server.HttpService;\n+import com.linecorp.armeria.server.ServerBuilder;\n+import com.linecorp.armeria.testing.junit5.server.ServerExtension;\n+\n+class DecodingServiceTest {\n+\n+    @RegisterExtension\n+    static final ServerExtension server = new ServerExtension() {\n+        @Override\n+        protected void configure(ServerBuilder sb) throws Exception {\n+            final HttpService httpService = (ctx, req) -> HttpResponse.from(\n+                    req.aggregate()\n+                       .thenApply(aggregated -> {\n+                           final ResponseHeaders responseHeaders =\n+                                   ResponseHeaders.of(HttpStatus.OK,\n+                                                      HttpHeaderNames.CONTENT_TYPE, MediaType.PLAIN_TEXT_UTF_8);\n+                           return HttpResponse.of(responseHeaders,\n+                                                  HttpData.ofUtf8(\"Hello \" + aggregated.contentUtf8() + '!'));\n+                       }));\n+            sb.decorator(\"/decodeTest\", DecodingService.newDecorator());\n+            sb.service(\"/decodeTest\", httpService);\n+\n+            sb.decoratorUnder(\"/\", (delegate, ctx, req) -> {\n+                return delegate.serve(ctx, req);\n+            });\n+        }\n+    };\n+\n+    @Test\n+    void decodingGzippedPayloadFromClient() throws IOException {\n+\n+        final WebClient client = WebClient.builder(server.httpUri()).build();\n+        final RequestHeaders headers = RequestHeaders.of(HttpMethod.POST, \"/decodeTest\",\n+                                                         HttpHeaderNames.CONTENT_ENCODING, \"gzip\");\n+        final ByteArrayOutputStream encodedStream = new ByteArrayOutputStream();\n+        final DeflaterOutputStream encodingStream = new GZIPOutputStream(encodedStream, true);\n+\n+        final byte[] testByteArray = \"Armeria Gzip Test\".getBytes(StandardCharsets.UTF_8);\n+        encodingStream.write(testByteArray);\n+        encodingStream.flush();\n+\n+        assertThat(client.execute(headers, HttpData.wrap(encodedStream.toByteArray())).aggregate().join()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "499e93fdc955e82188ee1a1b9514ea49ba841c61"}, "originalPosition": 80}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjQ2NjA3MA==", "bodyText": "EncodingClient is good idea that armeria support end-to-end compressed data for reduce traffic size. I'll make another PR to implement EncodingClient ASAP \ud83d\ude04", "url": "https://github.com/line/armeria/pull/3087#discussion_r496466070", "createdAt": "2020-09-29T07:10:40Z", "author": {"login": "joonhaeng"}, "path": "core/src/test/java/com/linecorp/armeria/server/decoding/DecodingServiceTest.java", "diffHunk": "@@ -0,0 +1,100 @@\n+/*\n+ * Copyright 2020 LINE Corporation\n+ *\n+ * LINE Corporation licenses this file to you under the Apache License,\n+ * version 2.0 (the \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at:\n+ *\n+ *   https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+ * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n+ * License for the specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package com.linecorp.armeria.server.decoding;\n+\n+import static org.assertj.core.api.Assertions.assertThat;\n+\n+import java.io.ByteArrayOutputStream;\n+import java.io.IOException;\n+import java.nio.charset.StandardCharsets;\n+import java.util.zip.DeflaterOutputStream;\n+import java.util.zip.GZIPOutputStream;\n+\n+import org.junit.jupiter.api.Test;\n+import org.junit.jupiter.api.extension.RegisterExtension;\n+\n+import com.linecorp.armeria.client.WebClient;\n+import com.linecorp.armeria.common.HttpData;\n+import com.linecorp.armeria.common.HttpHeaderNames;\n+import com.linecorp.armeria.common.HttpMethod;\n+import com.linecorp.armeria.common.HttpResponse;\n+import com.linecorp.armeria.common.HttpStatus;\n+import com.linecorp.armeria.common.MediaType;\n+import com.linecorp.armeria.common.RequestHeaders;\n+import com.linecorp.armeria.common.ResponseHeaders;\n+import com.linecorp.armeria.server.HttpService;\n+import com.linecorp.armeria.server.ServerBuilder;\n+import com.linecorp.armeria.testing.junit5.server.ServerExtension;\n+\n+class DecodingServiceTest {\n+\n+    @RegisterExtension\n+    static final ServerExtension server = new ServerExtension() {\n+        @Override\n+        protected void configure(ServerBuilder sb) throws Exception {\n+            final HttpService httpService = (ctx, req) -> HttpResponse.from(\n+                    req.aggregate()\n+                       .thenApply(aggregated -> {\n+                           final ResponseHeaders responseHeaders =\n+                                   ResponseHeaders.of(HttpStatus.OK,\n+                                                      HttpHeaderNames.CONTENT_TYPE, MediaType.PLAIN_TEXT_UTF_8);\n+                           return HttpResponse.of(responseHeaders,\n+                                                  HttpData.ofUtf8(\"Hello \" + aggregated.contentUtf8() + '!'));\n+                       }));\n+            sb.decorator(\"/decodeTest\", DecodingService.newDecorator());\n+            sb.service(\"/decodeTest\", httpService);\n+\n+            sb.decoratorUnder(\"/\", (delegate, ctx, req) -> {\n+                return delegate.serve(ctx, req);\n+            });\n+        }\n+    };\n+\n+    @Test\n+    void decodingGzippedPayloadFromClient() throws IOException {\n+\n+        final WebClient client = WebClient.builder(server.httpUri()).build();\n+        final RequestHeaders headers = RequestHeaders.of(HttpMethod.POST, \"/decodeTest\",\n+                                                         HttpHeaderNames.CONTENT_ENCODING, \"gzip\");\n+        final ByteArrayOutputStream encodedStream = new ByteArrayOutputStream();\n+        final DeflaterOutputStream encodingStream = new GZIPOutputStream(encodedStream, true);\n+\n+        final byte[] testByteArray = \"Armeria Gzip Test\".getBytes(StandardCharsets.UTF_8);\n+        encodingStream.write(testByteArray);\n+        encodingStream.flush();\n+\n+        assertThat(client.execute(headers, HttpData.wrap(encodedStream.toByteArray())).aggregate().join()", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjMzNTc0Nw=="}, "originalCommit": {"oid": "499e93fdc955e82188ee1a1b9514ea49ba841c61"}, "originalPosition": 80}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODI4Mjc2Nw==", "bodyText": "Awesome, @joonhaeng. Looking forward to the follow-up PR. \u2764\ufe0f", "url": "https://github.com/line/armeria/pull/3087#discussion_r498282767", "createdAt": "2020-10-01T14:21:10Z", "author": {"login": "trustin"}, "path": "core/src/test/java/com/linecorp/armeria/server/decoding/DecodingServiceTest.java", "diffHunk": "@@ -0,0 +1,100 @@\n+/*\n+ * Copyright 2020 LINE Corporation\n+ *\n+ * LINE Corporation licenses this file to you under the Apache License,\n+ * version 2.0 (the \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at:\n+ *\n+ *   https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+ * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n+ * License for the specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package com.linecorp.armeria.server.decoding;\n+\n+import static org.assertj.core.api.Assertions.assertThat;\n+\n+import java.io.ByteArrayOutputStream;\n+import java.io.IOException;\n+import java.nio.charset.StandardCharsets;\n+import java.util.zip.DeflaterOutputStream;\n+import java.util.zip.GZIPOutputStream;\n+\n+import org.junit.jupiter.api.Test;\n+import org.junit.jupiter.api.extension.RegisterExtension;\n+\n+import com.linecorp.armeria.client.WebClient;\n+import com.linecorp.armeria.common.HttpData;\n+import com.linecorp.armeria.common.HttpHeaderNames;\n+import com.linecorp.armeria.common.HttpMethod;\n+import com.linecorp.armeria.common.HttpResponse;\n+import com.linecorp.armeria.common.HttpStatus;\n+import com.linecorp.armeria.common.MediaType;\n+import com.linecorp.armeria.common.RequestHeaders;\n+import com.linecorp.armeria.common.ResponseHeaders;\n+import com.linecorp.armeria.server.HttpService;\n+import com.linecorp.armeria.server.ServerBuilder;\n+import com.linecorp.armeria.testing.junit5.server.ServerExtension;\n+\n+class DecodingServiceTest {\n+\n+    @RegisterExtension\n+    static final ServerExtension server = new ServerExtension() {\n+        @Override\n+        protected void configure(ServerBuilder sb) throws Exception {\n+            final HttpService httpService = (ctx, req) -> HttpResponse.from(\n+                    req.aggregate()\n+                       .thenApply(aggregated -> {\n+                           final ResponseHeaders responseHeaders =\n+                                   ResponseHeaders.of(HttpStatus.OK,\n+                                                      HttpHeaderNames.CONTENT_TYPE, MediaType.PLAIN_TEXT_UTF_8);\n+                           return HttpResponse.of(responseHeaders,\n+                                                  HttpData.ofUtf8(\"Hello \" + aggregated.contentUtf8() + '!'));\n+                       }));\n+            sb.decorator(\"/decodeTest\", DecodingService.newDecorator());\n+            sb.service(\"/decodeTest\", httpService);\n+\n+            sb.decoratorUnder(\"/\", (delegate, ctx, req) -> {\n+                return delegate.serve(ctx, req);\n+            });\n+        }\n+    };\n+\n+    @Test\n+    void decodingGzippedPayloadFromClient() throws IOException {\n+\n+        final WebClient client = WebClient.builder(server.httpUri()).build();\n+        final RequestHeaders headers = RequestHeaders.of(HttpMethod.POST, \"/decodeTest\",\n+                                                         HttpHeaderNames.CONTENT_ENCODING, \"gzip\");\n+        final ByteArrayOutputStream encodedStream = new ByteArrayOutputStream();\n+        final DeflaterOutputStream encodingStream = new GZIPOutputStream(encodedStream, true);\n+\n+        final byte[] testByteArray = \"Armeria Gzip Test\".getBytes(StandardCharsets.UTF_8);\n+        encodingStream.write(testByteArray);\n+        encodingStream.flush();\n+\n+        assertThat(client.execute(headers, HttpData.wrap(encodedStream.toByteArray())).aggregate().join()", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjMzNTc0Nw=="}, "originalCommit": {"oid": "499e93fdc955e82188ee1a1b9514ea49ba841c61"}, "originalPosition": 80}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEwODAxMzIyOnYy", "diffSide": "RIGHT", "path": "core/src/main/java/com/linecorp/armeria/server/decoding/DecodingService.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQwNzoxOTozNlrOHZeL8g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxOTowNzo1MlrOHZ805w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjQ3MTAyNg==", "bodyText": "We should update the request. \ud83d\ude04\nctx.updateRequest(decodedRequest);", "url": "https://github.com/line/armeria/pull/3087#discussion_r496471026", "createdAt": "2020-09-29T07:19:36Z", "author": {"login": "minwoox"}, "path": "core/src/main/java/com/linecorp/armeria/server/decoding/DecodingService.java", "diffHunk": "@@ -0,0 +1,81 @@\n+/*\n+ * Copyright 2020 LINE Corporation\n+ *\n+ * LINE Corporation licenses this file to you under the Apache License,\n+ * version 2.0 (the \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at:\n+ *\n+ *   https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+ * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n+ * License for the specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package com.linecorp.armeria.server.decoding;\n+\n+import static com.google.common.collect.ImmutableMap.toImmutableMap;\n+\n+import java.util.Map;\n+import java.util.function.Function;\n+\n+import com.google.common.collect.ImmutableList;\n+import com.google.common.collect.Streams;\n+\n+import com.linecorp.armeria.common.HttpRequest;\n+import com.linecorp.armeria.common.HttpResponse;\n+import com.linecorp.armeria.common.encoding.StreamDecoderFactory;\n+import com.linecorp.armeria.server.DecoratingService;\n+import com.linecorp.armeria.server.HttpService;\n+import com.linecorp.armeria.server.ServiceRequestContext;\n+import com.linecorp.armeria.server.SimpleDecoratingHttpService;\n+\n+/**\n+ * A {@link DecoratingService} that requests and decodes HTTP encoding (e.g., gzip) that has been applied to the\n+ * content of an {@link HttpRequest}.\n+ */\n+public final class DecodingService extends SimpleDecoratingHttpService {\n+\n+    /**\n+     * Creates a new {@link DecodingService} decorator with the default encodings of 'gzip' and 'deflate'.\n+     */\n+    public static Function<? super HttpService, DecodingService> newDecorator() {\n+        return newDecorator(ImmutableList.of(StreamDecoderFactory.gzip(), StreamDecoderFactory.deflate()));\n+    }\n+\n+    /**\n+     * Creates a new {@link DecodingService} decorator with the specified {@link StreamDecoderFactory}s.\n+     */\n+    public static Function<? super HttpService, DecodingService> newDecorator(\n+            StreamDecoderFactory... decoderFactories) {\n+        return newDecorator(ImmutableList.copyOf(decoderFactories));\n+    }\n+\n+    /**\n+     * Creates a new {@link DecodingService} decorator with the specified {@link StreamDecoderFactory}s.\n+     */\n+    public static Function<? super HttpService, DecodingService> newDecorator(\n+            Iterable<? extends StreamDecoderFactory> decoderFactories) {\n+        return delegate -> new DecodingService(delegate, decoderFactories);\n+    }\n+\n+    private final Map<String, StreamDecoderFactory> decoderFactories;\n+\n+    /**\n+     * Creates a new instance that decorates the specified {@link HttpService} with the provided decoders.\n+     */\n+    private DecodingService(HttpService delegate, Iterable<? extends StreamDecoderFactory> decoderFactories) {\n+        super(delegate);\n+        this.decoderFactories = Streams.stream(decoderFactories)\n+                                       .collect(toImmutableMap(StreamDecoderFactory::encodingHeaderValue,\n+                                                               Function.identity()));\n+    }\n+\n+    @Override\n+    public HttpResponse serve(ServiceRequestContext ctx, HttpRequest req) throws Exception {\n+        final HttpDecodedRequest decodedRequest = new HttpDecodedRequest(req, decoderFactories, ctx.alloc());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9bbaa3fdc8046c8c8f58603ae9133c2401e90a4b"}, "originalPosition": 78}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Njk3MzAzMQ==", "bodyText": "fix it! wow...I didn't know it was necessary... \ud83d\ude22", "url": "https://github.com/line/armeria/pull/3087#discussion_r496973031", "createdAt": "2020-09-29T19:07:52Z", "author": {"login": "joonhaeng"}, "path": "core/src/main/java/com/linecorp/armeria/server/decoding/DecodingService.java", "diffHunk": "@@ -0,0 +1,81 @@\n+/*\n+ * Copyright 2020 LINE Corporation\n+ *\n+ * LINE Corporation licenses this file to you under the Apache License,\n+ * version 2.0 (the \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at:\n+ *\n+ *   https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+ * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n+ * License for the specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package com.linecorp.armeria.server.decoding;\n+\n+import static com.google.common.collect.ImmutableMap.toImmutableMap;\n+\n+import java.util.Map;\n+import java.util.function.Function;\n+\n+import com.google.common.collect.ImmutableList;\n+import com.google.common.collect.Streams;\n+\n+import com.linecorp.armeria.common.HttpRequest;\n+import com.linecorp.armeria.common.HttpResponse;\n+import com.linecorp.armeria.common.encoding.StreamDecoderFactory;\n+import com.linecorp.armeria.server.DecoratingService;\n+import com.linecorp.armeria.server.HttpService;\n+import com.linecorp.armeria.server.ServiceRequestContext;\n+import com.linecorp.armeria.server.SimpleDecoratingHttpService;\n+\n+/**\n+ * A {@link DecoratingService} that requests and decodes HTTP encoding (e.g., gzip) that has been applied to the\n+ * content of an {@link HttpRequest}.\n+ */\n+public final class DecodingService extends SimpleDecoratingHttpService {\n+\n+    /**\n+     * Creates a new {@link DecodingService} decorator with the default encodings of 'gzip' and 'deflate'.\n+     */\n+    public static Function<? super HttpService, DecodingService> newDecorator() {\n+        return newDecorator(ImmutableList.of(StreamDecoderFactory.gzip(), StreamDecoderFactory.deflate()));\n+    }\n+\n+    /**\n+     * Creates a new {@link DecodingService} decorator with the specified {@link StreamDecoderFactory}s.\n+     */\n+    public static Function<? super HttpService, DecodingService> newDecorator(\n+            StreamDecoderFactory... decoderFactories) {\n+        return newDecorator(ImmutableList.copyOf(decoderFactories));\n+    }\n+\n+    /**\n+     * Creates a new {@link DecodingService} decorator with the specified {@link StreamDecoderFactory}s.\n+     */\n+    public static Function<? super HttpService, DecodingService> newDecorator(\n+            Iterable<? extends StreamDecoderFactory> decoderFactories) {\n+        return delegate -> new DecodingService(delegate, decoderFactories);\n+    }\n+\n+    private final Map<String, StreamDecoderFactory> decoderFactories;\n+\n+    /**\n+     * Creates a new instance that decorates the specified {@link HttpService} with the provided decoders.\n+     */\n+    private DecodingService(HttpService delegate, Iterable<? extends StreamDecoderFactory> decoderFactories) {\n+        super(delegate);\n+        this.decoderFactories = Streams.stream(decoderFactories)\n+                                       .collect(toImmutableMap(StreamDecoderFactory::encodingHeaderValue,\n+                                                               Function.identity()));\n+    }\n+\n+    @Override\n+    public HttpResponse serve(ServiceRequestContext ctx, HttpRequest req) throws Exception {\n+        final HttpDecodedRequest decodedRequest = new HttpDecodedRequest(req, decoderFactories, ctx.alloc());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjQ3MTAyNg=="}, "originalCommit": {"oid": "9bbaa3fdc8046c8c8f58603ae9133c2401e90a4b"}, "originalPosition": 78}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEwOTE1NTQzOnYy", "diffSide": "RIGHT", "path": "core/src/main/java/com/linecorp/armeria/server/decoding/HttpDecodedRequest.java", "isResolved": false, "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxMTo1MToyMlrOHZpYFw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMVQxNzo1MToyM1rOHbVDGQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjY1NDM1OQ==", "bodyText": "I think we can do this only once when this request is created because HttpRequest always has a header when it's created. \ud83d\ude04", "url": "https://github.com/line/armeria/pull/3087#discussion_r496654359", "createdAt": "2020-09-29T11:51:22Z", "author": {"login": "minwoox"}, "path": "core/src/main/java/com/linecorp/armeria/server/decoding/HttpDecodedRequest.java", "diffHunk": "@@ -0,0 +1,91 @@\n+/*\n+ * Copyright 2020 LINE Corporation\n+ *\n+ * LINE Corporation licenses this file to you under the Apache License,\n+ * version 2.0 (the \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at:\n+ *\n+ *   https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+ * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n+ * License for the specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package com.linecorp.armeria.server.decoding;\n+\n+import java.util.Map;\n+\n+import javax.annotation.Nullable;\n+\n+import org.reactivestreams.Subscriber;\n+\n+import com.google.common.base.Ascii;\n+\n+import com.linecorp.armeria.common.FilteredHttpRequest;\n+import com.linecorp.armeria.common.HttpData;\n+import com.linecorp.armeria.common.HttpHeaderNames;\n+import com.linecorp.armeria.common.HttpObject;\n+import com.linecorp.armeria.common.HttpRequest;\n+import com.linecorp.armeria.common.encoding.StreamDecoder;\n+import com.linecorp.armeria.common.encoding.StreamDecoderFactory;\n+\n+import io.netty.buffer.ByteBufAllocator;\n+\n+/**\n+ * A {@link FilteredHttpRequest} that applies HTTP decoding to {@link HttpObject}s as they are published.\n+ */\n+final class HttpDecodedRequest extends FilteredHttpRequest {\n+\n+    private final Map<String, StreamDecoderFactory> availableDecoders;\n+    private final ByteBufAllocator alloc;\n+\n+    @Nullable\n+    private StreamDecoder responseDecoder;\n+\n+    HttpDecodedRequest(HttpRequest delegate, Map<String, StreamDecoderFactory> availableDecoders,\n+                       ByteBufAllocator alloc) {\n+        super(delegate);\n+        this.availableDecoders = availableDecoders;\n+        this.alloc = alloc;\n+    }\n+\n+    @Override\n+    protected HttpObject filter(HttpObject obj) {\n+        if (obj instanceof HttpData) {\n+            final String contentEncoding = headers().get(HttpHeaderNames.CONTENT_ENCODING);\n+            if (contentEncoding != null) {\n+                final StreamDecoderFactory decoderFactory =\n+                        availableDecoders.get(Ascii.toLowerCase(contentEncoding));\n+                // If the client sent an encoding we don't support, decoding will be skipped which is ok.\n+                if (decoderFactory != null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9bbaa3fdc8046c8c8f58603ae9133c2401e90a4b"}, "originalPosition": 63}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Njk3MzMxNQ==", "bodyText": "add decoderCheck for prevent check many times", "url": "https://github.com/line/armeria/pull/3087#discussion_r496973315", "createdAt": "2020-09-29T19:08:25Z", "author": {"login": "joonhaeng"}, "path": "core/src/main/java/com/linecorp/armeria/server/decoding/HttpDecodedRequest.java", "diffHunk": "@@ -0,0 +1,91 @@\n+/*\n+ * Copyright 2020 LINE Corporation\n+ *\n+ * LINE Corporation licenses this file to you under the Apache License,\n+ * version 2.0 (the \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at:\n+ *\n+ *   https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+ * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n+ * License for the specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package com.linecorp.armeria.server.decoding;\n+\n+import java.util.Map;\n+\n+import javax.annotation.Nullable;\n+\n+import org.reactivestreams.Subscriber;\n+\n+import com.google.common.base.Ascii;\n+\n+import com.linecorp.armeria.common.FilteredHttpRequest;\n+import com.linecorp.armeria.common.HttpData;\n+import com.linecorp.armeria.common.HttpHeaderNames;\n+import com.linecorp.armeria.common.HttpObject;\n+import com.linecorp.armeria.common.HttpRequest;\n+import com.linecorp.armeria.common.encoding.StreamDecoder;\n+import com.linecorp.armeria.common.encoding.StreamDecoderFactory;\n+\n+import io.netty.buffer.ByteBufAllocator;\n+\n+/**\n+ * A {@link FilteredHttpRequest} that applies HTTP decoding to {@link HttpObject}s as they are published.\n+ */\n+final class HttpDecodedRequest extends FilteredHttpRequest {\n+\n+    private final Map<String, StreamDecoderFactory> availableDecoders;\n+    private final ByteBufAllocator alloc;\n+\n+    @Nullable\n+    private StreamDecoder responseDecoder;\n+\n+    HttpDecodedRequest(HttpRequest delegate, Map<String, StreamDecoderFactory> availableDecoders,\n+                       ByteBufAllocator alloc) {\n+        super(delegate);\n+        this.availableDecoders = availableDecoders;\n+        this.alloc = alloc;\n+    }\n+\n+    @Override\n+    protected HttpObject filter(HttpObject obj) {\n+        if (obj instanceof HttpData) {\n+            final String contentEncoding = headers().get(HttpHeaderNames.CONTENT_ENCODING);\n+            if (contentEncoding != null) {\n+                final StreamDecoderFactory decoderFactory =\n+                        availableDecoders.get(Ascii.toLowerCase(contentEncoding));\n+                // If the client sent an encoding we don't support, decoding will be skipped which is ok.\n+                if (decoderFactory != null) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjY1NDM1OQ=="}, "originalCommit": {"oid": "9bbaa3fdc8046c8c8f58603ae9133c2401e90a4b"}, "originalPosition": 63}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzAwMTY4Ng==", "bodyText": "Would it have been better to do it in the constructor?", "url": "https://github.com/line/armeria/pull/3087#discussion_r497001686", "createdAt": "2020-09-29T19:46:19Z", "author": {"login": "joonhaeng"}, "path": "core/src/main/java/com/linecorp/armeria/server/decoding/HttpDecodedRequest.java", "diffHunk": "@@ -0,0 +1,91 @@\n+/*\n+ * Copyright 2020 LINE Corporation\n+ *\n+ * LINE Corporation licenses this file to you under the Apache License,\n+ * version 2.0 (the \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at:\n+ *\n+ *   https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+ * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n+ * License for the specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package com.linecorp.armeria.server.decoding;\n+\n+import java.util.Map;\n+\n+import javax.annotation.Nullable;\n+\n+import org.reactivestreams.Subscriber;\n+\n+import com.google.common.base.Ascii;\n+\n+import com.linecorp.armeria.common.FilteredHttpRequest;\n+import com.linecorp.armeria.common.HttpData;\n+import com.linecorp.armeria.common.HttpHeaderNames;\n+import com.linecorp.armeria.common.HttpObject;\n+import com.linecorp.armeria.common.HttpRequest;\n+import com.linecorp.armeria.common.encoding.StreamDecoder;\n+import com.linecorp.armeria.common.encoding.StreamDecoderFactory;\n+\n+import io.netty.buffer.ByteBufAllocator;\n+\n+/**\n+ * A {@link FilteredHttpRequest} that applies HTTP decoding to {@link HttpObject}s as they are published.\n+ */\n+final class HttpDecodedRequest extends FilteredHttpRequest {\n+\n+    private final Map<String, StreamDecoderFactory> availableDecoders;\n+    private final ByteBufAllocator alloc;\n+\n+    @Nullable\n+    private StreamDecoder responseDecoder;\n+\n+    HttpDecodedRequest(HttpRequest delegate, Map<String, StreamDecoderFactory> availableDecoders,\n+                       ByteBufAllocator alloc) {\n+        super(delegate);\n+        this.availableDecoders = availableDecoders;\n+        this.alloc = alloc;\n+    }\n+\n+    @Override\n+    protected HttpObject filter(HttpObject obj) {\n+        if (obj instanceof HttpData) {\n+            final String contentEncoding = headers().get(HttpHeaderNames.CONTENT_ENCODING);\n+            if (contentEncoding != null) {\n+                final StreamDecoderFactory decoderFactory =\n+                        availableDecoders.get(Ascii.toLowerCase(contentEncoding));\n+                // If the client sent an encoding we don't support, decoding will be skipped which is ok.\n+                if (decoderFactory != null) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjY1NDM1OQ=="}, "originalCommit": {"oid": "9bbaa3fdc8046c8c8f58603ae9133c2401e90a4b"}, "originalPosition": 63}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODMyNTQ3MA==", "bodyText": "How about even doing this before making HttpDecodedRequest?\nIf the request headers does not have the content-encoding header, we don't even need to create HttpDecodedRequest but just pass the original request to the next decorator.", "url": "https://github.com/line/armeria/pull/3087#discussion_r498325470", "createdAt": "2020-10-01T15:17:26Z", "author": {"login": "minwoox"}, "path": "core/src/main/java/com/linecorp/armeria/server/decoding/HttpDecodedRequest.java", "diffHunk": "@@ -0,0 +1,91 @@\n+/*\n+ * Copyright 2020 LINE Corporation\n+ *\n+ * LINE Corporation licenses this file to you under the Apache License,\n+ * version 2.0 (the \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at:\n+ *\n+ *   https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+ * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n+ * License for the specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package com.linecorp.armeria.server.decoding;\n+\n+import java.util.Map;\n+\n+import javax.annotation.Nullable;\n+\n+import org.reactivestreams.Subscriber;\n+\n+import com.google.common.base.Ascii;\n+\n+import com.linecorp.armeria.common.FilteredHttpRequest;\n+import com.linecorp.armeria.common.HttpData;\n+import com.linecorp.armeria.common.HttpHeaderNames;\n+import com.linecorp.armeria.common.HttpObject;\n+import com.linecorp.armeria.common.HttpRequest;\n+import com.linecorp.armeria.common.encoding.StreamDecoder;\n+import com.linecorp.armeria.common.encoding.StreamDecoderFactory;\n+\n+import io.netty.buffer.ByteBufAllocator;\n+\n+/**\n+ * A {@link FilteredHttpRequest} that applies HTTP decoding to {@link HttpObject}s as they are published.\n+ */\n+final class HttpDecodedRequest extends FilteredHttpRequest {\n+\n+    private final Map<String, StreamDecoderFactory> availableDecoders;\n+    private final ByteBufAllocator alloc;\n+\n+    @Nullable\n+    private StreamDecoder responseDecoder;\n+\n+    HttpDecodedRequest(HttpRequest delegate, Map<String, StreamDecoderFactory> availableDecoders,\n+                       ByteBufAllocator alloc) {\n+        super(delegate);\n+        this.availableDecoders = availableDecoders;\n+        this.alloc = alloc;\n+    }\n+\n+    @Override\n+    protected HttpObject filter(HttpObject obj) {\n+        if (obj instanceof HttpData) {\n+            final String contentEncoding = headers().get(HttpHeaderNames.CONTENT_ENCODING);\n+            if (contentEncoding != null) {\n+                final StreamDecoderFactory decoderFactory =\n+                        availableDecoders.get(Ascii.toLowerCase(contentEncoding));\n+                // If the client sent an encoding we don't support, decoding will be skipped which is ok.\n+                if (decoderFactory != null) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjY1NDM1OQ=="}, "originalCommit": {"oid": "9bbaa3fdc8046c8c8f58603ae9133c2401e90a4b"}, "originalPosition": 63}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODQxODQ1Nw==", "bodyText": "With 3db769c commit, finding appropriate decoder before create HttpDecodedRequest", "url": "https://github.com/line/armeria/pull/3087#discussion_r498418457", "createdAt": "2020-10-01T17:51:23Z", "author": {"login": "joonhaeng"}, "path": "core/src/main/java/com/linecorp/armeria/server/decoding/HttpDecodedRequest.java", "diffHunk": "@@ -0,0 +1,91 @@\n+/*\n+ * Copyright 2020 LINE Corporation\n+ *\n+ * LINE Corporation licenses this file to you under the Apache License,\n+ * version 2.0 (the \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at:\n+ *\n+ *   https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+ * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n+ * License for the specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package com.linecorp.armeria.server.decoding;\n+\n+import java.util.Map;\n+\n+import javax.annotation.Nullable;\n+\n+import org.reactivestreams.Subscriber;\n+\n+import com.google.common.base.Ascii;\n+\n+import com.linecorp.armeria.common.FilteredHttpRequest;\n+import com.linecorp.armeria.common.HttpData;\n+import com.linecorp.armeria.common.HttpHeaderNames;\n+import com.linecorp.armeria.common.HttpObject;\n+import com.linecorp.armeria.common.HttpRequest;\n+import com.linecorp.armeria.common.encoding.StreamDecoder;\n+import com.linecorp.armeria.common.encoding.StreamDecoderFactory;\n+\n+import io.netty.buffer.ByteBufAllocator;\n+\n+/**\n+ * A {@link FilteredHttpRequest} that applies HTTP decoding to {@link HttpObject}s as they are published.\n+ */\n+final class HttpDecodedRequest extends FilteredHttpRequest {\n+\n+    private final Map<String, StreamDecoderFactory> availableDecoders;\n+    private final ByteBufAllocator alloc;\n+\n+    @Nullable\n+    private StreamDecoder responseDecoder;\n+\n+    HttpDecodedRequest(HttpRequest delegate, Map<String, StreamDecoderFactory> availableDecoders,\n+                       ByteBufAllocator alloc) {\n+        super(delegate);\n+        this.availableDecoders = availableDecoders;\n+        this.alloc = alloc;\n+    }\n+\n+    @Override\n+    protected HttpObject filter(HttpObject obj) {\n+        if (obj instanceof HttpData) {\n+            final String contentEncoding = headers().get(HttpHeaderNames.CONTENT_ENCODING);\n+            if (contentEncoding != null) {\n+                final StreamDecoderFactory decoderFactory =\n+                        availableDecoders.get(Ascii.toLowerCase(contentEncoding));\n+                // If the client sent an encoding we don't support, decoding will be skipped which is ok.\n+                if (decoderFactory != null) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjY1NDM1OQ=="}, "originalCommit": {"oid": "9bbaa3fdc8046c8c8f58603ae9133c2401e90a4b"}, "originalPosition": 63}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEwOTU5NjI5OnYy", "diffSide": "RIGHT", "path": "core/src/main/java/com/linecorp/armeria/common/encoding/package-info.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxMzozODowMVrOHZtmIQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxOTowNjozOVrOHZ8yTw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjcyMzQ4OQ==", "bodyText": "Provides the common classes for HTTP content encoding and decoding?", "url": "https://github.com/line/armeria/pull/3087#discussion_r496723489", "createdAt": "2020-09-29T13:38:01Z", "author": {"login": "trustin"}, "path": "core/src/main/java/com/linecorp/armeria/common/encoding/package-info.java", "diffHunk": "@@ -0,0 +1,23 @@\n+/*\n+ * Copyright 2020 LINE Corporation\n+ *\n+ * LINE Corporation licenses this file to you under the Apache License,\n+ * version 2.0 (the \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at:\n+ *\n+ *   https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+ * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n+ * License for the specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+/**\n+ * HTTP content decoding class.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9bbaa3fdc8046c8c8f58603ae9133c2401e90a4b"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Njk3MjM2Nw==", "bodyText": "fix it!", "url": "https://github.com/line/armeria/pull/3087#discussion_r496972367", "createdAt": "2020-09-29T19:06:39Z", "author": {"login": "joonhaeng"}, "path": "core/src/main/java/com/linecorp/armeria/common/encoding/package-info.java", "diffHunk": "@@ -0,0 +1,23 @@\n+/*\n+ * Copyright 2020 LINE Corporation\n+ *\n+ * LINE Corporation licenses this file to you under the Apache License,\n+ * version 2.0 (the \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at:\n+ *\n+ *   https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+ * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n+ * License for the specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+/**\n+ * HTTP content decoding class.", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjcyMzQ4OQ=="}, "originalCommit": {"oid": "9bbaa3fdc8046c8c8f58603ae9133c2401e90a4b"}, "originalPosition": 18}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEwOTYwMDIyOnYy", "diffSide": "RIGHT", "path": "core/src/main/java/com/linecorp/armeria/server/decoding/DecodingService.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxMzozODo0OVrOHZtolQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxOTowNjo0NFrOHZ8yfQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjcyNDExNw==", "bodyText": "requireNonNull(decoderFactories, \"decoderFactories\")?", "url": "https://github.com/line/armeria/pull/3087#discussion_r496724117", "createdAt": "2020-09-29T13:38:49Z", "author": {"login": "trustin"}, "path": "core/src/main/java/com/linecorp/armeria/server/decoding/DecodingService.java", "diffHunk": "@@ -0,0 +1,81 @@\n+/*\n+ * Copyright 2020 LINE Corporation\n+ *\n+ * LINE Corporation licenses this file to you under the Apache License,\n+ * version 2.0 (the \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at:\n+ *\n+ *   https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+ * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n+ * License for the specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package com.linecorp.armeria.server.decoding;\n+\n+import static com.google.common.collect.ImmutableMap.toImmutableMap;\n+\n+import java.util.Map;\n+import java.util.function.Function;\n+\n+import com.google.common.collect.ImmutableList;\n+import com.google.common.collect.Streams;\n+\n+import com.linecorp.armeria.common.HttpRequest;\n+import com.linecorp.armeria.common.HttpResponse;\n+import com.linecorp.armeria.common.encoding.StreamDecoderFactory;\n+import com.linecorp.armeria.server.DecoratingService;\n+import com.linecorp.armeria.server.HttpService;\n+import com.linecorp.armeria.server.ServiceRequestContext;\n+import com.linecorp.armeria.server.SimpleDecoratingHttpService;\n+\n+/**\n+ * A {@link DecoratingService} that requests and decodes HTTP encoding (e.g., gzip) that has been applied to the\n+ * content of an {@link HttpRequest}.\n+ */\n+public final class DecodingService extends SimpleDecoratingHttpService {\n+\n+    /**\n+     * Creates a new {@link DecodingService} decorator with the default encodings of 'gzip' and 'deflate'.\n+     */\n+    public static Function<? super HttpService, DecodingService> newDecorator() {\n+        return newDecorator(ImmutableList.of(StreamDecoderFactory.gzip(), StreamDecoderFactory.deflate()));\n+    }\n+\n+    /**\n+     * Creates a new {@link DecodingService} decorator with the specified {@link StreamDecoderFactory}s.\n+     */\n+    public static Function<? super HttpService, DecodingService> newDecorator(\n+            StreamDecoderFactory... decoderFactories) {\n+        return newDecorator(ImmutableList.copyOf(decoderFactories));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9bbaa3fdc8046c8c8f58603ae9133c2401e90a4b"}, "originalPosition": 53}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Njk3MjQxMw==", "bodyText": "fix it!", "url": "https://github.com/line/armeria/pull/3087#discussion_r496972413", "createdAt": "2020-09-29T19:06:44Z", "author": {"login": "joonhaeng"}, "path": "core/src/main/java/com/linecorp/armeria/server/decoding/DecodingService.java", "diffHunk": "@@ -0,0 +1,81 @@\n+/*\n+ * Copyright 2020 LINE Corporation\n+ *\n+ * LINE Corporation licenses this file to you under the Apache License,\n+ * version 2.0 (the \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at:\n+ *\n+ *   https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+ * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n+ * License for the specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package com.linecorp.armeria.server.decoding;\n+\n+import static com.google.common.collect.ImmutableMap.toImmutableMap;\n+\n+import java.util.Map;\n+import java.util.function.Function;\n+\n+import com.google.common.collect.ImmutableList;\n+import com.google.common.collect.Streams;\n+\n+import com.linecorp.armeria.common.HttpRequest;\n+import com.linecorp.armeria.common.HttpResponse;\n+import com.linecorp.armeria.common.encoding.StreamDecoderFactory;\n+import com.linecorp.armeria.server.DecoratingService;\n+import com.linecorp.armeria.server.HttpService;\n+import com.linecorp.armeria.server.ServiceRequestContext;\n+import com.linecorp.armeria.server.SimpleDecoratingHttpService;\n+\n+/**\n+ * A {@link DecoratingService} that requests and decodes HTTP encoding (e.g., gzip) that has been applied to the\n+ * content of an {@link HttpRequest}.\n+ */\n+public final class DecodingService extends SimpleDecoratingHttpService {\n+\n+    /**\n+     * Creates a new {@link DecodingService} decorator with the default encodings of 'gzip' and 'deflate'.\n+     */\n+    public static Function<? super HttpService, DecodingService> newDecorator() {\n+        return newDecorator(ImmutableList.of(StreamDecoderFactory.gzip(), StreamDecoderFactory.deflate()));\n+    }\n+\n+    /**\n+     * Creates a new {@link DecodingService} decorator with the specified {@link StreamDecoderFactory}s.\n+     */\n+    public static Function<? super HttpService, DecodingService> newDecorator(\n+            StreamDecoderFactory... decoderFactories) {\n+        return newDecorator(ImmutableList.copyOf(decoderFactories));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjcyNDExNw=="}, "originalCommit": {"oid": "9bbaa3fdc8046c8c8f58603ae9133c2401e90a4b"}, "originalPosition": 53}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEwOTYwNTI5OnYy", "diffSide": "RIGHT", "path": "core/src/main/java/com/linecorp/armeria/server/decoding/DecodingService.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxMzozOTo1MlrOHZtr6Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxOToyNTowMlrOHZ9rTw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjcyNDk2OQ==", "bodyText": "Need to make an immutable copy with requireNonNull() check outside of the lambda expression first, so that any modifications to decoderFactories before Function.apply() does not affect the resulting service.", "url": "https://github.com/line/armeria/pull/3087#discussion_r496724969", "createdAt": "2020-09-29T13:39:52Z", "author": {"login": "trustin"}, "path": "core/src/main/java/com/linecorp/armeria/server/decoding/DecodingService.java", "diffHunk": "@@ -0,0 +1,81 @@\n+/*\n+ * Copyright 2020 LINE Corporation\n+ *\n+ * LINE Corporation licenses this file to you under the Apache License,\n+ * version 2.0 (the \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at:\n+ *\n+ *   https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+ * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n+ * License for the specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package com.linecorp.armeria.server.decoding;\n+\n+import static com.google.common.collect.ImmutableMap.toImmutableMap;\n+\n+import java.util.Map;\n+import java.util.function.Function;\n+\n+import com.google.common.collect.ImmutableList;\n+import com.google.common.collect.Streams;\n+\n+import com.linecorp.armeria.common.HttpRequest;\n+import com.linecorp.armeria.common.HttpResponse;\n+import com.linecorp.armeria.common.encoding.StreamDecoderFactory;\n+import com.linecorp.armeria.server.DecoratingService;\n+import com.linecorp.armeria.server.HttpService;\n+import com.linecorp.armeria.server.ServiceRequestContext;\n+import com.linecorp.armeria.server.SimpleDecoratingHttpService;\n+\n+/**\n+ * A {@link DecoratingService} that requests and decodes HTTP encoding (e.g., gzip) that has been applied to the\n+ * content of an {@link HttpRequest}.\n+ */\n+public final class DecodingService extends SimpleDecoratingHttpService {\n+\n+    /**\n+     * Creates a new {@link DecodingService} decorator with the default encodings of 'gzip' and 'deflate'.\n+     */\n+    public static Function<? super HttpService, DecodingService> newDecorator() {\n+        return newDecorator(ImmutableList.of(StreamDecoderFactory.gzip(), StreamDecoderFactory.deflate()));\n+    }\n+\n+    /**\n+     * Creates a new {@link DecodingService} decorator with the specified {@link StreamDecoderFactory}s.\n+     */\n+    public static Function<? super HttpService, DecodingService> newDecorator(\n+            StreamDecoderFactory... decoderFactories) {\n+        return newDecorator(ImmutableList.copyOf(decoderFactories));\n+    }\n+\n+    /**\n+     * Creates a new {@link DecodingService} decorator with the specified {@link StreamDecoderFactory}s.\n+     */\n+    public static Function<? super HttpService, DecodingService> newDecorator(\n+            Iterable<? extends StreamDecoderFactory> decoderFactories) {\n+        return delegate -> new DecodingService(delegate, decoderFactories);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9bbaa3fdc8046c8c8f58603ae9133c2401e90a4b"}, "originalPosition": 61}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Njk4Njk1OQ==", "bodyText": "requireNonNull(decoderFactories, \"decoderFactories\");\nfinal Iterable<? extends StreamDecoderFactory> immutableDecoderFactories = ImmutableList.copyOf(decoderFactories);\nadd two lines before lambda expression.", "url": "https://github.com/line/armeria/pull/3087#discussion_r496986959", "createdAt": "2020-09-29T19:25:02Z", "author": {"login": "joonhaeng"}, "path": "core/src/main/java/com/linecorp/armeria/server/decoding/DecodingService.java", "diffHunk": "@@ -0,0 +1,81 @@\n+/*\n+ * Copyright 2020 LINE Corporation\n+ *\n+ * LINE Corporation licenses this file to you under the Apache License,\n+ * version 2.0 (the \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at:\n+ *\n+ *   https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+ * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n+ * License for the specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package com.linecorp.armeria.server.decoding;\n+\n+import static com.google.common.collect.ImmutableMap.toImmutableMap;\n+\n+import java.util.Map;\n+import java.util.function.Function;\n+\n+import com.google.common.collect.ImmutableList;\n+import com.google.common.collect.Streams;\n+\n+import com.linecorp.armeria.common.HttpRequest;\n+import com.linecorp.armeria.common.HttpResponse;\n+import com.linecorp.armeria.common.encoding.StreamDecoderFactory;\n+import com.linecorp.armeria.server.DecoratingService;\n+import com.linecorp.armeria.server.HttpService;\n+import com.linecorp.armeria.server.ServiceRequestContext;\n+import com.linecorp.armeria.server.SimpleDecoratingHttpService;\n+\n+/**\n+ * A {@link DecoratingService} that requests and decodes HTTP encoding (e.g., gzip) that has been applied to the\n+ * content of an {@link HttpRequest}.\n+ */\n+public final class DecodingService extends SimpleDecoratingHttpService {\n+\n+    /**\n+     * Creates a new {@link DecodingService} decorator with the default encodings of 'gzip' and 'deflate'.\n+     */\n+    public static Function<? super HttpService, DecodingService> newDecorator() {\n+        return newDecorator(ImmutableList.of(StreamDecoderFactory.gzip(), StreamDecoderFactory.deflate()));\n+    }\n+\n+    /**\n+     * Creates a new {@link DecodingService} decorator with the specified {@link StreamDecoderFactory}s.\n+     */\n+    public static Function<? super HttpService, DecodingService> newDecorator(\n+            StreamDecoderFactory... decoderFactories) {\n+        return newDecorator(ImmutableList.copyOf(decoderFactories));\n+    }\n+\n+    /**\n+     * Creates a new {@link DecodingService} decorator with the specified {@link StreamDecoderFactory}s.\n+     */\n+    public static Function<? super HttpService, DecodingService> newDecorator(\n+            Iterable<? extends StreamDecoderFactory> decoderFactories) {\n+        return delegate -> new DecodingService(delegate, decoderFactories);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjcyNDk2OQ=="}, "originalCommit": {"oid": "9bbaa3fdc8046c8c8f58603ae9133c2401e90a4b"}, "originalPosition": 61}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzExMjM0Mjc5OnYy", "diffSide": "RIGHT", "path": "core/src/main/java/com/linecorp/armeria/server/decoding/HttpDecodedRequest.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQyMzo1ODo0OVrOHaILWw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0zMFQxNDo1OTozNlrOHah5Lw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzE1OTAwMw==", "bodyText": "filteredFirstData, handledFirstData or initializedDecoder?", "url": "https://github.com/line/armeria/pull/3087#discussion_r497159003", "createdAt": "2020-09-29T23:58:49Z", "author": {"login": "trustin"}, "path": "core/src/main/java/com/linecorp/armeria/server/decoding/HttpDecodedRequest.java", "diffHunk": "@@ -45,6 +45,8 @@\n     @Nullable\n     private StreamDecoder responseDecoder;\n \n+    private boolean decoderCheck;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "25b5ca60f71c9f9f4871c19500b6a1d09be120ab"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzU4MDMzNQ==", "bodyText": "rename to initializedDecoder", "url": "https://github.com/line/armeria/pull/3087#discussion_r497580335", "createdAt": "2020-09-30T14:59:36Z", "author": {"login": "joonhaeng"}, "path": "core/src/main/java/com/linecorp/armeria/server/decoding/HttpDecodedRequest.java", "diffHunk": "@@ -45,6 +45,8 @@\n     @Nullable\n     private StreamDecoder responseDecoder;\n \n+    private boolean decoderCheck;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzE1OTAwMw=="}, "originalCommit": {"oid": "25b5ca60f71c9f9f4871c19500b6a1d09be120ab"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzExMjM1MzY1OnYy", "diffSide": "RIGHT", "path": "core/src/main/java/com/linecorp/armeria/server/decoding/DecodingService.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0zMFQwMDowMToyOVrOHaISVg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0zMFQxNTowMjowNlrOHaiBBg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzE2MDc5MA==", "bodyText": "How about just using List<...>?\nThe constructor could require an ImmutableList to statically ensure the constructor will always get an immutable list (i.e. a dev will be sure he/she doesn't need to worry about immutability of the given list).", "url": "https://github.com/line/armeria/pull/3087#discussion_r497160790", "createdAt": "2020-09-30T00:01:29Z", "author": {"login": "trustin"}, "path": "core/src/main/java/com/linecorp/armeria/server/decoding/DecodingService.java", "diffHunk": "@@ -58,7 +60,10 @@\n      */\n     public static Function<? super HttpService, DecodingService> newDecorator(\n             Iterable<? extends StreamDecoderFactory> decoderFactories) {\n-        return delegate -> new DecodingService(delegate, decoderFactories);\n+        requireNonNull(decoderFactories, \"decoderFactories\");\n+        final Iterable<? extends StreamDecoderFactory> immutableDecoderFactories =", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cf79aec1006df73d2a6a3a023b6a8ae899ee4631"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzE2MTI4Mw==", "bodyText": "It'd be nice if you could make the same changes to DecodingClient. \ud83d\ude47", "url": "https://github.com/line/armeria/pull/3087#discussion_r497161283", "createdAt": "2020-09-30T00:02:13Z", "author": {"login": "trustin"}, "path": "core/src/main/java/com/linecorp/armeria/server/decoding/DecodingService.java", "diffHunk": "@@ -58,7 +60,10 @@\n      */\n     public static Function<? super HttpService, DecodingService> newDecorator(\n             Iterable<? extends StreamDecoderFactory> decoderFactories) {\n-        return delegate -> new DecodingService(delegate, decoderFactories);\n+        requireNonNull(decoderFactories, \"decoderFactories\");\n+        final Iterable<? extends StreamDecoderFactory> immutableDecoderFactories =", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzE2MDc5MA=="}, "originalCommit": {"oid": "cf79aec1006df73d2a6a3a023b6a8ae899ee4631"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzU4MjM0Mg==", "bodyText": "change Iterable to List\nadd requireNonNull & ImmutableList to DecodingClient (09342ef)", "url": "https://github.com/line/armeria/pull/3087#discussion_r497582342", "createdAt": "2020-09-30T15:02:06Z", "author": {"login": "joonhaeng"}, "path": "core/src/main/java/com/linecorp/armeria/server/decoding/DecodingService.java", "diffHunk": "@@ -58,7 +60,10 @@\n      */\n     public static Function<? super HttpService, DecodingService> newDecorator(\n             Iterable<? extends StreamDecoderFactory> decoderFactories) {\n-        return delegate -> new DecodingService(delegate, decoderFactories);\n+        requireNonNull(decoderFactories, \"decoderFactories\");\n+        final Iterable<? extends StreamDecoderFactory> immutableDecoderFactories =", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzE2MDc5MA=="}, "originalCommit": {"oid": "cf79aec1006df73d2a6a3a023b6a8ae899ee4631"}, "originalPosition": 22}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzExOTQ4ODUxOnYy", "diffSide": "RIGHT", "path": "core/src/test/java/com/linecorp/armeria/common/encoding/ZlibStreamDecoderTest.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMVQxNDoyMDozN1rOHbMvag==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMVQxNzo1MTozNlrOHbVDjA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODI4MjM0Ng==", "bodyText": "nit: probably OK without public?", "url": "https://github.com/line/armeria/pull/3087#discussion_r498282346", "createdAt": "2020-10-01T14:20:37Z", "author": {"login": "trustin"}, "path": "core/src/test/java/com/linecorp/armeria/common/encoding/ZlibStreamDecoderTest.java", "diffHunk": "@@ -0,0 +1,26 @@\n+/*\n+ * Copyright 2020 LINE Corporation\n+ *\n+ * LINE Corporation licenses this file to you under the Apache License,\n+ * version 2.0 (the \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at:\n+ *\n+ *   https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+ * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n+ * License for the specific language governing permissions and limitations\n+ * under the License.\n+ */\n+package com.linecorp.armeria.common.encoding;\n+\n+import io.netty.buffer.ByteBufAllocator;\n+import io.netty.handler.codec.compression.ZlibWrapper;\n+\n+public class ZlibStreamDecoderTest extends AbstractStreamDecoderTest {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "83a035cada4e3e631f42a694d0d1de35325b1643"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODQxODU3Mg==", "bodyText": "fix it!", "url": "https://github.com/line/armeria/pull/3087#discussion_r498418572", "createdAt": "2020-10-01T17:51:36Z", "author": {"login": "joonhaeng"}, "path": "core/src/test/java/com/linecorp/armeria/common/encoding/ZlibStreamDecoderTest.java", "diffHunk": "@@ -0,0 +1,26 @@\n+/*\n+ * Copyright 2020 LINE Corporation\n+ *\n+ * LINE Corporation licenses this file to you under the Apache License,\n+ * version 2.0 (the \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at:\n+ *\n+ *   https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+ * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n+ * License for the specific language governing permissions and limitations\n+ * under the License.\n+ */\n+package com.linecorp.armeria.common.encoding;\n+\n+import io.netty.buffer.ByteBufAllocator;\n+import io.netty.handler.codec.compression.ZlibWrapper;\n+\n+public class ZlibStreamDecoderTest extends AbstractStreamDecoderTest {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODI4MjM0Ng=="}, "originalCommit": {"oid": "83a035cada4e3e631f42a694d0d1de35325b1643"}, "originalPosition": 21}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzExOTQ5MjExOnYy", "diffSide": "RIGHT", "path": "core/src/test/java/com/linecorp/armeria/server/decoding/HttpDecodedRequestTest.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMVQxNDoyMTozMFrOHbMx7A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMVQxNzo1MTo0NlrOHbVD7w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODI4Mjk4OA==", "bodyText": "Ditto - public could be omitted", "url": "https://github.com/line/armeria/pull/3087#discussion_r498282988", "createdAt": "2020-10-01T14:21:30Z", "author": {"login": "trustin"}, "path": "core/src/test/java/com/linecorp/armeria/server/decoding/HttpDecodedRequestTest.java", "diffHunk": "@@ -0,0 +1,146 @@\n+/*\n+ * Copyright 2020 LINE Corporation\n+ *\n+ * LINE Corporation licenses this file to you under the Apache License,\n+ * version 2.0 (the \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at:\n+ *\n+ *   https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+ * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n+ * License for the specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package com.linecorp.armeria.server.decoding;\n+\n+import static org.assertj.core.api.Assertions.assertThat;\n+\n+import java.io.ByteArrayOutputStream;\n+import java.io.IOException;\n+import java.io.UncheckedIOException;\n+import java.nio.charset.StandardCharsets;\n+import java.util.Map;\n+import java.util.concurrent.CompletableFuture;\n+import java.util.zip.GZIPOutputStream;\n+\n+import org.junit.jupiter.api.Test;\n+import org.reactivestreams.Subscriber;\n+import org.reactivestreams.Subscription;\n+\n+import com.google.common.collect.ImmutableMap;\n+\n+import com.linecorp.armeria.common.HttpData;\n+import com.linecorp.armeria.common.HttpHeaderNames;\n+import com.linecorp.armeria.common.HttpMethod;\n+import com.linecorp.armeria.common.HttpObject;\n+import com.linecorp.armeria.common.HttpRequest;\n+import com.linecorp.armeria.common.RequestHeaders;\n+import com.linecorp.armeria.common.encoding.StreamDecoderFactory;\n+import com.linecorp.armeria.common.stream.SubscriptionOption;\n+\n+import io.netty.buffer.ByteBuf;\n+import io.netty.buffer.ByteBufAllocator;\n+\n+public class HttpDecodedRequestTest {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "83a035cada4e3e631f42a694d0d1de35325b1643"}, "originalPosition": 47}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODQxODY3MQ==", "bodyText": "fix it!", "url": "https://github.com/line/armeria/pull/3087#discussion_r498418671", "createdAt": "2020-10-01T17:51:46Z", "author": {"login": "joonhaeng"}, "path": "core/src/test/java/com/linecorp/armeria/server/decoding/HttpDecodedRequestTest.java", "diffHunk": "@@ -0,0 +1,146 @@\n+/*\n+ * Copyright 2020 LINE Corporation\n+ *\n+ * LINE Corporation licenses this file to you under the Apache License,\n+ * version 2.0 (the \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at:\n+ *\n+ *   https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+ * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n+ * License for the specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package com.linecorp.armeria.server.decoding;\n+\n+import static org.assertj.core.api.Assertions.assertThat;\n+\n+import java.io.ByteArrayOutputStream;\n+import java.io.IOException;\n+import java.io.UncheckedIOException;\n+import java.nio.charset.StandardCharsets;\n+import java.util.Map;\n+import java.util.concurrent.CompletableFuture;\n+import java.util.zip.GZIPOutputStream;\n+\n+import org.junit.jupiter.api.Test;\n+import org.reactivestreams.Subscriber;\n+import org.reactivestreams.Subscription;\n+\n+import com.google.common.collect.ImmutableMap;\n+\n+import com.linecorp.armeria.common.HttpData;\n+import com.linecorp.armeria.common.HttpHeaderNames;\n+import com.linecorp.armeria.common.HttpMethod;\n+import com.linecorp.armeria.common.HttpObject;\n+import com.linecorp.armeria.common.HttpRequest;\n+import com.linecorp.armeria.common.RequestHeaders;\n+import com.linecorp.armeria.common.encoding.StreamDecoderFactory;\n+import com.linecorp.armeria.common.stream.SubscriptionOption;\n+\n+import io.netty.buffer.ByteBuf;\n+import io.netty.buffer.ByteBufAllocator;\n+\n+public class HttpDecodedRequestTest {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODI4Mjk4OA=="}, "originalCommit": {"oid": "83a035cada4e3e631f42a694d0d1de35325b1643"}, "originalPosition": 47}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEyNjYzMjUwOnYy", "diffSide": "RIGHT", "path": "core/src/main/java/com/linecorp/armeria/common/encoding/package-info.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNVQwNjo0MzowMlrOHcPTig==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNVQxNjoyNzozNFrOHckv3g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTM3MjkzOA==", "bodyText": "nit: Remove and decoding? \ud83d\ude06", "url": "https://github.com/line/armeria/pull/3087#discussion_r499372938", "createdAt": "2020-10-05T06:43:02Z", "author": {"login": "ikhoon"}, "path": "core/src/main/java/com/linecorp/armeria/common/encoding/package-info.java", "diffHunk": "@@ -0,0 +1,23 @@\n+/*\n+ * Copyright 2020 LINE Corporation\n+ *\n+ * LINE Corporation licenses this file to you under the Apache License,\n+ * version 2.0 (the \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at:\n+ *\n+ *   https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+ * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n+ * License for the specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+/**\n+ * Provides the common classes for HTTP content encoding and decoding.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0341e11e2c1e32ca8107f6f4776a2bc5663fa6dc"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTcyNDI1NA==", "bodyText": "fix it!", "url": "https://github.com/line/armeria/pull/3087#discussion_r499724254", "createdAt": "2020-10-05T16:27:34Z", "author": {"login": "joonhaeng"}, "path": "core/src/main/java/com/linecorp/armeria/common/encoding/package-info.java", "diffHunk": "@@ -0,0 +1,23 @@\n+/*\n+ * Copyright 2020 LINE Corporation\n+ *\n+ * LINE Corporation licenses this file to you under the Apache License,\n+ * version 2.0 (the \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at:\n+ *\n+ *   https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+ * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n+ * License for the specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+/**\n+ * Provides the common classes for HTTP content encoding and decoding.", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTM3MjkzOA=="}, "originalCommit": {"oid": "0341e11e2c1e32ca8107f6f4776a2bc5663fa6dc"}, "originalPosition": 18}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEyNjY0NzAyOnYy", "diffSide": "RIGHT", "path": "core/src/test/java/com/linecorp/armeria/common/encoding/StreamDecoderCompatibleTest.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNVQwNjo0OTowMFrOHcPb-Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNVQxNjozMDowMVrOHck1rA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTM3NTA5Nw==", "bodyText": "You don't need to specify the default ClientFactory. It is used by default.", "url": "https://github.com/line/armeria/pull/3087#discussion_r499375097", "createdAt": "2020-10-05T06:49:00Z", "author": {"login": "ikhoon"}, "path": "core/src/test/java/com/linecorp/armeria/common/encoding/StreamDecoderCompatibleTest.java", "diffHunk": "@@ -0,0 +1,93 @@\n+/*\n+ * Copyright 2020 LINE Corporation\n+ *\n+ * LINE Corporation licenses this file to you under the Apache License,\n+ * version 2.0 (the \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at:\n+ *\n+ *   https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+ * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n+ * License for the specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package com.linecorp.armeria.common.encoding;\n+\n+import static org.assertj.core.api.Assertions.assertThat;\n+\n+import org.junit.jupiter.api.Test;\n+import org.junit.jupiter.api.extension.RegisterExtension;\n+\n+import com.linecorp.armeria.client.ClientFactory;\n+import com.linecorp.armeria.client.WebClient;\n+import com.linecorp.armeria.client.encoding.DecodingClient;\n+import com.linecorp.armeria.common.AggregatedHttpResponse;\n+import com.linecorp.armeria.common.HttpData;\n+import com.linecorp.armeria.common.HttpHeaderNames;\n+import com.linecorp.armeria.common.HttpMethod;\n+import com.linecorp.armeria.common.HttpRequest;\n+import com.linecorp.armeria.common.HttpResponse;\n+import com.linecorp.armeria.common.HttpStatus;\n+import com.linecorp.armeria.common.RequestHeaders;\n+import com.linecorp.armeria.common.ResponseHeaders;\n+import com.linecorp.armeria.server.AbstractHttpService;\n+import com.linecorp.armeria.server.ServerBuilder;\n+import com.linecorp.armeria.server.ServiceRequestContext;\n+import com.linecorp.armeria.server.encoding.EncodingService;\n+import com.linecorp.armeria.testing.junit5.server.ServerExtension;\n+\n+class StreamDecoderCompatibleTest {\n+\n+    @RegisterExtension\n+    static final ServerExtension server = new ServerExtension() {\n+        @Override\n+        protected void configure(ServerBuilder sb) throws Exception {\n+            sb.service(\"/encoding-test\", new AbstractHttpService() {\n+                @Override\n+                protected HttpResponse doGet(ServiceRequestContext ctx, HttpRequest req)\n+                        throws Exception {\n+                    return HttpResponse.of(\n+                            ResponseHeaders.of(HttpStatus.OK),\n+                            HttpData.ofUtf8(\"some content to compress \"),\n+                            HttpData.ofUtf8(\"more content to compress\"));\n+                }\n+            }.decorate(EncodingService.newDecorator()));\n+        }\n+    };\n+\n+    private static final ClientFactory clientFactory = ClientFactory.ofDefault();\n+\n+    @Test\n+    void httpDecodingWithNewDecoder() throws Exception {\n+        final WebClient client = WebClient.builder(server.httpUri())\n+                                          .factory(clientFactory)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0341e11e2c1e32ca8107f6f4776a2bc5663fa6dc"}, "originalPosition": 66}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTcyNTc0MA==", "bodyText": "Thank you for letting me know. remove ClientFactory.", "url": "https://github.com/line/armeria/pull/3087#discussion_r499725740", "createdAt": "2020-10-05T16:30:01Z", "author": {"login": "joonhaeng"}, "path": "core/src/test/java/com/linecorp/armeria/common/encoding/StreamDecoderCompatibleTest.java", "diffHunk": "@@ -0,0 +1,93 @@\n+/*\n+ * Copyright 2020 LINE Corporation\n+ *\n+ * LINE Corporation licenses this file to you under the Apache License,\n+ * version 2.0 (the \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at:\n+ *\n+ *   https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+ * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n+ * License for the specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package com.linecorp.armeria.common.encoding;\n+\n+import static org.assertj.core.api.Assertions.assertThat;\n+\n+import org.junit.jupiter.api.Test;\n+import org.junit.jupiter.api.extension.RegisterExtension;\n+\n+import com.linecorp.armeria.client.ClientFactory;\n+import com.linecorp.armeria.client.WebClient;\n+import com.linecorp.armeria.client.encoding.DecodingClient;\n+import com.linecorp.armeria.common.AggregatedHttpResponse;\n+import com.linecorp.armeria.common.HttpData;\n+import com.linecorp.armeria.common.HttpHeaderNames;\n+import com.linecorp.armeria.common.HttpMethod;\n+import com.linecorp.armeria.common.HttpRequest;\n+import com.linecorp.armeria.common.HttpResponse;\n+import com.linecorp.armeria.common.HttpStatus;\n+import com.linecorp.armeria.common.RequestHeaders;\n+import com.linecorp.armeria.common.ResponseHeaders;\n+import com.linecorp.armeria.server.AbstractHttpService;\n+import com.linecorp.armeria.server.ServerBuilder;\n+import com.linecorp.armeria.server.ServiceRequestContext;\n+import com.linecorp.armeria.server.encoding.EncodingService;\n+import com.linecorp.armeria.testing.junit5.server.ServerExtension;\n+\n+class StreamDecoderCompatibleTest {\n+\n+    @RegisterExtension\n+    static final ServerExtension server = new ServerExtension() {\n+        @Override\n+        protected void configure(ServerBuilder sb) throws Exception {\n+            sb.service(\"/encoding-test\", new AbstractHttpService() {\n+                @Override\n+                protected HttpResponse doGet(ServiceRequestContext ctx, HttpRequest req)\n+                        throws Exception {\n+                    return HttpResponse.of(\n+                            ResponseHeaders.of(HttpStatus.OK),\n+                            HttpData.ofUtf8(\"some content to compress \"),\n+                            HttpData.ofUtf8(\"more content to compress\"));\n+                }\n+            }.decorate(EncodingService.newDecorator()));\n+        }\n+    };\n+\n+    private static final ClientFactory clientFactory = ClientFactory.ofDefault();\n+\n+    @Test\n+    void httpDecodingWithNewDecoder() throws Exception {\n+        final WebClient client = WebClient.builder(server.httpUri())\n+                                          .factory(clientFactory)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTM3NTA5Nw=="}, "originalCommit": {"oid": "0341e11e2c1e32ca8107f6f4776a2bc5663fa6dc"}, "originalPosition": 66}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE0MDg3MDc2OnYy", "diffSide": "RIGHT", "path": "core/src/test/java/com/linecorp/armeria/common/encoding/StreamDecoderCompatibleTest.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOFQwOTo1NTo0NFrOHeW4vA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOFQxNzoyMzo0M1rOHeoxmQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTU5NDMwMA==", "bodyText": "How about renaming this class into DecodingClientTest and adding the tests for both deprecated and non-deprecated stream decoders? I'm just not sure why we don't have DecodingClientTest already. \ud83d\ude05", "url": "https://github.com/line/armeria/pull/3087#discussion_r501594300", "createdAt": "2020-10-08T09:55:44Z", "author": {"login": "trustin"}, "path": "core/src/test/java/com/linecorp/armeria/common/encoding/StreamDecoderCompatibleTest.java", "diffHunk": "@@ -0,0 +1,88 @@\n+/*\n+ * Copyright 2020 LINE Corporation\n+ *\n+ * LINE Corporation licenses this file to you under the Apache License,\n+ * version 2.0 (the \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at:\n+ *\n+ *   https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+ * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n+ * License for the specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package com.linecorp.armeria.common.encoding;\n+\n+import static org.assertj.core.api.Assertions.assertThat;\n+\n+import org.junit.jupiter.api.Test;\n+import org.junit.jupiter.api.extension.RegisterExtension;\n+\n+import com.linecorp.armeria.client.WebClient;\n+import com.linecorp.armeria.client.encoding.DecodingClient;\n+import com.linecorp.armeria.common.AggregatedHttpResponse;\n+import com.linecorp.armeria.common.HttpData;\n+import com.linecorp.armeria.common.HttpHeaderNames;\n+import com.linecorp.armeria.common.HttpMethod;\n+import com.linecorp.armeria.common.HttpRequest;\n+import com.linecorp.armeria.common.HttpResponse;\n+import com.linecorp.armeria.common.HttpStatus;\n+import com.linecorp.armeria.common.RequestHeaders;\n+import com.linecorp.armeria.common.ResponseHeaders;\n+import com.linecorp.armeria.server.AbstractHttpService;\n+import com.linecorp.armeria.server.ServerBuilder;\n+import com.linecorp.armeria.server.ServiceRequestContext;\n+import com.linecorp.armeria.server.encoding.EncodingService;\n+import com.linecorp.armeria.testing.junit5.server.ServerExtension;\n+\n+class StreamDecoderCompatibleTest {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "80874bb959b6bb7ac2beff03a551c7583e77ed7d"}, "originalPosition": 41}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTg4NzM4NQ==", "bodyText": "renaming and add some test (d1eb993)\nadd compatible test for HttpDecodedResponse (f7d9b44)", "url": "https://github.com/line/armeria/pull/3087#discussion_r501887385", "createdAt": "2020-10-08T17:23:43Z", "author": {"login": "joonhaeng"}, "path": "core/src/test/java/com/linecorp/armeria/common/encoding/StreamDecoderCompatibleTest.java", "diffHunk": "@@ -0,0 +1,88 @@\n+/*\n+ * Copyright 2020 LINE Corporation\n+ *\n+ * LINE Corporation licenses this file to you under the Apache License,\n+ * version 2.0 (the \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at:\n+ *\n+ *   https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+ * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n+ * License for the specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package com.linecorp.armeria.common.encoding;\n+\n+import static org.assertj.core.api.Assertions.assertThat;\n+\n+import org.junit.jupiter.api.Test;\n+import org.junit.jupiter.api.extension.RegisterExtension;\n+\n+import com.linecorp.armeria.client.WebClient;\n+import com.linecorp.armeria.client.encoding.DecodingClient;\n+import com.linecorp.armeria.common.AggregatedHttpResponse;\n+import com.linecorp.armeria.common.HttpData;\n+import com.linecorp.armeria.common.HttpHeaderNames;\n+import com.linecorp.armeria.common.HttpMethod;\n+import com.linecorp.armeria.common.HttpRequest;\n+import com.linecorp.armeria.common.HttpResponse;\n+import com.linecorp.armeria.common.HttpStatus;\n+import com.linecorp.armeria.common.RequestHeaders;\n+import com.linecorp.armeria.common.ResponseHeaders;\n+import com.linecorp.armeria.server.AbstractHttpService;\n+import com.linecorp.armeria.server.ServerBuilder;\n+import com.linecorp.armeria.server.ServiceRequestContext;\n+import com.linecorp.armeria.server.encoding.EncodingService;\n+import com.linecorp.armeria.testing.junit5.server.ServerExtension;\n+\n+class StreamDecoderCompatibleTest {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTU5NDMwMA=="}, "originalCommit": {"oid": "80874bb959b6bb7ac2beff03a551c7583e77ed7d"}, "originalPosition": 41}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE1NTExNDYwOnYy", "diffSide": "RIGHT", "path": "core/src/main/java/com/linecorp/armeria/server/decoding/package-info.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xM1QwNzowOToyM1rOHgYSzQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xM1QxMToxNDo0NVrOHghlXw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzcxNDUwOQ==", "bodyText": "How about merging this package into server.encoding?", "url": "https://github.com/line/armeria/pull/3087#discussion_r503714509", "createdAt": "2020-10-13T07:09:23Z", "author": {"login": "trustin"}, "path": "core/src/main/java/com/linecorp/armeria/server/decoding/package-info.java", "diffHunk": "@@ -0,0 +1,22 @@\n+/*\n+ * Copyright 2020 LINE Corporation\n+ *\n+ * LINE Corporation licenses this file to you under the Apache License,\n+ * version 2.0 (the \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at:\n+ *\n+ *   https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+ * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n+ * License for the specific language governing permissions and limitations\n+ * under the License.\n+ */\n+/**\n+ * HTTP content decoding service.\n+ */\n+@NonNullByDefault\n+package com.linecorp.armeria.server.decoding;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f7d9b4457a1469471b0999bbc11bbe7d665845bf"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzc0ODM2NQ==", "bodyText": "move complete! Now I think I know a little about the package policy in armeria \ud83d\ude0a", "url": "https://github.com/line/armeria/pull/3087#discussion_r503748365", "createdAt": "2020-10-13T08:05:49Z", "author": {"login": "joonhaeng"}, "path": "core/src/main/java/com/linecorp/armeria/server/decoding/package-info.java", "diffHunk": "@@ -0,0 +1,22 @@\n+/*\n+ * Copyright 2020 LINE Corporation\n+ *\n+ * LINE Corporation licenses this file to you under the Apache License,\n+ * version 2.0 (the \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at:\n+ *\n+ *   https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+ * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n+ * License for the specific language governing permissions and limitations\n+ * under the License.\n+ */\n+/**\n+ * HTTP content decoding service.\n+ */\n+@NonNullByDefault\n+package com.linecorp.armeria.server.decoding;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzcxNDUwOQ=="}, "originalCommit": {"oid": "f7d9b4457a1469471b0999bbc11bbe7d665845bf"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzg2NjcxOQ==", "bodyText": "Awesome. \ud83d\ude01", "url": "https://github.com/line/armeria/pull/3087#discussion_r503866719", "createdAt": "2020-10-13T11:14:45Z", "author": {"login": "trustin"}, "path": "core/src/main/java/com/linecorp/armeria/server/decoding/package-info.java", "diffHunk": "@@ -0,0 +1,22 @@\n+/*\n+ * Copyright 2020 LINE Corporation\n+ *\n+ * LINE Corporation licenses this file to you under the Apache License,\n+ * version 2.0 (the \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at:\n+ *\n+ *   https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+ * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n+ * License for the specific language governing permissions and limitations\n+ * under the License.\n+ */\n+/**\n+ * HTTP content decoding service.\n+ */\n+@NonNullByDefault\n+package com.linecorp.armeria.server.decoding;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzcxNDUwOQ=="}, "originalCommit": {"oid": "f7d9b4457a1469471b0999bbc11bbe7d665845bf"}, "originalPosition": 20}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE2MTUzNjIxOnYy", "diffSide": "RIGHT", "path": "core/src/main/java/com/linecorp/armeria/common/encoding/StreamDecoderFactory.java", "isResolved": false, "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNFQxNDoxODoxMlrOHhVZZQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNlQwNDo1ODozNFrOHim-EQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDcxNTYyMQ==", "bodyText": "Is there any reason that we are doing this instead of\npackage com.linecorp.armeria.client.encoding;\n\npublic interface StreamDecoderFactory extends com.linecorp.armeria.common.encoding.StreamDecoderFactory {\nIt looks weird this new interface extends the deprecated one. \ud83e\udd14", "url": "https://github.com/line/armeria/pull/3087#discussion_r504715621", "createdAt": "2020-10-14T14:18:12Z", "author": {"login": "minwoox"}, "path": "core/src/main/java/com/linecorp/armeria/common/encoding/StreamDecoderFactory.java", "diffHunk": "@@ -0,0 +1,54 @@\n+/*\n+ * Copyright 2020 LINE Corporation\n+ *\n+ * LINE Corporation licenses this file to you under the Apache License,\n+ * version 2.0 (the \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at:\n+ *\n+ *   https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+ * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n+ * License for the specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package com.linecorp.armeria.common.encoding;\n+\n+import com.linecorp.armeria.common.HttpResponse;\n+\n+import io.netty.buffer.ByteBufAllocator;\n+\n+/**\n+ * An interface that constructs a new {@link StreamDecoder} for a given Content-Encoding header value.\n+ * A new decoder is valid for the lifetime of an {@link HttpResponse}.\n+ */\n+public interface StreamDecoderFactory extends com.linecorp.armeria.client.encoding.StreamDecoderFactory {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dae2a224d3bf38087dd008d8c1ce97c6f7ef3081"}, "originalPosition": 27}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTE1ODExMA==", "bodyText": "This is @trustin 's suggestion (#3087 (review), #3087 (comment)) that DecodingClient can accept both new and deprecated without breaking change.", "url": "https://github.com/line/armeria/pull/3087#discussion_r505158110", "createdAt": "2020-10-15T04:34:13Z", "author": {"login": "joonhaeng"}, "path": "core/src/main/java/com/linecorp/armeria/common/encoding/StreamDecoderFactory.java", "diffHunk": "@@ -0,0 +1,54 @@\n+/*\n+ * Copyright 2020 LINE Corporation\n+ *\n+ * LINE Corporation licenses this file to you under the Apache License,\n+ * version 2.0 (the \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at:\n+ *\n+ *   https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+ * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n+ * License for the specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package com.linecorp.armeria.common.encoding;\n+\n+import com.linecorp.armeria.common.HttpResponse;\n+\n+import io.netty.buffer.ByteBufAllocator;\n+\n+/**\n+ * An interface that constructs a new {@link StreamDecoder} for a given Content-Encoding header value.\n+ * A new decoder is valid for the lifetime of an {@link HttpResponse}.\n+ */\n+public interface StreamDecoderFactory extends com.linecorp.armeria.client.encoding.StreamDecoderFactory {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDcxNTYyMQ=="}, "originalCommit": {"oid": "dae2a224d3bf38087dd008d8c1ce97c6f7ef3081"}, "originalPosition": 27}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTE3MDg1Mg==", "bodyText": "Oops, I have pasted the wrong example. I fixed it, please take a look at it again.\n\nHow about making the deprecated StreamDecoderFactory and StreamDecoder extend the new interfaces in the common package\n\nYeah, I think @trustin meant extending the new one from the deprecated one. \ud83d\ude04", "url": "https://github.com/line/armeria/pull/3087#discussion_r505170852", "createdAt": "2020-10-15T05:22:52Z", "author": {"login": "minwoox"}, "path": "core/src/main/java/com/linecorp/armeria/common/encoding/StreamDecoderFactory.java", "diffHunk": "@@ -0,0 +1,54 @@\n+/*\n+ * Copyright 2020 LINE Corporation\n+ *\n+ * LINE Corporation licenses this file to you under the Apache License,\n+ * version 2.0 (the \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at:\n+ *\n+ *   https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+ * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n+ * License for the specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package com.linecorp.armeria.common.encoding;\n+\n+import com.linecorp.armeria.common.HttpResponse;\n+\n+import io.netty.buffer.ByteBufAllocator;\n+\n+/**\n+ * An interface that constructs a new {@link StreamDecoder} for a given Content-Encoding header value.\n+ * A new decoder is valid for the lifetime of an {@link HttpResponse}.\n+ */\n+public interface StreamDecoderFactory extends com.linecorp.armeria.client.encoding.StreamDecoderFactory {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDcxNTYyMQ=="}, "originalCommit": {"oid": "dae2a224d3bf38087dd008d8c1ce97c6f7ef3081"}, "originalPosition": 27}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTE4MDY5OQ==", "bodyText": "Is there any reason that we are doing this instead of\npackage com.linecorp.armeria.client.encoding;\n\npublic interface StreamDecoderFactory extends com.linecorp.armeria.common.encoding.StreamDecoderFactory {\nIt looks weird this new interface extends the deprecated one. \ud83e\udd14\n\nIn this relation, DecodingClient can't accept new encoder without additional change(e.g update import statement, create new method that can accept new encoder)... \ud83d\ude22", "url": "https://github.com/line/armeria/pull/3087#discussion_r505180699", "createdAt": "2020-10-15T05:54:13Z", "author": {"login": "joonhaeng"}, "path": "core/src/main/java/com/linecorp/armeria/common/encoding/StreamDecoderFactory.java", "diffHunk": "@@ -0,0 +1,54 @@\n+/*\n+ * Copyright 2020 LINE Corporation\n+ *\n+ * LINE Corporation licenses this file to you under the Apache License,\n+ * version 2.0 (the \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at:\n+ *\n+ *   https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+ * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n+ * License for the specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package com.linecorp.armeria.common.encoding;\n+\n+import com.linecorp.armeria.common.HttpResponse;\n+\n+import io.netty.buffer.ByteBufAllocator;\n+\n+/**\n+ * An interface that constructs a new {@link StreamDecoder} for a given Content-Encoding header value.\n+ * A new decoder is valid for the lifetime of an {@link HttpResponse}.\n+ */\n+public interface StreamDecoderFactory extends com.linecorp.armeria.client.encoding.StreamDecoderFactory {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDcxNTYyMQ=="}, "originalCommit": {"oid": "dae2a224d3bf38087dd008d8c1ce97c6f7ef3081"}, "originalPosition": 27}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjA1MjExMw==", "bodyText": "Thanks for the explanation. Yeah I'm fine as it is. \ud83d\ude04", "url": "https://github.com/line/armeria/pull/3087#discussion_r506052113", "createdAt": "2020-10-16T04:58:34Z", "author": {"login": "minwoox"}, "path": "core/src/main/java/com/linecorp/armeria/common/encoding/StreamDecoderFactory.java", "diffHunk": "@@ -0,0 +1,54 @@\n+/*\n+ * Copyright 2020 LINE Corporation\n+ *\n+ * LINE Corporation licenses this file to you under the Apache License,\n+ * version 2.0 (the \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at:\n+ *\n+ *   https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+ * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n+ * License for the specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package com.linecorp.armeria.common.encoding;\n+\n+import com.linecorp.armeria.common.HttpResponse;\n+\n+import io.netty.buffer.ByteBufAllocator;\n+\n+/**\n+ * An interface that constructs a new {@link StreamDecoder} for a given Content-Encoding header value.\n+ * A new decoder is valid for the lifetime of an {@link HttpResponse}.\n+ */\n+public interface StreamDecoderFactory extends com.linecorp.armeria.client.encoding.StreamDecoderFactory {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDcxNTYyMQ=="}, "originalCommit": {"oid": "dae2a224d3bf38087dd008d8c1ce97c6f7ef3081"}, "originalPosition": 27}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1918, "cost": 1, "resetAt": "2021-11-12T20:44:06Z"}}}