{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY1MTQ0MzM3", "number": 2412, "title": "Auto-generate gRPC examples with default fields", "bodyText": "Motivation:\nA user sometimes uses a default gRPC Message instance as an example\nrequest when building a DocService:\nDocService.builder()\n          .exampleRequestForMethod(MyServiceGrpc.SERVICE_NAME,\n                                   \"DoSomething\",\n                                   SomeRequest.getDefaultInstance())\n\n.. which is a tedious job that can be automated.\nModifications:\n\nMake GrpcDocServicePlugin append an example request generated from\nthe default instance.\n\nThe frontend will show the user-specified example first.\n\n\n\nResult:\n\nA user does not need to set the default gRPC examples.", "createdAt": "2020-01-21T08:00:32Z", "url": "https://github.com/line/armeria/pull/2412", "merged": true, "mergeCommit": {"oid": "e16cdfa30c88ee8fb8457ff84d9722d3e9941017"}, "closed": true, "closedAt": "2020-01-22T01:57:43Z", "author": {"login": "trustin"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb8cbfKgH2gAyMzY1MTQ0MzM3OjMxNmYwODA0MjNjYTBiNDE3MGEzMTQ0ZWM2Yzg1ZTgyODI0ODVhNmI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABb8rmljgFqTM0NjMwMTkzOA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "316f080423ca0b4170a3144ec6c85e8282485a6b", "author": {"user": {"login": "trustin", "name": "Trustin Lee"}}, "url": "https://github.com/line/armeria/commit/316f080423ca0b4170a3144ec6c85e8282485a6b", "committedDate": "2020-01-21T07:57:45Z", "message": "Auto-generate gRPC examples with default fields\n\nMotivation:\n\nA user sometimes uses a default gRPC `Message` instance as an example\nrequest when building a `DocService`:\n\n    DocService.builder()\n              .exampleRequestForMethod(MyServiceGrpc.SERVICE_NAME,\n                                       \"DoSomething\",\n                                       SomeRequest.getDefaultInstance())\n\n.. which is a tedious job that can be automated.\n\nModifications:\n\n- Make `GrpcDocServicePlugin` append an example request generated from\n  the default instance.\n  - The frontend will show the user-specified example first.\n\nResult:\n\n- A user does not need to set the default gRPC examples."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ1NjkwOTMz", "url": "https://github.com/line/armeria/pull/2412#pullrequestreview-345690933", "createdAt": "2020-01-21T08:08:42Z", "commit": {"oid": "316f080423ca0b4170a3144ec6c85e8282485a6b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMVQwODowODo0MlrOFfxOhw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMVQwODowODo0MlrOFfxOhw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODg1NjcxMQ==", "bodyText": "A bit more characters, but guess we may just stick to Stream API for simplicity Stream.concat(Streams.stream(first), Streams.stream(second)).distinct()", "url": "https://github.com/line/armeria/pull/2412#discussion_r368856711", "createdAt": "2020-01-21T08:08:42Z", "author": {"login": "anuraaga"}, "path": "core/src/main/java/com/linecorp/armeria/server/docs/DocService.java", "diffHunk": "@@ -318,14 +318,20 @@ private ServiceInfo addServiceExamples(ServiceInfo service) {\n                 service.methods().stream().map(m -> new MethodInfo(\n                         m.name(), m.returnTypeSignature(), m.parameters(), m.exceptionTypeSignatures(),\n                         m.endpoints(),\n-                        Iterables.concat(m.exampleHttpHeaders(), exampleHttpHeaders.get(m.name())),\n-                        Iterables.concat(m.exampleRequests(), exampleRequests.get(m.name())),\n+                        // Show the examples added via `DocServiceBuilder` before the examples\n+                        // generated by the plugin.\n+                        concatAndDedup(exampleHttpHeaders.get(m.name()), m.exampleHttpHeaders()),\n+                        concatAndDedup(exampleRequests.get(m.name()), m.exampleRequests()),\n                         m.httpMethod(), m.docString()))::iterator,\n                 Iterables.concat(service.exampleHttpHeaders(),\n                                  exampleHttpHeaders.get(\"\")),\n                 service.docString());\n     }\n \n+    private static <T> Iterable<T> concatAndDedup(Iterable<T> first, Iterable<T> second) {\n+        return Streams.stream(Iterables.concat(first, second)).distinct()::iterator;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "316f080423ca0b4170a3144ec6c85e8282485a6b"}, "originalPosition": 17}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ1NjkxMzIx", "url": "https://github.com/line/armeria/pull/2412#pullrequestreview-345691321", "createdAt": "2020-01-21T08:09:39Z", "commit": {"oid": "316f080423ca0b4170a3144ec6c85e8282485a6b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1666f3ea23553cedfcc22ed79fc24661c52af78f", "author": {"user": {"login": "trustin", "name": "Trustin Lee"}}, "url": "https://github.com/line/armeria/commit/1666f3ea23553cedfcc22ed79fc24661c52af78f", "committedDate": "2020-01-21T09:13:36Z", "message": "Serialize default fields for user-specified gRPC examples as well"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "37db289935752c2979300caa3c83ec7071dd41b9", "author": {"user": {"login": "trustin", "name": "Trustin Lee"}}, "url": "https://github.com/line/armeria/commit/37db289935752c2979300caa3c83ec7071dd41b9", "committedDate": "2020-01-21T09:37:44Z", "message": "Fix a test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8771e74e2759f1efc7bb515ec916787c64b88a16", "author": {"user": {"login": "trustin", "name": "Trustin Lee"}}, "url": "https://github.com/line/armeria/commit/8771e74e2759f1efc7bb515ec916787c64b88a16", "committedDate": "2020-01-21T09:38:17Z", "message": "Checkstyle"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d7479085937d1ebfb5e95bd43c2551b86486577d", "author": {"user": {"login": "trustin", "name": "Trustin Lee"}}, "url": "https://github.com/line/armeria/commit/d7479085937d1ebfb5e95bd43c2551b86486577d", "committedDate": "2020-01-21T09:40:10Z", "message": "Address the comments from @anuraaga"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ1NzU1NTk1", "url": "https://github.com/line/armeria/pull/2412#pullrequestreview-345755595", "createdAt": "2020-01-21T10:01:40Z", "commit": {"oid": "d7479085937d1ebfb5e95bd43c2551b86486577d"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "aa524cb3731d3af993bb6d7fb642ff28ea9eb722", "author": {"user": {"login": "trustin", "name": "Trustin Lee"}}, "url": "https://github.com/line/armeria/commit/aa524cb3731d3af993bb6d7fb642ff28ea9eb722", "committedDate": "2020-01-21T10:12:38Z", "message": "Ignore an empty object"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "79574d970bacb49cd7887e624215f3e8293cf2ec", "author": {"user": {"login": "trustin", "name": "Trustin Lee"}}, "url": "https://github.com/line/armeria/commit/79574d970bacb49cd7887e624215f3e8293cf2ec", "committedDate": "2020-01-21T10:17:57Z", "message": "Fix test"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ2MzAxOTM4", "url": "https://github.com/line/armeria/pull/2412#pullrequestreview-346301938", "createdAt": "2020-01-22T01:38:27Z", "commit": {"oid": "79574d970bacb49cd7887e624215f3e8293cf2ec"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 890, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}