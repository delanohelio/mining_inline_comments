{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTQ2MzA3OTY5", "number": 3251, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yOVQwMzoyMzowOVrOFJq0tw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yOVQwNzoxMjozNFrOFJswVQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQ1NjgzMTI3OnYy", "diffSide": "RIGHT", "path": "core/src/main/java/com/linecorp/armeria/client/retry/AbstractRetryingClient.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yOVQwMzoyMzowOVrOIMGHzw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yOVQwMzoyMzowOVrOIMGHzw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTU1NDEyNw==", "bodyText": "These just changed to use thenAccept instead of thenApply.", "url": "https://github.com/line/armeria/pull/3251#discussion_r549554127", "createdAt": "2020-12-29T03:23:09Z", "author": {"login": "minwoox"}, "path": "core/src/main/java/com/linecorp/armeria/client/retry/AbstractRetryingClient.java", "diffHunk": "@@ -276,45 +276,39 @@ protected static ClientRequestContext newDerivedContext(ClientRequestContext ctx\n         if (parentLog.isAvailable(RequestLogProperty.NAME)) {\n             final String serviceName = partial.serviceName();\n             final String name = partial.name();\n-            if (name != null) {\n-                if (serviceName != null) {\n-                    logBuilder.name(serviceName, name);\n-                } else {\n-                    logBuilder.name(name);\n-                }\n+            if (serviceName != null) {\n+                logBuilder.name(serviceName, name);\n+            } else {\n+                logBuilder.name(name);\n             }\n         }\n \n         final RequestLogBuilder parentLogBuilder = ctx.logBuilder();\n         if (parentLogBuilder.isDeferred(RequestLogProperty.REQUEST_CONTENT)) {\n             logBuilder.defer(RequestLogProperty.REQUEST_CONTENT);\n         }\n-        parentLog.whenAvailable(RequestLogProperty.REQUEST_CONTENT).thenApply(requestLog -> {\n-            logBuilder.requestContent(requestLog.requestContent(), requestLog.rawRequestContent());\n-            return null;\n-        });\n+        parentLog.whenAvailable(RequestLogProperty.REQUEST_CONTENT)\n+                 .thenAccept(requestLog -> logBuilder.requestContent(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "09a51dfef00aa6bb71c88856e30edecfc96db430"}, "originalPosition": 26}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQ1NjgzMjY3OnYy", "diffSide": "RIGHT", "path": "core/src/main/java/com/linecorp/armeria/common/logging/DefaultRequestLog.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yOVQwMzoyNDoxMlrOIMGIfQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yOVQwMzoyNDoxMlrOIMGIfQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTU1NDMwMQ==", "bodyText": "This is not a bug.\nBut it does not break anything and I think it's better to call after calling updateRpcRequest .", "url": "https://github.com/line/armeria/pull/3251#discussion_r549554301", "createdAt": "2020-12-29T03:24:12Z", "author": {"login": "minwoox"}, "path": "core/src/main/java/com/linecorp/armeria/common/logging/DefaultRequestLog.java", "diffHunk": "@@ -908,11 +909,10 @@ public void requestContent(@Nullable Object requestContent, @Nullable Object raw\n \n         this.requestContent = requestContent;\n         this.rawRequestContent = rawRequestContent;\n-        updateFlags(RequestLogProperty.REQUEST_CONTENT);\n-\n         if (requestContent instanceof RpcRequest && ctx.rpcRequest() == null) {\n             ctx.updateRpcRequest((RpcRequest) requestContent);\n         }\n+        updateFlags(RequestLogProperty.REQUEST_CONTENT);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "09a51dfef00aa6bb71c88856e30edecfc96db430"}, "originalPosition": 17}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQ1Njg4ODg5OnYy", "diffSide": "RIGHT", "path": "core/src/main/java/com/linecorp/armeria/client/retry/AbstractRetryingClient.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yOVQwNDoxMjo0N1rOIMGkdw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yOVQwNDoxMjo0N1rOIMGkdw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTU2MTQ2Mw==", "bodyText": "\ud83d\udc4d", "url": "https://github.com/line/armeria/pull/3251#discussion_r549561463", "createdAt": "2020-12-29T04:12:47Z", "author": {"login": "ikhoon"}, "path": "core/src/main/java/com/linecorp/armeria/client/retry/AbstractRetryingClient.java", "diffHunk": "@@ -276,45 +276,39 @@ protected static ClientRequestContext newDerivedContext(ClientRequestContext ctx\n         if (parentLog.isAvailable(RequestLogProperty.NAME)) {\n             final String serviceName = partial.serviceName();\n             final String name = partial.name();\n-            if (name != null) {\n-                if (serviceName != null) {\n-                    logBuilder.name(serviceName, name);\n-                } else {\n-                    logBuilder.name(name);\n-                }\n+            if (serviceName != null) {\n+                logBuilder.name(serviceName, name);\n+            } else {\n+                logBuilder.name(name);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e727a5cf2bb9a146b8ee03b032fd6ec00b871959"}, "originalPosition": 13}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQ1NzE0NzczOnYy", "diffSide": "LEFT", "path": "core/src/main/java/com/linecorp/armeria/client/DefaultClientRequestContext.java", "isResolved": true, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yOVQwNzoxMjozNFrOIMImqw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yOVQxMzowNzowNVrOIMO5aw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTU5NDc5NQ==", "bodyText": "How about adding some comment about why we don't check nullness of rpcReq here unlike req?", "url": "https://github.com/line/armeria/pull/3251#discussion_r549594795", "createdAt": "2020-12-29T07:12:34Z", "author": {"login": "trustin"}, "path": "core/src/main/java/com/linecorp/armeria/client/DefaultClientRequestContext.java", "diffHunk": "@@ -357,9 +357,6 @@ private DefaultClientRequestContext(DefaultClientRequestContext ctx,\n         if (ctx.request() != null) {\n             requireNonNull(req, \"req\");\n         }\n-        if (ctx.rpcRequest() != null) {\n-            requireNonNull(rpcReq, \"rpcReq\");\n-        }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e727a5cf2bb9a146b8ee03b032fd6ec00b871959"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTY4NTQ5Mw==", "bodyText": "Added. \ud83d\ude04", "url": "https://github.com/line/armeria/pull/3251#discussion_r549685493", "createdAt": "2020-12-29T12:25:48Z", "author": {"login": "minwoox"}, "path": "core/src/main/java/com/linecorp/armeria/client/DefaultClientRequestContext.java", "diffHunk": "@@ -357,9 +357,6 @@ private DefaultClientRequestContext(DefaultClientRequestContext ctx,\n         if (ctx.request() != null) {\n             requireNonNull(req, \"req\");\n         }\n-        if (ctx.rpcRequest() != null) {\n-            requireNonNull(rpcReq, \"rpcReq\");\n-        }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTU5NDc5NQ=="}, "originalCommit": {"oid": "e727a5cf2bb9a146b8ee03b032fd6ec00b871959"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTY5MDc1MQ==", "bodyText": "And please add a link to the related github issue and PR? \ud83d\ude09", "url": "https://github.com/line/armeria/pull/3251#discussion_r549690751", "createdAt": "2020-12-29T12:44:02Z", "author": {"login": "trustin"}, "path": "core/src/main/java/com/linecorp/armeria/client/DefaultClientRequestContext.java", "diffHunk": "@@ -357,9 +357,6 @@ private DefaultClientRequestContext(DefaultClientRequestContext ctx,\n         if (ctx.request() != null) {\n             requireNonNull(req, \"req\");\n         }\n-        if (ctx.rpcRequest() != null) {\n-            requireNonNull(rpcReq, \"rpcReq\");\n-        }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTU5NDc5NQ=="}, "originalCommit": {"oid": "e727a5cf2bb9a146b8ee03b032fd6ec00b871959"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTY5Nzg5OQ==", "bodyText": "Added again. \ud83d\ude04", "url": "https://github.com/line/armeria/pull/3251#discussion_r549697899", "createdAt": "2020-12-29T13:07:05Z", "author": {"login": "minwoox"}, "path": "core/src/main/java/com/linecorp/armeria/client/DefaultClientRequestContext.java", "diffHunk": "@@ -357,9 +357,6 @@ private DefaultClientRequestContext(DefaultClientRequestContext ctx,\n         if (ctx.request() != null) {\n             requireNonNull(req, \"req\");\n         }\n-        if (ctx.rpcRequest() != null) {\n-            requireNonNull(rpcReq, \"rpcReq\");\n-        }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTU5NDc5NQ=="}, "originalCommit": {"oid": "e727a5cf2bb9a146b8ee03b032fd6ec00b871959"}, "originalPosition": 6}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1833, "cost": 1, "resetAt": "2021-11-12T20:44:06Z"}}}