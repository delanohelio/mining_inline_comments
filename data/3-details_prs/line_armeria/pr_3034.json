{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDc1NzM0MDM5", "number": 3034, "title": "Use MeterIdPrefixFunction bean when integrated with Spring Boot", "bodyText": "Motivation:\nArmeria Spring Integration always uses MeterIdPrefixFunction.ofDefault when enable-metrics is set to true.\nIt'd be good if users can configure the MeterIdPrefixFunction Armeria uses.\nand #2762 (comment)\nModifications:\n\nAdd an argument Optional<MeterIdPrefixFunction> to ArmeriaAutoConfiguration.armeriaServer\nAdd an argument MeterIdPrefixFunction to ArmeriaConfigurationUtil.configureServerWithArmeriaSettings\n\nResult:\nThe MeterIdPrefixFunction bean which users register will be used.\nIf the bean is not present, MeterIdPrefixFunction.ofDefault will be used.", "createdAt": "2020-08-29T07:03:08Z", "url": "https://github.com/line/armeria/pull/3034", "merged": true, "mergeCommit": {"oid": "e5c4e81419dc1aaaf89208d4cc141b62ccbcfea9"}, "closed": true, "closedAt": "2020-09-09T01:03:11Z", "author": {"login": "okue"}, "timelineItems": {"totalCount": 13, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdDkqAEABqjM3MDYyNzkyOTU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdHBjGegFqTQ4NDU4ODc2OA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a92c834d68897227cd455fda3e2f6edccef9a0a4", "author": {"user": {"login": "okue", "name": "Okue"}}, "url": "https://github.com/line/armeria/commit/a92c834d68897227cd455fda3e2f6edccef9a0a4", "committedDate": "2020-08-29T06:45:26Z", "message": "Use MeterIdPrefixFunction bean when integrated with Spring Boot"}, "afterCommit": {"oid": "72a51a518eeea3ef0e861f16a11bb8e17624c9e1", "author": {"user": {"login": "okue", "name": "Okue"}}, "url": "https://github.com/line/armeria/commit/72a51a518eeea3ef0e861f16a11bb8e17624c9e1", "committedDate": "2020-08-29T07:41:21Z", "message": "Use MeterIdPrefixFunction bean when integrated with Spring Boot"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "72a51a518eeea3ef0e861f16a11bb8e17624c9e1", "author": {"user": {"login": "okue", "name": "Okue"}}, "url": "https://github.com/line/armeria/commit/72a51a518eeea3ef0e861f16a11bb8e17624c9e1", "committedDate": "2020-08-29T07:41:21Z", "message": "Use MeterIdPrefixFunction bean when integrated with Spring Boot"}, "afterCommit": {"oid": "43f97f3e6557ea4bb2aa66997e7c18a58e8a356f", "author": {"user": {"login": "okue", "name": "Okue"}}, "url": "https://github.com/line/armeria/commit/43f97f3e6557ea4bb2aa66997e7c18a58e8a356f", "committedDate": "2020-08-29T09:14:37Z", "message": "Use MeterIdPrefixFunction bean when integrated with Spring Boot"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc4NDIzMTQ5", "url": "https://github.com/line/armeria/pull/3034#pullrequestreview-478423149", "createdAt": "2020-08-31T08:36:21Z", "commit": {"oid": "43f97f3e6557ea4bb2aa66997e7c18a58e8a356f"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "537e1447ea5fe468dc4356f9cd28e64645f39616", "author": {"user": {"login": "okue", "name": "Okue"}}, "url": "https://github.com/line/armeria/commit/537e1447ea5fe468dc4356f9cd28e64645f39616", "committedDate": "2020-08-31T09:01:04Z", "message": "Use MeterIdPrefixFunction bean when integrated with Spring Boot"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "43f97f3e6557ea4bb2aa66997e7c18a58e8a356f", "author": {"user": {"login": "okue", "name": "Okue"}}, "url": "https://github.com/line/armeria/commit/43f97f3e6557ea4bb2aa66997e7c18a58e8a356f", "committedDate": "2020-08-29T09:14:37Z", "message": "Use MeterIdPrefixFunction bean when integrated with Spring Boot"}, "afterCommit": {"oid": "537e1447ea5fe468dc4356f9cd28e64645f39616", "author": {"user": {"login": "okue", "name": "Okue"}}, "url": "https://github.com/line/armeria/commit/537e1447ea5fe468dc4356f9cd28e64645f39616", "committedDate": "2020-08-31T09:01:04Z", "message": "Use MeterIdPrefixFunction bean when integrated with Spring Boot"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc5NDcwNTk1", "url": "https://github.com/line/armeria/pull/3034#pullrequestreview-479470595", "createdAt": "2020-09-01T07:31:03Z", "commit": {"oid": "537e1447ea5fe468dc4356f9cd28e64645f39616"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMVQwNzozMTowM1rOHKpBaw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMVQwNzozMTowM1rOHKpBaw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDkxOTkxNQ==", "bodyText": "Could you use a ternary operator(? : ) instead of firstNonNull to avoid creating an extra object?", "url": "https://github.com/line/armeria/pull/3034#discussion_r480919915", "createdAt": "2020-09-01T07:31:03Z", "author": {"login": "ikhoon"}, "path": "spring/boot2-webflux-autoconfigure/src/main/java/com/linecorp/armeria/spring/web/reactive/ArmeriaReactiveWebServerFactory.java", "diffHunk": "@@ -259,7 +260,9 @@ private void configureArmeriaService(ServerBuilder sb, DocServiceBuilder docServ\n         configurePorts(sb, settings.getPorts());\n         configureServerWithArmeriaSettings(sb, settings,\n                                            firstNonNull(findBean(MeterRegistry.class), Metrics.globalRegistry),\n-                                           findBeans(HealthChecker.class));\n+                                           findBeans(HealthChecker.class),\n+                                           firstNonNull(findBean(MeterIdPrefixFunction.class),\n+                                                        MeterIdPrefixFunction.ofDefault(\"armeria.server\")));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "537e1447ea5fe468dc4356f9cd28e64645f39616"}, "originalPosition": 15}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f18c7e151290fd8cec921ad50bdb2ee7dcf42cda", "author": {"user": {"login": "okue", "name": "Okue"}}, "url": "https://github.com/line/armeria/commit/f18c7e151290fd8cec921ad50bdb2ee7dcf42cda", "committedDate": "2020-09-01T09:01:47Z", "message": "address comments by @ikhoon"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "80c521c6dda933700367f79c716da68fe5c953d4", "author": {"user": {"login": "okue", "name": "Okue"}}, "url": "https://github.com/line/armeria/commit/80c521c6dda933700367f79c716da68fe5c953d4", "committedDate": "2020-09-01T11:04:14Z", "message": "fix check style"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgzMjg5Mzcx", "url": "https://github.com/line/armeria/pull/3034#pullrequestreview-483289371", "createdAt": "2020-09-07T07:04:27Z", "commit": {"oid": "80c521c6dda933700367f79c716da68fe5c953d4"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wN1QwNzowNDoyOFrOHNyjsg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wN1QwNzowNDoyOFrOHNyjsg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDIyMTg3NA==", "bodyText": "How about using a non-default prefix name, e.g. custom.grpc.server?", "url": "https://github.com/line/armeria/pull/3034#discussion_r484221874", "createdAt": "2020-09-07T07:04:28Z", "author": {"login": "trustin"}, "path": "spring/boot2-autoconfigure/src/test/java/com/linecorp/armeria/spring/ArmeriaAutoConfigurationTest.java", "diffHunk": "@@ -151,6 +153,11 @@ public DocServiceConfigurator helloGrpcServiceExamples() {\n                              .exampleHeaders(HelloServiceGrpc.SERVICE_NAME, \"Hello\",\n                                              HttpHeaders.of(\"x-additional-header\", \"headerVal\"));\n         }\n+\n+        @Bean\n+        public MeterIdPrefixFunction myMeterIdPrefixFunction() {\n+            return GrpcMeterIdPrefixFunction.of(\"armeria.server\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "80c521c6dda933700367f79c716da68fe5c953d4"}, "originalPosition": 17}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "777793420d364d83ad614c16b564ba20fa305dd8", "author": {"user": {"login": "okue", "name": "Okue"}}, "url": "https://github.com/line/armeria/commit/777793420d364d83ad614c16b564ba20fa305dd8", "committedDate": "2020-09-07T09:36:13Z", "message": "address comments by @trustin"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "730522298b51960c36ae0e6a1eb2a3ce0516a2fa", "author": {"user": {"login": "okue", "name": "Okue"}}, "url": "https://github.com/line/armeria/commit/730522298b51960c36ae0e6a1eb2a3ce0516a2fa", "committedDate": "2020-09-07T10:03:09Z", "message": "fix checkstyle"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgzODE0NTc1", "url": "https://github.com/line/armeria/pull/3034#pullrequestreview-483814575", "createdAt": "2020-09-08T05:58:25Z", "commit": {"oid": "730522298b51960c36ae0e6a1eb2a3ce0516a2fa"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg0NTg4NzY4", "url": "https://github.com/line/armeria/pull/3034#pullrequestreview-484588768", "createdAt": "2020-09-09T01:02:57Z", "commit": {"oid": "730522298b51960c36ae0e6a1eb2a3ce0516a2fa"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4604, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}