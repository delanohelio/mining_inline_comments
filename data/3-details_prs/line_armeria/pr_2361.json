{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzU4NTgyMjc5", "number": 2361, "title": "Add `Clients.builder()` / Deprecate methods with optional parameters", "bodyText": "Motivation:\n\nFor consistency, a user should be able to create a ClientBuilder via\nbuilder() factory methods.\nThe factory methods in Clients and WebClient are overly crowded.\n\nModifications:\n\nAdd Clients.builder() and deprecated their corresponding\nClientBuilder constructors.\nDeprecate the factory methods that require optional parameters in\nClients and WebClients.\nMiscellaneous improvement:\n\nWebClient now accepts a URI that starts with none+.\n\n\n\nResult:\n\nCloses #1719\nLess cognitive load (once we remove the deprecated ones)", "createdAt": "2020-01-02T08:15:44Z", "url": "https://github.com/line/armeria/pull/2361", "merged": true, "mergeCommit": {"oid": "c2629b63850fd9ee3156d37a18bc46cf367cd748"}, "closed": true, "closedAt": "2020-01-03T02:35:57Z", "author": {"login": "trustin"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb2VPVsAH2gAyMzU4NTgyMjc5OjJlYjVmNTVlNDcyNWU5YWVjNWNjMzY1NjEwNTA4MDA4NDQxMTY3NTA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABb2lBfGgH2gAyMzU4NTgyMjc5OjA3ZDBhOTJlNjZhZTYxNjJjMzdlYWQzZjUxMWMzMzcxYzZlY2FiZGU=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "2eb5f55e4725e9aec5cc36561050800844116750", "author": {"user": {"login": "trustin", "name": "Trustin Lee"}}, "url": "https://github.com/line/armeria/commit/2eb5f55e4725e9aec5cc36561050800844116750", "committedDate": "2020-01-02T08:11:36Z", "message": "Add `Clients.builder()` / Deprecate methods with optional parameters\n\nMotivation:\n\n- For consistency, a user should be able to create a `ClientBuilder` via\n  `builder()` factory methods.\n- The factory methods in `Clients` and `WebClient` are overly crowded.\n\nModifications:\n\n- Add `Clients.builder()` and deprecated their corresponding\n  `ClientBuilder` constructors.\n- Deprecate the factory methods that require optional parameters in\n  `Clients` and `WebClients`.\n\nResult:\n\n- Closes #1719\n- Less cognitive load (once we remove the deprecated ones)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7ca16aa2f3a81214fd4fa7c19d1256c361d07af6", "author": {"user": {"login": "trustin", "name": "Trustin Lee"}}, "url": "https://github.com/line/armeria/commit/7ca16aa2f3a81214fd4fa7c19d1256c361d07af6", "committedDate": "2020-01-02T08:22:27Z", "message": "Indentation"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzM3NTYyNjYz", "url": "https://github.com/line/armeria/pull/2361#pullrequestreview-337562663", "createdAt": "2020-01-02T08:23:55Z", "commit": {"oid": "7ca16aa2f3a81214fd4fa7c19d1256c361d07af6"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cfb510a9a087541b6a84901306f0b826fe090d44", "author": {"user": {"login": "trustin", "name": "Trustin Lee"}}, "url": "https://github.com/line/armeria/commit/cfb510a9a087541b6a84901306f0b826fe090d44", "committedDate": "2020-01-02T08:47:37Z", "message": "Checkstyle / Improved scheme normalization"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzM3NTc0NjM0", "url": "https://github.com/line/armeria/pull/2361#pullrequestreview-337574634", "createdAt": "2020-01-02T09:09:44Z", "commit": {"oid": "cfb510a9a087541b6a84901306f0b826fe090d44"}, "state": "APPROVED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wMlQwOTowOTo0NFrOFZnf-g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wMlQwOToxMjoyMFrOFZnirA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MjQwNTg4Mg==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                 * Returns a new {@link WebClient} client that connects to the specified {@link Endpoint} with\n          \n          \n            \n                 * Returns a new {@link WebClient} that connects to the specified {@link Endpoint} with", "url": "https://github.com/line/armeria/pull/2361#discussion_r362405882", "createdAt": "2020-01-02T09:09:44Z", "author": {"login": "ikhoon"}, "path": "core/src/main/java/com/linecorp/armeria/client/WebClient.java", "diffHunk": "@@ -36,168 +36,248 @@\n public interface WebClient extends ClientBuilderParams, Unwrappable {\n \n     /**\n-     * Creates a new web client without a base URI using the default {@link ClientFactory} and\n+     * Returns a {@link WebClient} without a base URI using the default {@link ClientFactory} and\n      * the default {@link ClientOptions}.\n      */\n     static WebClient of() {\n-        return builder().options(ClientOptions.of()).build();\n+        return DefaultWebClient.DEFAULT;\n     }\n \n     /**\n-     * Creates a new web client that connects to the specified {@code uri} using the default\n+     * Returns a new {@link WebClient} that connects to the specified {@code uri} using the default options.\n+     *\n+     * @param uri the URI of the server endpoint\n+     *\n+     * @throws IllegalArgumentException if the scheme of the specified {@code uri} is not an HTTP scheme\n+     */\n+    static WebClient of(String uri) {\n+        return builder(uri).build();\n+    }\n+\n+    /**\n+     * Returns a new {@link WebClient} that connects to the specified {@link URI} using the default options.\n+     *\n+     * @param uri the {@link URI} of the server endpoint\n+     *\n+     * @throws IllegalArgumentException if the scheme of the specified {@link URI} is not an HTTP scheme\n+     */\n+    static WebClient of(URI uri) {\n+        return builder(uri).build();\n+    }\n+\n+    /**\n+     * Returns a new {@link WebClient} client that connects to the specified {@link Endpoint} with", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cfb510a9a087541b6a84901306f0b826fe090d44"}, "originalPosition": 37}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MjQwNjA5Nw==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                 * Returns a new web client that connects to the specified {@code uri} using the default\n          \n          \n            \n                 * Returns a new {@link WebClient} that connects to the specified {@code uri} using the default", "url": "https://github.com/line/armeria/pull/2361#discussion_r362406097", "createdAt": "2020-01-02T09:10:32Z", "author": {"login": "ikhoon"}, "path": "core/src/main/java/com/linecorp/armeria/client/WebClient.java", "diffHunk": "@@ -36,168 +36,248 @@\n public interface WebClient extends ClientBuilderParams, Unwrappable {\n \n     /**\n-     * Creates a new web client without a base URI using the default {@link ClientFactory} and\n+     * Returns a {@link WebClient} without a base URI using the default {@link ClientFactory} and\n      * the default {@link ClientOptions}.\n      */\n     static WebClient of() {\n-        return builder().options(ClientOptions.of()).build();\n+        return DefaultWebClient.DEFAULT;\n     }\n \n     /**\n-     * Creates a new web client that connects to the specified {@code uri} using the default\n+     * Returns a new {@link WebClient} that connects to the specified {@code uri} using the default options.\n+     *\n+     * @param uri the URI of the server endpoint\n+     *\n+     * @throws IllegalArgumentException if the scheme of the specified {@code uri} is not an HTTP scheme\n+     */\n+    static WebClient of(String uri) {\n+        return builder(uri).build();\n+    }\n+\n+    /**\n+     * Returns a new {@link WebClient} that connects to the specified {@link URI} using the default options.\n+     *\n+     * @param uri the {@link URI} of the server endpoint\n+     *\n+     * @throws IllegalArgumentException if the scheme of the specified {@link URI} is not an HTTP scheme\n+     */\n+    static WebClient of(URI uri) {\n+        return builder(uri).build();\n+    }\n+\n+    /**\n+     * Returns a new {@link WebClient} client that connects to the specified {@link Endpoint} with\n+     * the {@link SessionProtocol} using the default {@link ClientFactory} and the default\n+     * {@link ClientOptions}.\n+     *\n+     * @param protocol the {@link SessionProtocol} of the {@link Endpoint}\n+     * @param endpoint the server {@link Endpoint}\n+     */\n+    static WebClient of(SessionProtocol protocol, Endpoint endpoint) {\n+        return builder(protocol, endpoint).build();\n+    }\n+\n+    /**\n+     * Returns a new {@link WebClient} that connects to the specified {@code uri} using the default\n      * {@link ClientFactory}.\n      *\n      * @param uri the URI of the server endpoint\n      * @param options the {@link ClientOptionValue}s\n      *\n      * @throws IllegalArgumentException if the scheme of the specified {@code uri} is not an HTTP scheme\n+     *\n+     * @deprecated Use {@link #builder(String)} and {@link WebClientBuilder#option(ClientOptionValue)}.\n      */\n+    @Deprecated\n     static WebClient of(String uri, ClientOptionValue<?>... options) {\n-        return of(ClientFactory.ofDefault(), uri, options);\n+        return builder(uri).options(options).build();\n     }\n \n     /**\n-     * Creates a new web client that connects to the specified {@code uri} using the default\n+     * Returns a new web client that connects to the specified {@code uri} using the default", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cfb510a9a087541b6a84901306f0b826fe090d44"}, "originalPosition": 67}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MjQwNjIxNA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                 * Returns a new web client that connects to the specified {@code uri} using an alternative\n          \n          \n            \n                 * Returns a new {@link WebClient} that connects to the specified {@code uri} using an alternative", "url": "https://github.com/line/armeria/pull/2361#discussion_r362406214", "createdAt": "2020-01-02T09:11:00Z", "author": {"login": "ikhoon"}, "path": "core/src/main/java/com/linecorp/armeria/client/WebClient.java", "diffHunk": "@@ -36,168 +36,248 @@\n public interface WebClient extends ClientBuilderParams, Unwrappable {\n \n     /**\n-     * Creates a new web client without a base URI using the default {@link ClientFactory} and\n+     * Returns a {@link WebClient} without a base URI using the default {@link ClientFactory} and\n      * the default {@link ClientOptions}.\n      */\n     static WebClient of() {\n-        return builder().options(ClientOptions.of()).build();\n+        return DefaultWebClient.DEFAULT;\n     }\n \n     /**\n-     * Creates a new web client that connects to the specified {@code uri} using the default\n+     * Returns a new {@link WebClient} that connects to the specified {@code uri} using the default options.\n+     *\n+     * @param uri the URI of the server endpoint\n+     *\n+     * @throws IllegalArgumentException if the scheme of the specified {@code uri} is not an HTTP scheme\n+     */\n+    static WebClient of(String uri) {\n+        return builder(uri).build();\n+    }\n+\n+    /**\n+     * Returns a new {@link WebClient} that connects to the specified {@link URI} using the default options.\n+     *\n+     * @param uri the {@link URI} of the server endpoint\n+     *\n+     * @throws IllegalArgumentException if the scheme of the specified {@link URI} is not an HTTP scheme\n+     */\n+    static WebClient of(URI uri) {\n+        return builder(uri).build();\n+    }\n+\n+    /**\n+     * Returns a new {@link WebClient} client that connects to the specified {@link Endpoint} with\n+     * the {@link SessionProtocol} using the default {@link ClientFactory} and the default\n+     * {@link ClientOptions}.\n+     *\n+     * @param protocol the {@link SessionProtocol} of the {@link Endpoint}\n+     * @param endpoint the server {@link Endpoint}\n+     */\n+    static WebClient of(SessionProtocol protocol, Endpoint endpoint) {\n+        return builder(protocol, endpoint).build();\n+    }\n+\n+    /**\n+     * Returns a new {@link WebClient} that connects to the specified {@code uri} using the default\n      * {@link ClientFactory}.\n      *\n      * @param uri the URI of the server endpoint\n      * @param options the {@link ClientOptionValue}s\n      *\n      * @throws IllegalArgumentException if the scheme of the specified {@code uri} is not an HTTP scheme\n+     *\n+     * @deprecated Use {@link #builder(String)} and {@link WebClientBuilder#option(ClientOptionValue)}.\n      */\n+    @Deprecated\n     static WebClient of(String uri, ClientOptionValue<?>... options) {\n-        return of(ClientFactory.ofDefault(), uri, options);\n+        return builder(uri).options(options).build();\n     }\n \n     /**\n-     * Creates a new web client that connects to the specified {@code uri} using the default\n+     * Returns a new web client that connects to the specified {@code uri} using the default\n      * {@link ClientFactory}.\n      *\n      * @param uri the URI of the server endpoint\n      * @param options the {@link ClientOptions}\n      *\n      * @throws IllegalArgumentException if the scheme of the specified {@code uri} is not an HTTP scheme\n+     *\n+     * @deprecated Use {@link #builder(String)} and {@link WebClientBuilder#options(ClientOptions)}.\n      */\n+    @Deprecated\n     static WebClient of(String uri, ClientOptions options) {\n-        return of(ClientFactory.ofDefault(), uri, options);\n+        return builder(uri).options(options).build();\n     }\n \n     /**\n-     * Creates a new web client that connects to the specified {@code uri} using an alternative\n+     * Returns a new web client that connects to the specified {@code uri} using an alternative", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cfb510a9a087541b6a84901306f0b826fe090d44"}, "originalPosition": 85}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MjQwNjU3Mg==", "bodyText": "s/new web client/new {@link WebClient} \ud83d\ude00", "url": "https://github.com/line/armeria/pull/2361#discussion_r362406572", "createdAt": "2020-01-02T09:12:20Z", "author": {"login": "ikhoon"}, "path": "core/src/main/java/com/linecorp/armeria/client/WebClient.java", "diffHunk": "@@ -36,168 +36,248 @@\n public interface WebClient extends ClientBuilderParams, Unwrappable {\n \n     /**\n-     * Creates a new web client without a base URI using the default {@link ClientFactory} and\n+     * Returns a {@link WebClient} without a base URI using the default {@link ClientFactory} and\n      * the default {@link ClientOptions}.\n      */\n     static WebClient of() {\n-        return builder().options(ClientOptions.of()).build();\n+        return DefaultWebClient.DEFAULT;\n     }\n \n     /**\n-     * Creates a new web client that connects to the specified {@code uri} using the default\n+     * Returns a new {@link WebClient} that connects to the specified {@code uri} using the default options.\n+     *\n+     * @param uri the URI of the server endpoint\n+     *\n+     * @throws IllegalArgumentException if the scheme of the specified {@code uri} is not an HTTP scheme\n+     */\n+    static WebClient of(String uri) {\n+        return builder(uri).build();\n+    }\n+\n+    /**\n+     * Returns a new {@link WebClient} that connects to the specified {@link URI} using the default options.\n+     *\n+     * @param uri the {@link URI} of the server endpoint\n+     *\n+     * @throws IllegalArgumentException if the scheme of the specified {@link URI} is not an HTTP scheme\n+     */\n+    static WebClient of(URI uri) {\n+        return builder(uri).build();\n+    }\n+\n+    /**\n+     * Returns a new {@link WebClient} client that connects to the specified {@link Endpoint} with\n+     * the {@link SessionProtocol} using the default {@link ClientFactory} and the default\n+     * {@link ClientOptions}.\n+     *\n+     * @param protocol the {@link SessionProtocol} of the {@link Endpoint}\n+     * @param endpoint the server {@link Endpoint}\n+     */\n+    static WebClient of(SessionProtocol protocol, Endpoint endpoint) {\n+        return builder(protocol, endpoint).build();\n+    }\n+\n+    /**\n+     * Returns a new {@link WebClient} that connects to the specified {@code uri} using the default\n      * {@link ClientFactory}.\n      *\n      * @param uri the URI of the server endpoint\n      * @param options the {@link ClientOptionValue}s\n      *\n      * @throws IllegalArgumentException if the scheme of the specified {@code uri} is not an HTTP scheme\n+     *\n+     * @deprecated Use {@link #builder(String)} and {@link WebClientBuilder#option(ClientOptionValue)}.\n      */\n+    @Deprecated\n     static WebClient of(String uri, ClientOptionValue<?>... options) {\n-        return of(ClientFactory.ofDefault(), uri, options);\n+        return builder(uri).options(options).build();\n     }\n \n     /**\n-     * Creates a new web client that connects to the specified {@code uri} using the default\n+     * Returns a new web client that connects to the specified {@code uri} using the default\n      * {@link ClientFactory}.\n      *\n      * @param uri the URI of the server endpoint\n      * @param options the {@link ClientOptions}\n      *\n      * @throws IllegalArgumentException if the scheme of the specified {@code uri} is not an HTTP scheme\n+     *\n+     * @deprecated Use {@link #builder(String)} and {@link WebClientBuilder#options(ClientOptions)}.\n      */\n+    @Deprecated\n     static WebClient of(String uri, ClientOptions options) {\n-        return of(ClientFactory.ofDefault(), uri, options);\n+        return builder(uri).options(options).build();\n     }\n \n     /**\n-     * Creates a new web client that connects to the specified {@code uri} using an alternative\n+     * Returns a new web client that connects to the specified {@code uri} using an alternative\n      * {@link ClientFactory}.\n      *\n      * @param factory an alternative {@link ClientFactory}\n      * @param uri the URI of the server endpoint\n      * @param options the {@link ClientOptionValue}s\n      *\n      * @throws IllegalArgumentException if the scheme of the specified {@code uri} is not an HTTP scheme\n+     *\n+     * @deprecated Use {@link #builder(String)}, {@link WebClientBuilder#factory(ClientFactory)}\n+     *             and {@link WebClientBuilder#options(ClientOptionValue[])}.\n      */\n+    @Deprecated\n     static WebClient of(ClientFactory factory, String uri, ClientOptionValue<?>... options) {\n         return builder(uri).factory(factory).options(options).build();\n     }\n \n     /**\n-     * Creates a new web client that connects to the specified {@code uri} using an alternative\n+     * Returns a new web client that connects to the specified {@code uri} using an alternative", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cfb510a9a087541b6a84901306f0b826fe090d44"}, "originalPosition": 104}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ac9b80f9c8ff15f6fd74bcf05118e2adf47041a2", "author": {"user": {"login": "trustin", "name": "Trustin Lee"}}, "url": "https://github.com/line/armeria/commit/ac9b80f9c8ff15f6fd74bcf05118e2adf47041a2", "committedDate": "2020-01-02T12:32:35Z", "message": "Address the comments from @ikhoon"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzM3OTI3Mzk1", "url": "https://github.com/line/armeria/pull/2361#pullrequestreview-337927395", "createdAt": "2020-01-03T01:40:07Z", "commit": {"oid": "ac9b80f9c8ff15f6fd74bcf05118e2adf47041a2"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wM1QwMTo0MDowN1rOFZ4rrQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wM1QwMTo0ODozN1rOFZ4vXA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MjY4NzQwNQ==", "bodyText": "Clients?", "url": "https://github.com/line/armeria/pull/2361#discussion_r362687405", "createdAt": "2020-01-03T01:40:07Z", "author": {"login": "minwoox"}, "path": "grpc-protocol/src/main/java/com/linecorp/armeria/common/grpc/protocol/UnaryGrpcClient.java", "diffHunk": "@@ -59,7 +59,7 @@\n      * Constructs a {@link UnaryGrpcClient} for the given {@link WebClient}.\n      */\n     // TODO(anuraaga): We would ideally use our standard client building pattern, i.e.,\n-    // new ClientBuilder(...).build(UnaryGrpcClient.class), but that requires mapping protocol schemes to media\n+    // Client.builder(...).build(UnaryGrpcClient.class), but that requires mapping protocol schemes to media", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ac9b80f9c8ff15f6fd74bcf05118e2adf47041a2"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MjY4ODM0OA==", "bodyText": "Could you add a small example for this case please?", "url": "https://github.com/line/armeria/pull/2361#discussion_r362688348", "createdAt": "2020-01-03T01:48:37Z", "author": {"login": "minwoox"}, "path": "core/src/main/java/com/linecorp/armeria/client/WebClientBuilder.java", "diffHunk": "@@ -77,8 +85,15 @@ static boolean isUndefinedUri(URI uri) {\n         if (isUndefinedUri(uri)) {\n             this.uri = uri;\n         } else {\n-            validateScheme(requireNonNull(uri, \"uri\").getScheme());\n-            this.uri = URI.create(SerializationFormat.NONE + \"+\" + uri);\n+            final String givenScheme = requireNonNull(uri, \"uri\").getScheme();\n+            final Scheme scheme = validateScheme(givenScheme);\n+            if (scheme.uriText().equals(givenScheme)) {\n+                this.uri = uri;\n+            } else {\n+                // Replace the user-specified scheme with the normalized one.\n+                this.uri = URI.create(scheme.uriText() +\n+                                      uri.toString().substring(givenScheme.length()));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ac9b80f9c8ff15f6fd74bcf05118e2adf47041a2"}, "originalPosition": 40}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1d4de0574f3b2da0db762120ce773e475f85def6", "author": {"user": {"login": "trustin", "name": "Trustin Lee"}}, "url": "https://github.com/line/armeria/commit/1d4de0574f3b2da0db762120ce773e475f85def6", "committedDate": "2020-01-03T02:21:56Z", "message": "Address the comments from @minwoox"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "07d0a92e66ae6162c37ead3f511c3371c6ecabde", "author": {"user": {"login": "trustin", "name": "Trustin Lee"}}, "url": "https://github.com/line/armeria/commit/07d0a92e66ae6162c37ead3f511c3371c6ecabde", "committedDate": "2020-01-03T02:34:57Z", "message": "Clean-up"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1033, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}