{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE5NzU2NjM0", "number": 7047, "title": "xds: change route data validation logic", "bodyText": "Routes with action of specifying cluster_header should be skipped.\nEliminate unnecessary logic for validating converted data in XdsClientImpl.", "createdAt": "2020-05-18T21:42:02Z", "url": "https://github.com/grpc/grpc-java/pull/7047", "merged": true, "mergeCommit": {"oid": "a86fc47c04b339e47d808fa86a26fde66f995141"}, "closed": true, "closedAt": "2020-05-18T23:23:26Z", "author": {"login": "voidzcy"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcimo-FgH2gAyNDE5NzU2NjM0OmYwZGUxNjIyMDgwMzJmYzBhOWI2YWExZGJiZDliMjNlNDRjOWJmMDE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcioHJbgFqTQxMzk5NDE5MA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "f0de162208032fc0a9b6aa1dbbd9b23e44c9bf01", "author": {"user": {"login": "voidzcy", "name": "Chengyuan Zhang"}}, "url": "https://github.com/grpc/grpc-java/commit/f0de162208032fc0a9b6aa1dbbd9b23e44c9bf01", "committedDate": "2020-05-18T21:20:39Z", "message": "Routes with action that specifies cluster_header should be skipped."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e4239350f374286d117743c7103f87a17c170a4c", "author": {"user": {"login": "voidzcy", "name": "Chengyuan Zhang"}}, "url": "https://github.com/grpc/grpc-java/commit/e4239350f374286d117743c7103f87a17c170a4c", "committedDate": "2020-05-18T21:38:35Z", "message": "Eliminate unnecessary validation logic in XdsClientImpl, they are already covered in converters."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEzOTU5NDMw", "url": "https://github.com/grpc/grpc-java/pull/7047#pullrequestreview-413959430", "createdAt": "2020-05-18T21:43:18Z", "commit": {"oid": "e4239350f374286d117743c7103f87a17c170a4c"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOFQyMTo0MzoxOFrOGXIepg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOFQyMTo0Mzo1MFrOGXIfWQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjkwOTM1MA==", "bodyText": "Justification: The converted object EnvoyProtoData.Route is guaranteed to have one of cluster or weighted_cluster set. So this logic is redundant here.", "url": "https://github.com/grpc/grpc-java/pull/7047#discussion_r426909350", "createdAt": "2020-05-18T21:43:18Z", "author": {"login": "voidzcy"}, "path": "xds/src/main/java/io/grpc/xds/XdsClientImpl.java", "diffHunk": "@@ -864,30 +864,10 @@ private void handleRdsResponse(DiscoveryResponse rdsResponse) {\n           \"Virtual host [\" + virtualHost.getName()\n               + \"] contains non-default route as the last route\");\n     }\n-    // We only validate the default route unless path matching is enabled.\n     if (!enableExperimentalRouting) {\n       EnvoyProtoData.Route defaultRoute = Iterables.getLast(routes);\n-      if (defaultRoute.getRouteAction().getCluster() == null) {\n-        throw new InvalidProtoDataException(\n-            \"Virtual host [\" + virtualHost.getName()\n-                + \"] default route contains no cluster name\");\n-      }\n       return Collections.singletonList(defaultRoute);\n     }\n-\n-    // We do more validation if path matching is enabled, but whether every single route is\n-    // required to be valid for grpc is TBD.\n-    // For now we consider the whole list invalid if anything invalid for grpc is found.\n-    // TODO(zdapeng): Fix it if the decision is different from current implementation.\n-    // TODO(zdapeng): Add test for validation.\n-    for (EnvoyProtoData.Route route : routes) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e4239350f374286d117743c7103f87a17c170a4c"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjkwOTUyOQ==", "bodyText": "No longer require the default route to have cluster as the cluster_specifier.", "url": "https://github.com/grpc/grpc-java/pull/7047#discussion_r426909529", "createdAt": "2020-05-18T21:43:50Z", "author": {"login": "voidzcy"}, "path": "xds/src/main/java/io/grpc/xds/XdsClientImpl.java", "diffHunk": "@@ -864,30 +864,10 @@ private void handleRdsResponse(DiscoveryResponse rdsResponse) {\n           \"Virtual host [\" + virtualHost.getName()\n               + \"] contains non-default route as the last route\");\n     }\n-    // We only validate the default route unless path matching is enabled.\n     if (!enableExperimentalRouting) {\n       EnvoyProtoData.Route defaultRoute = Iterables.getLast(routes);\n-      if (defaultRoute.getRouteAction().getCluster() == null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e4239350f374286d117743c7103f87a17c170a4c"}, "originalPosition": 7}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEzOTk0MTkw", "url": "https://github.com/grpc/grpc-java/pull/7047#pullrequestreview-413994190", "createdAt": "2020-05-18T23:03:31Z", "commit": {"oid": "e4239350f374286d117743c7103f87a17c170a4c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4434, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}