{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTAyNTE0MjU2", "number": 7515, "title": "xds: implement the temporary xDS creds+fallback API", "bodyText": "", "createdAt": "2020-10-13T16:06:40Z", "url": "https://github.com/grpc/grpc-java/pull/7515", "merged": true, "mergeCommit": {"oid": "84337747ef7455fb3b7ba2691ebb151babb6829a"}, "closed": true, "closedAt": "2020-10-14T05:07:39Z", "author": {"login": "sanjaypujare"}, "timelineItems": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdSK0HlgH2gAyNTAyNTE0MjU2OmZhYmQzOWU4YTFmY2VjN2I4NmExZGZhNjM4NDEyOTE5ZGQyYThkMTc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdSVyCcAH2gAyNTAyNTE0MjU2Ojk3Y2JmNGQ1MzczZDg1YTk3ZTYxM2Y1ZWQ0MDAyZmIwYTk1ZTAxNGE=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "fabd39e8a1fcec7b86a1dfa638412919dd2a8d17", "author": {"user": {"login": "sanjaypujare", "name": null}}, "url": "https://github.com/grpc/grpc-java/commit/fabd39e8a1fcec7b86a1dfa638412919dd2a8d17", "committedDate": "2020-10-13T16:03:51Z", "message": "xds: implement the temporary xDS creds+fallback API"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA3NjEwMTk2", "url": "https://github.com/grpc/grpc-java/pull/7515#pullrequestreview-507610196", "createdAt": "2020-10-13T16:16:23Z", "commit": {"oid": "fabd39e8a1fcec7b86a1dfa638412919dd2a8d17"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xM1QxNjoxNjoyM1rOHguxnA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xM1QxNjoyMDo1MlrOHgu-jQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDA4Mjg0NA==", "bodyText": "Now, that I'm looking at the code, I think the environment variable isn't entirely necessary here, since the user already has to opt-in via an API. If we were silently enabling code paths based on I/O, that could be a problem, which might be a bigger concern in places like XdsClient. You probably don't even need setXdsSecurity(), as the useXdsSecurityWithPlaintextFallback() call itself is opting in.", "url": "https://github.com/grpc/grpc-java/pull/7515#discussion_r504082844", "createdAt": "2020-10-13T16:16:23Z", "author": {"login": "ejona86"}, "path": "xds/src/main/java/io/grpc/xds/internal/sds/XdsServerBuilder.java", "diffHunk": "@@ -29,20 +32,29 @@\n import io.grpc.ServerTransportFilter;\n import io.grpc.Status;\n import io.grpc.netty.InternalProtocolNegotiator.ProtocolNegotiator;\n+import io.grpc.netty.InternalProtocolNegotiators;\n import io.grpc.netty.NettyServerBuilder;\n+import io.grpc.xds.XdsClientWrapperForServerSds;\n import io.grpc.xds.internal.sds.SdsProtocolNegotiators.ServerSdsProtocolNegotiator;\n+import io.netty.handler.ssl.SslContext;\n+import io.netty.handler.ssl.SslContextBuilder;\n import java.io.File;\n+import java.io.InputStream;\n import java.net.InetSocketAddress;\n import java.util.concurrent.Executor;\n import java.util.concurrent.TimeUnit;\n import javax.annotation.Nullable;\n+import javax.net.ssl.SSLException;\n \n /**\n  * A version of {@link ServerBuilder} to create xDS managed servers that will use SDS to set up SSL\n  * with peers. Note, this is not ready to use yet.\n  */\n public final class XdsServerBuilder extends ServerBuilder<XdsServerBuilder> {\n \n+  private static final String XDS_SECURITY_ENV_VAR = \"GRPC_XDS_EXPERIMENTAL_SECURITY_SUPPORT\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fabd39e8a1fcec7b86a1dfa638412919dd2a8d17"}, "originalPosition": 38}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDA4NjE1Nw==", "bodyText": "Make it clear this is experimental functionality that is not ready for wide usage. It is clearly an experimental API, but that doesn't make it clear if the code is ready to be widely used.", "url": "https://github.com/grpc/grpc-java/pull/7515#discussion_r504086157", "createdAt": "2020-10-13T16:20:52Z", "author": {"login": "ejona86"}, "path": "xds/src/main/java/io/grpc/xds/internal/sds/XdsServerBuilder.java", "diffHunk": "@@ -103,7 +126,52 @@ public XdsServerBuilder fallbackHandlerRegistry(@Nullable HandlerRegistry fallba\n \n   @Override\n   public XdsServerBuilder useTransportSecurity(File certChain, File privateKey) {\n-    throw new UnsupportedOperationException(\"Cannot set security parameters on XdsServerBuilder\");\n+    delegate.useTransportSecurity(certChain, privateKey);\n+    return this;\n+  }\n+\n+  @Override\n+  public XdsServerBuilder useTransportSecurity(InputStream certChain, InputStream privateKey) {\n+    delegate.useTransportSecurity(certChain, privateKey);\n+    return this;\n+  }\n+\n+  /** Use xDS provided security with plaintext as fallback. */", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fabd39e8a1fcec7b86a1dfa638412919dd2a8d17"}, "originalPosition": 77}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "97cbf4d5373d85a97e613f5ed4002fb0a95e014a", "author": {"user": {"login": "sanjaypujare", "name": null}}, "url": "https://github.com/grpc/grpc-java/commit/97cbf4d5373d85a97e613f5ed4002fb0a95e014a", "committedDate": "2020-10-14T04:50:32Z", "message": "address review comments"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4096, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}