{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg0MDg0MzAz", "number": 6807, "title": "Add disableAutoRequest method that disables all automatic inbound flow-control requests", "bodyText": "The default behavior of requesting initial messages is applied even if disableAutoInboundFlowControl is called. ServerCalls disables all automatic flow control which is much more useful in case the user can't handle incoming messages until some time after the call has started.  This change creates a new StartableListener that has an onStart method that is invoked when the call is started which makes initial requests if necessary.\nSee #6806", "createdAt": "2020-03-05T06:02:45Z", "url": "https://github.com/grpc/grpc-java/pull/6807", "merged": true, "mergeCommit": {"oid": "a9250c1f995450a78abdc0b2490e3b4f3c189ed8"}, "closed": true, "closedAt": "2020-05-06T17:19:42Z", "author": {"login": "DRayX"}, "timelineItems": {"totalCount": 29, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcKlIp-AH2gAyMzg0MDg0MzAzOjg3YmIzOGFjYTExYTg1NDYzZjIyNjE1ZjJjNDJmNDgyOTI2OWEyNDU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABceYFaxgH2gAyMzg0MDg0MzAzOjIzZDViMTdjNTk2NGYyZjI1ZjJmMjg2YWI4Y2E5N2IxMWZiZGQ3YjY=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "87bb38aca11a85463f22615f2c42f4829269a245", "author": {"user": {"login": "DRayX", "name": null}}, "url": "https://github.com/grpc/grpc-java/commit/87bb38aca11a85463f22615f2c42f4829269a245", "committedDate": "2020-03-05T06:01:16Z", "message": "Update ClientCalls to disable initial flow-control\n\nThe default behavior of requesting initial messages is applied even if disableAutoInboundFlowControl is called. ServerCalls disables all automatic flow control which is much more useful in case the user can't handle incoming messages until some time after the call has started.  This change creates a new StartableListener that has an onStart method that is invoked when the call is started which makes initial requests if necessary."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY5MzE0OTky", "url": "https://github.com/grpc/grpc-java/pull/6807#pullrequestreview-369314992", "createdAt": "2020-03-05T06:10:13Z", "commit": {"oid": "87bb38aca11a85463f22615f2c42f4829269a245"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQwNjoxMDoxM1rOFyHaFw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQwNjoxMDoxM1rOFyHaFw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODA5NDQ4Nw==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              private static final class UnaryStreamToFuture<ReqT, RespT> extends StartableListener<RespT> {\n          \n          \n            \n              private static final class UnaryStreamToFuture<RespT> extends StartableListener<RespT> {", "url": "https://github.com/grpc/grpc-java/pull/6807#discussion_r388094487", "createdAt": "2020-03-05T06:10:13Z", "author": {"login": "DRayX"}, "path": "stub/src/main/java/io/grpc/stub/ClientCalls.java", "diffHunk": "@@ -456,12 +450,23 @@ public void onReady() {\n         adapter.onReadyHandler.run();\n       }\n     }\n+\n+    @Override\n+    void onStart() {\n+      if (adapter.autoFlowControlEnabled) {\n+        if (streamingResponse) {\n+          adapter.request(1);\n+        } else {\n+          adapter.request(2);\n+        }\n+      }\n+    }\n   }\n \n   /**\n    * Completes a {@link GrpcFuture} using {@link StreamObserver} events.\n    */\n-  private static final class UnaryStreamToFuture<RespT> extends ClientCall.Listener<RespT> {\n+  private static final class UnaryStreamToFuture<ReqT, RespT> extends StartableListener<RespT> {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "87bb38aca11a85463f22615f2c42f4829269a245"}, "originalPosition": 108}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "86752b0ca77cd713bff117fdce1d364abd75003b", "author": {"user": {"login": "DRayX", "name": null}}, "url": "https://github.com/grpc/grpc-java/commit/86752b0ca77cd713bff117fdce1d364abd75003b", "committedDate": "2020-03-05T06:10:29Z", "message": "Update stub/src/main/java/io/grpc/stub/ClientCalls.java\r\n\r\nDelete accidental addtion"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7029ad70bb69bcdbd85d5685238f2a322510d5ec", "author": {"user": {"login": "DRayX", "name": null}}, "url": "https://github.com/grpc/grpc-java/commit/7029ad70bb69bcdbd85d5685238f2a322510d5ec", "committedDate": "2020-03-09T21:39:47Z", "message": "Add new disableAutoRequest method\n\nAdd a new disableAutoRequest method that disables all automatic requests while disableAutoInboundFlowControl maintains existing behavior.  disableAutoInboundFlowControl is also marked as Deprecated."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4fd1176ab01b98ba00b2fe98ee7a391a379dec2e", "author": {"user": {"login": "DRayX", "name": null}}, "url": "https://github.com/grpc/grpc-java/commit/4fd1176ab01b98ba00b2fe98ee7a391a379dec2e", "committedDate": "2020-03-09T21:56:42Z", "message": "Add @Deprecated annotation to overrides"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2a036471fa21bac8d8de48364aee6483a9f99556", "author": {"user": {"login": "DRayX", "name": null}}, "url": "https://github.com/grpc/grpc-java/commit/2a036471fa21bac8d8de48364aee6483a9f99556", "committedDate": "2020-03-09T22:43:07Z", "message": "Update ClientResponseObserver comment"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "07bb0826830d93e681247db9f4ff1940bd45e3d6", "author": {"user": {"login": "DRayX", "name": null}}, "url": "https://github.com/grpc/grpc-java/commit/07bb0826830d93e681247db9f4ff1940bd45e3d6", "committedDate": "2020-03-09T22:47:49Z", "message": "Update Manual Flow Control examples\n\nUpdate the manual flow control examples to use the new disableAutoRequest method.  Note that the ManualFlowControlClient now needs to request one message after the call has been started."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1e8181a286ef78047ed40496677afebed5957609", "author": {"user": {"login": "DRayX", "name": null}}, "url": "https://github.com/grpc/grpc-java/commit/1e8181a286ef78047ed40496677afebed5957609", "committedDate": "2020-03-09T22:55:35Z", "message": "Update ProtoReflectionService to use disableAutoRequest"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "24d6763e50b9042bc7fcd3842c21f7c7743c86db", "author": {"user": {"login": "DRayX", "name": null}}, "url": "https://github.com/grpc/grpc-java/commit/24d6763e50b9042bc7fcd3842c21f7c7743c86db", "committedDate": "2020-03-09T22:56:51Z", "message": "Fixed mistake in comment"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c7083ae25357adbb05df2f0da19c0735712b1b7b", "author": {"user": {"login": "DRayX", "name": null}}, "url": "https://github.com/grpc/grpc-java/commit/c7083ae25357adbb05df2f0da19c0735712b1b7b", "committedDate": "2020-03-09T23:26:40Z", "message": "Fix flowControlOnCompleteWithPendingRequest test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2014d062a92b3f82d21cf78f4eee67553806b612", "author": {"user": {"login": "DRayX", "name": null}}, "url": "https://github.com/grpc/grpc-java/commit/2014d062a92b3f82d21cf78f4eee67553806b612", "committedDate": "2020-03-10T00:10:17Z", "message": "Update ManualFlowControlClient example\n\nUpdate the manual flow control client example to use a pattern that is applicable in all call arities (unary or streaming request).  If the call is unary request, the StreamObserver isn't returned, so the initial request can't be started from the return value, but the initial request can't be made before the call is started, so we expose a custom \"request\" method on the ClinetResponseObserver implementation."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4f90e0d9f23097d1681235115725bc5cb334d53f", "author": {"user": {"login": "DRayX", "name": null}}, "url": "https://github.com/grpc/grpc-java/commit/4f90e0d9f23097d1681235115725bc5cb334d53f", "committedDate": "2020-03-10T00:16:29Z", "message": "Update {Client|Server}CallsTest"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "80fc740142cf2d7c148b5f7b9183b0de6cb2945b", "author": {"user": {"login": "DRayX", "name": null}}, "url": "https://github.com/grpc/grpc-java/commit/80fc740142cf2d7c148b5f7b9183b0de6cb2945b", "committedDate": "2020-03-10T00:35:45Z", "message": "Update ClientCalls.java"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcxNjI0NDg5", "url": "https://github.com/grpc/grpc-java/pull/6807#pullrequestreview-371624489", "createdAt": "2020-03-10T01:14:41Z", "commit": {"oid": "80fc740142cf2d7c148b5f7b9183b0de6cb2945b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMFQwMToxNDo0MVrOFz-Z8w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMFQwMToxNDo0MVrOFz-Z8w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDA0NDE0Nw==", "bodyText": "Mention that they will need one additional request(1) to match the new behavior. It might be worth putting that as a code snippet in the longer method javadoc.", "url": "https://github.com/grpc/grpc-java/pull/6807#discussion_r390044147", "createdAt": "2020-03-10T01:14:41Z", "author": {"login": "ejona86"}, "path": "stub/src/main/java/io/grpc/stub/CallStreamObserver.java", "diffHunk": "@@ -106,9 +106,33 @@\n    *   </li>\n    * </ul>\n    * </p>\n+   *\n+   * @deprecated Use {@link #disableAutoRequest} instead. This method will be removed.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "80fc740142cf2d7c148b5f7b9183b0de6cb2945b"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcyMjE5MDYx", "url": "https://github.com/grpc/grpc-java/pull/6807#pullrequestreview-372219061", "createdAt": "2020-03-10T18:32:58Z", "commit": {"oid": "80fc740142cf2d7c148b5f7b9183b0de6cb2945b"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMFQxODozMjo1OFrOF0b4iw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMFQxODozMjo1OFrOF0b4iw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDUyNzExNQ==", "bodyText": "typo: s/recieved/received/s", "url": "https://github.com/grpc/grpc-java/pull/6807#discussion_r390527115", "createdAt": "2020-03-10T18:32:58Z", "author": {"login": "voidzcy"}, "path": "stub/src/main/java/io/grpc/stub/CallStreamObserver.java", "diffHunk": "@@ -106,9 +106,33 @@\n    *   </li>\n    * </ul>\n    * </p>\n+   *\n+   * @deprecated Use {@link #disableAutoRequest} instead. This method will be removed.\n    */\n+  @Deprecated\n   public abstract void disableAutoInboundFlowControl();\n \n+  /**\n+   * Disables automatic flow control where initial tokens are requested when the call is started,\n+   * and a token is returned to the peer after a call to the 'inbound' {@link\n+   * io.grpc.stub.StreamObserver#onNext(Object)} has completed. If disabled an application must\n+   * make explicit calls to {@link #request} to receive any messages.\n+   *\n+   * <p>On client-side this method may only be called during {@link\n+   * ClientResponseObserver#beforeStart}. On server-side it may only be called during the initial\n+   * call to the application, before the service returns its {@code StreamObserver}.\n+   *\n+   * <p>Note that for server-side cases where the message is recieved before the handler is invoked,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "80fc740142cf2d7c148b5f7b9183b0de6cb2945b"}, "originalPosition": 20}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcyMjgxODYw", "url": "https://github.com/grpc/grpc-java/pull/6807#pullrequestreview-372281860", "createdAt": "2020-03-10T20:05:31Z", "commit": {"oid": "80fc740142cf2d7c148b5f7b9183b0de6cb2945b"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMFQyMDowNTozMVrOF0fCkA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMFQyMDowNTozMVrOF0fCkA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDU3ODgzMg==", "bodyText": "although it is previous doc's fault, token is unclear. can you add description about token that it is basically number of messages?\none contributor was asking this before in #6561", "url": "https://github.com/grpc/grpc-java/pull/6807#discussion_r390578832", "createdAt": "2020-03-10T20:05:31Z", "author": {"login": "creamsoup"}, "path": "stub/src/main/java/io/grpc/stub/CallStreamObserver.java", "diffHunk": "@@ -106,9 +106,33 @@\n    *   </li>\n    * </ul>\n    * </p>\n+   *\n+   * @deprecated Use {@link #disableAutoRequest} instead. This method will be removed.\n    */\n+  @Deprecated\n   public abstract void disableAutoInboundFlowControl();\n \n+  /**\n+   * Disables automatic flow control where initial tokens are requested when the call is started,\n+   * and a token is returned to the peer after a call to the 'inbound' {@link", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "80fc740142cf2d7c148b5f7b9183b0de6cb2945b"}, "originalPosition": 12}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c149edc24c0ea6a3b785348d8cc62699ac477509", "author": {"user": {"login": "DRayX", "name": null}}, "url": "https://github.com/grpc/grpc-java/commit/c149edc24c0ea6a3b785348d8cc62699ac477509", "committedDate": "2020-03-10T22:53:22Z", "message": "Update CallStreamObserver.java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "effb394975d225f989e7d76e6496e7a6648ad91e", "author": {"user": {"login": "DRayX", "name": null}}, "url": "https://github.com/grpc/grpc-java/commit/effb394975d225f989e7d76e6496e7a6648ad91e", "committedDate": "2020-03-10T23:08:50Z", "message": "Add a note about migrating from disableAutoInboundFlowControl to disableAutoRequest"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b88f02fa4db5cc5e92c7f0b30501249b4598e3e9", "author": {"user": {"login": "DRayX", "name": null}}, "url": "https://github.com/grpc/grpc-java/commit/b88f02fa4db5cc5e92c7f0b30501249b4598e3e9", "committedDate": "2020-03-10T23:12:47Z", "message": "Update CallStreamObserver.java\n\nNoted the difference between client and server migration"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4285b05b8b60fcec4cd50e46b7096e70011bacf9", "author": {"user": {"login": "DRayX", "name": null}}, "url": "https://github.com/grpc/grpc-java/commit/4285b05b8b60fcec4cd50e46b7096e70011bacf9", "committedDate": "2020-03-11T00:26:23Z", "message": "Update CallStreamObserver.java\n\nFix indentation"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg1MTQ0MjA5", "url": "https://github.com/grpc/grpc-java/pull/6807#pullrequestreview-385144209", "createdAt": "2020-03-31T22:17:28Z", "commit": {"oid": "4285b05b8b60fcec4cd50e46b7096e70011bacf9"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMVQyMjoxNzoyOVrOF-qP7w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMVQyMjoxNzoyOVrOF-qP7w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTI0ODIzOQ==", "bodyText": "This should probably check if the response is unary and if so do an extra request(1).\nThe point of the extra request is to detect the situation a server is sending multiple responses when it shouldn't. Without the additional request(1) the RPC will deadlock. This should be handled in ClientCallImpl, really, but I believe there are issues in that location with how to report the error when a problem is detected.", "url": "https://github.com/grpc/grpc-java/pull/6807#discussion_r401248239", "createdAt": "2020-03-31T22:17:29Z", "author": {"login": "ejona86"}, "path": "stub/src/main/java/io/grpc/stub/ClientCalls.java", "diffHunk": "@@ -372,13 +372,23 @@ public void setOnReadyHandler(Runnable onReadyHandler) {\n       this.onReadyHandler = onReadyHandler;\n     }\n \n+    @Deprecated\n     @Override\n     public void disableAutoInboundFlowControl() {\n       if (frozen) {\n         throw new IllegalStateException(\n             \"Cannot disable auto flow control after call started. Use ClientResponseObserver\");\n       }\n-      autoFlowControlEnabled = false;\n+      autoRequestMode = AutoRequestMode.INITIAL_ONLY;\n+    }\n+\n+    @Override\n+    public void disableAutoRequest() {\n+      if (frozen) {\n+        throw new IllegalStateException(\n+            \"Cannot disable auto flow control after call started. Use ClientResponseObserver\");\n+      }\n+      autoRequestMode = AutoRequestMode.DISABLED;\n     }\n \n     @Override", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4285b05b8b60fcec4cd50e46b7096e70011bacf9"}, "originalPosition": 116}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d2b25e625b47892d466706b1f09cdbb53109ba3d", "author": {"user": {"login": "DRayX", "name": null}}, "url": "https://github.com/grpc/grpc-java/commit/d2b25e625b47892d466706b1f09cdbb53109ba3d", "committedDate": "2020-04-04T00:54:22Z", "message": "Switch to disableAutoRequestWithInitial\n\nSwitch to a disableAutoRequestWithInitialMethod that allows for an initial number of requests to be specified.  Also, change the behavior of ClientCalls.CallToStreamObserverAdapter.request to request 2 if expecting unary respone."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "14ce757ac1e28341b352f9ecd643edb9c0720160", "author": {"user": {"login": "DRayX", "name": null}}, "url": "https://github.com/grpc/grpc-java/commit/14ce757ac1e28341b352f9ecd643edb9c0720160", "committedDate": "2020-04-04T01:01:09Z", "message": "Update ClientCalls.java\n\nFix accidental deletion"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b83f94f3d4bf739e680979bbc5d7c3c68afb3fcd", "author": {"user": {"login": "DRayX", "name": null}}, "url": "https://github.com/grpc/grpc-java/commit/b83f94f3d4bf739e680979bbc5d7c3c68afb3fcd", "committedDate": "2020-04-04T01:06:48Z", "message": "Update ClientCalls.java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1839faf7641833f83ea168b1be8a8edb96f29acb", "author": {"user": {"login": "DRayX", "name": null}}, "url": "https://github.com/grpc/grpc-java/commit/1839faf7641833f83ea168b1be8a8edb96f29acb", "committedDate": "2020-04-04T01:21:50Z", "message": "Fix more typos"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "14d2276a5ae9441df2d364cc6e64cb5115b7b8ff", "author": {"user": {"login": "DRayX", "name": null}}, "url": "https://github.com/grpc/grpc-java/commit/14d2276a5ae9441df2d364cc6e64cb5115b7b8ff", "committedDate": "2020-04-04T01:25:06Z", "message": "Update ServerCalls.java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "da1d10973257108f840fd82857fcb7361af7023c", "author": {"user": {"login": "ejona86", "name": "Eric Anderson"}}, "url": "https://github.com/grpc/grpc-java/commit/da1d10973257108f840fd82857fcb7361af7023c", "committedDate": "2020-05-04T17:19:08Z", "message": "fix bug causing hanging servers"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "371bb887651d3d521511ded6cbe50f619f9155e6", "author": {"user": {"login": "DRayX", "name": null}}, "url": "https://github.com/grpc/grpc-java/commit/371bb887651d3d521511ded6cbe50f619f9155e6", "committedDate": "2020-05-05T17:31:50Z", "message": "Remove `@Deprecated` from disableAutoInboundFlowControl"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "23d5b17c5964f2f25f2f286ab8ca97b11fbdd7b6", "author": {"user": {"login": "DRayX", "name": null}}, "url": "https://github.com/grpc/grpc-java/commit/23d5b17c5964f2f25f2f286ab8ca97b11fbdd7b6", "committedDate": "2020-05-05T18:07:27Z", "message": "Fix style"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4638, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}