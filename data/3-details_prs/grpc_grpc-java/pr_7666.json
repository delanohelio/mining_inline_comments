{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTI3MjM3Nzkw", "number": 7666, "title": "xds: fix the new server API for ServerXdsClient", "bodyText": "", "createdAt": "2020-11-25T07:20:38Z", "url": "https://github.com/grpc/grpc-java/pull/7666", "merged": true, "mergeCommit": {"oid": "3811ef3d22f90ae8da8200964d178cbd829ee9f8"}, "closed": true, "closedAt": "2020-11-26T00:52:10Z", "author": {"login": "sanjaypujare"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdf5FtpgH2gAyNTI3MjM3NzkwOmNkNmRjM2ExZmU3OTdhOTUzYjJmNGNhYzNlYmFmZjcxZTExZjM4NDU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdgHVzrAFqTUzODkxMDAzNg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "cd6dc3a1fe797a953b2f4cac3ebaff71e11f3845", "author": {"user": {"login": "sanjaypujare", "name": null}}, "url": "https://github.com/grpc/grpc-java/commit/cd6dc3a1fe797a953b2f4cac3ebaff71e11f3845", "committedDate": "2020-11-25T07:19:43Z", "message": "xds: fix the new server API for ServerXdsClient"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM4ODYyNjM0", "url": "https://github.com/grpc/grpc-java/pull/7666#pullrequestreview-538862634", "createdAt": "2020-11-25T21:42:13Z", "commit": {"oid": "cd6dc3a1fe797a953b2f4cac3ebaff71e11f3845"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNVQyMTo0MjoxNFrOH6Es-A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNVQyMTo0MjoxNFrOH6Es-A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDY1NjUwNA==", "bodyText": "This becomes really messy. You could have fixed the resource name in the constructor instead of keeping recomputing it. That's much much cleaner.", "url": "https://github.com/grpc/grpc-java/pull/7666#discussion_r530656504", "createdAt": "2020-11-25T21:42:14Z", "author": {"login": "voidzcy"}, "path": "xds/src/main/java/io/grpc/xds/ServerXdsClient.java", "diffHunk": "@@ -101,15 +101,21 @@ public void run() {\n   @Override\n   Collection<String> getSubscribedResources(ResourceType type) {\n     if (newServerApi) {\n-      String listeningAddress = instanceIp + \":\" + listenerPort;\n-      String resourceName =\n-          grpcServerResourceId + \"?udpa.resource.listening_address=\" + listeningAddress;\n-      return ImmutableList.<String>of(resourceName);\n+      return ImmutableList.<String>of(getResourceNameForListener());\n     } else {\n       return Collections.emptyList();\n     }\n   }\n \n+  private String getResourceNameForListener() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cd6dc3a1fe797a953b2f4cac3ebaff71e11f3845"}, "originalPosition": 23}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c4c75eeb79c7aa24f018889fd9cb431c97e7f289", "author": {"user": {"login": "sanjaypujare", "name": null}}, "url": "https://github.com/grpc/grpc-java/commit/c4c75eeb79c7aa24f018889fd9cb431c97e7f289", "committedDate": "2020-11-25T23:28:56Z", "message": "address review comments"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM4OTEwMDM2", "url": "https://github.com/grpc/grpc-java/pull/7666#pullrequestreview-538910036", "createdAt": "2020-11-25T23:52:37Z", "commit": {"oid": "c4c75eeb79c7aa24f018889fd9cb431c97e7f289"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNVQyMzo1MjozN1rOH6HQNQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNVQyMzo1MjozN1rOH6HQNQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDY5ODI5Mw==", "bodyText": "Not related too this PR, but some comment on the code:\nThis is really an abused usage of Comparator. All you need is just a static helper method returning true if two filter chains are equivalent. Comparator is for implementing objects total ordering, the overridden compare method makes zero sense for ordering a collection of FilterChain objects.", "url": "https://github.com/grpc/grpc-java/pull/7666#discussion_r530698293", "createdAt": "2020-11-25T23:52:37Z", "author": {"login": "voidzcy"}, "path": "xds/src/main/java/io/grpc/xds/XdsClientWrapperForServerSds.java", "diffHunk": "@@ -180,7 +182,8 @@ private DownstreamTlsContext getDownstreamTlsContext(InetSocketAddress localInet\n       FilterChainComparator comparator = new FilterChainComparator(localInetAddr);\n       FilterChain bestMatch =\n           filterChains.isEmpty() ? null : Collections.max(filterChains, comparator);\n-      if (bestMatch != null && comparator.isMatching(bestMatch.getFilterChainMatch())) {\n+      if (bestMatch != null\n+          && (newServerApi || comparator.isMatching(bestMatch.getFilterChainMatch()))) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c4c75eeb79c7aa24f018889fd9cb431c97e7f289"}, "originalPosition": 22}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4719, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}