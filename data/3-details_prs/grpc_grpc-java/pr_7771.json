{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTQ2OTc2MDk3", "number": 7771, "title": "Log expected STREAM_CLOSED exceptions for already closed streams at FINE level", "bodyText": "See this PR in netty: netty/netty#9798 . It's possible that one peer has closed the stream, yet another frame from peers arrives after it. This is largely harmless, as explained in the PR from netty repository. If we don't do this, the log will be polluted with these harmless logs.", "createdAt": "2020-12-30T14:56:21Z", "url": "https://github.com/grpc/grpc-java/pull/7771", "merged": true, "mergeCommit": {"oid": "563288f0ada5a44015b026f2d00e6bcd20b48262"}, "closed": true, "closedAt": "2021-02-02T20:21:56Z", "author": {"login": "lriuui0x0"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdrQfylgH2gAyNTQ2OTc2MDk3OmJiNzM5YWMwZDYzZWFmY2NmODcyZTAzYjA1NGRiNTkwYzQ5M2IwZTU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABd2QdeIgFqTU4MTY3NDkxMQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "bb739ac0d63eafccf872e03b054db590c493b0e5", "author": {"user": {"login": "lriuui0x0", "name": "Rui Liu"}}, "url": "https://github.com/grpc/grpc-java/commit/bb739ac0d63eafccf872e03b054db590c493b0e5", "committedDate": "2020-12-30T14:49:11Z", "message": "change logging level to finer"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTY1NTczNTI2", "url": "https://github.com/grpc/grpc-java/pull/7771#pullrequestreview-565573526", "createdAt": "2021-01-11T17:18:42Z", "commit": {"oid": "bb739ac0d63eafccf872e03b054db590c493b0e5"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xMVQxNzoxODo0MlrOIRfaIA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xMVQxNzoxODo0MlrOIRfaIA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NTIxMTI5Ng==", "bodyText": "Do we need a null check for http2Ex or are you sure it will never be null in this context?", "url": "https://github.com/grpc/grpc-java/pull/7771#discussion_r555211296", "createdAt": "2021-01-11T17:18:42Z", "author": {"login": "sanjaypujare"}, "path": "netty/src/main/java/io/grpc/netty/NettyServerHandler.java", "diffHunk": "@@ -532,7 +532,8 @@ protected void onConnectionError(ChannelHandlerContext ctx, boolean outbound, Th\n   @Override\n   protected void onStreamError(ChannelHandlerContext ctx, boolean outbound, Throwable cause,\n       StreamException http2Ex) {\n-    logger.log(Level.WARNING, \"Stream Error\", cause);\n+    Level level = http2Ex.error() == Http2Error.STREAM_CLOSED ? Level.FINE : Level.WARNING;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bb739ac0d63eafccf872e03b054db590c493b0e5"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTY1NjcxMzU2", "url": "https://github.com/grpc/grpc-java/pull/7771#pullrequestreview-565671356", "createdAt": "2021-01-11T19:29:08Z", "commit": {"oid": "bb739ac0d63eafccf872e03b054db590c493b0e5"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xMVQxOToyOTowOFrOIRkBcw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xMVQxOToyOTowOFrOIRkBcw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NTI4Njg5OQ==", "bodyText": "It shouldn't be null. Netty doesn't guarantee that all that well, but Netty itself assumes it is non-null and there's no reason for it to be null.", "url": "https://github.com/grpc/grpc-java/pull/7771#discussion_r555286899", "createdAt": "2021-01-11T19:29:08Z", "author": {"login": "ejona86"}, "path": "netty/src/main/java/io/grpc/netty/NettyServerHandler.java", "diffHunk": "@@ -532,7 +532,8 @@ protected void onConnectionError(ChannelHandlerContext ctx, boolean outbound, Th\n   @Override\n   protected void onStreamError(ChannelHandlerContext ctx, boolean outbound, Throwable cause,\n       StreamException http2Ex) {\n-    logger.log(Level.WARNING, \"Stream Error\", cause);\n+    Level level = http2Ex.error() == Http2Error.STREAM_CLOSED ? Level.FINE : Level.WARNING;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NTIxMTI5Ng=="}, "originalCommit": {"oid": "bb739ac0d63eafccf872e03b054db590c493b0e5"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTc4Nzc0Njg1", "url": "https://github.com/grpc/grpc-java/pull/7771#pullrequestreview-578774685", "createdAt": "2021-01-28T21:56:42Z", "commit": {"oid": "bb739ac0d63eafccf872e03b054db590c493b0e5"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0yOFQyMTo1Njo0MlrOIcMZkA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0yOFQyMTo1Njo0MlrOIcMZkA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NjQzNDE5Mg==", "bodyText": "Let's use FINE only if serverStream == null as well. Really, connection().stream(Http2Exception.streamId(http2Ex)) == null is the more precise check, but serverStream == null is pretty close and is easy, and I don't think will mislead readers.", "url": "https://github.com/grpc/grpc-java/pull/7771#discussion_r566434192", "createdAt": "2021-01-28T21:56:42Z", "author": {"login": "ejona86"}, "path": "netty/src/main/java/io/grpc/netty/NettyServerHandler.java", "diffHunk": "@@ -532,7 +532,8 @@ protected void onConnectionError(ChannelHandlerContext ctx, boolean outbound, Th\n   @Override\n   protected void onStreamError(ChannelHandlerContext ctx, boolean outbound, Throwable cause,\n       StreamException http2Ex) {\n-    logger.log(Level.WARNING, \"Stream Error\", cause);\n+    Level level = http2Ex.error() == Http2Error.STREAM_CLOSED ? Level.FINE : Level.WARNING;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bb739ac0d63eafccf872e03b054db590c493b0e5"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c22a9ddeadf19c116c2eb6798eba62add94ebf3e", "author": {"user": {"login": "lriuui0x0", "name": "Rui Liu"}}, "url": "https://github.com/grpc/grpc-java/commit/c22a9ddeadf19c116c2eb6798eba62add94ebf3e", "committedDate": "2021-02-01T16:30:32Z", "message": "add more check"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTgwNjYwMDQz", "url": "https://github.com/grpc/grpc-java/pull/7771#pullrequestreview-580660043", "createdAt": "2021-02-01T18:47:33Z", "commit": {"oid": "c22a9ddeadf19c116c2eb6798eba62add94ebf3e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMi0wMVQxODo0NzozM1rOIdvhNA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMi0wMVQxODo0NzozM1rOIdvhNA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2ODA1ODE2NA==", "bodyText": "This won't build. serverStream is defined on the next line. The lines will need to be swapped.", "url": "https://github.com/grpc/grpc-java/pull/7771#discussion_r568058164", "createdAt": "2021-02-01T18:47:33Z", "author": {"login": "ejona86"}, "path": "netty/src/main/java/io/grpc/netty/NettyServerHandler.java", "diffHunk": "@@ -532,7 +532,11 @@ protected void onConnectionError(ChannelHandlerContext ctx, boolean outbound, Th\n   @Override\n   protected void onStreamError(ChannelHandlerContext ctx, boolean outbound, Throwable cause,\n       StreamException http2Ex) {\n-    logger.log(Level.WARNING, \"Stream Error\", cause);\n+    Level level = Level.WARNING;\n+    if (serverStream == null && http2Ex.error() == Http2Error.STREAM_CLOSED) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c22a9ddeadf19c116c2eb6798eba62add94ebf3e"}, "originalPosition": 6}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8d7eb094e4cf8a18229eb92a4da153d48c890b3f", "author": {"user": {"login": "lriuui0x0", "name": "Rui Liu"}}, "url": "https://github.com/grpc/grpc-java/commit/8d7eb094e4cf8a18229eb92a4da153d48c890b3f", "committedDate": "2021-02-02T16:26:52Z", "message": "fix"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTgxNjM5NTYw", "url": "https://github.com/grpc/grpc-java/pull/7771#pullrequestreview-581639560", "createdAt": "2021-02-02T18:17:18Z", "commit": {"oid": "8d7eb094e4cf8a18229eb92a4da153d48c890b3f"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTgxNjc0OTEx", "url": "https://github.com/grpc/grpc-java/pull/7771#pullrequestreview-581674911", "createdAt": "2021-02-02T18:59:49Z", "commit": {"oid": "8d7eb094e4cf8a18229eb92a4da153d48c890b3f"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4714, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}