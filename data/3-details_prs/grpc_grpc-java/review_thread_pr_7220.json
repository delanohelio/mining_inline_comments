{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDUwMzY5MDk3", "number": 7220, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xN1QxNzo1NTo1N1rOEPoAew==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xN1QxNzo1NTo1N1rOEPoAew==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg0ODE5NTc5OnYy", "diffSide": "RIGHT", "path": "xds/src/main/java/io/grpc/xds/internal/certprovider/CertificateProvider.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xN1QxNzo1NTo1N1rOGzcGeg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xN1QxODo0MzowM1rOGzdfbA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjU5MDk3MA==", "bodyText": "Maybe move the null checks to the public API updateCertificate(PrivateKey key, List<X509Certificate> certChain).", "url": "https://github.com/grpc/grpc-java/pull/7220#discussion_r456590970", "createdAt": "2020-07-17T17:55:57Z", "author": {"login": "dapengzhang0"}, "path": "xds/src/main/java/io/grpc/xds/internal/certprovider/CertificateProvider.java", "diffHunk": "@@ -47,33 +49,57 @@\n \n   @VisibleForTesting\n   static final class DistributorWatcher implements Watcher {\n+    private PrivateKey lastKey;\n+    private List<X509Certificate> lastCertChain;\n+    private List<X509Certificate> lastTrustedRoots;\n+\n     @VisibleForTesting\n     final Set<Watcher> downsstreamWatchers = new HashSet<>();\n \n     synchronized void addWatcher(Watcher watcher) {\n       downsstreamWatchers.add(watcher);\n+      if (lastKey != null && lastCertChain != null) {\n+        sendLastCertificateUpdate(watcher);\n+      }\n+      if (lastTrustedRoots != null) {\n+        sendLastTrustedRootsUpdate(watcher);\n+      }\n     }\n \n     synchronized void removeWatcher(Watcher watcher) {\n       downsstreamWatchers.remove(watcher);\n     }\n \n+    private void sendLastCertificateUpdate(Watcher watcher) {\n+      checkNotNull(lastKey, \"lastKey\");\n+      checkNotNull(lastCertChain, \"lastCertChain\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3b8ad78781a57d364ac1cb06bcd6a54152fa525b"}, "originalPosition": 36}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjYxMzc0MA==", "bodyText": "done", "url": "https://github.com/grpc/grpc-java/pull/7220#discussion_r456613740", "createdAt": "2020-07-17T18:43:03Z", "author": {"login": "sanjaypujare"}, "path": "xds/src/main/java/io/grpc/xds/internal/certprovider/CertificateProvider.java", "diffHunk": "@@ -47,33 +49,57 @@\n \n   @VisibleForTesting\n   static final class DistributorWatcher implements Watcher {\n+    private PrivateKey lastKey;\n+    private List<X509Certificate> lastCertChain;\n+    private List<X509Certificate> lastTrustedRoots;\n+\n     @VisibleForTesting\n     final Set<Watcher> downsstreamWatchers = new HashSet<>();\n \n     synchronized void addWatcher(Watcher watcher) {\n       downsstreamWatchers.add(watcher);\n+      if (lastKey != null && lastCertChain != null) {\n+        sendLastCertificateUpdate(watcher);\n+      }\n+      if (lastTrustedRoots != null) {\n+        sendLastTrustedRootsUpdate(watcher);\n+      }\n     }\n \n     synchronized void removeWatcher(Watcher watcher) {\n       downsstreamWatchers.remove(watcher);\n     }\n \n+    private void sendLastCertificateUpdate(Watcher watcher) {\n+      checkNotNull(lastKey, \"lastKey\");\n+      checkNotNull(lastCertChain, \"lastCertChain\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjU5MDk3MA=="}, "originalCommit": {"oid": "3b8ad78781a57d364ac1cb06bcd6a54152fa525b"}, "originalPosition": 36}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2613, "cost": 1, "resetAt": "2021-11-12T20:28:25Z"}}}