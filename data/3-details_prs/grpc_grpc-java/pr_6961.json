{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA2OTY2NDA3", "number": 6961, "title": "xds: reject case-insensitive route match", "bodyText": "", "createdAt": "2020-04-21T23:54:28Z", "url": "https://github.com/grpc/grpc-java/pull/6961", "merged": true, "mergeCommit": {"oid": "88bd7278ae8d9ad1f22258f1394202d7a41db112"}, "closed": true, "closedAt": "2020-04-23T00:10:30Z", "author": {"login": "dapengzhang0"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcZ8o6lgH2gAyNDA2OTY2NDA3OmFjMTQxMmI4YmRiMDQ0ZmEzMjAxNjgzYWRmNGNhMjRlYjVmNjhiNGY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcaPd_lgFqTM5ODYxNTA5Mw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "ac1412b8bdb044fa3201683adf4ca24eb5f68b4f", "author": {"user": {"login": "dapengzhang0", "name": "ZHANG Dapeng"}}, "url": "https://github.com/grpc/grpc-java/commit/ac1412b8bdb044fa3201683adf4ca24eb5f68b4f", "committedDate": "2020-04-21T23:53:11Z", "message": "xds: reject case-insensitive route match"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1fed9ca359da0033ac2f7c32671779f8d01dfa36", "author": {"user": {"login": "dapengzhang0", "name": "ZHANG Dapeng"}}, "url": "https://github.com/grpc/grpc-java/commit/1fed9ca359da0033ac2f7c32671779f8d01dfa36", "committedDate": "2020-04-22T01:45:24Z", "message": "unit test for data"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d5a473dc02500fcc9275df1dcc17164f40b48da6", "author": {"user": {"login": "dapengzhang0", "name": "ZHANG Dapeng"}}, "url": "https://github.com/grpc/grpc-java/commit/d5a473dc02500fcc9275df1dcc17164f40b48da6", "committedDate": "2020-04-22T01:41:58Z", "message": "s/an Nack/a Nack/"}, "afterCommit": {"oid": "1fed9ca359da0033ac2f7c32671779f8d01dfa36", "author": {"user": {"login": "dapengzhang0", "name": "ZHANG Dapeng"}}, "url": "https://github.com/grpc/grpc-java/commit/1fed9ca359da0033ac2f7c32671779f8d01dfa36", "committedDate": "2020-04-22T01:45:24Z", "message": "unit test for data"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk4NDMwMzEz", "url": "https://github.com/grpc/grpc-java/pull/6961#pullrequestreview-398430313", "createdAt": "2020-04-22T17:45:03Z", "commit": {"oid": "1fed9ca359da0033ac2f7c32671779f8d01dfa36"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMlQxNzo0NTowNFrOGKDAEw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMlQxNzo0NTowNFrOGKDAEw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzE4ODExNQ==", "bodyText": "I found that using addDomains(\"foo.googleapis.com\") actually it will fail/nack with a different reason: \"No routes found\". I think that's not what the test intended to test, it should fail/nack with \"Route action is not specified for the default route\", so I changed to addDomains(TARGET_AUTHORITY), namely \"foo.googleapis.com:8080\" instead.", "url": "https://github.com/grpc/grpc-java/pull/6961#discussion_r413188115", "createdAt": "2020-04-22T17:45:04Z", "author": {"login": "dapengzhang0"}, "path": "xds/src/test/java/io/grpc/xds/XdsClientImplTest.java", "diffHunk": "@@ -863,7 +889,7 @@ public void matchingVirtualHostDoesNotContainRouteAction() {\n     VirtualHost virtualHost =\n         VirtualHost.newBuilder()\n             .setName(\"virtualhost00.googleapis.com\")  // don't care\n-            .addDomains(\"foo.googleapis.com\")\n+            .addDomains(TARGET_AUTHORITY)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1fed9ca359da0033ac2f7c32671779f8d01dfa36"}, "originalPosition": 103}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk4NDI3MTYw", "url": "https://github.com/grpc/grpc-java/pull/6961#pullrequestreview-398427160", "createdAt": "2020-04-22T17:41:03Z", "commit": {"oid": "1fed9ca359da0033ac2f7c32671779f8d01dfa36"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMlQxNzo0MTowM1rOGKC0zQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMlQxNzo0ODoxNlrOGKDJfA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzE4NTIyOQ==", "bodyText": "Data validation should be done against the originally received proto messages at first place instead of against converted data. Conversion should not happen if the original proto message contains invalid data.", "url": "https://github.com/grpc/grpc-java/pull/6961#discussion_r413185229", "createdAt": "2020-04-22T17:41:03Z", "author": {"login": "voidzcy"}, "path": "xds/src/main/java/io/grpc/xds/XdsClientImpl.java", "diffHunk": "@@ -919,6 +919,9 @@ private static String validateRoutes(List<EnvoyProtoData.Route> routes) {\n       if (!routeMatch.isDefaultMatcher()) {\n         return \"The last route must be the default route\";\n       }\n+      if (!routeMatch.isCaseSensitive()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1fed9ca359da0033ac2f7c32671779f8d01dfa36"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzE5MDUyNA==", "bodyText": "I would not add error_detail to the matcher and make it nullable is even worse. If you require checking error_detail for the message, you should check its value for all NACKs, not just test cases you just added. Why some test cases require checking error_detail in NACKs while others do not?  I would not verify error messages literally to make unit test fragile, unless the message is required to literally match some specific string.", "url": "https://github.com/grpc/grpc-java/pull/6961#discussion_r413190524", "createdAt": "2020-04-22T17:48:16Z", "author": {"login": "voidzcy"}, "path": "xds/src/test/java/io/grpc/xds/XdsClientImplTest.java", "diffHunk": "@@ -3741,10 +3845,17 @@ private DiscoveryRequestMatcher(String versionInfo, String resourceName, String\n \n     private DiscoveryRequestMatcher(String versionInfo, List<String> resourceNames, String typeUrl,\n         String responseNonce) {\n+      this(versionInfo, resourceNames, typeUrl, responseNonce, null);\n+    }\n+\n+    private DiscoveryRequestMatcher(\n+        String versionInfo, List<String> resourceNames, String typeUrl, String responseNonce,\n+        @Nullable String nackErrorDetail) {\n       this.versionInfo = versionInfo;\n       this.resourceNames = new HashSet<>(resourceNames);\n       this.typeUrl = typeUrl;\n       this.responseNonce = responseNonce;\n+      this.nackErrorDetail = nackErrorDetail;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1fed9ca359da0033ac2f7c32671779f8d01dfa36"}, "originalPosition": 217}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "075c89aa0be0d77654ba77684f38dd1cd7067c5c", "author": {"user": {"login": "dapengzhang0", "name": "ZHANG Dapeng"}}, "url": "https://github.com/grpc/grpc-java/commit/075c89aa0be0d77654ba77684f38dd1cd7067c5c", "committedDate": "2020-04-22T21:22:31Z", "message": "not to compare error details in test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4dd0a0310158b39f58f7786839af22748a691fde", "author": {"user": {"login": "dapengzhang0", "name": "ZHANG Dapeng"}}, "url": "https://github.com/grpc/grpc-java/commit/4dd0a0310158b39f58f7786839af22748a691fde", "committedDate": "2020-04-22T21:28:33Z", "message": "change test name"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk4NjE1MDkz", "url": "https://github.com/grpc/grpc-java/pull/6961#pullrequestreview-398615093", "createdAt": "2020-04-22T21:49:28Z", "commit": {"oid": "4dd0a0310158b39f58f7786839af22748a691fde"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4560, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}