{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDU4MTE2NDY4", "number": 7260, "title": "xds: include a status for the result of ConfigSelector", "bodyText": "This is needed for cases like the ConfigSelector fails to find a route/cluster for the RPC.", "createdAt": "2020-07-28T23:53:18Z", "url": "https://github.com/grpc/grpc-java/pull/7260", "merged": true, "mergeCommit": {"oid": "1ed24feecde019f8a8057baa0e3342ae429506a7"}, "closed": true, "closedAt": "2020-07-30T22:21:39Z", "author": {"login": "voidzcy"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc5fp3WgH2gAyNDU4MTE2NDY4OjUyNDM3MWIyZTkzN2U1MWYzYmFiNTdjNmVmNjE0MzM4ODc2NTYyMjM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc5zUNiAFqTQ1Nzk1NzkyMA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "524371b2e937e51f3bab57c6ef61433887656223", "author": {"user": {"login": "voidzcy", "name": "Chengyuan Zhang"}}, "url": "https://github.com/grpc/grpc-java/commit/524371b2e937e51f3bab57c6ef61433887656223", "committedDate": "2020-07-29T00:12:33Z", "message": "Include a Status in the result of selectConfig."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ab3a9d417e92f99690d9f103eb6c9cd83b7fca5b", "author": {"user": {"login": "voidzcy", "name": "Chengyuan Zhang"}}, "url": "https://github.com/grpc/grpc-java/commit/ab3a9d417e92f99690d9f103eb6c9cd83b7fca5b", "committedDate": "2020-07-28T23:51:48Z", "message": "Include a Status in the result of selectConfig."}, "afterCommit": {"oid": "524371b2e937e51f3bab57c6ef61433887656223", "author": {"user": {"login": "voidzcy", "name": "Chengyuan Zhang"}}, "url": "https://github.com/grpc/grpc-java/commit/524371b2e937e51f3bab57c6ef61433887656223", "committedDate": "2020-07-29T00:12:33Z", "message": "Include a Status in the result of selectConfig."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU3ODQzNjI1", "url": "https://github.com/grpc/grpc-java/pull/7260#pullrequestreview-457843625", "createdAt": "2020-07-29T19:56:58Z", "commit": {"oid": "524371b2e937e51f3bab57c6ef61433887656223"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOVQxOTo1Njo1OFrOG5H4TA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOVQxOTo1OToyMVrOG5H9HQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjU1MTExNg==", "bodyText": "nit: Creates", "url": "https://github.com/grpc/grpc-java/pull/7260#discussion_r462551116", "createdAt": "2020-07-29T19:56:58Z", "author": {"login": "dapengzhang0"}, "path": "api/src/main/java/io/grpc/InternalConfigSelector.java", "diffHunk": "@@ -37,28 +38,51 @@\n   public abstract Result selectConfig(LoadBalancer.PickSubchannelArgs args);\n \n   public static final class Result {\n+    private final Status status;\n+    @Nullable\n     private final Object config;\n+    @Nullable\n     private final CallOptions callOptions;\n     @Nullable\n     private final Runnable committedCallback;\n \n-    private Result(Object config, CallOptions callOptions, @Nullable Runnable committedCallback) {\n-      this.config = checkNotNull(config, \"config\");\n-      this.callOptions = checkNotNull(callOptions, \"callOptions\");\n+    private Result(\n+        Status status, Object config, CallOptions callOptions, Runnable committedCallback) {\n+      this.status = checkNotNull(status, \"status\");\n+      this.config = config;\n+      this.callOptions = callOptions;\n       this.committedCallback = committedCallback;\n     }\n \n+    /**\n+     * Create a {@code Result} with the given error status.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "524371b2e937e51f3bab57c6ef61433887656223"}, "originalPosition": 32}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjU1MjM0OQ==", "bodyText": "config and callOptions here must not be null", "url": "https://github.com/grpc/grpc-java/pull/7260#discussion_r462552349", "createdAt": "2020-07-29T19:59:21Z", "author": {"login": "dapengzhang0"}, "path": "api/src/main/java/io/grpc/InternalConfigSelector.java", "diffHunk": "@@ -113,7 +137,7 @@ public Builder setCommittedCallback(@Nullable Runnable committedCallback) {\n       }\n \n       public Result build() {\n-        return new Result(config, callOptions, committedCallback);\n+        return new Result(Status.OK, config, callOptions, committedCallback);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "524371b2e937e51f3bab57c6ef61433887656223"}, "originalPosition": 68}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d542932b8a7c9cefb431119ce4a898e25f26c59e", "author": {"user": {"login": "voidzcy", "name": "Chengyuan Zhang"}}, "url": "https://github.com/grpc/grpc-java/commit/d542932b8a7c9cefb431119ce4a898e25f26c59e", "committedDate": "2020-07-29T20:45:41Z", "message": "Fix comments typo."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "532ac5a58c85c426c9ee59388bbbeb3d14ab0f8f", "author": {"user": {"login": "voidzcy", "name": "Chengyuan Zhang"}}, "url": "https://github.com/grpc/grpc-java/commit/532ac5a58c85c426c9ee59388bbbeb3d14ab0f8f", "committedDate": "2020-07-29T21:27:06Z", "message": "Check nullity for config and callOptions."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU3OTM1MjE4", "url": "https://github.com/grpc/grpc-java/pull/7260#pullrequestreview-457935218", "createdAt": "2020-07-29T22:13:45Z", "commit": {"oid": "532ac5a58c85c426c9ee59388bbbeb3d14ab0f8f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOVQyMjoxMzo0NVrOG5MHOA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOVQyMjoxMzo0NVrOG5MHOA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjYyMDQ3Mg==", "bodyText": "@Nullable is misleading. Although it is nullable from the programing language point of view. The null case is when status is an error you call getConfig(), which is wrong usecase. The only true @Nullable is getCommittedCallback().", "url": "https://github.com/grpc/grpc-java/pull/7260#discussion_r462620472", "createdAt": "2020-07-29T22:13:45Z", "author": {"login": "dapengzhang0"}, "path": "api/src/main/java/io/grpc/InternalConfigSelector.java", "diffHunk": "@@ -37,28 +39,51 @@\n   public abstract Result selectConfig(LoadBalancer.PickSubchannelArgs args);\n \n   public static final class Result {\n+    private final Status status;\n+    @Nullable\n     private final Object config;\n+    @Nullable\n     private final CallOptions callOptions;\n     @Nullable\n     private final Runnable committedCallback;\n \n-    private Result(Object config, CallOptions callOptions, @Nullable Runnable committedCallback) {\n-      this.config = checkNotNull(config, \"config\");\n-      this.callOptions = checkNotNull(callOptions, \"callOptions\");\n+    private Result(\n+        Status status, Object config, CallOptions callOptions, Runnable committedCallback) {\n+      this.status = checkNotNull(status, \"status\");\n+      this.config = config;\n+      this.callOptions = callOptions;\n       this.committedCallback = committedCallback;\n     }\n \n+    /**\n+     * Creates a {@code Result} with the given error status.\n+     */\n+    public static Result forError(Status status) {\n+      checkArgument(!status.isOk(), \"status is OK\");\n+      return new Result(status, null, null, null);\n+    }\n+\n+    /**\n+     * Returns the status of the config selection operation. If status is not {@link Status#OK},\n+     * this result should not be used.\n+     */\n+    public Status getStatus() {\n+      return status;\n+    }\n+\n     /**\n      * Returns a parsed config. Must have been returned via\n      * ServiceConfigParser.parseServiceConfig().getConfig()\n      */\n+    @Nullable\n     public Object getConfig() {\n       return config;\n     }\n \n     /**\n      * Returns a config-selector-modified CallOptions for the RPC.\n      */\n+    @Nullable", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "532ac5a58c85c426c9ee59388bbbeb3d14ab0f8f"}, "originalPosition": 61}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a1b7132df3da77e21fd786f6a4385b4a3dac9284", "author": {"user": {"login": "voidzcy", "name": "Chengyuan Zhang"}}, "url": "https://github.com/grpc/grpc-java/commit/a1b7132df3da77e21fd786f6a4385b4a3dac9284", "committedDate": "2020-07-29T22:36:29Z", "message": "Add API javadoc."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU3OTU3OTIw", "url": "https://github.com/grpc/grpc-java/pull/7260#pullrequestreview-457957920", "createdAt": "2020-07-29T23:06:55Z", "commit": {"oid": "a1b7132df3da77e21fd786f6a4385b4a3dac9284"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOVQyMzowNjo1NVrOG5NUOw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOVQyMzowNjo1NVrOG5NUOw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjY0MDE4Nw==", "bodyText": "It's not mentioning \"with OK status, callOptions is not null.\" I'm not going to be nagging on about this. LGTM.", "url": "https://github.com/grpc/grpc-java/pull/7260#discussion_r462640187", "createdAt": "2020-07-29T23:06:55Z", "author": {"login": "dapengzhang0"}, "path": "api/src/main/java/io/grpc/InternalConfigSelector.java", "diffHunk": "@@ -113,7 +137,7 @@ public Builder setCommittedCallback(@Nullable Runnable committedCallback) {\n       }\n \n       public Result build() {\n-        return new Result(config, callOptions, committedCallback);\n+        return new Result(Status.OK, config, callOptions, committedCallback);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjU1MjM0OQ=="}, "originalCommit": {"oid": "524371b2e937e51f3bab57c6ef61433887656223"}, "originalPosition": 68}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4116, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}