{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDg5NTcwMzIx", "number": 7441, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xOFQyMzo1Nzo1M1rOElJdFw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xOFQyMzo1Nzo1M1rOElJdFw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA3Mzg3NjcxOnYy", "diffSide": "RIGHT", "path": "xds/src/main/java/io/grpc/xds/XdsClientImpl.java", "isResolved": true, "comments": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xOFQyMzo1Nzo1M1rOHUe3uA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xOVQwMTozMzo0NFrOHUfqjw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTIzOTM1Mg==", "bodyText": "Why change the logging message?", "url": "https://github.com/grpc/grpc-java/pull/7441#discussion_r491239352", "createdAt": "2020-09-18T23:57:53Z", "author": {"login": "dapengzhang0"}, "path": "xds/src/main/java/io/grpc/xds/XdsClientImpl.java", "diffHunk": "@@ -1737,27 +1723,40 @@ void start() {\n       StreamObserver<io.envoyproxy.envoy.api.v2.DiscoveryResponse> responseReaderV2 =\n           new StreamObserver<io.envoyproxy.envoy.api.v2.DiscoveryResponse>() {\n             @Override\n-            public void onNext(io.envoyproxy.envoy.api.v2.DiscoveryResponse response) {\n-              DiscoveryResponseData responseData =\n-                  DiscoveryResponseData.fromEnvoyProtoV2(response);\n-              if (logger.isLoggable(XdsLogLevel.DEBUG)) {\n-                logger.log(\n-                    XdsLogLevel.DEBUG,\n-                    \"Received {0} response:\\n{1}\",\n-                    responseData.getResourceType(),\n-                    respPrinter.print(response));\n-              }\n-              onDiscoveryResponse(responseData);\n+            public void onNext(final io.envoyproxy.envoy.api.v2.DiscoveryResponse response) {\n+              syncContext.execute(new Runnable() {\n+                @Override\n+                public void run() {\n+                  if (logger.isLoggable(XdsLogLevel.DEBUG)) {\n+                    logger.log(\n+                        XdsLogLevel.DEBUG,\n+                        \"Received DiscoveryResponse:\\n{0}\", respPrinter.print(response));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b2d4c907de27afb6160fad037334253fc1be4563"}, "originalPosition": 135}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTI0MDYwNw==", "bodyText": "Well, it's a small cosmetic change. Two reasons:\n\nMake this logging the first operation to be run in the handler, without needing information from parsed data. This seems a bit more elegant?\nJust log out the implementation types for DEBUG logs, indicating the content being logged is the actual code.", "url": "https://github.com/grpc/grpc-java/pull/7441#discussion_r491240607", "createdAt": "2020-09-19T00:06:09Z", "author": {"login": "voidzcy"}, "path": "xds/src/main/java/io/grpc/xds/XdsClientImpl.java", "diffHunk": "@@ -1737,27 +1723,40 @@ void start() {\n       StreamObserver<io.envoyproxy.envoy.api.v2.DiscoveryResponse> responseReaderV2 =\n           new StreamObserver<io.envoyproxy.envoy.api.v2.DiscoveryResponse>() {\n             @Override\n-            public void onNext(io.envoyproxy.envoy.api.v2.DiscoveryResponse response) {\n-              DiscoveryResponseData responseData =\n-                  DiscoveryResponseData.fromEnvoyProtoV2(response);\n-              if (logger.isLoggable(XdsLogLevel.DEBUG)) {\n-                logger.log(\n-                    XdsLogLevel.DEBUG,\n-                    \"Received {0} response:\\n{1}\",\n-                    responseData.getResourceType(),\n-                    respPrinter.print(response));\n-              }\n-              onDiscoveryResponse(responseData);\n+            public void onNext(final io.envoyproxy.envoy.api.v2.DiscoveryResponse response) {\n+              syncContext.execute(new Runnable() {\n+                @Override\n+                public void run() {\n+                  if (logger.isLoggable(XdsLogLevel.DEBUG)) {\n+                    logger.log(\n+                        XdsLogLevel.DEBUG,\n+                        \"Received DiscoveryResponse:\\n{0}\", respPrinter.print(response));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTIzOTM1Mg=="}, "originalCommit": {"oid": "b2d4c907de27afb6160fad037334253fc1be4563"}, "originalPosition": 135}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTI0NTM2NA==", "bodyText": "You can still add resource type information, which is more user-friendly\nResourceType.fromTypeUrl(response.getTypeUrl())", "url": "https://github.com/grpc/grpc-java/pull/7441#discussion_r491245364", "createdAt": "2020-09-19T00:39:23Z", "author": {"login": "dapengzhang0"}, "path": "xds/src/main/java/io/grpc/xds/XdsClientImpl.java", "diffHunk": "@@ -1737,27 +1723,40 @@ void start() {\n       StreamObserver<io.envoyproxy.envoy.api.v2.DiscoveryResponse> responseReaderV2 =\n           new StreamObserver<io.envoyproxy.envoy.api.v2.DiscoveryResponse>() {\n             @Override\n-            public void onNext(io.envoyproxy.envoy.api.v2.DiscoveryResponse response) {\n-              DiscoveryResponseData responseData =\n-                  DiscoveryResponseData.fromEnvoyProtoV2(response);\n-              if (logger.isLoggable(XdsLogLevel.DEBUG)) {\n-                logger.log(\n-                    XdsLogLevel.DEBUG,\n-                    \"Received {0} response:\\n{1}\",\n-                    responseData.getResourceType(),\n-                    respPrinter.print(response));\n-              }\n-              onDiscoveryResponse(responseData);\n+            public void onNext(final io.envoyproxy.envoy.api.v2.DiscoveryResponse response) {\n+              syncContext.execute(new Runnable() {\n+                @Override\n+                public void run() {\n+                  if (logger.isLoggable(XdsLogLevel.DEBUG)) {\n+                    logger.log(\n+                        XdsLogLevel.DEBUG,\n+                        \"Received DiscoveryResponse:\\n{0}\", respPrinter.print(response));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTIzOTM1Mg=="}, "originalCommit": {"oid": "b2d4c907de27afb6160fad037334253fc1be4563"}, "originalPosition": 135}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTI0NTczMw==", "bodyText": "That's a long URL, not good. Also, the raw response already contains everything, so not bother do anything excessive.", "url": "https://github.com/grpc/grpc-java/pull/7441#discussion_r491245733", "createdAt": "2020-09-19T00:41:57Z", "author": {"login": "voidzcy"}, "path": "xds/src/main/java/io/grpc/xds/XdsClientImpl.java", "diffHunk": "@@ -1737,27 +1723,40 @@ void start() {\n       StreamObserver<io.envoyproxy.envoy.api.v2.DiscoveryResponse> responseReaderV2 =\n           new StreamObserver<io.envoyproxy.envoy.api.v2.DiscoveryResponse>() {\n             @Override\n-            public void onNext(io.envoyproxy.envoy.api.v2.DiscoveryResponse response) {\n-              DiscoveryResponseData responseData =\n-                  DiscoveryResponseData.fromEnvoyProtoV2(response);\n-              if (logger.isLoggable(XdsLogLevel.DEBUG)) {\n-                logger.log(\n-                    XdsLogLevel.DEBUG,\n-                    \"Received {0} response:\\n{1}\",\n-                    responseData.getResourceType(),\n-                    respPrinter.print(response));\n-              }\n-              onDiscoveryResponse(responseData);\n+            public void onNext(final io.envoyproxy.envoy.api.v2.DiscoveryResponse response) {\n+              syncContext.execute(new Runnable() {\n+                @Override\n+                public void run() {\n+                  if (logger.isLoggable(XdsLogLevel.DEBUG)) {\n+                    logger.log(\n+                        XdsLogLevel.DEBUG,\n+                        \"Received DiscoveryResponse:\\n{0}\", respPrinter.print(response));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTIzOTM1Mg=="}, "originalCommit": {"oid": "b2d4c907de27afb6160fad037334253fc1be4563"}, "originalPosition": 135}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTI0NjA2Mg==", "bodyText": "That's a long URL\n\nIt's converted to type enum.\n\nthe raw response already contains everything,\n\nThat's long URL, it's hard to eyeball the type quickly.", "url": "https://github.com/grpc/grpc-java/pull/7441#discussion_r491246062", "createdAt": "2020-09-19T00:44:35Z", "author": {"login": "dapengzhang0"}, "path": "xds/src/main/java/io/grpc/xds/XdsClientImpl.java", "diffHunk": "@@ -1737,27 +1723,40 @@ void start() {\n       StreamObserver<io.envoyproxy.envoy.api.v2.DiscoveryResponse> responseReaderV2 =\n           new StreamObserver<io.envoyproxy.envoy.api.v2.DiscoveryResponse>() {\n             @Override\n-            public void onNext(io.envoyproxy.envoy.api.v2.DiscoveryResponse response) {\n-              DiscoveryResponseData responseData =\n-                  DiscoveryResponseData.fromEnvoyProtoV2(response);\n-              if (logger.isLoggable(XdsLogLevel.DEBUG)) {\n-                logger.log(\n-                    XdsLogLevel.DEBUG,\n-                    \"Received {0} response:\\n{1}\",\n-                    responseData.getResourceType(),\n-                    respPrinter.print(response));\n-              }\n-              onDiscoveryResponse(responseData);\n+            public void onNext(final io.envoyproxy.envoy.api.v2.DiscoveryResponse response) {\n+              syncContext.execute(new Runnable() {\n+                @Override\n+                public void run() {\n+                  if (logger.isLoggable(XdsLogLevel.DEBUG)) {\n+                    logger.log(\n+                        XdsLogLevel.DEBUG,\n+                        \"Received DiscoveryResponse:\\n{0}\", respPrinter.print(response));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTIzOTM1Mg=="}, "originalCommit": {"oid": "b2d4c907de27afb6160fad037334253fc1be4563"}, "originalPosition": 135}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTI0NzA2Ng==", "bodyText": "It's converted to type enum.\n\nOh you mean converted parsed data. But as I said, it's better to just log everything raw.\n\nThat's long URL, it's hard to eyeball the type quickly.\n\nActually it works pretty good from my experience, as people usually care more about Listener/RouteConfiguration/Cluster/ClusterLoadAssignment rather than xDS. IMO, it's better not to add anything excessive to raw data logs.", "url": "https://github.com/grpc/grpc-java/pull/7441#discussion_r491247066", "createdAt": "2020-09-19T00:53:15Z", "author": {"login": "voidzcy"}, "path": "xds/src/main/java/io/grpc/xds/XdsClientImpl.java", "diffHunk": "@@ -1737,27 +1723,40 @@ void start() {\n       StreamObserver<io.envoyproxy.envoy.api.v2.DiscoveryResponse> responseReaderV2 =\n           new StreamObserver<io.envoyproxy.envoy.api.v2.DiscoveryResponse>() {\n             @Override\n-            public void onNext(io.envoyproxy.envoy.api.v2.DiscoveryResponse response) {\n-              DiscoveryResponseData responseData =\n-                  DiscoveryResponseData.fromEnvoyProtoV2(response);\n-              if (logger.isLoggable(XdsLogLevel.DEBUG)) {\n-                logger.log(\n-                    XdsLogLevel.DEBUG,\n-                    \"Received {0} response:\\n{1}\",\n-                    responseData.getResourceType(),\n-                    respPrinter.print(response));\n-              }\n-              onDiscoveryResponse(responseData);\n+            public void onNext(final io.envoyproxy.envoy.api.v2.DiscoveryResponse response) {\n+              syncContext.execute(new Runnable() {\n+                @Override\n+                public void run() {\n+                  if (logger.isLoggable(XdsLogLevel.DEBUG)) {\n+                    logger.log(\n+                        XdsLogLevel.DEBUG,\n+                        \"Received DiscoveryResponse:\\n{0}\", respPrinter.print(response));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTIzOTM1Mg=="}, "originalCommit": {"oid": "b2d4c907de27afb6160fad037334253fc1be4563"}, "originalPosition": 135}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTI0ODUxNA==", "bodyText": "Also, those are DEBUG level logs, they are intended to be read carefully when enabled for debugging, instead of quick eyeballing for what happens.", "url": "https://github.com/grpc/grpc-java/pull/7441#discussion_r491248514", "createdAt": "2020-09-19T01:06:29Z", "author": {"login": "voidzcy"}, "path": "xds/src/main/java/io/grpc/xds/XdsClientImpl.java", "diffHunk": "@@ -1737,27 +1723,40 @@ void start() {\n       StreamObserver<io.envoyproxy.envoy.api.v2.DiscoveryResponse> responseReaderV2 =\n           new StreamObserver<io.envoyproxy.envoy.api.v2.DiscoveryResponse>() {\n             @Override\n-            public void onNext(io.envoyproxy.envoy.api.v2.DiscoveryResponse response) {\n-              DiscoveryResponseData responseData =\n-                  DiscoveryResponseData.fromEnvoyProtoV2(response);\n-              if (logger.isLoggable(XdsLogLevel.DEBUG)) {\n-                logger.log(\n-                    XdsLogLevel.DEBUG,\n-                    \"Received {0} response:\\n{1}\",\n-                    responseData.getResourceType(),\n-                    respPrinter.print(response));\n-              }\n-              onDiscoveryResponse(responseData);\n+            public void onNext(final io.envoyproxy.envoy.api.v2.DiscoveryResponse response) {\n+              syncContext.execute(new Runnable() {\n+                @Override\n+                public void run() {\n+                  if (logger.isLoggable(XdsLogLevel.DEBUG)) {\n+                    logger.log(\n+                        XdsLogLevel.DEBUG,\n+                        \"Received DiscoveryResponse:\\n{0}\", respPrinter.print(response));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTIzOTM1Mg=="}, "originalCommit": {"oid": "b2d4c907de27afb6160fad037334253fc1be4563"}, "originalPosition": 135}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTI1MTk3Nw==", "bodyText": "Oh you mean converted parsed data. But as I said, it's better to just log everything raw.\n\nNot the parsed data, ResourceType.fromTypeUrl(response.getTypeUrl()) is the raw data.", "url": "https://github.com/grpc/grpc-java/pull/7441#discussion_r491251977", "createdAt": "2020-09-19T01:29:46Z", "author": {"login": "dapengzhang0"}, "path": "xds/src/main/java/io/grpc/xds/XdsClientImpl.java", "diffHunk": "@@ -1737,27 +1723,40 @@ void start() {\n       StreamObserver<io.envoyproxy.envoy.api.v2.DiscoveryResponse> responseReaderV2 =\n           new StreamObserver<io.envoyproxy.envoy.api.v2.DiscoveryResponse>() {\n             @Override\n-            public void onNext(io.envoyproxy.envoy.api.v2.DiscoveryResponse response) {\n-              DiscoveryResponseData responseData =\n-                  DiscoveryResponseData.fromEnvoyProtoV2(response);\n-              if (logger.isLoggable(XdsLogLevel.DEBUG)) {\n-                logger.log(\n-                    XdsLogLevel.DEBUG,\n-                    \"Received {0} response:\\n{1}\",\n-                    responseData.getResourceType(),\n-                    respPrinter.print(response));\n-              }\n-              onDiscoveryResponse(responseData);\n+            public void onNext(final io.envoyproxy.envoy.api.v2.DiscoveryResponse response) {\n+              syncContext.execute(new Runnable() {\n+                @Override\n+                public void run() {\n+                  if (logger.isLoggable(XdsLogLevel.DEBUG)) {\n+                    logger.log(\n+                        XdsLogLevel.DEBUG,\n+                        \"Received DiscoveryResponse:\\n{0}\", respPrinter.print(response));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTIzOTM1Mg=="}, "originalCommit": {"oid": "b2d4c907de27afb6160fad037334253fc1be4563"}, "originalPosition": 135}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTI1MjM2Nw==", "bodyText": "Why do you want to decorate the raw data? Keeping the plain data is concise.", "url": "https://github.com/grpc/grpc-java/pull/7441#discussion_r491252367", "createdAt": "2020-09-19T01:33:44Z", "author": {"login": "voidzcy"}, "path": "xds/src/main/java/io/grpc/xds/XdsClientImpl.java", "diffHunk": "@@ -1737,27 +1723,40 @@ void start() {\n       StreamObserver<io.envoyproxy.envoy.api.v2.DiscoveryResponse> responseReaderV2 =\n           new StreamObserver<io.envoyproxy.envoy.api.v2.DiscoveryResponse>() {\n             @Override\n-            public void onNext(io.envoyproxy.envoy.api.v2.DiscoveryResponse response) {\n-              DiscoveryResponseData responseData =\n-                  DiscoveryResponseData.fromEnvoyProtoV2(response);\n-              if (logger.isLoggable(XdsLogLevel.DEBUG)) {\n-                logger.log(\n-                    XdsLogLevel.DEBUG,\n-                    \"Received {0} response:\\n{1}\",\n-                    responseData.getResourceType(),\n-                    respPrinter.print(response));\n-              }\n-              onDiscoveryResponse(responseData);\n+            public void onNext(final io.envoyproxy.envoy.api.v2.DiscoveryResponse response) {\n+              syncContext.execute(new Runnable() {\n+                @Override\n+                public void run() {\n+                  if (logger.isLoggable(XdsLogLevel.DEBUG)) {\n+                    logger.log(\n+                        XdsLogLevel.DEBUG,\n+                        \"Received DiscoveryResponse:\\n{0}\", respPrinter.print(response));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTIzOTM1Mg=="}, "originalCommit": {"oid": "b2d4c907de27afb6160fad037334253fc1be4563"}, "originalPosition": 135}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2354, "cost": 1, "resetAt": "2021-11-12T20:28:25Z"}}}