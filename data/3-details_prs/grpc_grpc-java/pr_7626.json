{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTIxOTc4ODEw", "number": 7626, "title": "netty,xds: Plumb XdsClientWrapperForServerSds via eagAttributes", "bodyText": "I'd like the Netty change to make it before the branch cut. The Xds change could come later if need be.\nYes, we'll get to coordinate this change with other XdsServerBuilder changes.", "createdAt": "2020-11-16T21:44:40Z", "url": "https://github.com/grpc/grpc-java/pull/7626", "merged": true, "mergeCommit": {"oid": "d9927ffe9921beb40f0122a902df267e5022782f"}, "closed": true, "closedAt": "2020-11-17T20:26:02Z", "author": {"login": "ejona86"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABddQPZKAFqTUzMTk3OTIyMw==", "endCursor": "Y3Vyc29yOnYyOpPPAAABddfUX8gBqjQwMDczMTk1Nzk=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMxOTc5MjIz", "url": "https://github.com/grpc/grpc-java/pull/7626#pullrequestreview-531979223", "createdAt": "2020-11-17T02:36:20Z", "commit": {"oid": "ec84cb31ef7134ee931fc6c3ec4e6a63b8d858ae"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xN1QwMjozNjoyMFrOH0iGlw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xN1QwMjozNjoyMFrOH0iGlw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDg0Njc0Mw==", "bodyText": "Any\u00a0reason why the new param wasn't added to the end?", "url": "https://github.com/grpc/grpc-java/pull/7626#discussion_r524846743", "createdAt": "2020-11-17T02:36:20Z", "author": {"login": "sanjaypujare"}, "path": "netty/src/main/java/io/grpc/netty/NettyServer.java", "diffHunk": "@@ -113,7 +115,7 @@\n       long maxConnectionIdleInNanos,\n       long maxConnectionAgeInNanos, long maxConnectionAgeGraceInNanos,\n       boolean permitKeepAliveWithoutCalls, long permitKeepAliveTimeInNanos,\n-      InternalChannelz channelz) {\n+      Attributes eagAttributes, InternalChannelz channelz) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ec84cb31ef7134ee931fc6c3ec4e6a63b8d858ae"}, "originalPosition": 21}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMxOTkwNjgz", "url": "https://github.com/grpc/grpc-java/pull/7626#pullrequestreview-531990683", "createdAt": "2020-11-17T03:11:01Z", "commit": {"oid": "ec84cb31ef7134ee931fc6c3ec4e6a63b8d858ae"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xN1QwMzoxMTowMVrOH0it8w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xN1QwMzoxMTowMVrOH0it8w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDg1NjgxOQ==", "bodyText": "Remove the 2nd sentence in the comment since it doesn't \"get the getXdsClientWrapperForServerSds from the serverSdsProtocolNegotiator\". In any case with my PR this will be a non-public method so the whole comment can be removed.", "url": "https://github.com/grpc/grpc-java/pull/7626#discussion_r524856819", "createdAt": "2020-11-17T03:11:01Z", "author": {"login": "sanjaypujare"}, "path": "xds/src/main/java/io/grpc/xds/internal/sds/XdsServerBuilder.java", "diffHunk": "@@ -199,26 +201,30 @@ public static XdsServerBuilder forPort(int port) {\n \n   @Override\n   public Server build() {\n+    XdsClientWrapperForServerSds xdsClient = new XdsClientWrapperForServerSds(port);\n+    ServerSdsProtocolNegotiator serverProtocolNegotiator = null;\n     if (fallbackProtocolNegotiator != null) {\n-      ServerSdsProtocolNegotiator serverProtocolNegotiator =\n-          SdsProtocolNegotiators.serverProtocolNegotiator(port, fallbackProtocolNegotiator);\n-      return buildServer(serverProtocolNegotiator);\n-    } else {\n-      return new ServerWrapperForXds(\n-          delegate.build(), new XdsClientWrapperForServerSds(port), errorNotifier);\n+      serverProtocolNegotiator =\n+          SdsProtocolNegotiators.serverProtocolNegotiator(fallbackProtocolNegotiator);\n     }\n+    return buildServer(xdsClient, serverProtocolNegotiator);\n   }\n \n   /**\n    * Creates a Server using the given serverSdsProtocolNegotiator: gets the", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ec84cb31ef7134ee931fc6c3ec4e6a63b8d858ae"}, "originalPosition": 36}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMyMDMwODI2", "url": "https://github.com/grpc/grpc-java/pull/7626#pullrequestreview-532030826", "createdAt": "2020-11-17T05:26:13Z", "commit": {"oid": "ec84cb31ef7134ee931fc6c3ec4e6a63b8d858ae"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ac48bae923a9d5a1fe2a4561cb74b6fac79c98e0", "author": {"user": {"login": "ejona86", "name": "Eric Anderson"}}, "url": "https://github.com/grpc/grpc-java/commit/ac48bae923a9d5a1fe2a4561cb74b6fac79c98e0", "committedDate": "2020-11-17T19:29:35Z", "message": "xds: Fix javadoc"}, "afterCommit": {"oid": "403abf46e9f33cf851fd84b526f4380427f09ab6", "author": {"user": {"login": "ejona86", "name": "Eric Anderson"}}, "url": "https://github.com/grpc/grpc-java/commit/403abf46e9f33cf851fd84b526f4380427f09ab6", "committedDate": "2020-11-17T19:30:45Z", "message": "xds: Use eagAttributes to propagate XdsClientWrapperForServerSds\n\nThis is preparation for XdsServerCredentials, which must be created\nwithout knowledge of the server listening port."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "84951d82d877c212e4b8285a650b3e2375cdd400", "author": {"user": {"login": "ejona86", "name": "Eric Anderson"}}, "url": "https://github.com/grpc/grpc-java/commit/84951d82d877c212e4b8285a650b3e2375cdd400", "committedDate": "2020-11-17T20:02:36Z", "message": "netty: Add plumbing for eagAttributes on server-side\n\nThis is to be used for xDS to inject configuration for the\nXdsServerCredentials. We'd like a cleaner approach, but they mostly seem\nto be more heavy-weight. We will probably address this at the same time\nwe handle the Executor being passed for TLS. In the mean time this is\neasy, doesn't hurt much, and can easily be changed in the future."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4c62bbb7fc6cbd5531b26e48b1f6f710b68bcbb3", "author": {"user": {"login": "ejona86", "name": "Eric Anderson"}}, "url": "https://github.com/grpc/grpc-java/commit/4c62bbb7fc6cbd5531b26e48b1f6f710b68bcbb3", "committedDate": "2020-11-17T20:09:29Z", "message": "xds: Use eagAttributes to propagate XdsClientWrapperForServerSds\n\nThis is preparation for XdsServerCredentials, which must be created\nwithout knowledge of the server listening port."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "403abf46e9f33cf851fd84b526f4380427f09ab6", "author": {"user": {"login": "ejona86", "name": "Eric Anderson"}}, "url": "https://github.com/grpc/grpc-java/commit/403abf46e9f33cf851fd84b526f4380427f09ab6", "committedDate": "2020-11-17T19:30:45Z", "message": "xds: Use eagAttributes to propagate XdsClientWrapperForServerSds\n\nThis is preparation for XdsServerCredentials, which must be created\nwithout knowledge of the server listening port."}, "afterCommit": {"oid": "4c62bbb7fc6cbd5531b26e48b1f6f710b68bcbb3", "author": {"user": {"login": "ejona86", "name": "Eric Anderson"}}, "url": "https://github.com/grpc/grpc-java/commit/4c62bbb7fc6cbd5531b26e48b1f6f710b68bcbb3", "committedDate": "2020-11-17T20:09:29Z", "message": "xds: Use eagAttributes to propagate XdsClientWrapperForServerSds\n\nThis is preparation for XdsServerCredentials, which must be created\nwithout knowledge of the server listening port."}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3991, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}