{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE3NjQ0ODY0", "number": 7603, "title": "interop-testing: aggregate accumulated stats by RPC methods in xDS test client", "bodyText": "Mirrored proto change as grpc/grpc#24703 and its corresponding change for the test client.", "createdAt": "2020-11-09T10:09:52Z", "url": "https://github.com/grpc/grpc-java/pull/7603", "merged": true, "mergeCommit": {"oid": "bf191cb5ea56fe96e0ffa4c8936d3096c738fb07"}, "closed": true, "closedAt": "2020-11-11T07:58:09Z", "author": {"login": "voidzcy"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdarQODAH2gAyNTE3NjQ0ODY0OmIwZjc5MTBhOTYyMWQwYTkwNTJhNmZkNWRhYjk1YWY5Nzg4NWY2NTU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdbSD9CAH2gAyNTE3NjQ0ODY0OjU2NDFjZGViMzU1MzlhNDU0NzQyZDFhMDBiMWI5YmMyOTI1ZTM0Mjg=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "b0f7910a9621d0a9052a6fd5dab95af97885f655", "author": {"user": {"login": "voidzcy", "name": "Chengyuan Zhang"}}, "url": "https://github.com/grpc/grpc-java/commit/b0f7910a9621d0a9052a6fd5dab95af97885f655", "committedDate": "2020-11-09T02:22:54Z", "message": "Count accumulated RPC stats by methods."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "19a56ece4785148bc45d4625e1e3b373d21fd5bc", "author": {"user": {"login": "voidzcy", "name": "Chengyuan Zhang"}}, "url": "https://github.com/grpc/grpc-java/commit/19a56ece4785148bc45d4625e1e3b373d21fd5bc", "committedDate": "2020-11-09T19:06:11Z", "message": "Fix style"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI3NjQ2MjI3", "url": "https://github.com/grpc/grpc-java/pull/7603#pullrequestreview-527646227", "createdAt": "2020-11-10T22:06:29Z", "commit": {"oid": "19a56ece4785148bc45d4625e1e3b373d21fd5bc"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQyMjowNjoyOVrOHwxdhw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQyMjowNjoyOVrOHwxdhw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDkwNDA3MQ==", "bodyText": "nit/optional: is this a standard way of working around Java 7's lack of getOrDefault? This seems slightly \"tricky\" to me in that it requires thinking to see that that value in the map later on will never be null when rpcsSucceededByMethod.put(rpcType.name(), succeededBase + 1);-type code is executing. Correctness here also requires knowing that no key is ever removed from these maps, which could be less obvious in the future.\nI would prefer dropping this block here and just doing the null check when incrementing the value each time, as it seems a bit clearer for future readers:\nint rpcsStarted = 0;\nif (rpcsStartedBymethod.containsKey(rpcType.name()) {\n    rpcsStarted = rpcsStartedByMethod.get(rpcType.name());\n}\nrpcsStartedByMethod.put(rpcType.name(), rpcsStarted + 1);\n\nBut then we have to use the ugly block above in several places as well, so will let you choose whether it's better as-is versus my proposal.", "url": "https://github.com/grpc/grpc-java/pull/7603#discussion_r520904071", "createdAt": "2020-11-10T22:06:29Z", "author": {"login": "ericgribkoff"}, "path": "interop-testing/src/main/java/io/grpc/testing/integration/XdsTestClient.java", "diffHunk": "@@ -281,6 +280,15 @@ private void makeRpc(final RpcType rpcType, final Metadata headersToSend) {\n           currentRequestId += 1;\n           requestId = currentRequestId;\n           savedWatchers.addAll(watchers);\n+          if (!rpcsStartedByMethod.containsKey(rpcType.name())) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "19a56ece4785148bc45d4625e1e3b373d21fd5bc"}, "originalPosition": 25}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5641cdeb35539a454742d1a00b1b9bc2925e3428", "author": {"user": {"login": "voidzcy", "name": "Chengyuan Zhang"}}, "url": "https://github.com/grpc/grpc-java/commit/5641cdeb35539a454742d1a00b1b9bc2925e3428", "committedDate": "2020-11-10T23:35:48Z", "message": "Improve code readability by delaying map entry null-check."}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3977, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}