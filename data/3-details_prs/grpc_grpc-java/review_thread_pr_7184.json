{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ1MDIxOTk1", "number": 7184, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNlQyMzo1Mjo0MFrOEL4QBA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wN1QwMDoyMjoyN1rOEL4lIA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgwODkxMzk2OnYy", "diffSide": "RIGHT", "path": "xds/src/main/java/io/grpc/xds/EnvoyProtoData.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNlQyMzo1Mjo0MFrOGtqmpQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wN1QwMDozNzo1MVrOGtrVQQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDUzNzEyNQ==", "bodyText": "nit: 10_000. But usually we only do this kind of format for long type (10_000L).", "url": "https://github.com/grpc/grpc-java/pull/7184#discussion_r450537125", "createdAt": "2020-07-06T23:52:40Z", "author": {"login": "voidzcy"}, "path": "xds/src/main/java/io/grpc/xds/EnvoyProtoData.java", "diffHunk": "@@ -394,6 +430,32 @@ static DropOverload fromEnvoyProtoDropOverload(\n       return new DropOverload(proto.getCategory(), numerator);\n     }\n \n+    @VisibleForTesting\n+    static DropOverload fromEnvoyProtoDropOverloadV2(\n+        io.envoyproxy.envoy.api.v2.ClusterLoadAssignment.Policy.DropOverload proto) {\n+      io.envoyproxy.envoy.type.FractionalPercent percent = proto.getDropPercentage();\n+      int numerator = percent.getNumerator();\n+      io.envoyproxy.envoy.type.FractionalPercent.DenominatorType type = percent.getDenominator();\n+      switch (type) {\n+        case TEN_THOUSAND:\n+          numerator *= 100;\n+          break;\n+        case HUNDRED:\n+          numerator *= 100_00;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d26dd19f2fe37d9e6b945c0d519c3580c73323c2"}, "originalPosition": 118}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDU0OTA1Nw==", "bodyText": "Done.", "url": "https://github.com/grpc/grpc-java/pull/7184#discussion_r450549057", "createdAt": "2020-07-07T00:37:51Z", "author": {"login": "dapengzhang0"}, "path": "xds/src/main/java/io/grpc/xds/EnvoyProtoData.java", "diffHunk": "@@ -394,6 +430,32 @@ static DropOverload fromEnvoyProtoDropOverload(\n       return new DropOverload(proto.getCategory(), numerator);\n     }\n \n+    @VisibleForTesting\n+    static DropOverload fromEnvoyProtoDropOverloadV2(\n+        io.envoyproxy.envoy.api.v2.ClusterLoadAssignment.Policy.DropOverload proto) {\n+      io.envoyproxy.envoy.type.FractionalPercent percent = proto.getDropPercentage();\n+      int numerator = percent.getNumerator();\n+      io.envoyproxy.envoy.type.FractionalPercent.DenominatorType type = percent.getDenominator();\n+      switch (type) {\n+        case TEN_THOUSAND:\n+          numerator *= 100;\n+          break;\n+        case HUNDRED:\n+          numerator *= 100_00;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDUzNzEyNQ=="}, "originalCommit": {"oid": "d26dd19f2fe37d9e6b945c0d519c3580c73323c2"}, "originalPosition": 118}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgwODkzMjQ4OnYy", "diffSide": "RIGHT", "path": "xds/src/main/java/io/grpc/xds/EnvoyProtoData.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wN1QwMDowMjozOFrOGtqxdA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wN1QwMDozNzo0MlrOGtrVJA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDUzOTg5Mg==", "bodyText": "nit: this line can be shrunk to the previous one. Same for below.", "url": "https://github.com/grpc/grpc-java/pull/7184#discussion_r450539892", "createdAt": "2020-07-07T00:02:38Z", "author": {"login": "voidzcy"}, "path": "xds/src/main/java/io/grpc/xds/EnvoyProtoData.java", "diffHunk": "@@ -299,18 +322,31 @@ public String toString() {\n     }\n \n     static LbEndpoint fromEnvoyProtoLbEndpoint(\n+        io.envoyproxy.envoy.config.endpoint.v3.LbEndpoint proto) {\n+      io.envoyproxy.envoy.config.core.v3.SocketAddress socketAddress =\n+          proto.getEndpoint().getAddress().getSocketAddress();\n+      InetSocketAddress addr =\n+          new InetSocketAddress(socketAddress.getAddress(), socketAddress.getPortValue());\n+      return new LbEndpoint(\n+          new EquivalentAddressGroup(ImmutableList.<java.net.SocketAddress>of(addr)),\n+          proto.getLoadBalancingWeight().getValue(),\n+          proto.getHealthStatus() == io.envoyproxy.envoy.config.core.v3.HealthStatus.HEALTHY\n+              || proto.getHealthStatus()\n+                  == io.envoyproxy.envoy.config.core.v3.HealthStatus.UNKNOWN);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d26dd19f2fe37d9e6b945c0d519c3580c73323c2"}, "originalPosition": 69}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDU0OTAyOA==", "bodyText": "Done for below. Though this line can not be shrunk because otherwise the length would be 101 chars.", "url": "https://github.com/grpc/grpc-java/pull/7184#discussion_r450549028", "createdAt": "2020-07-07T00:37:42Z", "author": {"login": "dapengzhang0"}, "path": "xds/src/main/java/io/grpc/xds/EnvoyProtoData.java", "diffHunk": "@@ -299,18 +322,31 @@ public String toString() {\n     }\n \n     static LbEndpoint fromEnvoyProtoLbEndpoint(\n+        io.envoyproxy.envoy.config.endpoint.v3.LbEndpoint proto) {\n+      io.envoyproxy.envoy.config.core.v3.SocketAddress socketAddress =\n+          proto.getEndpoint().getAddress().getSocketAddress();\n+      InetSocketAddress addr =\n+          new InetSocketAddress(socketAddress.getAddress(), socketAddress.getPortValue());\n+      return new LbEndpoint(\n+          new EquivalentAddressGroup(ImmutableList.<java.net.SocketAddress>of(addr)),\n+          proto.getLoadBalancingWeight().getValue(),\n+          proto.getHealthStatus() == io.envoyproxy.envoy.config.core.v3.HealthStatus.HEALTHY\n+              || proto.getHealthStatus()\n+                  == io.envoyproxy.envoy.config.core.v3.HealthStatus.UNKNOWN);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDUzOTg5Mg=="}, "originalCommit": {"oid": "d26dd19f2fe37d9e6b945c0d519c3580c73323c2"}, "originalPosition": 69}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgwODk2ODAwOnYy", "diffSide": "RIGHT", "path": "xds/src/main/java/io/grpc/xds/EnvoyProtoData.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wN1QwMDoyMjoyN1rOGtrF8g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wN1QwMDozMTowM1rOGtrO4w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDU0NTEzOA==", "bodyText": "We should either use all v2 or all v3 messages for tests, but not a mix of both (although both can be handled). But we should just choose one version for all unit tests.", "url": "https://github.com/grpc/grpc-java/pull/7184#discussion_r450545138", "createdAt": "2020-07-07T00:22:27Z", "author": {"login": "voidzcy"}, "path": "xds/src/main/java/io/grpc/xds/EnvoyProtoData.java", "diffHunk": "@@ -148,7 +148,15 @@ public String toString() {\n       this.subZone = subZone;\n     }\n \n-    static Locality fromEnvoyProtoLocality(io.envoyproxy.envoy.api.v2.core.Locality locality) {\n+    static Locality fromEnvoyProtoLocality(io.envoyproxy.envoy.config.core.v3.Locality locality) {\n+      return new Locality(\n+          /* region = */ locality.getRegion(),\n+          /* zone = */ locality.getZone(),\n+          /* subZone = */ locality.getSubZone());\n+    }\n+\n+    @VisibleForTesting\n+    static Locality fromEnvoyProtoLocalityV2(io.envoyproxy.envoy.api.v2.core.Locality locality) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d26dd19f2fe37d9e6b945c0d519c3580c73323c2"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDU0NzQyNw==", "bodyText": "V2 messages are used in the tests with a server sending response. We only test server sending v2 messages. There is no mix. Some v3 messages in the tests are testing EnvoyProtoData and some utils methods, not server response.", "url": "https://github.com/grpc/grpc-java/pull/7184#discussion_r450547427", "createdAt": "2020-07-07T00:31:03Z", "author": {"login": "dapengzhang0"}, "path": "xds/src/main/java/io/grpc/xds/EnvoyProtoData.java", "diffHunk": "@@ -148,7 +148,15 @@ public String toString() {\n       this.subZone = subZone;\n     }\n \n-    static Locality fromEnvoyProtoLocality(io.envoyproxy.envoy.api.v2.core.Locality locality) {\n+    static Locality fromEnvoyProtoLocality(io.envoyproxy.envoy.config.core.v3.Locality locality) {\n+      return new Locality(\n+          /* region = */ locality.getRegion(),\n+          /* zone = */ locality.getZone(),\n+          /* subZone = */ locality.getSubZone());\n+    }\n+\n+    @VisibleForTesting\n+    static Locality fromEnvoyProtoLocalityV2(io.envoyproxy.envoy.api.v2.core.Locality locality) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDU0NTEzOA=="}, "originalCommit": {"oid": "d26dd19f2fe37d9e6b945c0d519c3580c73323c2"}, "originalPosition": 24}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2583, "cost": 1, "resetAt": "2021-11-12T20:28:25Z"}}}