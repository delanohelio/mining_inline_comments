{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTExODM4ODcy", "number": 7564, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOFQyMzoyNDozNlrOEzCdQA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOFQyMzoyNDozNlrOEzCdQA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIxOTUzMDg4OnYy", "diffSide": "RIGHT", "path": "core/src/main/java/io/grpc/internal/AbstractServerImplBuilder.java", "isResolved": true, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOFQyMzoyNDozNlrOHqBEwQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOVQwMzoyNTozNlrOHqG9Cw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzgxOTg0MQ==", "bodyText": "This would need to re-define the methods of ForwardingServerBuilder. At that point extending ForwardingServerBuilder provides nothing. It is good to change ForwardingServerBuilder to <T extends ServerBuilder>, though. Although I also wonder if we should remove the class from v1.33.x since it is now unused. (We can just make it package-private to reduce code churn.)", "url": "https://github.com/grpc/grpc-java/pull/7564#discussion_r513819841", "createdAt": "2020-10-28T23:24:36Z", "author": {"login": "ejona86"}, "path": "core/src/main/java/io/grpc/internal/AbstractServerImplBuilder.java", "diffHunk": "@@ -0,0 +1,36 @@\n+/*\n+ * Copyright 2020 The gRPC Authors\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package io.grpc.internal;\n+\n+import io.grpc.ForwardingServerBuilder;\n+import io.grpc.ServerBuilder;\n+\n+/**\n+ * Temporary shim for {@link io.grpc.ForwardingServerBuilder} to fix ABI backward compatibility.\n+ *\n+ * @param <T> The concrete type of this builder.\n+ * @see <a href=\"https://github.com/grpc/grpc-java/issues/7211\">grpc/grpc-java#7211</a>\n+ */\n+public abstract class AbstractServerImplBuilder", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "be7a6281c898fad1917bd5932ae9d6bebf13cbec"}, "originalPosition": 28}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzg1MDU5Ng==", "bodyText": "Right, that's where I had doubts. On another hand, one could interpret the spec that it's sufficient for the class to be simply  present in the hierarchy. I was about to give updated AbstractManagedChannelImplBuilder a shot, I already have a setup with the issue reproduced. Will try AbstractServerImplBuilder too.", "url": "https://github.com/grpc/grpc-java/pull/7564#discussion_r513850596", "createdAt": "2020-10-29T01:08:27Z", "author": {"login": "sergiitk"}, "path": "core/src/main/java/io/grpc/internal/AbstractServerImplBuilder.java", "diffHunk": "@@ -0,0 +1,36 @@\n+/*\n+ * Copyright 2020 The gRPC Authors\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package io.grpc.internal;\n+\n+import io.grpc.ForwardingServerBuilder;\n+import io.grpc.ServerBuilder;\n+\n+/**\n+ * Temporary shim for {@link io.grpc.ForwardingServerBuilder} to fix ABI backward compatibility.\n+ *\n+ * @param <T> The concrete type of this builder.\n+ * @see <a href=\"https://github.com/grpc/grpc-java/issues/7211\">grpc/grpc-java#7211</a>\n+ */\n+public abstract class AbstractServerImplBuilder", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzgxOTg0MQ=="}, "originalCommit": {"oid": "be7a6281c898fad1917bd5932ae9d6bebf13cbec"}, "originalPosition": 28}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzkwMjE2NA==", "bodyText": "OK, after digging with javap, I understand the order of things with generics now. You're right. I'd have to redefine all methods in AbstractManagedChannelImplBuilder, otherwise they are generated with ServerBuilder return type. Which is a supertype for AbstractManagedChannelImplBuilder, so no match.", "url": "https://github.com/grpc/grpc-java/pull/7564#discussion_r513902164", "createdAt": "2020-10-29T02:58:51Z", "author": {"login": "sergiitk"}, "path": "core/src/main/java/io/grpc/internal/AbstractServerImplBuilder.java", "diffHunk": "@@ -0,0 +1,36 @@\n+/*\n+ * Copyright 2020 The gRPC Authors\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package io.grpc.internal;\n+\n+import io.grpc.ForwardingServerBuilder;\n+import io.grpc.ServerBuilder;\n+\n+/**\n+ * Temporary shim for {@link io.grpc.ForwardingServerBuilder} to fix ABI backward compatibility.\n+ *\n+ * @param <T> The concrete type of this builder.\n+ * @see <a href=\"https://github.com/grpc/grpc-java/issues/7211\">grpc/grpc-java#7211</a>\n+ */\n+public abstract class AbstractServerImplBuilder", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzgxOTg0MQ=="}, "originalCommit": {"oid": "be7a6281c898fad1917bd5932ae9d6bebf13cbec"}, "originalPosition": 28}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzkxNjE3MQ==", "bodyText": "Good news is the fix for AbstractManagedChannelImplBuilder works well.\nA client created with gRPC v1.32.2 is compatible with gRPC jars created from this branch. I confirmed the client is compatible with methods that got moved from abstract to fwd  in v1.32.2, then brought back in this PR.  And, just in case, I confirmed that methods that were pushed down from abstract to netty, work too.\n\u276f java -cp \"./abi-1.32.2.jar:./deps-1.32.2/*\" org.example.AbiClient\nManagedChannelOrphanWrapper{delegate=ManagedChannelImpl{logId=1, target=localhost:100}}\n\n\u276f java -cp \"./abi-1.32.2.jar:./deps-1.33.0/*\" org.example.AbiClient\nException in thread \"main\" java.lang.NoSuchMethodError: \n  io.grpc.netty.NettyChannelBuilder.maxRetryAttempts(I)Lio/grpc/internal/AbstractManagedChannelImplBuilder;\n\tat org.example.AbiClient.<init>(AbiClient.java:14)\n\tat org.example.AbiClient.main(AbiClient.java:22)\n\n\u276f java -cp \"./abi-1.32.2.jar:./deps-1.34-be7a6281c/*\" org.example.AbiClient\nManagedChannelOrphanWrapper{delegate=ManagedChannelImpl{logId=1, target=localhost:100}}\n\nsrc:\npackage org.example;\n\nimport io.grpc.ManagedChannel;\nimport io.grpc.ManagedChannelBuilder;\nimport io.grpc.netty.NettyChannelBuilder;\n\npublic class AbiClient {\n  private final NettyChannelBuilder ncb;\n\n  public AbiClient() {\n    ncb = NettyChannelBuilder\n        .forTarget(\"localhost:100\")\n        .maxInboundMetadataSize(100)    // own\n        .maxRetryAttempts(100);         // Moved from abstract to fwd in v1.33.0\n  }\n\n  public NettyChannelBuilder getBuilder() {\n    return ncb;\n  }\n\n  public static void main(String[] args) {\n    AbiClient me = new AbiClient();\n    ManagedChannel c = me.getBuilder().build();\n    System.out.println(c);\n  }\n}", "url": "https://github.com/grpc/grpc-java/pull/7564#discussion_r513916171", "createdAt": "2020-10-29T03:25:36Z", "author": {"login": "sergiitk"}, "path": "core/src/main/java/io/grpc/internal/AbstractServerImplBuilder.java", "diffHunk": "@@ -0,0 +1,36 @@\n+/*\n+ * Copyright 2020 The gRPC Authors\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package io.grpc.internal;\n+\n+import io.grpc.ForwardingServerBuilder;\n+import io.grpc.ServerBuilder;\n+\n+/**\n+ * Temporary shim for {@link io.grpc.ForwardingServerBuilder} to fix ABI backward compatibility.\n+ *\n+ * @param <T> The concrete type of this builder.\n+ * @see <a href=\"https://github.com/grpc/grpc-java/issues/7211\">grpc/grpc-java#7211</a>\n+ */\n+public abstract class AbstractServerImplBuilder", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzgxOTg0MQ=="}, "originalCommit": {"oid": "be7a6281c898fad1917bd5932ae9d6bebf13cbec"}, "originalPosition": 28}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2255, "cost": 1, "resetAt": "2021-11-12T20:28:25Z"}}}