{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ1MDIxOTk1", "number": 7184, "title": "xds: parse resources in ADS response to envoy-api v3 objects", "bodyText": "Continuation of #7169 to parse all resources in ADS response to v3 objects. In this PR we still only send v2 requests to xDS server (No v3 bootstrap or env flag support).", "createdAt": "2020-07-06T21:55:18Z", "url": "https://github.com/grpc/grpc-java/pull/7184", "merged": true, "mergeCommit": {"oid": "c756c2db56926f20cb06d0242b662198da779634"}, "closed": true, "closedAt": "2020-07-07T04:55:26Z", "author": {"login": "dapengzhang0"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcyYeMmAH2gAyNDQ1MDIxOTk1OmE2N2FmZGIxNmE3NDJhYzk0OTkwMjFlZWU5OTNkZjEwOTM4ZWEwY2Q=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcya1RigFqTQ0MzQ4ODI5MQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "a67afdb16a742ac9499021eee993df10938ea0cd", "author": {"user": {"login": "dapengzhang0", "name": "ZHANG Dapeng"}}, "url": "https://github.com/grpc/grpc-java/commit/a67afdb16a742ac9499021eee993df10938ea0cd", "committedDate": "2020-07-06T21:53:00Z", "message": "update import.sh to include v3 proto"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "28003670d5b496ba664a92f98e864818fdec43ea", "author": {"user": {"login": "dapengzhang0", "name": "ZHANG Dapeng"}}, "url": "https://github.com/grpc/grpc-java/commit/28003670d5b496ba664a92f98e864818fdec43ea", "committedDate": "2020-07-06T21:53:19Z", "message": "import v3 proto"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "bfdf529f147a9f5902b97a758c54c3672ed14470", "author": {"user": {"login": "dapengzhang0", "name": "ZHANG Dapeng"}}, "url": "https://github.com/grpc/grpc-java/commit/bfdf529f147a9f5902b97a758c54c3672ed14470", "committedDate": "2020-07-06T21:53:50Z", "message": "parse resources in ADS response to v3 objects"}, "afterCommit": {"oid": "abeedb722089f0b5c4f729a053d2ab29787351f6", "author": {"user": {"login": "dapengzhang0", "name": "ZHANG Dapeng"}}, "url": "https://github.com/grpc/grpc-java/commit/abeedb722089f0b5c4f729a053d2ab29787351f6", "committedDate": "2020-07-06T22:02:06Z", "message": "parse resources in ADS response to v3 objects"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "abeedb722089f0b5c4f729a053d2ab29787351f6", "author": {"user": {"login": "dapengzhang0", "name": "ZHANG Dapeng"}}, "url": "https://github.com/grpc/grpc-java/commit/abeedb722089f0b5c4f729a053d2ab29787351f6", "committedDate": "2020-07-06T22:02:06Z", "message": "parse resources in ADS response to v3 objects"}, "afterCommit": {"oid": "054a531a4ab2d2bbd1f65888fc084ea35b48fac1", "author": {"user": {"login": "dapengzhang0", "name": "ZHANG Dapeng"}}, "url": "https://github.com/grpc/grpc-java/commit/054a531a4ab2d2bbd1f65888fc084ea35b48fac1", "committedDate": "2020-07-06T22:05:37Z", "message": "parse resources in ADS response to v3 objects"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d26dd19f2fe37d9e6b945c0d519c3580c73323c2", "author": {"user": {"login": "dapengzhang0", "name": "ZHANG Dapeng"}}, "url": "https://github.com/grpc/grpc-java/commit/d26dd19f2fe37d9e6b945c0d519c3580c73323c2", "committedDate": "2020-07-06T22:16:33Z", "message": "parse resources in ADS response to v3 objects"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "054a531a4ab2d2bbd1f65888fc084ea35b48fac1", "author": {"user": {"login": "dapengzhang0", "name": "ZHANG Dapeng"}}, "url": "https://github.com/grpc/grpc-java/commit/054a531a4ab2d2bbd1f65888fc084ea35b48fac1", "committedDate": "2020-07-06T22:05:37Z", "message": "parse resources in ADS response to v3 objects"}, "afterCommit": {"oid": "d26dd19f2fe37d9e6b945c0d519c3580c73323c2", "author": {"user": {"login": "dapengzhang0", "name": "ZHANG Dapeng"}}, "url": "https://github.com/grpc/grpc-java/commit/d26dd19f2fe37d9e6b945c0d519c3580c73323c2", "committedDate": "2020-07-06T22:16:33Z", "message": "parse resources in ADS response to v3 objects"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQzNDc1NTQ2", "url": "https://github.com/grpc/grpc-java/pull/7184#pullrequestreview-443475546", "createdAt": "2020-07-06T23:52:40Z", "commit": {"oid": "d26dd19f2fe37d9e6b945c0d519c3580c73323c2"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNlQyMzo1Mjo0MFrOGtqmpQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wN1QwMDoyMjoyN1rOGtrF8g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDUzNzEyNQ==", "bodyText": "nit: 10_000. But usually we only do this kind of format for long type (10_000L).", "url": "https://github.com/grpc/grpc-java/pull/7184#discussion_r450537125", "createdAt": "2020-07-06T23:52:40Z", "author": {"login": "voidzcy"}, "path": "xds/src/main/java/io/grpc/xds/EnvoyProtoData.java", "diffHunk": "@@ -394,6 +430,32 @@ static DropOverload fromEnvoyProtoDropOverload(\n       return new DropOverload(proto.getCategory(), numerator);\n     }\n \n+    @VisibleForTesting\n+    static DropOverload fromEnvoyProtoDropOverloadV2(\n+        io.envoyproxy.envoy.api.v2.ClusterLoadAssignment.Policy.DropOverload proto) {\n+      io.envoyproxy.envoy.type.FractionalPercent percent = proto.getDropPercentage();\n+      int numerator = percent.getNumerator();\n+      io.envoyproxy.envoy.type.FractionalPercent.DenominatorType type = percent.getDenominator();\n+      switch (type) {\n+        case TEN_THOUSAND:\n+          numerator *= 100;\n+          break;\n+        case HUNDRED:\n+          numerator *= 100_00;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d26dd19f2fe37d9e6b945c0d519c3580c73323c2"}, "originalPosition": 118}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDUzOTg5Mg==", "bodyText": "nit: this line can be shrunk to the previous one. Same for below.", "url": "https://github.com/grpc/grpc-java/pull/7184#discussion_r450539892", "createdAt": "2020-07-07T00:02:38Z", "author": {"login": "voidzcy"}, "path": "xds/src/main/java/io/grpc/xds/EnvoyProtoData.java", "diffHunk": "@@ -299,18 +322,31 @@ public String toString() {\n     }\n \n     static LbEndpoint fromEnvoyProtoLbEndpoint(\n+        io.envoyproxy.envoy.config.endpoint.v3.LbEndpoint proto) {\n+      io.envoyproxy.envoy.config.core.v3.SocketAddress socketAddress =\n+          proto.getEndpoint().getAddress().getSocketAddress();\n+      InetSocketAddress addr =\n+          new InetSocketAddress(socketAddress.getAddress(), socketAddress.getPortValue());\n+      return new LbEndpoint(\n+          new EquivalentAddressGroup(ImmutableList.<java.net.SocketAddress>of(addr)),\n+          proto.getLoadBalancingWeight().getValue(),\n+          proto.getHealthStatus() == io.envoyproxy.envoy.config.core.v3.HealthStatus.HEALTHY\n+              || proto.getHealthStatus()\n+                  == io.envoyproxy.envoy.config.core.v3.HealthStatus.UNKNOWN);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d26dd19f2fe37d9e6b945c0d519c3580c73323c2"}, "originalPosition": 69}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDU0NTEzOA==", "bodyText": "We should either use all v2 or all v3 messages for tests, but not a mix of both (although both can be handled). But we should just choose one version for all unit tests.", "url": "https://github.com/grpc/grpc-java/pull/7184#discussion_r450545138", "createdAt": "2020-07-07T00:22:27Z", "author": {"login": "voidzcy"}, "path": "xds/src/main/java/io/grpc/xds/EnvoyProtoData.java", "diffHunk": "@@ -148,7 +148,15 @@ public String toString() {\n       this.subZone = subZone;\n     }\n \n-    static Locality fromEnvoyProtoLocality(io.envoyproxy.envoy.api.v2.core.Locality locality) {\n+    static Locality fromEnvoyProtoLocality(io.envoyproxy.envoy.config.core.v3.Locality locality) {\n+      return new Locality(\n+          /* region = */ locality.getRegion(),\n+          /* zone = */ locality.getZone(),\n+          /* subZone = */ locality.getSubZone());\n+    }\n+\n+    @VisibleForTesting\n+    static Locality fromEnvoyProtoLocalityV2(io.envoyproxy.envoy.api.v2.core.Locality locality) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d26dd19f2fe37d9e6b945c0d519c3580c73323c2"}, "originalPosition": 24}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQzNDg0MTUx", "url": "https://github.com/grpc/grpc-java/pull/7184#pullrequestreview-443484151", "createdAt": "2020-07-07T00:22:46Z", "commit": {"oid": "d26dd19f2fe37d9e6b945c0d519c3580c73323c2"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "59c2753fb221629712ec42bd77a9aa7f54bf80bb", "author": {"user": {"login": "dapengzhang0", "name": "ZHANG Dapeng"}}, "url": "https://github.com/grpc/grpc-java/commit/59c2753fb221629712ec42bd77a9aa7f54bf80bb", "committedDate": "2020-07-07T00:33:44Z", "message": "reformat line break"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "89d0ca61e6712cfbebe023123cc18e789da6ae2c", "author": {"user": {"login": "dapengzhang0", "name": "ZHANG Dapeng"}}, "url": "https://github.com/grpc/grpc-java/commit/89d0ca61e6712cfbebe023123cc18e789da6ae2c", "committedDate": "2020-07-07T00:35:38Z", "message": "fix nit"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQzNDg4Mjkx", "url": "https://github.com/grpc/grpc-java/pull/7184#pullrequestreview-443488291", "createdAt": "2020-07-07T00:38:01Z", "commit": {"oid": "89d0ca61e6712cfbebe023123cc18e789da6ae2c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4294, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}