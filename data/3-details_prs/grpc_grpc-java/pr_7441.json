{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDg5NTcwMzIx", "number": 7441, "title": "xds: log raw response messages in sync context", "bodyText": "Logging raw response messages should be run in the same synchronization context as other response handling logics. Otherwise, logs for the same response message will be interleaved.\nIncluding minor cosmetic improvements.", "createdAt": "2020-09-18T22:38:01Z", "url": "https://github.com/grpc/grpc-java/pull/7441", "merged": true, "mergeCommit": {"oid": "bc8c758a3c2e3f355e81a293f3dadc965c72064a"}, "closed": true, "closedAt": "2020-09-23T00:28:46Z", "author": {"login": "voidzcy"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdKNTmRgH2gAyNDg5NTcwMzIxOjczZjgzNzUzZWNkZjEwNzM3OWFiZDhjOTUyNmQ2YmI2Y2Q2MTQyODU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdLg3tkgFqTQ5MzkxOTYxNg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "73f83753ecdf107379abd8c9526d6bb6cd614285", "author": {"user": {"login": "voidzcy", "name": "Chengyuan Zhang"}}, "url": "https://github.com/grpc/grpc-java/commit/73f83753ecdf107379abd8c9526d6bb6cd614285", "committedDate": "2020-09-18T22:26:39Z", "message": "Logging LRS raw response should be together (run by the same thread) withlogging the parsed data."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "35b3ce2943519a3fd053ccc5e0ab4322d75cef79", "author": {"user": {"login": "voidzcy", "name": "Chengyuan Zhang"}}, "url": "https://github.com/grpc/grpc-java/commit/35b3ce2943519a3fd053ccc5e0ab4322d75cef79", "committedDate": "2020-09-18T22:26:46Z", "message": "Logging xDS response should be together (run by the same thread) with logging the parsed data."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0913171088615b933fa23cbf9656fb976f7e7dcc", "author": {"user": {"login": "voidzcy", "name": "Chengyuan Zhang"}}, "url": "https://github.com/grpc/grpc-java/commit/0913171088615b933fa23cbf9656fb976f7e7dcc", "committedDate": "2020-09-18T22:31:05Z", "message": "Use implementation types for debug log messages."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b2d4c907de27afb6160fad037334253fc1be4563", "author": {"user": {"login": "voidzcy", "name": "Chengyuan Zhang"}}, "url": "https://github.com/grpc/grpc-java/commit/b2d4c907de27afb6160fad037334253fc1be4563", "committedDate": "2020-09-18T22:33:47Z", "message": "Improve method names."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkxODM1OTc4", "url": "https://github.com/grpc/grpc-java/pull/7441#pullrequestreview-491835978", "createdAt": "2020-09-18T23:57:53Z", "commit": {"oid": "b2d4c907de27afb6160fad037334253fc1be4563"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xOFQyMzo1Nzo1M1rOHUe3uA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xOFQyMzo1Nzo1M1rOHUe3uA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTIzOTM1Mg==", "bodyText": "Why change the logging message?", "url": "https://github.com/grpc/grpc-java/pull/7441#discussion_r491239352", "createdAt": "2020-09-18T23:57:53Z", "author": {"login": "dapengzhang0"}, "path": "xds/src/main/java/io/grpc/xds/XdsClientImpl.java", "diffHunk": "@@ -1737,27 +1723,40 @@ void start() {\n       StreamObserver<io.envoyproxy.envoy.api.v2.DiscoveryResponse> responseReaderV2 =\n           new StreamObserver<io.envoyproxy.envoy.api.v2.DiscoveryResponse>() {\n             @Override\n-            public void onNext(io.envoyproxy.envoy.api.v2.DiscoveryResponse response) {\n-              DiscoveryResponseData responseData =\n-                  DiscoveryResponseData.fromEnvoyProtoV2(response);\n-              if (logger.isLoggable(XdsLogLevel.DEBUG)) {\n-                logger.log(\n-                    XdsLogLevel.DEBUG,\n-                    \"Received {0} response:\\n{1}\",\n-                    responseData.getResourceType(),\n-                    respPrinter.print(response));\n-              }\n-              onDiscoveryResponse(responseData);\n+            public void onNext(final io.envoyproxy.envoy.api.v2.DiscoveryResponse response) {\n+              syncContext.execute(new Runnable() {\n+                @Override\n+                public void run() {\n+                  if (logger.isLoggable(XdsLogLevel.DEBUG)) {\n+                    logger.log(\n+                        XdsLogLevel.DEBUG,\n+                        \"Received DiscoveryResponse:\\n{0}\", respPrinter.print(response));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b2d4c907de27afb6160fad037334253fc1be4563"}, "originalPosition": 135}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c6d30f15cb009f9ab9b2d381f2c931107546f3d7", "author": {"user": {"login": "voidzcy", "name": "Chengyuan Zhang"}}, "url": "https://github.com/grpc/grpc-java/commit/c6d30f15cb009f9ab9b2d381f2c931107546f3d7", "committedDate": "2020-09-22T23:44:06Z", "message": "Format log messages."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkzOTE5NjE2", "url": "https://github.com/grpc/grpc-java/pull/7441#pullrequestreview-493919616", "createdAt": "2020-09-22T23:48:13Z", "commit": {"oid": "c6d30f15cb009f9ab9b2d381f2c931107546f3d7"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4051, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}