{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM2MTY5ODc1", "number": 7137, "title": "xds: use fallback PN if you get exception while retrieving SslContextProvider", "bodyText": "As promised in PR #7131 this takes care of default values in tlsContext", "createdAt": "2020-06-18T01:05:31Z", "url": "https://github.com/grpc/grpc-java/pull/7137", "merged": true, "mergeCommit": {"oid": "57ae04007da60fc0c64b7b3a377da8913e84b04e"}, "closed": true, "closedAt": "2020-06-18T17:08:40Z", "author": {"login": "sanjaypujare"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcsTy8-AH2gAyNDM2MTY5ODc1OjAzZGIwNThkNGYxZTcyZTI5OGQ4MzY0ODY4NWUwYjgxM2MwNzFkZjI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcshdfrAFqTQzMzQ3NTg3MA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "03db058d4f1e72e298d83648685e0b813c071df2", "author": {"user": {"login": "sanjaypujare", "name": null}}, "url": "https://github.com/grpc/grpc-java/commit/03db058d4f1e72e298d83648685e0b813c071df2", "committedDate": "2020-06-18T01:02:36Z", "message": "xds: use fallback PN if you get exception while retrieving SslContextProvider"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMyOTAwNzEy", "url": "https://github.com/grpc/grpc-java/pull/7137#pullrequestreview-432900712", "createdAt": "2020-06-18T02:37:28Z", "commit": {"oid": "03db058d4f1e72e298d83648685e0b813c071df2"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOFQwMjozNzoyOVrOGldluQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOFQwMjozODo1N1rOGldnWA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTkzNTI4OQ==", "bodyText": "does this need to run in an executor? it seems like it should be fine without it.", "url": "https://github.com/grpc/grpc-java/pull/7137#discussion_r441935289", "createdAt": "2020-06-18T02:37:29Z", "author": {"login": "creamsoup"}, "path": "xds/src/main/java/io/grpc/xds/internal/sds/SdsProtocolNegotiators.java", "diffHunk": "@@ -338,29 +344,49 @@ public void handlerAdded(ChannelHandlerContext ctx) throws Exception {\n       checkNotNull(grpcHandler, \"grpcHandler\");\n       this.grpcHandler = grpcHandler;\n       this.downstreamTlsContext = downstreamTlsContext;\n+      this.fallbackProtocolNegotiator = fallbackProtocolNegotiator;\n     }\n \n     @Override\n     protected void handlerAdded0(final ChannelHandlerContext ctx) {\n       final BufferReadsHandler bufferReads = new BufferReadsHandler();\n       ctx.pipeline().addBefore(ctx.name(), null, bufferReads);\n \n-      final SslContextProvider sslContextProvider =\n-              TlsContextManagerImpl.getInstance()\n-                      .findOrCreateServerSslContextProvider(downstreamTlsContext);\n-\n+      SslContextProvider sslContextProviderTemp = null;\n+      try {\n+        sslContextProviderTemp =\n+            TlsContextManagerImpl.getInstance()\n+                .findOrCreateServerSslContextProvider(downstreamTlsContext);\n+      } catch (Exception e) {\n+        if (fallbackProtocolNegotiator == null) {\n+          ctx.fireExceptionCaught(new CertStoreException(\"No certificate source found!\", e));\n+          return;\n+        }\n+        logger.log(Level.INFO, \"Using fallback for {0}\", ctx.channel().localAddress());\n+        // Delegate rest of handshake to fallback handler\n+        ctx.executor()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "03db058d4f1e72e298d83648685e0b813c071df2"}, "originalPosition": 55}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTkzNTcwNA==", "bodyText": "indentations are off in this test.", "url": "https://github.com/grpc/grpc-java/pull/7137#discussion_r441935704", "createdAt": "2020-06-18T02:38:57Z", "author": {"login": "creamsoup"}, "path": "xds/src/test/java/io/grpc/xds/XdsSdsClientServerTest.java", "diffHunk": "@@ -89,6 +89,18 @@ public void plaintextClientServer() throws IOException, URISyntaxException {\n     assertThat(unaryRpc(\"buddy\", blockingStub)).isEqualTo(\"Hello buddy\");\n   }\n \n+  @Test\n+  public void plaintextClientServer_withDefaultTlsContext() throws IOException, URISyntaxException {\n+    DownstreamTlsContext defaultTlsContext =\n+            EnvoyServerProtoData.DownstreamTlsContext.fromEnvoyProtoDownstreamTlsContext(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "03db058d4f1e72e298d83648685e0b813c071df2"}, "originalPosition": 7}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8b79cea9bf336289c0d670dcc498ab5713205e6a", "author": {"user": {"login": "sanjaypujare", "name": null}}, "url": "https://github.com/grpc/grpc-java/commit/8b79cea9bf336289c0d670dcc498ab5713205e6a", "committedDate": "2020-06-18T06:10:39Z", "message": "fix indentation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "eb4f4a12d7a617154c01465a147a288db1ab2b84", "author": {"user": {"login": "sanjaypujare", "name": null}}, "url": "https://github.com/grpc/grpc-java/commit/eb4f4a12d7a617154c01465a147a288db1ab2b84", "committedDate": "2020-06-18T16:47:21Z", "message": "address comments: PNE not needed and we can just call replace"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMzNDc1ODcw", "url": "https://github.com/grpc/grpc-java/pull/7137#pullrequestreview-433475870", "createdAt": "2020-06-18T16:57:50Z", "commit": {"oid": "eb4f4a12d7a617154c01465a147a288db1ab2b84"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4257, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}