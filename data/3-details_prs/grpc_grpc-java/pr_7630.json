{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTIyMTQxOTIx", "number": 7630, "title": "alts: create handshaker RPC lazily", "bodyText": "This PR fixes bug described in #7622", "createdAt": "2020-11-17T05:05:10Z", "url": "https://github.com/grpc/grpc-java/pull/7630", "merged": true, "mergeCommit": {"oid": "24e4d6828224bbda26e5207b875a7a77ab337347"}, "closed": true, "closedAt": "2020-11-18T01:36:10Z", "author": {"login": "jiangtaoli2016"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABddSTbWgH2gAyNTIyMTQxOTIxOmQyMGM0YmUyMjg4YTMwY2MxODQ2MGE2YjExYzA0YzY2NWQyM2M2MGU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABddiYX5AFqTUzMjkwNDQ4MA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "d20c4be2288a30cc18460a6b11c04c665d23c60e", "author": {"user": null}, "url": "https://github.com/grpc/grpc-java/commit/d20c4be2288a30cc18460a6b11c04c665d23c60e", "committedDate": "2020-11-17T05:00:33Z", "message": "alts: create handshaker RPC lazily"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMyNzc5NjQ0", "url": "https://github.com/grpc/grpc-java/pull/7630#pullrequestreview-532779644", "createdAt": "2020-11-17T20:22:48Z", "commit": {"oid": "d20c4be2288a30cc18460a6b11c04c665d23c60e"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xN1QyMDoyMjo0OFrOH1Jg8A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xN1QyMDoyNDoyM1rOH1Joqw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTQ5MjQ2NA==", "bodyText": "Delete this line. It does nothing. Initialization is only required for final fields. Other fields default to 0/null. Ditto below.", "url": "https://github.com/grpc/grpc-java/pull/7630#discussion_r525492464", "createdAt": "2020-11-17T20:22:48Z", "author": {"login": "ejona86"}, "path": "alts/src/main/java/io/grpc/alts/internal/AltsHandshakerStub.java", "diffHunk": "@@ -29,28 +29,29 @@\n /** An interface to the ALTS handshaker service. */\n class AltsHandshakerStub {\n   private final StreamObserver<HandshakerResp> reader = new Reader();\n-  private final StreamObserver<HandshakerReq> writer;\n+  private StreamObserver<HandshakerReq> writer;\n+  private final HandshakerServiceStub serviceStub;\n   private final ArrayBlockingQueue<Optional<HandshakerResp>> responseQueue =\n       new ArrayBlockingQueue<>(1);\n   private final AtomicReference<String> exceptionMessage = new AtomicReference<>();\n \n   private static final long HANDSHAKE_RPC_DEADLINE_SECS = 20;\n \n   AltsHandshakerStub(HandshakerServiceStub serviceStub) {\n-    this.writer =\n-        serviceStub\n-            .withDeadlineAfter(HANDSHAKE_RPC_DEADLINE_SECS, SECONDS)\n-            .doHandshake(this.reader);\n+    writer = null;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d20c4be2288a30cc18460a6b11c04c665d23c60e"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTQ5NDQ0Mw==", "bodyText": "Why is this synchronized? I don't think this class can be used from multiple callers/threads.", "url": "https://github.com/grpc/grpc-java/pull/7630#discussion_r525494443", "createdAt": "2020-11-17T20:24:23Z", "author": {"login": "ejona86"}, "path": "alts/src/main/java/io/grpc/alts/internal/AltsHandshakerStub.java", "diffHunk": "@@ -72,6 +74,14 @@ public HandshakerResp send(HandshakerReq req) throws InterruptedException, IOExc\n     return result.get();\n   }\n \n+  /** Create a new writer if the writer is null. */\n+  private synchronized void createWriterIfNull() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d20c4be2288a30cc18460a6b11c04c665d23c60e"}, "originalPosition": 48}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f15738da65d579c36e92344a7f036d8b833efa27", "author": {"user": null}, "url": "https://github.com/grpc/grpc-java/commit/f15738da65d579c36e92344a7f036d8b833efa27", "committedDate": "2020-11-17T23:41:20Z", "message": "alts: address review comments"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMyOTA0NDgw", "url": "https://github.com/grpc/grpc-java/pull/7630#pullrequestreview-532904480", "createdAt": "2020-11-17T23:44:26Z", "commit": {"oid": "f15738da65d579c36e92344a7f036d8b833efa27"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3993, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}