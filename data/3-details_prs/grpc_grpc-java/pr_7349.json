{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDcxOTA4NjA0", "number": 7349, "title": "core, alts, cronet: fix ByteBuffer covariant method usages", "bodyText": "Java 9 introduces overridden methods with covariant return types for the following methods in java.nio.ByteBuffer:\n\nposition\u200b(int newPosition)\nlimit\u200b(int newLimit)\nflip\u200b()\nclear\u200b()\nmark\u200b()\nreset\u200b()\nrewind\u200b()\n\nIn Java 9 they all now return ByteBuffer, whereas the methods they override return Buffer, resulting in exceptions like this when executing on Java 8 and lower:\njava.lang.NoSuchMethodError: java.nio.ByteBuffer.limit(I)Ljava/nio/ByteBuffer\nThis is because the generated byte code includes the static return type of the method, which is not found on Java 8 and lower because the overloaded methods with covariant return types don't exist (the issue appears even with source and target 8 or lower in compilation parameters).\nThe solution is to cast ByteBuffer instances to Buffer before calling the method.\n\nSee details in #7348.\nFixed with find-replace, I can't guarantee not missing one or two. Tweaked with animal sniffer, but seems it doesn't catch it.", "createdAt": "2020-08-22T00:44:44Z", "url": "https://github.com/grpc/grpc-java/pull/7349", "merged": true, "mergeCommit": {"oid": "c30505df041359305230fa94139deebf0aae5b71"}, "closed": true, "closedAt": "2020-08-26T00:21:35Z", "author": {"login": "voidzcy"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdBOeAGAH2gAyNDcxOTA4NjA0OjczYTJiNWEwMTIxMDNhNjNkZTBkZGM1Mzk1OTFlOWE5MDY5NTM5MjQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdCabIZgFqTQ3NDY4NjQ0OA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "73a2b5a012103a63de0ddc539591e9a906953924", "author": {"user": {"login": "voidzcy", "name": "Chengyuan Zhang"}}, "url": "https://github.com/grpc/grpc-java/commit/73a2b5a012103a63de0ddc539591e9a906953924", "committedDate": "2020-08-22T00:42:36Z", "message": "Fix core."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ac3f828d7602b5fae20389822128b50ed412283a", "author": {"user": {"login": "voidzcy", "name": "Chengyuan Zhang"}}, "url": "https://github.com/grpc/grpc-java/commit/ac3f828d7602b5fae20389822128b50ed412283a", "committedDate": "2020-08-22T00:42:47Z", "message": "Fix alts."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "84c3372db6e8e08619c559e205168c1b0dd21c3a", "author": {"user": {"login": "voidzcy", "name": "Chengyuan Zhang"}}, "url": "https://github.com/grpc/grpc-java/commit/84c3372db6e8e08619c559e205168c1b0dd21c3a", "committedDate": "2020-08-22T00:42:57Z", "message": "Fix cronet."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDcyODc5MjQ3", "url": "https://github.com/grpc/grpc-java/pull/7349#pullrequestreview-472879247", "createdAt": "2020-08-22T00:49:30Z", "commit": {"oid": "73a2b5a012103a63de0ddc539591e9a906953924"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMlQwMDo1MDoxOFrOHFBJGw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMlQwMDo1MDoxOFrOHFBJGw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTAyMzY0Mw==", "bodyText": "Why remove this comment?", "url": "https://github.com/grpc/grpc-java/pull/7349#discussion_r475023643", "createdAt": "2020-08-22T00:50:18Z", "author": {"login": "dapengzhang0"}, "path": "core/src/main/java/io/grpc/internal/CompositeReadableBuffer.java", "diffHunk": "@@ -102,18 +102,15 @@ public int readInternal(ReadableBuffer buffer, int length) {\n \n   @Override\n   public void readBytes(final ByteBuffer dest) {\n-    // Use Buffer instead of ByteBuffer for JDK 9+ compatibility.\n-    final Buffer destAsBuffer = dest;\n     execute(new ReadOperation() {\n       @Override\n       public int readInternal(ReadableBuffer buffer, int length) {\n-        // Change the limit so that only lengthToCopy bytes are available.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "73a2b5a012103a63de0ddc539591e9a906953924"}, "originalPosition": 9}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4598adc129d87d0f89b55abaca36d9da3a4ebd07", "author": {"user": {"login": "voidzcy", "name": "Chengyuan Zhang"}}, "url": "https://github.com/grpc/grpc-java/commit/4598adc129d87d0f89b55abaca36d9da3a4ebd07", "committedDate": "2020-08-22T00:58:24Z", "message": "Undo comment deletion."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc0Njg2NDQ4", "url": "https://github.com/grpc/grpc-java/pull/7349#pullrequestreview-474686448", "createdAt": "2020-08-25T17:12:15Z", "commit": {"oid": "4598adc129d87d0f89b55abaca36d9da3a4ebd07"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4189, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}