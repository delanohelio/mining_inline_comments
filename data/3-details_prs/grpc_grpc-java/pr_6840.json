{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzkwNjU4NjYw", "number": 6840, "title": "Implemented Frame Size Negotiation in ALTS for gRPC Java", "bodyText": "gRPC Java uses zero copy frame protectors, and hence are capable of handling larger frame size. Frame Size Negotiation support in ALTS, extends send frame size from 16KB to 128KB, and thereby improves performance.\nDesign Document: go/seal-frame-size-negotiation-alts", "createdAt": "2020-03-18T20:52:45Z", "url": "https://github.com/grpc/grpc-java/pull/6840", "merged": true, "mergeCommit": {"oid": "cfe73eb4846f222b87f63d168b6b030a82506182"}, "closed": true, "closedAt": "2020-04-10T20:38:47Z", "author": {"login": "ashithasantosh"}, "timelineItems": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcRRXVUAFqTM4MTYzMDc4Nw==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcWWF1ZAH2gAyMzkwNjU4NjYwOmRhMGVjOWNiNTI2NjY4NWY4Y2U0NDQ0NTJjNDcwZTY5MTk0ZDBlOWU=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgxNjMwNzg3", "url": "https://github.com/grpc/grpc-java/pull/6840#pullrequestreview-381630787", "createdAt": "2020-03-26T00:34:57Z", "commit": {"oid": "435a40c16fdea103a13ae292e58350f909183afa"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNlQwMDozNDo1N1rOF7zYRQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNlQwMDo1NDo1M1rOF7ztQQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODI1MjEwMQ==", "bodyText": "Currently max_frame_size is defined in AltsTsiFrameProtector.java.\nPlease define min/max in AltsTsiFrameProtector.java.", "url": "https://github.com/grpc/grpc-java/pull/6840#discussion_r398252101", "createdAt": "2020-03-26T00:34:57Z", "author": {"login": "jiangtaoli2016"}, "path": "alts/src/main/java/io/grpc/alts/internal/AltsHandshakerClient.java", "diffHunk": "@@ -35,6 +35,9 @@\n   private static final String APPLICATION_PROTOCOL = \"grpc\";\n   private static final String RECORD_PROTOCOL = \"ALTSRP_GCM_AES128_REKEY\";\n   private static final int KEY_LENGTH = AltsChannelCrypter.getKeyLength();\n+  // Frame size negotiation extends frame size range to [MIN_FRAME_SIZE, MAX_FRAME_SIZE].\n+  private static final int MIN_FRAME_SIZE = 16 * 1024;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "435a40c16fdea103a13ae292e58350f909183afa"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODI1NzQ3Mw==", "bodyText": "As in my other comment above, don't set maxFrameSize here.\nIf there is no frame size negotiation, use the value from parameter -- which will be the default frame size", "url": "https://github.com/grpc/grpc-java/pull/6840#discussion_r398257473", "createdAt": "2020-03-26T00:54:53Z", "author": {"login": "jiangtaoli2016"}, "path": "alts/src/main/java/io/grpc/alts/internal/AltsTsiHandshaker.java", "diffHunk": "@@ -178,6 +182,17 @@ public TsiFrameProtector createFrameProtector(int maxFrameSize, ByteBufAllocator\n     byte[] key = handshaker.getKey();\n     Preconditions.checkState(key.length == AltsChannelCrypter.getKeyLength(), \"Bad key length.\");\n \n+    // In case the peer does not send max frame size (e.g. peer is gRPC Go or peer uses an old\n+    // binary), the negotiated frame size is set to MIN_FRAME_SIZE. Otherwise, the negotiated\n+    // value is based on peer frame size. maxFrameSize parameter is ignored.\n+    maxFrameSize = AltsHandshakerClient.getMinFrameSize();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "435a40c16fdea103a13ae292e58350f909183afa"}, "originalPosition": 23}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkwMTk0NjI3", "url": "https://github.com/grpc/grpc-java/pull/6840#pullrequestreview-390194627", "createdAt": "2020-04-08T17:44:36Z", "commit": {"oid": "f1c6bf164304904fd175b945c3f7a9b493ed9751"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "da0ec9cb5266685f8ce444452c470e69194d0e9e", "author": {"user": {"login": "ashithasantosh", "name": "Ashitha Santhosh"}}, "url": "https://github.com/grpc/grpc-java/commit/da0ec9cb5266685f8ce444452c470e69194d0e9e", "committedDate": "2020-04-10T19:16:42Z", "message": "Implemented Frame Size Negotiation in ALTS for gRPC Java."}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4477, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}