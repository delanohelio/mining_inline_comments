{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTIwNTcyMjM5", "number": 7620, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNFQwMDowNDoyMVrOE43-hg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNFQwMDoxMDo0NFrOE44CwA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI4MDcyODM4OnYy", "diffSide": "LEFT", "path": "xds/src/main/java/io/grpc/xds/Bootstrapper.java", "isResolved": true, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNFQwMDowNDoyMVrOHzDVqQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNlQxNjo0NjoyMlrOH0Hmxg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzI5NDEyMQ==", "bodyText": "Technically it's not necessary to remove this and use the XdsLogger logger variable. You can just replace the hardcoded string BOOTSTRAP_PATH_SYS_ENV_VAR + \"={0}\" with a String variable which is set to either BOOTSTRAP_PATH_SYS_PROPERTY_VAR + \"={0}\" or BOOTSTRAP_PATH_SYS_ENV_VAR + \"={0}\" in your 'if-else` statement. But this also works...", "url": "https://github.com/grpc/grpc-java/pull/7620#discussion_r523294121", "createdAt": "2020-11-14T00:04:21Z", "author": {"login": "sanjaypujare"}, "path": "xds/src/main/java/io/grpc/xds/Bootstrapper.java", "diffHunk": "@@ -47,21 +47,28 @@\n \n   private static final String LOG_PREFIX = \"xds-bootstrap\";\n   private static final String BOOTSTRAP_PATH_SYS_ENV_VAR = \"GRPC_XDS_BOOTSTRAP\";\n+  private static final String BOOTSTRAP_PATH_SYS_PROPERTY_VAR = \"io.grpc.xds.bootstrap\";\n   @VisibleForTesting\n   static final String CLIENT_FEATURE_DISABLE_OVERPROVISIONING =\n       \"envoy.lb.does_not_support_overprovisioning\";\n \n   private static final Bootstrapper DEFAULT_INSTANCE = new Bootstrapper() {\n     @Override\n     public BootstrapInfo readBootstrap() throws XdsInitializationException {\n+      XdsLogger logger = XdsLogger.withPrefix(LOG_PREFIX);\n       String filePath = System.getenv(BOOTSTRAP_PATH_SYS_ENV_VAR);\n       if (filePath == null) {\n-        throw new XdsInitializationException(\n-            \"Environment variable \" + BOOTSTRAP_PATH_SYS_ENV_VAR + \" not defined.\");\n+        filePath = System.getProperty(BOOTSTRAP_PATH_SYS_PROPERTY_VAR);\n+        if (filePath == null) {\n+          throw new XdsInitializationException(\n+                  \"Environment variable \" + BOOTSTRAP_PATH_SYS_ENV_VAR\n+                  + \" or Java System Property \" + BOOTSTRAP_PATH_SYS_PROPERTY_VAR\n+                  + \" not defined.\");\n+        }\n+        logger.log(XdsLogLevel.INFO, BOOTSTRAP_PATH_SYS_PROPERTY_VAR + \"={0}\", filePath);\n+      } else {\n+        logger.log(XdsLogLevel.INFO, BOOTSTRAP_PATH_SYS_ENV_VAR + \"={0}\", filePath);\n       }\n-      XdsLogger", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f5065b51d8f71e1fcaf14f7842d6de2832f68817"}, "originalPosition": 28}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDA3NTEzMQ==", "bodyText": "Hmm, I did it like this to avoid having a temporary variable only used for the log message but maybe that's fine in this case. What about something like this?\nString filePathSource = BOOTSTRAP_PATH_SYS_ENV_VAR;\nString filePath = System.getenv(filePathSource);\nif(filePath == null) {\n  filePathSource = BOOTSTRAP_PATH_SYS_PROPERTY_VAR;\n  filePath = System.getProperty(filePathSource);\n}\nif(filePath == null) {\n  throw new XdsInitializationException(\n         \"Environment variable \" + BOOTSTRAP_PATH_SYS_ENV_VAR\n         + \" or Java System Property \" + BOOTSTRAP_PATH_SYS_PROPERTY_VAR\n         + \" not defined.\");\n} \nXdsLogger\n   .withPrefix(LOG_PREFIX)\n   .log(XdsLogLevel.INFO, filePathSource + \"={0}\", filePath);", "url": "https://github.com/grpc/grpc-java/pull/7620#discussion_r524075131", "createdAt": "2020-11-16T10:16:12Z", "author": {"login": "erikjoh"}, "path": "xds/src/main/java/io/grpc/xds/Bootstrapper.java", "diffHunk": "@@ -47,21 +47,28 @@\n \n   private static final String LOG_PREFIX = \"xds-bootstrap\";\n   private static final String BOOTSTRAP_PATH_SYS_ENV_VAR = \"GRPC_XDS_BOOTSTRAP\";\n+  private static final String BOOTSTRAP_PATH_SYS_PROPERTY_VAR = \"io.grpc.xds.bootstrap\";\n   @VisibleForTesting\n   static final String CLIENT_FEATURE_DISABLE_OVERPROVISIONING =\n       \"envoy.lb.does_not_support_overprovisioning\";\n \n   private static final Bootstrapper DEFAULT_INSTANCE = new Bootstrapper() {\n     @Override\n     public BootstrapInfo readBootstrap() throws XdsInitializationException {\n+      XdsLogger logger = XdsLogger.withPrefix(LOG_PREFIX);\n       String filePath = System.getenv(BOOTSTRAP_PATH_SYS_ENV_VAR);\n       if (filePath == null) {\n-        throw new XdsInitializationException(\n-            \"Environment variable \" + BOOTSTRAP_PATH_SYS_ENV_VAR + \" not defined.\");\n+        filePath = System.getProperty(BOOTSTRAP_PATH_SYS_PROPERTY_VAR);\n+        if (filePath == null) {\n+          throw new XdsInitializationException(\n+                  \"Environment variable \" + BOOTSTRAP_PATH_SYS_ENV_VAR\n+                  + \" or Java System Property \" + BOOTSTRAP_PATH_SYS_PROPERTY_VAR\n+                  + \" not defined.\");\n+        }\n+        logger.log(XdsLogLevel.INFO, BOOTSTRAP_PATH_SYS_PROPERTY_VAR + \"={0}\", filePath);\n+      } else {\n+        logger.log(XdsLogLevel.INFO, BOOTSTRAP_PATH_SYS_ENV_VAR + \"={0}\", filePath);\n       }\n-      XdsLogger", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzI5NDEyMQ=="}, "originalCommit": {"oid": "f5065b51d8f71e1fcaf14f7842d6de2832f68817"}, "originalPosition": 28}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDM5NDQzNQ==", "bodyText": "Sounds good. It's fine even if you don't change it since the logic is correct", "url": "https://github.com/grpc/grpc-java/pull/7620#discussion_r524394435", "createdAt": "2020-11-16T16:22:18Z", "author": {"login": "sanjaypujare"}, "path": "xds/src/main/java/io/grpc/xds/Bootstrapper.java", "diffHunk": "@@ -47,21 +47,28 @@\n \n   private static final String LOG_PREFIX = \"xds-bootstrap\";\n   private static final String BOOTSTRAP_PATH_SYS_ENV_VAR = \"GRPC_XDS_BOOTSTRAP\";\n+  private static final String BOOTSTRAP_PATH_SYS_PROPERTY_VAR = \"io.grpc.xds.bootstrap\";\n   @VisibleForTesting\n   static final String CLIENT_FEATURE_DISABLE_OVERPROVISIONING =\n       \"envoy.lb.does_not_support_overprovisioning\";\n \n   private static final Bootstrapper DEFAULT_INSTANCE = new Bootstrapper() {\n     @Override\n     public BootstrapInfo readBootstrap() throws XdsInitializationException {\n+      XdsLogger logger = XdsLogger.withPrefix(LOG_PREFIX);\n       String filePath = System.getenv(BOOTSTRAP_PATH_SYS_ENV_VAR);\n       if (filePath == null) {\n-        throw new XdsInitializationException(\n-            \"Environment variable \" + BOOTSTRAP_PATH_SYS_ENV_VAR + \" not defined.\");\n+        filePath = System.getProperty(BOOTSTRAP_PATH_SYS_PROPERTY_VAR);\n+        if (filePath == null) {\n+          throw new XdsInitializationException(\n+                  \"Environment variable \" + BOOTSTRAP_PATH_SYS_ENV_VAR\n+                  + \" or Java System Property \" + BOOTSTRAP_PATH_SYS_PROPERTY_VAR\n+                  + \" not defined.\");\n+        }\n+        logger.log(XdsLogLevel.INFO, BOOTSTRAP_PATH_SYS_PROPERTY_VAR + \"={0}\", filePath);\n+      } else {\n+        logger.log(XdsLogLevel.INFO, BOOTSTRAP_PATH_SYS_ENV_VAR + \"={0}\", filePath);\n       }\n-      XdsLogger", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzI5NDEyMQ=="}, "originalCommit": {"oid": "f5065b51d8f71e1fcaf14f7842d6de2832f68817"}, "originalPosition": 28}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDQxMjYxNA==", "bodyText": "Updated it anyway since I think it's more readable code.", "url": "https://github.com/grpc/grpc-java/pull/7620#discussion_r524412614", "createdAt": "2020-11-16T16:46:22Z", "author": {"login": "erikjoh"}, "path": "xds/src/main/java/io/grpc/xds/Bootstrapper.java", "diffHunk": "@@ -47,21 +47,28 @@\n \n   private static final String LOG_PREFIX = \"xds-bootstrap\";\n   private static final String BOOTSTRAP_PATH_SYS_ENV_VAR = \"GRPC_XDS_BOOTSTRAP\";\n+  private static final String BOOTSTRAP_PATH_SYS_PROPERTY_VAR = \"io.grpc.xds.bootstrap\";\n   @VisibleForTesting\n   static final String CLIENT_FEATURE_DISABLE_OVERPROVISIONING =\n       \"envoy.lb.does_not_support_overprovisioning\";\n \n   private static final Bootstrapper DEFAULT_INSTANCE = new Bootstrapper() {\n     @Override\n     public BootstrapInfo readBootstrap() throws XdsInitializationException {\n+      XdsLogger logger = XdsLogger.withPrefix(LOG_PREFIX);\n       String filePath = System.getenv(BOOTSTRAP_PATH_SYS_ENV_VAR);\n       if (filePath == null) {\n-        throw new XdsInitializationException(\n-            \"Environment variable \" + BOOTSTRAP_PATH_SYS_ENV_VAR + \" not defined.\");\n+        filePath = System.getProperty(BOOTSTRAP_PATH_SYS_PROPERTY_VAR);\n+        if (filePath == null) {\n+          throw new XdsInitializationException(\n+                  \"Environment variable \" + BOOTSTRAP_PATH_SYS_ENV_VAR\n+                  + \" or Java System Property \" + BOOTSTRAP_PATH_SYS_PROPERTY_VAR\n+                  + \" not defined.\");\n+        }\n+        logger.log(XdsLogLevel.INFO, BOOTSTRAP_PATH_SYS_PROPERTY_VAR + \"={0}\", filePath);\n+      } else {\n+        logger.log(XdsLogLevel.INFO, BOOTSTRAP_PATH_SYS_ENV_VAR + \"={0}\", filePath);\n       }\n-      XdsLogger", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzI5NDEyMQ=="}, "originalCommit": {"oid": "f5065b51d8f71e1fcaf14f7842d6de2832f68817"}, "originalPosition": 28}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI4MDczOTIwOnYy", "diffSide": "RIGHT", "path": "examples/example-xds/README.md", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNFQwMDoxMDo0NFrOHzDbfQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNlQxNDowNjoxMlrOH0AMUg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzI5NTYxMw==", "bodyText": "should we say something like below to be more precise?:\n...GRPC_XDS_BOOTSTRAP environment variable (preferred) or if that is not set then the io.grpc.xds.bootstrap java system property...", "url": "https://github.com/grpc/grpc-java/pull/7620#discussion_r523295613", "createdAt": "2020-11-14T00:10:44Z", "author": {"login": "sanjaypujare"}, "path": "examples/example-xds/README.md", "diffHunk": "@@ -24,8 +24,8 @@ This creates the scripts `build/install/example-xds/bin/hello-world-client-xds`\n ### Run the example without using XDS Credentials\n \n To use XDS, you should first deploy the XDS management server in your deployment environment\n-and know its name. You need to set the `GRPC_XDS_BOOTSTRAP` environment variable to point to the\n-gRPC XDS bootstrap file (see\n+and know its name. You need to set the `GRPC_XDS_BOOTSTRAP` environment variable or the `io.grpc.xds.bootstrap` java", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f5065b51d8f71e1fcaf14f7842d6de2832f68817"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDI5MTE1NA==", "bodyText": "Makes sense!\nI'll update it \ud83d\ude42", "url": "https://github.com/grpc/grpc-java/pull/7620#discussion_r524291154", "createdAt": "2020-11-16T14:06:12Z", "author": {"login": "erikjoh"}, "path": "examples/example-xds/README.md", "diffHunk": "@@ -24,8 +24,8 @@ This creates the scripts `build/install/example-xds/bin/hello-world-client-xds`\n ### Run the example without using XDS Credentials\n \n To use XDS, you should first deploy the XDS management server in your deployment environment\n-and know its name. You need to set the `GRPC_XDS_BOOTSTRAP` environment variable to point to the\n-gRPC XDS bootstrap file (see\n+and know its name. You need to set the `GRPC_XDS_BOOTSTRAP` environment variable or the `io.grpc.xds.bootstrap` java", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzI5NTYxMw=="}, "originalCommit": {"oid": "f5065b51d8f71e1fcaf14f7842d6de2832f68817"}, "originalPosition": 15}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2294, "cost": 1, "resetAt": "2021-11-12T20:28:25Z"}}}