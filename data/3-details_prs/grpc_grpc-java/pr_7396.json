{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDc5MTM5ODg2", "number": 7396, "title": "xds: make channel creds required in bootstrap file", "bodyText": "This PR only adds validation to the bootstrap file to require users specify at least one channel creds configuration.\nIn a following up PR, creating the xDS channel will select the first supported channel creds and fail (e.g., an exception thrown) to create the channel if none is supported (instead of failing back to use parent channel's channel creds). Need to clean up the interfaces for creating XdsClient/Channel.\nAlso, Ideally I am thinking about having a BootstrapException. Using IOException is not accurate here.", "createdAt": "2020-09-04T00:46:15Z", "url": "https://github.com/grpc/grpc-java/pull/7396", "merged": true, "mergeCommit": {"oid": "8ac63626c3a9221f142d58317d94835999ee1bae"}, "closed": true, "closedAt": "2020-09-11T17:08:53Z", "author": {"login": "voidzcy"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdFWjpLAH2gAyNDc5MTM5ODg2OjVhYmY4YTQwZjU1NmJkOTA2NmExNTBjYWE3ZGUxOWMzNjQ1ZDYzYTc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdHqGAsgH2gAyNDc5MTM5ODg2OjM4MTEyNDYxMjczOTMyMzI1ZmYxNzU0NmM1OTQyYWM3Yzk5ODk4MTc=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "5abf8a40f556bd9066a150caa7de19c3645d63a7", "author": {"user": {"login": "voidzcy", "name": "Chengyuan Zhang"}}, "url": "https://github.com/grpc/grpc-java/commit/5abf8a40f556bd9066a150caa7de19c3645d63a7", "committedDate": "2020-09-03T20:23:42Z", "message": "Make channel_creds required in bootstrap file."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgyMzA0NjI0", "url": "https://github.com/grpc/grpc-java/pull/7396#pullrequestreview-482304624", "createdAt": "2020-09-04T01:45:07Z", "commit": {"oid": "5abf8a40f556bd9066a150caa7de19c3645d63a7"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wNFQwMTo0NTowN1rOHM8vQg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wNFQwMTo0NTowN1rOHM8vQg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzM0MDA5OA==", "bodyText": "This is the case of type not being set as opposed to \"unknown type\".", "url": "https://github.com/grpc/grpc-java/pull/7396#discussion_r483340098", "createdAt": "2020-09-04T01:45:07Z", "author": {"login": "sanjaypujare"}, "path": "xds/src/main/java/io/grpc/xds/Bootstrapper.java", "diffHunk": "@@ -101,19 +101,19 @@ public static BootstrapInfo parseConfig(String rawData) throws IOException {\n       logger.log(XdsLogLevel.INFO, \"xDS server URI: {0}\", serverUri);\n       List<ChannelCreds> channelCredsOptions = new ArrayList<>();\n       List<?> rawChannelCredsList = JsonUtil.getList(serverConfig, \"channel_creds\");\n-      // List of channel creds is optional.\n-      if (rawChannelCredsList != null) {\n-        List<Map<String, ?>> channelCredsList = JsonUtil.checkObjectList(rawChannelCredsList);\n-        for (Map<String, ?> channelCreds : channelCredsList) {\n-          String type = JsonUtil.getString(channelCreds, \"type\");\n-          if (type == null) {\n-            throw new IOException(\"Invalid bootstrap: 'xds_servers' contains server with \"\n-                + \"unknown type 'channel_creds'.\");\n-          }\n-          logger.log(XdsLogLevel.INFO, \"Channel credentials option: {0}\", type);\n-          ChannelCreds creds = new ChannelCreds(type, JsonUtil.getObject(channelCreds, \"config\"));\n-          channelCredsOptions.add(creds);\n+      if (rawChannelCredsList == null) {\n+        throw new IOException(\"Invalid bootstrap: 'channel_creds' required\");\n+      }\n+      List<Map<String, ?>> channelCredsList = JsonUtil.checkObjectList(rawChannelCredsList);\n+      for (Map<String, ?> channelCreds : channelCredsList) {\n+        String type = JsonUtil.getString(channelCreds, \"type\");\n+        if (type == null) {\n+          throw new IOException(\"Invalid bootstrap: 'xds_servers' contains server with \"\n+              + \"unknown type 'channel_creds'.\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5abf8a40f556bd9066a150caa7de19c3645d63a7"}, "originalPosition": 24}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgyMzA2MzU2", "url": "https://github.com/grpc/grpc-java/pull/7396#pullrequestreview-482306356", "createdAt": "2020-09-04T01:51:15Z", "commit": {"oid": "5abf8a40f556bd9066a150caa7de19c3645d63a7"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wNFQwMTo1MToxNVrOHM81VA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wNFQwMTo1MToxNVrOHM81VA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzM0MTY1Mg==", "bodyText": "How about?\nif (rawChannelCredsList == null || rawChannelCredsList.isEmpty())", "url": "https://github.com/grpc/grpc-java/pull/7396#discussion_r483341652", "createdAt": "2020-09-04T01:51:15Z", "author": {"login": "sanjaypujare"}, "path": "xds/src/main/java/io/grpc/xds/Bootstrapper.java", "diffHunk": "@@ -101,19 +101,19 @@ public static BootstrapInfo parseConfig(String rawData) throws IOException {\n       logger.log(XdsLogLevel.INFO, \"xDS server URI: {0}\", serverUri);\n       List<ChannelCreds> channelCredsOptions = new ArrayList<>();\n       List<?> rawChannelCredsList = JsonUtil.getList(serverConfig, \"channel_creds\");\n-      // List of channel creds is optional.\n-      if (rawChannelCredsList != null) {\n-        List<Map<String, ?>> channelCredsList = JsonUtil.checkObjectList(rawChannelCredsList);\n-        for (Map<String, ?> channelCreds : channelCredsList) {\n-          String type = JsonUtil.getString(channelCreds, \"type\");\n-          if (type == null) {\n-            throw new IOException(\"Invalid bootstrap: 'xds_servers' contains server with \"\n-                + \"unknown type 'channel_creds'.\");\n-          }\n-          logger.log(XdsLogLevel.INFO, \"Channel credentials option: {0}\", type);\n-          ChannelCreds creds = new ChannelCreds(type, JsonUtil.getObject(channelCreds, \"config\"));\n-          channelCredsOptions.add(creds);\n+      if (rawChannelCredsList == null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5abf8a40f556bd9066a150caa7de19c3645d63a7"}, "originalPosition": 16}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d47423b72632908ae8531bf51e39762f91b2ef7c", "author": {"user": {"login": "voidzcy", "name": "Chengyuan Zhang"}}, "url": "https://github.com/grpc/grpc-java/commit/d47423b72632908ae8531bf51e39762f91b2ef7c", "committedDate": "2020-09-10T21:52:36Z", "message": "Do not allow empty list of channel creds."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg2MzczNTIy", "url": "https://github.com/grpc/grpc-java/pull/7396#pullrequestreview-486373522", "createdAt": "2020-09-10T23:17:43Z", "commit": {"oid": "d47423b72632908ae8531bf51e39762f91b2ef7c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8f760a03f2ea19185aeb11a742bf4d6c97d5c79a", "author": {"user": {"login": "voidzcy", "name": "Chengyuan Zhang"}}, "url": "https://github.com/grpc/grpc-java/commit/8f760a03f2ea19185aeb11a742bf4d6c97d5c79a", "committedDate": "2020-09-11T00:17:04Z", "message": "Fix test that has empty channel_creds"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "38112461273932325ff17546c5942ac7c9989817", "author": {"user": {"login": "voidzcy", "name": "Chengyuan Zhang"}}, "url": "https://github.com/grpc/grpc-java/commit/38112461273932325ff17546c5942ac7c9989817", "committedDate": "2020-09-11T00:17:17Z", "message": "Improve exception message."}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4026, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}