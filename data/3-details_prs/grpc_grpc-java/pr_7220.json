{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDUwMzY5MDk3", "number": 7220, "title": "xds: fix DistributorWatcher to send last updates to newly added watchers", "bodyText": "", "createdAt": "2020-07-16T17:28:20Z", "url": "https://github.com/grpc/grpc-java/pull/7220", "merged": true, "mergeCommit": {"oid": "8ab2c751500160ea37779025d345eb79577e6e14"}, "closed": true, "closedAt": "2020-07-17T18:58:31Z", "author": {"login": "sanjaypujare"}, "timelineItems": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc1ipFdgH2gAyNDUwMzY5MDk3OjNiOGFkNzg3ODFhNTdkMzY0YWMxY2IwNmJjZDZhNTQxNTJmYTUyNWI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc14VVHgH2gAyNDUwMzY5MDk3OjVjZGFjMGRhM2M1MzgxMTQ0NDY0NjYxYThjNzM3NzBlOWMzMWFkMDk=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "3b8ad78781a57d364ac1cb06bcd6a54152fa525b", "author": {"user": {"login": "sanjaypujare", "name": null}}, "url": "https://github.com/grpc/grpc-java/commit/3b8ad78781a57d364ac1cb06bcd6a54152fa525b", "committedDate": "2020-07-16T17:25:43Z", "message": "xds: fix DistributorWatcher to send last updates to newly added watchers"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUwODUyNDky", "url": "https://github.com/grpc/grpc-java/pull/7220#pullrequestreview-450852492", "createdAt": "2020-07-17T17:55:57Z", "commit": {"oid": "3b8ad78781a57d364ac1cb06bcd6a54152fa525b"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xN1QxNzo1NTo1N1rOGzcGeg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xN1QxNzo1NTo1N1rOGzcGeg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjU5MDk3MA==", "bodyText": "Maybe move the null checks to the public API updateCertificate(PrivateKey key, List<X509Certificate> certChain).", "url": "https://github.com/grpc/grpc-java/pull/7220#discussion_r456590970", "createdAt": "2020-07-17T17:55:57Z", "author": {"login": "dapengzhang0"}, "path": "xds/src/main/java/io/grpc/xds/internal/certprovider/CertificateProvider.java", "diffHunk": "@@ -47,33 +49,57 @@\n \n   @VisibleForTesting\n   static final class DistributorWatcher implements Watcher {\n+    private PrivateKey lastKey;\n+    private List<X509Certificate> lastCertChain;\n+    private List<X509Certificate> lastTrustedRoots;\n+\n     @VisibleForTesting\n     final Set<Watcher> downsstreamWatchers = new HashSet<>();\n \n     synchronized void addWatcher(Watcher watcher) {\n       downsstreamWatchers.add(watcher);\n+      if (lastKey != null && lastCertChain != null) {\n+        sendLastCertificateUpdate(watcher);\n+      }\n+      if (lastTrustedRoots != null) {\n+        sendLastTrustedRootsUpdate(watcher);\n+      }\n     }\n \n     synchronized void removeWatcher(Watcher watcher) {\n       downsstreamWatchers.remove(watcher);\n     }\n \n+    private void sendLastCertificateUpdate(Watcher watcher) {\n+      checkNotNull(lastKey, \"lastKey\");\n+      checkNotNull(lastCertChain, \"lastCertChain\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3b8ad78781a57d364ac1cb06bcd6a54152fa525b"}, "originalPosition": 36}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5cdac0da3c5381144464661a8c73770e9c31ad09", "author": {"user": {"login": "sanjaypujare", "name": null}}, "url": "https://github.com/grpc/grpc-java/commit/5cdac0da3c5381144464661a8c73770e9c31ad09", "committedDate": "2020-07-17T18:42:03Z", "message": "address comments"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4321, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}