{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDg4OTk1ODEx", "number": 7438, "title": "xds: implement fallbackProtocolNegotiator for XdsChannelBuilder", "bodyText": "", "createdAt": "2020-09-18T00:18:24Z", "url": "https://github.com/grpc/grpc-java/pull/7438", "merged": true, "mergeCommit": {"oid": "147bee81425f1b28940a31c0dc6a5053935252fa"}, "closed": true, "closedAt": "2020-09-23T17:35:02Z", "author": {"login": "sanjaypujare"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdJ6RBBAH2gAyNDg4OTk1ODExOjdmZjg5Mzg4N2Y1N2I4NDI3ZThlMmY1OTcwNDJlNWRmNmVmZmYzZGY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdLv9GugFqTQ5NDg4MzYxMg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "7ff893887f57b8427e8e2f597042e5df6efff3df", "author": {"user": {"login": "sanjaypujare", "name": null}}, "url": "https://github.com/grpc/grpc-java/commit/7ff893887f57b8427e8e2f597042e5df6efff3df", "committedDate": "2020-09-18T00:15:38Z", "message": "xds: implement fallbackProtocolNegotiator for XdsChannelBuilder"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkxNjg5Njc5", "url": "https://github.com/grpc/grpc-java/pull/7438#pullrequestreview-491689679", "createdAt": "2020-09-18T18:23:08Z", "commit": {"oid": "7ff893887f57b8427e8e2f597042e5df6efff3df"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xOFQxODoyMzowOFrOHUXf-Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xOFQxODoyMzowOFrOHUXf-Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTExODU4NQ==", "bodyText": "Why is fallback negotiator is required? Is that by design?", "url": "https://github.com/grpc/grpc-java/pull/7438#discussion_r491118585", "createdAt": "2020-09-18T18:23:08Z", "author": {"login": "dapengzhang0"}, "path": "xds/src/test/java/io/grpc/xds/internal/sds/XdsChannelBuilderTest.java", "diffHunk": "@@ -35,7 +37,19 @@ public void buildsXdsChannelBuilder() {\n     XdsChannelBuilder builder = XdsChannelBuilder.forTarget(\"localhost:8080\");\n     assertThat(builder).isNotNull();\n     assertThat(builder.delegate()).isInstanceOf(NettyChannelBuilder.class);\n+    builder = builder.fallbackProtocolNegotiator(InternalProtocolNegotiators.plaintext());\n     ManagedChannel channel = builder.build();\n     assertThat(channel).isNotNull();\n   }\n+\n+  @Test\n+  public void buildsXdsChannelBuilder_noFallbackNegotiator() {\n+    XdsChannelBuilder builder = XdsChannelBuilder.forTarget(\"localhost:8080\");\n+    try {\n+      builder.build();\n+      Assert.fail(\"no exception thrown\");\n+    } catch (NullPointerException expected) {\n+      assertThat(expected).hasMessageThat().isEqualTo(\"fallbackProtocolNegotiator\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7ff893887f57b8427e8e2f597042e5df6efff3df"}, "originalPosition": 26}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f5d38d87046f8b159101b5795490b75bd7632d4a", "author": {"user": {"login": "sanjaypujare", "name": null}}, "url": "https://github.com/grpc/grpc-java/commit/f5d38d87046f8b159101b5795490b75bd7632d4a", "committedDate": "2020-09-19T00:28:15Z", "message": "address review comment: make fallbackNegotiator optional"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkxODQzMDEx", "url": "https://github.com/grpc/grpc-java/pull/7438#pullrequestreview-491843011", "createdAt": "2020-09-19T00:50:17Z", "commit": {"oid": "f5d38d87046f8b159101b5795490b75bd7632d4a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xOVQwMDo1MDoxN1rOHUfUmw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xOVQwMDo1MDoxN1rOHUfUmw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTI0Njc0Nw==", "bodyText": "Should also mention the absence of ATTR_SSL_CONTEXT_PROVIDER_SUPPLIER attribute?", "url": "https://github.com/grpc/grpc-java/pull/7438#discussion_r491246747", "createdAt": "2020-09-19T00:50:17Z", "author": {"login": "dapengzhang0"}, "path": "xds/src/main/java/io/grpc/xds/internal/sds/SdsProtocolNegotiators.java", "diffHunk": "@@ -138,6 +137,7 @@ public ChannelHandler newHandler(GrpcHttp2ConnectionHandler grpcHandler) {\n       SslContextProviderSupplier localSslContextProviderSupplier =\n           grpcHandler.getEagAttributes().get(XdsAttributes.ATTR_SSL_CONTEXT_PROVIDER_SUPPLIER);\n       if (localSslContextProviderSupplier == null) {\n+        checkNotNull(fallbackProtocolNegotiator, \"fallbackProtocolNegotiator not set!\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f5d38d87046f8b159101b5795490b75bd7632d4a"}, "originalPosition": 12}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkzODk0NDM4", "url": "https://github.com/grpc/grpc-java/pull/7438#pullrequestreview-493894438", "createdAt": "2020-09-22T22:39:23Z", "commit": {"oid": "f5d38d87046f8b159101b5795490b75bd7632d4a"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQyMjozOToyM1rOHWOyAw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQyMjozOTo0M1rOHWOyaA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzA3Mjg5OQ==", "bodyText": "Add @Nullable?", "url": "https://github.com/grpc/grpc-java/pull/7438#discussion_r493072899", "createdAt": "2020-09-22T22:39:23Z", "author": {"login": "dapengzhang0"}, "path": "xds/src/main/java/io/grpc/xds/internal/sds/SdsProtocolNegotiators.java", "diffHunk": "@@ -108,6 +120,12 @@ public void close() {\n   @VisibleForTesting\n   static final class ClientSdsProtocolNegotiator implements ProtocolNegotiator {\n \n+    private final ProtocolNegotiator fallbackProtocolNegotiator;\n+\n+    ClientSdsProtocolNegotiator(ProtocolNegotiator fallbackProtocolNegotiator) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f5d38d87046f8b159101b5795490b75bd7632d4a"}, "originalPosition": 42}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzA3MzAwMA==", "bodyText": "Add @Nullable?", "url": "https://github.com/grpc/grpc-java/pull/7438#discussion_r493073000", "createdAt": "2020-09-22T22:39:43Z", "author": {"login": "dapengzhang0"}, "path": "xds/src/main/java/io/grpc/xds/internal/sds/SdsProtocolNegotiators.java", "diffHunk": "@@ -59,9 +59,14 @@ private SdsProtocolNegotiators() {\n \n   private static final AsciiString SCHEME = AsciiString.of(\"http\");\n \n-  /** Returns a {@link ProtocolNegotiatorFactory} to be used on {@link NettyChannelBuilder}. */\n-  public static ProtocolNegotiatorFactory clientProtocolNegotiatorFactory() {\n-    return new ClientSdsProtocolNegotiatorFactory();\n+  /**\n+   * Returns a {@link ProtocolNegotiatorFactory} to be used on {@link NettyChannelBuilder}.\n+   *\n+   * @param fallbackNegotiator protocol negotiator to use as fallback.\n+   */\n+  public static ProtocolNegotiatorFactory clientProtocolNegotiatorFactory(\n+      ProtocolNegotiator fallbackNegotiator) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f5d38d87046f8b159101b5795490b75bd7632d4a"}, "originalPosition": 13}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ef96ab08be3c7f4f761a023de3eee07b50cbee10", "author": {"user": {"login": "sanjaypujare", "name": null}}, "url": "https://github.com/grpc/grpc-java/commit/ef96ab08be3c7f4f761a023de3eee07b50cbee10", "committedDate": "2020-09-23T01:42:07Z", "message": "address review comments - round2"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk0ODgzNjEy", "url": "https://github.com/grpc/grpc-java/pull/7438#pullrequestreview-494883612", "createdAt": "2020-09-23T17:22:41Z", "commit": {"oid": "ef96ab08be3c7f4f761a023de3eee07b50cbee10"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4050, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}