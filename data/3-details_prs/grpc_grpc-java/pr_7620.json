{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTIwNTcyMjM5", "number": 7620, "title": "xds: add support for setting bootstrap file with java system property", "bodyText": "While most languages support setting environment variables during runtime,\nJava does not. In Java, the preferred approach is to use Java System Properties\nin order so specify configuration options. By checking for the existence\nof the io.grpc.xds.bootstrap property if GRPC_XDS_BOOTSTRAP is not found,\nit is possible to either supply the bootstrap location during runtime or as\na Java argument. The environment variable still takes precedence in order\nto not break any existing documentation.\nFor discussion see #7605 .", "createdAt": "2020-11-13T13:10:28Z", "url": "https://github.com/grpc/grpc-java/pull/7620", "merged": true, "mergeCommit": {"oid": "19923df1b56d562572c82496bb35a3686b13c344"}, "closed": true, "closedAt": "2020-11-16T23:45:29Z", "author": {"login": "erikjoh"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdcP-92AFqTUzMDQ4MjI0NA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABddH8gmAFqTUzMTUxNjI4NA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMwNDgyMjQ0", "url": "https://github.com/grpc/grpc-java/pull/7620#pullrequestreview-530482244", "createdAt": "2020-11-13T23:44:28Z", "commit": {"oid": "f5065b51d8f71e1fcaf14f7842d6de2832f68817"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMwNDg5Mzg2", "url": "https://github.com/grpc/grpc-java/pull/7620#pullrequestreview-530489386", "createdAt": "2020-11-14T00:04:21Z", "commit": {"oid": "f5065b51d8f71e1fcaf14f7842d6de2832f68817"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNFQwMDowNDoyMVrOHzDVqQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNFQwMDowNDoyMVrOHzDVqQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzI5NDEyMQ==", "bodyText": "Technically it's not necessary to remove this and use the XdsLogger logger variable. You can just replace the hardcoded string BOOTSTRAP_PATH_SYS_ENV_VAR + \"={0}\" with a String variable which is set to either BOOTSTRAP_PATH_SYS_PROPERTY_VAR + \"={0}\" or BOOTSTRAP_PATH_SYS_ENV_VAR + \"={0}\" in your 'if-else` statement. But this also works...", "url": "https://github.com/grpc/grpc-java/pull/7620#discussion_r523294121", "createdAt": "2020-11-14T00:04:21Z", "author": {"login": "sanjaypujare"}, "path": "xds/src/main/java/io/grpc/xds/Bootstrapper.java", "diffHunk": "@@ -47,21 +47,28 @@\n \n   private static final String LOG_PREFIX = \"xds-bootstrap\";\n   private static final String BOOTSTRAP_PATH_SYS_ENV_VAR = \"GRPC_XDS_BOOTSTRAP\";\n+  private static final String BOOTSTRAP_PATH_SYS_PROPERTY_VAR = \"io.grpc.xds.bootstrap\";\n   @VisibleForTesting\n   static final String CLIENT_FEATURE_DISABLE_OVERPROVISIONING =\n       \"envoy.lb.does_not_support_overprovisioning\";\n \n   private static final Bootstrapper DEFAULT_INSTANCE = new Bootstrapper() {\n     @Override\n     public BootstrapInfo readBootstrap() throws XdsInitializationException {\n+      XdsLogger logger = XdsLogger.withPrefix(LOG_PREFIX);\n       String filePath = System.getenv(BOOTSTRAP_PATH_SYS_ENV_VAR);\n       if (filePath == null) {\n-        throw new XdsInitializationException(\n-            \"Environment variable \" + BOOTSTRAP_PATH_SYS_ENV_VAR + \" not defined.\");\n+        filePath = System.getProperty(BOOTSTRAP_PATH_SYS_PROPERTY_VAR);\n+        if (filePath == null) {\n+          throw new XdsInitializationException(\n+                  \"Environment variable \" + BOOTSTRAP_PATH_SYS_ENV_VAR\n+                  + \" or Java System Property \" + BOOTSTRAP_PATH_SYS_PROPERTY_VAR\n+                  + \" not defined.\");\n+        }\n+        logger.log(XdsLogLevel.INFO, BOOTSTRAP_PATH_SYS_PROPERTY_VAR + \"={0}\", filePath);\n+      } else {\n+        logger.log(XdsLogLevel.INFO, BOOTSTRAP_PATH_SYS_ENV_VAR + \"={0}\", filePath);\n       }\n-      XdsLogger", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f5065b51d8f71e1fcaf14f7842d6de2832f68817"}, "originalPosition": 28}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMwNDkwODQ4", "url": "https://github.com/grpc/grpc-java/pull/7620#pullrequestreview-530490848", "createdAt": "2020-11-14T00:10:43Z", "commit": {"oid": "f5065b51d8f71e1fcaf14f7842d6de2832f68817"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNFQwMDoxMDo0NFrOHzDbfQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNFQwMDoxMDo0NFrOHzDbfQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzI5NTYxMw==", "bodyText": "should we say something like below to be more precise?:\n...GRPC_XDS_BOOTSTRAP environment variable (preferred) or if that is not set then the io.grpc.xds.bootstrap java system property...", "url": "https://github.com/grpc/grpc-java/pull/7620#discussion_r523295613", "createdAt": "2020-11-14T00:10:44Z", "author": {"login": "sanjaypujare"}, "path": "examples/example-xds/README.md", "diffHunk": "@@ -24,8 +24,8 @@ This creates the scripts `build/install/example-xds/bin/hello-world-client-xds`\n ### Run the example without using XDS Credentials\n \n To use XDS, you should first deploy the XDS management server in your deployment environment\n-and know its name. You need to set the `GRPC_XDS_BOOTSTRAP` environment variable to point to the\n-gRPC XDS bootstrap file (see\n+and know its name. You need to set the `GRPC_XDS_BOOTSTRAP` environment variable or the `io.grpc.xds.bootstrap` java", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f5065b51d8f71e1fcaf14f7842d6de2832f68817"}, "originalPosition": 15}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMwNDkxMDIz", "url": "https://github.com/grpc/grpc-java/pull/7620#pullrequestreview-530491023", "createdAt": "2020-11-14T00:11:30Z", "commit": {"oid": "f5065b51d8f71e1fcaf14f7842d6de2832f68817"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6ff16a0ae84f7d996b24f181140cfdfb654f534a", "author": {"user": {"login": "erikjoh", "name": "Erik Johansson"}}, "url": "https://github.com/grpc/grpc-java/commit/6ff16a0ae84f7d996b24f181140cfdfb654f534a", "committedDate": "2020-11-16T16:42:31Z", "message": "xds: add support for setting bootstrap file with java system property\n\nWhile most languages support setting environment variables during runtime,\nJava does not. In Java, the preferred approach is to use Java System Properties\nin order so specify configuration options. By checking for the existence\nof the io.grpc.xds.bootstrap property if GRPC_XDS_BOOTSTRAP is not found,\nit is possible to either supply the bootstrap location during runtime or as\na Java argument. The environment variable still takes precedence in order\nto not break any existing documentation."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f5065b51d8f71e1fcaf14f7842d6de2832f68817", "author": {"user": {"login": "erikjoh", "name": "Erik Johansson"}}, "url": "https://github.com/grpc/grpc-java/commit/f5065b51d8f71e1fcaf14f7842d6de2832f68817", "committedDate": "2020-11-13T12:57:51Z", "message": "xds: add support for setting bootstrap file with java system property\n\nWhile most languages support setting environment variables during runtime,\nJava does not. In Java, the preferred approach is to use Java System Properties\nin order so specify configuration options. By checking for the existence\nof the io.grpc.xds.bootstrap property if GRPC_XDS_BOOTSTRAP is not found,\nit is possible to either supply the bootstrap location during runtime or as\na Java argument. The environment variable still takes precedence in order\nto not break any existing documentation."}, "afterCommit": {"oid": "6ff16a0ae84f7d996b24f181140cfdfb654f534a", "author": {"user": {"login": "erikjoh", "name": "Erik Johansson"}}, "url": "https://github.com/grpc/grpc-java/commit/6ff16a0ae84f7d996b24f181140cfdfb654f534a", "committedDate": "2020-11-16T16:42:31Z", "message": "xds: add support for setting bootstrap file with java system property\n\nWhile most languages support setting environment variables during runtime,\nJava does not. In Java, the preferred approach is to use Java System Properties\nin order so specify configuration options. By checking for the existence\nof the io.grpc.xds.bootstrap property if GRPC_XDS_BOOTSTRAP is not found,\nit is possible to either supply the bootstrap location during runtime or as\na Java argument. The environment variable still takes precedence in order\nto not break any existing documentation."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMxNTE2Mjg0", "url": "https://github.com/grpc/grpc-java/pull/7620#pullrequestreview-531516284", "createdAt": "2020-11-16T16:56:28Z", "commit": {"oid": "6ff16a0ae84f7d996b24f181140cfdfb654f534a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3989, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}