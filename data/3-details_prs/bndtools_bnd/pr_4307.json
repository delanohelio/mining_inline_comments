{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDgzMzI3OTY2", "number": 4307, "title": "BndrunContainer incorrectly assumes artifactId == osgi.identity", "bodyText": "fixes #4189\nSigned-off-by: Raymond Aug\u00e9 raymond.auge@liferay.com", "createdAt": "2020-09-10T03:31:22Z", "url": "https://github.com/bndtools/bnd/pull/4307", "merged": true, "mergeCommit": {"oid": "a6b5870cd9aff239eb5f56fb0de7f8b5e7532c9e"}, "closed": true, "closedAt": "2020-09-10T17:56:36Z", "author": {"login": "rotty3000"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdHgvn0gFqTQ4NTkxOTQxMg==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdHkpQYgFqTQ4NjE3NzQwMA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg1OTE5NDEy", "url": "https://github.com/bndtools/bnd/pull/4307#pullrequestreview-485919412", "createdAt": "2020-09-10T13:18:29Z", "commit": {"oid": "df37bdc459793a9d88a525df3b55a2d13cc4c202"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMFQxMzoxODoyOVrOHPzItg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMFQxMzoxODoyOVrOHPzItg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjMyODUwMg==", "bodyText": "This is kind of expensive as it will read the entire jar when all you need is the manifest. It is less costly to use Bnd Domain class (Domain.domain(File)) to process the manifest and get the BSN.\n\n  \n    \n      bnd/biz.aQute.bndlib/src/aQute/bnd/osgi/Domain.java\n    \n    \n        Lines 509 to 519\n      in\n      aea111f\n    \n    \n    \n    \n\n        \n          \n           // default & last. Assume JAR \n        \n\n        \n          \n           try (JarFile jf = new JarFile(file, false)) { \n        \n\n        \n          \n           \tManifest m = jf.getManifest(); \n        \n\n        \n          \n           \tif (m != null) { \n        \n\n        \n          \n           \t\tDomain domain = domain(m); \n        \n\n        \n          \n           \t\tJarEntry entry = jf.getJarEntry(domain.getLocalization()); \n        \n\n        \n          \n           \t\tif (entry != null) { \n        \n\n        \n          \n           \t\t\tdomain.translation.load(jf.getInputStream(entry)); \n        \n\n        \n          \n           \t\t} \n        \n\n        \n          \n           \t\treturn domain; \n        \n\n        \n          \n           \t}", "url": "https://github.com/bndtools/bnd/pull/4307#discussion_r486328502", "createdAt": "2020-09-10T13:18:29Z", "author": {"login": "bjhargrave"}, "path": "biz.aQute.bnd.maven/src/aQute/bnd/maven/lib/resolve/BndrunContainer.java", "diffHunk": "@@ -262,9 +263,19 @@ public void setRunrequiresFromProjectArtifact(Run run) {\n \t\t\t&& (project.getPlugin(\"biz.aQute.bnd:bnd-maven-plugin\") != null)) {\n \n \t\t\tArtifact artifact = project.getArtifact();\n+\t\t\tString bsn = artifact.getArtifactId();\n+\n+\t\t\ttry (Jar jar = new Jar(artifact.getFile())) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "df37bdc459793a9d88a525df3b55a2d13cc4c202"}, "originalPosition": 14}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "df37bdc459793a9d88a525df3b55a2d13cc4c202", "author": {"user": {"login": "rotty3000", "name": "Raymond Aug\u00e9"}}, "url": "https://github.com/bndtools/bnd/commit/df37bdc459793a9d88a525df3b55a2d13cc4c202", "committedDate": "2020-09-10T03:30:58Z", "message": "BndrunContainer incorrectly assumes artifactId == osgi.identity\n\nfixes #4189\n\nSigned-off-by: Raymond Aug\u00e9 <raymond.auge@liferay.com>"}, "afterCommit": {"oid": "8beb810e77725f50e1716d8fd8faf89a6a0f3c18", "author": {"user": {"login": "rotty3000", "name": "Raymond Aug\u00e9"}}, "url": "https://github.com/bndtools/bnd/commit/8beb810e77725f50e1716d8fd8faf89a6a0f3c18", "committedDate": "2020-09-10T16:32:53Z", "message": "BndrunContainer incorrectly assumes artifactId == osgi.identity\n\nfixes #4189\n\nSigned-off-by: Raymond Aug\u00e9 <raymond.auge@liferay.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg2MTIzMTcz", "url": "https://github.com/bndtools/bnd/pull/4307#pullrequestreview-486123173", "createdAt": "2020-09-10T16:44:10Z", "commit": {"oid": "8beb810e77725f50e1716d8fd8faf89a6a0f3c18"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMFQxNjo0NDoxMFrOHP8zrQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMFQxNjo0NToyNFrOHP820w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjQ4Njk1Nw==", "bodyText": "getBundleSymbolicName can return null. Are you counting on the NPE from of ending up in the catch block?", "url": "https://github.com/bndtools/bnd/pull/4307#discussion_r486486957", "createdAt": "2020-09-10T16:44:10Z", "author": {"login": "bjhargrave"}, "path": "biz.aQute.bnd.maven/src/aQute/bnd/maven/lib/resolve/BndrunContainer.java", "diffHunk": "@@ -263,8 +265,22 @@ public void setRunrequiresFromProjectArtifact(Run run) {\n \n \t\t\tArtifact artifact = project.getArtifact();\n \n+\t\t\tString bsn = artifact.getArtifactId();\n+\n+\t\t\ttry {\n+\t\t\t\tDomain domain = Domain.domain(artifact.getFile());\n+\n+\t\t\t\tbsn = Optional.of(domain.getBundleSymbolicName())", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8beb810e77725f50e1716d8fd8faf89a6a0f3c18"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjQ4NzE3Mw==", "bodyText": ".orElseGet(artifact::getArtifactId)", "url": "https://github.com/bndtools/bnd/pull/4307#discussion_r486487173", "createdAt": "2020-09-10T16:44:34Z", "author": {"login": "bjhargrave"}, "path": "biz.aQute.bnd.maven/src/aQute/bnd/maven/lib/resolve/BndrunContainer.java", "diffHunk": "@@ -263,8 +265,22 @@ public void setRunrequiresFromProjectArtifact(Run run) {\n \n \t\t\tArtifact artifact = project.getArtifact();\n \n+\t\t\tString bsn = artifact.getArtifactId();\n+\n+\t\t\ttry {\n+\t\t\t\tDomain domain = Domain.domain(artifact.getFile());\n+\n+\t\t\t\tbsn = Optional.of(domain.getBundleSymbolicName())\n+\t\t\t\t\t.map(Map.Entry::getKey)\n+\t\t\t\t\t.orElseGet(() -> artifact.getArtifactId());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8beb810e77725f50e1716d8fd8faf89a6a0f3c18"}, "originalPosition": 27}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjQ4Nzc2Mw==", "bodyText": "domain can be null. Are you counting on the NPE dereferencing domain ending up in the catch block?", "url": "https://github.com/bndtools/bnd/pull/4307#discussion_r486487763", "createdAt": "2020-09-10T16:45:24Z", "author": {"login": "bjhargrave"}, "path": "biz.aQute.bnd.maven/src/aQute/bnd/maven/lib/resolve/BndrunContainer.java", "diffHunk": "@@ -263,8 +265,22 @@ public void setRunrequiresFromProjectArtifact(Run run) {\n \n \t\t\tArtifact artifact = project.getArtifact();\n \n+\t\t\tString bsn = artifact.getArtifactId();\n+\n+\t\t\ttry {\n+\t\t\t\tDomain domain = Domain.domain(artifact.getFile());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8beb810e77725f50e1716d8fd8faf89a6a0f3c18"}, "originalPosition": 23}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "45b92188799dba623de7510c59d7c8394ca404f4", "author": {"user": {"login": "rotty3000", "name": "Raymond Aug\u00e9"}}, "url": "https://github.com/bndtools/bnd/commit/45b92188799dba623de7510c59d7c8394ca404f4", "committedDate": "2020-09-10T17:17:59Z", "message": "BndrunContainer incorrectly assumes artifactId == osgi.identity\n\nfixes #4189\n\nSigned-off-by: Raymond Aug\u00e9 <raymond.auge@liferay.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "8beb810e77725f50e1716d8fd8faf89a6a0f3c18", "author": {"user": {"login": "rotty3000", "name": "Raymond Aug\u00e9"}}, "url": "https://github.com/bndtools/bnd/commit/8beb810e77725f50e1716d8fd8faf89a6a0f3c18", "committedDate": "2020-09-10T16:32:53Z", "message": "BndrunContainer incorrectly assumes artifactId == osgi.identity\n\nfixes #4189\n\nSigned-off-by: Raymond Aug\u00e9 <raymond.auge@liferay.com>"}, "afterCommit": {"oid": "45b92188799dba623de7510c59d7c8394ca404f4", "author": {"user": {"login": "rotty3000", "name": "Raymond Aug\u00e9"}}, "url": "https://github.com/bndtools/bnd/commit/45b92188799dba623de7510c59d7c8394ca404f4", "committedDate": "2020-09-10T17:17:59Z", "message": "BndrunContainer incorrectly assumes artifactId == osgi.identity\n\nfixes #4189\n\nSigned-off-by: Raymond Aug\u00e9 <raymond.auge@liferay.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg2MTc3NDAw", "url": "https://github.com/bndtools/bnd/pull/4307#pullrequestreview-486177400", "createdAt": "2020-09-10T17:56:21Z", "commit": {"oid": "45b92188799dba623de7510c59d7c8394ca404f4"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3102, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}