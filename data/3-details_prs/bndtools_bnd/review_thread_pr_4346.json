{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTAwNDUwNDQ0", "number": 4346, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yN1QxMzoyODowOVrOEyWe5g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yN1QxMzoyODowOVrOEyWe5g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIxMjMyNjE0OnYy", "diffSide": "RIGHT", "path": "biz.aQute.launcher/src/aQute/launcher/Launcher.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yN1QxMzoyODowOVrOHo8IJg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOFQxMzowNTo1NFrOHppAcQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjY5MDIxNA==", "bodyText": "This should not be an instance variable. You should not reuse the Hashtable across service calls. Create a new Hashtable and populated it at each place you make a service call.", "url": "https://github.com/bndtools/bnd/pull/4346#discussion_r512690214", "createdAt": "2020-10-27T13:28:09Z", "author": {"login": "bjhargrave"}, "path": "biz.aQute.launcher/src/aQute/launcher/Launcher.java", "diffHunk": "@@ -121,6 +122,9 @@\n \tprivate boolean\t\t\t\t\t\t\trestart\t\t\t\t\t= false;\n \tprivate boolean\t\t\t\t\t\t\tframeworkInited\t\t\t= false;\n \n+\tprivate ServiceRegistration<?>\t\t\tlauncherServiceRegistraion;\n+\tprivate Hashtable<String, Object>\t\tlauncherServiceProperties;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e865fb5b6ecaf75dd73890c0fe80ba87b334f81f"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzIxOTI4OA==", "bodyText": "@bjhargrave I'll change it, but I'm unsure for the reason for it. I know that there had been issues in the past, because of service props that contained certain kinds of lists. besides this, we use this pattern in felix and equinox for years and it works like a charm. Can you elaborate some more?", "url": "https://github.com/bndtools/bnd/pull/4346#discussion_r513219288", "createdAt": "2020-10-28T07:05:46Z", "author": {"login": "juergen-albert"}, "path": "biz.aQute.launcher/src/aQute/launcher/Launcher.java", "diffHunk": "@@ -121,6 +122,9 @@\n \tprivate boolean\t\t\t\t\t\t\trestart\t\t\t\t\t= false;\n \tprivate boolean\t\t\t\t\t\t\tframeworkInited\t\t\t= false;\n \n+\tprivate ServiceRegistration<?>\t\t\tlauncherServiceRegistraion;\n+\tprivate Hashtable<String, Object>\t\tlauncherServiceProperties;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjY5MDIxNA=="}, "originalCommit": {"oid": "e865fb5b6ecaf75dd73890c0fe80ba87b334f81f"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzQyNTUyMQ==", "bodyText": "It is not clear in the registerService method who owns the Dictionary after the call. So the safest course is to assume the Dictionary cannot be reused and is owned by the framework. I recall that Tom Watson encountered some code where they reused the Dictionary and encountered side effects (probably because of mutated values such as collections). So we should always be safe and not reuse the Dictionary and any values.", "url": "https://github.com/bndtools/bnd/pull/4346#discussion_r513425521", "createdAt": "2020-10-28T13:05:54Z", "author": {"login": "bjhargrave"}, "path": "biz.aQute.launcher/src/aQute/launcher/Launcher.java", "diffHunk": "@@ -121,6 +122,9 @@\n \tprivate boolean\t\t\t\t\t\t\trestart\t\t\t\t\t= false;\n \tprivate boolean\t\t\t\t\t\t\tframeworkInited\t\t\t= false;\n \n+\tprivate ServiceRegistration<?>\t\t\tlauncherServiceRegistraion;\n+\tprivate Hashtable<String, Object>\t\tlauncherServiceProperties;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjY5MDIxNA=="}, "originalCommit": {"oid": "e865fb5b6ecaf75dd73890c0fe80ba87b334f81f"}, "originalPosition": 13}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1330, "cost": 1, "resetAt": "2021-11-12T13:16:51Z"}}}