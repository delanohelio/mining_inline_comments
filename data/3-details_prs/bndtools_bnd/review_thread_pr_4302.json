{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDgyMTk5MjM4", "number": 4302, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOFQxNzo0NTowN1rOEhWhjQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOFQxNzo0NTowN1rOEhWhjQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAzNDA3NTAxOnYy", "diffSide": "RIGHT", "path": "bndtools.m2e/src/bndtools/m2e/BndConfigurator.java", "isResolved": false, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOFQxNzo0NTowN1rOHOntVQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOFQxNzo1MTo0MVrOHOn7Cg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTA5MjY5Mw==", "bodyText": "Doesn't this lose checking executions for different target directories as the removed comment says?", "url": "https://github.com/bndtools/bnd/pull/4302#discussion_r485092693", "createdAt": "2020-09-08T17:45:07Z", "author": {"login": "bjhargrave"}, "path": "bndtools.m2e/src/bndtools/m2e/BndConfigurator.java", "diffHunk": "@@ -145,20 +150,15 @@ public AbstractBuildParticipant getBuildParticipant(final IMavenProjectFacade pr\n \t\t\t\t\treturn build;\n \t\t\t\t}\n \n-\t\t\t\t// There might be more than one bnd-maven-plugin execution on\n-\t\t\t\t// any single project. An example of this would be bundling test\n-\t\t\t\t// classes. However, each such execution would be pointing at a\n-\t\t\t\t// particular output directory, for example:\n-\t\t\t\t//\n-\t\t\t\t// ${project.build.outputDirectory}\n-\t\t\t\t// vs.\n-\t\t\t\t// ${project.build.testOutputDirectory}\n-\t\t\t\t//\n-\t\t\t\t// With that in mind the scope of detectable changes needs to be\n-\t\t\t\t// limited to the actual output directory associated with the\n-\t\t\t\t// plugin by reading the classesDir property.\n-\t\t\t\tfinal File classesDir = maven.getMojoParameterValue(projectFacade.getMavenProject(), execution,\n-\t\t\t\t\t\"classesDir\", File.class, monitor);\n+\n+\t\t\t\tSet<IPath> deltaFilePaths = collectResourceDeltas(getDelta(project)).map(IResourceDelta::getResource)\n+\t\t\t\t\t.filter(IFile.class::isInstance)\n+\t\t\t\t\t.map(IResource::getFullPath)\n+\t\t\t\t\t.collect(Collectors.toSet());\n+\n+\t\t\t\tfinal String targetDirectory = projectFacade.getMavenProject()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f84dad8e1d2404a00e6d5922b2c7a50ff2cb1637"}, "originalPosition": 49}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTA5NTE0OA==", "bodyText": "Yes. I discussed with Ray and he agreed this more \"course grained\" approach would be ok provided we didn't hit the \"infinite build\" loop problem, which I have tried to address with the new resource delta check.", "url": "https://github.com/bndtools/bnd/pull/4302#discussion_r485095148", "createdAt": "2020-09-08T17:49:49Z", "author": {"login": "gamerson"}, "path": "bndtools.m2e/src/bndtools/m2e/BndConfigurator.java", "diffHunk": "@@ -145,20 +150,15 @@ public AbstractBuildParticipant getBuildParticipant(final IMavenProjectFacade pr\n \t\t\t\t\treturn build;\n \t\t\t\t}\n \n-\t\t\t\t// There might be more than one bnd-maven-plugin execution on\n-\t\t\t\t// any single project. An example of this would be bundling test\n-\t\t\t\t// classes. However, each such execution would be pointing at a\n-\t\t\t\t// particular output directory, for example:\n-\t\t\t\t//\n-\t\t\t\t// ${project.build.outputDirectory}\n-\t\t\t\t// vs.\n-\t\t\t\t// ${project.build.testOutputDirectory}\n-\t\t\t\t//\n-\t\t\t\t// With that in mind the scope of detectable changes needs to be\n-\t\t\t\t// limited to the actual output directory associated with the\n-\t\t\t\t// plugin by reading the classesDir property.\n-\t\t\t\tfinal File classesDir = maven.getMojoParameterValue(projectFacade.getMavenProject(), execution,\n-\t\t\t\t\t\"classesDir\", File.class, monitor);\n+\n+\t\t\t\tSet<IPath> deltaFilePaths = collectResourceDeltas(getDelta(project)).map(IResourceDelta::getResource)\n+\t\t\t\t\t.filter(IFile.class::isInstance)\n+\t\t\t\t\t.map(IResource::getFullPath)\n+\t\t\t\t\t.collect(Collectors.toSet());\n+\n+\t\t\t\tfinal String targetDirectory = projectFacade.getMavenProject()", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTA5MjY5Mw=="}, "originalCommit": {"oid": "f84dad8e1d2404a00e6d5922b2c7a50ff2cb1637"}, "originalPosition": 49}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTA5NTY2NQ==", "bodyText": "@bjhargrave you might be right, but @gamerson and I discussed this and this change solves some problems that @kriegfrj reported and it's on me to test if this breaks the use case I documented in the comment.", "url": "https://github.com/bndtools/bnd/pull/4302#discussion_r485095665", "createdAt": "2020-09-08T17:50:44Z", "author": {"login": "rotty3000"}, "path": "bndtools.m2e/src/bndtools/m2e/BndConfigurator.java", "diffHunk": "@@ -145,20 +150,15 @@ public AbstractBuildParticipant getBuildParticipant(final IMavenProjectFacade pr\n \t\t\t\t\treturn build;\n \t\t\t\t}\n \n-\t\t\t\t// There might be more than one bnd-maven-plugin execution on\n-\t\t\t\t// any single project. An example of this would be bundling test\n-\t\t\t\t// classes. However, each such execution would be pointing at a\n-\t\t\t\t// particular output directory, for example:\n-\t\t\t\t//\n-\t\t\t\t// ${project.build.outputDirectory}\n-\t\t\t\t// vs.\n-\t\t\t\t// ${project.build.testOutputDirectory}\n-\t\t\t\t//\n-\t\t\t\t// With that in mind the scope of detectable changes needs to be\n-\t\t\t\t// limited to the actual output directory associated with the\n-\t\t\t\t// plugin by reading the classesDir property.\n-\t\t\t\tfinal File classesDir = maven.getMojoParameterValue(projectFacade.getMavenProject(), execution,\n-\t\t\t\t\t\"classesDir\", File.class, monitor);\n+\n+\t\t\t\tSet<IPath> deltaFilePaths = collectResourceDeltas(getDelta(project)).map(IResourceDelta::getResource)\n+\t\t\t\t\t.filter(IFile.class::isInstance)\n+\t\t\t\t\t.map(IResource::getFullPath)\n+\t\t\t\t\t.collect(Collectors.toSet());\n+\n+\t\t\t\tfinal String targetDirectory = projectFacade.getMavenProject()", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTA5MjY5Mw=="}, "originalCommit": {"oid": "f84dad8e1d2404a00e6d5922b2c7a50ff2cb1637"}, "originalPosition": 49}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTA5NjIwMg==", "bodyText": "OK, as long as you got this! :-)", "url": "https://github.com/bndtools/bnd/pull/4302#discussion_r485096202", "createdAt": "2020-09-08T17:51:41Z", "author": {"login": "bjhargrave"}, "path": "bndtools.m2e/src/bndtools/m2e/BndConfigurator.java", "diffHunk": "@@ -145,20 +150,15 @@ public AbstractBuildParticipant getBuildParticipant(final IMavenProjectFacade pr\n \t\t\t\t\treturn build;\n \t\t\t\t}\n \n-\t\t\t\t// There might be more than one bnd-maven-plugin execution on\n-\t\t\t\t// any single project. An example of this would be bundling test\n-\t\t\t\t// classes. However, each such execution would be pointing at a\n-\t\t\t\t// particular output directory, for example:\n-\t\t\t\t//\n-\t\t\t\t// ${project.build.outputDirectory}\n-\t\t\t\t// vs.\n-\t\t\t\t// ${project.build.testOutputDirectory}\n-\t\t\t\t//\n-\t\t\t\t// With that in mind the scope of detectable changes needs to be\n-\t\t\t\t// limited to the actual output directory associated with the\n-\t\t\t\t// plugin by reading the classesDir property.\n-\t\t\t\tfinal File classesDir = maven.getMojoParameterValue(projectFacade.getMavenProject(), execution,\n-\t\t\t\t\t\"classesDir\", File.class, monitor);\n+\n+\t\t\t\tSet<IPath> deltaFilePaths = collectResourceDeltas(getDelta(project)).map(IResourceDelta::getResource)\n+\t\t\t\t\t.filter(IFile.class::isInstance)\n+\t\t\t\t\t.map(IResource::getFullPath)\n+\t\t\t\t\t.collect(Collectors.toSet());\n+\n+\t\t\t\tfinal String targetDirectory = projectFacade.getMavenProject()", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTA5MjY5Mw=="}, "originalCommit": {"oid": "f84dad8e1d2404a00e6d5922b2c7a50ff2cb1637"}, "originalPosition": 49}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1311, "cost": 1, "resetAt": "2021-11-12T13:16:51Z"}}}