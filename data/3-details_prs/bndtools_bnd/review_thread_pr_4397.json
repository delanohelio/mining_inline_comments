{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE2MDE3MTEx", "number": 4397, "reviewThreads": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNlQxMzozMjozNlrOE2FmAQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNlQxNDoxNDoyM1rOE5gYrA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI1MTUwMjA5OnYy", "diffSide": "RIGHT", "path": "biz.aQute.bndlib/src/aQute/bnd/build/ProjectBuilder.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNlQxMzozMjozNlrOHuuJ7A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMVQxOTowNDozOVrOHxaeEA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODc1Mjc0OA==", "bodyText": "So why not remove it instead of passing the buck to the future with a comment? :-)", "url": "https://github.com/bndtools/bnd/pull/4397#discussion_r518752748", "createdAt": "2020-11-06T13:32:36Z", "author": {"login": "bjhargrave"}, "path": "biz.aQute.bndlib/src/aQute/bnd/build/ProjectBuilder.java", "diffHunk": "@@ -593,6 +593,7 @@ private boolean isMaster(InfoRepository repo, String bsn, Version v) throws Exce\n \t\treturn descriptor.phase == Phase.MASTER;\n \t}\n \n+\t// TODO: Needs to be removed. We allready have this method", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "18bd0c0fb5ca9b9300fd56c121861886458dd3bf"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTU3NTk1Mg==", "bodyText": "Right you are. I accidentally committed the comment. Fixed it. I hope you don't mind that I did it in this PR.", "url": "https://github.com/bndtools/bnd/pull/4397#discussion_r521575952", "createdAt": "2020-11-11T19:04:39Z", "author": {"login": "juergen-albert"}, "path": "biz.aQute.bndlib/src/aQute/bnd/build/ProjectBuilder.java", "diffHunk": "@@ -593,6 +593,7 @@ private boolean isMaster(InfoRepository repo, String bsn, Version v) throws Exce\n \t\treturn descriptor.phase == Phase.MASTER;\n \t}\n \n+\t// TODO: Needs to be removed. We allready have this method", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODc1Mjc0OA=="}, "originalCommit": {"oid": "18bd0c0fb5ca9b9300fd56c121861886458dd3bf"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI1MTUwNjcxOnYy", "diffSide": "LEFT", "path": "biz.aQute.repository/src/aQute/bnd/repository/maven/provider/MavenBndRepository.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNlQxMzozNDowMVrOHuuMxg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMVQxOTowMzoyNVrOHxabnA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODc1MzQ3OA==", "bodyText": "Why not just use flattened properties? It is big deal to change all these API from getting a Properties object to get a Processor object. I am not sure that is a great idea.\nIf flattened properties do not work, then I would suggest we implement a Properties subclass which wraps a Processor and pass that.", "url": "https://github.com/bndtools/bnd/pull/4397#discussion_r518753478", "createdAt": "2020-11-06T13:34:01Z", "author": {"login": "bjhargrave"}, "path": "biz.aQute.repository/src/aQute/bnd/repository/maven/provider/MavenBndRepository.java", "diffHunk": "@@ -194,7 +194,7 @@ public PutResult put(InputStream stream, PutOptions options) throws Exception {\n \t\t\t\t}\n \n \t\t\t\tlogger.debug(\"Put release {}\", pom.getRevision());\n-\t\t\t\ttry (Release releaser = storage.release(pom.getRevision(), options.context.getProperties())) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "18bd0c0fb5ca9b9300fd56c121861886458dd3bf"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTU3NTMyNA==", "bodyText": "true that. Much easier solution!", "url": "https://github.com/bndtools/bnd/pull/4397#discussion_r521575324", "createdAt": "2020-11-11T19:03:25Z", "author": {"login": "juergen-albert"}, "path": "biz.aQute.repository/src/aQute/bnd/repository/maven/provider/MavenBndRepository.java", "diffHunk": "@@ -194,7 +194,7 @@ public PutResult put(InputStream stream, PutOptions options) throws Exception {\n \t\t\t\t}\n \n \t\t\t\tlogger.debug(\"Put release {}\", pom.getRevision());\n-\t\t\t\ttry (Release releaser = storage.release(pom.getRevision(), options.context.getProperties())) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODc1MzQ3OA=="}, "originalCommit": {"oid": "18bd0c0fb5ca9b9300fd56c121861886458dd3bf"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI3MzI1MzU5OnYy", "diffSide": "RIGHT", "path": "biz.aQute.bndlib/src/aQute/bnd/build/Project.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMlQxMzozMTowNVrOHx610A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMlQxMzozMTowNVrOHx610A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjEwNjMyMA==", "bodyText": "I don't think this needs to be public, just not private. So use default (package-private access).", "url": "https://github.com/bndtools/bnd/pull/4397#discussion_r522106320", "createdAt": "2020-11-12T13:31:05Z", "author": {"login": "bjhargrave"}, "path": "biz.aQute.bndlib/src/aQute/bnd/build/Project.java", "diffHunk": "@@ -1146,7 +1146,7 @@ private URI releaseRepo(RepositoryPlugin releaseRepo, Processor context, String\n \t\t}\n \t}\n \n-\tprivate List<RepositoryPlugin> getReleaseRepos(String names) {\n+\tpublic List<RepositoryPlugin> getReleaseRepos(String names) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fca22f9767b18ba3f8d2cae76d5d6e1edefeaad8"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI3MzI1NTczOnYy", "diffSide": "RIGHT", "path": "biz.aQute.bndlib/src/aQute/bnd/build/package-info.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMlQxMzozMTozN1rOHx63IQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMlQxMzozMTozN1rOHx63IQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjEwNjY1Nw==", "bodyText": "Don't need this since we don't make the method public.", "url": "https://github.com/bndtools/bnd/pull/4397#discussion_r522106657", "createdAt": "2020-11-12T13:31:37Z", "author": {"login": "bjhargrave"}, "path": "biz.aQute.bndlib/src/aQute/bnd/build/package-info.java", "diffHunk": "@@ -1,6 +1,6 @@\n /**\n  */\n-@Version(\"3.5.0\")\n+@Version(\"3.6.0\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fca22f9767b18ba3f8d2cae76d5d6e1edefeaad8"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI4MDQwOTk5OnYy", "diffSide": "RIGHT", "path": "biz.aQute.bndlib/src/aQute/bnd/build/Project.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xM1QyMTozODo1NlrOHzAZtA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xM1QyMTozODo1NlrOHzAZtA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzI0NjAwNA==", "bodyText": "Not protected. Protected is still API. Just default access (package-private).", "url": "https://github.com/bndtools/bnd/pull/4397#discussion_r523246004", "createdAt": "2020-11-13T21:38:56Z", "author": {"login": "bjhargrave"}, "path": "biz.aQute.bndlib/src/aQute/bnd/build/Project.java", "diffHunk": "@@ -1146,7 +1146,7 @@ private URI releaseRepo(RepositoryPlugin releaseRepo, Processor context, String\n \t\t}\n \t}\n \n-\tprivate List<RepositoryPlugin> getReleaseRepos(String names) {\n+\tprotected List<RepositoryPlugin> getReleaseRepos(String names) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4982eb2764491a666d83a2c39f1667742cbef915"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI4NzMyMDc0OnYy", "diffSide": "RIGHT", "path": "biz.aQute.bndlib/src/aQute/bnd/build/ProjectBuilder.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNlQxNDowODowMFrOH0ARDg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNlQxNDowODowMFrOH0ARDg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDI5MjM2Ng==", "bodyText": "The error message seems a bit wrong since it mentions writeable repos when no one has even looked for a writeable repo. I also thought we decided not to change behavior and just warn if -releaserepo was not set but still release to the first writeable repo.", "url": "https://github.com/bndtools/bnd/pull/4397#discussion_r524292366", "createdAt": "2020-11-16T14:08:00Z", "author": {"login": "bjhargrave"}, "path": "biz.aQute.bndlib/src/aQute/bnd/build/ProjectBuilder.java", "diffHunk": "@@ -594,29 +594,32 @@ private boolean isMaster(InfoRepository repo, String bsn, Version v) throws Exce\n \t}\n \n \tprivate RepositoryPlugin getReleaseRepo() {\n-\t\tString repoName = getProperty(Constants.RELEASEREPO);\n \n-\t\tList<RepositoryPlugin> repos = getPlugins(RepositoryPlugin.class);\n-\t\tfor (RepositoryPlugin r : repos) {\n-\t\t\tif (r.canWrite()) {\n-\t\t\t\tif (repoName == null || r.getName()\n-\t\t\t\t\t.equals(repoName)) {\n-\t\t\t\t\treturn r;\n-\t\t\t\t}\n-\t\t\t}\n-\t\t}\n-\t\tif (repoName == null)\n+\t\tString repoNames = getProperty(Constants.RELEASEREPO);\n+\n+\t\tif (repoNames == null) {\n \t\t\terror(\"Could not find a writable repo for the release repo (-releaserepo is not set)\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4588d221460e9612fddf3cf575df8449d5ea469a"}, "originalPosition": 19}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI4NzMyNDAxOnYy", "diffSide": "RIGHT", "path": "biz.aQute.bndlib/src/aQute/bnd/build/ProjectBuilder.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNlQxNDowODo0MlrOH0AS8w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNlQxNDowODo0MlrOH0AS8w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDI5Mjg1MQ==", "bodyText": "Not empty can also mean 1. So the warning will trigger when there is only one repo in the list.", "url": "https://github.com/bndtools/bnd/pull/4397#discussion_r524292851", "createdAt": "2020-11-16T14:08:42Z", "author": {"login": "bjhargrave"}, "path": "biz.aQute.bndlib/src/aQute/bnd/build/ProjectBuilder.java", "diffHunk": "@@ -594,29 +594,32 @@ private boolean isMaster(InfoRepository repo, String bsn, Version v) throws Exce\n \t}\n \n \tprivate RepositoryPlugin getReleaseRepo() {\n-\t\tString repoName = getProperty(Constants.RELEASEREPO);\n \n-\t\tList<RepositoryPlugin> repos = getPlugins(RepositoryPlugin.class);\n-\t\tfor (RepositoryPlugin r : repos) {\n-\t\t\tif (r.canWrite()) {\n-\t\t\t\tif (repoName == null || r.getName()\n-\t\t\t\t\t.equals(repoName)) {\n-\t\t\t\t\treturn r;\n-\t\t\t\t}\n-\t\t\t}\n-\t\t}\n-\t\tif (repoName == null)\n+\t\tString repoNames = getProperty(Constants.RELEASEREPO);\n+\n+\t\tif (repoNames == null) {\n \t\t\terror(\"Could not find a writable repo for the release repo (-releaserepo is not set)\");\n-\t\telse\n-\t\t\terror(\"No such -releaserepo %s found\", repoName);\n+\t\t\treturn null;\n+\t\t}\n+\n+\t\tList<RepositoryPlugin> releaseRepos = project.getReleaseRepos(repoNames);\n \n+\t\tif (!releaseRepos.isEmpty()) {\n+\t\t\twarning(\"Found multiple release repositories [%s], so we will use the first one\", repoNames);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4588d221460e9612fddf3cf575df8449d5ea469a"}, "originalPosition": 28}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI4NzMzMjYxOnYy", "diffSide": "RIGHT", "path": "biz.aQute.bndlib/src/aQute/bnd/build/ProjectBuilder.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNlQxNDoxMDozOFrOH0AYQA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNlQxNDoxMDozOFrOH0AYQA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDI5NDIwOA==", "bodyText": "The message should be something like \"no repo found to release into\" since we still allow the old behavior of releasing into a writeable rep.", "url": "https://github.com/bndtools/bnd/pull/4397#discussion_r524294208", "createdAt": "2020-11-16T14:10:38Z", "author": {"login": "bjhargrave"}, "path": "biz.aQute.bndlib/src/aQute/bnd/build/ProjectBuilder.java", "diffHunk": "@@ -594,29 +594,32 @@ private boolean isMaster(InfoRepository repo, String bsn, Version v) throws Exce\n \t}\n \n \tprivate RepositoryPlugin getReleaseRepo() {\n-\t\tString repoName = getProperty(Constants.RELEASEREPO);\n \n-\t\tList<RepositoryPlugin> repos = getPlugins(RepositoryPlugin.class);\n-\t\tfor (RepositoryPlugin r : repos) {\n-\t\t\tif (r.canWrite()) {\n-\t\t\t\tif (repoName == null || r.getName()\n-\t\t\t\t\t.equals(repoName)) {\n-\t\t\t\t\treturn r;\n-\t\t\t\t}\n-\t\t\t}\n-\t\t}\n-\t\tif (repoName == null)\n+\t\tString repoNames = getProperty(Constants.RELEASEREPO);\n+\n+\t\tif (repoNames == null) {\n \t\t\terror(\"Could not find a writable repo for the release repo (-releaserepo is not set)\");\n-\t\telse\n-\t\t\terror(\"No such -releaserepo %s found\", repoName);\n+\t\t\treturn null;\n+\t\t}\n+\n+\t\tList<RepositoryPlugin> releaseRepos = project.getReleaseRepos(repoNames);\n \n+\t\tif (!releaseRepos.isEmpty()) {\n+\t\t\twarning(\"Found multiple release repositories [%s], so we will use the first one\", repoNames);\n+\t\t\treturn releaseRepos.get(0);\n+\t\t}\n+\n+\t\terror(\"No such -releaserepo %s found\", repoNames);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4588d221460e9612fddf3cf575df8449d5ea469a"}, "originalPosition": 32}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI4NzM0MzgyOnYy", "diffSide": "RIGHT", "path": "biz.aQute.bndlib/src/aQute/bnd/build/ProjectBuilder.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNlQxNDoxMzoxNFrOH0AfCA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNlQxNDoxMzoxNFrOH0AfCA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDI5NTk0NA==", "bodyText": "For these messages, we should use proper grammar. So we should capitalize \"Baselining\".", "url": "https://github.com/bndtools/bnd/pull/4397#discussion_r524295944", "createdAt": "2020-11-16T14:13:14Z", "author": {"login": "bjhargrave"}, "path": "biz.aQute.bndlib/src/aQute/bnd/build/ProjectBuilder.java", "diffHunk": "@@ -594,29 +594,32 @@ private boolean isMaster(InfoRepository repo, String bsn, Version v) throws Exce\n \t}\n \n \tprivate RepositoryPlugin getReleaseRepo() {\n-\t\tString repoName = getProperty(Constants.RELEASEREPO);\n \n-\t\tList<RepositoryPlugin> repos = getPlugins(RepositoryPlugin.class);\n-\t\tfor (RepositoryPlugin r : repos) {\n-\t\t\tif (r.canWrite()) {\n-\t\t\t\tif (repoName == null || r.getName()\n-\t\t\t\t\t.equals(repoName)) {\n-\t\t\t\t\treturn r;\n-\t\t\t\t}\n-\t\t\t}\n-\t\t}\n-\t\tif (repoName == null)\n+\t\tString repoNames = getProperty(Constants.RELEASEREPO);\n+\n+\t\tif (repoNames == null) {\n \t\t\terror(\"Could not find a writable repo for the release repo (-releaserepo is not set)\");\n-\t\telse\n-\t\t\terror(\"No such -releaserepo %s found\", repoName);\n+\t\t\treturn null;\n+\t\t}\n+\n+\t\tList<RepositoryPlugin> releaseRepos = project.getReleaseRepos(repoNames);\n \n+\t\tif (!releaseRepos.isEmpty()) {\n+\t\t\twarning(\"Found multiple release repositories [%s], so we will use the first one\", repoNames);\n+\t\t\treturn releaseRepos.get(0);\n+\t\t}\n+\n+\t\terror(\"No such -releaserepo %s found\", repoNames);\n \t\treturn null;\n \t}\n \n \tprivate RepositoryPlugin getBaselineRepo() {\n \t\tString repoName = getProperty(Constants.BASELINEREPO);\n-\t\tif (repoName == null)\n+\t\tif (repoName == null) {\n+\t\t\twarning(\"baselining is active, but no %s is set. Will fall back to release repositories\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4588d221460e9612fddf3cf575df8449d5ea469a"}, "originalPosition": 40}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI4NzM0ODkyOnYy", "diffSide": "RIGHT", "path": "biz.aQute.repository/src/aQute/bnd/repository/maven/provider/MavenBndRepository.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNlQxNDoxNDoyM1rOH0AiJA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNlQxNDoxNDoyM1rOH0AiJA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDI5Njc0MA==", "bodyText": "I think this change should be in a separate commit from the other changes to repo finding since they are totally unrelated. This enable proper cherry-picking if we want.", "url": "https://github.com/bndtools/bnd/pull/4397#discussion_r524296740", "createdAt": "2020-11-16T14:14:23Z", "author": {"login": "bjhargrave"}, "path": "biz.aQute.repository/src/aQute/bnd/repository/maven/provider/MavenBndRepository.java", "diffHunk": "@@ -194,7 +194,7 @@ public PutResult put(InputStream stream, PutOptions options) throws Exception {\n \t\t\t\t}\n \n \t\t\t\tlogger.debug(\"Put release {}\", pom.getRevision());\n-\t\t\t\ttry (Release releaser = storage.release(pom.getRevision(), options.context.getProperties())) {\n+\t\t\t\ttry (Release releaser = storage.release(pom.getRevision(), options.context.getFlattenedProperties())) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4588d221460e9612fddf3cf575df8449d5ea469a"}, "originalPosition": 5}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1339, "cost": 1, "resetAt": "2021-11-12T13:16:51Z"}}}