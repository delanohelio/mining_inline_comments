{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE4NDI5NTYy", "number": 4404, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQxNTowMzozM1rOE3RKQw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMVQxMjo0ODoxOVrOE3sLfQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI2Mzg4MjkxOnYy", "diffSide": "RIGHT", "path": "bndtools.builder/src/org/bndtools/builder/BndtoolsBuilder.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQxNTowMzozM1rOHwg1Iw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMVQwMjowODo1MlrOHw4tMw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDYzMTU4Nw==", "bodyText": "You now call markers.deleteMarkers(\"*\") twice if you get an exception on Central.getProject(myProject).", "url": "https://github.com/bndtools/bnd/pull/4404#discussion_r520631587", "createdAt": "2020-11-10T15:03:33Z", "author": {"login": "bjhargrave"}, "path": "bndtools.builder/src/org/bndtools/builder/BndtoolsBuilder.java", "diffHunk": "@@ -113,15 +112,21 @@\n \t\t\t\t\t.getDynamicReferences();\n \t\t\t}\n \n-\t\t\tif (model == null) {\n-\t\t\t\ttry {\n-\t\t\t\t\tmodel = Central.getProject(myProject);\n-\t\t\t\t} catch (Exception e) {\n-\t\t\t\t\tmarkers.deleteMarkers(\"*\");\n-\t\t\t\t}\n-\t\t\t\tif (model == null)\n-\t\t\t\t\treturn noreport();\n+\t\t\tProject ourModel = null;\n+\t\t\ttry {\n+\t\t\t\tourModel = Central.getProject(myProject);\n+\t\t\t} catch (Exception e) {\n+\t\t\t\tmarkers.deleteMarkers(\"*\");\n \t\t\t}\n+\t\t\tif (ourModel == null) {\n+\t\t\t\tmarkers.deleteMarkers(\"*\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "595170a3e19cf2cb8aa6165d578c38be544a9c9f"}, "originalPosition": 27}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTAyMjc3MQ==", "bodyText": "Fixed.", "url": "https://github.com/bndtools/bnd/pull/4404#discussion_r521022771", "createdAt": "2020-11-11T02:08:52Z", "author": {"login": "kriegfrj"}, "path": "bndtools.builder/src/org/bndtools/builder/BndtoolsBuilder.java", "diffHunk": "@@ -113,15 +112,21 @@\n \t\t\t\t\t.getDynamicReferences();\n \t\t\t}\n \n-\t\t\tif (model == null) {\n-\t\t\t\ttry {\n-\t\t\t\t\tmodel = Central.getProject(myProject);\n-\t\t\t\t} catch (Exception e) {\n-\t\t\t\t\tmarkers.deleteMarkers(\"*\");\n-\t\t\t\t}\n-\t\t\t\tif (model == null)\n-\t\t\t\t\treturn noreport();\n+\t\t\tProject ourModel = null;\n+\t\t\ttry {\n+\t\t\t\tourModel = Central.getProject(myProject);\n+\t\t\t} catch (Exception e) {\n+\t\t\t\tmarkers.deleteMarkers(\"*\");\n \t\t\t}\n+\t\t\tif (ourModel == null) {\n+\t\t\t\tmarkers.deleteMarkers(\"*\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDYzMTU4Nw=="}, "originalCommit": {"oid": "595170a3e19cf2cb8aa6165d578c38be544a9c9f"}, "originalPosition": 27}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI2Mzg5NDEzOnYy", "diffSide": "RIGHT", "path": "bndtools.builder/src/org/bndtools/builder/MarkerSupport.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQxNTowNTo1NFrOHwg8IQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQyMjozMjo1M1rOHwyOxg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDYzMzM3Nw==", "bodyText": "Should this not be cnf.isOpen()?", "url": "https://github.com/bndtools/bnd/pull/4404#discussion_r520633377", "createdAt": "2020-11-10T15:05:54Z", "author": {"login": "bjhargrave"}, "path": "bndtools.builder/src/org/bndtools/builder/MarkerSupport.java", "diffHunk": "@@ -98,7 +98,7 @@ private void deleteCnfMarkersForThisProject(String markerType) throws CoreExcept\n \t\tIProject cnf = ResourcesPlugin.getWorkspace()\n \t\t\t.getRoot()\n \t\t\t.getProject(\"cnf\");\n-\t\tif (cnf != null) {\n+\t\tif (cnf != null && cnf.exists()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "595170a3e19cf2cb8aa6165d578c38be544a9c9f"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDkxNjY3OA==", "bodyText": "I don't know enough about Eclipse's marker handling to know the answer to this question. Checking for existence was sufficient to stop the NPE from happening in the enclosing code if the cnf project was missing. But checking for openness is probably not a bad idea.", "url": "https://github.com/bndtools/bnd/pull/4404#discussion_r520916678", "createdAt": "2020-11-10T22:32:53Z", "author": {"login": "kriegfrj"}, "path": "bndtools.builder/src/org/bndtools/builder/MarkerSupport.java", "diffHunk": "@@ -98,7 +98,7 @@ private void deleteCnfMarkersForThisProject(String markerType) throws CoreExcept\n \t\tIProject cnf = ResourcesPlugin.getWorkspace()\n \t\t\t.getRoot()\n \t\t\t.getProject(\"cnf\");\n-\t\tif (cnf != null) {\n+\t\tif (cnf != null && cnf.exists()) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDYzMzM3Nw=="}, "originalCommit": {"oid": "595170a3e19cf2cb8aa6165d578c38be544a9c9f"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI2ODMwNzI1OnYy", "diffSide": "RIGHT", "path": "bndtools.builder/src/org/bndtools/builder/BndtoolsBuilder.java", "isResolved": true, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMVQxMjo0NzoyOFrOHxLuGQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMlQwNzoyMjozMVrOHxtXsA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTMzNDI5Nw==", "bodyText": "It does seem a bit presumptuous of us (Bndtools) to remove the error markers of another builder, no? I am not sure we should do this.", "url": "https://github.com/bndtools/bnd/pull/4404#discussion_r521334297", "createdAt": "2020-11-11T12:47:28Z", "author": {"login": "bjhargrave"}, "path": "bndtools.builder/src/org/bndtools/builder/BndtoolsBuilder.java", "diffHunk": "@@ -113,16 +118,57 @@\n \t\t\t\t\t.getDynamicReferences();\n \t\t\t}\n \n-\t\t\tif (model == null) {\n-\t\t\t\ttry {\n-\t\t\t\t\tmodel = Central.getProject(myProject);\n-\t\t\t\t} catch (Exception e) {\n-\t\t\t\t\tmarkers.deleteMarkers(\"*\");\n+\t\t\tProject ourModel = null;\n+\t\t\ttry {\n+\t\t\t\tourModel = Central.getProject(myProject);\n+\t\t\t} catch (Exception e) {\n+\t\t\t\tmarkers.deleteMarkers(\"*\");\n+\t\t\t\t// If the cnf project is missing there will likely be a myriad\n+\t\t\t\t// of Java problems. These do nothing but clutter the error\n+\t\t\t\t// output and make it hard to find the real problem in the\n+\t\t\t\t// problem log.\n+\t\t\t\tmyProject.deleteMarkers(IJavaModelMarker.JAVA_MODEL_PROBLEM_MARKER, true, IResource.DEPTH_INFINITE);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "08c6ac9f060d5b33edc4524e2d61b614ba1d651a"}, "originalPosition": 59}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTM3NDIwMA==", "bodyText": "I suppose i could try and see if we can coerce the JavaBuilder to do it itself under these conditions, eg by failing the BndClasspathContainer somehow.", "url": "https://github.com/bndtools/bnd/pull/4404#discussion_r521374200", "createdAt": "2020-11-11T13:55:50Z", "author": {"login": "kriegfrj"}, "path": "bndtools.builder/src/org/bndtools/builder/BndtoolsBuilder.java", "diffHunk": "@@ -113,16 +118,57 @@\n \t\t\t\t\t.getDynamicReferences();\n \t\t\t}\n \n-\t\t\tif (model == null) {\n-\t\t\t\ttry {\n-\t\t\t\t\tmodel = Central.getProject(myProject);\n-\t\t\t\t} catch (Exception e) {\n-\t\t\t\t\tmarkers.deleteMarkers(\"*\");\n+\t\t\tProject ourModel = null;\n+\t\t\ttry {\n+\t\t\t\tourModel = Central.getProject(myProject);\n+\t\t\t} catch (Exception e) {\n+\t\t\t\tmarkers.deleteMarkers(\"*\");\n+\t\t\t\t// If the cnf project is missing there will likely be a myriad\n+\t\t\t\t// of Java problems. These do nothing but clutter the error\n+\t\t\t\t// output and make it hard to find the real problem in the\n+\t\t\t\t// problem log.\n+\t\t\t\tmyProject.deleteMarkers(IJavaModelMarker.JAVA_MODEL_PROBLEM_MARKER, true, IResource.DEPTH_INFINITE);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTMzNDI5Nw=="}, "originalCommit": {"oid": "08c6ac9f060d5b33edc4524e2d61b614ba1d651a"}, "originalPosition": 59}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTM4ODEwMg==", "bodyText": "I don't think that is a good idea or possible either. The Java builder's errors are real. They are compilation failures. And they are the responsibility of the Java builder to manage.", "url": "https://github.com/bndtools/bnd/pull/4404#discussion_r521388102", "createdAt": "2020-11-11T14:17:27Z", "author": {"login": "bjhargrave"}, "path": "bndtools.builder/src/org/bndtools/builder/BndtoolsBuilder.java", "diffHunk": "@@ -113,16 +118,57 @@\n \t\t\t\t\t.getDynamicReferences();\n \t\t\t}\n \n-\t\t\tif (model == null) {\n-\t\t\t\ttry {\n-\t\t\t\t\tmodel = Central.getProject(myProject);\n-\t\t\t\t} catch (Exception e) {\n-\t\t\t\t\tmarkers.deleteMarkers(\"*\");\n+\t\t\tProject ourModel = null;\n+\t\t\ttry {\n+\t\t\t\tourModel = Central.getProject(myProject);\n+\t\t\t} catch (Exception e) {\n+\t\t\t\tmarkers.deleteMarkers(\"*\");\n+\t\t\t\t// If the cnf project is missing there will likely be a myriad\n+\t\t\t\t// of Java problems. These do nothing but clutter the error\n+\t\t\t\t// output and make it hard to find the real problem in the\n+\t\t\t\t// problem log.\n+\t\t\t\tmyProject.deleteMarkers(IJavaModelMarker.JAVA_MODEL_PROBLEM_MARKER, true, IResource.DEPTH_INFINITE);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTMzNDI5Nw=="}, "originalCommit": {"oid": "08c6ac9f060d5b33edc4524e2d61b614ba1d651a"}, "originalPosition": 59}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTg4NTYxNg==", "bodyText": "I disagree, but rather than hold up this PR over this issue (which is not directly related to the original problem)  I have removed the offending lines for now so that we can get it merged. We can discuss this further at another time.", "url": "https://github.com/bndtools/bnd/pull/4404#discussion_r521885616", "createdAt": "2020-11-12T07:22:31Z", "author": {"login": "kriegfrj"}, "path": "bndtools.builder/src/org/bndtools/builder/BndtoolsBuilder.java", "diffHunk": "@@ -113,16 +118,57 @@\n \t\t\t\t\t.getDynamicReferences();\n \t\t\t}\n \n-\t\t\tif (model == null) {\n-\t\t\t\ttry {\n-\t\t\t\t\tmodel = Central.getProject(myProject);\n-\t\t\t\t} catch (Exception e) {\n-\t\t\t\t\tmarkers.deleteMarkers(\"*\");\n+\t\t\tProject ourModel = null;\n+\t\t\ttry {\n+\t\t\t\tourModel = Central.getProject(myProject);\n+\t\t\t} catch (Exception e) {\n+\t\t\t\tmarkers.deleteMarkers(\"*\");\n+\t\t\t\t// If the cnf project is missing there will likely be a myriad\n+\t\t\t\t// of Java problems. These do nothing but clutter the error\n+\t\t\t\t// output and make it hard to find the real problem in the\n+\t\t\t\t// problem log.\n+\t\t\t\tmyProject.deleteMarkers(IJavaModelMarker.JAVA_MODEL_PROBLEM_MARKER, true, IResource.DEPTH_INFINITE);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTMzNDI5Nw=="}, "originalCommit": {"oid": "08c6ac9f060d5b33edc4524e2d61b614ba1d651a"}, "originalPosition": 59}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI2ODMwOTczOnYy", "diffSide": "RIGHT", "path": "bndtools.builder/src/org/bndtools/builder/BndtoolsBuilder.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMVQxMjo0ODoxOVrOHxLvxA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMVQxMjo0ODoxOVrOHxLvxA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTMzNDcyNA==", "bodyText": "It does seem a bit presumptuous of us (Bndtools) to remove the error markers of another builder, no? I am not sure we should do this.", "url": "https://github.com/bndtools/bnd/pull/4404#discussion_r521334724", "createdAt": "2020-11-11T12:48:19Z", "author": {"login": "bjhargrave"}, "path": "bndtools.builder/src/org/bndtools/builder/BndtoolsBuilder.java", "diffHunk": "@@ -113,16 +118,57 @@\n \t\t\t\t\t.getDynamicReferences();\n \t\t\t}\n \n-\t\t\tif (model == null) {\n-\t\t\t\ttry {\n-\t\t\t\t\tmodel = Central.getProject(myProject);\n-\t\t\t\t} catch (Exception e) {\n-\t\t\t\t\tmarkers.deleteMarkers(\"*\");\n+\t\t\tProject ourModel = null;\n+\t\t\ttry {\n+\t\t\t\tourModel = Central.getProject(myProject);\n+\t\t\t} catch (Exception e) {\n+\t\t\t\tmarkers.deleteMarkers(\"*\");\n+\t\t\t\t// If the cnf project is missing there will likely be a myriad\n+\t\t\t\t// of Java problems. These do nothing but clutter the error\n+\t\t\t\t// output and make it hard to find the real problem in the\n+\t\t\t\t// problem log.\n+\t\t\t\tmyProject.deleteMarkers(IJavaModelMarker.JAVA_MODEL_PROBLEM_MARKER, true, IResource.DEPTH_INFINITE);\n+\t\t\t\tlogger.logError(\"Exception while trying to fetch bnd project for \" + myProject.getName(), e);\n+\t\t\t\tmarkers.createMarker(null, IMarker.SEVERITY_ERROR, \"Exception while trying to fetch bnd project: \" + e,\n+\t\t\t\t\tBndtoolsConstants.MARKER_BND_PATH_PROBLEM);\n+\t\t\t\treturn noreport();\n+\t\t\t}\n+\t\t\tif (ourModel == null) {\n+\t\t\t\tmarkers.deleteMarkers(\"*\");\n+\t\t\t\t// If the cnf project is missing there will likely be a myriad\n+\t\t\t\t// of Java problems. These do nothing but clutter the error\n+\t\t\t\t// output and make it hard to find the real problem in the\n+\t\t\t\t// problem log.\n+\t\t\t\tmyProject.deleteMarkers(IJavaModelMarker.JAVA_MODEL_PROBLEM_MARKER, true, IResource.DEPTH_INFINITE);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "08c6ac9f060d5b33edc4524e2d61b614ba1d651a"}, "originalPosition": 71}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1341, "cost": 1, "resetAt": "2021-11-12T13:16:51Z"}}}