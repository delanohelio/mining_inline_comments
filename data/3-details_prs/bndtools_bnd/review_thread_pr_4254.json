{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY0NDcyODkx", "number": 4254, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOFQxOTo1NDowOVrOEhZLvA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOFQyMDowNzowNFrOEhZcXA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAzNDUxMDY4OnYy", "diffSide": "RIGHT", "path": "biz.aQute.tester.test/bnd.bnd", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOFQxOTo1NDowOVrOHOr2VA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMFQwMTowODowMFrOHPfUeQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTE2MDUzMg==", "bodyText": "This seems wrong. You have both org.junit.jupiter.api at the eclipse version AND junit-jupiter-api at the specific version='5.6.2'. We need to pick one version and I suspect it is not 5.6.2.", "url": "https://github.com/bndtools/bnd/pull/4254#discussion_r485160532", "createdAt": "2020-09-08T19:54:09Z", "author": {"login": "bjhargrave"}, "path": "biz.aQute.tester.test/bnd.bnd", "diffHunk": "@@ -5,11 +5,12 @@\n \n -buildpath: \\\n \torg.apache.servicemix.bundles.junit;version=latest,\\\n-\torg.junit.jupiter.api;version=\"${junit.jupiter.eclipse.version}\",\\\n-\torg.junit.jupiter.params;version=\"${junit.jupiter.eclipse.version}\",\\\n+\torg.junit.jupiter.api;version='${junit.jupiter.eclipse.version}',\\\n+\torg.junit.jupiter.params;version='${junit.jupiter.eclipse.version}',\\\n \torg.opentest4j,\\\n \torg.apiguardian,\\\n-\tosgi.core;version=latest\n+\tosgi.core;version=latest,\\\n+\tjunit-jupiter-api;version='5.6.2'", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "62dbaa2683a50c091393821995ad2a0ccb597bc7"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjAwMzgzMw==", "bodyText": "Sorry, looks like I got a bit trigger-happy on the quick fix at one point (the presence of the version attribute is a dead giveaway!)", "url": "https://github.com/bndtools/bnd/pull/4254#discussion_r486003833", "createdAt": "2020-09-10T01:08:00Z", "author": {"login": "kriegfrj"}, "path": "biz.aQute.tester.test/bnd.bnd", "diffHunk": "@@ -5,11 +5,12 @@\n \n -buildpath: \\\n \torg.apache.servicemix.bundles.junit;version=latest,\\\n-\torg.junit.jupiter.api;version=\"${junit.jupiter.eclipse.version}\",\\\n-\torg.junit.jupiter.params;version=\"${junit.jupiter.eclipse.version}\",\\\n+\torg.junit.jupiter.api;version='${junit.jupiter.eclipse.version}',\\\n+\torg.junit.jupiter.params;version='${junit.jupiter.eclipse.version}',\\\n \torg.opentest4j,\\\n \torg.apiguardian,\\\n-\tosgi.core;version=latest\n+\tosgi.core;version=latest,\\\n+\tjunit-jupiter-api;version='5.6.2'", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTE2MDUzMg=="}, "originalCommit": {"oid": "62dbaa2683a50c091393821995ad2a0ccb597bc7"}, "originalPosition": 12}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAzNDU0NzAzOnYy", "diffSide": "RIGHT", "path": "biz.aQute.tester.junit-platform/src/aQute/tester/junit/platform/Activator.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOFQyMDowNTowM1rOHOsMAA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMFQwMTozMzo0N1rOHPfutg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTE2NjA4MA==", "bodyText": "Can you even get an NCDFE here? The only gogo type is Description which is only used as an annotation and the class loader will be happy to load the GogoCommandlet class even if the annotations are not available. So I don't think you can ever get the error.", "url": "https://github.com/bndtools/bnd/pull/4254#discussion_r485166080", "createdAt": "2020-09-08T20:05:03Z", "author": {"login": "bjhargrave"}, "path": "biz.aQute.tester.junit-platform/src/aQute/tester/junit/platform/Activator.java", "diffHunk": "@@ -295,12 +297,26 @@ public void removedBundle(Bundle bundle, BundleEvent event, Bundle object) {\n \t\t};\n \t\ttracker.open();\n \n+\t\tif (Boolean.valueOf(context.getProperty(\"launch.services\"))) {\n+\t\t\ttry {\n+\t\t\t\tGogoCommandlet cmd = new GogoCommandlet();\n+\t\t\t\tHashtable<String, Object> properties = new Hashtable<>();\n+\t\t\t\tproperties.put(\"osgi.command.function\", new String[] {\n+\t\t\t\t\t\"runTests\"\n+\t\t\t\t});\n+\t\t\t\tproperties.put(\"osgi.command.scope\", \"tester\");\n+\n+\t\t\t\ttrace(\"starting gogo commandlet\");\n+\t\t\t\tcontext.registerService(Object.class, cmd, properties);\n+\t\t\t} catch (NoClassDefFoundError e) {}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "62dbaa2683a50c091393821995ad2a0ccb597bc7"}, "originalPosition": 73}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjAxMDU1MA==", "bodyText": "Well I've learned something. I didn't know that the classloader would ignore annotations if their type was missing. I've removed it and the tests pass. In fact, it didn't occur to me (or at least I never seriously investigated) that the gogo-specific tests were running and passing even though I hadn't added gogo to the command line runbundles.\nAnd this is also a lesson to me, that this is the kind of thing that happens when you don't do proper TDD! I obviously never attempted (or at least never succeeded) to write that failing test to trigger the NCDFE.", "url": "https://github.com/bndtools/bnd/pull/4254#discussion_r486010550", "createdAt": "2020-09-10T01:33:47Z", "author": {"login": "kriegfrj"}, "path": "biz.aQute.tester.junit-platform/src/aQute/tester/junit/platform/Activator.java", "diffHunk": "@@ -295,12 +297,26 @@ public void removedBundle(Bundle bundle, BundleEvent event, Bundle object) {\n \t\t};\n \t\ttracker.open();\n \n+\t\tif (Boolean.valueOf(context.getProperty(\"launch.services\"))) {\n+\t\t\ttry {\n+\t\t\t\tGogoCommandlet cmd = new GogoCommandlet();\n+\t\t\t\tHashtable<String, Object> properties = new Hashtable<>();\n+\t\t\t\tproperties.put(\"osgi.command.function\", new String[] {\n+\t\t\t\t\t\"runTests\"\n+\t\t\t\t});\n+\t\t\t\tproperties.put(\"osgi.command.scope\", \"tester\");\n+\n+\t\t\t\ttrace(\"starting gogo commandlet\");\n+\t\t\t\tcontext.registerService(Object.class, cmd, properties);\n+\t\t\t} catch (NoClassDefFoundError e) {}", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTE2NjA4MA=="}, "originalCommit": {"oid": "62dbaa2683a50c091393821995ad2a0ccb597bc7"}, "originalPosition": 73}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAzNDU1MzI0OnYy", "diffSide": "RIGHT", "path": "biz.aQute.tester.junit-platform/src/aQute/tester/junit/platform/Activator.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOFQyMDowNzowNFrOHOsP_A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMFQwMTo0OToyNlrOHPf-5Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTE2NzEwMA==", "bodyText": "Perhaps this should only be registered if in continuous mode? Otherwise there is no loop watching the queue. The test case sets continuous on to get the test to work I assume.", "url": "https://github.com/bndtools/bnd/pull/4254#discussion_r485167100", "createdAt": "2020-09-08T20:07:04Z", "author": {"login": "bjhargrave"}, "path": "biz.aQute.tester.junit-platform/src/aQute/tester/junit/platform/Activator.java", "diffHunk": "@@ -295,12 +297,26 @@ public void removedBundle(Bundle bundle, BundleEvent event, Bundle object) {\n \t\t};\n \t\ttracker.open();\n \n+\t\tif (Boolean.valueOf(context.getProperty(\"launch.services\"))) {\n+\t\t\ttry {\n+\t\t\t\tGogoCommandlet cmd = new GogoCommandlet();\n+\t\t\t\tHashtable<String, Object> properties = new Hashtable<>();\n+\t\t\t\tproperties.put(\"osgi.command.function\", new String[] {\n+\t\t\t\t\t\"runTests\"\n+\t\t\t\t});\n+\t\t\t\tproperties.put(\"osgi.command.scope\", \"tester\");\n+\n+\t\t\t\ttrace(\"starting gogo commandlet\");\n+\t\t\t\tcontext.registerService(Object.class, cmd, properties);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "62dbaa2683a50c091393821995ad2a0ccb597bc7"}, "originalPosition": 72}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjAxNDY5Mw==", "bodyText": "Perhaps this should only be registered if in continuous mode? Otherwise there is no loop watching the queue.\n\nIn auto, non-continuous mode, the tester can still it can still sit waiting if it doesn't find any test bundles. In theory, at least, the commandlet could still be used at this time. However if there are no test bundles in the environment it won't do much.\nI'll change it to only register during continuous mode.\n\nThe test case sets continuous on to get the test to work I assume.\n\nYes:\n\n  \n    \n      bnd/biz.aQute.tester.test/test/aQute/tester/junit/platform/test/GogoShellTests.java\n    \n    \n         Line 76\n      in\n      62dbaa2\n    \n    \n    \n    \n\n        \n          \n           .set(TESTER_CONTINUOUS, \"true\")", "url": "https://github.com/bndtools/bnd/pull/4254#discussion_r486014693", "createdAt": "2020-09-10T01:49:26Z", "author": {"login": "kriegfrj"}, "path": "biz.aQute.tester.junit-platform/src/aQute/tester/junit/platform/Activator.java", "diffHunk": "@@ -295,12 +297,26 @@ public void removedBundle(Bundle bundle, BundleEvent event, Bundle object) {\n \t\t};\n \t\ttracker.open();\n \n+\t\tif (Boolean.valueOf(context.getProperty(\"launch.services\"))) {\n+\t\t\ttry {\n+\t\t\t\tGogoCommandlet cmd = new GogoCommandlet();\n+\t\t\t\tHashtable<String, Object> properties = new Hashtable<>();\n+\t\t\t\tproperties.put(\"osgi.command.function\", new String[] {\n+\t\t\t\t\t\"runTests\"\n+\t\t\t\t});\n+\t\t\t\tproperties.put(\"osgi.command.scope\", \"tester\");\n+\n+\t\t\t\ttrace(\"starting gogo commandlet\");\n+\t\t\t\tcontext.registerService(Object.class, cmd, properties);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTE2NzEwMA=="}, "originalCommit": {"oid": "62dbaa2683a50c091393821995ad2a0ccb597bc7"}, "originalPosition": 72}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1384, "cost": 1, "resetAt": "2021-11-12T13:16:51Z"}}}