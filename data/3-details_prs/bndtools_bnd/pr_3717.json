{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzYzNDc1MzU5", "number": 3717, "title": "[tester] OSGiJUnitLaunchDelegate to handle restarting tester bundle", "bodyText": "Loop around the call to accept() to accept reconnection attempts (such as what happens when the tester bundle is restarted).\nPartial fix for #3528.", "createdAt": "2020-01-16T06:18:49Z", "url": "https://github.com/bndtools/bnd/pull/3717", "merged": true, "mergeCommit": {"oid": "330865cd264b106f92e1032218b404c116bcf4d0"}, "closed": true, "closedAt": "2020-01-23T14:09:31Z", "author": {"login": "kriegfrj"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb7Zci6AFqTM0NDkxNzUxMw==", "endCursor": "Y3Vyc29yOnYyOpPPAAABb9K8O4gFqTM0NzMyMjE3Mg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ0OTE3NTEz", "url": "https://github.com/bndtools/bnd/pull/3717#pullrequestreview-344917513", "createdAt": "2020-01-18T01:55:10Z", "commit": {"oid": "52b24a7d782f2afc65090b30ab1c186b83a82073"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xOFQwMTo1NToxMFrOFfJBgQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xOFQwMTo1NToxMFrOFfJBgQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODE5ODAxNw==", "bodyText": "So the only way out of this loop is throwing an exception? That seems like poor flow control.", "url": "https://github.com/bndtools/bnd/pull/3717#discussion_r368198017", "createdAt": "2020-01-18T01:55:10Z", "author": {"login": "bjhargrave"}, "path": "bndtools.core/src/bndtools/launch/OSGiJUnitLaunchDelegate.java", "diffHunk": "@@ -197,12 +197,14 @@ public void run() {\n \t\t\ttry {\n \t\t\t\tlistener = new ServerSocket(port);\n \n-\t\t\t\tsocket = listener.accept();\n-\t\t\t\toutStr = new DataOutputStream(socket.getOutputStream());\n-\t\t\t\twhile (socket.getInputStream()\n-\t\t\t\t\t.read() != -1) {\n-\t\t\t\t\ttestRunSession = new TestRunSessionAndPort(launch, project);\n-\t\t\t\t\toutStr.writeInt(testRunSession.getPort());\n+\t\t\t\twhile (true) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "52b24a7d782f2afc65090b30ab1c186b83a82073"}, "originalPosition": 10}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1c164edb558ff5163b9511400a6a49045cb319c4", "author": {"user": {"login": "kriegfrj", "name": "Fr Jeremy Krieg"}}, "url": "https://github.com/bndtools/bnd/commit/1c164edb558ff5163b9511400a6a49045cb319c4", "committedDate": "2020-01-22T01:41:30Z", "message": "[tester] OSGiJUnitLaunchDelegate to handle restarting tester bundle\n\nImplements #3528\n\nSigned-off-by: Fr Jeremy Krieg <fr.jkrieg@greekwelfaresa.org.au>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "52b24a7d782f2afc65090b30ab1c186b83a82073", "author": {"user": {"login": "kriegfrj", "name": "Fr Jeremy Krieg"}}, "url": "https://github.com/bndtools/bnd/commit/52b24a7d782f2afc65090b30ab1c186b83a82073", "committedDate": "2020-01-16T05:59:23Z", "message": "[tester] OSGiJUnitLaunchDelegate to handle restarting tester bundle\n\nImplements #3528\n\nSigned-off-by: Fr Jeremy Krieg <fr.jkrieg@greekwelfaresa.org.au>"}, "afterCommit": {"oid": "251a7facaa464557e42c4b239710f30e0071b71d", "author": {"user": {"login": "kriegfrj", "name": "Fr Jeremy Krieg"}}, "url": "https://github.com/bndtools/bnd/commit/251a7facaa464557e42c4b239710f30e0071b71d", "committedDate": "2020-01-22T02:55:06Z", "message": "[bndtools tester] Init ControlThread.listener in constructor\n\nThis allows error reporting for initialisation to be separated from runtime errors for more informative reporting.\n\nSigned-off-by: Fr Jeremy Krieg <fr.jkrieg@greekwelfaresa.org.au>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ2NjM1NzEx", "url": "https://github.com/bndtools/bnd/pull/3717#pullrequestreview-346635711", "createdAt": "2020-01-22T14:38:03Z", "commit": {"oid": "251a7facaa464557e42c4b239710f30e0071b71d"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMlQxNDozODowM1rOFgeaBw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMlQxNDozODowM1rOFgeaBw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTU5NjkzNQ==", "bodyText": "You also need to delete the port variable since it is no longer used. Also make listener, launch, and project variables final. The other variables should be volatile since they are written by one thread (run method) and read by another thread (close method).", "url": "https://github.com/bndtools/bnd/pull/3717#discussion_r369596935", "createdAt": "2020-01-22T14:38:03Z", "author": {"login": "bjhargrave"}, "path": "bndtools.core/src/bndtools/launch/OSGiJUnitLaunchDelegate.java", "diffHunk": "@@ -186,29 +186,36 @@ public void stopTestRun() {\n \t\tint\t\t\t\t\t\tport;\n \t\tDataOutputStream\t\toutStr;\n \n-\t\tpublic ControlThread(ILaunch launch, IJavaProject project, int port) {\n+\t\tpublic ControlThread(ILaunch launch, IJavaProject project, int port) throws IOException {\n \t\t\tthis.launch = launch;\n \t\t\tthis.project = project;\n-\t\t\tthis.port = port;\n+\t\t\tlistener = new ServerSocket(port);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "251a7facaa464557e42c4b239710f30e0071b71d"}, "originalPosition": 9}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b2739bd4a98c3681715f7097cf35541a4b3d2bc3", "author": {"user": {"login": "kriegfrj", "name": "Fr Jeremy Krieg"}}, "url": "https://github.com/bndtools/bnd/commit/b2739bd4a98c3681715f7097cf35541a4b3d2bc3", "committedDate": "2020-01-23T04:11:01Z", "message": "[bndtools tester] Init ControlThread.listener in constructor\n\nThis allows error reporting for initialisation to be separated from runtime errors for more informative reporting.\n\nSigned-off-by: Fr Jeremy Krieg <fr.jkrieg@greekwelfaresa.org.au>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "94a6f32c21c053f7479fbfc3ac40b5a82463e418", "author": {"user": {"login": "kriegfrj", "name": "Fr Jeremy Krieg"}}, "url": "https://github.com/bndtools/bnd/commit/94a6f32c21c053f7479fbfc3ac40b5a82463e418", "committedDate": "2020-01-23T05:02:55Z", "message": "[bndtools tester] Improve thread safety of tester delegate\n\nSigned-off-by: Fr Jeremy Krieg <fr.jkrieg@greekwelfaresa.org.au>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "251a7facaa464557e42c4b239710f30e0071b71d", "author": {"user": {"login": "kriegfrj", "name": "Fr Jeremy Krieg"}}, "url": "https://github.com/bndtools/bnd/commit/251a7facaa464557e42c4b239710f30e0071b71d", "committedDate": "2020-01-22T02:55:06Z", "message": "[bndtools tester] Init ControlThread.listener in constructor\n\nThis allows error reporting for initialisation to be separated from runtime errors for more informative reporting.\n\nSigned-off-by: Fr Jeremy Krieg <fr.jkrieg@greekwelfaresa.org.au>"}, "afterCommit": {"oid": "94a6f32c21c053f7479fbfc3ac40b5a82463e418", "author": {"user": {"login": "kriegfrj", "name": "Fr Jeremy Krieg"}}, "url": "https://github.com/bndtools/bnd/commit/94a6f32c21c053f7479fbfc3ac40b5a82463e418", "committedDate": "2020-01-23T05:02:55Z", "message": "[bndtools tester] Improve thread safety of tester delegate\n\nSigned-off-by: Fr Jeremy Krieg <fr.jkrieg@greekwelfaresa.org.au>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ3MzIyMTcy", "url": "https://github.com/bndtools/bnd/pull/3717#pullrequestreview-347322172", "createdAt": "2020-01-23T14:09:09Z", "commit": {"oid": "94a6f32c21c053f7479fbfc3ac40b5a82463e418"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3056, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}