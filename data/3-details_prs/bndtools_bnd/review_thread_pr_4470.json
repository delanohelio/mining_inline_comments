{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTQzNzE2Mzk1", "number": 4470, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMVQyMDo1NDo1M1rOFH7hYg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMVQyMDo1NzoyNVrOFH7kMQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQzODU5NTU0OnYy", "diffSide": "RIGHT", "path": "biz.aQute.tester/src/aQute/tester/plugin/ProjectTesterImpl.java", "isResolved": true, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMVQyMDo1NDo1M1rOIJlpGg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yM1QyMDozNzoyNVrOIK0etQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjkyNDgyNg==", "bodyText": "This seems an unwanted side effect. We already add me to the launcher above. Jamming into the project seems wrong. Every time you launch, you will add it again, no? I think some other solution is needed.", "url": "https://github.com/bndtools/bnd/pull/4470#discussion_r546924826", "createdAt": "2020-12-21T20:54:53Z", "author": {"login": "bjhargrave"}, "path": "biz.aQute.tester/src/aQute/tester/plugin/ProjectTesterImpl.java", "diffHunk": "@@ -83,6 +83,14 @@ protected void updateFromProject() throws Exception {\n \n \t\tlauncher.addRunBundle(me.getFile()\n \t\t\t.getAbsolutePath());\n+\n+\t\t//\n+\t\t// We also add it to the project to handle the case of the remote\n+\t\t// launcher that wants to sync the bundles with the runtime dynamically\n+\t\t//\n+\n+\t\tgetProject().getRunbundles()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dff67a6b900cd0f577961df65a326e632fe0be37"}, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzMxMzI2Mg==", "bodyText": "There's no other way. the remote launcher is blowing away the runbundles set using launcher.addRunBundle.\nI'm open to other options.", "url": "https://github.com/bndtools/bnd/pull/4470#discussion_r547313262", "createdAt": "2020-12-22T14:38:25Z", "author": {"login": "rotty3000"}, "path": "biz.aQute.tester/src/aQute/tester/plugin/ProjectTesterImpl.java", "diffHunk": "@@ -83,6 +83,14 @@ protected void updateFromProject() throws Exception {\n \n \t\tlauncher.addRunBundle(me.getFile()\n \t\t\t.getAbsolutePath());\n+\n+\t\t//\n+\t\t// We also add it to the project to handle the case of the remote\n+\t\t// launcher that wants to sync the bundles with the runtime dynamically\n+\t\t//\n+\n+\t\tgetProject().getRunbundles()", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjkyNDgyNg=="}, "originalCommit": {"oid": "dff67a6b900cd0f577961df65a326e632fe0be37"}, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzMzMzQ0OA==", "bodyText": "the tester gets the launcher instance\nthe tester calls prepare() where it adds the tester bundle to launcher runbundles\nthe tester then calls getProjectLauncher().launch(); which calls launcher.prepare() which calls launcher.updateFromProject(); which calls runbundles.clear();\n\nAlso, RemoteProjectLauncherPlugin inherits from aQute.bnd.build.ProjectLauncher which has https://github.com/bndtools/bnd/blob/master/biz.aQute.bndlib/src/aQute/bnd/build/ProjectLauncher.java#L148", "url": "https://github.com/bndtools/bnd/pull/4470#discussion_r547333448", "createdAt": "2020-12-22T15:14:26Z", "author": {"login": "rotty3000"}, "path": "biz.aQute.tester/src/aQute/tester/plugin/ProjectTesterImpl.java", "diffHunk": "@@ -83,6 +83,14 @@ protected void updateFromProject() throws Exception {\n \n \t\tlauncher.addRunBundle(me.getFile()\n \t\t\t.getAbsolutePath());\n+\n+\t\t//\n+\t\t// We also add it to the project to handle the case of the remote\n+\t\t// launcher that wants to sync the bundles with the runtime dynamically\n+\t\t//\n+\n+\t\tgetProject().getRunbundles()", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjkyNDgyNg=="}, "originalCommit": {"oid": "dff67a6b900cd0f577961df65a326e632fe0be37"}, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODIxNjUwMQ==", "bodyText": "fixed this", "url": "https://github.com/bndtools/bnd/pull/4470#discussion_r548216501", "createdAt": "2020-12-23T20:37:25Z", "author": {"login": "rotty3000"}, "path": "biz.aQute.tester/src/aQute/tester/plugin/ProjectTesterImpl.java", "diffHunk": "@@ -83,6 +83,14 @@ protected void updateFromProject() throws Exception {\n \n \t\tlauncher.addRunBundle(me.getFile()\n \t\t\t.getAbsolutePath());\n+\n+\t\t//\n+\t\t// We also add it to the project to handle the case of the remote\n+\t\t// launcher that wants to sync the bundles with the runtime dynamically\n+\t\t//\n+\n+\t\tgetProject().getRunbundles()", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjkyNDgyNg=="}, "originalCommit": {"oid": "dff67a6b900cd0f577961df65a326e632fe0be37"}, "originalPosition": 10}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQzODYwMjczOnYy", "diffSide": "RIGHT", "path": "biz.aQute.remote/src/aQute/remote/plugin/RunSessionImpl.java", "isResolved": true, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMVQyMDo1NzoyNVrOIJltLg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMlQxNTo1Mzo0MFrOIJ_7cg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjkyNTg3MA==", "bodyText": "Doesn't this just stack up side effects since the system properties are not restored when done?", "url": "https://github.com/bndtools/bnd/pull/4470#discussion_r546925870", "createdAt": "2020-12-21T20:57:25Z", "author": {"login": "bjhargrave"}, "path": "biz.aQute.remote/src/aQute/remote/plugin/RunSessionImpl.java", "diffHunk": "@@ -96,8 +97,13 @@ public int launch() throws Exception {\n \n \t\t\tAgent agent = supervisor.getAgent();\n \n-\t\t\tif (agent.isEnvoy())\n+\t\t\tif (agent.isEnvoy()) {\n \t\t\t\tinstallFramework(agent, dto, properties);\n+\t\t\t} else {\n+\t\t\t\tfor (Entry<String, String> entry : properties.entrySet()) {\n+\t\t\t\t\tagent.setSystemProperty(entry.getKey(), entry.getValue());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dff67a6b900cd0f577961df65a326e632fe0be37"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzMxMjI4Ng==", "bodyText": "I'm open to other solutions. We'd have to rewrite a testers to get information via some other means. I can't see that happening in short order. This at least is a short term yet pretty safe fix. No one else cares about these properties... and the ONLY way to hand over -runproperties in the remote use case.", "url": "https://github.com/bndtools/bnd/pull/4470#discussion_r547312286", "createdAt": "2020-12-22T14:36:35Z", "author": {"login": "rotty3000"}, "path": "biz.aQute.remote/src/aQute/remote/plugin/RunSessionImpl.java", "diffHunk": "@@ -96,8 +97,13 @@ public int launch() throws Exception {\n \n \t\t\tAgent agent = supervisor.getAgent();\n \n-\t\t\tif (agent.isEnvoy())\n+\t\t\tif (agent.isEnvoy()) {\n \t\t\t\tinstallFramework(agent, dto, properties);\n+\t\t\t} else {\n+\t\t\t\tfor (Entry<String, String> entry : properties.entrySet()) {\n+\t\t\t\t\tagent.setSystemProperty(entry.getKey(), entry.getValue());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjkyNTg3MA=="}, "originalCommit": {"oid": "dff67a6b900cd0f577961df65a326e632fe0be37"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzMzMzcxMg==", "bodyText": "I guess we could track the original value if any and then reset... I can add that.", "url": "https://github.com/bndtools/bnd/pull/4470#discussion_r547333712", "createdAt": "2020-12-22T15:14:53Z", "author": {"login": "rotty3000"}, "path": "biz.aQute.remote/src/aQute/remote/plugin/RunSessionImpl.java", "diffHunk": "@@ -96,8 +97,13 @@ public int launch() throws Exception {\n \n \t\t\tAgent agent = supervisor.getAgent();\n \n-\t\t\tif (agent.isEnvoy())\n+\t\t\tif (agent.isEnvoy()) {\n \t\t\t\tinstallFramework(agent, dto, properties);\n+\t\t\t} else {\n+\t\t\t\tfor (Entry<String, String> entry : properties.entrySet()) {\n+\t\t\t\t\tagent.setSystemProperty(entry.getKey(), entry.getValue());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjkyNTg3MA=="}, "originalCommit": {"oid": "dff67a6b900cd0f577961df65a326e632fe0be37"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzM1NTUwNg==", "bodyText": "fixed", "url": "https://github.com/bndtools/bnd/pull/4470#discussion_r547355506", "createdAt": "2020-12-22T15:53:40Z", "author": {"login": "rotty3000"}, "path": "biz.aQute.remote/src/aQute/remote/plugin/RunSessionImpl.java", "diffHunk": "@@ -96,8 +97,13 @@ public int launch() throws Exception {\n \n \t\t\tAgent agent = supervisor.getAgent();\n \n-\t\t\tif (agent.isEnvoy())\n+\t\t\tif (agent.isEnvoy()) {\n \t\t\t\tinstallFramework(agent, dto, properties);\n+\t\t\t} else {\n+\t\t\t\tfor (Entry<String, String> entry : properties.entrySet()) {\n+\t\t\t\t\tagent.setSystemProperty(entry.getKey(), entry.getValue());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjkyNTg3MA=="}, "originalCommit": {"oid": "dff67a6b900cd0f577961df65a326e632fe0be37"}, "originalPosition": 17}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1303, "cost": 1, "resetAt": "2021-11-12T13:16:51Z"}}}