{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA2NjY5NTQy", "number": 3950, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMVQxNDoxMTo1MVrOD0RD0g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMVQxNDoxMTo1MVrOD0RD0g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU2MTMyMDUwOnYy", "diffSide": "RIGHT", "path": "biz.aQute.bndlib/src/aQute/bnd/build/Workspace.java", "isResolved": true, "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMVQxNDoxMTo1MVrOGJH7XQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMVQxNzoyNzo0MlrOGJP1ag==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjIyMDI1Mw==", "bodyText": "Wouldn't be better to make sure Processor always stores it's base as a canonical file? Or does that mess up symlinks?", "url": "https://github.com/bndtools/bnd/pull/3950#discussion_r412220253", "createdAt": "2020-04-21T14:11:51Z", "author": {"login": "bjhargrave"}, "path": "biz.aQute.bndlib/src/aQute/bnd/build/Workspace.java", "diffHunk": "@@ -320,13 +321,18 @@ public void setFileSystem(File workspaceDir, String bndDir) throws Exception {\n \t}\n \n \tpublic Project getProjectFromFile(File projectDir) {\n-\t\tprojectDir = projectDir.getAbsoluteFile();\n-\t\tassert projectDir.isDirectory();\n+\t\ttry {\n+\t\t\tprojectDir = projectDir.getCanonicalFile();\n+\t\t\tassert projectDir.isDirectory();\n \n-\t\tif (getBase().equals(projectDir.getParentFile())) {\n-\t\t\treturn getProject(projectDir.getName());\n+\t\t\tif (getBase().getCanonicalFile()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5967600126c7674e60c2536576210a8db795983d"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjIzODc3MQ==", "bodyText": "That is the reason I did not have the courage ...\nI agree it would be nicer but it can break existing code. I always thought getAbsoluteFile would remove the .. :-(", "url": "https://github.com/bndtools/bnd/pull/3950#discussion_r412238771", "createdAt": "2020-04-21T14:33:07Z", "author": {"login": "pkriens"}, "path": "biz.aQute.bndlib/src/aQute/bnd/build/Workspace.java", "diffHunk": "@@ -320,13 +321,18 @@ public void setFileSystem(File workspaceDir, String bndDir) throws Exception {\n \t}\n \n \tpublic Project getProjectFromFile(File projectDir) {\n-\t\tprojectDir = projectDir.getAbsoluteFile();\n-\t\tassert projectDir.isDirectory();\n+\t\ttry {\n+\t\t\tprojectDir = projectDir.getCanonicalFile();\n+\t\t\tassert projectDir.isDirectory();\n \n-\t\tif (getBase().equals(projectDir.getParentFile())) {\n-\t\t\treturn getProject(projectDir.getName());\n+\t\t\tif (getBase().getCanonicalFile()", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjIyMDI1Mw=="}, "originalCommit": {"oid": "5967600126c7674e60c2536576210a8db795983d"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjI0MTg1OQ==", "bodyText": "Maybe instead of canonical path, we us IO.getPath since it already has logic to clean . and .. from paths?\n\n  \n    \n      bnd/aQute.libg/src/aQute/lib/io/IO.java\n    \n    \n        Lines 679 to 697\n      in\n      bee8153\n    \n    \n    \n    \n\n        \n          \n           for (f = base.getAbsoluteFile(); !rover.isEmpty();) { \n        \n\n        \n          \n           \tint n = rover.indexOf('/'); \n        \n\n        \n          \n           \tif (n < 0) { \n        \n\n        \n          \n           \t\tn = rover.length(); \n        \n\n        \n          \n           \t} \n        \n\n        \n          \n           \tif ((n == 0) || ((n == 1) && (rover.charAt(0) == '.'))) { \n        \n\n        \n          \n           \t\t// case \"\" or \".\" \n        \n\n        \n          \n           \t} else if ((n == 2) && (rover.charAt(0) == '.') && (rover.charAt(1) == '.')) { \n        \n\n        \n          \n           \t\t// case \"..\" \n        \n\n        \n          \n           \t\tFile parent = f.getParentFile(); \n        \n\n        \n          \n           \t\tif (parent != null) { \n        \n\n        \n          \n           \t\t\tf = parent; \n        \n\n        \n          \n           \t\t} \n        \n\n        \n          \n           \t} else { \n        \n\n        \n          \n           \t\tString segment = rover.substring(0, n); \n        \n\n        \n          \n           \t\tf = new File(f, segment); \n        \n\n        \n          \n           \t} \n        \n\n        \n          \n           \trover.increment(n + 1); \n        \n\n        \n          \n           }", "url": "https://github.com/bndtools/bnd/pull/3950#discussion_r412241859", "createdAt": "2020-04-21T14:36:42Z", "author": {"login": "bjhargrave"}, "path": "biz.aQute.bndlib/src/aQute/bnd/build/Workspace.java", "diffHunk": "@@ -320,13 +321,18 @@ public void setFileSystem(File workspaceDir, String bndDir) throws Exception {\n \t}\n \n \tpublic Project getProjectFromFile(File projectDir) {\n-\t\tprojectDir = projectDir.getAbsoluteFile();\n-\t\tassert projectDir.isDirectory();\n+\t\ttry {\n+\t\t\tprojectDir = projectDir.getCanonicalFile();\n+\t\t\tassert projectDir.isDirectory();\n \n-\t\tif (getBase().equals(projectDir.getParentFile())) {\n-\t\t\treturn getProject(projectDir.getName());\n+\t\t\tif (getBase().getCanonicalFile()", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjIyMDI1Mw=="}, "originalCommit": {"oid": "5967600126c7674e60c2536576210a8db795983d"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjM0OTMwMA==", "bodyText": "I considered that but I am not sure it handles the Windows drive identifier (d:) properly? This is the current problem I am trying to fix", "url": "https://github.com/bndtools/bnd/pull/3950#discussion_r412349300", "createdAt": "2020-04-21T17:26:56Z", "author": {"login": "pkriens"}, "path": "biz.aQute.bndlib/src/aQute/bnd/build/Workspace.java", "diffHunk": "@@ -320,13 +321,18 @@ public void setFileSystem(File workspaceDir, String bndDir) throws Exception {\n \t}\n \n \tpublic Project getProjectFromFile(File projectDir) {\n-\t\tprojectDir = projectDir.getAbsoluteFile();\n-\t\tassert projectDir.isDirectory();\n+\t\ttry {\n+\t\t\tprojectDir = projectDir.getCanonicalFile();\n+\t\t\tassert projectDir.isDirectory();\n \n-\t\tif (getBase().equals(projectDir.getParentFile())) {\n-\t\t\treturn getProject(projectDir.getName());\n+\t\t\tif (getBase().getCanonicalFile()", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjIyMDI1Mw=="}, "originalCommit": {"oid": "5967600126c7674e60c2536576210a8db795983d"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjM0OTgwMg==", "bodyText": "WINDOWS SUCKS!", "url": "https://github.com/bndtools/bnd/pull/3950#discussion_r412349802", "createdAt": "2020-04-21T17:27:42Z", "author": {"login": "pkriens"}, "path": "biz.aQute.bndlib/src/aQute/bnd/build/Workspace.java", "diffHunk": "@@ -320,13 +321,18 @@ public void setFileSystem(File workspaceDir, String bndDir) throws Exception {\n \t}\n \n \tpublic Project getProjectFromFile(File projectDir) {\n-\t\tprojectDir = projectDir.getAbsoluteFile();\n-\t\tassert projectDir.isDirectory();\n+\t\ttry {\n+\t\t\tprojectDir = projectDir.getCanonicalFile();\n+\t\t\tassert projectDir.isDirectory();\n \n-\t\tif (getBase().equals(projectDir.getParentFile())) {\n-\t\t\treturn getProject(projectDir.getName());\n+\t\t\tif (getBase().getCanonicalFile()", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjIyMDI1Mw=="}, "originalCommit": {"oid": "5967600126c7674e60c2536576210a8db795983d"}, "originalPosition": 20}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1455, "cost": 1, "resetAt": "2021-11-12T13:16:51Z"}}}