{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDg0NzU1ODI4", "number": 981, "title": "CAM-12115: refactor telemetry reporting", "bodyText": "implements retries for sending the telemetry\nretries are configurable in the engine configuration\nlets the toggling of the telemetry fail if the timer for reporting cannot be scheduled\nmakes the reporting period configurable via engine configuration and makes the first telemetry request after five minutes\n\nrelated to CAM-12115", "createdAt": "2020-09-11T07:37:24Z", "url": "https://github.com/camunda/camunda-bpm-platform/pull/981", "merged": true, "mergeCommit": {"oid": "b56ffdeac82ba1210130634db7b9fed8c7f6fb90"}, "closed": true, "closedAt": "2020-09-11T16:16:02Z", "author": {"login": "ThorbenLindhauer"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdHwwR8gBqjM3NTQ4OTA4NDA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdH3ze5gBqjM3NTcwMDI1NTM=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "96d5ae9fc6ffb385a5bf414cadf7b8945373d986", "author": {"user": {"login": "ThorbenLindhauer", "name": "Thorben Lindhauer"}}, "url": "https://github.com/camunda/camunda-bpm-platform/commit/96d5ae9fc6ffb385a5bf414cadf7b8945373d986", "committedDate": "2020-09-10T16:06:11Z", "message": "make telemetry reporting period configurable"}, "afterCommit": {"oid": "de219af78bc3b85dfe3095f7e5d4add57c5c7144", "author": {"user": {"login": "ThorbenLindhauer", "name": "Thorben Lindhauer"}}, "url": "https://github.com/camunda/camunda-bpm-platform/commit/de219af78bc3b85dfe3095f7e5d4add57c5c7144", "committedDate": "2020-09-11T08:02:37Z", "message": "make telemetry reporting period configurable"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "de219af78bc3b85dfe3095f7e5d4add57c5c7144", "author": {"user": {"login": "ThorbenLindhauer", "name": "Thorben Lindhauer"}}, "url": "https://github.com/camunda/camunda-bpm-platform/commit/de219af78bc3b85dfe3095f7e5d4add57c5c7144", "committedDate": "2020-09-11T08:02:37Z", "message": "make telemetry reporting period configurable"}, "afterCommit": {"oid": "0e4dbe6936be254ace926ba3ef9f8f29c0c8f59f", "author": {"user": {"login": "ThorbenLindhauer", "name": "Thorben Lindhauer"}}, "url": "https://github.com/camunda/camunda-bpm-platform/commit/0e4dbe6936be254ace926ba3ef9f8f29c0c8f59f", "committedDate": "2020-09-11T08:17:06Z", "message": "make telemetry reporting period configurable"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b1496a277c58ee71d1c1f231c261c2424399fec2", "author": {"user": {"login": "ThorbenLindhauer", "name": "Thorben Lindhauer"}}, "url": "https://github.com/camunda/camunda-bpm-platform/commit/b1496a277c58ee71d1c1f231c261c2424399fec2", "committedDate": "2020-09-11T08:19:56Z", "message": "improve(engine): make configurable retries when sending telemetry\n\n- retries can be configured in engine configuration\n- default is 2\n- in case of failure, the command counters should be restored so that\n  we send them the next time\n\nrelated to CAM-12115"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "18bf977bb63d40665f051c82ca87aa23f9718c76", "author": {"user": {"login": "ThorbenLindhauer", "name": "Thorben Lindhauer"}}, "url": "https://github.com/camunda/camunda-bpm-platform/commit/18bf977bb63d40665f051c82ca87aa23f9718c76", "committedDate": "2020-09-11T08:21:54Z", "message": "improve(engine): let telemetry toggle fail if scheduling fails\n\n- else the user assumes that telemetry will be reported, but in fact\n  it is not\n- on engine startup, we must catch the exception to avoid that startup\n  fails entirely\n\nrelated to CAM-12115"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0e4dbe6936be254ace926ba3ef9f8f29c0c8f59f", "author": {"user": {"login": "ThorbenLindhauer", "name": "Thorben Lindhauer"}}, "url": "https://github.com/camunda/camunda-bpm-platform/commit/0e4dbe6936be254ace926ba3ef9f8f29c0c8f59f", "committedDate": "2020-09-11T08:17:06Z", "message": "make telemetry reporting period configurable"}, "afterCommit": {"oid": "6815008f8ee0a08b3f6f1d2fdbfa139d5816eade", "author": {"user": {"login": "ThorbenLindhauer", "name": "Thorben Lindhauer"}}, "url": "https://github.com/camunda/camunda-bpm-platform/commit/6815008f8ee0a08b3f6f1d2fdbfa139d5816eade", "committedDate": "2020-09-11T08:23:25Z", "message": "feat(engine): make telemetry reporting period configurable\n\n- default is 24 hours\n- users can configure a different period via an engine configuration\n  property\n\nrelated to CAM-12115"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6815008f8ee0a08b3f6f1d2fdbfa139d5816eade", "author": {"user": {"login": "ThorbenLindhauer", "name": "Thorben Lindhauer"}}, "url": "https://github.com/camunda/camunda-bpm-platform/commit/6815008f8ee0a08b3f6f1d2fdbfa139d5816eade", "committedDate": "2020-09-11T08:23:25Z", "message": "feat(engine): make telemetry reporting period configurable\n\n- default is 24 hours\n- users can configure a different period via an engine configuration\n  property\n\nrelated to CAM-12115"}, "afterCommit": {"oid": "18501e1aa777397100cf36066cb24c849e196d73", "author": {"user": {"login": "ThorbenLindhauer", "name": "Thorben Lindhauer"}}, "url": "https://github.com/camunda/camunda-bpm-platform/commit/18501e1aa777397100cf36066cb24c849e196d73", "committedDate": "2020-09-11T08:24:23Z", "message": "feat(engine): make telemetry reporting period configurable\n\n- default is 24 hours\n- users can configure a different period via an engine configuration\n  property\n\nrelated to CAM-12115"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg2ODAzNDUw", "url": "https://github.com/camunda/camunda-bpm-platform/pull/981#pullrequestreview-486803450", "createdAt": "2020-09-11T13:25:41Z", "commit": {"oid": "18501e1aa777397100cf36066cb24c849e196d73"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMVQxMzoyNTo0MVrOHQev7A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMVQxMzoyNTo0MVrOHQev7A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzA0MzA1Mg==", "bodyText": "maybe this id should be 004 instead?\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                  exceptionMessage(\"013\", \"Unexpected response code {} when sending telemetry data\", responseCode));\n          \n          \n            \n                  exceptionMessage(\"004\", \"Unexpected response code {} when sending telemetry data\", responseCode));", "url": "https://github.com/camunda/camunda-bpm-platform/pull/981#discussion_r487043052", "createdAt": "2020-09-11T13:25:41Z", "author": {"login": "yanavasileva"}, "path": "engine/src/main/java/org/camunda/bpm/engine/impl/telemetry/TelemetryLogger.java", "diffHunk": "@@ -26,59 +27,85 @@ public void startTelemetrySendingTask() {\n   }\n \n   public void exceptionWhileSendingTelemetryData(Exception e) {\n+    logWarn(\"002\",\n+        \"Could not send telemetry data. Reason: {} with message '{}'. Set this logger to DEBUG/FINE for the full stacktrace.\",\n+        e.getClass().getSimpleName(),\n+        e.getMessage());\n     logDebug(\n-        \"002\", \"'{}' exception occurred while sending telemetry data with message: {}\", \n+        \"003\", \"{} occurred while sending telemetry data.\",\n         e.getClass().getCanonicalName(),\n-        e.getMessage());\n+        e);\n   }\n \n-  public void unexpectedResponseWhileSendingTelemetryData(int responseCode) {\n-    logDebug(\n-        \"003\", \"Unexpected response while sending telemetry data. Status code: {}\", responseCode);\n+  public ProcessEngineException unexpectedResponseWhileSendingTelemetryData(int responseCode) {\n+    return new ProcessEngineException(\n+      exceptionMessage(\"013\", \"Unexpected response code {} when sending telemetry data\", responseCode));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "18501e1aa777397100cf36066cb24c849e196d73"}, "originalPosition": 29}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg2OTA5NzI4", "url": "https://github.com/camunda/camunda-bpm-platform/pull/981#pullrequestreview-486909728", "createdAt": "2020-09-11T15:30:22Z", "commit": {"oid": "18501e1aa777397100cf36066cb24c849e196d73"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ee4a935662f2b8e4c3cd8de8073f634ceb26e00c", "author": {"user": {"login": "ThorbenLindhauer", "name": "Thorben Lindhauer"}}, "url": "https://github.com/camunda/camunda-bpm-platform/commit/ee4a935662f2b8e4c3cd8de8073f634ceb26e00c", "committedDate": "2020-09-11T16:14:48Z", "message": "feat(engine): make telemetry reporting period configurable\n\n- default is 24 hours\n- users can configure a different period via an engine configuration\n  property\n\nrelated to CAM-12115"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "18501e1aa777397100cf36066cb24c849e196d73", "author": {"user": {"login": "ThorbenLindhauer", "name": "Thorben Lindhauer"}}, "url": "https://github.com/camunda/camunda-bpm-platform/commit/18501e1aa777397100cf36066cb24c849e196d73", "committedDate": "2020-09-11T08:24:23Z", "message": "feat(engine): make telemetry reporting period configurable\n\n- default is 24 hours\n- users can configure a different period via an engine configuration\n  property\n\nrelated to CAM-12115"}, "afterCommit": {"oid": "ee4a935662f2b8e4c3cd8de8073f634ceb26e00c", "author": {"user": {"login": "ThorbenLindhauer", "name": "Thorben Lindhauer"}}, "url": "https://github.com/camunda/camunda-bpm-platform/commit/ee4a935662f2b8e4c3cd8de8073f634ceb26e00c", "committedDate": "2020-09-11T16:14:48Z", "message": "feat(engine): make telemetry reporting period configurable\n\n- default is 24 hours\n- users can configure a different period via an engine configuration\n  property\n\nrelated to CAM-12115"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2203, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}