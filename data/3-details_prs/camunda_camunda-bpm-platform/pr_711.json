{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg2MjcxNjg5", "number": 711, "title": "CAM-8724: fix(engine): timer jobs are executed on time", "bodyText": "Fix bug that executes Timer jobs whose DueDate is earlier than the sum of the Current Time and the JobExecutor wait time.\n\nRelated to CAM-8724", "createdAt": "2020-03-10T17:35:45Z", "url": "https://github.com/camunda/camunda-bpm-platform/pull/711", "merged": true, "mergeCommit": {"oid": "9f01e6f4e1d39d537872fc81354aac7e5f1c95b6"}, "closed": true, "closedAt": "2020-03-17T16:08:07Z", "author": {"login": "koevskinikola"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcMWGf7gBqjMxMTU3NjAxNTQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcOjil6gFqTM3NjA4NDIxMg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "319bc6fd01273ceb87f8441c6283713e9f424a5d", "author": {"user": {"login": "koevskinikola", "name": "Nikola Koevski"}}, "url": "https://github.com/camunda/camunda-bpm-platform/commit/319bc6fd01273ceb87f8441c6283713e9f424a5d", "committedDate": "2020-03-10T16:41:32Z", "message": "fix(engine): timer jobs are executed on time\n\n* Fix bug that executes Timer jobs whose DueDate is earlier than the sum of the Current Time and the JobExecutor wait time.\n\nRelated to CAM-8724"}, "afterCommit": {"oid": "cb006c0142ec4f79d8f5e6be1c76e77f975d8e6d", "author": {"user": {"login": "koevskinikola", "name": "Nikola Koevski"}}, "url": "https://github.com/camunda/camunda-bpm-platform/commit/cb006c0142ec4f79d8f5e6be1c76e77f975d8e6d", "committedDate": "2020-03-10T17:37:42Z", "message": "fix(engine): timer jobs are executed on time\n\n* Fix bug that executes Timer jobs whose DueDate is earlier than the sum of the Current Time and the JobExecutor wait time.\n\nRelated to CAM-8724"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcyNTQ5NDk2", "url": "https://github.com/camunda/camunda-bpm-platform/pull/711#pullrequestreview-372549496", "createdAt": "2020-03-11T08:23:20Z", "commit": {"oid": "a378e3e9bf4a6f88630b0d71184e344ad44b787b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMVQwODoyMzoyMFrOF0s7Dg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMVQwODoyMzoyMFrOF0s7Dg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDgwNjI4Ng==", "bodyText": "Should probably be <=, or?", "url": "https://github.com/camunda/camunda-bpm-platform/pull/711#discussion_r390806286", "createdAt": "2020-03-11T08:23:20Z", "author": {"login": "ThorbenLindhauer"}, "path": "engine/src/main/java/org/camunda/bpm/engine/impl/persistence/entity/JobManager.java", "diffHunk": "@@ -103,12 +103,7 @@ public void reschedule(JobEntity jobEntity, Date newDuedate) {\n   }\n \n   private void hintJobExecutorIfNeeded(JobEntity jobEntity, Date duedate) {\n-    // Check if this timer fires before the next time the job executor will check for new timers to fire.\n-    // This is highly unlikely because normally waitTimeInMillis is 5000 (5 seconds)\n-    // and timers are usually set further in the future\n-    JobExecutor jobExecutor = Context.getProcessEngineConfiguration().getJobExecutor();\n-    int waitTimeInMillis = jobExecutor.getWaitTimeInMillis();\n-    if (duedate.getTime() < (ClockUtil.getCurrentTime().getTime() + waitTimeInMillis)) {\n+    if (duedate.getTime() < ClockUtil.getCurrentTime().getTime()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a378e3e9bf4a6f88630b0d71184e344ad44b787b"}, "originalPosition": 10}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "74e4b4fb3c6b8a4b7500736c62a6908d0eafa252", "author": {"user": {"login": "koevskinikola", "name": "Nikola Koevski"}}, "url": "https://github.com/camunda/camunda-bpm-platform/commit/74e4b4fb3c6b8a4b7500736c62a6908d0eafa252", "committedDate": "2020-03-11T16:50:41Z", "message": "fix(engine): timer jobs are executed on time\n\n* Fix bug that executes Timer jobs whose DueDate is earlier than the sum of the Current Time and the JobExecutor wait time. Only Timer jobs that have a DueDate past, or equal, to the current time, should be executed immediately.\n* Refactor test to JUnit4.\n\nRelated to CAM-8724"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a378e3e9bf4a6f88630b0d71184e344ad44b787b", "author": {"user": {"login": "koevskinikola", "name": "Nikola Koevski"}}, "url": "https://github.com/camunda/camunda-bpm-platform/commit/a378e3e9bf4a6f88630b0d71184e344ad44b787b", "committedDate": "2020-03-11T07:48:09Z", "message": "SQUASH ME: remove unused import"}, "afterCommit": {"oid": "74e4b4fb3c6b8a4b7500736c62a6908d0eafa252", "author": {"user": {"login": "koevskinikola", "name": "Nikola Koevski"}}, "url": "https://github.com/camunda/camunda-bpm-platform/commit/74e4b4fb3c6b8a4b7500736c62a6908d0eafa252", "committedDate": "2020-03-11T16:50:41Z", "message": "fix(engine): timer jobs are executed on time\n\n* Fix bug that executes Timer jobs whose DueDate is earlier than the sum of the Current Time and the JobExecutor wait time. Only Timer jobs that have a DueDate past, or equal, to the current time, should be executed immediately.\n* Refactor test to JUnit4.\n\nRelated to CAM-8724"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "81fb7a0297e063029d6482108f9327ec76d8cae3", "author": {"user": {"login": "ThorbenLindhauer", "name": "Thorben Lindhauer"}}, "url": "https://github.com/camunda/camunda-bpm-platform/commit/81fb7a0297e063029d6482108f9327ec76d8cae3", "committedDate": "2020-03-16T16:34:44Z", "message": "squash: make guard more robust"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc1MzgwMzg2", "url": "https://github.com/camunda/camunda-bpm-platform/pull/711#pullrequestreview-375380386", "createdAt": "2020-03-16T16:28:05Z", "commit": {"oid": "74e4b4fb3c6b8a4b7500736c62a6908d0eafa252"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNlQxNjoyODowNVrOF28DoQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNlQxNjoyODowNVrOF28DoQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzE1MTM5Mw==", "bodyText": "schedule job for the next processor: what exactly do you mean here?", "url": "https://github.com/camunda/camunda-bpm-platform/pull/711#discussion_r393151393", "createdAt": "2020-03-16T16:28:05Z", "author": {"login": "ThorbenLindhauer"}, "path": "engine/src/main/java/org/camunda/bpm/engine/impl/persistence/entity/JobManager.java", "diffHunk": "@@ -132,6 +153,7 @@ protected void hintJobExecutor(JobEntity job) {\n       job.setLockOwner(jobExecutor.getLockOwner());\n       transactionListener = new ExclusiveJobAddedNotification(job.getId(), jobExecutorContext);\n     } else {\n+      // schedule job for the next processor and reset Acquisition strategy", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "74e4b4fb3c6b8a4b7500736c62a6908d0eafa252"}, "originalPosition": 68}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5a873b4a78c5de4aacc993956aba390fd4f8aca7", "author": {"user": {"login": "koevskinikola", "name": "Nikola Koevski"}}, "url": "https://github.com/camunda/camunda-bpm-platform/commit/5a873b4a78c5de4aacc993956aba390fd4f8aca7", "committedDate": "2020-03-17T08:00:50Z", "message": "SQUASH ME: rephrase comment for JobExecutor notification"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc2MDg0MjEy", "url": "https://github.com/camunda/camunda-bpm-platform/pull/711#pullrequestreview-376084212", "createdAt": "2020-03-17T14:25:29Z", "commit": {"oid": "5a873b4a78c5de4aacc993956aba390fd4f8aca7"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1942, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}