{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTM5MzUzMDI2", "number": 1193, "title": "feat(engine): config flag to skip output mappings on canceled activities", "bodyText": "Related to CAM-12894", "createdAt": "2020-12-14T10:49:16Z", "url": "https://github.com/camunda/camunda-bpm-platform/pull/1193", "merged": true, "mergeCommit": {"oid": "9022f866d36e85a76838f278f6874695c078b3a3"}, "closed": true, "closedAt": "2021-01-06T09:41:31Z", "author": {"login": "mboskamp"}, "timelineItems": {"totalCount": 13, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdmE5GogH2gAyNTM5MzUzMDI2OmMyZGEyNDA1N2NkOGZhNzk0ZjcxNTc5NDgwZjFlYTU0NTVmYjU2MmY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdtHqZIAH2gAyNTM5MzUzMDI2OjAyYWJmMGVlNDQzMjFlNzA2MTcwMTlmZWJmMjkwYTJiOTFhMGM5MTk=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "c2da24057cd8fa794f71579480f1ea5455fb562f", "author": {"user": {"login": "mboskamp", "name": "Miklas Boskamp"}}, "url": "https://github.com/camunda/camunda-bpm-platform/commit/c2da24057cd8fa794f71579480f1ea5455fb562f", "committedDate": "2020-12-14T12:28:21Z", "message": "feat(engine): config flag to skip output mappings on canceled activities\n\nRelated to CAM-12894"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "1213fb347268b126bd89384935162f1e070cb346", "author": {"user": {"login": "mboskamp", "name": "Miklas Boskamp"}}, "url": "https://github.com/camunda/camunda-bpm-platform/commit/1213fb347268b126bd89384935162f1e070cb346", "committedDate": "2020-12-14T10:48:43Z", "message": "feat(engine): config flag to skip output mappings on canceled activities\n\nRelated to CAM-12894"}, "afterCommit": {"oid": "c2da24057cd8fa794f71579480f1ea5455fb562f", "author": {"user": {"login": "mboskamp", "name": "Miklas Boskamp"}}, "url": "https://github.com/camunda/camunda-bpm-platform/commit/c2da24057cd8fa794f71579480f1ea5455fb562f", "committedDate": "2020-12-14T12:28:21Z", "message": "feat(engine): config flag to skip output mappings on canceled activities\n\nRelated to CAM-12894"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0f5dec4fdfe84400aba47ea2f8b70d18b16319ec", "author": {"user": {"login": "mboskamp", "name": "Miklas Boskamp"}}, "url": "https://github.com/camunda/camunda-bpm-platform/commit/0f5dec4fdfe84400aba47ea2f8b70d18b16319ec", "committedDate": "2020-12-14T14:37:37Z", "message": "trigger ci"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "38339a41aa03e53faffeea84b036057afbb2e21a", "author": {"user": {"login": "mboskamp", "name": "Miklas Boskamp"}}, "url": "https://github.com/camunda/camunda-bpm-platform/commit/38339a41aa03e53faffeea84b036057afbb2e21a", "committedDate": "2020-12-15T08:53:04Z", "message": "chore(engine): reset config flag after test"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU0MDA4MTMx", "url": "https://github.com/camunda/camunda-bpm-platform/pull/1193#pullrequestreview-554008131", "createdAt": "2020-12-16T19:19:15Z", "commit": {"oid": "38339a41aa03e53faffeea84b036057afbb2e21a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNlQxOToxOToxNlrOIHVPaA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNlQxOToxOToxNlrOIHVPaA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDU1ODk1Mg==", "bodyText": "It took quite a while for me to understand which elements we are trying to get to here specifically.\nWhat do you think about adding a little one-line explanation here to state which executions this is meant for?\nAlso, how confident are we that we do not include any unwanted executions with this as well? I have to admit that getting a good grip on which executions this might unwantedly include is quite tough. From a gut feeling, I would say this could also include other activity types, e.g. user tasks with boundary events?\nDo you think it makes sense to add some test cases for other activity types to ensure they are not affected by this? Or, if we already know there will be others affected by this, add test cases for them as well of course?", "url": "https://github.com/camunda/camunda-bpm-platform/pull/1193#discussion_r544558952", "createdAt": "2020-12-16T19:19:16Z", "author": {"login": "tmetzke"}, "path": "engine/src/main/java/org/camunda/bpm/engine/impl/pvm/runtime/operation/PvmAtomicOperationDeleteCascadeFireActivityEnd.java", "diffHunk": "@@ -71,6 +72,9 @@ protected void eventNotificationsCompleted(PvmExecutionImpl execution) {\n \n     } else {\n       if (execution.isScope()) {\n+        if(execution instanceof ExecutionEntity && !execution.isProcessInstanceExecution() && execution.isCanceled()) {\n+          execution.setSkipIoMappings(execution.isSkipIoMappings() || execution.getProcessEngine().getProcessEngineConfiguration().isSkipOutputMappingOnCanceledTasks());\n+        }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "38339a41aa03e53faffeea84b036057afbb2e21a"}, "originalPosition": 14}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5c1b5b462170fc0379ed33d49d8271527ccd63bf", "author": {"user": {"login": "mboskamp", "name": "Miklas Boskamp"}}, "url": "https://github.com/camunda/camunda-bpm-platform/commit/5c1b5b462170fc0379ed33d49d8271527ccd63bf", "committedDate": "2020-12-18T09:19:34Z", "message": "chore(engine): only include externalTasks"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU1MzI4Mzcw", "url": "https://github.com/camunda/camunda-bpm-platform/pull/1193#pullrequestreview-555328370", "createdAt": "2020-12-18T09:27:59Z", "commit": {"oid": "5c1b5b462170fc0379ed33d49d8271527ccd63bf"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xOFQwOToyODowMFrOIIbQ7A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xOFQwOToyODowMFrOIIbQ7A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTcwNjIyMA==", "bodyText": "I know it's a micro-optimization \ud83d\ude01, but the execution.isCanceled() is quite cheap and probably very selective (doesn't occur that often) - putting it first, we don't have to check the activity type in most cases I would imagine?\nFeel free to ignore it, it just caught my eye \ud83d\ude03", "url": "https://github.com/camunda/camunda-bpm-platform/pull/1193#discussion_r545706220", "createdAt": "2020-12-18T09:28:00Z", "author": {"login": "tmetzke"}, "path": "engine/src/main/java/org/camunda/bpm/engine/impl/pvm/runtime/operation/PvmAtomicOperationDeleteCascadeFireActivityEnd.java", "diffHunk": "@@ -72,7 +72,8 @@ protected void eventNotificationsCompleted(PvmExecutionImpl execution) {\n \n     } else {\n       if (execution.isScope()) {\n-        if(execution instanceof ExecutionEntity && !execution.isProcessInstanceExecution() && execution.isCanceled()) {\n+        if(isOutputMappingSkippableForActivity(activity) && execution.isCanceled()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5c1b5b462170fc0379ed33d49d8271527ccd63bf"}, "originalPosition": 23}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f4f054b96c5ddfd2b9c0cc38d0d330e23ec64489", "author": {"user": {"login": "mboskamp", "name": "Miklas Boskamp"}}, "url": "https://github.com/camunda/camunda-bpm-platform/commit/f4f054b96c5ddfd2b9c0cc38d0d330e23ec64489", "committedDate": "2020-12-18T09:32:02Z", "message": "chore(engine): swap conditions"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9392d3ffcdf6840b87cf3b7ed47824ab709adaf6", "author": {"user": {"login": "mboskamp", "name": "Miklas Boskamp"}}, "url": "https://github.com/camunda/camunda-bpm-platform/commit/9392d3ffcdf6840b87cf3b7ed47824ab709adaf6", "committedDate": "2021-01-04T14:11:21Z", "message": "chore(engine): extend for all activity types\n\n* move test in dedicated class\n* add test including a subprocess\n* rename config property"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e2c4f7964b3d3e31ddb2da1dfebafe76aab7d73e", "author": {"user": {"login": "mboskamp", "name": "Miklas Boskamp"}}, "url": "https://github.com/camunda/camunda-bpm-platform/commit/e2c4f7964b3d3e31ddb2da1dfebafe76aab7d73e", "committedDate": "2021-01-05T07:08:23Z", "message": "trigger CI"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTYxNjM3MjM0", "url": "https://github.com/camunda/camunda-bpm-platform/pull/1193#pullrequestreview-561637234", "createdAt": "2021-01-05T09:33:04Z", "commit": {"oid": "e2c4f7964b3d3e31ddb2da1dfebafe76aab7d73e"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wNVQwOTozMzowNFrOIOQIUQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wNVQwOTozMzowNFrOIOQIUQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTgxNTI0OQ==", "bodyText": "I think this will not be necessary anymore as the tests have been moved. \ud83d\ude03", "url": "https://github.com/camunda/camunda-bpm-platform/pull/1193#discussion_r551815249", "createdAt": "2021-01-05T09:33:04Z", "author": {"login": "tmetzke"}, "path": "engine/src/test/java/org/camunda/bpm/engine/test/api/externaltask/ExternalTaskServiceTest.java", "diffHunk": "@@ -103,6 +103,7 @@ public void setUp() throws Exception {\n   @After\n   public void tearDown() throws Exception {\n     ClockUtil.reset();\n+    processEngineConfiguration.setSkipOutputMappingOnCanceledActivities(false);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e2c4f7964b3d3e31ddb2da1dfebafe76aab7d73e"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTYxNjQxMDUw", "url": "https://github.com/camunda/camunda-bpm-platform/pull/1193#pullrequestreview-561641050", "createdAt": "2021-01-05T09:38:22Z", "commit": {"oid": "e2c4f7964b3d3e31ddb2da1dfebafe76aab7d73e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wNVQwOTozODoyMlrOIOQTzA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wNVQwOTozODoyMlrOIOQTzA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTgxODE4OA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                processEngineConfiguration.setSkipOutputMappingOnCanceledActivities(false);", "url": "https://github.com/camunda/camunda-bpm-platform/pull/1193#discussion_r551818188", "createdAt": "2021-01-05T09:38:22Z", "author": {"login": "mboskamp"}, "path": "engine/src/test/java/org/camunda/bpm/engine/test/api/externaltask/ExternalTaskServiceTest.java", "diffHunk": "@@ -103,6 +103,7 @@ public void setUp() throws Exception {\n   @After\n   public void tearDown() throws Exception {\n     ClockUtil.reset();\n+    processEngineConfiguration.setSkipOutputMappingOnCanceledActivities(false);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e2c4f7964b3d3e31ddb2da1dfebafe76aab7d73e"}, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "02abf0ee44321e70617019febf290a2b91a0c919", "author": {"user": {"login": "mboskamp", "name": "Miklas Boskamp"}}, "url": "https://github.com/camunda/camunda-bpm-platform/commit/02abf0ee44321e70617019febf290a2b91a0c919", "committedDate": "2021-01-05T09:39:28Z", "message": "Update engine/src/test/java/org/camunda/bpm/engine/test/api/externaltask/ExternalTaskServiceTest.java"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2111, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}