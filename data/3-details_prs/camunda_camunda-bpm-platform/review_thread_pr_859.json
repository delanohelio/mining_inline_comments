{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM0NjE0MjEw", "number": 859, "reviewThreads": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOFQwNzoyODowMVrOEGoZbw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOVQxMjo0ODo0MlrOEHGrXQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc1Mzg4NzgzOnYy", "diffSide": "RIGHT", "path": "engine/src/main/java/org/camunda/bpm/engine/impl/db/EnginePersistenceLogger.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOFQwNzoyODowMlrOGli52w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOFQwNzoyODowMlrOGli52w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjAyMjM2Mw==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    \"Error fetcing telemetry property in database: {}\", exception.getMessage());\n          \n          \n            \n                    \"Error while fetching the telemetry property from the database: {}\", exception.getMessage());", "url": "https://github.com/camunda/camunda-bpm-platform/pull/859#discussion_r442022363", "createdAt": "2020-06-18T07:28:02Z", "author": {"login": "tasso94"}, "path": "engine/src/main/java/org/camunda/bpm/engine/impl/db/EnginePersistenceLogger.java", "diffHunk": "@@ -739,4 +739,26 @@ public ProcessEngineException disabledHistoricInstancePermissionsException() {\n     ));\n   }\n \n+  public void noTelemetryLockPropertyFound() {\n+    logDebug(\n+        \"091\", \"No telemetry lock property found in database\");\n+  }\n+\n+  public void noTelemetryPropertyFound() {\n+    logDebug(\n+        \"092\", \"No telemetry property found in database\");\n+  }\n+\n+  public void creatingTelemetryPropertyInDatabase(Boolean telemetryEnabled) {\n+    logDebug(\n+        \"093\",\n+        \"Creating telemetry property in database with value: {}\", telemetryEnabled);\n+  }\n+\n+  public void errorFetchingTelemetryPropertyInDatabase(Exception exception) {\n+    logDebug(\n+        \"094\",\n+        \"Error fetcing telemetry property in database: {}\", exception.getMessage());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9fda8ea6ae8f689322a9c4186348040d67612a7f"}, "originalPosition": 23}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc1Mzg5MTQxOnYy", "diffSide": "RIGHT", "path": "engine/src/main/java/org/camunda/bpm/engine/impl/db/EnginePersistenceLogger.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOFQwNzoyOTowOVrOGli8GQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOFQwNzoyOTowOVrOGli8GQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjAyMjkzNw==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    \"091\", \"No telemetry lock property found in database\");\n          \n          \n            \n                    \"091\", \"No telemetry lock property found in the database\");", "url": "https://github.com/camunda/camunda-bpm-platform/pull/859#discussion_r442022937", "createdAt": "2020-06-18T07:29:09Z", "author": {"login": "tasso94"}, "path": "engine/src/main/java/org/camunda/bpm/engine/impl/db/EnginePersistenceLogger.java", "diffHunk": "@@ -739,4 +739,26 @@ public ProcessEngineException disabledHistoricInstancePermissionsException() {\n     ));\n   }\n \n+  public void noTelemetryLockPropertyFound() {\n+    logDebug(\n+        \"091\", \"No telemetry lock property found in database\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9fda8ea6ae8f689322a9c4186348040d67612a7f"}, "originalPosition": 6}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc1Mzg5MjEyOnYy", "diffSide": "RIGHT", "path": "engine/src/main/java/org/camunda/bpm/engine/impl/db/EnginePersistenceLogger.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOFQwNzoyOToyM1rOGli8hw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOFQwNzoyOToyM1rOGli8hw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjAyMzA0Nw==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    \"092\", \"No telemetry property found in database\");\n          \n          \n            \n                    \"092\", \"No telemetry property found in the database\");", "url": "https://github.com/camunda/camunda-bpm-platform/pull/859#discussion_r442023047", "createdAt": "2020-06-18T07:29:23Z", "author": {"login": "tasso94"}, "path": "engine/src/main/java/org/camunda/bpm/engine/impl/db/EnginePersistenceLogger.java", "diffHunk": "@@ -739,4 +739,26 @@ public ProcessEngineException disabledHistoricInstancePermissionsException() {\n     ));\n   }\n \n+  public void noTelemetryLockPropertyFound() {\n+    logDebug(\n+        \"091\", \"No telemetry lock property found in database\");\n+  }\n+\n+  public void noTelemetryPropertyFound() {\n+    logDebug(\n+        \"092\", \"No telemetry property found in database\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9fda8ea6ae8f689322a9c4186348040d67612a7f"}, "originalPosition": 11}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc1Mzg5MzI2OnYy", "diffSide": "RIGHT", "path": "engine/src/main/java/org/camunda/bpm/engine/impl/db/EnginePersistenceLogger.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOFQwNzoyOTo0M1rOGli9Lg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOFQwNzoyOTo0M1rOGli9Lg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjAyMzIxNA==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    \"Creating telemetry property in database with value: {}\", telemetryEnabled);\n          \n          \n            \n                    \"Creating the telemetry property in database with the value: {}\", telemetryEnabled);", "url": "https://github.com/camunda/camunda-bpm-platform/pull/859#discussion_r442023214", "createdAt": "2020-06-18T07:29:43Z", "author": {"login": "tasso94"}, "path": "engine/src/main/java/org/camunda/bpm/engine/impl/db/EnginePersistenceLogger.java", "diffHunk": "@@ -739,4 +739,26 @@ public ProcessEngineException disabledHistoricInstancePermissionsException() {\n     ));\n   }\n \n+  public void noTelemetryLockPropertyFound() {\n+    logDebug(\n+        \"091\", \"No telemetry lock property found in database\");\n+  }\n+\n+  public void noTelemetryPropertyFound() {\n+    logDebug(\n+        \"092\", \"No telemetry property found in database\");\n+  }\n+\n+  public void creatingTelemetryPropertyInDatabase(Boolean telemetryEnabled) {\n+    logDebug(\n+        \"093\",\n+        \"Creating telemetry property in database with value: {}\", telemetryEnabled);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9fda8ea6ae8f689322a9c4186348040d67612a7f"}, "originalPosition": 17}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc1MzkxODQ4OnYy", "diffSide": "RIGHT", "path": "engine/src/main/java/org/camunda/bpm/engine/impl/cmd/TelemetrySetupCommand.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOFQwNzozNzoxOVrOGljM7A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOFQwNzozNzoxOVrOGljM7A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjAyNzI0NA==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                  PropertyEntity telemetryPropetry =  fetchTelemetryProperty(commandContext);\n          \n          \n            \n                  PropertyEntity telemetryProperty = fetchTelemetryProperty(commandContext);", "url": "https://github.com/camunda/camunda-bpm-platform/pull/859#discussion_r442027244", "createdAt": "2020-06-18T07:37:19Z", "author": {"login": "tasso94"}, "path": "engine/src/main/java/org/camunda/bpm/engine/impl/cmd/TelemetrySetupCommand.java", "diffHunk": "@@ -0,0 +1,99 @@\n+/*\n+ * Copyright Camunda Services GmbH and/or licensed to Camunda Services GmbH\n+ * under one or more contributor license agreements. See the NOTICE file\n+ * distributed with this work for additional information regarding copyright\n+ * ownership. Camunda licenses this file to you under the Apache License,\n+ * Version 2.0; you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.camunda.bpm.engine.impl.cmd;\n+\n+import org.camunda.bpm.engine.impl.ProcessEngineLogger;\n+import org.camunda.bpm.engine.impl.db.EnginePersistenceLogger;\n+import org.camunda.bpm.engine.impl.db.entitymanager.DbEntityManager;\n+import org.camunda.bpm.engine.impl.interceptor.Command;\n+import org.camunda.bpm.engine.impl.interceptor.CommandContext;\n+import org.camunda.bpm.engine.impl.persistence.entity.PropertyEntity;\n+\n+public class TelemetrySetupCommand implements Command<Void> {\n+\n+  private final static EnginePersistenceLogger LOG = ProcessEngineLogger.PERSISTENCE_LOGGER;\n+\n+  protected boolean telemetryEnabled;\n+\n+  public TelemetrySetupCommand() {\n+  }\n+  \n+  public TelemetrySetupCommand(boolean enabled) {\n+    this.telemetryEnabled = enabled;\n+  }\n+\n+  public Void execute(CommandContext commandContext) {\n+\n+    checkTelemetryLockExists(commandContext);\n+\n+    Boolean databaseTelemetryProperty = databaseTelemetryConfiguration(commandContext);\n+\n+    if (databaseTelemetryProperty == null) {\n+\n+      commandContext.getPropertyManager().acquireExclusiveLockForTelemetry();\n+      databaseTelemetryProperty = databaseTelemetryConfiguration(commandContext);\n+\n+      if(databaseTelemetryProperty == null) {\n+        LOG.noTelemetryPropertyFound();\n+        createTelemetryProperty(commandContext);\n+      }\n+    } else if (databaseTelemetryProperty != null) {\n+\n+      commandContext.getPropertyManager().acquireExclusiveLockForTelemetry();\n+      databaseTelemetryProperty = databaseTelemetryConfiguration(commandContext);\n+\n+      if(databaseTelemetryProperty != null) {\n+        PropertyEntity telemetryProperty = fetchTelemetryProperty(commandContext);\n+        telemetryProperty.setValue(Boolean.toString(telemetryEnabled));\n+      } else {\n+        LOG.noTelemetryPropertyFound();\n+        createTelemetryProperty(commandContext);\n+      }\n+    }\n+\n+    return null;\n+  }\n+\n+  protected void checkTelemetryLockExists(CommandContext commandContext) {\n+    PropertyEntity telemetryLockProperty = commandContext.getPropertyManager().findPropertyById(\"telemetry.lock\");\n+    if (telemetryLockProperty == null) {\n+      LOG.noTelemetryLockPropertyFound();\n+    }\n+  }\n+\n+  private PropertyEntity fetchTelemetryProperty(CommandContext commandContext) {\n+    return commandContext.getPropertyManager().findPropertyById(\"camunda.telemetry.enabled\");\n+  }\n+\n+  protected Boolean databaseTelemetryConfiguration(CommandContext commandContext) {\n+    try {\n+      PropertyEntity telemetryPropetry =  fetchTelemetryProperty(commandContext);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9fda8ea6ae8f689322a9c4186348040d67612a7f"}, "originalPosition": 84}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc1MzkyOTYzOnYy", "diffSide": "RIGHT", "path": "engine/src/main/java/org/camunda/bpm/engine/impl/cmd/TelemetrySetupCommand.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOFQwNzo0MDozOFrOGljUAg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOFQwNzo0MDozOFrOGljUAg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjAyOTA1OA==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                }", "url": "https://github.com/camunda/camunda-bpm-platform/pull/859#discussion_r442029058", "createdAt": "2020-06-18T07:40:38Z", "author": {"login": "tasso94"}, "path": "engine/src/main/java/org/camunda/bpm/engine/impl/cmd/TelemetrySetupCommand.java", "diffHunk": "@@ -0,0 +1,99 @@\n+/*\n+ * Copyright Camunda Services GmbH and/or licensed to Camunda Services GmbH\n+ * under one or more contributor license agreements. See the NOTICE file\n+ * distributed with this work for additional information regarding copyright\n+ * ownership. Camunda licenses this file to you under the Apache License,\n+ * Version 2.0; you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.camunda.bpm.engine.impl.cmd;\n+\n+import org.camunda.bpm.engine.impl.ProcessEngineLogger;\n+import org.camunda.bpm.engine.impl.db.EnginePersistenceLogger;\n+import org.camunda.bpm.engine.impl.db.entitymanager.DbEntityManager;\n+import org.camunda.bpm.engine.impl.interceptor.Command;\n+import org.camunda.bpm.engine.impl.interceptor.CommandContext;\n+import org.camunda.bpm.engine.impl.persistence.entity.PropertyEntity;\n+\n+public class TelemetrySetupCommand implements Command<Void> {\n+\n+  private final static EnginePersistenceLogger LOG = ProcessEngineLogger.PERSISTENCE_LOGGER;\n+\n+  protected boolean telemetryEnabled;\n+\n+  public TelemetrySetupCommand() {\n+  }\n+  \n+  public TelemetrySetupCommand(boolean enabled) {\n+    this.telemetryEnabled = enabled;\n+  }\n+\n+  public Void execute(CommandContext commandContext) {\n+\n+    checkTelemetryLockExists(commandContext);\n+\n+    Boolean databaseTelemetryProperty = databaseTelemetryConfiguration(commandContext);\n+\n+    if (databaseTelemetryProperty == null) {\n+\n+      commandContext.getPropertyManager().acquireExclusiveLockForTelemetry();\n+      databaseTelemetryProperty = databaseTelemetryConfiguration(commandContext);\n+\n+      if(databaseTelemetryProperty == null) {\n+        LOG.noTelemetryPropertyFound();\n+        createTelemetryProperty(commandContext);\n+      }\n+    } else if (databaseTelemetryProperty != null) {\n+\n+      commandContext.getPropertyManager().acquireExclusiveLockForTelemetry();\n+      databaseTelemetryProperty = databaseTelemetryConfiguration(commandContext);\n+\n+      if(databaseTelemetryProperty != null) {\n+        PropertyEntity telemetryProperty = fetchTelemetryProperty(commandContext);\n+        telemetryProperty.setValue(Boolean.toString(telemetryEnabled));\n+      } else {\n+        LOG.noTelemetryPropertyFound();\n+        createTelemetryProperty(commandContext);\n+      }\n+    }\n+\n+    return null;\n+  }\n+\n+  protected void checkTelemetryLockExists(CommandContext commandContext) {\n+    PropertyEntity telemetryLockProperty = commandContext.getPropertyManager().findPropertyById(\"telemetry.lock\");\n+    if (telemetryLockProperty == null) {\n+      LOG.noTelemetryLockPropertyFound();\n+    }\n+  }\n+\n+  private PropertyEntity fetchTelemetryProperty(CommandContext commandContext) {\n+    return commandContext.getPropertyManager().findPropertyById(\"camunda.telemetry.enabled\");\n+  }\n+\n+  protected Boolean databaseTelemetryConfiguration(CommandContext commandContext) {\n+    try {\n+      PropertyEntity telemetryPropetry =  fetchTelemetryProperty(commandContext);\n+      return telemetryPropetry != null ? Boolean.parseBoolean(telemetryPropetry.getValue()) : null;\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9fda8ea6ae8f689322a9c4186348040d67612a7f"}, "originalPosition": 86}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc1MzkyOTg4OnYy", "diffSide": "RIGHT", "path": "engine/src/main/java/org/camunda/bpm/engine/impl/cmd/TelemetrySetupCommand.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOFQwNzo0MDo0MlrOGljUJQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOFQwNzo0MDo0MlrOGljUJQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjAyOTA5Mw==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                catch (Exception e) {\n          \n          \n            \n                } catch (Exception e) {", "url": "https://github.com/camunda/camunda-bpm-platform/pull/859#discussion_r442029093", "createdAt": "2020-06-18T07:40:42Z", "author": {"login": "tasso94"}, "path": "engine/src/main/java/org/camunda/bpm/engine/impl/cmd/TelemetrySetupCommand.java", "diffHunk": "@@ -0,0 +1,99 @@\n+/*\n+ * Copyright Camunda Services GmbH and/or licensed to Camunda Services GmbH\n+ * under one or more contributor license agreements. See the NOTICE file\n+ * distributed with this work for additional information regarding copyright\n+ * ownership. Camunda licenses this file to you under the Apache License,\n+ * Version 2.0; you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.camunda.bpm.engine.impl.cmd;\n+\n+import org.camunda.bpm.engine.impl.ProcessEngineLogger;\n+import org.camunda.bpm.engine.impl.db.EnginePersistenceLogger;\n+import org.camunda.bpm.engine.impl.db.entitymanager.DbEntityManager;\n+import org.camunda.bpm.engine.impl.interceptor.Command;\n+import org.camunda.bpm.engine.impl.interceptor.CommandContext;\n+import org.camunda.bpm.engine.impl.persistence.entity.PropertyEntity;\n+\n+public class TelemetrySetupCommand implements Command<Void> {\n+\n+  private final static EnginePersistenceLogger LOG = ProcessEngineLogger.PERSISTENCE_LOGGER;\n+\n+  protected boolean telemetryEnabled;\n+\n+  public TelemetrySetupCommand() {\n+  }\n+  \n+  public TelemetrySetupCommand(boolean enabled) {\n+    this.telemetryEnabled = enabled;\n+  }\n+\n+  public Void execute(CommandContext commandContext) {\n+\n+    checkTelemetryLockExists(commandContext);\n+\n+    Boolean databaseTelemetryProperty = databaseTelemetryConfiguration(commandContext);\n+\n+    if (databaseTelemetryProperty == null) {\n+\n+      commandContext.getPropertyManager().acquireExclusiveLockForTelemetry();\n+      databaseTelemetryProperty = databaseTelemetryConfiguration(commandContext);\n+\n+      if(databaseTelemetryProperty == null) {\n+        LOG.noTelemetryPropertyFound();\n+        createTelemetryProperty(commandContext);\n+      }\n+    } else if (databaseTelemetryProperty != null) {\n+\n+      commandContext.getPropertyManager().acquireExclusiveLockForTelemetry();\n+      databaseTelemetryProperty = databaseTelemetryConfiguration(commandContext);\n+\n+      if(databaseTelemetryProperty != null) {\n+        PropertyEntity telemetryProperty = fetchTelemetryProperty(commandContext);\n+        telemetryProperty.setValue(Boolean.toString(telemetryEnabled));\n+      } else {\n+        LOG.noTelemetryPropertyFound();\n+        createTelemetryProperty(commandContext);\n+      }\n+    }\n+\n+    return null;\n+  }\n+\n+  protected void checkTelemetryLockExists(CommandContext commandContext) {\n+    PropertyEntity telemetryLockProperty = commandContext.getPropertyManager().findPropertyById(\"telemetry.lock\");\n+    if (telemetryLockProperty == null) {\n+      LOG.noTelemetryLockPropertyFound();\n+    }\n+  }\n+\n+  private PropertyEntity fetchTelemetryProperty(CommandContext commandContext) {\n+    return commandContext.getPropertyManager().findPropertyById(\"camunda.telemetry.enabled\");\n+  }\n+\n+  protected Boolean databaseTelemetryConfiguration(CommandContext commandContext) {\n+    try {\n+      PropertyEntity telemetryPropetry =  fetchTelemetryProperty(commandContext);\n+      return telemetryPropetry != null ? Boolean.parseBoolean(telemetryPropetry.getValue()) : null;\n+    }\n+    catch (Exception e) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9fda8ea6ae8f689322a9c4186348040d67612a7f"}, "originalPosition": 87}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc1NDQwOTg3OnYy", "diffSide": "RIGHT", "path": "engine/src/main/java/org/camunda/bpm/engine/impl/cmd/TelemetrySetupCommand.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOFQwOTo1MjowMFrOGloGpw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOFQwOTo1MjowMFrOGloGpw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjEwNzU1OQ==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              private final static EnginePersistenceLogger LOG = ProcessEngineLogger.PERSISTENCE_LOGGER;\n          \n          \n            \n              protected static final EnginePersistenceLogger LOG = ProcessEngineLogger.PERSISTENCE_LOGGER;", "url": "https://github.com/camunda/camunda-bpm-platform/pull/859#discussion_r442107559", "createdAt": "2020-06-18T09:52:00Z", "author": {"login": "tasso94"}, "path": "engine/src/main/java/org/camunda/bpm/engine/impl/cmd/TelemetrySetupCommand.java", "diffHunk": "@@ -0,0 +1,99 @@\n+/*\n+ * Copyright Camunda Services GmbH and/or licensed to Camunda Services GmbH\n+ * under one or more contributor license agreements. See the NOTICE file\n+ * distributed with this work for additional information regarding copyright\n+ * ownership. Camunda licenses this file to you under the Apache License,\n+ * Version 2.0; you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.camunda.bpm.engine.impl.cmd;\n+\n+import org.camunda.bpm.engine.impl.ProcessEngineLogger;\n+import org.camunda.bpm.engine.impl.db.EnginePersistenceLogger;\n+import org.camunda.bpm.engine.impl.db.entitymanager.DbEntityManager;\n+import org.camunda.bpm.engine.impl.interceptor.Command;\n+import org.camunda.bpm.engine.impl.interceptor.CommandContext;\n+import org.camunda.bpm.engine.impl.persistence.entity.PropertyEntity;\n+\n+public class TelemetrySetupCommand implements Command<Void> {\n+\n+  private final static EnginePersistenceLogger LOG = ProcessEngineLogger.PERSISTENCE_LOGGER;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9fda8ea6ae8f689322a9c4186348040d67612a7f"}, "originalPosition": 28}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc1NDQxMDcxOnYy", "diffSide": "RIGHT", "path": "engine/src/main/java/org/camunda/bpm/engine/impl/cmd/TelemetrySetupCommand.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOFQwOTo1MjoxN1rOGloHTA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOFQwOTo1MjoxN1rOGloHTA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjEwNzcyNA==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              private PropertyEntity fetchTelemetryProperty(CommandContext commandContext) {\n          \n          \n            \n              protected PropertyEntity fetchTelemetryProperty(CommandContext commandContext) {", "url": "https://github.com/camunda/camunda-bpm-platform/pull/859#discussion_r442107724", "createdAt": "2020-06-18T09:52:17Z", "author": {"login": "tasso94"}, "path": "engine/src/main/java/org/camunda/bpm/engine/impl/cmd/TelemetrySetupCommand.java", "diffHunk": "@@ -0,0 +1,99 @@\n+/*\n+ * Copyright Camunda Services GmbH and/or licensed to Camunda Services GmbH\n+ * under one or more contributor license agreements. See the NOTICE file\n+ * distributed with this work for additional information regarding copyright\n+ * ownership. Camunda licenses this file to you under the Apache License,\n+ * Version 2.0; you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.camunda.bpm.engine.impl.cmd;\n+\n+import org.camunda.bpm.engine.impl.ProcessEngineLogger;\n+import org.camunda.bpm.engine.impl.db.EnginePersistenceLogger;\n+import org.camunda.bpm.engine.impl.db.entitymanager.DbEntityManager;\n+import org.camunda.bpm.engine.impl.interceptor.Command;\n+import org.camunda.bpm.engine.impl.interceptor.CommandContext;\n+import org.camunda.bpm.engine.impl.persistence.entity.PropertyEntity;\n+\n+public class TelemetrySetupCommand implements Command<Void> {\n+\n+  private final static EnginePersistenceLogger LOG = ProcessEngineLogger.PERSISTENCE_LOGGER;\n+\n+  protected boolean telemetryEnabled;\n+\n+  public TelemetrySetupCommand() {\n+  }\n+  \n+  public TelemetrySetupCommand(boolean enabled) {\n+    this.telemetryEnabled = enabled;\n+  }\n+\n+  public Void execute(CommandContext commandContext) {\n+\n+    checkTelemetryLockExists(commandContext);\n+\n+    Boolean databaseTelemetryProperty = databaseTelemetryConfiguration(commandContext);\n+\n+    if (databaseTelemetryProperty == null) {\n+\n+      commandContext.getPropertyManager().acquireExclusiveLockForTelemetry();\n+      databaseTelemetryProperty = databaseTelemetryConfiguration(commandContext);\n+\n+      if(databaseTelemetryProperty == null) {\n+        LOG.noTelemetryPropertyFound();\n+        createTelemetryProperty(commandContext);\n+      }\n+    } else if (databaseTelemetryProperty != null) {\n+\n+      commandContext.getPropertyManager().acquireExclusiveLockForTelemetry();\n+      databaseTelemetryProperty = databaseTelemetryConfiguration(commandContext);\n+\n+      if(databaseTelemetryProperty != null) {\n+        PropertyEntity telemetryProperty = fetchTelemetryProperty(commandContext);\n+        telemetryProperty.setValue(Boolean.toString(telemetryEnabled));\n+      } else {\n+        LOG.noTelemetryPropertyFound();\n+        createTelemetryProperty(commandContext);\n+      }\n+    }\n+\n+    return null;\n+  }\n+\n+  protected void checkTelemetryLockExists(CommandContext commandContext) {\n+    PropertyEntity telemetryLockProperty = commandContext.getPropertyManager().findPropertyById(\"telemetry.lock\");\n+    if (telemetryLockProperty == null) {\n+      LOG.noTelemetryLockPropertyFound();\n+    }\n+  }\n+\n+  private PropertyEntity fetchTelemetryProperty(CommandContext commandContext) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9fda8ea6ae8f689322a9c4186348040d67612a7f"}, "originalPosition": 78}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc1NDQxNTYwOnYy", "diffSide": "RIGHT", "path": "engine/src/main/java/org/camunda/bpm/engine/impl/ProcessEngineImpl.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOFQwOTo1MzozOVrOGloKcw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOFQwOTo1MzozOVrOGloKcw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjEwODUzMQ==", "bodyText": "Let's remove this check and always insert the telemetry enabled property on engine startup. We probably also don't need to pass the flag to the command since we can access the engine config inside the command.", "url": "https://github.com/camunda/camunda-bpm-platform/pull/859#discussion_r442108531", "createdAt": "2020-06-18T09:53:39Z", "author": {"login": "tasso94"}, "path": "engine/src/main/java/org/camunda/bpm/engine/impl/ProcessEngineImpl.java", "diffHunk": "@@ -144,6 +145,10 @@ public ProcessEngineImpl(ProcessEngineConfigurationImpl processEngineConfigurati\n   protected void executeSchemaOperations() {\n     commandExecutorSchemaOperations.execute(processEngineConfiguration.getSchemaOperationsCommand());\n     commandExecutorSchemaOperations.execute(processEngineConfiguration.getHistoryLevelCommand());\n+    \n+    if (processEngineConfiguration.isTelemetryEnabled()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9fda8ea6ae8f689322a9c4186348040d67612a7f"}, "originalPosition": 13}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc1ODg0ODkzOnYy", "diffSide": "RIGHT", "path": "engine/src/main/java/org/camunda/bpm/engine/impl/BootstrapEngineCommand.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOVQxMjo0ODo0MlrOGmTnvw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOVQxMjo0ODo0MlrOGmTnvw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjgyMDU0Mw==", "bodyText": "Nice dirty check! :)", "url": "https://github.com/camunda/camunda-bpm-platform/pull/859#discussion_r442820543", "createdAt": "2020-06-19T12:48:42Z", "author": {"login": "tasso94"}, "path": "engine/src/main/java/org/camunda/bpm/engine/impl/BootstrapEngineCommand.java", "diffHunk": "@@ -85,4 +89,50 @@ protected boolean isHistoryCleanupEnabled(CommandContext commandContext) {\n         .isHistoryCleanupEnabled();\n   }\n \n+  public void configureTelemetryProperty(CommandContext commandContext) {\n+    try {\n+\n+      checkTelemetryLockExists(commandContext);\n+\n+      commandContext.getPropertyManager().acquireExclusiveLockForTelemetry();\n+      PropertyEntity databaseTelemetryProperty = databaseTelemetryConfiguration(commandContext);\n+\n+      if (databaseTelemetryProperty == null) {\n+        LOG.noTelemetryPropertyFound();\n+        createTelemetryProperty(commandContext);\n+      } else {\n+        boolean oldValue = Boolean.parseBoolean(databaseTelemetryProperty.getValue());\n+        boolean currentValue = Context.getProcessEngineConfiguration().isTelemetryEnabled();\n+        if(currentValue != oldValue) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fd5bba65a95375531ed53b73ce779ecc34506fba"}, "originalPosition": 36}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4494, "cost": 1, "resetAt": "2021-11-12T18:49:56Z"}}}