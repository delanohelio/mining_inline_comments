{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk1Njc3NzMw", "number": 764, "title": "CAM-11690: Add filter and sort by deployment time options to DecisionDefinitionQuery", "bodyText": "", "createdAt": "2020-03-30T14:10:35Z", "url": "https://github.com/camunda/camunda-bpm-platform/pull/764", "merged": true, "mergeCommit": {"oid": "0b998c6ac3d0af4c07353891f1c261f36ab1a57d"}, "closed": true, "closedAt": "2020-04-09T15:03:46Z", "author": {"login": "mboskamp"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcTYbBmgBqjMxODgxMzEwMDg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcV3awrAFqTM5MDU1MzM5Ng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "caf0acf70a035354235ead37abafa265f57a4ec3", "author": {"user": {"login": "mboskamp", "name": "Miklas Boskamp"}}, "url": "https://github.com/camunda/camunda-bpm-platform/commit/caf0acf70a035354235ead37abafa265f57a4ec3", "committedDate": "2020-03-30T14:09:10Z", "message": "feat(engine): add filter/sort by deployment time to DecisionDefinition\n\nRelated to CAM-11325, CAM-11690"}, "afterCommit": {"oid": "507feda331d4664e9ed2cabccc9ce6776df4d49d", "author": {"user": {"login": "mboskamp", "name": "Miklas Boskamp"}}, "url": "https://github.com/camunda/camunda-bpm-platform/commit/507feda331d4664e9ed2cabccc9ce6776df4d49d", "committedDate": "2020-04-01T14:16:11Z", "message": "chore(engine): Improve tests\n\nRelated to CAM-11325, CAM-11690"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "507feda331d4664e9ed2cabccc9ce6776df4d49d", "author": {"user": {"login": "mboskamp", "name": "Miklas Boskamp"}}, "url": "https://github.com/camunda/camunda-bpm-platform/commit/507feda331d4664e9ed2cabccc9ce6776df4d49d", "committedDate": "2020-04-01T14:16:11Z", "message": "chore(engine): Improve tests\n\nRelated to CAM-11325, CAM-11690"}, "afterCommit": {"oid": "b96ef081b5149492ee048439903f2f8bdd2da1b1", "author": {"user": {"login": "mboskamp", "name": "Miklas Boskamp"}}, "url": "https://github.com/camunda/camunda-bpm-platform/commit/b96ef081b5149492ee048439903f2f8bdd2da1b1", "committedDate": "2020-04-07T13:19:23Z", "message": "feat(engine): add filter/sort by deployment time to DecisionDefinition\n\n* convert DecisionDefinitionQueryTest to JUnit4\n\nRelated to CAM-11325, CAM-11690"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg5MjI4NDY5", "url": "https://github.com/camunda/camunda-bpm-platform/pull/764#pullrequestreview-389228469", "createdAt": "2020-04-07T15:24:11Z", "commit": {"oid": "b96ef081b5149492ee048439903f2f8bdd2da1b1"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wN1QxNToyNDoxMVrOGCI_kQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wN1QxNToyNTozM1rOGCJDqg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDg5NzY4MQ==", "bodyText": "Please escape the comparison operator.", "url": "https://github.com/camunda/camunda-bpm-platform/pull/764#discussion_r404897681", "createdAt": "2020-04-07T15:24:11Z", "author": {"login": "ThorbenLindhauer"}, "path": "engine/src/main/resources/org/camunda/bpm/engine/impl/mapping/entity/DecisionDefinition.xml", "diffHunk": "@@ -306,9 +292,15 @@\n       <if test=\"deploymentId != null\">\n         and RES.DEPLOYMENT_ID_ = #{deploymentId}\n       </if>\n+      <if test=\"deployedAfter != null\">\n+        and DEP.DEPLOY_TIME_ > #{deployedAfter}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b96ef081b5149492ee048439903f2f8bdd2da1b1"}, "originalPosition": 58}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDg5ODczMA==", "bodyText": "This duplicate call to ClockUtil#setCurrentTime is not necessary.", "url": "https://github.com/camunda/camunda-bpm-platform/pull/764#discussion_r404898730", "createdAt": "2020-04-07T15:25:33Z", "author": {"login": "ThorbenLindhauer"}, "path": "engine/src/test/java/org/camunda/bpm/engine/test/api/repository/DecisionDefinitionQueryTest.java", "diffHunk": "@@ -126,79 +136,155 @@ public void queryByDecisionDefinitionIds() {\n       .decisionDefinitionIdIn(ids.toArray(new String[ids.size()]))\n       .list();\n \n-    assertEquals(ids.size(), decisionDefinitions.size());\n+    assertThat(decisionDefinitions).hasSize(ids.size());\n     for (DecisionDefinition decisionDefinition : decisionDefinitions) {\n-      if (!ids.contains(decisionDefinition.getId())) {\n-        fail(\"Expected to find decision definition \"+ decisionDefinition);\n-      }\n+      assertThat(ids).contains(decisionDefinition.getId()).withFailMessage(\"Expected to find decision definition \" + decisionDefinition);\n     }\n   }\n \n   @Test\n-\tpublic void queryByDeploymentId() {\n+  public void queryByDeploymentId() {\n     DecisionDefinitionQuery query = repositoryService.createDecisionDefinitionQuery();\n \n-    query\n-      .deploymentId(firstDeploymentId);\n+    query.deploymentId(firstDeploymentId);\n \n     verifyQueryResults(query, 2);\n   }\n \n   @Test\n-\tpublic void queryByInvalidDeploymentId() {\n+  public void queryByInvalidDeploymentId() {\n     DecisionDefinitionQuery query = repositoryService.createDecisionDefinitionQuery();\n \n    query\n      .deploymentId(\"invalid\");\n \n     verifyQueryResults(query, 0);\n \n-    try {\n-      query.deploymentId(null);\n-      fail();\n-    } catch (NotValidException e) {\n-      // Expected exception\n-    }\n+    exceptionRule.expect(NotValidException.class);\n+    query.deploymentId(null);\n   }\n \n   @Test\n-\tpublic void queryByName() {\n+  public void testQueryByDeploymentTimeAfter() {\n+    // given\n+    Date startTest = DateUtils.addSeconds(ClockUtil.now(), 5);\n+    ClockUtil.setCurrentTime(startTest);\n+\n+    ClockUtil.setCurrentTime(DateUtils.addSeconds(startTest, 5));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b96ef081b5149492ee048439903f2f8bdd2da1b1"}, "originalPosition": 179}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b96ef081b5149492ee048439903f2f8bdd2da1b1", "author": {"user": {"login": "mboskamp", "name": "Miklas Boskamp"}}, "url": "https://github.com/camunda/camunda-bpm-platform/commit/b96ef081b5149492ee048439903f2f8bdd2da1b1", "committedDate": "2020-04-07T13:19:23Z", "message": "feat(engine): add filter/sort by deployment time to DecisionDefinition\n\n* convert DecisionDefinitionQueryTest to JUnit4\n\nRelated to CAM-11325, CAM-11690"}, "afterCommit": {"oid": "2fae71775b498cb3e8e5a53270c2c8665e9ee7b4", "author": {"user": {"login": "mboskamp", "name": "Miklas Boskamp"}}, "url": "https://github.com/camunda/camunda-bpm-platform/commit/2fae71775b498cb3e8e5a53270c2c8665e9ee7b4", "committedDate": "2020-04-08T05:49:08Z", "message": "feat(engine): add filter/sort by deployment time to DecisionDefinition\n\n* convert DecisionDefinitionQueryTest to JUnit4\n\nRelated to CAM-11325, CAM-11690"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9d7809453ba5a97dbb9a94fa059f9df250ea7213", "author": {"user": {"login": "mboskamp", "name": "Miklas Boskamp"}}, "url": "https://github.com/camunda/camunda-bpm-platform/commit/9d7809453ba5a97dbb9a94fa059f9df250ea7213", "committedDate": "2020-04-08T11:10:38Z", "message": "feat(engine): add filter/sort by deployment time to DecisionDefinition\n\n* convert DecisionDefinitionQueryTest to JUnit4\n\nRelated to CAM-11325, CAM-11690"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "2fae71775b498cb3e8e5a53270c2c8665e9ee7b4", "author": {"user": {"login": "mboskamp", "name": "Miklas Boskamp"}}, "url": "https://github.com/camunda/camunda-bpm-platform/commit/2fae71775b498cb3e8e5a53270c2c8665e9ee7b4", "committedDate": "2020-04-08T05:49:08Z", "message": "feat(engine): add filter/sort by deployment time to DecisionDefinition\n\n* convert DecisionDefinitionQueryTest to JUnit4\n\nRelated to CAM-11325, CAM-11690"}, "afterCommit": {"oid": "9d7809453ba5a97dbb9a94fa059f9df250ea7213", "author": {"user": {"login": "mboskamp", "name": "Miklas Boskamp"}}, "url": "https://github.com/camunda/camunda-bpm-platform/commit/9d7809453ba5a97dbb9a94fa059f9df250ea7213", "committedDate": "2020-04-08T11:10:38Z", "message": "feat(engine): add filter/sort by deployment time to DecisionDefinition\n\n* convert DecisionDefinitionQueryTest to JUnit4\n\nRelated to CAM-11325, CAM-11690"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkwNTUzMzk2", "url": "https://github.com/camunda/camunda-bpm-platform/pull/764#pullrequestreview-390553396", "createdAt": "2020-04-09T07:32:30Z", "commit": {"oid": "9d7809453ba5a97dbb9a94fa059f9df250ea7213"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1821, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}