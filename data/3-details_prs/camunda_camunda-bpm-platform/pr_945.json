{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDc0NTgxOTg4", "number": 945, "title": "feat(rest): add batch operation to set variables", "bodyText": "related to CAM-12300", "createdAt": "2020-08-27T09:46:41Z", "url": "https://github.com/camunda/camunda-bpm-platform/pull/945", "merged": true, "mergeCommit": {"oid": "57ceba33255518c29d29a58633523ccca2828a7e"}, "closed": true, "closedAt": "2020-09-01T06:03:29Z", "author": {"login": "tasso94"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdDA7l_ABqjM2OTk4MDY2MzU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdETyqeAFqTQ3ODY3MjIwMA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "9e63defd0f238c06c7e471b6bf315beb88a3081a", "author": {"user": {"login": "tasso94", "name": "Tassilo Weidner"}}, "url": "https://github.com/camunda/camunda-bpm-platform/commit/9e63defd0f238c06c7e471b6bf315beb88a3081a", "committedDate": "2020-08-27T09:40:38Z", "message": "feat(rest): add batch operation to set variables\n\nrelated to CAM-12300"}, "afterCommit": {"oid": "bc8bdc96ef5313b72dc48e9b1b76d2f5fa2983ee", "author": {"user": {"login": "tasso94", "name": "Tassilo Weidner"}}, "url": "https://github.com/camunda/camunda-bpm-platform/commit/bc8bdc96ef5313b72dc48e9b1b76d2f5fa2983ee", "committedDate": "2020-08-27T14:03:07Z", "message": "feat(engine): add batch operation to set variables\n\nrelated to CAM-12301"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "bc8bdc96ef5313b72dc48e9b1b76d2f5fa2983ee", "author": {"user": {"login": "tasso94", "name": "Tassilo Weidner"}}, "url": "https://github.com/camunda/camunda-bpm-platform/commit/bc8bdc96ef5313b72dc48e9b1b76d2f5fa2983ee", "committedDate": "2020-08-27T14:03:07Z", "message": "feat(engine): add batch operation to set variables\n\nrelated to CAM-12301"}, "afterCommit": {"oid": "849dba4ab164196fab5c656b3b209470148439da", "author": {"user": {"login": "tasso94", "name": "Tassilo Weidner"}}, "url": "https://github.com/camunda/camunda-bpm-platform/commit/849dba4ab164196fab5c656b3b209470148439da", "committedDate": "2020-08-27T14:13:21Z", "message": "feat(rest): add batch operation to set variables\n\nrelated to CAM-12300"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cc85e19d2285c6b8348525799d2153b863e69a78", "author": {"user": {"login": "tasso94", "name": "Tassilo Weidner"}}, "url": "https://github.com/camunda/camunda-bpm-platform/commit/cc85e19d2285c6b8348525799d2153b863e69a78", "committedDate": "2020-08-27T14:15:43Z", "message": "feat(rest): add batch operation to set variables\n\nrelated to CAM-12300"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "849dba4ab164196fab5c656b3b209470148439da", "author": {"user": {"login": "tasso94", "name": "Tassilo Weidner"}}, "url": "https://github.com/camunda/camunda-bpm-platform/commit/849dba4ab164196fab5c656b3b209470148439da", "committedDate": "2020-08-27T14:13:21Z", "message": "feat(rest): add batch operation to set variables\n\nrelated to CAM-12300"}, "afterCommit": {"oid": "cc85e19d2285c6b8348525799d2153b863e69a78", "author": {"user": {"login": "tasso94", "name": "Tassilo Weidner"}}, "url": "https://github.com/camunda/camunda-bpm-platform/commit/cc85e19d2285c6b8348525799d2153b863e69a78", "committedDate": "2020-08-27T14:15:43Z", "message": "feat(rest): add batch operation to set variables\n\nrelated to CAM-12300"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc4NDU3MzMx", "url": "https://github.com/camunda/camunda-bpm-platform/pull/945#pullrequestreview-478457331", "createdAt": "2020-08-31T09:29:30Z", "commit": {"oid": "cc85e19d2285c6b8348525799d2153b863e69a78"}, "state": "APPROVED", "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0zMVQwOToyOTozMFrOHJxXuw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0zMVQwOTozNzoyNFrOHJxmyg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDAwODEyMw==", "bodyText": "I guess it is just fine like that, but what it really tests is that ProcessEngineExceptions are transformed to InvalidRequestExceptions, right?", "url": "https://github.com/camunda/camunda-bpm-platform/pull/945#discussion_r480008123", "createdAt": "2020-08-31T09:29:30Z", "author": {"login": "tmetzke"}, "path": "engine-rest/engine-rest/src/test/java/org/camunda/bpm/engine/rest/ProcessInstanceRestServiceInteractionTest.java", "diffHunk": "@@ -3634,6 +3640,254 @@ public void testAsyncProcessInstanceModificationCancellationSource() {\n     verify(mockModificationBuilder).cancellationSourceExternal(true);\n   }\n \n+  @Test\n+  public void shouldSetVariablesAsync() {\n+    // given\n+    Batch batchMock = createMockBatch();\n+    when(runtimeServiceMock.setVariablesAsync(any(), any(), any(), any()))\n+        .thenReturn(batchMock);\n+\n+    SetVariablesAsyncDto body = new SetVariablesAsyncDto();\n+\n+    VariableValueDto variableValueDto = new VariableValueDto();\n+    variableValueDto.setValue(\"bar\");\n+\n+    body.setVariables(Collections.singletonMap(\"foo\", variableValueDto));\n+\n+    // when\n+    Response response = given()\n+          .contentType(ContentType.JSON)\n+          .body(body)\n+        .then().expect()\n+          .statusCode(Status.OK.getStatusCode())\n+        .when()\n+          .post(PROCESS_INSTANCE_SET_VARIABLES_ASYNC_URL);\n+\n+    // then\n+    ArgumentCaptor<Map> captor = ArgumentCaptor.forClass(Map.class);\n+    verify(runtimeServiceMock).setVariablesAsync(\n+        eq(null),\n+        eq(null),\n+        eq(null),\n+        captor.capture()\n+    );\n+\n+    Assertions.assertThat(captor.getValue().get(\"foo\")).isEqualTo(\"bar\");\n+\n+    verifyBatchJson(response.asString());\n+  }\n+\n+  @Test\n+  public void shouldThrowExceptionWhenSetVariablesAsync_UnsupportedType() {\n+    // given\n+    Batch batchMock = createMockBatch();\n+    when(runtimeServiceMock.setVariablesAsync(any(), any(), any(), any()))\n+        .thenReturn(batchMock);\n+\n+    SetVariablesAsyncDto body = new SetVariablesAsyncDto();\n+\n+    VariableValueDto variableValueDto = new VariableValueDto();\n+    variableValueDto.setValue(\"bar\");\n+    variableValueDto.setType(\"unknown\");\n+\n+    body.setVariables(Collections.singletonMap(\"foo\", variableValueDto));\n+\n+    // when + then\n+    given()\n+          .contentType(ContentType.JSON)\n+          .body(body)\n+        .then().expect()\n+          .statusCode(Status.BAD_REQUEST.getStatusCode())\n+          .body(containsString(\"{\\\"type\\\":\\\"InvalidRequestException\\\",\" +\n+              \"\\\"message\\\":\\\"Cannot set variables: Unsupported value type 'unknown'\\\"}\"))\n+        .when()\n+          .post(PROCESS_INSTANCE_SET_VARIABLES_ASYNC_URL);\n+  }\n+\n+  @Test\n+  public void shouldThrowExceptionWhenSetVariablesAsync_JavaSerializationFormatProhibited() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cc85e19d2285c6b8348525799d2153b863e69a78"}, "originalPosition": 107}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDAxMDYzMg==", "bodyText": "Should we include the desc from camunda/camunda-docs-manual#664 as well?", "url": "https://github.com/camunda/camunda-bpm-platform/pull/945#discussion_r480010632", "createdAt": "2020-08-31T09:34:38Z", "author": {"login": "tmetzke"}, "path": "engine-rest/engine-rest-openapi/src/main/templates/models/org/camunda/bpm/engine/rest/dto/runtime/batch/SetVariablesAsyncDto.ftl", "diffHunk": "@@ -0,0 +1,27 @@\n+<@lib.dto>\n+\n+    <@lib.property\n+        name = \"processInstanceIds\"\n+        type = \"array\"\n+        itemType = \"string\"\n+        desc = \"A list of process instance ids that define a group of process instances\n+                to which the operation will set variables.\" />\n+\n+    <@lib.property\n+        name = \"processInstanceQuery\"\n+        type = \"ref\"\n+        dto = \"ProcessInstanceQueryDto\" />", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cc85e19d2285c6b8348525799d2153b863e69a78"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDAxMDcwMw==", "bodyText": "Should we include the desc from camunda/camunda-docs-manual#664 as well?", "url": "https://github.com/camunda/camunda-bpm-platform/pull/945#discussion_r480010703", "createdAt": "2020-08-31T09:34:48Z", "author": {"login": "tmetzke"}, "path": "engine-rest/engine-rest-openapi/src/main/templates/models/org/camunda/bpm/engine/rest/dto/runtime/batch/SetVariablesAsyncDto.ftl", "diffHunk": "@@ -0,0 +1,27 @@\n+<@lib.dto>\n+\n+    <@lib.property\n+        name = \"processInstanceIds\"\n+        type = \"array\"\n+        itemType = \"string\"\n+        desc = \"A list of process instance ids that define a group of process instances\n+                to which the operation will set variables.\" />\n+\n+    <@lib.property\n+        name = \"processInstanceQuery\"\n+        type = \"ref\"\n+        dto = \"ProcessInstanceQueryDto\" />\n+\n+    <@lib.property\n+        name = \"historicProcessInstanceQuery\"\n+        type = \"ref\"\n+        dto = \"HistoricProcessInstanceQueryDto\" />", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cc85e19d2285c6b8348525799d2153b863e69a78"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDAxMDkzMA==", "bodyText": "Should we include the desc from camunda/camunda-docs-manual#664 as well?", "url": "https://github.com/camunda/camunda-bpm-platform/pull/945#discussion_r480010930", "createdAt": "2020-08-31T09:35:15Z", "author": {"login": "tmetzke"}, "path": "engine-rest/engine-rest-openapi/src/main/templates/models/org/camunda/bpm/engine/rest/dto/runtime/batch/SetVariablesAsyncDto.ftl", "diffHunk": "@@ -0,0 +1,27 @@\n+<@lib.dto>\n+\n+    <@lib.property\n+        name = \"processInstanceIds\"\n+        type = \"array\"\n+        itemType = \"string\"\n+        desc = \"A list of process instance ids that define a group of process instances\n+                to which the operation will set variables.\" />\n+\n+    <@lib.property\n+        name = \"processInstanceQuery\"\n+        type = \"ref\"\n+        dto = \"ProcessInstanceQueryDto\" />\n+\n+    <@lib.property\n+        name = \"historicProcessInstanceQuery\"\n+        type = \"ref\"\n+        dto = \"HistoricProcessInstanceQueryDto\" />\n+\n+      <@lib.property\n+          name = \"variables\"\n+          type = \"object\"\n+          additionalProperties = true\n+          last = true\n+          dto = \"VariableValueDto\" />", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cc85e19d2285c6b8348525799d2153b863e69a78"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDAxMTk3OA==", "bodyText": "Should we also include the following hint from camunda/camunda-docs-manual#664?\nPlease note that if processInstanceIds, processInstanceQuery and historicProcessInstanceQuery\nare defined, the resulting operation will be performed on the union of these sets.", "url": "https://github.com/camunda/camunda-bpm-platform/pull/945#discussion_r480011978", "createdAt": "2020-08-31T09:37:24Z", "author": {"login": "tmetzke"}, "path": "engine-rest/engine-rest-openapi/src/main/templates/paths/process-instance/variables-async/post.ftl", "diffHunk": "@@ -0,0 +1,74 @@\n+{\n+  <@lib.endpointInfo\n+      id = \"setVariablesAsyncOperation\"\n+      tag = \"Process Instance\"\n+      desc = \"Update or create runtime process variables in the root scope of process instances.\" />", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cc85e19d2285c6b8348525799d2153b863e69a78"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "878a6604e5a1675506a2673af79006a32e2c4a8f", "author": {"user": {"login": "tasso94", "name": "Tassilo Weidner"}}, "url": "https://github.com/camunda/camunda-bpm-platform/commit/878a6604e5a1675506a2673af79006a32e2c4a8f", "committedDate": "2020-08-31T13:02:03Z", "message": "follow review hints"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7780f865e8c404e773d9198f1bfe0ac95426674f", "author": {"user": {"login": "tasso94", "name": "Tassilo Weidner"}}, "url": "https://github.com/camunda/camunda-bpm-platform/commit/7780f865e8c404e773d9198f1bfe0ac95426674f", "committedDate": "2020-08-31T12:54:10Z", "message": "follow review hints"}, "afterCommit": {"oid": "878a6604e5a1675506a2673af79006a32e2c4a8f", "author": {"user": {"login": "tasso94", "name": "Tassilo Weidner"}}, "url": "https://github.com/camunda/camunda-bpm-platform/commit/878a6604e5a1675506a2673af79006a32e2c4a8f", "committedDate": "2020-08-31T13:02:03Z", "message": "follow review hints"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc4NjcyMjAw", "url": "https://github.com/camunda/camunda-bpm-platform/pull/945#pullrequestreview-478672200", "createdAt": "2020-08-31T14:36:28Z", "commit": {"oid": "878a6604e5a1675506a2673af79006a32e2c4a8f"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1784, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}