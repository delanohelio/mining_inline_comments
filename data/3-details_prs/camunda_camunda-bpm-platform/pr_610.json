{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzU5NjA4ODM2", "number": 610, "title": "CAM-10784: feat(engine): add historic job log hostname information", "bodyText": "The PR adds a hostname column to the Historic  Job Log table.\nNote that I migrated the HistoricJobLogTest and HistoricJobLogQueryTest to JUnit 4. To see the relevant changes to these classes, please exclude commit 69a6d85.\nPlease squash the commits before merging.", "createdAt": "2020-01-06T16:15:02Z", "url": "https://github.com/camunda/camunda-bpm-platform/pull/610", "merged": true, "mergeCommit": {"oid": "1ec82c565ab0e88cdc5d708fe66346fccd0354ae"}, "closed": true, "closedAt": "2020-01-09T13:26:18Z", "author": {"login": "koevskinikola"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb4BTqOAH2gAyMzU5NjA4ODM2OmY5NmYzNjg1NjgwY2FhMDRmZGI1OTQ1YzI5YTcwNmNkZTVkYWFiNTk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABb4p6x-AFqTM0MDUxNTg5OA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "f96f3685680caa04fdb5945c29a706cde5daab59", "author": {"user": {"login": "koevskinikola", "name": "Nikola Koevski"}}, "url": "https://github.com/camunda/camunda-bpm-platform/commit/f96f3685680caa04fdb5945c29a706cde5daab59", "committedDate": "2020-01-07T14:06:04Z", "message": "feat(engine): add hostname to historic job log\n\n* Provide a hostName configuration String;\n* Add a HostNameProvider interface;\n* Replace MetricsReporterIdProvider with HostNameProvider;\n* Define Hostname vs Metrics Provider priority during ProcessEngine bootstrap;\n* Deprecate MetricsReporterIdProvider;\n\nRelated to CAM-10784"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "69a6d85324998e2e137a6820e80f7fadba7cc77f", "author": {"user": {"login": "koevskinikola", "name": "Nikola Koevski"}}, "url": "https://github.com/camunda/camunda-bpm-platform/commit/69a6d85324998e2e137a6820e80f7fadba7cc77f", "committedDate": "2020-01-07T14:06:11Z", "message": "chore(engine): refactor historic job log tests to junit4"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ad3624293842e26904010633a0bdc755f61f23dd", "author": {"user": {"login": "koevskinikola", "name": "Nikola Koevski"}}, "url": "https://github.com/camunda/camunda-bpm-platform/commit/ad3624293842e26904010633a0bdc755f61f23dd", "committedDate": "2020-01-07T14:06:11Z", "message": "feat(engine): add historic job log hostname tests\n\nRelated to CAM-10784"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b460c9ae88f41c7d06c3cafe4510585e8a34fa4f", "author": {"user": {"login": "koevskinikola", "name": "Nikola Koevski"}}, "url": "https://github.com/camunda/camunda-bpm-platform/commit/b460c9ae88f41c7d06c3cafe4510585e8a34fa4f", "committedDate": "2020-01-07T10:43:05Z", "message": "chore(engine): add missing hostname sort property and method"}, "afterCommit": {"oid": "ad3624293842e26904010633a0bdc755f61f23dd", "author": {"user": {"login": "koevskinikola", "name": "Nikola Koevski"}}, "url": "https://github.com/camunda/camunda-bpm-platform/commit/ad3624293842e26904010633a0bdc755f61f23dd", "committedDate": "2020-01-07T14:06:11Z", "message": "feat(engine): add historic job log hostname tests\n\nRelated to CAM-10784"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzM5ODM3MjIx", "url": "https://github.com/camunda/camunda-bpm-platform/pull/610#pullrequestreview-339837221", "createdAt": "2020-01-08T12:40:36Z", "commit": {"oid": "ad3624293842e26904010633a0bdc755f61f23dd"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOFQxMjo0MDozNlrOFbVrnw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOFQxNDo1NjoxNVrOFbZaTg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDIxMTEwMw==", "bodyText": "I guess we can use the following instead of both lines?\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                ensureNotNull(\"hostName\", hostname);\n          \n          \n            \n                ensureNotContainsEmptyString(\"hostName\", Collections.singletonList(hostname));\n          \n          \n            \n                ensureNotEmpty(\"hostName\", hostname);", "url": "https://github.com/camunda/camunda-bpm-platform/pull/610#discussion_r364211103", "createdAt": "2020-01-08T12:40:36Z", "author": {"login": "tmetzke"}, "path": "engine/src/main/java/org/camunda/bpm/engine/impl/HistoricJobLogQueryImpl.java", "diffHunk": "@@ -166,6 +168,14 @@ public HistoricJobLogQuery withoutTenantId() {\n     return this;\n   }\n \n+  @Override\n+  public HistoricJobLogQuery hostname(String hostname) {\n+    ensureNotNull(\"hostName\", hostname);\n+    ensureNotContainsEmptyString(\"hostName\", Collections.singletonList(hostname));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ad3624293842e26904010633a0bdc755f61f23dd"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDIxMzQyNg==", "bodyText": "This import can be removed if the other comment in this class below is accepted.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            import java.util.Collections;", "url": "https://github.com/camunda/camunda-bpm-platform/pull/610#discussion_r364213426", "createdAt": "2020-01-08T12:47:20Z", "author": {"login": "tmetzke"}, "path": "engine/src/main/java/org/camunda/bpm/engine/impl/HistoricJobLogQueryImpl.java", "diffHunk": "@@ -20,6 +20,7 @@\n import static org.camunda.bpm.engine.impl.util.EnsureUtil.ensureNotContainsNull;\n import static org.camunda.bpm.engine.impl.util.EnsureUtil.ensureNotNull;\n \n+import java.util.Collections;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ad3624293842e26904010633a0bdc755f61f23dd"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDI3MjIwNg==", "bodyText": "Let's move this to the ProcessEngineConfiguration#initHostname method", "url": "https://github.com/camunda/camunda-bpm-platform/pull/610#discussion_r364272206", "createdAt": "2020-01-08T14:56:15Z", "author": {"login": "tmetzke"}, "path": "engine/src/main/java/org/camunda/bpm/engine/impl/ProcessEngineImpl.java", "diffHunk": "@@ -90,6 +91,13 @@ public ProcessEngineImpl(ProcessEngineConfigurationImpl processEngineConfigurati\n     this.historyLevel = processEngineConfiguration.getHistoryLevel();\n     this.transactionContextFactory = processEngineConfiguration.getTransactionContextFactory();\n \n+    // provide hostname before history cleanup job is created in `executeSchemaOperations()`\n+    String hostname = processEngineConfiguration.getHostname();\n+    if (hostname == null) {\n+      hostname = processEngineConfiguration.getHostnameProvider().getHostname(this);\n+      processEngineConfiguration.setHostname(hostname);\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ad3624293842e26904010633a0bdc755f61f23dd"}, "originalPosition": 17}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "47c5dbe9af0226f05f1c8919da1f434ac3fb7382", "author": {"user": {"login": "koevskinikola", "name": "Nikola Koevski"}}, "url": "https://github.com/camunda/camunda-bpm-platform/commit/47c5dbe9af0226f05f1c8919da1f434ac3fb7382", "committedDate": "2020-01-09T10:55:23Z", "message": "chore(engine): implement review hints\n\n* Move Hostname initialization completely to the ProcessEngineConfigurationImpl class;\n* Refactor the HostnameProvider interface to accept a ProcessEngineConfiguration instance as a method parameter;\n* Add additional tests for Hostname/Metrics Reporter scenarios."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "af26b6cbfc5ae5f7108c291ea88434ca1795d99d", "author": {"user": {"login": "koevskinikola", "name": "Nikola Koevski"}}, "url": "https://github.com/camunda/camunda-bpm-platform/commit/af26b6cbfc5ae5f7108c291ea88434ca1795d99d", "committedDate": "2020-01-09T10:56:45Z", "message": "chore(engine): add a configuration property to the bootstrap rule\n\n* Provide Java 8 syntax for ProcessEngineBootstrapRule configuration."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8c2908daf5edf0beb8ea55a664a5da3080c53bb7", "author": {"user": {"login": "koevskinikola", "name": "Nikola Koevski"}}, "url": "https://github.com/camunda/camunda-bpm-platform/commit/8c2908daf5edf0beb8ea55a664a5da3080c53bb7", "committedDate": "2020-01-09T11:41:39Z", "message": "SQUASH ME: optimize imports and refactor HostnameProvider"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0578ac387aace79a3f2036a2b743e36ab1757264", "author": {"user": {"login": "koevskinikola", "name": "Nikola Koevski"}}, "url": "https://github.com/camunda/camunda-bpm-platform/commit/0578ac387aace79a3f2036a2b743e36ab1757264", "committedDate": "2020-01-09T12:38:59Z", "message": "chore(engine): add review hints\n\n* Add test case for default behavior;\n* Add comment for Metrics Reporter behavior in ProcessEngineImpl code."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bfdd1618cecf47451f5b73b0c7ca3593ef4319f2", "author": {"user": {"login": "koevskinikola", "name": "Nikola Koevski"}}, "url": "https://github.com/camunda/camunda-bpm-platform/commit/bfdd1618cecf47451f5b73b0c7ca3593ef4319f2", "committedDate": "2020-01-09T13:15:43Z", "message": "SQUASH ME: simplify test code"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQwNTE1ODk4", "url": "https://github.com/camunda/camunda-bpm-platform/pull/610#pullrequestreview-340515898", "createdAt": "2020-01-09T13:25:00Z", "commit": {"oid": "bfdd1618cecf47451f5b73b0c7ca3593ef4319f2"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2006, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}