{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzYxNDQ5NDIz", "number": 617, "title": "[CAM-10378] feat(engine): add id of failed activity to job", "bodyText": "Separated PR into 2 commits for easier comprehension, otherwise the changes in ProcessDataLoggingContext are hard to grasp:\n\ncommit 8cca251 adds the functionality\ncommit ed41ac6 renames the data context class (otherwise, one addition and one deletion are part of the changeset and the changes are not really comparable)\n\nPlease squash commits before merge.\nrelated to CAM-10378", "createdAt": "2020-01-10T13:26:06Z", "url": "https://github.com/camunda/camunda-bpm-platform/pull/617", "merged": true, "mergeCommit": {"oid": "6f0320245594a4e62d54952f5fd7bab90de47595"}, "closed": true, "closedAt": "2020-01-17T10:05:38Z", "author": {"login": "tmetzke"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb6N6MeABqjI5NDYzNzcwMTM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABb7lkWRgFqTM0NDk0OTc5NA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "9cc036c2bc8bfbf5dcd655b86c3ee220ac1ed545", "author": {"user": {"login": "tmetzke", "name": "Tobias Metzke-Bernstein"}}, "url": "https://github.com/camunda/camunda-bpm-platform/commit/9cc036c2bc8bfbf5dcd655b86c3ee220ac1ed545", "committedDate": "2020-01-14T09:14:16Z", "message": "* handle internal properties correctly\n  when disabled in logging configuration"}, "afterCommit": {"oid": "ea2c5d10e675f894d062942c0c012df265c16fb6", "author": {"user": {"login": "tmetzke", "name": "Tobias Metzke-Bernstein"}}, "url": "https://github.com/camunda/camunda-bpm-platform/commit/ea2c5d10e675f894d062942c0c012df265c16fb6", "committedDate": "2020-01-14T09:53:39Z", "message": "merge ProcessDataContext and ProcessDataLoggingContext\n\n* handle internal properties correctly\n  when disabled in logging configuration"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ea2c5d10e675f894d062942c0c012df265c16fb6", "author": {"user": {"login": "tmetzke", "name": "Tobias Metzke-Bernstein"}}, "url": "https://github.com/camunda/camunda-bpm-platform/commit/ea2c5d10e675f894d062942c0c012df265c16fb6", "committedDate": "2020-01-14T09:53:39Z", "message": "merge ProcessDataContext and ProcessDataLoggingContext\n\n* handle internal properties correctly\n  when disabled in logging configuration"}, "afterCommit": {"oid": "2c46be093c683e16f2132928213234d4f7f25c54", "author": {"user": {"login": "tmetzke", "name": "Tobias Metzke-Bernstein"}}, "url": "https://github.com/camunda/camunda-bpm-platform/commit/2c46be093c683e16f2132928213234d4f7f25c54", "committedDate": "2020-01-14T12:18:50Z", "message": "* rename ProcessDataLoggingContext to ProcessDataContext"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "2c46be093c683e16f2132928213234d4f7f25c54", "author": {"user": {"login": "tmetzke", "name": "Tobias Metzke-Bernstein"}}, "url": "https://github.com/camunda/camunda-bpm-platform/commit/2c46be093c683e16f2132928213234d4f7f25c54", "committedDate": "2020-01-14T12:18:50Z", "message": "* rename ProcessDataLoggingContext to ProcessDataContext"}, "afterCommit": {"oid": "8676b1f422671595e2a4d02c2ea9e08821c33e17", "author": {"user": {"login": "tmetzke", "name": "Tobias Metzke-Bernstein"}}, "url": "https://github.com/camunda/camunda-bpm-platform/commit/8676b1f422671595e2a4d02c2ea9e08821c33e17", "committedDate": "2020-01-14T13:06:42Z", "message": "* rename ProcessDataLoggingContext to ProcessDataContext"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8cca25185bb61b100ff18fde9a5cdb23f24510d3", "author": {"user": {"login": "tmetzke", "name": "Tobias Metzke-Bernstein"}}, "url": "https://github.com/camunda/camunda-bpm-platform/commit/8cca25185bb61b100ff18fde9a5cdb23f24510d3", "committedDate": "2020-01-15T08:08:48Z", "message": "feat(engine): add id of failed activity to job\n\nrelated to CAM-10378"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "8676b1f422671595e2a4d02c2ea9e08821c33e17", "author": {"user": {"login": "tmetzke", "name": "Tobias Metzke-Bernstein"}}, "url": "https://github.com/camunda/camunda-bpm-platform/commit/8676b1f422671595e2a4d02c2ea9e08821c33e17", "committedDate": "2020-01-14T13:06:42Z", "message": "* rename ProcessDataLoggingContext to ProcessDataContext"}, "afterCommit": {"oid": "ee2747afb9baa9f88438a0baea4f78a1df5a0b40", "author": {"user": {"login": "tmetzke", "name": "Tobias Metzke-Bernstein"}}, "url": "https://github.com/camunda/camunda-bpm-platform/commit/ee2747afb9baa9f88438a0baea4f78a1df5a0b40", "committedDate": "2020-01-15T08:08:49Z", "message": "* rename ProcessDataLoggingContext to ProcessDataContext"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ed41ac6f09a9dd4c1927ec84ddebafb2c45f1415", "author": {"user": {"login": "tmetzke", "name": "Tobias Metzke-Bernstein"}}, "url": "https://github.com/camunda/camunda-bpm-platform/commit/ed41ac6f09a9dd4c1927ec84ddebafb2c45f1415", "committedDate": "2020-01-15T11:41:55Z", "message": "* rename ProcessDataLoggingContext to ProcessDataContext"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ee2747afb9baa9f88438a0baea4f78a1df5a0b40", "author": {"user": {"login": "tmetzke", "name": "Tobias Metzke-Bernstein"}}, "url": "https://github.com/camunda/camunda-bpm-platform/commit/ee2747afb9baa9f88438a0baea4f78a1df5a0b40", "committedDate": "2020-01-15T08:08:49Z", "message": "* rename ProcessDataLoggingContext to ProcessDataContext"}, "afterCommit": {"oid": "ed41ac6f09a9dd4c1927ec84ddebafb2c45f1415", "author": {"user": {"login": "tmetzke", "name": "Tobias Metzke-Bernstein"}}, "url": "https://github.com/camunda/camunda-bpm-platform/commit/ed41ac6f09a9dd4c1927ec84ddebafb2c45f1415", "committedDate": "2020-01-15T11:41:55Z", "message": "* rename ProcessDataLoggingContext to ProcessDataContext"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQzODU4MTM4", "url": "https://github.com/camunda/camunda-bpm-platform/pull/617#pullrequestreview-343858138", "createdAt": "2020-01-16T11:52:36Z", "commit": {"oid": "ed41ac6f09a9dd4c1927ec84ddebafb2c45f1415"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNlQxMTo1MjozN1rOFeW4_g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNlQxMTo1MjozN1rOFeW4_g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzM3NjYzOA==", "bodyText": "Since we're refactoring, should the fields be set to protected as per the code style?", "url": "https://github.com/camunda/camunda-bpm-platform/pull/617#discussion_r367376638", "createdAt": "2020-01-16T11:52:37Z", "author": {"login": "koevskinikola"}, "path": "engine/src/main/java/org/camunda/bpm/engine/impl/interceptor/ProcessDataContext.java", "diffHunk": "@@ -0,0 +1,292 @@\n+/*\n+ * Copyright Camunda Services GmbH and/or licensed to Camunda Services GmbH\n+ * under one or more contributor license agreements. See the NOTICE file\n+ * distributed with this work for additional information regarding copyright\n+ * ownership. Camunda licenses this file to you under the Apache License,\n+ * Version 2.0; you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.camunda.bpm.engine.impl.interceptor;\n+\n+import java.util.ArrayDeque;\n+import java.util.ArrayList;\n+import java.util.Deque;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+\n+import org.camunda.bpm.application.ProcessApplicationReference;\n+import org.camunda.bpm.engine.impl.cfg.ProcessEngineConfigurationImpl;\n+import org.camunda.bpm.engine.impl.context.Context;\n+import org.camunda.bpm.engine.impl.persistence.entity.ExecutionEntity;\n+import org.camunda.commons.logging.MdcAccess;\n+\n+/**\n+ * Holds the contextual process data.<br>\n+ *\n+ * New context properties are always part of a section that can be started by\n+ * {@link #pushSection(ExecutionEntity)}. The section keeps track of all pushed\n+ * properties. Those can easily be cleared by popping the section with\n+ * {@link #popSection()} afterwards, e.g. after the successful execution.<br>\n+ *\n+ * A property can be pushed to the logging context (MDC) if there is a configured\n+ * non-empty context name for it in the {@link ProcessEngineConfigurationImpl\n+ * process engine configuration}. The following configuration options are\n+ * available:\n+ * <ul>\n+ * <li>loggingContextActivityId - the context property for the activity id</li>\n+ * <li>loggingContextApplicationName - the context property for the application name</li>\n+ * <li>loggingContextBusinessKey - the context property for the business key</li>\n+ * <li>loggingContextDefinitionId - the context property for the definition id</li>\n+ * <li>loggingContextProcessInstanceId - the context property for the instance id</li>\n+ * <li>loggingContextTenantId - the context property for the tenant id</li>\n+ * </ul>\n+ */\n+public class ProcessDataContext {\n+\n+  private static final String NULL_VALUE = \"~NULL_VALUE~\";\n+\n+  public static final String PROPERTY_ACTIVITY_ID = \"activityId\";\n+\n+  private String mdcPropertyActivityId;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ed41ac6f09a9dd4c1927ec84ddebafb2c45f1415"}, "originalPosition": 59}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3b6fa7d96799396d367ca2aa2cf011aa959cc738", "author": {"user": {"login": "tmetzke", "name": "Tobias Metzke-Bernstein"}}, "url": "https://github.com/camunda/camunda-bpm-platform/commit/3b6fa7d96799396d367ca2aa2cf011aa959cc738", "committedDate": "2020-01-17T09:52:15Z", "message": "chore(engine): make fields protected"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ0NDc0NjU5", "url": "https://github.com/camunda/camunda-bpm-platform/pull/617#pullrequestreview-344474659", "createdAt": "2020-01-17T10:04:46Z", "commit": {"oid": "3b6fa7d96799396d367ca2aa2cf011aa959cc738"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ0OTQ5Nzk0", "url": "https://github.com/camunda/camunda-bpm-platform/pull/617#pullrequestreview-344949794", "createdAt": "2020-01-18T16:02:38Z", "commit": {"oid": "3b6fa7d96799396d367ca2aa2cf011aa959cc738"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xOFQxNjowMjozOFrOFfLONg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xOFQxNjowMjozOFrOFfLONg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODIzNDAzOA==", "bodyText": "Why is named \"Last....\"? Isn't it so that an incident is created because of exactly one exception? Hence there will be exactly one activityId, and hence there will be no \"first\" or \"last\" one.", "url": "https://github.com/camunda/camunda-bpm-platform/pull/617#discussion_r368234038", "createdAt": "2020-01-18T16:02:38Z", "author": {"login": "fml2"}, "path": "engine/src/main/java/org/camunda/bpm/engine/history/HistoricIncident.java", "diffHunk": "@@ -150,4 +150,9 @@\n \n   /** The time the historic incident will be removed. */\n   Date getRemovalTime();\n+\n+  /**\n+   * Returns the id of the activity on which the last exception occurred.\n+   */\n+  String getLastFailingActivityId();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3b6fa7d96799396d367ca2aa2cf011aa959cc738"}, "originalPosition": 8}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2014, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}