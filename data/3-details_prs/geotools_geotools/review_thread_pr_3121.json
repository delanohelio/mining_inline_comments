{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDczOTQ5MzE1", "number": 3121, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QwNzo0NzozMVrOEdGjzQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0zMFQyMDoxMjowOVrOEeGc3g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk4OTUxNjI5OnYy", "diffSide": "RIGHT", "path": "modules/library/main/src/main/java/org/geotools/filter/visitor/SimplifyingFilterVisitor.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QwNzo0NzozMVrOHIEcZQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QxNDo1NzoyMFrOHIUVEQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODIyMzQ2MQ==", "bodyText": "If the featureType field has been set, check if the property is nullable before adding this extra. Add a test accordingly.", "url": "https://github.com/geotools/geotools/pull/3121#discussion_r478223461", "createdAt": "2020-08-27T07:47:31Z", "author": {"login": "aaime"}, "path": "modules/library/main/src/main/java/org/geotools/filter/visitor/SimplifyingFilterVisitor.java", "diffHunk": "@@ -418,7 +421,8 @@ public Object visit(Not filter, Object extraData) {\n                 PropertyIsBetween pb = (PropertyIsBetween) simplified;\n                 Filter lt = ff.less(pb.getExpression(), pb.getLowerBoundary());\n                 Filter gt = ff.greater(pb.getExpression(), pb.getUpperBoundary());\n-                return ff.or(lt, gt);\n+                Filter nullFilter = ff.isNull(pb.getExpression());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8cd319764678d122b5f0c5d47843633848ea39e3"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODQ4MzcyOQ==", "bodyText": "I have just made related changes and added the test as well.", "url": "https://github.com/geotools/geotools/pull/3121#discussion_r478483729", "createdAt": "2020-08-27T14:57:20Z", "author": {"login": "huseyin-bozkurt"}, "path": "modules/library/main/src/main/java/org/geotools/filter/visitor/SimplifyingFilterVisitor.java", "diffHunk": "@@ -418,7 +421,8 @@ public Object visit(Not filter, Object extraData) {\n                 PropertyIsBetween pb = (PropertyIsBetween) simplified;\n                 Filter lt = ff.less(pb.getExpression(), pb.getLowerBoundary());\n                 Filter gt = ff.greater(pb.getExpression(), pb.getUpperBoundary());\n-                return ff.or(lt, gt);\n+                Filter nullFilter = ff.isNull(pb.getExpression());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODIyMzQ2MQ=="}, "originalCommit": {"oid": "8cd319764678d122b5f0c5d47843633848ea39e3"}, "originalPosition": 15}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk5OTk4NDMwOnYy", "diffSide": "RIGHT", "path": "modules/library/main/src/main/java/org/geotools/filter/visitor/SimplifyingFilterVisitor.java", "isResolved": false, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0zMFQyMDoxMjowOVrOHJlUuA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0zMVQxMjo1MTowNVrOHJ3eww==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTgxMDc0NA==", "bodyText": "If I'm not mistaken the propose of the expression Stream.of(lt,gt,nullFilter).filter(Objects::nonNull).collect(Collectors.toList())  is to get rid of nullFilter if it's NULL, I think it would be more efficient and (arguably) clear to do something like this instead:\nif (isNillable(pName)) {\n    // the property may have a NULL value, we need to vouch for it\n    nullFilter = ff.isNull(pb.getExpression());\n    return ff.or(lt, gt, nullFilter);\n}\n// the property value cannot be null\nreturn ff.or(lt, gt);", "url": "https://github.com/geotools/geotools/pull/3121#discussion_r479810744", "createdAt": "2020-08-30T20:12:09Z", "author": {"login": "nmco"}, "path": "modules/library/main/src/main/java/org/geotools/filter/visitor/SimplifyingFilterVisitor.java", "diffHunk": "@@ -418,7 +423,13 @@ public Object visit(Not filter, Object extraData) {\n                 PropertyIsBetween pb = (PropertyIsBetween) simplified;\n                 Filter lt = ff.less(pb.getExpression(), pb.getLowerBoundary());\n                 Filter gt = ff.greater(pb.getExpression(), pb.getUpperBoundary());\n-                return ff.or(lt, gt);\n+                PropertyName pn = (PropertyName) pb.getExpression();\n+                String pName = pn.getPropertyName();\n+                Filter nullFilter = null;\n+                if(isNillable(pName)) {\n+                \tnullFilter = ff.isNull(pb.getExpression());\n+                }\n+                return ff.or(Stream.of(lt,gt,nullFilter).filter(Objects::nonNull).collect(Collectors.toList()));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ac12cf826cb35162a054d2629dba165cb1ae7cbd"}, "originalPosition": 28}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTgxMzg2NA==", "bodyText": "Yes @nmco , you are right. The aim is to get rid of nullFilter if it's NULL but not possible to use ff.or(lt, gt, nullFilter); because it accepts 2 parameters or an ArrayList (for more than 2 filters).\nInstead of defining a new arraylist for non-null case, i would like to handle it in just one line.", "url": "https://github.com/geotools/geotools/pull/3121#discussion_r479813864", "createdAt": "2020-08-30T20:47:20Z", "author": {"login": "huseyin-bozkurt"}, "path": "modules/library/main/src/main/java/org/geotools/filter/visitor/SimplifyingFilterVisitor.java", "diffHunk": "@@ -418,7 +423,13 @@ public Object visit(Not filter, Object extraData) {\n                 PropertyIsBetween pb = (PropertyIsBetween) simplified;\n                 Filter lt = ff.less(pb.getExpression(), pb.getLowerBoundary());\n                 Filter gt = ff.greater(pb.getExpression(), pb.getUpperBoundary());\n-                return ff.or(lt, gt);\n+                PropertyName pn = (PropertyName) pb.getExpression();\n+                String pName = pn.getPropertyName();\n+                Filter nullFilter = null;\n+                if(isNillable(pName)) {\n+                \tnullFilter = ff.isNull(pb.getExpression());\n+                }\n+                return ff.or(Stream.of(lt,gt,nullFilter).filter(Objects::nonNull).collect(Collectors.toList()));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTgxMDc0NA=="}, "originalCommit": {"oid": "ac12cf826cb35162a054d2629dba165cb1ae7cbd"}, "originalPosition": 28}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTk3NTEwNA==", "bodyText": "You're correct, my mistake. In that case I would suggest to separate the concerns; first you build the list of filters then you build the filter. Something like this:\nList<Filter> orFilters = new ArrayList<>();\norFilters.add(lt);\norFilters.add(gt);\nif (isNillable(pName)) {\n    // the property may have a NULL value, we need to vouch for it\n    orFilters.add(pb.getExpression());\n}\nreturn ff.or(orFilters);", "url": "https://github.com/geotools/geotools/pull/3121#discussion_r479975104", "createdAt": "2020-08-31T08:25:18Z", "author": {"login": "nmco"}, "path": "modules/library/main/src/main/java/org/geotools/filter/visitor/SimplifyingFilterVisitor.java", "diffHunk": "@@ -418,7 +423,13 @@ public Object visit(Not filter, Object extraData) {\n                 PropertyIsBetween pb = (PropertyIsBetween) simplified;\n                 Filter lt = ff.less(pb.getExpression(), pb.getLowerBoundary());\n                 Filter gt = ff.greater(pb.getExpression(), pb.getUpperBoundary());\n-                return ff.or(lt, gt);\n+                PropertyName pn = (PropertyName) pb.getExpression();\n+                String pName = pn.getPropertyName();\n+                Filter nullFilter = null;\n+                if(isNillable(pName)) {\n+                \tnullFilter = ff.isNull(pb.getExpression());\n+                }\n+                return ff.or(Stream.of(lt,gt,nullFilter).filter(Objects::nonNull).collect(Collectors.toList()));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTgxMDc0NA=="}, "originalCommit": {"oid": "ac12cf826cb35162a054d2629dba165cb1ae7cbd"}, "originalPosition": 28}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDEwODIyNw==", "bodyText": "Dear @nmco, I updated the file according to your suggestion.", "url": "https://github.com/geotools/geotools/pull/3121#discussion_r480108227", "createdAt": "2020-08-31T12:51:05Z", "author": {"login": "huseyin-bozkurt"}, "path": "modules/library/main/src/main/java/org/geotools/filter/visitor/SimplifyingFilterVisitor.java", "diffHunk": "@@ -418,7 +423,13 @@ public Object visit(Not filter, Object extraData) {\n                 PropertyIsBetween pb = (PropertyIsBetween) simplified;\n                 Filter lt = ff.less(pb.getExpression(), pb.getLowerBoundary());\n                 Filter gt = ff.greater(pb.getExpression(), pb.getUpperBoundary());\n-                return ff.or(lt, gt);\n+                PropertyName pn = (PropertyName) pb.getExpression();\n+                String pName = pn.getPropertyName();\n+                Filter nullFilter = null;\n+                if(isNillable(pName)) {\n+                \tnullFilter = ff.isNull(pb.getExpression());\n+                }\n+                return ff.or(Stream.of(lt,gt,nullFilter).filter(Objects::nonNull).collect(Collectors.toList()));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTgxMDc0NA=="}, "originalCommit": {"oid": "ac12cf826cb35162a054d2629dba165cb1ae7cbd"}, "originalPosition": 28}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3805, "cost": 1, "resetAt": "2021-11-12T19:05:54Z"}}}