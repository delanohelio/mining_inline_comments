{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDc1NTEyMjE4", "number": 3122, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOVQwMDoxOTo1NlrOEd63iw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOVQwMDoxOTo1NlrOEd63iw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk5ODA4NjUxOnYy", "diffSide": "RIGHT", "path": "modules/library/main/src/main/java/org/geotools/renderer/crs/AzimulthalEquidistantProjectionHandlerFactory.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOVQwMDoxOTo1NlrOHJXYFg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMVQwNTo1MjoyNFrOHKklWw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTU4MjIzMA==", "bodyText": "I thought through putting a try catch around these, in order to throw the original TransformException exception. It is more useful to have this failure so you can tell exactly how far it got.", "url": "https://github.com/geotools/geotools/pull/3122#discussion_r479582230", "createdAt": "2020-08-29T00:19:56Z", "author": {"login": "jodygarnett"}, "path": "modules/library/main/src/main/java/org/geotools/renderer/crs/AzimulthalEquidistantProjectionHandlerFactory.java", "diffHunk": "@@ -161,12 +161,37 @@ private void initializeDatelineCutter(CoordinateReferenceSystem crs, Point2D.Dou\n                 Geometry difference = renderingGeometry.difference(bufferedDateline);\n                 List<Polygon> polygons = PolygonExtracter.getPolygons(difference);\n                 for (Polygon p : polygons) {\n-                    Geometry transformed =\n-                            JTS.transform(\n-                                    p,\n-                                    CRS.findMathTransform(\n-                                            renderingEnvelope.getCoordinateReferenceSystem(),\n-                                            sourceCRS));\n+                    Geometry transformed = null;\n+                    try {\n+                        transformed =\n+                                JTS.transform(\n+                                        p,\n+                                        CRS.findMathTransform(\n+                                                renderingEnvelope.getCoordinateReferenceSystem(),\n+                                                sourceCRS));\n+                    } catch (TransformException e) {\n+                        // uh oh, got into a special case of the target projection... go step by\n+                        // step\n+                        Geometry polygonWGS84 =\n+                                JTS.transform(\n+                                        p,\n+                                        CRS.findMathTransform(\n+                                                renderingEnvelope.getCoordinateReferenceSystem(),\n+                                                DefaultGeographicCRS.WGS84));\n+                        ProjectionHandler handler =\n+                                ProjectionHandlerFinder.getHandler(\n+                                        new ReferencedEnvelope(sourceCRS),\n+                                        DefaultGeographicCRS.WGS84,\n+                                        false);\n+                        if (handler == null) throw e;\n+                        Geometry preProcessed = handler.preProcess(polygonWGS84);\n+                        transformed =\n+                                JTS.transform(\n+                                        preProcessed,\n+                                        CRS.findMathTransform(\n+                                                renderingEnvelope.getCoordinateReferenceSystem(),\n+                                                sourceCRS));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "20f600693d55e7ec4955c1f7e32e9b63abbcf4da"}, "originalPosition": 39}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTYzMzE5OA==", "bodyText": "The method declares to throw TransformException, so in case JTS.transform throws, it's going to go out of the method and handled at higher level, logged or re-wrapped. Don't think anything is lost. Have I misunderstood your comment?", "url": "https://github.com/geotools/geotools/pull/3122#discussion_r479633198", "createdAt": "2020-08-29T10:02:02Z", "author": {"login": "aaime"}, "path": "modules/library/main/src/main/java/org/geotools/renderer/crs/AzimulthalEquidistantProjectionHandlerFactory.java", "diffHunk": "@@ -161,12 +161,37 @@ private void initializeDatelineCutter(CoordinateReferenceSystem crs, Point2D.Dou\n                 Geometry difference = renderingGeometry.difference(bufferedDateline);\n                 List<Polygon> polygons = PolygonExtracter.getPolygons(difference);\n                 for (Polygon p : polygons) {\n-                    Geometry transformed =\n-                            JTS.transform(\n-                                    p,\n-                                    CRS.findMathTransform(\n-                                            renderingEnvelope.getCoordinateReferenceSystem(),\n-                                            sourceCRS));\n+                    Geometry transformed = null;\n+                    try {\n+                        transformed =\n+                                JTS.transform(\n+                                        p,\n+                                        CRS.findMathTransform(\n+                                                renderingEnvelope.getCoordinateReferenceSystem(),\n+                                                sourceCRS));\n+                    } catch (TransformException e) {\n+                        // uh oh, got into a special case of the target projection... go step by\n+                        // step\n+                        Geometry polygonWGS84 =\n+                                JTS.transform(\n+                                        p,\n+                                        CRS.findMathTransform(\n+                                                renderingEnvelope.getCoordinateReferenceSystem(),\n+                                                DefaultGeographicCRS.WGS84));\n+                        ProjectionHandler handler =\n+                                ProjectionHandlerFinder.getHandler(\n+                                        new ReferencedEnvelope(sourceCRS),\n+                                        DefaultGeographicCRS.WGS84,\n+                                        false);\n+                        if (handler == null) throw e;\n+                        Geometry preProcessed = handler.preProcess(polygonWGS84);\n+                        transformed =\n+                                JTS.transform(\n+                                        preProcessed,\n+                                        CRS.findMathTransform(\n+                                                renderingEnvelope.getCoordinateReferenceSystem(),\n+                                                sourceCRS));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTU4MjIzMA=="}, "originalCommit": {"oid": "20f600693d55e7ec4955c1f7e32e9b63abbcf4da"}, "originalPosition": 39}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDg0NzE5NQ==", "bodyText": "Nope it is fine, was trying to decide if there was any value in throwing the origional exception (there was not)", "url": "https://github.com/geotools/geotools/pull/3122#discussion_r480847195", "createdAt": "2020-09-01T05:52:24Z", "author": {"login": "jodygarnett"}, "path": "modules/library/main/src/main/java/org/geotools/renderer/crs/AzimulthalEquidistantProjectionHandlerFactory.java", "diffHunk": "@@ -161,12 +161,37 @@ private void initializeDatelineCutter(CoordinateReferenceSystem crs, Point2D.Dou\n                 Geometry difference = renderingGeometry.difference(bufferedDateline);\n                 List<Polygon> polygons = PolygonExtracter.getPolygons(difference);\n                 for (Polygon p : polygons) {\n-                    Geometry transformed =\n-                            JTS.transform(\n-                                    p,\n-                                    CRS.findMathTransform(\n-                                            renderingEnvelope.getCoordinateReferenceSystem(),\n-                                            sourceCRS));\n+                    Geometry transformed = null;\n+                    try {\n+                        transformed =\n+                                JTS.transform(\n+                                        p,\n+                                        CRS.findMathTransform(\n+                                                renderingEnvelope.getCoordinateReferenceSystem(),\n+                                                sourceCRS));\n+                    } catch (TransformException e) {\n+                        // uh oh, got into a special case of the target projection... go step by\n+                        // step\n+                        Geometry polygonWGS84 =\n+                                JTS.transform(\n+                                        p,\n+                                        CRS.findMathTransform(\n+                                                renderingEnvelope.getCoordinateReferenceSystem(),\n+                                                DefaultGeographicCRS.WGS84));\n+                        ProjectionHandler handler =\n+                                ProjectionHandlerFinder.getHandler(\n+                                        new ReferencedEnvelope(sourceCRS),\n+                                        DefaultGeographicCRS.WGS84,\n+                                        false);\n+                        if (handler == null) throw e;\n+                        Geometry preProcessed = handler.preProcess(polygonWGS84);\n+                        transformed =\n+                                JTS.transform(\n+                                        preProcessed,\n+                                        CRS.findMathTransform(\n+                                                renderingEnvelope.getCoordinateReferenceSystem(),\n+                                                sourceCRS));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTU4MjIzMA=="}, "originalCommit": {"oid": "20f600693d55e7ec4955c1f7e32e9b63abbcf4da"}, "originalPosition": 39}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3807, "cost": 1, "resetAt": "2021-11-12T19:05:54Z"}}}