{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzkwNjc3NzY3", "number": 2840, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QxMDoyNTozMFrODqUO-g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QxMDoyNjoxOVrODqUP9w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ1Njk4Mjk4OnYy", "diffSide": "RIGHT", "path": "modules/extension/wmts/src/test/java/org/geotools/ows/wmts/WebMapTileServerTest.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QxMDoyNTozMFrOF5_F6Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QyMDo1MjozOFrOF6XpPg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjM0Njg1Nw==", "bodyText": "Tests should not be writing to system.out, use the logging framework instead, or if you need it for development, keep the line that does the printout commented out, using System.out directly.", "url": "https://github.com/geotools/geotools/pull/2840#discussion_r396346857", "createdAt": "2020-03-23T10:25:30Z", "author": {"login": "aaime"}, "path": "modules/extension/wmts/src/test/java/org/geotools/ows/wmts/WebMapTileServerTest.java", "diffHunk": "@@ -16,21 +16,27 @@\n  */\n package org.geotools.ows.wmts;\n \n-import static junit.framework.TestCase.assertEquals;\n-import static junit.framework.TestCase.assertNotNull;\n-import static junit.framework.TestCase.assertNull;\n+import static junit.framework.TestCase.*;\n import static org.geotools.ows.wmts.WMTSTestUtils.createCapabilities;\n \n+import java.io.PrintStream;\n+import java.util.Set;\n import org.geotools.geometry.GeneralEnvelope;\n+import org.geotools.geometry.jts.ReferencedEnvelope;\n import org.geotools.ows.wms.Layer;\n import org.geotools.ows.wmts.model.WMTSCapabilities;\n+import org.geotools.ows.wmts.model.WMTSLayer;\n+import org.geotools.ows.wmts.request.GetTileRequest;\n import org.geotools.referencing.CRS;\n+import org.geotools.tile.Tile;\n import org.junit.Test;\n import org.opengis.referencing.crs.CoordinateReferenceSystem;\n \n /** @author Emanuele Tajariol (etj at geo-solutions dot it) */\n public class WebMapTileServerTest {\n \n+    private static PrintStream out = System.out;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ce9f8a4098f0866c466812a2da3d88dfb900a140"}, "originalPosition": 26}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Njc0OTExOA==", "bodyText": "Removed all print statements. I only needed them for development and no need for them to be left in and commented out", "url": "https://github.com/geotools/geotools/pull/2840#discussion_r396749118", "createdAt": "2020-03-23T20:52:38Z", "author": {"login": "singhdan"}, "path": "modules/extension/wmts/src/test/java/org/geotools/ows/wmts/WebMapTileServerTest.java", "diffHunk": "@@ -16,21 +16,27 @@\n  */\n package org.geotools.ows.wmts;\n \n-import static junit.framework.TestCase.assertEquals;\n-import static junit.framework.TestCase.assertNotNull;\n-import static junit.framework.TestCase.assertNull;\n+import static junit.framework.TestCase.*;\n import static org.geotools.ows.wmts.WMTSTestUtils.createCapabilities;\n \n+import java.io.PrintStream;\n+import java.util.Set;\n import org.geotools.geometry.GeneralEnvelope;\n+import org.geotools.geometry.jts.ReferencedEnvelope;\n import org.geotools.ows.wms.Layer;\n import org.geotools.ows.wmts.model.WMTSCapabilities;\n+import org.geotools.ows.wmts.model.WMTSLayer;\n+import org.geotools.ows.wmts.request.GetTileRequest;\n import org.geotools.referencing.CRS;\n+import org.geotools.tile.Tile;\n import org.junit.Test;\n import org.opengis.referencing.crs.CoordinateReferenceSystem;\n \n /** @author Emanuele Tajariol (etj at geo-solutions dot it) */\n public class WebMapTileServerTest {\n \n+    private static PrintStream out = System.out;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjM0Njg1Nw=="}, "originalCommit": {"oid": "ce9f8a4098f0866c466812a2da3d88dfb900a140"}, "originalPosition": 26}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ1Njk4NTUxOnYy", "diffSide": "RIGHT", "path": "modules/extension/wmts/src/main/java/org/geotools/ows/wmts/request/AbstractGetTileRequest.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QxMDoyNjoxOVrOF5_HtQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QyMDo1Mjo1NFrOF6XpvA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjM0NzMxNw==", "bodyText": "No need to convert it at every round in the loop, could be done outside.", "url": "https://github.com/geotools/geotools/pull/2840#discussion_r396347317", "createdAt": "2020-03-23T10:26:19Z", "author": {"login": "aaime"}, "path": "modules/extension/wmts/src/main/java/org/geotools/ows/wmts/request/AbstractGetTileRequest.java", "diffHunk": "@@ -351,12 +351,15 @@ private TileMatrixSet selectMatrixSet() throws ServiceException, RuntimeExceptio\n             }\n         }\n \n-        // If the layer provides the requested CRS, use it\n+        // See if the layer supports the requested SRS. Matching against the SRS rather than the\n+        // full CRS will avoid missing matches due to Longitude first being set on the request\n+        // CRS and therefore minimise transformations that need to be performed on the received tile\n         for (TileMatrixSet matrixSet : capabilities.getMatrixSets()) {\n \n             CoordinateReferenceSystem matrixCRS = matrixSet.getCoordinateReferenceSystem();\n-\n-            if (CRS.equalsIgnoreMetadata(requestCRS, matrixCRS)) { // matching SRS\n+            String requestSRS = CRS.toSRS(requestCRS);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ce9f8a4098f0866c466812a2da3d88dfb900a140"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Njc0OTI0NA==", "bodyText": "Agreed, moved to outside the loop", "url": "https://github.com/geotools/geotools/pull/2840#discussion_r396749244", "createdAt": "2020-03-23T20:52:54Z", "author": {"login": "singhdan"}, "path": "modules/extension/wmts/src/main/java/org/geotools/ows/wmts/request/AbstractGetTileRequest.java", "diffHunk": "@@ -351,12 +351,15 @@ private TileMatrixSet selectMatrixSet() throws ServiceException, RuntimeExceptio\n             }\n         }\n \n-        // If the layer provides the requested CRS, use it\n+        // See if the layer supports the requested SRS. Matching against the SRS rather than the\n+        // full CRS will avoid missing matches due to Longitude first being set on the request\n+        // CRS and therefore minimise transformations that need to be performed on the received tile\n         for (TileMatrixSet matrixSet : capabilities.getMatrixSets()) {\n \n             CoordinateReferenceSystem matrixCRS = matrixSet.getCoordinateReferenceSystem();\n-\n-            if (CRS.equalsIgnoreMetadata(requestCRS, matrixCRS)) { // matching SRS\n+            String requestSRS = CRS.toSRS(requestCRS);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjM0NzMxNw=="}, "originalCommit": {"oid": "ce9f8a4098f0866c466812a2da3d88dfb900a140"}, "originalPosition": 13}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3682, "cost": 1, "resetAt": "2021-11-12T19:05:54Z"}}}