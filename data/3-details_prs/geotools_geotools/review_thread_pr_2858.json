{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk2OTg2OTA4", "number": 2858, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMFQxNToxNTowMFrODzx5EA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMFQxNToyMTozMVrODzyGPw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU1NjIxMzkyOnYy", "diffSide": "RIGHT", "path": "modules/extension/xsd/xsd-fes/src/test/java/org/geotools/filter/v2_0/bindings/BBoxBindingTest.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMFQxNToxNTowMFrOGIZmjQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMFQxNjo0NzozOFrOGId7xQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTQ2MTI2MQ==", "bodyText": "Letting it simply throw the exception is an easier way to get the test to fail, also gives all details including a stack trace, while this only reports the error message.", "url": "https://github.com/geotools/geotools/pull/2858#discussion_r411461261", "createdAt": "2020-04-20T15:15:00Z", "author": {"login": "aaime"}, "path": "modules/extension/xsd/xsd-fes/src/test/java/org/geotools/filter/v2_0/bindings/BBoxBindingTest.java", "diffHunk": "@@ -0,0 +1,98 @@\n+package org.geotools.filter.v2_0.bindings;\n+\n+import java.io.IOException;\n+import org.geotools.factory.CommonFactoryFinder;\n+import org.geotools.filter.v2_0.FES;\n+import org.geotools.filter.v2_0.FESTestSupport;\n+import org.geotools.geometry.jts.ReferencedEnvelope;\n+import org.geotools.referencing.CRS;\n+import org.geotools.xsd.Encoder;\n+import org.junit.Assert;\n+import org.junit.Test;\n+import org.opengis.filter.Filter;\n+import org.opengis.filter.FilterFactory2;\n+import org.opengis.filter.expression.Literal;\n+import org.opengis.filter.expression.PropertyName;\n+import org.opengis.filter.spatial.BBOX;\n+import org.opengis.geometry.MismatchedDimensionException;\n+import org.opengis.referencing.FactoryException;\n+import org.opengis.referencing.NoSuchAuthorityCodeException;\n+\n+public class BBoxBindingTest extends FESTestSupport {\n+\n+    @Test\n+    public void testEncode() {\n+        FilterFactory2 ff = CommonFactoryFinder.getFilterFactory2();\n+\n+        try {\n+            ReferencedEnvelope env =\n+                    new ReferencedEnvelope(\n+                            Double.valueOf(48.81752162),\n+                            Double.valueOf(48.81915540),\n+                            Double.valueOf(-3.47568429),\n+                            Double.valueOf(-3.47261370),\n+                            CRS.decode(\"EPSG:4326\"));\n+            Filter bboxFilter = ff.bbox(ff.property(\"geom\"), env);\n+            Encoder encoder = new Encoder(createConfiguration());\n+            String encodedFilter = encoder.encodeAsString(bboxFilter, FES.Filter);\n+            Assert.assertTrue(\n+                    encodedFilter.contains(\"<fes:ValueReference>geom</fes:ValueReference>\"));\n+            Assert.assertTrue(\n+                    encodedFilter.contains(\n+                            \"<gml:Envelope srsDimension=\\\"2\\\" srsName=\\\"urn:ogc:def:crs:EPSG::4326\\\">\"));\n+            Assert.assertTrue(\n+                    encodedFilter.contains(\n+                            \"<gml:lowerCorner>48.817522 -3.475684</gml:lowerCorner>\"));\n+            Assert.assertTrue(\n+                    encodedFilter.contains(\n+                            \"<gml:upperCorner>48.819155 -3.472614</gml:upperCorner>\"));\n+\n+        } catch (MismatchedDimensionException e) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "869a7b7fbb97587172b08840bfddbe905286242d"}, "originalPosition": 50}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTUzMjIyOQ==", "bodyText": "OK, Unit test catch exception removed", "url": "https://github.com/geotools/geotools/pull/2858#discussion_r411532229", "createdAt": "2020-04-20T16:47:38Z", "author": {"login": "eropartz"}, "path": "modules/extension/xsd/xsd-fes/src/test/java/org/geotools/filter/v2_0/bindings/BBoxBindingTest.java", "diffHunk": "@@ -0,0 +1,98 @@\n+package org.geotools.filter.v2_0.bindings;\n+\n+import java.io.IOException;\n+import org.geotools.factory.CommonFactoryFinder;\n+import org.geotools.filter.v2_0.FES;\n+import org.geotools.filter.v2_0.FESTestSupport;\n+import org.geotools.geometry.jts.ReferencedEnvelope;\n+import org.geotools.referencing.CRS;\n+import org.geotools.xsd.Encoder;\n+import org.junit.Assert;\n+import org.junit.Test;\n+import org.opengis.filter.Filter;\n+import org.opengis.filter.FilterFactory2;\n+import org.opengis.filter.expression.Literal;\n+import org.opengis.filter.expression.PropertyName;\n+import org.opengis.filter.spatial.BBOX;\n+import org.opengis.geometry.MismatchedDimensionException;\n+import org.opengis.referencing.FactoryException;\n+import org.opengis.referencing.NoSuchAuthorityCodeException;\n+\n+public class BBoxBindingTest extends FESTestSupport {\n+\n+    @Test\n+    public void testEncode() {\n+        FilterFactory2 ff = CommonFactoryFinder.getFilterFactory2();\n+\n+        try {\n+            ReferencedEnvelope env =\n+                    new ReferencedEnvelope(\n+                            Double.valueOf(48.81752162),\n+                            Double.valueOf(48.81915540),\n+                            Double.valueOf(-3.47568429),\n+                            Double.valueOf(-3.47261370),\n+                            CRS.decode(\"EPSG:4326\"));\n+            Filter bboxFilter = ff.bbox(ff.property(\"geom\"), env);\n+            Encoder encoder = new Encoder(createConfiguration());\n+            String encodedFilter = encoder.encodeAsString(bboxFilter, FES.Filter);\n+            Assert.assertTrue(\n+                    encodedFilter.contains(\"<fes:ValueReference>geom</fes:ValueReference>\"));\n+            Assert.assertTrue(\n+                    encodedFilter.contains(\n+                            \"<gml:Envelope srsDimension=\\\"2\\\" srsName=\\\"urn:ogc:def:crs:EPSG::4326\\\">\"));\n+            Assert.assertTrue(\n+                    encodedFilter.contains(\n+                            \"<gml:lowerCorner>48.817522 -3.475684</gml:lowerCorner>\"));\n+            Assert.assertTrue(\n+                    encodedFilter.contains(\n+                            \"<gml:upperCorner>48.819155 -3.472614</gml:upperCorner>\"));\n+\n+        } catch (MismatchedDimensionException e) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTQ2MTI2MQ=="}, "originalCommit": {"oid": "869a7b7fbb97587172b08840bfddbe905286242d"}, "originalPosition": 50}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU1NjIxNDYyOnYy", "diffSide": "RIGHT", "path": "modules/extension/xsd/xsd-fes/src/test/java/org/geotools/filter/v2_0/bindings/BBoxBindingTest.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMFQxNToxNTowOFrOGIZm8A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMFQxNjo0Nzo0NVrOGId8Bg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTQ2MTM2MA==", "bodyText": "Same as above.", "url": "https://github.com/geotools/geotools/pull/2858#discussion_r411461360", "createdAt": "2020-04-20T15:15:08Z", "author": {"login": "aaime"}, "path": "modules/extension/xsd/xsd-fes/src/test/java/org/geotools/filter/v2_0/bindings/BBoxBindingTest.java", "diffHunk": "@@ -0,0 +1,98 @@\n+package org.geotools.filter.v2_0.bindings;\n+\n+import java.io.IOException;\n+import org.geotools.factory.CommonFactoryFinder;\n+import org.geotools.filter.v2_0.FES;\n+import org.geotools.filter.v2_0.FESTestSupport;\n+import org.geotools.geometry.jts.ReferencedEnvelope;\n+import org.geotools.referencing.CRS;\n+import org.geotools.xsd.Encoder;\n+import org.junit.Assert;\n+import org.junit.Test;\n+import org.opengis.filter.Filter;\n+import org.opengis.filter.FilterFactory2;\n+import org.opengis.filter.expression.Literal;\n+import org.opengis.filter.expression.PropertyName;\n+import org.opengis.filter.spatial.BBOX;\n+import org.opengis.geometry.MismatchedDimensionException;\n+import org.opengis.referencing.FactoryException;\n+import org.opengis.referencing.NoSuchAuthorityCodeException;\n+\n+public class BBoxBindingTest extends FESTestSupport {\n+\n+    @Test\n+    public void testEncode() {\n+        FilterFactory2 ff = CommonFactoryFinder.getFilterFactory2();\n+\n+        try {\n+            ReferencedEnvelope env =\n+                    new ReferencedEnvelope(\n+                            Double.valueOf(48.81752162),\n+                            Double.valueOf(48.81915540),\n+                            Double.valueOf(-3.47568429),\n+                            Double.valueOf(-3.47261370),\n+                            CRS.decode(\"EPSG:4326\"));\n+            Filter bboxFilter = ff.bbox(ff.property(\"geom\"), env);\n+            Encoder encoder = new Encoder(createConfiguration());\n+            String encodedFilter = encoder.encodeAsString(bboxFilter, FES.Filter);\n+            Assert.assertTrue(\n+                    encodedFilter.contains(\"<fes:ValueReference>geom</fes:ValueReference>\"));\n+            Assert.assertTrue(\n+                    encodedFilter.contains(\n+                            \"<gml:Envelope srsDimension=\\\"2\\\" srsName=\\\"urn:ogc:def:crs:EPSG::4326\\\">\"));\n+            Assert.assertTrue(\n+                    encodedFilter.contains(\n+                            \"<gml:lowerCorner>48.817522 -3.475684</gml:lowerCorner>\"));\n+            Assert.assertTrue(\n+                    encodedFilter.contains(\n+                            \"<gml:upperCorner>48.819155 -3.472614</gml:upperCorner>\"));\n+\n+        } catch (MismatchedDimensionException e) {\n+            Assert.fail(e.getMessage());\n+        } catch (NoSuchAuthorityCodeException e) {\n+            Assert.fail(e.getMessage());\n+        } catch (FactoryException e) {\n+            Assert.fail(e.getMessage());\n+        } catch (IOException e) {\n+            Assert.fail(e.getMessage());\n+        }\n+    }\n+\n+    @Test\n+    public void testParse() {\n+        String xml =\n+                \"<fes:Filter \"\n+                        + \"xmlns:xs='http://www.w3.org/2001/XMLSchema' \"\n+                        + \"xmlns:fes='http://www.opengis.net/fes/2.0' \"\n+                        + \"xmlns:gml='http://www.opengis.net/gml/3.2'>\"\n+                        + \"\t\t<fes:BBOX>\"\n+                        + \"\t\t\t<fes:ValueReference>geom</fes:ValueReference>\"\n+                        + \"\t\t\t<gml:Envelope srsDimension='2' srsName='urn:ogc:def:crs:EPSG::4326'>\"\n+                        + \"\t\t\t\t<gml:lowerCorner>48.817522 -3.475684</gml:lowerCorner>\"\n+                        + \"\t\t\t\t<gml:upperCorner>48.819155 -3.472614</gml:upperCorner>\"\n+                        + \"\t\t\t</gml:Envelope>\"\n+                        + \"\t\t</fes:BBOX>\"\n+                        + \"</fes:Filter>\";\n+\n+        try {\n+            buildDocument(xml);\n+            BBOX bbox = (BBOX) parse();\n+            assertNotNull(bbox);\n+\n+            assertTrue(bbox.getExpression1() instanceof PropertyName);\n+            assertEquals(\"geom\", ((PropertyName) bbox.getExpression1()).getPropertyName());\n+\n+            assertTrue(bbox.getExpression2() instanceof Literal);\n+            assertTrue(bbox.getExpression2().evaluate(null) instanceof ReferencedEnvelope);\n+\n+            ReferencedEnvelope env = (ReferencedEnvelope) bbox.getExpression2().evaluate(null);\n+            assertEquals(Double.valueOf(48.817522), env.getMinX());\n+            assertEquals(Double.valueOf(-3.475684), env.getMinY());\n+            assertEquals(Double.valueOf(48.819155), env.getMaxX());\n+            assertEquals(Double.valueOf(-3.472614), env.getMaxY());\n+\n+        } catch (Exception e) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "869a7b7fbb97587172b08840bfddbe905286242d"}, "originalPosition": 94}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTUzMjI5NA==", "bodyText": "OK, Unit test catch exception removed", "url": "https://github.com/geotools/geotools/pull/2858#discussion_r411532294", "createdAt": "2020-04-20T16:47:45Z", "author": {"login": "eropartz"}, "path": "modules/extension/xsd/xsd-fes/src/test/java/org/geotools/filter/v2_0/bindings/BBoxBindingTest.java", "diffHunk": "@@ -0,0 +1,98 @@\n+package org.geotools.filter.v2_0.bindings;\n+\n+import java.io.IOException;\n+import org.geotools.factory.CommonFactoryFinder;\n+import org.geotools.filter.v2_0.FES;\n+import org.geotools.filter.v2_0.FESTestSupport;\n+import org.geotools.geometry.jts.ReferencedEnvelope;\n+import org.geotools.referencing.CRS;\n+import org.geotools.xsd.Encoder;\n+import org.junit.Assert;\n+import org.junit.Test;\n+import org.opengis.filter.Filter;\n+import org.opengis.filter.FilterFactory2;\n+import org.opengis.filter.expression.Literal;\n+import org.opengis.filter.expression.PropertyName;\n+import org.opengis.filter.spatial.BBOX;\n+import org.opengis.geometry.MismatchedDimensionException;\n+import org.opengis.referencing.FactoryException;\n+import org.opengis.referencing.NoSuchAuthorityCodeException;\n+\n+public class BBoxBindingTest extends FESTestSupport {\n+\n+    @Test\n+    public void testEncode() {\n+        FilterFactory2 ff = CommonFactoryFinder.getFilterFactory2();\n+\n+        try {\n+            ReferencedEnvelope env =\n+                    new ReferencedEnvelope(\n+                            Double.valueOf(48.81752162),\n+                            Double.valueOf(48.81915540),\n+                            Double.valueOf(-3.47568429),\n+                            Double.valueOf(-3.47261370),\n+                            CRS.decode(\"EPSG:4326\"));\n+            Filter bboxFilter = ff.bbox(ff.property(\"geom\"), env);\n+            Encoder encoder = new Encoder(createConfiguration());\n+            String encodedFilter = encoder.encodeAsString(bboxFilter, FES.Filter);\n+            Assert.assertTrue(\n+                    encodedFilter.contains(\"<fes:ValueReference>geom</fes:ValueReference>\"));\n+            Assert.assertTrue(\n+                    encodedFilter.contains(\n+                            \"<gml:Envelope srsDimension=\\\"2\\\" srsName=\\\"urn:ogc:def:crs:EPSG::4326\\\">\"));\n+            Assert.assertTrue(\n+                    encodedFilter.contains(\n+                            \"<gml:lowerCorner>48.817522 -3.475684</gml:lowerCorner>\"));\n+            Assert.assertTrue(\n+                    encodedFilter.contains(\n+                            \"<gml:upperCorner>48.819155 -3.472614</gml:upperCorner>\"));\n+\n+        } catch (MismatchedDimensionException e) {\n+            Assert.fail(e.getMessage());\n+        } catch (NoSuchAuthorityCodeException e) {\n+            Assert.fail(e.getMessage());\n+        } catch (FactoryException e) {\n+            Assert.fail(e.getMessage());\n+        } catch (IOException e) {\n+            Assert.fail(e.getMessage());\n+        }\n+    }\n+\n+    @Test\n+    public void testParse() {\n+        String xml =\n+                \"<fes:Filter \"\n+                        + \"xmlns:xs='http://www.w3.org/2001/XMLSchema' \"\n+                        + \"xmlns:fes='http://www.opengis.net/fes/2.0' \"\n+                        + \"xmlns:gml='http://www.opengis.net/gml/3.2'>\"\n+                        + \"\t\t<fes:BBOX>\"\n+                        + \"\t\t\t<fes:ValueReference>geom</fes:ValueReference>\"\n+                        + \"\t\t\t<gml:Envelope srsDimension='2' srsName='urn:ogc:def:crs:EPSG::4326'>\"\n+                        + \"\t\t\t\t<gml:lowerCorner>48.817522 -3.475684</gml:lowerCorner>\"\n+                        + \"\t\t\t\t<gml:upperCorner>48.819155 -3.472614</gml:upperCorner>\"\n+                        + \"\t\t\t</gml:Envelope>\"\n+                        + \"\t\t</fes:BBOX>\"\n+                        + \"</fes:Filter>\";\n+\n+        try {\n+            buildDocument(xml);\n+            BBOX bbox = (BBOX) parse();\n+            assertNotNull(bbox);\n+\n+            assertTrue(bbox.getExpression1() instanceof PropertyName);\n+            assertEquals(\"geom\", ((PropertyName) bbox.getExpression1()).getPropertyName());\n+\n+            assertTrue(bbox.getExpression2() instanceof Literal);\n+            assertTrue(bbox.getExpression2().evaluate(null) instanceof ReferencedEnvelope);\n+\n+            ReferencedEnvelope env = (ReferencedEnvelope) bbox.getExpression2().evaluate(null);\n+            assertEquals(Double.valueOf(48.817522), env.getMinX());\n+            assertEquals(Double.valueOf(-3.475684), env.getMinY());\n+            assertEquals(Double.valueOf(48.819155), env.getMaxX());\n+            assertEquals(Double.valueOf(-3.472614), env.getMaxY());\n+\n+        } catch (Exception e) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTQ2MTM2MA=="}, "originalCommit": {"oid": "869a7b7fbb97587172b08840bfddbe905286242d"}, "originalPosition": 94}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU1NjI0NzY3OnYy", "diffSide": "RIGHT", "path": "modules/extension/xsd/xsd-fes/src/main/java/org/geotools/filter/v2_0/bindings/BBOXTypeBinding.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMFQxNToyMTozMVrOGIZ65Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMFQxNToyMTozMVrOGIZ65Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTQ2NjQ2OQ==", "bodyText": "Interesting... but legit it seems, from the schema:\n<xsd:complexType name=\"BBOXType\">\n<xsd:complexContent>\n<xsd:extension base=\"fes:SpatialOpsType\">\n<xsd:choice maxOccurs=\"2\">\n<xsd:element ref=\"fes:expression\"/>\n<xsd:any namespace=\"##other\"/>\n</xsd:choice>\n</xsd:extension>\n</xsd:complexContent>\n</xsd:complexType>\n\nGuess the original writer just migrated the code from the superclass, without noticing the schema definition is quite different compared to Filter 1.1, e.g.:\n<xsd:complexType name=\"BBOXType\">\n<xsd:complexContent>\n<xsd:extension base=\"ogc:SpatialOpsType\">\n<xsd:sequence>\n<xsd:element ref=\"ogc:PropertyName\" minOccurs=\"0\"/>\n<xsd:element ref=\"gml:Envelope\"/>\n</xsd:sequence>\n</xsd:extension>\n</xsd:complexContent>\n</xsd:complexType>", "url": "https://github.com/geotools/geotools/pull/2858#discussion_r411466469", "createdAt": "2020-04-20T15:21:31Z", "author": {"login": "aaime"}, "path": "modules/extension/xsd/xsd-fes/src/main/java/org/geotools/filter/v2_0/bindings/BBOXTypeBinding.java", "diffHunk": "@@ -82,7 +82,7 @@ public Class getType() {\n     public Object getProperty(Object object, QName name) throws Exception {\n         BBOX box = (BBOX) object;\n \n-        if (FES.ValueReference.equals(name)) {\n+        if (FES.expression.equals(name)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "869a7b7fbb97587172b08840bfddbe905286242d"}, "originalPosition": 5}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3578, "cost": 1, "resetAt": "2021-11-12T19:05:54Z"}}}