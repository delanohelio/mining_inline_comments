{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzU4NjcxNjA4", "number": 2733, "title": "Mbstyles, disables partials, enable multi-font search, fix labelling as a consequence", "bodyText": "The end result of the activity looks like this:", "createdAt": "2020-01-02T14:12:16Z", "url": "https://github.com/geotools/geotools/pull/2733", "merged": true, "mergeCommit": {"oid": "fa61c8c256e631fe8a54375f64e71211dfc35d45"}, "closed": true, "closedAt": "2020-01-16T16:25:14Z", "author": {"login": "aaime"}, "timelineItems": {"totalCount": 14, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb2bC-2ABqjI5MTc5MjAwNDc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABb68oCFAFqTM0NDAzOTkyMQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b71ae91d4280fe88a9e225ca4996ee7a093cab6e", "author": {"user": {"login": "aaime", "name": "Andrea Aime"}}, "url": "https://github.com/geotools/geotools/commit/b71ae91d4280fe88a9e225ca4996ee7a093cab6e", "committedDate": "2020-01-02T14:09:48Z", "message": "[GEOT-6480] MBStyle, disable partials=true exports"}, "afterCommit": {"oid": "e400cb05f27f9e0254472fadf00bd55c0edb1f9e", "author": {"user": {"login": "aaime", "name": "Andrea Aime"}}, "url": "https://github.com/geotools/geotools/commit/e400cb05f27f9e0254472fadf00bd55c0edb1f9e", "committedDate": "2020-01-02T14:57:04Z", "message": "[GEOT-6480] MBStyle, disable partials=true exports"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e400cb05f27f9e0254472fadf00bd55c0edb1f9e", "author": {"user": {"login": "aaime", "name": "Andrea Aime"}}, "url": "https://github.com/geotools/geotools/commit/e400cb05f27f9e0254472fadf00bd55c0edb1f9e", "committedDate": "2020-01-02T14:57:04Z", "message": "[GEOT-6480] MBStyle, disable partials=true exports"}, "afterCommit": {"oid": "9069af2811fc3b7b4388591e554da2b42bc47ca8", "author": {"user": {"login": "aaime", "name": "Andrea Aime"}}, "url": "https://github.com/geotools/geotools/commit/9069af2811fc3b7b4388591e554da2b42bc47ca8", "committedDate": "2020-01-04T14:06:57Z", "message": "[GEOT-6462] MBStyle font management can lead to tofu chars"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "9069af2811fc3b7b4388591e554da2b42bc47ca8", "author": {"user": {"login": "aaime", "name": "Andrea Aime"}}, "url": "https://github.com/geotools/geotools/commit/9069af2811fc3b7b4388591e554da2b42bc47ca8", "committedDate": "2020-01-04T14:06:57Z", "message": "[GEOT-6462] MBStyle font management can lead to tofu chars"}, "afterCommit": {"oid": "fc9fd6c32db78f890a33f41d7b1d96b1bed2f1a5", "author": {"user": {"login": "aaime", "name": "Andrea Aime"}}, "url": "https://github.com/geotools/geotools/commit/fc9fd6c32db78f890a33f41d7b1d96b1bed2f1a5", "committedDate": "2020-01-04T14:46:19Z", "message": "[GEOT-6462] MBStyle font management can lead to tofu chars"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "fc9fd6c32db78f890a33f41d7b1d96b1bed2f1a5", "author": {"user": {"login": "aaime", "name": "Andrea Aime"}}, "url": "https://github.com/geotools/geotools/commit/fc9fd6c32db78f890a33f41d7b1d96b1bed2f1a5", "committedDate": "2020-01-04T14:46:19Z", "message": "[GEOT-6462] MBStyle font management can lead to tofu chars"}, "afterCommit": {"oid": "2f57abf72f77a6856730685a19735596aad3cfbc", "author": {"user": {"login": "aaime", "name": "Andrea Aime"}}, "url": "https://github.com/geotools/geotools/commit/2f57abf72f77a6856730685a19735596aad3cfbc", "committedDate": "2020-01-13T09:46:25Z", "message": "[GEOT-6462] MBStyle font management can lead to tofu chars"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQyODg0MzMz", "url": "https://github.com/geotools/geotools/pull/2733#pullrequestreview-342884333", "createdAt": "2020-01-14T22:33:45Z", "commit": {"oid": "2f57abf72f77a6856730685a19735596aad3cfbc"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNFQyMjozMzo0NVrOFdoAVg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNFQyMjozNzo1MlrOFdoGTw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjYwODQ3MA==", "bodyText": "Should this put the result into alternatives before returning? As far as I can tell, nothing ever gets written to alternatives currently.", "url": "https://github.com/geotools/geotools/pull/2733#discussion_r366608470", "createdAt": "2020-01-14T22:33:45Z", "author": {"login": "tbarsballe"}, "path": "modules/library/render/src/main/java/org/geotools/renderer/style/FontCache.java", "diffHunk": "@@ -252,4 +259,31 @@ public synchronized void resetCache() {\n \n         return availableFonts;\n     }\n+\n+    /**\n+     * Given a font name, returns alternatives for other scripts, based on the assumption they start\n+     * with the same base name.\n+     *\n+     * @param name\n+     * @return A list of font names with the same base name\n+     */\n+    public List<String> getAlternatives(String name) {\n+        List<String> result = alternatives.get(name);\n+        if (result == null) {\n+            result =\n+                    FontCache.getDefaultInstance()\n+                            .getAvailableFonts()\n+                            .stream()\n+                            .filter(f -> f.startsWith(name))\n+                            .filter(\n+                                    f -> { // leave out alterations, use base fonts\n+                                        String lc = f.toLowerCase();\n+                                        return !lc.contains(\" bold\") && !lc.contains(\" italic\");\n+                                    })\n+                            .sorted() // leave further altered fonts down the line, base ones first\n+                            .collect(Collectors.toList());\n+        }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2f57abf72f77a6856730685a19735596aad3cfbc"}, "originalPosition": 95}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjYwOTk5OQ==", "bodyText": "This should be restored to its prior state before merging", "url": "https://github.com/geotools/geotools/pull/2733#discussion_r366609999", "createdAt": "2020-01-14T22:37:52Z", "author": {"login": "tbarsballe"}, "path": "modules/library/render/src/test/java/org/geotools/renderer/lite/LetterConflictTest.java", "diffHunk": "@@ -55,8 +55,8 @@\n      *\n      * <p>Build with mvn -P image.interactive\n      */\n-    static final boolean IMAGE_INTERACTIVE =\n-            Boolean.getBoolean(\"org.geotools.image.test.interactive\");\n+    static final boolean IMAGE_INTERACTIVE = true;\n+    // Boolean.getBoolean(\"org.geotools.image.test.interactive\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2f57abf72f77a6856730685a19735596aad3cfbc"}, "originalPosition": 7}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "2f57abf72f77a6856730685a19735596aad3cfbc", "author": {"user": {"login": "aaime", "name": "Andrea Aime"}}, "url": "https://github.com/geotools/geotools/commit/2f57abf72f77a6856730685a19735596aad3cfbc", "committedDate": "2020-01-13T09:46:25Z", "message": "[GEOT-6462] MBStyle font management can lead to tofu chars"}, "afterCommit": {"oid": "2ca6ba3e70aecb44512372848b3836722fcab891", "author": {"user": {"login": "aaime", "name": "Andrea Aime"}}, "url": "https://github.com/geotools/geotools/commit/2ca6ba3e70aecb44512372848b3836722fcab891", "committedDate": "2020-01-16T11:15:06Z", "message": "[GEOT-6462] MBStyle font management can lead to tofu chars"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "2ca6ba3e70aecb44512372848b3836722fcab891", "author": {"user": {"login": "aaime", "name": "Andrea Aime"}}, "url": "https://github.com/geotools/geotools/commit/2ca6ba3e70aecb44512372848b3836722fcab891", "committedDate": "2020-01-16T11:15:06Z", "message": "[GEOT-6462] MBStyle font management can lead to tofu chars"}, "afterCommit": {"oid": "6e8da8fa6ccc320787aaa806813f340bccd0e5db", "author": {"user": {"login": "aaime", "name": "Andrea Aime"}}, "url": "https://github.com/geotools/geotools/commit/6e8da8fa6ccc320787aaa806813f340bccd0e5db", "committedDate": "2020-01-16T11:22:54Z", "message": "[GEOT-6462] MBStyle font management can lead to tofu chars"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "117648bff165134f2795bb00e5bfc49aa8269768", "author": {"user": {"login": "aaime", "name": "Andrea Aime"}}, "url": "https://github.com/geotools/geotools/commit/117648bff165134f2795bb00e5bfc49aa8269768", "committedDate": "2020-01-16T11:25:13Z", "message": "[GEOT-6484] LabelPainter miscalculates the position of a labels background graphic, might result in the label not being placed"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1277b122712a3602bb429626e9f6cbcd39150f28", "author": {"user": {"login": "aaime", "name": "Andrea Aime"}}, "url": "https://github.com/geotools/geotools/commit/1277b122712a3602bb429626e9f6cbcd39150f28", "committedDate": "2020-01-16T11:25:13Z", "message": "[GEOT-6480] MBStyle, disable partials=true exports"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "15e461c62ba7582a4318b34dd04fd4983c86f70d", "author": {"user": {"login": "aaime", "name": "Andrea Aime"}}, "url": "https://github.com/geotools/geotools/commit/15e461c62ba7582a4318b34dd04fd4983c86f70d", "committedDate": "2020-01-16T11:25:13Z", "message": "[GEOT-6485] Reduce memory allocation while rendering labels"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cef0dfee972bef4b492519e48e9fb211ca5627e8", "author": {"user": {"login": "aaime", "name": "Andrea Aime"}}, "url": "https://github.com/geotools/geotools/commit/cef0dfee972bef4b492519e48e9fb211ca5627e8", "committedDate": "2020-01-16T11:26:12Z", "message": "[GEOT-6486] Excessive line spacing, especially when arabic chars are in use, when wrapping lines"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b6fe316e0a55aa7169b5ca08a87ccfada27ede6a", "author": {"user": {"login": "aaime", "name": "Andrea Aime"}}, "url": "https://github.com/geotools/geotools/commit/b6fe316e0a55aa7169b5ca08a87ccfada27ede6a", "committedDate": "2020-01-16T11:26:12Z", "message": "[GEOT-6462] MBStyle font management can lead to tofu chars"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6e8da8fa6ccc320787aaa806813f340bccd0e5db", "author": {"user": {"login": "aaime", "name": "Andrea Aime"}}, "url": "https://github.com/geotools/geotools/commit/6e8da8fa6ccc320787aaa806813f340bccd0e5db", "committedDate": "2020-01-16T11:22:54Z", "message": "[GEOT-6462] MBStyle font management can lead to tofu chars"}, "afterCommit": {"oid": "b6fe316e0a55aa7169b5ca08a87ccfada27ede6a", "author": {"user": {"login": "aaime", "name": "Andrea Aime"}}, "url": "https://github.com/geotools/geotools/commit/b6fe316e0a55aa7169b5ca08a87ccfada27ede6a", "committedDate": "2020-01-16T11:26:12Z", "message": "[GEOT-6462] MBStyle font management can lead to tofu chars"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ0MDM5OTIx", "url": "https://github.com/geotools/geotools/pull/2733#pullrequestreview-344039921", "createdAt": "2020-01-16T16:20:34Z", "commit": {"oid": "b6fe316e0a55aa7169b5ca08a87ccfada27ede6a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2968, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}