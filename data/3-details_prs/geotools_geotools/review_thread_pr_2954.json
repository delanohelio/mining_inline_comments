{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDI1NDQ2MzI1", "number": 2954, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0zMFQxMzozODozMlrOEBG9Lw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0zMFQxMzozOToyMFrOEBG9UQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY5NTk3OTk5OnYy", "diffSide": "RIGHT", "path": "modules/extension/tile-client/src/main/java/org/geotools/tile/Tile.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0zMFQxMzozODozMlrOGcymlg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0zMFQxMzozODozMlrOGcymlg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjg0MjM5MA==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    headers.put(\"User-Agent\", \"Geotools Http client\");\n          \n          \n            \n                    headers.put(\"User-Agent\", \"Geotools HTTP client\");\n          \n      \n    \n    \n  \n\n:-p", "url": "https://github.com/geotools/geotools/pull/2954#discussion_r432842390", "createdAt": "2020-05-30T13:38:32Z", "author": {"login": "aaime"}, "path": "modules/extension/tile-client/src/main/java/org/geotools/tile/Tile.java", "diffHunk": "@@ -171,8 +176,19 @@ public BufferedImage getBufferedImage() {\n         }\n     }\n \n+    @Override\n     public BufferedImage loadImageTileImage(Tile tile) throws IOException {\n-        return ImageIOExt.readBufferedImage(getUrl());\n+\n+        Map<String, String> headers = new HashMap<>();\n+        headers.put(\"User-Agent\", \"Geotools Http client\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9afa3682c4d7e6f5e7148087013c3a94f40843a6"}, "originalPosition": 24}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY5NTk4MDMzOnYy", "diffSide": "RIGHT", "path": "modules/extension/tile-client/src/main/java/org/geotools/tile/Tile.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0zMFQxMzozOToyMFrOGcymwQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0zMFQxMzozOTo1M1rOGcym4A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjg0MjQzMw==", "bodyText": "Wondering if SimpleHttpClient should default to the new user agent. It's not the first time I see cascading blocked because servers don't like the Java user agent.", "url": "https://github.com/geotools/geotools/pull/2954#discussion_r432842433", "createdAt": "2020-05-30T13:39:20Z", "author": {"login": "aaime"}, "path": "modules/extension/tile-client/src/main/java/org/geotools/tile/Tile.java", "diffHunk": "@@ -171,8 +176,19 @@ public BufferedImage getBufferedImage() {\n         }\n     }\n \n+    @Override\n     public BufferedImage loadImageTileImage(Tile tile) throws IOException {\n-        return ImageIOExt.readBufferedImage(getUrl());\n+\n+        Map<String, String> headers = new HashMap<>();\n+        headers.put(\"User-Agent\", \"Geotools Http client\");\n+        try (InputStream is = setupInputStream(getUrl(), headers)) {\n+            return ImageIOExt.readBufferedImage(is);\n+        }\n+    }\n+\n+    private InputStream setupInputStream(URL url, Map<String, String> headers) throws IOException {\n+        HTTPClient client = new SimpleHttpClient();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9afa3682c4d7e6f5e7148087013c3a94f40843a6"}, "originalPosition": 31}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjg0MjQ2NA==", "bodyText": "that might be an even better fix - I guess.", "url": "https://github.com/geotools/geotools/pull/2954#discussion_r432842464", "createdAt": "2020-05-30T13:39:53Z", "author": {"login": "ianturton"}, "path": "modules/extension/tile-client/src/main/java/org/geotools/tile/Tile.java", "diffHunk": "@@ -171,8 +176,19 @@ public BufferedImage getBufferedImage() {\n         }\n     }\n \n+    @Override\n     public BufferedImage loadImageTileImage(Tile tile) throws IOException {\n-        return ImageIOExt.readBufferedImage(getUrl());\n+\n+        Map<String, String> headers = new HashMap<>();\n+        headers.put(\"User-Agent\", \"Geotools Http client\");\n+        try (InputStream is = setupInputStream(getUrl(), headers)) {\n+            return ImageIOExt.readBufferedImage(is);\n+        }\n+    }\n+\n+    private InputStream setupInputStream(URL url, Map<String, String> headers) throws IOException {\n+        HTTPClient client = new SimpleHttpClient();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjg0MjQzMw=="}, "originalCommit": {"oid": "9afa3682c4d7e6f5e7148087013c3a94f40843a6"}, "originalPosition": 31}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3529, "cost": 1, "resetAt": "2021-11-12T19:05:54Z"}}}