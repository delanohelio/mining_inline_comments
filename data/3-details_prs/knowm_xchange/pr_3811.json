{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTIxNzUyMTgx", "number": 3811, "title": "[Upbit] Implements getTickers()", "bodyText": "Implements getTickers()\nAdded Upbit util class", "createdAt": "2020-11-16T15:49:58Z", "url": "https://github.com/knowm/XChange/pull/3811", "merged": true, "mergeCommit": {"oid": "62015a71b8beb91ab5e48ba78afc8c38da3fe9d7"}, "closed": true, "closedAt": "2020-11-20T00:28:34Z", "author": {"login": "aaron-jang"}, "timelineItems": {"totalCount": 16, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABddMq5IgH2gAyNTIxNzUyMTgxOmE0Yjg2YzNlNmMwNTA4Yzc5MzZiZTU5NzQ5YjczNjk2N2Y0ZmRjYjk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdd0Wy2AFqTUzMzg1Nzc5Mg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "a4b86c3e6c0508c7936be59749b736967f4fdcb9", "author": {"user": {"login": "aaron-jang", "name": "Aaron Jang"}}, "url": "https://github.com/knowm/XChange/commit/a4b86c3e6c0508c7936be59749b736967f4fdcb9", "committedDate": "2020-11-16T22:26:45Z", "message": "[Upbit] Added Upbit util class"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c0b35397e028acdbd97cd69122c658f140a614db", "author": {"user": {"login": "aaron-jang", "name": "Aaron Jang"}}, "url": "https://github.com/knowm/XChange/commit/c0b35397e028acdbd97cd69122c658f140a614db", "committedDate": "2020-11-16T22:26:45Z", "message": "[Upbit] Fixed correct exchange class"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cae89c10faf94570966784cf4f2615e65ce53403", "author": {"user": {"login": "aaron-jang", "name": "Aaron Jang"}}, "url": "https://github.com/knowm/XChange/commit/cae89c10faf94570966784cf4f2615e65ce53403", "committedDate": "2020-11-16T22:26:45Z", "message": "[Upbit] Implements getTickers and metadata"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "37b3c7712891850f34cca6a1d005e4590d534bac", "author": {"user": {"login": "aaron-jang", "name": "Aaron Jang"}}, "url": "https://github.com/knowm/XChange/commit/37b3c7712891850f34cca6a1d005e4590d534bac", "committedDate": "2020-11-16T15:45:46Z", "message": "[Upbit] Implements getTickers and metadata"}, "afterCommit": {"oid": "556f12e51d2fc8a2283739b0b49c04fa96180123", "author": {"user": {"login": "dependabot-preview[bot]", "name": null}}, "url": "https://github.com/knowm/XChange/commit/556f12e51d2fc8a2283739b0b49c04fa96180123", "committedDate": "2020-11-16T22:26:45Z", "message": "Bump pubnub-gson from 4.31.3 to 4.33.3\n\nBumps [pubnub-gson](https://github.com/pubnub/java) from 4.31.3 to 4.33.3.\n- [Release notes](https://github.com/pubnub/java/releases)\n- [Changelog](https://github.com/pubnub/java/blob/master/CHANGELOG.md)\n- [Commits](https://github.com/pubnub/java/compare/v4.31.3...v4.33.3)\n\nSigned-off-by: dependabot-preview[bot] <support@dependabot.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "556f12e51d2fc8a2283739b0b49c04fa96180123", "author": {"user": {"login": "dependabot-preview[bot]", "name": null}}, "url": "https://github.com/knowm/XChange/commit/556f12e51d2fc8a2283739b0b49c04fa96180123", "committedDate": "2020-11-16T22:26:45Z", "message": "Bump pubnub-gson from 4.31.3 to 4.33.3\n\nBumps [pubnub-gson](https://github.com/pubnub/java) from 4.31.3 to 4.33.3.\n- [Release notes](https://github.com/pubnub/java/releases)\n- [Changelog](https://github.com/pubnub/java/blob/master/CHANGELOG.md)\n- [Commits](https://github.com/pubnub/java/compare/v4.31.3...v4.33.3)\n\nSigned-off-by: dependabot-preview[bot] <support@dependabot.com>"}, "afterCommit": {"oid": "cae89c10faf94570966784cf4f2615e65ce53403", "author": {"user": {"login": "aaron-jang", "name": "Aaron Jang"}}, "url": "https://github.com/knowm/XChange/commit/cae89c10faf94570966784cf4f2615e65ce53403", "committedDate": "2020-11-16T22:26:45Z", "message": "[Upbit] Implements getTickers and metadata"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMyNjExNzAz", "url": "https://github.com/knowm/XChange/pull/3811#pullrequestreview-532611703", "createdAt": "2020-11-17T17:23:33Z", "commit": {"oid": "cae89c10faf94570966784cf4f2615e65ce53403"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xN1QxNzoyMzozM1rOH1Aiaw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xN1QxNzoyMzozM1rOH1Aiaw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTM0NTM4Nw==", "bodyText": "This isn't needed", "url": "https://github.com/knowm/XChange/pull/3811#discussion_r525345387", "createdAt": "2020-11-17T17:23:33Z", "author": {"login": "earce"}, "path": "xchange-upbit/src/main/java/org/knowm/xchange/upbit/UpbitUtils.java", "diffHunk": "@@ -0,0 +1,26 @@\n+package org.knowm.xchange.upbit;\n+\n+import org.knowm.xchange.currency.CurrencyPair;\n+\n+public class UpbitUtils {\n+\n+  public static final String MARKET_NAME_SEPARATOR = \"-\";\n+\n+  private UpbitUtils() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cae89c10faf94570966784cf4f2615e65ce53403"}, "originalPosition": 9}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMyNjEyMzE5", "url": "https://github.com/knowm/XChange/pull/3811#pullrequestreview-532612319", "createdAt": "2020-11-17T17:24:15Z", "commit": {"oid": "cae89c10faf94570966784cf4f2615e65ce53403"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xN1QxNzoyNDoxNVrOH1AkMg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xN1QxNzoyNDoxNVrOH1AkMg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTM0NTg0Mg==", "bodyText": "is this index order correct (1 then 0)? Seems to be the opposite of what I am seeing in public static OrderBook adaptOrderBook(UpbitOrderBooks upbitOrderBooks)", "url": "https://github.com/knowm/XChange/pull/3811#discussion_r525345842", "createdAt": "2020-11-17T17:24:15Z", "author": {"login": "earce"}, "path": "xchange-upbit/src/main/java/org/knowm/xchange/upbit/UpbitUtils.java", "diffHunk": "@@ -0,0 +1,26 @@\n+package org.knowm.xchange.upbit;\n+\n+import org.knowm.xchange.currency.CurrencyPair;\n+\n+public class UpbitUtils {\n+\n+  public static final String MARKET_NAME_SEPARATOR = \"-\";\n+\n+  private UpbitUtils() {\n+    // not called\n+  }\n+\n+  public static String toPairString(CurrencyPair currencyPair) {\n+    if (currencyPair == null) return null;\n+    return currencyPair.counter.getCurrencyCode().toUpperCase()\n+        + MARKET_NAME_SEPARATOR\n+        + currencyPair.base.getCurrencyCode().toUpperCase();\n+  }\n+\n+  public static CurrencyPair toCurrencyPair(String pairString) {\n+    if (pairString == null) return null;\n+    String[] pairStringSplit = pairString.split(MARKET_NAME_SEPARATOR);\n+    if (pairStringSplit.length != 2) return null;\n+    return new CurrencyPair(pairStringSplit[1], pairStringSplit[0]);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cae89c10faf94570966784cf4f2615e65ce53403"}, "originalPosition": 24}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMyNjE1Mzc4", "url": "https://github.com/knowm/XChange/pull/3811#pullrequestreview-532615378", "createdAt": "2020-11-17T17:27:46Z", "commit": {"oid": "cae89c10faf94570966784cf4f2615e65ce53403"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xN1QxNzoyNzo0N1rOH1AtXg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xN1QxNzoyNzo0N1rOH1AtXg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTM0ODE5MA==", "bodyText": "put the ask on the left side for NPE protection", "url": "https://github.com/knowm/XChange/pull/3811#discussion_r525348190", "createdAt": "2020-11-17T17:27:47Z", "author": {"login": "earce"}, "path": "xchange-upbit/src/main/java/org/knowm/xchange/upbit/UpbitAdapters.java", "diffHunk": "@@ -131,27 +138,27 @@ public static Order adaptOrderInfo(UpbitOrderResponse upbitOrderResponse) {\n     } else if (upbitOrderResponse.getState().equalsIgnoreCase(\"done\")) {\n       status = Order.OrderStatus.FILLED;\n     }\n-    OrderType type = upbitOrderResponse.getSide().equals(\"ask\") ? OrderType.ASK : OrderType.BID;\n-    BigDecimal originalAmount = upbitOrderResponse.getVolume();\n-    String[] markets = upbitOrderResponse.getMarket().split(\"-\");\n-    CurrencyPair currencyPair =\n-        new CurrencyPair(new Currency(markets[1]), new Currency(markets[0]));\n-    String orderId = upbitOrderResponse.getUuid();\n-    BigDecimal cumulativeAmount = upbitOrderResponse.getExecutedVolume();\n-    BigDecimal price = upbitOrderResponse.getAvgPrice();\n-    ZonedDateTime dateTime = ZonedDateTime.parse(upbitOrderResponse.getCreatedAt());\n-    LimitOrder order =\n-        new LimitOrder(\n-            type,\n-            originalAmount,\n-            currencyPair,\n-            orderId,\n-            Date.from(dateTime.toInstant()),\n-            price,\n-            price,\n-            cumulativeAmount,\n-            upbitOrderResponse.getPaidFee(),\n-            status);\n-    return order;\n+    return new LimitOrder(\n+        upbitOrderResponse.getSide().equals(\"ask\") ? OrderType.ASK : OrderType.BID,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cae89c10faf94570966784cf4f2615e65ce53403"}, "originalPosition": 95}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c3d60f02b3e8178db7708767d171ca1104d21439", "author": {"user": {"login": "aaron-jang", "name": "Aaron Jang"}}, "url": "https://github.com/knowm/XChange/commit/c3d60f02b3e8178db7708767d171ca1104d21439", "committedDate": "2020-11-18T16:34:34Z", "message": "[Upbit] Fixed NPE in adaptOrderInfo"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9c9a30894491da0a381f37c5cbe79164061d8e5b", "author": {"user": {"login": "aaron-jang", "name": "Aaron Jang"}}, "url": "https://github.com/knowm/XChange/commit/9c9a30894491da0a381f37c5cbe79164061d8e5b", "committedDate": "2020-11-18T16:51:36Z", "message": "[Upbit] Removed unnecessary code"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "84fa9f0255cf4fc20bd542dc7ef5ee2907fc289c", "author": {"user": {"login": "aaron-jang", "name": "Aaron Jang"}}, "url": "https://github.com/knowm/XChange/commit/84fa9f0255cf4fc20bd542dc7ef5ee2907fc289c", "committedDate": "2020-11-18T17:30:17Z", "message": "[Upbit] Added getOrder, cancelOrder support to TradeService"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMzNzMyNzY3", "url": "https://github.com/knowm/XChange/pull/3811#pullrequestreview-533732767", "createdAt": "2020-11-18T17:59:46Z", "commit": {"oid": "84fa9f0255cf4fc20bd542dc7ef5ee2907fc289c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOFQxNzo1OTo0NlrOH17PAA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOFQxNzo1OTo0NlrOH17PAA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjMwNzA3Mg==", "bodyText": "also sorry missed this but can you use the builder class that limit order has to do this", "url": "https://github.com/knowm/XChange/pull/3811#discussion_r526307072", "createdAt": "2020-11-18T17:59:46Z", "author": {"login": "earce"}, "path": "xchange-upbit/src/main/java/org/knowm/xchange/upbit/UpbitAdapters.java", "diffHunk": "@@ -130,28 +137,30 @@ public static Order adaptOrderInfo(UpbitOrderResponse upbitOrderResponse) {\n       status = Order.OrderStatus.PARTIALLY_FILLED;\n     } else if (upbitOrderResponse.getState().equalsIgnoreCase(\"done\")) {\n       status = Order.OrderStatus.FILLED;\n+    } else {\n+      status = Order.OrderStatus.NEW;\n     }\n-    OrderType type = upbitOrderResponse.getSide().equals(\"ask\") ? OrderType.ASK : OrderType.BID;\n-    BigDecimal originalAmount = upbitOrderResponse.getVolume();\n-    String[] markets = upbitOrderResponse.getMarket().split(\"-\");\n-    CurrencyPair currencyPair =\n-        new CurrencyPair(new Currency(markets[1]), new Currency(markets[0]));\n-    String orderId = upbitOrderResponse.getUuid();\n-    BigDecimal cumulativeAmount = upbitOrderResponse.getExecutedVolume();\n-    BigDecimal price = upbitOrderResponse.getAvgPrice();\n-    ZonedDateTime dateTime = ZonedDateTime.parse(upbitOrderResponse.getCreatedAt());\n-    LimitOrder order =\n-        new LimitOrder(\n-            type,\n-            originalAmount,\n-            currencyPair,\n-            orderId,\n-            Date.from(dateTime.toInstant()),\n-            price,\n-            price,\n-            cumulativeAmount,\n-            upbitOrderResponse.getPaidFee(),\n-            status);\n-    return order;\n+    return new LimitOrder(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "84fa9f0255cf4fc20bd542dc7ef5ee2907fc289c"}, "originalPosition": 106}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5d73cb1e91fcdfd58e029b0f42ea622509d5ff83", "author": {"user": {"login": "aaron-jang", "name": "Aaron Jang"}}, "url": "https://github.com/knowm/XChange/commit/5d73cb1e91fcdfd58e029b0f42ea622509d5ff83", "committedDate": "2020-11-18T18:04:24Z", "message": "[Upbit] Removed private constructor"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3ad817e7ccd567c372ab8670af978d9b44f11214", "author": {"user": {"login": "aaron-jang", "name": "Aaron Jang"}}, "url": "https://github.com/knowm/XChange/commit/3ad817e7ccd567c372ab8670af978d9b44f11214", "committedDate": "2020-11-18T18:35:14Z", "message": "[Upbit] Convert LimitOrder from constructor to Builder creation"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMzODU1Mjk0", "url": "https://github.com/knowm/XChange/pull/3811#pullrequestreview-533855294", "createdAt": "2020-11-18T20:37:37Z", "commit": {"oid": "3ad817e7ccd567c372ab8670af978d9b44f11214"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOFQyMDozNzozN1rOH2BMOQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOFQyMDozNzozN1rOH2BMOQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjQwNDY2NQ==", "bodyText": "is there a reason why you aren't using cp here?", "url": "https://github.com/knowm/XChange/pull/3811#discussion_r526404665", "createdAt": "2020-11-18T20:37:37Z", "author": {"login": "earce"}, "path": "xchange-upbit/src/main/java/org/knowm/xchange/upbit/UpbitAdapters.java", "diffHunk": "@@ -130,28 +136,32 @@ public static Order adaptOrderInfo(UpbitOrderResponse upbitOrderResponse) {\n       status = Order.OrderStatus.PARTIALLY_FILLED;\n     } else if (upbitOrderResponse.getState().equalsIgnoreCase(\"done\")) {\n       status = Order.OrderStatus.FILLED;\n+    } else {\n+      status = Order.OrderStatus.NEW;\n     }\n-    OrderType type = upbitOrderResponse.getSide().equals(\"ask\") ? OrderType.ASK : OrderType.BID;\n-    BigDecimal originalAmount = upbitOrderResponse.getVolume();\n-    String[] markets = upbitOrderResponse.getMarket().split(\"-\");\n-    CurrencyPair currencyPair =\n-        new CurrencyPair(new Currency(markets[1]), new Currency(markets[0]));\n-    String orderId = upbitOrderResponse.getUuid();\n-    BigDecimal cumulativeAmount = upbitOrderResponse.getExecutedVolume();\n-    BigDecimal price = upbitOrderResponse.getAvgPrice();\n-    ZonedDateTime dateTime = ZonedDateTime.parse(upbitOrderResponse.getCreatedAt());\n-    LimitOrder order =\n-        new LimitOrder(\n-            type,\n-            originalAmount,\n-            currencyPair,\n-            orderId,\n-            Date.from(dateTime.toInstant()),\n-            price,\n-            price,\n-            cumulativeAmount,\n-            upbitOrderResponse.getPaidFee(),\n-            status);\n-    return order;\n+\n+    final OrderType orderType = UpbitUtils.fromSide(upbitOrderResponse.getSide());\n+    final CurrencyPair currencyPair = UpbitUtils.toCurrencyPair(upbitOrderResponse.getMarket());\n+    return new LimitOrder.Builder(orderType, currencyPair)\n+        .originalAmount(upbitOrderResponse.getVolume())\n+        .id(upbitOrderResponse.getUuid())\n+        .timestamp(Date.from(ZonedDateTime.parse(upbitOrderResponse.getCreatedAt()).toInstant()))\n+        .limitPrice(upbitOrderResponse.getAvgPrice())\n+        .averagePrice(upbitOrderResponse.getAvgPrice())\n+        .cumulativeAmount(upbitOrderResponse.getExecutedVolume())\n+        .fee(upbitOrderResponse.getPaidFee())\n+        .orderStatus(status)\n+        .build();\n+  }\n+\n+  public static ExchangeMetaData adaptMetadata(List<UpbitMarket> markets) {\n+    Map<CurrencyPair, CurrencyPairMetaData> pairMeta =\n+        markets.stream()\n+            .map(UpbitMarket::getMarket)\n+            .map(UpbitUtils::toCurrencyPair)\n+            .collect(\n+                Collectors.toMap(\n+                    Function.identity(), cp -> new CurrencyPairMetaData.Builder().build()));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3ad817e7ccd567c372ab8670af978d9b44f11214"}, "originalPosition": 156}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMzODU3Nzky", "url": "https://github.com/knowm/XChange/pull/3811#pullrequestreview-533857792", "createdAt": "2020-11-18T20:41:00Z", "commit": {"oid": "3ad817e7ccd567c372ab8670af978d9b44f11214"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOFQyMDo0MTowMFrOH2BToA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOFQyMDo0MTowMFrOH2BToA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjQwNjU2MA==", "bodyText": "the compare to == 0 implies executed volume == 0 which would be unfilled, wouldn't partially filled be a number > 0?", "url": "https://github.com/knowm/XChange/pull/3811#discussion_r526406560", "createdAt": "2020-11-18T20:41:00Z", "author": {"login": "earce"}, "path": "xchange-upbit/src/main/java/org/knowm/xchange/upbit/UpbitAdapters.java", "diffHunk": "@@ -121,7 +127,7 @@ public static Wallet adaptWallet(UpbitBalances wallets) {\n   }\n \n   public static Order adaptOrderInfo(UpbitOrderResponse upbitOrderResponse) {\n-    Order.OrderStatus status = Order.OrderStatus.NEW;\n+    Order.OrderStatus status;\n     if (upbitOrderResponse.getState().equalsIgnoreCase(\"cancel\")) {\n       status = Order.OrderStatus.CANCELED;\n     } else if (upbitOrderResponse.getExecutedVolume().compareTo(BigDecimal.ZERO) == 0) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3ad817e7ccd567c372ab8670af978d9b44f11214"}, "originalPosition": 104}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2474, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}