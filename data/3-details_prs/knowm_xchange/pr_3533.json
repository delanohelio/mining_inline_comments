{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDIyMzMyNDc3", "number": 3533, "title": "[streaming] ping related cleanup, inspection cleanup", "bodyText": "Cleaning up some redundant parts of the code related to ping.\nLog + Gemini both override method protected void handleIdle(ChannelHandlerContext ctx) which is now part of NettyStreamingService.java behavior so have removed these overrides. Since Gemini's idle time was 15 seconds which is Netty's default --have switched to use that default var.\nIn my QA environment I saw bitrich-info/xchange-stream#502 present itself and pingStatus treated as an unknown message type which I have now added to the switch to log as a warn given this presents itself when we are hitting rate limits. Not sure if another log level makes more sense? Additionally, is this issue only a product of attempting to open many WebSocket connections quickly, or can it occur by hammering a single WebSocket channel with 15+ subscriptions?\nHave removed protected Completable openConnection() override from KrakenStreamingService.java given that the idle ping sends a ping out every 15 seconds of being idle (this will now be a web socket ping rather then an application level ping). @mdvx I saw you had added this in, with what frequency were you seeing disconnects? Was the heartbeat not sufficient to keep the connection alive?\nIn NettyStreamingService.java have cleared up some inspection warnings.", "createdAt": "2020-05-23T22:01:41Z", "url": "https://github.com/knowm/XChange/pull/3533", "merged": true, "mergeCommit": {"oid": "f78f9cfc156788e3e11d8fc92eb9940a6139b07b"}, "closed": true, "closedAt": "2020-05-25T09:20:18Z", "author": {"login": "earce"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcjlflWgH2gAyNDIyMzMyNDc3OmRkOTFiMDlmZjc2YzI4NDQyYzUyZjczNzFjNzAxNmQyMDQ0MjBjYjE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcksfbBAFqTQxNzU3Njg0MA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "dd91b09ff76c28442c52f7371c7016d204420cb1", "author": {"user": {"login": "earce", "name": "Erick Arce"}}, "url": "https://github.com/knowm/XChange/commit/dd91b09ff76c28442c52f7371c7016d204420cb1", "committedDate": "2020-05-21T22:34:25Z", "message": "Merge pull request #1 from knowm/develop\n\nupdating to head"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7f93a8eebe2bb0c470992a58d33b723d90c09f42", "author": {"user": {"login": "earce", "name": "Erick Arce"}}, "url": "https://github.com/knowm/XChange/commit/7f93a8eebe2bb0c470992a58d33b723d90c09f42", "committedDate": "2020-05-23T20:51:59Z", "message": "cleanup of streaming classes, removing inspection errors"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1c4f174bb5393ddee0bf6d4e7c4166ee0f622d41", "author": {"user": {"login": "earce", "name": "Erick Arce"}}, "url": "https://github.com/knowm/XChange/commit/1c4f174bb5393ddee0bf6d4e7c4166ee0f622d41", "committedDate": "2020-05-23T20:54:22Z", "message": "Merge pull request #2 from knowm/develop\n\nupdating fork"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "719b759fcf835bfa71b46c268556006b44150816", "author": {"user": {"login": "earce", "name": "Erick Arce"}}, "url": "https://github.com/knowm/XChange/commit/719b759fcf835bfa71b46c268556006b44150816", "committedDate": "2020-05-23T21:10:30Z", "message": "Merge remote-tracking branch 'origin/develop' into develop"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE3MzM1MzQ5", "url": "https://github.com/knowm/XChange/pull/3533#pullrequestreview-417335349", "createdAt": "2020-05-24T07:49:31Z", "commit": {"oid": "719b759fcf835bfa71b46c268556006b44150816"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNFQwNzo0OTozMVrOGZtSLw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNFQwNzo0OTozMVrOGZtSLw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTYwOTUxOQ==", "bodyText": "Warn is quite high. Does this warrant waking someone up for?", "url": "https://github.com/knowm/XChange/pull/3533#discussion_r429609519", "createdAt": "2020-05-24T07:49:31Z", "author": {"login": "badgerwithagun"}, "path": "xchange-stream-kraken/src/main/java/info/bitrich/xchangestream/kraken/KrakenStreamingService.java", "diffHunk": "@@ -57,6 +54,9 @@ protected void handleMessage(JsonNode message) {\n       KrakenEventType krakenEvent;\n       if (event != null && (krakenEvent = KrakenEventType.getEvent(event.textValue())) != null) {\n         switch (krakenEvent) {\n+          case pingStatus:\n+            LOG.warn(\"PingStatus received: {}\", message);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "719b759fcf835bfa71b46c268556006b44150816"}, "originalPosition": 29}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE3MzM1NDE1", "url": "https://github.com/knowm/XChange/pull/3533#pullrequestreview-417335415", "createdAt": "2020-05-24T07:50:53Z", "commit": {"oid": "719b759fcf835bfa71b46c268556006b44150816"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNFQwNzo1MDo1M1rOGZtShg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNFQwNzo1MDo1M1rOGZtShg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTYwOTYwNg==", "bodyText": "Looks like the fmt plugin needs rerunning here", "url": "https://github.com/knowm/XChange/pull/3533#discussion_r429609606", "createdAt": "2020-05-24T07:50:53Z", "author": {"login": "badgerwithagun"}, "path": "xchange-stream-service-netty/src/main/java/info/bitrich/xchangestream/service/netty/NettyStreamingService.java", "diffHunk": "@@ -163,8 +163,7 @@ protected Completable openConnection() {\n                 if (ssl) {\n                   SslContextBuilder sslContextBuilder = SslContextBuilder.forClient();\n                   if (acceptAllCertificates) {\n-                    sslContextBuilder =\n-                        sslContextBuilder.trustManager(InsecureTrustManagerFactory.INSTANCE);\n+                    sslContextBuilder.trustManager(InsecureTrustManagerFactory.INSTANCE);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "719b759fcf835bfa71b46c268556006b44150816"}, "originalPosition": 6}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE3MzM1NDM3", "url": "https://github.com/knowm/XChange/pull/3533#pullrequestreview-417335437", "createdAt": "2020-05-24T07:51:11Z", "commit": {"oid": "719b759fcf835bfa71b46c268556006b44150816"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8989b79cbc173f3a937742aec57b62d421a2e446", "author": {"user": {"login": "earce", "name": "Erick Arce"}}, "url": "https://github.com/knowm/XChange/commit/8989b79cbc173f3a937742aec57b62d421a2e446", "committedDate": "2020-05-24T14:06:57Z", "message": "cleanup of streaming classes, removing inspection errors"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE3NTc2ODQw", "url": "https://github.com/knowm/XChange/pull/3533#pullrequestreview-417576840", "createdAt": "2020-05-25T09:17:30Z", "commit": {"oid": "8989b79cbc173f3a937742aec57b62d421a2e446"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2565, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}