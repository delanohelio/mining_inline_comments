{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzkyODM3NzE5", "number": 3466, "title": "#3171 Support for futures markets in orders", "bodyText": "Unfortunately I had to refactor two xchange implementations a little for correct json deserialisation.", "createdAt": "2020-03-24T08:06:17Z", "url": "https://github.com/knowm/XChange/pull/3466", "merged": true, "mergeCommit": {"oid": "d8976185c9a508c5b3a3323afe4ed4fc24213da5"}, "closed": true, "closedAt": "2020-03-27T08:32:46Z", "author": {"login": "douggie"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcQuRyeAH2gAyMzkyODM3NzE5Ojc1Y2NjZDBkMjdiOGI4NGRiYThjNzRjNjdjMjAwM2Q1MTI1OTUwMjU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcRdszrgH2gAyMzkyODM3NzE5OjMxZWViYjUxMDk2MWVkZTMzNDMxZDY0ZjFkMjYwNjcxOTRjMWY4MDY=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "75cccd0d27b8b84dba8c74c67c2003d512595025", "author": {"user": {"login": "douggie", "name": null}}, "url": "https://github.com/knowm/XChange/commit/75cccd0d27b8b84dba8c74c67c2003d512595025", "committedDate": "2020-03-24T08:03:56Z", "message": "#3171 Unfortunatley I had to refactor two xchange implmetations a little\nfor correct json deserialisation."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1c1402600ca8e9b41bf0ea089fbf45746d7c05c9", "author": {"user": {"login": "douggie", "name": null}}, "url": "https://github.com/knowm/XChange/commit/1c1402600ca8e9b41bf0ea089fbf45746d7c05c9", "committedDate": "2020-03-24T08:21:06Z", "message": "#3171"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d9ee762140409cdff1599818798b3a9958e9afad", "author": {"user": {"login": "douggie", "name": null}}, "url": "https://github.com/knowm/XChange/commit/d9ee762140409cdff1599818798b3a9958e9afad", "committedDate": "2020-03-24T08:21:27Z", "message": "#3171"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "849bae2f8783fab366d9f19260f290a826241006", "author": {"user": {"login": "douggie", "name": null}}, "url": "https://github.com/knowm/XChange/commit/849bae2f8783fab366d9f19260f290a826241006", "committedDate": "2020-03-24T08:44:04Z", "message": "#3171 couple of xchange implementations calling order builders directly\nand need casting to CurrencyPair"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgwMDk1Mzk5", "url": "https://github.com/knowm/XChange/pull/3466#pullrequestreview-380095399", "createdAt": "2020-03-24T08:40:11Z", "commit": {"oid": "d9ee762140409cdff1599818798b3a9958e9afad"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQwODo0MDoxMVrOF6lz9A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQwODo0MjowOVrOF6l4FA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Njk4MTIzNg==", "bodyText": "first of all is this needed here for the Instrument refactor to work?\nsecondly you should not write deserializer for DTOs that can be easily deserialized by Jackson it self if you just use Jacksons annotations properly", "url": "https://github.com/knowm/XChange/pull/3466#discussion_r396981236", "createdAt": "2020-03-24T08:40:11Z", "author": {"login": "walec51"}, "path": "xchange-therock/src/main/java/org/knowm/xchange/therock/dto/marketdata/TheRockTicker.java", "diffHunk": "@@ -3,21 +3,71 @@\n import com.fasterxml.jackson.databind.PropertyNamingStrategy;\n import com.fasterxml.jackson.databind.annotation.JsonDeserialize;\n import com.fasterxml.jackson.databind.annotation.JsonNaming;\n+import java.io.Serializable;\n import java.math.BigDecimal;\n import java.util.Date;\n import org.knowm.xchange.currency.CurrencyPair;\n-import org.knowm.xchange.utils.jackson.CurrencyPairDeserializer;\n+import org.knowm.xchange.therock.utils.jackson.TheRockTickerDeserializer;\n \n /** @author Matija Mazi */\n @JsonNaming(PropertyNamingStrategy.SnakeCaseStrategy.class)\n-public class TheRockTicker {\n+@JsonDeserialize(using = TheRockTickerDeserializer.class)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d9ee762140409cdff1599818798b3a9958e9afad"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Njk4MjI5Mg==", "bodyText": "so now we have an over complicated deserialization mechanism to the rock DTOs with less test coverage\nrestore this test, remove the deserializers, use Jackson annotation on DTOs\nbesides this looks unrelated to the futures feature - if so then separate this to a different PR", "url": "https://github.com/knowm/XChange/pull/3466#discussion_r396982292", "createdAt": "2020-03-24T08:42:09Z", "author": {"login": "walec51"}, "path": "xchange-therock/src/test/java/org/knowm/xchange/therock/dto/TheRockDtoTest.java", "diffHunk": "@@ -1,115 +0,0 @@\n-package org.knowm.xchange.therock.dto;\n-\n-import static org.assertj.core.api.Assertions.assertThat;\n-\n-import com.fasterxml.jackson.databind.ObjectMapper;\n-import java.io.IOException;\n-import java.io.InputStream;\n-import java.math.BigDecimal;\n-import java.nio.file.Paths;\n-import java.text.ParseException;\n-import java.text.SimpleDateFormat;\n-import java.util.Arrays;\n-import java.util.Date;\n-import java.util.LinkedList;\n-import org.junit.Test;\n-import org.knowm.xchange.currency.CurrencyPair;\n-import org.knowm.xchange.therock.TheRock;\n-import org.knowm.xchange.therock.dto.account.TheRockBalance;\n-import org.knowm.xchange.therock.dto.account.TheRockBalances;\n-import org.knowm.xchange.therock.dto.account.TheRockWithdrawalResponse;\n-import org.knowm.xchange.therock.dto.marketdata.TheRockTicker;\n-import org.knowm.xchange.therock.dto.trade.TheRockOrder;\n-import org.knowm.xchange.therock.dto.trade.TheRockOrders;\n-\n-public class TheRockDtoTest {\n-\n-  private static ObjectMapper mapper = new ObjectMapper();\n-\n-  private static <T> T parse(Class<T> theClass) throws IOException {\n-    LinkedList<String> linkedList =\n-        new LinkedList<>(\n-            Arrays.asList(new Object() {}.getClass().getPackage().getName().split(\"\\\\.\")));\n-    linkedList.add(theClass.getSimpleName() + \".json\");\n-    String filename =\n-        Paths.get(linkedList.removeFirst(), linkedList.toArray(new String[0])).toString();\n-    return parse(filename, theClass);\n-  }\n-\n-  private static <E> E parse(String filename, Class<E> type) throws java.io.IOException {\n-    InputStream is = TheRockDtoTest.class.getResourceAsStream(\"/\" + filename);\n-    return mapper.readValue(is, type);\n-  }\n-\n-  @Test\n-  public void testTicker() throws Exception {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d9ee762140409cdff1599818798b3a9958e9afad"}, "originalPosition": 45}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgwMTYzNzgz", "url": "https://github.com/knowm/XChange/pull/3466#pullrequestreview-380163783", "createdAt": "2020-03-24T10:10:29Z", "commit": {"oid": "849bae2f8783fab366d9f19260f290a826241006"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQxMDoxMDoyOVrOF6pN_w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQxMDoxMDoyOVrOF6pN_w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzAzNzA1NQ==", "bodyText": "I think we could also just change this to\nprivate String fundId;\n\nmapping this to an CurrencyPair here is to early\nan adapter should do this - even if the mapping is trivial", "url": "https://github.com/knowm/XChange/pull/3466#discussion_r397037055", "createdAt": "2020-03-24T10:10:29Z", "author": {"login": "walec51"}, "path": "xchange-therock/src/main/java/org/knowm/xchange/therock/dto/marketdata/TheRockTicker.java", "diffHunk": "@@ -3,21 +3,71 @@\n import com.fasterxml.jackson.databind.PropertyNamingStrategy;\n import com.fasterxml.jackson.databind.annotation.JsonDeserialize;\n import com.fasterxml.jackson.databind.annotation.JsonNaming;\n+import java.io.Serializable;\n import java.math.BigDecimal;\n import java.util.Date;\n import org.knowm.xchange.currency.CurrencyPair;\n-import org.knowm.xchange.utils.jackson.CurrencyPairDeserializer;\n+import org.knowm.xchange.therock.utils.jackson.TheRockTickerDeserializer;\n \n /** @author Matija Mazi */\n @JsonNaming(PropertyNamingStrategy.SnakeCaseStrategy.class)\n-public class TheRockTicker {\n+@JsonDeserialize(using = TheRockTickerDeserializer.class)\n+public class TheRockTicker implements Serializable {\n+  /** */\n+  private static final long serialVersionUID = -4662345648477360478L;\n \n-  @JsonDeserialize(using = CurrencyPairDeserializer.class)\n   private CurrencyPair fundId;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "849bae2f8783fab366d9f19260f290a826241006"}, "originalPosition": 20}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "252918b854264c2cc2c73a77152d1026212149e7", "author": {"user": {"login": "douggie", "name": null}}, "url": "https://github.com/knowm/XChange/commit/252918b854264c2cc2c73a77152d1026212149e7", "committedDate": "2020-03-24T13:33:52Z", "message": "#3171"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "82d76b15ecaf2a21de9da2ff6752a76771e44e30", "author": {"user": {"login": "douggie", "name": null}}, "url": "https://github.com/knowm/XChange/commit/82d76b15ecaf2a21de9da2ff6752a76771e44e30", "committedDate": "2020-03-24T13:45:19Z", "message": "#3171"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "63be81f16277a2f7e3f9fd2efd5dc7489fcfb9ec", "author": {"user": {"login": "douggie", "name": null}}, "url": "https://github.com/knowm/XChange/commit/63be81f16277a2f7e3f9fd2efd5dc7489fcfb9ec", "committedDate": "2020-03-24T13:45:51Z", "message": "#3171"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgxNzc4ODI0", "url": "https://github.com/knowm/XChange/pull/3466#pullrequestreview-381778824", "createdAt": "2020-03-26T08:14:54Z", "commit": {"oid": "63be81f16277a2f7e3f9fd2efd5dc7489fcfb9ec"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNlQwODoxNDo1NFrOF77cCA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNlQwODoxNDo1NFrOF77cCA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODM4NDEzNg==", "bodyText": "change this javadoc to\n/**\n  * @deprecated\n  * CurrencyPair is a subtype of Instrument - this method will throw\n  * an exception if the order was for a derivative\n  * <p> use {@link #getInstrument()} instead\n  */\n\nthat example in blockquote is not needed", "url": "https://github.com/knowm/XChange/pull/3466#discussion_r398384136", "createdAt": "2020-03-26T08:14:54Z", "author": {"login": "walec51"}, "path": "xchange-core/src/main/java/org/knowm/xchange/dto/Order.java", "diffHunk": "@@ -224,10 +221,27 @@ public void setAveragePrice(BigDecimal averagePrice) {\n \n     this.averagePrice = averagePrice;\n   }\n-\n+  /**\n+   * @deprecated CurrencyPair is a subtype of instrument <br>\n+   *     use {@link #getInstrument()} instead like this:\n+   *     <blockquote>\n+   *     <pre>\n+   * getInstrument()\n+   * </pre>\n+   *     </blockquote>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "63be81f16277a2f7e3f9fd2efd5dc7489fcfb9ec"}, "originalPosition": 98}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "31eebb510961ede33431d64f1d26067194c1f806", "author": {"user": {"login": "douggie", "name": null}}, "url": "https://github.com/knowm/XChange/commit/31eebb510961ede33431d64f1d26067194c1f806", "committedDate": "2020-03-26T15:18:59Z", "message": "#3171 updated javadoc"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2529, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}