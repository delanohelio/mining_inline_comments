{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA4ODc1MDc3", "number": 948, "reviewThreads": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yN1QxMTozMDoyMVrOD2ob4w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0zMFQxNToyNzoyNVrOD4F-zQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU4NjEyMTk1OnYy", "diffSide": "RIGHT", "path": "libs/java/server_common/src/main/resources/messages/ServerCommon.properties", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yN1QxMTozMDoyMVrOGMeX0A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yN1QxMTozMDoyMVrOGMeX0A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTczMzcxMg==", "bodyText": "have left ServerCommon.properties in common even tough this file contains notification specific attributes.\nI will move these attributes to files in zms / zts on a separate pull request.", "url": "https://github.com/AthenZ/athenz/pull/948#discussion_r415733712", "createdAt": "2020-04-27T11:30:21Z", "author": {"login": "OferLevi85"}, "path": "libs/java/server_common/src/main/resources/messages/ServerCommon.properties", "diffHunk": "@@ -10,3 +10,9 @@ athenz.notification.email.principal.expiry.body.entry=<tr><td class=\"cv\">{0}</td\n \n athenz.notification.email.unrefreshed.certs.subject=Athenz Unrefreshed Certificates Notification\n athenz.notification.email.unrefreshed.certs.body.entry=<tr><td class=\"cv\">{0}</td><td class=\"cv\">{1}</td><td class=\"cv\">{2}</td><td class=\"cv\">{3}</td><td class=\"cv\">{4}</td><td class=\"cv\">{5}</td></tr>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3e61655d92f58312b8f98a8e4ad58fa49995e2c6"}, "originalPosition": 3}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU4NjEyNjE4OnYy", "diffSide": "RIGHT", "path": "servers/zms/src/main/java/com/yahoo/athenz/zms/DBService.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yN1QxMTozMToyM1rOGMeaMw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yN1QxMTozMToyM1rOGMeaMw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTczNDMyMw==", "bodyText": "DB is implemented in PR 951", "url": "https://github.com/AthenZ/athenz/pull/948#discussion_r415734323", "createdAt": "2020-04-27T11:31:23Z", "author": {"login": "OferLevi85"}, "path": "servers/zms/src/main/java/com/yahoo/athenz/zms/DBService.java", "diffHunk": "@@ -4226,6 +4226,11 @@ DomainRoleMembership getPendingDomainRoleMembers(final String principal) {\n         return null;\n     }\n \n+    public Map<String, DomainRoleMember> getReviewMembers() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3e61655d92f58312b8f98a8e4ad58fa49995e2c6"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYwMTQxNDEzOnYy", "diffSide": "RIGHT", "path": "servers/zms/src/main/java/com/yahoo/athenz/zms/notification/RoleMemberReviewNotificationTask.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0zMFQxNToxOTo0N1rOGOuMvQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0zMFQxNToxOTo0N1rOGOuMvQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODA5MDE3Mw==", "bodyText": "A better description would be: \"Periodic Review Reminder\"\nthis feature is not really about expiration. it's just about reviewing members without expiring anyone.", "url": "https://github.com/AthenZ/athenz/pull/948#discussion_r418090173", "createdAt": "2020-04-30T15:19:47Z", "author": {"login": "havetisyan"}, "path": "servers/zms/src/main/java/com/yahoo/athenz/zms/notification/RoleMemberReviewNotificationTask.java", "diffHunk": "@@ -0,0 +1,159 @@\n+/*\n+ *  Copyright 2020 Verizon Media\n+ *\n+ *  Licensed under the Apache License, Version 2.0 (the \"License\");\n+ *  you may not use this file except in compliance with the License.\n+ *  You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *  Unless required by applicable law or agreed to in writing, software\n+ *  distributed under the License is distributed on an \"AS IS\" BASIS,\n+ *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ *  See the License for the specific language governing permissions and\n+ *  limitations under the License.\n+ */\n+\n+package com.yahoo.athenz.zms.notification;\n+\n+import com.yahoo.athenz.common.server.notification.*;\n+import com.yahoo.athenz.zms.DBService;\n+import com.yahoo.athenz.zms.DomainRoleMember;\n+import com.yahoo.athenz.zms.MemberRole;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Set;\n+\n+import static com.yahoo.athenz.common.server.notification.NotificationServiceConstants.*;\n+\n+public class RoleMemberReviewNotificationTask implements NotificationTask {\n+    private final DBService dbService;\n+    private final RoleMemberNotificationCommon roleMemberNotificationCommon;\n+    private static final Logger LOGGER = LoggerFactory.getLogger(RoleMemberReviewNotificationTask.class);\n+    private final static String DESCRIPTION = \"Review before expiration reminder\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d21f2f869198c10d380905428c8755a76ee7bc87"}, "originalPosition": 37}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYwMTQyMTcwOnYy", "diffSide": "RIGHT", "path": "servers/zms/src/main/resources/messages/domain-member-review.html", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0zMFQxNToyMToyN1rOGOuRdw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0zMFQxNToyMToyN1rOGOuRdw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODA5MTM4Mw==", "bodyText": "we should remove EXPIRATION from this reminder. The user will get those separately so let's not combine and possibly confuse the users.", "url": "https://github.com/AthenZ/athenz/pull/948#discussion_r418091383", "createdAt": "2020-04-30T15:21:27Z", "author": {"login": "havetisyan"}, "path": "servers/zms/src/main/resources/messages/domain-member-review.html", "diffHunk": "@@ -0,0 +1,36 @@\n+<!DOCTYPE html>\n+<html lang=\"en\" dir=\"ltr\">\n+<head>\n+    <meta charset=\"utf-8\">\n+    <title></title>\n+    <style></style>\n+</head>\n+<body style=\"margin: 0; background: rgba(231, 232, 231, 1.0);\">\n+<div class=\"athenz-wrapper\">\n+    <div class=\"mbrapproval\">\n+        <div class=\"logo\">\n+            <img src=\"cid:logo\" class=\"athenzlogowhite\" alt=\"Athenz logo\"/>\n+        </div>\n+        <div class=\"hdr\">Domain Membership Review Details</div>\n+        <div class=\"bt\">You have one or more principals in your Athenz domain <b>{0}</b> whose review date will pass soon:</div>\n+        <hr>\n+        <table id=\"t02\">\n+            <thead>\n+            <tr>\n+                <th class=\"ch\">MEMBER</th>\n+                <th class=\"ch\">ROLE</th>\n+                <th class=\"ch\">EXPIRATION</th>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d21f2f869198c10d380905428c8755a76ee7bc87"}, "originalPosition": 22}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYwMTQyOTEwOnYy", "diffSide": "RIGHT", "path": "servers/zms/src/main/resources/messages/domain-member-review.html", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0zMFQxNToyMzowNlrOGOuWHg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0zMFQxNToyMzowNlrOGOuWHg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODA5MjU3NA==", "bodyText": "We should remove any references to expiration.", "url": "https://github.com/AthenZ/athenz/pull/948#discussion_r418092574", "createdAt": "2020-04-30T15:23:06Z", "author": {"login": "havetisyan"}, "path": "servers/zms/src/main/resources/messages/domain-member-review.html", "diffHunk": "@@ -0,0 +1,36 @@\n+<!DOCTYPE html>\n+<html lang=\"en\" dir=\"ltr\">\n+<head>\n+    <meta charset=\"utf-8\">\n+    <title></title>\n+    <style></style>\n+</head>\n+<body style=\"margin: 0; background: rgba(231, 232, 231, 1.0);\">\n+<div class=\"athenz-wrapper\">\n+    <div class=\"mbrapproval\">\n+        <div class=\"logo\">\n+            <img src=\"cid:logo\" class=\"athenzlogowhite\" alt=\"Athenz logo\"/>\n+        </div>\n+        <div class=\"hdr\">Domain Membership Review Details</div>\n+        <div class=\"bt\">You have one or more principals in your Athenz domain <b>{0}</b> whose review date will pass soon:</div>\n+        <hr>\n+        <table id=\"t02\">\n+            <thead>\n+            <tr>\n+                <th class=\"ch\">MEMBER</th>\n+                <th class=\"ch\">ROLE</th>\n+                <th class=\"ch\">EXPIRATION</th>\n+                <th class=\"ch\">REVIEW</th>\n+            </tr>\n+            </thead>\n+            <tbody></tbody>\n+        </table>\n+        <hr>\n+        <div class=\"bt\"><br>Please review this list and, if necessary, login to <a href=\"{1}/domain/{0}/role\">Athenz UI</a> to extend their expiration and review dates.</div>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d21f2f869198c10d380905428c8755a76ee7bc87"}, "originalPosition": 29}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYwMTQ0NDU5OnYy", "diffSide": "RIGHT", "path": "servers/zms/src/main/resources/messages/principal-review.html", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0zMFQxNToyNjozOFrOGOugCQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0zMFQxNToyNjozOFrOGOugCQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODA5NTExMw==", "bodyText": "it should say - \"You are required to review your {0} principal's membership in the listed roles:\"", "url": "https://github.com/AthenZ/athenz/pull/948#discussion_r418095113", "createdAt": "2020-04-30T15:26:38Z", "author": {"login": "havetisyan"}, "path": "servers/zms/src/main/resources/messages/principal-review.html", "diffHunk": "@@ -0,0 +1,36 @@\n+<!DOCTYPE html>\n+<html lang=\"en\" dir=\"ltr\">\n+<head>\n+    <meta charset=\"utf-8\">\n+    <title></title>\n+    <style></style>\n+</head>\n+<body style=\"margin: 0; background: rgba(231, 232, 231, 1.0);\">\n+<div class=\"athenz-wrapper\">\n+    <div class=\"mbrapproval\">\n+        <div class=\"logo\">\n+            <img src=\"cid:logo\" class=\"athenzlogowhite\" alt=\"Athenz logo\"/>\n+        </div>\n+        <div class=\"hdr\">Principal Review Details</div>\n+        <div class=\"bt\">Review date for principal <b>{0}</b> in the following roles will expire soon:</div>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d21f2f869198c10d380905428c8755a76ee7bc87"}, "originalPosition": 15}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYwMTQ0NzQzOnYy", "diffSide": "RIGHT", "path": "servers/zms/src/main/resources/messages/principal-review.html", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0zMFQxNToyNzoxM1rOGOuhxQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0zMFQxNToyNzoxM1rOGOuhxQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODA5NTU1Nw==", "bodyText": "let's remove the \"those expiration\" part from the message.", "url": "https://github.com/AthenZ/athenz/pull/948#discussion_r418095557", "createdAt": "2020-04-30T15:27:13Z", "author": {"login": "havetisyan"}, "path": "servers/zms/src/main/resources/messages/principal-review.html", "diffHunk": "@@ -0,0 +1,36 @@\n+<!DOCTYPE html>\n+<html lang=\"en\" dir=\"ltr\">\n+<head>\n+    <meta charset=\"utf-8\">\n+    <title></title>\n+    <style></style>\n+</head>\n+<body style=\"margin: 0; background: rgba(231, 232, 231, 1.0);\">\n+<div class=\"athenz-wrapper\">\n+    <div class=\"mbrapproval\">\n+        <div class=\"logo\">\n+            <img src=\"cid:logo\" class=\"athenzlogowhite\" alt=\"Athenz logo\"/>\n+        </div>\n+        <div class=\"hdr\">Principal Review Details</div>\n+        <div class=\"bt\">Review date for principal <b>{0}</b> in the following roles will expire soon:</div>\n+        <hr>\n+        <table id=\"t03\">\n+            <thead>\n+            <tr>\n+                <th class=\"ch\">DOMAIN</th>\n+                <th class=\"ch\">ROLE</th>\n+                <th class=\"ch\">EXPIRATION</th>\n+                <th class=\"ch\">REVIEW</th>\n+            </tr>\n+            </thead>\n+            <tbody></tbody>\n+        </table>\n+        <hr>\n+        <div class=\"bt\"><br>Please review this list and, if necessary, follow up with their respective domain administrators to extend those expiration and review dates.</div>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d21f2f869198c10d380905428c8755a76ee7bc87"}, "originalPosition": 29}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYwMTQ0ODQ1OnYy", "diffSide": "RIGHT", "path": "servers/zms/src/main/resources/messages/principal-review.html", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0zMFQxNToyNzoyNVrOGOuiaQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0zMFQxNToyNzoyNVrOGOuiaQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODA5NTcyMQ==", "bodyText": "let's remove this expiration line as well.", "url": "https://github.com/AthenZ/athenz/pull/948#discussion_r418095721", "createdAt": "2020-04-30T15:27:25Z", "author": {"login": "havetisyan"}, "path": "servers/zms/src/main/resources/messages/principal-review.html", "diffHunk": "@@ -0,0 +1,36 @@\n+<!DOCTYPE html>\n+<html lang=\"en\" dir=\"ltr\">\n+<head>\n+    <meta charset=\"utf-8\">\n+    <title></title>\n+    <style></style>\n+</head>\n+<body style=\"margin: 0; background: rgba(231, 232, 231, 1.0);\">\n+<div class=\"athenz-wrapper\">\n+    <div class=\"mbrapproval\">\n+        <div class=\"logo\">\n+            <img src=\"cid:logo\" class=\"athenzlogowhite\" alt=\"Athenz logo\"/>\n+        </div>\n+        <div class=\"hdr\">Principal Review Details</div>\n+        <div class=\"bt\">Review date for principal <b>{0}</b> in the following roles will expire soon:</div>\n+        <hr>\n+        <table id=\"t03\">\n+            <thead>\n+            <tr>\n+                <th class=\"ch\">DOMAIN</th>\n+                <th class=\"ch\">ROLE</th>\n+                <th class=\"ch\">EXPIRATION</th>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d21f2f869198c10d380905428c8755a76ee7bc87"}, "originalPosition": 22}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1768, "cost": 1, "resetAt": "2021-11-12T09:44:50Z"}}}