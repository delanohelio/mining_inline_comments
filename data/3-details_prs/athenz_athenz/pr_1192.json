{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTI3NDU4MDcx", "number": 1192, "title": "Enforce autentication for swagger endpoints", "bodyText": "I confirm that this contribution is made under the terms of the license found in the root directory of this repository's source tree and that I have the authority necessary to make this contribution on behalf of its copyright owner.", "createdAt": "2020-11-25T13:49:02Z", "url": "https://github.com/AthenZ/athenz/pull/1192", "merged": true, "mergeCommit": {"oid": "04624031cdb5ab38430e8588f9152e8ecf11927f"}, "closed": true, "closedAt": "2020-11-27T20:03:25Z", "author": {"login": "OferLevi85"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdf-rCygFqTUzODUxMTI1Mg==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdgtNh1gFqTU0MDE3ODE5OA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM4NTExMjUy", "url": "https://github.com/AthenZ/athenz/pull/1192#pullrequestreview-538511252", "createdAt": "2020-11-25T13:50:00Z", "commit": {"oid": "e6892b60c6f72cd00b176603582c7f4fdd43b7bc"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNVQxMzo1MDowMFrOH50Qpw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNVQxMzo1MDowMFrOH50Qpw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDM4NzExMQ==", "bodyText": "I use the same zms instance to check authentication in swagger endpoints. Same thing in ZTS.", "url": "https://github.com/AthenZ/athenz/pull/1192#discussion_r530387111", "createdAt": "2020-11-25T13:50:00Z", "author": {"login": "OferLevi85"}, "path": "servers/zms/src/main/java/com/yahoo/athenz/zms/ZMSBinder.java", "diffHunk": "@@ -21,6 +21,6 @@\n \n     @Override\n     protected void configure() {\n-        bind(new ZMSImpl()).to(ZMSHandler.class);\n+        bind(ZMSImplFactory.getZmsInstance()).to(ZMSHandler.class);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e6892b60c6f72cd00b176603582c7f4fdd43b7bc"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM4NTEyMDAz", "url": "https://github.com/AthenZ/athenz/pull/1192#pullrequestreview-538512003", "createdAt": "2020-11-25T13:50:53Z", "commit": {"oid": "e6892b60c6f72cd00b176603582c7f4fdd43b7bc"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNVQxMzo1MDo1NFrOH50S5w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNVQxMzo1MDo1NFrOH50S5w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDM4NzY4Nw==", "bodyText": "Basically the same check for authentication as in ZMSResources / ZTSResources", "url": "https://github.com/AthenZ/athenz/pull/1192#discussion_r530387687", "createdAt": "2020-11-25T13:50:54Z", "author": {"login": "OferLevi85"}, "path": "servers/zms/src/main/java/com/yahoo/athenz/zms/servlet/SwaggerFilter.java", "diffHunk": "@@ -0,0 +1,36 @@\n+package com.yahoo.athenz.zms.servlet;\n+\n+import com.yahoo.athenz.zms.ResourceContext;\n+import com.yahoo.athenz.zms.ZMSHandler;\n+import com.yahoo.athenz.zms.ZMSImplFactory;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+import javax.servlet.*;\n+import javax.servlet.http.HttpServletRequest;\n+import javax.servlet.http.HttpServletResponse;\n+import javax.ws.rs.ext.Provider;\n+import java.io.IOException;\n+\n+@Provider\n+public class SwaggerFilter implements javax.servlet.Filter {\n+\n+    private final ZMSHandler zmsHandler = ZMSImplFactory.getZmsInstance();\n+\n+    @Override\n+    public void init(FilterConfig filterConfig) throws ServletException {\n+\n+    }\n+\n+    @Override\n+    public void doFilter(ServletRequest request, ServletResponse response, FilterChain chain) throws IOException, ServletException {\n+        ResourceContext context = this.zmsHandler.newResourceContext((HttpServletRequest) request, (HttpServletResponse) response, \"swagger\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e6892b60c6f72cd00b176603582c7f4fdd43b7bc"}, "originalPosition": 27}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM4NTEyNjU4", "url": "https://github.com/AthenZ/athenz/pull/1192#pullrequestreview-538512658", "createdAt": "2020-11-25T13:51:36Z", "commit": {"oid": "e6892b60c6f72cd00b176603582c7f4fdd43b7bc"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNVQxMzo1MTozN1rOH50Uzw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNVQxMzo1MTozN1rOH50Uzw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDM4ODE3NQ==", "bodyText": "A configuration file for swagger. Determines how the yaml will be displayed.", "url": "https://github.com/AthenZ/athenz/pull/1192#discussion_r530388175", "createdAt": "2020-11-25T13:51:37Z", "author": {"login": "OferLevi85"}, "path": "servers/zms/src/main/webapp/WEB-INF/openapi.yaml", "diffHunk": "@@ -0,0 +1,8 @@\n+prettyPrint: true", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e6892b60c6f72cd00b176603582c7f4fdd43b7bc"}, "originalPosition": 1}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM4NTEzMTc0", "url": "https://github.com/AthenZ/athenz/pull/1192#pullrequestreview-538513174", "createdAt": "2020-11-25T13:52:11Z", "commit": {"oid": "e6892b60c6f72cd00b176603582c7f4fdd43b7bc"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNVQxMzo1MjoxMVrOH50WnQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNVQxMzo1MjoxMVrOH50WnQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDM4ODYzNw==", "bodyText": "Register the authentication filter for swagger servlet... same for ZTS", "url": "https://github.com/AthenZ/athenz/pull/1192#discussion_r530388637", "createdAt": "2020-11-25T13:52:11Z", "author": {"login": "OferLevi85"}, "path": "servers/zms/src/main/webapp/WEB-INF/web.xml", "diffHunk": "@@ -31,9 +32,20 @@\n         <load-on-startup>2</load-on-startup>\n     </servlet>\n     <servlet-mapping>\n-        <servlet-name>jersey</servlet-name>\n+        <servlet-name>swagger-servlet</servlet-name>\n         <url-pattern>/v1/api/*</url-pattern>\n     </servlet-mapping>\n+\n+    <!-- Authentication filter for swagger -->", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e6892b60c6f72cd00b176603582c7f4fdd43b7bc"}, "originalPosition": 20}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e6892b60c6f72cd00b176603582c7f4fdd43b7bc", "author": {"user": {"login": "OferLevi85", "name": "Ofer Levi"}}, "url": "https://github.com/AthenZ/athenz/commit/e6892b60c6f72cd00b176603582c7f4fdd43b7bc", "committedDate": "2020-11-25T13:48:16Z", "message": "Enforce autentication for swagger endpoints"}, "afterCommit": {"oid": "7bbcb7063f44aed16b578ca6e531adfed436d179", "author": {"user": {"login": "OferLevi85", "name": "Ofer Levi"}}, "url": "https://github.com/AthenZ/athenz/commit/7bbcb7063f44aed16b578ca6e531adfed436d179", "committedDate": "2020-11-25T16:10:05Z", "message": "Enforce autentication for swagger endpoints"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b060755b7727882a749a62a304b9d14f44b6448f", "author": {"user": {"login": "OferLevi85", "name": "Ofer Levi"}}, "url": "https://github.com/AthenZ/athenz/commit/b060755b7727882a749a62a304b9d14f44b6448f", "committedDate": "2020-11-25T17:06:46Z", "message": "Enforce autentication for swagger endpoints"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7bbcb7063f44aed16b578ca6e531adfed436d179", "author": {"user": {"login": "OferLevi85", "name": "Ofer Levi"}}, "url": "https://github.com/AthenZ/athenz/commit/7bbcb7063f44aed16b578ca6e531adfed436d179", "committedDate": "2020-11-25T16:10:05Z", "message": "Enforce autentication for swagger endpoints"}, "afterCommit": {"oid": "b060755b7727882a749a62a304b9d14f44b6448f", "author": {"user": {"login": "OferLevi85", "name": "Ofer Levi"}}, "url": "https://github.com/AthenZ/athenz/commit/b060755b7727882a749a62a304b9d14f44b6448f", "committedDate": "2020-11-25T17:06:46Z", "message": "Enforce autentication for swagger endpoints"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQwMTc4MTk4", "url": "https://github.com/AthenZ/athenz/pull/1192#pullrequestreview-540178198", "createdAt": "2020-11-27T20:03:19Z", "commit": {"oid": "b060755b7727882a749a62a304b9d14f44b6448f"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2873, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}