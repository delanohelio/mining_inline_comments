{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDc5ODk5Mzg0", "number": 1105, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wNFQxODo1NDo0NVrOEgfhPw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wNFQxOToyMDoyN1rOEgf7VA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAyNTA2MzAzOnYy", "diffSide": "RIGHT", "path": "core/zms/src/main/rdl/Group.tdl", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wNFQxODo1NDo0NVrOHNYlqw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wNFQxOToyODo1MVrOHNZZqg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Mzc5NjM5NQ==", "bodyText": "Do we need to add principalType in \"*Membership\" structs as well?", "url": "https://github.com/AthenZ/athenz/pull/1105#discussion_r483796395", "createdAt": "2020-09-04T18:54:45Z", "author": {"login": "abvaidya"}, "path": "core/zms/src/main/rdl/Group.tdl", "diffHunk": "@@ -25,11 +25,12 @@ type GroupMember Struct {\n     ResourceName requestPrincipal (optional); //pending members only - name of the principal requesting the change\n     Timestamp reviewLastNotifiedTime (optional); //for pending membership requests, time when last notification was sent (for file store)\n     Int32 systemDisabled (optional); //user disabled by system based on configured group setting\n+    Int32 principalType (optional); //server use only - principal type: user or service\n }\n \n //The representation for a group membership.\n type GroupMembership Struct {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2cf7e42addedf3940956b5873f87394a61a38f33"}, "originalPosition": 26}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzgwOTcwNg==", "bodyText": "in the next PR when we add support for membership we'll probably add those. this pr only handles putRole operations", "url": "https://github.com/AthenZ/athenz/pull/1105#discussion_r483809706", "createdAt": "2020-09-04T19:28:51Z", "author": {"login": "havetisyan"}, "path": "core/zms/src/main/rdl/Group.tdl", "diffHunk": "@@ -25,11 +25,12 @@ type GroupMember Struct {\n     ResourceName requestPrincipal (optional); //pending members only - name of the principal requesting the change\n     Timestamp reviewLastNotifiedTime (optional); //for pending membership requests, time when last notification was sent (for file store)\n     Int32 systemDisabled (optional); //user disabled by system based on configured group setting\n+    Int32 principalType (optional); //server use only - principal type: user or service\n }\n \n //The representation for a group membership.\n type GroupMembership Struct {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Mzc5NjM5NQ=="}, "originalCommit": {"oid": "2cf7e42addedf3940956b5873f87394a61a38f33"}, "originalPosition": 26}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAyNTA2NzIxOnYy", "diffSide": "RIGHT", "path": "core/zms/src/main/rdl/Role.tdl", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wNFQxODo1NjoyMFrOHNYoNA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wNFQxOTozOToyOFrOHNZpZA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Mzc5NzA0NA==", "bodyText": "It might be helpful to document in tdl which number represents which type. e.g. user=0, service=1 etc", "url": "https://github.com/AthenZ/athenz/pull/1105#discussion_r483797044", "createdAt": "2020-09-04T18:56:20Z", "author": {"login": "abvaidya"}, "path": "core/zms/src/main/rdl/Role.tdl", "diffHunk": "@@ -30,6 +30,7 @@ type RoleMember Struct {\n     ResourceName requestPrincipal (optional); //pending members only - name of the principal requesting the change\n     Timestamp reviewLastNotifiedTime (optional); //for pending membership requests, time when last notification was sent (for file store)\n     Int32 systemDisabled (optional); //user disabled by system based on configured role setting\n+    Int32 principalType (optional); //server use only - principal type: user, group, or service", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2cf7e42addedf3940956b5873f87394a61a38f33"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzgxMzczMg==", "bodyText": "sure", "url": "https://github.com/AthenZ/athenz/pull/1105#discussion_r483813732", "createdAt": "2020-09-04T19:39:28Z", "author": {"login": "havetisyan"}, "path": "core/zms/src/main/rdl/Role.tdl", "diffHunk": "@@ -30,6 +30,7 @@ type RoleMember Struct {\n     ResourceName requestPrincipal (optional); //pending members only - name of the principal requesting the change\n     Timestamp reviewLastNotifiedTime (optional); //for pending membership requests, time when last notification was sent (for file store)\n     Int32 systemDisabled (optional); //user disabled by system based on configured role setting\n+    Int32 principalType (optional); //server use only - principal type: user, group, or service", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Mzc5NzA0NA=="}, "originalCommit": {"oid": "2cf7e42addedf3940956b5873f87394a61a38f33"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAyNTExNzkwOnYy", "diffSide": "RIGHT", "path": "servers/zms/src/main/java/com/yahoo/athenz/zms/ZMSImpl.java", "isResolved": false, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wNFQxOToxNjoxM1rOHNZGKQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wNFQxOTo0MzowNVrOHNZuuw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzgwNDcxMw==", "bodyText": "This method is always going to return true, so does it make sense to just remove it?", "url": "https://github.com/AthenZ/athenz/pull/1105#discussion_r483804713", "createdAt": "2020-09-04T19:16:13Z", "author": {"login": "abvaidya"}, "path": "servers/zms/src/main/java/com/yahoo/athenz/zms/ZMSImpl.java", "diffHunk": "@@ -3566,7 +3617,7 @@ String enforcedUserAuthorityFilter(final String roleUserAuthorityFilter, final S\n     }\n \n     boolean shouldValidateRoleMembers(final String userAuthorityFilter) {\n-        return validateUserRoleMembers || validateServiceRoleMembers || userAuthorityFilter != null;\n+        return validateGroupRoleMembers || validateUserRoleMembers || validateServiceRoleMembers || userAuthorityFilter != null;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2cf7e42addedf3940956b5873f87394a61a38f33"}, "originalPosition": 327}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzgwNzEyNw==", "bodyText": "I see all references are removed?", "url": "https://github.com/AthenZ/athenz/pull/1105#discussion_r483807127", "createdAt": "2020-09-04T19:22:06Z", "author": {"login": "abvaidya"}, "path": "servers/zms/src/main/java/com/yahoo/athenz/zms/ZMSImpl.java", "diffHunk": "@@ -3566,7 +3617,7 @@ String enforcedUserAuthorityFilter(final String roleUserAuthorityFilter, final S\n     }\n \n     boolean shouldValidateRoleMembers(final String userAuthorityFilter) {\n-        return validateUserRoleMembers || validateServiceRoleMembers || userAuthorityFilter != null;\n+        return validateGroupRoleMembers || validateUserRoleMembers || validateServiceRoleMembers || userAuthorityFilter != null;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzgwNDcxMw=="}, "originalCommit": {"oid": "2cf7e42addedf3940956b5873f87394a61a38f33"}, "originalPosition": 327}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzgwOTk3Mg==", "bodyText": "eventually yes, it will be removed. I've removed in a couple of place already. once other functionality is added, it will slowly be removed", "url": "https://github.com/AthenZ/athenz/pull/1105#discussion_r483809972", "createdAt": "2020-09-04T19:29:30Z", "author": {"login": "havetisyan"}, "path": "servers/zms/src/main/java/com/yahoo/athenz/zms/ZMSImpl.java", "diffHunk": "@@ -3566,7 +3617,7 @@ String enforcedUserAuthorityFilter(final String roleUserAuthorityFilter, final S\n     }\n \n     boolean shouldValidateRoleMembers(final String userAuthorityFilter) {\n-        return validateUserRoleMembers || validateServiceRoleMembers || userAuthorityFilter != null;\n+        return validateGroupRoleMembers || validateUserRoleMembers || validateServiceRoleMembers || userAuthorityFilter != null;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzgwNDcxMw=="}, "originalCommit": {"oid": "2cf7e42addedf3940956b5873f87394a61a38f33"}, "originalPosition": 327}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzgxNTA5OQ==", "bodyText": "ok, looks like it got cleaned up in all place, so I'll remove it in this PR as well.", "url": "https://github.com/AthenZ/athenz/pull/1105#discussion_r483815099", "createdAt": "2020-09-04T19:43:05Z", "author": {"login": "havetisyan"}, "path": "servers/zms/src/main/java/com/yahoo/athenz/zms/ZMSImpl.java", "diffHunk": "@@ -3566,7 +3617,7 @@ String enforcedUserAuthorityFilter(final String roleUserAuthorityFilter, final S\n     }\n \n     boolean shouldValidateRoleMembers(final String userAuthorityFilter) {\n-        return validateUserRoleMembers || validateServiceRoleMembers || userAuthorityFilter != null;\n+        return validateGroupRoleMembers || validateUserRoleMembers || validateServiceRoleMembers || userAuthorityFilter != null;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzgwNDcxMw=="}, "originalCommit": {"oid": "2cf7e42addedf3940956b5873f87394a61a38f33"}, "originalPosition": 327}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAyNTEyOTgwOnYy", "diffSide": "RIGHT", "path": "servers/zms/src/main/java/com/yahoo/athenz/zms/ZMSImpl.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wNFQxOToyMDoyN1rOHNZM_w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wNFQxOTozNDozMlrOHNZiDQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzgwNjQ2Mw==", "bodyText": "instead of looping over again, can we set the principal type which adding them to \"normalizedGroupMembers\" above?", "url": "https://github.com/AthenZ/athenz/pull/1105#discussion_r483806463", "createdAt": "2020-09-04T19:20:27Z", "author": {"login": "abvaidya"}, "path": "servers/zms/src/main/java/com/yahoo/athenz/zms/ZMSImpl.java", "diffHunk": "@@ -8043,6 +8095,13 @@ void normalizeGroupMembers(Group group) {\n                 addNormalizedGroupMember(normalizedMembers, member);\n             }\n         }\n+\n+        // go through each member and set the principal type\n+\n+        for (GroupMember member : normalizedMembers.values()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2cf7e42addedf3940956b5873f87394a61a38f33"}, "originalPosition": 366}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzgxMTg1Mw==", "bodyText": "sure, we'll just need to add some logic to skip duplicates and don't waste lookup operations.", "url": "https://github.com/AthenZ/athenz/pull/1105#discussion_r483811853", "createdAt": "2020-09-04T19:34:32Z", "author": {"login": "havetisyan"}, "path": "servers/zms/src/main/java/com/yahoo/athenz/zms/ZMSImpl.java", "diffHunk": "@@ -8043,6 +8095,13 @@ void normalizeGroupMembers(Group group) {\n                 addNormalizedGroupMember(normalizedMembers, member);\n             }\n         }\n+\n+        // go through each member and set the principal type\n+\n+        for (GroupMember member : normalizedMembers.values()) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzgwNjQ2Mw=="}, "originalCommit": {"oid": "2cf7e42addedf3940956b5873f87394a61a38f33"}, "originalPosition": 366}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1602, "cost": 1, "resetAt": "2021-11-12T09:44:50Z"}}}