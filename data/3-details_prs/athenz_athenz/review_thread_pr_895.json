{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg0MjU0MjU1", "number": 895, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQxMjo0NDowMFrODlaHqQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQxMjo1MzoxNlrODlaTFQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQwNTUxODQ5OnYy", "diffSide": "LEFT", "path": "libs/java/server_common/src/main/java/com/yahoo/athenz/common/server/http/HttpDriver.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQxMjo0NDowMFrOFySF8w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQxMjo0NDowMFrOFySF8w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODI2OTU1NQ==", "bodyText": "Removed unused members", "url": "https://github.com/AthenZ/athenz/pull/895#discussion_r388269555", "createdAt": "2020-03-05T12:44:00Z", "author": {"login": "OferLevi85"}, "path": "libs/java/server_common/src/main/java/com/yahoo/athenz/common/server/http/HttpDriver.java", "diffHunk": "@@ -59,10 +58,6 @@\n     private static final int DEFAULT_CLIENT_READ_TIMEOUT_MS = 5000;\n \n     private final String baseUrl;\n-    private final String truststorePath;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "569908b2a80af697e3c85ffa786917014ec1c245"}, "originalPosition": 12}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQwNTUyMTQwOnYy", "diffSide": "RIGHT", "path": "libs/java/server_common/src/main/java/com/yahoo/athenz/common/server/http/HttpDriver.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQxMjo0NDo1N1rOFySHtw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQxMjo0NDo1N1rOFySHtw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODI3MDAwNw==", "bodyText": "Expose doPost that accepts HttpPost for more complicated posts.", "url": "https://github.com/AthenZ/athenz/pull/895#discussion_r388270007", "createdAt": "2020-03-05T12:44:57Z", "author": {"login": "OferLevi85"}, "path": "libs/java/server_common/src/main/java/com/yahoo/athenz/common/server/http/HttpDriver.java", "diffHunk": "@@ -261,16 +252,14 @@ public String doGet(final String url) throws IOException {\n \n     /**\n      * doPost performs post operation and returns a string\n-     * @param url target url\n-     * @param fields form fields that need to posted to the url\n+     * @param httpPost\n      * @return response string\n      * @throws IOException\n      */\n-    public String doPost(final String url, final List<NameValuePair> fields) throws IOException {\n-        LOGGER.debug(\"Requesting from {} with query {}\", url, fields);\n-\n-        HttpPost httpPost = new HttpPost(url);\n-        httpPost.setEntity(new UrlEncodedFormEntity(fields));\n+    public String doPost(HttpPost httpPost) throws IOException {\n+        String url = httpPost.getURI().toString();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "569908b2a80af697e3c85ffa786917014ec1c245"}, "originalPosition": 46}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQwNTUyNzQ2OnYy", "diffSide": "RIGHT", "path": "libs/java/server_common/src/main/java/com/yahoo/athenz/common/server/notification/impl/AWSEmailProvider.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQxMjo0Njo0N1rOFySLNg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQxMjo0Njo0N1rOFySLNg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODI3MDkwMg==", "bodyText": "As @abvaidya suggested, extracted the MimeMessage construction so providers will not need to implement it.", "url": "https://github.com/AthenZ/athenz/pull/895#discussion_r388270902", "createdAt": "2020-03-05T12:46:47Z", "author": {"login": "OferLevi85"}, "path": "libs/java/server_common/src/main/java/com/yahoo/athenz/common/server/notification/impl/AWSEmailProvider.java", "diffHunk": "@@ -27,77 +27,20 @@\n import org.slf4j.Logger;\n import org.slf4j.LoggerFactory;\n \n-import javax.mail.Session;\n-import javax.mail.internet.InternetAddress;\n-import javax.mail.internet.MimeBodyPart;\n import javax.mail.internet.MimeMessage;\n-import javax.mail.internet.MimeMultipart;\n import java.io.ByteArrayOutputStream;\n import java.nio.ByteBuffer;\n import java.util.Collection;\n-import java.util.Properties;\n-\n-import static com.yahoo.athenz.common.server.notification.NotificationServiceConstants.CHARSET_UTF_8;\n-import static com.yahoo.athenz.common.server.notification.NotificationServiceConstants.HTML_LOGO_CID_PLACEHOLDER;\n \n public class AWSEmailProvider implements EmailProvider {\n     private static final Logger LOGGER = LoggerFactory.getLogger(AWSEmailProvider.class);\n     private final AmazonSimpleEmailService ses;\n \n     @Override\n-    public boolean sendEmail(String subject, String body, boolean status, Collection<String> recipients, String from, byte[] logoImage) {\n+    public boolean sendEmail(boolean status, Collection<String> recipients, String from, MimeMessage mimeMessage) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "569908b2a80af697e3c85ffa786917014ec1c245"}, "originalPosition": 23}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQwNTU0NzczOnYy", "diffSide": "LEFT", "path": "libs/java/server_common/src/main/java/com/yahoo/athenz/common/server/notification/EmailProvider.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQxMjo1MzoxNlrOFySXiw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQxMjo1MzoxNlrOFySXiw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODI3NDA1OQ==", "bodyText": "I have changed the interface but it is unlikely that someone already implemented a new EmailProvider.", "url": "https://github.com/AthenZ/athenz/pull/895#discussion_r388274059", "createdAt": "2020-03-05T12:53:16Z", "author": {"login": "OferLevi85"}, "path": "libs/java/server_common/src/main/java/com/yahoo/athenz/common/server/notification/EmailProvider.java", "diffHunk": "@@ -16,19 +16,18 @@\n \n package com.yahoo.athenz.common.server.notification;\n \n+import javax.mail.internet.MimeMessage;\n import java.util.Collection;\n \n public interface EmailProvider {\n \n     /**\n      * Send an email through the provider\n-     * @param subject\n-     * @param body\n      * @param status\n      * @param recipients\n      * @param from\n-     * @param logoImage\n+     * @param mimeMessage\n      * @return true if mail was sent\n      */\n-    boolean sendEmail(String subject, String body, boolean status, Collection<String> recipients, String from, byte[] logoImage);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "569908b2a80af697e3c85ffa786917014ec1c245"}, "originalPosition": 20}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1737, "cost": 1, "resetAt": "2021-11-12T09:44:50Z"}}}