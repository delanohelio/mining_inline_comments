{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ3MDgxODM1", "number": 1034, "reviewThreads": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xM1QwMDowNTozOVrOENpY-A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNVQwNTo0Nzo1OFrOEOiQhw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgyNzQ1MDgwOnYy", "diffSide": "RIGHT", "path": "core/zms/src/main/rdl/Role.rdli", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xM1QwMDowNTozOVrOGwYJRA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xM1QxMDo0ODo1OFrOGwjUqw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzM4MDQyMA==", "bodyText": "can we also extend this to include an optional domainName attribute where I would only return the role names from the given domain name if specified. We don't have an API that just returns the role names that a given principal is member  in a domain so we don't want them to get the full list and then parse and filter out the domain they're interested in.", "url": "https://github.com/AthenZ/athenz/pull/1034#discussion_r453380420", "createdAt": "2020-07-13T00:05:39Z", "author": {"login": "havetisyan"}, "path": "core/zms/src/main/rdl/Role.rdli", "diffHunk": "@@ -129,6 +129,19 @@ resource DomainRoleMembers GET \"/domain/{domainName}/member\" {\n     }\n }\n \n+// Fetch all the roles across domains by either calling or specified principal\n+resource DomainRoleMember GET \"/all_roles?principal={principal}\" (name=GetAllRoles) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6eaaab108dea843fcc122fa854b2d01426f46a05"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzQ0NTI1NQ==", "bodyText": "Sure thing.", "url": "https://github.com/AthenZ/athenz/pull/1034#discussion_r453445255", "createdAt": "2020-07-13T05:39:59Z", "author": {"login": "OferLevi85"}, "path": "core/zms/src/main/rdl/Role.rdli", "diffHunk": "@@ -129,6 +129,19 @@ resource DomainRoleMembers GET \"/domain/{domainName}/member\" {\n     }\n }\n \n+// Fetch all the roles across domains by either calling or specified principal\n+resource DomainRoleMember GET \"/all_roles?principal={principal}\" (name=GetAllRoles) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzM4MDQyMA=="}, "originalCommit": {"oid": "6eaaab108dea843fcc122fa854b2d01426f46a05"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzU2MzU2Mw==", "bodyText": "Done", "url": "https://github.com/AthenZ/athenz/pull/1034#discussion_r453563563", "createdAt": "2020-07-13T10:48:58Z", "author": {"login": "OferLevi85"}, "path": "core/zms/src/main/rdl/Role.rdli", "diffHunk": "@@ -129,6 +129,19 @@ resource DomainRoleMembers GET \"/domain/{domainName}/member\" {\n     }\n }\n \n+// Fetch all the roles across domains by either calling or specified principal\n+resource DomainRoleMember GET \"/all_roles?principal={principal}\" (name=GetAllRoles) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzM4MDQyMA=="}, "originalCommit": {"oid": "6eaaab108dea843fcc122fa854b2d01426f46a05"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgyOTc4OTgzOnYy", "diffSide": "RIGHT", "path": "clients/java/zms/pom.xml", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xM1QxNToyNzozNlrOGwtthg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xM1QyMDo1NjozOVrOGw5jsQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzczMzc2Ng==", "bodyText": "we should remove the previous line", "url": "https://github.com/AthenZ/athenz/pull/1034#discussion_r453733766", "createdAt": "2020-07-13T15:27:36Z", "author": {"login": "havetisyan"}, "path": "clients/java/zms/pom.xml", "diffHunk": "@@ -28,6 +28,7 @@\n \n   <properties>\n     <code.coverage.min>0.42</code.coverage.min>\n+    <code.coverage.min>0.95</code.coverage.min>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "06aa599d510acef180213cf293282194938d59c7"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzkyNzg1Nw==", "bodyText": "Done", "url": "https://github.com/AthenZ/athenz/pull/1034#discussion_r453927857", "createdAt": "2020-07-13T20:56:39Z", "author": {"login": "OferLevi85"}, "path": "clients/java/zms/pom.xml", "diffHunk": "@@ -28,6 +28,7 @@\n \n   <properties>\n     <code.coverage.min>0.42</code.coverage.min>\n+    <code.coverage.min>0.95</code.coverage.min>", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzczMzc2Ng=="}, "originalCommit": {"oid": "06aa599d510acef180213cf293282194938d59c7"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgyOTgwNTkzOnYy", "diffSide": "RIGHT", "path": "servers/zms/src/main/java/com/yahoo/athenz/zms/store/file/FileConnection.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xM1QxNTozMToxNVrOGwt3gg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xM1QyMDo1NzoxM1rOGw5k2w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzczNjMyMg==", "bodyText": "we should also return the system disabled flag if we're return all the other attributes", "url": "https://github.com/AthenZ/athenz/pull/1034#discussion_r453736322", "createdAt": "2020-07-13T15:31:15Z", "author": {"login": "havetisyan"}, "path": "servers/zms/src/main/java/com/yahoo/athenz/zms/store/file/FileConnection.java", "diffHunk": "@@ -1639,6 +1640,51 @@ public DomainRoleMembers listDomainRoleMembers(String domainName) {\n         return listReviewRoleMembersWithFilter(domainName, (roleMember -> true), \"listDomainRoleMembers\");\n     }\n \n+    @Override\n+    public DomainRoleMember getAllRoles(String principal, String domainName) {\n+        DomainRoleMember domainRoleMember = new DomainRoleMember();\n+        domainRoleMember.setMemberName(principal);\n+        domainRoleMember.setMemberRoles(new ArrayList<>());\n+\n+        if (!StringUtil.isEmpty(domainName)) {\n+            getDomainRolesForPrincipal(principal, domainRoleMember, domainName);\n+        } else {\n+            String[] fnames = getDomainList();\n+            for (String domain : fnames) {\n+                getDomainRolesForPrincipal(principal, domainRoleMember, domain);\n+            }\n+        }\n+\n+        return domainRoleMember;\n+    }\n+\n+    private void getDomainRolesForPrincipal(String principal, DomainRoleMember domainRoleMember, String domain) {\n+        DomainStruct dom = getDomainStruct(domain);\n+        if (dom == null) {\n+            return;\n+        }\n+\n+        for (Role role: dom.getRoles().values()) {\n+            List<RoleMember> roleMembers = role.getRoleMembers();\n+            if (roleMembers == null) {\n+                continue;\n+            }\n+            for (RoleMember roleMember : roleMembers) {\n+                if (!roleMember.getMemberName().equals(principal)) {\n+                    continue;\n+                }\n+\n+                MemberRole memberRole = new MemberRole();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "06aa599d510acef180213cf293282194938d59c7"}, "originalPosition": 46}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzkyODE1NQ==", "bodyText": "Done", "url": "https://github.com/AthenZ/athenz/pull/1034#discussion_r453928155", "createdAt": "2020-07-13T20:57:13Z", "author": {"login": "OferLevi85"}, "path": "servers/zms/src/main/java/com/yahoo/athenz/zms/store/file/FileConnection.java", "diffHunk": "@@ -1639,6 +1640,51 @@ public DomainRoleMembers listDomainRoleMembers(String domainName) {\n         return listReviewRoleMembersWithFilter(domainName, (roleMember -> true), \"listDomainRoleMembers\");\n     }\n \n+    @Override\n+    public DomainRoleMember getAllRoles(String principal, String domainName) {\n+        DomainRoleMember domainRoleMember = new DomainRoleMember();\n+        domainRoleMember.setMemberName(principal);\n+        domainRoleMember.setMemberRoles(new ArrayList<>());\n+\n+        if (!StringUtil.isEmpty(domainName)) {\n+            getDomainRolesForPrincipal(principal, domainRoleMember, domainName);\n+        } else {\n+            String[] fnames = getDomainList();\n+            for (String domain : fnames) {\n+                getDomainRolesForPrincipal(principal, domainRoleMember, domain);\n+            }\n+        }\n+\n+        return domainRoleMember;\n+    }\n+\n+    private void getDomainRolesForPrincipal(String principal, DomainRoleMember domainRoleMember, String domain) {\n+        DomainStruct dom = getDomainStruct(domain);\n+        if (dom == null) {\n+            return;\n+        }\n+\n+        for (Role role: dom.getRoles().values()) {\n+            List<RoleMember> roleMembers = role.getRoleMembers();\n+            if (roleMembers == null) {\n+                continue;\n+            }\n+            for (RoleMember roleMember : roleMembers) {\n+                if (!roleMember.getMemberName().equals(principal)) {\n+                    continue;\n+                }\n+\n+                MemberRole memberRole = new MemberRole();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzczNjMyMg=="}, "originalCommit": {"oid": "06aa599d510acef180213cf293282194938d59c7"}, "originalPosition": 46}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgyOTgxODAwOnYy", "diffSide": "RIGHT", "path": "servers/zms/src/main/java/com/yahoo/athenz/zms/store/jdbc/JDBCConnection.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xM1QxNTozMzo1N1rOGwt-0g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xM1QyMDo1NzozNlrOGw5lkw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzczODE5NA==", "bodyText": "we should. handle the case where we have an invalid domain:\n    if (domainId == 0) {\n        throw notFoundError(caller, ZMSConsts.OBJECT_DOMAIN, domainName);\n    }\n\nand we should have a unit test case for this as well.", "url": "https://github.com/AthenZ/athenz/pull/1034#discussion_r453738194", "createdAt": "2020-07-13T15:33:57Z", "author": {"login": "havetisyan"}, "path": "servers/zms/src/main/java/com/yahoo/athenz/zms/store/jdbc/JDBCConnection.java", "diffHunk": "@@ -3751,6 +3765,65 @@ public DomainRoleMembers listDomainRoleMembers(String domainName) {\n         return listDomainRoleMembersWithQuery(domainName, SQL_GET_DOMAIN_ROLE_MEMBERS, \"listDomainRoleMembers\");\n     }\n \n+    @Override\n+    public DomainRoleMember getAllRoles(String principal, String domainName) {\n+        final String caller = \"getAllRoles\";\n+\n+        int principalId = getPrincipalId(principal);\n+        if (principalId == 0) {\n+            throw notFoundError(caller, ZMSConsts.OBJECT_PRINCIPAL, principal);\n+        }\n+\n+        DomainRoleMember roleMember = new DomainRoleMember();\n+        roleMember.setMemberRoles(new ArrayList<>());\n+        roleMember.setMemberName(principal);\n+        if (StringUtil.isEmpty(domainName)) {\n+            try (PreparedStatement ps = con.prepareStatement(SQL_GET_ALL_ROLES)) {\n+                ps.setInt(1, principalId);\n+                return getRolesForPrincipal(caller, roleMember, ps);\n+            } catch (SQLException ex) {\n+                throw sqlError(ex, caller);\n+            }\n+        } else {\n+            int domainId = getDomainId(domainName);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "06aa599d510acef180213cf293282194938d59c7"}, "originalPosition": 52}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzkyODMzOQ==", "bodyText": "Done", "url": "https://github.com/AthenZ/athenz/pull/1034#discussion_r453928339", "createdAt": "2020-07-13T20:57:36Z", "author": {"login": "OferLevi85"}, "path": "servers/zms/src/main/java/com/yahoo/athenz/zms/store/jdbc/JDBCConnection.java", "diffHunk": "@@ -3751,6 +3765,65 @@ public DomainRoleMembers listDomainRoleMembers(String domainName) {\n         return listDomainRoleMembersWithQuery(domainName, SQL_GET_DOMAIN_ROLE_MEMBERS, \"listDomainRoleMembers\");\n     }\n \n+    @Override\n+    public DomainRoleMember getAllRoles(String principal, String domainName) {\n+        final String caller = \"getAllRoles\";\n+\n+        int principalId = getPrincipalId(principal);\n+        if (principalId == 0) {\n+            throw notFoundError(caller, ZMSConsts.OBJECT_PRINCIPAL, principal);\n+        }\n+\n+        DomainRoleMember roleMember = new DomainRoleMember();\n+        roleMember.setMemberRoles(new ArrayList<>());\n+        roleMember.setMemberName(principal);\n+        if (StringUtil.isEmpty(domainName)) {\n+            try (PreparedStatement ps = con.prepareStatement(SQL_GET_ALL_ROLES)) {\n+                ps.setInt(1, principalId);\n+                return getRolesForPrincipal(caller, roleMember, ps);\n+            } catch (SQLException ex) {\n+                throw sqlError(ex, caller);\n+            }\n+        } else {\n+            int domainId = getDomainId(domainName);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzczODE5NA=="}, "originalCommit": {"oid": "06aa599d510acef180213cf293282194938d59c7"}, "originalPosition": 52}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgyOTg1NzI2OnYy", "diffSide": "RIGHT", "path": "servers/zms/src/main/java/com/yahoo/athenz/zms/ZMSImpl.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xM1QxNTo0MDo1N1rOGwuXBg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xM1QyMDo1NzowMFrOGw5kag==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mzc0NDM5MA==", "bodyText": "if domainName is specified, we need to validate its value as well", "url": "https://github.com/AthenZ/athenz/pull/1034#discussion_r453744390", "createdAt": "2020-07-13T15:40:57Z", "author": {"login": "havetisyan"}, "path": "servers/zms/src/main/java/com/yahoo/athenz/zms/ZMSImpl.java", "diffHunk": "@@ -2956,6 +2957,34 @@ public DomainRoleMembers getDomainRoleMembers(ResourceContext ctx, String domain\n         return roleMembers;\n     }\n \n+    @Override\n+    public DomainRoleMember getAllRoles(ResourceContext context, String principal, String domainName) {\n+        final String caller = \"getallroles\";\n+        metric.increment(ZMSConsts.HTTP_GET);\n+        logPrincipal(context);\n+\n+        if (StringUtil.isEmpty(principal)) {\n+            // If principal not specified, get roles for current user\n+            principal = ((RsrcCtxWrapper) context).principal().getFullName();\n+        }\n+        validateRequest(context.request(), caller);\n+        validate(principal, TYPE_ENTITY_NAME, caller);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "06aa599d510acef180213cf293282194938d59c7"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzkyODA0Mg==", "bodyText": "Done", "url": "https://github.com/AthenZ/athenz/pull/1034#discussion_r453928042", "createdAt": "2020-07-13T20:57:00Z", "author": {"login": "OferLevi85"}, "path": "servers/zms/src/main/java/com/yahoo/athenz/zms/ZMSImpl.java", "diffHunk": "@@ -2956,6 +2957,34 @@ public DomainRoleMembers getDomainRoleMembers(ResourceContext ctx, String domain\n         return roleMembers;\n     }\n \n+    @Override\n+    public DomainRoleMember getAllRoles(ResourceContext context, String principal, String domainName) {\n+        final String caller = \"getallroles\";\n+        metric.increment(ZMSConsts.HTTP_GET);\n+        logPrincipal(context);\n+\n+        if (StringUtil.isEmpty(principal)) {\n+            // If principal not specified, get roles for current user\n+            principal = ((RsrcCtxWrapper) context).principal().getFullName();\n+        }\n+        validateRequest(context.request(), caller);\n+        validate(principal, TYPE_ENTITY_NAME, caller);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mzc0NDM5MA=="}, "originalCommit": {"oid": "06aa599d510acef180213cf293282194938d59c7"}, "originalPosition": 23}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgyOTkwMzAwOnYy", "diffSide": "RIGHT", "path": "core/zms/src/main/rdl/Role.rdli", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xM1QxNTo1MToyOFrOGwuzxg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xM1QyMTowMDowNFrOGw5qwg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mzc1MTc1MA==", "bodyText": "for the uri should be consistent with others and use the first component as the object type, e.g. /domain, /resource,e tc.\nwe should just call it /role instead of /all_roles and instead of getAllRoles, let's call the API as getPrincipalRoles", "url": "https://github.com/AthenZ/athenz/pull/1034#discussion_r453751750", "createdAt": "2020-07-13T15:51:28Z", "author": {"login": "havetisyan"}, "path": "core/zms/src/main/rdl/Role.rdli", "diffHunk": "@@ -129,6 +129,20 @@ resource DomainRoleMembers GET \"/domain/{domainName}/member\" {\n     }\n }\n \n+// Fetch all the roles across domains by either calling or specified principal\n+resource DomainRoleMember GET \"/all_roles?principal={principal}&domain={domainName}\" (name=GetAllRoles) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "06aa599d510acef180213cf293282194938d59c7"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzkyOTY2Ng==", "bodyText": "Done", "url": "https://github.com/AthenZ/athenz/pull/1034#discussion_r453929666", "createdAt": "2020-07-13T21:00:04Z", "author": {"login": "OferLevi85"}, "path": "core/zms/src/main/rdl/Role.rdli", "diffHunk": "@@ -129,6 +129,20 @@ resource DomainRoleMembers GET \"/domain/{domainName}/member\" {\n     }\n }\n \n+// Fetch all the roles across domains by either calling or specified principal\n+resource DomainRoleMember GET \"/all_roles?principal={principal}&domain={domainName}\" (name=GetAllRoles) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mzc1MTc1MA=="}, "originalCommit": {"oid": "06aa599d510acef180213cf293282194938d59c7"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgzNjc2ODA3OnYy", "diffSide": "RIGHT", "path": "servers/zms/src/main/java/com/yahoo/athenz/zms/ZMSImpl.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNVQwNTo0Nzo1OFrOGxvMOw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNVQwODo0OTo1MlrOGx0j0A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDgwNjU4Nw==", "bodyText": "we should also lowercase the domainname here", "url": "https://github.com/AthenZ/athenz/pull/1034#discussion_r454806587", "createdAt": "2020-07-15T05:47:58Z", "author": {"login": "havetisyan"}, "path": "servers/zms/src/main/java/com/yahoo/athenz/zms/ZMSImpl.java", "diffHunk": "@@ -2956,6 +2957,38 @@ public DomainRoleMembers getDomainRoleMembers(ResourceContext ctx, String domain\n         return roleMembers;\n     }\n \n+    @Override\n+    public DomainRoleMember getPrincipalRoles(ResourceContext context, String principal, String domainName) {\n+        final String caller = \"getPrincipalRoles\";\n+        metric.increment(ZMSConsts.HTTP_GET);\n+        logPrincipal(context);\n+\n+        if (StringUtil.isEmpty(principal)) {\n+            // If principal not specified, get roles for current user\n+            principal = ((RsrcCtxWrapper) context).principal().getFullName();\n+        }\n+        validateRequest(context.request(), caller);\n+        validate(principal, TYPE_ENTITY_NAME, caller);\n+\n+        if (!StringUtil.isEmpty(domainName)) {\n+            validate(domainName, TYPE_DOMAIN_NAME, caller);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d5a953a08431ef099c98c3c44b9d5cd9bdc1d6fb"}, "originalPosition": 26}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDg5NDU0NA==", "bodyText": "Fixed", "url": "https://github.com/AthenZ/athenz/pull/1034#discussion_r454894544", "createdAt": "2020-07-15T08:49:52Z", "author": {"login": "OferLevi85"}, "path": "servers/zms/src/main/java/com/yahoo/athenz/zms/ZMSImpl.java", "diffHunk": "@@ -2956,6 +2957,38 @@ public DomainRoleMembers getDomainRoleMembers(ResourceContext ctx, String domain\n         return roleMembers;\n     }\n \n+    @Override\n+    public DomainRoleMember getPrincipalRoles(ResourceContext context, String principal, String domainName) {\n+        final String caller = \"getPrincipalRoles\";\n+        metric.increment(ZMSConsts.HTTP_GET);\n+        logPrincipal(context);\n+\n+        if (StringUtil.isEmpty(principal)) {\n+            // If principal not specified, get roles for current user\n+            principal = ((RsrcCtxWrapper) context).principal().getFullName();\n+        }\n+        validateRequest(context.request(), caller);\n+        validate(principal, TYPE_ENTITY_NAME, caller);\n+\n+        if (!StringUtil.isEmpty(domainName)) {\n+            validate(domainName, TYPE_DOMAIN_NAME, caller);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDgwNjU4Nw=="}, "originalCommit": {"oid": "d5a953a08431ef099c98c3c44b9d5cd9bdc1d6fb"}, "originalPosition": 26}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1697, "cost": 1, "resetAt": "2021-11-12T09:44:50Z"}}}