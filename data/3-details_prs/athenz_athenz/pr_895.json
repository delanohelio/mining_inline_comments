{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg0MjU0MjU1", "number": 895, "title": "Refactor EmailNotificatioService and expose HttpDriver HttpPost method", "bodyText": "Refactor EmailNotificationService to have a getMimeMessage method that will create a MimeMessage (instead of having each provider implement it)\nExpose a post method in HttpDriver that accepts HttpPost as argument (for more complicated posts)\n\n\nI confirm that this contribution is made under the terms of the license found in the root directory of this repository's source tree and that I have the authority necessary to make this contribution on behalf of its copyright owner.", "createdAt": "2020-03-05T12:43:20Z", "url": "https://github.com/AthenZ/athenz/pull/895", "merged": true, "mergeCommit": {"oid": "0a653cdb9b82ef2e629de644eb9131ff4de6e41c"}, "closed": true, "closedAt": "2020-03-06T22:32:10Z", "author": {"login": "OferLevi85"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcKq5YmgFqTM2OTUzNjgwMA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcLH6DwAFqTM3MDY2NjQ0Mw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY5NTM2ODAw", "url": "https://github.com/AthenZ/athenz/pull/895#pullrequestreview-369536800", "createdAt": "2020-03-05T12:44:00Z", "commit": {"oid": "569908b2a80af697e3c85ffa786917014ec1c245"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQxMjo0NDowMFrOFySF8w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQxMjo0NDowMFrOFySF8w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODI2OTU1NQ==", "bodyText": "Removed unused members", "url": "https://github.com/AthenZ/athenz/pull/895#discussion_r388269555", "createdAt": "2020-03-05T12:44:00Z", "author": {"login": "OferLevi85"}, "path": "libs/java/server_common/src/main/java/com/yahoo/athenz/common/server/http/HttpDriver.java", "diffHunk": "@@ -59,10 +58,6 @@\n     private static final int DEFAULT_CLIENT_READ_TIMEOUT_MS = 5000;\n \n     private final String baseUrl;\n-    private final String truststorePath;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "569908b2a80af697e3c85ffa786917014ec1c245"}, "originalPosition": 12}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY5NTM3Mzc2", "url": "https://github.com/AthenZ/athenz/pull/895#pullrequestreview-369537376", "createdAt": "2020-03-05T12:44:56Z", "commit": {"oid": "569908b2a80af697e3c85ffa786917014ec1c245"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQxMjo0NDo1N1rOFySHtw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQxMjo0NDo1N1rOFySHtw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODI3MDAwNw==", "bodyText": "Expose doPost that accepts HttpPost for more complicated posts.", "url": "https://github.com/AthenZ/athenz/pull/895#discussion_r388270007", "createdAt": "2020-03-05T12:44:57Z", "author": {"login": "OferLevi85"}, "path": "libs/java/server_common/src/main/java/com/yahoo/athenz/common/server/http/HttpDriver.java", "diffHunk": "@@ -261,16 +252,14 @@ public String doGet(final String url) throws IOException {\n \n     /**\n      * doPost performs post operation and returns a string\n-     * @param url target url\n-     * @param fields form fields that need to posted to the url\n+     * @param httpPost\n      * @return response string\n      * @throws IOException\n      */\n-    public String doPost(final String url, final List<NameValuePair> fields) throws IOException {\n-        LOGGER.debug(\"Requesting from {} with query {}\", url, fields);\n-\n-        HttpPost httpPost = new HttpPost(url);\n-        httpPost.setEntity(new UrlEncodedFormEntity(fields));\n+    public String doPost(HttpPost httpPost) throws IOException {\n+        String url = httpPost.getURI().toString();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "569908b2a80af697e3c85ffa786917014ec1c245"}, "originalPosition": 46}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY5NTM4NDkx", "url": "https://github.com/AthenZ/athenz/pull/895#pullrequestreview-369538491", "createdAt": "2020-03-05T12:46:47Z", "commit": {"oid": "569908b2a80af697e3c85ffa786917014ec1c245"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQxMjo0Njo0N1rOFySLNg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQxMjo0Njo0N1rOFySLNg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODI3MDkwMg==", "bodyText": "As @abvaidya suggested, extracted the MimeMessage construction so providers will not need to implement it.", "url": "https://github.com/AthenZ/athenz/pull/895#discussion_r388270902", "createdAt": "2020-03-05T12:46:47Z", "author": {"login": "OferLevi85"}, "path": "libs/java/server_common/src/main/java/com/yahoo/athenz/common/server/notification/impl/AWSEmailProvider.java", "diffHunk": "@@ -27,77 +27,20 @@\n import org.slf4j.Logger;\n import org.slf4j.LoggerFactory;\n \n-import javax.mail.Session;\n-import javax.mail.internet.InternetAddress;\n-import javax.mail.internet.MimeBodyPart;\n import javax.mail.internet.MimeMessage;\n-import javax.mail.internet.MimeMultipart;\n import java.io.ByteArrayOutputStream;\n import java.nio.ByteBuffer;\n import java.util.Collection;\n-import java.util.Properties;\n-\n-import static com.yahoo.athenz.common.server.notification.NotificationServiceConstants.CHARSET_UTF_8;\n-import static com.yahoo.athenz.common.server.notification.NotificationServiceConstants.HTML_LOGO_CID_PLACEHOLDER;\n \n public class AWSEmailProvider implements EmailProvider {\n     private static final Logger LOGGER = LoggerFactory.getLogger(AWSEmailProvider.class);\n     private final AmazonSimpleEmailService ses;\n \n     @Override\n-    public boolean sendEmail(String subject, String body, boolean status, Collection<String> recipients, String from, byte[] logoImage) {\n+    public boolean sendEmail(boolean status, Collection<String> recipients, String from, MimeMessage mimeMessage) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "569908b2a80af697e3c85ffa786917014ec1c245"}, "originalPosition": 23}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY5NTQyNjIz", "url": "https://github.com/AthenZ/athenz/pull/895#pullrequestreview-369542623", "createdAt": "2020-03-05T12:53:16Z", "commit": {"oid": "569908b2a80af697e3c85ffa786917014ec1c245"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQxMjo1MzoxNlrOFySXiw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQxMjo1MzoxNlrOFySXiw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODI3NDA1OQ==", "bodyText": "I have changed the interface but it is unlikely that someone already implemented a new EmailProvider.", "url": "https://github.com/AthenZ/athenz/pull/895#discussion_r388274059", "createdAt": "2020-03-05T12:53:16Z", "author": {"login": "OferLevi85"}, "path": "libs/java/server_common/src/main/java/com/yahoo/athenz/common/server/notification/EmailProvider.java", "diffHunk": "@@ -16,19 +16,18 @@\n \n package com.yahoo.athenz.common.server.notification;\n \n+import javax.mail.internet.MimeMessage;\n import java.util.Collection;\n \n public interface EmailProvider {\n \n     /**\n      * Send an email through the provider\n-     * @param subject\n-     * @param body\n      * @param status\n      * @param recipients\n      * @param from\n-     * @param logoImage\n+     * @param mimeMessage\n      * @return true if mail was sent\n      */\n-    boolean sendEmail(String subject, String body, boolean status, Collection<String> recipients, String from, byte[] logoImage);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "569908b2a80af697e3c85ffa786917014ec1c245"}, "originalPosition": 20}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "28cac3359629b65841cc239b56d0be4275aed533", "author": {"user": {"login": "OferLevi85", "name": "Ofer Levi"}}, "url": "https://github.com/AthenZ/athenz/commit/28cac3359629b65841cc239b56d0be4275aed533", "committedDate": "2020-03-05T14:04:08Z", "message": "Refactor EmailNotificatioService and expost HttpDriver HttpPost\n\n1. Refactor EmailNotificationService to have a getMimeMessage method that will create a MimeMessage (instead of having each provider implement it)\n2. Expose a post method in HttpDriver that accepts HttpPost as argument (for more complicated posts)"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcwNjY2NDQz", "url": "https://github.com/AthenZ/athenz/pull/895#pullrequestreview-370666443", "createdAt": "2020-03-06T22:32:00Z", "commit": {"oid": "28cac3359629b65841cc239b56d0be4275aed533"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3064, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}