{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk1OTQ5NzU1", "number": 926, "title": "Fixed a bug where big emails caused http client to crash", "bodyText": "httpPost.getEntity is limited to 25k and will throw an exception if it is bigger.\n\nI confirm that this contribution is made under the terms of the license found in the root directory of this repository's source tree and that I have the authority necessary to make this contribution on behalf of its copyright owner.", "createdAt": "2020-03-30T22:50:01Z", "url": "https://github.com/AthenZ/athenz/pull/926", "merged": true, "mergeCommit": {"oid": "66967c1bbf1eee93e5dbe46c4867fbee9d09cc25"}, "closed": true, "closedAt": "2020-03-31T14:07:08Z", "author": {"login": "OferLevi85"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcS29g9gFqTM4NDI5OTAxMA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcTDqv1gFqTM4NDc2OTAyMw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg0Mjk5MDEw", "url": "https://github.com/AthenZ/athenz/pull/926#pullrequestreview-384299010", "createdAt": "2020-03-30T23:18:34Z", "commit": {"oid": "8600dc607f33c9dbf0ed6c05f5dcd0b609dbb615"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMFQyMzoxODozNFrOF9_tiA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMFQyMzoxODozNFrOF9_tiA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDU1MTMwNA==", "bodyText": "where are we using this object - I only see two references in log debug and error points. In which case why are we doing this here at all? We can do a private method to return the query and then have something like:\nif (LOGGER.isDebugEnabled()) {\nLOGGER.debug(...., getPostQuery(httpPost);\n}\nand then further down:\n} catch (IOException ex) {\nLOGGER.error(......, getPostQuery(httpPost), ...);\n}", "url": "https://github.com/AthenZ/athenz/pull/926#discussion_r400551304", "createdAt": "2020-03-30T23:18:34Z", "author": {"login": "havetisyan"}, "path": "libs/java/server_common/src/main/java/com/yahoo/athenz/common/server/http/HttpDriver.java", "diffHunk": "@@ -258,7 +259,9 @@ public String doGet(final String url) throws IOException {\n      */\n     public String doPost(HttpPost httpPost) throws IOException {\n         String url = httpPost.getURI().toString();\n-        String query = EntityUtils.toString(httpPost.getEntity());\n+        ByteArrayOutputStream byteArrayOutputStream = new ByteArrayOutputStream();\n+        httpPost.getEntity().writeTo(byteArrayOutputStream);\n+        String query = byteArrayOutputStream.toString();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8600dc607f33c9dbf0ed6c05f5dcd0b609dbb615"}, "originalPosition": 15}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "8600dc607f33c9dbf0ed6c05f5dcd0b609dbb615", "author": {"user": {"login": "OferLevi85", "name": "Ofer Levi"}}, "url": "https://github.com/AthenZ/athenz/commit/8600dc607f33c9dbf0ed6c05f5dcd0b609dbb615", "committedDate": "2020-03-30T22:40:27Z", "message": "Fixed a bug where big emails caused http client to crash\nhttpPost.getEntity is limited to 25k and will throw an exception if it is bigger."}, "afterCommit": {"oid": "d3b1607151a0afb974e78bbf5dad34fb3f872469", "author": {"user": {"login": "OferLevi85", "name": "Ofer Levi"}}, "url": "https://github.com/AthenZ/athenz/commit/d3b1607151a0afb974e78bbf5dad34fb3f872469", "committedDate": "2020-03-31T02:18:35Z", "message": "Fixed a bug where big emails caused http client to crash\nhttpPost.getEntity is limited to 25k and will throw an exception if it is bigger."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg0MzU5NTM1", "url": "https://github.com/AthenZ/athenz/pull/926#pullrequestreview-384359535", "createdAt": "2020-03-31T02:22:33Z", "commit": {"oid": "d3b1607151a0afb974e78bbf5dad34fb3f872469"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMVQwMjoyMjozM1rOF-C7_g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMVQwMjoyMjozM1rOF-C7_g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDYwNDE1OA==", "bodyText": "we should put this in If (LOGGER.isDebugEnabled()) block otherwise we'll do all the work for the getPostQuery, then pass the argument to the function which will just throw it away since in production we don't have debug enabled (so the getPostQuery call is just wasted).", "url": "https://github.com/AthenZ/athenz/pull/926#discussion_r400604158", "createdAt": "2020-03-31T02:22:33Z", "author": {"login": "havetisyan"}, "path": "libs/java/server_common/src/main/java/com/yahoo/athenz/common/server/http/HttpDriver.java", "diffHunk": "@@ -258,8 +259,7 @@ public String doGet(final String url) throws IOException {\n      */\n     public String doPost(HttpPost httpPost) throws IOException {\n         String url = httpPost.getURI().toString();\n-        String query = EntityUtils.toString(httpPost.getEntity());\n-        LOGGER.debug(\"Requesting from {} with query {}\", url, query);\n+        LOGGER.debug(\"Requesting from {} with query {}\", url, getPostQuery(httpPost));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d3b1607151a0afb974e78bbf5dad34fb3f872469"}, "originalPosition": 14}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4bece7e78774ec2dee5c01e5b1061473c062b19e", "author": {"user": {"login": "OferLevi85", "name": "Ofer Levi"}}, "url": "https://github.com/AthenZ/athenz/commit/4bece7e78774ec2dee5c01e5b1061473c062b19e", "committedDate": "2020-03-31T02:54:06Z", "message": "Fixed a bug where big emails caused http client to crash\nhttpPost.getEntity is limited to 25k and will throw an exception if it is bigger."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d3b1607151a0afb974e78bbf5dad34fb3f872469", "author": {"user": {"login": "OferLevi85", "name": "Ofer Levi"}}, "url": "https://github.com/AthenZ/athenz/commit/d3b1607151a0afb974e78bbf5dad34fb3f872469", "committedDate": "2020-03-31T02:18:35Z", "message": "Fixed a bug where big emails caused http client to crash\nhttpPost.getEntity is limited to 25k and will throw an exception if it is bigger."}, "afterCommit": {"oid": "4bece7e78774ec2dee5c01e5b1061473c062b19e", "author": {"user": {"login": "OferLevi85", "name": "Ofer Levi"}}, "url": "https://github.com/AthenZ/athenz/commit/4bece7e78774ec2dee5c01e5b1061473c062b19e", "committedDate": "2020-03-31T02:54:06Z", "message": "Fixed a bug where big emails caused http client to crash\nhttpPost.getEntity is limited to 25k and will throw an exception if it is bigger."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg0NzY5MDIz", "url": "https://github.com/AthenZ/athenz/pull/926#pullrequestreview-384769023", "createdAt": "2020-03-31T14:07:03Z", "commit": {"oid": "4bece7e78774ec2dee5c01e5b1061473c062b19e"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3082, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}