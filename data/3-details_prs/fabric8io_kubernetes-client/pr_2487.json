{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDg3MTI0MTk1", "number": 2487, "title": "Read process output stream before waiting the exit code of the process", "bodyText": "Description\n\nType of change\n\n\n Bug fix (non-breaking change which fixes an issue)\n Feature (non-breaking change which adds functionality)\n Breaking change (fix or feature that would cause existing functionality to change\n Chore (non-breaking change which doesn't affect codebase;\ntest, version modification, documentation, etc.)\n\nChecklist\n\n Code contributed by me aligns with current project license: Apache 2.0\n I Added CHANGELOG entry regarding this change\n I have implemented unit tests to cover my changes\n I have added/updated the javadocs and other documentation accordingly\n No new bugs, code smells, etc. in SonarCloud report\n I tested my code in Kubernetes\n I tested my code in OpenShift", "createdAt": "2020-09-15T08:20:26Z", "url": "https://github.com/fabric8io/kubernetes-client/pull/2487", "merged": true, "mergeCommit": {"oid": "71692850095527587abec4ed395bf47a9119371b"}, "closed": true, "closedAt": "2020-09-25T10:30:35Z", "author": {"login": "umutkocasarac"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdJCOYGAH2gAyNDg3MTI0MTk1OmU4YjQzOWQxOTk3YjFjY2UxNTAyYTZjOTUwMDYzYmExYmYzNmU4ODY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdMSpShgFqTQ5NjI3MzI5Nw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "e8b439d1997b1cce1502a6c950063ba1bf36e886", "author": {"user": {"login": "cinarkocasarac", "name": null}}, "url": "https://github.com/fabric8io/kubernetes-client/commit/e8b439d1997b1cce1502a6c950063ba1bf36e886", "committedDate": "2020-09-15T06:58:04Z", "message": "Resolve Conflict"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "32d4cef0a241c78f3b58c0ad3f4eccef2b33f19e", "author": {"user": {"login": "cinarkocasarac", "name": null}}, "url": "https://github.com/fabric8io/kubernetes-client/commit/32d4cef0a241c78f3b58c0ad3f4eccef2b33f19e", "committedDate": "2020-09-15T08:17:35Z", "message": "Read process output stream before waiting the exit code of the process"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e17125cbd279b7b84b86bf4c195bd0ab0d28d5ee", "author": {"user": {"login": "rohanKanojia", "name": "Rohan Kumar "}}, "url": "https://github.com/fabric8io/kubernetes-client/commit/e17125cbd279b7b84b86bf4c195bd0ab0d28d5ee", "committedDate": "2020-09-21T08:37:10Z", "message": "Merge branch 'master' into iss_2458"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkyNDE4ODQ1", "url": "https://github.com/fabric8io/kubernetes-client/pull/2487#pullrequestreview-492418845", "createdAt": "2020-09-21T09:28:41Z", "commit": {"oid": "e17125cbd279b7b84b86bf4c195bd0ab0d28d5ee"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMVQwOToyODo0MVrOHVHadA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMVQwOToyODo0MVrOHVHadA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTkwMzYwNA==", "bodyText": "In this excerpt you are no longer considering the error stream.\nWould something like this work with your solution?\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                  StringBuilder sb = new StringBuilder();\n          \n          \n            \n                  try (BufferedReader in = new BufferedReader(new InputStreamReader(p.getInputStream()))) {\n          \n          \n            \n                    String line;\n          \n          \n            \n                    while ((line = in.readLine()) != null) {\n          \n          \n            \n                      sb.append(line);\n          \n          \n            \n                    }\n          \n          \n            \n                  }\n          \n          \n            \n                  if (p.waitFor() != 0) {\n          \n          \n            \n                    LOGGER.warn(IOHelpers.readFully(p.getErrorStream()));\n          \n          \n            \n                    LOGGER.warn(sb.toString());\n          \n          \n            \n                  }\n          \n          \n            \n                  ExecCredential ec = Serialization.unmarshal(p.getInputStream(), ExecCredential.class);\n          \n          \n            \n                  ExecCredential ec = Serialization.unmarshal(sb.toString(), ExecCredential.class);\n          \n          \n            \n                  final String errorOutput = IOHelpers.readFully(p.getErrorStream());\n          \n          \n            \n                  final String standardOutput = IOHelpers.readFully(p.getInputStream());\n          \n          \n            \n                  if (p.waitFor() != 0) {\n          \n          \n            \n                    LOGGER.warn(errorOutput);\n          \n          \n            \n                  }\n          \n          \n            \n                  ExecCredential ec = Serialization.unmarshal(standardOutput, ExecCredential.class);", "url": "https://github.com/fabric8io/kubernetes-client/pull/2487#discussion_r491903604", "createdAt": "2020-09-21T09:28:41Z", "author": {"login": "manusa"}, "path": "kubernetes-client/src/main/java/io/fabric8/kubernetes/client/Config.java", "diffHunk": "@@ -634,15 +634,23 @@ protected static ExecCredential getExecCredentialFromExecConfig(ExecConfig exec,\n       List<ExecEnvVar> env = exec.getEnv();\n       // TODO check behavior of tty & stdin\n       ProcessBuilder pb = new ProcessBuilder(getAuthenticatorCommandFromExecConfig(exec, configFile, Utils.getSystemPathVariable()));\n+      pb.redirectErrorStream(true);\n       if (env != null) {\n         Map<String, String> environment = pb.environment();\n         env.forEach(var -> environment.put(var.getName(), var.getValue()));\n       }\n       Process p = pb.start();\n+      StringBuilder sb = new StringBuilder();\n+      try (BufferedReader in = new BufferedReader(new InputStreamReader(p.getInputStream()))) {\n+        String line;\n+        while ((line = in.readLine()) != null) {\n+          sb.append(line);\n+        }\n+      }\n       if (p.waitFor() != 0) {\n-        LOGGER.warn(IOHelpers.readFully(p.getErrorStream()));\n+        LOGGER.warn(sb.toString());\n       }\n-      ExecCredential ec = Serialization.unmarshal(p.getInputStream(), ExecCredential.class);\n+      ExecCredential ec = Serialization.unmarshal(sb.toString(), ExecCredential.class);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e17125cbd279b7b84b86bf4c195bd0ab0d28d5ee"}, "originalPosition": 22}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "12839a5e934540061436a9551ced4655239a48f9", "author": {"user": {"login": "cinarkocasarac", "name": null}}, "url": "https://github.com/fabric8io/kubernetes-client/commit/12839a5e934540061436a9551ced4655239a48f9", "committedDate": "2020-09-23T09:35:36Z", "message": "IOHelper used for reading message"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6b20cb70eff324962d9e58b5d4c77f6642671894", "author": {"user": {"login": "cinarkocasarac", "name": null}}, "url": "https://github.com/fabric8io/kubernetes-client/commit/6b20cb70eff324962d9e58b5d4c77f6642671894", "committedDate": "2020-09-23T09:41:56Z", "message": "Merge branch 'iss_2458' of github.com-personal:umutkocasarac/kubernetes-client into iss_2458"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk0NTg2ODQw", "url": "https://github.com/fabric8io/kubernetes-client/pull/2487#pullrequestreview-494586840", "createdAt": "2020-09-23T12:06:34Z", "commit": {"oid": "6b20cb70eff324962d9e58b5d4c77f6642671894"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk1NDE0MDMz", "url": "https://github.com/fabric8io/kubernetes-client/pull/2487#pullrequestreview-495414033", "createdAt": "2020-09-24T10:05:25Z", "commit": {"oid": "6b20cb70eff324962d9e58b5d4c77f6642671894"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk2MjczMjk3", "url": "https://github.com/fabric8io/kubernetes-client/pull/2487#pullrequestreview-496273297", "createdAt": "2020-09-25T09:47:43Z", "commit": {"oid": "6b20cb70eff324962d9e58b5d4c77f6642671894"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3637, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}