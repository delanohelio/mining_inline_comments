{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTM3MTgyNTE0", "number": 2660, "title": "Fix #2651: SharedInformers should ignore resync on zero resyncPeriod", "bodyText": "Fix #2651\nRefactor Reflector to ignore resync if resyncPeriod is set to zero\nDescription\n\nType of change\n\n\n Bug fix (non-breaking change which fixes an issue)\n Feature (non-breaking change which adds functionality)\n Breaking change (fix or feature that would cause existing functionality to change\n Chore (non-breaking change which doesn't affect codebase;\ntest, version modification, documentation, etc.)\n\nChecklist\n\n Code contributed by me aligns with current project license: Apache 2.0\n I Added CHANGELOG entry regarding this change\n I have implemented unit tests to cover my changes\n I have added/updated the javadocs and other documentation accordingly\n No new bugs, code smells, etc. in SonarCloud report\n I tested my code in Kubernetes\n I tested my code in OpenShift", "createdAt": "2020-12-11T17:26:22Z", "url": "https://github.com/fabric8io/kubernetes-client/pull/2660", "merged": true, "mergeCommit": {"oid": "1d1b39ec3340ee4275806b0e1f3f8b02e9c1130b"}, "closed": true, "closedAt": "2020-12-15T08:49:25Z", "author": {"login": "rohanKanojia"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdmAEtVAFqTU1MTA4MzE2Mw==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdmDK81AFqTU1MTIzNDE4MQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUxMDgzMTYz", "url": "https://github.com/fabric8io/kubernetes-client/pull/2660#pullrequestreview-551083163", "createdAt": "2020-12-14T06:51:29Z", "commit": {"oid": "6f3d9ec7da126fb5b2209607fc4974c2f0ad2421"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNFQwNjo1MToyOVrOIFCKrw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNFQwNjo1MToyOVrOIFCKrw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjE0OTI5NQ==", "bodyText": "Is this ever not a Executors.newSingleThreadScheduledExecutor() ?", "url": "https://github.com/fabric8io/kubernetes-client/pull/2660#discussion_r542149295", "createdAt": "2020-12-14T06:51:29Z", "author": {"login": "manusa"}, "path": "kubernetes-client/src/main/java/io/fabric8/kubernetes/client/informers/cache/Reflector.java", "diffHunk": "@@ -48,18 +47,18 @@\n   private final AtomicBoolean isWatcherStarted;\n   private final AtomicReference<Watch> watch;\n \n-  public Reflector(Class<T> apiTypeClass, ListerWatcher<T, L> listerWatcher, Store store, OperationContext operationContext, long resyncPeriodMillis) {\n+  public Reflector(Class<T> apiTypeClass, ListerWatcher<T, L> listerWatcher, Store store, OperationContext operationContext, long resyncPeriodMillis, ScheduledExecutorService resyncExecutor) {\n     this.apiTypeClass = apiTypeClass;\n     this.listerWatcher = listerWatcher;\n     this.store = store;\n     this.operationContext = operationContext;\n     this.resyncPeriodMillis = resyncPeriodMillis;\n-    lastSyncResourceVersion = new AtomicReference<>();\n-    resyncExecutor = Executors.newSingleThreadScheduledExecutor();\n-    watcher = new ReflectorWatcher<>(store, lastSyncResourceVersion, this::startWatcher, this::reListAndSync);\n-    isActive = new AtomicBoolean(true);\n-    isWatcherStarted = new AtomicBoolean(false);\n-    watch = new AtomicReference<>(null);\n+    this.lastSyncResourceVersion = new AtomicReference<>();\n+    this.resyncExecutor = resyncExecutor;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6f3d9ec7da126fb5b2209607fc4974c2f0ad2421"}, "originalPosition": 26}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUxMDg3MzUx", "url": "https://github.com/fabric8io/kubernetes-client/pull/2660#pullrequestreview-551087351", "createdAt": "2020-12-14T07:01:19Z", "commit": {"oid": "6f3d9ec7da126fb5b2209607fc4974c2f0ad2421"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNFQwNzowMToxOVrOIFCZuw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNFQwNzowMToxOVrOIFCZuw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjE1MzE0Nw==", "bodyText": "Given the fact that resync period is expected to be positive, maybe we should add a check+IllegalArgumentException here so that users won't remain clueless in case for some reason this class was instantiated directly (not through Controller.java)", "url": "https://github.com/fabric8io/kubernetes-client/pull/2660#discussion_r542153147", "createdAt": "2020-12-14T07:01:19Z", "author": {"login": "manusa"}, "path": "kubernetes-client/src/main/java/io/fabric8/kubernetes/client/informers/cache/Reflector.java", "diffHunk": "@@ -48,18 +47,18 @@\n   private final AtomicBoolean isWatcherStarted;\n   private final AtomicReference<Watch> watch;\n \n-  public Reflector(Class<T> apiTypeClass, ListerWatcher<T, L> listerWatcher, Store store, OperationContext operationContext, long resyncPeriodMillis) {\n+  public Reflector(Class<T> apiTypeClass, ListerWatcher<T, L> listerWatcher, Store store, OperationContext operationContext, long resyncPeriodMillis, ScheduledExecutorService resyncExecutor) {\n     this.apiTypeClass = apiTypeClass;\n     this.listerWatcher = listerWatcher;\n     this.store = store;\n     this.operationContext = operationContext;\n     this.resyncPeriodMillis = resyncPeriodMillis;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6f3d9ec7da126fb5b2209607fc4974c2f0ad2421"}, "originalPosition": 18}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "95b93c3ad38284d44767a7f4b23e61597a052771", "author": {"user": {"login": "rohanKanojia", "name": "Rohan Kumar "}}, "url": "https://github.com/fabric8io/kubernetes-client/commit/95b93c3ad38284d44767a7f4b23e61597a052771", "committedDate": "2020-12-14T10:16:08Z", "message": "Fix #2651: SharedInformers should ignore resync on zero resyncPeriod\n\nRefactor Reflector to ignore resync if resyncPeriod is set to zero"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "adad437b6629b7eb84c86a3cd37d1640935bd699", "author": {"user": {"login": "rohanKanojia", "name": "Rohan Kumar "}}, "url": "https://github.com/fabric8io/kubernetes-client/commit/adad437b6629b7eb84c86a3cd37d1640935bd699", "committedDate": "2020-12-14T10:16:09Z", "message": "Throw IllegalArgumentException on negative resync period instead"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4e61bcd16b72253bbbebd4387c33c8087542fde8", "author": {"user": {"login": "rohanKanojia", "name": "Rohan Kumar "}}, "url": "https://github.com/fabric8io/kubernetes-client/commit/4e61bcd16b72253bbbebd4387c33c8087542fde8", "committedDate": "2020-12-14T10:14:04Z", "message": "Throw IllegalArgumentException on negative resync period instead"}, "afterCommit": {"oid": "adad437b6629b7eb84c86a3cd37d1640935bd699", "author": {"user": {"login": "rohanKanojia", "name": "Rohan Kumar "}}, "url": "https://github.com/fabric8io/kubernetes-client/commit/adad437b6629b7eb84c86a3cd37d1640935bd699", "committedDate": "2020-12-14T10:16:09Z", "message": "Throw IllegalArgumentException on negative resync period instead"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUxMjM0MTgx", "url": "https://github.com/fabric8io/kubernetes-client/pull/2660#pullrequestreview-551234181", "createdAt": "2020-12-14T10:28:02Z", "commit": {"oid": "adad437b6629b7eb84c86a3cd37d1640935bd699"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3563, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}