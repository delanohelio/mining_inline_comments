{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDIwMTQyMjY2", "number": 2239, "title": "Update waitUntilCondition to use a watcher instead of polling.", "bodyText": "There were a couple different implementations of waitUntil*, and this PR unifies all of them on an approach that somewhat mirrors the native go watcher code. I couldn't fully mirror that approach because of the typing we do in the WatchConnectionManager and elsewhere. I think this is a good incremental step towards that, and we can do any necessary refactoring in those manager classes in another PR down the line if necessary.\nWhen you call waitUntilCondition or waitUntilReady, the code will first just try to fetch the item once from the server. If the item matches the condition it returns early. Otherwise it proceeds to create a watcher. Any errors in the watcher will cause a retry, except HTTP_GONE which will propagate. We will retry with backoff until the timeout is met.\nI wanted to make the backoff configurable, so I added the plumbing necessary to support a withWaitRetryBackoff method. It defaults to 5ms initial backoff with 2x exponential backoff growth.\nFixes #2204", "createdAt": "2020-05-19T14:06:36Z", "url": "https://github.com/fabric8io/kubernetes-client/pull/2239", "merged": true, "mergeCommit": {"oid": "15d3ce5d013cffa8223d015cbe9926f20d09b906"}, "closed": true, "closedAt": "2020-05-22T14:10:06Z", "author": {"login": "bbeaudreault"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABci0Js3AH2gAyNDIwMTQyMjY2OjMzNDIyNzkxMmU1MTJmMGRjNTFmNzQ4YmI4ZWY0MDUzYWQwNDczZTg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcjwWSSgH2gAyNDIwMTQyMjY2OjNjMWVmMTgzNDIzNmMxNDZjNGVjMWUzNWJjMWNlZDc3YjdlZTBjZWE=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "334227912e512f0dc51f748bb8ef4053ad0473e8", "author": {"user": {"login": "bbeaudreault", "name": "Bryan Beaudreault"}}, "url": "https://github.com/fabric8io/kubernetes-client/commit/334227912e512f0dc51f748bb8ef4053ad0473e8", "committedDate": "2020-05-19T13:05:10Z", "message": "Update waitUntilCondition to use a watcher instead of polling. All waitUntil* methods should end up calling waitUntilCondition. Retry all exceptions except HTTP_GONE, with backoff"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a72d158926c758b87d5e5bd5ac5ca14192442c7f", "author": {"user": {"login": "bbeaudreault", "name": "Bryan Beaudreault"}}, "url": "https://github.com/fabric8io/kubernetes-client/commit/a72d158926c758b87d5e5bd5ac5ca14192442c7f", "committedDate": "2020-05-19T14:16:08Z", "message": "fix call to match new constructor args"}, "afterCommit": {"oid": "e1cee611b8246f47655f8e27de69dd5cb017365c", "author": {"user": {"login": "bbeaudreault", "name": "Bryan Beaudreault"}}, "url": "https://github.com/fabric8io/kubernetes-client/commit/e1cee611b8246f47655f8e27de69dd5cb017365c", "committedDate": "2020-05-19T14:19:49Z", "message": "remove unnecessary extra interface, add license, fix constructor calls after merge"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fd6d26df9488928c69e1541ef8f7a4d65e7ac228", "author": {"user": {"login": "bbeaudreault", "name": "Bryan Beaudreault"}}, "url": "https://github.com/fabric8io/kubernetes-client/commit/fd6d26df9488928c69e1541ef8f7a4d65e7ac228", "committedDate": "2020-05-19T14:27:49Z", "message": "remove unnecessary extra interface, add license, fix constructor calls after merge"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e1cee611b8246f47655f8e27de69dd5cb017365c", "author": {"user": {"login": "bbeaudreault", "name": "Bryan Beaudreault"}}, "url": "https://github.com/fabric8io/kubernetes-client/commit/e1cee611b8246f47655f8e27de69dd5cb017365c", "committedDate": "2020-05-19T14:19:49Z", "message": "remove unnecessary extra interface, add license, fix constructor calls after merge"}, "afterCommit": {"oid": "fd6d26df9488928c69e1541ef8f7a4d65e7ac228", "author": {"user": {"login": "bbeaudreault", "name": "Bryan Beaudreault"}}, "url": "https://github.com/fabric8io/kubernetes-client/commit/fd6d26df9488928c69e1541ef8f7a4d65e7ac228", "committedDate": "2020-05-19T14:27:49Z", "message": "remove unnecessary extra interface, add license, fix constructor calls after merge"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE0Njg5NzE0", "url": "https://github.com/fabric8io/kubernetes-client/pull/2239#pullrequestreview-414689714", "createdAt": "2020-05-19T17:55:15Z", "commit": {"oid": "fd6d26df9488928c69e1541ef8f7a4d65e7ac228"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE1NjY3NDkz", "url": "https://github.com/fabric8io/kubernetes-client/pull/2239#pullrequestreview-415667493", "createdAt": "2020-05-20T19:55:13Z", "commit": {"oid": "fd6d26df9488928c69e1541ef8f7a4d65e7ac228"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE1ODcwMjcx", "url": "https://github.com/fabric8io/kubernetes-client/pull/2239#pullrequestreview-415870271", "createdAt": "2020-05-21T04:26:52Z", "commit": {"oid": "fd6d26df9488928c69e1541ef8f7a4d65e7ac228"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMVQwNDoyNjo1MlrOGYlyHA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMVQwNDoyNjo1MlrOGYlyHA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODQzODA0NA==", "bodyText": "nit: Could you initialize values with correct primitive type to remove ambiguity\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              long DEFAULT_INITIAL_BACKOFF_MILLIS = 5;\n          \n          \n            \n              double DEFAULT_BACKOFF_MULTIPLIER = 2;\n          \n          \n            \n              long DEFAULT_INITIAL_BACKOFF_MILLIS = 5L;\n          \n          \n            \n              double DEFAULT_BACKOFF_MULTIPLIER = 2d;", "url": "https://github.com/fabric8io/kubernetes-client/pull/2239#discussion_r428438044", "createdAt": "2020-05-21T04:26:52Z", "author": {"login": "manusa"}, "path": "kubernetes-client/src/main/java/io/fabric8/kubernetes/client/dsl/Waitable.java", "diffHunk": "@@ -20,7 +20,19 @@\n \n public interface Waitable<T, P> {\n \n-    T waitUntilReady(long amount, TimeUnit timeUnit) throws InterruptedException;\n+  long DEFAULT_INITIAL_BACKOFF_MILLIS = 5;\n+  double DEFAULT_BACKOFF_MULTIPLIER = 2;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fd6d26df9488928c69e1541ef8f7a4d65e7ac228"}, "originalPosition": 6}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE1ODcyNDc2", "url": "https://github.com/fabric8io/kubernetes-client/pull/2239#pullrequestreview-415872476", "createdAt": "2020-05-21T04:35:53Z", "commit": {"oid": "fd6d26df9488928c69e1541ef8f7a4d65e7ac228"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a8c4d77fa14b8a20a3f13c58c9b295cbdf660e7f", "author": {"user": {"login": "bbeaudreault", "name": "Bryan Beaudreault"}}, "url": "https://github.com/fabric8io/kubernetes-client/commit/a8c4d77fa14b8a20a3f13c58c9b295cbdf660e7f", "committedDate": "2020-05-21T11:28:15Z", "message": "use primitive type in initialization\n\nCo-authored-by: Marc Nuri <marc@marcnuri.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5b0e5309db7c207cb7c0936ac338a3eab59164b0", "author": {"user": {"login": "bbeaudreault", "name": "Bryan Beaudreault"}}, "url": "https://github.com/fabric8io/kubernetes-client/commit/5b0e5309db7c207cb7c0936ac338a3eab59164b0", "committedDate": "2020-05-22T11:10:34Z", "message": "Merge remote-tracking branch 'upstream/master' into watch_for_wait"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3c1ef1834236c146c4ec1e35bc1ced77b7ee0cea", "author": {"user": {"login": "bbeaudreault", "name": "Bryan Beaudreault"}}, "url": "https://github.com/fabric8io/kubernetes-client/commit/3c1ef1834236c146c4ec1e35bc1ced77b7ee0cea", "committedDate": "2020-05-22T11:13:13Z", "message": "fix method ambiguity after merge with master"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3689, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}