{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzYzNjY4Mjg1", "number": 1955, "title": "LeaderElection (client-go) ported implementation", "bodyText": "Description\nPort of the client-go leader election implementation (As requested in #1948)\nIncludes lock implementations for:\n\nConfigMap (core/v1)\nLease (coordination.k8s.io/v1)\n\nUsage\nLeaderExamples.java contains 2 examples of how the leader election implementation can be used.\nSingleThreadExample\n\n  \n    \n      kubernetes-client/kubernetes-examples/src/main/java/io/fabric8/kubernetes/examples/LeaderElectionExamples.java\n    \n    \n        Lines 46 to 67\n      in\n      d2fa731\n    \n    \n    \n    \n\n        \n          \n           public static final class SingleThreadExample { \n        \n\n        \n          \n             public static void main(String[] args) { \n        \n\n        \n          \n               final String lockIdentity = UUID.randomUUID().toString(); \n        \n\n        \n          \n               try (KubernetesClient kc = new DefaultKubernetesClient()) { \n        \n\n        \n          \n                 kc.leaderElector() \n        \n\n        \n          \n                   .withConfig( \n        \n\n        \n          \n                     new LeaderElectionConfigBuilder() \n        \n\n        \n          \n                       .withName(\"Sample Leader Election configuration\") \n        \n\n        \n          \n                       .withLeaseDuration(Duration.ofSeconds(15L)) \n        \n\n        \n          \n                       .withLock(new LeaseLock(NAMESPACE, NAME, lockIdentity)) \n        \n\n        \n          \n                       .withRenewDeadline(Duration.ofSeconds(10L)) \n        \n\n        \n          \n                       .withRetryPeriod(Duration.ofSeconds(2L)) \n        \n\n        \n          \n                       .withLeaderCallbacks(new LeaderCallbacks( \n        \n\n        \n          \n                         () -> System.out.println(\"STARTED LEADERSHIP\"), \n        \n\n        \n          \n                         () -> System.out.println(\"STOPPED LEADERSHIP\"), \n        \n\n        \n          \n                         newLeader -> System.out.printf(\"New leader elected %s\\n\", newLeader) \n        \n\n        \n          \n                       )) \n        \n\n        \n          \n                       .build()) \n        \n\n        \n          \n                   .build().run(); \n        \n\n        \n          \n               } \n        \n\n        \n          \n             } \n        \n\n        \n          \n           } \n        \n    \n  \n\n\nSimple example that highlights how to create a configuration and launch an election process.\nConcurrentExample\n\n  \n    \n      kubernetes-client/kubernetes-examples/src/main/java/io/fabric8/kubernetes/examples/LeaderElectionExamples.java\n    \n    \n         Line 69\n      in\n      d2fa731\n    \n    \n    \n    \n\n        \n          \n           public static final class ConcurrentExample { \n        \n    \n  \n\n\nThis example will launch 100 concurrent identical threads and will start killing leaders some time after they are elected. Each time a leader thread is killed, a new leader will be elected and synchronized using the LeaderElection implementation.\nThe example accepts an argument indicating the type of lock to use configmap or lease.\nThe example can also be launched through Maven:\nmvn exec:java -Pleader-election -pl kubernetes-examples\n\nAdditional work\nThis PR includes a refactor of the go generator to be able to include classes with a same name that belong to different packages.\nA fix for Lease API automagic implementation is also included so that it actually works with Java time API classes", "createdAt": "2020-01-16T14:16:41Z", "url": "https://github.com/fabric8io/kubernetes-client/pull/1955", "merged": true, "mergeCommit": {"oid": "6d83d41d50941bf8f2d4e0c859951eb10f617df6"}, "closed": true, "closedAt": "2020-02-03T12:32:00Z", "author": {"login": "manusa"}, "timelineItems": {"totalCount": 22, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb7HwBdgBqjI5NTY5NDEyNTA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcAr5cwgFqTM1MjIxMDgyMg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0a087ebd4919652e807bdbc3f27a3b0513ac857d", "author": {"user": {"login": "manusa", "name": "Marc Nuri"}}, "url": "https://github.com/fabric8io/kubernetes-client/commit/0a087ebd4919652e807bdbc3f27a3b0513ac857d", "committedDate": "2020-01-16T14:15:00Z", "message": "WIP: Kubernetes-model compiles without modifying WatchEvent"}, "afterCommit": {"oid": "3e2c86e9f6dc8285c4f5f802c8f58600429527a6", "author": {"user": {"login": "manusa", "name": "Marc Nuri"}}, "url": "https://github.com/fabric8io/kubernetes-client/commit/3e2c86e9f6dc8285c4f5f802c8f58600429527a6", "committedDate": "2020-01-17T05:17:50Z", "message": "WIP: Kubernetes-model compiles without modifying WatchEvent"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ0Nzk1NDE0", "url": "https://github.com/fabric8io/kubernetes-client/pull/1955#pullrequestreview-344795414", "createdAt": "2020-01-17T19:31:17Z", "commit": {"oid": "17b11db330b8e7224fb4185f411b6b366da75ea4"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "cefce443b3ea804dbc0cc16c1589ab456d9f8787", "author": {"user": {"login": "manusa", "name": "Marc Nuri"}}, "url": "https://github.com/fabric8io/kubernetes-client/commit/cefce443b3ea804dbc0cc16c1589ab456d9f8787", "committedDate": "2020-01-21T12:30:10Z", "message": "wip: Implemented ConfigMapLock and working examples"}, "afterCommit": {"oid": "115b401bf8233b5e16900f3eee3865bb3c804e03", "author": {"user": {"login": "manusa", "name": "Marc Nuri"}}, "url": "https://github.com/fabric8io/kubernetes-client/commit/115b401bf8233b5e16900f3eee3865bb3c804e03", "committedDate": "2020-01-21T15:38:23Z", "message": "wip: LeaderElection, ConfigMapLock and working examples"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "115b401bf8233b5e16900f3eee3865bb3c804e03", "author": {"user": {"login": "manusa", "name": "Marc Nuri"}}, "url": "https://github.com/fabric8io/kubernetes-client/commit/115b401bf8233b5e16900f3eee3865bb3c804e03", "committedDate": "2020-01-21T15:38:23Z", "message": "wip: LeaderElection, ConfigMapLock and working examples"}, "afterCommit": {"oid": "42a65c9d0b0fbccd67888e99b83cbf3af26c3669", "author": {"user": {"login": "manusa", "name": "Marc Nuri"}}, "url": "https://github.com/fabric8io/kubernetes-client/commit/42a65c9d0b0fbccd67888e99b83cbf3af26c3669", "committedDate": "2020-01-21T15:42:44Z", "message": "wip: LeaderElection, ConfigMapLock and working examples"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b023e627c8ffcd01105668f710802bb8f34cd96b", "author": {"user": {"login": "manusa", "name": "Marc Nuri"}}, "url": "https://github.com/fabric8io/kubernetes-client/commit/b023e627c8ffcd01105668f710802bb8f34cd96b", "committedDate": "2020-01-21T16:25:59Z", "message": "wip: Pseudo-Integration test"}, "afterCommit": {"oid": "71b43386e946770a5e422d36c648852b3e73f5e5", "author": {"user": {"login": "manusa", "name": "Marc Nuri"}}, "url": "https://github.com/fabric8io/kubernetes-client/commit/71b43386e946770a5e422d36c648852b3e73f5e5", "committedDate": "2020-01-21T16:27:48Z", "message": "wip: Pseudo-Integration test"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "71b43386e946770a5e422d36c648852b3e73f5e5", "author": {"user": {"login": "manusa", "name": "Marc Nuri"}}, "url": "https://github.com/fabric8io/kubernetes-client/commit/71b43386e946770a5e422d36c648852b3e73f5e5", "committedDate": "2020-01-21T16:27:48Z", "message": "wip: Pseudo-Integration test"}, "afterCommit": {"oid": "f7bca94ab16b39fd4b7c68c74caafdd24f98c2e3", "author": {"user": {"login": "manusa", "name": "Marc Nuri"}}, "url": "https://github.com/fabric8io/kubernetes-client/commit/f7bca94ab16b39fd4b7c68c74caafdd24f98c2e3", "committedDate": "2020-01-21T16:29:44Z", "message": "wip: Pseudo-Integration test"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4d79d6297ac81d3a7c766c6a04a540d483fb0e7b", "author": {"user": {"login": "manusa", "name": "Marc Nuri"}}, "url": "https://github.com/fabric8io/kubernetes-client/commit/4d79d6297ac81d3a7c766c6a04a540d483fb0e7b", "committedDate": "2020-01-23T11:36:31Z", "message": "wip: LeaderElector code coverage"}, "afterCommit": {"oid": "fbaf13a60b84eb248c04197bbc2b93c9ec764df2", "author": {"user": {"login": "manusa", "name": "Marc Nuri"}}, "url": "https://github.com/fabric8io/kubernetes-client/commit/fbaf13a60b84eb248c04197bbc2b93c9ec764df2", "committedDate": "2020-01-23T11:42:14Z", "message": "wip: LeaderElection, ConfigMapLock, tests, examples"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "fbaf13a60b84eb248c04197bbc2b93c9ec764df2", "author": {"user": {"login": "manusa", "name": "Marc Nuri"}}, "url": "https://github.com/fabric8io/kubernetes-client/commit/fbaf13a60b84eb248c04197bbc2b93c9ec764df2", "committedDate": "2020-01-23T11:42:14Z", "message": "wip: LeaderElection, ConfigMapLock, tests, examples"}, "afterCommit": {"oid": "5f96f1654b4e503c2a566b9c71b97d3b7aa54bc6", "author": {"user": {"login": "manusa", "name": "Marc Nuri"}}, "url": "https://github.com/fabric8io/kubernetes-client/commit/5f96f1654b4e503c2a566b9c71b97d3b7aa54bc6", "committedDate": "2020-01-23T14:48:17Z", "message": "wip: LeaderElection, ConfigMapLock, tests, examples"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "1c40d2cbd7be4dd754dccf777134959144d87022", "author": {"user": {"login": "manusa", "name": "Marc Nuri"}}, "url": "https://github.com/fabric8io/kubernetes-client/commit/1c40d2cbd7be4dd754dccf777134959144d87022", "committedDate": "2020-01-24T10:10:56Z", "message": "wip: LeaseLock implementation complete"}, "afterCommit": {"oid": "a87bb36a08a5258b5ccaac5e806ffd0901fe8cae", "author": {"user": {"login": "manusa", "name": "Marc Nuri"}}, "url": "https://github.com/fabric8io/kubernetes-client/commit/a87bb36a08a5258b5ccaac5e806ffd0901fe8cae", "committedDate": "2020-01-24T10:20:23Z", "message": "wip: LeaseLock implementation complete"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a87bb36a08a5258b5ccaac5e806ffd0901fe8cae", "author": {"user": {"login": "manusa", "name": "Marc Nuri"}}, "url": "https://github.com/fabric8io/kubernetes-client/commit/a87bb36a08a5258b5ccaac5e806ffd0901fe8cae", "committedDate": "2020-01-24T10:20:23Z", "message": "wip: LeaseLock implementation complete"}, "afterCommit": {"oid": "8ecadc4cb6c117eda45c5e5da9dc79cc0b4bfb4d", "author": {"user": {"login": "manusa", "name": "Marc Nuri"}}, "url": "https://github.com/fabric8io/kubernetes-client/commit/8ecadc4cb6c117eda45c5e5da9dc79cc0b4bfb4d", "committedDate": "2020-01-24T10:24:00Z", "message": "wip: LeaseLock implementation complete"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "8ecadc4cb6c117eda45c5e5da9dc79cc0b4bfb4d", "author": {"user": {"login": "manusa", "name": "Marc Nuri"}}, "url": "https://github.com/fabric8io/kubernetes-client/commit/8ecadc4cb6c117eda45c5e5da9dc79cc0b4bfb4d", "committedDate": "2020-01-24T10:24:00Z", "message": "wip: LeaseLock implementation complete"}, "afterCommit": {"oid": "8637f30d1a29c69cb8394f4ea3d3fcdf0531f086", "author": {"user": {"login": "manusa", "name": "Marc Nuri"}}, "url": "https://github.com/fabric8io/kubernetes-client/commit/8637f30d1a29c69cb8394f4ea3d3fcdf0531f086", "committedDate": "2020-01-24T11:03:30Z", "message": "wip: LeaseLock implementation complete"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "8637f30d1a29c69cb8394f4ea3d3fcdf0531f086", "author": {"user": {"login": "manusa", "name": "Marc Nuri"}}, "url": "https://github.com/fabric8io/kubernetes-client/commit/8637f30d1a29c69cb8394f4ea3d3fcdf0531f086", "committedDate": "2020-01-24T11:03:30Z", "message": "wip: LeaseLock implementation complete"}, "afterCommit": {"oid": "4cfc156e70d4c2ad5aa09b02fec11310e166759a", "author": {"user": {"login": "manusa", "name": "Marc Nuri"}}, "url": "https://github.com/fabric8io/kubernetes-client/commit/4cfc156e70d4c2ad5aa09b02fec11310e166759a", "committedDate": "2020-01-24T12:37:29Z", "message": "wip: LeaseLock implementation complete"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4cfc156e70d4c2ad5aa09b02fec11310e166759a", "author": {"user": {"login": "manusa", "name": "Marc Nuri"}}, "url": "https://github.com/fabric8io/kubernetes-client/commit/4cfc156e70d4c2ad5aa09b02fec11310e166759a", "committedDate": "2020-01-24T12:37:29Z", "message": "wip: LeaseLock implementation complete"}, "afterCommit": {"oid": "bef6478cedbb20ba9488b4a76cea339624d9e98a", "author": {"user": {"login": "manusa", "name": "Marc Nuri"}}, "url": "https://github.com/fabric8io/kubernetes-client/commit/bef6478cedbb20ba9488b4a76cea339624d9e98a", "committedDate": "2020-01-24T15:35:54Z", "message": "wip: LeaderElection, ConfigMapLock, LeaseLock, tests, examples"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "bef6478cedbb20ba9488b4a76cea339624d9e98a", "author": {"user": {"login": "manusa", "name": "Marc Nuri"}}, "url": "https://github.com/fabric8io/kubernetes-client/commit/bef6478cedbb20ba9488b4a76cea339624d9e98a", "committedDate": "2020-01-24T15:35:54Z", "message": "wip: LeaderElection, ConfigMapLock, LeaseLock, tests, examples"}, "afterCommit": {"oid": "d2fa731d62e1d09bc69d0a9ed078602998223998", "author": {"user": {"login": "manusa", "name": "Marc Nuri"}}, "url": "https://github.com/fabric8io/kubernetes-client/commit/d2fa731d62e1d09bc69d0a9ed078602998223998", "committedDate": "2020-01-24T15:49:36Z", "message": "wip: LeaderElection, ConfigMapLock, LeaseLock, tests, examples"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d2fa731d62e1d09bc69d0a9ed078602998223998", "author": {"user": {"login": "manusa", "name": "Marc Nuri"}}, "url": "https://github.com/fabric8io/kubernetes-client/commit/d2fa731d62e1d09bc69d0a9ed078602998223998", "committedDate": "2020-01-24T15:49:36Z", "message": "wip: LeaderElection, ConfigMapLock, LeaseLock, tests, examples"}, "afterCommit": {"oid": "a4b9eeac5ffdc5bd3034436b60dc0754d6a7cb68", "author": {"user": {"login": "manusa", "name": "Marc Nuri"}}, "url": "https://github.com/fabric8io/kubernetes-client/commit/a4b9eeac5ffdc5bd3034436b60dc0754d6a7cb68", "committedDate": "2020-01-24T16:30:35Z", "message": "feat: #1948 LeaderElection, ConfigMapLock, LeaseLock, tests, examples"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ5OTQ4MTM3", "url": "https://github.com/fabric8io/kubernetes-client/pull/1955#pullrequestreview-349948137", "createdAt": "2020-01-29T09:02:13Z", "commit": {"oid": "76db16cd18855b9e349fda6b00babb06535967ab"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOVQwOTowMjoxNFrOFjA6Eg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOVQwOTowMjoxNFrOFjA6Eg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjI1OTM0Ng==", "bodyText": "Shouldn't it be in 4.7-SNAPSHOT section?", "url": "https://github.com/fabric8io/kubernetes-client/pull/1955#discussion_r372259346", "createdAt": "2020-01-29T09:02:14Z", "author": {"login": "rohanKanojia"}, "path": "CHANGELOG.md", "diffHunk": "@@ -27,6 +27,7 @@\n \n #### New Features\n * Fix #1917: Allow user to add custom Headers to client\n+* Fix #1948: LeaderElection Implementation (Lock Implementations: ConfigMap & Lease)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "76db16cd18855b9e349fda6b00babb06535967ab"}, "originalPosition": 4}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "76db16cd18855b9e349fda6b00babb06535967ab", "author": {"user": {"login": "manusa", "name": "Marc Nuri"}}, "url": "https://github.com/fabric8io/kubernetes-client/commit/76db16cd18855b9e349fda6b00babb06535967ab", "committedDate": "2020-01-29T08:59:57Z", "message": "Merge branch 'master' into feature/leaderelection-go"}, "afterCommit": {"oid": "a4b9eeac5ffdc5bd3034436b60dc0754d6a7cb68", "author": {"user": {"login": "manusa", "name": "Marc Nuri"}}, "url": "https://github.com/fabric8io/kubernetes-client/commit/a4b9eeac5ffdc5bd3034436b60dc0754d6a7cb68", "committedDate": "2020-01-24T16:30:35Z", "message": "feat: #1948 LeaderElection, ConfigMapLock, LeaseLock, tests, examples"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a4e68a51a6f02fd52ebd1e909c304a85d4f4dd1f", "author": {"user": {"login": "manusa", "name": "Marc Nuri"}}, "url": "https://github.com/fabric8io/kubernetes-client/commit/a4e68a51a6f02fd52ebd1e909c304a85d4f4dd1f", "committedDate": "2020-01-29T10:50:14Z", "message": "refactor: Kubernetes-model go generator support for classes with same name"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "33684dbe257a986265d5857b37233a183a382732", "author": {"user": {"login": "manusa", "name": "Marc Nuri"}}, "url": "https://github.com/fabric8io/kubernetes-client/commit/33684dbe257a986265d5857b37233a183a382732", "committedDate": "2020-01-29T10:50:55Z", "message": "feat: #1948 LeaderElection, ConfigMapLock, LeaseLock, tests, examples"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a4b9eeac5ffdc5bd3034436b60dc0754d6a7cb68", "author": {"user": {"login": "manusa", "name": "Marc Nuri"}}, "url": "https://github.com/fabric8io/kubernetes-client/commit/a4b9eeac5ffdc5bd3034436b60dc0754d6a7cb68", "committedDate": "2020-01-24T16:30:35Z", "message": "feat: #1948 LeaderElection, ConfigMapLock, LeaseLock, tests, examples"}, "afterCommit": {"oid": "33684dbe257a986265d5857b37233a183a382732", "author": {"user": {"login": "manusa", "name": "Marc Nuri"}}, "url": "https://github.com/fabric8io/kubernetes-client/commit/33684dbe257a986265d5857b37233a183a382732", "committedDate": "2020-01-29T10:50:55Z", "message": "feat: #1948 LeaderElection, ConfigMapLock, LeaseLock, tests, examples"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUxOTI3ODEx", "url": "https://github.com/fabric8io/kubernetes-client/pull/1955#pullrequestreview-351927811", "createdAt": "2020-02-02T08:54:15Z", "commit": {"oid": "33684dbe257a986265d5857b37233a183a382732"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUyMjEwODIy", "url": "https://github.com/fabric8io/kubernetes-client/pull/1955#pullrequestreview-352210822", "createdAt": "2020-02-03T12:14:45Z", "commit": {"oid": "33684dbe257a986265d5857b37233a183a382732"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3475, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}