{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTMxMTQyMzcz", "number": 2646, "title": "Fix #2510: Yaml containing aliases rejected due to FasterXML bug", "bodyText": "Fix #2510\nModify the way we deserialize Yaml objects. Load them into raw HashMap\nusing SnakeYAML and then use Jackson to convert them to JSON and finally\nthe required object\nDescription\n\nType of change\n\n\n Bug fix (non-breaking change which fixes an issue)\n Feature (non-breaking change which adds functionality)\n Breaking change (fix or feature that would cause existing functionality to change\n Chore (non-breaking change which doesn't affect codebase;\ntest, version modification, documentation, etc.)\n\nChecklist\n\n Code contributed by me aligns with current project license: Apache 2.0\n I Added CHANGELOG entry regarding this change\n I have implemented unit tests to cover my changes\n I have added/updated the javadocs and other documentation accordingly\n No new bugs, code smells, etc. in SonarCloud report\n I tested my code in Kubernetes\n I tested my code in OpenShift", "createdAt": "2020-12-02T16:36:56Z", "url": "https://github.com/fabric8io/kubernetes-client/pull/2646", "merged": true, "mergeCommit": {"oid": "9e548a85cc99c86bad735373d6624d136f70d19c"}, "closed": true, "closedAt": "2020-12-11T11:01:36Z", "author": {"login": "rohanKanojia"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdiRe12AFqTU0MzAzODkwMA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdlEYkEgBqjQwOTkzNTk3NDc=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQzMDM4OTAw", "url": "https://github.com/fabric8io/kubernetes-client/pull/2646#pullrequestreview-543038900", "createdAt": "2020-12-02T16:52:44Z", "commit": {"oid": "8bc94e16081b0301cd1011f78873a7eb0cf52f57"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "8bc94e16081b0301cd1011f78873a7eb0cf52f57", "author": {"user": {"login": "rohanKanojia", "name": "Rohan Kumar "}}, "url": "https://github.com/fabric8io/kubernetes-client/commit/8bc94e16081b0301cd1011f78873a7eb0cf52f57", "committedDate": "2020-12-02T16:30:28Z", "message": "Fix #2510: Yaml containing aliases rejected due to FasterXML bug\n\n+ Fallback to SnakeYAML while deserializing Kubernetes YAML manifests\n+ Refactored SerializationUtils#dumpAsYaml(...) to use SnakeYAML instead\n  of Jackson\n+ Moved `SerializationUtils` to `io.fabric8.kubernetes.client.utils`"}, "afterCommit": {"oid": "db4b6ce919cbcdbfb86cbe388b1c536557cd410d", "author": {"user": {"login": "rohanKanojia", "name": "Rohan Kumar "}}, "url": "https://github.com/fabric8io/kubernetes-client/commit/db4b6ce919cbcdbfb86cbe388b1c536557cd410d", "committedDate": "2020-12-02T17:04:45Z", "message": "Fix #2510: Yaml containing aliases rejected due to FasterXML bug\n\n+ Fallback to SnakeYAML while deserializing Kubernetes YAML manifests\n+ Refactored SerializationUtils#dumpAsYaml(...) to use SnakeYAML instead\n  of Jackson\n+ Moved `SerializationUtils` to `io.fabric8.kubernetes.client.utils`"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ5MDQyMDQ3", "url": "https://github.com/fabric8io/kubernetes-client/pull/2646#pullrequestreview-549042047", "createdAt": "2020-12-10T10:12:00Z", "commit": {"oid": "db4b6ce919cbcdbfb86cbe388b1c536557cd410d"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMFQxMDoxMjowMVrOIDBhtw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMFQxMDoxMjowMVrOIDBhtw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDA0MTY1NQ==", "bodyText": "This class (Yaml) is not thread safe, should be instantiated for each request.\nnit: it's not a mapper either.\nThe field should be removed. See proposed changes in lines 62-64 for the thread-safety issue.", "url": "https://github.com/fabric8io/kubernetes-client/pull/2646#discussion_r540041655", "createdAt": "2020-12-10T10:12:01Z", "author": {"login": "manusa"}, "path": "kubernetes-client/src/main/java/io/fabric8/kubernetes/client/utils/Serialization.java", "diffHunk": "@@ -46,6 +48,7 @@ private Serialization() { }\n     JSON_MAPPER.registerModule(new JavaTimeModule());\n   }\n   private static final ObjectMapper YAML_MAPPER = new ObjectMapper(new YAMLFactory());\n+  private static final Yaml SNAKE_YAML_MAPPER = new Yaml();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "db4b6ce919cbcdbfb86cbe388b1c536557cd410d"}, "originalPosition": 13}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ5MDQyMzg2", "url": "https://github.com/fabric8io/kubernetes-client/pull/2646#pullrequestreview-549042386", "createdAt": "2020-12-10T10:12:26Z", "commit": {"oid": "db4b6ce919cbcdbfb86cbe388b1c536557cd410d"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMFQxMDoxMjoyNlrOIDBjZQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMFQxMDoxMjoyNlrOIDBjZQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDA0MjA4NQ==", "bodyText": "https://github.com/fabric8io/kubernetes-client/pull/2646/files#r540041655\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              public static Yaml snakeYamlMapper() {\n          \n          \n            \n                return SNAKE_YAML_MAPPER;\n          \n          \n            \n              }\n          \n          \n            \n              public static Yaml newSnakeYaml() {\n          \n          \n            \n                return new Yaml();\n          \n          \n            \n              }", "url": "https://github.com/fabric8io/kubernetes-client/pull/2646#discussion_r540042085", "createdAt": "2020-12-10T10:12:26Z", "author": {"login": "manusa"}, "path": "kubernetes-client/src/main/java/io/fabric8/kubernetes/client/utils/Serialization.java", "diffHunk": "@@ -56,6 +59,10 @@ public static ObjectMapper yamlMapper() {\n     return YAML_MAPPER;\n   }\n \n+  public static Yaml snakeYamlMapper() {\n+    return SNAKE_YAML_MAPPER;\n+  }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "db4b6ce919cbcdbfb86cbe388b1c536557cd410d"}, "originalPosition": 23}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "db4b6ce919cbcdbfb86cbe388b1c536557cd410d", "author": {"user": {"login": "rohanKanojia", "name": "Rohan Kumar "}}, "url": "https://github.com/fabric8io/kubernetes-client/commit/db4b6ce919cbcdbfb86cbe388b1c536557cd410d", "committedDate": "2020-12-02T17:04:45Z", "message": "Fix #2510: Yaml containing aliases rejected due to FasterXML bug\n\n+ Fallback to SnakeYAML while deserializing Kubernetes YAML manifests\n+ Refactored SerializationUtils#dumpAsYaml(...) to use SnakeYAML instead\n  of Jackson\n+ Moved `SerializationUtils` to `io.fabric8.kubernetes.client.utils`"}, "afterCommit": {"oid": "a7d65db4c7f0b70bd9efeb2e7918e87419ff208b", "author": {"user": {"login": "rohanKanojia", "name": "Rohan Kumar "}}, "url": "https://github.com/fabric8io/kubernetes-client/commit/a7d65db4c7f0b70bd9efeb2e7918e87419ff208b", "committedDate": "2020-12-11T07:02:29Z", "message": "Fix #2510: Yaml containing aliases rejected due to FasterXML bug\n\nModify the way we deserialize Yaml objects. Load them into raw HashMap\nusing SnakeYAML and then use Jackson to convert them to JSON and finally\nthe required object"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ5ODY4ODE3", "url": "https://github.com/fabric8io/kubernetes-client/pull/2646#pullrequestreview-549868817", "createdAt": "2020-12-11T07:53:33Z", "commit": {"oid": "a7d65db4c7f0b70bd9efeb2e7918e87419ff208b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMVQwNzo1MzozM1rOIDtAXg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMVQwNzo1MzozM1rOIDtAXg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDc1NDAxNA==", "bodyText": "nit: these comments are very redundant", "url": "https://github.com/fabric8io/kubernetes-client/pull/2646#discussion_r540754014", "createdAt": "2020-12-11T07:53:33Z", "author": {"login": "manusa"}, "path": "kubernetes-client/src/main/java/io/fabric8/kubernetes/client/utils/Serialization.java", "diffHunk": "@@ -294,4 +294,21 @@ private static String readSpecFileFromInputStream(InputStream inputStream) {\n       throw new RuntimeException(\"Unable to read InputStream.\" + e);\n     }\n   }\n+\n+  private static <T> T unmarshalYaml(InputStream is, TypeReference<T> type) throws JsonProcessingException {\n+    final Yaml yaml = new Yaml();\n+    // Load YAML into HashMap using SnakeYAML", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a7d65db4c7f0b70bd9efeb2e7918e87419ff208b"}, "originalPosition": 41}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ5ODY4OTE5", "url": "https://github.com/fabric8io/kubernetes-client/pull/2646#pullrequestreview-549868919", "createdAt": "2020-12-11T07:53:45Z", "commit": {"oid": "a7d65db4c7f0b70bd9efeb2e7918e87419ff208b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "db1923b62b44b774077cf5359b0492ab6eda75bb", "author": {"user": {"login": "rohanKanojia", "name": "Rohan Kumar "}}, "url": "https://github.com/fabric8io/kubernetes-client/commit/db1923b62b44b774077cf5359b0492ab6eda75bb", "committedDate": "2020-12-11T09:18:38Z", "message": "Fix #2510: Yaml containing aliases rejected due to FasterXML bug\n\nModify the way we deserialize Yaml objects. Load them into raw HashMap\nusing SnakeYAML and then use Jackson to convert them to JSON and finally\nthe required object"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a7d65db4c7f0b70bd9efeb2e7918e87419ff208b", "author": {"user": {"login": "rohanKanojia", "name": "Rohan Kumar "}}, "url": "https://github.com/fabric8io/kubernetes-client/commit/a7d65db4c7f0b70bd9efeb2e7918e87419ff208b", "committedDate": "2020-12-11T07:02:29Z", "message": "Fix #2510: Yaml containing aliases rejected due to FasterXML bug\n\nModify the way we deserialize Yaml objects. Load them into raw HashMap\nusing SnakeYAML and then use Jackson to convert them to JSON and finally\nthe required object"}, "afterCommit": {"oid": "db1923b62b44b774077cf5359b0492ab6eda75bb", "author": {"user": {"login": "rohanKanojia", "name": "Rohan Kumar "}}, "url": "https://github.com/fabric8io/kubernetes-client/commit/db1923b62b44b774077cf5359b0492ab6eda75bb", "committedDate": "2020-12-11T09:18:38Z", "message": "Fix #2510: Yaml containing aliases rejected due to FasterXML bug\n\nModify the way we deserialize Yaml objects. Load them into raw HashMap\nusing SnakeYAML and then use Jackson to convert them to JSON and finally\nthe required object"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3559, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}