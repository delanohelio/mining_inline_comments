{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTQzNjMzNzUy", "number": 2685, "title": "Add an Integration test for Typed CustomResource support", "bodyText": "Added an Integration test for new improved typed customResources() API whichtests standard operations like create, createOrReplace, get, list, watch, update, updateStatus, delete\nWe had an integration test for custom resources but that was using the raw API. This test should cover most of the use cases with respect to typed api\nDescription\n\nType of change\n\n\n Bug fix (non-breaking change which fixes an issue)\n Feature (non-breaking change which adds functionality)\n Breaking change (fix or feature that would cause existing functionality to change\n Chore (non-breaking change which doesn't affect codebase;\ntest, version modification, documentation, etc.)\n\nChecklist\n\n Code contributed by me aligns with current project license: Apache 2.0\n I Added CHANGELOG entry regarding this change\n I have implemented unit tests to cover my changes\n I have added/updated the javadocs and other documentation accordingly\n No new bugs, code smells, etc. in SonarCloud report\n I tested my code in Kubernetes\n I tested my code in OpenShift", "createdAt": "2020-12-21T17:45:15Z", "url": "https://github.com/fabric8io/kubernetes-client/pull/2685", "merged": true, "mergeCommit": {"oid": "b6e0f7f6f2802d50d485ce7bf1dfec3f6e27e383"}, "closed": true, "closedAt": "2020-12-22T17:16:15Z", "author": {"login": "rohanKanojia"}, "timelineItems": {"totalCount": 14, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdoZu_3AFqTU1NjU2MDI3Ng==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdooaDeAFqTU1Njk5NDQ3NQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU2NTYwMjc2", "url": "https://github.com/fabric8io/kubernetes-client/pull/2685#pullrequestreview-556560276", "createdAt": "2020-12-21T17:53:10Z", "commit": {"oid": "76ec7b0761f770f96be33627e140d69869f6776d"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "76ec7b0761f770f96be33627e140d69869f6776d", "author": {"user": {"login": "rohanKanojia", "name": "Rohan Kumar "}}, "url": "https://github.com/fabric8io/kubernetes-client/commit/76ec7b0761f770f96be33627e140d69869f6776d", "committedDate": "2020-12-21T17:38:09Z", "message": "Add an Integration test for Typed CustomResource support\n\nAdded an Integration test for typed customResources() API which\ntests standard operations like create, createOrReplace, get, list,\nwatch, update, updateStatus, delete"}, "afterCommit": {"oid": "5a496b86fc638caf465254b324785ad4ed818c3f", "author": {"user": {"login": "rohanKanojia", "name": "Rohan Kumar "}}, "url": "https://github.com/fabric8io/kubernetes-client/commit/5a496b86fc638caf465254b324785ad4ed818c3f", "committedDate": "2020-12-21T17:55:29Z", "message": "Add an Integration test for Typed CustomResource support\n\nAdded an Integration test for typed customResources() API which\ntests standard operations like create, createOrReplace, get, list,\nwatch, update, updateStatus, delete"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "5a496b86fc638caf465254b324785ad4ed818c3f", "author": {"user": {"login": "rohanKanojia", "name": "Rohan Kumar "}}, "url": "https://github.com/fabric8io/kubernetes-client/commit/5a496b86fc638caf465254b324785ad4ed818c3f", "committedDate": "2020-12-21T17:55:29Z", "message": "Add an Integration test for Typed CustomResource support\n\nAdded an Integration test for typed customResources() API which\ntests standard operations like create, createOrReplace, get, list,\nwatch, update, updateStatus, delete"}, "afterCommit": {"oid": "28add10c644037aafb09cafc301f0a7641dad7c5", "author": {"user": {"login": "rohanKanojia", "name": "Rohan Kumar "}}, "url": "https://github.com/fabric8io/kubernetes-client/commit/28add10c644037aafb09cafc301f0a7641dad7c5", "committedDate": "2020-12-21T17:57:28Z", "message": "Add an Integration test for Typed CustomResource support\n\nAdded an Integration test for typed customResources() API which\ntests standard operations like create, createOrReplace, get, list,\nwatch, update, updateStatus, delete"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU2ODU3MDU5", "url": "https://github.com/fabric8io/kubernetes-client/pull/2685#pullrequestreview-556857059", "createdAt": "2020-12-22T06:55:11Z", "commit": {"oid": "28add10c644037aafb09cafc301f0a7641dad7c5"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMlQwNjo1NToxMVrOIJwZ9A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMlQwNjo1NToxMVrOIJwZ9A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzEwMTE3Mg==", "bodyText": "Not necessary", "url": "https://github.com/fabric8io/kubernetes-client/pull/2685#discussion_r547101172", "createdAt": "2020-12-22T06:55:11Z", "author": {"login": "manusa"}, "path": "kubernetes-itests/src/test/java/io/fabric8/crd/PetSpec.java", "diffHunk": "@@ -0,0 +1,42 @@\n+/**\n+ * Copyright (C) 2015 Red Hat, Inc.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *         http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package io.fabric8.crd;\n+\n+import com.fasterxml.jackson.databind.JsonDeserializer;\n+import com.fasterxml.jackson.databind.annotation.JsonDeserialize;\n+import io.fabric8.kubernetes.api.model.KubernetesResource;\n+\n+@JsonDeserialize(\n+  using = JsonDeserializer.None.class\n+)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "28add10c644037aafb09cafc301f0a7641dad7c5"}, "originalPosition": 24}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU2ODU3MTc3", "url": "https://github.com/fabric8io/kubernetes-client/pull/2685#pullrequestreview-556857177", "createdAt": "2020-12-22T06:55:28Z", "commit": {"oid": "28add10c644037aafb09cafc301f0a7641dad7c5"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMlQwNjo1NToyOFrOIJwaQA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMlQwNjo1NToyOFrOIJwaQA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzEwMTI0OA==", "bodyText": "Don't implement KubernetesResource (unless there is a strong reason to)", "url": "https://github.com/fabric8io/kubernetes-client/pull/2685#discussion_r547101248", "createdAt": "2020-12-22T06:55:28Z", "author": {"login": "manusa"}, "path": "kubernetes-itests/src/test/java/io/fabric8/crd/PetSpec.java", "diffHunk": "@@ -0,0 +1,42 @@\n+/**\n+ * Copyright (C) 2015 Red Hat, Inc.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *         http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package io.fabric8.crd;\n+\n+import com.fasterxml.jackson.databind.JsonDeserializer;\n+import com.fasterxml.jackson.databind.annotation.JsonDeserialize;\n+import io.fabric8.kubernetes.api.model.KubernetesResource;\n+\n+@JsonDeserialize(\n+  using = JsonDeserializer.None.class\n+)\n+public class PetSpec implements KubernetesResource {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "28add10c644037aafb09cafc301f0a7641dad7c5"}, "originalPosition": 25}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU2ODU3MzQy", "url": "https://github.com/fabric8io/kubernetes-client/pull/2685#pullrequestreview-556857342", "createdAt": "2020-12-22T06:55:51Z", "commit": {"oid": "28add10c644037aafb09cafc301f0a7641dad7c5"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMlQwNjo1NTo1MVrOIJwaxQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMlQwNjo1NTo1MVrOIJwaxQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzEwMTM4MQ==", "bodyText": "Same as with spec, remove deserializer config and don't implement KubernetesResource", "url": "https://github.com/fabric8io/kubernetes-client/pull/2685#discussion_r547101381", "createdAt": "2020-12-22T06:55:51Z", "author": {"login": "manusa"}, "path": "kubernetes-itests/src/test/java/io/fabric8/crd/PetStatus.java", "diffHunk": "@@ -0,0 +1,41 @@\n+/**\n+ * Copyright (C) 2015 Red Hat, Inc.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *         http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package io.fabric8.crd;\n+\n+import com.fasterxml.jackson.databind.JsonDeserializer;\n+import com.fasterxml.jackson.databind.annotation.JsonDeserialize;\n+import io.fabric8.kubernetes.api.model.KubernetesResource;\n+\n+@JsonDeserialize(\n+  using = JsonDeserializer.None.class\n+)\n+public class PetStatus implements KubernetesResource {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "28add10c644037aafb09cafc301f0a7641dad7c5"}, "originalPosition": 25}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU2ODYxNjQz", "url": "https://github.com/fabric8io/kubernetes-client/pull/2685#pullrequestreview-556861643", "createdAt": "2020-12-22T07:06:23Z", "commit": {"oid": "28add10c644037aafb09cafc301f0a7641dad7c5"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMlQwNzowNjoyM1rOIJwosQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMlQwNzowNjoyM1rOIJwosQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzEwNDk0NQ==", "bodyText": "Why don't we declare the CRD using Java instead?\nI really think we should push our users to think in Java instead of YAML.\nIt works against us to mix unnecessary YAMLs, this sends the wrong message. I've seen this in many of the open issues when users post examples of infrastructure defined in YAML resources and then pushed to k8s using our client. \"Why are they using YAML in the first place?\".\nWe should really be working our way with our own types and try to send this message: https://www.youtube.com/watch?v=QFn_H_LmMfQ\nThis point should be true for test suites too unless we're either testing serialization/deserialization, or we're actually testing the given k8s resource and we want to prepare it using YAML first (but then that should use other means of deployment aka kubectl).\nFor this case we're testing CRs, so defining the CRD using our Java API should be perfectly fine and IMO preferred.", "url": "https://github.com/fabric8io/kubernetes-client/pull/2685#discussion_r547104945", "createdAt": "2020-12-22T07:06:23Z", "author": {"login": "manusa"}, "path": "kubernetes-itests/src/test/java/io/fabric8/kubernetes/TypedCustomResourceIT.java", "diffHunk": "@@ -0,0 +1,239 @@\n+/**\n+ * Copyright (C) 2015 Red Hat, Inc.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *         http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package io.fabric8.kubernetes;\n+\n+import io.fabric8.commons.AssumingK8sVersionAtLeast;\n+import io.fabric8.commons.ClusterEntity;\n+import io.fabric8.crd.Pet;\n+import io.fabric8.crd.PetSpec;\n+import io.fabric8.crd.PetStatus;\n+import io.fabric8.kubernetes.api.model.KubernetesResourceList;\n+import io.fabric8.kubernetes.api.model.ObjectMetaBuilder;\n+import io.fabric8.kubernetes.client.KubernetesClient;\n+import io.fabric8.kubernetes.client.Watch;\n+import io.fabric8.kubernetes.client.Watcher;\n+import io.fabric8.kubernetes.client.WatcherException;\n+import io.fabric8.kubernetes.client.dsl.MixedOperation;\n+import io.fabric8.kubernetes.client.dsl.Resource;\n+import org.arquillian.cube.kubernetes.api.Session;\n+import org.arquillian.cube.kubernetes.impl.requirement.RequiresKubernetes;\n+import org.arquillian.cube.requirement.ArquillianConditionalRunner;\n+import org.jboss.arquillian.test.api.ArquillianResource;\n+import org.junit.AfterClass;\n+import org.junit.Before;\n+import org.junit.BeforeClass;\n+import org.junit.ClassRule;\n+import org.junit.Test;\n+import org.junit.runner.RunWith;\n+\n+import java.util.Collections;\n+import java.util.concurrent.CountDownLatch;\n+import java.util.concurrent.TimeUnit;\n+\n+import static org.awaitility.Awaitility.await;\n+import static org.junit.Assert.assertEquals;\n+import static org.junit.Assert.assertNotNull;\n+import static org.junit.Assert.assertTrue;\n+\n+@RunWith(ArquillianConditionalRunner.class)\n+@RequiresKubernetes\n+public class TypedCustomResourceIT {\n+  @ArquillianResource\n+  KubernetesClient client;\n+\n+  @ArquillianResource\n+  Session session;\n+\n+  private String currentNamespace;\n+\n+  private MixedOperation<Pet, KubernetesResourceList<Pet>, Resource<Pet>> petClient;\n+\n+  @ClassRule\n+  public static final AssumingK8sVersionAtLeast assumingK8sVersion = new AssumingK8sVersionAtLeast(\"1\", \"16\");\n+\n+  @BeforeClass\n+  public static void init() {\n+    ClusterEntity.apply(TypedCustomResourceIT.class.getResourceAsStream(\"/pet-crd.yml\"));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "28add10c644037aafb09cafc301f0a7641dad7c5"}, "originalPosition": 69}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU2ODYyMDM4", "url": "https://github.com/fabric8io/kubernetes-client/pull/2685#pullrequestreview-556862038", "createdAt": "2020-12-22T07:07:24Z", "commit": {"oid": "28add10c644037aafb09cafc301f0a7641dad7c5"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMlQwNzowNzoyNFrOIJwqBg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMlQwNzowNzoyNFrOIJwqBg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzEwNTI4Ng==", "bodyText": "nit: We are not getting a pet from a store, we are creating a new Pet from scratch createNewPet.", "url": "https://github.com/fabric8io/kubernetes-client/pull/2685#discussion_r547105286", "createdAt": "2020-12-22T07:07:24Z", "author": {"login": "manusa"}, "path": "kubernetes-itests/src/test/java/io/fabric8/kubernetes/TypedCustomResourceIT.java", "diffHunk": "@@ -0,0 +1,239 @@\n+/**\n+ * Copyright (C) 2015 Red Hat, Inc.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *         http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package io.fabric8.kubernetes;\n+\n+import io.fabric8.commons.AssumingK8sVersionAtLeast;\n+import io.fabric8.commons.ClusterEntity;\n+import io.fabric8.crd.Pet;\n+import io.fabric8.crd.PetSpec;\n+import io.fabric8.crd.PetStatus;\n+import io.fabric8.kubernetes.api.model.KubernetesResourceList;\n+import io.fabric8.kubernetes.api.model.ObjectMetaBuilder;\n+import io.fabric8.kubernetes.client.KubernetesClient;\n+import io.fabric8.kubernetes.client.Watch;\n+import io.fabric8.kubernetes.client.Watcher;\n+import io.fabric8.kubernetes.client.WatcherException;\n+import io.fabric8.kubernetes.client.dsl.MixedOperation;\n+import io.fabric8.kubernetes.client.dsl.Resource;\n+import org.arquillian.cube.kubernetes.api.Session;\n+import org.arquillian.cube.kubernetes.impl.requirement.RequiresKubernetes;\n+import org.arquillian.cube.requirement.ArquillianConditionalRunner;\n+import org.jboss.arquillian.test.api.ArquillianResource;\n+import org.junit.AfterClass;\n+import org.junit.Before;\n+import org.junit.BeforeClass;\n+import org.junit.ClassRule;\n+import org.junit.Test;\n+import org.junit.runner.RunWith;\n+\n+import java.util.Collections;\n+import java.util.concurrent.CountDownLatch;\n+import java.util.concurrent.TimeUnit;\n+\n+import static org.awaitility.Awaitility.await;\n+import static org.junit.Assert.assertEquals;\n+import static org.junit.Assert.assertNotNull;\n+import static org.junit.Assert.assertTrue;\n+\n+@RunWith(ArquillianConditionalRunner.class)\n+@RequiresKubernetes\n+public class TypedCustomResourceIT {\n+  @ArquillianResource\n+  KubernetesClient client;\n+\n+  @ArquillianResource\n+  Session session;\n+\n+  private String currentNamespace;\n+\n+  private MixedOperation<Pet, KubernetesResourceList<Pet>, Resource<Pet>> petClient;\n+\n+  @ClassRule\n+  public static final AssumingK8sVersionAtLeast assumingK8sVersion = new AssumingK8sVersionAtLeast(\"1\", \"16\");\n+\n+  @BeforeClass\n+  public static void init() {\n+    ClusterEntity.apply(TypedCustomResourceIT.class.getResourceAsStream(\"/pet-crd.yml\"));\n+  }\n+\n+  @Before\n+  public void initPetClientAndCurrentNamespace() {\n+    petClient = client.customResources(Pet.class);\n+    currentNamespace = session.getNamespace();\n+  }\n+\n+  @Test\n+  public void create() {\n+    // Given\n+    Pet pet = getNewPet(\"pet-create\", \"Dog\", null);\n+\n+    // When\n+    Pet createdPet = petClient.inNamespace(currentNamespace).create(pet);\n+\n+    // Then\n+    assertPet(createdPet, \"pet-create\", \"Dog\", null);\n+  }\n+\n+  @Test\n+  public void createOrReplace() {\n+    // Given\n+    Pet pet = getNewPet(\"pet-createorreplace\", \"Dog\", null);\n+\n+    // When\n+    Pet createdPet = petClient.inNamespace(currentNamespace).create(pet);\n+    createdPet.getSpec().setType(\"Buffalo\");\n+    Pet replacedPet = petClient.inNamespace(currentNamespace).createOrReplace(createdPet);\n+\n+    // Then\n+    assertPet(replacedPet, \"pet-createorreplace\", \"Buffalo\", null);\n+  }\n+\n+  @Test\n+  public void get() {\n+    // Given\n+    Pet pet = getNewPet(\"pet-get\", \"Cow\", null);\n+\n+    // When\n+    petClient.inNamespace(currentNamespace).create(pet);\n+    Pet petFromServer = petClient.inNamespace(currentNamespace).withName(\"pet-get\").get();\n+\n+    // Then\n+    assertPet(petFromServer, \"pet-get\", \"Cow\", null);\n+  }\n+\n+  @Test\n+  public void list() {\n+    // Given\n+    Pet pet = getNewPet(\"pet-list\", \"Parrot\", null);\n+\n+    // When\n+    petClient.inNamespace(currentNamespace).create(pet);\n+    KubernetesResourceList<Pet> petList = petClient.inNamespace(currentNamespace).list();\n+\n+    // Then\n+    assertNotNull(petList);\n+    assertNotNull(petList.getItems());\n+    assertTrue(petList.getItems().size() >= 1);\n+  }\n+\n+  @Test\n+  public void update() {\n+    // Given\n+    Pet pet = getNewPet(\"pet-update\", \"Pigeon\", null);\n+\n+    // When\n+    petClient.inNamespace(currentNamespace).create(pet);\n+    await().atMost(5, TimeUnit.SECONDS)\n+      .until(() -> petClient.inNamespace(currentNamespace).withName(\"pet-update\").get() != null);\n+    Pet updatedPet = petClient.inNamespace(currentNamespace).withName(\"pet-update\").edit(pet1 -> {\n+      pet1.getMetadata().setAnnotations(Collections.singletonMap(\"first\", \"1\"));\n+      return pet1;\n+    });\n+\n+    // Then\n+    assertPet(updatedPet, \"pet-update\", \"Pigeon\", null);\n+    assertNotNull(updatedPet.getMetadata().getAnnotations());\n+    assertEquals(1, updatedPet.getMetadata().getAnnotations().size());\n+    assertEquals(\"1\", updatedPet.getMetadata().getAnnotations().get(\"first\"));\n+  }\n+\n+  @Test\n+  public void updateStatusSubresource() {\n+    // Given\n+    Pet pet = getNewPet(\"pet-updatestatus\", \"Pigeon\", null);\n+    PetStatus petStatusToUpdate = new PetStatus();\n+    petStatusToUpdate.setCurrentStatus(\"Sleeping\");\n+\n+    // When\n+    pet = petClient.inNamespace(currentNamespace).create(pet);\n+    await().atMost(5, TimeUnit.SECONDS)\n+      .until(() -> petClient.inNamespace(currentNamespace).withName(\"pet-updatestatus\").get() != null);\n+    pet.setStatus(petStatusToUpdate);\n+    Pet updatedPet = petClient.inNamespace(currentNamespace).updateStatus(pet);\n+\n+    // Then\n+    assertPet(updatedPet, \"pet-updatestatus\", \"Pigeon\", \"Sleeping\");\n+  }\n+\n+  @Test\n+  public void watch() throws InterruptedException {\n+    // Given\n+    Pet pet = getNewPet(\"pet-watch\", \"Hamster\", null);\n+\n+    // When\n+    CountDownLatch creationEventReceived = new CountDownLatch(1);\n+    Watch petWatch = petClient.inNamespace(currentNamespace).watch(new Watcher<Pet>() {\n+      @Override\n+      public void eventReceived(Action action, Pet resource) {\n+        if (resource.getMetadata().getName().equals(\"pet-watch\")) {\n+          creationEventReceived.countDown();\n+        }\n+      }\n+\n+      @Override\n+      public void onClose(WatcherException cause) { }\n+    });\n+    petClient.inNamespace(currentNamespace).createOrReplace(pet);\n+\n+    // Then\n+    assertTrue(creationEventReceived.await(1, TimeUnit.SECONDS));\n+    petWatch.close();\n+  }\n+\n+  @Test\n+  public void delete() {\n+    // Given\n+    Pet pet = getNewPet(\"pet-delete\", \"Cow\", \"Eating\");\n+\n+    // When\n+    petClient.inNamespace(currentNamespace).create(pet);\n+    Boolean isDeleted = petClient.inNamespace(currentNamespace).withName(\"pet-delete\").delete();\n+\n+    // Then\n+    assertNotNull(isDeleted);\n+    assertTrue(isDeleted);\n+  }\n+\n+  private void assertPet(Pet pet, String name, String type, String currentStatus) {\n+    assertNotNull(pet);\n+    assertEquals(name, pet.getMetadata().getName());\n+    assertEquals(type, pet.getSpec().getType());\n+    if (currentStatus != null) {\n+      assertEquals(currentStatus, pet.getStatus().getCurrentStatus());\n+    }\n+  }\n+\n+  @AfterClass\n+  public static void cleanup() {\n+    ClusterEntity.remove(TypedCustomResourceIT.class.getResourceAsStream(\"/pet-crd.yml\"));\n+  }\n+\n+  private Pet getNewPet(String name, String type, String currentStatus) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "28add10c644037aafb09cafc301f0a7641dad7c5"}, "originalPosition": 224}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1d7f46584005d747c12c4dadf64d893d72b46a08", "author": {"user": {"login": "rohanKanojia", "name": "Rohan Kumar "}}, "url": "https://github.com/fabric8io/kubernetes-client/commit/1d7f46584005d747c12c4dadf64d893d72b46a08", "committedDate": "2020-12-22T07:24:44Z", "message": "Add an Integration test for Typed CustomResource support\n\nAdded an Integration test for typed customResources() API which\ntests standard operations like create, createOrReplace, get, list,\nwatch, update, updateStatus, delete"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "28add10c644037aafb09cafc301f0a7641dad7c5", "author": {"user": {"login": "rohanKanojia", "name": "Rohan Kumar "}}, "url": "https://github.com/fabric8io/kubernetes-client/commit/28add10c644037aafb09cafc301f0a7641dad7c5", "committedDate": "2020-12-21T17:57:28Z", "message": "Add an Integration test for Typed CustomResource support\n\nAdded an Integration test for typed customResources() API which\ntests standard operations like create, createOrReplace, get, list,\nwatch, update, updateStatus, delete"}, "afterCommit": {"oid": "1d7f46584005d747c12c4dadf64d893d72b46a08", "author": {"user": {"login": "rohanKanojia", "name": "Rohan Kumar "}}, "url": "https://github.com/fabric8io/kubernetes-client/commit/1d7f46584005d747c12c4dadf64d893d72b46a08", "committedDate": "2020-12-22T07:24:44Z", "message": "Add an Integration test for Typed CustomResource support\n\nAdded an Integration test for typed customResources() API which\ntests standard operations like create, createOrReplace, get, list,\nwatch, update, updateStatus, delete"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "892ffc188ac07d3eb340337e8531116d2d5404c7", "author": {"user": {"login": "rohanKanojia", "name": "Rohan Kumar "}}, "url": "https://github.com/fabric8io/kubernetes-client/commit/892ffc188ac07d3eb340337e8531116d2d5404c7", "committedDate": "2020-12-22T10:11:27Z", "message": "Use CustomResourceDefinitionBuilder rather thanYaml for applying CRD"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU2OTc5NjE4", "url": "https://github.com/fabric8io/kubernetes-client/pull/2685#pullrequestreview-556979618", "createdAt": "2020-12-22T10:33:14Z", "commit": {"oid": "892ffc188ac07d3eb340337e8531116d2d5404c7"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMlQxMDozMzoxNFrOIJ2X4A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMlQxMDozMzoxNFrOIJ2X4A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzE5ODk0NA==", "bodyText": "Most of the boilerplate can be skipped, see https://github.com/fabric8io/kubernetes-client/blob/22e2e6fe942b9a740812ba2d45968a31e0e045da/kubernetes-examples/src/main/java/io/fabric8/kubernetes/examples/CustomResourceV1Example.java as reference", "url": "https://github.com/fabric8io/kubernetes-client/pull/2685#discussion_r547198944", "createdAt": "2020-12-22T10:33:14Z", "author": {"login": "manusa"}, "path": "kubernetes-itests/src/test/java/io/fabric8/kubernetes/TypedCustomResourceIT.java", "diffHunk": "@@ -59,14 +62,53 @@\n \n   private String currentNamespace;\n \n+  private static final CustomResourceDefinition petCrd = new CustomResourceDefinitionBuilder()\n+    .withNewMetadata().withName(\"pets.testing.fabric8.io\").endMetadata()\n+    .withNewSpec()\n+    .withGroup(\"testing.fabric8.io\")\n+    .addNewVersion()\n+    .withName(\"v1alpha1\")\n+    .withServed(true)\n+    .withStorage(true)\n+    .withNewSubresources()\n+    .withNewStatus().endStatus()\n+    .endSubresources()\n+    .withNewSchema()\n+    .withNewOpenAPIV3Schema()\n+    .withType(\"object\")\n+    .addToProperties(Collections.singletonMap(\"spec\", new JSONSchemaPropsBuilder()\n+      .withType(\"object\")\n+      .withProperties(Collections.singletonMap(\"type\", new JSONSchemaPropsBuilder()\n+        .withType(\"string\")\n+        .build()))\n+      .build()))\n+    .addToProperties(Collections.singletonMap(\"status\", new JSONSchemaPropsBuilder()\n+      .withType(\"object\")\n+      .withProperties(Collections.singletonMap(\"currentStatus\", new JSONSchemaPropsBuilder()\n+        .withType(\"string\")\n+        .build()))\n+      .build()))\n+    .endOpenAPIV3Schema()\n+    .endSchema()\n+    .endVersion()\n+    .withScope(\"Namespaced\")\n+    .withNewNames()\n+    .withPlural(\"pets\")\n+    .withSingular(\"pet\")\n+    .withKind(\"Pet\")\n+    .withShortNames(\"pt\")\n+    .endNames()\n+    .endSpec()\n+    .build();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "892ffc188ac07d3eb340337e8531116d2d5404c7"}, "originalPosition": 51}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "675a1239127aeae8e730306e02f609f9148e7ce3", "author": {"user": {"login": "rohanKanojia", "name": "Rohan Kumar "}}, "url": "https://github.com/fabric8io/kubernetes-client/commit/675a1239127aeae8e730306e02f609f9148e7ce3", "committedDate": "2020-12-22T10:55:25Z", "message": "Infer CRD from CustomResourceDefinitionContext\n\nUse CustomResourceDefinitionContext.v1CRDFromCustomResourceType to get\nCustomResourceDefinition details from POJO annotations"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU2OTk0NDc1", "url": "https://github.com/fabric8io/kubernetes-client/pull/2685#pullrequestreview-556994475", "createdAt": "2020-12-22T10:58:52Z", "commit": {"oid": "675a1239127aeae8e730306e02f609f9148e7ce3"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3584, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}