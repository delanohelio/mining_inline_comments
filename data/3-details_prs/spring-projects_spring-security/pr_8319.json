{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk3OTEyMzIz", "number": 8319, "title": "Add addFilterAfter and addFilterBefore to Kotlin DSL", "bodyText": "Fixes gh-8316", "createdAt": "2020-04-03T03:16:54Z", "url": "https://github.com/spring-projects/spring-security/pull/8319", "merged": true, "mergeCommit": {"oid": "dc6b8ce47027866b86aadbcaba31ed959759da8a"}, "closed": true, "closedAt": "2020-04-03T16:04:04Z", "author": {"login": "mengelbrecht"}, "timelineItems": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcT4I-mAH2gAyMzk3OTEyMzIzOmEyNDEzMzY5ZTgzZGE1Y2U2ZjRmMGU3NTRiNGRhNzZiOWQ4ZTRjMjg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcUCsHlAH2gAyMzk3OTEyMzIzOjk1YWY0ZDFhMTJjMzY3ZmNhYTg5NWQ4M2YxYTkwNTcwNGQ2YTI2YzQ=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "a2413369e83da5ce6f4f0e754b4da76b9d8e4c28", "author": {"user": {"login": "mengelbrecht", "name": "Markus Engelbrecht"}}, "url": "https://github.com/spring-projects/spring-security/commit/a2413369e83da5ce6f4f0e754b4da76b9d8e4c28", "committedDate": "2020-04-03T03:15:08Z", "message": "Add addFilterAfter and addFilterBefore to Kotlin DSL\n\nFixes gh-8316"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg3MzUwMjAx", "url": "https://github.com/spring-projects/spring-security/pull/8319#pullrequestreview-387350201", "createdAt": "2020-04-03T15:17:17Z", "commit": {"oid": "a2413369e83da5ce6f4f0e754b4da76b9d8e4c28"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wM1QxNToxNzoxN1rOGAZ_uw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wM1QxNToxNzoxN1rOGAZ_uw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzA3OTA5OQ==", "bodyText": "It would make sense to move CustomFilter outside of the configuration classes, and into the test class, since it is used in multiple tests.", "url": "https://github.com/spring-projects/spring-security/pull/8319#discussion_r403079099", "createdAt": "2020-04-03T15:17:17Z", "author": {"login": "eleftherias"}, "path": "config/src/test/kotlin/org/springframework/security/config/web/servlet/HttpSecurityDslTests.kt", "diffHunk": "@@ -239,4 +239,56 @@ class HttpSecurityDslTests {\n \n         class CustomFilter : UsernamePasswordAuthenticationFilter()\n     }\n+\n+    @Test\n+    fun `HTTP security when custom filter configured then custom filter added after specific filter to filter chain`() {\n+        this.spring.register(CustomFilterAfterConfig::class.java).autowire()\n+\n+        val filterChain = spring.context.getBean(FilterChainProxy::class.java)\n+        val filters: List<Class<out Filter>> = filterChain.getFilters(\"/\").map { it.javaClass }\n+\n+        assertThat(filters).containsSubsequence(\n+            UsernamePasswordAuthenticationFilter::class.java,\n+            CustomFilterAfterConfig.CustomFilter::class.java\n+        )\n+    }\n+\n+    @EnableWebSecurity\n+    @EnableWebMvc\n+    open class CustomFilterAfterConfig : WebSecurityConfigurerAdapter() {\n+        override fun configure(http: HttpSecurity) {\n+            http {\n+                addFilterAfter(CustomFilter(), UsernamePasswordAuthenticationFilter::class.java)\n+                formLogin {}\n+            }\n+        }\n+\n+        class CustomFilter : UsernamePasswordAuthenticationFilter()\n+    }\n+\n+    @Test\n+    fun `HTTP security when custom filter configured then custom filter added before specific filter to filter chain`() {\n+        this.spring.register(CustomFilterBeforeConfig::class.java).autowire()\n+\n+        val filterChain = spring.context.getBean(FilterChainProxy::class.java)\n+        val filters: List<Class<out Filter>> = filterChain.getFilters(\"/\").map { it.javaClass }\n+\n+        assertThat(filters).containsSubsequence(\n+            CustomFilterBeforeConfig.CustomFilter::class.java,\n+            UsernamePasswordAuthenticationFilter::class.java\n+        )\n+    }\n+\n+    @EnableWebSecurity\n+    @EnableWebMvc\n+    open class CustomFilterBeforeConfig : WebSecurityConfigurerAdapter() {\n+        override fun configure(http: HttpSecurity) {\n+            http {\n+                addFilterBefore(CustomFilter(), UsernamePasswordAuthenticationFilter::class.java)\n+                formLogin {}\n+            }\n+        }\n+\n+        class CustomFilter : UsernamePasswordAuthenticationFilter()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a2413369e83da5ce6f4f0e754b4da76b9d8e4c28"}, "originalPosition": 54}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "95af4d1a12c367fcaa895d83f1a905704d6a26c4", "author": {"user": {"login": "mengelbrecht", "name": "Markus Engelbrecht"}}, "url": "https://github.com/spring-projects/spring-security/commit/95af4d1a12c367fcaa895d83f1a905704d6a26c4", "committedDate": "2020-04-03T15:32:34Z", "message": "Move CustomFilter outside of the configuration classes to enable reuse"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 40, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}