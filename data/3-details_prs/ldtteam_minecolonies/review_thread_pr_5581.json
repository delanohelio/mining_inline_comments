{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY4MjIyODQz", "number": 5581, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xNVQxNjowOToyOFrOEYuKnA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xNlQxMDowNToyMFrOEYyeJg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk0MzU3NjYwOnYy", "diffSide": "RIGHT", "path": "src/main/resources/assets/minecolonies/lang/en_us.json", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xNVQxNjowOToyOFrOHBMJpg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xNVQxNjowOToyOFrOHBMJpg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTAwOTcwMg==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              \"com.minecolonies.coremod.crafters.recipeimproved.1\": \"%4$s just successfully reducing the need for %3$s when they are making %2$s\",\n          \n          \n            \n              \"com.minecolonies.coremod.crafters.recipeimproved.1\": \"%4$s just successfully reduced the need for %3$s when they make %2$s.\",", "url": "https://github.com/ldtteam/minecolonies/pull/5581#discussion_r471009702", "createdAt": "2020-08-15T16:09:28Z", "author": {"login": "ravenbuilder934"}, "path": "src/main/resources/assets/minecolonies/lang/en_us.json", "diffHunk": "@@ -1602,7 +1602,10 @@\n   \"com.minecolonies.coremod.university.researchconcluded.0\": \"Your researchers just successfully concluded: %s\",\n   \"com.minecolonies.coremod.university.researchconcluded.1\": \"The researchers in your colony just unravelled the mystery of: %s\",\n   \"com.minecolonies.coremod.university.researchconcluded.2\": \"The Research about %s was successfully demystified by your researchers\",\n-\n+  \"com.minecolonies.coremod.crafters.recipeimproved.0\": \"Your %s just successfully improved their recipe for %s by reducing the need for %s\",\n+  \"com.minecolonies.coremod.crafters.recipeimproved.1\": \"%4$s just successfully reducing the need for %3$s when they are making %2$s\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2cb3d4d6dd31f0a1ab2dd1e5272419dfe6acb660"}, "originalPosition": 6}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk0MzU3NzM2OnYy", "diffSide": "RIGHT", "path": "src/main/resources/assets/minecolonies/lang/en_us.json", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xNVQxNjoxMDoyN1rOHBMJ_Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xNVQxNjoxMDoyN1rOHBMJ_Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTAwOTc4OQ==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              \"com.minecolonies.coremod.crafters.recipeimproved.0\": \"Your %s just successfully improved their recipe for %s by reducing the need for %s\",\n          \n          \n            \n              \"com.minecolonies.coremod.crafters.recipeimproved.0\": \"Your %s just successfully improved their recipe for %s by reducing the need for %s.\",", "url": "https://github.com/ldtteam/minecolonies/pull/5581#discussion_r471009789", "createdAt": "2020-08-15T16:10:27Z", "author": {"login": "ravenbuilder934"}, "path": "src/main/resources/assets/minecolonies/lang/en_us.json", "diffHunk": "@@ -1602,7 +1602,10 @@\n   \"com.minecolonies.coremod.university.researchconcluded.0\": \"Your researchers just successfully concluded: %s\",\n   \"com.minecolonies.coremod.university.researchconcluded.1\": \"The researchers in your colony just unravelled the mystery of: %s\",\n   \"com.minecolonies.coremod.university.researchconcluded.2\": \"The Research about %s was successfully demystified by your researchers\",\n-\n+  \"com.minecolonies.coremod.crafters.recipeimproved.0\": \"Your %s just successfully improved their recipe for %s by reducing the need for %s\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2cb3d4d6dd31f0a1ab2dd1e5272419dfe6acb660"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk0NDI4MTk4OnYy", "diffSide": "RIGHT", "path": "src/main/java/com/minecolonies/coremod/colony/buildings/AbstractBuildingWorker.java", "isResolved": true, "comments": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xNlQxMDowNToyMFrOHBRN0w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xNlQxNjo0OToxM1rOHBTuUQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTA5MjY5MQ==", "bodyText": "pretty sure we had a LanguageHandler function to send it to all players, should check that out", "url": "https://github.com/ldtteam/minecolonies/pull/5581#discussion_r471092691", "createdAt": "2020-08-16T10:05:20Z", "author": {"login": "someaddons"}, "path": "src/main/java/com/minecolonies/coremod/colony/buildings/AbstractBuildingWorker.java", "diffHunk": "@@ -343,6 +347,16 @@ public void improveRecipe(IRecipeStorage recipe, int count, ICitizenData citizen\n                     Blocks.AIR);\n \n                 replaceRecipe(recipe.getToken(), IColonyManager.getInstance().getRecipeManager().checkOrAddRecipe(storage));\n+\n+                // Expected parameters for RECIPE_IMPROVED are Job, Result, Ingredient, Citizen\n+                for(PlayerEntity player :colony.getMessagePlayerEntities())", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7ec288f5b28f8a4f525b572ebc7601ea67c6c483"}, "originalPosition": 44}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTEyNTkxNA==", "bodyText": "I did, and it didn't work with the replacements correctly. I looked at the source for it in Structurize, and it looks overly complicated. We probably need to review a bunch of our LanguageHandler stuff, and look at where it makes sense to use MessageFormatter rather than String.format.", "url": "https://github.com/ldtteam/minecolonies/pull/5581#discussion_r471125914", "createdAt": "2020-08-16T15:28:59Z", "author": {"login": "Mekle001"}, "path": "src/main/java/com/minecolonies/coremod/colony/buildings/AbstractBuildingWorker.java", "diffHunk": "@@ -343,6 +347,16 @@ public void improveRecipe(IRecipeStorage recipe, int count, ICitizenData citizen\n                     Blocks.AIR);\n \n                 replaceRecipe(recipe.getToken(), IColonyManager.getInstance().getRecipeManager().checkOrAddRecipe(storage));\n+\n+                // Expected parameters for RECIPE_IMPROVED are Job, Result, Ingredient, Citizen\n+                for(PlayerEntity player :colony.getMessagePlayerEntities())", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTA5MjY5MQ=="}, "originalCommit": {"oid": "7ec288f5b28f8a4f525b572ebc7601ea67c6c483"}, "originalPosition": 44}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTEyODM3MA==", "bodyText": "There should be two versions, one uses string.format, second is the big thing for weird formatting used back in old minecolonies and left for compatibility reasons (tho ray is still using it and I still hadn't got how it works)", "url": "https://github.com/ldtteam/minecolonies/pull/5581#discussion_r471128370", "createdAt": "2020-08-16T15:53:16Z", "author": {"login": "Nightenom"}, "path": "src/main/java/com/minecolonies/coremod/colony/buildings/AbstractBuildingWorker.java", "diffHunk": "@@ -343,6 +347,16 @@ public void improveRecipe(IRecipeStorage recipe, int count, ICitizenData citizen\n                     Blocks.AIR);\n \n                 replaceRecipe(recipe.getToken(), IColonyManager.getInstance().getRecipeManager().checkOrAddRecipe(storage));\n+\n+                // Expected parameters for RECIPE_IMPROVED are Job, Result, Ingredient, Citizen\n+                for(PlayerEntity player :colony.getMessagePlayerEntities())", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTA5MjY5MQ=="}, "originalCommit": {"oid": "7ec288f5b28f8a4f525b572ebc7601ea67c6c483"}, "originalPosition": 44}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTEyODUyMQ==", "bodyText": "also you definitely should reuse the message instead of creating it every time", "url": "https://github.com/ldtteam/minecolonies/pull/5581#discussion_r471128521", "createdAt": "2020-08-16T15:54:32Z", "author": {"login": "Nightenom"}, "path": "src/main/java/com/minecolonies/coremod/colony/buildings/AbstractBuildingWorker.java", "diffHunk": "@@ -343,6 +347,16 @@ public void improveRecipe(IRecipeStorage recipe, int count, ICitizenData citizen\n                     Blocks.AIR);\n \n                 replaceRecipe(recipe.getToken(), IColonyManager.getInstance().getRecipeManager().checkOrAddRecipe(storage));\n+\n+                // Expected parameters for RECIPE_IMPROVED are Job, Result, Ingredient, Citizen\n+                for(PlayerEntity player :colony.getMessagePlayerEntities())", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTA5MjY5MQ=="}, "originalCommit": {"oid": "7ec288f5b28f8a4f525b572ebc7601ea67c6c483"}, "originalPosition": 44}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTEzMDQxNA==", "bodyText": "You should be able to give the Languagehandler version the TranslateableTextComponent", "url": "https://github.com/ldtteam/minecolonies/pull/5581#discussion_r471130414", "createdAt": "2020-08-16T16:13:28Z", "author": {"login": "Raycoms"}, "path": "src/main/java/com/minecolonies/coremod/colony/buildings/AbstractBuildingWorker.java", "diffHunk": "@@ -343,6 +347,16 @@ public void improveRecipe(IRecipeStorage recipe, int count, ICitizenData citizen\n                     Blocks.AIR);\n \n                 replaceRecipe(recipe.getToken(), IColonyManager.getInstance().getRecipeManager().checkOrAddRecipe(storage));\n+\n+                // Expected parameters for RECIPE_IMPROVED are Job, Result, Ingredient, Citizen\n+                for(PlayerEntity player :colony.getMessagePlayerEntities())", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTA5MjY5MQ=="}, "originalCommit": {"oid": "7ec288f5b28f8a4f525b572ebc7601ea67c6c483"}, "originalPosition": 44}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTEzMzAxMA==", "bodyText": "Only one of the functions in LanguageHandler.java takes a player collection, sendPlayersMessage. That's the one that creates a chat component and didn't work correctly.\nsendMessageToPlayer sends to an individual player, by creating a stringTextComponent wrapped around a translateKeyWithFormat, which is a simple string.Format on the resulting key.\nNothing in LanguageHandler takes a ITextComponent as it's only parameter.\nI think what I'm doing here is actually the most correct way to accomplish this (except the message reuse, which I'll fix).  If I use any of the current methods of LanguageHandler, I'm implicitly recreating the message every time anyway.", "url": "https://github.com/ldtteam/minecolonies/pull/5581#discussion_r471133010", "createdAt": "2020-08-16T16:41:29Z", "author": {"login": "Mekle001"}, "path": "src/main/java/com/minecolonies/coremod/colony/buildings/AbstractBuildingWorker.java", "diffHunk": "@@ -343,6 +347,16 @@ public void improveRecipe(IRecipeStorage recipe, int count, ICitizenData citizen\n                     Blocks.AIR);\n \n                 replaceRecipe(recipe.getToken(), IColonyManager.getInstance().getRecipeManager().checkOrAddRecipe(storage));\n+\n+                // Expected parameters for RECIPE_IMPROVED are Job, Result, Ingredient, Citizen\n+                for(PlayerEntity player :colony.getMessagePlayerEntities())", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTA5MjY5MQ=="}, "originalCommit": {"oid": "7ec288f5b28f8a4f525b572ebc7601ea67c6c483"}, "originalPosition": 44}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTEzMzc3Nw==", "bodyText": "To be clear: I believe we need to add this functionality (in several methods) to LanguageHandler, and I will start on that change, once I figure out appropriate naming that doesn't create a prototype that conflicts with what is already there.", "url": "https://github.com/ldtteam/minecolonies/pull/5581#discussion_r471133777", "createdAt": "2020-08-16T16:49:13Z", "author": {"login": "Mekle001"}, "path": "src/main/java/com/minecolonies/coremod/colony/buildings/AbstractBuildingWorker.java", "diffHunk": "@@ -343,6 +347,16 @@ public void improveRecipe(IRecipeStorage recipe, int count, ICitizenData citizen\n                     Blocks.AIR);\n \n                 replaceRecipe(recipe.getToken(), IColonyManager.getInstance().getRecipeManager().checkOrAddRecipe(storage));\n+\n+                // Expected parameters for RECIPE_IMPROVED are Job, Result, Ingredient, Citizen\n+                for(PlayerEntity player :colony.getMessagePlayerEntities())", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTA5MjY5MQ=="}, "originalCommit": {"oid": "7ec288f5b28f8a4f525b572ebc7601ea67c6c483"}, "originalPosition": 44}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3619, "cost": 1, "resetAt": "2021-11-12T20:44:06Z"}}}