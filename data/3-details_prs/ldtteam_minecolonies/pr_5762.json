{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDg1MDQzNDMz", "number": 5762, "title": "Some fixes", "bodyText": "Changes proposed in this pull request:\nFix entity AI active too early, causing a crash\nFix respawning missing checks\nRemove entity respawning at the TH when actually unloaded\nFix can't spawn at messages appearing for unloaded citizens\nReview please", "createdAt": "2020-09-11T12:55:20Z", "url": "https://github.com/ldtteam/minecolonies/pull/5762", "merged": true, "mergeCommit": {"oid": "37de382492d2f7cc130ae333c49732639352f304"}, "closed": true, "closedAt": "2020-09-11T17:06:30Z", "author": {"login": "someaddons"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdH06BwgH2gAyNDg1MDQzNDMzOjdlZDZjYmY1NDdmM2U3NzU0ZmIwOTU2MmIwYTNmYTQ4MDI2NTJkZWI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdH4e0VgFqTQ4NjkxMTYxOQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "7ed6cbf547f3e7754fb09562b0a3fa4802652deb", "author": {"user": {"login": "someaddons", "name": null}}, "url": "https://github.com/ldtteam/minecolonies/commit/7ed6cbf547f3e7754fb09562b0a3fa4802652deb", "committedDate": "2020-09-11T12:53:09Z", "message": "Fix AI initialized too early\nFix respawning missing checks"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg2Nzg4MDg4", "url": "https://github.com/ldtteam/minecolonies/pull/5762#pullrequestreview-486788088", "createdAt": "2020-09-11T13:06:26Z", "commit": {"oid": "7ed6cbf547f3e7754fb09562b0a3fa4802652deb"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMVQxMzowNjoyNlrOHQeDHA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMVQxMzowNjoyNlrOHQeDHA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzAzMTU4MA==", "bodyText": "I'm pretty sure this causes the out of world issues", "url": "https://github.com/ldtteam/minecolonies/pull/5762#discussion_r487031580", "createdAt": "2020-09-11T13:06:26Z", "author": {"login": "Raycoms"}, "path": "src/main/java/com/minecolonies/coremod/colony/VisitorData.java", "diffHunk": "@@ -114,10 +115,14 @@ public void updateEntityIfNecessary()\n     {\n         if (getEntity().isPresent())\n         {\n-            return;\n+            final Entity entity = getEntity().get();\n+            if (entity.isAlive() && entity.addedToChunk && WorldUtil.isEntityBlockLoaded(entity.world, entity.getPosition()))\n+            {\n+                return;\n+            }\n         }\n \n-        if (WorldUtil.isEntityBlockLoaded(getColony().getWorld(), getLastPosition()))\n+        if (getLastPosition() != BlockPos.ZERO && WorldUtil.isEntityBlockLoaded(getColony().getWorld(), getLastPosition()))\n         {\n             getColony().getVisitorManager().spawnOrCreateCivilian(this, getColony().getWorld(), getLastPosition(), true);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7ed6cbf547f3e7754fb09562b0a3fa4802652deb"}, "originalPosition": 23}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e0980ca03f0cd2dd6e34e506926afada04ee8af1", "author": {"user": {"login": "someaddons", "name": null}}, "url": "https://github.com/ldtteam/minecolonies/commit/e0980ca03f0cd2dd6e34e506926afada04ee8af1", "committedDate": "2020-09-11T14:07:05Z", "message": "Remove entity respawning at the TH when actually unloaded\nFix can't spawn at messages appearing for unloaded citizens"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "80ff3e7095518bd31f3fbe32906141f82f35a748", "author": {"user": {"login": "someaddons", "name": null}}, "url": "https://github.com/ldtteam/minecolonies/commit/80ff3e7095518bd31f3fbe32906141f82f35a748", "committedDate": "2020-09-11T14:16:43Z", "message": "improve recall message"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg2OTExNjE5", "url": "https://github.com/ldtteam/minecolonies/pull/5762#pullrequestreview-486911619", "createdAt": "2020-09-11T15:32:50Z", "commit": {"oid": "80ff3e7095518bd31f3fbe32906141f82f35a748"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMVQxNTozMjo1MFrOHQjuOw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMVQxNTozMjo1MFrOHQjuOw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzEyNDUzOQ==", "bodyText": "Why is this cast here?......", "url": "https://github.com/ldtteam/minecolonies/pull/5762#discussion_r487124539", "createdAt": "2020-09-11T15:32:50Z", "author": {"login": "OrionDevelopment"}, "path": "src/main/java/com/minecolonies/coremod/colony/managers/CitizenManager.java", "diffHunk": "@@ -227,35 +226,23 @@ public ICitizenData spawnOrCreateCivilian(@Nullable final ICivilianData data, fi\n             spawnLocation = colony.getBuildingManager().getTownHall().getPosition();\n         }\n \n-\n-        BlockPos calculatedSpawn = null;\n-\n-        if (world.getChunkProvider().isChunkLoaded(new ChunkPos(spawnLocation.getX() >> 4, spawnLocation.getZ() >> 4)))\n-        {\n-            calculatedSpawn = EntityUtils.getSpawnPoint(world, spawnLocation);\n-        }\n-\n-        if (calculatedSpawn == null)\n+        if (WorldUtil.isEntityBlockLoaded(colony.getWorld(), spawnLocation))\n         {\n-            spawnLocation = colony.getBuildingManager().getTownHall().getPosition();\n-            if (world.getChunkProvider().isChunkLoaded(new ChunkPos(spawnLocation.getX() >> 4, spawnLocation.getZ() >> 4)))\n+            final BlockPos calculatedSpawn = EntityUtils.getSpawnPoint(world, spawnLocation);\n+            if (calculatedSpawn != null)\n             {\n-                calculatedSpawn = EntityUtils.getSpawnPoint(world, spawnLocation);\n+                return spawnCitizenOnPosition((ICitizenData) data, world, force, calculatedSpawn);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "80ff3e7095518bd31f3fbe32906141f82f35a748"}, "originalPosition": 43}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1935, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}