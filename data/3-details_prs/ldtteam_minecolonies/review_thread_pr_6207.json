{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTMzMjMxNjE3", "number": 6207, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wNlQxNzoyMzo0NVrOFBe3bA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wNlQxNzoyMzo0NVrOFBe3bA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM3MDk4NjA0OnYy", "diffSide": "RIGHT", "path": "src/main/java/com/minecolonies/coremod/entity/ai/citizen/guard/EntityAIRanger.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wNlQxNzoyMzo0NVrOIANDNA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wNlQxNzozMToyN1rOIANIsQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzA4NDcyNA==", "bodyText": "what is this supposed to do?", "url": "https://github.com/ldtteam/minecolonies/pull/6207#discussion_r537084724", "createdAt": "2020-12-06T17:23:45Z", "author": {"login": "someaddons"}, "path": "src/main/java/com/minecolonies/coremod/entity/ai/citizen/guard/EntityAIRanger.java", "diffHunk": "@@ -553,21 +553,33 @@ private double getAimHeight()\n     @Override\n     public void moveInAttackPosition()\n     {\n-        if (buildingGuards.getTask() == GuardTask.GUARD)\n-        {\n-            ((MinecoloniesAdvancedPathNavigate) worker.getNavigator()).setPathJob(new PathJobCanSee(worker, target, world, buildingGuards.getGuardPos(), 20),\n-              null,\n-              getCombatMovementSpeed());\n-            return;\n-        }\n+        ((MinecoloniesAdvancedPathNavigate) worker.getNavigator()).setPathJob(new PathJobCanSee(worker,\n+            target,\n+            world,\n+            buildingGuards.getGuardPos(), shouldStayCloseToPos()\n+             ? 20 : 40),\n+          null,\n+          getCombatMovementSpeed());\n+    }\n \n-        worker.getNavigator()\n-          .tryMoveToBlockPos(worker.getPosition().offset(BlockPosUtil.getXZFacing(target.getPosition(), worker.getPosition()).getOpposite(), 8), getCombatMovementSpeed());\n+    /**\n+     * If the guard should stick close to the guard/patroll pos.\n+     * @return true if so.\n+     */\n+    private boolean shouldStayCloseToPos()\n+    {\n+        return buildingGuards.getTask() == GuardTask.GUARD || (buildingGuards.getTask() == GuardTask.PATROL && buildingGuards.shallPatrolManually());\n     }\n \n     @Override\n     public void guardMovement()\n     {\n+        if (worker.getRandom().nextInt(3) < 1)\n+        {\n+            worker.isWorkerAtSiteWithMove(buildingGuards.getGuardPos(), 3);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4eb576cc4f91a4c5a86c9471ff748933d39cbc86"}, "originalPosition": 63}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzA4NTQwMA==", "bodyText": "Atm, there is a problem that the archer, stays a very long time, far away from the actual guarding spot. This should balance out that regularly the archer returns to the initial guarding spot and then from there walk a little bit again.", "url": "https://github.com/ldtteam/minecolonies/pull/6207#discussion_r537085400", "createdAt": "2020-12-06T17:27:05Z", "author": {"login": "Raycoms"}, "path": "src/main/java/com/minecolonies/coremod/entity/ai/citizen/guard/EntityAIRanger.java", "diffHunk": "@@ -553,21 +553,33 @@ private double getAimHeight()\n     @Override\n     public void moveInAttackPosition()\n     {\n-        if (buildingGuards.getTask() == GuardTask.GUARD)\n-        {\n-            ((MinecoloniesAdvancedPathNavigate) worker.getNavigator()).setPathJob(new PathJobCanSee(worker, target, world, buildingGuards.getGuardPos(), 20),\n-              null,\n-              getCombatMovementSpeed());\n-            return;\n-        }\n+        ((MinecoloniesAdvancedPathNavigate) worker.getNavigator()).setPathJob(new PathJobCanSee(worker,\n+            target,\n+            world,\n+            buildingGuards.getGuardPos(), shouldStayCloseToPos()\n+             ? 20 : 40),\n+          null,\n+          getCombatMovementSpeed());\n+    }\n \n-        worker.getNavigator()\n-          .tryMoveToBlockPos(worker.getPosition().offset(BlockPosUtil.getXZFacing(target.getPosition(), worker.getPosition()).getOpposite(), 8), getCombatMovementSpeed());\n+    /**\n+     * If the guard should stick close to the guard/patroll pos.\n+     * @return true if so.\n+     */\n+    private boolean shouldStayCloseToPos()\n+    {\n+        return buildingGuards.getTask() == GuardTask.GUARD || (buildingGuards.getTask() == GuardTask.PATROL && buildingGuards.shallPatrolManually());\n     }\n \n     @Override\n     public void guardMovement()\n     {\n+        if (worker.getRandom().nextInt(3) < 1)\n+        {\n+            worker.isWorkerAtSiteWithMove(buildingGuards.getGuardPos(), 3);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzA4NDcyNA=="}, "originalCommit": {"oid": "4eb576cc4f91a4c5a86c9471ff748933d39cbc86"}, "originalPosition": 63}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzA4NjEyOQ==", "bodyText": "ok", "url": "https://github.com/ldtteam/minecolonies/pull/6207#discussion_r537086129", "createdAt": "2020-12-06T17:31:27Z", "author": {"login": "someaddons"}, "path": "src/main/java/com/minecolonies/coremod/entity/ai/citizen/guard/EntityAIRanger.java", "diffHunk": "@@ -553,21 +553,33 @@ private double getAimHeight()\n     @Override\n     public void moveInAttackPosition()\n     {\n-        if (buildingGuards.getTask() == GuardTask.GUARD)\n-        {\n-            ((MinecoloniesAdvancedPathNavigate) worker.getNavigator()).setPathJob(new PathJobCanSee(worker, target, world, buildingGuards.getGuardPos(), 20),\n-              null,\n-              getCombatMovementSpeed());\n-            return;\n-        }\n+        ((MinecoloniesAdvancedPathNavigate) worker.getNavigator()).setPathJob(new PathJobCanSee(worker,\n+            target,\n+            world,\n+            buildingGuards.getGuardPos(), shouldStayCloseToPos()\n+             ? 20 : 40),\n+          null,\n+          getCombatMovementSpeed());\n+    }\n \n-        worker.getNavigator()\n-          .tryMoveToBlockPos(worker.getPosition().offset(BlockPosUtil.getXZFacing(target.getPosition(), worker.getPosition()).getOpposite(), 8), getCombatMovementSpeed());\n+    /**\n+     * If the guard should stick close to the guard/patroll pos.\n+     * @return true if so.\n+     */\n+    private boolean shouldStayCloseToPos()\n+    {\n+        return buildingGuards.getTask() == GuardTask.GUARD || (buildingGuards.getTask() == GuardTask.PATROL && buildingGuards.shallPatrolManually());\n     }\n \n     @Override\n     public void guardMovement()\n     {\n+        if (worker.getRandom().nextInt(3) < 1)\n+        {\n+            worker.isWorkerAtSiteWithMove(buildingGuards.getGuardPos(), 3);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzA4NDcyNA=="}, "originalCommit": {"oid": "4eb576cc4f91a4c5a86c9471ff748933d39cbc86"}, "originalPosition": 63}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3287, "cost": 1, "resetAt": "2021-11-12T20:44:06Z"}}}