{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTA0MTAwNzM0", "number": 5928, "title": "Serveral fixes", "bodyText": "Closes #5901\nCloses #5929\nCloses #5848\nChanges proposed in this pull request:\nAdds Custom arrows for our entities, which do not scale in damage with movement and despawn quickly after beeing on the ground for a bit, avoiding fps lag from large battles with thousands of arrows.\nSome raid balancing:\nRaiders now have less armor and scale less in health\nColonies raidlevel grows more linearly than before and is a bit lower.\nWhen less than 5% of raiders remain the raids now automatically end.\nFixes:\nTraining archers no longer deal damage when shooting\nToggleAI no longer toggles single blocks on doors and instead uses the doors own toggle functionality\nRaiders no longer accidentally toggle doors\nFix guarding guards \"Jiggling\" because they didnt fix up their starting position for pathing\nFix pathing starting positions, now it checks for an existing collision box and if the citizen is actually within it so that e.g. standing next to a Trapdoor no longer assumes a pathing node above the trapdoor. Before it used entity positions which can vary too much, and caused some cases where citizens get stuck.\nFix players not always beeing added to the colony view subs after dim changes, they now check if they're added each time they enter a chunk claimed by a colony making it more resistant.\nReview please", "createdAt": "2020-10-15T13:21:59Z", "url": "https://github.com/ldtteam/minecolonies/pull/5928", "merged": true, "mergeCommit": {"oid": "5e1ab274b962c5322d8f6a085ac7018da5c39cfb"}, "closed": true, "closedAt": "2020-10-16T06:54:42Z", "author": {"login": "someaddons"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdSxie0gH2gAyNTA0MTAwNzM0OjM5MDY3MGUwM2QzNjI5NzBmYTAyOWQ0N2VhY2ZiYzMyOTJlYTEzY2Q=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdS-RyggFqTUwOTk5NTI2MA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "390670e03d362970fa029d47eacfbc3292ea13cd", "author": {"user": {"login": "someaddons", "name": null}}, "url": "https://github.com/ldtteam/minecolonies/commit/390670e03d362970fa029d47eacfbc3292ea13cd", "committedDate": "2020-10-15T13:10:53Z", "message": "Serveral fixes"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA5MzgyMzk2", "url": "https://github.com/ldtteam/minecolonies/pull/5928#pullrequestreview-509382396", "createdAt": "2020-10-15T13:32:29Z", "commit": {"oid": "390670e03d362970fa029d47eacfbc3292ea13cd"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNVQxMzozMjoyOVrOHiH_rQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNVQxMzozMjoyOVrOHiH_rQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTU0NDYyMQ==", "bodyText": "maybe a constant?", "url": "https://github.com/ldtteam/minecolonies/pull/5928#discussion_r505544621", "createdAt": "2020-10-15T13:32:29Z", "author": {"login": "Raycoms"}, "path": "src/main/java/com/minecolonies/coremod/entity/CustomArrowEntity.java", "diffHunk": "@@ -0,0 +1,54 @@\n+package com.minecolonies.coremod.entity;\n+\n+import net.minecraft.entity.EntityType;\n+import net.minecraft.entity.LivingEntity;\n+import net.minecraft.entity.projectile.ArrowEntity;\n+import net.minecraft.util.math.EntityRayTraceResult;\n+import net.minecraft.world.World;\n+\n+/**\n+ * Custom arrow entity class which remove themselves when on the ground for a bit to not cause lag and they do not scale in damage with their motion.\n+ */\n+public class CustomArrowEntity extends ArrowEntity\n+{\n+    public CustomArrowEntity(final EntityType<? extends ArrowEntity> type, final World world)\n+    {\n+        super(type, world);\n+    }\n+\n+    @Override\n+    protected void arrowHit(LivingEntity target)\n+    {\n+        // TODO add enderman damage hit research here not that this is also used by mobs so check the shooter\n+        super.arrowHit(target);\n+    }\n+\n+    @Override\n+    protected void onEntityHit(EntityRayTraceResult traceResult)\n+    {\n+        final double prevDamage = getDamage();\n+\n+        // Reduce damage by motion before vanilla increases it by the same factor, so our damage stays.\n+        float f = (float) this.getMotion().length();\n+        if (f != 0)\n+        {\n+            setDamage(prevDamage / f);\n+        }\n+\n+        super.onEntityHit(traceResult);\n+\n+        // Set the old actual damage value back\n+        setDamage(prevDamage);\n+    }\n+\n+    @Override\n+    public void tick()\n+    {\n+        super.tick();\n+\n+        if (this.timeInGround > 10)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "390670e03d362970fa029d47eacfbc3292ea13cd"}, "originalPosition": 49}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "67766b4e403a592df6a022fcfd8629c211848792", "author": {"user": {"login": "someaddons", "name": null}}, "url": "https://github.com/ldtteam/minecolonies/commit/67766b4e403a592df6a022fcfd8629c211848792", "committedDate": "2020-10-15T15:14:37Z", "message": "Fix arrows\nFix close players not added after dim changes"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA5OTk1MjYw", "url": "https://github.com/ldtteam/minecolonies/pull/5928#pullrequestreview-509995260", "createdAt": "2020-10-16T04:01:25Z", "commit": {"oid": "67766b4e403a592df6a022fcfd8629c211848792"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1774, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}