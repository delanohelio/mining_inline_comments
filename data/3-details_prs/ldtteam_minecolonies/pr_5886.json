{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDk4NTI4Nzc0", "number": 5886, "title": "Rewrite of door/gate/trapdoor toggle AI", "bodyText": "Changes proposed in this pull request:\nRewrite of door/gate/trapdoor toggle AI, this lets us use the same AI for blocks with similar toggle behaviour.\nThe idea is the same as the fenceGateAI before: we check the parts of path for toggleable blocks in range, and save their positions(previously we could only use one position). If we found some blocks the AI becomes active, while active it randomly activates one of the blocks it found. With multiple blocks in range it eventually finds a combination which allows it to go through.\nPathing now allows single trapdoor blocks as passable.\nPathing now also adds the starting node to the path, previously only nodes with a parent were added.\nExample of what they now make their way through:\n\nDoors no longer have double door issues, which the vanilla AI has.\nGates no longer have double gate issues either\nCitizens now are able to use trapdoors, e.g. when going down/up a ladder\nReview please", "createdAt": "2020-10-06T13:02:27Z", "url": "https://github.com/ldtteam/minecolonies/pull/5886", "merged": true, "mergeCommit": {"oid": "0968b8ef7dff7d4db24ca4eb9ab2b4c2f0548a03"}, "closed": true, "closedAt": "2020-10-06T17:19:10Z", "author": {"login": "someaddons"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdP37dAgH2gAyNDk4NTI4Nzc0OmM3ZjZkODJiZWViYjYxYTE2ZWZkN2E0ZTk5ZjJjZjNmYWM3MjQ2YmY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdP7qBkAFqTUwMzE4OTU5NA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "c7f6d82beebb61a16efd7a4e99f2cf3fac7246bf", "author": {"user": {"login": "someaddons", "name": null}}, "url": "https://github.com/ldtteam/minecolonies/commit/c7f6d82beebb61a16efd7a4e99f2cf3fac7246bf", "committedDate": "2020-10-06T12:55:49Z", "message": "Rewrite of door/gate/trapdoor toggle AI"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f3985505aa4362ba0c063c26ce48341c738c5476", "author": {"user": {"login": "someaddons", "name": null}}, "url": "https://github.com/ldtteam/minecolonies/commit/f3985505aa4362ba0c063c26ce48341c738c5476", "committedDate": "2020-10-06T13:07:53Z", "message": "reset only valid blocks"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "09aad8c64892382c23cb565b7d3f6a980b76511f", "author": {"user": {"login": "Raycoms", "name": null}}, "url": "https://github.com/ldtteam/minecolonies/commit/09aad8c64892382c23cb565b7d3f6a980b76511f", "committedDate": "2020-10-06T13:10:46Z", "message": "Merge branch 'version/1.15' into toggleAI"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAzMDM1NDg3", "url": "https://github.com/ldtteam/minecolonies/pull/5886#pullrequestreview-503035487", "createdAt": "2020-10-06T14:36:28Z", "commit": {"oid": "09aad8c64892382c23cb565b7d3f6a980b76511f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNlQxNDozNjoyOVrOHdKYQw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNlQxNDozNjoyOVrOHdKYQw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDM0MDgwMw==", "bodyText": "Why aren't those just  predicates if we don't need the state anyway?", "url": "https://github.com/ldtteam/minecolonies/pull/5886#discussion_r500340803", "createdAt": "2020-10-06T14:36:29Z", "author": {"login": "Raycoms"}, "path": "src/main/java/com/minecolonies/coremod/entity/ai/minimal/EntityAIInteractToggleAble.java", "diffHunk": "@@ -0,0 +1,254 @@\n+package com.minecolonies.coremod.entity.ai.minimal;\n+\n+import net.minecraft.block.*;\n+import net.minecraft.entity.MobEntity;\n+import net.minecraft.entity.ai.goal.Goal;\n+import net.minecraft.pathfinding.GroundPathNavigator;\n+import net.minecraft.pathfinding.Path;\n+import net.minecraft.pathfinding.PathPoint;\n+import net.minecraft.state.properties.BlockStateProperties;\n+import net.minecraft.util.math.BlockPos;\n+import org.jetbrains.annotations.NotNull;\n+\n+import java.util.*;\n+import java.util.function.Predicate;\n+\n+/**\n+ * AI Task for toggling blocks open/closed when collided\n+ */\n+public class EntityAIInteractToggleAble extends Goal\n+{\n+    /**\n+     * Number of blocks to check for the fence gate - height.\n+     */\n+    private static final int HEIGHT_TO_CHECK = 2;\n+\n+    /**\n+     * Number of blocks to check for the fence gate - length.\n+     */\n+    private static final int LENGTH_TO_CHECK = 2;\n+\n+    /**\n+     * The min distance the gate has to be from the citizen.\n+     */\n+    private static final double MIN_DISTANCE = 2.25D;\n+\n+    /**\n+     * Default predicate for all 3 vanilla blocks\n+     */\n+    public static final Predicate<BlockState> GATE_DOOR_TRAP = new Predicate<BlockState>()\n+    {\n+        @Override\n+        public boolean test(final BlockState state)\n+        {\n+            final Block block = state.getBlock();\n+            return block instanceof DoorBlock || block instanceof FenceGateBlock || block instanceof TrapDoorBlock;\n+        }\n+    };\n+\n+    /**\n+     * Only trapdoors and fence gates\n+     */\n+    public static final Predicate<BlockState> GATE_TRAP = new Predicate<BlockState>()\n+    {\n+        @Override\n+        public boolean test(final BlockState state)\n+        {\n+            final Block block = state.getBlock();\n+            return block instanceof DoorBlock || block instanceof FenceGateBlock || block instanceof TrapDoorBlock;\n+        }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "09aad8c64892382c23cb565b7d3f6a980b76511f"}, "originalPosition": 59}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAzMTg5NTk0", "url": "https://github.com/ldtteam/minecolonies/pull/5886#pullrequestreview-503189594", "createdAt": "2020-10-06T17:16:24Z", "commit": {"oid": "09aad8c64892382c23cb565b7d3f6a980b76511f"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1760, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}