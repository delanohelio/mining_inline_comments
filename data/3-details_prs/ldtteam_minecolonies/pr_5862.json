{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDk3MjM4MjEz", "number": 5862, "title": "Fix/multiples", "bodyText": "Closes #5840\nCloses #\nCloses #\nChanges proposed in this pull request:\nBetter stat inheritance\nIncreased pupil leveling\nWarehouse resolving to closest\nRemove recall all at townhall\nAdd recall to citizen hut\nFix team display on client side\nReview please", "createdAt": "2020-10-03T08:15:51Z", "url": "https://github.com/ldtteam/minecolonies/pull/5862", "merged": true, "mergeCommit": {"oid": "3e91da7b1b21ae09d7fafdf39145042547e99cda"}, "closed": true, "closedAt": "2020-10-03T22:14:19Z", "author": {"login": "Raycoms"}, "timelineItems": {"totalCount": 14, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdOqHu3AH2gAyNDk3MjM4MjEzOmJjZmQwNjFiNTk2NzlmODExNzVjYTBkMDdmNmNlZGUwODBhZDRiNzY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdPAzLcAFqTUwMTU3MzAwNw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "bcfd061b59679f81175ca0d07f6cede080ad4b76", "author": {"user": {"login": "Raycoms", "name": null}}, "url": "https://github.com/ldtteam/minecolonies/commit/bcfd061b59679f81175ca0d07f6cede080ad4b76", "committedDate": "2020-10-02T18:16:38Z", "message": "Several Fixes\n\nBetter stat inheritance\nIncreased pupil leveling\nWarehouse resolving to closest\nRemove recall all at townhall\nAdd recall to citizen hut\nFix team display on client side"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "092f84f82d0f8902c79042df55246229705b2c93", "author": {"user": {"login": "Raycoms", "name": null}}, "url": "https://github.com/ldtteam/minecolonies/commit/092f84f82d0f8902c79042df55246229705b2c93", "committedDate": "2020-10-03T08:11:41Z", "message": "fix #5840"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "084ef1888319d2449ce813f7d826b7ab37d1f26a", "author": {"user": {"login": "Raycoms", "name": null}}, "url": "https://github.com/ldtteam/minecolonies/commit/084ef1888319d2449ce813f7d826b7ab37d1f26a", "committedDate": "2020-10-03T10:35:42Z", "message": "Setup resolvers better"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1faa103459afd8238fbec0e3c5aea798cbe51da7", "author": {"user": {"login": "Raycoms", "name": null}}, "url": "https://github.com/ldtteam/minecolonies/commit/1faa103459afd8238fbec0e3c5aea798cbe51da7", "committedDate": "2020-10-03T10:44:18Z", "message": "remove unnecessary sort"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "32789e9e4062edc2a267ebf8e666e592e40cdcab", "author": {"user": {"login": "Raycoms", "name": null}}, "url": "https://github.com/ldtteam/minecolonies/commit/32789e9e4062edc2a267ebf8e666e592e40cdcab", "committedDate": "2020-10-03T10:51:02Z", "message": "simplify"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAxNTQwNjQ2", "url": "https://github.com/ldtteam/minecolonies/pull/5862#pullrequestreview-501540646", "createdAt": "2020-10-03T11:48:39Z", "commit": {"oid": "32789e9e4062edc2a267ebf8e666e592e40cdcab"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wM1QxMTo0ODozOVrOHcBKng==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wM1QxMTo0ODozOVrOHcBKng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTE0MTI3OA==", "bodyText": "if you only need the closest just keep the closest saved, no need to re-sort the entire list", "url": "https://github.com/ldtteam/minecolonies/pull/5862#discussion_r499141278", "createdAt": "2020-10-03T11:48:39Z", "author": {"login": "someaddons"}, "path": "src/main/java/com/minecolonies/coremod/colony/managers/BuildingManager.java", "diffHunk": "@@ -257,6 +257,34 @@ public IBuilding getBuilding(final BlockPos buildingId)\n         return null;\n     }\n \n+    @Nullable\n+    @Override\n+    public IWareHouse getClosestWarehouseInColony(final BlockPos pos)\n+    {\n+        final List<IWareHouse> wareHouses = new ArrayList<>();\n+        for (final IBuilding building : colony.getBuildingManager().getBuildings().values())\n+        {\n+            if (building instanceof BuildingWareHouse && building.getTileEntity() != null)\n+            {\n+                wareHouses.add((IWareHouse) building);\n+            }\n+        }\n+\n+        wareHouses.removeIf(Objects::isNull);\n+        wareHouses.sort((w1, w2) ->\n+        {\n+            final double dist1 = w1.getPosition().distanceSq(pos);\n+            final double dist2 = w2.getPosition().distanceSq(pos);\n+            return Double.compare(dist1, dist2);\n+        });", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "32789e9e4062edc2a267ebf8e666e592e40cdcab"}, "originalPosition": 23}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1d784b86b8f577fe7feebe832044383e5a294887", "author": {"user": {"login": "Raycoms", "name": null}}, "url": "https://github.com/ldtteam/minecolonies/commit/1d784b86b8f577fe7feebe832044383e5a294887", "committedDate": "2020-10-03T11:54:53Z", "message": "make this more performant"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAxNTQxMDU1", "url": "https://github.com/ldtteam/minecolonies/pull/5862#pullrequestreview-501541055", "createdAt": "2020-10-03T11:56:57Z", "commit": {"oid": "32789e9e4062edc2a267ebf8e666e592e40cdcab"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wM1QxMTo1Njo1N1rOHcBMnA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wM1QxMTo1Njo1N1rOHcBMnA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTE0MTc4OA==", "bodyText": "unneeded null check, we only add notnull objects", "url": "https://github.com/ldtteam/minecolonies/pull/5862#discussion_r499141788", "createdAt": "2020-10-03T11:56:57Z", "author": {"login": "someaddons"}, "path": "src/main/java/com/minecolonies/coremod/colony/requestsystem/resolvers/core/AbstractWarehouseRequestResolver.java", "diffHunk": "@@ -264,6 +262,14 @@ public void onAssignedRequestCancelled(@NotNull final IRequestManager manager, @\n             }\n         }\n \n+        wareHouses.removeIf(Objects::isNull);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "32789e9e4062edc2a267ebf8e666e592e40cdcab"}, "originalPosition": 62}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAxNTQxNTMz", "url": "https://github.com/ldtteam/minecolonies/pull/5862#pullrequestreview-501541533", "createdAt": "2020-10-03T12:04:52Z", "commit": {"oid": "32789e9e4062edc2a267ebf8e666e592e40cdcab"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wM1QxMjowNDo1MlrOHcBObw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wM1QxMjowNDo1MlrOHcBObw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTE0MjI1NQ==", "bodyText": "could we here instead do data.setLastpos(buildingpos) -> existing entity remove(or null) -> data.updateEntityIfNecessary() ?\nThen we're making sure to cleanup the references and get a valid entity in any case. E.g. when the data somehow has a no longer valid entities but still keeps that", "url": "https://github.com/ldtteam/minecolonies/pull/5862#discussion_r499142255", "createdAt": "2020-10-03T12:04:52Z", "author": {"login": "someaddons"}, "path": "src/main/java/com/minecolonies/coremod/network/messages/server/colony/building/RecallCitizenHutMessage.java", "diffHunk": "@@ -0,0 +1,83 @@\n+package com.minecolonies.coremod.network.messages.server.colony.building;\n+\n+import com.ldtteam.structurize.util.LanguageHandler;\n+import com.minecolonies.api.colony.ICitizenData;\n+import com.minecolonies.api.colony.IColony;\n+import com.minecolonies.api.colony.buildings.IBuilding;\n+import com.minecolonies.api.entity.citizen.AbstractEntityCitizen;\n+import com.minecolonies.api.util.Log;\n+import com.minecolonies.coremod.colony.buildings.views.AbstractBuildingView;\n+import com.minecolonies.coremod.network.messages.server.AbstractBuildingServerMessage;\n+import com.minecolonies.coremod.util.TeleportHelper;\n+import net.minecraft.entity.player.PlayerEntity;\n+import net.minecraft.network.PacketBuffer;\n+import net.minecraft.util.math.BlockPos;\n+import net.minecraft.world.World;\n+import net.minecraftforge.fml.network.NetworkEvent;\n+import org.jetbrains.annotations.NotNull;\n+\n+import java.util.Optional;\n+\n+/**\n+ * Used to handle citizen recalls to their hut.\n+ */\n+public class RecallCitizenHutMessage extends AbstractBuildingServerMessage<IBuilding>\n+{\n+    /**\n+     * Empty public constructor.\n+     */\n+    public RecallCitizenHutMessage()\n+    {\n+        super();\n+    }\n+\n+    /**\n+     * Creates a message to recall all citizens to their hut.\n+     *\n+     * @param building {@link AbstractBuildingView}\n+     */\n+    public RecallCitizenHutMessage(@NotNull final AbstractBuildingView building)\n+    {\n+        super(building);\n+    }\n+\n+    @Override\n+    protected void onExecute(@NotNull final NetworkEvent.Context ctxIn, final boolean isLogicalServer, @NotNull final IColony colony, @NotNull final IBuilding building)\n+    {\n+        final BlockPos location = building.getPosition();\n+        final World world = colony.getWorld();\n+        for (final ICitizenData citizenData : building.getAssignedCitizen())\n+        {\n+            Optional<AbstractEntityCitizen> optionalEntityCitizen = citizenData.getEntity();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "32789e9e4062edc2a267ebf8e666e592e40cdcab"}, "originalPosition": 51}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "639e2d040f5368aa207f1792bfc3c46e7e0d18ba", "author": {"user": {"login": "Raycoms", "name": null}}, "url": "https://github.com/ldtteam/minecolonies/commit/639e2d040f5368aa207f1792bfc3c46e7e0d18ba", "committedDate": "2020-10-03T14:00:47Z", "message": "remove this"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "737e9a178ed3982f7aef1f8eeb39244a4452fb31", "author": {"user": {"login": "Raycoms", "name": null}}, "url": "https://github.com/ldtteam/minecolonies/commit/737e9a178ed3982f7aef1f8eeb39244a4452fb31", "committedDate": "2020-10-03T14:08:10Z", "message": "Merge branch 'version/1.15' into fix/multiples"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0d344e3100f114377994f6a5c1035077e97bef7d", "author": {"user": {"login": "Raycoms", "name": null}}, "url": "https://github.com/ldtteam/minecolonies/commit/0d344e3100f114377994f6a5c1035077e97bef7d", "committedDate": "2020-10-03T19:18:38Z", "message": "Additional info for dman"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAxNTcxNTk4", "url": "https://github.com/ldtteam/minecolonies/pull/5862#pullrequestreview-501571598", "createdAt": "2020-10-03T20:15:50Z", "commit": {"oid": "0d344e3100f114377994f6a5c1035077e97bef7d"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAxNTczMDA3", "url": "https://github.com/ldtteam/minecolonies/pull/5862#pullrequestreview-501573007", "createdAt": "2020-10-03T20:42:00Z", "commit": {"oid": "0d344e3100f114377994f6a5c1035077e97bef7d"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1963, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}