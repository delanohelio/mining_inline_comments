{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzgzNTQ5Njcw", "number": 4390, "title": "exp fixes", "bodyText": "Closes #4389\nChanges proposed in this pull request:\n-raids drop exp\n-When guard is following you, gives you effect without particles\n-Fixed infinite loop when citizen earns too much exp too quickly\nReview please", "createdAt": "2020-03-04T13:18:24Z", "url": "https://github.com/ldtteam/minecolonies/pull/4390", "merged": true, "mergeCommit": {"oid": "0a4667b2987bba06202a82e1e1f8158bc155d2c5"}, "closed": true, "closedAt": "2020-03-06T21:03:27Z", "author": {"login": "adoxentor"}, "timelineItems": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcJO-niAH2gAyMzgzNTQ5NjcwOmJhZThlZjgzY2I5YWNlNzgwMzA5ZjI1ZTRhNzg4NTY4ZGFjZTVlOWQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcLEHu9gFqTM3MDUyMjMwMg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "bae8ef83cb9ace780309f25e4a788568dace5e9d", "author": {"user": {"login": "adoxes", "name": null}}, "url": "https://github.com/ldtteam/minecolonies/commit/bae8ef83cb9ace780309f25e4a788568dace5e9d", "committedDate": "2020-03-01T01:38:28Z", "message": "fixed loot tables\nadded tome to most mob drops"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8d8c79ac1526be294148c2f5450f5031277191a3", "author": {"user": {"login": "adoxes", "name": null}}, "url": "https://github.com/ldtteam/minecolonies/commit/8d8c79ac1526be294148c2f5450f5031277191a3", "committedDate": "2020-03-01T01:39:31Z", "message": "renamed loot files to match entity name"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "42cb0162894440c2ce55224819f0df45d289fcc6", "author": {"user": {"login": "adoxes", "name": null}}, "url": "https://github.com/ldtteam/minecolonies/commit/42cb0162894440c2ce55224819f0df45d289fcc6", "committedDate": "2020-03-01T04:09:30Z", "message": "removed tome as rare loot"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "aa11aae5566699946018d351c9e3f972fe1ea9bf", "author": {"user": {"login": "adoxentor", "name": "Iddo"}}, "url": "https://github.com/ldtteam/minecolonies/commit/aa11aae5566699946018d351c9e3f972fe1ea9bf", "committedDate": "2020-03-01T14:42:58Z", "message": "Merge branch 'version/1.15' into version/1.15"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "219e3edf79312fa69d62ebe356cb7d0c8d41cd28", "author": {"user": {"login": "adoxes", "name": null}}, "url": "https://github.com/ldtteam/minecolonies/commit/219e3edf79312fa69d62ebe356cb7d0c8d41cd28", "committedDate": "2020-03-03T21:55:00Z", "message": "Merge https://github.com/ldtteam/minecolonies into version/1.15"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "07ac798438e6319d1498a0b9fceac053f98eea8b", "author": {"user": {"login": "adoxes", "name": null}}, "url": "https://github.com/ldtteam/minecolonies/commit/07ac798438e6319d1498a0b9fceac053f98eea8b", "committedDate": "2020-03-03T21:56:16Z", "message": "Merge remote-tracking branch 'origin/version/1.15' into version/1.15"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3f0ac6352d78fbfb93a4ec1f808c8e11152e4fea", "author": {"user": {"login": "adoxes", "name": null}}, "url": "https://github.com/ldtteam/minecolonies/commit/3f0ac6352d78fbfb93a4ec1f808c8e11152e4fea", "committedDate": "2020-03-04T03:36:21Z", "message": "#   fixed infinite loop when citizen gets too much exp.\n#   removed particles when gaurd follows you\n#   fixed raid don't drop exp\n#   made raiders drop more exp\n#   made exp fly to citizens instead of instant collect to allow player to\ncollect some"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY4ODAyMTk2", "url": "https://github.com/ldtteam/minecolonies/pull/4390#pullrequestreview-368802196", "createdAt": "2020-03-04T14:04:21Z", "commit": {"oid": "3f0ac6352d78fbfb93a4ec1f808c8e11152e4fea"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQxNDowNDoyMlrOFxudUA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQxNDowNDoyMlrOFxudUA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzY4NTcxMg==", "bodyText": "Why is this needed?", "url": "https://github.com/ldtteam/minecolonies/pull/4390#discussion_r387685712", "createdAt": "2020-03-04T14:04:22Z", "author": {"login": "Raycoms"}, "path": "src/main/java/com/minecolonies/coremod/colony/CitizenData.java", "diffHunk": "@@ -940,6 +941,10 @@ private void increaseLevel()\n             {\n                 this.levelExperienceMap.put(job.getExperienceTag(), new Tuple<>(entry.getA() + 1, entry.getB()));\n             }\n+            else\n+            {\n+                this.levelExperienceMap.put(job.getExperienceTag(),new Tuple<Integer,Double> ((int)MAX_CITIZEN_LEVEL,ExperienceUtils.getXPNeededForNextLevel(MAX_CITIZEN_LEVEL-1)));\n+            }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3f0ac6352d78fbfb93a4ec1f808c8e11152e4fea"}, "originalPosition": 15}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY4ODAyNDM0", "url": "https://github.com/ldtteam/minecolonies/pull/4390#pullrequestreview-368802434", "createdAt": "2020-03-04T14:04:39Z", "commit": {"oid": "3f0ac6352d78fbfb93a4ec1f808c8e11152e4fea"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQxNDowNDozOVrOFxueCA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQxNDowNDozOVrOFxueCA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzY4NTg5Ng==", "bodyText": "Good catch, you can remove the comment here.", "url": "https://github.com/ldtteam/minecolonies/pull/4390#discussion_r387685896", "createdAt": "2020-03-04T14:04:39Z", "author": {"login": "Raycoms"}, "path": "src/main/java/com/minecolonies/coremod/colony/buildings/AbstractBuildingGuards.java", "diffHunk": "@@ -915,7 +915,7 @@ public void setPlayerToFollow(final PlayerEntity player)\n         if (this.getColony().getWorld() != null)\n         {\n             this.getColony().getWorld().getScoreboard().addPlayerToTeam(player.getScoreboardName(), new ScorePlayerTeam(this.getColony().getWorld().getScoreboard(), TEAM_COLONY_NAME + getColony().getID()));\n-            player.addPotionEffect(new EffectInstance(GLOW_EFFECT, GLOW_EFFECT_DURATION_TEAM, GLOW_EFFECT_MULTIPLIER));\n+            player.addPotionEffect(new EffectInstance(GLOW_EFFECT, GLOW_EFFECT_DURATION_TEAM, GLOW_EFFECT_MULTIPLIER,false,false));//no reason for particales\n ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3f0ac6352d78fbfb93a4ec1f808c8e11152e4fea"}, "originalPosition": 6}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY4ODAyODg2", "url": "https://github.com/ldtteam/minecolonies/pull/4390#pullrequestreview-368802886", "createdAt": "2020-03-04T14:05:14Z", "commit": {"oid": "3f0ac6352d78fbfb93a4ec1f808c8e11152e4fea"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQxNDowNToxNFrOFxufWw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQxNDowNToxNFrOFxufWw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzY4NjIzNQ==", "bodyText": "Awesome", "url": "https://github.com/ldtteam/minecolonies/pull/4390#discussion_r387686235", "createdAt": "2020-03-04T14:05:14Z", "author": {"login": "Raycoms"}, "path": "src/main/java/com/minecolonies/coremod/entity/citizen/citizenhandlers/CitizenExperienceHandler.java", "diffHunk": "@@ -210,8 +211,16 @@ public void gatherXp()\n     {\n         for (@NotNull final ExperienceOrbEntity orb : getXPOrbsOnGrid())\n         {\n-            addExperience(orb.getXpValue() / 2.0D);\n-            orb.remove();\n+            Vec3d vec3d = new Vec3d(citizen.posX - orb.getPosX(), citizen.posY + (double)this.citizen.getEyeHeight() / 2.0D - orb.getPosY(), citizen.getPosZ() - orb.getPosZ());\n+            double d1 = vec3d.lengthSquared();\n+\n+            if (d1 < 1.0D) {\n+                addExperience(orb.getXpValue() / 2.0D);\n+                orb.remove();\n+                return;\n+            }\n+            double d2 = 1.0D - Math.sqrt(d1) / 8.0D;\n+            orb.setMotion(orb.getMotion().add(vec3d.normalize().scale(d2 * d2 * 0.1D)));\n         }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3f0ac6352d78fbfb93a4ec1f808c8e11152e4fea"}, "originalPosition": 33}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY4ODAzOTI0", "url": "https://github.com/ldtteam/minecolonies/pull/4390#pullrequestreview-368803924", "createdAt": "2020-03-04T14:06:34Z", "commit": {"oid": "3f0ac6352d78fbfb93a4ec1f808c8e11152e4fea"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQxNDowNjozNFrOFxuioA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQxNDowNjozNFrOFxuioA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzY4NzA3Mg==", "bodyText": "This is very old code, didn't know there was a new way around this. Good job", "url": "https://github.com/ldtteam/minecolonies/pull/4390#discussion_r387687072", "createdAt": "2020-03-04T14:06:34Z", "author": {"login": "Raycoms"}, "path": "src/api/java/com/minecolonies/api/entity/mobs/AbstractEntityMinecoloniesMob.java", "diffHunk": "@@ -280,17 +281,6 @@ public ILivingEntityData onInitialSpawn(\n         return super.onInitialSpawn(worldIn, difficultyIn, reason, spawnDataIn, dataTag);\n     }\n \n-    @Override\n-    protected void onDeathUpdate()\n-    {\n-        if (!(this.getAttackingEntity() instanceof PlayerEntity) && (this.recentlyHit > 0 && this.canDropLoot() && world.getGameRules().getBoolean(GameRules.DO_MOB_LOOT)))\n-        {\n-            final int experience = ExperienceOrbEntity.getXPSplit(BARBARIAN_EXP_DROP);\n-            CompatibilityUtils.addEntity(world, new ExperienceOrbEntity(world, this.posX, this.posY, this.posZ, experience));\n-        }\n-        super.onDeathUpdate();\n-    }\n-", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3f0ac6352d78fbfb93a4ec1f808c8e11152e4fea"}, "originalPosition": 22}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcwNTIyMzAy", "url": "https://github.com/ldtteam/minecolonies/pull/4390#pullrequestreview-370522302", "createdAt": "2020-03-06T18:07:19Z", "commit": {"oid": "3f0ac6352d78fbfb93a4ec1f808c8e11152e4fea"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2289, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}