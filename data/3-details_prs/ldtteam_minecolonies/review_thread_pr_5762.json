{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDg1MDQzNDMz", "number": 5762, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMVQxMzowNjoyNlrOEiiSZw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMVQxNTozMjo1MFrOEil2hA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA0NjQ4ODA3OnYy", "diffSide": "RIGHT", "path": "src/main/java/com/minecolonies/coremod/colony/VisitorData.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMVQxMzowNjoyNlrOHQeDHA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMVQxMzowNzoxOFrOHQeFGw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzAzMTU4MA==", "bodyText": "I'm pretty sure this causes the out of world issues", "url": "https://github.com/ldtteam/minecolonies/pull/5762#discussion_r487031580", "createdAt": "2020-09-11T13:06:26Z", "author": {"login": "Raycoms"}, "path": "src/main/java/com/minecolonies/coremod/colony/VisitorData.java", "diffHunk": "@@ -114,10 +115,14 @@ public void updateEntityIfNecessary()\n     {\n         if (getEntity().isPresent())\n         {\n-            return;\n+            final Entity entity = getEntity().get();\n+            if (entity.isAlive() && entity.addedToChunk && WorldUtil.isEntityBlockLoaded(entity.world, entity.getPosition()))\n+            {\n+                return;\n+            }\n         }\n \n-        if (WorldUtil.isEntityBlockLoaded(getColony().getWorld(), getLastPosition()))\n+        if (getLastPosition() != BlockPos.ZERO && WorldUtil.isEntityBlockLoaded(getColony().getWorld(), getLastPosition()))\n         {\n             getColony().getVisitorManager().spawnOrCreateCivilian(this, getColony().getWorld(), getLastPosition(), true);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7ed6cbf547f3e7754fb09562b0a3fa4802652deb"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzAzMjA5MQ==", "bodyText": "ye might do", "url": "https://github.com/ldtteam/minecolonies/pull/5762#discussion_r487032091", "createdAt": "2020-09-11T13:07:18Z", "author": {"login": "someaddons"}, "path": "src/main/java/com/minecolonies/coremod/colony/VisitorData.java", "diffHunk": "@@ -114,10 +115,14 @@ public void updateEntityIfNecessary()\n     {\n         if (getEntity().isPresent())\n         {\n-            return;\n+            final Entity entity = getEntity().get();\n+            if (entity.isAlive() && entity.addedToChunk && WorldUtil.isEntityBlockLoaded(entity.world, entity.getPosition()))\n+            {\n+                return;\n+            }\n         }\n \n-        if (WorldUtil.isEntityBlockLoaded(getColony().getWorld(), getLastPosition()))\n+        if (getLastPosition() != BlockPos.ZERO && WorldUtil.isEntityBlockLoaded(getColony().getWorld(), getLastPosition()))\n         {\n             getColony().getVisitorManager().spawnOrCreateCivilian(this, getColony().getWorld(), getLastPosition(), true);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzAzMTU4MA=="}, "originalCommit": {"oid": "7ed6cbf547f3e7754fb09562b0a3fa4802652deb"}, "originalPosition": 23}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA0NzA3MjA0OnYy", "diffSide": "RIGHT", "path": "src/main/java/com/minecolonies/coremod/colony/managers/CitizenManager.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMVQxNTozMjo1MFrOHQjuOw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMVQxNzowNjowNlrOHQm3vg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzEyNDUzOQ==", "bodyText": "Why is this cast here?......", "url": "https://github.com/ldtteam/minecolonies/pull/5762#discussion_r487124539", "createdAt": "2020-09-11T15:32:50Z", "author": {"login": "OrionDevelopment"}, "path": "src/main/java/com/minecolonies/coremod/colony/managers/CitizenManager.java", "diffHunk": "@@ -227,35 +226,23 @@ public ICitizenData spawnOrCreateCivilian(@Nullable final ICivilianData data, fi\n             spawnLocation = colony.getBuildingManager().getTownHall().getPosition();\n         }\n \n-\n-        BlockPos calculatedSpawn = null;\n-\n-        if (world.getChunkProvider().isChunkLoaded(new ChunkPos(spawnLocation.getX() >> 4, spawnLocation.getZ() >> 4)))\n-        {\n-            calculatedSpawn = EntityUtils.getSpawnPoint(world, spawnLocation);\n-        }\n-\n-        if (calculatedSpawn == null)\n+        if (WorldUtil.isEntityBlockLoaded(colony.getWorld(), spawnLocation))\n         {\n-            spawnLocation = colony.getBuildingManager().getTownHall().getPosition();\n-            if (world.getChunkProvider().isChunkLoaded(new ChunkPos(spawnLocation.getX() >> 4, spawnLocation.getZ() >> 4)))\n+            final BlockPos calculatedSpawn = EntityUtils.getSpawnPoint(world, spawnLocation);\n+            if (calculatedSpawn != null)\n             {\n-                calculatedSpawn = EntityUtils.getSpawnPoint(world, spawnLocation);\n+                return spawnCitizenOnPosition((ICitizenData) data, world, force, calculatedSpawn);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "80ff3e7095518bd31f3fbe32906141f82f35a748"}, "originalPosition": 43}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzE3NjAyMw==", "bodyText": "this happens to be a citizenmanager internal function which is uses citizen data instead of civilian", "url": "https://github.com/ldtteam/minecolonies/pull/5762#discussion_r487176023", "createdAt": "2020-09-11T17:05:54Z", "author": {"login": "someaddons"}, "path": "src/main/java/com/minecolonies/coremod/colony/managers/CitizenManager.java", "diffHunk": "@@ -227,35 +226,23 @@ public ICitizenData spawnOrCreateCivilian(@Nullable final ICivilianData data, fi\n             spawnLocation = colony.getBuildingManager().getTownHall().getPosition();\n         }\n \n-\n-        BlockPos calculatedSpawn = null;\n-\n-        if (world.getChunkProvider().isChunkLoaded(new ChunkPos(spawnLocation.getX() >> 4, spawnLocation.getZ() >> 4)))\n-        {\n-            calculatedSpawn = EntityUtils.getSpawnPoint(world, spawnLocation);\n-        }\n-\n-        if (calculatedSpawn == null)\n+        if (WorldUtil.isEntityBlockLoaded(colony.getWorld(), spawnLocation))\n         {\n-            spawnLocation = colony.getBuildingManager().getTownHall().getPosition();\n-            if (world.getChunkProvider().isChunkLoaded(new ChunkPos(spawnLocation.getX() >> 4, spawnLocation.getZ() >> 4)))\n+            final BlockPos calculatedSpawn = EntityUtils.getSpawnPoint(world, spawnLocation);\n+            if (calculatedSpawn != null)\n             {\n-                calculatedSpawn = EntityUtils.getSpawnPoint(world, spawnLocation);\n+                return spawnCitizenOnPosition((ICitizenData) data, world, force, calculatedSpawn);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzEyNDUzOQ=="}, "originalCommit": {"oid": "80ff3e7095518bd31f3fbe32906141f82f35a748"}, "originalPosition": 43}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzE3NjEyNg==", "bodyText": "could probably move that to civilian too in the future", "url": "https://github.com/ldtteam/minecolonies/pull/5762#discussion_r487176126", "createdAt": "2020-09-11T17:06:06Z", "author": {"login": "someaddons"}, "path": "src/main/java/com/minecolonies/coremod/colony/managers/CitizenManager.java", "diffHunk": "@@ -227,35 +226,23 @@ public ICitizenData spawnOrCreateCivilian(@Nullable final ICivilianData data, fi\n             spawnLocation = colony.getBuildingManager().getTownHall().getPosition();\n         }\n \n-\n-        BlockPos calculatedSpawn = null;\n-\n-        if (world.getChunkProvider().isChunkLoaded(new ChunkPos(spawnLocation.getX() >> 4, spawnLocation.getZ() >> 4)))\n-        {\n-            calculatedSpawn = EntityUtils.getSpawnPoint(world, spawnLocation);\n-        }\n-\n-        if (calculatedSpawn == null)\n+        if (WorldUtil.isEntityBlockLoaded(colony.getWorld(), spawnLocation))\n         {\n-            spawnLocation = colony.getBuildingManager().getTownHall().getPosition();\n-            if (world.getChunkProvider().isChunkLoaded(new ChunkPos(spawnLocation.getX() >> 4, spawnLocation.getZ() >> 4)))\n+            final BlockPos calculatedSpawn = EntityUtils.getSpawnPoint(world, spawnLocation);\n+            if (calculatedSpawn != null)\n             {\n-                calculatedSpawn = EntityUtils.getSpawnPoint(world, spawnLocation);\n+                return spawnCitizenOnPosition((ICitizenData) data, world, force, calculatedSpawn);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzEyNDUzOQ=="}, "originalCommit": {"oid": "80ff3e7095518bd31f3fbe32906141f82f35a748"}, "originalPosition": 43}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3495, "cost": 1, "resetAt": "2021-11-12T20:44:06Z"}}}