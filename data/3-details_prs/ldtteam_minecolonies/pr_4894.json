{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDEzNTY4MTU0", "number": 4894, "title": "Tavern", "bodyText": "Changes proposed in this pull request:\nAdds the Tavern hut as a new early game building.\nFeatures:\n\nHouses 4 citizens\nMax 1 Tavern\nPlays a tavern theme music upon entering\n(More will be added in future PR's for it(recruitment traders,quests etc), need to add some other features for that first)\nCitizen limit at which raids appear is raised from 5 to 7.\nAdd citizen data registry, for allowing colony-external citizens like recruitable citizens/guards and trader npcs.\nAdd a trigger for buildings when a player comes close/enters the building area, which uses the chunk cap's list of buildings.\nMoved some placement logic out of the eventhandler, into the buildingmanager.\nSound datagen now uses Json directly, to apply custom properties.\n\nFix: Guard building NPE after firing a guard.\nFix: Rotations are now cached as intended and not recalculated on 0, aswell as written to NBT to no longer load all Building chunks upon serializing them to a view, probably caused some longer login times.\nReview please", "createdAt": "2020-05-05T14:54:18Z", "url": "https://github.com/ldtteam/minecolonies/pull/4894", "merged": true, "mergeCommit": {"oid": "c308779129054108a2e851532c799dfbfe476459"}, "closed": true, "closedAt": "2020-05-13T11:27:37Z", "author": {"login": "someaddons"}, "timelineItems": {"totalCount": 16, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABceUcpUAH2gAyNDEzNTY4MTU0OmMwMjQzMzYwMDAzODgyMzNiMTUyNWViNDY4OTEwZTUyMzcyMDFhYzY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcg1cFPAFqTQxMDc0Nzg1MA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "c024336000388233b1525eb468910e5237201ac6", "author": {"user": {"login": "someaddons", "name": null}}, "url": "https://github.com/ldtteam/minecolonies/commit/c024336000388233b1525eb468910e5237201ac6", "committedDate": "2020-05-05T13:53:12Z", "message": "Tavern building/blocks"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "705dd86dc83d67d1c6408906c23bc0a5edf86f31", "author": {"user": {"login": "someaddons", "name": null}}, "url": "https://github.com/ldtteam/minecolonies/commit/705dd86dc83d67d1c6408906c23bc0a5edf86f31", "committedDate": "2020-05-07T10:34:50Z", "message": "Tavern building/event"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9491f1c881831bc5cb9ca41b71f3a29e8355befd", "author": {"user": {"login": "someaddons", "name": null}}, "url": "https://github.com/ldtteam/minecolonies/commit/9491f1c881831bc5cb9ca41b71f3a29e8355befd", "committedDate": "2020-05-07T20:58:20Z", "message": "tavern"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dccbffde42af0a91ee09a4a249de81c2425cc6f9", "author": {"user": {"login": "someaddons", "name": null}}, "url": "https://github.com/ldtteam/minecolonies/commit/dccbffde42af0a91ee09a4a249de81c2425cc6f9", "committedDate": "2020-05-08T08:26:11Z", "message": "Merge remote-tracking branch 'remotes/origin/version/1.15' into Tavern\n\n# Conflicts:\n#\tsrc/api/java/com/minecolonies/api/blocks/ModBlocks.java\n#\tsrc/api/java/com/minecolonies/api/colony/buildings/ModBuildings.java\n#\tsrc/main/java/com/minecolonies/apiimp/initializer/ModBlocksInitializer.java\n#\tsrc/main/java/com/minecolonies/apiimp/initializer/ModBuildingsInitializer.java\n#\tsrc/main/java/com/minecolonies/coremod/entity/citizen/citizenhandlers/CitizenChatHandler.java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ae30324f584a926af9bb62c1d14bc070d46bdf22", "author": {"user": {"login": "someaddons", "name": null}}, "url": "https://github.com/ldtteam/minecolonies/commit/ae30324f584a926af9bb62c1d14bc070d46bdf22", "committedDate": "2020-05-09T16:53:01Z", "message": "tavern sound added"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f63c57d7a95a81c6fe4730fd40c38a5e32c074a7", "author": {"user": {"login": "someaddons", "name": null}}, "url": "https://github.com/ldtteam/minecolonies/commit/f63c57d7a95a81c6fe4730fd40c38a5e32c074a7", "committedDate": "2020-05-09T19:32:58Z", "message": "tavern sounds/progress added"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b898e35994b43451758e23b67e4fc21309859377", "author": {"user": {"login": "someaddons", "name": null}}, "url": "https://github.com/ldtteam/minecolonies/commit/b898e35994b43451758e23b67e4fc21309859377", "committedDate": "2020-05-09T19:35:25Z", "message": "Merge remote-tracking branch 'remotes/origin/version/1.15' into Tavern\n\n# Conflicts:\n#\tsrc/api/java/com/minecolonies/api/blocks/ModBlocks.java\n#\tsrc/api/java/com/minecolonies/api/colony/buildings/ModBuildings.java\n#\tsrc/main/java/com/minecolonies/apiimp/initializer/ModBlocksInitializer.java\n#\tsrc/main/java/com/minecolonies/apiimp/initializer/ModBuildingsInitializer.java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "02a0b800a635b08b913b7399efc9250b25296aa1", "author": {"user": {"login": "someaddons", "name": null}}, "url": "https://github.com/ldtteam/minecolonies/commit/02a0b800a635b08b913b7399efc9250b25296aa1", "committedDate": "2020-05-09T19:59:17Z", "message": "fix guard npe"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "36a3405ab75e3d2bb31dca079efc44e021df66d6", "author": {"user": {"login": "someaddons", "name": null}}, "url": "https://github.com/ldtteam/minecolonies/commit/36a3405ab75e3d2bb31dca079efc44e021df66d6", "committedDate": "2020-05-09T20:24:36Z", "message": "javadoc"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9418a9ac66c36f4178e996857b39fbf9147d12d7", "author": {"user": {"login": "someaddons", "name": null}}, "url": "https://github.com/ldtteam/minecolonies/commit/9418a9ac66c36f4178e996857b39fbf9147d12d7", "committedDate": "2020-05-10T07:12:46Z", "message": "credits and invalidate cache"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA4NzE5Mjc4", "url": "https://github.com/ldtteam/minecolonies/pull/4894#pullrequestreview-408719278", "createdAt": "2020-05-10T08:14:39Z", "commit": {"oid": "9418a9ac66c36f4178e996857b39fbf9147d12d7"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMFQwODoxNDozOVrOGTB6ug==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMFQwODoxNDozOVrOGTB6ug==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjYwNzU0Ng==", "bodyText": "this formatting looks wrong now =D", "url": "https://github.com/ldtteam/minecolonies/pull/4894#discussion_r422607546", "createdAt": "2020-05-10T08:14:39Z", "author": {"login": "Raycoms"}, "path": "src/api/java/com/minecolonies/api/colony/buildings/ModBuildings.java", "diffHunk": "@@ -86,6 +87,7 @@\n     public static       BuildingEntry dyer;\n     public static       BuildingEntry fletcher;\n     public static       BuildingEntry mechanic;\n+    public static BuildingEntry tavern;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9418a9ac66c36f4178e996857b39fbf9147d12d7"}, "originalPosition": 35}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b22cf061446cdb8cc23aad399cb917adcbd50971", "author": {"user": {"login": "someaddons", "name": null}}, "url": "https://github.com/ldtteam/minecolonies/commit/b22cf061446cdb8cc23aad399cb917adcbd50971", "committedDate": "2020-05-10T14:27:46Z", "message": "fix network messages merge regressions"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA5OTM5NjA2", "url": "https://github.com/ldtteam/minecolonies/pull/4894#pullrequestreview-409939606", "createdAt": "2020-05-12T11:16:38Z", "commit": {"oid": "b22cf061446cdb8cc23aad399cb917adcbd50971"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQxMToxNjozOFrOGUBzeg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQxMTozMDoxNFrOGUCPNw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzY1NDI2Ng==", "bodyText": "It is either an IForgeRegistry<CitizenDataTypeRegirtryEntry> or the method should be called getCitizenDataRegistry()", "url": "https://github.com/ldtteam/minecolonies/pull/4894#discussion_r423654266", "createdAt": "2020-05-12T11:16:38Z", "author": {"login": "OrionDevelopment"}, "path": "src/api/java/com/minecolonies/api/IMinecoloniesAPI.java", "diffHunk": "@@ -59,4 +60,6 @@ static IMinecoloniesAPI getInstance() {\n     IGlobalResearchTree getGlobalResearchTree();\n \n     IForgeRegistry<ColonyEventTypeRegistryEntry> getColonyEventRegistry();\n+\n+    IForgeRegistry<CitizenDataRegistryEntry> getCitizenDataTypeRegistry();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b22cf061446cdb8cc23aad399cb917adcbd50971"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzY1NDU2Nw==", "bodyText": "See interface declaration on naming issues.", "url": "https://github.com/ldtteam/minecolonies/pull/4894#discussion_r423654567", "createdAt": "2020-05-12T11:17:13Z", "author": {"login": "OrionDevelopment"}, "path": "src/api/java/com/minecolonies/api/MinecoloniesAPIProxy.java", "diffHunk": "@@ -140,4 +141,10 @@ public IGlobalResearchTree getGlobalResearchTree()\n     {\n         return apiInstance.getColonyEventRegistry();\n     }\n+\n+    @Override\n+    public IForgeRegistry<CitizenDataRegistryEntry> getCitizenDataTypeRegistry()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b22cf061446cdb8cc23aad399cb917adcbd50971"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzY1NDgzOQ==", "bodyText": "Yes please rerun the formatter.", "url": "https://github.com/ldtteam/minecolonies/pull/4894#discussion_r423654839", "createdAt": "2020-05-12T11:17:42Z", "author": {"login": "OrionDevelopment"}, "path": "src/api/java/com/minecolonies/api/colony/buildings/ModBuildings.java", "diffHunk": "@@ -86,6 +87,7 @@\n     public static       BuildingEntry dyer;\n     public static       BuildingEntry fletcher;\n     public static       BuildingEntry mechanic;\n+    public static BuildingEntry tavern;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjYwNzU0Ng=="}, "originalCommit": {"oid": "9418a9ac66c36f4178e996857b39fbf9147d12d7"}, "originalPosition": 35}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzY1NTczNA==", "bodyText": "If I see this correctly, this would allow for a custom ICitizenData implementation to be used.\nI do not think this is a good idea.\nA better approach to solve this problem would be to make ICitizenData an ICapabilityProvider and via this way allow the handling and adaptation of custom data on a given citizen.", "url": "https://github.com/ldtteam/minecolonies/pull/4894#discussion_r423655734", "createdAt": "2020-05-12T11:19:26Z", "author": {"login": "OrionDevelopment"}, "path": "src/api/java/com/minecolonies/api/colony/citizen/CitizenDataRegistryEntry.java", "diffHunk": "@@ -0,0 +1,50 @@\n+package com.minecolonies.api.colony.citizen;\n+\n+import com.minecolonies.api.colony.ICitizenData;\n+import com.minecolonies.api.colony.IColony;\n+import com.minecolonies.api.util.Log;\n+import net.minecraft.nbt.CompoundNBT;\n+import net.minecraft.util.ResourceLocation;\n+import net.minecraftforge.registries.ForgeRegistryEntry;\n+import net.minecraftforge.registries.IForgeRegistryEntry;\n+import org.jetbrains.annotations.NotNull;\n+\n+import java.util.function.BiFunction;\n+\n+/**\n+ * Registry entry for citizen data types, matches a resource location id to a creation function.\n+ */\n+public class CitizenDataRegistryEntry extends ForgeRegistryEntry<CitizenDataRegistryEntry> implements IForgeRegistryEntry<CitizenDataRegistryEntry>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b22cf061446cdb8cc23aad399cb917adcbd50971"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzY1NjgzNg==", "bodyText": "Since i also see no real reason why this is part of this PR, it should be split of into a seperate one.", "url": "https://github.com/ldtteam/minecolonies/pull/4894#discussion_r423656836", "createdAt": "2020-05-12T11:21:31Z", "author": {"login": "OrionDevelopment"}, "path": "src/api/java/com/minecolonies/api/colony/citizen/CitizenDataRegistryEntry.java", "diffHunk": "@@ -0,0 +1,50 @@\n+package com.minecolonies.api.colony.citizen;\n+\n+import com.minecolonies.api.colony.ICitizenData;\n+import com.minecolonies.api.colony.IColony;\n+import com.minecolonies.api.util.Log;\n+import net.minecraft.nbt.CompoundNBT;\n+import net.minecraft.util.ResourceLocation;\n+import net.minecraftforge.registries.ForgeRegistryEntry;\n+import net.minecraftforge.registries.IForgeRegistryEntry;\n+import org.jetbrains.annotations.NotNull;\n+\n+import java.util.function.BiFunction;\n+\n+/**\n+ * Registry entry for citizen data types, matches a resource location id to a creation function.\n+ */\n+public class CitizenDataRegistryEntry extends ForgeRegistryEntry<CitizenDataRegistryEntry> implements IForgeRegistryEntry<CitizenDataRegistryEntry>", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzY1NTczNA=="}, "originalCommit": {"oid": "b22cf061446cdb8cc23aad399cb917adcbd50971"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzY1Nzk2NA==", "bodyText": "Your warning references the wrong class name: Should be: ModCitizenDataTypeInitializer?", "url": "https://github.com/ldtteam/minecolonies/pull/4894#discussion_r423657964", "createdAt": "2020-05-12T11:23:45Z", "author": {"login": "OrionDevelopment"}, "path": "src/main/java/com/minecolonies/apiimp/initializer/ModCitizenDataTypeInitializer.java", "diffHunk": "@@ -0,0 +1,23 @@\n+package com.minecolonies.apiimp.initializer;\n+\n+import com.minecolonies.api.colony.citizen.CitizenDataRegistryEntry;\n+import com.minecolonies.coremod.colony.CitizenData;\n+import net.minecraftforge.event.RegistryEvent;\n+import net.minecraftforge.registries.IForgeRegistry;\n+\n+/**\n+ * Initializer for citizen data registry entries\n+ */\n+public class ModCitizenDataTypeInitializer\n+{\n+    private ModCitizenDataTypeInitializer()\n+    {\n+        throw new IllegalStateException(\"Tried to initialize: CitizenDataInitializer but this is a Utility class.\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b22cf061446cdb8cc23aad399cb917adcbd50971"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzY1OTUxNA==", "bodyText": "Remove this class from this PR.\nAs stated it is not needed, can be added later again, but for now please do not mix feature and infrastructure or bugfixes in one PR but split them in several.\nMixing the goals of a PR makes things harder.", "url": "https://github.com/ldtteam/minecolonies/pull/4894#discussion_r423659514", "createdAt": "2020-05-12T11:26:41Z", "author": {"login": "OrionDevelopment"}, "path": "src/main/java/com/minecolonies/coremod/colony/colonyEvents/ColonyRecruitableCitizenEvent.java", "diffHunk": "@@ -0,0 +1,226 @@\n+package com.minecolonies.coremod.colony.colonyEvents;\n+\n+import com.minecolonies.api.colony.ICitizenData;\n+import com.minecolonies.api.colony.IColony;\n+import com.minecolonies.api.colony.colonyEvents.EventStatus;\n+import com.minecolonies.api.colony.colonyEvents.IColonyEntitySpawnEvent;\n+import com.minecolonies.api.util.BlockPosUtil;\n+import com.minecolonies.coremod.colony.CitizenData;\n+import net.minecraft.entity.Entity;\n+import net.minecraft.entity.LivingEntity;\n+import net.minecraft.nbt.CompoundNBT;\n+import net.minecraft.nbt.INBT;\n+import net.minecraft.nbt.ListNBT;\n+import net.minecraft.util.ResourceLocation;\n+import net.minecraft.util.math.BlockPos;\n+import org.jetbrains.annotations.NotNull;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+\n+import static com.minecolonies.api.colony.colonyEvents.NBTTags.*;\n+import static com.minecolonies.api.util.constant.Constants.MOD_ID;\n+import static com.minecolonies.api.util.constant.Constants.TAG_COMPOUND;\n+import static com.minecolonies.api.util.constant.NbtTagConstants.TAG_CITIZENS;\n+\n+/**\n+ * TODO: unused for now, implement soon\n+ * Event for recruitable citizens spawning in the tavern\n+ */\n+public class ColonyRecruitableCitizenEvent implements IColonyEntitySpawnEvent", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b22cf061446cdb8cc23aad399cb917adcbd50971"}, "originalPosition": 30}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzY2MTM2Nw==", "bodyText": "This needs to be way more dynamic.\nI already told ray this.\nPlease find a way to make this more fluently useable.\nInstead of doing a bunch of if switches design a registry or even a better placement logic system todo this.", "url": "https://github.com/ldtteam/minecolonies/pull/4894#discussion_r423661367", "createdAt": "2020-05-12T11:30:14Z", "author": {"login": "OrionDevelopment"}, "path": "src/main/java/com/minecolonies/coremod/colony/managers/BuildingManager.java", "diffHunk": "@@ -612,4 +619,43 @@ private void addField(@NotNull final BlockPos pos)\n         }\n         colony.markDirty();\n     }\n+\n+    @Override\n+    public boolean canPlaceAt(final Block block, final BlockPos pos, final PlayerEntity player)\n+    {\n+        if (block instanceof BlockHutWareHouse)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b22cf061446cdb8cc23aad399cb917adcbd50971"}, "originalPosition": 37}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fec6d9e0c49561d3ccd30e8557bb57e42318016b", "author": {"user": {"login": "someaddons", "name": null}}, "url": "https://github.com/ldtteam/minecolonies/commit/fec6d9e0c49561d3ccd30e8557bb57e42318016b", "committedDate": "2020-05-12T18:58:34Z", "message": "Removing citizen data registry and unused event"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "71c95a38030ec21b5de6ab9e77ef6f344866683c", "author": {"user": {"login": "someaddons", "name": null}}, "url": "https://github.com/ldtteam/minecolonies/commit/71c95a38030ec21b5de6ab9e77ef6f344866683c", "committedDate": "2020-05-12T18:59:42Z", "message": "Merge remote-tracking branch 'remotes/origin/version/1.15' into Tavern"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEwNzQ3ODUw", "url": "https://github.com/ldtteam/minecolonies/pull/4894#pullrequestreview-410747850", "createdAt": "2020-05-13T09:27:18Z", "commit": {"oid": "71c95a38030ec21b5de6ab9e77ef6f344866683c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2235, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}