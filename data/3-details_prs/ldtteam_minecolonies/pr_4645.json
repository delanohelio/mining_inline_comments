{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA0MDM5NTMx", "number": 4645, "title": "Feature/1.15/warehouse inventory, new inventory tab", "bodyText": "Changes proposed in this pull request:\n\ncreates a new tab in the Warehose screen which displays the Inventory of all Racks belonging to that Warehouse\na lot of Formating changes due re run of the code formating settings in IntelliJ\n\nCurrently requires #4634 to be merged first\nReview please", "createdAt": "2020-04-15T23:33:53Z", "url": "https://github.com/ldtteam/minecolonies/pull/4645", "merged": true, "mergeCommit": {"oid": "3cbaefebf3b7e84c76be70ae399c955031b4e9fb"}, "closed": true, "closedAt": "2020-04-22T14:34:33Z", "author": {"login": "lexustec"}, "timelineItems": {"totalCount": 40, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcXi3pxAH2gAyNDA0MDM5NTMxOjQ0YWJhYTBmMjU3OWYzMGUxNGVmODg2MzI2MTRjNDI4MjQ1NjhlM2Y=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcZ7JVZgH2gAyNDA0MDM5NTMxOmIxMmEzODdjN2ZiOWVkMDQ1MGJlYjc0YzkwNjMwMTI3YjJiMWYzMzk=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "44abaa0f2579f30e14ef88632614c42824568e3f", "author": {"user": {"login": "lexustec", "name": null}}, "url": "https://github.com/ldtteam/minecolonies/commit/44abaa0f2579f30e14ef88632614c42824568e3f", "committedDate": "2020-04-14T12:43:54Z", "message": "Change in BuilderAi to be a little bit more smart\n\nChanged the System to reflect more proper requests if needed material is bigger than stacksize. and also to pick not only full stacks.. instead real values."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "221e836fa6ce2fcfd316e22393c70c21f6e8f89b", "author": {"user": {"login": "lexustec", "name": null}}, "url": "https://github.com/ldtteam/minecolonies/commit/221e836fa6ce2fcfd316e22393c70c21f6e8f89b", "committedDate": "2020-04-14T13:34:07Z", "message": "Change in BuilderAi to be a little bit more smart---still has a bug\n\nChanged the System to reflect more proper requests if needed material is bigger than stacksize. and also to pick not only full stacks.. instead real values."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8a848f3ff39d26c4930d79c1d8ed9ca5163d8eed", "author": {"user": {"login": "lexustec", "name": null}}, "url": "https://github.com/ldtteam/minecolonies/commit/8a848f3ff39d26c4930d79c1d8ed9ca5163d8eed", "committedDate": "2020-04-14T13:34:24Z", "message": "Merge remote-tracking branch 'origin/version/1.15' into version/1.15"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "147e61250c888807be5b12a96f34bbd90bf4ad01", "author": {"user": {"login": "lexustec", "name": null}}, "url": "https://github.com/ldtteam/minecolonies/commit/147e61250c888807be5b12a96f34bbd90bf4ad01", "committedDate": "2020-04-14T13:35:30Z", "message": "Change in BuilderAi to be a little bit more smart\n\nBugfix... endless loop at bigger buildings"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5436848a18e4e2dfaedd6ee5283bb5617e738263", "author": {"user": {"login": "Raycoms", "name": null}}, "url": "https://github.com/ldtteam/minecolonies/commit/5436848a18e4e2dfaedd6ee5283bb5617e738263", "committedDate": "2020-04-14T14:16:31Z", "message": "Merge branch 'version/1.15' into version/1.15"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0645923db7baed91a5669383e7e101b29eb13e9c", "author": {"user": {"login": "lexustec", "name": null}}, "url": "https://github.com/ldtteam/minecolonies/commit/0645923db7baed91a5669383e7e101b29eb13e9c", "committedDate": "2020-04-14T22:50:24Z", "message": "Modified and moved AI code\n\nChanged the System to reflect more proper requests if needed material is bigger than stacksize. and also to pick not only full stacks.. instead real needed values."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8926eaa3e83df3954ebdbc259c811b7f8388e313", "author": {"user": {"login": "lexustec", "name": null}}, "url": "https://github.com/ldtteam/minecolonies/commit/8926eaa3e83df3954ebdbc259c811b7f8388e313", "committedDate": "2020-04-14T22:51:27Z", "message": "Merge remote-tracking branch 'origin/version/1.15' into version/1.15"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2240f28e9515e25de0e54fc87cc762ebdfb03279", "author": {"user": {"login": "lexustec", "name": null}}, "url": "https://github.com/ldtteam/minecolonies/commit/2240f28e9515e25de0e54fc87cc762ebdfb03279", "committedDate": "2020-04-14T23:03:06Z", "message": "formatting change\n\nfixed formatting"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "01be50403e86161e6c208250db4adb5ac9f90bd8", "author": {"user": {"login": "lexustec", "name": null}}, "url": "https://github.com/ldtteam/minecolonies/commit/01be50403e86161e6c208250db4adb5ac9f90bd8", "committedDate": "2020-04-15T06:02:50Z", "message": "Fix and format"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fe885b21d65873591ea85e1ed149ed0861780a71", "author": {"user": {"login": "lexustec", "name": null}}, "url": "https://github.com/ldtteam/minecolonies/commit/fe885b21d65873591ea85e1ed149ed0861780a71", "committedDate": "2020-04-15T06:26:37Z", "message": "Format Fix\n\nFixed again. now should be good"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fb8b4a415ac2bf5ab5f2ce926469f3e379bc3c55", "author": {"user": {"login": "lexustec", "name": null}}, "url": "https://github.com/ldtteam/minecolonies/commit/fb8b4a415ac2bf5ab5f2ce926469f3e379bc3c55", "committedDate": "2020-04-15T09:59:24Z", "message": "Tuple replace\n\nNow it should be ready for review"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e570e69500186e03ca671be786c93e668cf62028", "author": {"user": {"login": "lexustec", "name": null}}, "url": "https://github.com/ldtteam/minecolonies/commit/e570e69500186e03ca671be786c93e668cf62028", "committedDate": "2020-04-15T23:09:56Z", "message": "Warehouse Inventory Total page working\n\nThe Warehouse got a new page which lists now all Warehouse connected Inventory. Icons still missing and window text is abstract for now. I didnt want to fuzz in the Language files for now. correct name needs to be found. Tech wise works nice. Ready for test"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk0NTQ4NDU4", "url": "https://github.com/ldtteam/minecolonies/pull/4645#pullrequestreview-394548458", "createdAt": "2020-04-16T11:40:25Z", "commit": {"oid": "e570e69500186e03ca671be786c93e668cf62028"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNlQxMTo0MDoyNVrOGGhPrQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNlQxMTo0MDoyNVrOGGhPrQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTQ4OTMyNQ==", "bodyText": "our buildings already have a list of containers, called containerList. So you don't need to add all this stuff", "url": "https://github.com/ldtteam/minecolonies/pull/4645#discussion_r409489325", "createdAt": "2020-04-16T11:40:25Z", "author": {"login": "someaddons"}, "path": "src/main/java/com/minecolonies/coremod/colony/buildings/workerbuildings/BuildingWareHouse.java", "diffHunk": "@@ -525,6 +537,8 @@ else if (request != null)\n          */\n         private boolean reachedLimit = false;\n \n+        private List<BlockPos> storageracks = new ArrayList<>();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e570e69500186e03ca671be786c93e668cf62028"}, "originalPosition": 159}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk0NTUwODU3", "url": "https://github.com/ldtteam/minecolonies/pull/4645#pullrequestreview-394550857", "createdAt": "2020-04-16T11:44:15Z", "commit": {"oid": "e570e69500186e03ca671be786c93e668cf62028"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNlQxMTo0NDoxNlrOGGhXfg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNlQxMTo0NDoxNlrOGGhXfg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTQ5MTMyNg==", "bodyText": "make it two parameters isntead of the tuple", "url": "https://github.com/ldtteam/minecolonies/pull/4645#discussion_r409491326", "createdAt": "2020-04-16T11:44:16Z", "author": {"login": "someaddons"}, "path": "src/main/java/com/minecolonies/coremod/entity/ai/basic/AbstractEntityAIBasic.java", "diffHunk": "@@ -1463,19 +1435,58 @@ public boolean checkIfRequestForItemExistOrCreateAsynch(@NotNull final ItemStack\n      * @param predicate the predicate to evaluate.\n      * @return true if succesful.\n      */\n-    private boolean tryTransferFromPosToWorker(final BlockPos pos, @NotNull final Predicate<ItemStack> predicate)\n+\n+    private boolean tryTransferFromPosToWorker(final BlockPos pos, @NotNull final Tuple<Predicate<ItemStack>, Integer> predicate)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e570e69500186e03ca671be786c93e668cf62028"}, "originalPosition": 405}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk0NTUxNDMx", "url": "https://github.com/ldtteam/minecolonies/pull/4645#pullrequestreview-394551431", "createdAt": "2020-04-16T11:45:08Z", "commit": {"oid": "e570e69500186e03ca671be786c93e668cf62028"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNlQxMTo0NTowOFrOGGhZNg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNlQxMTo0NTowOFrOGGhZNg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTQ5MTc2Ng==", "bodyText": "sure this is right? tryTransferFromPosToWorker doesnt seem like a function which checks the own inventory for contains", "url": "https://github.com/ldtteam/minecolonies/pull/4645#discussion_r409491766", "createdAt": "2020-04-16T11:45:08Z", "author": {"login": "someaddons"}, "path": "src/main/java/com/minecolonies/coremod/entity/ai/basic/AbstractEntityAIBasic.java", "diffHunk": "@@ -1463,19 +1435,58 @@ public boolean checkIfRequestForItemExistOrCreateAsynch(@NotNull final ItemStack\n      * @param predicate the predicate to evaluate.\n      * @return true if succesful.\n      */\n-    private boolean tryTransferFromPosToWorker(final BlockPos pos, @NotNull final Predicate<ItemStack> predicate)\n+\n+    private boolean tryTransferFromPosToWorker(final BlockPos pos, @NotNull final Tuple<Predicate<ItemStack>, Integer> predicate)\n     {\n         final TileEntity entity = world.getTileEntity(pos);\n         if (entity == null)\n         {\n             return false;\n         }\n \n-        return InventoryUtils.transferXOfFirstSlotInProviderWithIntoNextFreeSlotInItemHandler(\n-          entity,\n-          predicate,\n-          Constants.STACKSIZE,\n-          worker.getInventoryCitizen());\n+        final int existingAmount = InventoryUtils.getItemCountInItemHandler(worker.getInventoryCitizen(), predicate.getA());\n+        int amount = 0;\n+        if (predicate.getB() > existingAmount)\n+        {\n+            amount = predicate.getB() - existingAmount;\n+        }\n+        else\n+        {\n+            return true; // has already needed transfers...", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e570e69500186e03ca671be786c93e668cf62028"}, "originalPosition": 426}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk0NTUyNjIx", "url": "https://github.com/ldtteam/minecolonies/pull/4645#pullrequestreview-394552621", "createdAt": "2020-04-16T11:47:00Z", "commit": {"oid": "e570e69500186e03ca671be786c93e668cf62028"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNlQxMTo0NzowMVrOGGhc5Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNlQxMTo0NzowMVrOGGhc5Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTQ5MjcwOQ==", "bodyText": "why Constants.STACKSIZE instead of inputStorage.amount?", "url": "https://github.com/ldtteam/minecolonies/pull/4645#discussion_r409492709", "createdAt": "2020-04-16T11:47:01Z", "author": {"login": "someaddons"}, "path": "src/main/java/com/minecolonies/coremod/entity/ai/basic/AbstractEntityAICrafting.java", "diffHunk": "@@ -164,19 +169,20 @@ private IAIState queryItems()\n \n     /**\n      * Check for all items of the required recipe.\n+     *\n      * @return the next state to go to.\n      */\n     protected IAIState checkForItems(@NotNull final IRecipeStorage storage)\n     {\n         final List<ItemStorage> input = storage.getCleanedInput();\n-        for(final ItemStorage inputStorage : input)\n+        for (final ItemStorage inputStorage : input)\n         {\n             final Predicate<ItemStack> predicate = stack -> !ItemStackUtils.isEmpty(stack) && new Stack(stack).matches(inputStorage.getItemStack());\n             if (InventoryUtils.getItemCountInItemHandler(worker.getInventoryCitizen(), predicate) < inputStorage.getAmount())\n             {\n                 if (InventoryUtils.hasItemInProvider(getOwnBuilding(), predicate))\n                 {\n-                    needsCurrently = predicate;\n+                    needsCurrently = new Tuple<>(predicate, Constants.STACKSIZE);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e570e69500186e03ca671be786c93e668cf62028"}, "originalPosition": 64}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "07afbdb0b048c49c8ba18e5f088f8d37167990a5", "author": {"user": {"login": "lexustec", "name": null}}, "url": "https://github.com/ldtteam/minecolonies/commit/07afbdb0b048c49c8ba18e5f088f8d37167990a5", "committedDate": "2020-04-16T15:30:41Z", "message": "Reformed Itemcollection and Filters\n\nAdded features to the screen and fixed icon display."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1efa32f8e6f60456d89860776d7889d525992196", "author": {"user": {"login": "lexustec", "name": null}}, "url": "https://github.com/ldtteam/minecolonies/commit/1efa32f8e6f60456d89860776d7889d525992196", "committedDate": "2020-04-16T16:22:12Z", "message": "Minor changes\n\nchanged icon display, added language entry, removed inventory button and resized list"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8a1029b5bd31af85d7627964bce6878808a56b78", "author": {"user": {"login": "lexustec", "name": null}}, "url": "https://github.com/ldtteam/minecolonies/commit/8a1029b5bd31af85d7627964bce6878808a56b78", "committedDate": "2020-04-16T22:34:34Z", "message": "Added code for big recipes to average out items"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk1NzUxNTQ2", "url": "https://github.com/ldtteam/minecolonies/pull/4645#pullrequestreview-395751546", "createdAt": "2020-04-17T20:26:58Z", "commit": {"oid": "8a1029b5bd31af85d7627964bce6878808a56b78"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xN1QyMDoyNjo1OVrOGHcFvA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xN1QyMDoyNjo1OVrOGHcFvA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDQ1MzQzNg==", "bodyText": "private + javadoc please", "url": "https://github.com/ldtteam/minecolonies/pull/4645#discussion_r410453436", "createdAt": "2020-04-17T20:26:59Z", "author": {"login": "Raycoms"}, "path": "src/main/java/com/minecolonies/coremod/client/gui/WindowHutWareHouse.java", "diffHunk": "@@ -107,6 +146,37 @@ private void addStock()\n         }\n     }\n \n+    void setSortFlag()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8a1029b5bd31af85d7627964bce6878808a56b78"}, "originalPosition": 111}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk1NzUxOTA5", "url": "https://github.com/ldtteam/minecolonies/pull/4645#pullrequestreview-395751909", "createdAt": "2020-04-17T20:27:39Z", "commit": {"oid": "8a1029b5bd31af85d7627964bce6878808a56b78"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xN1QyMDoyNzozOVrOGHcG4w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xN1QyMDoyNzozOVrOGHcG4w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDQ1MzczMQ==", "bodyText": "javadoc for the remaining options please", "url": "https://github.com/ldtteam/minecolonies/pull/4645#discussion_r410453731", "createdAt": "2020-04-17T20:27:39Z", "author": {"login": "Raycoms"}, "path": "src/main/java/com/minecolonies/coremod/client/gui/WindowHutWareHouse.java", "diffHunk": "@@ -36,10 +46,36 @@\n  */\n public class WindowHutWareHouse extends AbstractWindowBuilding<BuildingWareHouse.View>\n {\n+    /**\n+     * List of all item stacks in the warehouse.\n+     */\n+    List<ItemStorage> allItems = new ArrayList<>();\n+\n+    /**\n+     * Resource scrolling list.\n+     */\n+    private final       ScrollingList stackList;\n+    /**\n+     * The filter for the resource list.\n+     */\n+    private             String        filter          = \"\";\n+    /**\n+     * The sortDescriptor so how we want to sort\n+     */\n+    public static final int           NO_SORT         = 0;\n+    public static final int           ASC_SORT        = 1;\n+    public static final int           DESC_SORT       = 2;\n+    public static final int           COUNT_ASC_SORT  = 3;\n+    public static final int           COUNT_DESC_SORT = 4;\n+    int sortDescriptor = 0;\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8a1029b5bd31af85d7627964bce6878808a56b78"}, "originalPosition": 73}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk1NzUyNDY2", "url": "https://github.com/ldtteam/minecolonies/pull/4645#pullrequestreview-395752466", "createdAt": "2020-04-17T20:28:39Z", "commit": {"oid": "8a1029b5bd31af85d7627964bce6878808a56b78"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xN1QyMDoyODozOVrOGHcIlA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xN1QyMDoyODozOVrOGHcIlA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDQ1NDE2NA==", "bodyText": "Btw, there is already a way to get ItemStorage from the rack without having to go through all slots", "url": "https://github.com/ldtteam/minecolonies/pull/4645#discussion_r410454164", "createdAt": "2020-04-17T20:28:39Z", "author": {"login": "Raycoms"}, "path": "src/main/java/com/minecolonies/coremod/client/gui/WindowHutWareHouse.java", "diffHunk": "@@ -247,6 +315,151 @@ public void updateElement(final int index, @NotNull final Pane rowPane)\n         });\n     }\n \n+    /**\n+     * Update the item list.\n+     */\n+    private void updateResources()\n+    {\n+        List<ItemStorage> filterItems = new ArrayList<>();\n+        final List<BlockPos> containerList = building.getContainerList();\n+        List<ItemStack> items = new ArrayList<>();\n+        int count = containerList.size();\n+        World world = building.getColony().getWorld();\n+\n+        for (int s = 0; s < count; s++)\n+        {\n+            final TileEntity rack = world.getTileEntity(containerList.get(s));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8a1029b5bd31af85d7627964bce6878808a56b78"}, "originalPosition": 189}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e47563d34d705e908dfb1f45f64628d50386808f", "author": {"user": {"login": "lexustec", "name": null}}, "url": "https://github.com/ldtteam/minecolonies/commit/e47563d34d705e908dfb1f45f64628d50386808f", "committedDate": "2020-04-17T21:20:59Z", "message": "Formatting changes and Javadoc"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cf2aa8c60b591f31d5a2c74cfa8269151a0ba29e", "author": {"user": {"login": "lexustec", "name": null}}, "url": "https://github.com/ldtteam/minecolonies/commit/cf2aa8c60b591f31d5a2c74cfa8269151a0ba29e", "committedDate": "2020-04-18T08:08:02Z", "message": "Changing in how to get the stacks to the view"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "64edb315145cf3ae49f64388a6714b0f8ee7a893", "author": {"user": {"login": "lexustec", "name": null}}, "url": "https://github.com/ldtteam/minecolonies/commit/64edb315145cf3ae49f64388a6714b0f8ee7a893", "committedDate": "2020-04-18T11:23:51Z", "message": "Merge remote-tracking branch 'upstream/version/1.15' into feature/1.15/warehouse_inventory"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4037f0c58a7743f5f347ff93ea6ad9fe2a9907bf", "author": {"user": {"login": "lexustec", "name": null}}, "url": "https://github.com/ldtteam/minecolonies/commit/4037f0c58a7743f5f347ff93ea6ad9fe2a9907bf", "committedDate": "2020-04-18T11:32:06Z", "message": "Mergefix"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "da931a9346c460b4eb448c622547121f8d4d7257", "author": {"user": {"login": "lexustec", "name": null}}, "url": "https://github.com/ldtteam/minecolonies/commit/da931a9346c460b4eb448c622547121f8d4d7257", "committedDate": "2020-04-18T21:19:36Z", "message": "Updated Position of Inventory Stuff\n\nWindow in Inventoryview bugs left..."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c47415674f3c05bc4a57db988a1127236da3857d", "author": {"user": {"login": "lexustec", "name": null}}, "url": "https://github.com/ldtteam/minecolonies/commit/c47415674f3c05bc4a57db988a1127236da3857d", "committedDate": "2020-04-18T21:36:58Z", "message": "small fixes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "60c12b93f403fddd125c6849bada49fe8953d89b", "author": {"user": {"login": "lexustec", "name": null}}, "url": "https://github.com/ldtteam/minecolonies/commit/60c12b93f403fddd125c6849bada49fe8953d89b", "committedDate": "2020-04-19T08:19:21Z", "message": "Positioning fix"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk2NTEzMTE2", "url": "https://github.com/ldtteam/minecolonies/pull/4645#pullrequestreview-396513116", "createdAt": "2020-04-20T14:34:39Z", "commit": {"oid": "60c12b93f403fddd125c6849bada49fe8953d89b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMFQxNDozNDo0MFrOGIXofQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMFQxNDozNDo0MFrOGIXofQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTQyODk4OQ==", "bodyText": "if not instanceof TileEntityRack but rack.getCapability(IItemHandlerCap) then  get itemhandler and iterate over slots.", "url": "https://github.com/ldtteam/minecolonies/pull/4645#discussion_r411428989", "createdAt": "2020-04-20T14:34:40Z", "author": {"login": "Raycoms"}, "path": "src/main/java/com/minecolonies/coremod/client/gui/WindowHutAllInventory.java", "diffHunk": "@@ -0,0 +1,251 @@\n+package com.minecolonies.coremod.client.gui;\n+\n+import com.ldtteam.blockout.Pane;\n+import com.ldtteam.blockout.controls.*;\n+import com.ldtteam.blockout.views.ScrollingList;\n+import com.minecolonies.api.colony.buildings.views.IBuildingView;\n+import com.minecolonies.api.crafting.ItemStorage;\n+import com.minecolonies.api.tileentities.TileEntityRack;\n+import com.minecolonies.api.util.Log;\n+import com.minecolonies.api.util.constant.Constants;\n+\n+import com.minecolonies.coremod.colony.buildings.AbstractBuilding;\n+import net.minecraft.item.Item;\n+import net.minecraft.item.ItemStack;\n+import net.minecraft.tileentity.TileEntity;\n+import net.minecraft.util.math.BlockPos;\n+import net.minecraft.world.World;\n+import org.jetbrains.annotations.NotNull;\n+\n+import java.util.*;\n+import java.util.function.Predicate;\n+import java.util.stream.Collectors;\n+\n+import static com.minecolonies.api.util.constant.WindowConstants.*;\n+import com.minecolonies.api.util.constant.WindowConstants;\n+/**\n+ * Window for a hut name entry.\n+ */\n+public class WindowHutAllInventory extends AbstractWindowSkeleton\n+{\n+\n+    /**\n+     * List of all item stacks in the warehouse.\n+     */\n+    List<ItemStorage> allItems = new ArrayList<>();\n+\n+    /**\n+     * Resource scrolling list.\n+     */\n+    private final ScrollingList stackList;\n+    /**\n+     * The filter for the resource list.\n+     */\n+    private       String        filter         = \"\";\n+    /**\n+     * The sortDescriptor so how we want to sort\n+     */\n+    private       int           sortDescriptor = 0;\n+\n+    /**\n+     * The building associated to the GUI.\n+     */\n+    private final IBuildingView building;\n+\n+    /**\n+     * Constructor for a hut rename entry window.\n+     *\n+     * @param b {@link AbstractBuilding}\n+     */\n+    public WindowHutAllInventory(final IBuildingView b)\n+    {\n+        super(Constants.MOD_ID + HUT_ALL_INVENTORY_SUFFIX);\n+        this.building = b;\n+        registerButton(BUTTON_SORT, this::setSortFlag);\n+        this.stackList = findPaneOfTypeByID(LIST_ALLINVENTORY, ScrollingList.class);\n+        updateResources();\n+    }\n+\n+    @Override\n+    public void onOpened()\n+    {\n+\n+    }\n+\n+    /**\n+     * Increments the sortDescriptor and sets the GUI Button accordingly Valid Stages 0 - 4 NO_SORT         0   No Sorting, like wysiwyg ASC_SORT        1   Name Ascending\n+     * DESC_SORT       2   Name Descending COUNT_ASC_SORT  3   Itemcount Ascending COUNT_DESC_SORT 4   Itemcount Descending\n+     **/\n+    private void setSortFlag()\n+    {\n+        sortDescriptor++;\n+        if (sortDescriptor > 4)\n+        {\n+            sortDescriptor = NO_SORT;\n+        }\n+        switch (sortDescriptor)\n+        {\n+            case NO_SORT:\n+                findPaneOfTypeByID(BUTTON_SORT, ButtonImage.class).setLabel(\"v^\");\n+                break;\n+            case ASC_SORT:\n+                findPaneOfTypeByID(BUTTON_SORT, ButtonImage.class).setLabel(\"A^\");\n+                break;\n+            case DESC_SORT:\n+                findPaneOfTypeByID(BUTTON_SORT, ButtonImage.class).setLabel(\"Av\");\n+                break;\n+            case COUNT_ASC_SORT:\n+                findPaneOfTypeByID(BUTTON_SORT, ButtonImage.class).setLabel(\"1^\");\n+                break;\n+            case COUNT_DESC_SORT:\n+                findPaneOfTypeByID(BUTTON_SORT, ButtonImage.class).setLabel(\"1v\");\n+                break;\n+            default:\n+                break;\n+        }\n+\n+        updateResources();\n+    }\n+\n+    /**\n+     * Update the item list.\n+     */\n+    private void updateResources()\n+    {\n+        List<ItemStorage> filterItems = new ArrayList<>();\n+        final List<BlockPos> containerList = building.getContainerList();\n+        List<ItemStack> items = new ArrayList<>();\n+        int count = containerList.size();\n+        World world = building.getColony().getWorld();\n+        for (int s = 0; s < count; s++)\n+        {\n+            final TileEntity rack = world.getTileEntity(containerList.get(s));\n+            if (rack instanceof TileEntityRack)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "60c12b93f403fddd125c6849bada49fe8953d89b"}, "originalPosition": 123}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fb94c5831366a60a840ca241d583acbdfca2a4f3", "author": {"user": {"login": "lexustec", "name": null}}, "url": "https://github.com/ldtteam/minecolonies/commit/fb94c5831366a60a840ca241d583acbdfca2a4f3", "committedDate": "2020-04-20T19:41:46Z", "message": "Added ChestTileEntity in Inventory slot check"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "352474a6b06954aa709398a11f4930975fba1c0a", "author": {"user": {"login": "lexustec", "name": null}}, "url": "https://github.com/ldtteam/minecolonies/commit/352474a6b06954aa709398a11f4930975fba1c0a", "committedDate": "2020-04-20T19:52:11Z", "message": "if to else if"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk2OTk5MjE5", "url": "https://github.com/ldtteam/minecolonies/pull/4645#pullrequestreview-396999219", "createdAt": "2020-04-21T05:35:50Z", "commit": {"oid": "352474a6b06954aa709398a11f4930975fba1c0a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ac346e525cd1dd66e843ae3e05425a53856c44db", "author": {"user": {"login": "Raycoms", "name": null}}, "url": "https://github.com/ldtteam/minecolonies/commit/ac346e525cd1dd66e843ae3e05425a53856c44db", "committedDate": "2020-04-21T10:25:33Z", "message": "small fixes (#4691)\n\nFix some university issues\r\nAdd some more block recipes to the stonemason"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "97733f57ddc533787c59e54a5e799080e1ef511a", "author": {"user": {"login": "Raycoms", "name": null}}, "url": "https://github.com/ldtteam/minecolonies/commit/97733f57ddc533787c59e54a5e799080e1ef511a", "committedDate": "2020-04-21T10:55:21Z", "message": "Hotfix allow to detect non minecolonies hutblock"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "37d8e98cf01fbf7923df93af8c9c1677962bb88e", "author": {"user": {"login": "Raycoms", "name": null}}, "url": "https://github.com/ldtteam/minecolonies/commit/37d8e98cf01fbf7923df93af8c9c1677962bb88e", "committedDate": "2020-04-21T10:56:02Z", "message": "fix imports"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "221cdcce338baca75e65b007902607fb5959ae98", "author": {"user": {"login": "Raycoms", "name": null}}, "url": "https://github.com/ldtteam/minecolonies/commit/221cdcce338baca75e65b007902607fb5959ae98", "committedDate": "2020-04-21T11:15:41Z", "message": "hotfix max happiness (#4692)\n\nMax happiness fix"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6e41233cbc78ad0c16425cdbb2f3fa8ce9867f47", "author": {"user": {"login": "Raycoms", "name": null}}, "url": "https://github.com/ldtteam/minecolonies/commit/6e41233cbc78ad0c16425cdbb2f3fa8ce9867f47", "committedDate": "2020-04-21T15:12:51Z", "message": "fix child sounds together, fix placement handling not using forgereg (#4693)\n\nDeclutters sounds a little bit (step 1)\r\nAdds a better way for hut detection for placement handling"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk3NjIwNTMz", "url": "https://github.com/ldtteam/minecolonies/pull/4645#pullrequestreview-397620533", "createdAt": "2020-04-21T19:44:36Z", "commit": {"oid": "352474a6b06954aa709398a11f4930975fba1c0a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMVQxOTo0NDozNlrOGJVd7w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMVQxOTo0NDozNlrOGJVd7w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjQ0MjA5NQ==", "bodyText": "if result == true (since else means the event was not caught by this gui)", "url": "https://github.com/ldtteam/minecolonies/pull/4645#discussion_r412442095", "createdAt": "2020-04-21T19:44:36Z", "author": {"login": "Nightenom"}, "path": "src/main/java/com/minecolonies/coremod/client/gui/WindowHutAllInventory.java", "diffHunk": "@@ -0,0 +1,268 @@\n+package com.minecolonies.coremod.client.gui;\n+\n+import com.ldtteam.blockout.Pane;\n+import com.ldtteam.blockout.controls.*;\n+import com.ldtteam.blockout.views.ScrollingList;\n+import com.minecolonies.api.colony.buildings.views.IBuildingView;\n+import com.minecolonies.api.crafting.ItemStorage;\n+import com.minecolonies.api.tileentities.TileEntityRack;\n+import com.minecolonies.api.util.ItemStackUtils;\n+import com.minecolonies.api.util.Log;\n+import com.minecolonies.api.util.constant.Constants;\n+\n+import com.minecolonies.coremod.colony.buildings.AbstractBuilding;\n+import net.minecraft.item.Item;\n+import net.minecraft.item.ItemStack;\n+import net.minecraft.tileentity.ChestTileEntity;\n+import net.minecraft.tileentity.TileEntity;\n+import net.minecraft.util.math.BlockPos;\n+import net.minecraft.world.World;\n+import org.jetbrains.annotations.NotNull;\n+\n+import java.util.*;\n+import java.util.function.Predicate;\n+import java.util.stream.Collectors;\n+\n+import static com.minecolonies.api.util.constant.WindowConstants.*;\n+\n+import com.minecolonies.api.util.constant.WindowConstants;\n+\n+/**\n+ * Window for a hut name entry.\n+ */\n+public class WindowHutAllInventory extends AbstractWindowSkeleton\n+{\n+\n+    /**\n+     * List of all item stacks in the warehouse.\n+     */\n+    List<ItemStorage> allItems = new ArrayList<>();\n+\n+    /**\n+     * Resource scrolling list.\n+     */\n+    private final ScrollingList stackList;\n+    /**\n+     * The filter for the resource list.\n+     */\n+    private       String        filter         = \"\";\n+    /**\n+     * The sortDescriptor so how we want to sort\n+     */\n+    private       int           sortDescriptor = 0;\n+\n+    /**\n+     * The building associated to the GUI.\n+     */\n+    private final IBuildingView building;\n+\n+    /**\n+     * Constructor for a hut rename entry window.\n+     *\n+     * @param b {@link AbstractBuilding}\n+     */\n+    public WindowHutAllInventory(final IBuildingView b)\n+    {\n+        super(Constants.MOD_ID + HUT_ALL_INVENTORY_SUFFIX);\n+        this.building = b;\n+        registerButton(BUTTON_SORT, this::setSortFlag);\n+        this.stackList = findPaneOfTypeByID(LIST_ALLINVENTORY, ScrollingList.class);\n+        updateResources();\n+    }\n+\n+    @Override\n+    public void onOpened()\n+    {\n+\n+    }\n+\n+    /**\n+     * Increments the sortDescriptor and sets the GUI Button accordingly Valid Stages 0 - 4 NO_SORT         0   No Sorting, like wysiwyg ASC_SORT        1   Name Ascending\n+     * DESC_SORT       2   Name Descending COUNT_ASC_SORT  3   Itemcount Ascending COUNT_DESC_SORT 4   Itemcount Descending\n+     **/\n+    private void setSortFlag()\n+    {\n+        sortDescriptor++;\n+        if (sortDescriptor > 4)\n+        {\n+            sortDescriptor = NO_SORT;\n+        }\n+        switch (sortDescriptor)\n+        {\n+            case NO_SORT:\n+                findPaneOfTypeByID(BUTTON_SORT, ButtonImage.class).setLabel(\"v^\");\n+                break;\n+            case ASC_SORT:\n+                findPaneOfTypeByID(BUTTON_SORT, ButtonImage.class).setLabel(\"A^\");\n+                break;\n+            case DESC_SORT:\n+                findPaneOfTypeByID(BUTTON_SORT, ButtonImage.class).setLabel(\"Av\");\n+                break;\n+            case COUNT_ASC_SORT:\n+                findPaneOfTypeByID(BUTTON_SORT, ButtonImage.class).setLabel(\"1^\");\n+                break;\n+            case COUNT_DESC_SORT:\n+                findPaneOfTypeByID(BUTTON_SORT, ButtonImage.class).setLabel(\"1v\");\n+                break;\n+            default:\n+                break;\n+        }\n+\n+        updateResources();\n+    }\n+\n+    /**\n+     * Update the item list.\n+     */\n+    private void updateResources()\n+    {\n+        List<ItemStorage> filterItems = new ArrayList<>();\n+        final List<BlockPos> containerList = building.getContainerList();\n+\n+        List<ItemStack> items = new ArrayList<>();\n+        int count = containerList.size();\n+        World world = building.getColony().getWorld();\n+        for (int s = 0; s < count; s++)\n+        {\n+            final TileEntity rack = world.getTileEntity(containerList.get(s));\n+            if (rack instanceof TileEntityRack)\n+            {\n+\n+                Map<ItemStorage, Integer> storage = ((TileEntityRack) rack).getAllContent();\n+\n+                for (final Map.Entry<ItemStorage, Integer> entry : storage.entrySet())\n+                {\n+                    items.add(new ItemStorage(entry.getKey().getItemStack(), entry.getValue(), false).getItemStack());\n+                }\n+            }\n+            else if (rack instanceof ChestTileEntity)\n+            {\n+                final int size = ((ChestTileEntity) rack).getSizeInventory();\n+                for (int slot = 0; slot < size; slot++)\n+                {\n+                    final ItemStack stack = ((ChestTileEntity) rack).getStackInSlot(slot);\n+                    if (!ItemStackUtils.isEmpty(stack))\n+                    {\n+                        items.add(stack.copy());\n+                    }\n+                }\n+            }\n+        }\n+\n+        Map<ItemStorage, ItemStorage> storedItems = new HashMap<>();\n+        storedItems.clear();\n+\n+        for (final ItemStack currentItem : items)\n+        {\n+            final ItemStorage currentStorage = new ItemStorage(currentItem, currentItem.getCount(), false);\n+\n+            if (storedItems.containsKey(currentStorage))\n+            {\n+                final ItemStorage existing = storedItems.get(currentStorage);\n+                existing.setAmount(existing.getAmount() + currentStorage.getAmount());\n+            }\n+            else\n+            {\n+                storedItems.put(currentStorage, currentStorage);\n+            }\n+        }\n+\n+        filterItems.clear();\n+        for (ItemStorage entry : storedItems.keySet())\n+        {\n+            filterItems.add(entry);\n+        }\n+\n+        final Predicate<ItemStorage> filterPredicate = stack -> filter.isEmpty()\n+                                                                  || stack.getItemStack().getTranslationKey().toLowerCase(Locale.US).contains(filter.toLowerCase(Locale.US))\n+                                                                  || stack.getItemStack()\n+                                                                       .getDisplayName()\n+                                                                       .getFormattedText()\n+                                                                       .toLowerCase(Locale.US)\n+                                                                       .contains(filter.toLowerCase(Locale.US));\n+\n+        allItems.clear();\n+        if (filter.isEmpty())\n+        {\n+            allItems.addAll(filterItems);\n+        }\n+        else\n+        {\n+            allItems.addAll(filterItems.stream().filter(filterPredicate).collect(Collectors.toList()));\n+        }\n+\n+        Comparator<ItemStorage> compareByName =\n+          (ItemStorage o1, ItemStorage o2) -> o1.getItemStack().getDisplayName().getFormattedText().compareTo(o2.getItemStack().getDisplayName().getFormattedText());\n+        Comparator<ItemStorage> compareByCount = (ItemStorage o1, ItemStorage o2) -> o1.getAmount() - o2.getAmount();\n+        switch (sortDescriptor)\n+        {\n+            case NO_SORT:\n+                break;\n+            case ASC_SORT:\n+                Collections.sort(allItems, compareByName);\n+                break;\n+            case DESC_SORT:\n+                Collections.sort(allItems, compareByName.reversed());\n+                break;\n+            case COUNT_ASC_SORT:\n+                Collections.sort(allItems, compareByCount);\n+                break;\n+            case COUNT_DESC_SORT:\n+                Collections.sort(allItems, compareByCount.reversed());\n+                break;\n+            default:\n+                break;\n+        }\n+\n+        updateResourceList();\n+    }\n+\n+    /**\n+     * Updates the resource list in the GUI with the info we need.\n+     */\n+    private void updateResourceList()\n+    {\n+        stackList.enable();\n+\n+        //Creates a dataProvider for the unemployed stackList.\n+        stackList.setDataProvider(new ScrollingList.DataProvider()\n+        {\n+            /**\n+             * The number of rows of the list.\n+             * @return the number.\n+             */\n+            @Override\n+            public int getElementCount()\n+            {\n+                return allItems.size();\n+            }\n+\n+            /**\n+             * Inserts the elements into each row.\n+             * @param index the index of the row/list element.\n+             * @param rowPane the parent Pane for the row, containing the elements to update.\n+             */\n+            @Override\n+            public void updateElement(final int index, @NotNull final Pane rowPane)\n+            {\n+                ItemStorage resource = allItems.get(index);\n+                final Label resourceLabel = rowPane.findPaneOfTypeByID(\"ressourceStackName\", Label.class);\n+                resourceLabel.setLabelText(resource.getItemStack().getDisplayName().getFormattedText());\n+                final Label qtys = rowPane.findPaneOfTypeByID(\"quantities\", Label.class);\n+                qtys.setLabelText(Integer.toString(resource.getAmount()));\n+                Item imagesrc = resource.getItemStack().getItem();\n+                ItemStack image = new ItemStack(imagesrc, 1);\n+                rowPane.findPaneOfTypeByID(RESOURCE_ICON, ItemIcon.class).setItem(image);\n+            }\n+        });\n+    }\n+\n+    @Override\n+    public boolean onKeyTyped(final char ch, final int key)\n+    {\n+        final boolean result = super.onKeyTyped(ch, key);\n+        filter = findPaneOfTypeByID(\"names\", TextField.class).getText();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "352474a6b06954aa709398a11f4930975fba1c0a"}, "originalPosition": 264}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b12a387c7fb9ed0450beb74c90630127b2b1f339", "author": {"user": {"login": "lexustec", "name": null}}, "url": "https://github.com/ldtteam/minecolonies/commit/b12a387c7fb9ed0450beb74c90630127b2b1f339", "committedDate": "2020-04-21T22:08:47Z", "message": "Merge remote-tracking branch 'upstream/version/1.15' into feature/1.15/warehouse_inventory"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2192, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}