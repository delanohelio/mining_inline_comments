{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzYxNzcxNTA1", "number": 4229, "title": "Fix citizen limit calculation v1.12", "bodyText": "Closes #4191\nCloses #3463\nChanges proposed in this pull request:\nNow Calculates on building upgrade/destruction.\nRecalculates after colony load, instead of reading old values.\nRecruitment of additional guards over the citizen hut limit now works.\nLevel 0 guard-buildings no longer count towards the limit.\nUpdate: Fixed another case and changed it to global instead. So that in the future you only need to adjust the maxCitizenCalc for new buildings/other stuff that houses.\nThe max citizens are now recalculated on:\n\nAssign and removal from a building\nUpgrade and destruction from a building\nremoval of a citizen\nColony load\n\n1.12 only:\nBackported the RackInventory class from 1.14, as on 1.12 we're atm overwriting our setStackinSlot  hook needed for our warehouse and RS\nFixed an ID issue, causing the Townhalls info page to be hidden.\nReview please", "createdAt": "2020-01-11T22:41:01Z", "url": "https://github.com/ldtteam/minecolonies/pull/4229", "merged": true, "mergeCommit": {"oid": "4f8430b6bd72f872393ea914d7e30b67dfe9183b"}, "closed": true, "closedAt": "2020-01-17T09:26:21Z", "author": {"login": "someaddons"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb5bBnkgH2gAyMzYxNzcxNTA1OjZhODM5ZTY2MThmZTQxZjc2YTM3NTFhZGMwMWRhNGE5NTI3OGVmYzY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABb67ugcAFqTM0Mzk4OTUyOQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "6a839e6618fe41f76a3751adc01da4a95278efc6", "author": {"user": {"login": "someaddons", "name": null}}, "url": "https://github.com/ldtteam/minecolonies/commit/6a839e6618fe41f76a3751adc01da4a95278efc6", "committedDate": "2020-01-11T22:37:49Z", "message": "Fix citizen limit calculation.\nNow Calculates on building upgrade/destruction.\nRecalculates after colony load, instead of reading old values.\nRecruitment of additional guards over the citizen hut limit now works.\nLevel 0 guard-buildings no longer count towards the limit.\n\nFix itemrack hooks beeing overwritten on load, backported from 1.14."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQxNTQ0NTI4", "url": "https://github.com/ldtteam/minecolonies/pull/4229#pullrequestreview-341544528", "createdAt": "2020-01-11T22:43:36Z", "commit": {"oid": "6a839e6618fe41f76a3751adc01da4a95278efc6"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xMVQyMjo0MzozNlrOFcnJwg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xMVQyMjo0MzozNlrOFcnJwg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTU0NTkyMg==", "bodyText": "this above overwrote the hooks we setup for setStackInSlot on class load before", "url": "https://github.com/ldtteam/minecolonies/pull/4229#discussion_r365545922", "createdAt": "2020-01-11T22:43:36Z", "author": {"login": "someaddons"}, "path": "src/api/java/com/minecolonies/api/tileentities/TileEntityRack.java", "diffHunk": "@@ -330,15 +330,7 @@ public void readFromNBT(final NBTTagCompound compound)\n             size = compound.getInteger(TAG_SIZE);\n             if (size > 0)\n             {\n-                inventory = new ItemStackHandler(DEFAULT_SIZE + size * SLOT_PER_LINE)\n-                {\n-                    @Override\n-                    protected void onContentsChanged(final int slot)\n-                    {\n-                        updateItemStorage();\n-                        super.onContentsChanged(slot);\n-                    }\n-                };", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6a839e6618fe41f76a3751adc01da4a95278efc6"}, "originalPosition": 12}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "95de3d8dc36c6c8140e3128f33e20a0f79054a92", "author": {"user": {"login": "someaddons", "name": null}}, "url": "https://github.com/ldtteam/minecolonies/commit/95de3d8dc36c6c8140e3128f33e20a0f79054a92", "committedDate": "2020-01-11T22:52:50Z", "message": "fix rack upgrade"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f0ae094f6eb6685b8daa4e48958e396c3fdf1728", "author": {"user": {"login": "someaddons", "name": null}}, "url": "https://github.com/ldtteam/minecolonies/commit/f0ae094f6eb6685b8daa4e48958e396c3fdf1728", "committedDate": "2020-01-13T18:00:49Z", "message": "update citizen limit upon all assigns/removes/building upgrade/destruction"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7af5868e9b1dfb4613b15e9c779d9a222035f8dc", "author": {"user": {"login": "someaddons", "name": null}}, "url": "https://github.com/ldtteam/minecolonies/commit/7af5868e9b1dfb4613b15e9c779d9a222035f8dc", "committedDate": "2020-01-13T21:40:12Z", "message": "fix TH UI issues"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQzOTg5NTI5", "url": "https://github.com/ldtteam/minecolonies/pull/4229#pullrequestreview-343989529", "createdAt": "2020-01-16T15:17:44Z", "commit": {"oid": "7af5868e9b1dfb4613b15e9c779d9a222035f8dc"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2256, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}