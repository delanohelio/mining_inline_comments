{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzYxNzY4NTYx", "number": 4228, "title": "Fix citizen limit calculation", "bodyText": "Closes #4191\nCloses #3463\nChanges proposed in this pull request:\nNow Calculates on building upgrade/destruction.\nRecalculates after colony load, instead of reading old values.\nRecruitment of additional guards over the citizen hut limit now works.\nLevel 0 guard-buildings no longer count towards the limit.\nUpdate: Fixed another case and changed it to global instead. So that in the future you only need to adjust the maxCitizenCalc for new buildings/other stuff that houses.\nThe max citizens are now recalculated on:\n\nAssign and removal from a building\nUpgrade and destruction from a building\nremoval of a citizen\nColony load\n\nReview please", "createdAt": "2020-01-11T22:00:48Z", "url": "https://github.com/ldtteam/minecolonies/pull/4228", "merged": true, "mergeCommit": {"oid": "970d97f590bca72f5c8c39a381b394426f7bca36"}, "closed": true, "closedAt": "2020-01-17T09:26:41Z", "author": {"login": "someaddons"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb5ad4dgH2gAyMzYxNzY4NTYxOjY1NzEzYjIzYmQ2ODEyMWZkMDRhNDg5OTAxNWFmYmRjNGEwYWQ5NTA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABb67uM6AFqTM0Mzk4OTI2OA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "65713b23bd68121fd04a4899015afbdc4a0ad950", "author": {"user": {"login": "someaddons", "name": null}}, "url": "https://github.com/ldtteam/minecolonies/commit/65713b23bd68121fd04a4899015afbdc4a0ad950", "committedDate": "2020-01-11T21:58:47Z", "message": "Fix citizen limit calculation.\nNow Calculates on building upgrade/destruction.\nRecalculates after colony load, instead of reading old values.\nRecruitment of additional guards over the citizen hut limit now works.\nLevel 0 guard-buildings no longer count towards the limit."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQxNTQzNDU1", "url": "https://github.com/ldtteam/minecolonies/pull/4228#pullrequestreview-341543455", "createdAt": "2020-01-11T22:09:55Z", "commit": {"oid": "65713b23bd68121fd04a4899015afbdc4a0ad950"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xMVQyMjowOTo1NVrOFcnEtQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xMVQyMjowOTo1NVrOFcnEtQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTU0NDYyOQ==", "bodyText": "our RackInventory class already has that overwrite, onContentsChanged was overwritten twice on accident", "url": "https://github.com/ldtteam/minecolonies/pull/4228#discussion_r365544629", "createdAt": "2020-01-11T22:09:55Z", "author": {"login": "someaddons"}, "path": "src/api/java/com/minecolonies/api/tileentities/TileEntityRack.java", "diffHunk": "@@ -340,15 +340,7 @@ public void read(final CompoundNBT compound)\n             size = compound.getInt(TAG_SIZE);\n             if (size > 0)\n             {\n-                inventory = new RackInventory(DEFAULT_SIZE + size * SLOT_PER_LINE)\n-                {\n-                    @Override\n-                    protected void onContentsChanged(final int slot)\n-                    {\n-                        updateItemStorage();\n-                        super.onContentsChanged(slot);\n-                    }\n-                };\n+                inventory = new RackInventory(DEFAULT_SIZE + size * SLOT_PER_LINE);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "65713b23bd68121fd04a4899015afbdc4a0ad950"}, "originalPosition": 13}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQxNTQ1MDY3", "url": "https://github.com/ldtteam/minecolonies/pull/4228#pullrequestreview-341545067", "createdAt": "2020-01-11T23:02:57Z", "commit": {"oid": "65713b23bd68121fd04a4899015afbdc4a0ad950"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xMVQyMzowMjo1OFrOFcnMfQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xMVQyMzowMjo1OFrOFcnMfQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTU0NjYyMQ==", "bodyText": "Shouldn't we then recalc after read?", "url": "https://github.com/ldtteam/minecolonies/pull/4228#discussion_r365546621", "createdAt": "2020-01-11T23:02:58Z", "author": {"login": "Raycoms"}, "path": "src/main/java/com/minecolonies/coremod/colony/managers/CitizenManager.java", "diffHunk": "@@ -92,9 +92,6 @@ public CitizenManager(final Colony colony)\n     @Override\n     public void read(@NotNull final CompoundNBT compound)\n     {\n-        maxCitizens = compound.getInt(TAG_MAX_CITIZENS);\n-        potentialMaxCitizens = compound.getInt(TAG_POTENTIAL_MAX_CITIZENS);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "65713b23bd68121fd04a4899015afbdc4a0ad950"}, "originalPosition": 14}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQxNTQ1NDI1", "url": "https://github.com/ldtteam/minecolonies/pull/4228#pullrequestreview-341545425", "createdAt": "2020-01-11T23:15:20Z", "commit": {"oid": "65713b23bd68121fd04a4899015afbdc4a0ad950"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQxNjI3NzAw", "url": "https://github.com/ldtteam/minecolonies/pull/4228#pullrequestreview-341627700", "createdAt": "2020-01-13T03:21:10Z", "commit": {"oid": "65713b23bd68121fd04a4899015afbdc4a0ad950"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "efb066de0ccda4993cceecd4d791796ecc4a10cb", "author": {"user": {"login": "someaddons", "name": null}}, "url": "https://github.com/ldtteam/minecolonies/commit/efb066de0ccda4993cceecd4d791796ecc4a10cb", "committedDate": "2020-01-13T22:09:02Z", "message": "Add missing calculation case & make it global for future use."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQzOTg5MjY4", "url": "https://github.com/ldtteam/minecolonies/pull/4228#pullrequestreview-343989268", "createdAt": "2020-01-16T15:17:24Z", "commit": {"oid": "efb066de0ccda4993cceecd4d791796ecc4a10cb"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2254, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}