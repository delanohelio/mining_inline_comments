{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTMzMjMxNjE3", "number": 6207, "title": "Fix/archer pos", "bodyText": "Closes #6179\nChanges proposed in this pull request:\n\nImproved archer positioning to not leave the wall/tower all the time\nFixes issue of stonesmeltery appearing with smeltery\n\n\nReview please", "createdAt": "2020-12-06T17:07:45Z", "url": "https://github.com/ldtteam/minecolonies/pull/6207", "merged": true, "mergeCommit": {"oid": "c08750a9bb30e79cc6528db9f22b82942f78e126"}, "closed": true, "closedAt": "2020-12-07T20:03:02Z", "author": {"login": "Raycoms"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdjiKHEAH2gAyNTMzMjMxNjE3OmFmNTU1OTZiYmI1ODc1ZmI0Y2ZlMzZjNzgyMTA0ZWE3ZmFkMDFmMzY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdj69hygFqTU0NjQ3OTk4OQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "af55596bbb5875fb4cfe36c782104ea7fad01f36", "author": {"user": {"login": "Raycoms", "name": null}}, "url": "https://github.com/ldtteam/minecolonies/commit/af55596bbb5875fb4cfe36c782104ea7fad01f36", "committedDate": "2020-12-06T14:52:24Z", "message": "fix 6186 + 6177"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "66f7c8db3f61e1b346108438262cbfa6d4b389ef", "author": {"user": {"login": "Raycoms", "name": null}}, "url": "https://github.com/ldtteam/minecolonies/commit/66f7c8db3f61e1b346108438262cbfa6d4b389ef", "committedDate": "2020-12-06T17:07:11Z", "message": "Improved archer positioning"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4eb576cc4f91a4c5a86c9471ff748933d39cbc86", "author": {"user": {"login": "Raycoms", "name": null}}, "url": "https://github.com/ldtteam/minecolonies/commit/4eb576cc4f91a4c5a86c9471ff748933d39cbc86", "committedDate": "2020-12-06T17:15:16Z", "message": "fix #6179"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ1NzI5NzM2", "url": "https://github.com/ldtteam/minecolonies/pull/6207#pullrequestreview-545729736", "createdAt": "2020-12-06T17:22:23Z", "commit": {"oid": "4eb576cc4f91a4c5a86c9471ff748933d39cbc86"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ1NzI5ODU3", "url": "https://github.com/ldtteam/minecolonies/pull/6207#pullrequestreview-545729857", "createdAt": "2020-12-06T17:23:45Z", "commit": {"oid": "4eb576cc4f91a4c5a86c9471ff748933d39cbc86"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wNlQxNzoyMzo0NVrOIANDNA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wNlQxNzoyMzo0NVrOIANDNA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzA4NDcyNA==", "bodyText": "what is this supposed to do?", "url": "https://github.com/ldtteam/minecolonies/pull/6207#discussion_r537084724", "createdAt": "2020-12-06T17:23:45Z", "author": {"login": "someaddons"}, "path": "src/main/java/com/minecolonies/coremod/entity/ai/citizen/guard/EntityAIRanger.java", "diffHunk": "@@ -553,21 +553,33 @@ private double getAimHeight()\n     @Override\n     public void moveInAttackPosition()\n     {\n-        if (buildingGuards.getTask() == GuardTask.GUARD)\n-        {\n-            ((MinecoloniesAdvancedPathNavigate) worker.getNavigator()).setPathJob(new PathJobCanSee(worker, target, world, buildingGuards.getGuardPos(), 20),\n-              null,\n-              getCombatMovementSpeed());\n-            return;\n-        }\n+        ((MinecoloniesAdvancedPathNavigate) worker.getNavigator()).setPathJob(new PathJobCanSee(worker,\n+            target,\n+            world,\n+            buildingGuards.getGuardPos(), shouldStayCloseToPos()\n+             ? 20 : 40),\n+          null,\n+          getCombatMovementSpeed());\n+    }\n \n-        worker.getNavigator()\n-          .tryMoveToBlockPos(worker.getPosition().offset(BlockPosUtil.getXZFacing(target.getPosition(), worker.getPosition()).getOpposite(), 8), getCombatMovementSpeed());\n+    /**\n+     * If the guard should stick close to the guard/patroll pos.\n+     * @return true if so.\n+     */\n+    private boolean shouldStayCloseToPos()\n+    {\n+        return buildingGuards.getTask() == GuardTask.GUARD || (buildingGuards.getTask() == GuardTask.PATROL && buildingGuards.shallPatrolManually());\n     }\n \n     @Override\n     public void guardMovement()\n     {\n+        if (worker.getRandom().nextInt(3) < 1)\n+        {\n+            worker.isWorkerAtSiteWithMove(buildingGuards.getGuardPos(), 3);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4eb576cc4f91a4c5a86c9471ff748933d39cbc86"}, "originalPosition": 63}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ1NzMwNzkx", "url": "https://github.com/ldtteam/minecolonies/pull/6207#pullrequestreview-545730791", "createdAt": "2020-12-06T17:35:23Z", "commit": {"oid": "4eb576cc4f91a4c5a86c9471ff748933d39cbc86"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ2NDc5OTg5", "url": "https://github.com/ldtteam/minecolonies/pull/6207#pullrequestreview-546479989", "createdAt": "2020-12-07T19:46:17Z", "commit": {"oid": "4eb576cc4f91a4c5a86c9471ff748933d39cbc86"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1708, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}