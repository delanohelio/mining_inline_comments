{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDEwMDY5MDEw", "number": 4791, "title": "Fix dimension change", "bodyText": "Closes #4787\nChanges proposed in this pull request:\nFix dimension change subscribers add/removal, our usual onChunkEnter fails since it is coord based on the entities current world obj so it can't compare the right chunk objects from two different worlds.\nReview please", "createdAt": "2020-04-28T11:54:03Z", "url": "https://github.com/ldtteam/minecolonies/pull/4791", "merged": true, "mergeCommit": {"oid": "90e86aec59b8980fcdd8b4c9a2f24c58f21a52f6"}, "closed": true, "closedAt": "2020-04-29T08:28:33Z", "author": {"login": "someaddons"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABccBYfYgH2gAyNDEwMDY5MDEwOmY4MjVhZDM1YjU3MWQ2ODhhNmIxZjE5OTUxY2Y2ZWFhODBlMjM3NGI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABccTQu1AH2gAyNDEwMDY5MDEwOjRlYzRkNTQ2ZDE0MTIzMGEyMmYwZTZkMjk4NDFkZDMzY2MwMDliYmY=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "f825ad35b571d688a6b1f19951cf6eaa80e2374b", "author": {"user": {"login": "someaddons", "name": null}}, "url": "https://github.com/ldtteam/minecolonies/commit/f825ad35b571d688a6b1f19951cf6eaa80e2374b", "committedDate": "2020-04-28T10:32:37Z", "message": "Fix dim change subscribers not registering correctly"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e33136bfcd856ed8f4a65386de3a65f1f54b6ce3", "author": {"user": {"login": "someaddons", "name": null}}, "url": "https://github.com/ldtteam/minecolonies/commit/e33136bfcd856ed8f4a65386de3a65f1f54b6ce3", "committedDate": "2020-04-28T10:49:01Z", "message": "Fix dim change subscribers not registering correctly"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "132a6df1d1e467dca16344345ebabdc3cf2f711a", "author": {"user": {"login": "someaddons", "name": null}}, "url": "https://github.com/ldtteam/minecolonies/commit/132a6df1d1e467dca16344345ebabdc3cf2f711a", "committedDate": "2020-04-28T14:27:04Z", "message": "change loaded check for range message"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAyMzc1NDU4", "url": "https://github.com/ldtteam/minecolonies/pull/4791#pullrequestreview-402375458", "createdAt": "2020-04-29T05:40:37Z", "commit": {"oid": "132a6df1d1e467dca16344345ebabdc3cf2f711a"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOVQwNTo0MDozN1rOGNwZ3A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOVQwNTo0MDozN1rOGNwZ3A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzA3NzcyNA==", "bodyText": "Null check please! Since you are explicitly returning null for the orElse(...) and it is possible that the capability does not exist for some reason or another, a null check is required here.", "url": "https://github.com/ldtteam/minecolonies/pull/4791#discussion_r417077724", "createdAt": "2020-04-29T05:40:37Z", "author": {"login": "OrionDevelopment"}, "path": "src/main/java/com/minecolonies/coremod/event/EventHandler.java", "diffHunk": "@@ -210,6 +210,57 @@ public static void onChunkUnLoad(final ChunkEvent.Unload event)\n         }\n     }\n \n+    /**\n+     * Called right before dimension change event, used to remove the player from an existing colony\n+     *\n+     * @param event dim travel event.\n+     */\n+    @SubscribeEvent(priority = LOWEST)\n+    public static void onEntityTravelToDimensionEvent(final EntityTravelToDimensionEvent event)\n+    {\n+        if (event.getEntity() instanceof ServerPlayerEntity && !event.isCanceled())\n+        {\n+            final ServerPlayerEntity player = (ServerPlayerEntity) event.getEntity();\n+            final Chunk oldChunk = player.world.getChunk(player.chunkCoordX, player.chunkCoordZ);\n+            final IColonyTagCapability oldCloseColonies = oldChunk.getCapability(CLOSE_COLONY_CAP, null).orElse(null);\n+            // Remove visiting/subscriber from old colony\n+            if (oldCloseColonies.getOwningColony() != 0)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "132a6df1d1e467dca16344345ebabdc3cf2f711a"}, "originalPosition": 34}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4ec4d546d141230a22f0e6d29841dd33cc009bbf", "author": {"user": {"login": "someaddons", "name": null}}, "url": "https://github.com/ldtteam/minecolonies/commit/4ec4d546d141230a22f0e6d29841dd33cc009bbf", "committedDate": "2020-04-29T07:22:26Z", "message": "Add null check"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2210, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}