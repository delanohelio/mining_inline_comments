{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDEyNDg0NjQx", "number": 4850, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wMlQxNzo1NTozN1rOD4rhpQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wMlQxNzo1NTozN1rOD4rhpQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYwNzU5OTczOnYy", "diffSide": "LEFT", "path": "src/main/java/com/minecolonies/coremod/network/messages/server/colony/OpenInventoryMessage.java", "isResolved": true, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wMlQxNzo1NTozN1rOGPk_7w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wMlQxNzo1OToyMVrOGPlBwg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODk4ODAxNQ==", "bodyText": "does this mean the permission doesn't get checked at all in this packet?", "url": "https://github.com/ldtteam/minecolonies/pull/4850#discussion_r418988015", "createdAt": "2020-05-02T17:55:37Z", "author": {"login": "ToMe25"}, "path": "src/main/java/com/minecolonies/coremod/network/messages/server/colony/OpenInventoryMessage.java", "diffHunk": "@@ -175,30 +146,17 @@ private void doCitizenInventory(final ServerPlayerEntity player)\n         }\n     }\n \n-    private void doHutInventory(final ServerPlayerEntity player)\n+    private void doHutInventory(final ServerPlayerEntity player, final IColony colony)\n     {\n-        if (checkPermissions(IColonyManager.getInstance().getClosestColony(player.getEntityWorld(), tePos), player))\n-        {\n-            @NotNull final TileEntityRack chest = (TileEntityRack) BlockPosUtil.getTileEntity(player.world, tePos);\n+        @NotNull final TileEntityRack chest = (TileEntityRack) BlockPosUtil.getTileEntity(player.world, tePos);\n \n-            NetworkHooks.openGui(player, chest, packetBuffer -> packetBuffer.writeVarInt(colonyId).writeBlockPos(chest.getPos()));\n-        }\n+        NetworkHooks.openGui(player, chest, packetBuffer -> packetBuffer.writeVarInt(colony.getID()).writeBlockPos(chest.getPos()));\n     }\n \n     private void doFieldInventory(final ServerPlayerEntity player)\n     {\n-        if (checkPermissions(IColonyManager.getInstance().getClosestColony(player.getEntityWorld(), tePos), player))\n-        {\n-            @NotNull final ScarecrowTileEntity scarecrowTileEntity = (ScarecrowTileEntity) BlockPosUtil.getTileEntity(CompatibilityUtils.getWorldFromEntity(player), tePos);\n-            NetworkHooks.openGui(player, scarecrowTileEntity);\n-\n-        }\n-    }\n-\n-    private static boolean checkPermissions(final IColony colony, final ServerPlayerEntity player)\n-    {\n-        //Verify player has permission to change this huts settings\n-        return colony.getPermissions().hasPermission(player, Action.MANAGE_HUTS);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "730abbe572cb7190e23d9a04c2142692b6034515"}, "originalPosition": 208}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODk4ODE4Mg==", "bodyText": "look at the base class: AbstractColonyServerMessage", "url": "https://github.com/ldtteam/minecolonies/pull/4850#discussion_r418988182", "createdAt": "2020-05-02T17:56:55Z", "author": {"login": "Asherslab"}, "path": "src/main/java/com/minecolonies/coremod/network/messages/server/colony/OpenInventoryMessage.java", "diffHunk": "@@ -175,30 +146,17 @@ private void doCitizenInventory(final ServerPlayerEntity player)\n         }\n     }\n \n-    private void doHutInventory(final ServerPlayerEntity player)\n+    private void doHutInventory(final ServerPlayerEntity player, final IColony colony)\n     {\n-        if (checkPermissions(IColonyManager.getInstance().getClosestColony(player.getEntityWorld(), tePos), player))\n-        {\n-            @NotNull final TileEntityRack chest = (TileEntityRack) BlockPosUtil.getTileEntity(player.world, tePos);\n+        @NotNull final TileEntityRack chest = (TileEntityRack) BlockPosUtil.getTileEntity(player.world, tePos);\n \n-            NetworkHooks.openGui(player, chest, packetBuffer -> packetBuffer.writeVarInt(colonyId).writeBlockPos(chest.getPos()));\n-        }\n+        NetworkHooks.openGui(player, chest, packetBuffer -> packetBuffer.writeVarInt(colony.getID()).writeBlockPos(chest.getPos()));\n     }\n \n     private void doFieldInventory(final ServerPlayerEntity player)\n     {\n-        if (checkPermissions(IColonyManager.getInstance().getClosestColony(player.getEntityWorld(), tePos), player))\n-        {\n-            @NotNull final ScarecrowTileEntity scarecrowTileEntity = (ScarecrowTileEntity) BlockPosUtil.getTileEntity(CompatibilityUtils.getWorldFromEntity(player), tePos);\n-            NetworkHooks.openGui(player, scarecrowTileEntity);\n-\n-        }\n-    }\n-\n-    private static boolean checkPermissions(final IColony colony, final ServerPlayerEntity player)\n-    {\n-        //Verify player has permission to change this huts settings\n-        return colony.getPermissions().hasPermission(player, Action.MANAGE_HUTS);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODk4ODAxNQ=="}, "originalCommit": {"oid": "730abbe572cb7190e23d9a04c2142692b6034515"}, "originalPosition": 208}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODk4ODIzNA==", "bodyText": "that's a major part of the boiler plate i removed", "url": "https://github.com/ldtteam/minecolonies/pull/4850#discussion_r418988234", "createdAt": "2020-05-02T17:57:15Z", "author": {"login": "Asherslab"}, "path": "src/main/java/com/minecolonies/coremod/network/messages/server/colony/OpenInventoryMessage.java", "diffHunk": "@@ -175,30 +146,17 @@ private void doCitizenInventory(final ServerPlayerEntity player)\n         }\n     }\n \n-    private void doHutInventory(final ServerPlayerEntity player)\n+    private void doHutInventory(final ServerPlayerEntity player, final IColony colony)\n     {\n-        if (checkPermissions(IColonyManager.getInstance().getClosestColony(player.getEntityWorld(), tePos), player))\n-        {\n-            @NotNull final TileEntityRack chest = (TileEntityRack) BlockPosUtil.getTileEntity(player.world, tePos);\n+        @NotNull final TileEntityRack chest = (TileEntityRack) BlockPosUtil.getTileEntity(player.world, tePos);\n \n-            NetworkHooks.openGui(player, chest, packetBuffer -> packetBuffer.writeVarInt(colonyId).writeBlockPos(chest.getPos()));\n-        }\n+        NetworkHooks.openGui(player, chest, packetBuffer -> packetBuffer.writeVarInt(colony.getID()).writeBlockPos(chest.getPos()));\n     }\n \n     private void doFieldInventory(final ServerPlayerEntity player)\n     {\n-        if (checkPermissions(IColonyManager.getInstance().getClosestColony(player.getEntityWorld(), tePos), player))\n-        {\n-            @NotNull final ScarecrowTileEntity scarecrowTileEntity = (ScarecrowTileEntity) BlockPosUtil.getTileEntity(CompatibilityUtils.getWorldFromEntity(player), tePos);\n-            NetworkHooks.openGui(player, scarecrowTileEntity);\n-\n-        }\n-    }\n-\n-    private static boolean checkPermissions(final IColony colony, final ServerPlayerEntity player)\n-    {\n-        //Verify player has permission to change this huts settings\n-        return colony.getPermissions().hasPermission(player, Action.MANAGE_HUTS);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODk4ODAxNQ=="}, "originalCommit": {"oid": "730abbe572cb7190e23d9a04c2142692b6034515"}, "originalPosition": 208}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODk4ODQ4Mg==", "bodyText": "Seems ok then.\nI don't know too much about minecraft/minecolonies networking, so i just looked for changes in logic that seemed important.", "url": "https://github.com/ldtteam/minecolonies/pull/4850#discussion_r418988482", "createdAt": "2020-05-02T17:59:21Z", "author": {"login": "ToMe25"}, "path": "src/main/java/com/minecolonies/coremod/network/messages/server/colony/OpenInventoryMessage.java", "diffHunk": "@@ -175,30 +146,17 @@ private void doCitizenInventory(final ServerPlayerEntity player)\n         }\n     }\n \n-    private void doHutInventory(final ServerPlayerEntity player)\n+    private void doHutInventory(final ServerPlayerEntity player, final IColony colony)\n     {\n-        if (checkPermissions(IColonyManager.getInstance().getClosestColony(player.getEntityWorld(), tePos), player))\n-        {\n-            @NotNull final TileEntityRack chest = (TileEntityRack) BlockPosUtil.getTileEntity(player.world, tePos);\n+        @NotNull final TileEntityRack chest = (TileEntityRack) BlockPosUtil.getTileEntity(player.world, tePos);\n \n-            NetworkHooks.openGui(player, chest, packetBuffer -> packetBuffer.writeVarInt(colonyId).writeBlockPos(chest.getPos()));\n-        }\n+        NetworkHooks.openGui(player, chest, packetBuffer -> packetBuffer.writeVarInt(colony.getID()).writeBlockPos(chest.getPos()));\n     }\n \n     private void doFieldInventory(final ServerPlayerEntity player)\n     {\n-        if (checkPermissions(IColonyManager.getInstance().getClosestColony(player.getEntityWorld(), tePos), player))\n-        {\n-            @NotNull final ScarecrowTileEntity scarecrowTileEntity = (ScarecrowTileEntity) BlockPosUtil.getTileEntity(CompatibilityUtils.getWorldFromEntity(player), tePos);\n-            NetworkHooks.openGui(player, scarecrowTileEntity);\n-\n-        }\n-    }\n-\n-    private static boolean checkPermissions(final IColony colony, final ServerPlayerEntity player)\n-    {\n-        //Verify player has permission to change this huts settings\n-        return colony.getPermissions().hasPermission(player, Action.MANAGE_HUTS);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODk4ODAxNQ=="}, "originalCommit": {"oid": "730abbe572cb7190e23d9a04c2142692b6034515"}, "originalPosition": 208}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3171, "cost": 1, "resetAt": "2021-11-12T20:44:06Z"}}}