{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDIyNDkxNzIx", "number": 5070, "title": "Adds chat notification when all citizens (other than guards) are sleeping", "bodyText": "Closes #5068\nCloses #\nCloses #\nChanges proposed in this pull request:\n\nAdds chat notification when all citizens (other than guards) are sleeping so that the player knows when it is ok for them to sleep.\n\n\n\nReview please", "createdAt": "2020-05-25T00:18:07Z", "url": "https://github.com/ldtteam/minecolonies/pull/5070", "merged": true, "mergeCommit": {"oid": "bd5c77752d3aa40951339a4e267514aaa2455f3a"}, "closed": true, "closedAt": "2020-05-28T21:07:49Z", "author": {"login": "PowerSchill"}, "timelineItems": {"totalCount": 13, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABckgpiIgH2gAyNDIyNDkxNzIxOmUyYWI5N2VkNTk3MzRmOWRhM2E2ZGViZDMwMWRlMjI3MGI0NTA5Y2Q=", "endCursor": "Y3Vyc29yOnYyOpPPAAABclzV6DAH2gAyNDIyNDkxNzIxOmU2YjFjMmI1ZTJhZWM5OTJiYTczZmRlMTRlZmI4ZjQwYWRhYTE4MjM=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "e2ab97ed59734f9da3a6debd301de2270b4509cd", "author": {"user": {"login": "PowerSchill", "name": "Mark E. Schill"}}, "url": "https://github.com/ldtteam/minecolonies/commit/e2ab97ed59734f9da3a6debd301de2270b4509cd", "committedDate": "2020-05-24T19:29:41Z", "message": "Adds message when all citizens are sleeping\n\nSigned-off-by: Mark E. Schill <Mark.Schill@cmschill.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8c1c962f1bf085059570e94720a7c6c778609443", "author": {"user": {"login": "PowerSchill", "name": "Mark E. Schill"}}, "url": "https://github.com/ldtteam/minecolonies/commit/8c1c962f1bf085059570e94720a7c6c778609443", "committedDate": "2020-05-25T00:15:03Z", "message": "Handles spamming of sleep notifications\n\nSigned-off-by: Mark E. Schill <Mark.Schill@cmschill.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "59f2054e6a19371b0a3b97ca71b6ab3a35a30034", "author": {"user": {"login": "PowerSchill", "name": "Mark E. Schill"}}, "url": "https://github.com/ldtteam/minecolonies/commit/59f2054e6a19371b0a3b97ca71b6ab3a35a30034", "committedDate": "2020-05-25T17:33:28Z", "message": "Merge branch 'version/1.15' into feature/sleep_notifications"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE3ODMzNDM4", "url": "https://github.com/ldtteam/minecolonies/pull/5070#pullrequestreview-417833438", "createdAt": "2020-05-25T18:10:29Z", "commit": {"oid": "59f2054e6a19371b0a3b97ca71b6ab3a35a30034"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNVQxODoxMDoyOVrOGaHZ7Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNVQxODoxMDoyOVrOGaHZ7Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDAzNzQ4NQ==", "bodyText": "This is actually more then needed. We have already a way to check on the sleep handler if a citizen is sleeping. So you only need to check this, no need for additional variables.", "url": "https://github.com/ldtteam/minecolonies/pull/5070#discussion_r430037485", "createdAt": "2020-05-25T18:10:29Z", "author": {"login": "Raycoms"}, "path": "src/main/java/com/minecolonies/coremod/colony/managers/CitizenManager.java", "diffHunk": "@@ -548,4 +550,31 @@ public ICitizenData getRandomCitizen()\n     {\n         return (ICitizenData) citizens.values().toArray()[random.nextInt(citizens.values().size())];\n     }\n+\n+    @Override\n+    public void updateCitizenSleep(final boolean sleep)\n+    {\n+        this.isCitizensSleeping = sleep;\n+    }\n+\n+    @Override\n+    public void onCitizenSleep()\n+    {\n+\n+\n+        for (final ICitizenData citizenData : citizens.values())", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "59f2054e6a19371b0a3b97ca71b6ab3a35a30034"}, "originalPosition": 32}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE3ODM2Mjc2", "url": "https://github.com/ldtteam/minecolonies/pull/5070#pullrequestreview-417836276", "createdAt": "2020-05-25T18:21:16Z", "commit": {"oid": "59f2054e6a19371b0a3b97ca71b6ab3a35a30034"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNVQxODoyMToxN1rOGaHkAg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNVQxODoyMToxN1rOGaHkAg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDA0MDA2Ng==", "bodyText": "getImportantMessageEntityPlayers will notify any officers even when not inside the colony, e.g. your friend who is officer in your colony aswell. Think you want to use the nonimportant ones", "url": "https://github.com/ldtteam/minecolonies/pull/5070#discussion_r430040066", "createdAt": "2020-05-25T18:21:17Z", "author": {"login": "someaddons"}, "path": "src/main/java/com/minecolonies/coremod/colony/managers/CitizenManager.java", "diffHunk": "@@ -548,4 +550,31 @@ public ICitizenData getRandomCitizen()\n     {\n         return (ICitizenData) citizens.values().toArray()[random.nextInt(citizens.values().size())];\n     }\n+\n+    @Override\n+    public void updateCitizenSleep(final boolean sleep)\n+    {\n+        this.isCitizensSleeping = sleep;\n+    }\n+\n+    @Override\n+    public void onCitizenSleep()\n+    {\n+\n+\n+        for (final ICitizenData citizenData : citizens.values())\n+        {\n+            if (!(citizenData.isAsleep() || citizenData.getJob() instanceof AbstractJobGuard))\n+            {\n+                return;\n+            }\n+        }\n+\n+        if (!this.isCitizensSleeping)\n+        {\n+            LanguageHandler.sendPlayersMessage(colony.getImportantMessageEntityPlayers(), ALL_CITIZENS_ARE_SLEEPING);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "59f2054e6a19371b0a3b97ca71b6ab3a35a30034"}, "originalPosition": 42}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "546afd3e4c9f81fc1f9ca21bbcc71bfcb8a404be", "author": {"user": {"login": "PowerSchill", "name": "Mark E. Schill"}}, "url": "https://github.com/ldtteam/minecolonies/commit/546afd3e4c9f81fc1f9ca21bbcc71bfcb8a404be", "committedDate": "2020-05-25T18:36:08Z", "message": "Updates notification targets for sleep message\n\nSigned-off-by: Mark E. Schill <Mark.Schill@cmschill.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d3f04ebcf6644588599e19bbc9cfe6ff08eda808", "author": {"user": {"login": "Raycoms", "name": null}}, "url": "https://github.com/ldtteam/minecolonies/commit/d3f04ebcf6644588599e19bbc9cfe6ff08eda808", "committedDate": "2020-05-26T08:32:14Z", "message": "Merge branch 'version/1.15' into feature/sleep_notifications"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9d07c400561d7f31a603326a82217e5e36e01a4b", "author": {"user": {"login": "PowerSchill", "name": "Mark E. Schill"}}, "url": "https://github.com/ldtteam/minecolonies/commit/9d07c400561d7f31a603326a82217e5e36e01a4b", "committedDate": "2020-05-26T09:59:29Z", "message": "Adds missing field\n\nSigned-off-by: Mark E. Schill <Mark.Schill@cmschill.net>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE4MTQ5ODM3", "url": "https://github.com/ldtteam/minecolonies/pull/5070#pullrequestreview-418149837", "createdAt": "2020-05-26T10:02:02Z", "commit": {"oid": "9d07c400561d7f31a603326a82217e5e36e01a4b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNlQxMDowMjowM1rOGaXUmQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNlQxMDowMjowM1rOGaXUmQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDI5ODI2NQ==", "bodyText": "areCitizensSleeping then", "url": "https://github.com/ldtteam/minecolonies/pull/5070#discussion_r430298265", "createdAt": "2020-05-26T10:02:03Z", "author": {"login": "Raycoms"}, "path": "src/main/java/com/minecolonies/coremod/colony/managers/CitizenManager.java", "diffHunk": "@@ -82,6 +84,11 @@\n      */\n     private Random random = new Random();\n \n+    /**\n+     * Whether all citizens excluding guards are sleeping\n+     */\n+    private boolean isCitizensSleeping;\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9d07c400561d7f31a603326a82217e5e36e01a4b"}, "originalPosition": 24}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "66557cef921d55a8f1a21414d99ce903452e2f0b", "author": {"user": {"login": "PowerSchill", "name": "Mark E. Schill"}}, "url": "https://github.com/ldtteam/minecolonies/commit/66557cef921d55a8f1a21414d99ce903452e2f0b", "committedDate": "2020-05-28T19:31:41Z", "message": "Merge branch 'version/1.15' into feature/sleep_notifications"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2ad771d974e0ea42b5f9ee0cf7bd03d57900ef85", "author": {"user": {"login": "PowerSchill", "name": "Mark E. Schill"}}, "url": "https://github.com/ldtteam/minecolonies/commit/2ad771d974e0ea42b5f9ee0cf7bd03d57900ef85", "committedDate": "2020-05-28T19:44:42Z", "message": "Renames sleeping parameter"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIwNDQwNTYy", "url": "https://github.com/ldtteam/minecolonies/pull/5070#pullrequestreview-420440562", "createdAt": "2020-05-28T19:48:00Z", "commit": {"oid": "2ad771d974e0ea42b5f9ee0cf7bd03d57900ef85"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOFQxOTo0ODowMVrOGcEE3Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOFQxOTo0ODowMVrOGcEE3Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjA4MDA5Mw==", "bodyText": "Just this 2 lines of whitespace here and then we can merge it =D", "url": "https://github.com/ldtteam/minecolonies/pull/5070#discussion_r432080093", "createdAt": "2020-05-28T19:48:01Z", "author": {"login": "Raycoms"}, "path": "src/main/java/com/minecolonies/coremod/colony/managers/CitizenManager.java", "diffHunk": "@@ -548,4 +554,31 @@ public ICitizenData getRandomCitizen()\n     {\n         return (ICitizenData) citizens.values().toArray()[random.nextInt(citizens.values().size())];\n     }\n+\n+    @Override\n+    public void updateCitizenSleep(final boolean sleep)\n+    {\n+        this.areCitizensSleeping = sleep;\n+    }\n+\n+    @Override\n+    public void onCitizenSleep()\n+    {\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2ad771d974e0ea42b5f9ee0cf7bd03d57900ef85"}, "originalPosition": 34}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e6b1c2b5e2aec992ba73fde14efb8f40adaa1823", "author": {"user": {"login": "PowerSchill", "name": "Mark E. Schill"}}, "url": "https://github.com/ldtteam/minecolonies/commit/e6b1c2b5e2aec992ba73fde14efb8f40adaa1823", "committedDate": "2020-05-28T19:50:22Z", "message": "Cleans up whitespace\n\nSigned-off-by: Mark E. Schill <Mark.Schill@cmschill.net>"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2139, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}