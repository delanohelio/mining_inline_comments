{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA4OTYxMDg3", "number": 4759, "reviewThreads": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yNVQyMDoyOTo1NVrOD2Lb2g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yNVQyMTo1MjoxMlrOD2MMRA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU4MTM3MDUwOnYy", "diffSide": "RIGHT", "path": "src/api/java/com/minecolonies/api/tileentities/TileEntityRack.java", "isResolved": true, "comments": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yNVQyMDoyOTo1NVrOGL6Ahg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yNVQyMToxMDozN1rOGL6cDQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTEzNzkyNg==", "bodyText": "int amount = ItemStackUtils.getSize(stack);\nif (content.containsKey(storage))\n{\namount += content.remove(storage);\n}\ncontent.put(storage, amount);\n\nWhy isn't this enough?", "url": "https://github.com/ldtteam/minecolonies/pull/4759#discussion_r415137926", "createdAt": "2020-04-25T20:29:55Z", "author": {"login": "Raycoms"}, "path": "src/api/java/com/minecolonies/api/tileentities/TileEntityRack.java", "diffHunk": "@@ -225,12 +225,14 @@ public void updateItemStorage()\n                 continue;\n             }\n \n-            final ItemStorage storage = new ItemStorage(stack.copy());\n+            final ItemStack stackCopy = stack.copy();\n+            final ItemStorage storage = new ItemStorage(stackCopy);\n             int amount = ItemStackUtils.getSize(stack);\n             if (content.containsKey(storage))\n             {\n                 amount += content.remove(storage);\n             }\n+            stackCopy.setCount(amount);\n             content.put(storage, amount);\n         }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "84fa0aaf06052529fb9c664f27a6f715c3b2bb2b"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTEzODI5Mw==", "bodyText": "because this only uses the stack, not the amount.\nboth in the current, and my changed version.", "url": "https://github.com/ldtteam/minecolonies/pull/4759#discussion_r415138293", "createdAt": "2020-04-25T20:31:41Z", "author": {"login": "ToMe25"}, "path": "src/api/java/com/minecolonies/api/tileentities/TileEntityRack.java", "diffHunk": "@@ -225,12 +225,14 @@ public void updateItemStorage()\n                 continue;\n             }\n \n-            final ItemStorage storage = new ItemStorage(stack.copy());\n+            final ItemStack stackCopy = stack.copy();\n+            final ItemStorage storage = new ItemStorage(stackCopy);\n             int amount = ItemStackUtils.getSize(stack);\n             if (content.containsKey(storage))\n             {\n                 amount += content.remove(storage);\n             }\n+            stackCopy.setCount(amount);\n             content.put(storage, amount);\n         }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTEzNzkyNg=="}, "originalCommit": {"oid": "84fa0aaf06052529fb9c664f27a6f715c3b2bb2b"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTEzODMxNg==", "bodyText": "that should work normally", "url": "https://github.com/ldtteam/minecolonies/pull/4759#discussion_r415138316", "createdAt": "2020-04-25T20:31:48Z", "author": {"login": "lexustec"}, "path": "src/api/java/com/minecolonies/api/tileentities/TileEntityRack.java", "diffHunk": "@@ -225,12 +225,14 @@ public void updateItemStorage()\n                 continue;\n             }\n \n-            final ItemStorage storage = new ItemStorage(stack.copy());\n+            final ItemStack stackCopy = stack.copy();\n+            final ItemStorage storage = new ItemStorage(stackCopy);\n             int amount = ItemStackUtils.getSize(stack);\n             if (content.containsKey(storage))\n             {\n                 amount += content.remove(storage);\n             }\n+            stackCopy.setCount(amount);\n             content.put(storage, amount);\n         }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTEzNzkyNg=="}, "originalCommit": {"oid": "84fa0aaf06052529fb9c664f27a6f715c3b2bb2b"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTEzODc2OQ==", "bodyText": "it gets the amount from the stack and adds it to the amount in the map. That should be enough", "url": "https://github.com/ldtteam/minecolonies/pull/4759#discussion_r415138769", "createdAt": "2020-04-25T20:34:28Z", "author": {"login": "Raycoms"}, "path": "src/api/java/com/minecolonies/api/tileentities/TileEntityRack.java", "diffHunk": "@@ -225,12 +225,14 @@ public void updateItemStorage()\n                 continue;\n             }\n \n-            final ItemStorage storage = new ItemStorage(stack.copy());\n+            final ItemStack stackCopy = stack.copy();\n+            final ItemStorage storage = new ItemStorage(stackCopy);\n             int amount = ItemStackUtils.getSize(stack);\n             if (content.containsKey(storage))\n             {\n                 amount += content.remove(storage);\n             }\n+            stackCopy.setCount(amount);\n             content.put(storage, amount);\n         }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTEzNzkyNg=="}, "originalCommit": {"oid": "84fa0aaf06052529fb9c664f27a6f715c3b2bb2b"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTEzOTI5Nw==", "bodyText": "Should i change it back to how it was in the second commit then? that didn't change TileEntityRack at all.", "url": "https://github.com/ldtteam/minecolonies/pull/4759#discussion_r415139297", "createdAt": "2020-04-25T20:37:55Z", "author": {"login": "ToMe25"}, "path": "src/api/java/com/minecolonies/api/tileentities/TileEntityRack.java", "diffHunk": "@@ -225,12 +225,14 @@ public void updateItemStorage()\n                 continue;\n             }\n \n-            final ItemStorage storage = new ItemStorage(stack.copy());\n+            final ItemStack stackCopy = stack.copy();\n+            final ItemStorage storage = new ItemStorage(stackCopy);\n             int amount = ItemStackUtils.getSize(stack);\n             if (content.containsKey(storage))\n             {\n                 amount += content.remove(storage);\n             }\n+            stackCopy.setCount(amount);\n             content.put(storage, amount);\n         }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTEzNzkyNg=="}, "originalCommit": {"oid": "84fa0aaf06052529fb9c664f27a6f715c3b2bb2b"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTEzOTU0Nw==", "bodyText": "none of this should be necessary of the above.", "url": "https://github.com/ldtteam/minecolonies/pull/4759#discussion_r415139547", "createdAt": "2020-04-25T20:39:16Z", "author": {"login": "Raycoms"}, "path": "src/api/java/com/minecolonies/api/tileentities/TileEntityRack.java", "diffHunk": "@@ -225,12 +225,14 @@ public void updateItemStorage()\n                 continue;\n             }\n \n-            final ItemStorage storage = new ItemStorage(stack.copy());\n+            final ItemStack stackCopy = stack.copy();\n+            final ItemStorage storage = new ItemStorage(stackCopy);\n             int amount = ItemStackUtils.getSize(stack);\n             if (content.containsKey(storage))\n             {\n                 amount += content.remove(storage);\n             }\n+            stackCopy.setCount(amount);\n             content.put(storage, amount);\n         }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTEzNzkyNg=="}, "originalCommit": {"oid": "84fa0aaf06052529fb9c664f27a6f715c3b2bb2b"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTE0MzkyMA==", "bodyText": "does that mean you prefer leaving this alone like it was, and just changing the WindowHutAllInventory?", "url": "https://github.com/ldtteam/minecolonies/pull/4759#discussion_r415143920", "createdAt": "2020-04-25T21:04:54Z", "author": {"login": "ToMe25"}, "path": "src/api/java/com/minecolonies/api/tileentities/TileEntityRack.java", "diffHunk": "@@ -225,12 +225,14 @@ public void updateItemStorage()\n                 continue;\n             }\n \n-            final ItemStorage storage = new ItemStorage(stack.copy());\n+            final ItemStack stackCopy = stack.copy();\n+            final ItemStorage storage = new ItemStorage(stackCopy);\n             int amount = ItemStackUtils.getSize(stack);\n             if (content.containsKey(storage))\n             {\n                 amount += content.remove(storage);\n             }\n+            stackCopy.setCount(amount);\n             content.put(storage, amount);\n         }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTEzNzkyNg=="}, "originalCommit": {"oid": "84fa0aaf06052529fb9c664f27a6f715c3b2bb2b"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTE0NDM4MQ==", "bodyText": "The above code is correct. It should not be the cause of any issue.", "url": "https://github.com/ldtteam/minecolonies/pull/4759#discussion_r415144381", "createdAt": "2020-04-25T21:07:06Z", "author": {"login": "Raycoms"}, "path": "src/api/java/com/minecolonies/api/tileentities/TileEntityRack.java", "diffHunk": "@@ -225,12 +225,14 @@ public void updateItemStorage()\n                 continue;\n             }\n \n-            final ItemStorage storage = new ItemStorage(stack.copy());\n+            final ItemStack stackCopy = stack.copy();\n+            final ItemStorage storage = new ItemStorage(stackCopy);\n             int amount = ItemStackUtils.getSize(stack);\n             if (content.containsKey(storage))\n             {\n                 amount += content.remove(storage);\n             }\n+            stackCopy.setCount(amount);\n             content.put(storage, amount);\n         }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTEzNzkyNg=="}, "originalCommit": {"oid": "84fa0aaf06052529fb9c664f27a6f715c3b2bb2b"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTE0NDk3Mw==", "bodyText": "ok i changed it back.", "url": "https://github.com/ldtteam/minecolonies/pull/4759#discussion_r415144973", "createdAt": "2020-04-25T21:10:37Z", "author": {"login": "ToMe25"}, "path": "src/api/java/com/minecolonies/api/tileentities/TileEntityRack.java", "diffHunk": "@@ -225,12 +225,14 @@ public void updateItemStorage()\n                 continue;\n             }\n \n-            final ItemStorage storage = new ItemStorage(stack.copy());\n+            final ItemStack stackCopy = stack.copy();\n+            final ItemStorage storage = new ItemStorage(stackCopy);\n             int amount = ItemStackUtils.getSize(stack);\n             if (content.containsKey(storage))\n             {\n                 amount += content.remove(storage);\n             }\n+            stackCopy.setCount(amount);\n             content.put(storage, amount);\n         }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTEzNzkyNg=="}, "originalCommit": {"oid": "84fa0aaf06052529fb9c664f27a6f715c3b2bb2b"}, "originalPosition": 14}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU4MTQzMjQ4OnYy", "diffSide": "RIGHT", "path": "src/main/java/com/minecolonies/coremod/client/gui/WindowHutAllInventory.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yNVQyMToxMDo1MVrOGL6cIg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yNVQyMTozNDo0M1rOGL6rnQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTE0NDk5NA==", "bodyText": "This does not work officially, and even though it works in the current Mc version it is not officially supported. As such please change this to use itemstorage instances or use the proposed change by @Raycoms.", "url": "https://github.com/ldtteam/minecolonies/pull/4759#discussion_r415144994", "createdAt": "2020-04-25T21:10:51Z", "author": {"login": "OrionDevelopment"}, "path": "src/main/java/com/minecolonies/coremod/client/gui/WindowHutAllInventory.java", "diffHunk": "@@ -147,7 +147,9 @@ private void updateResources()\n \n                 for (final Map.Entry<ItemStorage, Integer> entry : storage.entrySet())\n                 {\n-                    items.add(new ItemStorage(entry.getKey().getItemStack(), entry.getValue(), false).getItemStack());\n+                \tItemStack stack = entry.getKey().getItemStack().copy();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "867a0ad8b5f1431e1a244fbcd8c0a88e63bf3dc6"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTE0NTMzOQ==", "bodyText": "should i just change the items list to use ItemStorage instead of ItemStack then?", "url": "https://github.com/ldtteam/minecolonies/pull/4759#discussion_r415145339", "createdAt": "2020-04-25T21:12:56Z", "author": {"login": "ToMe25"}, "path": "src/main/java/com/minecolonies/coremod/client/gui/WindowHutAllInventory.java", "diffHunk": "@@ -147,7 +147,9 @@ private void updateResources()\n \n                 for (final Map.Entry<ItemStorage, Integer> entry : storage.entrySet())\n                 {\n-                    items.add(new ItemStorage(entry.getKey().getItemStack(), entry.getValue(), false).getItemStack());\n+                \tItemStack stack = entry.getKey().getItemStack().copy();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTE0NDk5NA=="}, "originalCommit": {"oid": "867a0ad8b5f1431e1a244fbcd8c0a88e63bf3dc6"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTE0ODk1Nw==", "bodyText": "I did get rid of it now.", "url": "https://github.com/ldtteam/minecolonies/pull/4759#discussion_r415148957", "createdAt": "2020-04-25T21:34:43Z", "author": {"login": "ToMe25"}, "path": "src/main/java/com/minecolonies/coremod/client/gui/WindowHutAllInventory.java", "diffHunk": "@@ -147,7 +147,9 @@ private void updateResources()\n \n                 for (final Map.Entry<ItemStorage, Integer> entry : storage.entrySet())\n                 {\n-                    items.add(new ItemStorage(entry.getKey().getItemStack(), entry.getValue(), false).getItemStack());\n+                \tItemStack stack = entry.getKey().getItemStack().copy();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTE0NDk5NA=="}, "originalCommit": {"oid": "867a0ad8b5f1431e1a244fbcd8c0a88e63bf3dc6"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU4MTQ3MDA2OnYy", "diffSide": "RIGHT", "path": "src/main/java/com/minecolonies/coremod/client/gui/WindowHutAllInventory.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yNVQyMTozNjowNFrOGL6sbQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yNVQyMTo1MjozNlrOGL63Lw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTE0OTE2NQ==", "bodyText": "Yes better, and make this a Map<ItemStorage, Integer> and increment the quantity in the. And keep ItemStorage the same", "url": "https://github.com/ldtteam/minecolonies/pull/4759#discussion_r415149165", "createdAt": "2020-04-25T21:36:04Z", "author": {"login": "Raycoms"}, "path": "src/main/java/com/minecolonies/coremod/client/gui/WindowHutAllInventory.java", "diffHunk": "@@ -135,7 +135,7 @@ private void updateResources()\n     {\n         final List<BlockPos> containerList = building.getContainerList();\n \n-        final List<ItemStack> items = new ArrayList<>();\n+        final Map<ItemStorage, ItemStorage> storedItems = new HashMap<>();\n         final World world = building.getColony().getWorld();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "88ab8f2181756b1fdf8dd38e8ffa6878780c3378"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTE1MTkxOQ==", "bodyText": "Did that.", "url": "https://github.com/ldtteam/minecolonies/pull/4759#discussion_r415151919", "createdAt": "2020-04-25T21:52:36Z", "author": {"login": "ToMe25"}, "path": "src/main/java/com/minecolonies/coremod/client/gui/WindowHutAllInventory.java", "diffHunk": "@@ -135,7 +135,7 @@ private void updateResources()\n     {\n         final List<BlockPos> containerList = building.getContainerList();\n \n-        final List<ItemStack> items = new ArrayList<>();\n+        final Map<ItemStorage, ItemStorage> storedItems = new HashMap<>();\n         final World world = building.getColony().getWorld();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTE0OTE2NQ=="}, "originalCommit": {"oid": "88ab8f2181756b1fdf8dd38e8ffa6878780c3378"}, "originalPosition": 6}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU4MTQ3NTU1OnYy", "diffSide": "RIGHT", "path": "src/api/java/com/minecolonies/api/tileentities/TileEntityRack.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yNVQyMTo0MDowNVrOGL6u3g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yNVQyMTo1MjoyOFrOGL63HA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTE0OTc5MA==", "bodyText": "this should not be necessary.", "url": "https://github.com/ldtteam/minecolonies/pull/4759#discussion_r415149790", "createdAt": "2020-04-25T21:40:05Z", "author": {"login": "Raycoms"}, "path": "src/api/java/com/minecolonies/api/tileentities/TileEntityRack.java", "diffHunk": "@@ -231,6 +231,7 @@ public void updateItemStorage()\n             {\n                 amount += content.remove(storage);\n             }\n+            storage.setAmount(amount);\n             content.put(storage, amount);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "88ab8f2181756b1fdf8dd38e8ffa6878780c3378"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTE1MDA3Mw==", "bodyText": "ok i will remove it.", "url": "https://github.com/ldtteam/minecolonies/pull/4759#discussion_r415150073", "createdAt": "2020-04-25T21:41:26Z", "author": {"login": "ToMe25"}, "path": "src/api/java/com/minecolonies/api/tileentities/TileEntityRack.java", "diffHunk": "@@ -231,6 +231,7 @@ public void updateItemStorage()\n             {\n                 amount += content.remove(storage);\n             }\n+            storage.setAmount(amount);\n             content.put(storage, amount);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTE0OTc5MA=="}, "originalCommit": {"oid": "88ab8f2181756b1fdf8dd38e8ffa6878780c3378"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTE1MTkwMA==", "bodyText": "I removed it.", "url": "https://github.com/ldtteam/minecolonies/pull/4759#discussion_r415151900", "createdAt": "2020-04-25T21:52:28Z", "author": {"login": "ToMe25"}, "path": "src/api/java/com/minecolonies/api/tileentities/TileEntityRack.java", "diffHunk": "@@ -231,6 +231,7 @@ public void updateItemStorage()\n             {\n                 amount += content.remove(storage);\n             }\n+            storage.setAmount(amount);\n             content.put(storage, amount);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTE0OTc5MA=="}, "originalCommit": {"oid": "88ab8f2181756b1fdf8dd38e8ffa6878780c3378"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU4MTQ5NDQ0OnYy", "diffSide": "RIGHT", "path": "src/main/java/com/minecolonies/coremod/client/gui/WindowHutAllInventory.java", "isResolved": true, "comments": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yNVQyMTo1MjoxMlrOGL63CA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yNlQwODowODo1M1rOGMAydQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTE1MTg4MA==", "bodyText": "Is like this OK, or do i have to find another way to set the amount of the ItemStorage?", "url": "https://github.com/ldtteam/minecolonies/pull/4759#discussion_r415151880", "createdAt": "2020-04-25T21:52:12Z", "author": {"login": "ToMe25"}, "path": "src/main/java/com/minecolonies/coremod/client/gui/WindowHutAllInventory.java", "diffHunk": "@@ -158,29 +165,25 @@ else if (rack instanceof ChestTileEntity)\n                     final ItemStack stack = ((ChestTileEntity) rack).getStackInSlot(slot);\n                     if (!ItemStackUtils.isEmpty(stack))\n                     {\n-                        items.add(stack.copy());\n+                        ItemStorage currentStorage = new ItemStorage(stack.copy());\n+                        if (storedItems.containsKey(currentStorage))\n+                        {\n+                            storedItems.put(currentStorage, storedItems.get(currentStorage) + stack.getCount());\n+                        }\n+                        else\n+                        {\n+                        \tstoredItems.put(currentStorage, stack.getCount());\n+                        }\n                     }\n                 }\n             }\n         }\n \n-        final Map<ItemStorage, ItemStorage> storedItems = new HashMap<>();\n-        for (final ItemStack currentItem : items)\n-        {\n-            final ItemStorage currentStorage = new ItemStorage(currentItem, currentItem.getCount(), false);\n-\n-            if (storedItems.containsKey(currentStorage))\n-            {\n-                final ItemStorage existing = storedItems.get(currentStorage);\n-                existing.setAmount(existing.getAmount() + currentStorage.getAmount());\n-            }\n-            else\n-            {\n-                storedItems.put(currentStorage, currentStorage);\n-            }\n-        }\n-\n-        final List<ItemStorage> filterItems = new ArrayList<>(storedItems.keySet());\n+        final List<ItemStorage> filterItems = new ArrayList<>();\n+        storedItems.forEach((storage, amount) -> {\n+            storage.setAmount(amount);\n+            filterItems.add(storage);\n+        });", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2c5286655568afbc7698903b01346915b2af8012"}, "originalPosition": 65}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTE1MjUwMw==", "bodyText": "Should be fine like this.\nDid you test this?", "url": "https://github.com/ldtteam/minecolonies/pull/4759#discussion_r415152503", "createdAt": "2020-04-25T21:56:09Z", "author": {"login": "Raycoms"}, "path": "src/main/java/com/minecolonies/coremod/client/gui/WindowHutAllInventory.java", "diffHunk": "@@ -158,29 +165,25 @@ else if (rack instanceof ChestTileEntity)\n                     final ItemStack stack = ((ChestTileEntity) rack).getStackInSlot(slot);\n                     if (!ItemStackUtils.isEmpty(stack))\n                     {\n-                        items.add(stack.copy());\n+                        ItemStorage currentStorage = new ItemStorage(stack.copy());\n+                        if (storedItems.containsKey(currentStorage))\n+                        {\n+                            storedItems.put(currentStorage, storedItems.get(currentStorage) + stack.getCount());\n+                        }\n+                        else\n+                        {\n+                        \tstoredItems.put(currentStorage, stack.getCount());\n+                        }\n                     }\n                 }\n             }\n         }\n \n-        final Map<ItemStorage, ItemStorage> storedItems = new HashMap<>();\n-        for (final ItemStack currentItem : items)\n-        {\n-            final ItemStorage currentStorage = new ItemStorage(currentItem, currentItem.getCount(), false);\n-\n-            if (storedItems.containsKey(currentStorage))\n-            {\n-                final ItemStorage existing = storedItems.get(currentStorage);\n-                existing.setAmount(existing.getAmount() + currentStorage.getAmount());\n-            }\n-            else\n-            {\n-                storedItems.put(currentStorage, currentStorage);\n-            }\n-        }\n-\n-        final List<ItemStorage> filterItems = new ArrayList<>(storedItems.keySet());\n+        final List<ItemStorage> filterItems = new ArrayList<>();\n+        storedItems.forEach((storage, amount) -> {\n+            storage.setAmount(amount);\n+            filterItems.add(storage);\n+        });", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTE1MTg4MA=="}, "originalCommit": {"oid": "2c5286655568afbc7698903b01346915b2af8012"}, "originalPosition": 65}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTE1MjU4Mw==", "bodyText": "Yes i did.", "url": "https://github.com/ldtteam/minecolonies/pull/4759#discussion_r415152583", "createdAt": "2020-04-25T21:56:26Z", "author": {"login": "ToMe25"}, "path": "src/main/java/com/minecolonies/coremod/client/gui/WindowHutAllInventory.java", "diffHunk": "@@ -158,29 +165,25 @@ else if (rack instanceof ChestTileEntity)\n                     final ItemStack stack = ((ChestTileEntity) rack).getStackInSlot(slot);\n                     if (!ItemStackUtils.isEmpty(stack))\n                     {\n-                        items.add(stack.copy());\n+                        ItemStorage currentStorage = new ItemStorage(stack.copy());\n+                        if (storedItems.containsKey(currentStorage))\n+                        {\n+                            storedItems.put(currentStorage, storedItems.get(currentStorage) + stack.getCount());\n+                        }\n+                        else\n+                        {\n+                        \tstoredItems.put(currentStorage, stack.getCount());\n+                        }\n                     }\n                 }\n             }\n         }\n \n-        final Map<ItemStorage, ItemStorage> storedItems = new HashMap<>();\n-        for (final ItemStack currentItem : items)\n-        {\n-            final ItemStorage currentStorage = new ItemStorage(currentItem, currentItem.getCount(), false);\n-\n-            if (storedItems.containsKey(currentStorage))\n-            {\n-                final ItemStorage existing = storedItems.get(currentStorage);\n-                existing.setAmount(existing.getAmount() + currentStorage.getAmount());\n-            }\n-            else\n-            {\n-                storedItems.put(currentStorage, currentStorage);\n-            }\n-        }\n-\n-        final List<ItemStorage> filterItems = new ArrayList<>(storedItems.keySet());\n+        final List<ItemStorage> filterItems = new ArrayList<>();\n+        storedItems.forEach((storage, amount) -> {\n+            storage.setAmount(amount);\n+            filterItems.add(storage);\n+        });", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTE1MTg4MA=="}, "originalCommit": {"oid": "2c5286655568afbc7698903b01346915b2af8012"}, "originalPosition": 65}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTE1Mjg0Nw==", "bodyText": "If you want to suggest any more changes, i will look at it tomorrow, today its late enough :)", "url": "https://github.com/ldtteam/minecolonies/pull/4759#discussion_r415152847", "createdAt": "2020-04-25T21:58:15Z", "author": {"login": "ToMe25"}, "path": "src/main/java/com/minecolonies/coremod/client/gui/WindowHutAllInventory.java", "diffHunk": "@@ -158,29 +165,25 @@ else if (rack instanceof ChestTileEntity)\n                     final ItemStack stack = ((ChestTileEntity) rack).getStackInSlot(slot);\n                     if (!ItemStackUtils.isEmpty(stack))\n                     {\n-                        items.add(stack.copy());\n+                        ItemStorage currentStorage = new ItemStorage(stack.copy());\n+                        if (storedItems.containsKey(currentStorage))\n+                        {\n+                            storedItems.put(currentStorage, storedItems.get(currentStorage) + stack.getCount());\n+                        }\n+                        else\n+                        {\n+                        \tstoredItems.put(currentStorage, stack.getCount());\n+                        }\n                     }\n                 }\n             }\n         }\n \n-        final Map<ItemStorage, ItemStorage> storedItems = new HashMap<>();\n-        for (final ItemStack currentItem : items)\n-        {\n-            final ItemStorage currentStorage = new ItemStorage(currentItem, currentItem.getCount(), false);\n-\n-            if (storedItems.containsKey(currentStorage))\n-            {\n-                final ItemStorage existing = storedItems.get(currentStorage);\n-                existing.setAmount(existing.getAmount() + currentStorage.getAmount());\n-            }\n-            else\n-            {\n-                storedItems.put(currentStorage, currentStorage);\n-            }\n-        }\n-\n-        final List<ItemStorage> filterItems = new ArrayList<>(storedItems.keySet());\n+        final List<ItemStorage> filterItems = new ArrayList<>();\n+        storedItems.forEach((storage, amount) -> {\n+            storage.setAmount(amount);\n+            filterItems.add(storage);\n+        });", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTE1MTg4MA=="}, "originalCommit": {"oid": "2c5286655568afbc7698903b01346915b2af8012"}, "originalPosition": 65}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTE1OTAyOQ==", "bodyText": "Looks fine for me now. Does this solve all the issues there were before?\nCan you add an additional check to query the rack from the position of the building itself (it's not include din the list of containers, so it needs an additional line to add the stacks from it.", "url": "https://github.com/ldtteam/minecolonies/pull/4759#discussion_r415159029", "createdAt": "2020-04-25T22:36:35Z", "author": {"login": "Raycoms"}, "path": "src/main/java/com/minecolonies/coremod/client/gui/WindowHutAllInventory.java", "diffHunk": "@@ -158,29 +165,25 @@ else if (rack instanceof ChestTileEntity)\n                     final ItemStack stack = ((ChestTileEntity) rack).getStackInSlot(slot);\n                     if (!ItemStackUtils.isEmpty(stack))\n                     {\n-                        items.add(stack.copy());\n+                        ItemStorage currentStorage = new ItemStorage(stack.copy());\n+                        if (storedItems.containsKey(currentStorage))\n+                        {\n+                            storedItems.put(currentStorage, storedItems.get(currentStorage) + stack.getCount());\n+                        }\n+                        else\n+                        {\n+                        \tstoredItems.put(currentStorage, stack.getCount());\n+                        }\n                     }\n                 }\n             }\n         }\n \n-        final Map<ItemStorage, ItemStorage> storedItems = new HashMap<>();\n-        for (final ItemStack currentItem : items)\n-        {\n-            final ItemStorage currentStorage = new ItemStorage(currentItem, currentItem.getCount(), false);\n-\n-            if (storedItems.containsKey(currentStorage))\n-            {\n-                final ItemStorage existing = storedItems.get(currentStorage);\n-                existing.setAmount(existing.getAmount() + currentStorage.getAmount());\n-            }\n-            else\n-            {\n-                storedItems.put(currentStorage, currentStorage);\n-            }\n-        }\n-\n-        final List<ItemStorage> filterItems = new ArrayList<>(storedItems.keySet());\n+        final List<ItemStorage> filterItems = new ArrayList<>();\n+        storedItems.forEach((storage, amount) -> {\n+            storage.setAmount(amount);\n+            filterItems.add(storage);\n+        });", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTE1MTg4MA=="}, "originalCommit": {"oid": "2c5286655568afbc7698903b01346915b2af8012"}, "originalPosition": 65}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTIzODA3MA==", "bodyText": "\"Does this solve all the issues there were before?\" idk, i don't know about many issues with this view, i just made this to fix the linked issue.\n\"Can you add an additional check to query the rack from the position of the building itself\" I can do that, but i think lexustec said he is working on that, so i wouldn't put that in here.", "url": "https://github.com/ldtteam/minecolonies/pull/4759#discussion_r415238070", "createdAt": "2020-04-26T07:10:59Z", "author": {"login": "ToMe25"}, "path": "src/main/java/com/minecolonies/coremod/client/gui/WindowHutAllInventory.java", "diffHunk": "@@ -158,29 +165,25 @@ else if (rack instanceof ChestTileEntity)\n                     final ItemStack stack = ((ChestTileEntity) rack).getStackInSlot(slot);\n                     if (!ItemStackUtils.isEmpty(stack))\n                     {\n-                        items.add(stack.copy());\n+                        ItemStorage currentStorage = new ItemStorage(stack.copy());\n+                        if (storedItems.containsKey(currentStorage))\n+                        {\n+                            storedItems.put(currentStorage, storedItems.get(currentStorage) + stack.getCount());\n+                        }\n+                        else\n+                        {\n+                        \tstoredItems.put(currentStorage, stack.getCount());\n+                        }\n                     }\n                 }\n             }\n         }\n \n-        final Map<ItemStorage, ItemStorage> storedItems = new HashMap<>();\n-        for (final ItemStack currentItem : items)\n-        {\n-            final ItemStorage currentStorage = new ItemStorage(currentItem, currentItem.getCount(), false);\n-\n-            if (storedItems.containsKey(currentStorage))\n-            {\n-                final ItemStorage existing = storedItems.get(currentStorage);\n-                existing.setAmount(existing.getAmount() + currentStorage.getAmount());\n-            }\n-            else\n-            {\n-                storedItems.put(currentStorage, currentStorage);\n-            }\n-        }\n-\n-        final List<ItemStorage> filterItems = new ArrayList<>(storedItems.keySet());\n+        final List<ItemStorage> filterItems = new ArrayList<>();\n+        storedItems.forEach((storage, amount) -> {\n+            storage.setAmount(amount);\n+            filterItems.add(storage);\n+        });", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTE1MTg4MA=="}, "originalCommit": {"oid": "2c5286655568afbc7698903b01346915b2af8012"}, "originalPosition": 65}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTI0OTAxMw==", "bodyText": "\"Can you add an additional check to query the rack from the position of the building itself\"\nI have a working version for the warehouse now, i will test it with some other buildings, and than hopefully push it.", "url": "https://github.com/ldtteam/minecolonies/pull/4759#discussion_r415249013", "createdAt": "2020-04-26T08:08:53Z", "author": {"login": "ToMe25"}, "path": "src/main/java/com/minecolonies/coremod/client/gui/WindowHutAllInventory.java", "diffHunk": "@@ -158,29 +165,25 @@ else if (rack instanceof ChestTileEntity)\n                     final ItemStack stack = ((ChestTileEntity) rack).getStackInSlot(slot);\n                     if (!ItemStackUtils.isEmpty(stack))\n                     {\n-                        items.add(stack.copy());\n+                        ItemStorage currentStorage = new ItemStorage(stack.copy());\n+                        if (storedItems.containsKey(currentStorage))\n+                        {\n+                            storedItems.put(currentStorage, storedItems.get(currentStorage) + stack.getCount());\n+                        }\n+                        else\n+                        {\n+                        \tstoredItems.put(currentStorage, stack.getCount());\n+                        }\n                     }\n                 }\n             }\n         }\n \n-        final Map<ItemStorage, ItemStorage> storedItems = new HashMap<>();\n-        for (final ItemStack currentItem : items)\n-        {\n-            final ItemStorage currentStorage = new ItemStorage(currentItem, currentItem.getCount(), false);\n-\n-            if (storedItems.containsKey(currentStorage))\n-            {\n-                final ItemStorage existing = storedItems.get(currentStorage);\n-                existing.setAmount(existing.getAmount() + currentStorage.getAmount());\n-            }\n-            else\n-            {\n-                storedItems.put(currentStorage, currentStorage);\n-            }\n-        }\n-\n-        final List<ItemStorage> filterItems = new ArrayList<>(storedItems.keySet());\n+        final List<ItemStorage> filterItems = new ArrayList<>();\n+        storedItems.forEach((storage, amount) -> {\n+            storage.setAmount(amount);\n+            filterItems.add(storage);\n+        });", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTE1MTg4MA=="}, "originalCommit": {"oid": "2c5286655568afbc7698903b01346915b2af8012"}, "originalPosition": 65}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3148, "cost": 1, "resetAt": "2021-11-12T20:44:06Z"}}}