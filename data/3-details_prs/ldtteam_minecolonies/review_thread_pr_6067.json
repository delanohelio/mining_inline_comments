{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE5NTk2Nzgy", "number": 6067, "reviewThreads": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMlQwODoyNTozMFrOE4DG_Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wNlQxMzo1OTo0NlrOFBcz5Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI3MjA2NjUzOnYy", "diffSide": "RIGHT", "path": "src/main/java/com/minecolonies/coremod/entity/ai/basic/AbstractEntityAIBasic.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMlQwODoyNTozMFrOHxvglw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMlQwODoyNTozMFrOHxvglw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTkyMDY2Mw==", "bodyText": "jdoc", "url": "https://github.com/ldtteam/minecolonies/pull/6067#discussion_r521920663", "createdAt": "2020-11-12T08:25:30Z", "author": {"login": "Raycoms"}, "path": "src/main/java/com/minecolonies/coremod/entity/ai/basic/AbstractEntityAIBasic.java", "diffHunk": "@@ -1050,10 +1057,23 @@ else if (dumpOneMoreSlot())\n             // Note that this will not create a pickup request when another request is already in progress.\n             building.createPickupRequest(scaledPriority(building.getPickUpPriority()));\n             hasDumpedItems = false;\n+            fastPickup.clear();\n+        } \n+        else if (!fastPickup.isEmpty())\n+        {\n+            building.createPickupRequest(scaledPriority(building.getPickUpPriority()), fastPickup);\n+            fastPickup.clear();\n         }\n+\n+\n         return afterDump();\n     }\n \n+    public boolean addItemForFastPickup(ItemStack item)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1fbcc9e27cb514520b4a17e770fb8e1332c69519"}, "originalPosition": 44}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM0MTM2Njg3OnYy", "diffSide": "RIGHT", "path": "src/main/java/com/minecolonies/coremod/colony/buildings/AbstractBuildingWorker.java", "isResolved": true, "comments": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0zMFQxMzozOToyMlrOH77fVA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0zMFQxNjozMDoyNVrOH8DNTg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjYwMjcwOA==", "bodyText": "Might this here cause issues? @someaddons", "url": "https://github.com/ldtteam/minecolonies/pull/6067#discussion_r532602708", "createdAt": "2020-11-30T13:39:22Z", "author": {"login": "Raycoms"}, "path": "src/main/java/com/minecolonies/coremod/colony/buildings/AbstractBuildingWorker.java", "diffHunk": "@@ -911,6 +912,13 @@ else if((forceReplace || newRecipe.getMustExist()) && duplicateFound != recipeTo\n      */\n     public String getJobDisplayName()\n     {\n+        if(jobDisplayName.isEmpty())\n+        {\n+            //This will only happen if getJobDisplayName is called before the first citizen is assigned. \n+            ICitizenData citizen = colony.getCitizenManager().createAndRegisterCivilianData();\n+            jobDisplayName = this.createJob(citizen).getName();\n+            colony.getCitizenManager().removeCivilian(citizen);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7650b8fc8ae3fa78e65c08056e738b5dd9624df8"}, "originalPosition": 174}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjYwNzAyNQ==", "bodyText": "hm not sure tbh, though this is a pretty weird solution to just get a name, seems like a hacky solution with a high overhead. Should be able to solve this much more smoothly", "url": "https://github.com/ldtteam/minecolonies/pull/6067#discussion_r532607025", "createdAt": "2020-11-30T13:45:56Z", "author": {"login": "someaddons"}, "path": "src/main/java/com/minecolonies/coremod/colony/buildings/AbstractBuildingWorker.java", "diffHunk": "@@ -911,6 +912,13 @@ else if((forceReplace || newRecipe.getMustExist()) && duplicateFound != recipeTo\n      */\n     public String getJobDisplayName()\n     {\n+        if(jobDisplayName.isEmpty())\n+        {\n+            //This will only happen if getJobDisplayName is called before the first citizen is assigned. \n+            ICitizenData citizen = colony.getCitizenManager().createAndRegisterCivilianData();\n+            jobDisplayName = this.createJob(citizen).getName();\n+            colony.getCitizenManager().removeCivilian(citizen);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjYwMjcwOA=="}, "originalCommit": {"oid": "7650b8fc8ae3fa78e65c08056e738b5dd9624df8"}, "originalPosition": 174}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjYyMDEwMg==", "bodyText": "I just checked and it seems to be not used at all? so could just remove it", "url": "https://github.com/ldtteam/minecolonies/pull/6067#discussion_r532620102", "createdAt": "2020-11-30T14:05:15Z", "author": {"login": "someaddons"}, "path": "src/main/java/com/minecolonies/coremod/colony/buildings/AbstractBuildingWorker.java", "diffHunk": "@@ -911,6 +912,13 @@ else if((forceReplace || newRecipe.getMustExist()) && duplicateFound != recipeTo\n      */\n     public String getJobDisplayName()\n     {\n+        if(jobDisplayName.isEmpty())\n+        {\n+            //This will only happen if getJobDisplayName is called before the first citizen is assigned. \n+            ICitizenData citizen = colony.getCitizenManager().createAndRegisterCivilianData();\n+            jobDisplayName = this.createJob(citizen).getName();\n+            colony.getCitizenManager().removeCivilian(citizen);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjYwMjcwOA=="}, "originalCommit": {"oid": "7650b8fc8ae3fa78e65c08056e738b5dd9624df8"}, "originalPosition": 174}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjcwMjA5Ng==", "bodyText": "This is used, in both PublicWorkerCraftingProductionResolver and PublicWorkerCraftingRequestResolver. In both of those cases, it shouldn't go through this codepath. The codepath that might hit his is the one in WindowTownHall.java, and then only once.\nThis is the result of building.getJobName returning a non-localization key, and being needed by the crafting code. This is the only contact the building has today with the actual job, and to get the jobName localization key.", "url": "https://github.com/ldtteam/minecolonies/pull/6067#discussion_r532702096", "createdAt": "2020-11-30T15:54:47Z", "author": {"login": "Mekle001"}, "path": "src/main/java/com/minecolonies/coremod/colony/buildings/AbstractBuildingWorker.java", "diffHunk": "@@ -911,6 +912,13 @@ else if((forceReplace || newRecipe.getMustExist()) && duplicateFound != recipeTo\n      */\n     public String getJobDisplayName()\n     {\n+        if(jobDisplayName.isEmpty())\n+        {\n+            //This will only happen if getJobDisplayName is called before the first citizen is assigned. \n+            ICitizenData citizen = colony.getCitizenManager().createAndRegisterCivilianData();\n+            jobDisplayName = this.createJob(citizen).getName();\n+            colony.getCitizenManager().removeCivilian(citizen);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjYwMjcwOA=="}, "originalCommit": {"oid": "7650b8fc8ae3fa78e65c08056e738b5dd9624df8"}, "originalPosition": 174}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjcwNTE3Nw==", "bodyText": "Couldn't we return a \"not loaded\" or so then?", "url": "https://github.com/ldtteam/minecolonies/pull/6067#discussion_r532705177", "createdAt": "2020-11-30T15:58:45Z", "author": {"login": "Raycoms"}, "path": "src/main/java/com/minecolonies/coremod/colony/buildings/AbstractBuildingWorker.java", "diffHunk": "@@ -911,6 +912,13 @@ else if((forceReplace || newRecipe.getMustExist()) && duplicateFound != recipeTo\n      */\n     public String getJobDisplayName()\n     {\n+        if(jobDisplayName.isEmpty())\n+        {\n+            //This will only happen if getJobDisplayName is called before the first citizen is assigned. \n+            ICitizenData citizen = colony.getCitizenManager().createAndRegisterCivilianData();\n+            jobDisplayName = this.createJob(citizen).getName();\n+            colony.getCitizenManager().removeCivilian(citizen);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjYwMjcwOA=="}, "originalCommit": {"oid": "7650b8fc8ae3fa78e65c08056e738b5dd9624df8"}, "originalPosition": 174}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjcwNzUyMg==", "bodyText": "This is serversided and the stuff you're talking about is clientside", "url": "https://github.com/ldtteam/minecolonies/pull/6067#discussion_r532707522", "createdAt": "2020-11-30T16:01:48Z", "author": {"login": "someaddons"}, "path": "src/main/java/com/minecolonies/coremod/colony/buildings/AbstractBuildingWorker.java", "diffHunk": "@@ -911,6 +912,13 @@ else if((forceReplace || newRecipe.getMustExist()) && duplicateFound != recipeTo\n      */\n     public String getJobDisplayName()\n     {\n+        if(jobDisplayName.isEmpty())\n+        {\n+            //This will only happen if getJobDisplayName is called before the first citizen is assigned. \n+            ICitizenData citizen = colony.getCitizenManager().createAndRegisterCivilianData();\n+            jobDisplayName = this.createJob(citizen).getName();\n+            colony.getCitizenManager().removeCivilian(citizen);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjYwMjcwOA=="}, "originalCommit": {"oid": "7650b8fc8ae3fa78e65c08056e738b5dd9624df8"}, "originalPosition": 174}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjcwNzcxMg==", "bodyText": "We could, but then that would show to the user, and they won't know how to fix it (assign a worker to the building). This is specifically the list of job names in the town hall. Right now, the town hall will show 0/1 for a blank job name if the building has never been assigned a worker before this change.", "url": "https://github.com/ldtteam/minecolonies/pull/6067#discussion_r532707712", "createdAt": "2020-11-30T16:02:04Z", "author": {"login": "Mekle001"}, "path": "src/main/java/com/minecolonies/coremod/colony/buildings/AbstractBuildingWorker.java", "diffHunk": "@@ -911,6 +912,13 @@ else if((forceReplace || newRecipe.getMustExist()) && duplicateFound != recipeTo\n      */\n     public String getJobDisplayName()\n     {\n+        if(jobDisplayName.isEmpty())\n+        {\n+            //This will only happen if getJobDisplayName is called before the first citizen is assigned. \n+            ICitizenData citizen = colony.getCitizenManager().createAndRegisterCivilianData();\n+            jobDisplayName = this.createJob(citizen).getName();\n+            colony.getCitizenManager().removeCivilian(citizen);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjYwMjcwOA=="}, "originalCommit": {"oid": "7650b8fc8ae3fa78e65c08056e738b5dd9624df8"}, "originalPosition": 174}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjcwOTQ0Mg==", "bodyText": "This code is serverside, and is serialized to the window for display clientside.", "url": "https://github.com/ldtteam/minecolonies/pull/6067#discussion_r532709442", "createdAt": "2020-11-30T16:04:22Z", "author": {"login": "Mekle001"}, "path": "src/main/java/com/minecolonies/coremod/colony/buildings/AbstractBuildingWorker.java", "diffHunk": "@@ -911,6 +912,13 @@ else if((forceReplace || newRecipe.getMustExist()) && duplicateFound != recipeTo\n      */\n     public String getJobDisplayName()\n     {\n+        if(jobDisplayName.isEmpty())\n+        {\n+            //This will only happen if getJobDisplayName is called before the first citizen is assigned. \n+            ICitizenData citizen = colony.getCitizenManager().createAndRegisterCivilianData();\n+            jobDisplayName = this.createJob(citizen).getName();\n+            colony.getCitizenManager().removeCivilian(citizen);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjYwMjcwOA=="}, "originalCommit": {"oid": "7650b8fc8ae3fa78e65c08056e738b5dd9624df8"}, "originalPosition": 174}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjcxMTc1Mw==", "bodyText": "where is this used in serialization? Unless intelliJ is lying to me its a function that never gets called", "url": "https://github.com/ldtteam/minecolonies/pull/6067#discussion_r532711753", "createdAt": "2020-11-30T16:07:21Z", "author": {"login": "someaddons"}, "path": "src/main/java/com/minecolonies/coremod/colony/buildings/AbstractBuildingWorker.java", "diffHunk": "@@ -911,6 +912,13 @@ else if((forceReplace || newRecipe.getMustExist()) && duplicateFound != recipeTo\n      */\n     public String getJobDisplayName()\n     {\n+        if(jobDisplayName.isEmpty())\n+        {\n+            //This will only happen if getJobDisplayName is called before the first citizen is assigned. \n+            ICitizenData citizen = colony.getCitizenManager().createAndRegisterCivilianData();\n+            jobDisplayName = this.createJob(citizen).getName();\n+            colony.getCitizenManager().removeCivilian(citizen);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjYwMjcwOA=="}, "originalCommit": {"oid": "7650b8fc8ae3fa78e65c08056e738b5dd9624df8"}, "originalPosition": 174}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjcyOTE2Ng==", "bodyText": "Great point, I just looked at the serialization again, and it's referencing the field. It should be calling this function. Fixing.", "url": "https://github.com/ldtteam/minecolonies/pull/6067#discussion_r532729166", "createdAt": "2020-11-30T16:30:25Z", "author": {"login": "Mekle001"}, "path": "src/main/java/com/minecolonies/coremod/colony/buildings/AbstractBuildingWorker.java", "diffHunk": "@@ -911,6 +912,13 @@ else if((forceReplace || newRecipe.getMustExist()) && duplicateFound != recipeTo\n      */\n     public String getJobDisplayName()\n     {\n+        if(jobDisplayName.isEmpty())\n+        {\n+            //This will only happen if getJobDisplayName is called before the first citizen is assigned. \n+            ICitizenData citizen = colony.getCitizenManager().createAndRegisterCivilianData();\n+            jobDisplayName = this.createJob(citizen).getName();\n+            colony.getCitizenManager().removeCivilian(citizen);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjYwMjcwOA=="}, "originalCommit": {"oid": "7650b8fc8ae3fa78e65c08056e738b5dd9624df8"}, "originalPosition": 174}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM0MTM3NDA2OnYy", "diffSide": "RIGHT", "path": "src/main/java/com/minecolonies/coremod/colony/buildings/AbstractBuildingSmelterCrafter.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0zMFQxMzo0MTowNVrOH77jsQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0zMFQxNTo1NzowOVrOH8Bq0w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjYwMzgyNQ==", "bodyText": "seems badly alinged", "url": "https://github.com/ldtteam/minecolonies/pull/6067#discussion_r532603825", "createdAt": "2020-11-30T13:41:05Z", "author": {"login": "Raycoms"}, "path": "src/main/java/com/minecolonies/coremod/colony/buildings/AbstractBuildingSmelterCrafter.java", "diffHunk": "@@ -94,26 +94,31 @@ public int getMaxBuildingLevel()\n                     final IRequest<? extends PublicCrafting> request = (IRequest<? extends PublicCrafting>) colony.getRequestManager().getRequestForToken(taskToken);\n                     if (request != null)\n                     {\n-                        final IRecipeStorage recipeStorage = getFirstFullFillableRecipe(request.getRequest().getStack(), false);\n+                        final IRecipeStorage recipeStorage = getFirstRecipe(request.getRequest().getStack());\n                         if (recipeStorage != null)\n                         {\n                             for (final ItemStorage itemStorage : recipeStorage.getCleanedInput())\n                             {\n                                 int amount = itemStorage.getAmount() * request.getRequest().getCount();\n-                                if (recipeOutputs.containsKey(itemStorage))\n+                                if (requiredItems.containsKey(itemStorage))\n                                 {\n-                                    amount += recipeOutputs.get(itemStorage).getA();\n+                                    amount += requiredItems.get(itemStorage).getA();\n                                 }\n-                                recipeOutputs.put(itemStorage, new Tuple<>(amount, false));\n+                                requiredItems.put(itemStorage, new Tuple<>(amount, false));\n                             }\n                         }\n-                    }\n+                        final ItemStorage output = new ItemStorage(recipeStorage.getPrimaryOutput());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7650b8fc8ae3fa78e65c08056e738b5dd9624df8"}, "originalPosition": 31}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjcwMzk1NQ==", "bodyText": "The problem is actually line 115. Fixing.", "url": "https://github.com/ldtteam/minecolonies/pull/6067#discussion_r532703955", "createdAt": "2020-11-30T15:57:09Z", "author": {"login": "Mekle001"}, "path": "src/main/java/com/minecolonies/coremod/colony/buildings/AbstractBuildingSmelterCrafter.java", "diffHunk": "@@ -94,26 +94,31 @@ public int getMaxBuildingLevel()\n                     final IRequest<? extends PublicCrafting> request = (IRequest<? extends PublicCrafting>) colony.getRequestManager().getRequestForToken(taskToken);\n                     if (request != null)\n                     {\n-                        final IRecipeStorage recipeStorage = getFirstFullFillableRecipe(request.getRequest().getStack(), false);\n+                        final IRecipeStorage recipeStorage = getFirstRecipe(request.getRequest().getStack());\n                         if (recipeStorage != null)\n                         {\n                             for (final ItemStorage itemStorage : recipeStorage.getCleanedInput())\n                             {\n                                 int amount = itemStorage.getAmount() * request.getRequest().getCount();\n-                                if (recipeOutputs.containsKey(itemStorage))\n+                                if (requiredItems.containsKey(itemStorage))\n                                 {\n-                                    amount += recipeOutputs.get(itemStorage).getA();\n+                                    amount += requiredItems.get(itemStorage).getA();\n                                 }\n-                                recipeOutputs.put(itemStorage, new Tuple<>(amount, false));\n+                                requiredItems.put(itemStorage, new Tuple<>(amount, false));\n                             }\n                         }\n-                    }\n+                        final ItemStorage output = new ItemStorage(recipeStorage.getPrimaryOutput());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjYwMzgyNQ=="}, "originalCommit": {"oid": "7650b8fc8ae3fa78e65c08056e738b5dd9624df8"}, "originalPosition": 31}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM3MDY0NzEyOnYy", "diffSide": "RIGHT", "path": "src/main/java/com/minecolonies/coremod/colony/buildings/AbstractBuilding.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wNlQxMzo1ODoxNlrOIAKl8g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wNlQxNTo0Nzo1N1rOIAL2ww==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzA0NDQ2Ng==", "bodyText": "Is this a good idea? I had the null check here on purpose.", "url": "https://github.com/ldtteam/minecolonies/pull/6067#discussion_r537044466", "createdAt": "2020-12-06T13:58:16Z", "author": {"login": "Raycoms"}, "path": "src/main/java/com/minecolonies/coremod/colony/buildings/AbstractBuilding.java", "diffHunk": "@@ -1474,8 +1503,7 @@ public boolean createPickupRequest(final int scaledPriority)\n         {\n             for (final IToken<?> req : reqs)\n             {\n-                final IRequest<?> request = colony.getRequestManager().getRequestForToken(req);\n-                if (request != null && request.getState() == RequestState.IN_PROGRESS)\n+                if (colony.getRequestManager().getRequestForToken(req).getState() == RequestState.IN_PROGRESS)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "26e8ae16ad99d4c6d53bf2414615fc0ec27e2bc0"}, "originalPosition": 54}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzA2Mjk1OQ==", "bodyText": "I am pretty sure that null check is needed as well....\nIt threw exceptions previously but that was removed.", "url": "https://github.com/ldtteam/minecolonies/pull/6067#discussion_r537062959", "createdAt": "2020-12-06T15:35:17Z", "author": {"login": "OrionDevelopment"}, "path": "src/main/java/com/minecolonies/coremod/colony/buildings/AbstractBuilding.java", "diffHunk": "@@ -1474,8 +1503,7 @@ public boolean createPickupRequest(final int scaledPriority)\n         {\n             for (final IToken<?> req : reqs)\n             {\n-                final IRequest<?> request = colony.getRequestManager().getRequestForToken(req);\n-                if (request != null && request.getState() == RequestState.IN_PROGRESS)\n+                if (colony.getRequestManager().getRequestForToken(req).getState() == RequestState.IN_PROGRESS)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzA0NDQ2Ng=="}, "originalCommit": {"oid": "26e8ae16ad99d4c6d53bf2414615fc0ec27e2bc0"}, "originalPosition": 54}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzA2NTE1NQ==", "bodyText": "This is a bad merge/backout of the old code. Fixing.", "url": "https://github.com/ldtteam/minecolonies/pull/6067#discussion_r537065155", "createdAt": "2020-12-06T15:47:57Z", "author": {"login": "Mekle001"}, "path": "src/main/java/com/minecolonies/coremod/colony/buildings/AbstractBuilding.java", "diffHunk": "@@ -1474,8 +1503,7 @@ public boolean createPickupRequest(final int scaledPriority)\n         {\n             for (final IToken<?> req : reqs)\n             {\n-                final IRequest<?> request = colony.getRequestManager().getRequestForToken(req);\n-                if (request != null && request.getState() == RequestState.IN_PROGRESS)\n+                if (colony.getRequestManager().getRequestForToken(req).getState() == RequestState.IN_PROGRESS)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzA0NDQ2Ng=="}, "originalCommit": {"oid": "26e8ae16ad99d4c6d53bf2414615fc0ec27e2bc0"}, "originalPosition": 54}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM3MDY0OTMzOnYy", "diffSide": "RIGHT", "path": "src/main/java/com/minecolonies/coremod/colony/buildings/AbstractBuildingWorker.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wNlQxMzo1OTo0NlrOIAKm-g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wNlQxNTo0ODowNlrOIAL26Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzA0NDczMA==", "bodyText": "I still don't like this since it's not side-effect free. I rather have it return empty for now, until we got a propper fix. (It's only a small UI error after all).", "url": "https://github.com/ldtteam/minecolonies/pull/6067#discussion_r537044730", "createdAt": "2020-12-06T13:59:46Z", "author": {"login": "Raycoms"}, "path": "src/main/java/com/minecolonies/coremod/colony/buildings/AbstractBuildingWorker.java", "diffHunk": "@@ -911,6 +912,13 @@ else if((forceReplace || newRecipe.getMustExist()) && duplicateFound != recipeTo\n      */\n     public String getJobDisplayName()\n     {\n+        if(jobDisplayName.isEmpty())\n+        {\n+            //This will only happen if getJobDisplayName is called before the first citizen is assigned. \n+            ICitizenData citizen = colony.getCitizenManager().createAndRegisterCivilianData();\n+            jobDisplayName = this.createJob(citizen).getName();\n+            colony.getCitizenManager().removeCivilian(citizen);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "26e8ae16ad99d4c6d53bf2414615fc0ec27e2bc0"}, "originalPosition": 183}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzA2NTE5Mw==", "bodyText": "removing for now", "url": "https://github.com/ldtteam/minecolonies/pull/6067#discussion_r537065193", "createdAt": "2020-12-06T15:48:06Z", "author": {"login": "Mekle001"}, "path": "src/main/java/com/minecolonies/coremod/colony/buildings/AbstractBuildingWorker.java", "diffHunk": "@@ -911,6 +912,13 @@ else if((forceReplace || newRecipe.getMustExist()) && duplicateFound != recipeTo\n      */\n     public String getJobDisplayName()\n     {\n+        if(jobDisplayName.isEmpty())\n+        {\n+            //This will only happen if getJobDisplayName is called before the first citizen is assigned. \n+            ICitizenData citizen = colony.getCitizenManager().createAndRegisterCivilianData();\n+            jobDisplayName = this.createJob(citizen).getName();\n+            colony.getCitizenManager().removeCivilian(citizen);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzA0NDczMA=="}, "originalCommit": {"oid": "26e8ae16ad99d4c6d53bf2414615fc0ec27e2bc0"}, "originalPosition": 183}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3390, "cost": 1, "resetAt": "2021-11-12T20:44:06Z"}}}