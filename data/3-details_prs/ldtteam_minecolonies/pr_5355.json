{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ1NDU2NjU0", "number": 5355, "title": "Tavern2", "bodyText": "Changes proposed in this pull request:\n\nAdds a new feature which spawns visitors to the tavern, which a player then can recruit for varying costs.\nFor that it adds a new interaction type called recruitmentinteraction, which displays and handles the item stack cost for recruitment. The costs for recruitment are loaded from the config, with given item and weight on it.\nInteractions now are able to return the icon supposed to render for it.\nInteraction responses now are kept in insertion order instead of random hashmap order\nInteractions now know the player its interaction it, rather than the world.\nAdded a WorldUtil class with helper functions for checking chunk load status properly\nAdded a schematic constants class, for string tags used in schematics. Should be in sync with the builder's tag list.\nFixes:\nFix bed pos and last pos getting written to the same nbt tag, overwriting eachother.\nFix guards not moving out when fired.\nFix tavern music only playing when you were close enough when it started\nFix raider respawns, when sometimes an entity gets into an unloaded chunk but not removed\nFix claim command requiring an existing colony, so you now can unclaim already deleted colonies\nFix whereami command distance output\nFix loading chunks on entity enter event\nReview please", "createdAt": "2020-07-07T14:37:09Z", "url": "https://github.com/ldtteam/minecolonies/pull/5355", "merged": true, "mergeCommit": {"oid": "79b0c333d4bbb0e41368a6140b313292ace3108a"}, "closed": true, "closedAt": "2020-07-18T09:23:33Z", "author": {"login": "someaddons"}, "timelineItems": {"totalCount": 33, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABck09I8AH2gAyNDQ1NDU2NjU0OmE3MWQwNTUxY2QzMjQzYTEwNjQwMDhkOGY3ZjZhNjEwM2E1NTcyYTQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc17D85gH2gAyNDQ1NDU2NjU0OmVhMGQ4M2Y3MDFmYTMwYzY0MjViYWUzYzhjZTlkNTg4Njk5NjhhNjk=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "a71d0551cd3243a1064008d8f7f6a6103a5572a4", "author": {"user": {"login": "someaddons", "name": null}}, "url": "https://github.com/ldtteam/minecolonies/commit/a71d0551cd3243a1064008d8f7f6a6103a5572a4", "committedDate": "2020-05-25T19:09:12Z", "message": "Tavern3"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "20a5c19db597e8033ffd648d5e5673228bd88d67", "author": {"user": {"login": "someaddons", "name": null}}, "url": "https://github.com/ldtteam/minecolonies/commit/20a5c19db597e8033ffd648d5e5673228bd88d67", "committedDate": "2020-06-01T13:25:28Z", "message": "Merge remote-tracking branch 'remotes/origin/version/1.15' into tavern2\n\n# Conflicts:\n#\tsrc/main/resources/assets/minecolonies/lang/en_us.json"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d10f0ec55ad26ca70e07e8617d939ca9d5135785", "author": {"user": {"login": "someaddons", "name": null}}, "url": "https://github.com/ldtteam/minecolonies/commit/d10f0ec55ad26ca70e07e8617d939ca9d5135785", "committedDate": "2020-06-01T21:02:03Z", "message": "Merge remote-tracking branch 'remotes/origin/version/1.15' into tavern2"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b6c78711c031f8d426f8d098caee515355c37448", "author": {"user": {"login": "someaddons", "name": null}}, "url": "https://github.com/ldtteam/minecolonies/commit/b6c78711c031f8d426f8d098caee515355c37448", "committedDate": "2020-06-05T18:47:57Z", "message": "Merge remote-tracking branch 'remotes/origin/version/1.15' into tavern2"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7953b7fb20e9f470ed7ecbff7653ed6da90d16cd", "author": {"user": {"login": "someaddons", "name": null}}, "url": "https://github.com/ldtteam/minecolonies/commit/7953b7fb20e9f470ed7ecbff7653ed6da90d16cd", "committedDate": "2020-06-27T17:43:20Z", "message": "Merge remote-tracking branch 'remotes/origin/version/1.15' into tavern2\n\n# Conflicts:\n#\tsrc/main/java/com/minecolonies/apiimp/initializer/ModColonyEventTypeInitializer.java\n#\tsrc/main/java/com/minecolonies/coremod/entity/citizen/EntityCitizen.java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "380205254fbb388b665479b312f10bcf4b016202", "author": {"user": {"login": "someaddons", "name": null}}, "url": "https://github.com/ldtteam/minecolonies/commit/380205254fbb388b665479b312f10bcf4b016202", "committedDate": "2020-07-07T12:57:53Z", "message": "Tavern2:\nRecruitable citizens spawn periodically, with varying stats and recruitment costs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4763fcf0e3734bf51a8bc474b2f86ceaeac5cab9", "author": {"user": {"login": "someaddons", "name": null}}, "url": "https://github.com/ldtteam/minecolonies/commit/4763fcf0e3734bf51a8bc474b2f86ceaeac5cab9", "committedDate": "2020-07-07T13:10:01Z", "message": "Merge remote-tracking branch 'remotes/origin/version/1.15' into tavern2\n\n# Conflicts:\n#\tsrc/api/java/com/minecolonies/api/colony/ICitizenData.java\n#\tsrc/api/java/com/minecolonies/api/colony/interactionhandling/IInteractionResponseHandler.java\n#\tsrc/api/java/com/minecolonies/api/colony/interactionhandling/ModInteractionResponseHandlers.java\n#\tsrc/api/java/com/minecolonies/api/colony/managers/interfaces/ICitizenManager.java\n#\tsrc/main/java/com/minecolonies/apiimp/initializer/EntityInitializer.java\n#\tsrc/main/java/com/minecolonies/coremod/client/gui/WindowInteraction.java\n#\tsrc/main/java/com/minecolonies/coremod/client/gui/WindowTownHallHireCitizen.java\n#\tsrc/main/java/com/minecolonies/coremod/client/render/RenderBipedCitizen.java\n#\tsrc/main/java/com/minecolonies/coremod/colony/CitizenDataView.java\n#\tsrc/main/java/com/minecolonies/coremod/colony/Colony.java\n#\tsrc/main/java/com/minecolonies/coremod/colony/ColonyView.java\n#\tsrc/main/java/com/minecolonies/coremod/colony/interactionhandling/PosBasedInteractionResponseHandler.java\n#\tsrc/main/java/com/minecolonies/coremod/colony/interactionhandling/ServerCitizenInteractionResponseHandler.java\n#\tsrc/main/java/com/minecolonies/coremod/entity/ai/minimal/EntityAICitizenAvoidEntity.java\n#\tsrc/main/java/com/minecolonies/coremod/entity/citizen/citizenhandlers/CitizenChatHandler.java\n#\tsrc/main/java/com/minecolonies/coremod/event/ClientEventHandler.java\n#\tsrc/main/java/com/minecolonies/coremod/network/messages/server/colony/citizen/BuyCitizenMessage.java\n#\tsrc/main/resources/assets/minecolonies/gui/citizen/windowinteraction.xml\n#\tsrc/main/resources/assets/minecolonies/lang/en_us.json"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f02a66cb409cebe090347b9cd4d1ba7eabb2bda2", "author": {"user": {"login": "someaddons", "name": null}}, "url": "https://github.com/ldtteam/minecolonies/commit/f02a66cb409cebe090347b9cd4d1ba7eabb2bda2", "committedDate": "2020-07-07T14:36:12Z", "message": "fix compile"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ad0af17b133e5f3e4dd3ea029a24c8685ffb2a03", "author": {"user": {"login": "Raycoms", "name": null}}, "url": "https://github.com/ldtteam/minecolonies/commit/ad0af17b133e5f3e4dd3ea029a24c8685ffb2a03", "committedDate": "2020-07-07T16:55:19Z", "message": "Merge branch 'version/1.15' into tavern2"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ0MDgwMDUw", "url": "https://github.com/ldtteam/minecolonies/pull/5355#pullrequestreview-444080050", "createdAt": "2020-07-07T16:55:34Z", "commit": {"oid": "ad0af17b133e5f3e4dd3ea029a24c8685ffb2a03"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wN1QxNjo1NTozNVrOGuHZ1A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wN1QxNjo1NTozNVrOGuHZ1A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTAwODk4MA==", "bodyText": "ehem ehem", "url": "https://github.com/ldtteam/minecolonies/pull/5355#discussion_r451008980", "createdAt": "2020-07-07T16:55:35Z", "author": {"login": "Raycoms"}, "path": "build.gradle", "diffHunk": "@@ -105,7 +105,7 @@ dependencies {\n }\n \n group = \"com.minecolonies\"\n-version = config.minecraft_version.toString() + \"-\" + System.getenv().containsKey(\"Version\") ? System.getenv(\"Version\") : 'null'\n+version = config.minecraft_version.toString() + \"-\" + \"0.11.950-universal\"\n archivesBaseName = \"minecolonies\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ad0af17b133e5f3e4dd3ea029a24c8685ffb2a03"}, "originalPosition": 6}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ0MDgwNDkx", "url": "https://github.com/ldtteam/minecolonies/pull/5355#pullrequestreview-444080491", "createdAt": "2020-07-07T16:56:10Z", "commit": {"oid": "ad0af17b133e5f3e4dd3ea029a24c8685ffb2a03"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wN1QxNjo1NjoxMFrOGuHbSg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wN1QxNjo1NjoxMFrOGuHbSg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTAwOTM1NA==", "bodyText": "jdoc in this file", "url": "https://github.com/ldtteam/minecolonies/pull/5355#discussion_r451009354", "createdAt": "2020-07-07T16:56:10Z", "author": {"login": "Raycoms"}, "path": "src/api/java/com/minecolonies/api/colony/IColony.java", "diffHunk": "@@ -115,6 +115,8 @@ default String getTeamName()\n         return TEAM_COLONY_NAME + \"_\" + getDimension() + \"_\" + getID();\n     }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ad0af17b133e5f3e4dd3ea029a24c8685ffb2a03"}, "originalPosition": 2}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ0MDgwODI1", "url": "https://github.com/ldtteam/minecolonies/pull/5355#pullrequestreview-444080825", "createdAt": "2020-07-07T16:56:37Z", "commit": {"oid": "ad0af17b133e5f3e4dd3ea029a24c8685ffb2a03"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wN1QxNjo1NjozN1rOGuHcVw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wN1QxNjo1NjozN1rOGuHcVw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTAwOTYyMw==", "bodyText": "returns what?", "url": "https://github.com/ldtteam/minecolonies/pull/5355#discussion_r451009623", "createdAt": "2020-07-07T16:56:37Z", "author": {"login": "Raycoms"}, "path": "src/api/java/com/minecolonies/api/colony/IColonyView.java", "diffHunk": "@@ -442,4 +435,12 @@\n     List<CompactColonyReference> getFeuds();\n \n     boolean areSpiesEnabled();\n+\n+    /**\n+     * Gets the data view for a visitor\n+     *\n+     * @param citizenId\n+     * @return", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ad0af17b133e5f3e4dd3ea029a24c8685ffb2a03"}, "originalPosition": 45}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ0MDgwOTMy", "url": "https://github.com/ldtteam/minecolonies/pull/5355#pullrequestreview-444080932", "createdAt": "2020-07-07T16:56:44Z", "commit": {"oid": "ad0af17b133e5f3e4dd3ea029a24c8685ffb2a03"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wN1QxNjo1Njo0NFrOGuHctQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wN1QxNjo1Njo0NFrOGuHctQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTAwOTcxNw==", "bodyText": "jdc", "url": "https://github.com/ldtteam/minecolonies/pull/5355#discussion_r451009717", "createdAt": "2020-07-07T16:56:44Z", "author": {"login": "Raycoms"}, "path": "src/api/java/com/minecolonies/api/colony/IColonyView.java", "diffHunk": "@@ -251,6 +248,9 @@\n     @Nullable\n     IMessage handleColonyViewCitizensMessage(int id, PacketBuffer buf);\n \n+    @Nullable", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ad0af17b133e5f3e4dd3ea029a24c8685ffb2a03"}, "originalPosition": 16}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ0MDgxMzQ5", "url": "https://github.com/ldtteam/minecolonies/pull/5355#pullrequestreview-444081349", "createdAt": "2020-07-07T16:57:15Z", "commit": {"oid": "ad0af17b133e5f3e4dd3ea029a24c8685ffb2a03"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wN1QxNjo1NzoxNVrOGuHd8g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wN1QxNjo1NzoxNVrOGuHd8g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTAxMDAzNA==", "bodyText": "those semicolons in the middle of nwhere", "url": "https://github.com/ldtteam/minecolonies/pull/5355#discussion_r451010034", "createdAt": "2020-07-07T16:57:15Z", "author": {"login": "Raycoms"}, "path": "src/api/java/com/minecolonies/api/colony/interactionhandling/IInteractionResponseHandler.java", "diffHunk": "@@ -43,73 +43,83 @@\n \n     /**\n      * Check if this interaction is a primary interaction or secondary interaction.\n-     *\n      * @return true if primary.\n      */\n     boolean isPrimary();\n \n     /**\n      * Get the priority of this interaction response handler.\n-     *\n      * @return the chat priority.\n      */\n     IChatPriority getPriority();\n \n     /**\n      * Check if this response handler is still visible for the player.\n-     *\n      * @param world the world this citizen is in.\n      * @return true if so.\n      */\n     boolean isVisible(final World world);\n \n     /**\n      * Check if this response handler is still valid.\n-     *\n      * @param colony the colony the citizen is in.\n      * @return true if still valid, else false.\n      */\n     boolean isValid(final ICitizenData colony);\n \n     /**\n      * Server side action triggered on a possible response.\n-     *\n      * @param response the clicked string response of the player.\n-     * @param world    the world it was triggered in.\n-     * @param data     the citizen related to it.\n+     * @param player the world it was triggered in.\n+     * @param data the citizen related to it.\n      */\n-    void onServerResponseTriggered(final ITextComponent response, final World world, final ICitizenData data);\n+    void onServerResponseTriggered(final ITextComponent response, final PlayerEntity player, final ICitizenData data);\n \n     /**\n      * Client side action triggered on a possible response.\n-     *\n      * @param response the clicked string response of the player.\n-     * @param world    the client side world.\n-     * @param data     the citizen data assigned to it.\n-     * @param window   the window it was triggered in.\n+     * @param player the client side world.\n+     * @param data the citizen data assigned to it.\n+     * @param window the window it was triggered in.\n      * @return if wishing to continue interacting.\n      */\n     @OnlyIn(Dist.CLIENT)\n-    boolean onClientResponseTriggered(final ITextComponent response, final World world, final ICitizenDataView data, final Window window);\n+    boolean onClientResponseTriggered(final ITextComponent response, final PlayerEntity player, final ICitizenDataView data, final Window window);\n \n     /**\n      * Remove a certain parent.\n-     *\n      * @param inquiry the parent inquiry.\n      */\n     void removeParent(ITextComponent inquiry);\n \n     /**\n      * Gen all child interactions related to this.\n-     *\n      * @return all child interactions.\n      */\n     List<IInteractionResponseHandler> genChildInteractions();\n \n     /**\n      * Type id used to deserialize.\n-     *\n      * @return the string type.\n      */\n     String getType();\n+\n+    /**\n+     * Callback for showing the interaction, to set interaction specific stuff\n+     */\n+    default void onWindowOpened(final Window window, final ICitizenDataView dataView) {}\n+\n+    ;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ad0af17b133e5f3e4dd3ea029a24c8685ffb2a03"}, "originalPosition": 121}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ0MDgxNzk3", "url": "https://github.com/ldtteam/minecolonies/pull/5355#pullrequestreview-444081797", "createdAt": "2020-07-07T16:57:47Z", "commit": {"oid": "ad0af17b133e5f3e4dd3ea029a24c8685ffb2a03"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wN1QxNjo1Nzo0OFrOGuHfTA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wN1QxNjo1Nzo0OFrOGuHfTA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTAxMDM4MA==", "bodyText": "jdc", "url": "https://github.com/ldtteam/minecolonies/pull/5355#discussion_r451010380", "createdAt": "2020-07-07T16:57:48Z", "author": {"login": "Raycoms"}, "path": "src/api/java/com/minecolonies/api/compatibility/ICompatibilityManager.java", "diffHunk": "@@ -128,6 +129,8 @@\n      */\n     List<Disease> getDiseases();\n \n+    List<Tuple<Item, Integer>> getRecruitmentCostsWeights();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ad0af17b133e5f3e4dd3ea029a24c8685ffb2a03"}, "originalPosition": 12}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ0MDgyODQ1", "url": "https://github.com/ldtteam/minecolonies/pull/5355#pullrequestreview-444082845", "createdAt": "2020-07-07T16:59:06Z", "commit": {"oid": "ad0af17b133e5f3e4dd3ea029a24c8685ffb2a03"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wN1QxNjo1OTowN1rOGuHieA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wN1QxNjo1OTowN1rOGuHieA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTAxMTE5Mg==", "bodyText": "I'd make that methds.", "url": "https://github.com/ldtteam/minecolonies/pull/5355#discussion_r451011192", "createdAt": "2020-07-07T16:59:07Z", "author": {"login": "Raycoms"}, "path": "src/api/java/com/minecolonies/api/util/BlockPosUtil.java", "diffHunk": "@@ -636,4 +640,84 @@ public static Rotation getRotationFromRotations(final int rotations)\n                 return Rotation.NONE;\n         }\n     }\n+\n+    /**\n+     * Returns the first air position near the given start. Advances vertically first then horizontally\n+     *\n+     * @param start     start position\n+     * @param vRange    vertical search range\n+     * @param hRange    horizontal search range\n+     * @param predicate check predicate for the right block\n+     * @return position or null\n+     */\n+    public static BlockPos findAround(final IBlockReader world, final BlockPos start, final int vRange, final int hRange, final Predicate<BlockState> predicate)\n+    {\n+        if (vRange < 1 && hRange < 1)\n+        {\n+            return null;\n+        }\n+\n+        BlockPos temp;\n+        int y = 0;\n+        int y_offset = 1;\n+\n+        for (int i = 0; i < hRange + 2; i++)\n+        {\n+            for (int steps = 1; steps <= vRange; steps++)\n+            {\n+                // Start topleft of middle point\n+                temp = start.add(-steps, y, -steps);\n+\n+                // X ->\n+                for (int x = 0; x <= steps; x++)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ad0af17b133e5f3e4dd3ea029a24c8685ffb2a03"}, "originalPosition": 66}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "02fe8f37a80df99f09d5abc8cf839c7cc092b693", "author": {"user": {"login": "someaddons", "name": null}}, "url": "https://github.com/ldtteam/minecolonies/commit/02fe8f37a80df99f09d5abc8cf839c7cc092b693", "committedDate": "2020-07-07T18:42:47Z", "message": "cleanup and javadoc and formatting"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "80877767e0b39219150f707edf6c6445d4ba3c82", "author": {"user": {"login": "someaddons", "name": null}}, "url": "https://github.com/ldtteam/minecolonies/commit/80877767e0b39219150f707edf6c6445d4ba3c82", "committedDate": "2020-07-07T18:53:03Z", "message": "Merge remote-tracking branch 'origin/tavern2' into tavern2"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "13c810afa76e7557d6b2d67d863b150d986c12f6", "author": {"user": {"login": "someaddons", "name": null}}, "url": "https://github.com/ldtteam/minecolonies/commit/13c810afa76e7557d6b2d67d863b150d986c12f6", "committedDate": "2020-07-08T12:00:32Z", "message": "Fix some bugs, add additional stories"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "529a50854f7af012d220c38adc0163862ce71033", "author": {"user": {"login": "someaddons", "name": null}}, "url": "https://github.com/ldtteam/minecolonies/commit/529a50854f7af012d220c38adc0163862ce71033", "committedDate": "2020-07-08T14:25:40Z", "message": "fix texture bug"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4b0f2658d8e565107a4c5bc3e6b981e9ccc8386d", "author": {"user": {"login": "someaddons", "name": null}}, "url": "https://github.com/ldtteam/minecolonies/commit/4b0f2658d8e565107a4c5bc3e6b981e9ccc8386d", "committedDate": "2020-07-08T16:57:07Z", "message": "fix spawn time"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "df88c41555e9bf9df247351ffaf76e60ff80a54c", "author": {"user": {"login": "someaddons", "name": null}}, "url": "https://github.com/ldtteam/minecolonies/commit/df88c41555e9bf9df247351ffaf76e60ff80a54c", "committedDate": "2020-07-08T17:01:07Z", "message": "increase haybale price"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "75c192ba2a69b1a85d0ef5403fda82baafd60894", "author": {"user": {"login": "someaddons", "name": null}}, "url": "https://github.com/ldtteam/minecolonies/commit/75c192ba2a69b1a85d0ef5403fda82baafd60894", "committedDate": "2020-07-08T17:06:03Z", "message": "reduce wander delay"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "04142a038c1808b9f3390c22ef397250f941f384", "author": {"user": {"login": "someaddons", "name": null}}, "url": "https://github.com/ldtteam/minecolonies/commit/04142a038c1808b9f3390c22ef397250f941f384", "committedDate": "2020-07-08T18:06:43Z", "message": "fix respawns"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f2de26c2270f32d14d1156e5b3fe556816184c11", "author": {"user": {"login": "someaddons", "name": null}}, "url": "https://github.com/ldtteam/minecolonies/commit/f2de26c2270f32d14d1156e5b3fe556816184c11", "committedDate": "2020-07-08T21:59:28Z", "message": "fix siding issue"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ2NTU4NjEw", "url": "https://github.com/ldtteam/minecolonies/pull/5355#pullrequestreview-446558610", "createdAt": "2020-07-10T17:02:43Z", "commit": {"oid": "f2de26c2270f32d14d1156e5b3fe556816184c11"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMFQxNzowMjo0M1rOGv-xzw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMFQxNzowMjo0M1rOGv-xzw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mjk2NDgxNQ==", "bodyText": "constants", "url": "https://github.com/ldtteam/minecolonies/pull/5355#discussion_r452964815", "createdAt": "2020-07-10T17:02:43Z", "author": {"login": "Raycoms"}, "path": "src/main/java/com/minecolonies/coremod/colony/buildings/workerbuildings/BuildingTavern.java", "diffHunk": "@@ -104,26 +154,273 @@ public void onColonyTick(@NotNull final IColony colony)\n         {\n             musicCooldown -= MAX_TICKRATE;\n         }\n+\n+        final Iterator<Integer> it = externalCitizens.iterator();\n+        while (it.hasNext())\n+        {\n+            final Integer id = it.next();\n+            if (colony.getVisitorManager().getVisitor(id) == null)\n+            {\n+                it.remove();\n+            }\n+        }\n+\n+        if (noVisitorTime > 0)\n+        {\n+            noVisitorTime -= 500;\n+        }\n+\n+        if (getBuildingLevel() > 0 && externalCitizens.size() < 3 * getBuildingLevel() && noVisitorTime <= 0)\n+        {\n+            spawnVisitor();\n+            noVisitorTime = colony.getWorld().getRandom().nextInt(3000) + 6000;\n+        }\n     }\n \n-    /*\n     @Override\n-    public void onColonyTick(@NotNull final IColony colony)\n+    public void onUpgradeComplete(final int newlevel)\n     {\n-       TODO: Next PR, Hiring\n-       for(final IColonyEvent event:colony.getEventManager().getEvents().values())\n+        super.onUpgradeComplete(newlevel);\n+        initTags = false;\n+    }\n+\n+    /**\n+     * Spawns a recruitable visitor citizen.\n+     */\n+    private void spawnVisitor()\n+    {\n+        IVisitorData newCitizen = (IVisitorData) colony.getVisitorManager().createAndRegisterNewCitizenData();\n+        externalCitizens.add(newCitizen.getId());\n+\n+        newCitizen.setBedPos(getPosition());\n+        newCitizen.setHomeBuilding(this);\n+\n+        int recruitLevel = colony.getWorld().rand.nextInt(10 * getBuildingLevel()) + 15;\n+        List<com.minecolonies.api.util.Tuple<Item, Integer>> recruitCosts = IColonyManager.getInstance().getCompatibilityManager().getRecruitmentCostsWeights();\n+\n+        if (newCitizen.getName().contains(\"Ray\"))\n         {\n-            if (event instanceof ColonyRecruitableCitizenEvent)\n+            newCitizen.setRecruitCosts(new ItemStack(Items.BAKED_POTATO, 64));\n+        }\n+\n+        newCitizen.getCitizenSkillHandler().init(recruitLevel);\n+\n+        BlockPos spawnPos = BlockPosUtil.findAround(colony.getWorld(), getPosition(), 1, 1, bs -> bs.getMaterial() == Material.AIR);\n+        if (spawnPos == null)\n+        {\n+            spawnPos = getPosition();\n+        }\n+\n+        colony.getVisitorManager().spawnOrCreateCitizen(newCitizen, colony.getWorld(), spawnPos, true);\n+\n+        final AbstractEntityCitizen citizenEntity = newCitizen.getCitizenEntity().get();\n+\n+        Tuple<Item, Integer> cost = recruitCosts.get(colony.getWorld().rand.nextInt(recruitCosts.size()));\n+        if (recruitLevel > 20)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f2de26c2270f32d14d1156e5b3fe556816184c11"}, "originalPosition": 187}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ2ODE0ODM0", "url": "https://github.com/ldtteam/minecolonies/pull/5355#pullrequestreview-446814834", "createdAt": "2020-07-11T16:51:22Z", "commit": {"oid": "f2de26c2270f32d14d1156e5b3fe556816184c11"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMVQxNjo1MToyMlrOGwN7bQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMVQxNjo1MToyMlrOGwN7bQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzIxMzAzNw==", "bodyText": "This is a bit weird in my opinion.\nIf AbstractEntityCitizen is now used for none citizens it should be renamed, together with these kinds of methods.\nPlease refactor.", "url": "https://github.com/ldtteam/minecolonies/pull/5355#discussion_r453213037", "createdAt": "2020-07-11T16:51:22Z", "author": {"login": "OrionDevelopment"}, "path": "src/api/java/com/minecolonies/api/colony/managers/interfaces/IEntityManager.java", "diffHunk": "@@ -0,0 +1,115 @@\n+package com.minecolonies.api.colony.managers.interfaces;\n+\n+import com.minecolonies.api.colony.ICitizenData;\n+import com.minecolonies.api.colony.IColony;\n+import com.minecolonies.api.entity.citizen.AbstractEntityCitizen;\n+import net.minecraft.entity.player.ServerPlayerEntity;\n+import net.minecraft.nbt.CompoundNBT;\n+import net.minecraft.util.math.BlockPos;\n+import net.minecraft.world.World;\n+import org.jetbrains.annotations.NotNull;\n+\n+import java.util.Map;\n+import java.util.Set;\n+\n+/**\n+ * Manager interface for managing entities for a colony\n+ */\n+public interface IEntityManager\n+{\n+    /**\n+     * Register a citizen entity with the colony\n+     *\n+     * @param citizen citizen to register\n+     */\n+    void registerCitizen(AbstractEntityCitizen citizen);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f2de26c2270f32d14d1156e5b3fe556816184c11"}, "originalPosition": 25}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3ca99ed89ae5a5d42d6cb74121cefeef8b0dd7fd", "author": {"user": {"login": "someaddons", "name": null}}, "url": "https://github.com/ldtteam/minecolonies/commit/3ca99ed89ae5a5d42d6cb74121cefeef8b0dd7fd", "committedDate": "2020-07-16T11:16:00Z", "message": "Add constants, refactor citizen stuff, introducing civilians"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e690938f8c3ac15d5f73febac9752611248077b2", "author": {"user": {"login": "someaddons", "name": null}}, "url": "https://github.com/ldtteam/minecolonies/commit/e690938f8c3ac15d5f73febac9752611248077b2", "committedDate": "2020-07-16T11:17:11Z", "message": "Merge remote-tracking branch 'remotes/origin/version/1.15' into tavern2\n\n# Conflicts:\n#\tsrc/main/resources/assets/minecolonies/lang/en_us.json"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ5ODU1NzQw", "url": "https://github.com/ldtteam/minecolonies/pull/5355#pullrequestreview-449855740", "createdAt": "2020-07-16T13:38:22Z", "commit": {"oid": "e690938f8c3ac15d5f73febac9752611248077b2"}, "state": "DISMISSED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNlQxMzozODoyMlrOGyrV-w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNlQxMzo0MDo0N1rOGyrcpQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTc5MjEyMw==", "bodyText": "JDoc", "url": "https://github.com/ldtteam/minecolonies/pull/5355#discussion_r455792123", "createdAt": "2020-07-16T13:38:22Z", "author": {"login": "OrionDevelopment"}, "path": "src/api/java/com/minecolonies/api/colony/ICivilianData.java", "diffHunk": "@@ -0,0 +1,188 @@\n+package com.minecolonies.api.colony;\n+\n+import com.minecolonies.api.colony.interactionhandling.IInteractionResponseHandler;\n+import com.minecolonies.api.colony.requestsystem.requestable.IRequestable;\n+import com.minecolonies.api.colony.requestsystem.token.IToken;\n+import com.minecolonies.api.entity.citizen.AbstractCivilianEntity;\n+import com.minecolonies.api.entity.citizen.AbstractEntityCitizen;\n+import net.minecraft.entity.player.PlayerEntity;\n+import net.minecraft.nbt.CompoundNBT;\n+import net.minecraft.network.PacketBuffer;\n+import net.minecraft.util.text.ITextComponent;\n+import net.minecraftforge.common.util.INBTSerializable;\n+import org.jetbrains.annotations.NotNull;\n+import org.jetbrains.annotations.Nullable;\n+\n+import java.util.Optional;\n+\n+public interface ICivilianData extends ICitizen, INBTSerializable<CompoundNBT>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e690938f8c3ac15d5f73febac9752611248077b2"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTc5Mjk3MQ==", "bodyText": "You probably also want to take in the type T instead of ICivilianData as the first parameter?", "url": "https://github.com/ldtteam/minecolonies/pull/5355#discussion_r455792971", "createdAt": "2020-07-16T13:39:38Z", "author": {"login": "OrionDevelopment"}, "path": "src/api/java/com/minecolonies/api/colony/managers/interfaces/IEntityManager.java", "diffHunk": "@@ -56,50 +56,50 @@ void sendPackets(\n       @NotNull Set<ServerPlayerEntity> newSubscribers);\n \n     /**\n-     * Returns a map of citizens in the colony. The map has ID as key, and citizen data as value.\n+     * Returns a map of civilian in the colony. The map has ID as key, and civilian data as value.\n      *\n-     * @return Map of citizens in the colony, with as key the citizen ID, and as value the citizen data.\n+     * @return Map of civilian in the colony, with as key the civilian ID, and as value the civilian data.\n      */\n     @NotNull\n-    Map<Integer, ICitizenData> getCitizenMap();\n+    Map<Integer, ICivilianData> getCivilianDataMap();\n \n     /**\n-     * Get citizen by ID.\n+     * Get civilian by ID.\n      *\n-     * @param citizenId ID of the Citizen.\n-     * @return ICitizenData associated with the ID, or null if it was not found.\n+     * @param civilianId ID of the civilian.\n+     * @return ICivilianData associated with the ID, or null if it was not found.\n      */\n-    ICitizenData getCitizen(int citizenId);\n+    <T extends ICivilianData> T getCivilian(int civilianId);\n \n     /**\n-     * Spawns a citizen with the specific citizen data.\n+     * Spawns a civilian with the specific civilian data.\n      *\n      * @param data     Data to use when spawn, null when new generation.\n      * @param world    THe world.\n-     * @param force    True to skip max citizen test, false when not.\n      * @param spawnPos the pos to spawn it at.\n-     * @return the new citizen.\n+     * @param force    True to skip max civilian test, false when not.\n+     * @return the new civilian.\n      */\n-    ICitizenData spawnOrCreateCitizen(ICitizenData data, World world, BlockPos spawnPos, boolean force);\n+    <T extends ICivilianData> T spawnOrCreateCivilian(ICivilianData data, World world, BlockPos spawnPos, boolean force);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e690938f8c3ac15d5f73febac9752611248077b2"}, "originalPosition": 97}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTc5MzgyOQ==", "bodyText": "This is a bit weird.\nCould you check if something with generics works here?", "url": "https://github.com/ldtteam/minecolonies/pull/5355#discussion_r455793829", "createdAt": "2020-07-16T13:40:47Z", "author": {"login": "OrionDevelopment"}, "path": "src/api/java/com/minecolonies/api/inventory/container/ContainerCitizenInventory.java", "diffHunk": "@@ -78,11 +78,11 @@ public ContainerCitizenInventory(final int windowId, final PlayerInventory inv,\n             final ICitizenData data;\n             if (citizenId > 0)\n             {\n-                data = colony.getCitizenManager().getCitizen(citizenId);\n+                data = (ICitizenData) colony.getCitizenManager().getCivilian(citizenId);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e690938f8c3ac15d5f73febac9752611248077b2"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8bbfeb4d5db356555e8d7112a572be1feb3da8f3", "author": {"user": {"login": "someaddons", "name": null}}, "url": "https://github.com/ldtteam/minecolonies/commit/8bbfeb4d5db356555e8d7112a572be1feb3da8f3", "committedDate": "2020-07-16T15:33:51Z", "message": "Small fixes"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUwOTMwNDg5", "url": "https://github.com/ldtteam/minecolonies/pull/5355#pullrequestreview-450930489", "createdAt": "2020-07-17T20:12:29Z", "commit": {"oid": "8bbfeb4d5db356555e8d7112a572be1feb3da8f3"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ea0d83f701fa30c6425bae3c8ce9d58869968a69", "author": {"user": {"login": "someaddons", "name": null}}, "url": "https://github.com/ldtteam/minecolonies/commit/ea0d83f701fa30c6425bae3c8ce9d58869968a69", "committedDate": "2020-07-17T21:52:47Z", "message": "Merge branch 'version/1.15' into tavern2"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2100, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}