{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDkyOTczNTMz", "number": 5827, "title": "Allocate builder to decorations", "bodyText": "Changes proposed in this pull request:\n\nDecorations now transition to a build screen after placement\nThe resources of the decoration can be seen, and the builder can be allocated\nA confirming message is sent to the players when a decoration is placed\nDecoration names have simplified names in some places (removed the long \"schematics/decorations/\" prefix)\n\n\nTo be ported\n\nReview please", "createdAt": "2020-09-25T10:12:35Z", "url": "https://github.com/ldtteam/minecolonies/pull/5827", "merged": true, "mergeCommit": {"oid": "026b96b5593e6431bac109f403c5f572f0e9666a"}, "closed": true, "closedAt": "2020-09-29T10:04:30Z", "author": {"login": "ShadowProtocol"}, "timelineItems": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdMPK0PgH2gAyNDkyOTczNTMzOjMwNTk1N2MwYzM4NzZmOTVlMzVhMjM3YWFmZGIzNTEzNTQ2Njk0NmY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdNlNuoAFqTQ5ODMwNjg4MQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "305957c0c3876f95e35a237aafdb35135466946f", "author": {"user": {"login": "ShadowProtocol", "name": null}}, "url": "https://github.com/ldtteam/minecolonies/commit/305957c0c3876f95e35a237aafdb35135466946f", "committedDate": "2020-09-25T05:44:43Z", "message": "Add new Build screen for decorations"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a516aca8c1c55e35282b978e1fcc7c0f9591a4a5", "author": {"user": {"login": "ShadowProtocol", "name": null}}, "url": "https://github.com/ldtteam/minecolonies/commit/a516aca8c1c55e35282b978e1fcc7c0f9591a4a5", "committedDate": "2020-09-25T07:05:33Z", "message": "Fix Null exception and add deco build message"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "50f5d58d55a12a46895147410a918801af32a61c", "author": {"user": {"login": "ShadowProtocol", "name": null}}, "url": "https://github.com/ldtteam/minecolonies/commit/50f5d58d55a12a46895147410a918801af32a61c", "committedDate": "2020-09-25T09:40:53Z", "message": "Simplify decoration names to make them easier to read\n\nAnd in Town Hall, where the string was wasn't meaningful before cutting off."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "44a8a226e9da029385aee92c0333ece9ebc4e7a8", "author": {"user": {"login": "ShadowProtocol", "name": null}}, "url": "https://github.com/ldtteam/minecolonies/commit/44a8a226e9da029385aee92c0333ece9ebc4e7a8", "committedDate": "2020-09-26T04:47:40Z", "message": "Cut \"schematics\" off of infrastructure paths as well"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk2OTcyNjEy", "url": "https://github.com/ldtteam/minecolonies/pull/5827#pullrequestreview-496972612", "createdAt": "2020-09-26T08:58:20Z", "commit": {"oid": "44a8a226e9da029385aee92c0333ece9ebc4e7a8"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNlQwODo1ODoyMFrOHYe8cA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNlQwODo1ODoyMFrOHYe8cA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTQzNDg2NA==", "bodyText": "can we get the parenthesis here?", "url": "https://github.com/ldtteam/minecolonies/pull/5827#discussion_r495434864", "createdAt": "2020-09-26T08:58:20Z", "author": {"login": "Raycoms"}, "path": "src/main/java/com/minecolonies/coremod/network/messages/server/BuildToolPlaceMessage.java", "diffHunk": "@@ -301,7 +309,10 @@ private static void handleDecoration(\n                 }\n             }\n \n-            colony.getWorkManager().addWorkOrder(new WorkOrderBuildDecoration(schem, woName, rotation, buildPos, mirror), false);\n+            WorkOrderBuildDecoration woDeco = new WorkOrderBuildDecoration(schem, woName, rotation, buildPos, mirror);\n+            if (!builder.equals(BlockPos.ZERO)) woDeco.setClaimedBy(builder);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "44a8a226e9da029385aee92c0333ece9ebc4e7a8"}, "originalPosition": 60}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk2OTcyNjM1", "url": "https://github.com/ldtteam/minecolonies/pull/5827#pullrequestreview-496972635", "createdAt": "2020-09-26T08:58:35Z", "commit": {"oid": "44a8a226e9da029385aee92c0333ece9ebc4e7a8"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNlQwODo1ODozNlrOHYe8fg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNlQwODo1ODozNlrOHYe8fg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTQzNDg3OA==", "bodyText": "potentially this properly formatted too", "url": "https://github.com/ldtteam/minecolonies/pull/5827#discussion_r495434878", "createdAt": "2020-09-26T08:58:36Z", "author": {"login": "Raycoms"}, "path": "src/main/java/com/minecolonies/coremod/network/messages/server/BuildToolPlaceMessage.java", "diffHunk": "@@ -104,6 +105,8 @@ public BuildToolPlaceMessage(\n         this.state = state;\n     }\n \n+    public BlockPos getPos() { return pos; }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "44a8a226e9da029385aee92c0333ece9ebc4e7a8"}, "originalPosition": 12}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "408c9b7cf91a0d0d15ac5a34790fa2aaea701b10", "author": {"user": {"login": "ShadowProtocol", "name": null}}, "url": "https://github.com/ldtteam/minecolonies/commit/408c9b7cf91a0d0d15ac5a34790fa2aaea701b10", "committedDate": "2020-09-26T09:39:33Z", "message": "Fix formatting"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f7280f25815553db0a4d406199674a62435b3d37", "author": {"user": {"login": "Raycoms", "name": null}}, "url": "https://github.com/ldtteam/minecolonies/commit/f7280f25815553db0a4d406199674a62435b3d37", "committedDate": "2020-09-27T14:16:07Z", "message": "Merge branch 'version/1.15' into feature/decorations"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk3MDkxNTY2", "url": "https://github.com/ldtteam/minecolonies/pull/5827#pullrequestreview-497091566", "createdAt": "2020-09-27T16:02:10Z", "commit": {"oid": "f7280f25815553db0a4d406199674a62435b3d37"}, "state": "DISMISSED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yN1QxNjowMjoxMFrOHYoQKg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yN1QxNjowMjoxMFrOHYoQKg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTU4NzM3MA==", "bodyText": "could you sort the builders by distance here? and also on the Buid Building GUI?", "url": "https://github.com/ldtteam/minecolonies/pull/5827#discussion_r495587370", "createdAt": "2020-09-27T16:02:10Z", "author": {"login": "someaddons"}, "path": "src/main/java/com/minecolonies/coremod/client/gui/WindowBuildDecoration.java", "diffHunk": "@@ -0,0 +1,310 @@\n+package com.minecolonies.coremod.client.gui;\n+\n+import com.ldtteam.blockout.Color;\n+import com.ldtteam.blockout.Pane;\n+import com.ldtteam.blockout.controls.Button;\n+import com.ldtteam.blockout.controls.ItemIcon;\n+import com.ldtteam.blockout.controls.Label;\n+import com.ldtteam.blockout.views.DropDownList;\n+import com.ldtteam.blockout.views.ScrollingList;\n+import com.ldtteam.structurize.management.StructureName;\n+import com.ldtteam.structurize.management.Structures;\n+import com.ldtteam.structurize.network.messages.SchematicRequestMessage;\n+import com.ldtteam.structurize.placement.BlockPlacementResult;\n+import com.ldtteam.structurize.placement.StructurePhasePlacementResult;\n+import com.ldtteam.structurize.placement.StructurePlacer;\n+import com.ldtteam.structurize.util.LanguageHandler;\n+import com.ldtteam.structurize.util.PlacementSettings;\n+import com.minecolonies.api.colony.IColonyManager;\n+import com.minecolonies.api.colony.IColonyView;\n+import com.minecolonies.api.crafting.ItemStorage;\n+import com.minecolonies.api.util.ItemStackUtils;\n+import com.minecolonies.api.util.LoadOnlyStructureHandler;\n+import com.minecolonies.api.util.Log;\n+import com.minecolonies.api.util.constant.Constants;\n+import com.minecolonies.api.util.constant.TranslationConstants;\n+import com.minecolonies.coremod.Network;\n+import com.minecolonies.coremod.colony.buildings.views.AbstractBuildingBuilderView;\n+import com.minecolonies.coremod.colony.buildings.workerbuildings.BuildingMiner;\n+import com.minecolonies.coremod.network.messages.server.BuildToolPlaceMessage;\n+import net.minecraft.client.Minecraft;\n+import net.minecraft.item.ItemStack;\n+import net.minecraft.util.Tuple;\n+import net.minecraft.util.math.BlockPos;\n+import net.minecraft.world.World;\n+import net.minecraftforge.fml.server.ServerLifecycleHooks;\n+import org.jetbrains.annotations.NotNull;\n+import org.jetbrains.annotations.Nullable;\n+\n+import java.util.ArrayList;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.stream.Collectors;\n+\n+import static com.ldtteam.structurize.placement.BlueprintIterator.NULL_POS;\n+import static com.minecolonies.api.util.constant.WindowConstants.*;\n+\n+public class WindowBuildDecoration extends AbstractWindowSkeleton\n+{\n+    /**\n+     * Link to the xml file of the window.\n+     */\n+    private static final String BUILDING_NAME_RESOURCE_SUFFIX = \":gui/windowbuildbuilding.xml\";\n+\n+    /**\n+     * White color.\n+     */\n+    private static final int WHITE = Color.getByName(\"white\", 0);\n+\n+    /**\n+     * List of style for the section.\n+     */\n+    @NotNull\n+    private final List<Tuple<String, BlockPos>> builders = new ArrayList<>();\n+\n+    /**\n+     * Drop down list for builders.\n+     */\n+    private DropDownList buildersDropDownList;\n+\n+    /**\n+     * Contains all resources needed for a certain build.\n+     */\n+    private final Map<String, ItemStorage> resources = new HashMap<>();\n+\n+    /**\n+     * Stores the message to be transmitted upon completion\n+     */\n+    private final BuildToolPlaceMessage placementMessage;\n+\n+    /**\n+     * The name of the structure\n+     */\n+    private final StructureName structureName;\n+\n+    /**\n+     * The position of the decoration anchor\n+     */\n+    private final BlockPos structurePos;\n+\n+    /**\n+     * Constructs the decoration build confirmation dialog\n+     */\n+    public WindowBuildDecoration(BuildToolPlaceMessage msg, BlockPos pos, StructureName structure)\n+    {\n+        super(Constants.MOD_ID + BUILDING_NAME_RESOURCE_SUFFIX);\n+        placementMessage = msg;\n+        structureName = structure;\n+        structurePos = pos;\n+\n+        registerButton(BUTTON_BUILD, this::confirmedBuild);\n+        registerButton(BUTTON_CANCEL, this::close);\n+\n+        findPaneOfTypeByID(BUTTON_BUILD, Button.class)\n+                .setLabel(LanguageHandler.format(\"com.minecolonies.coremod.gui.workerhuts.build\"));\n+        findPaneOfTypeByID(BUTTON_MOVE_BUILDING, Button.class).hide();\n+        findPaneOfTypeByID(BUTTON_REPAIR, Button.class).hide();\n+        findPaneOfTypeByID(BUTTON_NEXT_STYLE_ID, Button.class).hide();\n+        findPaneOfTypeByID(BUTTON_PREVIOUS_STYLE_ID, Button.class).hide();\n+        findPaneOfTypeByID(DROPDOWN_STYLE_ID, DropDownList.class).disable();\n+    }\n+\n+    @Override\n+    public void onOpened()\n+    {\n+        updateBuilders();\n+        updateResources();\n+    }\n+\n+    /**\n+     * Update the builders list but try to keep the same one.\n+     */\n+    private void updateBuilders()\n+    {\n+        IColonyView colony = (IColonyView) IColonyManager.getInstance()\n+                .getIColony(Minecraft.getInstance().world, structurePos);\n+\n+        if (colony == null)\n+        {\n+            LanguageHandler.sendPlayerMessage(Minecraft.getInstance().player, TranslationConstants.OUT_OF_COLONY);\n+            close();\n+            return;\n+        }\n+\n+        builders.clear();\n+        builders.add(new Tuple<>(LanguageHandler.format(\"com.minecolonies.coremod.job.Builder\") + \":\", BlockPos.ZERO));\n+        builders.addAll(colony.getBuildings().stream()\n+                .filter(build -> build instanceof AbstractBuildingBuilderView && !((AbstractBuildingBuilderView) build).getWorkerName().isEmpty()\n+                        && !(build instanceof BuildingMiner.View))\n+                .map(build -> new Tuple<>(((AbstractBuildingBuilderView) build).getWorkerName(), build.getPosition()))\n+                .collect(Collectors.toList()));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f7280f25815553db0a4d406199674a62435b3d37"}, "originalPosition": 141}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "72502096d246802fa9fdbe4e2aa9a0bf11868a36", "author": {"user": {"login": "ShadowProtocol", "name": null}}, "url": "https://github.com/ldtteam/minecolonies/commit/72502096d246802fa9fdbe4e2aa9a0bf11868a36", "committedDate": "2020-09-29T02:03:45Z", "message": "Sort builders by distance"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "efb20da3cdb499d2db4f3e1c1b9bde2646ee6c58", "author": {"user": {"login": "ShadowProtocol", "name": null}}, "url": "https://github.com/ldtteam/minecolonies/commit/efb20da3cdb499d2db4f3e1c1b9bde2646ee6c58", "committedDate": "2020-09-29T02:05:35Z", "message": "Remove never used variable"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk4MzA2ODgx", "url": "https://github.com/ldtteam/minecolonies/pull/5827#pullrequestreview-498306881", "createdAt": "2020-09-29T09:59:44Z", "commit": {"oid": "efb20da3cdb499d2db4f3e1c1b9bde2646ee6c58"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1947, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}