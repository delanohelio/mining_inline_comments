{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDk4NDIzMTUz", "number": 5885, "title": "Adding split networking.", "bodyText": "This adds splits networking.\nOur packets are getting to big, even with string reductions on the RS side of things packets that we are sending around are getting extremely big for large colonies.\nThis PR adds a wrapping system which automatically splits all packets that are bigger then 90% of the max value.\nOn the receiving side the packets are processed, stitched back together and then processed as normal.", "createdAt": "2020-10-06T10:09:13Z", "url": "https://github.com/ldtteam/minecolonies/pull/5885", "merged": true, "mergeCommit": {"oid": "1a016594c841ec7d7efa051b452411126f2e4c67"}, "closed": true, "closedAt": "2020-10-06T12:42:24Z", "author": {"login": "OrionDevelopment"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdP1g5aAH2gAyNDk4NDIzMTUzOmM3NDQ3YzFlNjJhMjMxNjQ2YTQ5OTEwMDMxNzc5ZDBjM2I3MjVhMGE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdP3q2ggFqTUwMjg5MjY3Nw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "c7447c1e62a231646a49910031779d0c3b725a0a", "author": {"user": {"login": "OrionDevelopment", "name": "Marc Hermans"}}, "url": "https://github.com/ldtteam/minecolonies/commit/c7447c1e62a231646a49910031779d0c3b725a0a", "committedDate": "2020-10-06T10:07:00Z", "message": "Adding split networking."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAyNzkxNDA1", "url": "https://github.com/ldtteam/minecolonies/pull/5885#pullrequestreview-502791405", "createdAt": "2020-10-06T10:20:05Z", "commit": {"oid": "c7447c1e62a231646a49910031779d0c3b725a0a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNlQxMDoyMDowNVrOHc_ofA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNlQxMDoyMDowNVrOHc_ofA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDE2NDczMg==", "bodyText": "move to start of method", "url": "https://github.com/ldtteam/minecolonies/pull/5885#discussion_r500164732", "createdAt": "2020-10-06T10:20:05Z", "author": {"login": "Nightenom"}, "path": "src/main/java/com/minecolonies/coremod/network/NetworkChannel.java", "diffHunk": "@@ -353,6 +389,53 @@ public void sendToTrackingEntityAndSelf(final IMessage msg, final Entity entity)\n      */\n     public void sendToTrackingChunk(final IMessage msg, final Chunk chunk)\n     {\n-        rawChannel.send(PacketDistributor.TRACKING_CHUNK.with(() -> chunk), msg);\n+        handleSplitting(msg, s -> rawChannel.send(PacketDistributor.TRACKING_CHUNK.with(() -> chunk), s));\n+    }\n+\n+    private void handleSplitting(final IMessage msg, final Consumer<IMessage> splitMessageConsumer) {\n+        final ByteBuf buffer = Unpooled.buffer();\n+        final PacketBuffer innerPacketBuffer = new PacketBuffer(buffer);\n+        msg.toBytes(innerPacketBuffer);\n+        final byte[] data = new byte[buffer.capacity()];\n+        buffer.getBytes(0, data);\n+        buffer.release();\n+\n+        int max_packet_size = 943718; //This is 90% of max packet size.\n+        int currentIndex = 0;\n+        int packetIndex = 0;\n+        int comId = messageCounter.getAndIncrement();\n+        while(currentIndex < data.length) {\n+            final byte[] subPacketData = Arrays.copyOfRange(data, currentIndex, currentIndex+max_packet_size);\n+            final int messageId = this.messageTypeToIdMap.getOrDefault(msg.getClass(), -1);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c7447c1e62a231646a49910031779d0c3b725a0a"}, "originalPosition": 199}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dfd8394e05e2493c8169fdf2b5c3540b8a952844", "author": {"user": {"login": "OrionDevelopment", "name": "Marc Hermans"}}, "url": "https://github.com/ldtteam/minecolonies/commit/dfd8394e05e2493c8169fdf2b5c3540b8a952844", "committedDate": "2020-10-06T11:07:46Z", "message": "Add commenting and formatting."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAyODMxNTU1", "url": "https://github.com/ldtteam/minecolonies/pull/5885#pullrequestreview-502831555", "createdAt": "2020-10-06T11:16:33Z", "commit": {"oid": "dfd8394e05e2493c8169fdf2b5c3540b8a952844"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "31b263b2b1a4b5a4d2691ceac469a7f6c7f113c7", "author": {"user": {"login": "OrionDevelopment", "name": "Marc Hermans"}}, "url": "https://github.com/ldtteam/minecolonies/commit/31b263b2b1a4b5a4d2691ceac469a7f6c7f113c7", "committedDate": "2020-10-06T12:23:12Z", "message": "Fix some bugs due to me not actually calling and invoking the right methods for handling byte arrays and buffers."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAyODkyNjc3", "url": "https://github.com/ldtteam/minecolonies/pull/5885#pullrequestreview-502892677", "createdAt": "2020-10-06T12:37:41Z", "commit": {"oid": "31b263b2b1a4b5a4d2691ceac469a7f6c7f113c7"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1757, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}