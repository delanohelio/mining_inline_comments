{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTQ1ODU5MDc4", "number": 6305, "title": "Improves Ship Raid Events, respells Babarian.", "bodyText": "Changes proposed in this pull request:\n\nEventStructureManager was saving to paths including the full ResourceName of a dimension (eg schematicsstructbackup1 [minecraft : overworld]BlockPos{x=42, y=59, z=-208}.blueprint), which is not a valid file name on FAT32 and most Windows NTFS situations, as colons are a restricted character outside of POSIX emulation mode.  Changed structure to instead use ResourceName.namespace + ResourceName.path (eg schematicsstructbackup1minecraftoverworldBlockPos{x=42, y=59, z=-208}.blueprint).  Changed the load path management side to match.\nAdded compat layer for those with existing old ship schematics floating around.\n\nNew location is properly a path (eg schematics\\structbackup\\1\\minecraftoverworld\\BlockPos{x=42, y=59, z=-208}.blueprint)\nThis will also significant increase the number of raids for island or beach-side colonies for affected systems, as previously ship raids were being cancelled rather than rolling down to ground raids instead.\n\n\nFixes babarian -> barbarian, checks for any locations using the old names.\n\n\nFixes norsemen ships checking for biomes when spawned by command.  They will still check for water/ice regardless; if there's not a valid ship spawning location they'll do their ground variant instead.  NorsemenShipEvent natural spawns will still check for tundra biomes or the rare out-of-biome chance.\n\n\nReview please", "createdAt": "2020-12-27T21:22:43Z", "url": "https://github.com/ldtteam/minecolonies/pull/6305", "merged": true, "mergeCommit": {"oid": "e87bc022c1e3adbb8b6c130838c3ada4b10c9aab"}, "closed": true, "closedAt": "2021-01-01T19:10:57Z", "author": {"login": "gattsuru"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdqYSylAH2gAyNTQ1ODU5MDc4OmMyYjBlOGRlNDRiNjVmMDRjZWE3ZjUyYmYwYjI1NGZiMTYzNDM0ZGU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdr7bGtgFqTU2MDU5NTA5Mg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "c2b0e8de44b65f04cea7f52bf0b254fb163434de", "author": {"user": {"login": "gattsuru", "name": null}}, "url": "https://github.com/ldtteam/minecolonies/commit/c2b0e8de44b65f04cea7f52bf0b254fb163434de", "committedDate": "2020-12-27T21:20:18Z", "message": "Fixes to Ship Raid Spawns, Barbarian Spelling\n\nEventStructureManager was saving to paths including the full ResourceName of a dimension (ie schematicsstructbackup1 [minecraft : overworld]BlockPos{x=42, y=59, z=-208}.blueprint), which is not a valid file name on FAT32 and most Windows NTFS situations, as colons are a restricted character outside of POSIX emulation mode.  Changed structure to instead use ResourceName.namespace + ResourceName.path (ie schematicsstructbackup1minecraftoverworldBlockPos{x=42, y=59, z=-208}.blueprint.\n\nThis will cause some ships to not properly despawn on the few machines that were seeing them before.  Probably not the biggest problem.\n\nFixes babarian->barbarian.\n\nFixes norsemen ships checking for biomes when spawned by command.  They will  still check for water/ice regardless; if there's not a valid ship spawning location they'll do their ground variant instead.  Norsemen ship natural spawns will still check for biomes."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e41c3adbc067e02d2c818564ed7d6fa567ecdb10", "author": {"user": {"login": "gattsuru", "name": null}}, "url": "https://github.com/ldtteam/minecolonies/commit/e41c3adbc067e02d2c818564ed7d6fa567ecdb10", "committedDate": "2020-12-28T00:26:48Z", "message": "Further Fixes to Commands and Temporary Ship Structures\n\nExcludes norsemen_ship_raid and pirate_ground_raid from the events list, since neither group's ship variant can be guaranteed.  Added ground pirates to the ColonyEventTypeRegistry as a separate group instead of bumming off normal pirates.\n\nChanges files again, to use path as subdirectories instead of single long names.  Adds a compat layer to load old file formats from those OS that supported them."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cd957c6c66321994fa8b0b5815e5b9c28d769aaa", "author": {"user": {"login": "gattsuru", "name": null}}, "url": "https://github.com/ldtteam/minecolonies/commit/cd957c6c66321994fa8b0b5815e5b9c28d769aaa", "committedDate": "2020-12-28T16:05:16Z", "message": "Merge branch 'version/1.16.3' into version/1.16.3-command-and-gui"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d07f0f452602a204388c669c4177a84cd3393d00", "author": {"user": {"login": "gattsuru", "name": null}}, "url": "https://github.com/ldtteam/minecolonies/commit/d07f0f452602a204388c669c4177a84cd3393d00", "committedDate": "2020-12-29T03:51:54Z", "message": "Merge branch 'version/1.16.3' into version/1.16.3-command-and-gui"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU5NDM0OTYw", "url": "https://github.com/ldtteam/minecolonies/pull/6305#pullrequestreview-559434960", "createdAt": "2020-12-29T08:53:39Z", "commit": {"oid": "d07f0f452602a204388c669c4177a84cd3393d00"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yOVQwODo1MzozOVrOIMKSxA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yOVQwODo1MzozOVrOIMKSxA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTYyMjQ2OA==", "bodyText": "should be the other way around, first new backup path, if not exist try old", "url": "https://github.com/ldtteam/minecolonies/pull/6305#discussion_r549622468", "createdAt": "2020-12-29T08:53:39Z", "author": {"login": "Raycoms"}, "path": "src/main/java/com/minecolonies/coremod/colony/managers/EventStructureManager.java", "diffHunk": "@@ -156,8 +157,16 @@ public void loadBackupForEvent(final int eventID)\n \n             if (entry.getValue() == eventID)\n             {\n-                final String backupPath = String.valueOf(colony.getID()) + colony.getDimension() + entry.getKey();\n-                final String fileName = new StructureName(\"cache\", \"backup\", Structures.SCHEMATICS_PREFIX + STRUCTURE_BACKUP_FOLDER).toString() + backupPath;\n+                //TODO: remove compat for colony.getDimension()-based file names after sufficient time has passed from PR#6305\n+                final String oldBackupPath = String.valueOf(colony.getID()) + colony.getDimension() + entry.getKey();\n+                String fileName = new StructureName(\"cache\", \"backup\", Structures.SCHEMATICS_PREFIX + STRUCTURE_BACKUP_FOLDER).toString() + oldBackupPath;\n+\n+                File blueprintFile = new File(fileName);\n+                if(!blueprintFile.exists())", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d07f0f452602a204388c669c4177a84cd3393d00"}, "originalPosition": 37}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c90358733cc1474df2818256830eaba38b53e731", "author": {"user": {"login": "gattsuru", "name": null}}, "url": "https://github.com/ldtteam/minecolonies/commit/c90358733cc1474df2818256830eaba38b53e731", "committedDate": "2020-12-29T15:45:44Z", "message": "Changes compat layer for old name format of temporary structure files, prioritizing the current version first.  Also uses Structurize's builtins instead of File checks for better compatibility."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d21f8037168f4b0084788fb55b927e9de6c783bc", "author": {"user": {"login": "gattsuru", "name": null}}, "url": "https://github.com/ldtteam/minecolonies/commit/d21f8037168f4b0084788fb55b927e9de6c783bc", "committedDate": "2020-12-30T13:51:23Z", "message": "Merge branch 'version/1.16.3' into version/1.16.3-command-and-gui"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTYwNTg4OTY2", "url": "https://github.com/ldtteam/minecolonies/pull/6305#pullrequestreview-560588966", "createdAt": "2021-01-01T14:09:05Z", "commit": {"oid": "d21f8037168f4b0084788fb55b927e9de6c783bc"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTYwNTk1MDky", "url": "https://github.com/ldtteam/minecolonies/pull/6305#pullrequestreview-560595092", "createdAt": "2021-01-01T16:49:59Z", "commit": {"oid": "d21f8037168f4b0084788fb55b927e9de6c783bc"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1741, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}