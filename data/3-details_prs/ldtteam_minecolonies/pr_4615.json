{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDAyMjM2NTg2", "number": 4615, "title": "Colony creation gui", "bodyText": "Closes #4607\nCloses #\nCloses #\nChanges proposed in this pull request:\nThis PR changes how colony creation works, the colony is now created via a GUI you open by accessing a townhall, instead of upon townhall placement. The gui is looking like this:\n\n\nand shows information about nearby colonies, the colony you own and why you can't build a colony here. It replaces our previously complicated chain of blockplacement/prevention/commandusage with chatlinks.\nFixes:\n\nAdd colonyview to important players upon login\nAdd colonyview upon rank add\nBuilding blocks now always give feedback why the gui won't open\nPermissionhandler is no longer registered more than once per colony\nColonyviews now know their owner and no longer just return null\nChunkCapRange message now also send nearby colonies like ChunkCapSingle messages do\n\nReview please", "createdAt": "2020-04-11T19:32:40Z", "url": "https://github.com/ldtteam/minecolonies/pull/4615", "merged": true, "mergeCommit": {"oid": "ea8486dfa827acd31e1d865dac970a3fca9affd6"}, "closed": true, "closedAt": "2020-04-13T11:15:01Z", "author": {"login": "someaddons"}, "timelineItems": {"totalCount": 19, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcWqQ5UgH2gAyNDAyMjM2NTg2OjU2NzUxMGYwMTJiNDRlZTE3MGI4YmZkMWM0NDZkOGJjYzA4OWVlYzE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcXM-aFAH2gAyNDAyMjM2NTg2OjdjMzQxM2MyZjVjNzNmZGFmMzczMDMwYjJmZjQ0M2NjOGQwOWE0YWU=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "567510f012b44ee170b8bfd1c446d8bcc089eec1", "author": {"user": {"login": "someaddons", "name": null}}, "url": "https://github.com/ldtteam/minecolonies/commit/567510f012b44ee170b8bfd1c446d8bcc089eec1", "committedDate": "2020-04-11T18:46:53Z", "message": "Colony creation via townhall gui"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "96e1b71c4b5d3444207f1f4e8007a0ee782afb71", "author": {"user": {"login": "someaddons", "name": null}}, "url": "https://github.com/ldtteam/minecolonies/commit/96e1b71c4b5d3444207f1f4e8007a0ee782afb71", "committedDate": "2020-04-11T18:57:14Z", "message": "Merge remote-tracking branch 'remotes/origin/version/1.15' into TownhallBlock"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "41d7d9af93e054a2d4d8d1b0650c7c7c3618ad9b", "author": {"user": {"login": "someaddons", "name": null}}, "url": "https://github.com/ldtteam/minecolonies/commit/41d7d9af93e054a2d4d8d1b0650c7c7c3618ad9b", "committedDate": "2020-04-11T19:33:06Z", "message": "javadoc"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "47de74104c93dae322bafea26b96b91414005bfb", "author": {"user": {"login": "Raycoms", "name": null}}, "url": "https://github.com/ldtteam/minecolonies/commit/47de74104c93dae322bafea26b96b91414005bfb", "committedDate": "2020-04-11T22:54:55Z", "message": "Merge branch 'version/1.15' into ColonyCreationGUI"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkxODA3MzQ5", "url": "https://github.com/ldtteam/minecolonies/pull/4615#pullrequestreview-391807349", "createdAt": "2020-04-11T23:15:53Z", "commit": {"oid": "47de74104c93dae322bafea26b96b91414005bfb"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xMVQyMzoxNTo1M1rOGEQvBg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xMVQyMzoxNTo1M1rOGEQvBg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzEyMTY3MA==", "bodyText": "Why not register them as button handlers?", "url": "https://github.com/ldtteam/minecolonies/pull/4615#discussion_r407121670", "createdAt": "2020-04-11T23:15:53Z", "author": {"login": "Raycoms"}, "path": "src/main/java/com/minecolonies/coremod/client/gui/WindowTownHallColonyManage.java", "diffHunk": "@@ -0,0 +1,192 @@\n+package com.minecolonies.coremod.client.gui;\n+\n+import com.ldtteam.blockout.controls.Button;\n+import com.ldtteam.blockout.controls.ButtonImage;\n+import com.ldtteam.blockout.controls.Text;\n+import com.ldtteam.structurize.util.LanguageHandler;\n+import com.minecolonies.api.colony.IColony;\n+import com.minecolonies.api.colony.IColonyManager;\n+import com.minecolonies.api.colony.IColonyTagCapability;\n+import com.minecolonies.api.util.BlockPosUtil;\n+import com.minecolonies.coremod.MineColonies;\n+import com.minecolonies.coremod.Network;\n+import com.minecolonies.coremod.network.messages.CreateColonyMessage;\n+import com.minecolonies.coremod.network.messages.VanillaParticleMessage;\n+import net.minecraft.client.Minecraft;\n+import net.minecraft.entity.player.PlayerEntity;\n+import net.minecraft.particles.ParticleTypes;\n+import net.minecraft.util.SoundCategory;\n+import net.minecraft.util.SoundEvents;\n+import net.minecraft.util.math.BlockPos;\n+import net.minecraft.world.World;\n+import net.minecraft.world.chunk.Chunk;\n+import org.jetbrains.annotations.NotNull;\n+\n+import static com.minecolonies.api.util.constant.Constants.MOD_ID;\n+import static com.minecolonies.api.util.constant.TranslationConstants.CANT_PLACE_COLONY_TOO_CLOSE_TO_SPAWN;\n+import static com.minecolonies.api.util.constant.TranslationConstants.CANT_PLACE_COLONY_TOO_FAR_FROM_SPAWN;\n+import static com.minecolonies.api.util.constant.WindowConstants.TOWNHALL_COLONY_MANAGEMENT_GUI;\n+import static com.minecolonies.coremod.MineColonies.CLOSE_COLONY_CAP;\n+\n+/**\n+ * TownhallGUI for managing colony creation/deletion\n+ */\n+public class WindowTownHallColonyManage extends AbstractWindowSkeleton\n+{\n+    private static final String BUTTON_CLOSE  = \"cancel\";\n+    private static final String BUTTON_DELETE = \"delete\";\n+    private static final String BUTTON_CREATE = \"create\";\n+    private static final String TEXT_NEARBY   = \"nearbycolony\";\n+    private static final String TEXT_OWN      = \"owncolony\";\n+    private static final String TEXT_FEEDBACK = \"creationpossible\";\n+\n+    /**\n+     * Townhall position\n+     */\n+    private final BlockPos pos;\n+\n+    public WindowTownHallColonyManage(final PlayerEntity player, final BlockPos pos, final World world)\n+    {\n+        super(MOD_ID + TOWNHALL_COLONY_MANAGEMENT_GUI);\n+\n+        this.pos = pos;\n+\n+        final IColony existingColony = IColonyManager.getInstance().getIColony(world, pos);\n+\n+        if (existingColony != null)\n+        {\n+            // Colony here\n+            findPaneOfTypeByID(TEXT_NEARBY, Text.class).setTextContent(LanguageHandler.format(\"com.minecolonies.coremod.gui.colony.here\",\n+              existingColony.getName(),\n+              existingColony.getPermissions().getOwnerName()));\n+        }\n+        else\n+        {\n+            // Close colony\n+            int closeClonyID = findNextNearbyColony(world, pos, MineColonies.getConfig().getCommon().minTownHallPadding.get());\n+\n+            if (closeClonyID != 0)\n+            {\n+                findPaneOfTypeByID(TEXT_NEARBY, Text.class).setTextContent(LanguageHandler.format(\"com.minecolonies.coremod.gui.colony.near\", closeClonyID));\n+            }\n+            else\n+            {\n+                // No close colony\n+                findPaneOfTypeByID(TEXT_NEARBY, Text.class).setTextContent(LanguageHandler.format(\"com.minecolonies.coremod.gui.colony.nonenearby\"));\n+            }\n+        }\n+\n+        final IColony ownerColony = IColonyManager.getInstance().getIColonyByOwner(world, player);\n+        if (ownerColony != null)\n+        {\n+            findPaneOfTypeByID(BUTTON_DELETE, ButtonImage.class).enable();\n+            findPaneOfTypeByID(TEXT_OWN, Text.class).setTextContent(LanguageHandler.format(\"com.minecolonies.coremod.gui.colony.own\", ownerColony.getCenter()));\n+\n+            if (MineColonies.getConfig().getCommon().allowInfiniteColonies.get())\n+            {\n+                findPaneOfTypeByID(TEXT_FEEDBACK, Text.class).setTextContent(LanguageHandler.format(\"com.minecolonies.coremod.gui.colony.denied.existingandabandon\"));\n+            }\n+            else\n+            {\n+                findPaneOfTypeByID(TEXT_FEEDBACK, Text.class).setTextContent(LanguageHandler.format(\"com.minecolonies.coremod.gui.colony.denied.existing\"));\n+            }\n+        }\n+        else\n+        {\n+            findPaneOfTypeByID(TEXT_OWN, Text.class).setTextContent(LanguageHandler.format(\"com.minecolonies.coremod.gui.colony.none\"));\n+\n+            if (existingColony != null || IColonyManager.getInstance().isTooCloseToColony(world, pos))\n+            {\n+                findPaneOfTypeByID(TEXT_FEEDBACK, Text.class).setTextContent(LanguageHandler.format(\"com.minecolonies.coremod.gui.colony.denied.tooclose\"));\n+            }\n+        }\n+\n+        if (MineColonies.getConfig().getCommon().restrictColonyPlacement.get())\n+        {\n+            final double spawnDistance = Math.sqrt(BlockPosUtil.getDistanceSquared2D(pos, world.getSpawnPoint()));\n+            if (spawnDistance < MineColonies.getConfig().getCommon().minDistanceFromWorldSpawn.get())\n+            {\n+                findPaneOfTypeByID(TEXT_FEEDBACK, Text.class).setTextContent(LanguageHandler.format(CANT_PLACE_COLONY_TOO_CLOSE_TO_SPAWN,\n+                  MineColonies.getConfig().getCommon().minDistanceFromWorldSpawn.get()));\n+            }\n+            else if (spawnDistance > MineColonies.getConfig().getCommon().maxDistanceFromWorldSpawn.get())\n+            {\n+                findPaneOfTypeByID(TEXT_FEEDBACK, Text.class).setTextContent(LanguageHandler.format(CANT_PLACE_COLONY_TOO_FAR_FROM_SPAWN,\n+                  MineColonies.getConfig().getCommon().maxDistanceFromWorldSpawn.get()));\n+            }\n+        }\n+\n+        if (findPaneOfTypeByID(TEXT_FEEDBACK, Text.class).getTextContent().isEmpty())\n+        {\n+            findPaneOfTypeByID(BUTTON_CREATE, ButtonImage.class).enable();\n+            findPaneOfTypeByID(TEXT_FEEDBACK, Text.class).setTextContent(LanguageHandler.format(\"com.minecolonies.coremod.gui.colony.allowed.create\"));\n+        }\n+    }\n+\n+    @Override\n+    public void onButtonClicked(@NotNull final Button button)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "47de74104c93dae322bafea26b96b91414005bfb"}, "originalPosition": 127}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkxODA3Mzkw", "url": "https://github.com/ldtteam/minecolonies/pull/4615#pullrequestreview-391807390", "createdAt": "2020-04-11T23:16:50Z", "commit": {"oid": "47de74104c93dae322bafea26b96b91414005bfb"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xMVQyMzoxNjo1MFrOGEQvNQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xMVQyMzoxNjo1MFrOGEQvNQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzEyMTcxNw==", "bodyText": "On the client side?", "url": "https://github.com/ldtteam/minecolonies/pull/4615#discussion_r407121717", "createdAt": "2020-04-11T23:16:50Z", "author": {"login": "Raycoms"}, "path": "src/main/java/com/minecolonies/coremod/client/gui/WindowTownHallColonyManage.java", "diffHunk": "@@ -0,0 +1,192 @@\n+package com.minecolonies.coremod.client.gui;\n+\n+import com.ldtteam.blockout.controls.Button;\n+import com.ldtteam.blockout.controls.ButtonImage;\n+import com.ldtteam.blockout.controls.Text;\n+import com.ldtteam.structurize.util.LanguageHandler;\n+import com.minecolonies.api.colony.IColony;\n+import com.minecolonies.api.colony.IColonyManager;\n+import com.minecolonies.api.colony.IColonyTagCapability;\n+import com.minecolonies.api.util.BlockPosUtil;\n+import com.minecolonies.coremod.MineColonies;\n+import com.minecolonies.coremod.Network;\n+import com.minecolonies.coremod.network.messages.CreateColonyMessage;\n+import com.minecolonies.coremod.network.messages.VanillaParticleMessage;\n+import net.minecraft.client.Minecraft;\n+import net.minecraft.entity.player.PlayerEntity;\n+import net.minecraft.particles.ParticleTypes;\n+import net.minecraft.util.SoundCategory;\n+import net.minecraft.util.SoundEvents;\n+import net.minecraft.util.math.BlockPos;\n+import net.minecraft.world.World;\n+import net.minecraft.world.chunk.Chunk;\n+import org.jetbrains.annotations.NotNull;\n+\n+import static com.minecolonies.api.util.constant.Constants.MOD_ID;\n+import static com.minecolonies.api.util.constant.TranslationConstants.CANT_PLACE_COLONY_TOO_CLOSE_TO_SPAWN;\n+import static com.minecolonies.api.util.constant.TranslationConstants.CANT_PLACE_COLONY_TOO_FAR_FROM_SPAWN;\n+import static com.minecolonies.api.util.constant.WindowConstants.TOWNHALL_COLONY_MANAGEMENT_GUI;\n+import static com.minecolonies.coremod.MineColonies.CLOSE_COLONY_CAP;\n+\n+/**\n+ * TownhallGUI for managing colony creation/deletion\n+ */\n+public class WindowTownHallColonyManage extends AbstractWindowSkeleton\n+{\n+    private static final String BUTTON_CLOSE  = \"cancel\";\n+    private static final String BUTTON_DELETE = \"delete\";\n+    private static final String BUTTON_CREATE = \"create\";\n+    private static final String TEXT_NEARBY   = \"nearbycolony\";\n+    private static final String TEXT_OWN      = \"owncolony\";\n+    private static final String TEXT_FEEDBACK = \"creationpossible\";\n+\n+    /**\n+     * Townhall position\n+     */\n+    private final BlockPos pos;\n+\n+    public WindowTownHallColonyManage(final PlayerEntity player, final BlockPos pos, final World world)\n+    {\n+        super(MOD_ID + TOWNHALL_COLONY_MANAGEMENT_GUI);\n+\n+        this.pos = pos;\n+\n+        final IColony existingColony = IColonyManager.getInstance().getIColony(world, pos);\n+\n+        if (existingColony != null)\n+        {\n+            // Colony here\n+            findPaneOfTypeByID(TEXT_NEARBY, Text.class).setTextContent(LanguageHandler.format(\"com.minecolonies.coremod.gui.colony.here\",\n+              existingColony.getName(),\n+              existingColony.getPermissions().getOwnerName()));\n+        }\n+        else\n+        {\n+            // Close colony\n+            int closeClonyID = findNextNearbyColony(world, pos, MineColonies.getConfig().getCommon().minTownHallPadding.get());\n+\n+            if (closeClonyID != 0)\n+            {\n+                findPaneOfTypeByID(TEXT_NEARBY, Text.class).setTextContent(LanguageHandler.format(\"com.minecolonies.coremod.gui.colony.near\", closeClonyID));\n+            }\n+            else\n+            {\n+                // No close colony\n+                findPaneOfTypeByID(TEXT_NEARBY, Text.class).setTextContent(LanguageHandler.format(\"com.minecolonies.coremod.gui.colony.nonenearby\"));\n+            }\n+        }\n+\n+        final IColony ownerColony = IColonyManager.getInstance().getIColonyByOwner(world, player);\n+        if (ownerColony != null)\n+        {\n+            findPaneOfTypeByID(BUTTON_DELETE, ButtonImage.class).enable();\n+            findPaneOfTypeByID(TEXT_OWN, Text.class).setTextContent(LanguageHandler.format(\"com.minecolonies.coremod.gui.colony.own\", ownerColony.getCenter()));\n+\n+            if (MineColonies.getConfig().getCommon().allowInfiniteColonies.get())\n+            {\n+                findPaneOfTypeByID(TEXT_FEEDBACK, Text.class).setTextContent(LanguageHandler.format(\"com.minecolonies.coremod.gui.colony.denied.existingandabandon\"));\n+            }\n+            else\n+            {\n+                findPaneOfTypeByID(TEXT_FEEDBACK, Text.class).setTextContent(LanguageHandler.format(\"com.minecolonies.coremod.gui.colony.denied.existing\"));\n+            }\n+        }\n+        else\n+        {\n+            findPaneOfTypeByID(TEXT_OWN, Text.class).setTextContent(LanguageHandler.format(\"com.minecolonies.coremod.gui.colony.none\"));\n+\n+            if (existingColony != null || IColonyManager.getInstance().isTooCloseToColony(world, pos))\n+            {\n+                findPaneOfTypeByID(TEXT_FEEDBACK, Text.class).setTextContent(LanguageHandler.format(\"com.minecolonies.coremod.gui.colony.denied.tooclose\"));\n+            }\n+        }\n+\n+        if (MineColonies.getConfig().getCommon().restrictColonyPlacement.get())\n+        {\n+            final double spawnDistance = Math.sqrt(BlockPosUtil.getDistanceSquared2D(pos, world.getSpawnPoint()));\n+            if (spawnDistance < MineColonies.getConfig().getCommon().minDistanceFromWorldSpawn.get())\n+            {\n+                findPaneOfTypeByID(TEXT_FEEDBACK, Text.class).setTextContent(LanguageHandler.format(CANT_PLACE_COLONY_TOO_CLOSE_TO_SPAWN,\n+                  MineColonies.getConfig().getCommon().minDistanceFromWorldSpawn.get()));\n+            }\n+            else if (spawnDistance > MineColonies.getConfig().getCommon().maxDistanceFromWorldSpawn.get())\n+            {\n+                findPaneOfTypeByID(TEXT_FEEDBACK, Text.class).setTextContent(LanguageHandler.format(CANT_PLACE_COLONY_TOO_FAR_FROM_SPAWN,\n+                  MineColonies.getConfig().getCommon().maxDistanceFromWorldSpawn.get()));\n+            }\n+        }\n+\n+        if (findPaneOfTypeByID(TEXT_FEEDBACK, Text.class).getTextContent().isEmpty())\n+        {\n+            findPaneOfTypeByID(BUTTON_CREATE, ButtonImage.class).enable();\n+            findPaneOfTypeByID(TEXT_FEEDBACK, Text.class).setTextContent(LanguageHandler.format(\"com.minecolonies.coremod.gui.colony.allowed.create\"));\n+        }\n+    }\n+\n+    @Override\n+    public void onButtonClicked(@NotNull final Button button)\n+    {\n+        switch (button.getID())\n+        {\n+            case BUTTON_CLOSE:\n+            {\n+                close();\n+                return;\n+            }\n+            case BUTTON_CREATE:\n+            {\n+                new VanillaParticleMessage(pos.getX(), pos.getY(), pos.getZ(), ParticleTypes.DRAGON_BREATH).onExecute(null, false);\n+                Minecraft.getInstance().world.playSound(Minecraft.getInstance().player, Minecraft.getInstance().player.getPosition(),\n+                  SoundEvents.BLOCK_CAMPFIRE_CRACKLE, SoundCategory.AMBIENT, 2.5f, 0.8f);\n+                Network.getNetwork().sendToServer(new CreateColonyMessage(pos));\n+                close();\n+\n+                return;\n+            }\n+            case BUTTON_DELETE:\n+            {\n+                new WindowTownHallColonyDelete().open();\n+            }\n+            default:\n+        }\n+    }\n+\n+    /**\n+     * Finds the first nearby colony claim in the range\n+     *\n+     * @param world world to use\n+     * @param start start position\n+     * @param range search range\n+     * @return\n+     */\n+    private static int findNextNearbyColony(final World world, final BlockPos start, final int range)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "47de74104c93dae322bafea26b96b91414005bfb"}, "originalPosition": 162}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkxODA3NDA0", "url": "https://github.com/ldtteam/minecolonies/pull/4615#pullrequestreview-391807404", "createdAt": "2020-04-11T23:17:11Z", "commit": {"oid": "47de74104c93dae322bafea26b96b91414005bfb"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xMVQyMzoxNzoxMVrOGEQvSg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xMVQyMzoxNzoxMVrOGEQvSg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzEyMTczOA==", "bodyText": "don't we need this?", "url": "https://github.com/ldtteam/minecolonies/pull/4615#discussion_r407121738", "createdAt": "2020-04-11T23:17:11Z", "author": {"login": "Raycoms"}, "path": "src/main/java/com/minecolonies/coremod/colony/Colony.java", "diffHunk": "@@ -295,7 +295,6 @@ protected Colony(final int id, @Nullable final World world)\n         this.id = id;\n         if (world != null)\n         {\n-            this.dimensionId = world.getDimension().getType().getId();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "47de74104c93dae322bafea26b96b91414005bfb"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkxODA3NjEw", "url": "https://github.com/ldtteam/minecolonies/pull/4615#pullrequestreview-391807610", "createdAt": "2020-04-11T23:22:04Z", "commit": {"oid": "47de74104c93dae322bafea26b96b91414005bfb"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xMVQyMzoyMjowNFrOGEQwxA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xMVQyMzoyMjowNFrOGEQwxA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzEyMjExNg==", "bodyText": "Why only for overworld?", "url": "https://github.com/ldtteam/minecolonies/pull/4615#discussion_r407122116", "createdAt": "2020-04-11T23:22:04Z", "author": {"login": "Raycoms"}, "path": "src/main/java/com/minecolonies/coremod/event/EventHandler.java", "diffHunk": "@@ -785,11 +675,14 @@ public static void onWorldLoad(@NotNull final WorldEvent.Load event)\n     @SubscribeEvent\n     public static void onWorldUnload(@NotNull final WorldEvent.Unload event)\n     {\n-        Log.getLogger().warn(\"World unload\");\n-\n         if (event.getWorld() instanceof World)\n         {\n             IColonyManager.getInstance().onWorldUnload((World) event.getWorld());\n         }\n+        if (event.getWorld().isRemote() && event.getWorld().getDimension().getType() == DimensionType.OVERWORLD)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "47de74104c93dae322bafea26b96b91414005bfb"}, "originalPosition": 314}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkxODA3NjQ3", "url": "https://github.com/ldtteam/minecolonies/pull/4615#pullrequestreview-391807647", "createdAt": "2020-04-11T23:23:00Z", "commit": {"oid": "47de74104c93dae322bafea26b96b91414005bfb"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xMVQyMzoyMzowMFrOGEQxBg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xMVQyMzoyMzowMFrOGEQxBg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzEyMjE4Mg==", "bodyText": "I added this for when switching worlds in singlePlayer, don't we need this?", "url": "https://github.com/ldtteam/minecolonies/pull/4615#discussion_r407122182", "createdAt": "2020-04-11T23:23:00Z", "author": {"login": "Raycoms"}, "path": "src/main/java/com/minecolonies/coremod/event/FMLEventHandler.java", "diffHunk": "@@ -52,10 +52,6 @@ public static void onPlayerLogin(@NotNull final PlayerEvent.PlayerLoggedInEvent\n             IColonyManager.getInstance().getIColonyByOwner(((ServerPlayerEntity) event.getPlayer()).getServerWorld(), event.getPlayer());\n             //ColonyManager.syncAllColoniesAchievements();\n         }\n-        else\n-        {\n-            IColonyManager.getInstance().resetColonyViews();\n-        }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "47de74104c93dae322bafea26b96b91414005bfb"}, "originalPosition": 7}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkxODI4NTg5", "url": "https://github.com/ldtteam/minecolonies/pull/4615#pullrequestreview-391828589", "createdAt": "2020-04-12T07:10:24Z", "commit": {"oid": "47de74104c93dae322bafea26b96b91414005bfb"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xMlQwNzoxMDoyNFrOGES7Kg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xMlQwNzoxMDoyNFrOGES7Kg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzE1NzU0Ng==", "bodyText": "This may break universe when previous version connects to this version. Always add new messages to the end of the list, or increase network proto version", "url": "https://github.com/ldtteam/minecolonies/pull/4615#discussion_r407157546", "createdAt": "2020-04-12T07:10:24Z", "author": {"login": "Nightenom"}, "path": "src/main/java/com/minecolonies/coremod/network/NetworkChannel.java", "diffHunk": "@@ -93,6 +93,9 @@ public void registerCommonMessages()\n         registerMessage(++idx, LumberjackReplantSaplingToggleMessage.class, LumberjackReplantSaplingToggleMessage::new);\n         registerMessage(++idx, LumberjackRestrictionToggleMessage.class, LumberjackRestrictionToggleMessage::new);\n         registerMessage(++idx, LumberjackScepterMessage.class, LumberjackScepterMessage::new);\n+        registerMessage(++idx, CreateColonyMessage.class, CreateColonyMessage::new);\n+        registerMessage(++idx, ColonyDeleteOwnMessage.class, ColonyDeleteOwnMessage::new);\n+        registerMessage(++idx, ColonyViewRemoveMessage.class, ColonyViewRemoveMessage::new);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "47de74104c93dae322bafea26b96b91414005bfb"}, "originalPosition": 6}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "12289312f79026a849270418c0bf25ce8af86f94", "author": {"user": {"login": "someaddons", "name": null}}, "url": "https://github.com/ldtteam/minecolonies/commit/12289312f79026a849270418c0bf25ce8af86f94", "committedDate": "2020-04-12T08:32:36Z", "message": "changes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a962018feeb6fff691a1d9c092f1f35879eb754a", "author": {"user": {"login": "someaddons", "name": null}}, "url": "https://github.com/ldtteam/minecolonies/commit/a962018feeb6fff691a1d9c092f1f35879eb754a", "committedDate": "2020-04-12T15:19:20Z", "message": "Merge remote-tracking branch 'origin/version/1.15' into TownhallBlock"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cb3cbed9fab2bc98656d0a8af1b95a7ff6b53c77", "author": {"user": {"login": "someaddons", "name": null}}, "url": "https://github.com/ldtteam/minecolonies/commit/cb3cbed9fab2bc98656d0a8af1b95a7ff6b53c77", "committedDate": "2020-04-12T19:43:34Z", "message": "changes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "04a3e612a1ad945bdcc21da49b419e2937db331f", "author": {"user": {"login": "someaddons", "name": null}}, "url": "https://github.com/ldtteam/minecolonies/commit/04a3e612a1ad945bdcc21da49b419e2937db331f", "committedDate": "2020-04-12T20:23:35Z", "message": "Merge branch 'TownhallBlock' into ColonyCreationGUI"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a3141299039b47937e66fb7f22f766ff8eb0ee4a", "author": {"user": {"login": "someaddons", "name": null}}, "url": "https://github.com/ldtteam/minecolonies/commit/a3141299039b47937e66fb7f22f766ff8eb0ee4a", "committedDate": "2020-04-12T20:36:47Z", "message": "shutdown pathing earlier"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e160069b572b35f0dc017f1bae0d7effa80d6d1b", "author": {"user": {"login": "someaddons", "name": null}}, "url": "https://github.com/ldtteam/minecolonies/commit/e160069b572b35f0dc017f1bae0d7effa80d6d1b", "committedDate": "2020-04-13T07:53:03Z", "message": "change to super"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkyMDI0Mzc0", "url": "https://github.com/ldtteam/minecolonies/pull/4615#pullrequestreview-392024374", "createdAt": "2020-04-13T08:32:43Z", "commit": {"oid": "a3141299039b47937e66fb7f22f766ff8eb0ee4a"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xM1QwODozMjo0M1rOGEgWzQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xM1QwODozNjoyOVrOGEgb3g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzM3NzYxMw==", "bodyText": "Question:\nWhy remove the final here and make it so that we set the colonies (close colonies, should probably rename this field)\nI think it'd be better to use an add (to list) method and keep it final. Then you could also add close colonies later on (say a new colony is placed down later) without getting, modifying, and setting, or elsewise", "url": "https://github.com/ldtteam/minecolonies/pull/4615#discussion_r407377613", "createdAt": "2020-04-13T08:32:43Z", "author": {"login": "Asherslab"}, "path": "src/api/java/com/minecolonies/api/colony/IColonyTagCapability.java", "diffHunk": "@@ -97,7 +104,7 @@\n         /**\n          * The set of all close colonies. Only relevant in non dynamic claiming.\n          */\n-        private final Set<Integer> colonies = new HashSet<>();\n+        private Set<Integer> colonies = new HashSet<>();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a3141299039b47937e66fb7f22f766ff8eb0ee4a"}, "originalPosition": 19}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzM3Nzc4OA==", "bodyText": "Why is this changed in this PR?", "url": "https://github.com/ldtteam/minecolonies/pull/4615#discussion_r407377788", "createdAt": "2020-04-13T08:33:14Z", "author": {"login": "Asherslab"}, "path": "src/api/java/com/minecolonies/api/util/constant/GuardConstants.java", "diffHunk": "@@ -110,7 +110,7 @@\n     /**\n      * Basic bonus hp for knights\n      */\n-    public static final int KNIGHT_HP_BONUS = 5;\n+    public static final int KNIGHT_HP_BONUS = 15;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a3141299039b47937e66fb7f22f766ff8eb0ee4a"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzM3ODkxMA==", "bodyText": "Leave Bonus health private and call super.getBonusHealth() here instead", "url": "https://github.com/ldtteam/minecolonies/pull/4615#discussion_r407378910", "createdAt": "2020-04-13T08:36:29Z", "author": {"login": "Asherslab"}, "path": "src/main/java/com/minecolonies/coremod/colony/buildings/workerbuildings/BuildingGuardTower.java", "diffHunk": "@@ -67,6 +67,12 @@ public int getClaimRadius(final int newLevel)\n         return Math.max(0, newLevel - 1);\n     }\n \n+    @Override\n+    protected int getBonusHealth()\n+    {\n+        return BONUS_HP_SINGLE_GUARD + getBuildingLevel() * BONUS_HEALTH_PER_LEVEL;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a3141299039b47937e66fb7f22f766ff8eb0ee4a"}, "originalPosition": 31}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1ba0ba70ede2719dc5a86016bdee01c3488115af", "author": {"user": {"login": "someaddons", "name": null}}, "url": "https://github.com/ldtteam/minecolonies/commit/1ba0ba70ede2719dc5a86016bdee01c3488115af", "committedDate": "2020-04-13T09:19:19Z", "message": "make patrol default"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7c3413c2f5c73fdaf373030b2ff443cc8d09a4ae", "author": {"user": {"login": "Raycoms", "name": null}}, "url": "https://github.com/ldtteam/minecolonies/commit/7c3413c2f5c73fdaf373030b2ff443cc8d09a4ae", "committedDate": "2020-04-13T11:13:22Z", "message": "Merge branch 'version/1.15' into ColonyCreationGUI"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2184, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}