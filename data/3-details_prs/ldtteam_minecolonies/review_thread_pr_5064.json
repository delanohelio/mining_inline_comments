{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDIyMjg0NTYx", "number": 5064, "reviewThreads": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yM1QxNDo1OTozMFrOD_I0nQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yM1QxOTozNjoyMlrOD_Jrzg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY3NTMxNDIxOnYy", "diffSide": "RIGHT", "path": "src/api/java/com/minecolonies/api/util/MCCreativeStructureHandler.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yM1QxNDo1OTozMFrOGZp2EQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yM1QxNDo1OTozMFrOGZp2EQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTU1MzE2OQ==", "bodyText": "bad javadoc^^", "url": "https://github.com/ldtteam/minecolonies/pull/5064#discussion_r429553169", "createdAt": "2020-05-23T14:59:30Z", "author": {"login": "someaddons"}, "path": "src/api/java/com/minecolonies/api/util/MCCreativeStructureHandler.java", "diffHunk": "@@ -0,0 +1,141 @@\n+package com.minecolonies.api.util;\n+\n+import com.ldtteam.structures.blueprints.v1.Blueprint;\n+import com.ldtteam.structurize.api.util.Log;\n+import com.ldtteam.structurize.management.Manager;\n+import com.ldtteam.structurize.placement.StructurePlacer;\n+import com.ldtteam.structurize.placement.structure.CreativeStructureHandler;\n+import com.ldtteam.structurize.placement.structure.IStructureHandler;\n+import com.ldtteam.structurize.util.PlacementSettings;\n+import com.ldtteam.structurize.util.TickedWorldOperation;\n+import com.minecolonies.api.blocks.ModBlocks;\n+import com.minecolonies.api.colony.IColony;\n+import com.minecolonies.api.colony.IColonyManager;\n+import com.minecolonies.api.colony.buildings.IBuilding;\n+import net.minecraft.block.Block;\n+import net.minecraft.block.BlockState;\n+import net.minecraft.block.Blocks;\n+import net.minecraft.entity.player.ServerPlayerEntity;\n+import net.minecraft.item.ItemStack;\n+import net.minecraft.tags.ItemTags;\n+import net.minecraft.util.Mirror;\n+import net.minecraft.util.Rotation;\n+import net.minecraft.util.math.BlockPos;\n+import net.minecraft.world.World;\n+import org.jetbrains.annotations.NotNull;\n+import org.jetbrains.annotations.Nullable;\n+\n+import java.util.List;\n+\n+/**\n+ * Interface for using the structure codebase.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bb0eec564be763070621b0f81b362050d736bb26"}, "originalPosition": 31}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY3NTMxNDM3OnYy", "diffSide": "RIGHT", "path": "src/api/java/com/minecolonies/api/util/LoadOnlyStructureHandler.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yM1QxNDo1OTo0N1rOGZp2KQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yM1QxNDo1OTo0N1rOGZp2KQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTU1MzE5Mw==", "bodyText": "bad javadoc^^", "url": "https://github.com/ldtteam/minecolonies/pull/5064#discussion_r429553193", "createdAt": "2020-05-23T14:59:47Z", "author": {"login": "someaddons"}, "path": "src/api/java/com/minecolonies/api/util/LoadOnlyStructureHandler.java", "diffHunk": "@@ -0,0 +1,89 @@\n+package com.minecolonies.api.util;\n+\n+import com.ldtteam.structures.blueprints.v1.Blueprint;\n+import com.ldtteam.structurize.placement.structure.CreativeStructureHandler;\n+import com.ldtteam.structurize.util.PlacementSettings;\n+import com.minecolonies.api.blocks.ModBlocks;\n+import com.minecolonies.api.colony.buildings.IBuilding;\n+import net.minecraft.block.Block;\n+import net.minecraft.block.BlockState;\n+import net.minecraft.block.Blocks;\n+import net.minecraft.item.ItemStack;\n+import net.minecraft.tags.ItemTags;\n+import net.minecraft.util.math.BlockPos;\n+import net.minecraft.world.World;\n+import org.jetbrains.annotations.Nullable;\n+\n+import java.util.List;\n+\n+/**\n+ * Interface for using the structure codebase.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bb0eec564be763070621b0f81b362050d736bb26"}, "originalPosition": 20}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY3NTMxNTEyOnYy", "diffSide": "RIGHT", "path": "src/api/java/com/minecolonies/api/util/LoadOnlyStructureHandler.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yM1QxNTowMDo1NVrOGZp2hw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yM1QxNTowMDo1NVrOGZp2hw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTU1MzI4Nw==", "bodyText": "this looks like an unused building field, do we need this?", "url": "https://github.com/ldtteam/minecolonies/pull/5064#discussion_r429553287", "createdAt": "2020-05-23T15:00:55Z", "author": {"login": "someaddons"}, "path": "src/api/java/com/minecolonies/api/util/LoadOnlyStructureHandler.java", "diffHunk": "@@ -0,0 +1,89 @@\n+package com.minecolonies.api.util;\n+\n+import com.ldtteam.structures.blueprints.v1.Blueprint;\n+import com.ldtteam.structurize.placement.structure.CreativeStructureHandler;\n+import com.ldtteam.structurize.util.PlacementSettings;\n+import com.minecolonies.api.blocks.ModBlocks;\n+import com.minecolonies.api.colony.buildings.IBuilding;\n+import net.minecraft.block.Block;\n+import net.minecraft.block.BlockState;\n+import net.minecraft.block.Blocks;\n+import net.minecraft.item.ItemStack;\n+import net.minecraft.tags.ItemTags;\n+import net.minecraft.util.math.BlockPos;\n+import net.minecraft.world.World;\n+import org.jetbrains.annotations.Nullable;\n+\n+import java.util.List;\n+\n+/**\n+ * Interface for using the structure codebase.\n+ */\n+public final class LoadOnlyStructureHandler extends CreativeStructureHandler\n+{\n+    /**\n+     * The building associated with this placement.\n+     */\n+    private IBuilding building;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bb0eec564be763070621b0f81b362050d736bb26"}, "originalPosition": 27}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY3NTMyMTM3OnYy", "diffSide": "RIGHT", "path": "src/api/java/com/minecolonies/api/util/MCCreativeStructureHandler.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yM1QxNToxMTo1MFrOGZp5sw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yM1QxNToxMTo1MFrOGZp5sw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTU1NDA5OQ==", "bodyText": "how about just \"CreativeBuildingStructureHandler\"", "url": "https://github.com/ldtteam/minecolonies/pull/5064#discussion_r429554099", "createdAt": "2020-05-23T15:11:50Z", "author": {"login": "someaddons"}, "path": "src/api/java/com/minecolonies/api/util/MCCreativeStructureHandler.java", "diffHunk": "@@ -0,0 +1,141 @@\n+package com.minecolonies.api.util;\n+\n+import com.ldtteam.structures.blueprints.v1.Blueprint;\n+import com.ldtteam.structurize.api.util.Log;\n+import com.ldtteam.structurize.management.Manager;\n+import com.ldtteam.structurize.placement.StructurePlacer;\n+import com.ldtteam.structurize.placement.structure.CreativeStructureHandler;\n+import com.ldtteam.structurize.placement.structure.IStructureHandler;\n+import com.ldtteam.structurize.util.PlacementSettings;\n+import com.ldtteam.structurize.util.TickedWorldOperation;\n+import com.minecolonies.api.blocks.ModBlocks;\n+import com.minecolonies.api.colony.IColony;\n+import com.minecolonies.api.colony.IColonyManager;\n+import com.minecolonies.api.colony.buildings.IBuilding;\n+import net.minecraft.block.Block;\n+import net.minecraft.block.BlockState;\n+import net.minecraft.block.Blocks;\n+import net.minecraft.entity.player.ServerPlayerEntity;\n+import net.minecraft.item.ItemStack;\n+import net.minecraft.tags.ItemTags;\n+import net.minecraft.util.Mirror;\n+import net.minecraft.util.Rotation;\n+import net.minecraft.util.math.BlockPos;\n+import net.minecraft.world.World;\n+import org.jetbrains.annotations.NotNull;\n+import org.jetbrains.annotations.Nullable;\n+\n+import java.util.List;\n+\n+/**\n+ * Interface for using the structure codebase.\n+ */\n+public final class MCCreativeStructureHandler extends CreativeStructureHandler", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bb0eec564be763070621b0f81b362050d736bb26"}, "originalPosition": 33}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY3NTQxMTMwOnYy", "diffSide": "RIGHT", "path": "src/api/java/com/minecolonies/api/util/constant/CitizenConstants.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yM1QxODowOTowNFrOGZqpxA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNFQwODo0NDo0MFrOGZtiMw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTU2NjQwNA==", "bodyText": "isnt this the same as our config setting?", "url": "https://github.com/ldtteam/minecolonies/pull/5064#discussion_r429566404", "createdAt": "2020-05-23T18:09:04Z", "author": {"login": "someaddons"}, "path": "src/api/java/com/minecolonies/api/util/constant/CitizenConstants.java", "diffHunk": "@@ -257,4 +257,45 @@\n      * Noon day time.\n      */\n     public static final int NOON = 6000;\n+\n+    /**\n+     * The minimum range to keep from the current building place.\n+     */\n+    public static final int MIN_ADDITIONAL_RANGE_TO_BUILD = 3;\n+\n+    /**\n+     * String which shows if something is a waypoint.\n+     */\n+    public static final String WAYPOINT_STRING = \"infrastructure\";\n+\n+    /**\n+     * Amount of xp the builder gains each building (Will increase by attribute modifiers additionally).\n+     */\n+    public static final double XP_EACH_BUILDING = 10.0D;\n+\n+    /**\n+     * Increase this value to make the building speed slower.\n+     * Used to balance worker level speed increase.\n+     */\n+    public static final int PROGRESS_MULTIPLIER = 10;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bb0eec564be763070621b0f81b362050d736bb26"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTYxMzYxOQ==", "bodyText": "Idk, I just moved this around, I didn't create this in this PR.", "url": "https://github.com/ldtteam/minecolonies/pull/5064#discussion_r429613619", "createdAt": "2020-05-24T08:44:40Z", "author": {"login": "Raycoms"}, "path": "src/api/java/com/minecolonies/api/util/constant/CitizenConstants.java", "diffHunk": "@@ -257,4 +257,45 @@\n      * Noon day time.\n      */\n     public static final int NOON = 6000;\n+\n+    /**\n+     * The minimum range to keep from the current building place.\n+     */\n+    public static final int MIN_ADDITIONAL_RANGE_TO_BUILD = 3;\n+\n+    /**\n+     * String which shows if something is a waypoint.\n+     */\n+    public static final String WAYPOINT_STRING = \"infrastructure\";\n+\n+    /**\n+     * Amount of xp the builder gains each building (Will increase by attribute modifiers additionally).\n+     */\n+    public static final double XP_EACH_BUILDING = 10.0D;\n+\n+    /**\n+     * Increase this value to make the building speed slower.\n+     * Used to balance worker level speed increase.\n+     */\n+    public static final int PROGRESS_MULTIPLIER = 10;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTU2NjQwNA=="}, "originalCommit": {"oid": "bb0eec564be763070621b0f81b362050d736bb26"}, "originalPosition": 24}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY3NTQxNDk2OnYy", "diffSide": "RIGHT", "path": "src/main/java/com/minecolonies/coremod/colony/colonyEvents/raidEvents/pirateEvent/PirateEventUtils.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yM1QxODoxNTo1OVrOGZqryw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNFQwODo0NDo0OVrOGZtiQQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTU2NjkyMw==", "bodyText": "tried out pirate ships? :)", "url": "https://github.com/ldtteam/minecolonies/pull/5064#discussion_r429566923", "createdAt": "2020-05-23T18:15:59Z", "author": {"login": "someaddons"}, "path": "src/main/java/com/minecolonies/coremod/colony/colonyEvents/raidEvents/pirateEvent/PirateEventUtils.java", "diffHunk": "@@ -165,10 +166,10 @@ public static boolean canSpawnPirateEventAt(final IColony colony, final BlockPos\n         final World world = colony.getWorld();\n         final String shipSize = ShipSize.getShipForRaidLevel(raidLevel).schematicName;\n \n-        final Structure structure = new Structure(colony.getWorld(), Structures.SCHEMATICS_PREFIX + PIRATESHIP_FOLDER + shipSize, new PlacementSettings());\n-        structure.rotate(BlockPosUtil.getRotationFromRotations(rotation), colony.getWorld(), spawnPoint, Mirror.NONE);\n+        final MCCreativeStructureHandler structure = new MCCreativeStructureHandler(colony.getWorld(), spawnPoint, Structures.SCHEMATICS_PREFIX + PIRATESHIP_FOLDER + shipSize, new PlacementSettings(), true);\n+        structure.getBluePrint().rotateWithMirror(BlockPosUtil.getRotationFromRotations(rotation), Mirror.NONE, colony.getWorld());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bb0eec564be763070621b0f81b362050d736bb26"}, "originalPosition": 38}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTYxMzYzMw==", "bodyText": "Yes, they're working fine.", "url": "https://github.com/ldtteam/minecolonies/pull/5064#discussion_r429613633", "createdAt": "2020-05-24T08:44:49Z", "author": {"login": "Raycoms"}, "path": "src/main/java/com/minecolonies/coremod/colony/colonyEvents/raidEvents/pirateEvent/PirateEventUtils.java", "diffHunk": "@@ -165,10 +166,10 @@ public static boolean canSpawnPirateEventAt(final IColony colony, final BlockPos\n         final World world = colony.getWorld();\n         final String shipSize = ShipSize.getShipForRaidLevel(raidLevel).schematicName;\n \n-        final Structure structure = new Structure(colony.getWorld(), Structures.SCHEMATICS_PREFIX + PIRATESHIP_FOLDER + shipSize, new PlacementSettings());\n-        structure.rotate(BlockPosUtil.getRotationFromRotations(rotation), colony.getWorld(), spawnPoint, Mirror.NONE);\n+        final MCCreativeStructureHandler structure = new MCCreativeStructureHandler(colony.getWorld(), spawnPoint, Structures.SCHEMATICS_PREFIX + PIRATESHIP_FOLDER + shipSize, new PlacementSettings(), true);\n+        structure.getBluePrint().rotateWithMirror(BlockPosUtil.getRotationFromRotations(rotation), Mirror.NONE, colony.getWorld());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTU2NjkyMw=="}, "originalCommit": {"oid": "bb0eec564be763070621b0f81b362050d736bb26"}, "originalPosition": 38}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY3NTQxNjkyOnYy", "diffSide": "RIGHT", "path": "src/main/java/com/minecolonies/coremod/colony/managers/EventStructureManager.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yM1QxODoxOTo1MVrOGZqs3w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNFQwODo0NTowM1rOGZtiUQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTU2NzE5OQ==", "bodyText": "not sure if the 3 down offset still fits with the changed saving above", "url": "https://github.com/ldtteam/minecolonies/pull/5064#discussion_r429567199", "createdAt": "2020-05-23T18:19:51Z", "author": {"login": "someaddons"}, "path": "src/main/java/com/minecolonies/coremod/colony/managers/EventStructureManager.java", "diffHunk": "@@ -100,12 +103,12 @@ public boolean spawnTemporaryStructure(\n \n         backupSchematics.put(targetSpawnPoint.down(3), eventID);\n \n-        InstantStructurePlacer.loadAndPlaceStructureWithRotation(world,\n+        MCCreativeStructureHandler.loadAndPlaceStructureWithRotation(world,\n           schematicPath,\n           targetSpawnPoint.down(3),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bb0eec564be763070621b0f81b362050d736bb26"}, "originalPosition": 49}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTYxMzY0OQ==", "bodyText": "It worked fine for me.", "url": "https://github.com/ldtteam/minecolonies/pull/5064#discussion_r429613649", "createdAt": "2020-05-24T08:45:03Z", "author": {"login": "Raycoms"}, "path": "src/main/java/com/minecolonies/coremod/colony/managers/EventStructureManager.java", "diffHunk": "@@ -100,12 +103,12 @@ public boolean spawnTemporaryStructure(\n \n         backupSchematics.put(targetSpawnPoint.down(3), eventID);\n \n-        InstantStructurePlacer.loadAndPlaceStructureWithRotation(world,\n+        MCCreativeStructureHandler.loadAndPlaceStructureWithRotation(world,\n           schematicPath,\n           targetSpawnPoint.down(3),", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTU2NzE5OQ=="}, "originalCommit": {"oid": "bb0eec564be763070621b0f81b362050d736bb26"}, "originalPosition": 49}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY3NTQ1NDgxOnYy", "diffSide": "RIGHT", "path": "src/main/java/com/minecolonies/coremod/entity/ai/util/BuildingStructureHandler.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yM1QxOTozNTowNlrOGZrBRA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yM1QxOTozNTowNlrOGZrBRA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTU3MjQyMA==", "bodyText": "forgotten log entry?", "url": "https://github.com/ldtteam/minecolonies/pull/5064#discussion_r429572420", "createdAt": "2020-05-23T19:35:06Z", "author": {"login": "someaddons"}, "path": "src/main/java/com/minecolonies/coremod/entity/ai/util/BuildingStructureHandler.java", "diffHunk": "@@ -0,0 +1,316 @@\n+package com.minecolonies.coremod.entity.ai.util;\n+\n+import com.ldtteam.structures.blueprints.v1.Blueprint;\n+import com.ldtteam.structurize.placement.structure.AbstractStructureHandler;\n+import com.ldtteam.structurize.util.BlockUtils;\n+import com.ldtteam.structurize.util.PlacementSettings;\n+import com.minecolonies.api.blocks.ModBlocks;\n+import com.minecolonies.api.colony.IColony;\n+import com.minecolonies.api.colony.IColonyManager;\n+import com.minecolonies.api.colony.buildings.IBuilding;\n+import com.minecolonies.api.util.ItemStackUtils;\n+import com.minecolonies.api.util.Log;\n+import com.minecolonies.api.util.constant.ToolType;\n+import com.minecolonies.coremod.MineColonies;\n+import com.minecolonies.coremod.colony.jobs.AbstractJobStructure;\n+import com.minecolonies.coremod.entity.ai.basic.AbstractEntityAIStructure;\n+import com.minecolonies.coremod.util.WorkerUtil;\n+import net.minecraft.block.*;\n+import net.minecraft.inventory.EquipmentSlotType;\n+import net.minecraft.item.ItemStack;\n+import net.minecraft.tags.ItemTags;\n+import net.minecraft.util.Hand;\n+import net.minecraft.util.math.BlockPos;\n+import net.minecraft.util.math.MathHelper;\n+import net.minecraft.world.World;\n+import net.minecraftforge.items.IItemHandler;\n+import org.jetbrains.annotations.NotNull;\n+import org.jetbrains.annotations.Nullable;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+\n+import static com.minecolonies.api.util.constant.CitizenConstants.RUN_AWAY_SPEED;\n+\n+/**\n+ * Represents a build task for the StructureIterator AI.\n+ * <p>\n+ * It internally uses a structure it transparently loads.\n+ */\n+public class BuildingStructureHandler extends AbstractStructureHandler\n+{\n+    /**\n+     * Amount of xp the builder gains for placing a block.\n+     */\n+    private static final double XP_EACH_BLOCK = 0.1D;\n+\n+    /**\n+     * The structure AI handling this task.\n+     */\n+    private final AbstractEntityAIStructure<? extends AbstractJobStructure> structureAI;\n+\n+    /**\n+     * The total number of stages.\n+     */\n+    private final Stage[] stages;\n+\n+    /**\n+     * The building associated with this placement.\n+     */\n+    private IBuilding building;\n+\n+    /**\n+     * The current structure stage.\n+     */\n+    private int stage;\n+\n+    /**\n+     * The minecolonies AI specific creative structure placer.\n+     * @param world the world.\n+     * @param worldPos the pos it is placed at.\n+     * @param structureName the name of the structure.\n+     * @param settings the placement settings.\n+     * @param entityAIStructure the AI handling this structure.\n+     */\n+    public BuildingStructureHandler(final World world, final BlockPos worldPos, final String structureName, final PlacementSettings settings, final AbstractEntityAIStructure<? extends AbstractJobStructure> entityAIStructure, final Stage[] stages)\n+    {\n+        super(world, worldPos, structureName, settings);\n+        setupBuilding();\n+        this.structureAI= entityAIStructure;\n+        this.stages = stages;\n+        this.stage = 0;\n+    }\n+\n+    /**\n+     * The minecolonies AI specific creative structure placer.\n+     * @param world the world.\n+     * @param worldPos the pos it is placed at.\n+     * @param blueprint the blueprint.\n+     * @param settings the placement settings.\n+     * @param entityAIStructure the AI handling this structure.\n+     */\n+    public BuildingStructureHandler(final World world, final BlockPos worldPos, final Blueprint blueprint, final PlacementSettings settings, final AbstractEntityAIStructure<? extends AbstractJobStructure> entityAIStructure, final Stage[] stages)\n+    {\n+        super(world, worldPos, blueprint, settings);\n+        setupBuilding();\n+        this.structureAI= entityAIStructure;\n+        this.stages = stages;\n+        this.stage = 0;\n+    }\n+\n+    /**\n+     * Setup the building to register things to.\n+     */\n+    private void setupBuilding()\n+    {\n+        final IColony colony = IColonyManager.getInstance().getColonyByPosFromWorld(getWorld(), getWorldPos());\n+        if (colony != null)\n+        {\n+            this.building = colony.getBuildingManager().getBuilding(getWorldPos());\n+        }\n+    }\n+\n+    /**\n+     * Get the current stage we're in.\n+     *\n+     * @return the current Stage.\n+     */\n+    @Nullable\n+    public Stage getStage()\n+    {\n+        if (this.stage >= stages.length)\n+        {\n+            return null;\n+        }\n+        return stages[stage];\n+    }\n+\n+    /**\n+     * Go to the next stage.\n+     */\n+    public boolean nextStage()\n+    {\n+        return ++this.stage < stages.length;\n+    }\n+\n+    /**\n+     * Set the current stage from memory.\n+     * @param stage the stage to set.\n+     */\n+    public void setStage(final Stage stage)\n+    {\n+        for (int i = 0; i < stages.length; i++)\n+        {\n+            if (stages[i] == stage)\n+            {\n+                this.stage = i;\n+                return;\n+            }\n+        }\n+    }\n+\n+    @Override\n+    public void prePlacementLogic(final BlockPos worldPos, final BlockState blockState)\n+    {\n+        WorkerUtil.faceBlock(worldPos, structureAI.getWorker());\n+        //Move out of the way when placing blocks\n+        final ItemStack item = BlockUtils.getItemStackFromBlockState(blockState);\n+        structureAI.getWorker().setItemStackToSlot(EquipmentSlotType.MAINHAND, item == null ? ItemStackUtils.EMPTY : item);\n+\n+        if (MathHelper.floor(structureAI.getWorker().getPosX()) == worldPos.getX()\n+              && MathHelper.abs(worldPos.getY() - (int) structureAI.getWorker().getPosY()) <= 1\n+              && MathHelper.floor(structureAI.getWorker().getPosZ()) == worldPos.getZ()\n+              && structureAI.getWorker().getNavigator().noPath())\n+        {\n+            structureAI.getWorker().getNavigator().moveAwayFromXYZ(worldPos, RUN_AWAY_SPEED, 1);\n+        }\n+\n+        structureAI.getWorker().swingArm(Hand.MAIN_HAND);\n+    }\n+\n+    @Nullable\n+    @Override\n+    public IItemHandler getInventory()\n+    {\n+        return structureAI.getWorker().getInventoryCitizen();\n+    }\n+\n+    @Override\n+    public void triggerSuccess(final BlockPos pos, final List<ItemStack> list, final boolean placement)\n+    {\n+        final BlockState state = getBluePrint().getBlockState(pos);\n+        final BlockPos worldPos = getProgressPosInWorld(pos);\n+        if (building != null)\n+        {\n+            building.registerBlockPosition(getBluePrint().getBlockState(pos), worldPos, this.getWorld());\n+        }\n+\n+        if (placement)\n+        {\n+            structureAI.getWorker().getCitizenExperienceHandler().addExperience(XP_EACH_BLOCK);\n+\n+            for (final ItemStack stack : list)\n+            {\n+                structureAI.reduceNeededResources(stack);\n+            }\n+        }\n+\n+        if (state.getBlock() == ModBlocks.blockWayPoint)\n+        {\n+            structureAI.getWorker().getCitizenColonyHandler().getColony().addWayPoint(worldPos, state);\n+        }\n+        Log.getLogger().warn(\"success\" + pos.toString());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bb0eec564be763070621b0f81b362050d736bb26"}, "originalPosition": 202}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY3NTQ1NTUwOnYy", "diffSide": "RIGHT", "path": "src/main/java/com/minecolonies/coremod/network/messages/server/BuildToolPasteMessage.java", "isResolved": false, "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yM1QxOTozNjoyMlrOGZrBnQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNFQxNDo0MTozM1rOGZvXZw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTU3MjUwOQ==", "bodyText": "is this really needed? does the place not normally load the placed's TE data?", "url": "https://github.com/ldtteam/minecolonies/pull/5064#discussion_r429572509", "createdAt": "2020-05-23T19:36:22Z", "author": {"login": "someaddons"}, "path": "src/main/java/com/minecolonies/coremod/network/messages/server/BuildToolPasteMessage.java", "diffHunk": "@@ -173,8 +180,21 @@ public void onExecute(final NetworkEvent.Context ctxIn, final boolean isLogicalS\n             if (isHut)\n             {\n                 handleHut(CompatibilityUtils.getWorldFromEntity(player), player, sn, rotation, pos, mirror, state, complete);\n-                InstantStructurePlacer.loadAndPlaceStructureWithRotation(player.world, structureName,\n-                  pos, BlockPosUtil.getRotationFromRotations(rotation), mirror ? Mirror.FRONT_BACK : Mirror.NONE, complete);\n+                final Blueprint blueprint = MCCreativeStructureHandler.loadAndPlaceStructureWithRotation(player.world, structureName,\n+                  pos, BlockPosUtil.getRotationFromRotations(rotation), mirror ? Mirror.FRONT_BACK : Mirror.NONE, !complete, player);\n+\n+                final TileEntity tileEntity = player.world.getTileEntity(pos);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bb0eec564be763070621b0f81b362050d736bb26"}, "originalPosition": 48}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTYxMzczOQ==", "bodyText": "Not of the one at the offset pos.", "url": "https://github.com/ldtteam/minecolonies/pull/5064#discussion_r429613739", "createdAt": "2020-05-24T08:46:03Z", "author": {"login": "Raycoms"}, "path": "src/main/java/com/minecolonies/coremod/network/messages/server/BuildToolPasteMessage.java", "diffHunk": "@@ -173,8 +180,21 @@ public void onExecute(final NetworkEvent.Context ctxIn, final boolean isLogicalS\n             if (isHut)\n             {\n                 handleHut(CompatibilityUtils.getWorldFromEntity(player), player, sn, rotation, pos, mirror, state, complete);\n-                InstantStructurePlacer.loadAndPlaceStructureWithRotation(player.world, structureName,\n-                  pos, BlockPosUtil.getRotationFromRotations(rotation), mirror ? Mirror.FRONT_BACK : Mirror.NONE, complete);\n+                final Blueprint blueprint = MCCreativeStructureHandler.loadAndPlaceStructureWithRotation(player.world, structureName,\n+                  pos, BlockPosUtil.getRotationFromRotations(rotation), mirror ? Mirror.FRONT_BACK : Mirror.NONE, !complete, player);\n+\n+                final TileEntity tileEntity = player.world.getTileEntity(pos);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTU3MjUwOQ=="}, "originalCommit": {"oid": "bb0eec564be763070621b0f81b362050d736bb26"}, "originalPosition": 48}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTYxNzYxMA==", "bodyText": "offset pos? you mean the anchor position? why is it excluded? :D", "url": "https://github.com/ldtteam/minecolonies/pull/5064#discussion_r429617610", "createdAt": "2020-05-24T09:36:22Z", "author": {"login": "someaddons"}, "path": "src/main/java/com/minecolonies/coremod/network/messages/server/BuildToolPasteMessage.java", "diffHunk": "@@ -173,8 +180,21 @@ public void onExecute(final NetworkEvent.Context ctxIn, final boolean isLogicalS\n             if (isHut)\n             {\n                 handleHut(CompatibilityUtils.getWorldFromEntity(player), player, sn, rotation, pos, mirror, state, complete);\n-                InstantStructurePlacer.loadAndPlaceStructureWithRotation(player.world, structureName,\n-                  pos, BlockPosUtil.getRotationFromRotations(rotation), mirror ? Mirror.FRONT_BACK : Mirror.NONE, complete);\n+                final Blueprint blueprint = MCCreativeStructureHandler.loadAndPlaceStructureWithRotation(player.world, structureName,\n+                  pos, BlockPosUtil.getRotationFromRotations(rotation), mirror ? Mirror.FRONT_BACK : Mirror.NONE, !complete, player);\n+\n+                final TileEntity tileEntity = player.world.getTileEntity(pos);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTU3MjUwOQ=="}, "originalCommit": {"oid": "bb0eec564be763070621b0f81b362050d736bb26"}, "originalPosition": 48}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTY0MjA4OA==", "bodyText": "because the block gets placed first, to be placed with the right level data", "url": "https://github.com/ldtteam/minecolonies/pull/5064#discussion_r429642088", "createdAt": "2020-05-24T14:25:13Z", "author": {"login": "Raycoms"}, "path": "src/main/java/com/minecolonies/coremod/network/messages/server/BuildToolPasteMessage.java", "diffHunk": "@@ -173,8 +180,21 @@ public void onExecute(final NetworkEvent.Context ctxIn, final boolean isLogicalS\n             if (isHut)\n             {\n                 handleHut(CompatibilityUtils.getWorldFromEntity(player), player, sn, rotation, pos, mirror, state, complete);\n-                InstantStructurePlacer.loadAndPlaceStructureWithRotation(player.world, structureName,\n-                  pos, BlockPosUtil.getRotationFromRotations(rotation), mirror ? Mirror.FRONT_BACK : Mirror.NONE, complete);\n+                final Blueprint blueprint = MCCreativeStructureHandler.loadAndPlaceStructureWithRotation(player.world, structureName,\n+                  pos, BlockPosUtil.getRotationFromRotations(rotation), mirror ? Mirror.FRONT_BACK : Mirror.NONE, !complete, player);\n+\n+                final TileEntity tileEntity = player.world.getTileEntity(pos);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTU3MjUwOQ=="}, "originalCommit": {"oid": "bb0eec564be763070621b0f81b362050d736bb26"}, "originalPosition": 48}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTY0MzQ2Ng==", "bodyText": "ye but upon that placement it should read the schematics TE data or not?", "url": "https://github.com/ldtteam/minecolonies/pull/5064#discussion_r429643466", "createdAt": "2020-05-24T14:39:55Z", "author": {"login": "someaddons"}, "path": "src/main/java/com/minecolonies/coremod/network/messages/server/BuildToolPasteMessage.java", "diffHunk": "@@ -173,8 +180,21 @@ public void onExecute(final NetworkEvent.Context ctxIn, final boolean isLogicalS\n             if (isHut)\n             {\n                 handleHut(CompatibilityUtils.getWorldFromEntity(player), player, sn, rotation, pos, mirror, state, complete);\n-                InstantStructurePlacer.loadAndPlaceStructureWithRotation(player.world, structureName,\n-                  pos, BlockPosUtil.getRotationFromRotations(rotation), mirror ? Mirror.FRONT_BACK : Mirror.NONE, complete);\n+                final Blueprint blueprint = MCCreativeStructureHandler.loadAndPlaceStructureWithRotation(player.world, structureName,\n+                  pos, BlockPosUtil.getRotationFromRotations(rotation), mirror ? Mirror.FRONT_BACK : Mirror.NONE, !complete, player);\n+\n+                final TileEntity tileEntity = player.world.getTileEntity(pos);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTU3MjUwOQ=="}, "originalCommit": {"oid": "bb0eec564be763070621b0f81b362050d736bb26"}, "originalPosition": 48}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTY0MzYyMw==", "bodyText": "No, that's why I've added this here.", "url": "https://github.com/ldtteam/minecolonies/pull/5064#discussion_r429643623", "createdAt": "2020-05-24T14:41:33Z", "author": {"login": "Raycoms"}, "path": "src/main/java/com/minecolonies/coremod/network/messages/server/BuildToolPasteMessage.java", "diffHunk": "@@ -173,8 +180,21 @@ public void onExecute(final NetworkEvent.Context ctxIn, final boolean isLogicalS\n             if (isHut)\n             {\n                 handleHut(CompatibilityUtils.getWorldFromEntity(player), player, sn, rotation, pos, mirror, state, complete);\n-                InstantStructurePlacer.loadAndPlaceStructureWithRotation(player.world, structureName,\n-                  pos, BlockPosUtil.getRotationFromRotations(rotation), mirror ? Mirror.FRONT_BACK : Mirror.NONE, complete);\n+                final Blueprint blueprint = MCCreativeStructureHandler.loadAndPlaceStructureWithRotation(player.world, structureName,\n+                  pos, BlockPosUtil.getRotationFromRotations(rotation), mirror ? Mirror.FRONT_BACK : Mirror.NONE, !complete, player);\n+\n+                final TileEntity tileEntity = player.world.getTileEntity(pos);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTU3MjUwOQ=="}, "originalCommit": {"oid": "bb0eec564be763070621b0f81b362050d736bb26"}, "originalPosition": 48}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3073, "cost": 1, "resetAt": "2021-11-12T20:44:06Z"}}}