{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTMyNDkwMjE3", "number": 6196, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wNFQxMjoxMjozM1rOFAxZzw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wNVQxODowNzozM1rOFBR5Lg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM2MzUzNzQzOnYy", "diffSide": "RIGHT", "path": "src/main/java/com/minecolonies/coremod/entity/ai/citizen/guard/AbstractEntityAIGuard.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wNFQxMjoxMjozM1rOH_OQnQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wNFQxMjoxNjoxMVrOH_OX0A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjA1NTk2NQ==", "bodyText": "I sthis enough to have this here, what happens if combat finishes and they are hungry, or try to retreat with low health?", "url": "https://github.com/ldtteam/minecolonies/pull/6196#discussion_r536055965", "createdAt": "2020-12-04T12:12:33Z", "author": {"login": "Raycoms"}, "path": "src/main/java/com/minecolonies/coremod/entity/ai/citizen/guard/AbstractEntityAIGuard.java", "diffHunk": "@@ -438,6 +440,11 @@ private IAIState checkAndAttackTarget()\n         if (fighttimer > 0)\n         {\n             fighttimer--;\n+            if (fighttimer == 0)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7ee7248ef5a13b3909c00b40beec7add5f011fc2"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjA1NzQxMw==", "bodyText": "ye because this is the point which also prevents the interruption of the other AI's", "url": "https://github.com/ldtteam/minecolonies/pull/6196#discussion_r536057413", "createdAt": "2020-12-04T12:15:23Z", "author": {"login": "someaddons"}, "path": "src/main/java/com/minecolonies/coremod/entity/ai/citizen/guard/AbstractEntityAIGuard.java", "diffHunk": "@@ -438,6 +440,11 @@ private IAIState checkAndAttackTarget()\n         if (fighttimer > 0)\n         {\n             fighttimer--;\n+            if (fighttimer == 0)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjA1NTk2NQ=="}, "originalCommit": {"oid": "7ee7248ef5a13b3909c00b40beec7add5f011fc2"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjA1NzgwOA==", "bodyText": "kk", "url": "https://github.com/ldtteam/minecolonies/pull/6196#discussion_r536057808", "createdAt": "2020-12-04T12:16:11Z", "author": {"login": "Raycoms"}, "path": "src/main/java/com/minecolonies/coremod/entity/ai/citizen/guard/AbstractEntityAIGuard.java", "diffHunk": "@@ -438,6 +440,11 @@ private IAIState checkAndAttackTarget()\n         if (fighttimer > 0)\n         {\n             fighttimer--;\n+            if (fighttimer == 0)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjA1NTk2NQ=="}, "originalCommit": {"oid": "7ee7248ef5a13b3909c00b40beec7add5f011fc2"}, "originalPosition": 13}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM2ODg2MDQ2OnYy", "diffSide": "RIGHT", "path": "src/api/java/com/minecolonies/api/entity/ai/statemachine/basestatemachine/BasicStateMachine.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wNVQxODowNzoyMVrOH_9uDw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wNVQxOTo0Mjo0NlrOIAAkYg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjgzMzU1MQ==", "bodyText": "Are we sure this can not produce an NPE?\nWould a getOrDefault(..., Collections.emptyList()) not be better here just to be sure.", "url": "https://github.com/ldtteam/minecolonies/pull/6196#discussion_r536833551", "createdAt": "2020-12-05T18:07:21Z", "author": {"login": "OrionDevelopment"}, "path": "src/api/java/com/minecolonies/api/entity/ai/statemachine/basestatemachine/BasicStateMachine.java", "diffHunk": "@@ -92,15 +92,11 @@ public void removeTransition(final T transition)\n     {\n         if (transition instanceof IStateMachineEvent)\n         {\n-            final List<T> temp = new ArrayList<>(eventTransitionMap.get(((IStateMachineEvent<?>) transition).getEventType()));\n-            temp.remove(transition);\n-            eventTransitionMap.put(((IStateMachineEvent<?>) transition).getEventType(), temp);\n+            eventTransitionMap.get(((IStateMachineEvent<?>) transition).getEventType()).removeIf(t -> t == transition);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4f72583dfb43e11f3c4b6d039635cf96e8fc1a0a"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjg4MDIyNg==", "bodyText": "ye it would indeed cause and NPE, thought that too when writing it and just left it to crash as sth must be wrong when trying to remove one that isnt added at all", "url": "https://github.com/ldtteam/minecolonies/pull/6196#discussion_r536880226", "createdAt": "2020-12-05T19:42:46Z", "author": {"login": "someaddons"}, "path": "src/api/java/com/minecolonies/api/entity/ai/statemachine/basestatemachine/BasicStateMachine.java", "diffHunk": "@@ -92,15 +92,11 @@ public void removeTransition(final T transition)\n     {\n         if (transition instanceof IStateMachineEvent)\n         {\n-            final List<T> temp = new ArrayList<>(eventTransitionMap.get(((IStateMachineEvent<?>) transition).getEventType()));\n-            temp.remove(transition);\n-            eventTransitionMap.put(((IStateMachineEvent<?>) transition).getEventType(), temp);\n+            eventTransitionMap.get(((IStateMachineEvent<?>) transition).getEventType()).removeIf(t -> t == transition);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjgzMzU1MQ=="}, "originalCommit": {"oid": "4f72583dfb43e11f3c4b6d039635cf96e8fc1a0a"}, "originalPosition": 7}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM2ODg2MDYyOnYy", "diffSide": "RIGHT", "path": "src/api/java/com/minecolonies/api/entity/ai/statemachine/basestatemachine/BasicStateMachine.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wNVQxODowNzozM1rOH_9uIw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wNVQxODowNzozM1rOH_9uIw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjgzMzU3MQ==", "bodyText": "See other comments in the file.", "url": "https://github.com/ldtteam/minecolonies/pull/6196#discussion_r536833571", "createdAt": "2020-12-05T18:07:33Z", "author": {"login": "OrionDevelopment"}, "path": "src/api/java/com/minecolonies/api/entity/ai/statemachine/basestatemachine/BasicStateMachine.java", "diffHunk": "@@ -92,15 +92,11 @@ public void removeTransition(final T transition)\n     {\n         if (transition instanceof IStateMachineEvent)\n         {\n-            final List<T> temp = new ArrayList<>(eventTransitionMap.get(((IStateMachineEvent<?>) transition).getEventType()));\n-            temp.remove(transition);\n-            eventTransitionMap.put(((IStateMachineEvent<?>) transition).getEventType(), temp);\n+            eventTransitionMap.get(((IStateMachineEvent<?>) transition).getEventType()).removeIf(t -> t == transition);\n         }\n         else\n         {\n-            final List<T> temp = new ArrayList<>(transitionMap.get(transition.getState()));\n-            temp.remove(transition);\n-            transitionMap.put(transition.getState(), temp);\n+            transitionMap.get(transition.getState()).removeIf(t -> t == transition);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4f72583dfb43e11f3c4b6d039635cf96e8fc1a0a"}, "originalPosition": 14}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3282, "cost": 1, "resetAt": "2021-11-12T20:44:06Z"}}}