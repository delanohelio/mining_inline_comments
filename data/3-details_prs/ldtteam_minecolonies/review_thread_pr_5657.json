{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDczOTcwNDM3", "number": 5657, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNlQxNTowNjo0OVrOEcnpiQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNlQxNTowOTowNFrOEcntkQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk4NDQ1MTkzOnYy", "diffSide": "LEFT", "path": "src/api/java/com/minecolonies/api/util/InventoryUtils.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNlQxNTowNjo0OVrOHHQnoQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNlQxNToyMDowMVrOHHRN2w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzM3NDM2OQ==", "bodyText": "@return missing", "url": "https://github.com/ldtteam/minecolonies/pull/5657#discussion_r477374369", "createdAt": "2020-08-26T15:06:49Z", "author": {"login": "Raycoms"}, "path": "src/api/java/com/minecolonies/api/util/InventoryUtils.java", "diffHunk": "@@ -1808,7 +1808,7 @@ public static int transferXOfFirstSlotInItemHandlerWithIntoNextFreeSlotInItemHan\n      * @param targetHandler               the target.\n      * @param slot                        the slot to put it in.\n      */\n-    public static void transferXOfFirstSlotInItemHandlerWithIntoInItemHandler(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9b6456f8ca30b0da173afaea6e468f263ac1da63"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzM4NDE1NQ==", "bodyText": "fixed.", "url": "https://github.com/ldtteam/minecolonies/pull/5657#discussion_r477384155", "createdAt": "2020-08-26T15:20:01Z", "author": {"login": "Mekle001"}, "path": "src/api/java/com/minecolonies/api/util/InventoryUtils.java", "diffHunk": "@@ -1808,7 +1808,7 @@ public static int transferXOfFirstSlotInItemHandlerWithIntoNextFreeSlotInItemHan\n      * @param targetHandler               the target.\n      * @param slot                        the slot to put it in.\n      */\n-    public static void transferXOfFirstSlotInItemHandlerWithIntoInItemHandler(", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzM3NDM2OQ=="}, "originalCommit": {"oid": "9b6456f8ca30b0da173afaea6e468f263ac1da63"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk4NDQ1NDY5OnYy", "diffSide": "RIGHT", "path": "src/main/java/com/minecolonies/coremod/client/gui/WindowPostBox.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNlQxNTowNzoyNlrOHHQpXA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNlQxNToxOTo1MlrOHHRNXw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzM3NDgxMg==", "bodyText": "seems a bit too much whitespace. You can also delete the uncommented directly. We got git for that =D", "url": "https://github.com/ldtteam/minecolonies/pull/5657#discussion_r477374812", "createdAt": "2020-08-26T15:07:26Z", "author": {"login": "Raycoms"}, "path": "src/main/java/com/minecolonies/coremod/client/gui/WindowPostBox.java", "diffHunk": "@@ -110,12 +110,17 @@ private void requestClicked(final Button button)\n             }\n         }\n \n+\n+        Network.getNetwork().sendToServer(new PostBoxRequestMessage(buildingView, stack.copy(), qty, deliverAvailable));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9b6456f8ca30b0da173afaea6e468f263ac1da63"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzM4NDAzMQ==", "bodyText": "Yeah, Missed that in my cleanup pass.", "url": "https://github.com/ldtteam/minecolonies/pull/5657#discussion_r477384031", "createdAt": "2020-08-26T15:19:52Z", "author": {"login": "Mekle001"}, "path": "src/main/java/com/minecolonies/coremod/client/gui/WindowPostBox.java", "diffHunk": "@@ -110,12 +110,17 @@ private void requestClicked(final Button button)\n             }\n         }\n \n+\n+        Network.getNetwork().sendToServer(new PostBoxRequestMessage(buildingView, stack.copy(), qty, deliverAvailable));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzM3NDgxMg=="}, "originalCommit": {"oid": "9b6456f8ca30b0da173afaea6e468f263ac1da63"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk4NDQ2MjI1OnYy", "diffSide": "RIGHT", "path": "src/main/java/com/minecolonies/coremod/entity/ai/basic/AbstractEntityAIRequestSmelter.java", "isResolved": true, "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNlQxNTowOTowNFrOHHQuBw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNlQxNToyMDoyOFrOHHRPKQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzM3NjAwNw==", "bodyText": "formatting seems off here.", "url": "https://github.com/ldtteam/minecolonies/pull/5657#discussion_r477376007", "createdAt": "2020-08-26T15:09:04Z", "author": {"login": "Raycoms"}, "path": "src/main/java/com/minecolonies/coremod/entity/ai/basic/AbstractEntityAIRequestSmelter.java", "diffHunk": "@@ -478,11 +492,18 @@ private IAIState fillUpFurnace()\n                                 return getState();\n                             }\n                             worker.getCitizenItemHandler().hitBlockWithToolInHand(walkTo);\n-                            job.setProgress(job.getProgress() + toTransfer);\n-                            InventoryUtils.transferXOfFirstSlotInItemHandlerWithIntoInItemHandler(\n-                            worker.getInventoryCitizen(), smeltable, toTransfer,\n-                            new InvWrapper(furnace), SMELTABLE_SLOT);\n-                        }\n+                            int transferred = InventoryUtils.transferXOfFirstSlotInItemHandlerWithIntoInItemHandler(\n+                                worker.getInventoryCitizen(), smeltable, toTransfer,\n+                                new InvWrapper(furnace), SMELTABLE_SLOT);\n+                            // It's possible we have less in the stack than we want to transfer, so transfer what we can, and try one more time. \n+                            if (transferred < toTransfer)\n+                            {\n+                                transferred += InventoryUtils.transferXOfFirstSlotInItemHandlerWithIntoInItemHandler(\n+                                    worker.getInventoryCitizen(), smeltable, toTransfer - transferred,\n+                                    new InvWrapper(furnace), SMELTABLE_SLOT);\n+                            }\n+                            job.setProgress(job.getProgress() + transferred);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9b6456f8ca30b0da173afaea6e468f263ac1da63"}, "originalPosition": 124}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzM3NjIyMw==", "bodyText": "How can this fail and need to be executed twice?", "url": "https://github.com/ldtteam/minecolonies/pull/5657#discussion_r477376223", "createdAt": "2020-08-26T15:09:21Z", "author": {"login": "Raycoms"}, "path": "src/main/java/com/minecolonies/coremod/entity/ai/basic/AbstractEntityAIRequestSmelter.java", "diffHunk": "@@ -478,11 +492,18 @@ private IAIState fillUpFurnace()\n                                 return getState();\n                             }\n                             worker.getCitizenItemHandler().hitBlockWithToolInHand(walkTo);\n-                            job.setProgress(job.getProgress() + toTransfer);\n-                            InventoryUtils.transferXOfFirstSlotInItemHandlerWithIntoInItemHandler(\n-                            worker.getInventoryCitizen(), smeltable, toTransfer,\n-                            new InvWrapper(furnace), SMELTABLE_SLOT);\n-                        }\n+                            int transferred = InventoryUtils.transferXOfFirstSlotInItemHandlerWithIntoInItemHandler(\n+                                worker.getInventoryCitizen(), smeltable, toTransfer,\n+                                new InvWrapper(furnace), SMELTABLE_SLOT);\n+                            // It's possible we have less in the stack than we want to transfer, so transfer what we can, and try one more time. \n+                            if (transferred < toTransfer)\n+                            {\n+                                transferred += InventoryUtils.transferXOfFirstSlotInItemHandlerWithIntoInItemHandler(\n+                                    worker.getInventoryCitizen(), smeltable, toTransfer - transferred,\n+                                    new InvWrapper(furnace), SMELTABLE_SLOT);\n+                            }\n+                            job.setProgress(job.getProgress() + transferred);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzM3NjAwNw=="}, "originalCommit": {"oid": "9b6456f8ca30b0da173afaea6e468f263ac1da63"}, "originalPosition": 124}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzM3ODg5Mw==", "bodyText": "You want to transfer 20, the first slot it finds has 8, the rest are in the second slot. It only works with one slot, so the first request is for 20 on the slot with 8. You need to a follow request on the slot with 12 to complete it.", "url": "https://github.com/ldtteam/minecolonies/pull/5657#discussion_r477378893", "createdAt": "2020-08-26T15:12:53Z", "author": {"login": "Mekle001"}, "path": "src/main/java/com/minecolonies/coremod/entity/ai/basic/AbstractEntityAIRequestSmelter.java", "diffHunk": "@@ -478,11 +492,18 @@ private IAIState fillUpFurnace()\n                                 return getState();\n                             }\n                             worker.getCitizenItemHandler().hitBlockWithToolInHand(walkTo);\n-                            job.setProgress(job.getProgress() + toTransfer);\n-                            InventoryUtils.transferXOfFirstSlotInItemHandlerWithIntoInItemHandler(\n-                            worker.getInventoryCitizen(), smeltable, toTransfer,\n-                            new InvWrapper(furnace), SMELTABLE_SLOT);\n-                        }\n+                            int transferred = InventoryUtils.transferXOfFirstSlotInItemHandlerWithIntoInItemHandler(\n+                                worker.getInventoryCitizen(), smeltable, toTransfer,\n+                                new InvWrapper(furnace), SMELTABLE_SLOT);\n+                            // It's possible we have less in the stack than we want to transfer, so transfer what we can, and try one more time. \n+                            if (transferred < toTransfer)\n+                            {\n+                                transferred += InventoryUtils.transferXOfFirstSlotInItemHandlerWithIntoInItemHandler(\n+                                    worker.getInventoryCitizen(), smeltable, toTransfer - transferred,\n+                                    new InvWrapper(furnace), SMELTABLE_SLOT);\n+                            }\n+                            job.setProgress(job.getProgress() + transferred);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzM3NjAwNw=="}, "originalCommit": {"oid": "9b6456f8ca30b0da173afaea6e468f263ac1da63"}, "originalPosition": 124}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzM4MTQ1NA==", "bodyText": "Then we should probably use a better one.", "url": "https://github.com/ldtteam/minecolonies/pull/5657#discussion_r477381454", "createdAt": "2020-08-26T15:16:22Z", "author": {"login": "Raycoms"}, "path": "src/main/java/com/minecolonies/coremod/entity/ai/basic/AbstractEntityAIRequestSmelter.java", "diffHunk": "@@ -478,11 +492,18 @@ private IAIState fillUpFurnace()\n                                 return getState();\n                             }\n                             worker.getCitizenItemHandler().hitBlockWithToolInHand(walkTo);\n-                            job.setProgress(job.getProgress() + toTransfer);\n-                            InventoryUtils.transferXOfFirstSlotInItemHandlerWithIntoInItemHandler(\n-                            worker.getInventoryCitizen(), smeltable, toTransfer,\n-                            new InvWrapper(furnace), SMELTABLE_SLOT);\n-                        }\n+                            int transferred = InventoryUtils.transferXOfFirstSlotInItemHandlerWithIntoInItemHandler(\n+                                worker.getInventoryCitizen(), smeltable, toTransfer,\n+                                new InvWrapper(furnace), SMELTABLE_SLOT);\n+                            // It's possible we have less in the stack than we want to transfer, so transfer what we can, and try one more time. \n+                            if (transferred < toTransfer)\n+                            {\n+                                transferred += InventoryUtils.transferXOfFirstSlotInItemHandlerWithIntoInItemHandler(\n+                                    worker.getInventoryCitizen(), smeltable, toTransfer - transferred,\n+                                    new InvWrapper(furnace), SMELTABLE_SLOT);\n+                            }\n+                            job.setProgress(job.getProgress() + transferred);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzM3NjAwNw=="}, "originalCommit": {"oid": "9b6456f8ca30b0da173afaea6e468f263ac1da63"}, "originalPosition": 124}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzM4NDQ4OQ==", "bodyText": "Ok, that's more consistent formatting now.", "url": "https://github.com/ldtteam/minecolonies/pull/5657#discussion_r477384489", "createdAt": "2020-08-26T15:20:28Z", "author": {"login": "Mekle001"}, "path": "src/main/java/com/minecolonies/coremod/entity/ai/basic/AbstractEntityAIRequestSmelter.java", "diffHunk": "@@ -478,11 +492,18 @@ private IAIState fillUpFurnace()\n                                 return getState();\n                             }\n                             worker.getCitizenItemHandler().hitBlockWithToolInHand(walkTo);\n-                            job.setProgress(job.getProgress() + toTransfer);\n-                            InventoryUtils.transferXOfFirstSlotInItemHandlerWithIntoInItemHandler(\n-                            worker.getInventoryCitizen(), smeltable, toTransfer,\n-                            new InvWrapper(furnace), SMELTABLE_SLOT);\n-                        }\n+                            int transferred = InventoryUtils.transferXOfFirstSlotInItemHandlerWithIntoInItemHandler(\n+                                worker.getInventoryCitizen(), smeltable, toTransfer,\n+                                new InvWrapper(furnace), SMELTABLE_SLOT);\n+                            // It's possible we have less in the stack than we want to transfer, so transfer what we can, and try one more time. \n+                            if (transferred < toTransfer)\n+                            {\n+                                transferred += InventoryUtils.transferXOfFirstSlotInItemHandlerWithIntoInItemHandler(\n+                                    worker.getInventoryCitizen(), smeltable, toTransfer - transferred,\n+                                    new InvWrapper(furnace), SMELTABLE_SLOT);\n+                            }\n+                            job.setProgress(job.getProgress() + transferred);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzM3NjAwNw=="}, "originalCommit": {"oid": "9b6456f8ca30b0da173afaea6e468f263ac1da63"}, "originalPosition": 124}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3442, "cost": 1, "resetAt": "2021-11-12T20:44:06Z"}}}