{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDczOTcwNDM3", "number": 5657, "title": "Fix some edge cases in the smeltercrafter & improve the postbox", "bodyText": "Changes proposed in this pull request:\n\nSmeltercrafter was sometimes thinking it loaded more into a furnace than it did, and thus not completing the job.\nSmeltercrafter no longer paces when using fewer than all the furnaces in the building\nSmeltercrafter will now recover when a job is cancelled and a furnace runs out of fuel before completing it.\nPostbox no longer breaks requests up into multiple request of single stacks.\n\nReview please", "createdAt": "2020-08-26T15:04:16Z", "url": "https://github.com/ldtteam/minecolonies/pull/5657", "merged": true, "mergeCommit": {"oid": "a626184384ddc92b58c687293855001d764c18af"}, "closed": true, "closedAt": "2020-08-27T17:13:09Z", "author": {"login": "Mekle001"}, "timelineItems": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdCsmnSgH2gAyNDczOTcwNDM3OjUyZTVlNGNiM2I0MjA4MGY1OTI2ODAyNTk3YjVhNzZiMjY0NjYyYTY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdC-cBGAFqTQ3NjYxMzkwMQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "52e5e4cb3b42080f5926802597b5a76b264662a6", "author": {"user": {"login": "Mekle001", "name": "Mike Garlick"}}, "url": "https://github.com/ldtteam/minecolonies/commit/52e5e4cb3b42080f5926802597b5a76b264662a6", "committedDate": "2020-08-26T14:23:05Z", "message": "Add return of transferred count"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "552bcd783581fc50825f5aed194eee5bb3eaa104", "author": {"user": {"login": "Mekle001", "name": "Mike Garlick"}}, "url": "https://github.com/ldtteam/minecolonies/commit/552bcd783581fc50825f5aed194eee5bb3eaa104", "committedDate": "2020-08-26T14:23:45Z", "message": "Fix postbox to not break requests into stacks"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9b6456f8ca30b0da173afaea6e468f263ac1da63", "author": {"user": {"login": "Mekle001", "name": "Mike Garlick"}}, "url": "https://github.com/ldtteam/minecolonies/commit/9b6456f8ca30b0da173afaea6e468f263ac1da63", "committedDate": "2020-08-26T14:24:15Z", "message": "Improve Smeltercraftrer"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc1NTg1Mzkx", "url": "https://github.com/ldtteam/minecolonies/pull/5657#pullrequestreview-475585391", "createdAt": "2020-08-26T15:06:49Z", "commit": {"oid": "9b6456f8ca30b0da173afaea6e468f263ac1da63"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNlQxNTowNjo0OVrOHHQnoQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNlQxNTowNjo0OVrOHHQnoQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzM3NDM2OQ==", "bodyText": "@return missing", "url": "https://github.com/ldtteam/minecolonies/pull/5657#discussion_r477374369", "createdAt": "2020-08-26T15:06:49Z", "author": {"login": "Raycoms"}, "path": "src/api/java/com/minecolonies/api/util/InventoryUtils.java", "diffHunk": "@@ -1808,7 +1808,7 @@ public static int transferXOfFirstSlotInItemHandlerWithIntoNextFreeSlotInItemHan\n      * @param targetHandler               the target.\n      * @param slot                        the slot to put it in.\n      */\n-    public static void transferXOfFirstSlotInItemHandlerWithIntoInItemHandler(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9b6456f8ca30b0da173afaea6e468f263ac1da63"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc1NTg2MDEy", "url": "https://github.com/ldtteam/minecolonies/pull/5657#pullrequestreview-475586012", "createdAt": "2020-08-26T15:07:26Z", "commit": {"oid": "9b6456f8ca30b0da173afaea6e468f263ac1da63"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNlQxNTowNzoyNlrOHHQpXA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNlQxNTowNzoyNlrOHHQpXA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzM3NDgxMg==", "bodyText": "seems a bit too much whitespace. You can also delete the uncommented directly. We got git for that =D", "url": "https://github.com/ldtteam/minecolonies/pull/5657#discussion_r477374812", "createdAt": "2020-08-26T15:07:26Z", "author": {"login": "Raycoms"}, "path": "src/main/java/com/minecolonies/coremod/client/gui/WindowPostBox.java", "diffHunk": "@@ -110,12 +110,17 @@ private void requestClicked(final Button button)\n             }\n         }\n \n+\n+        Network.getNetwork().sendToServer(new PostBoxRequestMessage(buildingView, stack.copy(), qty, deliverAvailable));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9b6456f8ca30b0da173afaea6e468f263ac1da63"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc1NTg3NTcz", "url": "https://github.com/ldtteam/minecolonies/pull/5657#pullrequestreview-475587573", "createdAt": "2020-08-26T15:09:04Z", "commit": {"oid": "9b6456f8ca30b0da173afaea6e468f263ac1da63"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNlQxNTowOTowNFrOHHQuBw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNlQxNTowOTowNFrOHHQuBw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzM3NjAwNw==", "bodyText": "formatting seems off here.", "url": "https://github.com/ldtteam/minecolonies/pull/5657#discussion_r477376007", "createdAt": "2020-08-26T15:09:04Z", "author": {"login": "Raycoms"}, "path": "src/main/java/com/minecolonies/coremod/entity/ai/basic/AbstractEntityAIRequestSmelter.java", "diffHunk": "@@ -478,11 +492,18 @@ private IAIState fillUpFurnace()\n                                 return getState();\n                             }\n                             worker.getCitizenItemHandler().hitBlockWithToolInHand(walkTo);\n-                            job.setProgress(job.getProgress() + toTransfer);\n-                            InventoryUtils.transferXOfFirstSlotInItemHandlerWithIntoInItemHandler(\n-                            worker.getInventoryCitizen(), smeltable, toTransfer,\n-                            new InvWrapper(furnace), SMELTABLE_SLOT);\n-                        }\n+                            int transferred = InventoryUtils.transferXOfFirstSlotInItemHandlerWithIntoInItemHandler(\n+                                worker.getInventoryCitizen(), smeltable, toTransfer,\n+                                new InvWrapper(furnace), SMELTABLE_SLOT);\n+                            // It's possible we have less in the stack than we want to transfer, so transfer what we can, and try one more time. \n+                            if (transferred < toTransfer)\n+                            {\n+                                transferred += InventoryUtils.transferXOfFirstSlotInItemHandlerWithIntoInItemHandler(\n+                                    worker.getInventoryCitizen(), smeltable, toTransfer - transferred,\n+                                    new InvWrapper(furnace), SMELTABLE_SLOT);\n+                            }\n+                            job.setProgress(job.getProgress() + transferred);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9b6456f8ca30b0da173afaea6e468f263ac1da63"}, "originalPosition": 124}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f68f65c17b094e1233f42e3ce89c5ff56f0aeca4", "author": {"user": {"login": "Mekle001", "name": "Mike Garlick"}}, "url": "https://github.com/ldtteam/minecolonies/commit/f68f65c17b094e1233f42e3ce89c5ff56f0aeca4", "committedDate": "2020-08-26T15:09:16Z", "message": "Cleanup whitespace/comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "79382c376f276ad51dbfe281f304e7aceb564007", "author": {"user": {"login": "Mekle001", "name": "Mike Garlick"}}, "url": "https://github.com/ldtteam/minecolonies/commit/79382c376f276ad51dbfe281f304e7aceb564007", "committedDate": "2020-08-26T15:19:27Z", "message": "Review feedback"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5122a7b56086ca475073471e18efb245ad94fc59", "author": {"user": {"login": "Mekle001", "name": "Mike Garlick"}}, "url": "https://github.com/ldtteam/minecolonies/commit/5122a7b56086ca475073471e18efb245ad94fc59", "committedDate": "2020-08-26T15:47:26Z", "message": "Make the transfer a loop rather than 2 pass"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d22761bccf5aa2c4077a89ffa7b43293e4d99691", "author": {"user": {"login": "Mekle001", "name": "Mike Garlick"}}, "url": "https://github.com/ldtteam/minecolonies/commit/d22761bccf5aa2c4077a89ffa7b43293e4d99691", "committedDate": "2020-08-26T15:48:30Z", "message": "Fix"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "37d403a7ee8a3abd8b71bb8780f9b938365e5385", "author": {"user": {"login": "Mekle001", "name": "Mike Garlick"}}, "url": "https://github.com/ldtteam/minecolonies/commit/37d403a7ee8a3abd8b71bb8780f9b938365e5385", "committedDate": "2020-08-26T16:29:09Z", "message": "Move code to InventoryUtils"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc2NjEzOTAx", "url": "https://github.com/ldtteam/minecolonies/pull/5657#pullrequestreview-476613901", "createdAt": "2020-08-27T11:09:48Z", "commit": {"oid": "37d403a7ee8a3abd8b71bb8780f9b938365e5385"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1878, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}