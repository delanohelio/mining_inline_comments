{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE1MDU0MTE4", "number": 6029, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNFQwODozMDozMlrOE1Hlww==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNFQwODozMDozMlrOE1Hlww==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI0MTM0MzM5OnYy", "diffSide": "RIGHT", "path": "src/api/java/com/minecolonies/api/tileentities/TileEntityRack.java", "isResolved": true, "comments": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNFQwODozMDozMlrOHtNnjQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNFQxMDo1NTo1NlrOHtTCyw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzE3MTA4NQ==", "bodyText": "Ehm, shouldn't we avoid returning this cached value here?", "url": "https://github.com/ldtteam/minecolonies/pull/6029#discussion_r517171085", "createdAt": "2020-11-04T08:30:32Z", "author": {"login": "Raycoms"}, "path": "src/api/java/com/minecolonies/api/tileentities/TileEntityRack.java", "diffHunk": "@@ -447,13 +445,13 @@ public void rotate(final Rotation rotationIn)\n     @Override\n     public <T> LazyOptional<T> getCapability(@Nonnull final Capability<T> capability, final Direction dir)\n     {\n-        if (lastOptional != null)\n-        {\n-            lastOptional.invalidate();\n-        }\n-\n         if (capability == CapabilityItemHandler.ITEM_HANDLER_CAPABILITY)\n         {\n+            if (lastOptional != null && lastOptional.isPresent())\n+            {\n+                return (LazyOptional<T>) lastOptional;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3085f5b6041ab06d1866d071e28896575f3da513"}, "originalPosition": 37}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzIyMDc1NA==", "bodyText": "No why?", "url": "https://github.com/ldtteam/minecolonies/pull/6029#discussion_r517220754", "createdAt": "2020-11-04T09:52:16Z", "author": {"login": "OrionDevelopment"}, "path": "src/api/java/com/minecolonies/api/tileentities/TileEntityRack.java", "diffHunk": "@@ -447,13 +445,13 @@ public void rotate(final Rotation rotationIn)\n     @Override\n     public <T> LazyOptional<T> getCapability(@Nonnull final Capability<T> capability, final Direction dir)\n     {\n-        if (lastOptional != null)\n-        {\n-            lastOptional.invalidate();\n-        }\n-\n         if (capability == CapabilityItemHandler.ITEM_HANDLER_CAPABILITY)\n         {\n+            if (lastOptional != null && lastOptional.isPresent())\n+            {\n+                return (LazyOptional<T>) lastOptional;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzE3MTA4NQ=="}, "originalCommit": {"oid": "3085f5b6041ab06d1866d071e28896575f3da513"}, "originalPosition": 37}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzIyMzYxNw==", "bodyText": "I have a feeling I'm talking to a wall. I discussed this 2 weeks ago and removed this caching stuff.", "url": "https://github.com/ldtteam/minecolonies/pull/6029#discussion_r517223617", "createdAt": "2020-11-04T09:56:37Z", "author": {"login": "Raycoms"}, "path": "src/api/java/com/minecolonies/api/tileentities/TileEntityRack.java", "diffHunk": "@@ -447,13 +445,13 @@ public void rotate(final Rotation rotationIn)\n     @Override\n     public <T> LazyOptional<T> getCapability(@Nonnull final Capability<T> capability, final Direction dir)\n     {\n-        if (lastOptional != null)\n-        {\n-            lastOptional.invalidate();\n-        }\n-\n         if (capability == CapabilityItemHandler.ITEM_HANDLER_CAPABILITY)\n         {\n+            if (lastOptional != null && lastOptional.isPresent())\n+            {\n+                return (LazyOptional<T>) lastOptional;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzE3MTA4NQ=="}, "originalCommit": {"oid": "3085f5b6041ab06d1866d071e28896575f3da513"}, "originalPosition": 37}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzIyOTUwMg==", "bodyText": "Because you think it will break understood.\nBut I have no evidence that it will. It works for tons of other mods, even for vanilla. So come up with evidence that it will break.\nHe invalidates the cache when the single or double status changes. Which is the only relevant thing, in my eyes.", "url": "https://github.com/ldtteam/minecolonies/pull/6029#discussion_r517229502", "createdAt": "2020-11-04T10:05:52Z", "author": {"login": "OrionDevelopment"}, "path": "src/api/java/com/minecolonies/api/tileentities/TileEntityRack.java", "diffHunk": "@@ -447,13 +445,13 @@ public void rotate(final Rotation rotationIn)\n     @Override\n     public <T> LazyOptional<T> getCapability(@Nonnull final Capability<T> capability, final Direction dir)\n     {\n-        if (lastOptional != null)\n-        {\n-            lastOptional.invalidate();\n-        }\n-\n         if (capability == CapabilityItemHandler.ITEM_HANDLER_CAPABILITY)\n         {\n+            if (lastOptional != null && lastOptional.isPresent())\n+            {\n+                return (LazyOptional<T>) lastOptional;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzE3MTA4NQ=="}, "originalCommit": {"oid": "3085f5b6041ab06d1866d071e28896575f3da513"}, "originalPosition": 37}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzIzMDE3Mg==", "bodyText": "No no, not I think it will break, it did break in numerous cases and items were lost, not detected by dman, duped, etc", "url": "https://github.com/ldtteam/minecolonies/pull/6029#discussion_r517230172", "createdAt": "2020-11-04T10:06:56Z", "author": {"login": "Raycoms"}, "path": "src/api/java/com/minecolonies/api/tileentities/TileEntityRack.java", "diffHunk": "@@ -447,13 +445,13 @@ public void rotate(final Rotation rotationIn)\n     @Override\n     public <T> LazyOptional<T> getCapability(@Nonnull final Capability<T> capability, final Direction dir)\n     {\n-        if (lastOptional != null)\n-        {\n-            lastOptional.invalidate();\n-        }\n-\n         if (capability == CapabilityItemHandler.ITEM_HANDLER_CAPABILITY)\n         {\n+            if (lastOptional != null && lastOptional.isPresent())\n+            {\n+                return (LazyOptional<T>) lastOptional;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzE3MTA4NQ=="}, "originalCommit": {"oid": "3085f5b6041ab06d1866d071e28896575f3da513"}, "originalPosition": 37}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzIzMTEwNg==", "bodyText": "I'm talking with someaddons about this and forge does it completely different for chests too, (no simple cache like this) so we should probably copy this behaviour", "url": "https://github.com/ldtteam/minecolonies/pull/6029#discussion_r517231106", "createdAt": "2020-11-04T10:08:24Z", "author": {"login": "Raycoms"}, "path": "src/api/java/com/minecolonies/api/tileentities/TileEntityRack.java", "diffHunk": "@@ -447,13 +445,13 @@ public void rotate(final Rotation rotationIn)\n     @Override\n     public <T> LazyOptional<T> getCapability(@Nonnull final Capability<T> capability, final Direction dir)\n     {\n-        if (lastOptional != null)\n-        {\n-            lastOptional.invalidate();\n-        }\n-\n         if (capability == CapabilityItemHandler.ITEM_HANDLER_CAPABILITY)\n         {\n+            if (lastOptional != null && lastOptional.isPresent())\n+            {\n+                return (LazyOptional<T>) lastOptional;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzE3MTA4NQ=="}, "originalCommit": {"oid": "3085f5b6041ab06d1866d071e28896575f3da513"}, "originalPosition": 37}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzI1ODQ2Ng==", "bodyText": "If that is the case, then go for it. I would follow the example of the chests and just stick with that.\nI thought they cached it that is why I confused. If they do not then disregard my opinion.", "url": "https://github.com/ldtteam/minecolonies/pull/6029#discussion_r517258466", "createdAt": "2020-11-04T10:53:24Z", "author": {"login": "OrionDevelopment"}, "path": "src/api/java/com/minecolonies/api/tileentities/TileEntityRack.java", "diffHunk": "@@ -447,13 +445,13 @@ public void rotate(final Rotation rotationIn)\n     @Override\n     public <T> LazyOptional<T> getCapability(@Nonnull final Capability<T> capability, final Direction dir)\n     {\n-        if (lastOptional != null)\n-        {\n-            lastOptional.invalidate();\n-        }\n-\n         if (capability == CapabilityItemHandler.ITEM_HANDLER_CAPABILITY)\n         {\n+            if (lastOptional != null && lastOptional.isPresent())\n+            {\n+                return (LazyOptional<T>) lastOptional;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzE3MTA4NQ=="}, "originalCommit": {"oid": "3085f5b6041ab06d1866d071e28896575f3da513"}, "originalPosition": 37}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzI1OTk3OQ==", "bodyText": "their lazyoptional basically queries the tileEntity from the world =D", "url": "https://github.com/ldtteam/minecolonies/pull/6029#discussion_r517259979", "createdAt": "2020-11-04T10:55:56Z", "author": {"login": "Raycoms"}, "path": "src/api/java/com/minecolonies/api/tileentities/TileEntityRack.java", "diffHunk": "@@ -447,13 +445,13 @@ public void rotate(final Rotation rotationIn)\n     @Override\n     public <T> LazyOptional<T> getCapability(@Nonnull final Capability<T> capability, final Direction dir)\n     {\n-        if (lastOptional != null)\n-        {\n-            lastOptional.invalidate();\n-        }\n-\n         if (capability == CapabilityItemHandler.ITEM_HANDLER_CAPABILITY)\n         {\n+            if (lastOptional != null && lastOptional.isPresent())\n+            {\n+                return (LazyOptional<T>) lastOptional;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzE3MTA4NQ=="}, "originalCommit": {"oid": "3085f5b6041ab06d1866d071e28896575f3da513"}, "originalPosition": 37}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3381, "cost": 1, "resetAt": "2021-11-12T20:44:06Z"}}}