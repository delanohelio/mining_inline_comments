{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzgyMDcyMDI1", "number": 4385, "title": "Inventoryutils issues", "bodyText": "Changes proposed in this pull request:\nFixes a multitude of inventory issues, from dupes to lost stacks.\nFew cases of unhandled remainders, bugged comparisons etc.\nThese are all bugfixes for the current inventory utils, though I'll probably rework the class as whole aswell later, squishing it down to usecases and avoiding duplicate implementations/unused stuff\nReview please", "createdAt": "2020-03-01T17:36:26Z", "url": "https://github.com/ldtteam/minecolonies/pull/4385", "merged": true, "mergeCommit": {"oid": "424a778c33866c96b41457fcaeaaa4974fbf347a"}, "closed": true, "closedAt": "2020-03-07T20:25:34Z", "author": {"login": "someaddons"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcJcoTjAH2gAyMzgyMDcyMDI1OjhjMmZlMWZiN2UzN2E5MTU2NDBmNDM5MDk0ZDljMTE0NjFjZmQ1ZTI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcLaLmVgH2gAyMzgyMDcyMDI1OmU3Y2IyMjgwZWVmM2Q2ZGEwZTI2NzcxOTBkZGE4ODFhNTgxNmM4NWY=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "8c2fe1fb7e37a915640f439094d9c11461cfd5e2", "author": {"user": {"login": "someaddons", "name": null}}, "url": "https://github.com/ldtteam/minecolonies/commit/8c2fe1fb7e37a915640f439094d9c11461cfd5e2", "committedDate": "2020-03-01T17:32:46Z", "message": "Fixes a multitude of inventory issues, from dupes to lost stacks."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY2ODc0MzEz", "url": "https://github.com/ldtteam/minecolonies/pull/4385#pullrequestreview-366874313", "createdAt": "2020-03-01T17:38:16Z", "commit": {"oid": "8c2fe1fb7e37a915640f439094d9c11461cfd5e2"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wMVQxNzozODoxNlrOFwPQfA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wMVQxNzozODoxNlrOFwPQfA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjEyNTk0OA==", "bodyText": "and if we were able to insert a partial stack first and then the rest?\nThis should have worked fine up to now.", "url": "https://github.com/ldtteam/minecolonies/pull/4385#discussion_r386125948", "createdAt": "2020-03-01T17:38:16Z", "author": {"login": "Raycoms"}, "path": "src/api/java/com/minecolonies/api/util/InventoryUtils.java", "diffHunk": "@@ -874,14 +874,27 @@ public static boolean addItemStackToItemHandler(@NotNull final IItemHandler item\n                 slot = itemHandler.getSlots() == 0 ? -1 : 0;\n                 while (!ItemStackUtils.isEmpty(resultStack) && slot != -1 && slot != itemHandler.getSlots())\n                 {\n-                    resultStack = itemHandler.insertItem(slot, resultStack, false);\n+                    resultStack = itemHandler.insertItem(slot, resultStack, true);\n                     if (!ItemStackUtils.isEmpty(resultStack))\n                     {\n                         slot++;\n                     }\n+                    // result empty, we can insert the whole stack", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8c2fe1fb7e37a915640f439094d9c11461cfd5e2"}, "originalPosition": 28}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY2OTc4NDYz", "url": "https://github.com/ldtteam/minecolonies/pull/4385#pullrequestreview-366978463", "createdAt": "2020-03-02T06:50:23Z", "commit": {"oid": "8c2fe1fb7e37a915640f439094d9c11461cfd5e2"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wMlQwNjo1MDoyM1rOFwVBwA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wMlQwNjo1MjoyMFrOFwVDqw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjIyMDQ4MA==", "bodyText": "This is flawed logic. There are inventories from which you can't extract and not insert.", "url": "https://github.com/ldtteam/minecolonies/pull/4385#discussion_r386220480", "createdAt": "2020-03-02T06:50:23Z", "author": {"login": "OrionDevelopment"}, "path": "src/api/java/com/minecolonies/api/util/InventoryUtils.java", "diffHunk": "@@ -874,14 +874,27 @@ public static boolean addItemStackToItemHandler(@NotNull final IItemHandler item\n                 slot = itemHandler.getSlots() == 0 ? -1 : 0;\n                 while (!ItemStackUtils.isEmpty(resultStack) && slot != -1 && slot != itemHandler.getSlots())\n                 {\n-                    resultStack = itemHandler.insertItem(slot, resultStack, false);\n+                    resultStack = itemHandler.insertItem(slot, resultStack, true);\n                     if (!ItemStackUtils.isEmpty(resultStack))\n                     {\n                         slot++;\n                     }\n+                    // result empty, we can insert the whole stack", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjEyNTk0OA=="}, "originalCommit": {"oid": "8c2fe1fb7e37a915640f439094d9c11461cfd5e2"}, "originalPosition": 28}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjIyMDk3MQ==", "bodyText": "You are violating the IITemHandler contract here!\nAlways simulate first before performing any operation", "url": "https://github.com/ldtteam/minecolonies/pull/4385#discussion_r386220971", "createdAt": "2020-03-02T06:52:20Z", "author": {"login": "OrionDevelopment"}, "path": "src/api/java/com/minecolonies/api/util/InventoryUtils.java", "diffHunk": "@@ -1473,7 +1486,7 @@ public static boolean transferItemStackIntoNextFreeSlotInItemHandler(\n                                                                            final int sourceIndex,\n                                                                            @NotNull final IItemHandler targetHandler)\n     {\n-        ItemStack sourceStack = sourceHandler.extractItem(sourceIndex, Integer.MAX_VALUE, true);\n+        ItemStack sourceStack = sourceHandler.extractItem(sourceIndex, Integer.MAX_VALUE, false);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8c2fe1fb7e37a915640f439094d9c11461cfd5e2"}, "originalPosition": 71}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "092678b5c07bd9c33d40fc7e710df115fc3c3c97", "author": {"user": {"login": "someaddons", "name": null}}, "url": "https://github.com/ldtteam/minecolonies/commit/092678b5c07bd9c33d40fc7e710df115fc3c3c97", "committedDate": "2020-03-02T11:58:42Z", "message": "update to simulate first"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e7cb2280eef3d6da0e2677190dda881a5816c85f", "author": {"user": {"login": "Raycoms", "name": null}}, "url": "https://github.com/ldtteam/minecolonies/commit/e7cb2280eef3d6da0e2677190dda881a5816c85f", "committedDate": "2020-03-07T19:49:27Z", "message": "Merge branch 'version/1.15' into inventoryFixes115"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2287, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}