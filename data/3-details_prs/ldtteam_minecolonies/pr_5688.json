{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDc2MzExMDA3", "number": 5688, "title": "Make the miner less likely to get stuck", "bodyText": "Changes proposed in this pull request:\n\nMake getWorkingNode more stable/deterministic\nAdd tracking and validation of rotation\nMake node picking sequential until there are 10 nodes built on a level - this should do at least 2 nodes out from shaft on a new level\n\nReview please", "createdAt": "2020-08-31T13:48:19Z", "url": "https://github.com/ldtteam/minecolonies/pull/5688", "merged": true, "mergeCommit": {"oid": "fa594f96da4ea43a7045997203de3e567e00e0e6"}, "closed": true, "closedAt": "2020-09-01T21:21:10Z", "author": {"login": "Mekle001"}, "timelineItems": {"totalCount": 14, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdETD9NgH2gAyNDc2MzExMDA3Ojg0YTcxZTQ0YTQ1MTRhNmU5YjY2Y2RiOWY3NjI1MTc3ODU1YmFlZGI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdEpyNegH2gAyNDc2MzExMDA3OmExN2E2OGY1NzdmZjk2NmFkYTJhMGZlNTkyODgyOGFlYjhjNWVhODQ=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "84a71e44a4514a6e9b66cdb9f7625177855baedb", "author": {"user": {"login": "Mekle001", "name": "Mike Garlick"}}, "url": "https://github.com/ldtteam/minecolonies/commit/84a71e44a4514a6e9b66cdb9f7625177855baedb", "committedDate": "2020-08-31T13:45:27Z", "message": "Make getActiveNode stable"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "58ecd1485c1f2bd5636bf957e56f32f61d7767f9", "author": {"user": {"login": "Mekle001", "name": "Mike Garlick"}}, "url": "https://github.com/ldtteam/minecolonies/commit/58ecd1485c1f2bd5636bf957e56f32f61d7767f9", "committedDate": "2020-08-31T13:45:27Z", "message": "Add rotation tracking, with validations"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "101d751ec158c64dfea81501a4aca3331a5a036b", "author": {"user": {"login": "Mekle001", "name": "Mike Garlick"}}, "url": "https://github.com/ldtteam/minecolonies/commit/101d751ec158c64dfea81501a4aca3331a5a036b", "committedDate": "2020-08-31T13:45:28Z", "message": "Make node picking less random on new levels"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8f4efa1435d9f611ff6ac3e8ac0eb1c486a6101a", "author": {"user": {"login": "Mekle001", "name": "Mike Garlick"}}, "url": "https://github.com/ldtteam/minecolonies/commit/8f4efa1435d9f611ff6ac3e8ac0eb1c486a6101a", "committedDate": "2020-08-31T15:01:13Z", "message": "Default to undefined node style"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc4OTY3MjQ5", "url": "https://github.com/ldtteam/minecolonies/pull/5688#pullrequestreview-478967249", "createdAt": "2020-08-31T21:27:45Z", "commit": {"oid": "8f4efa1435d9f611ff6ac3e8ac0eb1c486a6101a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0zMVQyMToyNzo0NVrOHKJ0ew==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0zMVQyMToyNzo0NVrOHKJ0ew==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDQwODY5OQ==", "bodyText": "constant please", "url": "https://github.com/ldtteam/minecolonies/pull/5688#discussion_r480408699", "createdAt": "2020-08-31T21:27:45Z", "author": {"login": "Raycoms"}, "path": "src/main/java/com/minecolonies/coremod/entity/ai/citizen/miner/Level.java", "diffHunk": "@@ -194,7 +195,7 @@ public Level(@NotNull final CompoundNBT compound)\n     public Node getRandomNode(@Nullable final Node node)\n     {\n         Node nextNode = null;\n-        if (node != null && rand.nextInt(RANDOM_TYPES) > 0)\n+        if (node != null && getNumberOfBuiltNodes() > 10 && rand.nextInt(RANDOM_TYPES) > 0)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8f4efa1435d9f611ff6ac3e8ac0eb1c486a6101a"}, "originalPosition": 12}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc4OTY3NDIy", "url": "https://github.com/ldtteam/minecolonies/pull/5688#pullrequestreview-478967422", "createdAt": "2020-08-31T21:28:04Z", "commit": {"oid": "8f4efa1435d9f611ff6ac3e8ac0eb1c486a6101a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0zMVQyMToyODowNFrOHKJ1Eg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0zMVQyMToyODowNFrOHKJ1Eg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDQwODg1MA==", "bodyText": "I'd say .error -> Please tell the mod authors about this.", "url": "https://github.com/ldtteam/minecolonies/pull/5688#discussion_r480408850", "createdAt": "2020-08-31T21:28:04Z", "author": {"login": "Raycoms"}, "path": "src/main/java/com/minecolonies/coremod/entity/ai/citizen/miner/Level.java", "diffHunk": "@@ -230,6 +231,9 @@ public void closeNextNode(final int rotation, final Node node)\n                 nodeCenterList.add(getNextNodePositionFromNodeWithRotation(tempNode, rotation, ROTATE_ONCE));\n                 nodeCenterList.add(getNextNodePositionFromNodeWithRotation(tempNode, rotation, ROTATE_THREE_TIMES));\n                 break;\n+            case UNDEFINED:\n+                Log.getLogger().warn(\"Node: \" + node.getX() + \":\" + node.getZ() +\" style undefined, not creating children\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8f4efa1435d9f611ff6ac3e8ac0eb1c486a6101a"}, "originalPosition": 21}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc4OTY3NTUy", "url": "https://github.com/ldtteam/minecolonies/pull/5688#pullrequestreview-478967552", "createdAt": "2020-08-31T21:28:17Z", "commit": {"oid": "8f4efa1435d9f611ff6ac3e8ac0eb1c486a6101a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0zMVQyMToyODoxN1rOHKJ1XA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0zMVQyMToyODoxN1rOHKJ1XA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDQwODkyNA==", "bodyText": "same here potentially", "url": "https://github.com/ldtteam/minecolonies/pull/5688#discussion_r480408924", "createdAt": "2020-08-31T21:28:17Z", "author": {"login": "Raycoms"}, "path": "src/main/java/com/minecolonies/coremod/entity/ai/citizen/miner/Level.java", "diffHunk": "@@ -245,8 +249,14 @@ public void closeNextNode(final int rotation, final Node node)\n             nodes.put(pos, tempNodeToAdd);\n             openNodes.add(tempNodeToAdd);\n         }\n-        nodes.get(new Vec2i(tempNode.getX(), tempNode.getZ())).setStatus(Node.NodeStatus.COMPLETED);\n+        Node I = nodes.get(new Vec2i(tempNode.getX(), tempNode.getZ()));\n+        if(!tempNode.equals(I))\n+        {\n+            Log.getLogger().warn(\"Nodes not equal during close\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8f4efa1435d9f611ff6ac3e8ac0eb1c486a6101a"}, "originalPosition": 34}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc4OTY3NzEw", "url": "https://github.com/ldtteam/minecolonies/pull/5688#pullrequestreview-478967710", "createdAt": "2020-08-31T21:28:33Z", "commit": {"oid": "8f4efa1435d9f611ff6ac3e8ac0eb1c486a6101a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0zMVQyMToyODozM1rOHKJ13w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0zMVQyMToyODozM1rOHKJ13w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDQwOTA1NQ==", "bodyText": "wrong logger", "url": "https://github.com/ldtteam/minecolonies/pull/5688#discussion_r480409055", "createdAt": "2020-08-31T21:28:33Z", "author": {"login": "Raycoms"}, "path": "src/main/java/com/minecolonies/coremod/entity/ai/citizen/miner/Node.java", "diffHunk": "@@ -127,9 +139,18 @@ public static Node createFromNBT(@NotNull final CompoundNBT compound)\n \n         //Set the node status in all directions.\n         @NotNull final Node node = new Node(x, z, parent);\n+        if(style == NodeType.UNDEFINED)\n+        {\n+            com.ldtteam.blockout.Log.getLogger().warn(\"Node \" + x + \",\" + z + \" has an undefined style\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8f4efa1435d9f611ff6ac3e8ac0eb1c486a6101a"}, "originalPosition": 65}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc4OTY3Nzc5", "url": "https://github.com/ldtteam/minecolonies/pull/5688#pullrequestreview-478967779", "createdAt": "2020-08-31T21:28:40Z", "commit": {"oid": "8f4efa1435d9f611ff6ac3e8ac0eb1c486a6101a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0zMVQyMToyODo0MFrOHKJ2FQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0zMVQyMToyODo0MFrOHKJ2FQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDQwOTEwOQ==", "bodyText": "javadoc", "url": "https://github.com/ldtteam/minecolonies/pull/5688#discussion_r480409109", "createdAt": "2020-08-31T21:28:40Z", "author": {"login": "Raycoms"}, "path": "src/main/java/com/minecolonies/coremod/entity/ai/citizen/miner/Node.java", "diffHunk": "@@ -367,6 +393,18 @@ public int hashCode()\n         //Crossroad structure\n         CROSSROAD,\n         //Bending tunnle\n-        BEND\n+        BEND,\n+        //New node, undefined\n+        UNDEFINED\n+    }\n+\n+    public Optional<Integer> getRot()\n+    {\n+        return rot;\n+    }\n+\n+    public void setRot(int rot)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8f4efa1435d9f611ff6ac3e8ac0eb1c486a6101a"}, "originalPosition": 105}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f43ab36fb4d1921a0ee80abecdace5ab6a8145e0", "author": {"user": {"login": "Mekle001", "name": "Mike Garlick"}}, "url": "https://github.com/ldtteam/minecolonies/commit/f43ab36fb4d1921a0ee80abecdace5ab6a8145e0", "committedDate": "2020-08-31T22:08:25Z", "message": "Review Feedback"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f0b1ce52f65d5bfaaa6980e3913d40e9082021f2", "author": {"user": {"login": "Mekle001", "name": "Mike Garlick"}}, "url": "https://github.com/ldtteam/minecolonies/commit/f0b1ce52f65d5bfaaa6980e3913d40e9082021f2", "committedDate": "2020-09-01T15:12:47Z", "message": "Merge branch 'version/1.15' into miner/stableworkingnode"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "185242554ef257aef258da28f7d3b39061cd7185", "author": {"user": {"login": "Mekle001", "name": "Mike Garlick"}}, "url": "https://github.com/ldtteam/minecolonies/commit/185242554ef257aef258da28f7d3b39061cd7185", "committedDate": "2020-09-01T15:34:43Z", "message": "Small optimization"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc5OTEwMDA5", "url": "https://github.com/ldtteam/minecolonies/pull/5688#pullrequestreview-479910009", "createdAt": "2020-09-01T16:13:35Z", "commit": {"oid": "185242554ef257aef258da28f7d3b39061cd7185"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a17a68f577ff966ada2a0fe5928828aeb8c5ea84", "author": {"user": {"login": "someaddons", "name": null}}, "url": "https://github.com/ldtteam/minecolonies/commit/a17a68f577ff966ada2a0fe5928828aeb8c5ea84", "committedDate": "2020-09-01T16:13:53Z", "message": "Merge branch 'version/1.15' into miner/stableworkingnode"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1896, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}