{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDc1NTc1NDc5", "number": 5669, "title": "Add auto-hire from training centers", "bodyText": "Changes proposed in this pull request:\n\nGuard towers will now attempt to hire the best from the respective training centers before hiring unemployed\nThere is a new button in the Guard towers to turn off trainee hiring, it defaults to on.\nTraining centers are now 'homes' for their workers\nAdded bed registration to training centers, though not all schematics have beds yet.\n\nReview please", "createdAt": "2020-08-28T18:27:57Z", "url": "https://github.com/ldtteam/minecolonies/pull/5669", "merged": true, "mergeCommit": {"oid": "3f363c38ff678db48add3423e5a11d92190c30c5"}, "closed": true, "closedAt": "2020-08-29T18:01:53Z", "author": {"login": "Mekle001"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdDZRi-AH2gAyNDc1NTc1NDc5OjllOWU0MWM5NmQxZjk2MjlhYjFmNDVjY2RiMTcyMWE3NTk5MjVhYTk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdDteTTAH2gAyNDc1NTc1NDc5OmFkMzllZWVlZGY3YTdhNTNlMjdiY2RiNzk3MjhiZjhkMDRjMTk5Mjg=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "9e9e41c96d1f9629ab1f45ccdb1721a759925aa9", "author": {"user": {"login": "Mekle001", "name": "Mike Garlick"}}, "url": "https://github.com/ldtteam/minecolonies/commit/9e9e41c96d1f9629ab1f45ccdb1721a759925aa9", "committedDate": "2020-08-28T18:25:48Z", "message": "Add auto-hire from training centers"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc3OTgwMDc1", "url": "https://github.com/ldtteam/minecolonies/pull/5669#pullrequestreview-477980075", "createdAt": "2020-08-28T19:36:19Z", "commit": {"oid": "9e9e41c96d1f9629ab1f45ccdb1721a759925aa9"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOFQxOTozNjoxOVrOHJSRkg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOFQxOTozNjoxOVrOHJSRkg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTQ5ODY0Mg==", "bodyText": "actually you can do the whole find of job + find best skill logic with one single loop instead, that should be a lot better performance wise, since you only need to find the best skilled one", "url": "https://github.com/ldtteam/minecolonies/pull/5669#discussion_r479498642", "createdAt": "2020-08-28T19:36:19Z", "author": {"login": "someaddons"}, "path": "src/main/java/com/minecolonies/coremod/colony/buildings/AbstractBuildingGuards.java", "diffHunk": "@@ -454,7 +470,38 @@ public PlayerEntity getPlayerToFollowOrRally()\n     @Override\n     public void onColonyTick(@NotNull final IColony colony)\n     {\n-        super.onColonyTick(colony);\n+\n+        // If we have no active worker, attempt to grab one from the appropriate trainer\n+        if (hireTrainees && !isFull() && ((getBuildingLevel() > 0 && isBuilt()))\n+              && (this.getHiringMode() == HiringMode.DEFAULT && !this.getColony().isManualHiring() || this.getHiringMode() == HiringMode.AUTO))\n+        {\n+            List<ICitizenData> trainingCitizens = null;\n+            \n+            if(this.getGuardType() == ModGuardTypes.ranger)\n+            {\n+                trainingCitizens = colony.getCitizenManager().getCitizens().stream().filter(x -> x.getJob() instanceof JobArcherTraining).collect(Collectors.toList());\n+            }\n+            else if (this.getGuardType() == ModGuardTypes.knight)\n+            {\n+                trainingCitizens = colony.getCitizenManager().getCitizens().stream().filter(x -> x.getJob() instanceof JobCombatTraining).collect(Collectors.toList());\n+            }\n+\n+            if(trainingCitizens != null && !trainingCitizens.isEmpty())\n+            {\n+                Comparator<ICitizenData> skillComparator = Comparator.comparingInt(e -> e.getCitizenSkillHandler().getLevel(job.getPrimarySkill()));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9e9e41c96d1f9629ab1f45ccdb1721a759925aa9"}, "originalPosition": 105}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3e1d020379b158354e2d97f0025e17be56f2a5a4", "author": {"user": {"login": "Mekle001", "name": "Mike Garlick"}}, "url": "https://github.com/ldtteam/minecolonies/commit/3e1d020379b158354e2d97f0025e17be56f2a5a4", "committedDate": "2020-08-28T20:36:48Z", "message": "Add training facilities to max citizens"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "04a13683a58922ecfaa29716c444d712c861359f", "author": {"user": {"login": "Mekle001", "name": "Mike Garlick"}}, "url": "https://github.com/ldtteam/minecolonies/commit/04a13683a58922ecfaa29716c444d712c861359f", "committedDate": "2020-08-28T20:37:04Z", "message": "Review Feedback"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc4MDY1MDA2", "url": "https://github.com/ldtteam/minecolonies/pull/5669#pullrequestreview-478065006", "createdAt": "2020-08-28T23:02:01Z", "commit": {"oid": "04a13683a58922ecfaa29716c444d712c861359f"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ad39eeeedf7a7a53e27bcdb79728bf8d04c19928", "author": {"user": {"login": "Mekle001", "name": "Mike Garlick"}}, "url": "https://github.com/ldtteam/minecolonies/commit/ad39eeeedf7a7a53e27bcdb79728bf8d04c19928", "committedDate": "2020-08-29T17:57:50Z", "message": "Javadoc"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1894, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}