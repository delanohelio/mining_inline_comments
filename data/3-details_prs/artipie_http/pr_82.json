{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg5NzI3ODQy", "number": 82, "title": "Synchronisation improvements", "bodyText": "This pull request resolves #67", "createdAt": "2020-03-17T09:42:16Z", "url": "https://github.com/artipie/http/pull/82", "merged": true, "mergeCommit": {"oid": "ac23b6bc3e9a63dbd1e6026112e9345cf5f2462a"}, "closed": true, "closedAt": "2020-03-18T08:49:08Z", "author": {"login": "Sammers21"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcOfc45AH2gAyMzg5NzI3ODQyOmU2MTE3MTg0ZTY1NjBhY2ZhZWJhZGQxNWVkODIzMmJkOTlkZjFjMzE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcOy3q-gFqTM3NjY0MjIxNQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "e6117184e6560acfaebadd15ed8232bd99df1c31", "author": {"user": {"login": "Sammers21", "name": "Pavel Drankov"}}, "url": "https://github.com/artipie/http/commit/e6117184e6560acfaebadd15ed8232bd99df1c31", "committedDate": "2020-03-17T09:39:38Z", "message": "proper synchronization"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "03d7e2bf2c60e48adb497dd0aa4771570fca5692", "author": {"user": {"login": "Sammers21", "name": "Pavel Drankov"}}, "url": "https://github.com/artipie/http/commit/03d7e2bf2c60e48adb497dd0aa4771570fca5692", "committedDate": "2020-03-17T09:41:02Z", "message": "remove resolved puzzle"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "103b7617f325aca15935280fced2cecaade47b3d", "author": {"user": {"login": "Sammers21", "name": "Pavel Drankov"}}, "url": "https://github.com/artipie/http/commit/103b7617f325aca15935280fced2cecaade47b3d", "committedDate": "2020-03-17T09:22:44Z", "message": "introduce up and down syncs"}, "afterCommit": {"oid": "03d7e2bf2c60e48adb497dd0aa4771570fca5692", "author": {"user": {"login": "Sammers21", "name": "Pavel Drankov"}}, "url": "https://github.com/artipie/http/commit/03d7e2bf2c60e48adb497dd0aa4771570fca5692", "committedDate": "2020-03-17T09:41:02Z", "message": "remove resolved puzzle"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc2NTk5NzQx", "url": "https://github.com/artipie/http/pull/82#pullrequestreview-376599741", "createdAt": "2020-03-18T06:49:53Z", "commit": {"oid": "03d7e2bf2c60e48adb497dd0aa4771570fca5692"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOFQwNjo0OTo1NFrOF34F3Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOFQwNjo0OTo1NFrOF34F3Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDEzNTAwNQ==", "bodyText": "@Sammers21 do we need synchronization on throwing exception?", "url": "https://github.com/artipie/http/pull/82#discussion_r394135005", "createdAt": "2020-03-18T06:49:54Z", "author": {"login": "Vatavuk"}, "path": "src/main/java/com/artipie/http/stream/ByteByByteSplit.java", "diffHunk": "@@ -144,13 +152,17 @@ public void subscribe(final Subscriber<? super Publisher<ByteBuffer>> sub) {\n             new Subscription() {\n                 @Override\n                 public void request(final long ask) {\n-                    ByteByByteSplit.this.downDemand.updateAndGet(operand -> operand + ask);\n-                    ByteByByteSplit.this.upstream.get().get().request(ask);\n+                    synchronized (ByteByByteSplit.this.downSync) {\n+                        ByteByByteSplit.this.downDemand.updateAndGet(operand -> operand + ask);\n+                        ByteByByteSplit.this.upstream.get().get().request(ask);\n+                    }\n                 }\n \n                 @Override\n                 public void cancel() {\n-                    throw new IllegalStateException(\"Cancel is not allowed\");\n+                    synchronized (ByteByByteSplit.this.downSync) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "03d7e2bf2c60e48adb497dd0aa4771570fca5692"}, "originalPosition": 59}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc2NjQyMjE1", "url": "https://github.com/artipie/http/pull/82#pullrequestreview-376642215", "createdAt": "2020-03-18T08:17:05Z", "commit": {"oid": "03d7e2bf2c60e48adb497dd0aa4771570fca5692"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3135, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}