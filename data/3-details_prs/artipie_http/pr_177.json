{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM0NTIyMDQy", "number": 177, "title": "Response content-length headers", "bodyText": "#176 - added Content-Length headers to RsWithBody", "createdAt": "2020-06-15T12:55:32Z", "url": "https://github.com/artipie/http/pull/177", "merged": true, "mergeCommit": {"oid": "b2beaafd03aa0fd4aeeda70505c5ee66a3d29730"}, "closed": true, "closedAt": "2020-06-25T08:50:24Z", "author": {"login": "g4s8"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcrgLKlgH2gAyNDM0NTIyMDQyOjY5ZGI4ZTU3NmRkZGZmNDE3YjhiZWIzOGU3YmRkZWYzN2E2ODRkMmM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcup0i7AH2gAyNDM0NTIyMDQyOjY2ODk4MzU3MzdlOGNkMThhYTUxNmI5ZTNhZjQ4NzYwNjdkM2Q0MmQ=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "69db8e576dddff417b8beb38e7bddef37a684d2c", "author": {"user": {"login": "g4s8", "name": "Kirill"}}, "url": "https://github.com/artipie/http/commit/69db8e576dddff417b8beb38e7bddef37a684d2c", "committedDate": "2020-06-15T12:53:59Z", "message": "#176 - response content-size headers"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d3134ea75fcf4ab89114cca952e3c7d3a9edb485", "author": {"user": {"login": "g4s8", "name": "Kirill"}}, "url": "https://github.com/artipie/http/commit/d3134ea75fcf4ab89114cca952e3c7d3a9edb485", "committedDate": "2020-06-23T09:32:09Z", "message": "Merge branch 'master' into 176"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM1NjM5MDc5", "url": "https://github.com/artipie/http/pull/177#pullrequestreview-435639079", "createdAt": "2020-06-23T10:12:43Z", "commit": {"oid": "d3134ea75fcf4ab89114cca952e3c7d3a9edb485"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yM1QxMDoxMjo0NFrOGnioPg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yM1QxMDoxNToyNVrOGnit7g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDExNTAwNg==", "bodyText": "@g4s8 I'd suggest to keep RsWithHeaders.ConWithHeaders private and implement this method by wrapping this.origin into RsWithHeaders", "url": "https://github.com/artipie/http/pull/177#discussion_r444115006", "createdAt": "2020-06-23T10:12:44Z", "author": {"login": "olegmoz"}, "path": "src/main/java/com/artipie/http/rs/RsWithBody.java", "diffHunk": "@@ -94,18 +96,47 @@ public RsWithBody(final Publisher<ByteBuffer> body) {\n     }\n \n     /**\n-     * Decorates origin response body with publisher.\n-     * @param origin Response\n+     * Response with body from publisher.\n+     * @param origin Origin response\n      * @param body Publisher\n      */\n     public RsWithBody(final Response origin, final Publisher<ByteBuffer> body) {\n+        this(origin, new Content.From(body));\n+    }\n+\n+    /**\n+     * Decorates origin response body with content.\n+     * @param origin Response\n+     * @param body Content\n+     */\n+    public RsWithBody(final Response origin, final Content body) {\n         this.origin = origin;\n         this.body = body;\n     }\n \n     @Override\n     public CompletionStage<Void> send(final Connection con) {\n-        return this.origin.send(new RsWithBody.ConWithBody(con, this.body));\n+        return this.origin.send(\n+            new RsWithBody.ConWithBody(\n+                this.body.size()\n+                    .map(size -> RsWithBody.withSize(con, size))\n+                    .orElse(con),\n+                this.body\n+            )\n+        );", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d3134ea75fcf4ab89114cca952e3c7d3a9edb485"}, "originalPosition": 70}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDExNjQ2Mg==", "bodyText": "@g4s8 this new feature of is not tested, it would be great to add tests for RsWithBody class to check that header is sent to connection if Content has size specified", "url": "https://github.com/artipie/http/pull/177#discussion_r444116462", "createdAt": "2020-06-23T10:15:25Z", "author": {"login": "olegmoz"}, "path": "src/main/java/com/artipie/http/rs/RsWithBody.java", "diffHunk": "@@ -94,18 +96,47 @@ public RsWithBody(final Publisher<ByteBuffer> body) {\n     }\n \n     /**\n-     * Decorates origin response body with publisher.\n-     * @param origin Response\n+     * Response with body from publisher.\n+     * @param origin Origin response\n      * @param body Publisher\n      */\n     public RsWithBody(final Response origin, final Publisher<ByteBuffer> body) {\n+        this(origin, new Content.From(body));\n+    }\n+\n+    /**\n+     * Decorates origin response body with content.\n+     * @param origin Response\n+     * @param body Content\n+     */\n+    public RsWithBody(final Response origin, final Content body) {\n         this.origin = origin;\n         this.body = body;\n     }\n \n     @Override\n     public CompletionStage<Void> send(final Connection con) {\n-        return this.origin.send(new RsWithBody.ConWithBody(con, this.body));\n+        return this.origin.send(\n+            new RsWithBody.ConWithBody(\n+                this.body.size()\n+                    .map(size -> RsWithBody.withSize(con, size))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d3134ea75fcf4ab89114cca952e3c7d3a9edb485"}, "originalPosition": 66}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d8ec2b784f5881bcd2fed641a62d801ab9c4e6d8", "author": {"user": {"login": "g4s8", "name": "Kirill"}}, "url": "https://github.com/artipie/http/commit/d8ec2b784f5881bcd2fed641a62d801ab9c4e6d8", "committedDate": "2020-06-23T13:43:41Z", "message": "#176 - review fixes"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM1OTY1MTgw", "url": "https://github.com/artipie/http/pull/177#pullrequestreview-435965180", "createdAt": "2020-06-23T16:43:24Z", "commit": {"oid": "d8ec2b784f5881bcd2fed641a62d801ab9c4e6d8"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6689835737e8cd18aa516b9e3af4876067d3d42d", "author": {"user": {"login": "g4s8", "name": "Kirill"}}, "url": "https://github.com/artipie/http/commit/6689835737e8cd18aa516b9e3af4876067d3d42d", "committedDate": "2020-06-25T07:50:06Z", "message": "#176 - coverage ratios"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3218, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}