{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDcxNzEwNDE4", "number": 196, "title": "Copier context", "bodyText": "Fixes #195\nThis PR introduces a CopierContext class to hold the values that were being passed to the CopierFactory before, and then adds a TableReplication to this which in turns holds the additional values that were requested in the issue (source database and table names). This allows us to add more values to CopierContext in the past without breaking backwards compatibility which is the situation we're currently in due to the interface methods directly containing the values as arguments.\nThe changes in this PR are currently backwards-compatible by using a default method in the CopierFactory interface but I'll add some comments on this as another option would be to make a backwards incompatible change as it's quite easy to resolve downstream.", "createdAt": "2020-08-21T15:47:39Z", "url": "https://github.com/ExpediaGroup/circus-train/pull/196", "merged": true, "mergeCommit": {"oid": "6c45be940955a761a4c4e4e12457fc9e9ad5a7f1"}, "closed": true, "closedAt": "2020-08-25T07:45:26Z", "author": {"login": "massdosage"}, "timelineItems": {"totalCount": 15, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdAKFmQAH2gAyNDcxNzEwNDE4OmIzMmFiZDJlZDgzMDUwZDEyMTk3MTA3NDdlNzJlN2U0MTlhY2RjYzA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdCSQvyAH2gAyNDcxNzEwNDE4OmJmYmMxMDBhM2RhNWZhMmU2YzBhZTUzNWM5MzE3NjI4ZTUyM2FmMDE=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "b32abd2ed83050d1219710747e72e7e419acdcc0", "author": {"user": {"login": "massdosage", "name": "Adrian Woodhead"}}, "url": "https://github.com/ExpediaGroup/circus-train/commit/b32abd2ed83050d1219710747e72e7e419acdcc0", "committedDate": "2020-08-18T17:02:24Z", "message": "rough cut at possibilities for using a CopierContext"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3554609f4b3d7745a750a50aa7e75c610037b41f", "author": {"user": {"login": "massdosage", "name": "Adrian Woodhead"}}, "url": "https://github.com/ExpediaGroup/circus-train/commit/3554609f4b3d7745a750a50aa7e75c610037b41f", "committedDate": "2020-08-18T17:04:32Z", "message": "remove unused local variables"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3ace077c655b965f3e83c680f89704b3991a1e06", "author": {"user": {"login": "massdosage", "name": "Adrian Woodhead"}}, "url": "https://github.com/ExpediaGroup/circus-train/commit/3ace077c655b965f3e83c680f89704b3991a1e06", "committedDate": "2020-08-20T17:00:45Z", "message": "* use a default method for backwards compatibility (maybe only\ntemporarily to get test code compiling quicker)\n* WIP on tests passing"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "06118ae72c71c8201ecc83e2d9f780e2b5956160", "author": {"user": {"login": "massdosage", "name": "Adrian Woodhead"}}, "url": "https://github.com/ExpediaGroup/circus-train/commit/06118ae72c71c8201ecc83e2d9f780e2b5956160", "committedDate": "2020-08-21T14:58:15Z", "message": "more tests now passing"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "188394cd06adad93227f27ccf970043b03c9dfde", "author": {"user": {"login": "massdosage", "name": "Adrian Woodhead"}}, "url": "https://github.com/ExpediaGroup/circus-train/commit/188394cd06adad93227f27ccf970043b03c9dfde", "committedDate": "2020-08-21T15:02:18Z", "message": "remove todos"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ca8599c37c246da4d0b471186cc13bfb1cd923d1", "author": {"user": {"login": "massdosage", "name": "Adrian Woodhead"}}, "url": "https://github.com/ExpediaGroup/circus-train/commit/ca8599c37c246da4d0b471186cc13bfb1cd923d1", "committedDate": "2020-08-21T15:42:17Z", "message": "fix failing integration tests"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDcyNjAyNjg5", "url": "https://github.com/ExpediaGroup/circus-train/pull/196#pullrequestreview-472602689", "createdAt": "2020-08-21T15:49:36Z", "commit": {"oid": "ca8599c37c246da4d0b471186cc13bfb1cd923d1"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMVQxNTo0OTozNlrOHEyadQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMVQxNTo0OTozNlrOHEyadQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDc4MjMyNQ==", "bodyText": "Instead of deprecating these we could remove them and then just have the method above and clearly document in the CHANGELOG what the required change is for this. It's basically just updating any custom CopierFactory implementations to implement the new method and pull the values they need out of the CopierContext instead of having them passed as method arguments. Thoughts?", "url": "https://github.com/ExpediaGroup/circus-train/pull/196#discussion_r474782325", "createdAt": "2020-08-21T15:49:36Z", "author": {"login": "massdosage"}, "path": "circus-train-api/src/main/java/com/hotels/bdp/circustrain/api/copier/CopierFactory.java", "diffHunk": "@@ -25,13 +25,28 @@\n   boolean supportsSchemes(String sourceScheme, String replicaScheme);\n \n   /**\n+   * Creates a new Copier.\n+   * \n+   * @param copierContext Context object containing configuration values for the Copier.\n+   * @return\n+   */\n+  default Copier newInstance(CopierContext copierContext) {\n+    //TODO: this is only here for backwards compatibility with CopierFactorys using older versions of Circus Train, when the below\n+    //deprecated methods are removed so should this default implementation\n+    return newInstance(copierContext.getEventId(), copierContext.getSourceBaseLocation(), copierContext.getSourceSubLocations(), copierContext.getReplicaLocation(), \n+        copierContext.getCopierOptions());\n+  }\n+\n+  /**\n+   * @deprecated As of release 16.3.0, replaced by {@link #newInstance(CopierContext)}.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ca8599c37c246da4d0b471186cc13bfb1cd923d1"}, "originalPosition": 24}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDczMzAwMjI0", "url": "https://github.com/ExpediaGroup/circus-train/pull/196#pullrequestreview-473300224", "createdAt": "2020-08-24T09:44:23Z", "commit": {"oid": "ca8599c37c246da4d0b471186cc13bfb1cd923d1"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNFQwOTo0NDoyM1rOHFc0Ag==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNFQwOTo0NDoyM1rOHFc0Ag==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTQ3Njk5NA==", "bodyText": "Nice simplification.", "url": "https://github.com/ExpediaGroup/circus-train/pull/196#discussion_r475476994", "createdAt": "2020-08-24T09:44:23Z", "author": {"login": "nvitucci"}, "path": "circus-train-core/src/main/java/com/hotels/bdp/circustrain/core/ReplicationFactoryImpl.java", "diffHunk": "@@ -134,29 +124,25 @@ private Replication createPartitionedTableReplication(\n   private Replication createUnpartitionedTableReplication(\n       TableReplication tableReplication,\n       Source source,\n-      Replica replica,\n-      String sourceDatabaseName,\n-      String sourceTableName,\n-      String replicaDatabaseName,\n-      String replicaTableName,\n-      String replicaTableLocation) {\n+      Replica replica) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ca8599c37c246da4d0b471186cc13bfb1cd923d1"}, "originalPosition": 77}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDczMzExNjkx", "url": "https://github.com/ExpediaGroup/circus-train/pull/196#pullrequestreview-473311691", "createdAt": "2020-08-24T10:01:10Z", "commit": {"oid": "ca8599c37c246da4d0b471186cc13bfb1cd923d1"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDczMzE0MDUz", "url": "https://github.com/ExpediaGroup/circus-train/pull/196#pullrequestreview-473314053", "createdAt": "2020-08-24T10:04:48Z", "commit": {"oid": "ca8599c37c246da4d0b471186cc13bfb1cd923d1"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNFQxMDowNDo0OFrOHFdgEg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNFQxMDowNDo0OFrOHFdgEg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTQ4ODI3NA==", "bodyText": "thoughts on making this immutable? Is there a risk of a copier accidentally change one of these fields which might affect further copiers in the chain?", "url": "https://github.com/ExpediaGroup/circus-train/pull/196#discussion_r475488274", "createdAt": "2020-08-24T10:04:48Z", "author": {"login": "patduin"}, "path": "circus-train-api/src/main/java/com/hotels/bdp/circustrain/api/copier/CopierContext.java", "diffHunk": "@@ -0,0 +1,107 @@\n+/**\n+ * Copyright (C) 2016-2020 Expedia, Inc.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package com.hotels.bdp.circustrain.api.copier;\n+\n+import java.util.Collections;\n+import java.util.List;\n+import java.util.Map;\n+\n+import org.apache.hadoop.fs.Path;\n+\n+import com.hotels.bdp.circustrain.api.conf.TableReplication;\n+\n+public class CopierContext {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ca8599c37c246da4d0b471186cc13bfb1cd923d1"}, "originalPosition": 26}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cf29415cfb170fc9a82cdd111f78e27ca8a2da18", "author": {"user": {"login": "massdosage", "name": "Adrian Woodhead"}}, "url": "https://github.com/ExpediaGroup/circus-train/commit/cf29415cfb170fc9a82cdd111f78e27ca8a2da18", "committedDate": "2020-08-24T13:26:25Z", "message": "make CopierContext immutable"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4599ca882d52ffda46a3e892feb782ca9c22fe5c", "author": {"user": {"login": "massdosage", "name": "Adrian Woodhead"}}, "url": "https://github.com/ExpediaGroup/circus-train/commit/4599ca882d52ffda46a3e892feb782ca9c22fe5c", "committedDate": "2020-08-24T13:39:12Z", "message": "set target version number to 16.3.0"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDczNTI0NDk4", "url": "https://github.com/ExpediaGroup/circus-train/pull/196#pullrequestreview-473524498", "createdAt": "2020-08-24T14:08:19Z", "commit": {"oid": "cf29415cfb170fc9a82cdd111f78e27ca8a2da18"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d4b10239d8c64457ad070d1e32a84c0dc084002d", "author": {"user": {"login": "massdosage", "name": "Adrian Woodhead"}}, "url": "https://github.com/ExpediaGroup/circus-train/commit/d4b10239d8c64457ad070d1e32a84c0dc084002d", "committedDate": "2020-08-24T14:11:15Z", "message": "made final"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bfbc100a3da5fa2e6c0ae535c9317628e523af01", "author": {"user": {"login": "massdosage", "name": "Adrian Woodhead"}}, "url": "https://github.com/ExpediaGroup/circus-train/commit/bfbc100a3da5fa2e6c0ae535c9317628e523af01", "committedDate": "2020-08-25T07:41:40Z", "message": "revert mistake"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3829, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}