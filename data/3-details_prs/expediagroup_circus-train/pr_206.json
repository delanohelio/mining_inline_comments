{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE4NTExMzkw", "number": 206, "title": "Fixed issue on rename", "bodyText": "", "createdAt": "2020-11-10T14:03:36Z", "url": "https://github.com/ExpediaGroup/circus-train/pull/206", "merged": true, "mergeCommit": {"oid": "b985c2350a474bb4feb0e32986b4466926cdfa16"}, "closed": true, "closedAt": "2020-11-20T09:22:52Z", "author": {"login": "patduin"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdbJ1hoAH2gAyNTE4NTExMzkwOjBmNDAyN2ZlZWYzY2Y5NzA3MzFmOGRjYTVjNjIwODczYTQzOGI3MjM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdeT2RFAFqTUzNTI1NTg3Nw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "0f4027feef3cf970731f8dca5c620873a438b723", "author": {"user": null}, "url": "https://github.com/ExpediaGroup/circus-train/commit/0f4027feef3cf970731f8dca5c620873a438b723", "committedDate": "2020-11-10T14:00:48Z", "message": "Fixed issue on rename"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI3MjMzMTA5", "url": "https://github.com/ExpediaGroup/circus-train/pull/206#pullrequestreview-527233109", "createdAt": "2020-11-10T14:04:46Z", "commit": {"oid": "0f4027feef3cf970731f8dca5c620873a438b723"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQxNDowNDo0N1rOHweCkQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQxNDowNDo0N1rOHweCkQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDU4NTg3Mw==", "bodyText": "these test were wrong cause the \"test\" table object was injected into the real code and then mutated so the test weren't testing what they thought they were testing. Was never failing.", "url": "https://github.com/ExpediaGroup/circus-train/pull/206#discussion_r520585873", "createdAt": "2020-11-10T14:04:47Z", "author": {"login": "patduin"}, "path": "circus-train-core/src/test/java/com/hotels/bdp/circustrain/core/replica/hive/RenameTableOperationTest.java", "diffHunk": "@@ -55,8 +55,8 @@ public void setUp() throws TException {\n     toTable.setTableName(TO_TABLE_NAME);\n     fromTable.setDbName(FROM_DB_NAME);\n     toTable.setDbName(TO_DB_NAME);\n-    when(client.getTable(FROM_DB_NAME, FROM_TABLE_NAME)).thenReturn(fromTable);\n-    when(client.getTable(TO_DB_NAME, TO_TABLE_NAME)).thenReturn(toTable);\n+    when(client.getTable(FROM_DB_NAME, FROM_TABLE_NAME)).thenReturn(new Table(fromTable));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0f4027feef3cf970731f8dca5c620873a438b723"}, "originalPosition": 17}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI3MjQ2NTIw", "url": "https://github.com/ExpediaGroup/circus-train/pull/206#pullrequestreview-527246520", "createdAt": "2020-11-10T14:18:14Z", "commit": {"oid": "0f4027feef3cf970731f8dca5c620873a438b723"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQxNDoxODoxNFrOHwepgA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQxNDoyMDo0MFrOHwexAA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDU5NTg0MA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                      .info(\"Alter table {}.{} to {}.{}\", toTable.getDbName(), toTableName, toTable.getDbName(),\n          \n          \n            \n                      .info(\"Renaming table {}.{} to {}.{}\", toTable.getDbName(), toTableName, toTable.getDbName(),", "url": "https://github.com/ExpediaGroup/circus-train/pull/206#discussion_r520595840", "createdAt": "2020-11-10T14:18:14Z", "author": {"login": "massdosage"}, "path": "circus-train-core/src/main/java/com/hotels/bdp/circustrain/core/replica/hive/RenameTableOperation.java", "diffHunk": "@@ -40,20 +40,27 @@ public RenameTableOperation(DropTableService dropTableService) {\n    * renamed.\n    */\n   public void execute(CloseableMetaStoreClient client, Table from, Table to) throws Exception {\n-    LOG\n-        .info(\"Renaming table {}.{} to {}.{}\", from.getDbName(), from.getTableName(), to.getDbName(),\n-            to.getTableName());\n+    LOG.info(\"Renaming table {}.{} to {}.{}\", from.getDbName(), from.getTableName(), to.getDbName(), to.getTableName());\n     Table fromTable = client.getTable(from.getDbName(), from.getTableName());\n     Table toTable = client.getTable(to.getDbName(), to.getTableName());\n+    String fromDatabaseName = fromTable.getDbName();\n     String fromTableName = fromTable.getTableName();\n     String toTableName = toTable.getTableName();\n     String toDelete = toTableName + DELETE_ME;\n     try {\n+      fromTable.setDbName(toTable.getDbName());\n       fromTable.setTableName(toTableName);\n       toTable.setTableName(toDelete);\n+      LOG\n+          .info(\"Alter table {}.{} to {}.{}\", toTable.getDbName(), toTableName, toTable.getDbName(),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0f4027feef3cf970731f8dca5c620873a438b723"}, "originalPosition": 28}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDU5NjAyMA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                      .info(\"Alter table {}.{} to {}.{}\", fromDatabaseName, fromTableName, fromTable.getDbName(),\n          \n          \n            \n                      .info(\"Renamed table {}.{} to {}.{}\", fromDatabaseName, fromTableName, fromTable.getDbName(),", "url": "https://github.com/ExpediaGroup/circus-train/pull/206#discussion_r520596020", "createdAt": "2020-11-10T14:18:28Z", "author": {"login": "massdosage"}, "path": "circus-train-core/src/main/java/com/hotels/bdp/circustrain/core/replica/hive/RenameTableOperation.java", "diffHunk": "@@ -40,20 +40,27 @@ public RenameTableOperation(DropTableService dropTableService) {\n    * renamed.\n    */\n   public void execute(CloseableMetaStoreClient client, Table from, Table to) throws Exception {\n-    LOG\n-        .info(\"Renaming table {}.{} to {}.{}\", from.getDbName(), from.getTableName(), to.getDbName(),\n-            to.getTableName());\n+    LOG.info(\"Renaming table {}.{} to {}.{}\", from.getDbName(), from.getTableName(), to.getDbName(), to.getTableName());\n     Table fromTable = client.getTable(from.getDbName(), from.getTableName());\n     Table toTable = client.getTable(to.getDbName(), to.getTableName());\n+    String fromDatabaseName = fromTable.getDbName();\n     String fromTableName = fromTable.getTableName();\n     String toTableName = toTable.getTableName();\n     String toDelete = toTableName + DELETE_ME;\n     try {\n+      fromTable.setDbName(toTable.getDbName());\n       fromTable.setTableName(toTableName);\n       toTable.setTableName(toDelete);\n+      LOG\n+          .info(\"Alter table {}.{} to {}.{}\", toTable.getDbName(), toTableName, toTable.getDbName(),\n+              toTable.getTableName());\n       client.alter_table(toTable.getDbName(), toTableName, toTable);\n-      client.alter_table(fromTable.getDbName(), fromTableName, fromTable);\n+      LOG\n+          .info(\"Alter table {}.{} to {}.{}\", fromDatabaseName, fromTableName, fromTable.getDbName(),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0f4027feef3cf970731f8dca5c620873a438b723"}, "originalPosition": 33}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDU5Njc5Mg==", "bodyText": "Also, shouldn't the first two arguments be the \"from\" values? Same in the log statement below.", "url": "https://github.com/ExpediaGroup/circus-train/pull/206#discussion_r520596792", "createdAt": "2020-11-10T14:19:24Z", "author": {"login": "massdosage"}, "path": "circus-train-core/src/main/java/com/hotels/bdp/circustrain/core/replica/hive/RenameTableOperation.java", "diffHunk": "@@ -40,20 +40,27 @@ public RenameTableOperation(DropTableService dropTableService) {\n    * renamed.\n    */\n   public void execute(CloseableMetaStoreClient client, Table from, Table to) throws Exception {\n-    LOG\n-        .info(\"Renaming table {}.{} to {}.{}\", from.getDbName(), from.getTableName(), to.getDbName(),\n-            to.getTableName());\n+    LOG.info(\"Renaming table {}.{} to {}.{}\", from.getDbName(), from.getTableName(), to.getDbName(), to.getTableName());\n     Table fromTable = client.getTable(from.getDbName(), from.getTableName());\n     Table toTable = client.getTable(to.getDbName(), to.getTableName());\n+    String fromDatabaseName = fromTable.getDbName();\n     String fromTableName = fromTable.getTableName();\n     String toTableName = toTable.getTableName();\n     String toDelete = toTableName + DELETE_ME;\n     try {\n+      fromTable.setDbName(toTable.getDbName());\n       fromTable.setTableName(toTableName);\n       toTable.setTableName(toDelete);\n+      LOG\n+          .info(\"Alter table {}.{} to {}.{}\", toTable.getDbName(), toTableName, toTable.getDbName(),", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDU5NTg0MA=="}, "originalCommit": {"oid": "0f4027feef3cf970731f8dca5c620873a438b723"}, "originalPosition": 28}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDU5NzU4Ng==", "bodyText": "Alternatively we remove these two new log statements and just keep the one we already had.", "url": "https://github.com/ExpediaGroup/circus-train/pull/206#discussion_r520597586", "createdAt": "2020-11-10T14:20:25Z", "author": {"login": "massdosage"}, "path": "circus-train-core/src/main/java/com/hotels/bdp/circustrain/core/replica/hive/RenameTableOperation.java", "diffHunk": "@@ -40,20 +40,27 @@ public RenameTableOperation(DropTableService dropTableService) {\n    * renamed.\n    */\n   public void execute(CloseableMetaStoreClient client, Table from, Table to) throws Exception {\n-    LOG\n-        .info(\"Renaming table {}.{} to {}.{}\", from.getDbName(), from.getTableName(), to.getDbName(),\n-            to.getTableName());\n+    LOG.info(\"Renaming table {}.{} to {}.{}\", from.getDbName(), from.getTableName(), to.getDbName(), to.getTableName());\n     Table fromTable = client.getTable(from.getDbName(), from.getTableName());\n     Table toTable = client.getTable(to.getDbName(), to.getTableName());\n+    String fromDatabaseName = fromTable.getDbName();\n     String fromTableName = fromTable.getTableName();\n     String toTableName = toTable.getTableName();\n     String toDelete = toTableName + DELETE_ME;\n     try {\n+      fromTable.setDbName(toTable.getDbName());\n       fromTable.setTableName(toTableName);\n       toTable.setTableName(toDelete);\n+      LOG\n+          .info(\"Alter table {}.{} to {}.{}\", toTable.getDbName(), toTableName, toTable.getDbName(),", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDU5NTg0MA=="}, "originalCommit": {"oid": "0f4027feef3cf970731f8dca5c620873a438b723"}, "originalPosition": 28}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDU5Nzc2MA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                  LOG.info(\"Drop table {}.{}\", toTable.getDbName(), toDelete);\n          \n          \n            \n                  LOG.info(\"Dropping table {}.{}\", toTable.getDbName(), toDelete);", "url": "https://github.com/ExpediaGroup/circus-train/pull/206#discussion_r520597760", "createdAt": "2020-11-10T14:20:40Z", "author": {"login": "massdosage"}, "path": "circus-train-core/src/main/java/com/hotels/bdp/circustrain/core/replica/hive/RenameTableOperation.java", "diffHunk": "@@ -40,20 +40,27 @@ public RenameTableOperation(DropTableService dropTableService) {\n    * renamed.\n    */\n   public void execute(CloseableMetaStoreClient client, Table from, Table to) throws Exception {\n-    LOG\n-        .info(\"Renaming table {}.{} to {}.{}\", from.getDbName(), from.getTableName(), to.getDbName(),\n-            to.getTableName());\n+    LOG.info(\"Renaming table {}.{} to {}.{}\", from.getDbName(), from.getTableName(), to.getDbName(), to.getTableName());\n     Table fromTable = client.getTable(from.getDbName(), from.getTableName());\n     Table toTable = client.getTable(to.getDbName(), to.getTableName());\n+    String fromDatabaseName = fromTable.getDbName();\n     String fromTableName = fromTable.getTableName();\n     String toTableName = toTable.getTableName();\n     String toDelete = toTableName + DELETE_ME;\n     try {\n+      fromTable.setDbName(toTable.getDbName());\n       fromTable.setTableName(toTableName);\n       toTable.setTableName(toDelete);\n+      LOG\n+          .info(\"Alter table {}.{} to {}.{}\", toTable.getDbName(), toTableName, toTable.getDbName(),\n+              toTable.getTableName());\n       client.alter_table(toTable.getDbName(), toTableName, toTable);\n-      client.alter_table(fromTable.getDbName(), fromTableName, fromTable);\n+      LOG\n+          .info(\"Alter table {}.{} to {}.{}\", fromDatabaseName, fromTableName, fromTable.getDbName(),\n+              fromTable.getTableName());\n+      client.alter_table(fromDatabaseName, fromTableName, fromTable);\n     } finally {\n+      LOG.info(\"Drop table {}.{}\", toTable.getDbName(), toDelete);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0f4027feef3cf970731f8dca5c620873a438b723"}, "originalPosition": 37}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI3MjU0MzU4", "url": "https://github.com/ExpediaGroup/circus-train/pull/206#pullrequestreview-527254358", "createdAt": "2020-11-10T14:25:43Z", "commit": {"oid": "0f4027feef3cf970731f8dca5c620873a438b723"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQxNDoyNTo0NFrOHwfAzQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQxNDoyNzowOVrOHwfE4w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDYwMTgwNQ==", "bodyText": "Might be worth adding in the comment lines above the logs like we have in Cloverleaf? I find it a bit easier to follow", "url": "https://github.com/ExpediaGroup/circus-train/pull/206#discussion_r520601805", "createdAt": "2020-11-10T14:25:44Z", "author": {"login": "JayGreeeen"}, "path": "circus-train-core/src/main/java/com/hotels/bdp/circustrain/core/replica/hive/RenameTableOperation.java", "diffHunk": "@@ -40,20 +40,27 @@ public RenameTableOperation(DropTableService dropTableService) {\n    * renamed.\n    */\n   public void execute(CloseableMetaStoreClient client, Table from, Table to) throws Exception {\n-    LOG\n-        .info(\"Renaming table {}.{} to {}.{}\", from.getDbName(), from.getTableName(), to.getDbName(),\n-            to.getTableName());\n+    LOG.info(\"Renaming table {}.{} to {}.{}\", from.getDbName(), from.getTableName(), to.getDbName(), to.getTableName());\n     Table fromTable = client.getTable(from.getDbName(), from.getTableName());\n     Table toTable = client.getTable(to.getDbName(), to.getTableName());\n+    String fromDatabaseName = fromTable.getDbName();\n     String fromTableName = fromTable.getTableName();\n     String toTableName = toTable.getTableName();\n     String toDelete = toTableName + DELETE_ME;\n     try {\n+      fromTable.setDbName(toTable.getDbName());\n       fromTable.setTableName(toTableName);\n       toTable.setTableName(toDelete);\n+      LOG", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0f4027feef3cf970731f8dca5c620873a438b723"}, "originalPosition": 27}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDYwMjg1MQ==", "bodyText": "Worth also having String toDatabaseName = toTable.getDbName() ?\ntoTable.getDbName() is called quite a few times", "url": "https://github.com/ExpediaGroup/circus-train/pull/206#discussion_r520602851", "createdAt": "2020-11-10T14:27:09Z", "author": {"login": "JayGreeeen"}, "path": "circus-train-core/src/main/java/com/hotels/bdp/circustrain/core/replica/hive/RenameTableOperation.java", "diffHunk": "@@ -40,20 +40,27 @@ public RenameTableOperation(DropTableService dropTableService) {\n    * renamed.\n    */\n   public void execute(CloseableMetaStoreClient client, Table from, Table to) throws Exception {\n-    LOG\n-        .info(\"Renaming table {}.{} to {}.{}\", from.getDbName(), from.getTableName(), to.getDbName(),\n-            to.getTableName());\n+    LOG.info(\"Renaming table {}.{} to {}.{}\", from.getDbName(), from.getTableName(), to.getDbName(), to.getTableName());\n     Table fromTable = client.getTable(from.getDbName(), from.getTableName());\n     Table toTable = client.getTable(to.getDbName(), to.getTableName());\n+    String fromDatabaseName = fromTable.getDbName();\n     String fromTableName = fromTable.getTableName();\n     String toTableName = toTable.getTableName();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0f4027feef3cf970731f8dca5c620873a438b723"}, "originalPosition": 21}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI4MDQzNzQz", "url": "https://github.com/ExpediaGroup/circus-train/pull/206#pullrequestreview-528043743", "createdAt": "2020-11-11T10:23:09Z", "commit": {"oid": "0f4027feef3cf970731f8dca5c620873a438b723"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c9a9720ec99b6e1067465fef6d50212fd022c8fb", "author": {"user": null}, "url": "https://github.com/ExpediaGroup/circus-train/commit/c9a9720ec99b6e1067465fef6d50212fd022c8fb", "committedDate": "2020-11-20T09:13:34Z", "message": "fine tuning"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM1MjUwODk0", "url": "https://github.com/ExpediaGroup/circus-train/pull/206#pullrequestreview-535250894", "createdAt": "2020-11-20T09:15:42Z", "commit": {"oid": "c9a9720ec99b6e1067465fef6d50212fd022c8fb"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yMFQwOToxNTo0MlrOH3HT0A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yMFQwOToxNTo0MlrOH3HT0A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzU1MzQ4OA==", "bodyText": "version number?", "url": "https://github.com/ExpediaGroup/circus-train/pull/206#discussion_r527553488", "createdAt": "2020-11-20T09:15:42Z", "author": {"login": "JayGreeeen"}, "path": "CHANGELOG.md", "diffHunk": "@@ -1,3 +1,7 @@\n+## [TBD] - TBD", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c9a9720ec99b6e1067465fef6d50212fd022c8fb"}, "originalPosition": 1}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM1MjU0Nzgz", "url": "https://github.com/ExpediaGroup/circus-train/pull/206#pullrequestreview-535254783", "createdAt": "2020-11-20T09:21:01Z", "commit": {"oid": "c9a9720ec99b6e1067465fef6d50212fd022c8fb"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM1MjU1ODc3", "url": "https://github.com/ExpediaGroup/circus-train/pull/206#pullrequestreview-535255877", "createdAt": "2020-11-20T09:22:26Z", "commit": {"oid": "c9a9720ec99b6e1067465fef6d50212fd022c8fb"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3839, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}