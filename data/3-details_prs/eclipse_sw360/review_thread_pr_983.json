{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDg3NzY0MjMy", "number": 983, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQxMDozMzozNVrOEj_mzQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQxMDo0MToyMlrOEj_xHA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA2MTc3NzQxOnYy", "diffSide": "RIGHT", "path": "scripts/migrations/024_update_type_from_obligations_to_obligation.py", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQxMDozMzozNVrOHSqsbQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQxMToyMTo1NlrOHSsNpA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTMzNTkxNw==", "bodyText": "Please remove this count variable, It seems like it is not used anywhere.", "url": "https://github.com/eclipse/sw360/pull/983#discussion_r489335917", "createdAt": "2020-09-16T10:33:35Z", "author": {"login": "smrutis1"}, "path": "scripts/migrations/024_update_type_from_obligations_to_obligation.py", "diffHunk": "@@ -0,0 +1,85 @@\n+#!/usr/bin/python\n+# -----------------------------------------------------------------------------\n+# Copyright Siemens AG, 2020. Part of the SW360 Portal Project.\n+#\n+# This program and the accompanying materials are made\n+# available under the terms of the Eclipse Public License 2.0\n+# which is available at https://www.eclipse.org/legal/epl-2.0/\n+#\n+# SPDX-License-Identifier: EPL-2.0\n+#\n+# This is a manual database migration script. It is assumed that a\n+# dedicated framework for automatic migration will be written in the\n+# future. When that happens, this script should be refactored to conform\n+# to the framework's prerequisites to be run by the framework. For\n+# example, server address and db name should be parameterized, the code\n+# reorganized into a single class or function, etc.\n+#\n+# This script updates type of document from obligations to obligation\n+# ---------------------------------------------------------------------------------------------------------------------------------------------------------------\n+\n+import time\n+import couchdb\n+import json\n+from webbrowser import get\n+\n+# ---------------------------------------\n+# constants\n+# ---------------------------------------\n+\n+DRY_RUN = True\n+\n+COUCHSERVER = \"http://localhost:5984/\"\n+DBNAME = 'sw360db'\n+\n+couch=couchdb.Server(COUCHSERVER)\n+db = couch[DBNAME]\n+\n+# set fieldName\n+newValue = \"obligation\"\n+\n+# ----------------------------------------\n+# queries\n+# ----------------------------------------\n+\n+# get all obligations\n+all_obligations_query = {\"selector\": {\"type\": {\"$eq\": \"obligations\"}}}\n+\n+# ---------------------------------------\n+# functions\n+# ---------------------------------------\n+\n+def run():\n+    log = {}\n+    count = 0;\n+    log['updatedObligation'] = []\n+    print 'Getting all obligations'\n+    all_obligations = db.find(all_obligations_query)\n+    print 'found ' + str(len(all_obligations)) + ' obligations in db!'\n+    log['totalCount'] = len(all_obligations)\n+\n+    for obligation in all_obligations:\n+        print '\\tUpdating type of document from obligations to '+newValue+' for ID -> ' + obligation.get('_id')\n+        obligation['type'] = newValue\n+        updatedObligation = {}\n+        updatedObligation['id'] = obligation.get('_id')\n+        log['updatedObligation'].append(updatedObligation)\n+        count = count + 1", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b24fdd5fdff4ac63395326cfd20a1ac775f0ea96"}, "originalPosition": 67}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTM2MDgwNA==", "bodyText": "removed count variable", "url": "https://github.com/eclipse/sw360/pull/983#discussion_r489360804", "createdAt": "2020-09-16T11:21:56Z", "author": {"login": "JaideepPalit"}, "path": "scripts/migrations/024_update_type_from_obligations_to_obligation.py", "diffHunk": "@@ -0,0 +1,85 @@\n+#!/usr/bin/python\n+# -----------------------------------------------------------------------------\n+# Copyright Siemens AG, 2020. Part of the SW360 Portal Project.\n+#\n+# This program and the accompanying materials are made\n+# available under the terms of the Eclipse Public License 2.0\n+# which is available at https://www.eclipse.org/legal/epl-2.0/\n+#\n+# SPDX-License-Identifier: EPL-2.0\n+#\n+# This is a manual database migration script. It is assumed that a\n+# dedicated framework for automatic migration will be written in the\n+# future. When that happens, this script should be refactored to conform\n+# to the framework's prerequisites to be run by the framework. For\n+# example, server address and db name should be parameterized, the code\n+# reorganized into a single class or function, etc.\n+#\n+# This script updates type of document from obligations to obligation\n+# ---------------------------------------------------------------------------------------------------------------------------------------------------------------\n+\n+import time\n+import couchdb\n+import json\n+from webbrowser import get\n+\n+# ---------------------------------------\n+# constants\n+# ---------------------------------------\n+\n+DRY_RUN = True\n+\n+COUCHSERVER = \"http://localhost:5984/\"\n+DBNAME = 'sw360db'\n+\n+couch=couchdb.Server(COUCHSERVER)\n+db = couch[DBNAME]\n+\n+# set fieldName\n+newValue = \"obligation\"\n+\n+# ----------------------------------------\n+# queries\n+# ----------------------------------------\n+\n+# get all obligations\n+all_obligations_query = {\"selector\": {\"type\": {\"$eq\": \"obligations\"}}}\n+\n+# ---------------------------------------\n+# functions\n+# ---------------------------------------\n+\n+def run():\n+    log = {}\n+    count = 0;\n+    log['updatedObligation'] = []\n+    print 'Getting all obligations'\n+    all_obligations = db.find(all_obligations_query)\n+    print 'found ' + str(len(all_obligations)) + ' obligations in db!'\n+    log['totalCount'] = len(all_obligations)\n+\n+    for obligation in all_obligations:\n+        print '\\tUpdating type of document from obligations to '+newValue+' for ID -> ' + obligation.get('_id')\n+        obligation['type'] = newValue\n+        updatedObligation = {}\n+        updatedObligation['id'] = obligation.get('_id')\n+        log['updatedObligation'].append(updatedObligation)\n+        count = count + 1", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTMzNTkxNw=="}, "originalCommit": {"oid": "b24fdd5fdff4ac63395326cfd20a1ac775f0ea96"}, "originalPosition": 67}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA2MTgwMzgwOnYy", "diffSide": "RIGHT", "path": "frontend/sw360-portlet/src/main/resources/META-INF/resources/html/licenses/includes/detailTodos.jspf", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQxMDo0MToyMlrOHSq8qA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQxMToyMTo1MlrOHSsNhw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTM0MDA3Mg==", "bodyText": "It should be  ${oblig.listOfobligation} instead of ${oblig.obligations}", "url": "https://github.com/eclipse/sw360/pull/983#discussion_r489340072", "createdAt": "2020-09-16T10:41:22Z", "author": {"login": "smrutis1"}, "path": "frontend/sw360-portlet/src/main/resources/META-INF/resources/html/licenses/includes/detailTodos.jspf", "diffHunk": "@@ -95,15 +95,15 @@\n                     <td><sw360:DisplayBoolean value=\"${oblig.development}\" defined=\"${oblig.setDevelopment}\"/></td>\n                     <td><sw360:DisplayBoolean value=\"${oblig.distribution}\" defined=\"${oblig.setDistribution}\"/></td>\n                     <td><sw360:DisplayMap value=\"${oblig.customPropertyToValue}\"/></td>\n-                    <core_rt:if test=\"${oblig.listOfobligationSize > 0}\">\n-                        <td>\n+                    <td>\n+                        <core_rt:if test=\"${oblig.listOfobligationSize > 0}\">\n                             <ul>\n                                 <core_rt:forEach var=\"ob\" varStatus=\"status\" items=\"${oblig.obligations}\">", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b24fdd5fdff4ac63395326cfd20a1ac775f0ea96"}, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTM2MDc3NQ==", "bodyText": "Changes made", "url": "https://github.com/eclipse/sw360/pull/983#discussion_r489360775", "createdAt": "2020-09-16T11:21:52Z", "author": {"login": "JaideepPalit"}, "path": "frontend/sw360-portlet/src/main/resources/META-INF/resources/html/licenses/includes/detailTodos.jspf", "diffHunk": "@@ -95,15 +95,15 @@\n                     <td><sw360:DisplayBoolean value=\"${oblig.development}\" defined=\"${oblig.setDevelopment}\"/></td>\n                     <td><sw360:DisplayBoolean value=\"${oblig.distribution}\" defined=\"${oblig.setDistribution}\"/></td>\n                     <td><sw360:DisplayMap value=\"${oblig.customPropertyToValue}\"/></td>\n-                    <core_rt:if test=\"${oblig.listOfobligationSize > 0}\">\n-                        <td>\n+                    <td>\n+                        <core_rt:if test=\"${oblig.listOfobligationSize > 0}\">\n                             <ul>\n                                 <core_rt:forEach var=\"ob\" varStatus=\"status\" items=\"${oblig.obligations}\">", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTM0MDA3Mg=="}, "originalCommit": {"oid": "b24fdd5fdff4ac63395326cfd20a1ac775f0ea96"}, "originalPosition": 29}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1180, "cost": 1, "resetAt": "2021-11-12T18:49:56Z"}}}