{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY1OTE5NjMx", "number": 947, "title": "feat(ProjectReleaseRelation): Added new Field comment, createdOn, createdBy in ProjectReleaseRelation", "bodyText": "Added new Field comment, createdOn, createdBy in ProjectReleaseRelation\n\ncomment field is available in UI, REST and Excel\ncreatedOn , createdBy is not available in UI but available in REST and Excel.\n\n\n\n\nWhich issue is this pull request belonging to and how is it solving it? (#946 , #225)\nDid you add or update any new dependencies that are required for your change?\n\n\nHow To Test?\n\nCreate or Update Project with Linked Release, add some comment.\n\nExcepted behaviour, comment , createdOn, createdBy fields should be reflected in Excel , REST, ChangeLogs.\nNote\n\nComment is available in UI, Excel and REST.\n\nIn UI, it should be available in Project Edit Page and Clearing Status tab - Tree and List View.\n\n\ncreatedOn and createdBy is not available in UI . But available in Excel and REST. And the value of these field are only set if new ProjectReleaseRelation is added.\n\n\n\n\n\nHave you implemented any additional tests? - No\n\nChecklist\nMust:\n\n All related issues are referenced in commit messages and in PR\n\nSigned-off-by: Jaideep Palit jaideep.palit@siemens.com", "createdAt": "2020-08-11T07:22:42Z", "url": "https://github.com/eclipse/sw360/pull/947", "merged": true, "mergeCommit": {"oid": "a1724b749e4b57d2daff3717330b6d838d2730e5"}, "closed": true, "closedAt": "2020-08-19T08:21:37Z", "author": {"login": "JaideepPalit"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc_tlWTAFqTQ2ODE5Mjg2Nw==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdAVRIMgFqTQ3MDE0NzYyOQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY4MTkyODY3", "url": "https://github.com/eclipse/sw360/pull/947#pullrequestreview-468192867", "createdAt": "2020-08-17T06:28:15Z", "commit": {"oid": "75724090b28260db9a68f7eaae1610235c6aefdd"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xN1QwNjoyODoxNVrOHBbMWA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xN1QwNzozODowMFrOHBdpYw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTI1NjE1Mg==", "bodyText": "if (!textarea) make more sense here.\nsame applies to... if (!$(textarea)[0])", "url": "https://github.com/eclipse/sw360/pull/947#discussion_r471256152", "createdAt": "2020-08-17T06:28:15Z", "author": {"login": "akapti"}, "path": "frontend/sw360-portlet/src/main/resources/META-INF/resources/html/projects/includes/projects/administrationEdit.jspf", "diffHunk": "@@ -289,7 +289,9 @@\n         $('.datepicker').datepicker({changeMonth:true,changeYear:true,dateFormat: \"yy-mm-dd\"});\n \n         function setDefaultTextAndResize(textarea) {\n+            if(textarea == null||textarea == undefined) return;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "75724090b28260db9a68f7eaae1610235c6aefdd"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTI1NjU3Nw==", "bodyText": "fix the indentation.", "url": "https://github.com/eclipse/sw360/pull/947#discussion_r471256577", "createdAt": "2020-08-17T06:29:40Z", "author": {"login": "akapti"}, "path": "backend/src-common/src/main/java/org/eclipse/sw360/datahandler/db/ProjectDatabaseHandler.java", "diffHunk": "@@ -404,6 +406,51 @@ public RequestStatus updateProject(Project project, User user) throws SW360Excep\n         }\n     }\n \n+    private void setRequestedDateAndTrimComment(Project project, Project actual, User user) {\n+        Set<String> actualReleaseIds = null;\n+        if (Objects.nonNull(actual)&&Objects.nonNull(actual.getReleaseIdToUsage())) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "75724090b28260db9a68f7eaae1610235c6aefdd"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTI2MzkxNg==", "bodyText": "please get this map project.getReleaseIdToUsage() once and store in variable, rather than fetching it each time in line 416, 417, 424, 433 and 445.", "url": "https://github.com/eclipse/sw360/pull/947#discussion_r471263916", "createdAt": "2020-08-17T06:50:16Z", "author": {"login": "akapti"}, "path": "backend/src-common/src/main/java/org/eclipse/sw360/datahandler/db/ProjectDatabaseHandler.java", "diffHunk": "@@ -404,6 +406,51 @@ public RequestStatus updateProject(Project project, User user) throws SW360Excep\n         }\n     }\n \n+    private void setRequestedDateAndTrimComment(Project project, Project actual, User user) {\n+        Set<String> actualReleaseIds = null;\n+        if (Objects.nonNull(actual)&&Objects.nonNull(actual.getReleaseIdToUsage())) {\n+            actualReleaseIds = CommonUtils.nullToEmptySet(actual.getReleaseIdToUsage().keySet());\n+        }\n+        final Set<String> actualReleaseIdsFinal = CommonUtils.nullToEmptySet(actualReleaseIds);\n+        Set<String> updatedReleaseIds = null;\n+        if (Objects.nonNull(project.getReleaseIdToUsage())) {\n+            updatedReleaseIds = CommonUtils.nullToEmptySet(project.getReleaseIdToUsage().keySet());\n+        } else {\n+            updatedReleaseIds = new HashSet<>();\n+        }\n+\n+        updatedReleaseIds.stream().filter(updatedReleaseId -> !actualReleaseIdsFinal.contains(updatedReleaseId))\n+                .forEach(updatedReleaseId -> {\n+                    ProjectReleaseRelationship projectReleaseRelationship = project.getReleaseIdToUsage()\n+                            .get(updatedReleaseId);\n+                    if (Objects.nonNull(projectReleaseRelationship))\n+                        projectReleaseRelationship.setCreatedOn(SW360Utils.getCreatedOn());\n+                    projectReleaseRelationship.setCreatedBy(user.getEmail());\n+                });\n+\n+        updatedReleaseIds.stream().filter(commonReleaseId -> actualReleaseIdsFinal.contains(commonReleaseId))\n+                .forEach(commonReleaseId -> {\n+                    ProjectReleaseRelationship projectReleaseRelationship = project.getReleaseIdToUsage()\n+                            .get(commonReleaseId);\n+                    ProjectReleaseRelationship actualProjectReleaseRelationship = actual.getReleaseIdToUsage()\n+                            .get(commonReleaseId);\n+                    if (Objects.nonNull(projectReleaseRelationship)\n+                            && Objects.nonNull(actualProjectReleaseRelationship))\n+                        projectReleaseRelationship\n+                                .setCreatedOn(actualProjectReleaseRelationship.getCreatedOn());\n+                    projectReleaseRelationship\n+                    .setCreatedBy(actualProjectReleaseRelationship.getCreatedBy());\n+                });\n+\n+        if (Objects.nonNull(project.getReleaseIdToUsage())) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "75724090b28260db9a68f7eaae1610235c6aefdd"}, "originalPosition": 56}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTI2NzAwNg==", "bodyText": "No need to define a variable, we can directly pass empty string in method call (line 1428).", "url": "https://github.com/eclipse/sw360/pull/947#discussion_r471267006", "createdAt": "2020-08-17T06:57:46Z", "author": {"login": "akapti"}, "path": "backend/src-common/src/main/java/org/eclipse/sw360/datahandler/db/ProjectDatabaseHandler.java", "diffHunk": "@@ -1370,13 +1418,14 @@ private void flattenlinkedReleaseOfRelease(Map<String, ReleaseRelationship> rele\n         releaseIdToRelationship.entrySet().stream().forEach(rl -> wrapTException(() -> {\n             String relation = ThriftEnumUtils.enumToString(rl.getValue());\n             String projectMailLineState = \"\";\n+            String comment = \"\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "75724090b28260db9a68f7eaae1610235c6aefdd"}, "originalPosition": 88}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTI5NjM1NQ==", "bodyText": "please use braces as there are more than one statement inside if clause.\nSame applies to if clause in line 437.", "url": "https://github.com/eclipse/sw360/pull/947#discussion_r471296355", "createdAt": "2020-08-17T07:38:00Z", "author": {"login": "akapti"}, "path": "backend/src-common/src/main/java/org/eclipse/sw360/datahandler/db/ProjectDatabaseHandler.java", "diffHunk": "@@ -404,6 +406,51 @@ public RequestStatus updateProject(Project project, User user) throws SW360Excep\n         }\n     }\n \n+    private void setRequestedDateAndTrimComment(Project project, Project actual, User user) {\n+        Set<String> actualReleaseIds = null;\n+        if (Objects.nonNull(actual)&&Objects.nonNull(actual.getReleaseIdToUsage())) {\n+            actualReleaseIds = CommonUtils.nullToEmptySet(actual.getReleaseIdToUsage().keySet());\n+        }\n+        final Set<String> actualReleaseIdsFinal = CommonUtils.nullToEmptySet(actualReleaseIds);\n+        Set<String> updatedReleaseIds = null;\n+        if (Objects.nonNull(project.getReleaseIdToUsage())) {\n+            updatedReleaseIds = CommonUtils.nullToEmptySet(project.getReleaseIdToUsage().keySet());\n+        } else {\n+            updatedReleaseIds = new HashSet<>();\n+        }\n+\n+        updatedReleaseIds.stream().filter(updatedReleaseId -> !actualReleaseIdsFinal.contains(updatedReleaseId))\n+                .forEach(updatedReleaseId -> {\n+                    ProjectReleaseRelationship projectReleaseRelationship = project.getReleaseIdToUsage()\n+                            .get(updatedReleaseId);\n+                    if (Objects.nonNull(projectReleaseRelationship))\n+                        projectReleaseRelationship.setCreatedOn(SW360Utils.getCreatedOn());\n+                    projectReleaseRelationship.setCreatedBy(user.getEmail());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "75724090b28260db9a68f7eaae1610235c6aefdd"}, "originalPosition": 39}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "60f82182115aa465f7a00935428762faa722e549", "author": {"user": {"login": "JaideepPalit", "name": "Jaideep Palit"}}, "url": "https://github.com/eclipse/sw360/commit/60f82182115aa465f7a00935428762faa722e549", "committedDate": "2020-08-18T03:47:55Z", "message": "feat(ProjectReleaseRelation): Added new Field comment, createdOn, createdBy in ProjectReleaseRelation\n  * comment field is available in UI, REST and Excel\n  * createdOn , createdBy is not available in UI but available in REST and Excel.\n\nSigned-off-by: Jaideep Palit <jaideep.palit@siemens.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "75724090b28260db9a68f7eaae1610235c6aefdd", "author": {"user": {"login": "JaideepPalit", "name": "Jaideep Palit"}}, "url": "https://github.com/eclipse/sw360/commit/75724090b28260db9a68f7eaae1610235c6aefdd", "committedDate": "2020-08-11T07:10:05Z", "message": "feat(ProjectReleaseRelation): Added new Field comment, createdOn, createdBy in ProjectReleaseRelation\n  * comment field is available in UI, REST and Excel\n  * createdOn , createdBy is not available in UI but available in REST and Excel.\n\nSigned-off-by: Jaideep Palit <jaideep.palit@siemens.com>"}, "afterCommit": {"oid": "60f82182115aa465f7a00935428762faa722e549", "author": {"user": {"login": "JaideepPalit", "name": "Jaideep Palit"}}, "url": "https://github.com/eclipse/sw360/commit/60f82182115aa465f7a00935428762faa722e549", "committedDate": "2020-08-18T03:47:55Z", "message": "feat(ProjectReleaseRelation): Added new Field comment, createdOn, createdBy in ProjectReleaseRelation\n  * comment field is available in UI, REST and Excel\n  * createdOn , createdBy is not available in UI but available in REST and Excel.\n\nSigned-off-by: Jaideep Palit <jaideep.palit@siemens.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDcwMTQ3NjI5", "url": "https://github.com/eclipse/sw360/pull/947#pullrequestreview-470147629", "createdAt": "2020-08-19T06:03:57Z", "commit": {"oid": "60f82182115aa465f7a00935428762faa722e549"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4835, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}