{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDkxNzA2OTMy", "number": 994, "title": "fix(UserSearch): Fixed search user functionality", "bodyText": "Fixed search user functionality\n\nWhich issue is this pull request belonging to and how is it solving it? (#991)\nDid you add or update any new dependencies that are required for your change? - No\n\n\nHow To Test?\n\n\nGoto Search Page - Search Project, Component, Release, User...\nCreate/Edit Project, Component, Release - add user using search functionality to moderator, contributor, Project Responsible etc.\nHave you implemented any additional tests? - No\n\n\nChecklist\nMust:\n\n All related issues are referenced in commit messages and in PR\n\nSigned-off-by: Jaideep Palit jaideep.palit@siemens.com", "createdAt": "2020-09-23T11:26:58Z", "url": "https://github.com/eclipse/sw360/pull/994", "merged": true, "mergeCommit": {"oid": "f9ee6b8ce42c04344d79c8035657d1366a1d7e20"}, "closed": true, "closedAt": "2020-09-25T08:13:59Z", "author": {"login": "JaideepPalit"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdMOvr6gFqTQ5NjEwNjY4Mg==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdMRFXBAFqTQ5NjE5MzE0Nw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk2MTA2Njgy", "url": "https://github.com/eclipse/sw360/pull/994#pullrequestreview-496106682", "createdAt": "2020-09-25T04:43:59Z", "commit": {"oid": "93a053810cb6a969854e74a9d8956b542bf77486"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNVQwNDo0Mzo1OVrOHX0yJg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNVQwNDo0ODo1MVrOHX02lA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDc0NDEwMg==", "bodyText": "I believe stale parameter is used in line no. 168 as well for every database, in case it failing without it. May be no need to specifically handle it only for User DB. here?", "url": "https://github.com/eclipse/sw360/pull/994#discussion_r494744102", "createdAt": "2020-09-25T04:43:59Z", "author": {"login": "smrutis1"}, "path": "libraries/lib-datahandler/src/main/java/org/eclipse/sw360/datahandler/couchdb/lucene/LuceneAwareDatabaseConnector.java", "diffHunk": "@@ -149,18 +149,33 @@ private LuceneResult callLuceneDirectly(LuceneSearchView function, String queryS\n         if (resultLimit > 0) {\n             queryURI.param(\"limit\", resultLimit);\n         }\n+        if (dbNameForLuceneSearch.equals(DatabaseSettings.COUCH_DB_USERS)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "93a053810cb6a969854e74a9d8956b542bf77486"}, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDc0NTIzNg==", "bodyText": "Indentation may be like } else {. same in line number 175", "url": "https://github.com/eclipse/sw360/pull/994#discussion_r494745236", "createdAt": "2020-09-25T04:48:51Z", "author": {"login": "smrutis1"}, "path": "libraries/lib-datahandler/src/main/java/org/eclipse/sw360/datahandler/couchdb/lucene/LuceneAwareDatabaseConnector.java", "diffHunk": "@@ -149,18 +149,33 @@ private LuceneResult callLuceneDirectly(LuceneSearchView function, String queryS\n         if (resultLimit > 0) {\n             queryURI.param(\"limit\", resultLimit);\n         }\n+        if (dbNameForLuceneSearch.equals(DatabaseSettings.COUCH_DB_USERS)) {\n+            queryURI.param(\"stale\", \"ok\");\n+        }\n         queryURI.param(\"q\", queryString.toString());\n         URL luceneResourceUrl = new URL(DatabaseSettings.COUCH_DB_LUCENE_URL + queryURI.toString());\n+        ObjectMapper objectMapper = new EktorpLuceneObjectMapperFactory().createObjectMapper();\n         HttpURLConnection connection = null;\n         try {\n-            connection = (HttpURLConnection) luceneResourceUrl.openConnection();\n-            connection.setRequestMethod(\"GET\");\n-            connection.connect();\n+            connection = makeLuceneRequest(luceneResourceUrl);\n             int responseCode = connection.getResponseCode();\n             if (responseCode == 200) {\n-                ObjectMapper objectMapper = new EktorpLuceneObjectMapperFactory().createObjectMapper();\n                 return objectMapper.readValue(connection.getInputStream(), LuceneResult.class);\n             }\n+            else {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "93a053810cb6a969854e74a9d8956b542bf77486"}, "originalPosition": 46}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2f9a6879031341707cb8d578125e97798e47bbd6", "author": {"user": {"login": "JaideepPalit", "name": "Jaideep Palit"}}, "url": "https://github.com/eclipse/sw360/commit/2f9a6879031341707cb8d578125e97798e47bbd6", "committedDate": "2020-09-25T06:26:26Z", "message": "fix(UserSearch): Fixed search user functionality\n\nSigned-off-by: Jaideep Palit <jaideep.palit@siemens.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "93a053810cb6a969854e74a9d8956b542bf77486", "author": {"user": {"login": "JaideepPalit", "name": "Jaideep Palit"}}, "url": "https://github.com/eclipse/sw360/commit/93a053810cb6a969854e74a9d8956b542bf77486", "committedDate": "2020-09-23T09:34:21Z", "message": "fix(UserSearch): Fixed search user functionality\n\nSigned-off-by: Jaideep Palit <jaideep.palit@siemens.com>"}, "afterCommit": {"oid": "2f9a6879031341707cb8d578125e97798e47bbd6", "author": {"user": {"login": "JaideepPalit", "name": "Jaideep Palit"}}, "url": "https://github.com/eclipse/sw360/commit/2f9a6879031341707cb8d578125e97798e47bbd6", "committedDate": "2020-09-25T06:26:26Z", "message": "fix(UserSearch): Fixed search user functionality\n\nSigned-off-by: Jaideep Palit <jaideep.palit@siemens.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk2MTkzMTQ3", "url": "https://github.com/eclipse/sw360/pull/994#pullrequestreview-496193147", "createdAt": "2020-09-25T07:58:34Z", "commit": {"oid": "2f9a6879031341707cb8d578125e97798e47bbd6"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4847, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}