{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDYyNjQzMDI2", "number": 939, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMFQwODo0NDowMlrOEiA63g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMFQwODo0NDowMlrOEiA63g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA0MTAyMTEwOnYy", "diffSide": "RIGHT", "path": "scripts/install-thrift.sh", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMFQwODo0NDowMlrOHPpaqA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMFQwODo0NDowMlrOHPpaqA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjE2OTI1Ng==", "bodyText": "actually this seems to be a good way of doing the uninstall here (passing it as parameter", "url": "https://github.com/eclipse/sw360/pull/939#discussion_r486169256", "createdAt": "2020-09-10T08:44:02Z", "author": {"login": "mcjaeger"}, "path": "scripts/install-thrift.sh", "diffHunk": "@@ -18,23 +18,116 @@\n # -----------------------------------------------------------------------------\n \n set -e\n-\n-VERSION=0.13.0\n+CURRENT_THRIFT_VERSION=0.13.0\n \n BASEDIR=\"/tmp\"\n-BUILDDIR=\"${BASEDIR}/thrift-$VERSION\"\n+CLEANUP=true\n+UNINSTALL=false\n \n has() { type \"$1\" &> /dev/null; }\n \n-if has \"thrift\"; then\n-    if thrift --version | grep -q \"$VERSION\"; then\n-        echo \"thrift is already installed at $(which thrift)\"\n-        exit 0\n-    else\n-        echo \"thrift is already installed but does not have the correct version: $VERSION\"\n-        exit 1\n-    fi\n-fi\n+processThrift() {\n+  set -x\n+  VERSION=$3\n+  BUILDDIR=\"${BASEDIR}/thrift-$VERSION\"\n+\n+  if [[ ! -d \"$BUILDDIR\" ]]; then\n+      echo \"-[shell provisioning] Extracting thrift\"\n+      if [ -e \"/vagrant_shared/packages/thrift-$VERSION.tar.gz\" ]; then\n+          tar -xzf \"/vagrant_shared/packages/thrift-$VERSION.tar.gz\" -C $BASEDIR\n+      else\n+          if has \"apt-get\" ; then\n+              $SUDO_CMD apt-get update\n+              $SUDO_CMD apt-get install -y curl\n+          elif has \"apk\" ; then\n+              $SUDO_CMD apk --update add curl\n+          else\n+              echo \"no supported package manager found\"\n+              exit 1\n+          fi\n+\n+          TGZ=\"${BASEDIR}/thrift-$VERSION.tar.gz\"\n+\n+          curl -z $TGZ -o $TGZ http://archive.apache.org/dist/thrift/$VERSION/thrift-$VERSION.tar.gz\n+          tar -xzf $TGZ -C $BASEDIR\n+\n+          [[ $CLEANUP ]] && rm \"${BASEDIR}/thrift-$VERSION.tar.gz\"\n+      fi\n+  fi\n+\n+  cd \"$BUILDDIR\"\n+  if [[ ! -f \"./compiler/cpp/thrift\" ]]; then\n+      echo \"-[shell provisioning] Installing dependencies of thrift\"\n+\n+      if has \"apt-get\" ; then\n+          $SUDO_CMD apt-get update\n+          $SUDO_CMD apt-get install -y build-essential libboost-dev libboost-test-dev libboost-program-options-dev libevent-dev automake libtool flex bison pkg-config g++ libssl-dev\n+      elif has \"apk\" ; then\n+          $SUDO_CMD apk --update add g++ make apache-ant libtool automake autoconf bison flex\n+      else\n+          echo \"no supported package manager found\"\n+          exit 1\n+      fi\n+\n+      echo \"-[shell provisioning] Building thrift\"\n+      if [[ ! -f \"./Makefile\" ]]; then\n+          ./configure --without-java --without-cpp --without-qt4 --without-c_glib --without-csharp --without-erlang \\\n+                      --without-perl --without-php --without-php_extension --without-python --without-py3 --without-ruby \\\n+                      --without-haskell --without-go --without-d --without-haskell --without-php --without-ruby \\\n+                      --without-python --without-erlang --without-perl --without-c_sharp --without-d --without-php \\\n+                      --without-go --without-lua --without-nodejs --without-cl\n+      fi\n+      if [ \"$1\" == true ]; then\n+        make\n+      fi\n+  fi\n+\n+  echo \"-[shell provisioning] Executing make $2 on thrift\"\n+  $SUDO_CMD make $2", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c06851878b6a60aca265b519d987549c2955ea7f"}, "originalPosition": 81}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1159, "cost": 1, "resetAt": "2021-11-12T18:49:56Z"}}}