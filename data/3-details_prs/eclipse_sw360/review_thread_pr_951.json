{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY2NTkxNzQz", "number": 951, "reviewThreads": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMFQwNTo1NzoxNVrOEaU0xA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMFQwNjowOTowNFrOEaVIFg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk2MDM5NjIwOnYy", "diffSide": "RIGHT", "path": "frontend/sw360-portlet/src/main/resources/META-INF/resources/html/projects/licenseInfo.jsp", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMFQwNTo1NzoxNVrOHDrvuA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMFQwNTo1NzoxNVrOHDrvuA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzYyNDUwNA==", "bodyText": "Can it be written as if(data.attachmentNames)  same for line 218 and 183", "url": "https://github.com/eclipse/sw360/pull/951#discussion_r473624504", "createdAt": "2020-08-20T05:57:15Z", "author": {"login": "JaideepPalit"}, "path": "frontend/sw360-portlet/src/main/resources/META-INF/resources/html/projects/licenseInfo.jsp", "diffHunk": "@@ -138,74 +147,148 @@\n <script>\n require(['jquery', 'modules/dialog'], function($, dialog) {\n     let onlyClearingReport = '${onlyClearingReport}';\n+    let downloadEmptyTemplate = '${showSessionError}';\n+    let outputFormat = '${licInfoSelectedOutputFormat}';\n     $('#selectVariantAndDownload').on('click', selectVariantAndSubmit);\n     function selectVariantAndSubmit(){\n         dialog.open('#downloadLicenseInfoDialog','',function(submit, callback) {\n             callback(true);\n         });\n     }\n-    if(onlyClearingReport == 'true') {\n-        $('#downloadFileModal').on('click', downloadClearingReportOnly);\n-    } else {\n-        $('#downloadFileModal').on('click', downloadFile);\n+\n+    if(downloadEmptyTemplate) {\n+        if(onlyClearingReport == 'true') {\n+            downloadClearingReportOnly(true);\n+        } else {\n+            downloadFile(true, outputFormat);\n+        }\n     }\n \n-    function downloadFile(){\n-        var licenseInfoSelectedOutputFormat = $('input[name=\"outputFormat\"]:checked').val();\n-        var externalIds = [];\n-        var releaseRelations = [];\n-        var selectedProjectRelations = [];\n-        $.each($(\"input[name='externalIdsSelection']:checked\"), function(){\n-            externalIds.push($(this).val());\n+    $('#downloadFileModal').on('click', function() {\n+        checkIfSelectedAttachmentsExist().done(function(data){\n+            if(typeof data.attachmentNames !== 'undefined' && data.attachmentNames) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ce286ec9bb032c48e7ab349eecbbde78d5ac1b7c"}, "originalPosition": 64}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk2MDQyMjUyOnYy", "diffSide": "RIGHT", "path": "frontend/sw360-portlet/src/main/resources/META-INF/resources/html/projects/licenseInfo.jsp", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMFQwNjowMzo0MVrOHDsAOw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0zMVQwNjowNDoyOFrOHJrfTQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzYyODczMQ==", "bodyText": "It would be good to have all methods related to ajax in one place like done()", "url": "https://github.com/eclipse/sw360/pull/951#discussion_r473628731", "createdAt": "2020-08-20T06:03:41Z", "author": {"login": "JaideepPalit"}, "path": "frontend/sw360-portlet/src/main/resources/META-INF/resources/html/projects/licenseInfo.jsp", "diffHunk": "@@ -138,74 +147,148 @@\n <script>\n require(['jquery', 'modules/dialog'], function($, dialog) {\n     let onlyClearingReport = '${onlyClearingReport}';\n+    let downloadEmptyTemplate = '${showSessionError}';\n+    let outputFormat = '${licInfoSelectedOutputFormat}';\n     $('#selectVariantAndDownload').on('click', selectVariantAndSubmit);\n     function selectVariantAndSubmit(){\n         dialog.open('#downloadLicenseInfoDialog','',function(submit, callback) {\n             callback(true);\n         });\n     }\n-    if(onlyClearingReport == 'true') {\n-        $('#downloadFileModal').on('click', downloadClearingReportOnly);\n-    } else {\n-        $('#downloadFileModal').on('click', downloadFile);\n+\n+    if(downloadEmptyTemplate) {\n+        if(onlyClearingReport == 'true') {\n+            downloadClearingReportOnly(true);\n+        } else {\n+            downloadFile(true, outputFormat);\n+        }\n     }\n \n-    function downloadFile(){\n-        var licenseInfoSelectedOutputFormat = $('input[name=\"outputFormat\"]:checked').val();\n-        var externalIds = [];\n-        var releaseRelations = [];\n-        var selectedProjectRelations = [];\n-        $.each($(\"input[name='externalIdsSelection']:checked\"), function(){\n-            externalIds.push($(this).val());\n+    $('#downloadFileModal').on('click', function() {\n+        checkIfSelectedAttachmentsExist().done(function(data){\n+            if(typeof data.attachmentNames !== 'undefined' && data.attachmentNames) {\n+                downloadLicenseInfo(data.attachmentNames);\n+            } else {\n+                if(onlyClearingReport == 'true') {\n+                    downloadClearingReportOnly(false);\n+                } else {\n+                    downloadFile(false);\n+                }\n+            }\n         });\n-        var extIdsHidden = externalIds.join(',');\n+    });\n \n-        $.each($(\"input[name='releaseRelationSelection']:checked\"), function(){\n-            releaseRelations.push($(this).val());\n-        });\n-        var releaseRelationsHidden = releaseRelations.join();\n+    function downloadFile(isEmptyFile, outputFormat){\n+        var licenseInfoSelectedOutputFormat = $('input[name=\"outputFormat\"]:checked').val();\n+        if(isEmptyFile === \"undefined\" || !isEmptyFile){\n+            var externalIds = [];\n+            var releaseRelations = [];\n+            var selectedProjectRelations = [];\n+            $.each($(\"input[name='externalIdsSelection']:checked\"), function(){\n+                externalIds.push($(this).val());\n+            });\n+            var extIdsHidden = externalIds.join(',');\n \n-        $.each($(\"input[name='projectRelationSelection']:checked\"), function(){\n-            selectedProjectRelations.push($(this).val());\n-        });\n-        var selectedProjectRelationsHidden = selectedProjectRelations.join();\n+            $.each($(\"input[name='releaseRelationSelection']:checked\"), function(){\n+                releaseRelations.push($(this).val());\n+            });\n+            var releaseRelationsHidden = releaseRelations.join();\n+\n+            $.each($(\"input[name='projectRelationSelection']:checked\"), function(){\n+                selectedProjectRelations.push($(this).val());\n+            });\n+            var selectedProjectRelationsHidden = selectedProjectRelations.join();\n \n-        $('#downloadLicenseInfoForm').append('<input id=\"extIdHidden\" type=\"hidden\" name=\"<portlet:namespace/><%=PortalConstants.EXTERNAL_ID_SELECTED_KEYS%>\"/>');\n-        $('#downloadLicenseInfoForm').append('<input id=\"licensInfoFileFormat\" type=\"hidden\" name=\"<portlet:namespace/><%=PortalConstants.LICENSE_INFO_SELECTED_OUTPUT_FORMAT%>\"/>');\n-        $('#downloadLicenseInfoForm').append('<input id=\"releaseRelationship\" type=\"hidden\" name=\"<portlet:namespace/><%=PortalConstants.SELECTED_PROJECT_RELEASE_RELATIONS%>\"/>');\n-        $('#downloadLicenseInfoForm').append('<input id=\"selectedProjectRelations\" type=\"hidden\" name=\"<portlet:namespace/><%=PortalConstants.SELECTED_PROJECT_RELATIONS%>\"/>');\n-        $('#downloadLicenseInfoForm').append('<input id=\"isSubProjPresent\" type=\"hidden\" name=\"<portlet:namespace/><%=PortalConstants.IS_LINKED_PROJECT_PRESENT%>\"/>');\n+            $('#downloadLicenseInfoForm').append('<input id=\"extIdHidden\" type=\"hidden\" name=\"<portlet:namespace/><%=PortalConstants.EXTERNAL_ID_SELECTED_KEYS%>\"/>');\n+            $('#downloadLicenseInfoForm').append('<input id=\"licensInfoFileFormat\" type=\"hidden\" name=\"<portlet:namespace/><%=PortalConstants.LICENSE_INFO_SELECTED_OUTPUT_FORMAT%>\"/>');\n+            $('#downloadLicenseInfoForm').append('<input id=\"releaseRelationship\" type=\"hidden\" name=\"<portlet:namespace/><%=PortalConstants.SELECTED_PROJECT_RELEASE_RELATIONS%>\"/>');\n+            $('#downloadLicenseInfoForm').append('<input id=\"selectedProjectRelations\" type=\"hidden\" name=\"<portlet:namespace/><%=PortalConstants.SELECTED_PROJECT_RELATIONS%>\"/>');\n+            $('#downloadLicenseInfoForm').append('<input id=\"isSubProjPresent\" type=\"hidden\" name=\"<portlet:namespace/><%=PortalConstants.IS_LINKED_PROJECT_PRESENT%>\"/>');\n \n+            $(\"#extIdHidden\").val(extIdsHidden);\n+            $(\"#licensInfoFileFormat\").val(licenseInfoSelectedOutputFormat);\n+            $(\"#releaseRelationship\").val(releaseRelationsHidden);\n+            $(\"#selectedProjectRelations\").val(selectedProjectRelationsHidden);\n+            $(\"#isSubProjPresent\").val(${not empty linkedProjectRelation});\n \n-        $(\"#extIdHidden\").val(extIdsHidden);\n-        $(\"#licensInfoFileFormat\").val(licenseInfoSelectedOutputFormat);\n-        $(\"#releaseRelationship\").val(releaseRelationsHidden);\n-        $(\"#selectedProjectRelations\").val(selectedProjectRelationsHidden);\n-        $(\"#isSubProjPresent\").val(${not empty linkedProjectRelation});\n+            $('#downloadLicenseInfoForm').submit();\n+        } else {\n+            $('#downloadLicenseInfoForm').append('<input id=\"licensInfoFileFormat\" type=\"hidden\" name=\"<portlet:namespace/><%=PortalConstants.LICENSE_INFO_SELECTED_OUTPUT_FORMAT%>\"/>');\n+            $('#downloadLicenseInfoForm').append('<input id=\"isEmptyFile\" type=\"hidden\" value=\"Yes\" name=\"<portlet:namespace/><%=PortalConstants.LICENSE_INFO_EMPTY_FILE%>\" />');\n+            if(outputFormat !== 'undefined' && outputFormat) {\n+                $(\"#licensInfoFileFormat\").val(outputFormat);\n+            } else {\n+                $(\"#licensInfoFileFormat\").val(licenseInfoSelectedOutputFormat);\n+            }\n+            $('#downloadLicenseInfoForm').submit();\n+        }\n+    }\n+\n+    function downloadClearingReportOnly(isEmptyFile) {\n+        if(isEmptyFile === \"undefined\" || !isEmptyFile) {\n+            let releaseRelations = [];\n+            let selectedProjectRelations = [];\n+            $.each($(\"input[name='releaseRelationSelection']:checked\"), function(){\n+                releaseRelations.push($(this).val());\n+            });\n+            let releaseRelationsHidden = releaseRelations.join();\n \n-        $('#downloadLicenseInfoForm').submit();\n+            $.each($(\"input[name='projectRelationSelection']:checked\"), function(){\n+                selectedProjectRelations.push($(this).val());\n+            });\n+            var selectedProjectRelationsHidden = selectedProjectRelations.join();\n+            $('#downloadLicenseInfoForm').append('<input id=\"licensInfoFileFormat\" type=\"hidden\" value=\"DocxGenerator::REPORT\" name=\"<portlet:namespace/><%=PortalConstants.LICENSE_INFO_SELECTED_OUTPUT_FORMAT%>\" />');\n+            $('#downloadLicenseInfoForm').append('<input id=\"isSubProjPresent\" type=\"hidden\" name=\"<portlet:namespace/><%=PortalConstants.IS_LINKED_PROJECT_PRESENT%>\"/>');\n+            $('#downloadLicenseInfoForm').append('<input id=\"releaseRelationship\" type=\"hidden\" name=\"<portlet:namespace/><%=PortalConstants.SELECTED_PROJECT_RELEASE_RELATIONS%>\"/>');\n+            $('#downloadLicenseInfoForm').append('<input id=\"selectedProjectRelations\" type=\"hidden\" name=\"<portlet:namespace/><%=PortalConstants.SELECTED_PROJECT_RELATIONS%>\"/>');\n+            $(\"#isSubProjPresent\").val(${not empty linkedProjectRelation});\n+            $(\"#releaseRelationship\").val(releaseRelationsHidden);\n+            $(\"#selectedProjectRelations\").val(selectedProjectRelationsHidden);\n+            $('#downloadLicenseInfoForm').submit();\n+        } else {\n+            $('#downloadLicenseInfoForm').append('<input id=\"licensInfoFileFormat\" type=\"hidden\" value=\"DocxGenerator::REPORT\" name=\"<portlet:namespace/><%=PortalConstants.LICENSE_INFO_SELECTED_OUTPUT_FORMAT%>\" />');\n+            $('#downloadLicenseInfoForm').append('<input id=\"isEmptyFile\" type=\"hidden\" value=\"Yes\" name=\"<portlet:namespace/><%=PortalConstants.LICENSE_INFO_EMPTY_FILE%>\" />');\n+            $('#downloadLicenseInfoForm').submit();\n+        }\n     }\n \n-    function downloadClearingReportOnly() {\n-        let releaseRelations = [];\n-        let selectedProjectRelations = [];\n-        $.each($(\"input[name='releaseRelationSelection']:checked\"), function(){\n-            releaseRelations.push($(this).val());\n+    function checkIfSelectedAttachmentsExist() {\n+        var attchmntIdToFilename = [];\n+\n+        $.each($(\"input[name='<portlet:namespace/><%=PortalConstants.LICENSE_INFO_RELEASE_TO_ATTACHMENT%>']:checked\"), function() {\n+            let selectedAttachmentIdsWithPath = $(this).val();\n+            let fileName = $(this).closest('td').next('td').next('td').text();\n+            let selectedAttachmentIdsWithPathArray = selectedAttachmentIdsWithPath.split(\":\");\n+            let attchmntId = selectedAttachmentIdsWithPathArray[selectedAttachmentIdsWithPathArray.length - 1];\n+\n+            let attchIdToFname = fileName+\":\"+attchmntId;\n+            attchmntIdToFilename.push(attchIdToFname);\n         });\n-        let releaseRelationsHidden = releaseRelations.join();\n \n-        $.each($(\"input[name='projectRelationSelection']:checked\"), function(){\n-            selectedProjectRelations.push($(this).val());\n+        return jQuery.ajax({\n+            type: 'POST',\n+            url: '<%=checkIfAttachmentExists%>',\n+            async: false,\n+            data: {\n+                \"<portlet:namespace/><%=PortalConstants.ATTACHMENT_ID_TO_FILENAMES%>\": attchmntIdToFilename\n+            },\n+            success: function (data) {\n+\n+            }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ce286ec9bb032c48e7ab349eecbbde78d5ac1b7c"}, "originalPosition": 200}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTkxMTc1Nw==", "bodyText": "I think it's okay to keep it as it is for readability purpose.", "url": "https://github.com/eclipse/sw360/pull/951#discussion_r479911757", "createdAt": "2020-08-31T06:04:28Z", "author": {"login": "smrutis1"}, "path": "frontend/sw360-portlet/src/main/resources/META-INF/resources/html/projects/licenseInfo.jsp", "diffHunk": "@@ -138,74 +147,148 @@\n <script>\n require(['jquery', 'modules/dialog'], function($, dialog) {\n     let onlyClearingReport = '${onlyClearingReport}';\n+    let downloadEmptyTemplate = '${showSessionError}';\n+    let outputFormat = '${licInfoSelectedOutputFormat}';\n     $('#selectVariantAndDownload').on('click', selectVariantAndSubmit);\n     function selectVariantAndSubmit(){\n         dialog.open('#downloadLicenseInfoDialog','',function(submit, callback) {\n             callback(true);\n         });\n     }\n-    if(onlyClearingReport == 'true') {\n-        $('#downloadFileModal').on('click', downloadClearingReportOnly);\n-    } else {\n-        $('#downloadFileModal').on('click', downloadFile);\n+\n+    if(downloadEmptyTemplate) {\n+        if(onlyClearingReport == 'true') {\n+            downloadClearingReportOnly(true);\n+        } else {\n+            downloadFile(true, outputFormat);\n+        }\n     }\n \n-    function downloadFile(){\n-        var licenseInfoSelectedOutputFormat = $('input[name=\"outputFormat\"]:checked').val();\n-        var externalIds = [];\n-        var releaseRelations = [];\n-        var selectedProjectRelations = [];\n-        $.each($(\"input[name='externalIdsSelection']:checked\"), function(){\n-            externalIds.push($(this).val());\n+    $('#downloadFileModal').on('click', function() {\n+        checkIfSelectedAttachmentsExist().done(function(data){\n+            if(typeof data.attachmentNames !== 'undefined' && data.attachmentNames) {\n+                downloadLicenseInfo(data.attachmentNames);\n+            } else {\n+                if(onlyClearingReport == 'true') {\n+                    downloadClearingReportOnly(false);\n+                } else {\n+                    downloadFile(false);\n+                }\n+            }\n         });\n-        var extIdsHidden = externalIds.join(',');\n+    });\n \n-        $.each($(\"input[name='releaseRelationSelection']:checked\"), function(){\n-            releaseRelations.push($(this).val());\n-        });\n-        var releaseRelationsHidden = releaseRelations.join();\n+    function downloadFile(isEmptyFile, outputFormat){\n+        var licenseInfoSelectedOutputFormat = $('input[name=\"outputFormat\"]:checked').val();\n+        if(isEmptyFile === \"undefined\" || !isEmptyFile){\n+            var externalIds = [];\n+            var releaseRelations = [];\n+            var selectedProjectRelations = [];\n+            $.each($(\"input[name='externalIdsSelection']:checked\"), function(){\n+                externalIds.push($(this).val());\n+            });\n+            var extIdsHidden = externalIds.join(',');\n \n-        $.each($(\"input[name='projectRelationSelection']:checked\"), function(){\n-            selectedProjectRelations.push($(this).val());\n-        });\n-        var selectedProjectRelationsHidden = selectedProjectRelations.join();\n+            $.each($(\"input[name='releaseRelationSelection']:checked\"), function(){\n+                releaseRelations.push($(this).val());\n+            });\n+            var releaseRelationsHidden = releaseRelations.join();\n+\n+            $.each($(\"input[name='projectRelationSelection']:checked\"), function(){\n+                selectedProjectRelations.push($(this).val());\n+            });\n+            var selectedProjectRelationsHidden = selectedProjectRelations.join();\n \n-        $('#downloadLicenseInfoForm').append('<input id=\"extIdHidden\" type=\"hidden\" name=\"<portlet:namespace/><%=PortalConstants.EXTERNAL_ID_SELECTED_KEYS%>\"/>');\n-        $('#downloadLicenseInfoForm').append('<input id=\"licensInfoFileFormat\" type=\"hidden\" name=\"<portlet:namespace/><%=PortalConstants.LICENSE_INFO_SELECTED_OUTPUT_FORMAT%>\"/>');\n-        $('#downloadLicenseInfoForm').append('<input id=\"releaseRelationship\" type=\"hidden\" name=\"<portlet:namespace/><%=PortalConstants.SELECTED_PROJECT_RELEASE_RELATIONS%>\"/>');\n-        $('#downloadLicenseInfoForm').append('<input id=\"selectedProjectRelations\" type=\"hidden\" name=\"<portlet:namespace/><%=PortalConstants.SELECTED_PROJECT_RELATIONS%>\"/>');\n-        $('#downloadLicenseInfoForm').append('<input id=\"isSubProjPresent\" type=\"hidden\" name=\"<portlet:namespace/><%=PortalConstants.IS_LINKED_PROJECT_PRESENT%>\"/>');\n+            $('#downloadLicenseInfoForm').append('<input id=\"extIdHidden\" type=\"hidden\" name=\"<portlet:namespace/><%=PortalConstants.EXTERNAL_ID_SELECTED_KEYS%>\"/>');\n+            $('#downloadLicenseInfoForm').append('<input id=\"licensInfoFileFormat\" type=\"hidden\" name=\"<portlet:namespace/><%=PortalConstants.LICENSE_INFO_SELECTED_OUTPUT_FORMAT%>\"/>');\n+            $('#downloadLicenseInfoForm').append('<input id=\"releaseRelationship\" type=\"hidden\" name=\"<portlet:namespace/><%=PortalConstants.SELECTED_PROJECT_RELEASE_RELATIONS%>\"/>');\n+            $('#downloadLicenseInfoForm').append('<input id=\"selectedProjectRelations\" type=\"hidden\" name=\"<portlet:namespace/><%=PortalConstants.SELECTED_PROJECT_RELATIONS%>\"/>');\n+            $('#downloadLicenseInfoForm').append('<input id=\"isSubProjPresent\" type=\"hidden\" name=\"<portlet:namespace/><%=PortalConstants.IS_LINKED_PROJECT_PRESENT%>\"/>');\n \n+            $(\"#extIdHidden\").val(extIdsHidden);\n+            $(\"#licensInfoFileFormat\").val(licenseInfoSelectedOutputFormat);\n+            $(\"#releaseRelationship\").val(releaseRelationsHidden);\n+            $(\"#selectedProjectRelations\").val(selectedProjectRelationsHidden);\n+            $(\"#isSubProjPresent\").val(${not empty linkedProjectRelation});\n \n-        $(\"#extIdHidden\").val(extIdsHidden);\n-        $(\"#licensInfoFileFormat\").val(licenseInfoSelectedOutputFormat);\n-        $(\"#releaseRelationship\").val(releaseRelationsHidden);\n-        $(\"#selectedProjectRelations\").val(selectedProjectRelationsHidden);\n-        $(\"#isSubProjPresent\").val(${not empty linkedProjectRelation});\n+            $('#downloadLicenseInfoForm').submit();\n+        } else {\n+            $('#downloadLicenseInfoForm').append('<input id=\"licensInfoFileFormat\" type=\"hidden\" name=\"<portlet:namespace/><%=PortalConstants.LICENSE_INFO_SELECTED_OUTPUT_FORMAT%>\"/>');\n+            $('#downloadLicenseInfoForm').append('<input id=\"isEmptyFile\" type=\"hidden\" value=\"Yes\" name=\"<portlet:namespace/><%=PortalConstants.LICENSE_INFO_EMPTY_FILE%>\" />');\n+            if(outputFormat !== 'undefined' && outputFormat) {\n+                $(\"#licensInfoFileFormat\").val(outputFormat);\n+            } else {\n+                $(\"#licensInfoFileFormat\").val(licenseInfoSelectedOutputFormat);\n+            }\n+            $('#downloadLicenseInfoForm').submit();\n+        }\n+    }\n+\n+    function downloadClearingReportOnly(isEmptyFile) {\n+        if(isEmptyFile === \"undefined\" || !isEmptyFile) {\n+            let releaseRelations = [];\n+            let selectedProjectRelations = [];\n+            $.each($(\"input[name='releaseRelationSelection']:checked\"), function(){\n+                releaseRelations.push($(this).val());\n+            });\n+            let releaseRelationsHidden = releaseRelations.join();\n \n-        $('#downloadLicenseInfoForm').submit();\n+            $.each($(\"input[name='projectRelationSelection']:checked\"), function(){\n+                selectedProjectRelations.push($(this).val());\n+            });\n+            var selectedProjectRelationsHidden = selectedProjectRelations.join();\n+            $('#downloadLicenseInfoForm').append('<input id=\"licensInfoFileFormat\" type=\"hidden\" value=\"DocxGenerator::REPORT\" name=\"<portlet:namespace/><%=PortalConstants.LICENSE_INFO_SELECTED_OUTPUT_FORMAT%>\" />');\n+            $('#downloadLicenseInfoForm').append('<input id=\"isSubProjPresent\" type=\"hidden\" name=\"<portlet:namespace/><%=PortalConstants.IS_LINKED_PROJECT_PRESENT%>\"/>');\n+            $('#downloadLicenseInfoForm').append('<input id=\"releaseRelationship\" type=\"hidden\" name=\"<portlet:namespace/><%=PortalConstants.SELECTED_PROJECT_RELEASE_RELATIONS%>\"/>');\n+            $('#downloadLicenseInfoForm').append('<input id=\"selectedProjectRelations\" type=\"hidden\" name=\"<portlet:namespace/><%=PortalConstants.SELECTED_PROJECT_RELATIONS%>\"/>');\n+            $(\"#isSubProjPresent\").val(${not empty linkedProjectRelation});\n+            $(\"#releaseRelationship\").val(releaseRelationsHidden);\n+            $(\"#selectedProjectRelations\").val(selectedProjectRelationsHidden);\n+            $('#downloadLicenseInfoForm').submit();\n+        } else {\n+            $('#downloadLicenseInfoForm').append('<input id=\"licensInfoFileFormat\" type=\"hidden\" value=\"DocxGenerator::REPORT\" name=\"<portlet:namespace/><%=PortalConstants.LICENSE_INFO_SELECTED_OUTPUT_FORMAT%>\" />');\n+            $('#downloadLicenseInfoForm').append('<input id=\"isEmptyFile\" type=\"hidden\" value=\"Yes\" name=\"<portlet:namespace/><%=PortalConstants.LICENSE_INFO_EMPTY_FILE%>\" />');\n+            $('#downloadLicenseInfoForm').submit();\n+        }\n     }\n \n-    function downloadClearingReportOnly() {\n-        let releaseRelations = [];\n-        let selectedProjectRelations = [];\n-        $.each($(\"input[name='releaseRelationSelection']:checked\"), function(){\n-            releaseRelations.push($(this).val());\n+    function checkIfSelectedAttachmentsExist() {\n+        var attchmntIdToFilename = [];\n+\n+        $.each($(\"input[name='<portlet:namespace/><%=PortalConstants.LICENSE_INFO_RELEASE_TO_ATTACHMENT%>']:checked\"), function() {\n+            let selectedAttachmentIdsWithPath = $(this).val();\n+            let fileName = $(this).closest('td').next('td').next('td').text();\n+            let selectedAttachmentIdsWithPathArray = selectedAttachmentIdsWithPath.split(\":\");\n+            let attchmntId = selectedAttachmentIdsWithPathArray[selectedAttachmentIdsWithPathArray.length - 1];\n+\n+            let attchIdToFname = fileName+\":\"+attchmntId;\n+            attchmntIdToFilename.push(attchIdToFname);\n         });\n-        let releaseRelationsHidden = releaseRelations.join();\n \n-        $.each($(\"input[name='projectRelationSelection']:checked\"), function(){\n-            selectedProjectRelations.push($(this).val());\n+        return jQuery.ajax({\n+            type: 'POST',\n+            url: '<%=checkIfAttachmentExists%>',\n+            async: false,\n+            data: {\n+                \"<portlet:namespace/><%=PortalConstants.ATTACHMENT_ID_TO_FILENAMES%>\": attchmntIdToFilename\n+            },\n+            success: function (data) {\n+\n+            }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzYyODczMQ=="}, "originalCommit": {"oid": "ce286ec9bb032c48e7ab349eecbbde78d5ac1b7c"}, "originalPosition": 200}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk2MDQzNTE5OnYy", "diffSide": "RIGHT", "path": "frontend/sw360-portlet/src/main/java/org/eclipse/sw360/portal/portlets/projects/ProjectPortlet.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMFQwNjowNjozNlrOHDsH8g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMFQwNjowNjozNlrOHDsH8g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzYzMDcwNg==", "bodyText": "Define yes as a constant and reuse in Line 451 as well", "url": "https://github.com/eclipse/sw360/pull/951#discussion_r473630706", "createdAt": "2020-08-20T06:06:36Z", "author": {"login": "JaideepPalit"}, "path": "frontend/sw360-portlet/src/main/java/org/eclipse/sw360/portal/portlets/projects/ProjectPortlet.java", "diffHunk": "@@ -1223,13 +1277,27 @@ private void prepareLicenseInfo(RenderRequest request, RenderResponse response)\n \n                 storePathsMapInRequest(request, mappedProjectLinks);\n                 storeAttachmentUsageCountInRequest(request, mappedProjectLinks, UsageData.licenseInfo(new LicenseInfoUsage(Sets.newHashSet())));\n+                if (showAttchmntSessionError != null && \"yes\".equals(showAttchmntSessionError)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ce286ec9bb032c48e7ab349eecbbde78d5ac1b7c"}, "originalPosition": 146}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk2MDQ0MjY0OnYy", "diffSide": "RIGHT", "path": "frontend/sw360-portlet/src/main/java/org/eclipse/sw360/portal/portlets/projects/ProjectPortlet.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMFQwNjowODoyNlrOHDsM3Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0zMVQwNjowNjo1OVrOHJriNQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzYzMTk2NQ==", "bodyText": "Since thriftClient wont be changing between request. It would be good to have a method which return a singleton thrift client wherever possible.", "url": "https://github.com/eclipse/sw360/pull/951#discussion_r473631965", "createdAt": "2020-08-20T06:08:26Z", "author": {"login": "JaideepPalit"}, "path": "frontend/sw360-portlet/src/main/java/org/eclipse/sw360/portal/portlets/projects/ProjectPortlet.java", "diffHunk": "@@ -529,6 +544,41 @@ private void downloadLicenseInfo(ResourceRequest request, ResourceResponse respo\n         }\n     }\n \n+    private void downloadEmptyLicenseInfo(ResourceRequest request, ResourceResponse response, Project project, User user, String outputGenerator) throws TException, IOException {\n+        final LicenseInfoService.Iface licenseInfoClient = thriftClients.makeLicenseInfoClient();\n+        LicenseInfoFile licenseInfoFile = licenseInfoClient.getLicenseInfoFile(project, user, outputGenerator,\n+                Collections.emptyMap(), Collections.emptyMap(), \"\");\n+        sendLicenseInfoResponse(request, response, project, licenseInfoFile);\n+    }\n+\n+    private void verifyIfAttachmentsExists(ResourceRequest request, ResourceResponse response) throws IOException {\n+        String attachmentIdToFnames[] = request.getParameterValues(PortalConstants.ATTACHMENT_ID_TO_FILENAMES);\n+        AttachmentService.Iface attachmentClient = thriftClients.makeAttachmentClient();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ce286ec9bb032c48e7ab349eecbbde78d5ac1b7c"}, "originalPosition": 95}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTkxMjUwMQ==", "bodyText": "I hope it's not in the context of this PR. would look good to do it in a independent PR as it might touch many files.?", "url": "https://github.com/eclipse/sw360/pull/951#discussion_r479912501", "createdAt": "2020-08-31T06:06:59Z", "author": {"login": "smrutis1"}, "path": "frontend/sw360-portlet/src/main/java/org/eclipse/sw360/portal/portlets/projects/ProjectPortlet.java", "diffHunk": "@@ -529,6 +544,41 @@ private void downloadLicenseInfo(ResourceRequest request, ResourceResponse respo\n         }\n     }\n \n+    private void downloadEmptyLicenseInfo(ResourceRequest request, ResourceResponse response, Project project, User user, String outputGenerator) throws TException, IOException {\n+        final LicenseInfoService.Iface licenseInfoClient = thriftClients.makeLicenseInfoClient();\n+        LicenseInfoFile licenseInfoFile = licenseInfoClient.getLicenseInfoFile(project, user, outputGenerator,\n+                Collections.emptyMap(), Collections.emptyMap(), \"\");\n+        sendLicenseInfoResponse(request, response, project, licenseInfoFile);\n+    }\n+\n+    private void verifyIfAttachmentsExists(ResourceRequest request, ResourceResponse response) throws IOException {\n+        String attachmentIdToFnames[] = request.getParameterValues(PortalConstants.ATTACHMENT_ID_TO_FILENAMES);\n+        AttachmentService.Iface attachmentClient = thriftClients.makeAttachmentClient();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzYzMTk2NQ=="}, "originalCommit": {"oid": "ce286ec9bb032c48e7ab349eecbbde78d5ac1b7c"}, "originalPosition": 95}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk2MDQ0NTY2OnYy", "diffSide": "RIGHT", "path": "frontend/sw360-portlet/src/main/java/org/eclipse/sw360/portal/portlets/projects/ProjectPortlet.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMFQwNjowOTowNFrOHDsOmw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMFQwNjowOTowNFrOHDsOmw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzYzMjQxMQ==", "bodyText": "Some typo in error msg", "url": "https://github.com/eclipse/sw360/pull/951#discussion_r473632411", "createdAt": "2020-08-20T06:09:04Z", "author": {"login": "JaideepPalit"}, "path": "frontend/sw360-portlet/src/main/java/org/eclipse/sw360/portal/portlets/projects/ProjectPortlet.java", "diffHunk": "@@ -118,6 +120,7 @@\n     private static final String LICENSE_NAME_WITH_TEXT_ERROR = \"error\";\n     private static final String LICENSE_NAME_WITH_TEXT_FILE = \"file\";\n     private static final String CYCLIC_LINKED_PROJECT = \"Project cannot be created/updated due to cyclic linked project present. Cyclic Hierarchy : \";\n+    private static final String ATTCHMENTS_ERROR_MSG = \"Warning!! Attchments could not be opened-->\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ce286ec9bb032c48e7ab349eecbbde78d5ac1b7c"}, "originalPosition": 20}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1168, "cost": 1, "resetAt": "2021-11-12T18:49:56Z"}}}