{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDg0NjcwNDY2", "number": 976, "title": "feat(CR-UI): Enhancement & Bug fixes", "bodyText": "Please provide a summary of your changes here.\n\n\nWhich issue is this pull request belonging to and how is it solving it? -> Refer issue #972\nDid you add or update any new dependencies that are required for your change? -> NO\n\nSuggest Reviewer\n\nYou can suggest reviewers here with an @mention.\n\nHow To Test?\n\nHow should these changes be tested by the reviewer? -> Refer issue #972\nHave you implemented any additional tests? -> NO\n\nChecklist\nMust:\n\n All related issues are referenced in commit messages and in PR\n\ncloses #972\nSigned-off-by: Abdul Kapti abdul.mannankapti@siemens.com", "createdAt": "2020-09-11T05:39:04Z", "url": "https://github.com/eclipse/sw360/pull/976", "merged": true, "mergeCommit": {"oid": "920e2013c49f5125742bb47bb4785d453099117d"}, "closed": true, "closedAt": "2020-10-15T08:35:19Z", "author": {"login": "akapti"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdLNrhFABqjM3OTExNTIzNDI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdStlAKgFqTUwOTE0Mjk3Nw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "663f0ff7658e6853681661f245445e5ecd0b03f9", "author": {"user": null}, "url": "https://github.com/eclipse/sw360/commit/663f0ff7658e6853681661f245445e5ecd0b03f9", "committedDate": "2020-09-11T05:15:24Z", "message": "feat(CR-UI): Enhancement & Bug fixes\n\nSigned-off-by: Abdul Kapti <abdul.mannankapti@siemens.com>"}, "afterCommit": {"oid": "d60ec04ff414c36149d87c8d93e506cd56fb4767", "author": {"user": null}, "url": "https://github.com/eclipse/sw360/commit/d60ec04ff414c36149d87c8d93e506cd56fb4767", "committedDate": "2020-09-22T01:26:15Z", "message": "feat(CR-UI): Enhancement & Bug fixes\n\nSigned-off-by: Abdul Kapti <abdul.mannankapti@siemens.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAwMjExNjYy", "url": "https://github.com/eclipse/sw360/pull/976#pullrequestreview-500211662", "createdAt": "2020-10-01T10:28:28Z", "commit": {"oid": "d60ec04ff414c36149d87c8d93e506cd56fb4767"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMVQxMDoyODoyOFrOHbEMzQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMVQxMDo0NjozMlrOHbExJg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODE0MjQxMw==", "bodyText": "Use Platform-Independent Line Separators wherever possible.\nSystem.lineSeparator()", "url": "https://github.com/eclipse/sw360/pull/976#discussion_r498142413", "createdAt": "2020-10-01T10:28:28Z", "author": {"login": "JaideepPalit"}, "path": "backend/src-common/src/main/java/org/eclipse/sw360/datahandler/db/ComponentDatabaseHandler.java", "diffHunk": "@@ -932,6 +940,49 @@ public RequestStatus updateRelease(Release release, User user, Iterable<Release.\n         }\n     }\n \n+    private Runnable addCrCommentForAttachmentUpdatesInRelease(Release release, Set<Attachment> updatedAttachments, User user) {\n+        return () -> {\n+            Set<Attachment> originalAttachments = CommonUtils.nullToEmptySet(release.getAttachments());\n+            // collect the attachment Ids\n+            Set<String> originalAttachmentId = originalAttachments.stream().map(Attachment::getAttachmentContentId).collect(Collectors.toSet());\n+            Set<String> updatedAttachmentId = updatedAttachments.stream().map(Attachment::getAttachmentContentId).collect(Collectors.toSet());\n+\n+            // check if attachments are updated\n+            if (!originalAttachmentId.equals(updatedAttachmentId)) {\n+                // fetch all the projects associated with this release and collect the Clearing request Ids\n+                final Set<Project> usingProjects = projectRepository.searchByReleaseId(release.getId());\n+                final Set<String> crIds = CommonUtils.nullToEmptySet(usingProjects).stream()\n+                        .filter(proj -> CommonUtils.isNotNullEmptyOrWhitespace(proj.getClearingRequestId()))\n+                        .map(Project::getClearingRequestId).collect(Collectors.toSet());\n+                if (crIds.size() > 0) {\n+                    Set<String> added = Sets.difference(updatedAttachmentId, originalAttachmentId);\n+                    Set<String> removed = Sets.difference(originalAttachmentId, updatedAttachmentId);\n+                    StringBuilder commentText = new StringBuilder(\"Attachment(s) updated for the release: <b>\")\n+                            .append(SW360Utils.printFullname(release)).append(\"</b> (\").append(release.getId()).append(\")\");\n+                    if (CommonUtils.isNotEmpty(added)) {\n+                        Set<String> attachmentNames = extractAttachmentNameWithType(updatedAttachments, added);\n+                        commentText.append(\"\\nAdded Attachments: \").append(SW360Utils.spaceJoiner.join(attachmentNames));\n+                    }\n+                    if (CommonUtils.isNotEmpty(removed)) {\n+                        Set<String> attachmentNames = extractAttachmentNameWithType(originalAttachments, removed);\n+                        commentText.append(\"\\nRemoved Attachments: \").append(SW360Utils.spaceJoiner.join(attachmentNames));\n+                    }\n+                    for (String cdId : crIds) {\n+                        Comment comment = new Comment().setText(commentText.toString()).setCommentedBy(user.getEmail()).setAutoGenerated(true);\n+                        projectModerator.addCommentToClearingRequest(cdId, comment, user);\n+                    }\n+                }\n+            }\n+        };\n+    }\n+\n+    private Set<String> extractAttachmentNameWithType(Set<Attachment> attachments, Collection<String> filterCriteria) {\n+        return attachments.stream().filter(att -> filterCriteria.contains(att.getAttachmentContentId()))\n+                .map(att -> new StringBuilder(\"\\n\\t\").append(att.getFilename()).append(DatabaseHandlerUtil.SEPARATOR)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d60ec04ff414c36149d87c8d93e506cd56fb4767"}, "originalPosition": 105}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODE0MzkxNg==", "bodyText": "Use int to prevent Autoboxing and Unboxing during increment and then convert it to string.", "url": "https://github.com/eclipse/sw360/pull/976#discussion_r498143916", "createdAt": "2020-10-01T10:31:27Z", "author": {"login": "JaideepPalit"}, "path": "backend/src-common/src/main/java/org/eclipse/sw360/datahandler/db/ProjectDatabaseHandler.java", "diffHunk": "@@ -1145,9 +1181,15 @@ private String extractReleaseNameForClearingEmail(List<Release> releases) {\n         return builder.toString();\n     }\n \n-    private int getTotalReleaseCount(ReleaseClearingStateSummary clearingSummary) {\n-        return clearingSummary.getNewRelease() + clearingSummary.getReportAvailable() + clearingSummary.getUnderClearing()\n-                + clearingSummary.getSentToClearingTool()+ clearingSummary.getApproved();\n+    private String appendCompTypeToReleaseVersion(Collection<Release> releases, Set<String> cotsCompIds) {\n+        Integer count = 0;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d60ec04ff414c36149d87c8d93e506cd56fb4767"}, "originalPosition": 97}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODE0NjUzMA==", "bodyText": "looks same like ClosedCREmailTemplate.html . Could be merged using parameter for rejected/closed", "url": "https://github.com/eclipse/sw360/pull/976#discussion_r498146530", "createdAt": "2020-10-01T10:36:30Z", "author": {"login": "JaideepPalit"}, "path": "backend/src-common/src/main/resources/RejectedCREmailemplate.html", "diffHunk": "@@ -0,0 +1,21 @@\n+<!--\r\n+  ~ Copyright Siemens AG, 2020. Part of the SW360 Portal Project.\r\n+  ~\r\n+  ~ This program and the accompanying materials are made\r\n+  ~ available under the terms of the Eclipse Public License 2.0\r\n+  ~ which is available at https://www.eclipse.org/legal/epl-2.0/\r\n+  ~\r\n+  ~ SPDX-License-Identifier: EPL-2.0\r\n+-->\r\n+<!doctype html>\r\n+<html>\r\n+  <body>\r\n+\t<p>*** This is an automatically generated email, please do not reply. ***</p>\r\n+\t<p>Dear SW360-user,\r\n+\t    Your clearing request with id: <b>%s</b> for the project: <b>%s</b> has been rejected by the clearing team.\r", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d60ec04ff414c36149d87c8d93e506cd56fb4767"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODE0ODI5OA==", "bodyText": "Should be removed from Language_ja.properties", "url": "https://github.com/eclipse/sw360/pull/976#discussion_r498148298", "createdAt": "2020-10-01T10:39:51Z", "author": {"login": "JaideepPalit"}, "path": "frontend/sw360-portlet/src/main/resources/content/Language.properties", "diffHunk": "@@ -217,7 +220,6 @@ component.owner=Component Owner\n components=Components\n components2=component(s)\n components.only=Components only\n-components.to.be.cleared=Components to be cleared", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d60ec04ff414c36149d87c8d93e506cd56fb4767"}, "originalPosition": 36}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODE0ODcyNA==", "bodyText": "indentation", "url": "https://github.com/eclipse/sw360/pull/976#discussion_r498148724", "createdAt": "2020-10-01T10:40:35Z", "author": {"login": "JaideepPalit"}, "path": "libraries/lib-datahandler/src/main/java/org/eclipse/sw360/datahandler/common/SW360Utils.java", "diffHunk": "@@ -661,6 +662,11 @@ public static EccInformation newDefaultEccInformation(){\n                 .collect(Collectors.toSet());\n     }\n \n+    public static int getTotalReleaseCount(ReleaseClearingStateSummary clearingSummary) {\n+        return clearingSummary.getNewRelease() + clearingSummary.getReportAvailable() + clearingSummary.getUnderClearing()\n+                + clearingSummary.getSentToClearingTool()+ clearingSummary.getApproved();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d60ec04ff414c36149d87c8d93e506cd56fb4767"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODE1MDI3MA==", "bodyText": "Bootstrap class can used here d-none", "url": "https://github.com/eclipse/sw360/pull/976#discussion_r498150270", "createdAt": "2020-10-01T10:43:32Z", "author": {"login": "JaideepPalit"}, "path": "frontend/sw360-portlet/src/main/resources/META-INF/resources/html/moderation/view.jsp", "diffHunk": "@@ -58,6 +63,38 @@\n \t\t\t<div class=\"card-deck\">\n                 <%@ include file=\"/html/utils/includes/quickfilter.jspf\" %>\n             </div>\n+            <div class=\"card-deck hidden\" id=\"date-quickfilter\">\n+                <div class=\"card\">\n+                    <div class=\"card-header\">\n+                        Date Filter\n+                    </div>\n+                <div class=\"card-body\">\n+                <form>\n+                    <div class=\"form-group\">\n+                        <label for=\"date_type\"><liferay-ui:message key=\"select.date.type.and.range\" />:</label>\n+                        <select class=\"form-control form-control-sm\" id=\"date_type\">\n+                            <option value=\"\" class=\"textlabel stackedLabel\" ></option>\n+                            <option value=\"<%=ClearingRequest._Fields.TIMESTAMP%>\" class=\"textlabel stackedLabel\"><liferay-ui:message key=\"created.on\" /></option>\n+                            <option value=\"<%=ClearingRequest._Fields.REQUESTED_CLEARING_DATE%>\" class=\"textlabel stackedLabel\"><liferay-ui:message key=\"preferred.clearing.date\" /></option>\n+                            <option value=\"<%=ClearingRequest._Fields.AGREED_CLEARING_DATE%>\" class=\"textlabel stackedLabel\"><liferay-ui:message key=\"agreed.clearing.date\" /></option>\n+                            <option value=\"<%=ClearingRequest._Fields.MODIFIED_ON%>\" class=\"textlabel stackedLabel\"><liferay-ui:message key=\"last.updated.on\" /></option>\n+                            <option value=\"<%=ClearingRequest._Fields.TIMESTAMP_OF_DECISION%>\" class=\"textlabel stackedLabel\"><liferay-ui:message key=\"request.closed.on\" /></option>\n+                        </select>\n+                    </div>\n+                    <div class=\"form-group\">\n+                        <select class=\"form-control form-control-sm\" id=\"date_range\" style=\"display: none;\">", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d60ec04ff414c36149d87c8d93e506cd56fb4767"}, "originalPosition": 51}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODE1MTcxOA==", "bodyText": "Should it be P-3 for all if - else cases?", "url": "https://github.com/eclipse/sw360/pull/976#discussion_r498151718", "createdAt": "2020-10-01T10:46:32Z", "author": {"login": "JaideepPalit"}, "path": "frontend/sw360-portlet/src/main/resources/META-INF/resources/html/moderation/view.jsp", "diffHunk": "@@ -290,35 +431,66 @@ AUI().use('liferay-portlet-url', function () {\n                     {title: \"<liferay-ui:message key=\"request.id\" />\", render: {display: renderClearingRequestUrl}, className: 'text-nowrap', width: \"5%\" },\n                     {title: \"<liferay-ui:message key=\"business.area.line\" />\", className: 'text-nowrap', width: \"10%\" },\n                     {title: \"<liferay-ui:message key=\"project\" />\", width: \"15%\" },\n-                    {title: \"<liferay-ui:message key=\"components.to.be.cleared\" />\", width: \"8%\" },\n+                    {title: \"<liferay-ui:message key=\"number.of.components.to.be.cleared\" />\", width: \"8%\" },\n                     {title: \"<liferay-ui:message key=\"status\" />\", width: \"10%\" },\n                     {title: \"<liferay-ui:message key=\"requesting.user\" />\", className: 'text-nowrap', width: \"10%\" },\n+                    {title: \"<liferay-ui:message key=\"clearing.progress\" />\", className: 'text-nowrap', width: \"21%\" },\n+                    {title: \"<liferay-ui:message key=\"clearing.team\" />\", className: 'text-nowrap', width: \"15%\" },\n                     {title: \"<liferay-ui:message key=\"created.on\" />\", className: 'text-nowrap', width: \"7%\" },\n-                    {title: \"<liferay-ui:message key=\"preferred.clearing.date\" />\", width: \"7%\" },\n+                    {title: \"<liferay-ui:message key=\"preferred.clearing.date\" />\", width: \"8%\" },\n                     {title: \"<liferay-ui:message key=\"agreed.clearing.date\" />\", width: \"7%\" },\n-                    {title: \"<liferay-ui:message key=\"clearing.team\" />\", className: 'text-nowrap', width: \"15%\" },\n-                    {title: \"<liferay-ui:message key=\"actions\" />\", render: {display: renderClearingRequestAction}, className: 'one action',  width: \"5%\" }\n+                    {title: \"<liferay-ui:message key=\"modified.on\" />\", width: \"7%\" },\n+                    {title: \"<liferay-ui:message key=\"request.closed.on\" />\", width: \"7%\" },\n+                    {title: \"<liferay-ui:message key=\"actions\" />\", render: {display: renderClearingRequestAction}, className: 'one action',  width: \"5%\" },\n                 ],\n                 language: {\n                     emptyTable: \"<liferay-ui:message key='no.clearing.request.found'/>\"\n                 },\n                 columnDefs: [\n                     {\n-                        targets: [0, 3],\n+                        targets: [0],\n                         type: 'natural-nohtml'\n                     },\n+                    {\n+                        \"targets\": hiddenCol,\n+                        \"visible\": false\n+                    }\n                 ],\n                 order: [[0, 'asc']],\n                 initComplete: function (oSettings) {\n                     datatables.showPageContainer;\n                     loadProjectDetails(tableId, tableData);\n                 }\n-            }, [0,1,2,3,4,5,6,7,8,9], [10]);\n+            }, [0,1,2,3,4,5,7,8,9,10,11,12], [6,13]);\n         }\n \n         function renderClearingRequestUrl(tableData, type, row) {\n-            let portletURL = '<%=friendlyClearingURL%>';\n-            return render.linkTo(replaceFriendlyUrlParameter(portletURL.toString(), row.DT_RowId, '<%=PortalConstants.PAGENAME_DETAIL_CLEARING_REQUEST%>'), row.DT_RowId);\n+            let portletURL = '<%=friendlyClearingURL%>',\n+                rcd = row[9],\n+                span =  document.createElement('span'),\n+                isClosed = row[4].includes('sw360-tt-ClearingRequestState-CLOSED') || row[4].includes('sw360-tt-ClearingRequestState-REJECTED');\n+            let url = render.linkTo(replaceFriendlyUrlParameter(portletURL.toString(), row.DT_RowId, '<%=PortalConstants.PAGENAME_DETAIL_CLEARING_REQUEST%>'), \"\", row.DT_RowId);\n+            if (!isClosed) {\n+                span.setAttribute(\"class\",\"align-top badge\");\n+                if (validation.isValidDate(rcd, 21)) { // green --> greater than 21 days\n+                    span.innerHTML = \"P-3\";\n+                    $(span).html('P-3').addClass('badge-info');\n+                } else if (validation.isValidDate(rcd, 14)) { // yellow --> greater than 14 days but less than 21 days\n+                    span.innerHTML = \"P-3\";\n+                    $(span).html('P-2').addClass('badge-primary');\n+                } else if (validation.isValidDate(rcd, 7)) { // orange --> greater than 7 days but less than 14 days\n+                    span.innerHTML = \"P-3\";\n+                    $(span).html('P-1').addClass('badge-warning');\n+                } else if (validation.isValidDate(rcd, 1)) { // red --> greater than today but less than 7 days\n+                    span.innerHTML = \"P-3\";\n+                    $(span).html('P-0').addClass('badge-danger');\n+                } else { // red --> today\n+                    span.innerHTML = \"P-3\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d60ec04ff414c36149d87c8d93e506cd56fb4767"}, "originalPosition": 332}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d60ec04ff414c36149d87c8d93e506cd56fb4767", "author": {"user": null}, "url": "https://github.com/eclipse/sw360/commit/d60ec04ff414c36149d87c8d93e506cd56fb4767", "committedDate": "2020-09-22T01:26:15Z", "message": "feat(CR-UI): Enhancement & Bug fixes\n\nSigned-off-by: Abdul Kapti <abdul.mannankapti@siemens.com>"}, "afterCommit": {"oid": "9326077bfa201fa9ae8798ebe90619d4c42aab02", "author": {"user": null}, "url": "https://github.com/eclipse/sw360/commit/9326077bfa201fa9ae8798ebe90619d4c42aab02", "committedDate": "2020-10-01T16:09:58Z", "message": "feat(CR-UI): Enhancement & Bug fixes\n\nSigned-off-by: Abdul Kapti <abdul.mannankapti@siemens.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAyNjc5MzE1", "url": "https://github.com/eclipse/sw360/pull/976#pullrequestreview-502679315", "createdAt": "2020-10-06T08:02:13Z", "commit": {"oid": "9326077bfa201fa9ae8798ebe90619d4c42aab02"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "04020bef3fcf78be506cbe237faa2f5df4206961", "author": {"user": null}, "url": "https://github.com/eclipse/sw360/commit/04020bef3fcf78be506cbe237faa2f5df4206961", "committedDate": "2020-10-07T08:55:02Z", "message": "feat(CR-UI): Enhancement & Bug fixes\n\nSigned-off-by: Abdul Kapti <abdul.mannankapti@siemens.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "9326077bfa201fa9ae8798ebe90619d4c42aab02", "author": {"user": null}, "url": "https://github.com/eclipse/sw360/commit/9326077bfa201fa9ae8798ebe90619d4c42aab02", "committedDate": "2020-10-01T16:09:58Z", "message": "feat(CR-UI): Enhancement & Bug fixes\n\nSigned-off-by: Abdul Kapti <abdul.mannankapti@siemens.com>"}, "afterCommit": {"oid": "04020bef3fcf78be506cbe237faa2f5df4206961", "author": {"user": null}, "url": "https://github.com/eclipse/sw360/commit/04020bef3fcf78be506cbe237faa2f5df4206961", "committedDate": "2020-10-07T08:55:02Z", "message": "feat(CR-UI): Enhancement & Bug fixes\n\nSigned-off-by: Abdul Kapti <abdul.mannankapti@siemens.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA5MTQyOTc3", "url": "https://github.com/eclipse/sw360/pull/976#pullrequestreview-509142977", "createdAt": "2020-10-15T08:34:01Z", "commit": {"oid": "04020bef3fcf78be506cbe237faa2f5df4206961"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4842, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}