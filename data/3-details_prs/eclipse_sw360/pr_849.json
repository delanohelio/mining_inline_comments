{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE2NDg2Mzg2", "number": 849, "title": "fix(mergeComponent): Prevent multiple releases with same name and version for a component, which may occur during merge component.", "bodyText": "Prevent multiple releases with same name and version for a component, which may occur during merge component.\nProvided suffix _conflict (id) for releases of src component with same version as of target component's releases\n\nWhich issue is this pull request belonging to and how is it solving it? (#848)\nDid you add or update any new dependencies that are required for your change?- No\n\n\nHow To Test?\n\nMerge two Component with same release version. Target component should not have Release with same name and version, suffix should be added to the release from src component to indicate conflict, which can be resolved later by merging of release.\nHave you implemented any additional tests? - No\n\nChecklist\nMust:\n\n All related issues are referenced in commit messages and in PR\n\nSigned-off-by: Jaideep Palit jaideep.palit@siemens.com", "createdAt": "2020-05-12T05:01:34Z", "url": "https://github.com/eclipse/sw360/pull/849", "merged": true, "mergeCommit": {"oid": "f6b33847e094da8851d1d6bc29db7f935a9e9e76"}, "closed": true, "closedAt": "2020-05-22T08:19:40Z", "author": {"login": "JaideepPalit"}, "timelineItems": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcgPxd8AH2gAyNDE2NDg2Mzg2Ojc5ZjVjOWQ0ZDY3Mzk2ZjM1YzU5N2YwOTA4YzY4ODUzNjJlMjRhMDc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcjDkC1gFqTQxNTAzOTE0OQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "79f5c9d4d67396f35c597f0908c6885362e24a07", "author": {"user": {"login": "JaideepPalit", "name": "Jaideep Palit"}}, "url": "https://github.com/eclipse/sw360/commit/79f5c9d4d67396f35c597f0908c6885362e24a07", "committedDate": "2020-05-11T13:34:16Z", "message": "fix(mergeComponent): Prevent multiple releases with same name and version for a component, which may occur during merge component.\n\n  * Provided suffix[_conflict (id)] for releases of src component with same version as of target component's releases\n\nSigned-off-by: Jaideep Palit <jaideep.palit@siemens.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE1MDM5MTQ5", "url": "https://github.com/eclipse/sw360/pull/849#pullrequestreview-415039149", "createdAt": "2020-05-20T06:53:14Z", "commit": {"oid": "79f5c9d4d67396f35c597f0908c6885362e24a07"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMFQwNjo1MzoxNFrOGX9l6w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMFQwNjo1MzoxNFrOGX9l6w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzc3OTU2Mw==", "bodyText": "If possible, consider using StringBuilder for concatenation.", "url": "https://github.com/eclipse/sw360/pull/849#discussion_r427779563", "createdAt": "2020-05-20T06:53:14Z", "author": {"login": "akapti"}, "path": "backend/src-common/src/main/java/org/eclipse/sw360/datahandler/db/ComponentDatabaseHandler.java", "diffHunk": "@@ -804,14 +806,24 @@ private void transferReleases(Set<String> releaseIds, Component mergeTarget, Com\n         releaseIds.forEach(mergeTarget::addToReleaseIds);\n     }\n \n-    private void updateReleasesAfterMerge(Set<String> releaseIds, Component mergeSelection, Component mergeTarget, User sessionUser) throws SW360Exception {\n+    private void updateReleasesAfterMerge(Set<String> targetComponentReleaseIds, Set<String> srcComponentReleaseIds,\n+            Component mergeSelection, Component mergeTarget, User sessionUser) throws SW360Exception {\n         // Change release name if appropriate\n-        List<Release> releases = getReleasesForClearingStateSummary(releaseIds);\n+        List<Release> targetComponentReleases = getReleasesForClearingStateSummary(targetComponentReleaseIds);\n+        List<Release> srcComponentReleases = getReleasesForClearingStateSummary(srcComponentReleaseIds);\n+        Set<String> targetComponentReleaseVersions = targetComponentReleases.stream().map(Release::getVersion)\n+                .collect(Collectors.toSet());\n+        Set<Release> releases = Stream.concat(targetComponentReleases.stream(), srcComponentReleases.stream())\n+                .collect(Collectors.toSet());\n+\n         List<Release> releasesToUpdate = releases.stream()\n             .filter( r -> {\n                 return !(r.getComponentId().equals(mergeTarget.getId()) && r.getName().equals(mergeSelection.getName()));\n             }).map(r -> {\n                 Release releaseBefore = r.deepCopy();\n+                if (srcComponentReleases.contains(r) && targetComponentReleaseVersions.contains(r.getVersion())) {\n+                        r.setVersion(r.getVersion() + \"_conflict (\" + r.getId() + \")\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "79f5c9d4d67396f35c597f0908c6885362e24a07"}, "originalPosition": 53}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4913, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}