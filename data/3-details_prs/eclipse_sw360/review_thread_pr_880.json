{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDMxNjMxMzY5", "number": 880, "reviewThreads": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNVQxMDoyOTo1N1rOEItBzg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNVQxMToyMTo0MFrOEIt9VQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc3NTYxODA2OnYy", "diffSide": "RIGHT", "path": "scripts/migrations/018_remove_unwanted_field_from_clearing_request.py", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNVQxMDoyOTo1N1rOGo01cA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQwNDo0OTo1N1rOGpTluw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTQ2MTg3Mg==", "bodyText": "Kindly Change the description according to your script, same for Line 39", "url": "https://github.com/eclipse/sw360/pull/880#discussion_r445461872", "createdAt": "2020-06-25T10:29:57Z", "author": {"login": "JaideepPalit"}, "path": "scripts/migrations/018_remove_unwanted_field_from_clearing_request.py", "diffHunk": "@@ -0,0 +1,98 @@\n+#!/usr/bin/python\r\n+# -----------------------------------------------------------------------------\r\n+# Copyright Siemens AG, 2020. Part of the SW360 Portal Project.\r\n+#\r\n+# This program and the accompanying materials are made\r\n+# available under the terms of the Eclipse Public License 2.0\r\n+# which is available at https://www.eclipse.org/legal/epl-2.0/\r\n+#\r\n+# SPDX-License-Identifier: EPL-2.0\r\n+#\r\n+# This is a manual database migration script. It is assumed that a\r\n+# dedicated framework for automatic migration will be written in the\r\n+# future. When that happens, this script should be refactored to conform\r\n+# to the framework's prerequisites to be run by the framework. For\r\n+# example, server address and db name should be parameterized, the code\r\n+# reorganized into a single class or function, etc.\r\n+#\r\n+# This script updates releases with empty clearingState to default value - NEW_CLEARING.\r", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e05f282123a18e427afae6973a39fd81e04ef2e8"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTk2NTc1NQ==", "bodyText": "changed the description.", "url": "https://github.com/eclipse/sw360/pull/880#discussion_r445965755", "createdAt": "2020-06-26T04:49:57Z", "author": {"login": "akapti"}, "path": "scripts/migrations/018_remove_unwanted_field_from_clearing_request.py", "diffHunk": "@@ -0,0 +1,98 @@\n+#!/usr/bin/python\r\n+# -----------------------------------------------------------------------------\r\n+# Copyright Siemens AG, 2020. Part of the SW360 Portal Project.\r\n+#\r\n+# This program and the accompanying materials are made\r\n+# available under the terms of the Eclipse Public License 2.0\r\n+# which is available at https://www.eclipse.org/legal/epl-2.0/\r\n+#\r\n+# SPDX-License-Identifier: EPL-2.0\r\n+#\r\n+# This is a manual database migration script. It is assumed that a\r\n+# dedicated framework for automatic migration will be written in the\r\n+# future. When that happens, this script should be refactored to conform\r\n+# to the framework's prerequisites to be run by the framework. For\r\n+# example, server address and db name should be parameterized, the code\r\n+# reorganized into a single class or function, etc.\r\n+#\r\n+# This script updates releases with empty clearingState to default value - NEW_CLEARING.\r", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTQ2MTg3Mg=="}, "originalCommit": {"oid": "e05f282123a18e427afae6973a39fd81e04ef2e8"}, "originalPosition": 18}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc3NTYxOTg1OnYy", "diffSide": "RIGHT", "path": "scripts/migrations/018_remove_unwanted_field_from_clearing_request.py", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNVQxMDozMDoyNFrOGo02bA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQwNDo1Mzo0NFrOGpTotw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTQ2MjEyNA==", "bodyText": "DRY_RUN  should be true by default", "url": "https://github.com/eclipse/sw360/pull/880#discussion_r445462124", "createdAt": "2020-06-25T10:30:24Z", "author": {"login": "JaideepPalit"}, "path": "scripts/migrations/018_remove_unwanted_field_from_clearing_request.py", "diffHunk": "@@ -0,0 +1,98 @@\n+#!/usr/bin/python\r\n+# -----------------------------------------------------------------------------\r\n+# Copyright Siemens AG, 2020. Part of the SW360 Portal Project.\r\n+#\r\n+# This program and the accompanying materials are made\r\n+# available under the terms of the Eclipse Public License 2.0\r\n+# which is available at https://www.eclipse.org/legal/epl-2.0/\r\n+#\r\n+# SPDX-License-Identifier: EPL-2.0\r\n+#\r\n+# This is a manual database migration script. It is assumed that a\r\n+# dedicated framework for automatic migration will be written in the\r\n+# future. When that happens, this script should be refactored to conform\r\n+# to the framework's prerequisites to be run by the framework. For\r\n+# example, server address and db name should be parameterized, the code\r\n+# reorganized into a single class or function, etc.\r\n+#\r\n+# This script updates releases with empty clearingState to default value - NEW_CLEARING.\r\n+# -----------------------------------------------------------------------------\r\n+\r\n+import time\r\n+import couchdb\r\n+import json\r\n+from webbrowser import get\r\n+\r\n+# ---------------------------------------\r\n+# constants\r\n+# ---------------------------------------\r\n+\r\n+DRY_RUN = False\r", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e05f282123a18e427afae6973a39fd81e04ef2e8"}, "originalPosition": 30}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTk2NjUxOQ==", "bodyText": "done.", "url": "https://github.com/eclipse/sw360/pull/880#discussion_r445966519", "createdAt": "2020-06-26T04:53:44Z", "author": {"login": "akapti"}, "path": "scripts/migrations/018_remove_unwanted_field_from_clearing_request.py", "diffHunk": "@@ -0,0 +1,98 @@\n+#!/usr/bin/python\r\n+# -----------------------------------------------------------------------------\r\n+# Copyright Siemens AG, 2020. Part of the SW360 Portal Project.\r\n+#\r\n+# This program and the accompanying materials are made\r\n+# available under the terms of the Eclipse Public License 2.0\r\n+# which is available at https://www.eclipse.org/legal/epl-2.0/\r\n+#\r\n+# SPDX-License-Identifier: EPL-2.0\r\n+#\r\n+# This is a manual database migration script. It is assumed that a\r\n+# dedicated framework for automatic migration will be written in the\r\n+# future. When that happens, this script should be refactored to conform\r\n+# to the framework's prerequisites to be run by the framework. For\r\n+# example, server address and db name should be parameterized, the code\r\n+# reorganized into a single class or function, etc.\r\n+#\r\n+# This script updates releases with empty clearingState to default value - NEW_CLEARING.\r\n+# -----------------------------------------------------------------------------\r\n+\r\n+import time\r\n+import couchdb\r\n+import json\r\n+from webbrowser import get\r\n+\r\n+# ---------------------------------------\r\n+# constants\r\n+# ---------------------------------------\r\n+\r\n+DRY_RUN = False\r", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTQ2MjEyNA=="}, "originalCommit": {"oid": "e05f282123a18e427afae6973a39fd81e04ef2e8"}, "originalPosition": 30}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc3NTYyMTczOnYy", "diffSide": "RIGHT", "path": "scripts/migrations/018_remove_unwanted_field_from_clearing_request.py", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNVQxMDozMTowMVrOGo03kQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQwNDo1MDoxOVrOGpTmBQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTQ2MjQxNw==", "bodyText": "project doc is not used later in the script", "url": "https://github.com/eclipse/sw360/pull/880#discussion_r445462417", "createdAt": "2020-06-25T10:31:01Z", "author": {"login": "JaideepPalit"}, "path": "scripts/migrations/018_remove_unwanted_field_from_clearing_request.py", "diffHunk": "@@ -0,0 +1,98 @@\n+#!/usr/bin/python\r\n+# -----------------------------------------------------------------------------\r\n+# Copyright Siemens AG, 2020. Part of the SW360 Portal Project.\r\n+#\r\n+# This program and the accompanying materials are made\r\n+# available under the terms of the Eclipse Public License 2.0\r\n+# which is available at https://www.eclipse.org/legal/epl-2.0/\r\n+#\r\n+# SPDX-License-Identifier: EPL-2.0\r\n+#\r\n+# This is a manual database migration script. It is assumed that a\r\n+# dedicated framework for automatic migration will be written in the\r\n+# future. When that happens, this script should be refactored to conform\r\n+# to the framework's prerequisites to be run by the framework. For\r\n+# example, server address and db name should be parameterized, the code\r\n+# reorganized into a single class or function, etc.\r\n+#\r\n+# This script updates releases with empty clearingState to default value - NEW_CLEARING.\r\n+# -----------------------------------------------------------------------------\r\n+\r\n+import time\r\n+import couchdb\r\n+import json\r\n+from webbrowser import get\r\n+\r\n+# ---------------------------------------\r\n+# constants\r\n+# ---------------------------------------\r\n+\r\n+DRY_RUN = False\r\n+\r\n+COUCHSERVER = \"http://localhost:5984/\"\r\n+DBNAME = 'sw360db'\r\n+\r\n+couch = couchdb.Server(COUCHSERVER)\r\n+db = couch[DBNAME]\r\n+\r\n+\r\n+# set default values for clearingState field of Release\r\n+fieldValue = \"clearingTeamComment\"\r\n+\r\n+\r\n+# ----------------------------------------\r\n+# queries\r\n+# ----------------------------------------\r\n+\r\n+# get all the clearing requests\r\n+cr_all_query = '''function(doc){\r\n+    if (doc.type == \"clearingRequest\"){\r\n+        emit(doc._id, doc)\r\n+    }\r\n+}'''\r\n+\r\n+# ---------------------------------------\r\n+# functions\r\n+# ---------------------------------------\r\n+\r\n+def run():\r\n+    log = {}\r\n+    count = 0;\r\n+    log['updatedCR'] = []\r\n+    print 'Getting all clearing requests'\r\n+    clearing_request_all = db.query(cr_all_query)\r\n+    print 'found ' + str(len(clearing_request_all)) + ' clearing requests in db!'\r\n+    log['totalCount'] = len(clearing_request_all)\r\n+\r\n+    for crRow in clearing_request_all:\r\n+        cr = crRow.value\r\n+\r\n+\tif fieldValue in cr:\r\n+\t\tif 'projectId' in cr:\r\n+\t\t\tproject = db.get(cr.get('projectId'))\r", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e05f282123a18e427afae6973a39fd81e04ef2e8"}, "originalPosition": 72}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTk2NTgyOQ==", "bodyText": "removed this code.", "url": "https://github.com/eclipse/sw360/pull/880#discussion_r445965829", "createdAt": "2020-06-26T04:50:19Z", "author": {"login": "akapti"}, "path": "scripts/migrations/018_remove_unwanted_field_from_clearing_request.py", "diffHunk": "@@ -0,0 +1,98 @@\n+#!/usr/bin/python\r\n+# -----------------------------------------------------------------------------\r\n+# Copyright Siemens AG, 2020. Part of the SW360 Portal Project.\r\n+#\r\n+# This program and the accompanying materials are made\r\n+# available under the terms of the Eclipse Public License 2.0\r\n+# which is available at https://www.eclipse.org/legal/epl-2.0/\r\n+#\r\n+# SPDX-License-Identifier: EPL-2.0\r\n+#\r\n+# This is a manual database migration script. It is assumed that a\r\n+# dedicated framework for automatic migration will be written in the\r\n+# future. When that happens, this script should be refactored to conform\r\n+# to the framework's prerequisites to be run by the framework. For\r\n+# example, server address and db name should be parameterized, the code\r\n+# reorganized into a single class or function, etc.\r\n+#\r\n+# This script updates releases with empty clearingState to default value - NEW_CLEARING.\r\n+# -----------------------------------------------------------------------------\r\n+\r\n+import time\r\n+import couchdb\r\n+import json\r\n+from webbrowser import get\r\n+\r\n+# ---------------------------------------\r\n+# constants\r\n+# ---------------------------------------\r\n+\r\n+DRY_RUN = False\r\n+\r\n+COUCHSERVER = \"http://localhost:5984/\"\r\n+DBNAME = 'sw360db'\r\n+\r\n+couch = couchdb.Server(COUCHSERVER)\r\n+db = couch[DBNAME]\r\n+\r\n+\r\n+# set default values for clearingState field of Release\r\n+fieldValue = \"clearingTeamComment\"\r\n+\r\n+\r\n+# ----------------------------------------\r\n+# queries\r\n+# ----------------------------------------\r\n+\r\n+# get all the clearing requests\r\n+cr_all_query = '''function(doc){\r\n+    if (doc.type == \"clearingRequest\"){\r\n+        emit(doc._id, doc)\r\n+    }\r\n+}'''\r\n+\r\n+# ---------------------------------------\r\n+# functions\r\n+# ---------------------------------------\r\n+\r\n+def run():\r\n+    log = {}\r\n+    count = 0;\r\n+    log['updatedCR'] = []\r\n+    print 'Getting all clearing requests'\r\n+    clearing_request_all = db.query(cr_all_query)\r\n+    print 'found ' + str(len(clearing_request_all)) + ' clearing requests in db!'\r\n+    log['totalCount'] = len(clearing_request_all)\r\n+\r\n+    for crRow in clearing_request_all:\r\n+        cr = crRow.value\r\n+\r\n+\tif fieldValue in cr:\r\n+\t\tif 'projectId' in cr:\r\n+\t\t\tproject = db.get(cr.get('projectId'))\r", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTQ2MjQxNw=="}, "originalCommit": {"oid": "e05f282123a18e427afae6973a39fd81e04ef2e8"}, "originalPosition": 72}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc3NTYyNDM5OnYy", "diffSide": "RIGHT", "path": "scripts/migrations/018_remove_unwanted_field_from_clearing_request.py", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNVQxMDozMTo1OFrOGo05QQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQwNDo1MDo0OVrOGpTmag==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTQ2Mjg0OQ==", "bodyText": "Kindly remove tab from the script and maintain same indentation rule for each level", "url": "https://github.com/eclipse/sw360/pull/880#discussion_r445462849", "createdAt": "2020-06-25T10:31:58Z", "author": {"login": "JaideepPalit"}, "path": "scripts/migrations/018_remove_unwanted_field_from_clearing_request.py", "diffHunk": "@@ -0,0 +1,98 @@\n+#!/usr/bin/python\r\n+# -----------------------------------------------------------------------------\r\n+# Copyright Siemens AG, 2020. Part of the SW360 Portal Project.\r\n+#\r\n+# This program and the accompanying materials are made\r\n+# available under the terms of the Eclipse Public License 2.0\r\n+# which is available at https://www.eclipse.org/legal/epl-2.0/\r\n+#\r\n+# SPDX-License-Identifier: EPL-2.0\r\n+#\r\n+# This is a manual database migration script. It is assumed that a\r\n+# dedicated framework for automatic migration will be written in the\r\n+# future. When that happens, this script should be refactored to conform\r\n+# to the framework's prerequisites to be run by the framework. For\r\n+# example, server address and db name should be parameterized, the code\r\n+# reorganized into a single class or function, etc.\r\n+#\r\n+# This script updates releases with empty clearingState to default value - NEW_CLEARING.\r\n+# -----------------------------------------------------------------------------\r\n+\r\n+import time\r\n+import couchdb\r\n+import json\r\n+from webbrowser import get\r\n+\r\n+# ---------------------------------------\r\n+# constants\r\n+# ---------------------------------------\r\n+\r\n+DRY_RUN = False\r\n+\r\n+COUCHSERVER = \"http://localhost:5984/\"\r\n+DBNAME = 'sw360db'\r\n+\r\n+couch = couchdb.Server(COUCHSERVER)\r\n+db = couch[DBNAME]\r\n+\r\n+\r\n+# set default values for clearingState field of Release\r\n+fieldValue = \"clearingTeamComment\"\r\n+\r\n+\r\n+# ----------------------------------------\r\n+# queries\r\n+# ----------------------------------------\r\n+\r\n+# get all the clearing requests\r\n+cr_all_query = '''function(doc){\r\n+    if (doc.type == \"clearingRequest\"){\r\n+        emit(doc._id, doc)\r\n+    }\r\n+}'''\r\n+\r\n+# ---------------------------------------\r\n+# functions\r\n+# ---------------------------------------\r\n+\r\n+def run():\r\n+    log = {}\r\n+    count = 0;\r\n+    log['updatedCR'] = []\r\n+    print 'Getting all clearing requests'\r\n+    clearing_request_all = db.query(cr_all_query)\r\n+    print 'found ' + str(len(clearing_request_all)) + ' clearing requests in db!'\r\n+    log['totalCount'] = len(clearing_request_all)\r\n+\r\n+    for crRow in clearing_request_all:\r\n+        cr = crRow.value\r\n+\r\n+\tif fieldValue in cr:\r", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e05f282123a18e427afae6973a39fd81e04ef2e8"}, "originalPosition": 70}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTk2NTkzMA==", "bodyText": "fixed indentation.", "url": "https://github.com/eclipse/sw360/pull/880#discussion_r445965930", "createdAt": "2020-06-26T04:50:49Z", "author": {"login": "akapti"}, "path": "scripts/migrations/018_remove_unwanted_field_from_clearing_request.py", "diffHunk": "@@ -0,0 +1,98 @@\n+#!/usr/bin/python\r\n+# -----------------------------------------------------------------------------\r\n+# Copyright Siemens AG, 2020. Part of the SW360 Portal Project.\r\n+#\r\n+# This program and the accompanying materials are made\r\n+# available under the terms of the Eclipse Public License 2.0\r\n+# which is available at https://www.eclipse.org/legal/epl-2.0/\r\n+#\r\n+# SPDX-License-Identifier: EPL-2.0\r\n+#\r\n+# This is a manual database migration script. It is assumed that a\r\n+# dedicated framework for automatic migration will be written in the\r\n+# future. When that happens, this script should be refactored to conform\r\n+# to the framework's prerequisites to be run by the framework. For\r\n+# example, server address and db name should be parameterized, the code\r\n+# reorganized into a single class or function, etc.\r\n+#\r\n+# This script updates releases with empty clearingState to default value - NEW_CLEARING.\r\n+# -----------------------------------------------------------------------------\r\n+\r\n+import time\r\n+import couchdb\r\n+import json\r\n+from webbrowser import get\r\n+\r\n+# ---------------------------------------\r\n+# constants\r\n+# ---------------------------------------\r\n+\r\n+DRY_RUN = False\r\n+\r\n+COUCHSERVER = \"http://localhost:5984/\"\r\n+DBNAME = 'sw360db'\r\n+\r\n+couch = couchdb.Server(COUCHSERVER)\r\n+db = couch[DBNAME]\r\n+\r\n+\r\n+# set default values for clearingState field of Release\r\n+fieldValue = \"clearingTeamComment\"\r\n+\r\n+\r\n+# ----------------------------------------\r\n+# queries\r\n+# ----------------------------------------\r\n+\r\n+# get all the clearing requests\r\n+cr_all_query = '''function(doc){\r\n+    if (doc.type == \"clearingRequest\"){\r\n+        emit(doc._id, doc)\r\n+    }\r\n+}'''\r\n+\r\n+# ---------------------------------------\r\n+# functions\r\n+# ---------------------------------------\r\n+\r\n+def run():\r\n+    log = {}\r\n+    count = 0;\r\n+    log['updatedCR'] = []\r\n+    print 'Getting all clearing requests'\r\n+    clearing_request_all = db.query(cr_all_query)\r\n+    print 'found ' + str(len(clearing_request_all)) + ' clearing requests in db!'\r\n+    log['totalCount'] = len(clearing_request_all)\r\n+\r\n+    for crRow in clearing_request_all:\r\n+        cr = crRow.value\r\n+\r\n+\tif fieldValue in cr:\r", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTQ2Mjg0OQ=="}, "originalCommit": {"oid": "e05f282123a18e427afae6973a39fd81e04ef2e8"}, "originalPosition": 70}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc3NTY0MzYwOnYy", "diffSide": "RIGHT", "path": "scripts/migrations/018_remove_unwanted_field_from_clearing_request.py", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNVQxMDozNzo1N1rOGo1E_g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQwNDo1MzozNVrOGpTomg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTQ2NTg1NA==", "bodyText": "File name is varied based on fieldValue", "url": "https://github.com/eclipse/sw360/pull/880#discussion_r445465854", "createdAt": "2020-06-25T10:37:57Z", "author": {"login": "JaideepPalit"}, "path": "scripts/migrations/018_remove_unwanted_field_from_clearing_request.py", "diffHunk": "@@ -0,0 +1,98 @@\n+#!/usr/bin/python\r\n+# -----------------------------------------------------------------------------\r\n+# Copyright Siemens AG, 2020. Part of the SW360 Portal Project.\r\n+#\r\n+# This program and the accompanying materials are made\r\n+# available under the terms of the Eclipse Public License 2.0\r\n+# which is available at https://www.eclipse.org/legal/epl-2.0/\r\n+#\r\n+# SPDX-License-Identifier: EPL-2.0\r\n+#\r\n+# This is a manual database migration script. It is assumed that a\r\n+# dedicated framework for automatic migration will be written in the\r\n+# future. When that happens, this script should be refactored to conform\r\n+# to the framework's prerequisites to be run by the framework. For\r\n+# example, server address and db name should be parameterized, the code\r\n+# reorganized into a single class or function, etc.\r\n+#\r\n+# This script updates releases with empty clearingState to default value - NEW_CLEARING.\r\n+# -----------------------------------------------------------------------------\r\n+\r\n+import time\r\n+import couchdb\r\n+import json\r\n+from webbrowser import get\r\n+\r\n+# ---------------------------------------\r\n+# constants\r\n+# ---------------------------------------\r\n+\r\n+DRY_RUN = False\r\n+\r\n+COUCHSERVER = \"http://localhost:5984/\"\r\n+DBNAME = 'sw360db'\r\n+\r\n+couch = couchdb.Server(COUCHSERVER)\r\n+db = couch[DBNAME]\r\n+\r\n+\r\n+# set default values for clearingState field of Release\r\n+fieldValue = \"clearingTeamComment\"\r\n+\r\n+\r\n+# ----------------------------------------\r\n+# queries\r\n+# ----------------------------------------\r\n+\r\n+# get all the clearing requests\r\n+cr_all_query = '''function(doc){\r\n+    if (doc.type == \"clearingRequest\"){\r\n+        emit(doc._id, doc)\r\n+    }\r\n+}'''\r\n+\r\n+# ---------------------------------------\r\n+# functions\r\n+# ---------------------------------------\r\n+\r\n+def run():\r\n+    log = {}\r\n+    count = 0;\r\n+    log['updatedCR'] = []\r\n+    print 'Getting all clearing requests'\r\n+    clearing_request_all = db.query(cr_all_query)\r\n+    print 'found ' + str(len(clearing_request_all)) + ' clearing requests in db!'\r\n+    log['totalCount'] = len(clearing_request_all)\r\n+\r\n+    for crRow in clearing_request_all:\r\n+        cr = crRow.value\r\n+\r\n+\tif fieldValue in cr:\r\n+\t\tif 'projectId' in cr:\r\n+\t\t\tproject = db.get(cr.get('projectId'))\r\n+\r\n+\t        print '\\tUpdating Clearing Request ID -> ' + cr.get('_id')\r\n+\t        del cr[fieldValue]\r\n+\t        updatedCR = {}\r\n+\t        updatedCR['id'] = cr.get('_id')\r\n+\t        log['updatedCR'].append(updatedCR)\r\n+\t\tcount = count + 1\r\n+\t        if not DRY_RUN:\r\n+\t            db.save(cr)\r\n+\t\t    print '\\tUpdated Clearing Request ID -> ' + cr.get('_id')\r\n+    resultFile = open('018_clearing_request_migration_'+fieldValue+'.log', 'w')\r\n+    json.dump(log, resultFile, indent = 4, sort_keys = True)\r\n+    resultFile.close()\r\n+\r\n+    print '\\n'\r\n+    print '------------------------------------------'\r\n+    print 'Total Clearing Request updated : ' + str(count)\r\n+    print '------------------------------------------'\r\n+    print 'Please check log file \"018_clearing_request_migration_fieldName.log\" in this directory for details'\r", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e05f282123a18e427afae6973a39fd81e04ef2e8"}, "originalPosition": 91}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTk2NjQ5MA==", "bodyText": "removed fieldName from file name.", "url": "https://github.com/eclipse/sw360/pull/880#discussion_r445966490", "createdAt": "2020-06-26T04:53:35Z", "author": {"login": "akapti"}, "path": "scripts/migrations/018_remove_unwanted_field_from_clearing_request.py", "diffHunk": "@@ -0,0 +1,98 @@\n+#!/usr/bin/python\r\n+# -----------------------------------------------------------------------------\r\n+# Copyright Siemens AG, 2020. Part of the SW360 Portal Project.\r\n+#\r\n+# This program and the accompanying materials are made\r\n+# available under the terms of the Eclipse Public License 2.0\r\n+# which is available at https://www.eclipse.org/legal/epl-2.0/\r\n+#\r\n+# SPDX-License-Identifier: EPL-2.0\r\n+#\r\n+# This is a manual database migration script. It is assumed that a\r\n+# dedicated framework for automatic migration will be written in the\r\n+# future. When that happens, this script should be refactored to conform\r\n+# to the framework's prerequisites to be run by the framework. For\r\n+# example, server address and db name should be parameterized, the code\r\n+# reorganized into a single class or function, etc.\r\n+#\r\n+# This script updates releases with empty clearingState to default value - NEW_CLEARING.\r\n+# -----------------------------------------------------------------------------\r\n+\r\n+import time\r\n+import couchdb\r\n+import json\r\n+from webbrowser import get\r\n+\r\n+# ---------------------------------------\r\n+# constants\r\n+# ---------------------------------------\r\n+\r\n+DRY_RUN = False\r\n+\r\n+COUCHSERVER = \"http://localhost:5984/\"\r\n+DBNAME = 'sw360db'\r\n+\r\n+couch = couchdb.Server(COUCHSERVER)\r\n+db = couch[DBNAME]\r\n+\r\n+\r\n+# set default values for clearingState field of Release\r\n+fieldValue = \"clearingTeamComment\"\r\n+\r\n+\r\n+# ----------------------------------------\r\n+# queries\r\n+# ----------------------------------------\r\n+\r\n+# get all the clearing requests\r\n+cr_all_query = '''function(doc){\r\n+    if (doc.type == \"clearingRequest\"){\r\n+        emit(doc._id, doc)\r\n+    }\r\n+}'''\r\n+\r\n+# ---------------------------------------\r\n+# functions\r\n+# ---------------------------------------\r\n+\r\n+def run():\r\n+    log = {}\r\n+    count = 0;\r\n+    log['updatedCR'] = []\r\n+    print 'Getting all clearing requests'\r\n+    clearing_request_all = db.query(cr_all_query)\r\n+    print 'found ' + str(len(clearing_request_all)) + ' clearing requests in db!'\r\n+    log['totalCount'] = len(clearing_request_all)\r\n+\r\n+    for crRow in clearing_request_all:\r\n+        cr = crRow.value\r\n+\r\n+\tif fieldValue in cr:\r\n+\t\tif 'projectId' in cr:\r\n+\t\t\tproject = db.get(cr.get('projectId'))\r\n+\r\n+\t        print '\\tUpdating Clearing Request ID -> ' + cr.get('_id')\r\n+\t        del cr[fieldValue]\r\n+\t        updatedCR = {}\r\n+\t        updatedCR['id'] = cr.get('_id')\r\n+\t        log['updatedCR'].append(updatedCR)\r\n+\t\tcount = count + 1\r\n+\t        if not DRY_RUN:\r\n+\t            db.save(cr)\r\n+\t\t    print '\\tUpdated Clearing Request ID -> ' + cr.get('_id')\r\n+    resultFile = open('018_clearing_request_migration_'+fieldValue+'.log', 'w')\r\n+    json.dump(log, resultFile, indent = 4, sort_keys = True)\r\n+    resultFile.close()\r\n+\r\n+    print '\\n'\r\n+    print '------------------------------------------'\r\n+    print 'Total Clearing Request updated : ' + str(count)\r\n+    print '------------------------------------------'\r\n+    print 'Please check log file \"018_clearing_request_migration_fieldName.log\" in this directory for details'\r", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTQ2NTg1NA=="}, "originalCommit": {"oid": "e05f282123a18e427afae6973a39fd81e04ef2e8"}, "originalPosition": 91}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc3NTc3MDQ1OnYy", "diffSide": "RIGHT", "path": "scripts/migrations/018_remove_unwanted_field_from_clearing_request.py", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNVQxMToyMTo0MFrOGo2VpQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQwNDo1Mjo0M1rOGpTn7g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTQ4NjUwMQ==", "bodyText": "Instead of fetching all CRs and then filtering in a for loop.\nIt would be good to fetch all Docs containing the field\n'''function(doc){\n    if (doc.type == \"clearingRequest\" && doc.'''+ fieldValue +''' !=null){\n        emit(doc._id, doc)\n    }\n}'''", "url": "https://github.com/eclipse/sw360/pull/880#discussion_r445486501", "createdAt": "2020-06-25T11:21:40Z", "author": {"login": "JaideepPalit"}, "path": "scripts/migrations/018_remove_unwanted_field_from_clearing_request.py", "diffHunk": "@@ -0,0 +1,98 @@\n+#!/usr/bin/python\r\n+# -----------------------------------------------------------------------------\r\n+# Copyright Siemens AG, 2020. Part of the SW360 Portal Project.\r\n+#\r\n+# This program and the accompanying materials are made\r\n+# available under the terms of the Eclipse Public License 2.0\r\n+# which is available at https://www.eclipse.org/legal/epl-2.0/\r\n+#\r\n+# SPDX-License-Identifier: EPL-2.0\r\n+#\r\n+# This is a manual database migration script. It is assumed that a\r\n+# dedicated framework for automatic migration will be written in the\r\n+# future. When that happens, this script should be refactored to conform\r\n+# to the framework's prerequisites to be run by the framework. For\r\n+# example, server address and db name should be parameterized, the code\r\n+# reorganized into a single class or function, etc.\r\n+#\r\n+# This script updates releases with empty clearingState to default value - NEW_CLEARING.\r\n+# -----------------------------------------------------------------------------\r\n+\r\n+import time\r\n+import couchdb\r\n+import json\r\n+from webbrowser import get\r\n+\r\n+# ---------------------------------------\r\n+# constants\r\n+# ---------------------------------------\r\n+\r\n+DRY_RUN = False\r\n+\r\n+COUCHSERVER = \"http://localhost:5984/\"\r\n+DBNAME = 'sw360db'\r\n+\r\n+couch = couchdb.Server(COUCHSERVER)\r\n+db = couch[DBNAME]\r\n+\r\n+\r\n+# set default values for clearingState field of Release\r\n+fieldValue = \"clearingTeamComment\"\r\n+\r\n+\r\n+# ----------------------------------------\r\n+# queries\r\n+# ----------------------------------------\r\n+\r\n+# get all the clearing requests\r\n+cr_all_query = '''function(doc){\r\n+    if (doc.type == \"clearingRequest\"){\r\n+        emit(doc._id, doc)\r\n+    }\r\n+}'''\r", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e05f282123a18e427afae6973a39fd81e04ef2e8"}, "originalPosition": 52}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTk2NjMxOA==", "bodyText": "done.", "url": "https://github.com/eclipse/sw360/pull/880#discussion_r445966318", "createdAt": "2020-06-26T04:52:43Z", "author": {"login": "akapti"}, "path": "scripts/migrations/018_remove_unwanted_field_from_clearing_request.py", "diffHunk": "@@ -0,0 +1,98 @@\n+#!/usr/bin/python\r\n+# -----------------------------------------------------------------------------\r\n+# Copyright Siemens AG, 2020. Part of the SW360 Portal Project.\r\n+#\r\n+# This program and the accompanying materials are made\r\n+# available under the terms of the Eclipse Public License 2.0\r\n+# which is available at https://www.eclipse.org/legal/epl-2.0/\r\n+#\r\n+# SPDX-License-Identifier: EPL-2.0\r\n+#\r\n+# This is a manual database migration script. It is assumed that a\r\n+# dedicated framework for automatic migration will be written in the\r\n+# future. When that happens, this script should be refactored to conform\r\n+# to the framework's prerequisites to be run by the framework. For\r\n+# example, server address and db name should be parameterized, the code\r\n+# reorganized into a single class or function, etc.\r\n+#\r\n+# This script updates releases with empty clearingState to default value - NEW_CLEARING.\r\n+# -----------------------------------------------------------------------------\r\n+\r\n+import time\r\n+import couchdb\r\n+import json\r\n+from webbrowser import get\r\n+\r\n+# ---------------------------------------\r\n+# constants\r\n+# ---------------------------------------\r\n+\r\n+DRY_RUN = False\r\n+\r\n+COUCHSERVER = \"http://localhost:5984/\"\r\n+DBNAME = 'sw360db'\r\n+\r\n+couch = couchdb.Server(COUCHSERVER)\r\n+db = couch[DBNAME]\r\n+\r\n+\r\n+# set default values for clearingState field of Release\r\n+fieldValue = \"clearingTeamComment\"\r\n+\r\n+\r\n+# ----------------------------------------\r\n+# queries\r\n+# ----------------------------------------\r\n+\r\n+# get all the clearing requests\r\n+cr_all_query = '''function(doc){\r\n+    if (doc.type == \"clearingRequest\"){\r\n+        emit(doc._id, doc)\r\n+    }\r\n+}'''\r", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTQ4NjUwMQ=="}, "originalCommit": {"oid": "e05f282123a18e427afae6973a39fd81e04ef2e8"}, "originalPosition": 52}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1274, "cost": 1, "resetAt": "2021-11-12T18:49:56Z"}}}