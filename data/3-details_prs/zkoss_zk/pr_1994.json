{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE2NDYwMDky", "number": 1994, "title": "ZK-4175: replace XHR with the fetch() API to allow SSO redirect handling", "bodyText": "", "createdAt": "2020-05-12T03:19:40Z", "url": "https://github.com/zkoss/zk/pull/1994", "merged": true, "mergeCommit": {"oid": "4d6e4a0b23ab05abeaa654df78d2b1225355003b"}, "closed": true, "closedAt": "2020-05-14T08:44:22Z", "author": {"login": "plijyfes"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcgbwtdABqjMzMjU2MDQ1NTk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABchJa_0gFqTQxMTU4OTQyNA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3fd0be2406e6378c8c3dd225346e5ff23aa3fc36", "author": {"user": {"login": "plijyfes", "name": "LeonLee"}}, "url": "https://github.com/zkoss/zk/commit/3fd0be2406e6378c8c3dd225346e5ff23aa3fc36", "committedDate": "2020-05-12T03:17:36Z", "message": "ZK-4175: replace XHR with the fetch() API to allow SSO redirect handling"}, "afterCommit": {"oid": "a0c0c3b5d0068a066803adac37afb37c769e0f5c", "author": {"user": {"login": "plijyfes", "name": "LeonLee"}}, "url": "https://github.com/zkoss/zk/commit/a0c0c3b5d0068a066803adac37afb37c769e0f5c", "committedDate": "2020-05-12T03:32:02Z", "message": "ZK-4175: replace XHR with the fetch() API to allow SSO redirect handling"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a0c0c3b5d0068a066803adac37afb37c769e0f5c", "author": {"user": {"login": "plijyfes", "name": "LeonLee"}}, "url": "https://github.com/zkoss/zk/commit/a0c0c3b5d0068a066803adac37afb37c769e0f5c", "committedDate": "2020-05-12T03:32:02Z", "message": "ZK-4175: replace XHR with the fetch() API to allow SSO redirect handling"}, "afterCommit": {"oid": "e5890e0b6d2e834d8a79b4689d76a6493963cb02", "author": {"user": {"login": "plijyfes", "name": "LeonLee"}}, "url": "https://github.com/zkoss/zk/commit/e5890e0b6d2e834d8a79b4689d76a6493963cb02", "committedDate": "2020-05-12T04:32:53Z", "message": "ZK-4175: replace XHR with the fetch() API to allow SSO redirect handling"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA5ODU3MTYz", "url": "https://github.com/zkoss/zk/pull/1994#pullrequestreview-409857163", "createdAt": "2020-05-12T09:21:06Z", "commit": {"oid": "e5890e0b6d2e834d8a79b4689d76a6493963cb02"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQwOToyMTowNlrOGT92vg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQwOToyODo1M1rOGT-JvA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzU4OTU2Ng==", "bodyText": "response.statusText", "url": "https://github.com/zkoss/zk/pull/1994#discussion_r423589566", "createdAt": "2020-05-12T09:21:06Z", "author": {"login": "scribetw"}, "path": "zk/src/archive/web/js/zk/au.js", "diffHunk": "@@ -957,22 +948,22 @@ zAu.beforeSend = function (uri, req, dt) {\n \t\t&& (!reqInf.rtags || !reqInf.rtags.onTimer || zk.timerAlive)) // Bug ZK-2720 only timer-keep-alive should reset the timeout\n \t\t\tzAu._resetTimeout();\n \n-\t\tif (zAu.pushReqCmds(reqInf, req)) { //valid response\n+\t\tif (zAu.pushReqCmds(reqInf, response)) { //valid response\n \t\t\t//advance SID to avoid receive the same response twice\n \t\t\tif (sid && ++zAu.seqId > 9999) zAu.seqId = 1;\n \t\t\tzAu.ajaxReqTries = 0;\n \t\t\tzAu.pendingReqInf = null;\n \t\t}\n \t},\n-\t_respFailure: function (req, reqInf, rstatus) {\n+\t_respFailure: function (response, reqInf, rstatus) {\n \t\tvar eru = zAu._errURIs['' + rstatus];\n \t\tif (typeof eru == 'string') {\n \t\t\tzUtl.go(eru);\n \t\t\treturn true;\n \t\t}\n \n \t\tif (typeof zAu.ajaxErrorHandler == 'function') {\n-\t\t\tzAu.ajaxReqTries = zAu.ajaxErrorHandler(req, rstatus, req.statusText, zAu.ajaxReqTries);\n+\t\t\tzAu.ajaxReqTries = zAu.ajaxErrorHandler(response, rstatus, req.statusText, zAu.ajaxReqTries);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e5890e0b6d2e834d8a79b4689d76a6493963cb02"}, "originalPosition": 208}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzU5MTg0Nw==", "bodyText": "?", "url": "https://github.com/zkoss/zk/pull/1994#discussion_r423591847", "createdAt": "2020-05-12T09:24:57Z", "author": {"login": "scribetw"}, "path": "zk/src/archive/web/js/zk/au.js", "diffHunk": "@@ -1042,31 +1033,32 @@ zAu.beforeSend = function (uri, req, dt) {\n \t */\n \t//cmd1: null, //jsdoc\n \n-\tpushReqCmds: function (reqInf, req) {\n+\tpushReqCmds: function (reqInf, response) {\n \t\tvar dt = reqInf.dt,\n-\t\t\trt = req.responseText;\n+\t\t\trt = response.responseText;\n \t\tif (!rt) {\n-\t\t\tif (zk.pfmeter) zAu._pfdone(dt, zAu.pfGetIds(req));\n+\t\t\tif (zk.pfmeter) zAu._pfdone(dt, zAu.pfGetIds(response));\n \t\t\treturn false; //invalid\n \t\t}\n \n \t\tvar cmds = [];\n \t\tcmds.rtags = reqInf.rtags;\n \t\tif (zk.pfmeter) {\n \t\t\tcmds.dt = dt;\n-\t\t\tcmds.pfIds = zAu.pfGetIds(req);\n+\t\t\tcmds.pfIds = zAu.pfGetIds(response);\n \t\t}\n \n \t\ttry {\n \t\t\trt = jq.evalJSON(rt);\n \t\t} catch (e) {\n \t\t\tif (e.name == 'SyntaxError') { //ZK-4199: handle json parse error\n \t\t\t\tzAu.showError('FAILED_TO_PARSE_RESPONSE', e.message);\n-\t\t\t\tzk.debugLog(e.message + ', response text:\\n' + req.responseText);\n+\t\t\t\tzk.debugLog(e.message + ', response text:\\n' + rt);\n \t\t\t\treturn false;\n \t\t\t}\n \t\t\tthrow e;\n \t\t}\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e5890e0b6d2e834d8a79b4689d76a6493963cb02"}, "originalPosition": 246}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzU5MjM3MA==", "bodyText": "?", "url": "https://github.com/zkoss/zk/pull/1994#discussion_r423592370", "createdAt": "2020-05-12T09:25:44Z", "author": {"login": "scribetw"}, "path": "zk/src/archive/web/js/zk/au.js", "diffHunk": "@@ -1042,31 +1033,32 @@ zAu.beforeSend = function (uri, req, dt) {\n \t */\n \t//cmd1: null, //jsdoc\n \n-\tpushReqCmds: function (reqInf, req) {\n+\tpushReqCmds: function (reqInf, response) {\n \t\tvar dt = reqInf.dt,\n-\t\t\trt = req.responseText;\n+\t\t\trt = response.responseText;\n \t\tif (!rt) {\n-\t\t\tif (zk.pfmeter) zAu._pfdone(dt, zAu.pfGetIds(req));\n+\t\t\tif (zk.pfmeter) zAu._pfdone(dt, zAu.pfGetIds(response));\n \t\t\treturn false; //invalid\n \t\t}\n \n \t\tvar cmds = [];\n \t\tcmds.rtags = reqInf.rtags;\n \t\tif (zk.pfmeter) {\n \t\t\tcmds.dt = dt;\n-\t\t\tcmds.pfIds = zAu.pfGetIds(req);\n+\t\t\tcmds.pfIds = zAu.pfGetIds(response);\n \t\t}\n \n \t\ttry {\n \t\t\trt = jq.evalJSON(rt);\n \t\t} catch (e) {\n \t\t\tif (e.name == 'SyntaxError') { //ZK-4199: handle json parse error\n \t\t\t\tzAu.showError('FAILED_TO_PARSE_RESPONSE', e.message);\n-\t\t\t\tzk.debugLog(e.message + ', response text:\\n' + req.responseText);\n+\t\t\t\tzk.debugLog(e.message + ', response text:\\n' + rt);\n \t\t\t\treturn false;\n \t\t\t}\n \t\t\tthrow e;\n \t\t}\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e5890e0b6d2e834d8a79b4689d76a6493963cb02"}, "originalPosition": 246}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzU5NDQyOA==", "bodyText": "zAu.onError API changes", "url": "https://github.com/zkoss/zk/pull/1994#discussion_r423594428", "createdAt": "2020-05-12T09:28:53Z", "author": {"login": "scribetw"}, "path": "zk/src/archive/web/js/zk/au.js", "diffHunk": "@@ -1138,10 +1130,10 @@ zAu.beforeSend = function (uri, req, dt) {\n \t\t\tsetTimeout(ajaxReqResend2, timeout ? timeout : 0);\n \t\t}\n \t},\n-\tonResponseError: function (req, errCode) {\n+\tonResponseError: function (response, errCode) {\n \t\t//$clone first since it might add or remove onError\n \t\tfor (var errs = _onErrs.$clone(), fn; fn = errs.shift();)\n-\t\t\tif (fn(req, errCode))\n+\t\t\tif (fn(response, errCode))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e5890e0b6d2e834d8a79b4689d76a6493963cb02"}, "originalPosition": 270}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e5890e0b6d2e834d8a79b4689d76a6493963cb02", "author": {"user": {"login": "plijyfes", "name": "LeonLee"}}, "url": "https://github.com/zkoss/zk/commit/e5890e0b6d2e834d8a79b4689d76a6493963cb02", "committedDate": "2020-05-12T04:32:53Z", "message": "ZK-4175: replace XHR with the fetch() API to allow SSO redirect handling"}, "afterCommit": {"oid": "c0f66bc88bfeaa6fa024155569cdf7579c373d2c", "author": {"user": {"login": "plijyfes", "name": "LeonLee"}}, "url": "https://github.com/zkoss/zk/commit/c0f66bc88bfeaa6fa024155569cdf7579c373d2c", "committedDate": "2020-05-13T04:38:52Z", "message": "ZK-4175: replace XHR with the fetch() API to allow SSO redirect handling"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c0f66bc88bfeaa6fa024155569cdf7579c373d2c", "author": {"user": {"login": "plijyfes", "name": "LeonLee"}}, "url": "https://github.com/zkoss/zk/commit/c0f66bc88bfeaa6fa024155569cdf7579c373d2c", "committedDate": "2020-05-13T04:38:52Z", "message": "ZK-4175: replace XHR with the fetch() API to allow SSO redirect handling"}, "afterCommit": {"oid": "cd859a243334d58e56ca5531bd6e2612b4ace2d6", "author": {"user": {"login": "plijyfes", "name": "LeonLee"}}, "url": "https://github.com/zkoss/zk/commit/cd859a243334d58e56ca5531bd6e2612b4ace2d6", "committedDate": "2020-05-13T04:53:33Z", "message": "ZK-4175: replace XHR with the fetch() API to allow SSO redirect handling"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "cd859a243334d58e56ca5531bd6e2612b4ace2d6", "author": {"user": {"login": "plijyfes", "name": "LeonLee"}}, "url": "https://github.com/zkoss/zk/commit/cd859a243334d58e56ca5531bd6e2612b4ace2d6", "committedDate": "2020-05-13T04:53:33Z", "message": "ZK-4175: replace XHR with the fetch() API to allow SSO redirect handling"}, "afterCommit": {"oid": "10a5f819c4471744b95352852599e91f5b7e120f", "author": {"user": {"login": "plijyfes", "name": "LeonLee"}}, "url": "https://github.com/zkoss/zk/commit/10a5f819c4471744b95352852599e91f5b7e120f", "committedDate": "2020-05-13T06:47:37Z", "message": "ZK-4175: replace XHR with the fetch() API to allow SSO redirect handling"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDExNTM2OTI3", "url": "https://github.com/zkoss/zk/pull/1994#pullrequestreview-411536927", "createdAt": "2020-05-14T07:35:04Z", "commit": {"oid": "10a5f819c4471744b95352852599e91f5b7e120f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNFQwNzozNTowNFrOGVPl-g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNFQwNzozNTowNFrOGVPl-g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDkyODc2Mg==", "bodyText": ".js", "url": "https://github.com/zkoss/zk/pull/1994#discussion_r424928762", "createdAt": "2020-05-14T07:35:04Z", "author": {"login": "plijyfes"}, "path": "zk/src/archive/web/js/zk/ext/promise-polyfill.js", "diffHunk": "@@ -0,0 +1,312 @@\n+/* promise-polyfill.js.ts", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "10a5f819c4471744b95352852599e91f5b7e120f"}, "originalPosition": 1}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b361b3ab2e72a4635b5d9148f64fcc7d558c8771", "author": {"user": {"login": "plijyfes", "name": "LeonLee"}}, "url": "https://github.com/zkoss/zk/commit/b361b3ab2e72a4635b5d9148f64fcc7d558c8771", "committedDate": "2020-05-14T08:33:32Z", "message": "ZK-4175: replace XHR with the fetch() API to allow SSO redirect handling"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "10a5f819c4471744b95352852599e91f5b7e120f", "author": {"user": {"login": "plijyfes", "name": "LeonLee"}}, "url": "https://github.com/zkoss/zk/commit/10a5f819c4471744b95352852599e91f5b7e120f", "committedDate": "2020-05-13T06:47:37Z", "message": "ZK-4175: replace XHR with the fetch() API to allow SSO redirect handling"}, "afterCommit": {"oid": "b361b3ab2e72a4635b5d9148f64fcc7d558c8771", "author": {"user": {"login": "plijyfes", "name": "LeonLee"}}, "url": "https://github.com/zkoss/zk/commit/b361b3ab2e72a4635b5d9148f64fcc7d558c8771", "committedDate": "2020-05-14T08:33:32Z", "message": "ZK-4175: replace XHR with the fetch() API to allow SSO redirect handling"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDExNTg5MTMy", "url": "https://github.com/zkoss/zk/pull/1994#pullrequestreview-411589132", "createdAt": "2020-05-14T08:43:51Z", "commit": {"oid": "b361b3ab2e72a4635b5d9148f64fcc7d558c8771"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDExNTg5NDI0", "url": "https://github.com/zkoss/zk/pull/1994#pullrequestreview-411589424", "createdAt": "2020-05-14T08:44:13Z", "commit": {"oid": "b361b3ab2e72a4635b5d9148f64fcc7d558c8771"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4972, "cost": 1, "resetAt": "2021-11-02T12:20:56Z"}}}