{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDk3NjY1ODk1", "number": 2200, "title": "ZK-4688: A null parameter passed to a global command causes ClassCastException", "bodyText": "", "createdAt": "2020-10-05T07:54:51Z", "url": "https://github.com/zkoss/zk/pull/2200", "merged": true, "mergeCommit": {"oid": "83a2b105345fafda0e3f486738fc6340fc52a390"}, "closed": true, "closedAt": "2020-10-06T10:48:27Z", "author": {"login": "DevChu"}, "timelineItems": {"totalCount": 18, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdPfeCfABqjM4MzkxODMzNDQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdP1jRwABqjM4NDQ1OTM4MTk=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4448aac52168ecd8059873b76ece2d0ffe3632a3", "author": {"user": {"login": "DevChu", "name": "James Chu"}}, "url": "https://github.com/zkoss/zk/commit/4448aac52168ecd8059873b76ece2d0ffe3632a3", "committedDate": "2020-10-05T07:54:29Z", "message": "refine ZK-4552: ignore null value in positional command params"}, "afterCommit": {"oid": "05b03be30db67b0046562dda92f1091121307ca9", "author": {"user": {"login": "DevChu", "name": "James Chu"}}, "url": "https://github.com/zkoss/zk/commit/05b03be30db67b0046562dda92f1091121307ca9", "committedDate": "2020-10-05T08:25:47Z", "message": "refine ZK-4552: ignore null value in positional command params"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "05b03be30db67b0046562dda92f1091121307ca9", "author": {"user": {"login": "DevChu", "name": "James Chu"}}, "url": "https://github.com/zkoss/zk/commit/05b03be30db67b0046562dda92f1091121307ca9", "committedDate": "2020-10-05T08:25:47Z", "message": "refine ZK-4552: ignore null value in positional command params"}, "afterCommit": {"oid": "b36e200b6320ac1757d59fe542c3472e3d072cb8", "author": {"user": {"login": "DevChu", "name": "James Chu"}}, "url": "https://github.com/zkoss/zk/commit/b36e200b6320ac1757d59fe542c3472e3d072cb8", "committedDate": "2020-10-05T09:35:14Z", "message": "refine ZK-4552: ignore null value in positional command params"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b36e200b6320ac1757d59fe542c3472e3d072cb8", "author": {"user": {"login": "DevChu", "name": "James Chu"}}, "url": "https://github.com/zkoss/zk/commit/b36e200b6320ac1757d59fe542c3472e3d072cb8", "committedDate": "2020-10-05T09:35:14Z", "message": "refine ZK-4552: ignore null value in positional command params"}, "afterCommit": {"oid": "1d5226216b9483289c84a9042426809d7bbaf5b7", "author": {"user": {"login": "DevChu", "name": "James Chu"}}, "url": "https://github.com/zkoss/zk/commit/1d5226216b9483289c84a9042426809d7bbaf5b7", "committedDate": "2020-10-05T10:13:47Z", "message": "refine ZK-4552: ignore null value in positional command params"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "1d5226216b9483289c84a9042426809d7bbaf5b7", "author": {"user": {"login": "DevChu", "name": "James Chu"}}, "url": "https://github.com/zkoss/zk/commit/1d5226216b9483289c84a9042426809d7bbaf5b7", "committedDate": "2020-10-05T10:13:47Z", "message": "refine ZK-4552: ignore null value in positional command params"}, "afterCommit": {"oid": "f81cbd04c6c95cbc97059dfb5b7094c505cdbeb2", "author": {"user": {"login": "DevChu", "name": "James Chu"}}, "url": "https://github.com/zkoss/zk/commit/f81cbd04c6c95cbc97059dfb5b7094c505cdbeb2", "committedDate": "2020-10-06T01:45:21Z", "message": "refine ZK-4552: ignore null value in positional command params"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f81cbd04c6c95cbc97059dfb5b7094c505cdbeb2", "author": {"user": {"login": "DevChu", "name": "James Chu"}}, "url": "https://github.com/zkoss/zk/commit/f81cbd04c6c95cbc97059dfb5b7094c505cdbeb2", "committedDate": "2020-10-06T01:45:21Z", "message": "refine ZK-4552: ignore null value in positional command params"}, "afterCommit": {"oid": "b29966223320fd077190710d4b593997e7070389", "author": {"user": {"login": "DevChu", "name": "James Chu"}}, "url": "https://github.com/zkoss/zk/commit/b29966223320fd077190710d4b593997e7070389", "committedDate": "2020-10-06T02:16:17Z", "message": "refine ZK-4552: ignore null value in positional command params"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b29966223320fd077190710d4b593997e7070389", "author": {"user": {"login": "DevChu", "name": "James Chu"}}, "url": "https://github.com/zkoss/zk/commit/b29966223320fd077190710d4b593997e7070389", "committedDate": "2020-10-06T02:16:17Z", "message": "refine ZK-4552: ignore null value in positional command params"}, "afterCommit": {"oid": "fc85a80ee863eb11a936e2c0fb1d8998f653ab75", "author": {"user": {"login": "DevChu", "name": "James Chu"}}, "url": "https://github.com/zkoss/zk/commit/fc85a80ee863eb11a936e2c0fb1d8998f653ab75", "committedDate": "2020-10-06T02:16:41Z", "message": "refine ZK-4552: ignore null value in positional command params"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "fc85a80ee863eb11a936e2c0fb1d8998f653ab75", "author": {"user": {"login": "DevChu", "name": "James Chu"}}, "url": "https://github.com/zkoss/zk/commit/fc85a80ee863eb11a936e2c0fb1d8998f653ab75", "committedDate": "2020-10-06T02:16:41Z", "message": "refine ZK-4552: ignore null value in positional command params"}, "afterCommit": {"oid": "f67d791278e712e8cf358fa9de1b8d7829b2b20e", "author": {"user": {"login": "DevChu", "name": "James Chu"}}, "url": "https://github.com/zkoss/zk/commit/f67d791278e712e8cf358fa9de1b8d7829b2b20e", "committedDate": "2020-10-06T02:17:49Z", "message": "ZK-4688: A null parameter passed to a global command causes ClassCastException"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f67d791278e712e8cf358fa9de1b8d7829b2b20e", "author": {"user": {"login": "DevChu", "name": "James Chu"}}, "url": "https://github.com/zkoss/zk/commit/f67d791278e712e8cf358fa9de1b8d7829b2b20e", "committedDate": "2020-10-06T02:17:49Z", "message": "ZK-4688: A null parameter passed to a global command causes ClassCastException"}, "afterCommit": {"oid": "57e4383e58fa1f58564b10efe5862c9324d64757", "author": {"user": {"login": "DevChu", "name": "James Chu"}}, "url": "https://github.com/zkoss/zk/commit/57e4383e58fa1f58564b10efe5862c9324d64757", "committedDate": "2020-10-06T02:19:00Z", "message": "ZK-4688: A null parameter passed to a global command causes ClassCastException"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "57e4383e58fa1f58564b10efe5862c9324d64757", "author": {"user": {"login": "DevChu", "name": "James Chu"}}, "url": "https://github.com/zkoss/zk/commit/57e4383e58fa1f58564b10efe5862c9324d64757", "committedDate": "2020-10-06T02:19:00Z", "message": "ZK-4688: A null parameter passed to a global command causes ClassCastException"}, "afterCommit": {"oid": "c95e1bafd83d3cbecaf65c2023521118e2a394f9", "author": {"user": {"login": "DevChu", "name": "James Chu"}}, "url": "https://github.com/zkoss/zk/commit/c95e1bafd83d3cbecaf65c2023521118e2a394f9", "committedDate": "2020-10-06T02:28:27Z", "message": "ZK-4688: A null parameter passed to a global command causes ClassCastException"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAyNzQyNTI3", "url": "https://github.com/zkoss/zk/pull/2200#pullrequestreview-502742527", "createdAt": "2020-10-06T09:17:42Z", "commit": {"oid": "c95e1bafd83d3cbecaf65c2023521118e2a394f9"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNlQwOToxNzo0MlrOHc9ZEQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNlQwOToyMDozMVrOHc9gGA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDEyODAxNw==", "bodyText": "move to resolvePositionalParameter", "url": "https://github.com/zkoss/zk/pull/2200#discussion_r500128017", "createdAt": "2020-10-06T09:17:42Z", "author": {"login": "scribetw"}, "path": "zkbind/src/org/zkoss/bind/impl/ParamCall.java", "diffHunk": "@@ -208,8 +209,16 @@ private Object resolveParameter(Annotation[] parmAnnos, Class<?> paramType, Stri\n \t\t\t\t}\n \t\t\t}\n \t\t}\n-\t\tif (val == null)\n+\t\tif (val == null && _bindingArgs != null && index < _bindingArgs.size()) {\n+\t\t\tint argIndex = 0;\n+\t\t\tfor (Map.Entry<String, Object> entry : _bindingArgs.entrySet()) {\n+\t\t\t\t// skip using positional if the param key is not auto-generated\n+\t\t\t\tif (argIndex == index && !entry.getKey().startsWith(Parser.SIMPLIFIED_COMMAND_PARAM_PREFIX))\n+\t\t\t\t\treturn null;\n+\t\t\t\targIndex++;\n+\t\t\t}\n \t\t\tval = resolvePositionalParameter(paramType, index);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c95e1bafd83d3cbecaf65c2023521118e2a394f9"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDEyOTgxNg==", "bodyText": "add \",\"", "url": "https://github.com/zkoss/zk/pull/2200#discussion_r500129816", "createdAt": "2020-10-06T09:20:31Z", "author": {"login": "scribetw"}, "path": "zktest/src/org/zkoss/zktest/test2/B95_ZK_4688VM.java", "diffHunk": "@@ -0,0 +1,44 @@\n+package org.zkoss.zktest.test2;\r\n+\r\n+import java.util.Calendar;\r\n+import java.util.Date;\r\n+import java.util.HashMap;\r\n+import java.util.Locale;\r\n+import java.util.Map;\r\n+\r\n+import org.zkoss.bind.BindUtils;\r\n+import org.zkoss.bind.annotation.BindingParam;\r\n+import org.zkoss.bind.annotation.Command;\r\n+import org.zkoss.bind.annotation.GlobalCommand;\r\n+import org.zkoss.bind.annotation.NotifyChange;\r\n+\r\n+public class B95_ZK_4688VM {\r\n+\r\n+\tprivate String result = \"\";\r\n+\r\n+\t@GlobalCommand\r\n+\t@NotifyChange(\"result\")\r\n+\tpublic void stopSetup(@BindingParam(\"finishDate\") Date when, @BindingParam(\"setupQty\") int setupQty,\r\n+\t\t\t@BindingParam(\"reason\") Locale reason) {\r\n+\t\tresult = when + \",\" + setupQty + reason;\r", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c95e1bafd83d3cbecaf65c2023521118e2a394f9"}, "originalPosition": 23}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c95e1bafd83d3cbecaf65c2023521118e2a394f9", "author": {"user": {"login": "DevChu", "name": "James Chu"}}, "url": "https://github.com/zkoss/zk/commit/c95e1bafd83d3cbecaf65c2023521118e2a394f9", "committedDate": "2020-10-06T02:28:27Z", "message": "ZK-4688: A null parameter passed to a global command causes ClassCastException"}, "afterCommit": {"oid": "0d127af923bfdfd74f40e6100f7670e9d3591f53", "author": {"user": {"login": "DevChu", "name": "James Chu"}}, "url": "https://github.com/zkoss/zk/commit/0d127af923bfdfd74f40e6100f7670e9d3591f53", "committedDate": "2020-10-06T09:23:47Z", "message": "ZK-4688: A null parameter passed to a global command causes ClassCastException"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAyNzQ5OTg5", "url": "https://github.com/zkoss/zk/pull/2200#pullrequestreview-502749989", "createdAt": "2020-10-06T09:26:44Z", "commit": {"oid": "0d127af923bfdfd74f40e6100f7670e9d3591f53"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAyNzQ5OTQ0", "url": "https://github.com/zkoss/zk/pull/2200#pullrequestreview-502749944", "createdAt": "2020-10-06T09:26:41Z", "commit": {"oid": "0d127af923bfdfd74f40e6100f7670e9d3591f53"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNlQwOToyNjo0MVrOHc9vBg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNlQwOToyNjo0MVrOHc9vBg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDEzMzYzOA==", "bodyText": "++", "url": "https://github.com/zkoss/zk/pull/2200#discussion_r500133638", "createdAt": "2020-10-06T09:26:41Z", "author": {"login": "scribetw"}, "path": "zkbind/src/org/zkoss/bind/impl/ParamCall.java", "diffHunk": "@@ -218,14 +219,14 @@ private Object resolveParameter(Annotation[] parmAnnos, Class<?> paramType, Stri\n \tprivate Object resolvePositionalParameter(Class<?> returnType, int index) {\n \t\tObject val = null;\n \t\tif (_bindingArgs != null) {\n-\t\t\tCollection<Object> values = _bindingArgs.values();\n-\t\t\tint i = 0;\n-\t\t\tfor (Object v : values) {\n-\t\t\t\tif (index == i) {\n-\t\t\t\t\tval = v;\n+\t\t\tint argIndex = 0;\n+\t\t\tfor (Map.Entry<String, Object> entry : _bindingArgs.entrySet()) {\n+\t\t\t\t// skip using positional if the param key is not auto-generated\n+\t\t\t\tif (argIndex == index) {\n+\t\t\t\t\tif (entry.getKey().startsWith(Parser.SIMPLIFIED_COMMAND_PARAM_PREFIX))\n+\t\t\t\t\t\tval = entry.getValue();\n \t\t\t\t\tbreak;\n \t\t\t\t}\n-\t\t\t\ti++;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0d127af923bfdfd74f40e6100f7670e9d3591f53"}, "originalPosition": 25}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0d127af923bfdfd74f40e6100f7670e9d3591f53", "author": {"user": {"login": "DevChu", "name": "James Chu"}}, "url": "https://github.com/zkoss/zk/commit/0d127af923bfdfd74f40e6100f7670e9d3591f53", "committedDate": "2020-10-06T09:23:47Z", "message": "ZK-4688: A null parameter passed to a global command causes ClassCastException"}, "afterCommit": {"oid": "855170ee9e0cad917b5d2ceec4f5563ada756896", "author": {"user": {"login": "DevChu", "name": "James Chu"}}, "url": "https://github.com/zkoss/zk/commit/855170ee9e0cad917b5d2ceec4f5563ada756896", "committedDate": "2020-10-06T09:30:07Z", "message": "ZK-4688: A null parameter passed to a global command causes ClassCastException"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "855170ee9e0cad917b5d2ceec4f5563ada756896", "author": {"user": {"login": "DevChu", "name": "James Chu"}}, "url": "https://github.com/zkoss/zk/commit/855170ee9e0cad917b5d2ceec4f5563ada756896", "committedDate": "2020-10-06T09:30:07Z", "message": "ZK-4688: A null parameter passed to a global command causes ClassCastException"}, "afterCommit": {"oid": "26452b418b66b1a682be06274842b86849e5f9cf", "author": {"user": {"login": "DevChu", "name": "James Chu"}}, "url": "https://github.com/zkoss/zk/commit/26452b418b66b1a682be06274842b86849e5f9cf", "committedDate": "2020-10-06T10:05:55Z", "message": "ZK-4688: A null parameter passed to a global command causes ClassCastException"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAyNzgyNzgz", "url": "https://github.com/zkoss/zk/pull/2200#pullrequestreview-502782783", "createdAt": "2020-10-06T10:08:28Z", "commit": {"oid": "26452b418b66b1a682be06274842b86849e5f9cf"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0b43214faae70273a0622425f84f88d9b34b5849", "author": {"user": {"login": "DevChu", "name": "James Chu"}}, "url": "https://github.com/zkoss/zk/commit/0b43214faae70273a0622425f84f88d9b34b5849", "committedDate": "2020-10-06T10:09:31Z", "message": "ZK-4688: A null parameter passed to a global command causes ClassCastException"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "26452b418b66b1a682be06274842b86849e5f9cf", "author": {"user": {"login": "DevChu", "name": "James Chu"}}, "url": "https://github.com/zkoss/zk/commit/26452b418b66b1a682be06274842b86849e5f9cf", "committedDate": "2020-10-06T10:05:55Z", "message": "ZK-4688: A null parameter passed to a global command causes ClassCastException"}, "afterCommit": {"oid": "0b43214faae70273a0622425f84f88d9b34b5849", "author": {"user": {"login": "DevChu", "name": "James Chu"}}, "url": "https://github.com/zkoss/zk/commit/0b43214faae70273a0622425f84f88d9b34b5849", "committedDate": "2020-10-06T10:09:31Z", "message": "ZK-4688: A null parameter passed to a global command causes ClassCastException"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 43, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}