{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzkzNjA0MjM5", "number": 638, "title": "Linker assembly toggle", "bodyText": "Description of changes\nAdded gui selection for the type of file to export in the ngs linker.  This just helps the user generate the cmd line for them to paste into their terminal.\nRelated issue\nFixes #121\nChecklist\nThings for the developer to confirm they've done before the PR should be accepted:\n\n CHANGELOG.md (and UPGRADING.md if necessary) updated with information for new change.\n Tests added (or description of how to test) for any new features.\n User documentation updated for UI or technical changes.", "createdAt": "2020-03-25T13:59:03Z", "url": "https://github.com/phac-nml/irida/pull/638", "merged": true, "mergeCommit": {"oid": "7149a64f6d740f1c285f8d629a5e4c7ee8741af3"}, "closed": true, "closedAt": "2020-04-09T16:43:59Z", "author": {"login": "tom114"}, "timelineItems": {"totalCount": 24, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcQ4Nn1AH2gAyMzkzNjA0MjM5OjZhZDQ0NmQxMmMwNjE2ODdhYjRkOTNkOGFmYmNiYzkxZGMyNzI3MTQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcV_TebgFqTM5MDk1OTM2OQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "6ad446d12c061687ab4d93d8afbcbc91dc272714", "author": {"user": {"login": "tom114", "name": "Tom Matthews"}}, "url": "https://github.com/phac-nml/irida/commit/6ad446d12c061687ab4d93d8afbcbc91dc272714", "committedDate": "2020-03-24T19:38:26Z", "message": "starting to add toggles for which filetype for the linker"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "10b66cda7a0c5a2cfb9ac5fb75e10eaf9bc95036", "author": {"user": {"login": "tom114", "name": "Tom Matthews"}}, "url": "https://github.com/phac-nml/irida/commit/10b66cda7a0c5a2cfb9ac5fb75e10eaf9bc95036", "committedDate": "2020-03-25T13:57:58Z", "message": "trying to get the linker text to update using state"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4c9350f9db3d107bb099e4296fcece5de4213eda", "author": {"user": {"login": "joshsadam", "name": "Josh Adam"}}, "url": "https://github.com/phac-nml/irida/commit/4c9350f9db3d107bb099e4296fcece5de4213eda", "committedDate": "2020-03-25T15:35:41Z", "message": "Working updated modal"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dfa9305d3777479f631035abd09fdb3018800b39", "author": {"user": null}, "url": "https://github.com/phac-nml/irida/commit/dfa9305d3777479f631035abd09fdb3018800b39", "committedDate": "2020-03-25T19:58:52Z", "message": "Adding logic to add typestring"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a5faa455e8e2d5aa45a3309285657cc9f901e8b0", "author": {"user": {"login": "tom114", "name": "Tom Matthews"}}, "url": "https://github.com/phac-nml/irida/commit/a5faa455e8e2d5aa45a3309285657cc9f901e8b0", "committedDate": "2020-03-25T20:27:42Z", "message": "added i18n and some comments for the linker stuff"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ce6bcdf73830dc402661f17e1765034eb004c3e5", "author": {"user": {"login": "tom114", "name": "Tom Matthews"}}, "url": "https://github.com/phac-nml/irida/commit/ce6bcdf73830dc402661f17e1765034eb004c3e5", "committedDate": "2020-03-25T20:29:13Z", "message": "updated changelog with linker script stuff"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e7d03eb344763fac12f6f78dae2690b48ed1f7c3", "author": {"user": {"login": "tom114", "name": "Tom Matthews"}}, "url": "https://github.com/phac-nml/irida/commit/e7d03eb344763fac12f6f78dae2690b48ed1f7c3", "committedDate": "2020-03-25T20:37:08Z", "message": "updated docs with new linker screenshot"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7e70467c45d41c19dbf07b4b279ba8619a3d4d59", "author": {"user": {"login": "tom114", "name": "Tom Matthews"}}, "url": "https://github.com/phac-nml/irida/commit/7e70467c45d41c19dbf07b4b279ba8619a3d4d59", "committedDate": "2020-03-25T20:45:14Z", "message": "added test functionality for linker types"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "18429c6ac2e5a4064ff9f11c222b0d397ee6d2b5", "author": {"user": {"login": "tom114", "name": "Tom Matthews"}}, "url": "https://github.com/phac-nml/irida/commit/18429c6ac2e5a4064ff9f11c222b0d397ee6d2b5", "committedDate": "2020-03-26T12:50:16Z", "message": "Merge branch 'development' into linker-assembly-toggle"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ba2cde9a19c77894e1e6c1da4c67a1b9bd0dd99d", "author": {"user": {"login": "tom114", "name": "Tom Matthews"}}, "url": "https://github.com/phac-nml/irida/commit/ba2cde9a19c77894e1e6c1da4c67a1b9bd0dd99d", "committedDate": "2020-03-26T14:53:58Z", "message": "updated comments for the linker script"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgyMDk1NjY0", "url": "https://github.com/phac-nml/irida/pull/638#pullrequestreview-382095664", "createdAt": "2020-03-26T14:59:31Z", "commit": {"oid": "ba2cde9a19c77894e1e6c1da4c67a1b9bd0dd99d"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNlQxNDo1OTozMVrOF8LF-Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNlQyMDoxMToyOVrOF8YiXA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODY0MDYzMw==", "bodyText": "Remove {\" \"} that's an artifact from formatting with Prettier. It thinks you literally want to add a space.", "url": "https://github.com/phac-nml/irida/pull/638#discussion_r398640633", "createdAt": "2020-03-26T14:59:31Z", "author": {"login": "joshsadam"}, "path": "src/main/webapp/resources/js/pages/projects/samples/linker/Linker.jsx", "diffHunk": "@@ -27,33 +27,79 @@ const CommandText = styled(Paragraph)`\n  * @constructor\n  */\n function Linker() {\n+  const options = [\n+    { label: i18n(\"Linker.fastq\"), value: \"fastq\" },\n+    { label: i18n(\"Linker.assembly\"), value: \"assembly\" }\n+  ];\n+\n+  //this will hold the base string of the script with the projects & samples.  The filetypes will be appended before displaying.\n+  let scriptString = undefined;\n+\n+  let modal = undefined; \n+\n+  const ModalContents = (\n+    { command } \n+  ) => (\n+    <>\n+      {\" \"}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ba2cde9a19c77894e1e6c1da4c67a1b9bd0dd99d"}, "originalPosition": 26}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODg2MDg5Mg==", "bodyText": "You can rename a variable when you are destructuring the object, so:\n getNGSLinkerCode(detail).then(({ data : scriptString }) => {\n\nwould give the same result.", "url": "https://github.com/phac-nml/irida/pull/638#discussion_r398860892", "createdAt": "2020-03-26T20:11:29Z", "author": {"login": "joshsadam"}, "path": "src/main/webapp/resources/js/pages/projects/samples/linker/Linker.jsx", "diffHunk": "@@ -27,33 +27,79 @@ const CommandText = styled(Paragraph)`\n  * @constructor\n  */\n function Linker() {\n+  const options = [\n+    { label: i18n(\"Linker.fastq\"), value: \"fastq\" },\n+    { label: i18n(\"Linker.assembly\"), value: \"assembly\" }\n+  ];\n+\n+  //this will hold the base string of the script with the projects & samples.  The filetypes will be appended before displaying.\n+  let scriptString = undefined;\n+\n+  let modal = undefined; \n+\n+  const ModalContents = (\n+    { command } \n+  ) => (\n+    <>\n+      {\" \"}\n+      <Paragraph>{i18n(\"Linker.details\")}</Paragraph>\n+      <Text type=\"secondary\">\n+        <span dangerouslySetInnerHTML={{ __html: i18n(\"Linker.note\") }} />\n+      </Text>\n+      <br/><br/>\n+      <Text strong>{i18n(\"Linker.types\")}</Text> <Checkbox.Group\n+        options={options}\n+        defaultValue={[\"fastq\"]}\n+        onChange={updateCommand}\n+      />\n+      <CommandText\n+        className=\"t-cmd-text\"\n+        ellipsis={{ rows: 1 }}\n+        copyable={ command }\n+      >\n+        {command}\n+      </CommandText>\n+      \n+    </>\n+  );\n+\n   function handleSampleIds(e) {\n-    // Post data to get linker command.\n+    // Post data to the server to get the linker command.\n     const { detail } = e;\n     getNGSLinkerCode(detail).then(({ data }) => {\n-      Modal.success({\n+      scriptString = data;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ba2cde9a19c77894e1e6c1da4c67a1b9bd0dd99d"}, "originalPosition": 54}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0c2a1d3124b439acc7a9338ab6289d8a6d349209", "author": {"user": {"login": "tom114", "name": "Tom Matthews"}}, "url": "https://github.com/phac-nml/irida/commit/0c2a1d3124b439acc7a9338ab6289d8a6d349209", "committedDate": "2020-03-30T13:48:23Z", "message": "removed unnecessary space"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b5b0314aae7da120866d10aaeb1d26ed3e4b4ee1", "author": {"user": {"login": "joshsadam", "name": "Josh Adam"}}, "url": "https://github.com/phac-nml/irida/commit/b5b0314aae7da120866d10aaeb1d26ed3e4b4ee1", "committedDate": "2020-03-30T16:09:52Z", "message": "Cleaned up how modal get updated"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "46931f5fb80dc24ea9a492508e01aa606963192c", "author": {"user": {"login": "joshsadam", "name": "Josh Adam"}}, "url": "https://github.com/phac-nml/irida/commit/46931f5fb80dc24ea9a492508e01aa606963192c", "committedDate": "2020-03-30T18:51:35Z", "message": "Made default `fastq` not `fasta`"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c6a0457908e38f97b05412e6ed6795d8d3539266", "author": {"user": {"login": "tom114", "name": "Tom Matthews"}}, "url": "https://github.com/phac-nml/irida/commit/c6a0457908e38f97b05412e6ed6795d8d3539266", "committedDate": "2020-03-30T20:42:25Z", "message": "Merge pull request #35 from phac-nml/linker-assembly-toggle-modal-cleanup\n\nLinker toggle Modal cleanup"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d7a50a5efe0c4c2001dca9d08035b8e444c447d0", "author": {"user": {"login": "tom114", "name": "Tom Matthews"}}, "url": "https://github.com/phac-nml/irida/commit/d7a50a5efe0c4c2001dca9d08035b8e444c447d0", "committedDate": "2020-03-30T21:18:58Z", "message": "Merge branch 'development' into linker-assembly-toggle"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg0ODk0Nzc2", "url": "https://github.com/phac-nml/irida/pull/638#pullrequestreview-384894776", "createdAt": "2020-03-31T16:17:14Z", "commit": {"oid": "d7a50a5efe0c4c2001dca9d08035b8e444c447d0"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMVQxNjoxNzoxNFrOF-dq5w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMVQxNjoxNzoxNFrOF-dq5w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTA0MjE1MQ==", "bodyText": "Replace this with IconCode it's already in the imports, but I must have missed updating it.  Please then remove the import for CodeOutlined", "url": "https://github.com/phac-nml/irida/pull/638#discussion_r401042151", "createdAt": "2020-03-31T16:17:14Z", "author": {"login": "joshsadam"}, "path": "src/main/webapp/resources/js/pages/projects/samples/linker/Linker.jsx", "diffHunk": "@@ -27,58 +29,85 @@ const CommandText = styled(Paragraph)`\n  * @constructor\n  */\n function Linker() {\n-  function handleSampleIds(e) {\n-    // Post data to get linker command.\n-    const { detail } = e;\n+  const [visible, setVisible] = useState(false);\n+  const [types, setTypes] = useState([\"fastq\"]);\n+  const [scriptString, setScriptString] = useState();\n+  const [command, setCommand] = useState();\n+\n+  const options = [\n+    { label: i18n(\"Linker.fastq\"), value: \"fastq\" },\n+    { label: i18n(\"Linker.assembly\"), value: \"assembly\" }\n+  ];\n+\n+  function handleSampleIds({ detail }) {\n     getNGSLinkerCode(detail).then(({ data }) => {\n-      Modal.success({\n-        className: \"t-linker-modal\",\n-        width: 500,\n-        title: i18n(\"Linker.title\"),\n-        content: (\n-          <>\n-            <Paragraph>{i18n(\"Linker.details\")}</Paragraph>\n-            <Text type=\"secondary\">\n-              <span dangerouslySetInnerHTML={{ __html: i18n(\"Linker.note\") }} />\n-            </Text>\n-            <CommandText\n-              className=\"t-cmd-text\"\n-              ellipsis={{ rows: 1 }}\n-              copyable={{ text: data }}\n-            >\n-              {data}\n-            </CommandText>\n-          </>\n-        )\n-      });\n+      // Post data to the server to get the linker command.\n+      setScriptString(data);\n+      setVisible(true);\n     });\n   }\n \n+  useEffect(() => {\n+    setCommand(\n+      types.length ? `${scriptString} -t ${types.join(\",\")}` : scriptString\n+    );\n+  }, [scriptString, types]);\n+\n   /*\n   These Listeners and Dispatchers are a way to get around the separation between react\n   components and the legacy JS code already on the page.\n   */\n   document.addEventListener(\"sample-ids-return\", handleSampleIds, false);\n \n-  function showModal() {\n+  function getIds() {\n     document.dispatchEvent(new Event(\"sample-ids\"));\n   }\n \n   return (\n-    <Button\n-      type=\"link\"\n-      style={{\n-        margin: `0 inherit`,\n-        padding: 0,\n-        color: grey9\n-      }}\n-      className=\"t-linker-btn\"\n-      onClick={showModal}\n-    >\n-      {/* constant marginRight here to match old styles */}\n-      <IconCode style={{ marginRight: 2 }} />\n-      {i18n(\"project.samples.export.linker\")}\n-    </Button>\n+    <>\n+      <Button\n+        type=\"link\"\n+        style={{\n+          margin: `0 inherit`,\n+          padding: 0,\n+          color: grey9\n+        }}\n+        className=\"t-linker-btn\"\n+        onClick={getIds}\n+      >\n+        {/* constant marginRight here to match old styles */}\n+        <CodeOutlined style={{ marginRight: 2 }} />", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d7a50a5efe0c4c2001dca9d08035b8e444c447d0"}, "originalPosition": 100}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg0ODk2MTYy", "url": "https://github.com/phac-nml/irida/pull/638#pullrequestreview-384896162", "createdAt": "2020-03-31T16:18:47Z", "commit": {"oid": "d7a50a5efe0c4c2001dca9d08035b8e444c447d0"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6cff5b9ca56d1d2460ba79d3eb1cc7e96f9407e7", "author": {"user": {"login": "tom114", "name": "Tom Matthews"}}, "url": "https://github.com/phac-nml/irida/commit/6cff5b9ca56d1d2460ba79d3eb1cc7e96f9407e7", "committedDate": "2020-04-01T13:14:07Z", "message": "changed to iconcode"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3cb9bdbf0ba0a1269c15d38f6ee8506120399875", "author": {"user": {"login": "tom114", "name": "Tom Matthews"}}, "url": "https://github.com/phac-nml/irida/commit/3cb9bdbf0ba0a1269c15d38f6ee8506120399875", "committedDate": "2020-04-07T17:38:01Z", "message": "Merge branch 'development' into linker-assembly-toggle"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e8203909b964efd7e7442db6f25dd1f33540c533", "author": {"user": {"login": "tom114", "name": "Tom Matthews"}}, "url": "https://github.com/phac-nml/irida/commit/e8203909b964efd7e7442db6f25dd1f33540c533", "committedDate": "2020-04-07T17:38:57Z", "message": "added linker detail in changelog"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2ae9c56540296cf728ebac3271d69ce4ccc76e62", "author": {"user": {"login": "tom114", "name": "Tom Matthews"}}, "url": "https://github.com/phac-nml/irida/commit/2ae9c56540296cf728ebac3271d69ce4ccc76e62", "committedDate": "2020-04-07T17:40:17Z", "message": "Revert \"added linker detail in changelog\"\n\nThis reverts commit e8203909b964efd7e7442db6f25dd1f33540c533."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "22a686bb61ecec798832145a790126a019f40c63", "author": {"user": {"login": "tom114", "name": "Tom Matthews"}}, "url": "https://github.com/phac-nml/irida/commit/22a686bb61ecec798832145a790126a019f40c63", "committedDate": "2020-04-08T13:39:07Z", "message": "Merge branch 'development' into linker-assembly-toggle"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkwOTU5MzY5", "url": "https://github.com/phac-nml/irida/pull/638#pullrequestreview-390959369", "createdAt": "2020-04-09T16:43:47Z", "commit": {"oid": "22a686bb61ecec798832145a790126a019f40c63"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 209, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}