{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTQ1MDAxNTY3", "number": 897, "title": "Email pipeline result error", "bodyText": "Description of changes\nWhat did you change in this pull request?  Provide a description of files changed, user interactions changed, etc.  Include how to test your changes.\nUpdated to allow a user to select if they want to receive an email upon analysis completion and/or error.\n\n\nRelated issue\nLink to the GitHub issue this pull request addresses using the #issuenum format.  If it completes an issue, use Fixes #issuenum to automatically close the issue.\nFixes #434\nChecklist\nThings for the developer to confirm they've done before the PR should be accepted:\n\n CHANGELOG.md (and UPGRADING.md if necessary) updated with information for new change.\n Tests added (or description of how to test) for any new features.\n User documentation updated for UI or technical changes.", "createdAt": "2020-12-23T19:48:40Z", "url": "https://github.com/phac-nml/irida/pull/897", "merged": true, "mergeCommit": {"oid": "c3973c3656b8a1d9efce9907eaa28e01824a1670"}, "closed": true, "closedAt": "2021-01-15T20:47:35Z", "author": {"login": "deepsidhu85"}, "timelineItems": {"totalCount": 21, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdoy41KAH2gAyNTQ1MDAxNTY3OjI0M2IxYWI5MDM2NjQ5YzMzNGZhOTYxMmJlNWJlYWI0MmI4ZjAwMTY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdwfLaDgFqTU2OTYwNjA0MQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "243b1ab9036649c334fa9612be5beab42b8f0016", "author": {"user": {"login": "deepsidhu85", "name": null}}, "url": "https://github.com/phac-nml/irida/commit/243b1ab9036649c334fa9612be5beab42b8f0016", "committedDate": "2020-12-22T23:11:32Z", "message": "Moved email upon completion/error into email upon completion and email upon error checkboxes when launching a pipeline or viewing a running analysis"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3793af47fca62c8234088b58ee532bc7d95895cb", "author": {"user": {"login": "deepsidhu85", "name": null}}, "url": "https://github.com/phac-nml/irida/commit/3793af47fca62c8234088b58ee532bc7d95895cb", "committedDate": "2020-12-22T23:14:06Z", "message": "Updated translations"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cd2eceb45b12e519acab3d8d48ff65ee475324bc", "author": {"user": {"login": "deepsidhu85", "name": null}}, "url": "https://github.com/phac-nml/irida/commit/cd2eceb45b12e519acab3d8d48ff65ee475324bc", "committedDate": "2020-12-23T16:50:54Z", "message": "Created component to store simple radio button group with yes/no buttons. Updated analysis details to use this component"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ae350be33c0f5546951cf37762d9a1796288bfb6", "author": {"user": {"login": "deepsidhu85", "name": null}}, "url": "https://github.com/phac-nml/irida/commit/ae350be33c0f5546951cf37762d9a1796288bfb6", "committedDate": "2020-12-23T19:46:33Z", "message": "Updated images in docs, removed unused translations"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8eb56d69cae40c3585c940545647762499e8ec8b", "author": {"user": {"login": "deepsidhu85", "name": null}}, "url": "https://github.com/phac-nml/irida/commit/8eb56d69cae40c3585c940545647762499e8ec8b", "committedDate": "2020-12-23T19:50:12Z", "message": "Updated CHANGELOG"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2a81db3fa7b992bfa49623b99c61782bf7a2cadf", "author": {"user": {"login": "deepsidhu85", "name": null}}, "url": "https://github.com/phac-nml/irida/commit/2a81db3fa7b992bfa49623b99c61782bf7a2cadf", "committedDate": "2020-12-23T20:27:30Z", "message": "Removed unused imports. Updated db changeset to set the default value after altering table"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f25a4f3eaa8179b8f93337d86ed9d851346eb785", "author": {"user": {"login": "deepsidhu85", "name": null}}, "url": "https://github.com/phac-nml/irida/commit/f25a4f3eaa8179b8f93337d86ed9d851346eb785", "committedDate": "2020-12-23T22:07:49Z", "message": "Fixed syntax error in sql within changeset. Updated UI test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3de40af80325ce50a4280b96d2d4413bd2972ba9", "author": {"user": {"login": "deepsidhu85", "name": null}}, "url": "https://github.com/phac-nml/irida/commit/3de40af80325ce50a4280b96d2d4413bd2972ba9", "committedDate": "2020-12-23T22:09:17Z", "message": "Merged dev and fixed merge conflict"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "10e18629b5adbabbf0892e8a3ef29e1b0d313735", "author": {"user": {"login": "deepsidhu85", "name": null}}, "url": "https://github.com/phac-nml/irida/commit/10e18629b5adbabbf0892e8a3ef29e1b0d313735", "committedDate": "2020-12-24T15:19:36Z", "message": "Updated logic to send email on error if the user has selected it if irida can't get job information from galaxy"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9e6a110b45ff8cb2373411b13da296d030426453", "author": {"user": {"login": "deepsidhu85", "name": null}}, "url": "https://github.com/phac-nml/irida/commit/9e6a110b45ff8cb2373411b13da296d030426453", "committedDate": "2020-12-24T20:34:12Z", "message": "Merged dev and fixed merge conflict"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTYxMjg2ODE5", "url": "https://github.com/phac-nml/irida/pull/897#pullrequestreview-561286819", "createdAt": "2021-01-04T19:33:45Z", "commit": {"oid": "9e6a110b45ff8cb2373411b13da296d030426453"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wNFQxOTozMzo0NVrOIN-TvA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wNFQxOTozMzo0NVrOIN-TvA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTUyMzI2MA==", "bodyText": "Can you use the renameColumn thing fom liquibase instead of the custom sql?  https://docs.liquibase.com/change-types/community/rename-column.html", "url": "https://github.com/phac-nml/irida/pull/897#discussion_r551523260", "createdAt": "2021-01-04T19:33:45Z", "author": {"login": "tom114"}, "path": "src/main/resources/ca/corefacility/bioinformatics/irida/database/changesets/21.01/analysis-submission-email-pipeline-result-on-error.xml", "diffHunk": "@@ -0,0 +1,26 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+\n+<databaseChangeLog xmlns=\"http://www.liquibase.org/xml/ns/dbchangelog\"\n+                   xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n+                   xsi:schemaLocation=\"http://www.liquibase.org/xml/ns/dbchangelog\n+         http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.1.xsd\">\n+\n+    <changeSet id=\"analysis-submission-email-pipeline-result-on-error\" author=\"deep\">\n+        <addColumn tableName=\"analysis_submission\">\n+            <column name=\"email_pipeline_result_error\" type=\"bit(1)\" valueBoolean=\"false\"\n+                    defaultValueBoolean=\"false\">\n+                <constraints nullable=\"false\" />\n+            </column>\n+        </addColumn>\n+\n+        <addColumn tableName=\"analysis_submission_AUD\">\n+            <column name=\"email_pipeline_result_error\" type=\"bit(1)\" />\n+        </addColumn>\n+\n+        <!--Updating analysis submission table to change column email_pipeline_result to email_pipeline_result_completed -->\n+        <sql>\n+            ALTER TABLE analysis_submission CHANGE email_pipeline_result email_pipeline_result_completed BIT(1) not null DEFAULT 0;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9e6a110b45ff8cb2373411b13da296d030426453"}, "originalPosition": 22}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "741ea9aed7fbdd9feb951ac92bc700b0eea52e04", "author": {"user": {"login": "deepsidhu85", "name": null}}, "url": "https://github.com/phac-nml/irida/commit/741ea9aed7fbdd9feb951ac92bc700b0eea52e04", "committedDate": "2021-01-05T21:37:24Z", "message": "Updated pipeline launch page and analysis details page with select box for selecting if the user wants to receive a status email. Added translations. Updated db changeset to use renameColumn instead of custom sql for changing email_pipeline_result to email_pipeline_result_completed"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "10a3240872263b286d40b803340812c9e6df31b6", "author": {"user": {"login": "deepsidhu85", "name": null}}, "url": "https://github.com/phac-nml/irida/commit/10a3240872263b286d40b803340812c9e6df31b6", "committedDate": "2021-01-06T19:27:22Z", "message": "Merged dev and fixed merge conflicts"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4b11d19439555f266834a28704e5b10fc81e7783", "author": {"user": {"login": "deepsidhu85", "name": null}}, "url": "https://github.com/phac-nml/irida/commit/4b11d19439555f266834a28704e5b10fc81e7783", "committedDate": "2021-01-06T22:24:41Z", "message": "Updated changeset to add not null constraint and default value after renaming column"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "05084caee7123494b678658147f065e951a4443d", "author": {"user": {"login": "deepsidhu85", "name": null}}, "url": "https://github.com/phac-nml/irida/commit/05084caee7123494b678658147f065e951a4443d", "committedDate": "2021-01-07T15:58:29Z", "message": "Updated tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "eca9615ef910d6bc3fa5ebafdb860f0aa0ff9648", "author": {"user": {"login": "deepsidhu85", "name": null}}, "url": "https://github.com/phac-nml/irida/commit/eca9615ef910d6bc3fa5ebafdb860f0aa0ff9648", "committedDate": "2021-01-07T16:06:44Z", "message": "Merged dev and fixed merge conflict"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e26dcc0758db6810781cafcc08005ac315da511b", "author": {"user": {"login": "deepsidhu85", "name": null}}, "url": "https://github.com/phac-nml/irida/commit/e26dcc0758db6810781cafcc08005ac315da511b", "committedDate": "2021-01-12T19:14:10Z", "message": "Merged dev and fixed merge conflicts"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTY3NTk0NzA1", "url": "https://github.com/phac-nml/irida/pull/897#pullrequestreview-567594705", "createdAt": "2021-01-13T20:31:55Z", "commit": {"oid": "e26dcc0758db6810781cafcc08005ac315da511b"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xM1QyMDozMTo1NVrOITBAIg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xM1QyMDozMTo1NVrOITBAIg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NjgxMDI3NA==", "bodyText": "Again kinda a weird logic thing here with the way this is named.  If you select the \"error\" dropdown, emailPipelineResultError is true.  If you select the \"completion (error or success)\" dropdown, emailPipelineResultCompleted is true.  The names of the variables would suggest though that with the 2nd dropdown \"completion (error or success)\" that both of these values would be true.\nIf you want to keep it that only 1 of these will be true, I think it would be better set as an enum or something on AnalysisSubmission rather than the 2 boolean to indicate the \"level\" of email that will be sent here None, Error, Completion or All or something.", "url": "https://github.com/phac-nml/irida/pull/897#discussion_r556810274", "createdAt": "2021-01-13T20:31:55Z", "author": {"login": "tom114"}, "path": "src/main/java/ca/corefacility/bioinformatics/irida/ria/web/pipelines/PipelineController.java", "diffHunk": "@@ -471,7 +471,8 @@ private String localizedParamOptionLabel(Locale locale, String workflowName, Str\n \n             String analysisDescription = parameters.getDescription();\n             Boolean writeResultsToSamples = parameters.getWriteResultsToSamples();\n-            Boolean emailPipelineResult = parameters.getEmailPipelineResult();\n+            Boolean emailPipelineResultCompleted = parameters.getEmailPipelineResultCompleted();\n+            Boolean emailPipelineResultError = parameters.getEmailPipelineResultError();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e26dcc0758db6810781cafcc08005ac315da511b"}, "originalPosition": 6}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b3f3e8bf5be4b6ac25d3068a2b46b47f9672522d", "author": {"user": {"login": "deepsidhu85", "name": null}}, "url": "https://github.com/phac-nml/irida/commit/b3f3e8bf5be4b6ac25d3068a2b46b47f9672522d", "committedDate": "2021-01-13T22:41:15Z", "message": "Updated required-data sql with new column. Updated logic so both email_pipeline_result_completed and email_pipeline_result_error are set to true if a user selects to receive email on completion (success or error)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1af12330d2e2d9b19245e581e178d947aaa6ecb8", "author": {"user": {"login": "deepsidhu85", "name": null}}, "url": "https://github.com/phac-nml/irida/commit/1af12330d2e2d9b19245e581e178d947aaa6ecb8", "committedDate": "2021-01-14T23:18:14Z", "message": "Updated images and text"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTY5NjA2MDQx", "url": "https://github.com/phac-nml/irida/pull/897#pullrequestreview-569606041", "createdAt": "2021-01-15T20:45:07Z", "commit": {"oid": "1af12330d2e2d9b19245e581e178d947aaa6ecb8"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 7, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}