{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDIzNDUwMzk3", "number": 710, "title": "Added navbar button for base admin panel", "bodyText": "Description of changes\nAdded button to navbar (only visible to admins) that links to the base admin panel.\nRelated issue\nN/A\nChecklist\nThings for the developer to confirm they've done before the PR should be accepted:\n* [ ] CHANGELOG.md (and UPGRADING.md if necessary) updated with information for new change.\n\n Tests added (or description of how to test) for any new features.\n\n* [ ] User documentation updated for UI or technical changes.", "createdAt": "2020-05-26T20:36:52Z", "url": "https://github.com/phac-nml/irida/pull/710", "merged": true, "mergeCommit": {"oid": "e40be958f5f174d4c543ed5871f52af0bca9d82b"}, "closed": true, "closedAt": "2020-05-28T00:01:55Z", "author": {"login": "paulowenbrown"}, "timelineItems": {"totalCount": 13, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABclKkTZgH2gAyNDIzNDUwMzk3OjM5NzRlM2U5MjgxNTQxYzMxZmMwZjYxNjUwMzJhYjU4YjUxNmRkYWU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABclehFRAFqTQxOTU0ODAwMw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "3974e3e9281541c31fc0f6165032ab58b516ddae", "author": {"user": {"login": "paulowenbrown", "name": null}}, "url": "https://github.com/phac-nml/irida/commit/3974e3e9281541c31fc0f6165032ab58b516ddae", "committedDate": "2020-05-26T20:19:59Z", "message": "Added navbar button for base admin panel"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE4NjgwNzE3", "url": "https://github.com/phac-nml/irida/pull/710#pullrequestreview-418680717", "createdAt": "2020-05-26T21:08:52Z", "commit": {"oid": "3974e3e9281541c31fc0f6165032ab58b516ddae"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNlQyMTowODo1MlrOGawZCw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNlQyMTowODo1MlrOGawZCw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDcwOTAwMw==", "bodyText": "This looks great but you can move\nassertTrue(\"Admin Button should be displayed\", driver().findElements(By.id(\"admin-panel-btn\")).size() > 0); into the accessPageAsAdmin method after the LoginPage line and remove this test.\nSame applies to the test below where you can move the assertFalse(\"Admin Button should not be displayed\", driver().findElements(By.id(\"admin-panel-btn\")).size() > 0); into the accessPageFailure method after the LoginPage line and remove the test below as well", "url": "https://github.com/phac-nml/irida/pull/710#discussion_r430709003", "createdAt": "2020-05-26T21:08:52Z", "author": {"login": "deepsidhu85"}, "path": "src/test/java/ca/corefacility/bioinformatics/irida/ria/integration/admin/AdminPageIT.java", "diffHunk": "@@ -0,0 +1,45 @@\n+package ca.corefacility.bioinformatics.irida.ria.integration.admin;\n+\n+import org.junit.Test;\n+import org.openqa.selenium.By;\n+import org.springframework.test.context.ActiveProfiles;\n+\n+import ca.corefacility.bioinformatics.irida.ria.integration.AbstractIridaUIITChromeDriver;\n+import ca.corefacility.bioinformatics.irida.ria.integration.pages.LoginPage;\n+import ca.corefacility.bioinformatics.irida.ria.integration.pages.admin.AdminPage;\n+\n+import com.github.springtestdbunit.annotation.DatabaseSetup;\n+\n+import static junit.framework.TestCase.assertFalse;\n+import static org.junit.Assert.assertTrue;\n+\n+@ActiveProfiles(\"it\")\n+@DatabaseSetup(\"/ca/corefacility/bioinformatics/irida/ria/web/admin/AdminPageView.xml\")\n+public class AdminPageIT extends AbstractIridaUIITChromeDriver {\n+\n+\t@Test\n+\tpublic void accessPageAsAdmin() {\n+\t\tLoginPage.loginAsAdmin(driver());\n+\t\tAdminPage page = AdminPage.initPage(driver());\n+\t\tassertTrue(\"Page title should be present\", page.comparePageTitle(\"FUBAR - YOU MADE IT\"));\n+\t}\n+\n+\t@Test\n+\tpublic void accessPageFailure() {\n+\t\tLoginPage.loginAsUser(driver());\n+\t\tAdminPage page = AdminPage.initPage(driver());\n+\t\tassertFalse(\"Page title should not be present\", page.comparePageTitle(\"FUBAR - YOU MADE IT\"));\n+\t}\n+\n+\t@Test\n+\tpublic void adminButtonVisible() {\n+\t\tLoginPage.loginAsAdmin(driver());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3974e3e9281541c31fc0f6165032ab58b516ddae"}, "originalPosition": 36}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE4NzUyNzQw", "url": "https://github.com/phac-nml/irida/pull/710#pullrequestreview-418752740", "createdAt": "2020-05-26T23:48:46Z", "commit": {"oid": "3974e3e9281541c31fc0f6165032ab58b516ddae"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNlQyMzo0ODo0NlrOGaz_Ug==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNlQyMzo0OToxM1rOGaz_wQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDc2Nzk1NA==", "bodyText": "XPath really sucks to work with. Again here I would add a specific class for testing beginning with t-. \u00a0It is also better to just ask for the title found on the page and then actually do the comparison in the integration test.", "url": "https://github.com/phac-nml/irida/pull/710#discussion_r430767954", "createdAt": "2020-05-26T23:48:46Z", "author": {"login": "joshsadam"}, "path": "src/test/java/ca/corefacility/bioinformatics/irida/ria/integration/pages/admin/AdminPage.java", "diffHunk": "@@ -0,0 +1,41 @@\n+package ca.corefacility.bioinformatics.irida.ria.integration.pages.admin;\n+\n+import org.openqa.selenium.By;\n+import org.openqa.selenium.WebDriver;\n+import org.openqa.selenium.WebElement;\n+import org.openqa.selenium.support.FindBy;\n+import org.openqa.selenium.support.PageFactory;\n+\n+import ca.corefacility.bioinformatics.irida.ria.integration.pages.AbstractPage;\n+\n+public class AdminPage extends AbstractPage {\n+\tpublic static final String RELATIVE_URL = \"admin/\";\n+\n+\t@FindBy(tagName=\"body\")\n+\tprivate WebElement body;\n+\n+\tpublic AdminPage(WebDriver driver) { super(driver); }\n+\n+\t/**\n+\t * Initialize the page so that the default {@Link WebElement} has been found.\n+\t *\n+\t * @param driver\t{@Link WebDriver}\n+\t * @return The initialized {@Link AdminPage}\n+\t */\n+\tpublic static AdminPage initPage(WebDriver driver) {\n+\t\tget(driver, RELATIVE_URL);\n+\t\treturn PageFactory.initElements(driver, AdminPage.class);\n+\t}\n+\n+\t/**\n+\t * Compares the expected page title to the actual page title.\n+\t *\n+\t * @return {@link Boolean}\n+\t */\n+\tpublic boolean comparePageTitle(String pageTitle) {\n+\t\tint titleFound = body.findElements(By.xpath(\"//h1[contains(text(),'\" + pageTitle + \"')]\"))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3974e3e9281541c31fc0f6165032ab58b516ddae"}, "originalPosition": 36}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDc2ODA2NQ==", "bodyText": "Better just to find exactly what you are looking for here.  In this case you could find the title here.", "url": "https://github.com/phac-nml/irida/pull/710#discussion_r430768065", "createdAt": "2020-05-26T23:49:13Z", "author": {"login": "joshsadam"}, "path": "src/test/java/ca/corefacility/bioinformatics/irida/ria/integration/pages/admin/AdminPage.java", "diffHunk": "@@ -0,0 +1,41 @@\n+package ca.corefacility.bioinformatics.irida.ria.integration.pages.admin;\n+\n+import org.openqa.selenium.By;\n+import org.openqa.selenium.WebDriver;\n+import org.openqa.selenium.WebElement;\n+import org.openqa.selenium.support.FindBy;\n+import org.openqa.selenium.support.PageFactory;\n+\n+import ca.corefacility.bioinformatics.irida.ria.integration.pages.AbstractPage;\n+\n+public class AdminPage extends AbstractPage {\n+\tpublic static final String RELATIVE_URL = \"admin/\";\n+\n+\t@FindBy(tagName=\"body\")\n+\tprivate WebElement body;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3974e3e9281541c31fc0f6165032ab58b516ddae"}, "originalPosition": 15}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE5MTIxMTc2", "url": "https://github.com/phac-nml/irida/pull/710#pullrequestreview-419121176", "createdAt": "2020-05-27T12:00:58Z", "commit": {"oid": "3974e3e9281541c31fc0f6165032ab58b516ddae"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yN1QxMjowMDo1OFrOGbGACw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yN1QxMjowMDo1OFrOGbGACw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTA2MzA1MQ==", "bodyText": "In your integration test page only do comparisons, it should know nothing about the structure of the page - do that on your page object. \u00a0For example here you would maybe ask the page object if the admin panel button is present.", "url": "https://github.com/phac-nml/irida/pull/710#discussion_r431063051", "createdAt": "2020-05-27T12:00:58Z", "author": {"login": "joshsadam"}, "path": "src/test/java/ca/corefacility/bioinformatics/irida/ria/integration/admin/AdminPageIT.java", "diffHunk": "@@ -0,0 +1,45 @@\n+package ca.corefacility.bioinformatics.irida.ria.integration.admin;\n+\n+import org.junit.Test;\n+import org.openqa.selenium.By;\n+import org.springframework.test.context.ActiveProfiles;\n+\n+import ca.corefacility.bioinformatics.irida.ria.integration.AbstractIridaUIITChromeDriver;\n+import ca.corefacility.bioinformatics.irida.ria.integration.pages.LoginPage;\n+import ca.corefacility.bioinformatics.irida.ria.integration.pages.admin.AdminPage;\n+\n+import com.github.springtestdbunit.annotation.DatabaseSetup;\n+\n+import static junit.framework.TestCase.assertFalse;\n+import static org.junit.Assert.assertTrue;\n+\n+@ActiveProfiles(\"it\")\n+@DatabaseSetup(\"/ca/corefacility/bioinformatics/irida/ria/web/admin/AdminPageView.xml\")\n+public class AdminPageIT extends AbstractIridaUIITChromeDriver {\n+\n+\t@Test\n+\tpublic void accessPageAsAdmin() {\n+\t\tLoginPage.loginAsAdmin(driver());\n+\t\tAdminPage page = AdminPage.initPage(driver());\n+\t\tassertTrue(\"Page title should be present\", page.comparePageTitle(\"FUBAR - YOU MADE IT\"));\n+\t}\n+\n+\t@Test\n+\tpublic void accessPageFailure() {\n+\t\tLoginPage.loginAsUser(driver());\n+\t\tAdminPage page = AdminPage.initPage(driver());\n+\t\tassertFalse(\"Page title should not be present\", page.comparePageTitle(\"FUBAR - YOU MADE IT\"));\n+\t}\n+\n+\t@Test\n+\tpublic void adminButtonVisible() {\n+\t\tLoginPage.loginAsAdmin(driver());\n+\t\tassertTrue(\"Admin Button should be displayed\", driver().findElements(By.id(\"admin-panel-btn\")).size() > 0);\n+\t}\n+\n+\t@Test\n+\tpublic void adminButtonNotVisible() {\n+\t\tLoginPage.loginAsUser(driver());\n+\t\tassertFalse(\"Admin Button should not be displayed\", driver().findElements(By.id(\"admin-panel-btn\")).size() > 0);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3974e3e9281541c31fc0f6165032ab58b516ddae"}, "originalPosition": 43}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "58203fa62efba295f5ba528ce1ffe113140589d6", "author": {"user": {"login": "paulowenbrown", "name": null}}, "url": "https://github.com/phac-nml/irida/commit/58203fa62efba295f5ba528ce1ffe113140589d6", "committedDate": "2020-05-27T18:07:20Z", "message": "Changed admin panel button testing structure"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE5NDk5OTI0", "url": "https://github.com/phac-nml/irida/pull/710#pullrequestreview-419499924", "createdAt": "2020-05-27T18:29:53Z", "commit": {"oid": "58203fa62efba295f5ba528ce1ffe113140589d6"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yN1QxODoyOTo1M1rOGbX5XQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yN1QxODoyOTo1M1rOGbX5XQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTM1NjI1Mw==", "bodyText": "I am sure you see this waitForTime sprinkled all over, it is a terrible, horrible bad thing that I created and am trying to get rid of.  The reason it is bad, is no matter what happens it must wait for 500ms. One of these is not bad, but have them everywhere really slows down the tests.  A better way here would be:\nWebDriverWait wait = new WebDriverWait(driver, 2);\nwait.until(ExpectedConditions.urlContains(\"/admin\"));", "url": "https://github.com/phac-nml/irida/pull/710#discussion_r431356253", "createdAt": "2020-05-27T18:29:53Z", "author": {"login": "joshsadam"}, "path": "src/test/java/ca/corefacility/bioinformatics/irida/ria/integration/pages/admin/AdminPage.java", "diffHunk": "@@ -28,14 +29,42 @@ public static AdminPage initPage(WebDriver driver) {\n \t}\n \n \t/**\n-\t * Compares the expected page title to the actual page title.\n+\t * Navigate to the admin panel page on path 'admin/'.\n+\t *\n+\t * @param driver\t{@Link WebDriver}\n+\t */\n+\tpublic void goToAdminPage(WebDriver driver) {\n+\t\tget(driver, ADMIN_RELATIVE_URL);\n+\t}\n+\n+\t/**\n+\t *  Determines if admin panel title is\n+\t *  visible on the admin panel page.\n \t *\n \t * @return {@link Boolean}\n \t */\n-\tpublic boolean comparePageTitle(String pageTitle) {\n-\t\tint titleFound = body.findElements(By.xpath(\"//h1[contains(text(),'\" + pageTitle + \"')]\"))\n-\t\t\t\t.size();\n+\tpublic boolean adminPanelTitleVisible() {\n+\t\treturn driver.findElements(By.id(\"t-admin-panel-title\"))\n+\t\t\t\t.size() == 1;\n+\t}\n \n-\t\treturn titleFound > 0;\n+\t/**\n+\t *  Determines if admin panel button is\n+\t *  visible on the navbar.\n+\t *\n+\t * @return {@link Boolean}\n+\t */\n+\tpublic boolean adminPanelButtonVisible() {\n+\t\treturn driver.findElements(By.id(\"t-admin-panel-btn\"))\n+\t\t\t\t.size() == 1;\n+\t}\n+\n+\t/**\n+\t *  Clicks on the admin panel button to navigate\n+\t *  to the admin panel page.\n+\t */\n+\tpublic void clickAdminButton() {\n+\t\tadminPanelBtn.click();\n+\t\twaitForTime(500);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "58203fa62efba295f5ba528ce1ffe113140589d6"}, "originalPosition": 60}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4a6347d228592165dcf7b3f0efce83fbc58cf217", "author": {"user": {"login": "paulowenbrown", "name": null}}, "url": "https://github.com/phac-nml/irida/commit/4a6347d228592165dcf7b3f0efce83fbc58cf217", "committedDate": "2020-05-27T18:45:15Z", "message": "Changed admin panel tests to use classes and WebElement lists, also changed wait function used"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE5NTE0MTUy", "url": "https://github.com/phac-nml/irida/pull/710#pullrequestreview-419514152", "createdAt": "2020-05-27T18:49:47Z", "commit": {"oid": "4a6347d228592165dcf7b3f0efce83fbc58cf217"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE5NTE4MjMw", "url": "https://github.com/phac-nml/irida/pull/710#pullrequestreview-419518230", "createdAt": "2020-05-27T18:55:22Z", "commit": {"oid": "4a6347d228592165dcf7b3f0efce83fbc58cf217"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE5NTIxNjA0", "url": "https://github.com/phac-nml/irida/pull/710#pullrequestreview-419521604", "createdAt": "2020-05-27T18:59:57Z", "commit": {"oid": "4a6347d228592165dcf7b3f0efce83fbc58cf217"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yN1QxODo1OTo1N1rOGbY65g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yN1QxODo1OTo1N1rOGbY65g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTM3MzAzMA==", "bodyText": "Change this Fubar - You Made It text to something like \"Admin Panel\". You would add it to the messages.properties (translations) file. And here you would have something like\n<h1 class=\"t-admin-panel-title th:text=\"#{admin.panel.title}\">ADMIN PANEL<h1>\nThe admin.panel.title would be the translation key\nYou would had the\nth:text=\"#{admin.panel.title}\" to the title in the  tags as well", "url": "https://github.com/phac-nml/irida/pull/710#discussion_r431373030", "createdAt": "2020-05-27T18:59:57Z", "author": {"login": "deepsidhu85"}, "path": "src/main/webapp/pages/admin/index.html", "diffHunk": "@@ -5,6 +5,6 @@\n     <title>ADMIN PANEL</title>\n </head>\n <body>\n-    <h1>FUBAR - YOU MADE IT</h1>\n+    <h1 class=\"t-admin-panel-title\">FUBAR - YOU MADE IT</h1>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4a6347d228592165dcf7b3f0efce83fbc58cf217"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8b168df8ebd408a06b58d6a2adeb5a6348f872df", "author": {"user": {"login": "paulowenbrown", "name": null}}, "url": "https://github.com/phac-nml/irida/commit/8b168df8ebd408a06b58d6a2adeb5a6348f872df", "committedDate": "2020-05-27T19:15:27Z", "message": "Added admin panel title to message.properties"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "17e83f7fa1c746308e0889850f1d2207cb478a1d", "author": {"user": {"login": "paulowenbrown", "name": null}}, "url": "https://github.com/phac-nml/irida/commit/17e83f7fa1c746308e0889850f1d2207cb478a1d", "committedDate": "2020-05-27T19:19:01Z", "message": "Added admin panel title to title tag"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE5NTQ4MDAz", "url": "https://github.com/phac-nml/irida/pull/710#pullrequestreview-419548003", "createdAt": "2020-05-27T19:34:34Z", "commit": {"oid": "17e83f7fa1c746308e0889850f1d2207cb478a1d"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 9, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}