{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDIxOTM5Njc1", "number": 699, "title": "Remove momentjs (except on project samples page)", "bodyText": "Description of changes\nThis merge request removes almost all dependency on momentjs. \u00a0The one remaining holdout is the project samples page which uses bootstrap-daterangepicker which has momentjs as a dependency.\nTo ensure that the changes were made without breaking \u00a0any existing code using the updated functions, I add testing using the jest framework. \u00a0To run the tests, just run yarn test or yarn test:watch from within the webapp directory.\nRelated issue\nN/A\nChecklist\nThings for the developer to confirm they've done before the PR should be accepted:\n\n CHANGELOG.md (and UPGRADING.md if necessary) updated with information for new change.\n Tests added (or description of how to test) for any new features.\nUser documentation updated for UI or technical changes.", "createdAt": "2020-05-22T14:03:02Z", "url": "https://github.com/phac-nml/irida/pull/699", "merged": true, "mergeCommit": {"oid": "2d48e54061e7ee6b85198767ab89a69771127622"}, "closed": true, "closedAt": "2020-06-01T21:58:36Z", "author": {"login": "joshsadam"}, "timelineItems": {"totalCount": 17, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcjygDrAH2gAyNDIxOTM5Njc1OmYzYWUxNmE5ZmJhMmYyZjRmMDkxZGYzYjY3OGY5MWM1NDY1YTA5YWU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcnHkWVAFqTQyMjIxMDgzNw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "f3ae16a9fba2f2f4f091df3b678f91c5465a09ae", "author": {"user": {"login": "joshsadam", "name": "Josh Adam"}}, "url": "https://github.com/phac-nml/irida/commit/f3ae16a9fba2f2f4f091df3b678f91c5465a09ae", "committedDate": "2020-05-22T13:43:42Z", "message": "\ud83d\udc7d\ufe0f Fixed missing i18n strings"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "23f631f0a1ca4277ce0e53b3d41756e7bbea95ff", "author": {"user": {"login": "joshsadam", "name": "Josh Adam"}}, "url": "https://github.com/phac-nml/irida/commit/23f631f0a1ca4277ce0e53b3d41756e7bbea95ff", "committedDate": "2020-05-22T13:44:56Z", "message": "Updating to remove \"most\" of momentjs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e4d863d87600829d948d36b7eb7ddff9286fbd1b", "author": {"user": {"login": "joshsadam", "name": "Josh Adam"}}, "url": "https://github.com/phac-nml/irida/commit/e4d863d87600829d948d36b7eb7ddff9286fbd1b", "committedDate": "2020-05-22T14:02:43Z", "message": "Updated CHANGELOG"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d82cc8e1955113db4c98ad56b37c8c92f85d1fb9", "author": {"user": {"login": "joshsadam", "name": "Josh Adam"}}, "url": "https://github.com/phac-nml/irida/commit/d82cc8e1955113db4c98ad56b37c8c92f85d1fb9", "committedDate": "2020-05-23T01:52:15Z", "message": "Merge branch '\u26d4\ufe0f-development' into replace-momentjs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bc3db41b31d07065da8fe028a4bdf8e808ec979e", "author": {"user": {"login": "joshsadam", "name": "Josh Adam"}}, "url": "https://github.com/phac-nml/irida/commit/bc3db41b31d07065da8fe028a4bdf8e808ec979e", "committedDate": "2020-05-25T11:48:53Z", "message": "Date format update in UI, needed to update test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a76cfaabc950ef38016d28c19c0351d7648507c4", "author": {"user": {"login": "joshsadam", "name": "Josh Adam"}}, "url": "https://github.com/phac-nml/irida/commit/a76cfaabc950ef38016d28c19c0351d7648507c4", "committedDate": "2020-05-25T11:50:36Z", "message": "Decided to remove the seconds"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3694a3c21b3a169d9a0cec97f18ddd873ee09cc0", "author": {"user": {"login": "joshsadam", "name": "Josh Adam"}}, "url": "https://github.com/phac-nml/irida/commit/3694a3c21b3a169d9a0cec97f18ddd873ee09cc0", "committedDate": "2020-05-25T16:09:32Z", "message": "Fixed wrong humanization"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "12c74b56f02d38df498da5eefa0b84ea12771432", "author": {"user": {"login": "joshsadam", "name": "Josh Adam"}}, "url": "https://github.com/phac-nml/irida/commit/12c74b56f02d38df498da5eefa0b84ea12771432", "committedDate": "2020-05-25T18:04:09Z", "message": "Fixed time format"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cb6ef17c2fbce0f134be177a383a79262fbf083f", "author": {"user": {"login": "joshsadam", "name": "Josh Adam"}}, "url": "https://github.com/phac-nml/irida/commit/cb6ef17c2fbce0f134be177a383a79262fbf083f", "committedDate": "2020-05-25T19:11:45Z", "message": "Fixed broken testing time format and link"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d9acc4eb752c51d089dd84030951a6d441dc5717", "author": {"user": {"login": "joshsadam", "name": "Josh Adam"}}, "url": "https://github.com/phac-nml/irida/commit/d9acc4eb752c51d089dd84030951a6d441dc5717", "committedDate": "2020-05-26T18:47:10Z", "message": "Merge branch '\u26d4\ufe0f-development' into replace-momentjs"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE4NDQ2NzUy", "url": "https://github.com/phac-nml/irida/pull/699#pullrequestreview-418446752", "createdAt": "2020-05-26T15:59:49Z", "commit": {"oid": "cb6ef17c2fbce0f134be177a383a79262fbf083f"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNlQxNTo1OTo0OVrOGalQIA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNlQxNjowMDo0N1rOGalSvw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDUyNjQ5Ng==", "bodyText": "Change the constant d to something more descriptive", "url": "https://github.com/phac-nml/irida/pull/699#discussion_r430526496", "createdAt": "2020-05-26T15:59:49Z", "author": {"login": "deepsidhu85"}, "path": "src/main/webapp/resources/js/utilities/date-utilities.js", "diffHunk": "@@ -1,79 +1,72 @@\n-import moment from \"moment\";\n+import dayjs from \"dayjs\";\n+import relativeTime from \"dayjs/plugin/relativeTime\";\n+import duration from \"dayjs/plugin/duration\";\n \n-export function formatInternationalizedDateTime(d, options = {}) {\n-  const params = {\n+export function formatInternationalizedDateTime(\n+  d,\n+  options = {\n     hour: \"numeric\",\n     minute: \"numeric\",\n-    second: \"numeric\",\n     year: \"numeric\",\n     month: \"short\",\n     day: \"numeric\",\n-    ...options\n-  };\n-  return new Intl.DateTimeFormat(window.TL.LANGUAGE_TAG, params).format(\n+  }\n+) {\n+  if (!isDate(d)) return \"\";\n+  return new Intl.DateTimeFormat(window.TL.LANGUAGE_TAG, options).format(\n     new Date(d)\n   );\n }\n \n-/**\n- * Get how much time has passed since a certain date.\n- * @param {Number} now current\n- * @param {Number} date event occurred\n- * @return {string} formatted time since.\n- */\n-export function formatTimeForNow({ now, date }) {\n-  const dNow = new Date(now);\n-  const dDate = new Date(date);\n-  if (moment.isDate(dNow) && moment.isDate(dDate)) {\n-    return moment(dDate).from(moment(dNow));\n-  }\n-}\n-\n /**\n  * Generate the a human readable form from milliseconds.\n  * @param {Number} date to format\n  * @return {string} humanized version of the date\n  */\n export function getHumanizedDuration({ date }) {\n-  if (date !== null) {\n-    return moment.duration(date).humanize();\n-  }\n-  return \"\";\n+  dayjs.extend(duration);\n+  dayjs.extend(relativeTime);\n+  return dayjs.duration(-date).humanize(false);\n }\n \n /**\n  * Generate the time from now.  Renders as human readable.s\n- * @param {string} date raw string date from server\n+ * @param {number} date raw string date from server\n  * @return {*}\n  */\n export function fromNow({ date }) {\n-  const start = new Date(date);\n-  if (moment.isDate(start)) {\n-    const t = moment(start).fromNow();\n-    return t;\n-  }\n-  return \"\";\n+  // Using dayjs because Intl.RelativeTimeFormat does not have browser\n+  // support in IE11 or safari yet.\n+  dayjs.extend(duration);\n+  dayjs.extend(relativeTime);\n+  const d1 = dayjs();\n+  const d2 = dayjs(date);\n+  return dayjs.duration(d2.diff(d1)).humanize(true);\n }\n \n /**\n  * Format unix timestamp as human readable string.\n- * @param  {Number} date unix timestamp\n+ * @param  {(string | number)} date unix timestamp\n  * @param {String} format defaults to \"lll\" which is mmm dd, YYYY h:mm AM\n  * @return {string} formatted date\n  */\n-export function formatDate({ date, format = \"lll\" }) {\n-  const t = new Date(date);\n-  if (moment.isDate(t)) {\n-    return moment(t).format(format);\n-  }\n-  return \"\";\n+export function formatDate({ date, format }) {\n+  return formatInternationalizedDateTime(date, format);\n }\n \n /**\n  * Utility function to determine if a string is a date.\n- * @param {string} date\n+ * @param {(number | string)} date\n  * @returns {boolean}\n  */\n export function isDate(date) {\n-  return moment.isDate(new Date(date));\n+  const d = new Date(date);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cb6ef17c2fbce0f134be177a383a79262fbf083f"}, "originalPosition": 104}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDUyNjg5Ng==", "bodyText": "Change the constant d1 and d2 to something more descriptive", "url": "https://github.com/phac-nml/irida/pull/699#discussion_r430526896", "createdAt": "2020-05-26T16:00:23Z", "author": {"login": "deepsidhu85"}, "path": "src/main/webapp/resources/js/utilities/date-utilities.js", "diffHunk": "@@ -1,79 +1,72 @@\n-import moment from \"moment\";\n+import dayjs from \"dayjs\";\n+import relativeTime from \"dayjs/plugin/relativeTime\";\n+import duration from \"dayjs/plugin/duration\";\n \n-export function formatInternationalizedDateTime(d, options = {}) {\n-  const params = {\n+export function formatInternationalizedDateTime(\n+  d,\n+  options = {\n     hour: \"numeric\",\n     minute: \"numeric\",\n-    second: \"numeric\",\n     year: \"numeric\",\n     month: \"short\",\n     day: \"numeric\",\n-    ...options\n-  };\n-  return new Intl.DateTimeFormat(window.TL.LANGUAGE_TAG, params).format(\n+  }\n+) {\n+  if (!isDate(d)) return \"\";\n+  return new Intl.DateTimeFormat(window.TL.LANGUAGE_TAG, options).format(\n     new Date(d)\n   );\n }\n \n-/**\n- * Get how much time has passed since a certain date.\n- * @param {Number} now current\n- * @param {Number} date event occurred\n- * @return {string} formatted time since.\n- */\n-export function formatTimeForNow({ now, date }) {\n-  const dNow = new Date(now);\n-  const dDate = new Date(date);\n-  if (moment.isDate(dNow) && moment.isDate(dDate)) {\n-    return moment(dDate).from(moment(dNow));\n-  }\n-}\n-\n /**\n  * Generate the a human readable form from milliseconds.\n  * @param {Number} date to format\n  * @return {string} humanized version of the date\n  */\n export function getHumanizedDuration({ date }) {\n-  if (date !== null) {\n-    return moment.duration(date).humanize();\n-  }\n-  return \"\";\n+  dayjs.extend(duration);\n+  dayjs.extend(relativeTime);\n+  return dayjs.duration(-date).humanize(false);\n }\n \n /**\n  * Generate the time from now.  Renders as human readable.s\n- * @param {string} date raw string date from server\n+ * @param {number} date raw string date from server\n  * @return {*}\n  */\n export function fromNow({ date }) {\n-  const start = new Date(date);\n-  if (moment.isDate(start)) {\n-    const t = moment(start).fromNow();\n-    return t;\n-  }\n-  return \"\";\n+  // Using dayjs because Intl.RelativeTimeFormat does not have browser\n+  // support in IE11 or safari yet.\n+  dayjs.extend(duration);\n+  dayjs.extend(relativeTime);\n+  const d1 = dayjs();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cb6ef17c2fbce0f134be177a383a79262fbf083f"}, "originalPosition": 74}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDUyNzE2Nw==", "bodyText": "Change the constant d to something more descriptive", "url": "https://github.com/phac-nml/irida/pull/699#discussion_r430527167", "createdAt": "2020-05-26T16:00:47Z", "author": {"login": "deepsidhu85"}, "path": "src/main/webapp/resources/js/utilities/date-utilities.js", "diffHunk": "@@ -1,79 +1,72 @@\n-import moment from \"moment\";\n+import dayjs from \"dayjs\";\n+import relativeTime from \"dayjs/plugin/relativeTime\";\n+import duration from \"dayjs/plugin/duration\";\n \n-export function formatInternationalizedDateTime(d, options = {}) {\n-  const params = {\n+export function formatInternationalizedDateTime(\n+  d,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cb6ef17c2fbce0f134be177a383a79262fbf083f"}, "originalPosition": 9}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "32cc2f166c5daf0684c0290146aad66b22d24703", "author": {"user": {"login": "joshsadam", "name": "Josh Adam"}}, "url": "https://github.com/phac-nml/irida/commit/32cc2f166c5daf0684c0290146aad66b22d24703", "committedDate": "2020-05-26T19:40:17Z", "message": "Removed undescriptive variables"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b9014552b2d05dfd2ba96f50c7e74571063595a0", "author": {"user": {"login": "joshsadam", "name": "Josh Adam"}}, "url": "https://github.com/phac-nml/irida/commit/b9014552b2d05dfd2ba96f50c7e74571063595a0", "committedDate": "2020-05-26T19:42:11Z", "message": "Renamed variable"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e9791929ef7e1483903b768d2ffa071cc94c14f3", "author": {"user": {"login": "joshsadam", "name": "Josh Adam"}}, "url": "https://github.com/phac-nml/irida/commit/e9791929ef7e1483903b768d2ffa071cc94c14f3", "committedDate": "2020-05-29T18:39:06Z", "message": "Merge branch 'development' into replace-momentjs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "923a69cb04e626d91d3da312c03daf593af73e21", "author": {"user": {"login": "joshsadam", "name": "Josh Adam"}}, "url": "https://github.com/phac-nml/irida/commit/923a69cb04e626d91d3da312c03daf593af73e21", "committedDate": "2020-05-29T18:39:33Z", "message": ":memo: Updated CHANGELOG.md"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fd337f7be152a60bbba674fa33bb67861f9dc658", "author": {"user": {"login": "joshsadam", "name": "Josh Adam"}}, "url": "https://github.com/phac-nml/irida/commit/fd337f7be152a60bbba674fa33bb67861f9dc658", "committedDate": "2020-06-01T20:39:32Z", "message": "Merge branch 'development' into replace-momentjs\n\n# Conflicts:\n#\tCHANGELOG.md"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIyMjEwODM3", "url": "https://github.com/phac-nml/irida/pull/699#pullrequestreview-422210837", "createdAt": "2020-06-01T21:58:10Z", "commit": {"oid": "fd337f7be152a60bbba674fa33bb67861f9dc658"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 263, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}