{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTA1MDE3MzE0", "number": 829, "title": "Pipeline Launch: Basics", "bodyText": "Description of changes\nCreates a new launch page for launching IRIDA Workflow pipelines. This page currently only display the pipeline name and description to keep it simple, but will be built upon in subsequent merge requests.\nA new entry.html page is added to the project.  This can be used by any page that only uses a React component and does not require any additional content added to the page (which is pretty standard now in the application).  All that is required is that the Spring Controller have and model attribute called entry which contains the name of the entry in the web pack entries.js file.  This will add the appropriate CSS and JavaScript files to the page on run time.\nRelated issue\nN/A\nChecklist\nThings for the developer to confirm they've done before the PR should be accepted:\n* [ ] CHANGELOG.md (and UPGRADING.md if necessary) updated with information for new change.\n* [ ] Tests added (or description of how to test) for any new features.\n* [ ] User documentation updated for UI or technical changes.", "createdAt": "2020-10-16T18:11:09Z", "url": "https://github.com/phac-nml/irida/pull/829", "merged": true, "mergeCommit": {"oid": "c9b361fc6b20f3f378c855073e8ecaf14bf4777d"}, "closed": true, "closedAt": "2020-10-20T12:44:27Z", "author": {"login": "joshsadam"}, "timelineItems": {"totalCount": 17, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdTIy8igH2gAyNTA1MDE3MzE0OjQ3ZDAwYWI5ZWUzMGYwNjQ1NjVkNTAxNTRmOGQyNzczYzU3Y2UxNDU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdUWapKAH2gAyNTA1MDE3MzE0OjRmMWJmMmRlMTUwYzc5Mzc2MjAxZDFkOWJkZDA1ZThiOWM2MzdkN2U=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "47d00ab9ee30f064565d50154f8d2773c57ce145", "author": {"user": {"login": "joshsadam", "name": "Josh Adam"}}, "url": "https://github.com/phac-nml/irida/commit/47d00ab9ee30f064565d50154f8d2773c57ce145", "committedDate": "2020-10-16T16:16:41Z", "message": "Generic html file that can be used for any react based entry."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6d21fad85356c064d08469c78447df5fb32cf78c", "author": {"user": {"login": "joshsadam", "name": "Josh Adam"}}, "url": "https://github.com/phac-nml/irida/commit/6d21fad85356c064d08469c78447df5fb32cf78c", "committedDate": "2020-10-16T16:17:21Z", "message": "Basic setup for rending the new launch page."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0c0b5b9cc801ef09c939792032cd13707114b7de", "author": {"user": {"login": "joshsadam", "name": "Josh Adam"}}, "url": "https://github.com/phac-nml/irida/commit/0c0b5b9cc801ef09c939792032cd13707114b7de", "committedDate": "2020-10-16T18:09:54Z", "message": "\ud83d\udea7 Display only name and pipeline description"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fd427fe0bb6b9eed4e97224e1d25e8b2534befb9", "author": {"user": {"login": "joshsadam", "name": "Josh Adam"}}, "url": "https://github.com/phac-nml/irida/commit/fd427fe0bb6b9eed4e97224e1d25e8b2534befb9", "committedDate": "2020-10-16T18:24:25Z", "message": "Updated JSDoc"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d43e1526918c39c973bba01319205a54a722e0e2", "author": {"user": {"login": "joshsadam", "name": "Josh Adam"}}, "url": "https://github.com/phac-nml/irida/commit/d43e1526918c39c973bba01319205a54a722e0e2", "committedDate": "2020-10-16T18:26:27Z", "message": "This file is not needed, ...yet"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a7eda0c8b974166fbc7931dc29c64e895af71a19", "author": {"user": {"login": "joshsadam", "name": "Josh Adam"}}, "url": "https://github.com/phac-nml/irida/commit/a7eda0c8b974166fbc7931dc29c64e895af71a19", "committedDate": "2020-10-16T18:27:28Z", "message": "Updated JavaDoc"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c237c841884cd628617107b55f1b9c8fdc5fc14b", "author": {"user": {"login": "joshsadam", "name": "Josh Adam"}}, "url": "https://github.com/phac-nml/irida/commit/c237c841884cd628617107b55f1b9c8fdc5fc14b", "committedDate": "2020-10-16T18:28:44Z", "message": "Update JavaDoc"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8d784ac7326fdeab21dc62d7af9495a7081977e1", "author": {"user": {"login": "joshsadam", "name": "Josh Adam"}}, "url": "https://github.com/phac-nml/irida/commit/8d784ac7326fdeab21dc62d7af9495a7081977e1", "committedDate": "2020-10-16T18:29:49Z", "message": "Updated JavaDoc and cleaned up code formatting"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "47b4ac0b90b03c928e4832f382d7bb9b6aae8d05", "author": {"user": {"login": "joshsadam", "name": "Josh Adam"}}, "url": "https://github.com/phac-nml/irida/commit/47b4ac0b90b03c928e4832f382d7bb9b6aae8d05", "committedDate": "2020-10-16T18:31:59Z", "message": "Updated JavaDoc"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "78ae0687a4e954451c760c57a9593d63cdd6781c", "author": {"user": {"login": "joshsadam", "name": "Josh Adam"}}, "url": "https://github.com/phac-nml/irida/commit/78ae0687a4e954451c760c57a9593d63cdd6781c", "committedDate": "2020-10-16T18:35:54Z", "message": "Added comment about why the generic entry.html file"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7685925ea66dc59a90bef51bb1baf1b347b09be5", "author": {"user": {"login": "joshsadam", "name": "Josh Adam"}}, "url": "https://github.com/phac-nml/irida/commit/7685925ea66dc59a90bef51bb1baf1b347b09be5", "committedDate": "2020-10-16T18:37:20Z", "message": "Update JSDoc"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTEwNzE1MzMx", "url": "https://github.com/phac-nml/irida/pull/829#pullrequestreview-510715331", "createdAt": "2020-10-16T18:37:58Z", "commit": {"oid": "7685925ea66dc59a90bef51bb1baf1b347b09be5"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNlQxODozNzo1OFrOHjL5gg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNlQxODozNzo1OFrOHjL5gg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjY1NzE1NA==", "bodyText": "This is only temporary so I can compare between the two", "url": "https://github.com/phac-nml/irida/pull/829#discussion_r506657154", "createdAt": "2020-10-16T18:37:58Z", "author": {"login": "joshsadam"}, "path": "src/main/webapp/resources/js/components/pipeline/Pipeline.jsx", "diffHunk": "@@ -88,7 +88,10 @@ export default class Pipeline extends React.Component {\n                   href={pipelineUrl}\n                 >\n                   {i18n(\"pipelines.cart.select\")}\n-                </Button>\n+                </Button>,\n+              <Button type=\"link\" href={setBaseUrl(`launch?id=${this.props.id}`)}>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7685925ea66dc59a90bef51bb1baf1b347b09be5"}, "originalPosition": 6}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "32cad98f410515e2b867cdad4a181087fa77395c", "author": {"user": {"login": "joshsadam", "name": "Josh Adam"}}, "url": "https://github.com/phac-nml/irida/commit/32cad98f410515e2b867cdad4a181087fa77395c", "committedDate": "2020-10-19T10:23:52Z", "message": ":bulb: Added missing comment for thrown exception in UIPipelineService"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9f0bbb5cfe5d731ef0e43f52ed00f38948317545", "author": {"user": {"login": "joshsadam", "name": "Josh Adam"}}, "url": "https://github.com/phac-nml/irida/commit/9f0bbb5cfe5d731ef0e43f52ed00f38948317545", "committedDate": "2020-10-19T10:28:06Z", "message": ":bulb: Updated JSDoc"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTEyMDg4NzA3", "url": "https://github.com/phac-nml/irida/pull/829#pullrequestreview-512088707", "createdAt": "2020-10-19T19:24:04Z", "commit": {"oid": "9f0bbb5cfe5d731ef0e43f52ed00f38948317545"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xOVQxOToyNDowNFrOHkeRHA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xOVQxOToyOTo1NFrOHkedqw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODAwNjY4NA==", "bodyText": "Ceate a dto which has a project and list of samples rather than returning a map", "url": "https://github.com/phac-nml/irida/pull/829#discussion_r508006684", "createdAt": "2020-10-19T19:24:04Z", "author": {"login": "deepsidhu85"}, "path": "src/main/java/ca/corefacility/bioinformatics/irida/ria/web/services/UICartService.java", "diffHunk": "@@ -110,7 +110,7 @@ public int removeProject(Long id) {\n \t/**\n \t * Get the entire cart flushed out into {@link Project}s with their {@link Sample}s\n \t *\n-\t * @return All proejcts and samples in the part\n+\t * @return All projects and samples in the part\n \t */\n \tpublic Map<Project, List<Sample>> getFullCart() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9f0bbb5cfe5d731ef0e43f52ed00f38948317545"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODAwNzQwMw==", "bodyText": "Change launch to launched", "url": "https://github.com/phac-nml/irida/pull/829#discussion_r508007403", "createdAt": "2020-10-19T19:25:21Z", "author": {"login": "deepsidhu85"}, "path": "src/main/java/ca/corefacility/bioinformatics/irida/ria/web/services/UIPipelineService.java", "diffHunk": "@@ -0,0 +1,57 @@\n+package ca.corefacility.bioinformatics.irida.ria.web.services;\n+\n+import java.util.Locale;\n+import java.util.UUID;\n+\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.context.MessageSource;\n+import org.springframework.stereotype.Component;\n+\n+import ca.corefacility.bioinformatics.irida.exceptions.IridaWorkflowNotFoundException;\n+import ca.corefacility.bioinformatics.irida.model.workflow.IridaWorkflow;\n+import ca.corefacility.bioinformatics.irida.model.workflow.description.IridaWorkflowDescription;\n+import ca.corefacility.bioinformatics.irida.ria.web.ajax.dto.launch.UIPipelineDetailsResponse;\n+import ca.corefacility.bioinformatics.irida.service.workflow.IridaWorkflowsService;\n+\n+/**\n+ * UI Service for all things related to workflow pipelines.\n+ */\n+@Component\n+public class UIPipelineService {\n+    private final IridaWorkflowsService workflowsService;\n+    private final MessageSource messageSource;\n+\n+    @Autowired\n+    public UIPipelineService(IridaWorkflowsService workflowsService, MessageSource messageSource) {\n+        this.workflowsService = workflowsService;\n+        this.messageSource = messageSource;\n+    }\n+\n+    /**\n+     * Get the information about a specific workflow pipeline\n+     *\n+     * @param id     for a {@link IridaWorkflow}\n+     * @param locale current users {@link Locale}\n+     * @return Details contained within a {@link UIPipelineDetailsResponse}\n+     * @throws IridaWorkflowNotFoundException exception thrown if the workflow cannot be found.\n+     */\n+    public UIPipelineDetailsResponse getPipelineDetails(UUID id, Locale locale) throws IridaWorkflowNotFoundException {\n+        IridaWorkflow workflow = workflowsService.getIridaWorkflow(id);\n+        IridaWorkflowDescription description = workflow.getWorkflowDescription();\n+        UIPipelineDetailsResponse detailsResponse = new UIPipelineDetailsResponse();\n+\n+        /*\n+        Prefix for getting messages from IRIDA message properties file\n+         */\n+        String prefix = \"workflow.\" + description.getAnalysisType().getType() + \".\";\n+\n+        /*\n+        Set up basic information for the pipeline being launch.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9f0bbb5cfe5d731ef0e43f52ed00f38948317545"}, "originalPosition": 49}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODAwODc3OA==", "bodyText": "Shouldn't we rethrow this error and catch it in the UI rather than logging it?", "url": "https://github.com/phac-nml/irida/pull/829#discussion_r508008778", "createdAt": "2020-10-19T19:27:52Z", "author": {"login": "deepsidhu85"}, "path": "src/main/webapp/resources/js/apis/pipelines/pipelines.js", "diffHunk": "@@ -27,10 +28,21 @@ export async function getIridaWorkflowDescription(workflowUUID) {\n  * Get a listing of all Pipelines in IRIDA.\n  * @returns {Promise<AxiosResponse<any> | never>}\n  */\n-export const fetchIridaAnalysisWorkflows = async function() {\n+export const fetchIridaAnalysisWorkflows = async function () {\n   var ajaxUrl = URL;\n   if (window.PAGE.automatedProject !== null) {\n     ajaxUrl = `${ajaxUrl}?automatedProject=${window.PAGE.automatedProject}`;\n   }\n-  return axios.get(ajaxUrl).then(response => response.data);\n+  return axios.get(ajaxUrl).then((response) => response.data);\n };\n+\n+/**\n+ * Get details about a specific pipeline to be able to launch.\n+ * @param id - UUID identifier for the pipeline\n+ * @returns {*}\n+ */\n+export const getPipelineDetails = ({ id }) =>\n+  axios\n+    .get(`${AJAX_URL}/${id}`)\n+    .then(({ data }) => data)\n+    .catch((error) => console.log(error.response.data));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9f0bbb5cfe5d731ef0e43f52ed00f38948317545"}, "originalPosition": 40}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODAwOTQxMw==", "bodyText": "File comments", "url": "https://github.com/phac-nml/irida/pull/829#discussion_r508009413", "createdAt": "2020-10-19T19:29:02Z", "author": {"login": "deepsidhu85"}, "path": "src/main/webapp/resources/js/pages/launch/launch-context.js", "diffHunk": "@@ -0,0 +1,59 @@\n+import React from \"react\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9f0bbb5cfe5d731ef0e43f52ed00f38948317545"}, "originalPosition": 1}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODAwOTg5OQ==", "bodyText": "Can you add a comment to this function and the one below explaining when they are to be used", "url": "https://github.com/phac-nml/irida/pull/829#discussion_r508009899", "createdAt": "2020-10-19T19:29:54Z", "author": {"login": "deepsidhu85"}, "path": "src/main/webapp/resources/js/pages/launch/launch-context.js", "diffHunk": "@@ -0,0 +1,59 @@\n+import React from \"react\";\n+import { getPipelineDetails } from \"../../apis/pipelines/pipelines\";\n+\n+const LaunchStateContext = React.createContext();\n+const LaunchDispatchContext = React.createContext();\n+\n+const TYPES = {\n+  LOADED: \"launch:loaded\",\n+};\n+\n+const reducer = (state, action) => {\n+  switch (action.type) {\n+    case TYPES.LOADED:\n+      return { ...state, loading: false, ...action.details };\n+  }\n+};\n+\n+function LaunchProvider({ children }) {\n+  const [id] = React.useState(() => {\n+    const params = new URLSearchParams(window.location.search);\n+    return params.get(\"id\");\n+  });\n+\n+  const [state, dispatch] = React.useReducer(reducer, { loading: true });\n+\n+  React.useEffect(() => {\n+    getPipelineDetails({ id }).then((data) => {\n+      const { name, description, ...details } = data;\n+      details.pipeline = { name, description };\n+      dispatch({ type: TYPES.LOADED, details });\n+    });\n+  }, [id]);\n+\n+  return (\n+    <LaunchStateContext.Provider value={state}>\n+      <LaunchDispatchContext.Provider value={dispatch}>\n+        {children}\n+      </LaunchDispatchContext.Provider>\n+    </LaunchStateContext.Provider>\n+  );\n+}\n+\n+function useLaunchState() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9f0bbb5cfe5d731ef0e43f52ed00f38948317545"}, "originalPosition": 43}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e8fd739f2696876b708027f27a68e7651df9e7ac", "author": {"user": {"login": "joshsadam", "name": "Josh Adam"}}, "url": "https://github.com/phac-nml/irida/commit/e8fd739f2696876b708027f27a68e7651df9e7ac", "committedDate": "2020-10-20T10:15:56Z", "message": ":pencil2: Fixed typo"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4f1bf2de150c79376201d1d9bdd05e8b9c637d7e", "author": {"user": {"login": "joshsadam", "name": "Josh Adam"}}, "url": "https://github.com/phac-nml/irida/commit/4f1bf2de150c79376201d1d9bdd05e8b9c637d7e", "committedDate": "2020-10-20T10:42:44Z", "message": ":bulb: Updated file comment for the launch context"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 140, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}