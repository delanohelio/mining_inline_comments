{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTA4MzQzMjEx", "number": 834, "title": "Refactor statistics queries", "bodyText": "Description of changes\nWhat did you change in this pull request?  Provide a description of files changed, user interactions changed, etc.  Include how to test your changes.\nRefactored queries for statistics (analyses, projects, samples, users)  to use the same query per repository rather than have 4 individual queries per repository.\nRelated issue\nLink to the GitHub issue this pull request addresses using the #issuenum format.  If it completes an issue, use Fixes #issuenum to automatically close the issue.\nChecklist\nThings for the developer to confirm they've done before the PR should be accepted:\n* [ ] CHANGELOG.md (and UPGRADING.md if necessary) updated with information for new change.\n* [ ] Tests added (or description of how to test) for any new features.\n* [ ] User documentation updated for UI or technical changes.", "createdAt": "2020-10-22T14:39:46Z", "url": "https://github.com/phac-nml/irida/pull/834", "merged": true, "mergeCommit": {"oid": "c52548fb47fb5ebcbc3ce7a41c09b35725842b96"}, "closed": true, "closedAt": "2020-11-19T14:32:15Z", "author": {"login": "deepsidhu85"}, "timelineItems": {"totalCount": 13, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdVC-uXAH2gAyNTA4MzQzMjExOjUzZjQyMDljMWQ3YzBhNzVlNzQ2MDY1MmFlMmQwYzViNmZjZDQzZTM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdd1c8GgFqTUzMzkxMzYwNw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "53f4209c1d7c0a75e7460652ae2d0c5b6fcd43e3", "author": {"user": {"login": "deepsidhu85", "name": null}}, "url": "https://github.com/phac-nml/irida/commit/53f4209c1d7c0a75e7460652ae2d0c5b6fcd43e3", "committedDate": "2020-10-22T14:37:58Z", "message": "Refactored queries (analyses, projects, samples, users) for statistics to use the same query per repo rather than have 4 individual queries per repo."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cdd5a7aec6e160536c15b6d9d2c7b4895fc4b538", "author": {"user": {"login": "deepsidhu85", "name": null}}, "url": "https://github.com/phac-nml/irida/commit/cdd5a7aec6e160536c15b6d9d2c7b4895fc4b538", "committedDate": "2020-10-23T12:50:38Z", "message": "Added missing javadocs. Removed unused import"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE1Nzk0NDAz", "url": "https://github.com/phac-nml/irida/pull/834#pullrequestreview-515794403", "createdAt": "2020-10-23T15:47:40Z", "commit": {"oid": "cdd5a7aec6e160536c15b6d9d2c7b4895fc4b538"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yM1QxNTo0Nzo0MFrOHnTlsw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yM1QxNTo1MzozMVrOHnTzdw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDk3NzQ1OQ==", "bodyText": "Would it make sense to put all this stuff into StatisticTimePeriod?  You already have these exact values there so it's a bit of a duplication.\nIf you did that you could just add the groupByFormat property to that enum.", "url": "https://github.com/phac-nml/irida/pull/834#discussion_r510977459", "createdAt": "2020-10-23T15:47:40Z", "author": {"login": "tom114"}, "path": "src/main/java/ca/corefacility/bioinformatics/irida/model/enums/GroupByFormat.java", "diffHunk": "@@ -0,0 +1,44 @@\n+package ca.corefacility.bioinformatics.irida.model.enums;\n+\n+/**\n+ * Defines a set of formats which admin statistics\n+ * can be grouped by\n+ *\n+ */\n+\n+public enum GroupByFormat {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cdd5a7aec6e160536c15b6d9d2c7b4895fc4b538"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDk3ODE3NA==", "bodyText": "Use the enum values instead of fromString.  So GroupByFormat.DAILY instead here.", "url": "https://github.com/phac-nml/irida/pull/834#discussion_r510978174", "createdAt": "2020-10-23T15:48:55Z", "author": {"login": "tom114"}, "path": "src/main/java/ca/corefacility/bioinformatics/irida/ria/web/services/UIAdminStatisticsService.java", "diffHunk": "@@ -86,17 +86,21 @@ public StatisticsResponse getAdminAnalysesStatistics(Integer timePeriod) {\n \n \t\tif (IntStream.of(StatisticTimePeriod.DAILY.getDaily())\n \t\t\t\t.anyMatch((x -> x == timePeriod))) {\n-\t\t\treturn new StatisticsResponse(analysisSubmissionService.getAnalysesRanDaily(minimumCreatedDate));\n+\t\t\treturn new StatisticsResponse(analysisSubmissionService.getAnalysesRanGrouped(minimumCreatedDate,\n+\t\t\t\t\tGroupByFormat.fromString(\"daily\")));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cdd5a7aec6e160536c15b6d9d2c7b4895fc4b538"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDk4MDk4Mw==", "bodyText": "If you ended up moving the GroupByFormat stuff into StatisticsResponse you could also refactor to remove this whole if stack and get the method to just figure out which StatisticsResponse to use, and directly call into the service method with that StatisticsResponse.", "url": "https://github.com/phac-nml/irida/pull/834#discussion_r510980983", "createdAt": "2020-10-23T15:53:31Z", "author": {"login": "tom114"}, "path": "src/main/java/ca/corefacility/bioinformatics/irida/ria/web/services/UIAdminStatisticsService.java", "diffHunk": "@@ -86,17 +86,21 @@ public StatisticsResponse getAdminAnalysesStatistics(Integer timePeriod) {\n \n \t\tif (IntStream.of(StatisticTimePeriod.DAILY.getDaily())", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cdd5a7aec6e160536c15b6d9d2c7b4895fc4b538"}, "originalPosition": 20}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c5a00bcd1e78198ca591eaa499e2e494dd1cd5ca", "author": {"user": {"login": "deepsidhu85", "name": null}}, "url": "https://github.com/phac-nml/irida/commit/c5a00bcd1e78198ca591eaa499e2e494dd1cd5ca", "committedDate": "2020-10-26T13:12:02Z", "message": "Moved groupbyformat enum values into statistictimeperiod enum. Refactored logic in uiadminstatisticsservice to clean up if/else blocks"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "79f3a3ee19adfa3e6647dbe5ba385320206864e2", "author": {"user": {"login": "deepsidhu85", "name": null}}, "url": "https://github.com/phac-nml/irida/commit/79f3a3ee19adfa3e6647dbe5ba385320206864e2", "committedDate": "2020-10-26T14:17:09Z", "message": "Fixed typo and removed getters not required"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE2OTU4MjEy", "url": "https://github.com/phac-nml/irida/pull/834#pullrequestreview-516958212", "createdAt": "2020-10-26T16:29:08Z", "commit": {"oid": "79f3a3ee19adfa3e6647dbe5ba385320206864e2"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yNlQxNjoyOTowOFrOHoX5Vw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yNlQxNjo1MDoyM1rOHoY6uw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjA5NjU5OQ==", "bodyText": "Can you add a comment on what these int values are for?", "url": "https://github.com/phac-nml/irida/pull/834#discussion_r512096599", "createdAt": "2020-10-26T16:29:08Z", "author": {"login": "tom114"}, "path": "src/main/java/ca/corefacility/bioinformatics/irida/model/enums/StatisticTimePeriod.java", "diffHunk": "@@ -1,31 +1,39 @@\n package ca.corefacility.bioinformatics.irida.model.enums;\n \n /**\n- * Defines a arrays of time periods used\n+ * Defines a arrays of time periods and group by formats used\n  * for getting statistics for the Admin Panel.\n  *\n  */\n \n public enum StatisticTimePeriod {\n-\tDAILY(7,14,30),\n-\tMONTHLY(90, 365),\n-\tYEARLY(730, 1825, 3650);\n+\tHOURLY(new int[] {1}, \"%H:00\"),\n+\tDAILY(new int[] {7,14,30}, \"%m/%d\"),\n+\tMONTHLY(new int[] {90, 365}, \"%m/%y\"),\n+\tYEARLY(new int[] {730, 1825, 3650}, \"%Y\");\n \n \tprivate int [] values;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "79f3a3ee19adfa3e6647dbe5ba385320206864e2"}, "originalPosition": 19}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjA5OTExNg==", "bodyText": "Is there any use for the setters?  Since its an enum it doesn't really make sense for an outside object to modify it.  If its needed for hibernate or something though you can switch them to private.", "url": "https://github.com/phac-nml/irida/pull/834#discussion_r512099116", "createdAt": "2020-10-26T16:32:33Z", "author": {"login": "tom114"}, "path": "src/main/java/ca/corefacility/bioinformatics/irida/model/enums/StatisticTimePeriod.java", "diffHunk": "@@ -1,31 +1,39 @@\n package ca.corefacility.bioinformatics.irida.model.enums;\n \n /**\n- * Defines a arrays of time periods used\n+ * Defines a arrays of time periods and group by formats used\n  * for getting statistics for the Admin Panel.\n  *\n  */\n \n public enum StatisticTimePeriod {\n-\tDAILY(7,14,30),\n-\tMONTHLY(90, 365),\n-\tYEARLY(730, 1825, 3650);\n+\tHOURLY(new int[] {1}, \"%H:00\"),\n+\tDAILY(new int[] {7,14,30}, \"%m/%d\"),\n+\tMONTHLY(new int[] {90, 365}, \"%m/%y\"),\n+\tYEARLY(new int[] {730, 1825, 3650}, \"%Y\");\n \n \tprivate int [] values;\n+\tprivate String groupByFormat;\n \n-\tprivate StatisticTimePeriod(int... values) {\n+\tprivate StatisticTimePeriod(int[] values, String groupByFormat) {\n \t\tthis.values = values;\n+\t\tthis.groupByFormat = groupByFormat;\n \t}\n \n-\tpublic int[] getDaily() {\n-\t\treturn DAILY.values;\n+\tpublic int[] getValues() {\n+\t\treturn values;\n \t}\n \n-\tpublic int[] getMonthly() {\n-\t\treturn MONTHLY.values;\n+\tpublic void setValues(int[] values) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "79f3a3ee19adfa3e6647dbe5ba385320206864e2"}, "originalPosition": 36}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjExMzMzOQ==", "bodyText": "Thanks.  That paired down all those functions by a pile.", "url": "https://github.com/phac-nml/irida/pull/834#discussion_r512113339", "createdAt": "2020-10-26T16:50:23Z", "author": {"login": "tom114"}, "path": "src/main/java/ca/corefacility/bioinformatics/irida/ria/web/services/UIAdminStatisticsService.java", "diffHunk": "@@ -86,17 +86,21 @@ public StatisticsResponse getAdminAnalysesStatistics(Integer timePeriod) {\n \n \t\tif (IntStream.of(StatisticTimePeriod.DAILY.getDaily())", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDk4MDk4Mw=="}, "originalCommit": {"oid": "cdd5a7aec6e160536c15b6d9d2c7b4895fc4b538"}, "originalPosition": 20}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE2OTgxMDQz", "url": "https://github.com/phac-nml/irida/pull/834#pullrequestreview-516981043", "createdAt": "2020-10-26T16:51:02Z", "commit": {"oid": "79f3a3ee19adfa3e6647dbe5ba385320206864e2"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "863ac81b3bf92f01c418d0d5b77d95511d1f96df", "author": {"user": {"login": "deepsidhu85", "name": null}}, "url": "https://github.com/phac-nml/irida/commit/863ac81b3bf92f01c418d0d5b77d95511d1f96df", "committedDate": "2020-10-26T18:53:15Z", "message": "Added comments and removed setters not required for enum"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2f2501683ba267f66f41e18cea33dace7bc939cd", "author": {"user": {"login": "deepsidhu85", "name": null}}, "url": "https://github.com/phac-nml/irida/commit/2f2501683ba267f66f41e18cea33dace7bc939cd", "committedDate": "2020-10-28T14:09:01Z", "message": "Merge branch 'admin-statistics/_base' into admin-statistics/_refactor-queries"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "81c18b1708b93da00b19585dda49144f0181b398", "author": {"user": {"login": "deepsidhu85", "name": null}}, "url": "https://github.com/phac-nml/irida/commit/81c18b1708b93da00b19585dda49144f0181b398", "committedDate": "2020-11-02T15:31:11Z", "message": "Merge branch 'admin-statistics/_base' into admin-statistics/_refactor-queries"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0f50ac580c4f7c17cfceacb1d2c828cd49f09dad", "author": {"user": {"login": "deepsidhu85", "name": null}}, "url": "https://github.com/phac-nml/irida/commit/0f50ac580c4f7c17cfceacb1d2c828cd49f09dad", "committedDate": "2020-11-17T16:55:55Z", "message": "Merge branch 'admin-statistics/_base' into admin-statistics/_refactor-queries"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4a9b6a7e6e3eab4b6096e5200048d409c4dbdaca", "author": {"user": {"login": "deepsidhu85", "name": null}}, "url": "https://github.com/phac-nml/irida/commit/4a9b6a7e6e3eab4b6096e5200048d409c4dbdaca", "committedDate": "2020-11-18T21:25:43Z", "message": "Merge branch 'admin-statistics/_base' into admin-statistics/_refactor-queries"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMzOTEzNjA3", "url": "https://github.com/phac-nml/irida/pull/834#pullrequestreview-533913607", "createdAt": "2020-11-18T21:57:37Z", "commit": {"oid": "4a9b6a7e6e3eab4b6096e5200048d409c4dbdaca"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 150, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}