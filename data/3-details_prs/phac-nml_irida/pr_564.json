{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzYxNTU2MjIx", "number": 564, "title": "SRA Upload: Append .gz to uploaded filenames if fastq files are compressed", "bodyText": "Description of changes\nWhat did you change in this pull request?  Provide a description of files changed, user interactions changed, etc.  Include how to test your changes.\nWhen preparing an NCBI SRA upload, check if the sequence file is compressed. If so, use the fastq.gz extension. Otherwise, use .fastq\nTo test: Perform a test upload to NCBI SRA. Confirm that for gzipped fastq files, the uploaded files have a .fastq.gz extension, and plaintext files have a .fastq extension.\nRelated issue\nLink to the GitHub issue this pull request addresses using the #issuenum format.  If it completes an issue, use Fixes #issuenum to automatically close the issue.\nFixes #563\nChecklist\nThings for the developer to confirm they've done before the PR should be accepted:\n\n CHANGELOG.md (and UPGRADING.md if necessary) updated with information for new change.\n Tests added (or description of how to test) for any new features.\n User documentation updated for UI or technical changes.", "createdAt": "2020-01-10T17:43:57Z", "url": "https://github.com/phac-nml/irida/pull/564", "merged": true, "mergeCommit": {"oid": "0ab59ecb8511a2b56a05cd199be818e172e7d165"}, "closed": true, "closedAt": "2020-01-29T15:29:51Z", "author": {"login": "dfornika"}, "timelineItems": {"totalCount": 16, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb5CK_xAH2gAyMzYxNTU2MjIxOmQ1MDljMjlmM2FkZjFjMGRlMGVmNzMwMDcxZTczODUyYTc2MTI1ODk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABb_HrU2gFqTM1MDE5NTk3Ng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "d509c29f3adf1c0de0ef730071e73852a7612589", "author": {"user": {"login": "dfornika", "name": "Dan Fornika"}}, "url": "https://github.com/phac-nml/irida/commit/d509c29f3adf1c0de0ef730071e73852a7612589", "committedDate": "2020-01-10T17:40:26Z", "message": "Append .gz to uploaded filenames if fastq files are compressed"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e77f4b2069af1434dd0a41e5c7daed41198f70a3", "author": {"user": {"login": "dfornika", "name": "Dan Fornika"}}, "url": "https://github.com/phac-nml/irida/commit/e77f4b2069af1434dd0a41e5c7daed41198f70a3", "committedDate": "2020-01-10T18:22:58Z", "message": "Fix detection of .gz file extension"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "890ef9433452e53d0e447d5e59f62d9b9d91d623", "author": {"user": {"login": "dfornika", "name": "Dan Fornika"}}, "url": "https://github.com/phac-nml/irida/commit/890ef9433452e53d0e447d5e59f62d9b9d91d623", "committedDate": "2020-01-10T19:00:24Z", "message": "Adjust NCBI SRA submission template to handle gzipped fastq"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1040fb0eb3fc8e5d5012a00c36b9c66e7d3e5d14", "author": {"user": {"login": "dfornika", "name": "Dan Fornika"}}, "url": "https://github.com/phac-nml/irida/commit/1040fb0eb3fc8e5d5012a00c36b9c66e7d3e5d14", "committedDate": "2020-01-10T19:15:44Z", "message": "Handle fastq and fastq.gz files, both paired and single in submission.xml template"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7bda091898473166a61f0b3b8ef4fdf55653de94", "author": {"user": {"login": "dfornika", "name": "Dan Fornika"}}, "url": "https://github.com/phac-nml/irida/commit/7bda091898473166a61f0b3b8ef4fdf55653de94", "committedDate": "2020-01-10T19:23:27Z", "message": "Fix preparing reverse filename in submission.xml template"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5ad65798f23bb4339a3ccf6fed055842396b2f05", "author": {"user": {"login": "dfornika", "name": "Dan Fornika"}}, "url": "https://github.com/phac-nml/irida/commit/5ad65798f23bb4339a3ccf6fed055842396b2f05", "committedDate": "2020-01-10T20:15:04Z", "message": "Typo getFile() -> getFiles()"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "31425ea32e7e23b710440e8c5da7d3051979dc2e", "author": {"user": {"login": "dfornika", "name": "Dan Fornika"}}, "url": "https://github.com/phac-nml/irida/commit/31425ea32e7e23b710440e8c5da7d3051979dc2e", "committedDate": "2020-01-10T20:25:54Z", "message": "Add test for creating NCBI upload with fastq.gz extension"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f115ca25b8e94590bfcec142f2824763d05548f6", "author": {"user": {"login": "dfornika", "name": "Dan Fornika"}}, "url": "https://github.com/phac-nml/irida/commit/f115ca25b8e94590bfcec142f2824763d05548f6", "committedDate": "2020-01-10T20:30:53Z", "message": "Updated CHANGELOG"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ3NTU2NzQy", "url": "https://github.com/phac-nml/irida/pull/564#pullrequestreview-347556742", "createdAt": "2020-01-23T19:37:27Z", "commit": {"oid": "f115ca25b8e94590bfcec142f2824763d05548f6"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yM1QxOTozNzoyN1rOFhKQ7w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yM1QxOTozOTo0OVrOFhKVZw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDMxNTUwMw==", "bodyText": "Can you add some comment blocks in here for what this is for?", "url": "https://github.com/phac-nml/irida/pull/564#discussion_r370315503", "createdAt": "2020-01-23T19:37:27Z", "author": {"login": "tom114"}, "path": "src/main/resources/ca/corefacility/bioinformatics/irida/export/ncbi.xml", "diffHunk": "@@ -18,9 +18,16 @@\n \n \t<Action th:each=\"sample : ${submission.bioSampleFiles}\">\n \t\t<AddFiles target_db=\"SRA\" th:each=\"file : ${sample.files}\">\n-\t\t\t<File th:attr=\"file_path=${file.getId() + '.fastq'}\">\n-\t\t\t\t<DataType>generic-data</DataType>\n-\t\t\t</File>\n+\t\t\t<div th:if=\"${file.getFiles().toString().endsWith(&quot;.gz&quot;)}\">\n+\t\t\t\t<File th:attr=\"file_path=${file.getId() + '.fastq.gz'}\">", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f115ca25b8e94590bfcec142f2824763d05548f6"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDMxNjI4Ng==", "bodyText": "Rather than a <div> please use a <th:block> instead.  The th:block won't show up in the resulting xml like the div will.\nhttps://www.thymeleaf.org/doc/tutorials/2.1/usingthymeleaf.html#synthetic-thblock-tag", "url": "https://github.com/phac-nml/irida/pull/564#discussion_r370316286", "createdAt": "2020-01-23T19:39:06Z", "author": {"login": "tom114"}, "path": "src/main/resources/ca/corefacility/bioinformatics/irida/export/ncbi.xml", "diffHunk": "@@ -18,9 +18,16 @@\n \n \t<Action th:each=\"sample : ${submission.bioSampleFiles}\">\n \t\t<AddFiles target_db=\"SRA\" th:each=\"file : ${sample.files}\">\n-\t\t\t<File th:attr=\"file_path=${file.getId() + '.fastq'}\">\n-\t\t\t\t<DataType>generic-data</DataType>\n-\t\t\t</File>\n+\t\t\t<div th:if=\"${file.getFiles().toString().endsWith(&quot;.gz&quot;)}\">", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f115ca25b8e94590bfcec142f2824763d05548f6"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDMxNjY0Nw==", "bodyText": "Thanks for adding the zipped test.", "url": "https://github.com/phac-nml/irida/pull/564#discussion_r370316647", "createdAt": "2020-01-23T19:39:49Z", "author": {"login": "tom114"}, "path": "src/test/java/ca/corefacility/bioinformatics/irida/service/export/ExportUploadServiceTest.java", "diffHunk": "@@ -84,9 +84,54 @@ public void testUploadSubmission() throws UploadException, IOException {\n \t\tassertTrue(\"seqfile created\", fileSystem.exists(createdDirectory + \"/\" + createdFile.getId() + \".fastq\"));\n \t}\n \n+\t@Test\n+\tpublic void testUploadSubmissionGzipped() throws UploadException, IOException {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f115ca25b8e94590bfcec142f2824763d05548f6"}, "originalPosition": 14}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f473f27a28c2f00c63809d8b61cb461b25b31e84", "author": {"user": {"login": "dfornika", "name": "Dan Fornika"}}, "url": "https://github.com/phac-nml/irida/commit/f473f27a28c2f00c63809d8b61cb461b25b31e84", "committedDate": "2020-01-24T18:04:09Z", "message": "Merge branch 'development' into ncbi-sra-upload-gzipped"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "24a660d96192b9bb2b15ae811fd676c65dc2f088", "author": {"user": {"login": "dfornika", "name": "Dan Fornika"}}, "url": "https://github.com/phac-nml/irida/commit/24a660d96192b9bb2b15ae811fd676c65dc2f088", "committedDate": "2020-01-24T18:06:58Z", "message": "Switch div to th:block"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d04fe39fcd3e4a38ac1896e595435c9449878340", "author": {"user": {"login": "dfornika", "name": "Dan Fornika"}}, "url": "https://github.com/phac-nml/irida/commit/d04fe39fcd3e4a38ac1896e595435c9449878340", "committedDate": "2020-01-24T18:08:28Z", "message": "Switch other divs to th:block"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "32e187faa64d421c6209197efda3a572aa27c6c4", "author": {"user": {"login": "dfornika", "name": "Dan Fornika"}}, "url": "https://github.com/phac-nml/irida/commit/32e187faa64d421c6209197efda3a572aa27c6c4", "committedDate": "2020-01-24T18:12:46Z", "message": "Add comment explaining handling of gzipped fastqs"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ4OTA2Njg3", "url": "https://github.com/phac-nml/irida/pull/564#pullrequestreview-348906687", "createdAt": "2020-01-27T19:11:41Z", "commit": {"oid": "32e187faa64d421c6209197efda3a572aa27c6c4"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yN1QxOToxMTo0MVrOFiOKwQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yN1QxOToxMTo0MVrOFiOKwQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTQyODAzMw==", "bodyText": "Just doing some final testing with this.  Can you make these \"parser level\" comments?  It will make them not appear in the final rendered xml.  It just means changing the comment block format a to <!--/*  your comment here */-->\nSee https://www.thymeleaf.org/doc/tutorials/2.1/usingthymeleaf.html#thymeleaf-parser-level-comment-blocks for more", "url": "https://github.com/phac-nml/irida/pull/564#discussion_r371428033", "createdAt": "2020-01-27T19:11:41Z", "author": {"login": "tom114"}, "path": "src/main/resources/ca/corefacility/bioinformatics/irida/export/ncbi.xml", "diffHunk": "@@ -17,10 +17,22 @@\n \t</Description>\n \n \t<Action th:each=\"sample : ${submission.bioSampleFiles}\">\n+\t\t<!-- IRIDA sequence files may either be plaintext (.fastq) or gzip compressed (.fastq.gz)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "32e187faa64d421c6209197efda3a572aa27c6c4"}, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "226501d64e960fe7e68fa321d304258c9cfe6178", "author": {"user": {"login": "dfornika", "name": "Dan Fornika"}}, "url": "https://github.com/phac-nml/irida/commit/226501d64e960fe7e68fa321d304258c9cfe6178", "committedDate": "2020-01-28T18:12:18Z", "message": "Change to parser-level comment"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUwMTk1OTc2", "url": "https://github.com/phac-nml/irida/pull/564#pullrequestreview-350195976", "createdAt": "2020-01-29T15:28:49Z", "commit": {"oid": "226501d64e960fe7e68fa321d304258c9cfe6178"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 289, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}