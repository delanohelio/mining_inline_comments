{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDk2MjE4NTg0", "number": 813, "reviewThreads": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNlQxNTo1MjowNVrOEqz19Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNlQxNjo0Njo0NFrOEq1Ogg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEzMzI1MDQ1OnYy", "diffSide": "RIGHT", "path": "src/main/java/ca/corefacility/bioinformatics/irida/ria/web/ajax/CartAjaxController.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNlQxNTo1MjowNVrOHdOn8A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNlQxNzowMjozM1rOHdRdxQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDQxMDM1Mg==", "bodyText": "Should be Get the samples", "url": "https://github.com/phac-nml/irida/pull/813#discussion_r500410352", "createdAt": "2020-10-06T15:52:05Z", "author": {"login": "deepsidhu85"}, "path": "src/main/java/ca/corefacility/bioinformatics/irida/ria/web/ajax/CartAjaxController.java", "diffHunk": "@@ -0,0 +1,99 @@\n+package ca.corefacility.bioinformatics.irida.ria.web.ajax;\n+\n+import java.util.List;\n+import java.util.Set;\n+\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.http.ResponseEntity;\n+import org.springframework.web.bind.annotation.*;\n+\n+import ca.corefacility.bioinformatics.irida.ria.web.ajax.dto.cart.CartProject;\n+import ca.corefacility.bioinformatics.irida.ria.web.cart.dto.AddToCartRequest;\n+import ca.corefacility.bioinformatics.irida.ria.web.cart.dto.RemoveSampleRequest;\n+import ca.corefacility.bioinformatics.irida.ria.web.services.UICartService;\n+\n+/**\n+ * AJAX controller for cart functionality\n+ */\n+@RestController\n+@RequestMapping(\"/ajax/cart\")\n+public class CartAjaxController {\n+\tprivate final UICartService service;\n+\n+\t@Autowired\n+\tpublic CartAjaxController(UICartService service) {\n+\t\tthis.service = service;\n+\t}\n+\n+\t/**\n+\t * Add a set of samples to the cart from a particular project\n+\t *\n+\t * @param request Request to add sample to the cart\n+\t * @return the number of samples currrently in the cart\n+\t */\n+\t@PostMapping(\"\")\n+\tpublic ResponseEntity<Integer> addSamplesToCart(@RequestBody AddToCartRequest request) {\n+\t\treturn ResponseEntity.ok(service.addSamplesToCart(request));\n+\t}\n+\n+\t/**\n+\t * Get the number of samples from all projects that are currently in the cart\n+\t *\n+\t * @return the number of samples currently in the cart\n+\t */\n+\t@GetMapping(\"/count\")\n+\tpublic ResponseEntity<Integer> getNumberOfSamplesInCart() {\n+\t\treturn ResponseEntity.ok(service.getNumberOfSamplesInCart());\n+\t}\n+\n+\t/**\n+\t * Remove a sample from the cart\n+\t *\n+\t * @param request Request to move a sample from the cart\n+\t * @return the number of samples currently in the cart\n+\t */\n+\t@DeleteMapping(\"/sample\")\n+\tpublic ResponseEntity<Integer> removeSample(@RequestBody RemoveSampleRequest request) {\n+\t\treturn ResponseEntity.ok(service.removeSample(request));\n+\t}\n+\n+\t/**\n+\t * Remove all samples from a specific project from the cart\n+\t *\n+\t * @param id for a project\n+\t * @return the number of samples currently in the cart\n+\t */\n+\t@DeleteMapping(\"/project\")\n+\tpublic ResponseEntity<Integer> removeProject(@RequestParam Long id) {\n+\t\treturn ResponseEntity.ok(service.removeProject(id));\n+\t}\n+\n+\t/**\n+\t * Completely empty the cart\n+\t */\n+\t@DeleteMapping(\"\")\n+\tpublic void emptyCart() {\n+\t\tservice.emptyCart();\n+\t}\n+\n+\t/**\n+\t * Get a list of project identifiers for projects that have samples in the cart.\n+\t *\n+\t * @return list of project identifiers\n+\t */\n+\t@GetMapping(\"/ids\")\n+\tpublic ResponseEntity<Set<Long>> getProjectIdsInCart() {\n+\t\treturn ResponseEntity.ok(service.getProjectIdsInCart());\n+\t}\n+\n+\t/**\n+\t * Cart the samples that are in the cart for a specific project", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f58611dcacf9ee48b8662e993144b6ecaa79ef88"}, "originalPosition": 90}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDQ1NjkwMQ==", "bodyText": "Fixed in 7ff3cc6", "url": "https://github.com/phac-nml/irida/pull/813#discussion_r500456901", "createdAt": "2020-10-06T17:02:33Z", "author": {"login": "joshsadam"}, "path": "src/main/java/ca/corefacility/bioinformatics/irida/ria/web/ajax/CartAjaxController.java", "diffHunk": "@@ -0,0 +1,99 @@\n+package ca.corefacility.bioinformatics.irida.ria.web.ajax;\n+\n+import java.util.List;\n+import java.util.Set;\n+\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.http.ResponseEntity;\n+import org.springframework.web.bind.annotation.*;\n+\n+import ca.corefacility.bioinformatics.irida.ria.web.ajax.dto.cart.CartProject;\n+import ca.corefacility.bioinformatics.irida.ria.web.cart.dto.AddToCartRequest;\n+import ca.corefacility.bioinformatics.irida.ria.web.cart.dto.RemoveSampleRequest;\n+import ca.corefacility.bioinformatics.irida.ria.web.services.UICartService;\n+\n+/**\n+ * AJAX controller for cart functionality\n+ */\n+@RestController\n+@RequestMapping(\"/ajax/cart\")\n+public class CartAjaxController {\n+\tprivate final UICartService service;\n+\n+\t@Autowired\n+\tpublic CartAjaxController(UICartService service) {\n+\t\tthis.service = service;\n+\t}\n+\n+\t/**\n+\t * Add a set of samples to the cart from a particular project\n+\t *\n+\t * @param request Request to add sample to the cart\n+\t * @return the number of samples currrently in the cart\n+\t */\n+\t@PostMapping(\"\")\n+\tpublic ResponseEntity<Integer> addSamplesToCart(@RequestBody AddToCartRequest request) {\n+\t\treturn ResponseEntity.ok(service.addSamplesToCart(request));\n+\t}\n+\n+\t/**\n+\t * Get the number of samples from all projects that are currently in the cart\n+\t *\n+\t * @return the number of samples currently in the cart\n+\t */\n+\t@GetMapping(\"/count\")\n+\tpublic ResponseEntity<Integer> getNumberOfSamplesInCart() {\n+\t\treturn ResponseEntity.ok(service.getNumberOfSamplesInCart());\n+\t}\n+\n+\t/**\n+\t * Remove a sample from the cart\n+\t *\n+\t * @param request Request to move a sample from the cart\n+\t * @return the number of samples currently in the cart\n+\t */\n+\t@DeleteMapping(\"/sample\")\n+\tpublic ResponseEntity<Integer> removeSample(@RequestBody RemoveSampleRequest request) {\n+\t\treturn ResponseEntity.ok(service.removeSample(request));\n+\t}\n+\n+\t/**\n+\t * Remove all samples from a specific project from the cart\n+\t *\n+\t * @param id for a project\n+\t * @return the number of samples currently in the cart\n+\t */\n+\t@DeleteMapping(\"/project\")\n+\tpublic ResponseEntity<Integer> removeProject(@RequestParam Long id) {\n+\t\treturn ResponseEntity.ok(service.removeProject(id));\n+\t}\n+\n+\t/**\n+\t * Completely empty the cart\n+\t */\n+\t@DeleteMapping(\"\")\n+\tpublic void emptyCart() {\n+\t\tservice.emptyCart();\n+\t}\n+\n+\t/**\n+\t * Get a list of project identifiers for projects that have samples in the cart.\n+\t *\n+\t * @return list of project identifiers\n+\t */\n+\t@GetMapping(\"/ids\")\n+\tpublic ResponseEntity<Set<Long>> getProjectIdsInCart() {\n+\t\treturn ResponseEntity.ok(service.getProjectIdsInCart());\n+\t}\n+\n+\t/**\n+\t * Cart the samples that are in the cart for a specific project", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDQxMDM1Mg=="}, "originalCommit": {"oid": "f58611dcacf9ee48b8662e993144b6ecaa79ef88"}, "originalPosition": 90}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEzMzI1MjQ4OnYy", "diffSide": "RIGHT", "path": "CHANGELOG.md", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNlQxNTo1MjozNlrOHdOpYg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNlQxNzowMzozNFrOHdRgTA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDQxMDcyMg==", "bodyText": "Should be provided a service", "url": "https://github.com/phac-nml/irida/pull/813#discussion_r500410722", "createdAt": "2020-10-06T15:52:36Z", "author": {"login": "deepsidhu85"}, "path": "CHANGELOG.md", "diffHunk": "@@ -6,6 +6,7 @@ Changes\n * [UI]: Fixed bug where sequencing runs could not be deleted on sequencing runs details page. (20.09.1)\n * [Developer] Fixed `SISTR viewer` so plugin and built-in pipelines can use it (20.09.1)\n * [UI] Added two additional fields to SISTR viewer describing the number of alleles found (20.09.1)\n+* [Developer]: Updated the session Cart and provided a services for accessing it.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f58611dcacf9ee48b8662e993144b6ecaa79ef88"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDQ1NzU0OA==", "bodyText": "Updated in 413e197", "url": "https://github.com/phac-nml/irida/pull/813#discussion_r500457548", "createdAt": "2020-10-06T17:03:34Z", "author": {"login": "joshsadam"}, "path": "CHANGELOG.md", "diffHunk": "@@ -6,6 +6,7 @@ Changes\n * [UI]: Fixed bug where sequencing runs could not be deleted on sequencing runs details page. (20.09.1)\n * [Developer] Fixed `SISTR viewer` so plugin and built-in pipelines can use it (20.09.1)\n * [UI] Added two additional fields to SISTR viewer describing the number of alleles found (20.09.1)\n+* [Developer]: Updated the session Cart and provided a services for accessing it.", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDQxMDcyMg=="}, "originalCommit": {"oid": "f58611dcacf9ee48b8662e993144b6ecaa79ef88"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEzMzQwMzI0OnYy", "diffSide": "RIGHT", "path": "src/main/java/ca/corefacility/bioinformatics/irida/ria/web/ajax/dto/cart/CartProject.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNlQxNjoyODoyMFrOHdQIRw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNlQxNzowNTo0OFrOHdRlYA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDQzNTAxNQ==", "bodyText": "As this is a model for the UI rename it to CartProjectModel", "url": "https://github.com/phac-nml/irida/pull/813#discussion_r500435015", "createdAt": "2020-10-06T16:28:20Z", "author": {"login": "deepsidhu85"}, "path": "src/main/java/ca/corefacility/bioinformatics/irida/ria/web/ajax/dto/cart/CartProject.java", "diffHunk": "@@ -0,0 +1,35 @@\n+package ca.corefacility.bioinformatics.irida.ria.web.ajax.dto.cart;\n+\n+import java.util.List;\n+\n+import ca.corefacility.bioinformatics.irida.ria.web.ajax.dto.CartSample;\n+\n+/**\n+ * Model for UI to represent a project and its sample within the cart.\n+ */\n+public class CartProject {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f58611dcacf9ee48b8662e993144b6ecaa79ef88"}, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDQ1ODg0OA==", "bodyText": "Updated in 3550032", "url": "https://github.com/phac-nml/irida/pull/813#discussion_r500458848", "createdAt": "2020-10-06T17:05:48Z", "author": {"login": "joshsadam"}, "path": "src/main/java/ca/corefacility/bioinformatics/irida/ria/web/ajax/dto/cart/CartProject.java", "diffHunk": "@@ -0,0 +1,35 @@\n+package ca.corefacility.bioinformatics.irida.ria.web.ajax.dto.cart;\n+\n+import java.util.List;\n+\n+import ca.corefacility.bioinformatics.irida.ria.web.ajax.dto.CartSample;\n+\n+/**\n+ * Model for UI to represent a project and its sample within the cart.\n+ */\n+public class CartProject {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDQzNTAxNQ=="}, "originalCommit": {"oid": "f58611dcacf9ee48b8662e993144b6ecaa79ef88"}, "originalPosition": 10}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEzMzQwODM1OnYy", "diffSide": "RIGHT", "path": "src/main/java/ca/corefacility/bioinformatics/irida/ria/web/cart/CartController.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNlQxNjoyOTo0MVrOHdQLow==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNlQxNzowNjo1M1rOHdRoFA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDQzNTg3NQ==", "bodyText": "Remove the final", "url": "https://github.com/phac-nml/irida/pull/813#discussion_r500435875", "createdAt": "2020-10-06T16:29:41Z", "author": {"login": "deepsidhu85"}, "path": "src/main/java/ca/corefacility/bioinformatics/irida/ria/web/cart/CartController.java", "diffHunk": "@@ -1,49 +1,32 @@\n package ca.corefacility.bioinformatics.irida.ria.web.cart;\n \n-import ca.corefacility.bioinformatics.irida.model.project.Project;\n-import ca.corefacility.bioinformatics.irida.model.sample.Sample;\n-import ca.corefacility.bioinformatics.irida.ria.web.cart.components.Cart;\n-import ca.corefacility.bioinformatics.irida.ria.web.cart.dto.*;\n-import ca.corefacility.bioinformatics.irida.ria.web.oauth.GalaxyRedirectionEndpointController;\n-import ca.corefacility.bioinformatics.irida.service.ProjectService;\n-import ca.corefacility.bioinformatics.irida.service.sample.SampleService;\n import org.springframework.beans.factory.annotation.Autowired;\n import org.springframework.beans.factory.annotation.Qualifier;\n import org.springframework.beans.factory.annotation.Value;\n-import org.springframework.context.annotation.Scope;\n import org.springframework.http.MediaType;\n import org.springframework.stereotype.Controller;\n import org.springframework.ui.Model;\n-import org.springframework.web.bind.annotation.*;\n+import org.springframework.web.bind.annotation.RequestMapping;\n+import org.springframework.web.bind.annotation.RequestParam;\n \n-import java.util.*;\n+import ca.corefacility.bioinformatics.irida.ria.web.oauth.GalaxyRedirectionEndpointController;\n \n /**\n  * Controller managing interactions with the selected sequences\n  */\n @Controller\n-@Scope(\"session\")\n @RequestMapping(\"/cart\")\n public class CartController {\n-\tprivate Cart cart;\n-\n-\tprivate final SampleService sampleService;\n-\tprivate final ProjectService projectService;\n-\n \t@Value(\"${server.base.url}\")\n \tprivate String serverBaseUrl;\n \t/*\n \t * Additional variables\n \t */\n-\tprivate String iridaPipelinePluginStyle;\n+\tprivate final String iridaPipelinePluginStyle;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f58611dcacf9ee48b8662e993144b6ecaa79ef88"}, "originalPosition": 42}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDQ1OTU0MA==", "bodyText": "Updated in 720b1f6", "url": "https://github.com/phac-nml/irida/pull/813#discussion_r500459540", "createdAt": "2020-10-06T17:06:53Z", "author": {"login": "joshsadam"}, "path": "src/main/java/ca/corefacility/bioinformatics/irida/ria/web/cart/CartController.java", "diffHunk": "@@ -1,49 +1,32 @@\n package ca.corefacility.bioinformatics.irida.ria.web.cart;\n \n-import ca.corefacility.bioinformatics.irida.model.project.Project;\n-import ca.corefacility.bioinformatics.irida.model.sample.Sample;\n-import ca.corefacility.bioinformatics.irida.ria.web.cart.components.Cart;\n-import ca.corefacility.bioinformatics.irida.ria.web.cart.dto.*;\n-import ca.corefacility.bioinformatics.irida.ria.web.oauth.GalaxyRedirectionEndpointController;\n-import ca.corefacility.bioinformatics.irida.service.ProjectService;\n-import ca.corefacility.bioinformatics.irida.service.sample.SampleService;\n import org.springframework.beans.factory.annotation.Autowired;\n import org.springframework.beans.factory.annotation.Qualifier;\n import org.springframework.beans.factory.annotation.Value;\n-import org.springframework.context.annotation.Scope;\n import org.springframework.http.MediaType;\n import org.springframework.stereotype.Controller;\n import org.springframework.ui.Model;\n-import org.springframework.web.bind.annotation.*;\n+import org.springframework.web.bind.annotation.RequestMapping;\n+import org.springframework.web.bind.annotation.RequestParam;\n \n-import java.util.*;\n+import ca.corefacility.bioinformatics.irida.ria.web.oauth.GalaxyRedirectionEndpointController;\n \n /**\n  * Controller managing interactions with the selected sequences\n  */\n @Controller\n-@Scope(\"session\")\n @RequestMapping(\"/cart\")\n public class CartController {\n-\tprivate Cart cart;\n-\n-\tprivate final SampleService sampleService;\n-\tprivate final ProjectService projectService;\n-\n \t@Value(\"${server.base.url}\")\n \tprivate String serverBaseUrl;\n \t/*\n \t * Additional variables\n \t */\n-\tprivate String iridaPipelinePluginStyle;\n+\tprivate final String iridaPipelinePluginStyle;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDQzNTg3NQ=="}, "originalCommit": {"oid": "f58611dcacf9ee48b8662e993144b6ecaa79ef88"}, "originalPosition": 42}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEzMzQxOTEyOnYy", "diffSide": "RIGHT", "path": "src/main/java/ca/corefacility/bioinformatics/irida/ria/web/cart/CartGalaxyController.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNlQxNjozMjoxNFrOHdQSVw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNlQxNzowNzozN1rOHdRptA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDQzNzU5MQ==", "bodyText": "Remove the final from the variables", "url": "https://github.com/phac-nml/irida/pull/813#discussion_r500437591", "createdAt": "2020-10-06T16:32:14Z", "author": {"login": "deepsidhu85"}, "path": "src/main/java/ca/corefacility/bioinformatics/irida/ria/web/cart/CartGalaxyController.java", "diffHunk": "@@ -12,27 +13,26 @@\n import org.springframework.web.bind.annotation.RequestMapping;\n import org.springframework.web.bind.annotation.RestController;\n \n+import ca.corefacility.bioinformatics.irida.model.project.Project;\n import ca.corefacility.bioinformatics.irida.model.sample.Sample;\n import ca.corefacility.bioinformatics.irida.ria.config.GalaxySessionInterceptor;\n-import ca.corefacility.bioinformatics.irida.ria.web.cart.components.Cart;\n-import ca.corefacility.bioinformatics.irida.ria.web.cart.dto.CartSample;\n import ca.corefacility.bioinformatics.irida.ria.web.cart.dto.GalaxyExportSample;\n+import ca.corefacility.bioinformatics.irida.ria.web.services.UICartService;\n import ca.corefacility.bioinformatics.irida.service.sample.SampleService;\n \n /**\n  * Controller to handle all ajax requests made to the cart that have to do with Galaxy.\n  */\n @RestController\n-@Scope(\"session\")\n @RequestMapping(\"/ajax/galaxy-export\")\n public class CartGalaxyController {\n-\tprivate SampleService sampleService;\n-\tprivate Cart cart;\n+\tprivate final SampleService sampleService;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f58611dcacf9ee48b8662e993144b6ecaa79ef88"}, "originalPosition": 33}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDQ1OTk1Ng==", "bodyText": "Updated in 0019e23", "url": "https://github.com/phac-nml/irida/pull/813#discussion_r500459956", "createdAt": "2020-10-06T17:07:37Z", "author": {"login": "joshsadam"}, "path": "src/main/java/ca/corefacility/bioinformatics/irida/ria/web/cart/CartGalaxyController.java", "diffHunk": "@@ -12,27 +13,26 @@\n import org.springframework.web.bind.annotation.RequestMapping;\n import org.springframework.web.bind.annotation.RestController;\n \n+import ca.corefacility.bioinformatics.irida.model.project.Project;\n import ca.corefacility.bioinformatics.irida.model.sample.Sample;\n import ca.corefacility.bioinformatics.irida.ria.config.GalaxySessionInterceptor;\n-import ca.corefacility.bioinformatics.irida.ria.web.cart.components.Cart;\n-import ca.corefacility.bioinformatics.irida.ria.web.cart.dto.CartSample;\n import ca.corefacility.bioinformatics.irida.ria.web.cart.dto.GalaxyExportSample;\n+import ca.corefacility.bioinformatics.irida.ria.web.services.UICartService;\n import ca.corefacility.bioinformatics.irida.service.sample.SampleService;\n \n /**\n  * Controller to handle all ajax requests made to the cart that have to do with Galaxy.\n  */\n @RestController\n-@Scope(\"session\")\n @RequestMapping(\"/ajax/galaxy-export\")\n public class CartGalaxyController {\n-\tprivate SampleService sampleService;\n-\tprivate Cart cart;\n+\tprivate final SampleService sampleService;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDQzNzU5MQ=="}, "originalCommit": {"oid": "f58611dcacf9ee48b8662e993144b6ecaa79ef88"}, "originalPosition": 33}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEzMzQyMjU2OnYy", "diffSide": "RIGHT", "path": "src/main/java/ca/corefacility/bioinformatics/irida/ria/web/cart/CartGalaxyController.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNlQxNjozMzowM1rOHdQUig==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNlQxNjozMzowM1rOHdQUig==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDQzODE1NA==", "bodyText": "Might need to apply the irida intellij styling to this method", "url": "https://github.com/phac-nml/irida/pull/813#discussion_r500438154", "createdAt": "2020-10-06T16:33:03Z", "author": {"login": "deepsidhu85"}, "path": "src/main/java/ca/corefacility/bioinformatics/irida/ria/web/cart/CartGalaxyController.java", "diffHunk": "@@ -41,14 +41,9 @@ public CartGalaxyController(SampleService sampleService, Cart cart) {\n \t */\n \t@RequestMapping(\"/samples\")\n \tpublic List<GalaxyExportSample> getGalaxyExportForm() {\n-\t\tMap<Long, Map<Long, CartSample>> contents = cart.get();\n-\t\tList<GalaxyExportSample> result = new ArrayList<>();\n-\t\tfor (Long projectId : contents.keySet()) {\n-\t\t\tIterable<Sample> samples = sampleService.readMultiple(contents.get(projectId)\n-\t\t\t\t\t.keySet());\n-\t\t\tsamples.forEach(s -> result.add(new GalaxyExportSample(s, projectId)));\n-\t\t}\n-\t\treturn result;\n+\t\tMap<Project, List<Sample>> contents = cartService.getFullCart();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f58611dcacf9ee48b8662e993144b6ecaa79ef88"}, "originalPosition": 57}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEzMzQzNTgzOnYy", "diffSide": "RIGHT", "path": "src/main/java/ca/corefacility/bioinformatics/irida/ria/web/pipelines/PipelineController.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNlQxNjozNjoyMFrOHdQc5Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNlQxNjozNjoyMFrOHdQc5Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDQ0MDI5Mw==", "bodyText": "Remove the final from the variables", "url": "https://github.com/phac-nml/irida/pull/813#discussion_r500440293", "createdAt": "2020-10-06T16:36:20Z", "author": {"login": "deepsidhu85"}, "path": "src/main/java/ca/corefacility/bioinformatics/irida/ria/web/pipelines/PipelineController.java", "diffHunk": "@@ -83,45 +83,41 @@\n \t/*\n \t * SERVICES\n \t */\n-\tprivate ReferenceFileService referenceFileService;\n-\tprivate SequencingObjectService sequencingObjectService;\n-\tprivate AnalysisSubmissionService analysisSubmissionService;\n-\tprivate ProjectService projectService;\n-\tprivate UserService userService;\n-\tprivate IridaWorkflowsService workflowsService;\n-\tprivate MessageSource messageSource;\n+\tprivate final ReferenceFileService referenceFileService;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f58611dcacf9ee48b8662e993144b6ecaa79ef88"}, "originalPosition": 80}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEzMzQzNzkxOnYy", "diffSide": "RIGHT", "path": "src/main/java/ca/corefacility/bioinformatics/irida/ria/web/pipelines/PipelineController.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNlQxNjozNjo1M1rOHdQeOw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNlQxNzoxMDoyM1rOHdRwaw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDQ0MDYzNQ==", "bodyText": "Remove final", "url": "https://github.com/phac-nml/irida/pull/813#discussion_r500440635", "createdAt": "2020-10-06T16:36:53Z", "author": {"login": "deepsidhu85"}, "path": "src/main/java/ca/corefacility/bioinformatics/irida/ria/web/pipelines/PipelineController.java", "diffHunk": "@@ -83,45 +83,41 @@\n \t/*\n \t * SERVICES\n \t */\n-\tprivate ReferenceFileService referenceFileService;\n-\tprivate SequencingObjectService sequencingObjectService;\n-\tprivate AnalysisSubmissionService analysisSubmissionService;\n-\tprivate ProjectService projectService;\n-\tprivate UserService userService;\n-\tprivate IridaWorkflowsService workflowsService;\n-\tprivate MessageSource messageSource;\n+\tprivate final ReferenceFileService referenceFileService;\n+\tprivate final SequencingObjectService sequencingObjectService;\n+\tprivate final AnalysisSubmissionService analysisSubmissionService;\n+\tprivate final ProjectService projectService;\n+\tprivate final UserService userService;\n+\tprivate final IridaWorkflowsService workflowsService;\n+\tprivate final MessageSource messageSource;\n \tprivate final WorkflowNamedParametersService namedParameterService;\n-\tprivate UpdateSamplePermission updateSamplePermission;\n-\tprivate AnalysisSubmissionSampleProcessor analysisSubmissionSampleProcessor;\n-\tprivate GalaxyToolDataService galaxyToolDataService;\n-\tprivate EmailController emailController;\n-\n-\t/*\n-\t * CONTROLLERS\n-\t */\n-\tprivate CartController cartController;\n+\tprivate final UpdateSamplePermission updateSamplePermission;\n+\tprivate final AnalysisSubmissionSampleProcessor analysisSubmissionSampleProcessor;\n+\tprivate final GalaxyToolDataService galaxyToolDataService;\n+\tprivate final EmailController emailController;\n+\tprivate final UICartService cartService;\n \n \t@Autowired\n \tpublic PipelineController(SequencingObjectService sequencingObjectService,\n \t\t\tReferenceFileService referenceFileService, AnalysisSubmissionService analysisSubmissionService,\n \t\t\tIridaWorkflowsService iridaWorkflowsService, ProjectService projectService, UserService userService,\n-\t\t\tCartController cartController, MessageSource messageSource,\n+\t\t\tMessageSource messageSource,\n \t\t\tfinal WorkflowNamedParametersService namedParameterService, UpdateSamplePermission updateSamplePermission,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f58611dcacf9ee48b8662e993144b6ecaa79ef88"}, "originalPosition": 109}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDQ2MTY3NQ==", "bodyText": "This is an old relic, I cannot remember you used to like that. \u00a0Removed in 746b003", "url": "https://github.com/phac-nml/irida/pull/813#discussion_r500461675", "createdAt": "2020-10-06T17:10:23Z", "author": {"login": "joshsadam"}, "path": "src/main/java/ca/corefacility/bioinformatics/irida/ria/web/pipelines/PipelineController.java", "diffHunk": "@@ -83,45 +83,41 @@\n \t/*\n \t * SERVICES\n \t */\n-\tprivate ReferenceFileService referenceFileService;\n-\tprivate SequencingObjectService sequencingObjectService;\n-\tprivate AnalysisSubmissionService analysisSubmissionService;\n-\tprivate ProjectService projectService;\n-\tprivate UserService userService;\n-\tprivate IridaWorkflowsService workflowsService;\n-\tprivate MessageSource messageSource;\n+\tprivate final ReferenceFileService referenceFileService;\n+\tprivate final SequencingObjectService sequencingObjectService;\n+\tprivate final AnalysisSubmissionService analysisSubmissionService;\n+\tprivate final ProjectService projectService;\n+\tprivate final UserService userService;\n+\tprivate final IridaWorkflowsService workflowsService;\n+\tprivate final MessageSource messageSource;\n \tprivate final WorkflowNamedParametersService namedParameterService;\n-\tprivate UpdateSamplePermission updateSamplePermission;\n-\tprivate AnalysisSubmissionSampleProcessor analysisSubmissionSampleProcessor;\n-\tprivate GalaxyToolDataService galaxyToolDataService;\n-\tprivate EmailController emailController;\n-\n-\t/*\n-\t * CONTROLLERS\n-\t */\n-\tprivate CartController cartController;\n+\tprivate final UpdateSamplePermission updateSamplePermission;\n+\tprivate final AnalysisSubmissionSampleProcessor analysisSubmissionSampleProcessor;\n+\tprivate final GalaxyToolDataService galaxyToolDataService;\n+\tprivate final EmailController emailController;\n+\tprivate final UICartService cartService;\n \n \t@Autowired\n \tpublic PipelineController(SequencingObjectService sequencingObjectService,\n \t\t\tReferenceFileService referenceFileService, AnalysisSubmissionService analysisSubmissionService,\n \t\t\tIridaWorkflowsService iridaWorkflowsService, ProjectService projectService, UserService userService,\n-\t\t\tCartController cartController, MessageSource messageSource,\n+\t\t\tMessageSource messageSource,\n \t\t\tfinal WorkflowNamedParametersService namedParameterService, UpdateSamplePermission updateSamplePermission,", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDQ0MDYzNQ=="}, "originalCommit": {"oid": "f58611dcacf9ee48b8662e993144b6ecaa79ef88"}, "originalPosition": 109}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEzMzQ1NjE4OnYy", "diffSide": "RIGHT", "path": "src/main/java/ca/corefacility/bioinformatics/irida/ria/web/services/UICartService.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNlQxNjo0MToyNlrOHdQpuQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNlQxODoxNTo1OVrOHdUNPw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDQ0MzU3Nw==", "bodyText": "What do you think about changing wherever you have Map<Project, List<Sample>> here and any of the above files to a dto which contains those objects?", "url": "https://github.com/phac-nml/irida/pull/813#discussion_r500443577", "createdAt": "2020-10-06T16:41:26Z", "author": {"login": "deepsidhu85"}, "path": "src/main/java/ca/corefacility/bioinformatics/irida/ria/web/services/UICartService.java", "diffHunk": "@@ -0,0 +1,126 @@\n+package ca.corefacility.bioinformatics.irida.ria.web.services;\n+\n+import java.util.*;\n+\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.stereotype.Component;\n+\n+import ca.corefacility.bioinformatics.irida.model.project.Project;\n+import ca.corefacility.bioinformatics.irida.model.sample.Sample;\n+import ca.corefacility.bioinformatics.irida.ria.web.ajax.dto.CartSample;\n+import ca.corefacility.bioinformatics.irida.ria.web.ajax.dto.cart.CartProject;\n+import ca.corefacility.bioinformatics.irida.ria.web.cart.dto.AddToCartRequest;\n+import ca.corefacility.bioinformatics.irida.ria.web.cart.dto.RemoveSampleRequest;\n+import ca.corefacility.bioinformatics.irida.ria.web.sessionAttrs.Cart;\n+import ca.corefacility.bioinformatics.irida.service.ProjectService;\n+import ca.corefacility.bioinformatics.irida.service.sample.SampleService;\n+\n+/**\n+ * Service for handling all aspects interaction with the Cart.\n+ */\n+@Component\n+public class UICartService {\n+\tprivate final Cart cart;\n+\tprivate final ProjectService projectService;\n+\tprivate final SampleService sampleService;\n+\n+\t@Autowired\n+\tpublic UICartService(Cart cart, ProjectService projectService, SampleService sampleService) {\n+\t\tthis.cart = cart;\n+\t\tthis.projectService = projectService;\n+\t\tthis.sampleService = sampleService;\n+\t}\n+\n+\t/**\n+\t * Add samples from a project to the cart.\n+\t *\n+\t * @param request Information about the project and samples to add to the cart\n+\t * @return number of total samples in the cart\n+\t */\n+\tpublic int addSamplesToCart(AddToCartRequest request) {\n+\t\treturn cart.add(request.getProjectId(), (List<Long>) request.getSampleIds());\n+\t}\n+\n+\t/**\n+\t * Get the number of samples in the cart\n+\t *\n+\t * @return number of total samples in the cart\n+\t */\n+\tpublic int getNumberOfSamplesInCart() {\n+\t\treturn cart.getNumberOfSamplesInCart();\n+\t}\n+\n+\t/**\n+\t * Remove all samples from the cart\n+\t */\n+\tpublic void emptyCart() {\n+\t\tcart.clear();\n+\t}\n+\n+\t/**\n+\t * Remove a specific sample from the cart.\n+\t *\n+\t * @param request Information about the samplet o remove from the cart\n+\t * @return number of total samples in the cart\n+\t */\n+\tpublic int removeSample(RemoveSampleRequest request) {\n+\t\treturn cart.removeSample(request.getProjectId(), request.getSampleId());\n+\t}\n+\n+\t/**\n+\t * Remove all samples from a specific project from the cart.\n+\t *\n+\t * @param id identifier for the project to remove from the cart.\n+\t * @return number of total samples in the cart\n+\t */\n+\tpublic int removeProject(Long id) {\n+\t\treturn cart.removeProject(id);\n+\t}\n+\n+\t/**\n+\t * Get a set of  identifiers for {@link Project}s in the cart\n+\t *\n+\t * @return {@link Set} of {@link Project} identifiers\n+\t */\n+\tpublic Set<Long> getProjectIdsInCart() {\n+\t\treturn cart.getProjectIdsInCart();\n+\t}\n+\n+\t/**\n+\t * Get a list of sample in the cart belonging to a list of projects\n+\t *\n+\t * @param ids List of identifiers for project to get the samples for.\n+\t * @return {@link List} of {@link CartProject}s containing project and sample information for items in the cart.\n+\t */\n+\tpublic List<CartProject> getSamplesForProjects(List<Long> ids) {\n+\t\tList<Project> projects = (List<Project>) projectService.readMultiple(ids);\n+\t\tList<CartProject> cartProjects = new ArrayList<>();\n+\t\tfor (Project project : projects) {\n+\t\t\tCartProject cartProject = new CartProject(project.getId(), project.getLabel());\n+\t\t\tList<CartSample> samples = new ArrayList<>();\n+\t\t\tsampleService.readMultiple(cart.getCartSampleIdsForProject(project.getId()))\n+\t\t\t\t\t.forEach(sample -> {\n+\t\t\t\t\t\tsamples.add(new CartSample(sample));\n+\t\t\t\t\t});\n+\t\t\tcartProject.setSamples(samples);\n+\t\t\tcartProjects.add(cartProject);\n+\t\t}\n+\t\treturn cartProjects;\n+\t}\n+\n+\t/**\n+\t * Get the entire cart flushed out into {@link Project}s with their {@link Sample}s\n+\t *\n+\t * @return All proejcts and samples in the part\n+\t */\n+\tpublic Map<Project, List<Sample>> getFullCart() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f58611dcacf9ee48b8662e993144b6ecaa79ef88"}, "originalPosition": 116}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDQ2MDk4NQ==", "bodyText": "I left these calls pretty much as they were previous so to not have to refactor too much of the UI calls that are older. \u00a0As those get updated we can move these to DTOs. \u00a0I think this in particular is a galaxy call.", "url": "https://github.com/phac-nml/irida/pull/813#discussion_r500460985", "createdAt": "2020-10-06T17:09:18Z", "author": {"login": "joshsadam"}, "path": "src/main/java/ca/corefacility/bioinformatics/irida/ria/web/services/UICartService.java", "diffHunk": "@@ -0,0 +1,126 @@\n+package ca.corefacility.bioinformatics.irida.ria.web.services;\n+\n+import java.util.*;\n+\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.stereotype.Component;\n+\n+import ca.corefacility.bioinformatics.irida.model.project.Project;\n+import ca.corefacility.bioinformatics.irida.model.sample.Sample;\n+import ca.corefacility.bioinformatics.irida.ria.web.ajax.dto.CartSample;\n+import ca.corefacility.bioinformatics.irida.ria.web.ajax.dto.cart.CartProject;\n+import ca.corefacility.bioinformatics.irida.ria.web.cart.dto.AddToCartRequest;\n+import ca.corefacility.bioinformatics.irida.ria.web.cart.dto.RemoveSampleRequest;\n+import ca.corefacility.bioinformatics.irida.ria.web.sessionAttrs.Cart;\n+import ca.corefacility.bioinformatics.irida.service.ProjectService;\n+import ca.corefacility.bioinformatics.irida.service.sample.SampleService;\n+\n+/**\n+ * Service for handling all aspects interaction with the Cart.\n+ */\n+@Component\n+public class UICartService {\n+\tprivate final Cart cart;\n+\tprivate final ProjectService projectService;\n+\tprivate final SampleService sampleService;\n+\n+\t@Autowired\n+\tpublic UICartService(Cart cart, ProjectService projectService, SampleService sampleService) {\n+\t\tthis.cart = cart;\n+\t\tthis.projectService = projectService;\n+\t\tthis.sampleService = sampleService;\n+\t}\n+\n+\t/**\n+\t * Add samples from a project to the cart.\n+\t *\n+\t * @param request Information about the project and samples to add to the cart\n+\t * @return number of total samples in the cart\n+\t */\n+\tpublic int addSamplesToCart(AddToCartRequest request) {\n+\t\treturn cart.add(request.getProjectId(), (List<Long>) request.getSampleIds());\n+\t}\n+\n+\t/**\n+\t * Get the number of samples in the cart\n+\t *\n+\t * @return number of total samples in the cart\n+\t */\n+\tpublic int getNumberOfSamplesInCart() {\n+\t\treturn cart.getNumberOfSamplesInCart();\n+\t}\n+\n+\t/**\n+\t * Remove all samples from the cart\n+\t */\n+\tpublic void emptyCart() {\n+\t\tcart.clear();\n+\t}\n+\n+\t/**\n+\t * Remove a specific sample from the cart.\n+\t *\n+\t * @param request Information about the samplet o remove from the cart\n+\t * @return number of total samples in the cart\n+\t */\n+\tpublic int removeSample(RemoveSampleRequest request) {\n+\t\treturn cart.removeSample(request.getProjectId(), request.getSampleId());\n+\t}\n+\n+\t/**\n+\t * Remove all samples from a specific project from the cart.\n+\t *\n+\t * @param id identifier for the project to remove from the cart.\n+\t * @return number of total samples in the cart\n+\t */\n+\tpublic int removeProject(Long id) {\n+\t\treturn cart.removeProject(id);\n+\t}\n+\n+\t/**\n+\t * Get a set of  identifiers for {@link Project}s in the cart\n+\t *\n+\t * @return {@link Set} of {@link Project} identifiers\n+\t */\n+\tpublic Set<Long> getProjectIdsInCart() {\n+\t\treturn cart.getProjectIdsInCart();\n+\t}\n+\n+\t/**\n+\t * Get a list of sample in the cart belonging to a list of projects\n+\t *\n+\t * @param ids List of identifiers for project to get the samples for.\n+\t * @return {@link List} of {@link CartProject}s containing project and sample information for items in the cart.\n+\t */\n+\tpublic List<CartProject> getSamplesForProjects(List<Long> ids) {\n+\t\tList<Project> projects = (List<Project>) projectService.readMultiple(ids);\n+\t\tList<CartProject> cartProjects = new ArrayList<>();\n+\t\tfor (Project project : projects) {\n+\t\t\tCartProject cartProject = new CartProject(project.getId(), project.getLabel());\n+\t\t\tList<CartSample> samples = new ArrayList<>();\n+\t\t\tsampleService.readMultiple(cart.getCartSampleIdsForProject(project.getId()))\n+\t\t\t\t\t.forEach(sample -> {\n+\t\t\t\t\t\tsamples.add(new CartSample(sample));\n+\t\t\t\t\t});\n+\t\t\tcartProject.setSamples(samples);\n+\t\t\tcartProjects.add(cartProject);\n+\t\t}\n+\t\treturn cartProjects;\n+\t}\n+\n+\t/**\n+\t * Get the entire cart flushed out into {@link Project}s with their {@link Sample}s\n+\t *\n+\t * @return All proejcts and samples in the part\n+\t */\n+\tpublic Map<Project, List<Sample>> getFullCart() {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDQ0MzU3Nw=="}, "originalCommit": {"oid": "f58611dcacf9ee48b8662e993144b6ecaa79ef88"}, "originalPosition": 116}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDUwMTgyMw==", "bodyText": "Sounds good!", "url": "https://github.com/phac-nml/irida/pull/813#discussion_r500501823", "createdAt": "2020-10-06T18:15:59Z", "author": {"login": "deepsidhu85"}, "path": "src/main/java/ca/corefacility/bioinformatics/irida/ria/web/services/UICartService.java", "diffHunk": "@@ -0,0 +1,126 @@\n+package ca.corefacility.bioinformatics.irida.ria.web.services;\n+\n+import java.util.*;\n+\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.stereotype.Component;\n+\n+import ca.corefacility.bioinformatics.irida.model.project.Project;\n+import ca.corefacility.bioinformatics.irida.model.sample.Sample;\n+import ca.corefacility.bioinformatics.irida.ria.web.ajax.dto.CartSample;\n+import ca.corefacility.bioinformatics.irida.ria.web.ajax.dto.cart.CartProject;\n+import ca.corefacility.bioinformatics.irida.ria.web.cart.dto.AddToCartRequest;\n+import ca.corefacility.bioinformatics.irida.ria.web.cart.dto.RemoveSampleRequest;\n+import ca.corefacility.bioinformatics.irida.ria.web.sessionAttrs.Cart;\n+import ca.corefacility.bioinformatics.irida.service.ProjectService;\n+import ca.corefacility.bioinformatics.irida.service.sample.SampleService;\n+\n+/**\n+ * Service for handling all aspects interaction with the Cart.\n+ */\n+@Component\n+public class UICartService {\n+\tprivate final Cart cart;\n+\tprivate final ProjectService projectService;\n+\tprivate final SampleService sampleService;\n+\n+\t@Autowired\n+\tpublic UICartService(Cart cart, ProjectService projectService, SampleService sampleService) {\n+\t\tthis.cart = cart;\n+\t\tthis.projectService = projectService;\n+\t\tthis.sampleService = sampleService;\n+\t}\n+\n+\t/**\n+\t * Add samples from a project to the cart.\n+\t *\n+\t * @param request Information about the project and samples to add to the cart\n+\t * @return number of total samples in the cart\n+\t */\n+\tpublic int addSamplesToCart(AddToCartRequest request) {\n+\t\treturn cart.add(request.getProjectId(), (List<Long>) request.getSampleIds());\n+\t}\n+\n+\t/**\n+\t * Get the number of samples in the cart\n+\t *\n+\t * @return number of total samples in the cart\n+\t */\n+\tpublic int getNumberOfSamplesInCart() {\n+\t\treturn cart.getNumberOfSamplesInCart();\n+\t}\n+\n+\t/**\n+\t * Remove all samples from the cart\n+\t */\n+\tpublic void emptyCart() {\n+\t\tcart.clear();\n+\t}\n+\n+\t/**\n+\t * Remove a specific sample from the cart.\n+\t *\n+\t * @param request Information about the samplet o remove from the cart\n+\t * @return number of total samples in the cart\n+\t */\n+\tpublic int removeSample(RemoveSampleRequest request) {\n+\t\treturn cart.removeSample(request.getProjectId(), request.getSampleId());\n+\t}\n+\n+\t/**\n+\t * Remove all samples from a specific project from the cart.\n+\t *\n+\t * @param id identifier for the project to remove from the cart.\n+\t * @return number of total samples in the cart\n+\t */\n+\tpublic int removeProject(Long id) {\n+\t\treturn cart.removeProject(id);\n+\t}\n+\n+\t/**\n+\t * Get a set of  identifiers for {@link Project}s in the cart\n+\t *\n+\t * @return {@link Set} of {@link Project} identifiers\n+\t */\n+\tpublic Set<Long> getProjectIdsInCart() {\n+\t\treturn cart.getProjectIdsInCart();\n+\t}\n+\n+\t/**\n+\t * Get a list of sample in the cart belonging to a list of projects\n+\t *\n+\t * @param ids List of identifiers for project to get the samples for.\n+\t * @return {@link List} of {@link CartProject}s containing project and sample information for items in the cart.\n+\t */\n+\tpublic List<CartProject> getSamplesForProjects(List<Long> ids) {\n+\t\tList<Project> projects = (List<Project>) projectService.readMultiple(ids);\n+\t\tList<CartProject> cartProjects = new ArrayList<>();\n+\t\tfor (Project project : projects) {\n+\t\t\tCartProject cartProject = new CartProject(project.getId(), project.getLabel());\n+\t\t\tList<CartSample> samples = new ArrayList<>();\n+\t\t\tsampleService.readMultiple(cart.getCartSampleIdsForProject(project.getId()))\n+\t\t\t\t\t.forEach(sample -> {\n+\t\t\t\t\t\tsamples.add(new CartSample(sample));\n+\t\t\t\t\t});\n+\t\t\tcartProject.setSamples(samples);\n+\t\t\tcartProjects.add(cartProject);\n+\t\t}\n+\t\treturn cartProjects;\n+\t}\n+\n+\t/**\n+\t * Get the entire cart flushed out into {@link Project}s with their {@link Sample}s\n+\t *\n+\t * @return All proejcts and samples in the part\n+\t */\n+\tpublic Map<Project, List<Sample>> getFullCart() {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDQ0MzU3Nw=="}, "originalCommit": {"oid": "f58611dcacf9ee48b8662e993144b6ecaa79ef88"}, "originalPosition": 116}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEzMzQ2NDA5OnYy", "diffSide": "RIGHT", "path": "src/main/java/ca/corefacility/bioinformatics/irida/ria/web/sessionAttrs/Cart.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNlQxNjo0MzoyNFrOHdQuqA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNlQxNzoxMjowNVrOHdR0iA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDQ0NDg0MA==", "bodyText": "Method comment", "url": "https://github.com/phac-nml/irida/pull/813#discussion_r500444840", "createdAt": "2020-10-06T16:43:24Z", "author": {"login": "deepsidhu85"}, "path": "src/main/java/ca/corefacility/bioinformatics/irida/ria/web/sessionAttrs/Cart.java", "diffHunk": "@@ -0,0 +1,73 @@\n+package ca.corefacility.bioinformatics.irida.ria.web.sessionAttrs;\n+\n+import java.util.HashMap;\n+import java.util.HashSet;\n+import java.util.List;\n+import java.util.Set;\n+\n+/**\n+ * Session object to hold samples that are currently in the cart.\n+ */\n+public class Cart extends HashMap<Long, HashSet<Long>> {\n+\n+\tpublic int add(Long projectId, List<Long> sampleIds) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f58611dcacf9ee48b8662e993144b6ecaa79ef88"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDQ2MjcyOA==", "bodyText": "Added in ff327b3", "url": "https://github.com/phac-nml/irida/pull/813#discussion_r500462728", "createdAt": "2020-10-06T17:12:05Z", "author": {"login": "joshsadam"}, "path": "src/main/java/ca/corefacility/bioinformatics/irida/ria/web/sessionAttrs/Cart.java", "diffHunk": "@@ -0,0 +1,73 @@\n+package ca.corefacility.bioinformatics.irida.ria.web.sessionAttrs;\n+\n+import java.util.HashMap;\n+import java.util.HashSet;\n+import java.util.List;\n+import java.util.Set;\n+\n+/**\n+ * Session object to hold samples that are currently in the cart.\n+ */\n+public class Cart extends HashMap<Long, HashSet<Long>> {\n+\n+\tpublic int add(Long projectId, List<Long> sampleIds) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDQ0NDg0MA=="}, "originalCommit": {"oid": "f58611dcacf9ee48b8662e993144b6ecaa79ef88"}, "originalPosition": 13}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEzMzQ3MzU3OnYy", "diffSide": "RIGHT", "path": "src/main/webapp/resources/js/apis/cart/cart.js", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNlQxNjo0NTo0MFrOHdQ0cg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNlQxNzoxNDowMVrOHdR5DA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDQ0NjMyMg==", "bodyText": "Add comments to functions", "url": "https://github.com/phac-nml/irida/pull/813#discussion_r500446322", "createdAt": "2020-10-06T16:45:40Z", "author": {"login": "deepsidhu85"}, "path": "src/main/webapp/resources/js/apis/cart/cart.js", "diffHunk": "@@ -1,47 +1,49 @@\n import axios from \"axios\";\n import { setBaseUrl } from \"../../utilities/url-utilities\";\n \n-const url = setBaseUrl(`cart`);\n+const AJAX_URL = setBaseUrl(`/ajax/cart`);\n \n /**\n  * Add samples for a project to the cart.\n  * @param {number} projectId Identifier for the project the samples are from.\n  * @param {array} samples array of sample {ids } to add to cart.\n- * @returns {AxiosPromise<any>}\n+ * @returns {Promise<{count: any}>}\n  */\n export const putSampleInCart = async (projectId, samples) =>\n-  axios.put(url, {\n-    projectId,\n-    samples\n-  });\n+  axios\n+    .post(AJAX_URL, {\n+      projectId,\n+      sampleIds: samples.map((s) => s.id),\n+    })\n+    .then(({ data }) => data);\n \n /**\n  * Get the current number of samples in the cart\n- * @returns {Promise<void>}\n+ * @returns {Promise<{count: any}>}\n  */\n export const getCartCount = async () => {\n-  return axios.get(`${url}/count`).then(response => ({ count: response.data }));\n+  return axios.get(`${AJAX_URL}/count`).then(({ data }) => ({ count: data }));\n };\n \n /**\n  * Get the current state of the cart.\n  * @returns {Promise<void | never>}\n  */\n export const getCart = async () =>\n-  axios.get(`${url}`).then(response => response.data);\n+  axios.get(`${AJAX_URL}`).then((response) => response.data);\n \n export const getCartIds = async () =>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f58611dcacf9ee48b8662e993144b6ecaa79ef88"}, "originalPosition": 44}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDQ2Mzg4NA==", "bodyText": "Added in edb5a72", "url": "https://github.com/phac-nml/irida/pull/813#discussion_r500463884", "createdAt": "2020-10-06T17:14:01Z", "author": {"login": "joshsadam"}, "path": "src/main/webapp/resources/js/apis/cart/cart.js", "diffHunk": "@@ -1,47 +1,49 @@\n import axios from \"axios\";\n import { setBaseUrl } from \"../../utilities/url-utilities\";\n \n-const url = setBaseUrl(`cart`);\n+const AJAX_URL = setBaseUrl(`/ajax/cart`);\n \n /**\n  * Add samples for a project to the cart.\n  * @param {number} projectId Identifier for the project the samples are from.\n  * @param {array} samples array of sample {ids } to add to cart.\n- * @returns {AxiosPromise<any>}\n+ * @returns {Promise<{count: any}>}\n  */\n export const putSampleInCart = async (projectId, samples) =>\n-  axios.put(url, {\n-    projectId,\n-    samples\n-  });\n+  axios\n+    .post(AJAX_URL, {\n+      projectId,\n+      sampleIds: samples.map((s) => s.id),\n+    })\n+    .then(({ data }) => data);\n \n /**\n  * Get the current number of samples in the cart\n- * @returns {Promise<void>}\n+ * @returns {Promise<{count: any}>}\n  */\n export const getCartCount = async () => {\n-  return axios.get(`${url}/count`).then(response => ({ count: response.data }));\n+  return axios.get(`${AJAX_URL}/count`).then(({ data }) => ({ count: data }));\n };\n \n /**\n  * Get the current state of the cart.\n  * @returns {Promise<void | never>}\n  */\n export const getCart = async () =>\n-  axios.get(`${url}`).then(response => response.data);\n+  axios.get(`${AJAX_URL}`).then((response) => response.data);\n \n export const getCartIds = async () =>", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDQ0NjMyMg=="}, "originalCommit": {"oid": "f58611dcacf9ee48b8662e993144b6ecaa79ef88"}, "originalPosition": 44}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEzMzQ3NzE0OnYy", "diffSide": "RIGHT", "path": "src/main/webapp/resources/js/pages/cart/components/CartSamples.jsx", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNlQxNjo0Njo0NFrOHdQ26g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNlQxNzoxNTowNlrOHdR74A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDQ0Njk1NA==", "bodyText": "Remove this logging statement and also change the const variable name to make it clear as to what it is", "url": "https://github.com/phac-nml/irida/pull/813#discussion_r500446954", "createdAt": "2020-10-06T16:46:44Z", "author": {"login": "deepsidhu85"}, "path": "src/main/webapp/resources/js/pages/cart/components/CartSamples.jsx", "diffHunk": "@@ -72,18 +72,27 @@ function CartSamplesComponent({\n   emptyCart,\n   displaySample,\n   removeSample,\n-  removeProject\n+  removeProject,\n }) {\n-  const filterSamples = e => applyFilter(e.target.value);\n+  const s = samples\n+    .map((project) => {\n+      const { samples, ...p } = project;\n+      return project.samples.map((sample) => ({ ...sample, project: p }));\n+    })\n+    .flat();\n+  console.log(s);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f58611dcacf9ee48b8662e993144b6ecaa79ef88"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDQ2NDYwOA==", "bodyText": "Removed in 0b5643b", "url": "https://github.com/phac-nml/irida/pull/813#discussion_r500464608", "createdAt": "2020-10-06T17:15:06Z", "author": {"login": "joshsadam"}, "path": "src/main/webapp/resources/js/pages/cart/components/CartSamples.jsx", "diffHunk": "@@ -72,18 +72,27 @@ function CartSamplesComponent({\n   emptyCart,\n   displaySample,\n   removeSample,\n-  removeProject\n+  removeProject,\n }) {\n-  const filterSamples = e => applyFilter(e.target.value);\n+  const s = samples\n+    .map((project) => {\n+      const { samples, ...p } = project;\n+      return project.samples.map((sample) => ({ ...sample, project: p }));\n+    })\n+    .flat();\n+  console.log(s);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDQ0Njk1NA=="}, "originalCommit": {"oid": "f58611dcacf9ee48b8662e993144b6ecaa79ef88"}, "originalPosition": 14}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 748, "cost": 1, "resetAt": "2021-11-12T12:57:47Z"}}}