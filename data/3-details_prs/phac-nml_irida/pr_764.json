{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDU3MzUxMjMx", "number": 764, "title": "Hotfix sample metadata fields ", "bodyText": "Description of changes\nFixes issues raised by @nknox:\n\nNumeric fields imported from an excel spreadsheet need to keep their formatting. Fixed by checking during file upload if it is a numeric field. \u00a0If it is, it saves the value as it is formatted in the cell.\nLong values do not wrap properly on the sample details page. Fixed by adding a word-break css attribute to the dd tags.\n\nRelated issue\nN/A\nChecklist\nThings for the developer to confirm they've done before the PR should be accepted:\n\n CHANGELOG.md (and UPGRADING.md if necessary) updated with information for new change.\nTests added (or description of how to test) for any new features.\nUser documentation updated for UI or technical changes.", "createdAt": "2020-07-27T19:15:31Z", "url": "https://github.com/phac-nml/irida/pull/764", "merged": true, "mergeCommit": {"oid": "74d225cd77e406427fb637a1f07c90a0c5870dd0"}, "closed": true, "closedAt": "2020-07-29T20:00:50Z", "author": {"login": "joshsadam"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc5EgVNAH2gAyNDU3MzUxMjMxOjYxYWJkNjRhMGNhYmIxYTc4YTNhYmEzZGU0Yzc3NWMwOTcxOTczMzE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc5wkoOgFqTQ1Nzg0MTMzMw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "61abd64a0cabb1a78a3aba3de4c775c097197331", "author": {"user": {"login": "joshsadam", "name": "Josh Adam"}}, "url": "https://github.com/phac-nml/irida/commit/61abd64a0cabb1a78a3aba3de4c775c097197331", "committedDate": "2020-07-27T16:34:42Z", "message": ":ambulance: Fixed issues with formatting on the sample details page."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "68081c2382124056a5a4ec1c2c6502bc69f1def5", "author": {"user": {"login": "joshsadam", "name": "Josh Adam"}}, "url": "https://github.com/phac-nml/irida/commit/68081c2382124056a5a4ec1c2c6502bc69f1def5", "committedDate": "2020-07-27T18:47:41Z", "message": ":construction: Fix cell format during upload."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU3MDA5Mzc3", "url": "https://github.com/phac-nml/irida/pull/764#pullrequestreview-457009377", "createdAt": "2020-07-28T21:01:45Z", "commit": {"oid": "68081c2382124056a5a4ec1c2c6502bc69f1def5"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOFQyMTowMTo0NVrOG4et6w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOFQyMTowMTo0NVrOG4et6w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTg3NjcxNQ==", "bodyText": "This seems to work for me, glad it was that straightforwad.  Even rounding seems to happen the same as expected.  Can you add a comment about why it's being added?", "url": "https://github.com/phac-nml/irida/pull/764#discussion_r461876715", "createdAt": "2020-07-28T21:01:45Z", "author": {"login": "tom114"}, "path": "src/main/java/ca/corefacility/bioinformatics/irida/ria/web/projects/metadata/ProjectSampleMetadataController.java", "diffHunk": "@@ -132,14 +132,22 @@ public SampleMetadataStorage createProjectSampleMetadata(HttpSession session, @P\n \t\t\t\tIterator<Cell> cellIterator = row.cellIterator();\n \t\t\t\twhile (cellIterator.hasNext()) {\n \t\t\t\t\tCell cell = cellIterator.next();\n+\n \t\t\t\t\tint columnIndex = cell.getColumnIndex();\n \t\t\t\t\tif (columnIndex < headers.size()) {\n \t\t\t\t\t\tString header = headers.get(columnIndex);\n \n \t\t\t\t\t\tif (!Strings.isNullOrEmpty(header)) {\n \t\t\t\t\t\t\t// Need to ignore empty headers.\n-\t\t\t\t\t\t\tcell.setCellType(CellType.STRING);\n-\t\t\t\t\t\t\trowMap.put(header, cell.getStringCellValue());\n+\t\t\t\t\t\t\tif(cell.getCellTypeEnum().equals(CellType.NUMERIC)) {\n+\t\t\t\t\t\t\t\tDataFormatter formatter = new DataFormatter();\n+\t\t\t\t\t\t\t\tString value = formatter.formatCellValue(cell);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "68081c2382124056a5a4ec1c2c6502bc69f1def5"}, "originalPosition": 15}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8225710892b864fec5f931b454e69addbe6ad003", "author": {"user": {"login": "joshsadam", "name": "Josh Adam"}}, "url": "https://github.com/phac-nml/irida/commit/8225710892b864fec5f931b454e69addbe6ad003", "committedDate": "2020-07-29T15:31:19Z", "message": ":white_check_mark: Added test to ensure numbers are formatted properly."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU3Nzg3Nzg3", "url": "https://github.com/phac-nml/irida/pull/764#pullrequestreview-457787787", "createdAt": "2020-07-29T18:36:59Z", "commit": {"oid": "8225710892b864fec5f931b454e69addbe6ad003"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOVQxODozNjo1OVrOG5FLYg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOVQxODozNjo1OVrOG5FLYg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjUwNjg1MA==", "bodyText": "This method is a bit too specific to the test data being used in ProjectSampleMetadataImportPageIT.java.  Can you change it to accept the header name as a string so it can be passed in by the test?  That way we can better reuse this page object if we wanted different input data.", "url": "https://github.com/phac-nml/irida/pull/764#discussion_r462506850", "createdAt": "2020-07-29T18:36:59Z", "author": {"login": "tom114"}, "path": "src/test/java/ca/corefacility/bioinformatics/irida/ria/integration/pages/projects/ProjectSampleMetadataImportPage.java", "diffHunk": "@@ -55,4 +58,15 @@ public int getFoundCount() {\n \tpublic int getMissingCount() {\n \t\treturn Integer.parseInt(missingPill.findElement(By.className(\"badge\")).getText());\n \t}\n+\n+\tpublic List<String> getNumberColumnValues() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8225710892b864fec5f931b454e69addbe6ad003"}, "originalPosition": 22}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "74d225cd77e406427fb637a1f07c90a0c5870dd0", "author": {"user": {"login": "joshsadam", "name": "Josh Adam"}}, "url": "https://github.com/phac-nml/irida/commit/74d225cd77e406427fb637a1f07c90a0c5870dd0", "committedDate": "2020-07-29T18:44:08Z", "message": ":white_check_mark: Updated method call to get the values for a column"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU3ODQxMzMz", "url": "https://github.com/phac-nml/irida/pull/764#pullrequestreview-457841333", "createdAt": "2020-07-29T19:55:13Z", "commit": {"oid": "74d225cd77e406427fb637a1f07c90a0c5870dd0"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 64, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}