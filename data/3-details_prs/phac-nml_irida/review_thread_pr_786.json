{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDcyODE5MzQ4", "number": 786, "reviewThreads": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNVQxMzo1NTozOFrOEcFL0g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNVQxODo1MDo0NFrOEcMzYg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk3ODgwNTMwOnYy", "diffSide": "RIGHT", "path": "src/main/webapp/resources/js/contexts/AnalysisContext.js", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNVQxMzo1NTozOFrOHGZSpg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNVQxNjoyMzoxOFrOHGf5lw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjQ2Nzg3OA==", "bodyText": "I am wondering if we should not make this into a React hook (the polling portion) or if there is an existing one we can use. \u00a0This seems like common logic.", "url": "https://github.com/phac-nml/irida/pull/786#discussion_r476467878", "createdAt": "2020-08-25T13:55:38Z", "author": {"login": "joshsadam"}, "path": "src/main/webapp/resources/js/contexts/AnalysisContext.js", "diffHunk": "@@ -44,6 +44,30 @@ const AnalysisContext = React.createContext(initialContext);\n function AnalysisProvider(props) {\n   const [analysisContext, setAnalysisContext] = useState(initialContext);\n \n+  // Update the analysis details that\n+  // are required to display the progression\n+  // using polling\n+  useEffect(() => {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ad227bb2e037c54e6e4f16e7cda701b6d2c65651"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjQ2ODU3OA==", "bodyText": "You could look at this: https://blog.bitsrc.io/polling-in-react-using-the-useinterval-custom-hook-e2bcefda4197", "url": "https://github.com/phac-nml/irida/pull/786#discussion_r476468578", "createdAt": "2020-08-25T13:56:34Z", "author": {"login": "joshsadam"}, "path": "src/main/webapp/resources/js/contexts/AnalysisContext.js", "diffHunk": "@@ -44,6 +44,30 @@ const AnalysisContext = React.createContext(initialContext);\n function AnalysisProvider(props) {\n   const [analysisContext, setAnalysisContext] = useState(initialContext);\n \n+  // Update the analysis details that\n+  // are required to display the progression\n+  // using polling\n+  useEffect(() => {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjQ2Nzg3OA=="}, "originalCommit": {"oid": "ad227bb2e037c54e6e4f16e7cda701b6d2c65651"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjU3NjE1MQ==", "bodyText": "Updated in a48aa58", "url": "https://github.com/phac-nml/irida/pull/786#discussion_r476576151", "createdAt": "2020-08-25T16:23:18Z", "author": {"login": "deepsidhu85"}, "path": "src/main/webapp/resources/js/contexts/AnalysisContext.js", "diffHunk": "@@ -44,6 +44,30 @@ const AnalysisContext = React.createContext(initialContext);\n function AnalysisProvider(props) {\n   const [analysisContext, setAnalysisContext] = useState(initialContext);\n \n+  // Update the analysis details that\n+  // are required to display the progression\n+  // using polling\n+  useEffect(() => {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjQ2Nzg3OA=="}, "originalCommit": {"oid": "ad227bb2e037c54e6e4f16e7cda701b6d2c65651"}, "originalPosition": 22}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk3OTg2Nzk3OnYy", "diffSide": "RIGHT", "path": "src/main/webapp/resources/js/contexts/AnalysisContext.js", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNVQxNzo1Njo1NlrOHGjjFg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNVQxOTo0ODozN1rOHGnSVg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjYzNTkyNg==", "bodyText": "This is happening even if nothing changes? \u00a0 Shouldn't you do a check first to see if an update is needed?", "url": "https://github.com/phac-nml/irida/pull/786#discussion_r476635926", "createdAt": "2020-08-25T17:56:56Z", "author": {"login": "joshsadam"}, "path": "src/main/webapp/resources/js/contexts/AnalysisContext.js", "diffHunk": "@@ -44,6 +44,30 @@ const AnalysisContext = React.createContext(initialContext);\n function AnalysisProvider(props) {\n   const [analysisContext, setAnalysisContext] = useState(initialContext);\n \n+  // Update the analysis details that\n+  // are required to display the progression\n+  // using polling\n+  useEffect(() => {\n+      const interval = setInterval(() => {\n+        getUpdatedDetails(analysisContext.analysis.identifier).then(res => {\n+          setAnalysisContext(analysisContext => {\n+            return {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ad227bb2e037c54e6e4f16e7cda701b6d2c65651"}, "originalPosition": 26}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjY5NzE3NA==", "bodyText": "Updated in c64a856", "url": "https://github.com/phac-nml/irida/pull/786#discussion_r476697174", "createdAt": "2020-08-25T19:48:37Z", "author": {"login": "deepsidhu85"}, "path": "src/main/webapp/resources/js/contexts/AnalysisContext.js", "diffHunk": "@@ -44,6 +44,30 @@ const AnalysisContext = React.createContext(initialContext);\n function AnalysisProvider(props) {\n   const [analysisContext, setAnalysisContext] = useState(initialContext);\n \n+  // Update the analysis details that\n+  // are required to display the progression\n+  // using polling\n+  useEffect(() => {\n+      const interval = setInterval(() => {\n+        getUpdatedDetails(analysisContext.analysis.identifier).then(res => {\n+          setAnalysisContext(analysisContext => {\n+            return {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjYzNTkyNg=="}, "originalCommit": {"oid": "ad227bb2e037c54e6e4f16e7cda701b6d2c65651"}, "originalPosition": 26}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk4MDA0NzE1OnYy", "diffSide": "RIGHT", "path": "src/main/webapp/resources/js/contexts/AnalysisContext.js", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNVQxODo0OTowNlrOHGlTUg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNVQxOTo0ODozMFrOHGnSHA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjY2NDY1OA==", "bodyText": "You should catch an error thrown from the server. \u00a0Stop the polling and show a notice to the user that \"something\" went wrong.", "url": "https://github.com/phac-nml/irida/pull/786#discussion_r476664658", "createdAt": "2020-08-25T18:49:06Z", "author": {"login": "joshsadam"}, "path": "src/main/webapp/resources/js/contexts/AnalysisContext.js", "diffHunk": "@@ -44,6 +44,30 @@ const AnalysisContext = React.createContext(initialContext);\n function AnalysisProvider(props) {\n   const [analysisContext, setAnalysisContext] = useState(initialContext);\n \n+  // Update the analysis details that\n+  // are required to display the progression\n+  // using polling\n+  useEffect(() => {\n+      const interval = setInterval(() => {\n+        getUpdatedDetails(analysisContext.analysis.identifier).then(res => {\n+          setAnalysisContext(analysisContext => {\n+            return {\n+              ...analysisContext,\n+              analysisState: res.analysisState,\n+              isCompleted: res.analysisState === \"COMPLETED\",\n+              isError: res.analysisState.includes(\"ERROR\"),\n+              previousState: res.previousState,\n+              duration: res.duration\n+            };", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ad227bb2e037c54e6e4f16e7cda701b6d2c65651"}, "originalPosition": 33}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjY5NzExNg==", "bodyText": "Updated in c64a856", "url": "https://github.com/phac-nml/irida/pull/786#discussion_r476697116", "createdAt": "2020-08-25T19:48:30Z", "author": {"login": "deepsidhu85"}, "path": "src/main/webapp/resources/js/contexts/AnalysisContext.js", "diffHunk": "@@ -44,6 +44,30 @@ const AnalysisContext = React.createContext(initialContext);\n function AnalysisProvider(props) {\n   const [analysisContext, setAnalysisContext] = useState(initialContext);\n \n+  // Update the analysis details that\n+  // are required to display the progression\n+  // using polling\n+  useEffect(() => {\n+      const interval = setInterval(() => {\n+        getUpdatedDetails(analysisContext.analysis.identifier).then(res => {\n+          setAnalysisContext(analysisContext => {\n+            return {\n+              ...analysisContext,\n+              analysisState: res.analysisState,\n+              isCompleted: res.analysisState === \"COMPLETED\",\n+              isError: res.analysisState.includes(\"ERROR\"),\n+              previousState: res.previousState,\n+              duration: res.duration\n+            };", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjY2NDY1OA=="}, "originalCommit": {"oid": "ad227bb2e037c54e6e4f16e7cda701b6d2c65651"}, "originalPosition": 33}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk4MDA1MDI0OnYy", "diffSide": "RIGHT", "path": "src/main/java/ca/corefacility/bioinformatics/irida/ria/web/analysis/AnalysisAjaxController.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNVQxODo0OTo1M1rOHGlVHQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNVQxOTo0ODoyNVrOHGnR9w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjY2NTExNw==", "bodyText": "Wrap this in a ResponseEntity so you can return an error state if you need to.", "url": "https://github.com/phac-nml/irida/pull/786#discussion_r476665117", "createdAt": "2020-08-25T18:49:53Z", "author": {"login": "joshsadam"}, "path": "src/main/java/ca/corefacility/bioinformatics/irida/ria/web/analysis/AnalysisAjaxController.java", "diffHunk": "@@ -1148,6 +1149,36 @@ public AnalysisProvenanceResponse getProvenanceByFile(@PathVariable Long submiss\n \t\treturn analysisProvenance;\n \t}\n \n+\t/**\n+\t * Get the updated state and duration of an analysis\n+\t *\n+\t * @param submissionId The analysis submission id\n+\t * @return dto which contains the updated analysis state and duration\n+\t */\n+\t@RequestMapping(value = \"/{submissionId}/updated-progress\")\n+\t@ResponseBody\n+\tpublic UpdatedAnalysisProgress getProvenanceByFile(@PathVariable Long submissionId) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ad227bb2e037c54e6e4f16e7cda701b6d2c65651"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjY5NzA3OQ==", "bodyText": "Updated in c64a856", "url": "https://github.com/phac-nml/irida/pull/786#discussion_r476697079", "createdAt": "2020-08-25T19:48:25Z", "author": {"login": "deepsidhu85"}, "path": "src/main/java/ca/corefacility/bioinformatics/irida/ria/web/analysis/AnalysisAjaxController.java", "diffHunk": "@@ -1148,6 +1149,36 @@ public AnalysisProvenanceResponse getProvenanceByFile(@PathVariable Long submiss\n \t\treturn analysisProvenance;\n \t}\n \n+\t/**\n+\t * Get the updated state and duration of an analysis\n+\t *\n+\t * @param submissionId The analysis submission id\n+\t * @return dto which contains the updated analysis state and duration\n+\t */\n+\t@RequestMapping(value = \"/{submissionId}/updated-progress\")\n+\t@ResponseBody\n+\tpublic UpdatedAnalysisProgress getProvenanceByFile(@PathVariable Long submissionId) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjY2NTExNw=="}, "originalCommit": {"oid": "ad227bb2e037c54e6e4f16e7cda701b6d2c65651"}, "originalPosition": 20}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk4MDA1MzQ2OnYy", "diffSide": "RIGHT", "path": "src/main/java/ca/corefacility/bioinformatics/irida/ria/web/analysis/AnalysisAjaxController.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNVQxODo1MDo0NFrOHGlXFA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNVQxOTo0ODoyMFrOHGnRyA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjY2NTYyMA==", "bodyText": "Because this is a RestController you don't have to annotate methods with ResponseBody", "url": "https://github.com/phac-nml/irida/pull/786#discussion_r476665620", "createdAt": "2020-08-25T18:50:44Z", "author": {"login": "joshsadam"}, "path": "src/main/java/ca/corefacility/bioinformatics/irida/ria/web/analysis/AnalysisAjaxController.java", "diffHunk": "@@ -1148,6 +1149,36 @@ public AnalysisProvenanceResponse getProvenanceByFile(@PathVariable Long submiss\n \t\treturn analysisProvenance;\n \t}\n \n+\t/**\n+\t * Get the updated state and duration of an analysis\n+\t *\n+\t * @param submissionId The analysis submission id\n+\t * @return dto which contains the updated analysis state and duration\n+\t */\n+\t@RequestMapping(value = \"/{submissionId}/updated-progress\")\n+\t@ResponseBody", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ad227bb2e037c54e6e4f16e7cda701b6d2c65651"}, "originalPosition": 19}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjY5NzAzMg==", "bodyText": "Removed in c64a856", "url": "https://github.com/phac-nml/irida/pull/786#discussion_r476697032", "createdAt": "2020-08-25T19:48:20Z", "author": {"login": "deepsidhu85"}, "path": "src/main/java/ca/corefacility/bioinformatics/irida/ria/web/analysis/AnalysisAjaxController.java", "diffHunk": "@@ -1148,6 +1149,36 @@ public AnalysisProvenanceResponse getProvenanceByFile(@PathVariable Long submiss\n \t\treturn analysisProvenance;\n \t}\n \n+\t/**\n+\t * Get the updated state and duration of an analysis\n+\t *\n+\t * @param submissionId The analysis submission id\n+\t * @return dto which contains the updated analysis state and duration\n+\t */\n+\t@RequestMapping(value = \"/{submissionId}/updated-progress\")\n+\t@ResponseBody", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjY2NTYyMA=="}, "originalCommit": {"oid": "ad227bb2e037c54e6e4f16e7cda701b6d2c65651"}, "originalPosition": 19}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 711, "cost": 1, "resetAt": "2021-11-12T12:57:47Z"}}}