{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDgyMzIxODMw", "number": 795, "title": "Add password authentication for SMTP server", "bodyText": "Description of changes\nAdd password and port parameter for smtp user authentication\nweb.conf can now include:\nmail.server.password=\nmail.server.port=\n\nTesting this can be done by configuring IRIDA to use a SMTP server with password authentication and requesting a password reset from the IRIDA web interface.\nRelated issue\nFixes #757\nChecklist\nThings for the developer to confirm they've done before the PR should be accepted:\n\n CHANGELOG.md (and UPGRADING.md if necessary) updated with information for new change.\n Tests added (or description of how to test) for any new features.\n User documentation updated for UI or technical changes.", "createdAt": "2020-09-08T22:04:41Z", "url": "https://github.com/phac-nml/irida/pull/795", "merged": true, "mergeCommit": {"oid": "bcb91d9f41da59a863c56c6a9d77a25c21aaefcc"}, "closed": true, "closedAt": "2021-01-19T18:39:17Z", "author": {"login": "innovate-invent"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdiXl5MABqjQwNjQ5MDYxNjA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdxvw__gFqTU3MTUzOTM0MQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d3f0225c42572f2e26ff176fff30f45bd02ba034", "author": {"user": {"login": "innovate-invent", "name": "Nolan Woods"}}, "url": "https://github.com/phac-nml/irida/commit/d3f0225c42572f2e26ff176fff30f45bd02ba034", "committedDate": "2020-12-02T18:21:38Z", "message": "Add port configuration for SMTP server"}, "afterCommit": {"oid": "72d18fa7f1f27d2c849304a55b37c19ce894b4d7", "author": {"user": {"login": "innovate-invent", "name": "Nolan Woods"}}, "url": "https://github.com/phac-nml/irida/commit/72d18fa7f1f27d2c849304a55b37c19ce894b4d7", "committedDate": "2020-12-02T23:59:37Z", "message": "Add port configuration for SMTP server"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dc5d48f2bd100af105d8ac56f1fd02c47f560592", "author": {"user": {"login": "innovate-invent", "name": "Nolan Woods"}}, "url": "https://github.com/phac-nml/irida/commit/dc5d48f2bd100af105d8ac56f1fd02c47f560592", "committedDate": "2020-12-03T00:47:29Z", "message": "Add password authentication for SMTP server"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0248a0ee73ccffc8e43f931d3e40a3ac6eaabd31", "author": {"user": {"login": "innovate-invent", "name": "Nolan Woods"}}, "url": "https://github.com/phac-nml/irida/commit/0248a0ee73ccffc8e43f931d3e40a3ac6eaabd31", "committedDate": "2020-12-03T00:47:29Z", "message": "Add port configuration for SMTP server"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bb5940aeec2181c7836aa6da0ffef1efee7d5e8d", "author": {"user": {"login": "innovate-invent", "name": "Nolan Woods"}}, "url": "https://github.com/phac-nml/irida/commit/bb5940aeec2181c7836aa6da0ffef1efee7d5e8d", "committedDate": "2020-12-03T00:50:02Z", "message": "Update CHANGELOG.md"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "72d18fa7f1f27d2c849304a55b37c19ce894b4d7", "author": {"user": {"login": "innovate-invent", "name": "Nolan Woods"}}, "url": "https://github.com/phac-nml/irida/commit/72d18fa7f1f27d2c849304a55b37c19ce894b4d7", "committedDate": "2020-12-02T23:59:37Z", "message": "Add port configuration for SMTP server"}, "afterCommit": {"oid": "bb5940aeec2181c7836aa6da0ffef1efee7d5e8d", "author": {"user": {"login": "innovate-invent", "name": "Nolan Woods"}}, "url": "https://github.com/phac-nml/irida/commit/bb5940aeec2181c7836aa6da0ffef1efee7d5e8d", "committedDate": "2020-12-03T00:50:02Z", "message": "Update CHANGELOG.md"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ0MDU4MDU5", "url": "https://github.com/phac-nml/irida/pull/795#pullrequestreview-544058059", "createdAt": "2020-12-03T15:15:52Z", "commit": {"oid": "bb5940aeec2181c7836aa6da0ffef1efee7d5e8d"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wM1QxNToxNTo1MlrOH-hXaw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wM1QxNTo0MToyNlrOH-i4RA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTMyMDQyNw==", "bodyText": "These properties will need to be added to the mail server configuration to be displayed at https://irida.corefacility.ca/documentation/administrator/web/#web-configuration.  You can find the file to display there in /doc/administrator/web/config/web.conf", "url": "https://github.com/phac-nml/irida/pull/795#discussion_r535320427", "createdAt": "2020-12-03T15:15:52Z", "author": {"login": "tom114"}, "path": "src/main/resources/configuration.properties", "diffHunk": "@@ -7,6 +7,8 @@ mail.server.host=YOUR_MAIL_HOST\n mail.server.protocol=YOUR_MAIL_PROTOCOL (usually SMTP)\n mail.server.email=YOUR_MAIL_SOURCE (the address the mail is coming from)\n mail.server.username=YOUR_MAIL_NAME (the name that the e-mail is coming from)\n+mail.server.password=YOUR_MAIL_PASSWORD (the password associated with the provided name)\n+mail.server.port=25", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bb5940aeec2181c7836aa6da0ffef1efee7d5e8d"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTM0NTIyMA==", "bodyText": "Can I ask for a small refactor here?  The UNCONFIGURED_PASSWORD_VALUE thing is a bit less than ideal.  I know that in the src/main/resources/configuration.properties file it has those values for the other entries too (username, host, protocol etc) and they're used in the isConfigured method below, but I feel like that could be a bit better managed.  It looks like it was code written about 7 years ago and I believe it was with the intention that people would change the values in this file rather than in their /etc/irida/*conf files.\nCan I ask you to change all of those default mail.server.X entries to blank in the src/main/resources/configuration.properties file and add checks for Strings.isNullOrEmpty for the optional entries before setting them above?  Optional would be port & password. That will make all those properties optional and more configurable for different mail server setups.", "url": "https://github.com/phac-nml/irida/pull/795#discussion_r535345220", "createdAt": "2020-12-03T15:41:26Z", "author": {"login": "tom114"}, "path": "src/main/java/ca/corefacility/bioinformatics/irida/config/services/WebEmailConfig.java", "diffHunk": "@@ -50,9 +59,19 @@ public static PropertySourcesPlaceholderConfigurer propertySourcesPlaceholderCon\n \t@Bean\n \tpublic ConfigurableJavaMailSender javaMailSender() {\n \t\tConfigurableJavaMailSenderImpl sender = new ConfigurableJavaMailSenderImpl();\n+\t\tProperties props = new Properties();\n+\n \t\tsender.setHost(host);\n+\t\tsender.setPort(port);\n \t\tsender.setProtocol(protocol);\n \t\tsender.setUsername(username);\n+\n+\t\tif (!(UNCONFIGURED_PASSWORD_VALUE.equals(password) || password.isBlank())) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bb5940aeec2181c7836aa6da0ffef1efee7d5e8d"}, "originalPosition": 44}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "184bfeacebc083f5b19c3c83aea7c5b055be4dc9", "author": {"user": {"login": "innovate-invent", "name": "Nolan Woods"}}, "url": "https://github.com/phac-nml/irida/commit/184bfeacebc083f5b19c3c83aea7c5b055be4dc9", "committedDate": "2020-12-03T22:11:46Z", "message": "Remove awkward \"unconfigured\" values"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTcxMjc0NjAz", "url": "https://github.com/phac-nml/irida/pull/795#pullrequestreview-571274603", "createdAt": "2021-01-19T14:07:23Z", "commit": {"oid": "184bfeacebc083f5b19c3c83aea7c5b055be4dc9"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b7f0f2642becaf9c2e9335010b41f6c550aa9eea", "author": {"user": {"login": "innovate-invent", "name": "Nolan Woods"}}, "url": "https://github.com/phac-nml/irida/commit/b7f0f2642becaf9c2e9335010b41f6c550aa9eea", "committedDate": "2021-01-19T17:22:23Z", "message": "Merge branch 'development' into smtp_pass"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTcxNTM5MzQx", "url": "https://github.com/phac-nml/irida/pull/795#pullrequestreview-571539341", "createdAt": "2021-01-19T18:38:35Z", "commit": {"oid": "b7f0f2642becaf9c2e9335010b41f6c550aa9eea"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 107, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}