{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDc1NTQzNjI0", "number": 789, "title": "Removed page variables for analysis and updated to use ajax to get an\u2026", "bodyText": "Description of changes\nWhat did you change in this pull request?  Provide a description of files changed, user interactions changed, etc.  Include how to test your changes.\nRemoved page variables for an analysis and updated to use ajax to get analysis details.\nRelated issue\nLink to the GitHub issue this pull request addresses using the #issuenum format.  If it completes an issue, use Fixes #issuenum to automatically close the issue.\nChecklist\nThings for the developer to confirm they've done before the PR should be accepted:\n* [ ] CHANGELOG.md (and UPGRADING.md if necessary) updated with information for new change.\n* [ ] Tests added (or description of how to test) for any new features.\n* [ ] User documentation updated for UI or technical changes.", "createdAt": "2020-08-28T17:30:47Z", "url": "https://github.com/phac-nml/irida/pull/789", "merged": true, "mergeCommit": {"oid": "68002fd0de416df5862f2080c4ddd30a8d3c774d"}, "closed": true, "closedAt": "2020-09-10T15:01:05Z", "author": {"login": "deepsidhu85"}, "timelineItems": {"totalCount": 17, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdDYeBHgH2gAyNDc1NTQzNjI0Ojk2ZDJhNmM2NWIyOGI4MTE0Njg1Mzk0NDc0ZDY1MjIzN2IxNzQ5MzI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdHiImKAFqTQ4NjAyOTA5MQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "96d2a6c65b28b8114685394474d652237b174932", "author": {"user": {"login": "deepsidhu85", "name": null}}, "url": "https://github.com/phac-nml/irida/commit/96d2a6c65b28b8114685394474d652237b174932", "committedDate": "2020-08-28T17:29:31Z", "message": "Removed page variables for analysis and updated to use ajax to get analysis details."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "48b7d5a5f5eed69b0488e08d29070143a056ca48", "author": {"user": {"login": "deepsidhu85", "name": null}}, "url": "https://github.com/phac-nml/irida/commit/48b7d5a5f5eed69b0488e08d29070143a056ca48", "committedDate": "2020-09-01T15:26:52Z", "message": "Removed @param principal no longer required. Updated AnalysisControllerTest"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a42378c3f779f10fe566a2bbad2cee592932e9b5", "author": {"user": {"login": "deepsidhu85", "name": null}}, "url": "https://github.com/phac-nml/irida/commit/a42378c3f779f10fe566a2bbad2cee592932e9b5", "committedDate": "2020-09-03T19:03:16Z", "message": "Removed unused imports. Updated AnalysisContext to set if the analysis should display the tree tab"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6c638a6f81373942cc03efe3738653ba287a9bad", "author": {"user": {"login": "deepsidhu85", "name": null}}, "url": "https://github.com/phac-nml/irida/commit/6c638a6f81373942cc03efe3738653ba287a9bad", "committedDate": "2020-09-03T19:05:21Z", "message": "Added javadoc for method"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e4bad74b15034b7e4107149275d7fbd0b0c14ec7", "author": {"user": {"login": "deepsidhu85", "name": null}}, "url": "https://github.com/phac-nml/irida/commit/e4bad74b15034b7e4107149275d7fbd0b0c14ec7", "committedDate": "2020-09-03T19:41:17Z", "message": "Added function comment. Refactored import statements into one"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "69a5173918a6a448e752b3d171886910beb14f46", "author": {"user": {"login": "deepsidhu85", "name": null}}, "url": "https://github.com/phac-nml/irida/commit/69a5173918a6a448e752b3d171886910beb14f46", "committedDate": "2020-09-03T20:34:31Z", "message": "Added missing @param tag"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cd66b6bb19cc87069a1d83fb412d12488fd20494", "author": {"user": {"login": "deepsidhu85", "name": null}}, "url": "https://github.com/phac-nml/irida/commit/cd66b6bb19cc87069a1d83fb412d12488fd20494", "committedDate": "2020-09-04T19:17:00Z", "message": "Updated to use analysis id obtained in analysisContext. Removed unused import"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d530938ff519d196a4cabc6321abdb05b6967342", "author": {"user": {"login": "deepsidhu85", "name": null}}, "url": "https://github.com/phac-nml/irida/commit/d530938ff519d196a4cabc6321abdb05b6967342", "committedDate": "2020-09-08T14:06:41Z", "message": "Merge branch 'development' into cleanup-analysis-context-page-variables"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg0MjAxMjk1", "url": "https://github.com/phac-nml/irida/pull/789#pullrequestreview-484201295", "createdAt": "2020-09-08T14:31:41Z", "commit": {"oid": "d530938ff519d196a4cabc6321abdb05b6967342"}, "state": "COMMENTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOFQxNDozMTo0MVrOHOgDOw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOFQxNDozOTowNVrOHOgZrQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDk2NzIyNw==", "bodyText": "I am seeing warnings in this file that several of the auto wired components are not being used (emailController, analysisAudit, analysisTypeService), can you clean this up?", "url": "https://github.com/phac-nml/irida/pull/789#discussion_r484967227", "createdAt": "2020-09-08T14:31:41Z", "author": {"login": "joshsadam"}, "path": "src/main/java/ca/corefacility/bioinformatics/irida/ria/web/analysis/AnalysisController.java", "diffHunk": "@@ -1,8 +1,6 @@\n package ca.corefacility.bioinformatics.irida.ria.web.analysis;\n \n import java.security.Principal;\n-import java.util.Date;\n-import java.util.Optional;\n \n import org.slf4j.Logger;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d530938ff519d196a4cabc6321abdb05b6967342"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDk2ODU5Mw==", "bodyText": "Why are you keeping this one variable on the page?", "url": "https://github.com/phac-nml/irida/pull/789#discussion_r484968593", "createdAt": "2020-09-08T14:33:27Z", "author": {"login": "joshsadam"}, "path": "src/main/webapp/pages/analysis.html", "diffHunk": "@@ -5,20 +5,13 @@\n   data-layout-decorate=\"~{template/page}\"\n >\n   <head>\n-    <title th:text=\"#{analysis.title(${analysisSubmission.getName()})}\">ANALYSIS RESULTS</title>\n+    <title th:text=\"#{analysis.title(${analysisName})}\">ANALYSIS RESULTS</title>\n     <link rel=\"stylesheet\" th:href=\"@{/dist/css/analysis.bundle.css}\" />\n \n     <script th:inline=\"javascript\">\n+\n       window.PAGE = {\n-        analysis: [[${analysisSubmission}]],\n-        analysisName: [[${analysisSubmission.getName()}]],\n-        analysisState: [[${analysisSubmission.getAnalysisState()}]],\n         analysisType: [[${analysisType}]],", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d530938ff519d196a4cabc6321abdb05b6967342"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDk3MTE1NQ==", "bodyText": "Wouldn't these all default to null or false without stating them here?  Since none of these are objects you can just leave them off and add them as needed.", "url": "https://github.com/phac-nml/irida/pull/789#discussion_r484971155", "createdAt": "2020-09-08T14:36:42Z", "author": {"login": "joshsadam"}, "path": "src/main/webapp/resources/js/contexts/AnalysisContext.js", "diffHunk": "@@ -31,18 +35,19 @@ export const stateMap = {\n   COMPLETED: 5\n };\n \n-export const isAdmin = window.PAGE.isAdmin;\n-\n const initialContext = {\n-  analysis: window.PAGE.analysis,\n-  analysisName: window.PAGE.analysisName,\n-  analysisState: window.PAGE.analysisState,\n-  analysisType: window.PAGE.analysisType.type,\n-  analysisViewer: window.PAGE.analysisViewer,\n-  isCompleted: window.PAGE.analysisState === \"COMPLETED\",\n-  isError: window.PAGE.analysisState.includes(\"ERROR\"),\n-  previousState: window.PAGE.previousState,\n-  duration: window.PAGE.duration\n+  analysis: null,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d530938ff519d196a4cabc6321abdb05b6967342"}, "originalPosition": 38}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDk3Mjk3Mw==", "bodyText": "This looks like it would be simpler just to destructor the response and just explicitly state the ones that are not. e.g\nreturn {...analysisContexxt, ...res, isCompleted: res.analysisState === \"COMPLETED\"}", "url": "https://github.com/phac-nml/irida/pull/789#discussion_r484972973", "createdAt": "2020-09-08T14:39:05Z", "author": {"login": "joshsadam"}, "path": "src/main/webapp/resources/js/contexts/AnalysisContext.js", "diffHunk": "@@ -51,12 +56,49 @@ const AnalysisContext = React.createContext(initialContext);\n \n function AnalysisProvider(props) {\n   const [analysisContext, setAnalysisContext] = useState(initialContext);\n+  const analysisIdentifier = window.location.pathname.match(/analysis\\/(\\d+)/)[1];\n+\n+  useEffect(() => {\n+    getAnalysisInfo(analysisIdentifier).then(res => {\n+      setAnalysisContext(analysisContext => {\n+        return {\n+          ...analysisContext,\n+          analysis: res.analysis,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d530938ff519d196a4cabc6321abdb05b6967342"}, "originalPosition": 64}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8d63f91593b46a445bb918bea869f802e346b15f", "author": {"user": {"login": "deepsidhu85", "name": null}}, "url": "https://github.com/phac-nml/irida/commit/8d63f91593b46a445bb918bea869f802e346b15f", "committedDate": "2020-09-08T20:34:22Z", "message": "Removed unused services from analysiscontroller and analysiscontrollertest. Updated logic for getting analysis details to set isCompleted, isError, and/or if the tree tab should be displayed for an analysis."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg0OTMzNjY5", "url": "https://github.com/phac-nml/irida/pull/789#pullrequestreview-484933669", "createdAt": "2020-09-09T11:58:20Z", "commit": {"oid": "8d63f91593b46a445bb918bea869f802e346b15f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOVQxMTo1ODoyMFrOHPD1jw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOVQxMTo1ODoyMFrOHPD1jw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTU1MzU1MQ==", "bodyText": "Move this into you loading useEffect that way it does not happen on every re-render.  You can store the value in a setState variable by the same name.", "url": "https://github.com/phac-nml/irida/pull/789#discussion_r485553551", "createdAt": "2020-09-09T11:58:20Z", "author": {"login": "joshsadam"}, "path": "src/main/webapp/resources/js/contexts/AnalysisContext.js", "diffHunk": "@@ -51,12 +55,30 @@ const AnalysisContext = React.createContext(initialContext);\n \n function AnalysisProvider(props) {\n   const [analysisContext, setAnalysisContext] = useState(initialContext);\n+  const analysisIdentifier = window.location.pathname.match(/analysis\\/(\\d+)/)[1];", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8d63f91593b46a445bb918bea869f802e346b15f"}, "originalPosition": 56}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "91b5b8f9ea189503d79174656273a9f018de1d60", "author": {"user": {"login": "deepsidhu85", "name": null}}, "url": "https://github.com/phac-nml/irida/commit/91b5b8f9ea189503d79174656273a9f018de1d60", "committedDate": "2020-09-09T14:58:18Z", "message": "Moved setting of analysis identifier into useeffect. Changed method from which newick string is obtained"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0c3ba688b9ee6cd4dbea41205936ba090f91aa46", "author": {"user": {"login": "deepsidhu85", "name": null}}, "url": "https://github.com/phac-nml/irida/commit/0c3ba688b9ee6cd4dbea41205936ba090f91aa46", "committedDate": "2020-09-09T16:32:31Z", "message": "Modified assertEquals text. Updated logic to set treeDefault to true only if a newick string is not null"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "20706240fe9788875389c355fa69a731c73667ce", "author": {"user": {"login": "deepsidhu85", "name": null}}, "url": "https://github.com/phac-nml/irida/commit/20706240fe9788875389c355fa69a731c73667ce", "committedDate": "2020-09-09T16:59:20Z", "message": "Removed logging statement"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7b6def5bd07cbdc1f22afd587940c06aa726c879", "author": {"user": {"login": "deepsidhu85", "name": null}}, "url": "https://github.com/phac-nml/irida/commit/7b6def5bd07cbdc1f22afd587940c06aa726c879", "committedDate": "2020-09-09T17:10:12Z", "message": "Updated test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6b37dbe8bf41d8c91282165bcfec37091d687372", "author": {"user": {"login": "deepsidhu85", "name": null}}, "url": "https://github.com/phac-nml/irida/commit/6b37dbe8bf41d8c91282165bcfec37091d687372", "committedDate": "2020-09-09T18:30:31Z", "message": "Updated tests to pass the number of download buttons expected"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg2MDI5MDkx", "url": "https://github.com/phac-nml/irida/pull/789#pullrequestreview-486029091", "createdAt": "2020-09-10T15:00:52Z", "commit": {"oid": "6b37dbe8bf41d8c91282165bcfec37091d687372"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 93, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}