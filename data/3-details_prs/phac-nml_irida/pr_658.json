{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA0NzQwMjc5", "number": 658, "title": "Added analysis result image viewer", "bodyText": "Description of changes\nWhat did you change in this pull request?  Provide a description of files changed, user interactions changed, etc.  Include how to test your changes.\nAdded an Image Output tab for analysis results on the Output File Preview page which will display jpeg and png image previews.\nAs we don't have a pipeline which outputs image files, testing this out currently requires you to add an image output to a pipeline (upgrading the workflow structure), move an image to the output folder for an Irida pipeline, and updating the path in AnalysisOutputFile for the file. This also requires you to modify the output file map to include this file name. So for now I've included the below screenshot as to what it looks like.\n\nRelated issue\nLink to the GitHub issue this pull request addresses using the #issuenum format.  If it completes an issue, use Fixes #issuenum to automatically close the issue.\nChecklist\nThings for the developer to confirm they've done before the PR should be accepted:\n\n CHANGELOG.md (and UPGRADING.md if necessary) updated with information for new change.\n* [ ] Tests added (or description of how to test) for any new features.\n* [ ] User documentation updated for UI or technical changes.", "createdAt": "2020-04-16T21:15:23Z", "url": "https://github.com/phac-nml/irida/pull/658", "merged": true, "mergeCommit": {"oid": "2b3d8fa52fc25ddaffc5d05a9f23a91a4ab04942"}, "closed": true, "closedAt": "2020-04-19T00:13:56Z", "author": {"login": "deepsidhu85"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcYTWUFAH2gAyNDA0NzQwMjc5OmZkMWYwMDNmODEyMWJiNDVhODMwZWQ4MDA3ZTM0ZjcyMzI0ZGVhODM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcYlM5FAH2gAyNDA0NzQwMjc5OjEzNDcyY2NlZGJiYzhhMGM0ZDljZjE2MDA3NTcwNzUzZjI4NzAyYjI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "fd1f003f8121bb45a830ed8007e34f72324dea83", "author": {"user": null}, "url": "https://github.com/phac-nml/irida/commit/fd1f003f8121bb45a830ed8007e34f72324dea83", "committedDate": "2020-04-16T21:12:50Z", "message": "Added analysis result image viewer to output file preview page. Removed Row tags from output preview files that were misaligning the download buttons."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cb5b74deab45a10292634dbcf66d84b2986d4ff8", "author": {"user": null}, "url": "https://github.com/phac-nml/irida/commit/cb5b74deab45a10292634dbcf66d84b2986d4ff8", "committedDate": "2020-04-16T21:18:51Z", "message": "Updated CHANGELOG and add missing comment to AnalysisOutputFile model"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d464a3ec8cde8a3343cd6cd1a793b8c45e5e66de", "author": {"user": null}, "url": "https://github.com/phac-nml/irida/commit/d464a3ec8cde8a3343cd6cd1a793b8c45e5e66de", "committedDate": "2020-04-16T21:43:14Z", "message": "Merge branch 'development' into add-analysis-image-viewer"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8f27e701e703d5bd262b2ed6d90f344e40c13780", "author": {"user": null}, "url": "https://github.com/phac-nml/irida/commit/8f27e701e703d5bd262b2ed6d90f344e40c13780", "committedDate": "2020-04-16T22:31:49Z", "message": "Updated comment. Added throws IOException to the getImageFile method"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9e13ed4ef68859bc41e2d44ff927383415da3432", "author": {"user": null}, "url": "https://github.com/phac-nml/irida/commit/9e13ed4ef68859bc41e2d44ff927383415da3432", "committedDate": "2020-04-16T22:57:47Z", "message": "Added try catch block"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1068fb1d2168a577299c23d72d475f87e6976eef", "author": {"user": null}, "url": "https://github.com/phac-nml/irida/commit/1068fb1d2168a577299c23d72d475f87e6976eef", "committedDate": "2020-04-17T00:09:59Z", "message": "Removed throws comment as we catch the exception"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk1MzQ3Mzkz", "url": "https://github.com/phac-nml/irida/pull/658#pullrequestreview-395347393", "createdAt": "2020-04-17T10:39:39Z", "commit": {"oid": "1068fb1d2168a577299c23d72d475f87e6976eef"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xN1QxMDozOTozOVrOGHJBWw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xN1QxMjo1NzoyMFrOGHM3NA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDE0MTAxOQ==", "bodyText": "Instead of a straight out String, can we get in the habit of return ResponseEntity<String> it allows for better control of the response.  In the case, when you log the exception you could return an error state: ResponseEntity.status(HttpStatus.BAD_REQUEST).body(\"That was a terrible idea\").  That way the UI can response the the status of the request appropriately.", "url": "https://github.com/phac-nml/irida/pull/658#discussion_r410141019", "createdAt": "2020-04-17T10:39:39Z", "author": {"login": "joshsadam"}, "path": "src/main/java/ca/corefacility/bioinformatics/irida/ria/web/analysis/AnalysisAjaxController.java", "diffHunk": "@@ -882,6 +882,39 @@ public void getAjaxDownloadAnalysisSubmissionIndividualFile(@PathVariable Long a\n \t\treturn ImmutableMap.of(\"newick\", lines.get(0));\n \t}\n \n+\t/**\n+\t * Get an image file associated with a specific {@link AnalysisSubmission} by file name.\n+\t *\n+\t * @param submissionId {@link Long} id for an {@link AnalysisSubmission}\n+\t * @param filename {@link String} filename for an {@link AnalysisOutputFile}\n+\t *\n+\t * @return {@link String} containing the image file contents as a base64 encoded string.\n+\t */\n+\t@RequestMapping(\"{submissionId}/image\")\n+\t@ResponseBody\n+\tpublic String getImageFile(@PathVariable Long submissionId, String filename){", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1068fb1d2168a577299c23d72d475f87e6976eef"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDE3Njk1OA==", "bodyText": "Remember, in es6 this is redundant, you only need:\nfileTypes: [\n            {\n              hasJsonFile,\n              hasTabularFile,\n              hasTextFile,\n              hasExcelFile,\n              hasImageFile,\n            }\n          ]", "url": "https://github.com/phac-nml/irida/pull/658#discussion_r410176958", "createdAt": "2020-04-17T12:02:11Z", "author": {"login": "joshsadam"}, "path": "src/main/webapp/resources/js/contexts/AnalysisOutputsContext.js", "diffHunk": "@@ -71,7 +78,8 @@ function AnalysisOutputsProvider(props) {\n               hasJsonFile: hasJsonFile,\n               hasTabularFile: hasTabularFile,\n               hasTextFile: hasTextFile,\n-              hasExcelFile: hasExcelFile\n+              hasExcelFile: hasExcelFile,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1068fb1d2168a577299c23d72d475f87e6976eef"}, "originalPosition": 41}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDE4Nzc1Mw==", "bodyText": "This file is really get big.  Don't do it know, but if you need to add more to it, refactor some helper functions into their own file.", "url": "https://github.com/phac-nml/irida/pull/658#discussion_r410187753", "createdAt": "2020-04-17T12:25:47Z", "author": {"login": "joshsadam"}, "path": "src/main/webapp/resources/js/pages/analysis/components/outputs/OutputFilePreview.jsx", "diffHunk": "@@ -20,6 +20,7 @@ import { IconFile } from \"../../../../components/icons/Icons\";\n const AnalysisTextPreview = React.lazy(() => import(\"../AnalysisTextPreview\"));\n const AnalysisJsonPreview = React.lazy(() => import(\"../AnalysisJsonPreview\"));\n const AnalysisExcelPreview = React.lazy(() => import(\"../AnalysisExcelPreview\"));\n+const AnalysisImagePreview = React.lazy(() => import(\"../AnalysisImagePreview\"));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1068fb1d2168a577299c23d72d475f87e6976eef"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDIwMzk1Ng==", "bodyText": "Isn't this a duplicate set of code from AnalysisOutputsContext?", "url": "https://github.com/phac-nml/irida/pull/658#discussion_r410203956", "createdAt": "2020-04-17T12:57:20Z", "author": {"login": "joshsadam"}, "path": "src/main/webapp/resources/js/pages/analysis/components/outputs/OutputFilePreview.jsx", "diffHunk": "@@ -152,7 +177,9 @@ export default function OutputFilePreview() {\n       if (\n         !jsonExtSet.has(output.fileExt) &&\n         !tabExtSet.has(output.fileExt) &&\n-        !blacklistExtSet.has(output.fileExt)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1068fb1d2168a577299c23d72d475f87e6976eef"}, "originalPosition": 52}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a6f973b9319bc3f2d954a416af2062bb5b776ba8", "author": {"user": null}, "url": "https://github.com/phac-nml/irida/commit/a6f973b9319bc3f2d954a416af2062bb5b776ba8", "committedDate": "2020-04-17T16:17:49Z", "message": "Refactored code to move checking if a preview is required for a certain file type into the context. Updated getImageFile in analysis ajax controller to return a ResponseEntity<String>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cbf51db393fbb45b195bfb0d8a0dea2fcc2bbced", "author": {"user": null}, "url": "https://github.com/phac-nml/irida/commit/cbf51db393fbb45b195bfb0d8a0dea2fcc2bbced", "committedDate": "2020-04-17T17:11:02Z", "message": "Updated message returned if unable to read image file"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk1NjUwNDI1", "url": "https://github.com/phac-nml/irida/pull/658#pullrequestreview-395650425", "createdAt": "2020-04-17T17:41:31Z", "commit": {"oid": "cbf51db393fbb45b195bfb0d8a0dea2fcc2bbced"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "13472ccedbbc8a0c4d9cf16007570753f28702b2", "author": {"user": null}, "url": "https://github.com/phac-nml/irida/commit/13472ccedbbc8a0c4d9cf16007570753f28702b2", "committedDate": "2020-04-17T18:00:50Z", "message": "Added missing @param to method comment"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 228, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}