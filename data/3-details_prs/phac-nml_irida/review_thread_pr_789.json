{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDc1NTQzNjI0", "number": 789, "reviewThreads": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOFQxNDozMTo0MVrOEhRqXA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOVQxMTo1ODoyMFrOEho19A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAzMzI3ODM2OnYy", "diffSide": "RIGHT", "path": "src/main/java/ca/corefacility/bioinformatics/irida/ria/web/analysis/AnalysisController.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOFQxNDozMTo0MVrOHOgDOw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOVQxNToyMzo0OVrOHPMwjw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDk2NzIyNw==", "bodyText": "I am seeing warnings in this file that several of the auto wired components are not being used (emailController, analysisAudit, analysisTypeService), can you clean this up?", "url": "https://github.com/phac-nml/irida/pull/789#discussion_r484967227", "createdAt": "2020-09-08T14:31:41Z", "author": {"login": "joshsadam"}, "path": "src/main/java/ca/corefacility/bioinformatics/irida/ria/web/analysis/AnalysisController.java", "diffHunk": "@@ -1,8 +1,6 @@\n package ca.corefacility.bioinformatics.irida.ria.web.analysis;\n \n import java.security.Principal;\n-import java.util.Date;\n-import java.util.Optional;\n \n import org.slf4j.Logger;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d530938ff519d196a4cabc6321abdb05b6967342"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTY5OTcyNw==", "bodyText": "Removed in 8d63f91", "url": "https://github.com/phac-nml/irida/pull/789#discussion_r485699727", "createdAt": "2020-09-09T15:23:49Z", "author": {"login": "deepsidhu85"}, "path": "src/main/java/ca/corefacility/bioinformatics/irida/ria/web/analysis/AnalysisController.java", "diffHunk": "@@ -1,8 +1,6 @@\n package ca.corefacility.bioinformatics.irida.ria.web.analysis;\n \n import java.security.Principal;\n-import java.util.Date;\n-import java.util.Optional;\n \n import org.slf4j.Logger;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDk2NzIyNw=="}, "originalCommit": {"oid": "d530938ff519d196a4cabc6321abdb05b6967342"}, "originalPosition": 7}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAzMzI4NjkyOnYy", "diffSide": "RIGHT", "path": "src/main/webapp/pages/analysis.html", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOFQxNDozMzoyN1rOHOgIkQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOVQxNToyNDoxMVrOHPMxsw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDk2ODU5Mw==", "bodyText": "Why are you keeping this one variable on the page?", "url": "https://github.com/phac-nml/irida/pull/789#discussion_r484968593", "createdAt": "2020-09-08T14:33:27Z", "author": {"login": "joshsadam"}, "path": "src/main/webapp/pages/analysis.html", "diffHunk": "@@ -5,20 +5,13 @@\n   data-layout-decorate=\"~{template/page}\"\n >\n   <head>\n-    <title th:text=\"#{analysis.title(${analysisSubmission.getName()})}\">ANALYSIS RESULTS</title>\n+    <title th:text=\"#{analysis.title(${analysisName})}\">ANALYSIS RESULTS</title>\n     <link rel=\"stylesheet\" th:href=\"@{/dist/css/analysis.bundle.css}\" />\n \n     <script th:inline=\"javascript\">\n+\n       window.PAGE = {\n-        analysis: [[${analysisSubmission}]],\n-        analysisName: [[${analysisSubmission.getName()}]],\n-        analysisState: [[${analysisSubmission.getAnalysisState()}]],\n         analysisType: [[${analysisType}]],", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d530938ff519d196a4cabc6321abdb05b6967342"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTcwMDAxOQ==", "bodyText": "Removed in 8d63f91", "url": "https://github.com/phac-nml/irida/pull/789#discussion_r485700019", "createdAt": "2020-09-09T15:24:11Z", "author": {"login": "deepsidhu85"}, "path": "src/main/webapp/pages/analysis.html", "diffHunk": "@@ -5,20 +5,13 @@\n   data-layout-decorate=\"~{template/page}\"\n >\n   <head>\n-    <title th:text=\"#{analysis.title(${analysisSubmission.getName()})}\">ANALYSIS RESULTS</title>\n+    <title th:text=\"#{analysis.title(${analysisName})}\">ANALYSIS RESULTS</title>\n     <link rel=\"stylesheet\" th:href=\"@{/dist/css/analysis.bundle.css}\" />\n \n     <script th:inline=\"javascript\">\n+\n       window.PAGE = {\n-        analysis: [[${analysisSubmission}]],\n-        analysisName: [[${analysisSubmission.getName()}]],\n-        analysisState: [[${analysisSubmission.getAnalysisState()}]],\n         analysisType: [[${analysisType}]],", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDk2ODU5Mw=="}, "originalCommit": {"oid": "d530938ff519d196a4cabc6321abdb05b6967342"}, "originalPosition": 14}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAzMzMwMzQ2OnYy", "diffSide": "RIGHT", "path": "src/main/webapp/resources/js/contexts/AnalysisContext.js", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOFQxNDozNjo0MlrOHOgSkw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOVQxNToyNDozNlrOHPMy0w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDk3MTE1NQ==", "bodyText": "Wouldn't these all default to null or false without stating them here?  Since none of these are objects you can just leave them off and add them as needed.", "url": "https://github.com/phac-nml/irida/pull/789#discussion_r484971155", "createdAt": "2020-09-08T14:36:42Z", "author": {"login": "joshsadam"}, "path": "src/main/webapp/resources/js/contexts/AnalysisContext.js", "diffHunk": "@@ -31,18 +35,19 @@ export const stateMap = {\n   COMPLETED: 5\n };\n \n-export const isAdmin = window.PAGE.isAdmin;\n-\n const initialContext = {\n-  analysis: window.PAGE.analysis,\n-  analysisName: window.PAGE.analysisName,\n-  analysisState: window.PAGE.analysisState,\n-  analysisType: window.PAGE.analysisType.type,\n-  analysisViewer: window.PAGE.analysisViewer,\n-  isCompleted: window.PAGE.analysisState === \"COMPLETED\",\n-  isError: window.PAGE.analysisState.includes(\"ERROR\"),\n-  previousState: window.PAGE.previousState,\n-  duration: window.PAGE.duration\n+  analysis: null,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d530938ff519d196a4cabc6321abdb05b6967342"}, "originalPosition": 38}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTcwMDMwNw==", "bodyText": "If we don't set them then we get a bunch of undefined errors", "url": "https://github.com/phac-nml/irida/pull/789#discussion_r485700307", "createdAt": "2020-09-09T15:24:36Z", "author": {"login": "deepsidhu85"}, "path": "src/main/webapp/resources/js/contexts/AnalysisContext.js", "diffHunk": "@@ -31,18 +35,19 @@ export const stateMap = {\n   COMPLETED: 5\n };\n \n-export const isAdmin = window.PAGE.isAdmin;\n-\n const initialContext = {\n-  analysis: window.PAGE.analysis,\n-  analysisName: window.PAGE.analysisName,\n-  analysisState: window.PAGE.analysisState,\n-  analysisType: window.PAGE.analysisType.type,\n-  analysisViewer: window.PAGE.analysisViewer,\n-  isCompleted: window.PAGE.analysisState === \"COMPLETED\",\n-  isError: window.PAGE.analysisState.includes(\"ERROR\"),\n-  previousState: window.PAGE.previousState,\n-  duration: window.PAGE.duration\n+  analysis: null,", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDk3MTE1NQ=="}, "originalCommit": {"oid": "d530938ff519d196a4cabc6321abdb05b6967342"}, "originalPosition": 38}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAzMzMxNDg3OnYy", "diffSide": "RIGHT", "path": "src/main/webapp/resources/js/contexts/AnalysisContext.js", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOFQxNDozOTowNVrOHOgZrQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOVQxNToyNDo0NFrOHPMzPQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDk3Mjk3Mw==", "bodyText": "This looks like it would be simpler just to destructor the response and just explicitly state the ones that are not. e.g\nreturn {...analysisContexxt, ...res, isCompleted: res.analysisState === \"COMPLETED\"}", "url": "https://github.com/phac-nml/irida/pull/789#discussion_r484972973", "createdAt": "2020-09-08T14:39:05Z", "author": {"login": "joshsadam"}, "path": "src/main/webapp/resources/js/contexts/AnalysisContext.js", "diffHunk": "@@ -51,12 +56,49 @@ const AnalysisContext = React.createContext(initialContext);\n \n function AnalysisProvider(props) {\n   const [analysisContext, setAnalysisContext] = useState(initialContext);\n+  const analysisIdentifier = window.location.pathname.match(/analysis\\/(\\d+)/)[1];\n+\n+  useEffect(() => {\n+    getAnalysisInfo(analysisIdentifier).then(res => {\n+      setAnalysisContext(analysisContext => {\n+        return {\n+          ...analysisContext,\n+          analysis: res.analysis,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d530938ff519d196a4cabc6321abdb05b6967342"}, "originalPosition": 64}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDk4MzU0OA==", "bodyText": "I might even go as far as making the response from the server have all the variables set exactly as you want them (e.g. isCompleted, etc...) be set server side properly", "url": "https://github.com/phac-nml/irida/pull/789#discussion_r484983548", "createdAt": "2020-09-08T14:53:04Z", "author": {"login": "joshsadam"}, "path": "src/main/webapp/resources/js/contexts/AnalysisContext.js", "diffHunk": "@@ -51,12 +56,49 @@ const AnalysisContext = React.createContext(initialContext);\n \n function AnalysisProvider(props) {\n   const [analysisContext, setAnalysisContext] = useState(initialContext);\n+  const analysisIdentifier = window.location.pathname.match(/analysis\\/(\\d+)/)[1];\n+\n+  useEffect(() => {\n+    getAnalysisInfo(analysisIdentifier).then(res => {\n+      setAnalysisContext(analysisContext => {\n+        return {\n+          ...analysisContext,\n+          analysis: res.analysis,", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDk3Mjk3Mw=="}, "originalCommit": {"oid": "d530938ff519d196a4cabc6321abdb05b6967342"}, "originalPosition": 64}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTcwMDQxMw==", "bodyText": "Updated in 8d63f91", "url": "https://github.com/phac-nml/irida/pull/789#discussion_r485700413", "createdAt": "2020-09-09T15:24:44Z", "author": {"login": "deepsidhu85"}, "path": "src/main/webapp/resources/js/contexts/AnalysisContext.js", "diffHunk": "@@ -51,12 +56,49 @@ const AnalysisContext = React.createContext(initialContext);\n \n function AnalysisProvider(props) {\n   const [analysisContext, setAnalysisContext] = useState(initialContext);\n+  const analysisIdentifier = window.location.pathname.match(/analysis\\/(\\d+)/)[1];\n+\n+  useEffect(() => {\n+    getAnalysisInfo(analysisIdentifier).then(res => {\n+      setAnalysisContext(analysisContext => {\n+        return {\n+          ...analysisContext,\n+          analysis: res.analysis,", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDk3Mjk3Mw=="}, "originalCommit": {"oid": "d530938ff519d196a4cabc6321abdb05b6967342"}, "originalPosition": 64}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAzNzA3NjM2OnYy", "diffSide": "RIGHT", "path": "src/main/webapp/resources/js/contexts/AnalysisContext.js", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOVQxMTo1ODoyMFrOHPD1jw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOVQxNToyNDo1N1rOHPMz6w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTU1MzU1MQ==", "bodyText": "Move this into you loading useEffect that way it does not happen on every re-render.  You can store the value in a setState variable by the same name.", "url": "https://github.com/phac-nml/irida/pull/789#discussion_r485553551", "createdAt": "2020-09-09T11:58:20Z", "author": {"login": "joshsadam"}, "path": "src/main/webapp/resources/js/contexts/AnalysisContext.js", "diffHunk": "@@ -51,12 +55,30 @@ const AnalysisContext = React.createContext(initialContext);\n \n function AnalysisProvider(props) {\n   const [analysisContext, setAnalysisContext] = useState(initialContext);\n+  const analysisIdentifier = window.location.pathname.match(/analysis\\/(\\d+)/)[1];", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8d63f91593b46a445bb918bea869f802e346b15f"}, "originalPosition": 56}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTcwMDU4Nw==", "bodyText": "Updated in 91b5b8f", "url": "https://github.com/phac-nml/irida/pull/789#discussion_r485700587", "createdAt": "2020-09-09T15:24:57Z", "author": {"login": "deepsidhu85"}, "path": "src/main/webapp/resources/js/contexts/AnalysisContext.js", "diffHunk": "@@ -51,12 +55,30 @@ const AnalysisContext = React.createContext(initialContext);\n \n function AnalysisProvider(props) {\n   const [analysisContext, setAnalysisContext] = useState(initialContext);\n+  const analysisIdentifier = window.location.pathname.match(/analysis\\/(\\d+)/)[1];", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTU1MzU1MQ=="}, "originalCommit": {"oid": "8d63f91593b46a445bb918bea869f802e346b15f"}, "originalPosition": 56}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 717, "cost": 1, "resetAt": "2021-11-12T12:57:47Z"}}}