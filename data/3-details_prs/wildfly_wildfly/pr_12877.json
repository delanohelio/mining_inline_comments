{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzU5Mzk1MzEx", "number": 12877, "title": "WFLY-4699 Expose EJB3 deployment information at runtime", "bodyText": "JIRA:\nhttps://issues.redhat.com/browse/WFLY-4699\nhttps://issues.redhat.com/browse/EAP7-435\nAnalysis Document for this RFE:\nwildfly/wildfly-proposals#271\nThis PR implements the above RFE to expose ejb deployment info as management runtime resources. These deployment info can come from ejb deployment descriptor and annotations. This PR includes implementation changes, tests, and community docs.", "createdAt": "2020-01-06T05:20:44Z", "url": "https://github.com/wildfly/wildfly/pull/12877", "merged": true, "mergeCommit": {"oid": "1ca9db50c10c5ed51759ed395b303058b981b53e"}, "closed": true, "closedAt": "2020-05-20T03:38:20Z", "author": {"login": "chengfang"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb6oXNAgFqTM0MzM2MjYzMA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABciiXTcAFqTQxMzc0OTc1Mg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQzMzYyNjMw", "url": "https://github.com/wildfly/wildfly/pull/12877#pullrequestreview-343362630", "createdAt": "2020-01-15T16:44:05Z", "commit": {"oid": "7a45266e0354e5f69f0cc29e8e3ade22b30d927e"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk2NTExODE1", "url": "https://github.com/wildfly/wildfly/pull/12877#pullrequestreview-396511815", "createdAt": "2020-04-20T14:33:14Z", "commit": {"oid": "7a45266e0354e5f69f0cc29e8e3ade22b30d927e"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMFQxNDozMzoxNVrOGIXkUQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMFQxNDozMzoxNVrOGIXkUQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTQyNzkyMQ==", "bodyText": "@chengfang I can't find tests related to Bean statistics (execution-time, invocations, methods, peak-concurrent-invocations and wait-time) for Message-driven Beans: I expected to find those tests in EjbInvocationStatisticsTestCase but it only covers SLSB, SFSB and Singletons; can you point me at them?", "url": "https://github.com/wildfly/wildfly/pull/12877#discussion_r411427921", "createdAt": "2020-04-20T14:33:15Z", "author": {"login": "tommaso-borgato"}, "path": "testsuite/integration/basic/src/test/java/org/jboss/as/test/integration/ejb/management/deployments/EjbJarRuntimeResourceTestBase.java", "diffHunk": "@@ -72,8 +75,36 @@\n     private static final String[] POOL_ATTRIBUTES =\n             {\"pool-available-count\", \"pool-create-count\", \"pool-current-size\", POOL_NAME, \"pool-max-size\", \"pool-remove-count\"};\n \n-    private static final String[] TIMER_ATTRIBUTES = { \"time-remaining\", \"next-timeout\", \"calendar-timer\"};\n-    private static final String[] SCHEDULE_ATTRIBUTES = { \"day-of-month\", \"day-of-week\", \"hour\", \"minute\", \"year\", \"timezone\", \"start\", \"end\" };\n+    private static final String[] TIMER_ATTRIBUTES = {\"time-remaining\", \"next-timeout\", \"calendar-timer\"};\n+    private static final String[] SCHEDULE_ATTRIBUTES = {\"day-of-month\", \"day-of-week\", \"hour\", \"minute\", \"year\", \"timezone\", \"start\", \"end\"};\n+\n+    private static final String JNDI_NAMES = \"jndi-names\";\n+    private static final String BUSINESS_LOCAL = \"business-local\";\n+    private static final String BUSINESS_REMOTE = \"business-remote\";\n+    private static final String TIMEOUT_METHOD = \"timeout-method\";\n+    private static final String ASYNC_METHODS = \"async-methods\";\n+    private static final String TRANSACTION_TYPE = \"transaction-type\";\n+\n+    // MDB specific resource names\n+    private static final String ACTIVATION_CONFIG = \"activation-config\";\n+    private static final String MESSAGING_TYPE = \"messaging-type\";\n+    private static final String MESSAGE_DESTINATION_TYPE = \"message-destination-type\";\n+    private static final String MESSAGE_DESTINATION_LINK = \"message-destination-link\";\n+\n+    // STATEFUL specific resource names\n+    private static final String STATEFUL_TIMEOUT = \"stateful-timeout\";\n+    private static final String AFTER_BEGIN_METHOD = \"after-begin-method\";\n+    private static final String BEFORE_COMPLETION_METHOD = \"before-completion-method\";\n+    private static final String AFTER_COMPLETION_METHOD = \"after-completion-method\";\n+    private static final String PASSIVATION_CAPABLE = \"passivation-capable\";\n+    private static final String REMOVE_METHODS = \"remove-methods\";\n+    private static final String RETAIN_IF_EXCEPTION = \"retain-if-exception\";\n+    private static final String BEAN_METHOD = \"bean-method\";\n+\n+    // SINGLETON specific resource names\n+    private static final String DEPENDS_ON = \"depends-on\";\n+    private static final String INIT_ON_STARTUP = \"init-on-startup\";\n+    private static final String CONCURRENCY_MANAGEMENT_TYPE = \"concurrency-management-type\";\n ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7a45266e0354e5f69f0cc29e8e3ade22b30d927e"}, "originalPosition": 61}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEyMjE5MjMw", "url": "https://github.com/wildfly/wildfly/pull/12877#pullrequestreview-412219230", "createdAt": "2020-05-14T22:07:08Z", "commit": {"oid": "7a45266e0354e5f69f0cc29e8e3ade22b30d927e"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNFQyMjowNzowOFrOGVv5jg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNFQyMjowNzowOFrOGVv5jg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTQ1ODA2Mg==", "bodyText": "@chengfang For all the various LIST attributes you should used one of the ListAttributeDefinition impls. My guess is all of them are essentially List of String, so use StringListAttributeDefinition. The pattern would be\nstatic final SimpleAttributeDefinition JNDI_NAMES = StringListAttributeDefinition.Builder.of(\"jndi-names\")     \n\nfollowed by what you've got now.\nThis results in the management API description having the correct 'value-type' as discussed in https://docs.wildfly.org/19.1/Admin_Guide.html#description-of-an-attribute", "url": "https://github.com/wildfly/wildfly/pull/12877#discussion_r425458062", "createdAt": "2020-05-14T22:07:08Z", "author": {"login": "bstansberry"}, "path": "ejb3/src/main/java/org/jboss/as/ejb3/subsystem/deployment/AbstractEJBComponentResourceDefinition.java", "diffHunk": "@@ -51,11 +51,35 @@\n  */\n public abstract class AbstractEJBComponentResourceDefinition extends SimpleResourceDefinition {\n \n-    public static final SimpleAttributeDefinition COMPONENT_CLASS_NAME = new SimpleAttributeDefinitionBuilder(\"component-class-name\", ModelType.STRING)\n+     static final SimpleAttributeDefinition COMPONENT_CLASS_NAME = new SimpleAttributeDefinitionBuilder(\"component-class-name\", ModelType.STRING)\n             .setValidator(new StringLengthValidator(1))\n             .setFlags(AttributeAccess.Flag.STORAGE_RUNTIME)\n             .build();\n \n+     static final SimpleAttributeDefinition JNDI_NAMES = new SimpleAttributeDefinitionBuilder(\"jndi-names\", ModelType.LIST)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7a45266e0354e5f69f0cc29e8e3ade22b30d927e"}, "originalPosition": 10}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c94d8cda065096ed38d209a92c5ad3eb33ee1bf2", "author": {"user": {"login": "chengfang", "name": "Cheng Fang"}}, "url": "https://github.com/wildfly/wildfly/commit/c94d8cda065096ed38d209a92c5ad3eb33ee1bf2", "committedDate": "2020-05-16T13:43:39Z", "message": "WFLY-4699 Expose EJB3 deployment information at runtime"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f75198e76a0a4b82267a5c3e0e87ee8c2316d8ba", "author": {"user": {"login": "chengfang", "name": "Cheng Fang"}}, "url": "https://github.com/wildfly/wildfly/commit/f75198e76a0a4b82267a5c3e0e87ee8c2316d8ba", "committedDate": "2020-05-17T13:43:49Z", "message": "WFLY-4699 Expose EJB3 deployment info (use StringListAttributeDefinition for list-type attributes)"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7a45266e0354e5f69f0cc29e8e3ade22b30d927e", "author": {"user": {"login": "chengfang", "name": "Cheng Fang"}}, "url": "https://github.com/wildfly/wildfly/commit/7a45266e0354e5f69f0cc29e8e3ade22b30d927e", "committedDate": "2020-01-06T05:12:56Z", "message": "WFLY-4699 Expose EJB3 deployment information at runtime"}, "afterCommit": {"oid": "f75198e76a0a4b82267a5c3e0e87ee8c2316d8ba", "author": {"user": {"login": "chengfang", "name": "Cheng Fang"}}, "url": "https://github.com/wildfly/wildfly/commit/f75198e76a0a4b82267a5c3e0e87ee8c2316d8ba", "committedDate": "2020-05-17T13:43:49Z", "message": "WFLY-4699 Expose EJB3 deployment info (use StringListAttributeDefinition for list-type attributes)"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEzNzQ5NzUy", "url": "https://github.com/wildfly/wildfly/pull/12877#pullrequestreview-413749752", "createdAt": "2020-05-18T16:21:44Z", "commit": {"oid": "f75198e76a0a4b82267a5c3e0e87ee8c2316d8ba"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3637, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}