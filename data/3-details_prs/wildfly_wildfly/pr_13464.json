{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY0MTA1NDM1", "number": 13464, "title": "WFLY-13521 Upgrade Infinispan to 11.0.3.Final", "bodyText": "https://issues.redhat.com/browse/WFLY-13521\nRequires #13495\nRequires #13498", "createdAt": "2020-08-06T15:37:22Z", "url": "https://github.com/wildfly/wildfly/pull/13464", "merged": true, "mergeCommit": {"oid": "8cf79da752b3d6d1ac82fa453d5a51807e84a2d2"}, "closed": true, "closedAt": "2020-08-22T01:05:08Z", "author": {"login": "pferraro"}, "timelineItems": {"totalCount": 15, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc86XGmABqjM2MzU3NjUyMTE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdBGR4JgBqjM2ODAwMjk5Mzg=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "2ce8962f27464ab67cd88cf5a7628215ab095c45", "author": {"user": {"login": "pferraro", "name": "Paul Ferraro"}}, "url": "https://github.com/wildfly/wildfly/commit/2ce8962f27464ab67cd88cf5a7628215ab095c45", "committedDate": "2020-08-06T14:47:18Z", "message": "WFLY-13521 Upgrade Infinispan to 11.0.3.Final"}, "afterCommit": {"oid": "251fbc36eb5bf881e7faace90bb66c88e0a888f2", "author": {"user": {"login": "pferraro", "name": "Paul Ferraro"}}, "url": "https://github.com/wildfly/wildfly/commit/251fbc36eb5bf881e7faace90bb66c88e0a888f2", "committedDate": "2020-08-08T15:01:08Z", "message": "WFLY-13521 Upgrade Infinispan to 11.0.3.Final"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "251fbc36eb5bf881e7faace90bb66c88e0a888f2", "author": {"user": {"login": "pferraro", "name": "Paul Ferraro"}}, "url": "https://github.com/wildfly/wildfly/commit/251fbc36eb5bf881e7faace90bb66c88e0a888f2", "committedDate": "2020-08-08T15:01:08Z", "message": "WFLY-13521 Upgrade Infinispan to 11.0.3.Final"}, "afterCommit": {"oid": "fbe9ed1266633617922433ab83b8203281d55dd8", "author": {"user": {"login": "pferraro", "name": "Paul Ferraro"}}, "url": "https://github.com/wildfly/wildfly/commit/fbe9ed1266633617922433ab83b8203281d55dd8", "committedDate": "2020-08-10T13:24:06Z", "message": "WFLY-13521 Upgrade Infinispan to 11.0.3.Final"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "fbe9ed1266633617922433ab83b8203281d55dd8", "author": {"user": {"login": "pferraro", "name": "Paul Ferraro"}}, "url": "https://github.com/wildfly/wildfly/commit/fbe9ed1266633617922433ab83b8203281d55dd8", "committedDate": "2020-08-10T13:24:06Z", "message": "WFLY-13521 Upgrade Infinispan to 11.0.3.Final"}, "afterCommit": {"oid": "e58ae007b9c1b516c2f3b62cfd1c9a332a4c5a9a", "author": {"user": {"login": "pferraro", "name": "Paul Ferraro"}}, "url": "https://github.com/wildfly/wildfly/commit/e58ae007b9c1b516c2f3b62cfd1c9a332a4c5a9a", "committedDate": "2020-08-10T16:34:20Z", "message": "WFLY-13521 Upgrade Infinispan to 11.0.3.Final"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e58ae007b9c1b516c2f3b62cfd1c9a332a4c5a9a", "author": {"user": {"login": "pferraro", "name": "Paul Ferraro"}}, "url": "https://github.com/wildfly/wildfly/commit/e58ae007b9c1b516c2f3b62cfd1c9a332a4c5a9a", "committedDate": "2020-08-10T16:34:20Z", "message": "WFLY-13521 Upgrade Infinispan to 11.0.3.Final"}, "afterCommit": {"oid": "38ae6957235ccc0960849682bb53592a38b35291", "author": {"user": {"login": "pferraro", "name": "Paul Ferraro"}}, "url": "https://github.com/wildfly/wildfly/commit/38ae6957235ccc0960849682bb53592a38b35291", "committedDate": "2020-08-10T16:35:54Z", "message": "WFLY-13521 Upgrade Infinispan to 11.0.3.Final"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "38ae6957235ccc0960849682bb53592a38b35291", "author": {"user": {"login": "pferraro", "name": "Paul Ferraro"}}, "url": "https://github.com/wildfly/wildfly/commit/38ae6957235ccc0960849682bb53592a38b35291", "committedDate": "2020-08-10T16:35:54Z", "message": "WFLY-13521 Upgrade Infinispan to 11.0.3.Final"}, "afterCommit": {"oid": "681eb8f0792007c23db363b66dd3d5a64e359331", "author": {"user": {"login": "pferraro", "name": "Paul Ferraro"}}, "url": "https://github.com/wildfly/wildfly/commit/681eb8f0792007c23db363b66dd3d5a64e359331", "committedDate": "2020-08-11T13:53:18Z", "message": "WFLY-13521 Upgrade Infinispan to 11.0.3.Final"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "681eb8f0792007c23db363b66dd3d5a64e359331", "author": {"user": {"login": "pferraro", "name": "Paul Ferraro"}}, "url": "https://github.com/wildfly/wildfly/commit/681eb8f0792007c23db363b66dd3d5a64e359331", "committedDate": "2020-08-11T13:53:18Z", "message": "WFLY-13521 Upgrade Infinispan to 11.0.3.Final"}, "afterCommit": {"oid": "7e362d12aefc0c7f34be2635d80837d6205bf7f1", "author": {"user": {"login": "pferraro", "name": "Paul Ferraro"}}, "url": "https://github.com/wildfly/wildfly/commit/7e362d12aefc0c7f34be2635d80837d6205bf7f1", "committedDate": "2020-08-12T13:45:55Z", "message": "WFLY-13521 Upgrade Infinispan to 11.0.3.Final"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY2MDE1OTIw", "url": "https://github.com/wildfly/wildfly/pull/13464#pullrequestreview-466015920", "createdAt": "2020-08-12T15:14:14Z", "commit": {"oid": "7e362d12aefc0c7f34be2635d80837d6205bf7f1"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMlQxNToxNDoxNFrOG_l9Uw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMlQxNToxNDoxNFrOG_l9Uw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTMzNTM3OQ==", "bodyText": "Looks like this can be gone?", "url": "https://github.com/wildfly/wildfly/pull/13464#discussion_r469335379", "createdAt": "2020-08-12T15:14:14Z", "author": {"login": "rhusar"}, "path": "clustering/infinispan/extension/src/main/java/org/jboss/as/clustering/infinispan/subsystem/OffHeapMemoryResourceDefinition.java", "diffHunk": "@@ -62,24 +102,101 @@\n         public AttributeDefinition getDefinition() {\n             return this.definition;\n         }\n+\n+        @Override\n+        public SimpleAttributeDefinitionBuilder apply(SimpleAttributeDefinitionBuilder builder) {\n+            return builder;\n+        }\n     }\n \n     static void buildTransformation(ModelVersion version, ResourceTransformationDescriptionBuilder parent) {\n         if (InfinispanModel.VERSION_6_0_0.requiresTransformation(version)) {\n             parent.rejectChildResource(PATH);\n+        } else {\n+            ResourceTransformationDescriptionBuilder builder = parent.addChildResource(PATH);\n+            // We cannot convert these size values - as there is not guarantee that such a converter would run before the sizeUnitConverter\n+            for (MemorySizeUnit unit : EnumSet.complementOf(EnumSet.of(MemorySizeUnit.ENTRIES, MemorySizeUnit.BYTES))) {\n+                builder.getAttributeBuilder().addRejectCheck(new RejectAttributeChecker.SimpleRejectAttributeChecker(new ModelNode(unit.name())), Attribute.SIZE_UNIT.getName());\n+            }\n+            SimpleAttributeConverter.Converter sizeUnitConverter = new SimpleAttributeConverter.Converter() {\n+                @SuppressWarnings(\"deprecation\")\n+                @Override\n+                public void convert(PathAddress address, String name, ModelNode value, ModelNode model, TransformationContext context) {\n+                    if (value.isDefined()) {\n+                        MemorySizeUnit unit = MemorySizeUnit.valueOf(value.asString());\n+                        if (unit == MemorySizeUnit.ENTRIES) {\n+                            value.clear();\n+                        } else {\n+                            value.set(org.infinispan.eviction.EvictionType.MEMORY.name());\n+                        }\n+                        //value.set((unit == MemorySizeUnit.ENTRIES ? org.infinispan.eviction.EvictionType.COUNT : org.infinispan.eviction.EvictionType.MEMORY).name());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7e362d12aefc0c7f34be2635d80837d6205bf7f1"}, "originalPosition": 99}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7e362d12aefc0c7f34be2635d80837d6205bf7f1", "author": {"user": {"login": "pferraro", "name": "Paul Ferraro"}}, "url": "https://github.com/wildfly/wildfly/commit/7e362d12aefc0c7f34be2635d80837d6205bf7f1", "committedDate": "2020-08-12T13:45:55Z", "message": "WFLY-13521 Upgrade Infinispan to 11.0.3.Final"}, "afterCommit": {"oid": "099625b359a668efa420f3f055de39ae4ec7db63", "author": {"user": {"login": "pferraro", "name": "Paul Ferraro"}}, "url": "https://github.com/wildfly/wildfly/commit/099625b359a668efa420f3f055de39ae4ec7db63", "committedDate": "2020-08-20T15:36:00Z", "message": "WFLY-13786 DistributableSessionManager.getSession(...) should not propagate exceptions"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDcyMDE0MTQx", "url": "https://github.com/wildfly/wildfly/pull/13464#pullrequestreview-472014141", "createdAt": "2020-08-20T21:57:53Z", "commit": {"oid": "099625b359a668efa420f3f055de39ae4ec7db63"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "099625b359a668efa420f3f055de39ae4ec7db63", "author": {"user": {"login": "pferraro", "name": "Paul Ferraro"}}, "url": "https://github.com/wildfly/wildfly/commit/099625b359a668efa420f3f055de39ae4ec7db63", "committedDate": "2020-08-20T15:36:00Z", "message": "WFLY-13786 DistributableSessionManager.getSession(...) should not propagate exceptions"}, "afterCommit": {"oid": "336d49cb7d078094e24fbb6f8d8423f8ac17d0c1", "author": {"user": {"login": "pferraro", "name": "Paul Ferraro"}}, "url": "https://github.com/wildfly/wildfly/commit/336d49cb7d078094e24fbb6f8d8423f8ac17d0c1", "committedDate": "2020-08-21T13:03:09Z", "message": "WFLY-13521 Upgrade Infinispan to 11.0.3.Final"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "336d49cb7d078094e24fbb6f8d8423f8ac17d0c1", "author": {"user": {"login": "pferraro", "name": "Paul Ferraro"}}, "url": "https://github.com/wildfly/wildfly/commit/336d49cb7d078094e24fbb6f8d8423f8ac17d0c1", "committedDate": "2020-08-21T13:03:09Z", "message": "WFLY-13521 Upgrade Infinispan to 11.0.3.Final"}, "afterCommit": {"oid": "329c5f07f91f5e542e09ea454e34dd9db5792d93", "author": {"user": {"login": "pferraro", "name": "Paul Ferraro"}}, "url": "https://github.com/wildfly/wildfly/commit/329c5f07f91f5e542e09ea454e34dd9db5792d93", "committedDate": "2020-08-21T13:13:12Z", "message": "WFLY-13521 Upgrade Infinispan to 11.0.3.Final"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b9f784cfa885b407808ec1690471d160888b1379", "author": {"user": {"login": "pferraro", "name": "Paul Ferraro"}}, "url": "https://github.com/wildfly/wildfly/commit/b9f784cfa885b407808ec1690471d160888b1379", "committedDate": "2020-08-21T15:03:41Z", "message": "Add Infinispan subsystem model version 13.0.0"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b907f1920e30be2cc948c2e2db3f95ab3ca1a4d6", "author": {"user": {"login": "pferraro", "name": "Paul Ferraro"}}, "url": "https://github.com/wildfly/wildfly/commit/b907f1920e30be2cc948c2e2db3f95ab3ca1a4d6", "committedDate": "2020-08-21T15:03:41Z", "message": "Infinispan subsystem schema version 11.0."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a473ac10f59aaf6906ca6d6bbde86354d4cc8379", "author": {"user": {"login": "pferraro", "name": "Paul Ferraro"}}, "url": "https://github.com/wildfly/wildfly/commit/a473ac10f59aaf6906ca6d6bbde86354d4cc8379", "committedDate": "2020-08-21T15:09:48Z", "message": "WFLY-13521 Upgrade Infinispan to 11.0.3.Final"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "329c5f07f91f5e542e09ea454e34dd9db5792d93", "author": {"user": {"login": "pferraro", "name": "Paul Ferraro"}}, "url": "https://github.com/wildfly/wildfly/commit/329c5f07f91f5e542e09ea454e34dd9db5792d93", "committedDate": "2020-08-21T13:13:12Z", "message": "WFLY-13521 Upgrade Infinispan to 11.0.3.Final"}, "afterCommit": {"oid": "a473ac10f59aaf6906ca6d6bbde86354d4cc8379", "author": {"user": {"login": "pferraro", "name": "Paul Ferraro"}}, "url": "https://github.com/wildfly/wildfly/commit/a473ac10f59aaf6906ca6d6bbde86354d4cc8379", "committedDate": "2020-08-21T15:09:48Z", "message": "WFLY-13521 Upgrade Infinispan to 11.0.3.Final"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3950, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}