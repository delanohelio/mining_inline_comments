{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDI4MTQ1MDg0", "number": 13353, "title": "WFLY-13557 Clustering TS: Support for test execution parallelization \u2026", "bodyText": "Resolves\nhttps://issues.redhat.com/browse/WFLY-13557\nhttps://issues.redhat.com/browse/WFLY-13563\nhttps://issues.redhat.com/browse/WFLY-13564", "createdAt": "2020-06-04T23:43:45Z", "url": "https://github.com/wildfly/wildfly/pull/13353", "merged": true, "mergeCommit": {"oid": "c2a1064f6b13fa712433de981bfd45e68f21d401"}, "closed": true, "closedAt": "2020-06-16T09:21:00Z", "author": {"login": "rhusar"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcoPGbZgH2gAyNDI4MTQ1MDg0OmJkMzM1OTFmYzFmOTRiODVkZmExMGViNGVlZDI5MzI1YWI5OWM3Yjc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABco9rhcAFqTQyNTgzMDQ4MA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "bd33591fc1f94b85dfa10eb4eed29325ab99c7b7", "author": {"user": {"login": "rhusar", "name": "Radoslav Husar"}}, "url": "https://github.com/wildfly/wildfly/commit/bd33591fc1f94b85dfa10eb4eed29325ab99c7b7", "committedDate": "2020-06-05T09:18:39Z", "message": "WFLY-13557 Clustering TS: Support for test execution parallelization on multiple test runners\nWFLY-13563 Clustering TS: All clustering tests need not run on full-ha server profile\nWFLY-13564 Clustering TS: Running a single test with -Dtest= can only be used with main tests"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "5a0737386ea64e767442b0bfb8429b67818cf86c", "author": {"user": {"login": "rhusar", "name": "Radoslav Husar"}}, "url": "https://github.com/wildfly/wildfly/commit/5a0737386ea64e767442b0bfb8429b67818cf86c", "committedDate": "2020-06-04T23:42:42Z", "message": "WFLY-13557 Clustering TS: Support for test execution parallelization on multiple test runners\nWFLY-13563 Clustering TS: All clustering tests need not run on full-ha server profile\nWFLY-13564 Clustering TS: Running a single test with -Dtest= can only be used with main tests"}, "afterCommit": {"oid": "bd33591fc1f94b85dfa10eb4eed29325ab99c7b7", "author": {"user": {"login": "rhusar", "name": "Radoslav Husar"}}, "url": "https://github.com/wildfly/wildfly/commit/bd33591fc1f94b85dfa10eb4eed29325ab99c7b7", "committedDate": "2020-06-05T09:18:39Z", "message": "WFLY-13557 Clustering TS: Support for test execution parallelization on multiple test runners\nWFLY-13563 Clustering TS: All clustering tests need not run on full-ha server profile\nWFLY-13564 Clustering TS: Running a single test with -Dtest= can only be used with main tests"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI1MjA2MTgx", "url": "https://github.com/wildfly/wildfly/pull/13353#pullrequestreview-425206181", "createdAt": "2020-06-05T11:09:11Z", "commit": {"oid": "bd33591fc1f94b85dfa10eb4eed29325ab99c7b7"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNVQxMTowOToxMVrOGfqRbQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNVQxMTowOToxMVrOGfqRbQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTg1MTYyOQ==", "bodyText": "@kabir This is the section that would interest you.", "url": "https://github.com/wildfly/wildfly/pull/13353#discussion_r435851629", "createdAt": "2020-06-05T11:09:11Z", "author": {"login": "rhusar"}, "path": "docs/src/main/asciidoc/_testsuite/WildFly_Testsuite_Overview.adoc", "diffHunk": "@@ -119,16 +120,79 @@ Divided into three Surefire executions:\n * Third with web profile, but needs to be run after server restart to\n check whether persistent data are really persisted.\n \n-[[cluster--dts.clust]]\n-=== Cluster -Dts.clust\n+[[cluster--dts.clustering]]\n+=== Clustering `-Dts.clustering`\n+\n+Contains all tests relating to clustering aspects of the application server, such as:\n+\n+* web session clustering,\n+* ejb session clustering,\n+* command dispatcher,\n+* web session affinity handling,\n+* and other areas.\n+\n+Tests should leverage shared testing logic by extending `org.jboss.as.test.clustering.cluster.AbstractClusteringTestCase`.\n+The test case contract is that before executing the test method, all specified servers are started and all specified\n+deployments are deployed. This allows Arquillian resource injection into the test case.\n+\n+There are four WildFly server instances, one load-balancer (Undertow) and one datagrid (Infinispan server) available\n+for the tests.\n+\n+==== Maven profiles and Parallelization\n+\n+There are maven profiles that might come in handy for testing:\n+\n+* `ts.clustering.common.profile` prepares server configurations used by test execution profiles\n+* `ts.clustering.cluster.ha.profile` runs tests against `standalone-ha.xml` profile\n+* `ts.clustering.cluster.fullha.profile` runs tests which require `standalone-full-ha.xml` profile; e.g. tests requiring JMS subsystem\n+* `ts.clustering.single.profile` runs clustering tests that are using a non-HA server profile\n+* `ts.clustering.byteman.profile` runs clustering tests that require installation of byteman rules\n+\n+For instance, to only run tests that run against full-ha profile, activate clustering tests with `-Dts.clustering` and exclude\n+the other profiles with `-P`:\n+\n+    $ ./integration-tests.sh clean install -Dts.noSmoke -Dts.clustering -P \\!ts.clustering.cluster.ha.profile,\\!ts.clustering.single.profile,\\!ts.clustering.byteman.profile\n+\n+If the testsuite can be run on multiple runners in parallel, the main execution (which takes the majority of the execution time)\n+can be split by packages using `-Dts.surefire.clustering.ha.additionalExcludes` property.\n+This property feeds a regular expression to exclude sub-packages of the `org.jboss.as.test.clustering.cluster` package.\n+The sub-packages at the time of writing are `affinity`, `cdi`, `dispatcher`, `ejb`, `ejb2`, `group`, `jms`, `jpa`,\n+`jsf`, `provider`, `registry`, `singleton`, `sso`, `web`, and `xsite`.\n+For instance, to parallelize testsuite execution on two machines (e.g. when using GitHub actions scripting or alike) the following commands\n+could be used to split the clustering tests into two executions of similar execution time, the first node can run the first half of the tests in sub-packages, e.g.:\n \n-Sets up a cluster of two nodes.\n+    $ ./integration-tests.sh clean install -Dts.noSmoke -Dts.clustering -P \\!ts.clustering.cluster.fullha.profile,\\!ts.clustering.single.profile,\\!ts.clustering.byteman.profile -Dts.surefire.clustering.ha.additionalExcludes=affinity\\|cdi\\|dispatcher\\|ejb\\|ejb2\\|group\\|jms\\|jpa\n+\n+while another node can concurrently run all the other profiles and the other half of sub-packages:\n+\n+    $ ./integration-tests.sh clean install -Dts.noSmoke -Dts.clustering -Dts.surefire.clustering.ha.additionalExcludes=jsf\\|provider\\|registry\\|singleton\\|sso\\|web\\|xsite\n+\n+If the test packages get out of sync with the excludes this will result in a test running multiple times, rather than tests being omitted.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bd33591fc1f94b85dfa10eb4eed29325ab99c7b7"}, "originalPosition": 149}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI1ODMwNDgw", "url": "https://github.com/wildfly/wildfly/pull/13353#pullrequestreview-425830480", "createdAt": "2020-06-07T15:34:48Z", "commit": {"oid": "bd33591fc1f94b85dfa10eb4eed29325ab99c7b7"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4003, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}