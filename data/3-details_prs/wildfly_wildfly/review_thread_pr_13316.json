{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDIxMjQ0NjY1", "number": 13316, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOFQyMToxNDowM1rOEDoSAg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOFQyMToxNDowM1rOEDoSAg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcyMjQxMTU0OnYy", "diffSide": "RIGHT", "path": "ejb3/src/main/java/org/jboss/as/ejb3/deployment/processors/EJBClientDescriptorMetaDataProcessor.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOFQyMToxNDowM1rOGgwppg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOVQxMjozOTo1NFrOGhHjeg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzAwNDcxMA==", "bodyText": "Is this validation necessary?  This isn't a management model consistency check, where we need to fail in Stage.MODEL if something is wrong. This is runtime stuff. If the reference is invalid won't MSC report the service wiring failure? I'm reluctant to start adding additional validation. It has the potential to produce nicer failures (although a \"missing capability\" message isn't particularly nicer than a \"missing service\" message) but it's either going to end up being done in a few random spots or it will be a very large addition of potentially fragile code.", "url": "https://github.com/wildfly/wildfly/pull/13316#discussion_r437004710", "createdAt": "2020-06-08T21:14:03Z", "author": {"login": "bstansberry"}, "path": "ejb3/src/main/java/org/jboss/as/ejb3/deployment/processors/EJBClientDescriptorMetaDataProcessor.java", "diffHunk": "@@ -133,6 +136,19 @@ public void deploy(DeploymentPhaseContext phaseContext) throws DeploymentUnitPro\n         if (ejbClientDescriptorMetaData == null && ! interceptorsDefined) {\n             return;\n         }\n+\n+        final CapabilityServiceSupport support = deploymentUnit.getAttachment(org.jboss.as.server.deployment.Attachments.CAPABILITY_SERVICE_SUPPORT);\n+        if (ejbClientDescriptorMetaData != null && ejbClientDescriptorMetaData.getProfile() == null) {\n+                for (EJBClientDescriptorMetaData.RemotingReceiverConfiguration receiverConfiguration : ejbClientDescriptorMetaData.getRemotingReceiverConfigurations()) {\n+                    final String requiredCap = RuntimeCapability.buildDynamicCapabilityName(OUTBOUND_CONNECTION_CAPABILITY_NAME, receiverConfiguration.getOutboundConnectionRef());\n+                    if (!support.hasCapability(requiredCap)) {\n+                        throw EjbLogger.DEPLOYMENT_LOGGER.deploymentRequiresCapability(\n+                                deploymentUnit.getName(),\n+                                requiredCap);\n+                    }\n+            }\n+        }\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9837d374293e44e01e3e3a0bf5fdcb3f746d685a"}, "originalPosition": 42}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzM3OTk2Mg==", "bodyText": "It is unnecessary, the intention was fail as soon as possible with a nicer message.\nI agree on your points so I'll remove this and let the missing service message in case a user runs into this situation.", "url": "https://github.com/wildfly/wildfly/pull/13316#discussion_r437379962", "createdAt": "2020-06-09T12:39:54Z", "author": {"login": "yersan"}, "path": "ejb3/src/main/java/org/jboss/as/ejb3/deployment/processors/EJBClientDescriptorMetaDataProcessor.java", "diffHunk": "@@ -133,6 +136,19 @@ public void deploy(DeploymentPhaseContext phaseContext) throws DeploymentUnitPro\n         if (ejbClientDescriptorMetaData == null && ! interceptorsDefined) {\n             return;\n         }\n+\n+        final CapabilityServiceSupport support = deploymentUnit.getAttachment(org.jboss.as.server.deployment.Attachments.CAPABILITY_SERVICE_SUPPORT);\n+        if (ejbClientDescriptorMetaData != null && ejbClientDescriptorMetaData.getProfile() == null) {\n+                for (EJBClientDescriptorMetaData.RemotingReceiverConfiguration receiverConfiguration : ejbClientDescriptorMetaData.getRemotingReceiverConfigurations()) {\n+                    final String requiredCap = RuntimeCapability.buildDynamicCapabilityName(OUTBOUND_CONNECTION_CAPABILITY_NAME, receiverConfiguration.getOutboundConnectionRef());\n+                    if (!support.hasCapability(requiredCap)) {\n+                        throw EjbLogger.DEPLOYMENT_LOGGER.deploymentRequiresCapability(\n+                                deploymentUnit.getName(),\n+                                requiredCap);\n+                    }\n+            }\n+        }\n+", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzAwNDcxMA=="}, "originalCommit": {"oid": "9837d374293e44e01e3e3a0bf5fdcb3f746d685a"}, "originalPosition": 42}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4268, "cost": 1, "resetAt": "2021-11-13T14:23:39Z"}}}