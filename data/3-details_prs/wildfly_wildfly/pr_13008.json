{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc2NTUzMzE3", "number": 13008, "title": "[WFLY-13065] Options for reverse-proxy max-request-time and connection-idle-timeout are specified as seconds", "bodyText": "Fix for https://issues.redhat.com/browse/WFLY-13065. Comments:\n\nIt requires a bump for undertow xml version to 11 (I have cloned the changes previously done in 10).\nThe only difference in the XML is that all the default values for the reverse-proxy-handlerType have been added.\nTest added to check the max-request-time with a very low value and check the connection is aborted (503 returned).\nI have also changed the creation of the ProxyHandler to use the builder (to avoid the deprecated warning). Here there are two values (rewrite-host-header and reuse-x-forwarded) that could also be added to the wildfly configuration (now they are always false). Just in case you want to use the same bump for them.\n\nNo hurry with this one. It's a minor thing and the bump complicates it a bit.", "createdAt": "2020-02-18T11:04:42Z", "url": "https://github.com/wildfly/wildfly/pull/13008", "merged": true, "mergeCommit": {"oid": "fb5d98c3a5f235a06cb8b929b0f567a92400511a"}, "closed": true, "closedAt": "2020-08-10T00:24:43Z", "author": {"login": "rmartinc"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcjD4SvABqjMzNTUwNjg5NTQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc8pXVaAFqTQ2MzU1Mjc1Nw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "544b4e62156150f103d7008631223aafabd67fb9", "author": {"user": {"login": "rmartinc", "name": null}}, "url": "https://github.com/wildfly/wildfly/commit/544b4e62156150f103d7008631223aafabd67fb9", "committedDate": "2020-02-18T10:42:18Z", "message": "[WFLY-13065] Options for reverse-proxy max-request-time and connection-idle-timeout are specified as seconds"}, "afterCommit": {"oid": "4cef9c79267d2d3573193f1f6efb3e3857561813", "author": {"user": {"login": "rmartinc", "name": null}}, "url": "https://github.com/wildfly/wildfly/commit/4cef9c79267d2d3573193f1f6efb3e3857561813", "committedDate": "2020-05-20T07:13:55Z", "message": "[WFLY-13065] Options for reverse-proxy max-request-time and connection-idle-timeout are specified as seconds"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE1MjgyNjA4", "url": "https://github.com/wildfly/wildfly/pull/13008#pullrequestreview-415282608", "createdAt": "2020-05-20T12:30:26Z", "commit": {"oid": "4cef9c79267d2d3573193f1f6efb3e3857561813"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE1MjkwNTg3", "url": "https://github.com/wildfly/wildfly/pull/13008#pullrequestreview-415290587", "createdAt": "2020-05-20T12:41:18Z", "commit": {"oid": "4cef9c79267d2d3573193f1f6efb3e3857561813"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMFQxMjo0MToxOFrOGYJnVA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMFQxMjo0MToxOFrOGYJnVA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzk3NjUzMg==", "bodyText": "We need a transformer to deal with this one. If this isn't configured a server running the current version will use 60000 and one running a previous version will us 60. The servers should be consistent, so the transformer would explicitly tell the legacy server to use 60000.\nUnfortunately \"Attribute has a different default value\" at https://docs.wildfly.org/19.1/Extending_WildFly.html#common-transformation-use-cases doesn't explicitly illustrate how to do this", "url": "https://github.com/wildfly/wildfly/pull/13008#discussion_r427976532", "createdAt": "2020-05-20T12:41:18Z", "author": {"login": "bstansberry"}, "path": "undertow/src/main/java/org/wildfly/extension/undertow/handlers/ReverseProxyHandler.java", "diffHunk": "@@ -95,8 +96,8 @@\n     public static final AttributeDefinition CONNECTION_IDLE_TIMEOUT = new SimpleAttributeDefinitionBuilder(Constants.CONNECTION_IDLE_TIMEOUT, ModelType.INT)\n             .setRequired(false)\n             .setAllowExpression(true)\n-            .setDefaultValue(new ModelNode(60L))\n-            .setMeasurementUnit(MeasurementUnit.SECONDS)\n+            .setDefaultValue(new ModelNode(60000))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4cef9c79267d2d3573193f1f6efb3e3857561813"}, "originalPosition": 23}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "757e380760103ef65c4e5574891c559c3ee2100f", "author": {"user": {"login": "rmartinc", "name": null}}, "url": "https://github.com/wildfly/wildfly/commit/757e380760103ef65c4e5574891c559c3ee2100f", "committedDate": "2020-05-20T17:57:50Z", "message": "[WFLY-13065] Options for reverse-proxy max-request-time and connection-idle-timeout are specified as seconds"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4cef9c79267d2d3573193f1f6efb3e3857561813", "author": {"user": {"login": "rmartinc", "name": null}}, "url": "https://github.com/wildfly/wildfly/commit/4cef9c79267d2d3573193f1f6efb3e3857561813", "committedDate": "2020-05-20T07:13:55Z", "message": "[WFLY-13065] Options for reverse-proxy max-request-time and connection-idle-timeout are specified as seconds"}, "afterCommit": {"oid": "757e380760103ef65c4e5574891c559c3ee2100f", "author": {"user": {"login": "rmartinc", "name": null}}, "url": "https://github.com/wildfly/wildfly/commit/757e380760103ef65c4e5574891c559c3ee2100f", "committedDate": "2020-05-20T17:57:50Z", "message": "[WFLY-13065] Options for reverse-proxy max-request-time and connection-idle-timeout are specified as seconds"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYzNTUyNzU3", "url": "https://github.com/wildfly/wildfly/pull/13008#pullrequestreview-463552757", "createdAt": "2020-08-07T19:13:08Z", "commit": {"oid": "757e380760103ef65c4e5574891c559c3ee2100f"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3614, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}