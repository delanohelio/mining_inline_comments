{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk3NzIwOTU5", "number": 13170, "title": "[WFLY-13334]:  MP Opentracing tests are not passing with a SecurityMa\u2026", "bodyText": "\u2026nager\n\nAdding the missing permissions\n\nJira: https://issues.redhat.com/browse/WFLY-13334", "createdAt": "2020-04-02T17:35:37Z", "url": "https://github.com/wildfly/wildfly/pull/13170", "merged": true, "mergeCommit": {"oid": "a1bd6c3139b4ef6fd3df7f9f9e90bba6f908c8fd"}, "closed": true, "closedAt": "2020-04-03T18:28:50Z", "author": {"login": "ehsavoie"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcTwEDlgFqTM4NjY2MTQzMw==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcUAHeeABqjMxOTYxOTk4MzU=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg2NjYxNDMz", "url": "https://github.com/wildfly/wildfly/pull/13170#pullrequestreview-386661433", "createdAt": "2020-04-02T17:50:31Z", "commit": {"oid": "928e4841536de648da6c2cff6dcb28a7e5693578"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg2ODQwNDc2", "url": "https://github.com/wildfly/wildfly/pull/13170#pullrequestreview-386840476", "createdAt": "2020-04-02T23:13:10Z", "commit": {"oid": "928e4841536de648da6c2cff6dcb28a7e5693578"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMlQyMzoxMzoxMFrOF__uUA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMlQyMzoxMzoxMFrOF__uUA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjY0ODY1Ng==", "bodyText": "This could just be TRACERS.get(WildFlySecurityManager.getCurrentContextClassLoader())", "url": "https://github.com/wildfly/wildfly/pull/13170#discussion_r402648656", "createdAt": "2020-04-02T23:13:10Z", "author": {"login": "jamezp"}, "path": "microprofile/opentracing-smallrye/src/main/java/org/wildfly/microprofile/opentracing/smallrye/TracingCDIExtension.java", "diffHunk": "@@ -42,7 +45,18 @@ public static void registerApplicationTracer(ClassLoader classLoader, Tracer tra\n \n     public void registerTracerBean(@Observes AfterBeanDiscovery abd) {\n         abd.addBean().addTransitiveTypeClosure(Tracer.class).produceWith(i -> {\n-            return TRACERS.get(Thread.currentThread().getContextClassLoader());\n+            ClassLoader loader;\n+            if (!WildFlySecurityManager.isChecking()) {\n+                loader = Thread.currentThread().getContextClassLoader();\n+            } else {\n+                loader = AccessController.doPrivileged(new PrivilegedAction<ClassLoader>() {\n+                    @Override\n+                    public ClassLoader run() {\n+                        return Thread.currentThread().getContextClassLoader();\n+                    }\n+                });\n+            }\n+            return TRACERS.get(loader);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "928e4841536de648da6c2cff6dcb28a7e5693578"}, "originalPosition": 33}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "928e4841536de648da6c2cff6dcb28a7e5693578", "author": {"user": {"login": "ehsavoie", "name": "Emmanuel Hugonnet"}}, "url": "https://github.com/wildfly/wildfly/commit/928e4841536de648da6c2cff6dcb28a7e5693578", "committedDate": "2020-04-02T17:34:32Z", "message": "[WFLY-13334]:  MP Opentracing tests are not passing with a SecurityManager\n\n * Adding the missing permissions\n\nJira: https://issues.redhat.com/browse/WFLY-13334"}, "afterCommit": {"oid": "d33cd9c5d265d1b3a9232caa1393b2b11e7e4398", "author": {"user": {"login": "ehsavoie", "name": "Emmanuel Hugonnet"}}, "url": "https://github.com/wildfly/wildfly/commit/d33cd9c5d265d1b3a9232caa1393b2b11e7e4398", "committedDate": "2020-04-02T20:27:22Z", "message": "[WFLY-13334]: MP Opentracing tests are not passing with a SecurityManager\n\n* Adding the missing privileged actions.\n\nJira: https://issues.redhat.com/browse/WFLY-13334"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg3MDMyNjQx", "url": "https://github.com/wildfly/wildfly/pull/13170#pullrequestreview-387032641", "createdAt": "2020-04-03T07:52:19Z", "commit": {"oid": "d33cd9c5d265d1b3a9232caa1393b2b11e7e4398"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wM1QwNzo1MjoxOVrOGAI6fA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wM1QwNzo1MzozMVrOGAI91g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjc5OTIyOA==", "bodyText": "This entire block can be removed and instead just call WildFlySecurityManager.getCurrentContextClassLoaderPrivileged()", "url": "https://github.com/wildfly/wildfly/pull/13170#discussion_r402799228", "createdAt": "2020-04-03T07:52:19Z", "author": {"login": "darranl"}, "path": "microprofile/opentracing-smallrye/src/main/java/org/wildfly/microprofile/opentracing/smallrye/TracingCDIExtension.java", "diffHunk": "@@ -42,7 +45,18 @@ public static void registerApplicationTracer(ClassLoader classLoader, Tracer tra\n \n     public void registerTracerBean(@Observes AfterBeanDiscovery abd) {\n         abd.addBean().addTransitiveTypeClosure(Tracer.class).produceWith(i -> {\n-            return TRACERS.get(Thread.currentThread().getContextClassLoader());\n+            ClassLoader loader;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d33cd9c5d265d1b3a9232caa1393b2b11e7e4398"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjgwMDA4Ng==", "bodyText": "This entire block can be removed and instead just call WildFlySecurityManager.getCurrentContextClassLoaderPrivileged()\nAdditionally with this current approach two new classes needed to be defined and loaded to achieve a common task.", "url": "https://github.com/wildfly/wildfly/pull/13170#discussion_r402800086", "createdAt": "2020-04-03T07:53:31Z", "author": {"login": "darranl"}, "path": "microprofile/opentracing-smallrye/src/main/java/org/wildfly/microprofile/opentracing/smallrye/TracingCDIExtension.java", "diffHunk": "@@ -57,6 +71,17 @@ public void skipTracerBeans(@Observes ProcessAnnotatedType<? extends Tracer> pro\n      * @param bs\n      */\n     public void beforeShutdown(@Observes final BeforeShutdown bs) {\n-        TRACERS.remove(Thread.currentThread().getContextClassLoader());\n+        ClassLoader loader;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d33cd9c5d265d1b3a9232caa1393b2b11e7e4398"}, "originalPosition": 42}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d33cd9c5d265d1b3a9232caa1393b2b11e7e4398", "author": {"user": {"login": "ehsavoie", "name": "Emmanuel Hugonnet"}}, "url": "https://github.com/wildfly/wildfly/commit/d33cd9c5d265d1b3a9232caa1393b2b11e7e4398", "committedDate": "2020-04-02T20:27:22Z", "message": "[WFLY-13334]: MP Opentracing tests are not passing with a SecurityManager\n\n* Adding the missing privileged actions.\n\nJira: https://issues.redhat.com/browse/WFLY-13334"}, "afterCommit": {"oid": "5b82c18f79615fa96a7ea583944d924f036c7881", "author": {"user": {"login": "ehsavoie", "name": "Emmanuel Hugonnet"}}, "url": "https://github.com/wildfly/wildfly/commit/5b82c18f79615fa96a7ea583944d924f036c7881", "committedDate": "2020-04-03T08:01:11Z", "message": "[WFLY-13334]: MP Opentracing tests are not passing with a SecurityManager\n\n* Adding the missing privileged actions.\n\nJira: https://issues.redhat.com/browse/WFLY-13334"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg3MDQxNjE5", "url": "https://github.com/wildfly/wildfly/pull/13170#pullrequestreview-387041619", "createdAt": "2020-04-03T08:06:31Z", "commit": {"oid": "5b82c18f79615fa96a7ea583944d924f036c7881"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "03ad32427081e373263b3eee7ce9a130f53b7cb5", "author": {"user": {"login": "ehsavoie", "name": "Emmanuel Hugonnet"}}, "url": "https://github.com/wildfly/wildfly/commit/03ad32427081e373263b3eee7ce9a130f53b7cb5", "committedDate": "2020-04-03T12:32:28Z", "message": "[WFLY-13334]: MP Opentracing tests are not passing with a SecurityManager\n\n* Adding the missing privileged actions.\n\nJira: https://issues.redhat.com/browse/WFLY-13334"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "5b82c18f79615fa96a7ea583944d924f036c7881", "author": {"user": {"login": "ehsavoie", "name": "Emmanuel Hugonnet"}}, "url": "https://github.com/wildfly/wildfly/commit/5b82c18f79615fa96a7ea583944d924f036c7881", "committedDate": "2020-04-03T08:01:11Z", "message": "[WFLY-13334]: MP Opentracing tests are not passing with a SecurityManager\n\n* Adding the missing privileged actions.\n\nJira: https://issues.redhat.com/browse/WFLY-13334"}, "afterCommit": {"oid": "03ad32427081e373263b3eee7ce9a130f53b7cb5", "author": {"user": {"login": "ehsavoie", "name": "Emmanuel Hugonnet"}}, "url": "https://github.com/wildfly/wildfly/commit/03ad32427081e373263b3eee7ce9a130f53b7cb5", "committedDate": "2020-04-03T12:32:28Z", "message": "[WFLY-13334]: MP Opentracing tests are not passing with a SecurityManager\n\n* Adding the missing privileged actions.\n\nJira: https://issues.redhat.com/browse/WFLY-13334"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3597, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}