{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDc0OTY0MDkz", "number": 13510, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QyMTo0NDoxOFrOEdZg7A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMlQxOTo1NjoyNFrOEw6-CA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk5MjYyMTg4OnYy", "diffSide": "RIGHT", "path": "jpa/subsystem/src/test/java/org/jboss/as/jpa/puparser/PersistenceUnitXmlParserTestCase.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QyMTo0NDoxOFrOHIiUWw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QyMTo0NDoxOFrOHIiUWw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODcxMjkyMw==", "bodyText": "Thanks for adding this cool test, great idea!", "url": "https://github.com/wildfly/wildfly/pull/13510#discussion_r478712923", "createdAt": "2020-08-27T21:44:18Z", "author": {"login": "scottmarlow"}, "path": "jpa/subsystem/src/test/java/org/jboss/as/jpa/puparser/PersistenceUnitXmlParserTestCase.java", "diffHunk": "@@ -59,4 +64,57 @@ public void testVersion() throws Exception {\n         String version = metadata.getPersistenceXMLSchemaVersion();\n         assertEquals(\"1.0\", version);\n     }\n+\n+    @Test", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c548c0c35ab9773cf75cdcfc9406ddf6efa468ea"}, "originalPosition": 25}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk5NjEyNzc3OnYy", "diffSide": "RIGHT", "path": "jpa/subsystem/src/main/java/org/jboss/as/jpa/puparser/PersistenceUnitXmlParser.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOFQxMzoxMToyOVrOHJEifQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0zMVQyMjozMDoxNVrOHKLfqg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTI3MzU5Nw==", "bodyText": "Good question, for EE 8 I would like to default to the equivalent Jakarta (EE 8) Persistence 2.2 (http://xmlns.jcp.org/xml/ns/persistence/persistence_2_2.xsd) as parsePU() is doing.\nFor EE 9, I would like to default to 3.0 as you did below for parsePU().", "url": "https://github.com/wildfly/wildfly/pull/13510#discussion_r479273597", "createdAt": "2020-08-28T13:11:29Z", "author": {"login": "scottmarlow"}, "path": "jpa/subsystem/src/main/java/org/jboss/as/jpa/puparser/PersistenceUnitXmlParser.java", "diffHunk": "@@ -94,8 +94,10 @@ public static PersistenceUnitMetadataHolder parse(final XMLStreamReader reader,\n                 version = Version.JPA_2_2;\n             } else if (\"2\".equals(versionString)) {\n                 version = Version.JPA_2_0;\n+            } else if (\"3.0\".equals(versionString)) {\n+                version = Version.JPA_3_0;\n             } else {\n-                version = Version.JPA_2_1;\n+                version = Version.JPA_2_1; // TODO is this still the right default?", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c548c0c35ab9773cf75cdcfc9406ddf6efa468ea"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTU3NzM0Mw==", "bodyText": "@scottmarlow I added a static initializer to see if an EE 9 api class is available and determine the default based on that.\nAs part of doing that I also centralized the lookup logic and the version # strings a bit.", "url": "https://github.com/wildfly/wildfly/pull/13510#discussion_r479577343", "createdAt": "2020-08-28T23:50:11Z", "author": {"login": "bstansberry"}, "path": "jpa/subsystem/src/main/java/org/jboss/as/jpa/puparser/PersistenceUnitXmlParser.java", "diffHunk": "@@ -94,8 +94,10 @@ public static PersistenceUnitMetadataHolder parse(final XMLStreamReader reader,\n                 version = Version.JPA_2_2;\n             } else if (\"2\".equals(versionString)) {\n                 version = Version.JPA_2_0;\n+            } else if (\"3.0\".equals(versionString)) {\n+                version = Version.JPA_3_0;\n             } else {\n-                version = Version.JPA_2_1;\n+                version = Version.JPA_2_1; // TODO is this still the right default?", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTI3MzU5Nw=="}, "originalCommit": {"oid": "c548c0c35ab9773cf75cdcfc9406ddf6efa468ea"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDQzNjEzOA==", "bodyText": "@scottmarlow Does the change I describe ^^^ look good?", "url": "https://github.com/wildfly/wildfly/pull/13510#discussion_r480436138", "createdAt": "2020-08-31T22:30:15Z", "author": {"login": "bstansberry"}, "path": "jpa/subsystem/src/main/java/org/jboss/as/jpa/puparser/PersistenceUnitXmlParser.java", "diffHunk": "@@ -94,8 +94,10 @@ public static PersistenceUnitMetadataHolder parse(final XMLStreamReader reader,\n                 version = Version.JPA_2_2;\n             } else if (\"2\".equals(versionString)) {\n                 version = Version.JPA_2_0;\n+            } else if (\"3.0\".equals(versionString)) {\n+                version = Version.JPA_3_0;\n             } else {\n-                version = Version.JPA_2_1;\n+                version = Version.JPA_2_1; // TODO is this still the right default?", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTI3MzU5Nw=="}, "originalCommit": {"oid": "c548c0c35ab9773cf75cdcfc9406ddf6efa468ea"}, "originalPosition": 8}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE5NzMzMjU2OnYy", "diffSide": "RIGHT", "path": "jpa/subsystem/src/main/java/org/jboss/as/jpa/puparser/PersistenceUnitXmlParser.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMlQxOTo1NjoyNFrOHmxjuA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMlQxOTo1NjoyNFrOHmxjuA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDQxOTg5Ng==", "bodyText": "Cool idea to detect the default as Jakarta EE 8 Persistence 2.2 versus EE 9 Persistence 3.0!", "url": "https://github.com/wildfly/wildfly/pull/13510#discussion_r510419896", "createdAt": "2020-10-22T19:56:24Z", "author": {"login": "scottmarlow"}, "path": "jpa/subsystem/src/main/java/org/jboss/as/jpa/puparser/PersistenceUnitXmlParser.java", "diffHunk": "@@ -49,6 +49,19 @@\n public class PersistenceUnitXmlParser extends MetaDataElementParser {\n     // cache the trace enabled flag\n     private static final boolean traceEnabled = ROOT_LOGGER.isTraceEnabled();\n+    private static final Version DEFAULT_VERSION;\n+\n+    static {\n+        Version defaultVersion;\n+        try {\n+            // Try and load a jakarta namespace JPA API class to see if we're EE 8 or a later EE\n+            PersistenceUnitXmlParser.class.getClassLoader().loadClass(\"jakarta.persistence.SharedCacheMode\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0e2e3c1fbad6b325e8494f763daa910f9027c15f"}, "originalPosition": 10}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4161, "cost": 1, "resetAt": "2021-11-13T14:23:39Z"}}}