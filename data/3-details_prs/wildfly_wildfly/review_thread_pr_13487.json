{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY4NzYxNDIx", "number": 13487, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xN1QxMToxMTowMFrOEZAG0g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNVQyMDoyMDoxM1rOFFyfAQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk0NjUxNjAyOnYy", "diffSide": "RIGHT", "path": "testsuite/integration/clustering/pom.xml", "isResolved": true, "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xN1QxMToxMTowMFrOHBkbPQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yN1QwODozNDo0OFrOHowikA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTQwNzQyMQ==", "bodyText": "Hello @pferraro @rhusar ,\nCould you point me out to any missing test that should be included for this Galleon layer? The above list are the tests I found suitable to work with this kind of configuration but I want to be sure I'm not missing anything, I'm not very familiar with the clustering test suite. Thanks!", "url": "https://github.com/wildfly/wildfly/pull/13487#discussion_r471407421", "createdAt": "2020-08-17T11:11:00Z", "author": {"login": "yersan"}, "path": "testsuite/integration/clustering/pom.xml", "diffHunk": "@@ -832,6 +832,42 @@\n                                     </systemPropertyVariables>\n                                 </configuration>\n                             </execution>\n+\n+                            <execution>\n+                                <id>ts.surefire.clustering.web-passivation</id>\n+                                <!-- Disabled by default; other profiles turn it on -->\n+                                <phase>none</phase>\n+                                <goals>\n+                                    <goal>test</goal>\n+                                </goals>\n+                                <configuration>\n+                                    <!-- Tests to execute. -->\n+                                    <includes>\n+                                        <include>org/jboss/as/test/clustering/cluster/web/**/CoarseSessionPassivationTestCase.java</include>\n+                                        <include>org/jboss/as/test/clustering/cluster/web/**/FineSessionPassivationTestCase.java</include>\n+                                        <include>org/jboss/as/test/clustering/cluster/web/**/CoarseTransactionalSessionActivationTestCase.java</include>\n+                                        <include>org/jboss/as/test/clustering/cluster/web/**/NonDistributableTestCase.java</include>\n+                                        <include>org/jboss/as/test/clustering/cluster/web/**/FineTransactionalSessionActivationTestCase.java</include>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6a09e7a935b998e1ffa764c1ba5c7113b5a3d432"}, "originalPosition": 19}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTc1NzgyOQ==", "bodyText": "Everything within org/jboss/as/test/clustering/cluster/web/** should be testable with this profile.", "url": "https://github.com/wildfly/wildfly/pull/13487#discussion_r471757829", "createdAt": "2020-08-17T20:30:06Z", "author": {"login": "pferraro"}, "path": "testsuite/integration/clustering/pom.xml", "diffHunk": "@@ -832,6 +832,42 @@\n                                     </systemPropertyVariables>\n                                 </configuration>\n                             </execution>\n+\n+                            <execution>\n+                                <id>ts.surefire.clustering.web-passivation</id>\n+                                <!-- Disabled by default; other profiles turn it on -->\n+                                <phase>none</phase>\n+                                <goals>\n+                                    <goal>test</goal>\n+                                </goals>\n+                                <configuration>\n+                                    <!-- Tests to execute. -->\n+                                    <includes>\n+                                        <include>org/jboss/as/test/clustering/cluster/web/**/CoarseSessionPassivationTestCase.java</include>\n+                                        <include>org/jboss/as/test/clustering/cluster/web/**/FineSessionPassivationTestCase.java</include>\n+                                        <include>org/jboss/as/test/clustering/cluster/web/**/CoarseTransactionalSessionActivationTestCase.java</include>\n+                                        <include>org/jboss/as/test/clustering/cluster/web/**/NonDistributableTestCase.java</include>\n+                                        <include>org/jboss/as/test/clustering/cluster/web/**/FineTransactionalSessionActivationTestCase.java</include>", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTQwNzQyMQ=="}, "originalCommit": {"oid": "6a09e7a935b998e1ffa764c1ba5c7113b5a3d432"}, "originalPosition": 19}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTk5NjcxMw==", "bodyText": "@pferraro Notice that the web-passivation Galleon layer doesn't configures jgroups extension and configures a local infinispan web container cache. My understanding is the web session is not shared across all the cluster members, most of the tests under org/jboss/as/test/clustering/cluster/web/** assert values for all the cluster nodes.", "url": "https://github.com/wildfly/wildfly/pull/13487#discussion_r471996713", "createdAt": "2020-08-18T08:11:40Z", "author": {"login": "yersan"}, "path": "testsuite/integration/clustering/pom.xml", "diffHunk": "@@ -832,6 +832,42 @@\n                                     </systemPropertyVariables>\n                                 </configuration>\n                             </execution>\n+\n+                            <execution>\n+                                <id>ts.surefire.clustering.web-passivation</id>\n+                                <!-- Disabled by default; other profiles turn it on -->\n+                                <phase>none</phase>\n+                                <goals>\n+                                    <goal>test</goal>\n+                                </goals>\n+                                <configuration>\n+                                    <!-- Tests to execute. -->\n+                                    <includes>\n+                                        <include>org/jboss/as/test/clustering/cluster/web/**/CoarseSessionPassivationTestCase.java</include>\n+                                        <include>org/jboss/as/test/clustering/cluster/web/**/FineSessionPassivationTestCase.java</include>\n+                                        <include>org/jboss/as/test/clustering/cluster/web/**/CoarseTransactionalSessionActivationTestCase.java</include>\n+                                        <include>org/jboss/as/test/clustering/cluster/web/**/NonDistributableTestCase.java</include>\n+                                        <include>org/jboss/as/test/clustering/cluster/web/**/FineTransactionalSessionActivationTestCase.java</include>", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTQwNzQyMQ=="}, "originalCommit": {"oid": "6a09e7a935b998e1ffa764c1ba5c7113b5a3d432"}, "originalPosition": 19}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzg1NDg5MQ==", "bodyText": "@pferraro @rhusar\nI've adapted the code to use the single arquillian launch. Since the web-passivation Galleon layer uses a local infinispan web container cache, jgroups is not provisioned, that means, we cannot use any of the available tests that requires a cluster.\nThat made me to identify only one test available for a single node configuration SimpleWebTestCase. Could you let me know if that test would be enough to test the capabilities giving by the web-passivation Galleon layer or, by the contrast, which other tests available on the clustering test suite are suitable to test this layer?", "url": "https://github.com/wildfly/wildfly/pull/13487#discussion_r507854891", "createdAt": "2020-10-19T15:40:49Z", "author": {"login": "yersan"}, "path": "testsuite/integration/clustering/pom.xml", "diffHunk": "@@ -832,6 +832,42 @@\n                                     </systemPropertyVariables>\n                                 </configuration>\n                             </execution>\n+\n+                            <execution>\n+                                <id>ts.surefire.clustering.web-passivation</id>\n+                                <!-- Disabled by default; other profiles turn it on -->\n+                                <phase>none</phase>\n+                                <goals>\n+                                    <goal>test</goal>\n+                                </goals>\n+                                <configuration>\n+                                    <!-- Tests to execute. -->\n+                                    <includes>\n+                                        <include>org/jboss/as/test/clustering/cluster/web/**/CoarseSessionPassivationTestCase.java</include>\n+                                        <include>org/jboss/as/test/clustering/cluster/web/**/FineSessionPassivationTestCase.java</include>\n+                                        <include>org/jboss/as/test/clustering/cluster/web/**/CoarseTransactionalSessionActivationTestCase.java</include>\n+                                        <include>org/jboss/as/test/clustering/cluster/web/**/NonDistributableTestCase.java</include>\n+                                        <include>org/jboss/as/test/clustering/cluster/web/**/FineTransactionalSessionActivationTestCase.java</include>", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTQwNzQyMQ=="}, "originalCommit": {"oid": "6a09e7a935b998e1ffa764c1ba5c7113b5a3d432"}, "originalPosition": 19}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjEyNjcwMg==", "bodyText": "This test should be used to validate this configuration: https://github.com/wildfly/wildfly/blob/master/testsuite/integration/clustering/src/test/java/org/jboss/as/test/clustering/cluster/web/NonHaWebSessionPersistenceTestCase.java", "url": "https://github.com/wildfly/wildfly/pull/13487#discussion_r512126702", "createdAt": "2020-10-26T17:06:38Z", "author": {"login": "pferraro"}, "path": "testsuite/integration/clustering/pom.xml", "diffHunk": "@@ -832,6 +832,42 @@\n                                     </systemPropertyVariables>\n                                 </configuration>\n                             </execution>\n+\n+                            <execution>\n+                                <id>ts.surefire.clustering.web-passivation</id>\n+                                <!-- Disabled by default; other profiles turn it on -->\n+                                <phase>none</phase>\n+                                <goals>\n+                                    <goal>test</goal>\n+                                </goals>\n+                                <configuration>\n+                                    <!-- Tests to execute. -->\n+                                    <includes>\n+                                        <include>org/jboss/as/test/clustering/cluster/web/**/CoarseSessionPassivationTestCase.java</include>\n+                                        <include>org/jboss/as/test/clustering/cluster/web/**/FineSessionPassivationTestCase.java</include>\n+                                        <include>org/jboss/as/test/clustering/cluster/web/**/CoarseTransactionalSessionActivationTestCase.java</include>\n+                                        <include>org/jboss/as/test/clustering/cluster/web/**/NonDistributableTestCase.java</include>\n+                                        <include>org/jboss/as/test/clustering/cluster/web/**/FineTransactionalSessionActivationTestCase.java</include>", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTQwNzQyMQ=="}, "originalCommit": {"oid": "6a09e7a935b998e1ffa764c1ba5c7113b5a3d432"}, "originalPosition": 19}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjUwMDM2OA==", "bodyText": "ok, thank you Paul!", "url": "https://github.com/wildfly/wildfly/pull/13487#discussion_r512500368", "createdAt": "2020-10-27T08:34:48Z", "author": {"login": "yersan"}, "path": "testsuite/integration/clustering/pom.xml", "diffHunk": "@@ -832,6 +832,42 @@\n                                     </systemPropertyVariables>\n                                 </configuration>\n                             </execution>\n+\n+                            <execution>\n+                                <id>ts.surefire.clustering.web-passivation</id>\n+                                <!-- Disabled by default; other profiles turn it on -->\n+                                <phase>none</phase>\n+                                <goals>\n+                                    <goal>test</goal>\n+                                </goals>\n+                                <configuration>\n+                                    <!-- Tests to execute. -->\n+                                    <includes>\n+                                        <include>org/jboss/as/test/clustering/cluster/web/**/CoarseSessionPassivationTestCase.java</include>\n+                                        <include>org/jboss/as/test/clustering/cluster/web/**/FineSessionPassivationTestCase.java</include>\n+                                        <include>org/jboss/as/test/clustering/cluster/web/**/CoarseTransactionalSessionActivationTestCase.java</include>\n+                                        <include>org/jboss/as/test/clustering/cluster/web/**/NonDistributableTestCase.java</include>\n+                                        <include>org/jboss/as/test/clustering/cluster/web/**/FineTransactionalSessionActivationTestCase.java</include>", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTQwNzQyMQ=="}, "originalCommit": {"oid": "6a09e7a935b998e1ffa764c1ba5c7113b5a3d432"}, "originalPosition": 19}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM1OTMxODAyOnYy", "diffSide": "RIGHT", "path": "testsuite/integration/clustering/src/test/java/org/jboss/as/test/clustering/single/web/NonHaWebSessionPersistenceTestCase.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wM1QxNzoyMDowMlrOH-oGfQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wM1QxOToyNzozMFrOH-tkNg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTQzMDc4MQ==", "bodyText": "Hi @yersan - I might be missing something here, but IIUC the deployment is operated by Arquillian only when ts.bootable is set. What happens for Galleon - i.e. when ts.layers is set?", "url": "https://github.com/wildfly/wildfly/pull/13487#discussion_r535430781", "createdAt": "2020-12-03T17:20:02Z", "author": {"login": "fabiobrz"}, "path": "testsuite/integration/clustering/src/test/java/org/jboss/as/test/clustering/single/web/NonHaWebSessionPersistenceTestCase.java", "diffHunk": "@@ -99,8 +103,11 @@ public void testSessionPersistence(@ArquillianResource(SimpleServlet.class) @Ope\n             Assert.assertFalse(Boolean.valueOf(response.getFirstHeader(\"serialized\").getValue()));\n             response.getEntity().getContent().close();\n \n-            stop(CONTAINER_SINGLE);\n-            start(CONTAINER_SINGLE);\n+            NodeUtil.stop(this.controller, CONTAINER_SINGLE);\n+            NodeUtil.start(this.controller, CONTAINER_SINGLE);\n+            if (Boolean.getBoolean(\"ts.bootable\")) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "25556c65189cf2968a0e50aedaca9402cf643c4c"}, "originalPosition": 95}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTQ0MDM4MA==", "bodyText": "Hi @fabiobrz This test requires a server restart to later validate the session information is correctly recovered. This test is used for a bootable JAR, Galleon trimmed or bare metal server. The deployment is always managed by the test itself, I mean Arquillian will not automatically deploy the application, we deploy it manually on @before and @after methods, but the deployment survives to a server restart when we are not in the Bootable JAR scenario.\nWhen we are testing the Bootable JAR we need to redeploy it after stopping the server, hence this if.", "url": "https://github.com/wildfly/wildfly/pull/13487#discussion_r535440380", "createdAt": "2020-12-03T17:33:39Z", "author": {"login": "yersan"}, "path": "testsuite/integration/clustering/src/test/java/org/jboss/as/test/clustering/single/web/NonHaWebSessionPersistenceTestCase.java", "diffHunk": "@@ -99,8 +103,11 @@ public void testSessionPersistence(@ArquillianResource(SimpleServlet.class) @Ope\n             Assert.assertFalse(Boolean.valueOf(response.getFirstHeader(\"serialized\").getValue()));\n             response.getEntity().getContent().close();\n \n-            stop(CONTAINER_SINGLE);\n-            start(CONTAINER_SINGLE);\n+            NodeUtil.stop(this.controller, CONTAINER_SINGLE);\n+            NodeUtil.start(this.controller, CONTAINER_SINGLE);\n+            if (Boolean.getBoolean(\"ts.bootable\")) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTQzMDc4MQ=="}, "originalCommit": {"oid": "25556c65189cf2968a0e50aedaca9402cf643c4c"}, "originalPosition": 95}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTUyMDMxMA==", "bodyText": "Thanks @yersan you\u2019re right, the jar must be redeployed to the hollow bootable jar server.", "url": "https://github.com/wildfly/wildfly/pull/13487#discussion_r535520310", "createdAt": "2020-12-03T19:27:30Z", "author": {"login": "fabiobrz"}, "path": "testsuite/integration/clustering/src/test/java/org/jboss/as/test/clustering/single/web/NonHaWebSessionPersistenceTestCase.java", "diffHunk": "@@ -99,8 +103,11 @@ public void testSessionPersistence(@ArquillianResource(SimpleServlet.class) @Ope\n             Assert.assertFalse(Boolean.valueOf(response.getFirstHeader(\"serialized\").getValue()));\n             response.getEntity().getContent().close();\n \n-            stop(CONTAINER_SINGLE);\n-            start(CONTAINER_SINGLE);\n+            NodeUtil.stop(this.controller, CONTAINER_SINGLE);\n+            NodeUtil.start(this.controller, CONTAINER_SINGLE);\n+            if (Boolean.getBoolean(\"ts.bootable\")) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTQzMDc4MQ=="}, "originalCommit": {"oid": "25556c65189cf2968a0e50aedaca9402cf643c4c"}, "originalPosition": 95}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQxNjE0MzM3OnYy", "diffSide": "LEFT", "path": "ee-feature-pack/galleon-common/src/main/resources/layers/standalone/web-passivation/layer-spec.xml", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNVQyMDoyMDoxM1rOIGeUcw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNVQyMDoyMDoxM1rOIGeUcw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzY1OTEyMw==", "bodyText": "FYI - this should use the distributable-web-local feature-group, not distributable-web.\nCurrently, that feature-group is buggy, as it specifies parameters that are not valid.\nSee https://issues.redhat.com/browse/WFLY-14231", "url": "https://github.com/wildfly/wildfly/pull/13487#discussion_r543659123", "createdAt": "2020-12-15T20:20:13Z", "author": {"login": "pferraro"}, "path": "ee-feature-pack/galleon-common/src/main/resources/layers/standalone/web-passivation/layer-spec.xml", "diffHunk": "@@ -1,5 +1,5 @@\n <?xml version=\"1.0\" ?>\n-<layer-spec xmlns=\"urn:jboss:galleon:layer-spec:1.0\" name=\"distributable-web\">", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "25556c65189cf2968a0e50aedaca9402cf643c4c"}, "originalPosition": 2}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4259, "cost": 1, "resetAt": "2021-11-13T14:23:39Z"}}}