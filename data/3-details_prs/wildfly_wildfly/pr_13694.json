{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE3NjIwNTMy", "number": 13694, "title": "[WFLY-14034] FIx Health checks when RBAC is enabled", "bodyText": "Create a LocalModelControllerClient by calling createSuperUserClient so\nthat the server readiness checks can be performed even when RBAC is\nenabled.\nThis local client is used only by server checks hard-coded in the\nServerReadinessProbes probes.\nJIRA: https://issues.redhat.com/browse/WFLY-14034\nSigned-off-by: Jeff Mesnil jmesnil@redhat.com\nThanks for submitting your Pull Request!\nPlease delete this text, and add a link to the Jira issue solved by this PR.\nRemember to use the Jira issue ID in the PR title, and any commits.", "createdAt": "2020-11-09T09:31:42Z", "url": "https://github.com/wildfly/wildfly/pull/13694", "merged": true, "mergeCommit": {"oid": "57222213f89b5f31885b66282f7585b0cea3cf06"}, "closed": true, "closedAt": "2020-11-14T16:38:16Z", "author": {"login": "jmesnil"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdaxew4gFqTUyNjA3MzY5Mg==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdbE4WzAFqTUyNjk0ODgzOQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI2MDczNjky", "url": "https://github.com/wildfly/wildfly/pull/13694#pullrequestreview-526073692", "createdAt": "2020-11-09T09:38:12Z", "commit": {"oid": "3ab1c3d01650c66321a2e6fae7e1d78d7335dfe2"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wOVQwOTozODoxM1rOHvmK1w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wOVQwOTozODoxM1rOHvmK1w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTY3MDQ4Nw==", "bodyText": "I haven't got time today to check into the code but I suspect this will be triggering a permissions check here.\nThe normal reaction to that would be \"I must add a doProvileged\" but I think this code is correct as the complete call stack will be initiated from the management endpoint.\nBut assuming my two assumptions are true it may be worth adding a comment so no one helpfully adds a \"missing doPrivileged\" at a later point.", "url": "https://github.com/wildfly/wildfly/pull/13694#discussion_r519670487", "createdAt": "2020-11-09T09:38:13Z", "author": {"login": "darranl"}, "path": "microprofile/health-smallrye/src/main/java/org/wildfly/extension/microprofile/health/HealthReporterService.java", "diffHunk": "@@ -85,7 +85,7 @@ public void start(StartContext context) {\n         final boolean defaultServerProceduresDisabled = ConfigProvider.getConfig().getOptionalValue(\"mp.health.disable-default-procedures\", Boolean.class).orElse(false);\n         healthReporter = new HealthReporter(emptyLivenessChecksStatus, emptyReadinessChecksStatus, defaultServerProceduresDisabled);\n \n-        modelControllerClient = modelControllerClientFactory.get().createClient(managementExecutor.get());\n+        modelControllerClient = modelControllerClientFactory.get().createSuperUserClient(managementExecutor.get(), true);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3ab1c3d01650c66321a2e6fae7e1d78d7335dfe2"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a02dbb04a8e3802c7d44e00258a643b49415b9c6", "author": {"user": {"login": "jmesnil", "name": "Jeff Mesnil"}}, "url": "https://github.com/wildfly/wildfly/commit/a02dbb04a8e3802c7d44e00258a643b49415b9c6", "committedDate": "2020-11-09T09:43:56Z", "message": "[WFLY-14034] FIx Health checks when RBAC is enabled\n\nCreate a LocalModelControllerClient by calling createSuperUserClient so\nthat the server readiness checks can be performed even when RBAC is\nenabled.\nThis local client is used only by server checks hard-coded in the\nServerReadinessProbes probes.\n\nJIRA: https://issues.redhat.com/browse/WFLY-14034\n\nSigned-off-by: Jeff Mesnil <jmesnil@redhat.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3ab1c3d01650c66321a2e6fae7e1d78d7335dfe2", "author": {"user": {"login": "jmesnil", "name": "Jeff Mesnil"}}, "url": "https://github.com/wildfly/wildfly/commit/3ab1c3d01650c66321a2e6fae7e1d78d7335dfe2", "committedDate": "2020-11-09T09:28:30Z", "message": "[WFLY-14034] FIx Health checks when RBAC is enabled\n\nCreate a LocalModelControllerClient by calling createSuperUserClient so\nthat the server readiness checks can be performed even when RBAC is\nenabled.\nThis local client is used only by server checks hard-coded in the\nServerReadinessProbes probes.\n\nJIRA: https://issues.redhat.com/browse/WFLY-14034\n\nSigned-off-by: Jeff Mesnil <jmesnil@redhat.com>"}, "afterCommit": {"oid": "a02dbb04a8e3802c7d44e00258a643b49415b9c6", "author": {"user": {"login": "jmesnil", "name": "Jeff Mesnil"}}, "url": "https://github.com/wildfly/wildfly/commit/a02dbb04a8e3802c7d44e00258a643b49415b9c6", "committedDate": "2020-11-09T09:43:56Z", "message": "[WFLY-14034] FIx Health checks when RBAC is enabled\n\nCreate a LocalModelControllerClient by calling createSuperUserClient so\nthat the server readiness checks can be performed even when RBAC is\nenabled.\nThis local client is used only by server checks hard-coded in the\nServerReadinessProbes probes.\n\nJIRA: https://issues.redhat.com/browse/WFLY-14034\n\nSigned-off-by: Jeff Mesnil <jmesnil@redhat.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI2OTQ4ODM5", "url": "https://github.com/wildfly/wildfly/pull/13694#pullrequestreview-526948839", "createdAt": "2020-11-10T08:14:22Z", "commit": {"oid": "a02dbb04a8e3802c7d44e00258a643b49415b9c6"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3832, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}