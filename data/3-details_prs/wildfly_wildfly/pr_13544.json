{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDgyODgwNjYy", "number": 13544, "title": "WFLY-13832 Bug in detecting the org.apache.cxf module", "bodyText": "Look for cxf module also in exported parent dependencies\nhttps://issues.redhat.com/browse/WFLY-13832", "createdAt": "2020-09-09T14:21:04Z", "url": "https://github.com/wildfly/wildfly/pull/13544", "merged": true, "mergeCommit": {"oid": "fa64231fd772de25014b4b7992b5716cdb312c24"}, "closed": true, "closedAt": "2020-09-17T01:50:52Z", "author": {"login": "TomasHofman"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdHa-d2AFqTQ4NTYyMzA5NA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdJh0q2gFqTQ4OTk2ODQ4MQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg1NjIzMDk0", "url": "https://github.com/wildfly/wildfly/pull/13544#pullrequestreview-485623094", "createdAt": "2020-09-10T06:40:27Z", "commit": {"oid": "8eb6faff6b198f771463e2e703df51ec0459d7e3"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMFQwNjo0MDoyN1rOHPlLCw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMFQwNjo0MDoyN1rOHPlLCw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjA5OTcyMw==", "bodyText": "Only mockito-core was added, rest of the lines were just reformatted...", "url": "https://github.com/wildfly/wildfly/pull/13544#discussion_r486099723", "createdAt": "2020-09-10T06:40:27Z", "author": {"login": "TomasHofman"}, "path": "webservices/server-integration/pom.xml", "diffHunk": "@@ -42,102 +42,107 @@\n     <name>WildFly: Web Services Server Integration Subsystem</name>\n \n     <dependencies>\n-    <dependency>\n-       <groupId>junit</groupId>\n-       <artifactId>junit</artifactId>\n-       <scope>test</scope>\n-    </dependency>\n-\n-    <dependency>\n-       <groupId>org.jboss.msc</groupId>\n-       <artifactId>jboss-msc</artifactId>\n-    </dependency>\n-\n-    <dependency>\n-       <groupId>org.wildfly.security</groupId>\n-       <artifactId>wildfly-elytron</artifactId>\n-    </dependency>\n-\n-    <dependency>\n-       <groupId>org.wildfly.core</groupId>\n+        <dependency>\n+            <groupId>junit</groupId>\n+            <artifactId>junit</artifactId>\n+            <scope>test</scope>\n+        </dependency>\n+        <dependency>\n+            <groupId>org.mockito</groupId>\n+            <artifactId>mockito-core</artifactId>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8eb6faff6b198f771463e2e703df51ec0459d7e3"}, "originalPosition": 29}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg2NDI1MjEw", "url": "https://github.com/wildfly/wildfly/pull/13544#pullrequestreview-486425210", "createdAt": "2020-09-11T02:05:51Z", "commit": {"oid": "8eb6faff6b198f771463e2e703df51ec0459d7e3"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMVQwMjowNTo1MVrOHQLrbw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMVQwMjoxMjowMFrOHQLx7Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjczMDYwNw==", "bodyText": "@TomasHofman  Can you please only add the  mockito-core dependency in this PR and format this pom file in another PR ?", "url": "https://github.com/wildfly/wildfly/pull/13544#discussion_r486730607", "createdAt": "2020-09-11T02:05:51Z", "author": {"login": "jimma"}, "path": "webservices/server-integration/pom.xml", "diffHunk": "@@ -42,102 +42,107 @@\n     <name>WildFly: Web Services Server Integration Subsystem</name>\n \n     <dependencies>\n-    <dependency>\n-       <groupId>junit</groupId>\n-       <artifactId>junit</artifactId>\n-       <scope>test</scope>\n-    </dependency>\n-\n-    <dependency>\n-       <groupId>org.jboss.msc</groupId>\n-       <artifactId>jboss-msc</artifactId>\n-    </dependency>\n-\n-    <dependency>\n-       <groupId>org.wildfly.security</groupId>\n-       <artifactId>wildfly-elytron</artifactId>\n-    </dependency>\n-\n-    <dependency>\n-       <groupId>org.wildfly.core</groupId>\n+        <dependency>\n+            <groupId>junit</groupId>\n+            <artifactId>junit</artifactId>\n+            <scope>test</scope>\n+        </dependency>\n+        <dependency>\n+            <groupId>org.mockito</groupId>\n+            <artifactId>mockito-core</artifactId>", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjA5OTcyMw=="}, "originalCommit": {"oid": "8eb6faff6b198f771463e2e703df51ec0459d7e3"}, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjczMjI2OQ==", "bodyText": "If I understand this correctly, here we already checked Ear deployment. Do we really need this recursion after this check ?\nI don't know if this case has already been checked:  there is another sub-deployment has cxf dependencies, and ear-subdeployments-isolated set to false . Do we need to look at this ?", "url": "https://github.com/wildfly/wildfly/pull/13544#discussion_r486732269", "createdAt": "2020-09-11T02:12:00Z", "author": {"login": "jimma"}, "path": "webservices/server-integration/src/main/java/org/jboss/as/webservices/deployers/WSClassVerificationProcessor.java", "diffHunk": "@@ -138,14 +138,28 @@ private void verifyApacheCXFModuleDependencyRequirement(DeploymentUnit unit) {\n         }\n     }\n \n-    private static boolean hasCxfModuleDependency(DeploymentUnit unit) {\n+    static boolean hasCxfModuleDependency(DeploymentUnit unit) {\n         final ModuleSpecification moduleSpec = unit.getAttachment(Attachments.MODULE_SPECIFICATION);\n         for (ModuleDependency dep : moduleSpec.getUserDependencies()) {\n             final String id = dep.getIdentifier().getName();\n             if (cxfExportingModules.contains(id)) {\n                 return true;\n             }\n         }\n+        return hasParentCxfModuleDependency(unit);\n+    }\n+\n+    private static boolean hasParentCxfModuleDependency(DeploymentUnit unit) {\n+        if (unit.getParent() != null) {\n+            final ModuleSpecification moduleSpec = unit.getParent().getAttachment(Attachments.MODULE_SPECIFICATION);\n+            for (ModuleDependency dep : moduleSpec.getUserDependencies()) {\n+                final String id = dep.getIdentifier().getName();\n+                if (cxfExportingModules.contains(id) && dep.isExport()) {\n+                    return true;\n+                }\n+            }\n+            return hasParentCxfModuleDependency(unit.getParent());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8eb6faff6b198f771463e2e703df51ec0459d7e3"}, "originalPosition": 34}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "8eb6faff6b198f771463e2e703df51ec0459d7e3", "author": {"user": {"login": "TomasHofman", "name": null}}, "url": "https://github.com/wildfly/wildfly/commit/8eb6faff6b198f771463e2e703df51ec0459d7e3", "committedDate": "2020-09-09T14:19:15Z", "message": "WFLY-13832 Bug in detecting the org.apache.cxf module\n\nLook for cxf module also in exported parent dependencies"}, "afterCommit": {"oid": "6ecc8bf54d73e0b3b658ff4363f8781d5cd88ed0", "author": {"user": {"login": "TomasHofman", "name": null}}, "url": "https://github.com/wildfly/wildfly/commit/6ecc8bf54d73e0b3b658ff4363f8781d5cd88ed0", "committedDate": "2020-09-15T06:27:14Z", "message": "WFLY-13832 Bug in detecting the org.apache.cxf module\n\nLook for cxf module also in exported parent dependencies"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9cfc7bae9410288514fad6ad348276833690a1da", "author": {"user": {"login": "TomasHofman", "name": null}}, "url": "https://github.com/wildfly/wildfly/commit/9cfc7bae9410288514fad6ad348276833690a1da", "committedDate": "2020-09-15T16:32:47Z", "message": "WFLY-13832 Bug in detecting the org.apache.cxf module\n\nLook for cxf module also in exported parent dependencies"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6ecc8bf54d73e0b3b658ff4363f8781d5cd88ed0", "author": {"user": {"login": "TomasHofman", "name": null}}, "url": "https://github.com/wildfly/wildfly/commit/6ecc8bf54d73e0b3b658ff4363f8781d5cd88ed0", "committedDate": "2020-09-15T06:27:14Z", "message": "WFLY-13832 Bug in detecting the org.apache.cxf module\n\nLook for cxf module also in exported parent dependencies"}, "afterCommit": {"oid": "9cfc7bae9410288514fad6ad348276833690a1da", "author": {"user": {"login": "TomasHofman", "name": null}}, "url": "https://github.com/wildfly/wildfly/commit/9cfc7bae9410288514fad6ad348276833690a1da", "committedDate": "2020-09-15T16:32:47Z", "message": "WFLY-13832 Bug in detecting the org.apache.cxf module\n\nLook for cxf module also in exported parent dependencies"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg5OTY4NDgx", "url": "https://github.com/wildfly/wildfly/pull/13544#pullrequestreview-489968481", "createdAt": "2020-09-16T19:46:43Z", "commit": {"oid": "9cfc7bae9410288514fad6ad348276833690a1da"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQxOTo0Njo0M1rOHTBw4g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQxOTo0Njo0M1rOHTBw4g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTcxMzg5MA==", "bodyText": "Missing copyright header.", "url": "https://github.com/wildfly/wildfly/pull/13544#discussion_r489713890", "createdAt": "2020-09-16T19:46:43Z", "author": {"login": "darranl"}, "path": "webservices/server-integration/src/test/java/org/jboss/as/webservices/deployers/WSClassVerificationProcessorTestCase.java", "diffHunk": "@@ -0,0 +1,95 @@\n+package org.jboss.as.webservices.deployers;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9cfc7bae9410288514fad6ad348276833690a1da"}, "originalPosition": 1}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3870, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}