{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ1MTkxNTA0", "number": 13399, "title": "[WFLY-13647] Annotation processing error sun.reflect.annotation.TypeNotPresentExceptionProxy does not indicate issue", "bodyText": "Issue: https://issues.redhat.com/browse/WFLY-13647\nThere is a bug with Class.getAnnotation() call in JDK < 11 [1]  which throws ArrayStoreException when the annotation refers to some classes not found in current class path. The ArrayStoreException confuses user why it failed because the root cause is missing.\nThis PR tries to catch the exception and give more readable feedback in this case.\n[1] https://bugs.openjdk.java.net/browse/JDK-7183985", "createdAt": "2020-07-07T06:43:32Z", "url": "https://github.com/wildfly/wildfly/pull/13399", "merged": true, "mergeCommit": {"oid": "1044ec27734978f0822cc67d0e6b72ad4ee9d09f"}, "closed": true, "closedAt": "2020-07-24T22:14:27Z", "author": {"login": "gaol"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABczWISZgFqTQ0NTk4OTMzMQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABc29rQdgBqjM1Njg4NTQ0MTE=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ1OTg5MzMx", "url": "https://github.com/wildfly/wildfly/pull/13399#pullrequestreview-445989331", "createdAt": "2020-07-09T21:43:11Z", "commit": {"oid": "3bc0b1af46793f70f4404232484178ba86cd143a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOVQyMTo0MzoxMVrOGvi03A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOVQyMTo0MzoxMVrOGvi03A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjUwNjg0NA==", "bodyText": "I suspect we don't need exception handling here. When @Remote @Local is used in a business interface, they do not take any arguments.  The no-arg annotation is to indicate that the annotated business interface is a local or remote business interface.  For ex,\n@Remote \npublic interface Calculator {...}", "url": "https://github.com/wildfly/wildfly/pull/13399#discussion_r452506844", "createdAt": "2020-07-09T21:43:11Z", "author": {"login": "chengfang"}, "path": "ejb3/src/main/java/org/jboss/as/ejb3/deployment/processors/BusinessViewAnnotationProcessor.java", "diffHunk": "@@ -197,12 +211,18 @@ private void processViewAnnotations(final DeploymentUnit deploymentUnit, final C\n         return Arrays.asList(localViews);\n     }\n \n-    private static Collection<Class<?>> getBusinessInterfacesFromInterfaceAnnotations(Class<?> sessionBeanClass, Class<? extends Annotation> annotation) {\n+    private static Collection<Class<?>> getBusinessInterfacesFromInterfaceAnnotations(Class<?> sessionBeanClass, Class<? extends Annotation> annotation) throws DeploymentUnitProcessingException {\n         final Set<Class<?>> potentialBusinessInterfaces = getPotentialBusinessInterfaces(sessionBeanClass);\n         final Set<Class<?>> businessInterfaces = new HashSet<Class<?>>();\n         for (Class<?> iface : potentialBusinessInterfaces) {\n-            if (iface.getAnnotation(annotation) != null) {\n-                businessInterfaces.add(iface);\n+            try {\n+                if (iface.getAnnotation(annotation) != null) {\n+                    businessInterfaces.add(iface);\n+                }\n+            } catch (ArrayStoreException e) {\n+                // https://bugs.openjdk.java.net/browse/JDK-7183985\n+                // Class.findAnnotation() has a bug under JDK < 11 which throws ArrayStoreException\n+                throw EjbLogger.ROOT_LOGGER.missingClassInAnnotation(annotation.getSimpleName(), iface.getName());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3bc0b1af46793f70f4404232484178ba86cd143a"}, "originalPosition": 50}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ5OTEzMDA5", "url": "https://github.com/wildfly/wildfly/pull/13399#pullrequestreview-449913009", "createdAt": "2020-07-16T14:37:04Z", "commit": {"oid": "3bc0b1af46793f70f4404232484178ba86cd143a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d47f0aaef00cfac4cec8a82828b1b65e699ee9c7", "author": {"user": {"login": "gaol", "name": "Lin Gao"}}, "url": "https://github.com/wildfly/wildfly/commit/d47f0aaef00cfac4cec8a82828b1b65e699ee9c7", "committedDate": "2020-07-21T03:27:54Z", "message": "[WFLY-13647] Annotation processing error sun.reflect.annotation.TypeNotPresentExceptionProxy does not indicate issue\n\n- Fix case of missing classes referenced by HandlesTypes in ServletContainerInitializer\n\nSigned-off-by: Lin Gao <lgao@redhat.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "13cb5917abd6e99f60593a24a1abca8de894b9bc", "author": {"user": {"login": "gaol", "name": "Lin Gao"}}, "url": "https://github.com/wildfly/wildfly/commit/13cb5917abd6e99f60593a24a1abca8de894b9bc", "committedDate": "2020-07-21T03:28:47Z", "message": "[WFLY-13647] Annotation processing error sun.reflect.annotation.TypeNotPresentExceptionProxy does not indicate issue\n\n- Fix case of missing classes referenced by Remote or Local in session bean\n\nSigned-off-by: Lin Gao <lgao@redhat.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3bc0b1af46793f70f4404232484178ba86cd143a", "author": {"user": {"login": "gaol", "name": "Lin Gao"}}, "url": "https://github.com/wildfly/wildfly/commit/3bc0b1af46793f70f4404232484178ba86cd143a", "committedDate": "2020-07-07T06:05:17Z", "message": "[WFLY-13647] Annotation processing error sun.reflect.annotation.TypeNotPresentExceptionProxy does not indicate issue\n\n- Fix case of missing classes referenced by Remote or Local in session bean\n\nSigned-off-by: Lin Gao <lgao@redhat.com>"}, "afterCommit": {"oid": "13cb5917abd6e99f60593a24a1abca8de894b9bc", "author": {"user": {"login": "gaol", "name": "Lin Gao"}}, "url": "https://github.com/wildfly/wildfly/commit/13cb5917abd6e99f60593a24a1abca8de894b9bc", "committedDate": "2020-07-21T03:28:47Z", "message": "[WFLY-13647] Annotation processing error sun.reflect.annotation.TypeNotPresentExceptionProxy does not indicate issue\n\n- Fix case of missing classes referenced by Remote or Local in session bean\n\nSigned-off-by: Lin Gao <lgao@redhat.com>"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3893, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}