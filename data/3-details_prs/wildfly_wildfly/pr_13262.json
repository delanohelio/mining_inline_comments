{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDEyOTc0NzA3", "number": 13262, "title": "[WFLY-13424]: External pooled connection factory won't be properl injected if it has several JNDI entries.", "bodyText": "if the bound name is not the first one then we get a reference to a\nreference service instead ofg the pcf service.\nresolving this so that we get the proper resource adapter service name.\n\nJira: https://issues.redhat.com/browse/WFLY-13424", "createdAt": "2020-05-04T14:08:36Z", "url": "https://github.com/wildfly/wildfly/pull/13262", "merged": true, "mergeCommit": {"oid": "2c37137de1af7fd3b85fddce05cf84fd5949c3d3"}, "closed": true, "closedAt": "2020-05-16T12:16:01Z", "author": {"login": "ehsavoie"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABceAE27gBqjMzMDAwNTE4ODg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABchoK7FgFqTQxMjk0OTcyNw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "1814addbd2521d0d990188367c4f3d53f846debe", "author": {"user": {"login": "ehsavoie", "name": "Emmanuel Hugonnet"}}, "url": "https://github.com/wildfly/wildfly/commit/1814addbd2521d0d990188367c4f3d53f846debe", "committedDate": "2020-05-04T14:07:44Z", "message": "[(nobranch,rebasingWFLY-13424)]:  [WFLY-13424]: External pooled connection factory won't be properl injected if it has several JNDI entries.\n\n* if the bound name is not the first one then we get a reference to a\n  reference service instead ofg the pcf service.\n* resolving this so that we get the proper resource adapter service name.\n\nJira: https://issues.redhat.com/browse/WFLY-13424"}, "afterCommit": {"oid": "bb45cd4e27719363ab08ee18600b04bdb1648000", "author": {"user": {"login": "ehsavoie", "name": "Emmanuel Hugonnet"}}, "url": "https://github.com/wildfly/wildfly/commit/bb45cd4e27719363ab08ee18600b04bdb1648000", "committedDate": "2020-05-04T14:08:50Z", "message": "[WFLY-13424]: External pooled connection factory won't be properl injected if it has several JNDI entries.\n\n* if the bound name is not the first one then we get a reference to a\n  reference service instead ofg the pcf service.\n* resolving this so that we get the proper resource adapter service name.\n\nJira: https://issues.redhat.com/browse/WFLY-13424"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA3Njk2MTkx", "url": "https://github.com/wildfly/wildfly/pull/13262#pullrequestreview-407696191", "createdAt": "2020-05-07T17:43:02Z", "commit": {"oid": "bb45cd4e27719363ab08ee18600b04bdb1648000"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wN1QxNzo0MzowM1rOGSJWUw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wN1QxNzo0MzowM1rOGSJWUw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTY4MDcyMw==", "bodyText": "Minor point; ignore if you want -- this L435-437 block duplicates L423-425 and could be dropped if this entire new code block from L426 was moved above L423.", "url": "https://github.com/wildfly/wildfly/pull/13262#discussion_r421680723", "createdAt": "2020-05-07T17:43:03Z", "author": {"login": "bstansberry"}, "path": "messaging-activemq/src/main/java/org/wildfly/extension/messaging/activemq/deployment/JMSConnectionFactoryDefinitionInjectionSource.java", "diffHunk": "@@ -420,6 +423,21 @@ static String getDefaulResourceAdapter(DeploymentUnit deploymentUnit) {\n                 if (pcf != null && pcf instanceof ConnectionFactoryReferenceFactoryService) {\n                     return ((ConnectionFactoryReferenceFactoryService) pcf).getName();\n                 }\n+                //In case of multiple JNDI entries only the 1st is properly bound\n+                if (pcf != null && pcf instanceof ContextListAndJndiViewManagedReferenceFactory) {\n+                    ManagedReference ref = ((ContextListAndJndiViewManagedReferenceFactory) pcf).getReference();\n+                    Object ra = ref.getInstance();\n+                    if (ra instanceof ActiveMQRAConnectionFactoryImpl) {\n+                        bindInfo = ContextNames.bindInfoFor(((ActiveMQRAConnectionFactoryImpl) ra).getReference().getClassName());\n+                        binder = deploymentUnit.getServiceRegistry().getService(bindInfo.getBinderServiceName());\n+                        if (binder != null) {\n+                            pcf = binder.getService().getValue();\n+                            if (pcf != null && pcf instanceof ConnectionFactoryReferenceFactoryService) {\n+                                return ((ConnectionFactoryReferenceFactoryService) pcf).getName();\n+                            }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bb45cd4e27719363ab08ee18600b04bdb1648000"}, "originalPosition": 32}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a91eba91c96f0a511fe0be68fdd456fb632cf937", "author": {"user": {"login": "ehsavoie", "name": "Emmanuel Hugonnet"}}, "url": "https://github.com/wildfly/wildfly/commit/a91eba91c96f0a511fe0be68fdd456fb632cf937", "committedDate": "2020-05-11T12:30:24Z", "message": "[(nobranch,rebasingWFLY-13424)]:  [WFLY-13424]: External pooled connection factory won't be properl injected if it has several JNDI entries.\n\n* if the bound name is not the first one then we get a reference to a\n  reference service instead ofg the pcf service.\n* resolving this so that we get the proper resource adapter service name.\n\nJira: https://issues.redhat.com/browse/WFLY-13424"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "bb45cd4e27719363ab08ee18600b04bdb1648000", "author": {"user": {"login": "ehsavoie", "name": "Emmanuel Hugonnet"}}, "url": "https://github.com/wildfly/wildfly/commit/bb45cd4e27719363ab08ee18600b04bdb1648000", "committedDate": "2020-05-04T14:08:50Z", "message": "[WFLY-13424]: External pooled connection factory won't be properl injected if it has several JNDI entries.\n\n* if the bound name is not the first one then we get a reference to a\n  reference service instead ofg the pcf service.\n* resolving this so that we get the proper resource adapter service name.\n\nJira: https://issues.redhat.com/browse/WFLY-13424"}, "afterCommit": {"oid": "a91eba91c96f0a511fe0be68fdd456fb632cf937", "author": {"user": {"login": "ehsavoie", "name": "Emmanuel Hugonnet"}}, "url": "https://github.com/wildfly/wildfly/commit/a91eba91c96f0a511fe0be68fdd456fb632cf937", "committedDate": "2020-05-11T12:30:24Z", "message": "[(nobranch,rebasingWFLY-13424)]:  [WFLY-13424]: External pooled connection factory won't be properl injected if it has several JNDI entries.\n\n* if the bound name is not the first one then we get a reference to a\n  reference service instead ofg the pcf service.\n* resolving this so that we get the proper resource adapter service name.\n\nJira: https://issues.redhat.com/browse/WFLY-13424"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEyOTQ5NzI3", "url": "https://github.com/wildfly/wildfly/pull/13262#pullrequestreview-412949727", "createdAt": "2020-05-15T20:33:43Z", "commit": {"oid": "a91eba91c96f0a511fe0be68fdd456fb632cf937"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3551, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}