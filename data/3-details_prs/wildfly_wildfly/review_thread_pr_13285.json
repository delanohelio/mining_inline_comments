{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE3MjgyNzAz", "number": 13285, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNVQwMzoxNjoyNlrOD8t74A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNVQwMzoyMzozNFrOD8t_3Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY0OTkzNzYwOnYy", "diffSide": "RIGHT", "path": "ejb3/src/main/java/org/jboss/as/ejb3/timerservice/TimerServiceImpl.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNVQwMzoxNjoyNlrOGV1GSg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNVQwNjoxODoyM1rOGV34Lw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTU0MzI0Mg==", "bodyText": "timers is already declared as a synchronized map. We may want to switch to a regular HashMap and guard all access to it to avoid double synchronize it.", "url": "https://github.com/wildfly/wildfly/pull/13285#discussion_r425543242", "createdAt": "2020-05-15T03:16:26Z", "author": {"login": "chengfang"}, "path": "ejb3/src/main/java/org/jboss/as/ejb3/timerservice/TimerServiceImpl.java", "diffHunk": "@@ -1133,12 +1128,23 @@ public TimerServiceResource getResource() {\n         return resource;\n     }\n \n-    private void registerTimerResource(final String timerId) {\n-        this.resource.timerCreated(timerId);\n+    private boolean registerTimerResource(final TimerImpl timer) {\n+        synchronized (this.timers) {\n+            if (this.timers.containsKey(timer.getId())) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0556d0432842295a8edfdb3ffe7cabd9cebbafe1"}, "originalPosition": 51}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTU4ODc4Mw==", "bodyText": "done", "url": "https://github.com/wildfly/wildfly/pull/13285#discussion_r425588783", "createdAt": "2020-05-15T06:18:23Z", "author": {"login": "elguardian"}, "path": "ejb3/src/main/java/org/jboss/as/ejb3/timerservice/TimerServiceImpl.java", "diffHunk": "@@ -1133,12 +1128,23 @@ public TimerServiceResource getResource() {\n         return resource;\n     }\n \n-    private void registerTimerResource(final String timerId) {\n-        this.resource.timerCreated(timerId);\n+    private boolean registerTimerResource(final TimerImpl timer) {\n+        synchronized (this.timers) {\n+            if (this.timers.containsKey(timer.getId())) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTU0MzI0Mg=="}, "originalCommit": {"oid": "0556d0432842295a8edfdb3ffe7cabd9cebbafe1"}, "originalPosition": 51}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY0OTk0NzgxOnYy", "diffSide": "RIGHT", "path": "ejb3/src/main/java/org/jboss/as/ejb3/timerservice/TimerServiceImpl.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNVQwMzoyMzozNFrOGV1MvA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNVQwNjoxOToxN1rOGV35YA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTU0NDg5Mg==", "bodyText": "If the timer id already exists in the internal cache timers, why do we put the timer to timers again? It looks harmless though.", "url": "https://github.com/wildfly/wildfly/pull/13285#discussion_r425544892", "createdAt": "2020-05-15T03:23:34Z", "author": {"login": "chengfang"}, "path": "ejb3/src/main/java/org/jboss/as/ejb3/timerservice/TimerServiceImpl.java", "diffHunk": "@@ -1133,12 +1128,23 @@ public TimerServiceResource getResource() {\n         return resource;\n     }\n \n-    private void registerTimerResource(final String timerId) {\n-        this.resource.timerCreated(timerId);\n+    private boolean registerTimerResource(final TimerImpl timer) {\n+        synchronized (this.timers) {\n+            if (this.timers.containsKey(timer.getId())) {\n+                this.timers.put(timer.getId(), timer);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0556d0432842295a8edfdb3ffe7cabd9cebbafe1"}, "originalPosition": 52}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTU4OTA4OA==", "bodyText": "ok. removed", "url": "https://github.com/wildfly/wildfly/pull/13285#discussion_r425589088", "createdAt": "2020-05-15T06:19:17Z", "author": {"login": "elguardian"}, "path": "ejb3/src/main/java/org/jboss/as/ejb3/timerservice/TimerServiceImpl.java", "diffHunk": "@@ -1133,12 +1128,23 @@ public TimerServiceResource getResource() {\n         return resource;\n     }\n \n-    private void registerTimerResource(final String timerId) {\n-        this.resource.timerCreated(timerId);\n+    private boolean registerTimerResource(final TimerImpl timer) {\n+        synchronized (this.timers) {\n+            if (this.timers.containsKey(timer.getId())) {\n+                this.timers.put(timer.getId(), timer);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTU0NDg5Mg=="}, "originalCommit": {"oid": "0556d0432842295a8edfdb3ffe7cabd9cebbafe1"}, "originalPosition": 52}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4305, "cost": 1, "resetAt": "2021-11-13T14:23:39Z"}}}