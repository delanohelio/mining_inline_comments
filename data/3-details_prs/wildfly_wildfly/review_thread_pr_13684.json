{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTEzNzQwNDU2", "number": 13684, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNVQyMzozNDoxMlrOE142Pw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNVQyMzozNDoxMlrOE142Pw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI0OTQxMzc1OnYy", "diffSide": "RIGHT", "path": "testsuite/integration/ws/src/test/java/org/jboss/as/test/integration/ws/basic/EJBEndpointTestCase.java", "isResolved": false, "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNVQyMzozNDoxMlrOHuau8Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOFQwMzoxMjo1NlrOH1W4uA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODQzNDU0NQ==", "bodyText": "@jimma @soul2zimate Is the second part of this comment (\"is not supposed ... to be called from deployments\") correct?\nIf so it would be good to clarify that and expand the comment to explain that the accessClassInPackage permission is also needed for that call. That's assuming that is the case.\nIf tests need weird permissions its good to be very clear on how it's the deployment that needs the perms and not the server code.", "url": "https://github.com/wildfly/wildfly/pull/13684#discussion_r518434545", "createdAt": "2020-11-05T23:34:12Z", "author": {"login": "bstansberry"}, "path": "testsuite/integration/ws/src/test/java/org/jboss/as/test/integration/ws/basic/EJBEndpointTestCase.java", "diffHunk": "@@ -52,7 +52,12 @@\n         JavaArchive jar = ShrinkWrap.create(JavaArchive.class, \"jaxws-basic-ejb.jar\")\n                 .addClasses(EndpointIface.class, EJBEndpoint.class, HelloObject.class);\n         // EJBEndpoint#helloError needs getClassLoader permission for SOAPFactory.newInstance() invocation which is not supposed(??? at least it seems so) to be called from deployments", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2eb83e26ee6174b660f683d8e1ffc6763202a9af"}, "originalPosition": 3}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTg4MjU5OQ==", "bodyText": "The getClassLoader RuntimePermission seems unnecessary. Test in Linux SM - JDK 8 passed without it. I removed it from this PR.\nThe weird accessClassInPackage permission is only needed for the deployment by IBM JDK with security manager enabled. So I added an extra Java vendor check beforehand.", "url": "https://github.com/wildfly/wildfly/pull/13684#discussion_r521882599", "createdAt": "2020-11-12T07:14:44Z", "author": {"login": "soul2zimate"}, "path": "testsuite/integration/ws/src/test/java/org/jboss/as/test/integration/ws/basic/EJBEndpointTestCase.java", "diffHunk": "@@ -52,7 +52,12 @@\n         JavaArchive jar = ShrinkWrap.create(JavaArchive.class, \"jaxws-basic-ejb.jar\")\n                 .addClasses(EndpointIface.class, EJBEndpoint.class, HelloObject.class);\n         // EJBEndpoint#helloError needs getClassLoader permission for SOAPFactory.newInstance() invocation which is not supposed(??? at least it seems so) to be called from deployments", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODQzNDU0NQ=="}, "originalCommit": {"oid": "2eb83e26ee6174b660f683d8e1ffc6763202a9af"}, "originalPosition": 3}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTkwMDMyNA==", "bodyText": "@bstansberry  I think @soul2zimate already found the root cause.   @soul2zimate  Just curious, what does the stack trace look like without this permission?", "url": "https://github.com/wildfly/wildfly/pull/13684#discussion_r521900324", "createdAt": "2020-11-12T07:55:20Z", "author": {"login": "jimma"}, "path": "testsuite/integration/ws/src/test/java/org/jboss/as/test/integration/ws/basic/EJBEndpointTestCase.java", "diffHunk": "@@ -52,7 +52,12 @@\n         JavaArchive jar = ShrinkWrap.create(JavaArchive.class, \"jaxws-basic-ejb.jar\")\n                 .addClasses(EndpointIface.class, EJBEndpoint.class, HelloObject.class);\n         // EJBEndpoint#helloError needs getClassLoader permission for SOAPFactory.newInstance() invocation which is not supposed(??? at least it seems so) to be called from deployments", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODQzNDU0NQ=="}, "originalCommit": {"oid": "2eb83e26ee6174b660f683d8e1ffc6763202a9af"}, "originalPosition": 3}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTkwMTU5MA==", "bodyText": "Caused by: javax.xml.parsers.FactoryConfigurationError: Provider com.sun.org.apache.xerces.internal.jaxp.DocumentBuilderFactoryImpl could not be instantiated: java.security.AccessControlException: WFSM000001: Permission check failed (permission \"(\"java.lang.RuntimePermission\" \"accessClassInPackage.com.sun.org.apache.xerces.internal.jaxp\")\" in code source \"(vfs:/content/jaxws-basic-ejb.jar <no signer certificates>)\" of \"ModuleClassLoader for Module \"deployment.jaxws-basic-ejb.jar\" from Service Module Loader\")\n\tat javax.xml.parsers.DocumentBuilderFactory.newInstance(Unknown Source)\n\tat com.sun.xml.messaging.saaj.soap.SOAPDocumentImpl.createDocument(SOAPDocumentImpl.java:105)\n\tat com.sun.xml.messaging.saaj.soap.SOAPDocumentImpl.<init>(SOAPDocumentImpl.java:99)\n\tat com.sun.xml.messaging.saaj.soap.SOAPPartImpl.<init>(SOAPPartImpl.java:134)\n\tat com.sun.xml.messaging.saaj.soap.SOAPPartImpl.<init>(SOAPPartImpl.java:130)\n\tat com.sun.xml.messaging.saaj.soap.ver1_2.SOAPFactory1_2Impl.createDocument(SOAPFactory1_2Impl.java:59)\n\tat com.sun.xml.messaging.saaj.soap.ver1_2.SOAPFactory1_2Impl.createFault(SOAPFactory1_2Impl.java:76)\n\tat org.jboss.as.test.integration.ws.basic.EJBEndpoint.helloError(EJBEndpoint.java:72)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:90)\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:55)\n\tat java.lang.reflect.Method.invoke(Method.java:508)\n\tat org.jboss.as.ee.component.ManagedReferenceMethodInterceptor.processInvocation(ManagedReferenceMethodInterceptor.java:52)\n\tat org.jboss.invocation.InterceptorContext.proceed(InterceptorContext.java:422)\n\tat org.jboss.invocation.InterceptorContext$Invocation.proceed(InterceptorContext.java:509)\n\tat org.jboss.as.weld.interceptors.Jsr299BindingsInterceptor.delegateInterception(Jsr299BindingsInterceptor.java:79)\n\tat org.jboss.as.weld.interceptors.Jsr299BindingsInterceptor.doMethodInterception(Jsr299BindingsInterceptor.java:89)\n\tat org.jboss.as.weld.interceptors.Jsr299BindingsInterceptor.processInvocation(Jsr299BindingsInterceptor.java:102)\n\tat org.jboss.as.ee.component.interceptors.UserInterceptorFactory$1.processInvocation(UserInterceptorFactory.java:63)\n\tat org.jboss.invocation.InterceptorContext.proceed(InterceptorContext.java:422)\n\tat org.jboss.as.ejb3.component.invocationmetrics.ExecutionTimeInterceptor.processInvocation(ExecutionTimeInterceptor.java:43)\n\tat org.jboss.invocation.InterceptorContext.proceed(InterceptorContext.java:422)\n\tat org.jboss.as.jpa.interceptor.SBInvocationInterceptor.processInvocation(SBInvocationInterceptor.java:47)\n\tat org.jboss.invocation.InterceptorContext.proceed(InterceptorContext.java:422)\n\tat org.jboss.as.ee.concurrent.ConcurrentContextInterceptor.processInvocation(ConcurrentContextInterceptor.java:45)\n\tat org.jboss.invocation.InterceptorContext.proceed(InterceptorContext.java:422)\n\tat org.jboss.invocation.InitialInterceptor.processInvocation(InitialInterceptor.java:40)\n\tat org.jboss.invocation.InterceptorContext.proceed(InterceptorContext.java:422)\n\tat org.jboss.invocation.ChainedInterceptor.processInvocation(ChainedInterceptor.java:53)\n\tat org.jboss.as.ee.component.interceptors.ComponentDispatcherInterceptor.processInvocation(ComponentDispatcherInterceptor.java:52)\n\tat org.jboss.invocation.InterceptorContext.proceed(InterceptorContext.java:422)\n\tat org.jboss.as.ejb3.component.pool.PooledInstanceInterceptor.processInvocation(PooledInstanceInterceptor.java:51)\n\tat org.jboss.invocation.InterceptorContext.proceed(InterceptorContext.java:422)\n\tat org.jboss.as.ejb3.component.interceptors.AdditionalSetupInterceptor.processInvocation(AdditionalSetupInterceptor.java:54)\n\tat org.jboss.invocation.InterceptorContext.proceed(InterceptorContext.java:422)\n\tat org.jboss.as.ejb3.tx.CMTTxInterceptor.invokeInOurTx(CMTTxInterceptor.java:252)", "url": "https://github.com/wildfly/wildfly/pull/13684#discussion_r521901590", "createdAt": "2020-11-12T07:57:59Z", "author": {"login": "soul2zimate"}, "path": "testsuite/integration/ws/src/test/java/org/jboss/as/test/integration/ws/basic/EJBEndpointTestCase.java", "diffHunk": "@@ -52,7 +52,12 @@\n         JavaArchive jar = ShrinkWrap.create(JavaArchive.class, \"jaxws-basic-ejb.jar\")\n                 .addClasses(EndpointIface.class, EJBEndpoint.class, HelloObject.class);\n         // EJBEndpoint#helloError needs getClassLoader permission for SOAPFactory.newInstance() invocation which is not supposed(??? at least it seems so) to be called from deployments", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODQzNDU0NQ=="}, "originalCommit": {"oid": "2eb83e26ee6174b660f683d8e1ffc6763202a9af"}, "originalPosition": 3}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTIwMzc0MA==", "bodyText": "Thank you @soul2zimate. The comment addresses my concerns. \ud83d\udc4d\n@jimma I'll leave approving this PR to you. Please @ ping me when you do to decrease the chances it sits unmerged. Thanks!", "url": "https://github.com/wildfly/wildfly/pull/13684#discussion_r525203740", "createdAt": "2020-11-17T14:38:17Z", "author": {"login": "bstansberry"}, "path": "testsuite/integration/ws/src/test/java/org/jboss/as/test/integration/ws/basic/EJBEndpointTestCase.java", "diffHunk": "@@ -52,7 +52,12 @@\n         JavaArchive jar = ShrinkWrap.create(JavaArchive.class, \"jaxws-basic-ejb.jar\")\n                 .addClasses(EndpointIface.class, EJBEndpoint.class, HelloObject.class);\n         // EJBEndpoint#helloError needs getClassLoader permission for SOAPFactory.newInstance() invocation which is not supposed(??? at least it seems so) to be called from deployments", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODQzNDU0NQ=="}, "originalCommit": {"oid": "2eb83e26ee6174b660f683d8e1ffc6763202a9af"}, "originalPosition": 3}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTcxMTU0NA==", "bodyText": "@bstansberry  This looks good to me. +1 to merge this .  Thanks @soul2zimate", "url": "https://github.com/wildfly/wildfly/pull/13684#discussion_r525711544", "createdAt": "2020-11-18T03:12:56Z", "author": {"login": "jimma"}, "path": "testsuite/integration/ws/src/test/java/org/jboss/as/test/integration/ws/basic/EJBEndpointTestCase.java", "diffHunk": "@@ -52,7 +52,12 @@\n         JavaArchive jar = ShrinkWrap.create(JavaArchive.class, \"jaxws-basic-ejb.jar\")\n                 .addClasses(EndpointIface.class, EJBEndpoint.class, HelloObject.class);\n         // EJBEndpoint#helloError needs getClassLoader permission for SOAPFactory.newInstance() invocation which is not supposed(??? at least it seems so) to be called from deployments", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODQzNDU0NQ=="}, "originalCommit": {"oid": "2eb83e26ee6174b660f683d8e1ffc6763202a9af"}, "originalPosition": 3}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4147, "cost": 1, "resetAt": "2021-11-13T14:23:39Z"}}}