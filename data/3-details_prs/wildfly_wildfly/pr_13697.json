{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE4NTQ3Mzk3", "number": 13697, "title": "WFLY-14055 Implement caching inside ExternalBeanArchiveProcessor to i\u2026", "bodyText": "\u2026mprove deployment times for big applications.\nJIRA link - https://issues.redhat.com/browse/WFLY-14055\nThis attempts to solve an issue with deployment times for massive applications using Weld.\nThe numbers plus reproducer can be seen in the JIRA issue.\nLocally I have only verified this against basic integration suite, so if more issues popup, I'll look into it.\n@mkouba I'd like to hear your take on this. I am aware that map of maps isn't exactly nice, but it seems to get the job done here.", "createdAt": "2020-11-10T14:55:43Z", "url": "https://github.com/wildfly/wildfly/pull/13697", "merged": true, "mergeCommit": {"oid": "10b82f8d7ebffbd696034d0e8b1330f9a7f81796"}, "closed": true, "closedAt": "2020-11-11T23:23:31Z", "author": {"login": "manovotn"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdbLELzgBqjM5Nzk1MDM3MjA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdbmcu5AFqTUyODYwNzYwNQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "89d5321c2ebade085af83228703c0b77d1120301", "author": {"user": {"login": "manovotn", "name": "Matej Novotny"}}, "url": "https://github.com/wildfly/wildfly/commit/89d5321c2ebade085af83228703c0b77d1120301", "committedDate": "2020-11-10T14:51:59Z", "message": "WFLY-14055 Implement caching inside ExternalBeanArchiveProcessor to improve deployment times for big applications."}, "afterCommit": {"oid": "25f4df73b14e357e710757a4e686bab597142862", "author": {"user": {"login": "manovotn", "name": "Matej Novotny"}}, "url": "https://github.com/wildfly/wildfly/commit/25f4df73b14e357e710757a4e686bab597142862", "committedDate": "2020-11-10T15:26:31Z", "message": "WFLY-14055 Implement caching inside ExternalBeanArchiveProcessor to improve deployment times for big applications."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI3NTU4MzE1", "url": "https://github.com/wildfly/wildfly/pull/13697#pullrequestreview-527558315", "createdAt": "2020-11-10T19:55:59Z", "commit": {"oid": "25f4df73b14e357e710757a4e686bab597142862"}, "state": "DISMISSED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQxOTo1NjowMFrOHwtUvg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQxOTo1NjowMFrOHwtUvg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDgzNjI4Ng==", "bodyText": "This will always return false as the keys are dependencyModule.getName().", "url": "https://github.com/wildfly/wildfly/pull/13697#discussion_r520836286", "createdAt": "2020-11-10T19:56:00Z", "author": {"login": "bstansberry"}, "path": "weld/subsystem/src/main/java/org/jboss/as/weld/deployment/processors/ExternalBeanArchiveProcessor.java", "diffHunk": "@@ -325,9 +328,13 @@ private Index tryLoadIndex(URL indexUrl) {\n      * @param dependencyModule\n      * @return the map of exported resources\n      */\n-    private Map<URL, URL> findExportedResources(Module dependencyModule) {\n+    private Map<URL, URL> findExportedResources(Module dependencyModule, Map<String, Map<URL, URL>> exportedResourcesCache) {\n+        if (exportedResourcesCache.containsKey(dependencyModule)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "25f4df73b14e357e710757a4e686bab597142862"}, "originalPosition": 25}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "34088875f09252d608c30a42780ac306d23ff106", "author": {"user": {"login": "manovotn", "name": "Matej Novotny"}}, "url": "https://github.com/wildfly/wildfly/commit/34088875f09252d608c30a42780ac306d23ff106", "committedDate": "2020-11-11T05:35:05Z", "message": "WFLY-14055 Implement caching inside ExternalBeanArchiveProcessor to improve deployment times for big applications."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "25f4df73b14e357e710757a4e686bab597142862", "author": {"user": {"login": "manovotn", "name": "Matej Novotny"}}, "url": "https://github.com/wildfly/wildfly/commit/25f4df73b14e357e710757a4e686bab597142862", "committedDate": "2020-11-10T15:26:31Z", "message": "WFLY-14055 Implement caching inside ExternalBeanArchiveProcessor to improve deployment times for big applications."}, "afterCommit": {"oid": "34088875f09252d608c30a42780ac306d23ff106", "author": {"user": {"login": "manovotn", "name": "Matej Novotny"}}, "url": "https://github.com/wildfly/wildfly/commit/34088875f09252d608c30a42780ac306d23ff106", "committedDate": "2020-11-11T05:35:05Z", "message": "WFLY-14055 Implement caching inside ExternalBeanArchiveProcessor to improve deployment times for big applications."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "02a7739a7328f7770a433f65a4563fca346b06bb", "author": {"user": {"login": "manovotn", "name": "Matej Novotny"}}, "url": "https://github.com/wildfly/wildfly/commit/02a7739a7328f7770a433f65a4563fca346b06bb", "committedDate": "2020-11-11T13:56:10Z", "message": "WFLY-14055 Optimize BeanDeploymentArchiveImpl, avoid calling Module.getIdentifier."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI4MjE3ODI1", "url": "https://github.com/wildfly/wildfly/pull/13697#pullrequestreview-528217825", "createdAt": "2020-11-11T14:25:19Z", "commit": {"oid": "02a7739a7328f7770a433f65a4563fca346b06bb"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMVQxNDoyNToxOVrOHxPVWg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMVQxNDoyNToxOVrOHxPVWg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTM5MzQ5OA==", "bodyText": "This is the only part where I am not certain - the comparison takes the name of ModuleDependencySpec and that of a Module. But I assume that if their identifiers were comparable and those were replaced by String names, then the names should be comparable as well. Feel free to prove me wrong.", "url": "https://github.com/wildfly/wildfly/pull/13697#discussion_r521393498", "createdAt": "2020-11-11T14:25:19Z", "author": {"login": "manovotn"}, "path": "weld/subsystem/src/main/java/org/jboss/as/weld/deployment/BeanDeploymentArchiveImpl.java", "diffHunk": "@@ -239,11 +239,12 @@ public boolean isAccessible(BeanDeploymentArchive target) {\n             return true;\n         }\n \n+        final String thatIdentifier = that.getModule().getName();\n         // basic check whether the module is our dependency\n         for (DependencySpec dependency : module.getDependencies()) {\n             if (dependency instanceof ModuleDependencySpec) {\n                 ModuleDependencySpec moduleDependency = (ModuleDependencySpec) dependency;\n-                if (moduleDependency.getIdentifier().equals(that.getModule().getIdentifier())) {\n+                if (moduleDependency.getName().equals(thatIdentifier)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "02a7739a7328f7770a433f65a4563fca346b06bb"}, "originalPosition": 10}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI4NjA3NjA1", "url": "https://github.com/wildfly/wildfly/pull/13697#pullrequestreview-528607605", "createdAt": "2020-11-11T23:20:58Z", "commit": {"oid": "02a7739a7328f7770a433f65a4563fca346b06bb"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3834, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}