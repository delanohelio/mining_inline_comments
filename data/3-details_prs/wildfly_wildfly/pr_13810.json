{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTM2MzIwNTMw", "number": 13810, "title": "WFLY-14110 Distributed session manager reports HttpSession.getLastAccessedTime() incorrectly", "bodyText": "https://issues.redhat.com/browse/WFLY-14110", "createdAt": "2020-12-10T22:57:32Z", "url": "https://github.com/wildfly/wildfly/pull/13810", "merged": true, "mergeCommit": {"oid": "4ee6e02c1d9087d3dcf5e44a266c09cf90072abf"}, "closed": true, "closedAt": "2021-01-04T02:09:18Z", "author": {"login": "pferraro"}, "timelineItems": {"totalCount": 20, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdk75OogFqTU0OTY5MTkxMw==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdsQfKGgBqjQxNjE4NDg0OTQ=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ5NjkxOTEz", "url": "https://github.com/wildfly/wildfly/pull/13810#pullrequestreview-549691913", "createdAt": "2020-12-10T23:25:25Z", "commit": {"oid": "eb997287bf90663ce3ca9318c6dd041d7cee2202"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMFQyMzoyNToyNVrOIDiGPA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMFQyMzoyNToyNVrOIDiGPA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDU3NTI5Mg==", "bodyText": "What does 'newly created' mean? First request for the session id anywhere in the cluster? Locally?", "url": "https://github.com/wildfly/wildfly/pull/13810#discussion_r540575292", "createdAt": "2020-12-10T23:25:25Z", "author": {"login": "bstansberry"}, "path": "clustering/web/cache/src/main/java/org/wildfly/clustering/web/cache/session/SessionCreationMetaData.java", "diffHunk": "@@ -28,11 +28,31 @@\n  * The more static aspects of a session's meta-data.\n  * @author Paul Ferraro\n  */\n-public interface SessionCreationMetaData extends ImmutableSessionCreationMetaData {\n-\n+public interface SessionCreationMetaData extends ImmutableSessionCreationMetaData, AutoCloseable {\n+    /**\n+     * Sets the maximum duration of time this session may remain idle before it will be expired by the session manager.\n+     * @param a maximum duration of time this session may remain idle before it will be expired by the session manager.\n+     */\n     void setMaxInactiveInterval(Duration duration);\n \n+    /**\n+     * Indicates whether or not this session has been invalidated.\n+     * @return true, if this session was invalidated, false otherwise.\n+     */\n     boolean isValid();\n \n+    /**\n+     * Invalidates this session.\n+     * @return true, if this session was previous valid, false otherwise\n+     */\n     boolean invalidate();\n+\n+    /**\n+     * Indicates whether or not this session was newly created.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "eb997287bf90663ce3ca9318c6dd041d7cee2202"}, "originalPosition": 26}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ5NjkzMTc1", "url": "https://github.com/wildfly/wildfly/pull/13810#pullrequestreview-549693175", "createdAt": "2020-12-10T23:28:22Z", "commit": {"oid": "eb997287bf90663ce3ca9318c6dd041d7cee2202"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMFQyMzoyODoyMlrOIDiLMw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMFQyMzoyODoyMlrOIDiLMw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDU3NjU2Mw==", "bodyText": "What is the expected use of this? From looking at the PR it seems it's meant to be called at some point and that changes what isNew() would return. But 'close()' as a method name doesn't say that, which is ok so long as the expected use of close() will have that effect. But the expected use is ???.", "url": "https://github.com/wildfly/wildfly/pull/13810#discussion_r540576563", "createdAt": "2020-12-10T23:28:22Z", "author": {"login": "bstansberry"}, "path": "clustering/web/cache/src/main/java/org/wildfly/clustering/web/cache/session/SessionCreationMetaData.java", "diffHunk": "@@ -28,11 +28,31 @@\n  * The more static aspects of a session's meta-data.\n  * @author Paul Ferraro\n  */\n-public interface SessionCreationMetaData extends ImmutableSessionCreationMetaData {\n-\n+public interface SessionCreationMetaData extends ImmutableSessionCreationMetaData, AutoCloseable {\n+    /**\n+     * Sets the maximum duration of time this session may remain idle before it will be expired by the session manager.\n+     * @param a maximum duration of time this session may remain idle before it will be expired by the session manager.\n+     */\n     void setMaxInactiveInterval(Duration duration);\n \n+    /**\n+     * Indicates whether or not this session has been invalidated.\n+     * @return true, if this session was invalidated, false otherwise.\n+     */\n     boolean isValid();\n \n+    /**\n+     * Invalidates this session.\n+     * @return true, if this session was previous valid, false otherwise\n+     */\n     boolean invalidate();\n+\n+    /**\n+     * Indicates whether or not this session was newly created.\n+     * @return true, if this session was newly created, false otherwise.\n+     */\n+    boolean isNew();\n+\n+    @Override\n+    void close();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "eb997287bf90663ce3ca9318c6dd041d7cee2202"}, "originalPosition": 32}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ5NzAzNTkw", "url": "https://github.com/wildfly/wildfly/pull/13810#pullrequestreview-549703590", "createdAt": "2020-12-10T23:52:48Z", "commit": {"oid": "eb997287bf90663ce3ca9318c6dd041d7cee2202"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMFQyMzo1Mjo0OFrOIDizsg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMFQyMzo1Mjo0OFrOIDizsg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDU4NjkzMA==", "bodyText": "Is a new one of these DistributableSession objects created per request?\nMust be or startTime would not change and the Batch object passed to the c'tor doesn't sound like something that would span requests.", "url": "https://github.com/wildfly/wildfly/pull/13810#discussion_r540586930", "createdAt": "2020-12-10T23:52:48Z", "author": {"login": "bstansberry"}, "path": "clustering/web/undertow/src/main/java/org/wildfly/clustering/web/undertow/session/DistributableSession.java", "diffHunk": "@@ -87,6 +90,11 @@ public void requestDone(HttpServerExchange exchange) {\n                     }\n                     // If batch is closed, close session in a new batch\n                     try (Batch batch = (this.batch.getState() == Batch.State.CLOSED) ? batcher.createBatch() : this.batch) {\n+                        if (this.startTime != null) {\n+                            // According to \u00a77.6 of the servlet specification:\n+                            // The session is considered to be accessed when a request that is part of the session is first handled by the servlet container.\n+                            session.getMetaData().setLastAccessedTime(this.startTime);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "eb997287bf90663ce3ca9318c6dd041d7cee2202"}, "originalPosition": 31}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUwNjI0MDY1", "url": "https://github.com/wildfly/wildfly/pull/13810#pullrequestreview-550624065", "createdAt": "2020-12-11T22:39:54Z", "commit": {"oid": "1ce356ef8d9e19813a9617cad6dbbe2b9e1f0e9e"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUwOTk0NDUz", "url": "https://github.com/wildfly/wildfly/pull/13810#pullrequestreview-550994453", "createdAt": "2020-12-14T01:40:51Z", "commit": {"oid": "1ce356ef8d9e19813a9617cad6dbbe2b9e1f0e9e"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUyMDM4NzM3", "url": "https://github.com/wildfly/wildfly/pull/13810#pullrequestreview-552038737", "createdAt": "2020-12-15T01:34:58Z", "commit": {"oid": "765bfb75640f713736ae1fe75139fda0233ab854"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "765bfb75640f713736ae1fe75139fda0233ab854", "author": {"user": {"login": "pferraro", "name": "Paul Ferraro"}}, "url": "https://github.com/wildfly/wildfly/commit/765bfb75640f713736ae1fe75139fda0233ab854", "committedDate": "2020-12-14T16:04:22Z", "message": "Replace VolatileReference with AtomicReference."}, "afterCommit": {"oid": "505649cd9bea8c223acd716f562754106f8ecd11", "author": {"user": {"login": "pferraro", "name": "Paul Ferraro"}}, "url": "https://github.com/wildfly/wildfly/commit/505649cd9bea8c223acd716f562754106f8ecd11", "committedDate": "2020-12-15T15:28:54Z", "message": "Replace VolatileReference with AtomicReference."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "505649cd9bea8c223acd716f562754106f8ecd11", "author": {"user": {"login": "pferraro", "name": "Paul Ferraro"}}, "url": "https://github.com/wildfly/wildfly/commit/505649cd9bea8c223acd716f562754106f8ecd11", "committedDate": "2020-12-15T15:28:54Z", "message": "Replace VolatileReference with AtomicReference."}, "afterCommit": {"oid": "0ea78410d3a4fc0a3b50306aad4a369fb1ef4702", "author": {"user": {"login": "pferraro", "name": "Paul Ferraro"}}, "url": "https://github.com/wildfly/wildfly/commit/0ea78410d3a4fc0a3b50306aad4a369fb1ef4702", "committedDate": "2020-12-15T23:49:50Z", "message": "Replace VolatileReference with AtomicReference."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0ea78410d3a4fc0a3b50306aad4a369fb1ef4702", "author": {"user": {"login": "pferraro", "name": "Paul Ferraro"}}, "url": "https://github.com/wildfly/wildfly/commit/0ea78410d3a4fc0a3b50306aad4a369fb1ef4702", "committedDate": "2020-12-15T23:49:50Z", "message": "Replace VolatileReference with AtomicReference."}, "afterCommit": {"oid": "5c838b48c27fd8015c631c241eaa1dcd3bdc9ffb", "author": {"user": {"login": "pferraro", "name": "Paul Ferraro"}}, "url": "https://github.com/wildfly/wildfly/commit/5c838b48c27fd8015c631c241eaa1dcd3bdc9ffb", "committedDate": "2020-12-18T17:51:18Z", "message": "Replace VolatileReference with AtomicReference."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "5c838b48c27fd8015c631c241eaa1dcd3bdc9ffb", "author": {"user": {"login": "pferraro", "name": "Paul Ferraro"}}, "url": "https://github.com/wildfly/wildfly/commit/5c838b48c27fd8015c631c241eaa1dcd3bdc9ffb", "committedDate": "2020-12-18T17:51:18Z", "message": "Replace VolatileReference with AtomicReference."}, "afterCommit": {"oid": "a3d19cc62951955a0cc10280d2028c8ed03fe3f7", "author": {"user": {"login": "pferraro", "name": "Paul Ferraro"}}, "url": "https://github.com/wildfly/wildfly/commit/a3d19cc62951955a0cc10280d2028c8ed03fe3f7", "committedDate": "2020-12-21T19:32:26Z", "message": "Allow Infinispan to handle stacktraces containing JBoss Marshalling exceptions."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a3d19cc62951955a0cc10280d2028c8ed03fe3f7", "author": {"user": {"login": "pferraro", "name": "Paul Ferraro"}}, "url": "https://github.com/wildfly/wildfly/commit/a3d19cc62951955a0cc10280d2028c8ed03fe3f7", "committedDate": "2020-12-21T19:32:26Z", "message": "Allow Infinispan to handle stacktraces containing JBoss Marshalling exceptions."}, "afterCommit": {"oid": "f122e1f3f82cd2219611e3154e4beca324f42bf3", "author": {"user": {"login": "pferraro", "name": "Paul Ferraro"}}, "url": "https://github.com/wildfly/wildfly/commit/f122e1f3f82cd2219611e3154e4beca324f42bf3", "committedDate": "2020-12-21T21:44:11Z", "message": "Throw AssertionError instead of NotSerializableException to bypass JBossMarshalling TraceInformation logic."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f122e1f3f82cd2219611e3154e4beca324f42bf3", "author": {"user": {"login": "pferraro", "name": "Paul Ferraro"}}, "url": "https://github.com/wildfly/wildfly/commit/f122e1f3f82cd2219611e3154e4beca324f42bf3", "committedDate": "2020-12-21T21:44:11Z", "message": "Throw AssertionError instead of NotSerializableException to bypass JBossMarshalling TraceInformation logic."}, "afterCommit": {"oid": "5d7a1cc986e9e5f7ec4c39c0119b34569b7b69d7", "author": {"user": {"login": "pferraro", "name": "Paul Ferraro"}}, "url": "https://github.com/wildfly/wildfly/commit/5d7a1cc986e9e5f7ec4c39c0119b34569b7b69d7", "committedDate": "2020-12-27T17:56:46Z", "message": "Fix subsecond premature hotrod expiration"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "28423b2bcb8a7aa48312be6e3f9f320104c7779d", "author": {"user": {"login": "pferraro", "name": "Paul Ferraro"}}, "url": "https://github.com/wildfly/wildfly/commit/28423b2bcb8a7aa48312be6e3f9f320104c7779d", "committedDate": "2021-01-02T16:18:24Z", "message": "WFLY-14110 Distributed session manager reports HttpSession.getLastAccessedTime() incorrectly"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "939fa009ef02449ce6011e2c11b00aac8009cebc", "author": {"user": {"login": "pferraro", "name": "Paul Ferraro"}}, "url": "https://github.com/wildfly/wildfly/commit/939fa009ef02449ce6011e2c11b00aac8009cebc", "committedDate": "2021-01-02T16:18:24Z", "message": "Add javadoc to clarify #close() semantics."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "64092fc44ee2b2f97699ff9b60db4d102bfea602", "author": {"user": {"login": "pferraro", "name": "Paul Ferraro"}}, "url": "https://github.com/wildfly/wildfly/commit/64092fc44ee2b2f97699ff9b60db4d102bfea602", "committedDate": "2021-01-02T16:18:24Z", "message": "WFLY-14225 Concurrent writes to ATTRIBUTE granularity session can cause missing session passivation/activation events"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0b98949877e159487cab1e773868d694954b85b3", "author": {"user": {"login": "pferraro", "name": "Paul Ferraro"}}, "url": "https://github.com/wildfly/wildfly/commit/0b98949877e159487cab1e773868d694954b85b3", "committedDate": "2021-01-02T16:18:24Z", "message": "Replace VolatileReference with AtomicReference."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "00c6052c8c1fe2c6d8032807cc8a06db84e17977", "author": {"user": {"login": "pferraro", "name": "Paul Ferraro"}}, "url": "https://github.com/wildfly/wildfly/commit/00c6052c8c1fe2c6d8032807cc8a06db84e17977", "committedDate": "2021-01-02T16:18:24Z", "message": "Throw AssertionError instead of NotSerializableException to bypass JBossMarshalling TraceInformation logic."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e0aa5662c24bc6031fb0fa74efd12380fafbffe2", "author": {"user": {"login": "pferraro", "name": "Paul Ferraro"}}, "url": "https://github.com/wildfly/wildfly/commit/e0aa5662c24bc6031fb0fa74efd12380fafbffe2", "committedDate": "2021-01-02T16:18:24Z", "message": "Fix subsecond premature hotrod expiration"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e758945ae24e4d84197613a43c359f23823c1722", "author": {"user": {"login": "pferraro", "name": "Paul Ferraro"}}, "url": "https://github.com/wildfly/wildfly/commit/e758945ae24e4d84197613a43c359f23823c1722", "committedDate": "2021-01-02T17:01:47Z", "message": "Avoid concurrency during remove from non-owner."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "5d7a1cc986e9e5f7ec4c39c0119b34569b7b69d7", "author": {"user": {"login": "pferraro", "name": "Paul Ferraro"}}, "url": "https://github.com/wildfly/wildfly/commit/5d7a1cc986e9e5f7ec4c39c0119b34569b7b69d7", "committedDate": "2020-12-27T17:56:46Z", "message": "Fix subsecond premature hotrod expiration"}, "afterCommit": {"oid": "e758945ae24e4d84197613a43c359f23823c1722", "author": {"user": {"login": "pferraro", "name": "Paul Ferraro"}}, "url": "https://github.com/wildfly/wildfly/commit/e758945ae24e4d84197613a43c359f23823c1722", "committedDate": "2021-01-02T17:01:47Z", "message": "Avoid concurrency during remove from non-owner."}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3699, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}