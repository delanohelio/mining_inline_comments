{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTEzMTQ2MDIy", "number": 1655, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMVQwNjo1MjoyOVrOE0BTCQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMVQwMDowMDowMVrOE0F44Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIyOTgyNjY1OnYy", "diffSide": "RIGHT", "path": "fhir-database-utils/src/main/java/com/ibm/fhir/database/utils/model/ProcedureDef.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMVQwNjo1MjoyOVrOHrlewQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMVQwMDowMDozMFrOHrrAPA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTQ2NDg5Nw==", "bodyText": "does this comment invalidate the comment on the previous line?", "url": "https://github.com/IBM/FHIR/pull/1655#discussion_r515464897", "createdAt": "2020-10-31T06:52:29Z", "author": {"login": "lmsurpre"}, "path": "fhir-database-utils/src/main/java/com/ibm/fhir/database/utils/model/ProcedureDef.java", "diffHunk": "@@ -49,6 +50,8 @@ public void apply(Integer priorVersion, IDatabaseAdapter target) {\n         }\n \n         // Procedures are applied with \"Create or replace\", so just do a regular apply\n+        // we need to drop and then apply.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ade14246bd2e49dde8f3247e2b79222cca3f856f"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTU1NTM4OA==", "bodyText": "Yes, you are right.   Fixed", "url": "https://github.com/IBM/FHIR/pull/1655#discussion_r515555388", "createdAt": "2020-11-01T00:00:30Z", "author": {"login": "prb112"}, "path": "fhir-database-utils/src/main/java/com/ibm/fhir/database/utils/model/ProcedureDef.java", "diffHunk": "@@ -49,6 +50,8 @@ public void apply(Integer priorVersion, IDatabaseAdapter target) {\n         }\n \n         // Procedures are applied with \"Create or replace\", so just do a regular apply\n+        // we need to drop and then apply.", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTQ2NDg5Nw=="}, "originalCommit": {"oid": "ade14246bd2e49dde8f3247e2b79222cca3f856f"}, "originalPosition": 12}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIyOTgyOTcxOnYy", "diffSide": "RIGHT", "path": "fhir-persistence-schema/src/main/java/com/ibm/fhir/schema/app/Main.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMVQwNjo1NjozOFrOHrlgHw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQxNzo0NToxMVrOHsPSGA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTQ2NTI0Nw==", "bodyText": "I think its fine, but where were we starting the transaction before?", "url": "https://github.com/IBM/FHIR/pull/1655#discussion_r515465247", "createdAt": "2020-10-31T06:56:38Z", "author": {"login": "lmsurpre"}, "path": "fhir-persistence-schema/src/main/java/com/ibm/fhir/schema/app/Main.java", "diffHunk": "@@ -464,21 +464,22 @@ protected void updateProcedures() {\n \n         // Now only apply the procedures in the model. Much faster than\n         // going through the whole schema\n-        try {\n-            try (Connection c = createConnection()) {\n+        try (ITransaction tx = TransactionFactory.openTransaction(connectionPool)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ade14246bd2e49dde8f3247e2b79222cca3f856f"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTU1NTI2NA==", "bodyText": "We were not starting a transaction before, we were using a statement which autocommitted the change.", "url": "https://github.com/IBM/FHIR/pull/1655#discussion_r515555264", "createdAt": "2020-10-31T23:59:18Z", "author": {"login": "prb112"}, "path": "fhir-persistence-schema/src/main/java/com/ibm/fhir/schema/app/Main.java", "diffHunk": "@@ -464,21 +464,22 @@ protected void updateProcedures() {\n \n         // Now only apply the procedures in the model. Much faster than\n         // going through the whole schema\n-        try {\n-            try (Connection c = createConnection()) {\n+        try (ITransaction tx = TransactionFactory.openTransaction(connectionPool)) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTQ2NTI0Nw=="}, "originalCommit": {"oid": "ade14246bd2e49dde8f3247e2b79222cca3f856f"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjE0OTc4NA==", "bodyText": "ah, ok.  i remember trying something like this in the past and getting into trouble with the migration code...but I think that was before robin cleaned up all the transaction handling.  tests are passing, so i'm good if @punktilious is", "url": "https://github.com/IBM/FHIR/pull/1655#discussion_r516149784", "createdAt": "2020-11-02T17:45:11Z", "author": {"login": "lmsurpre"}, "path": "fhir-persistence-schema/src/main/java/com/ibm/fhir/schema/app/Main.java", "diffHunk": "@@ -464,21 +464,22 @@ protected void updateProcedures() {\n \n         // Now only apply the procedures in the model. Much faster than\n         // going through the whole schema\n-        try {\n-            try (Connection c = createConnection()) {\n+        try (ITransaction tx = TransactionFactory.openTransaction(connectionPool)) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTQ2NTI0Nw=="}, "originalCommit": {"oid": "ade14246bd2e49dde8f3247e2b79222cca3f856f"}, "originalPosition": 6}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIzMDU3ODg5OnYy", "diffSide": "RIGHT", "path": "fhir-database-utils/src/main/java/com/ibm/fhir/database/utils/model/ProcedureDef.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMVQwMDowMDowMVrOHrrAEQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMVQwMDowMDowMVrOHrrAEQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTU1NTM0NQ==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    // Procedures are applied with \"Create or replace\", so just do a regular apply", "url": "https://github.com/IBM/FHIR/pull/1655#discussion_r515555345", "createdAt": "2020-11-01T00:00:01Z", "author": {"login": "prb112"}, "path": "fhir-database-utils/src/main/java/com/ibm/fhir/database/utils/model/ProcedureDef.java", "diffHunk": "@@ -49,6 +50,8 @@ public void apply(Integer priorVersion, IDatabaseAdapter target) {\n         }\n \n         // Procedures are applied with \"Create or replace\", so just do a regular apply", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ade14246bd2e49dde8f3247e2b79222cca3f856f"}, "originalPosition": 11}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4591, "cost": 1, "resetAt": "2021-11-13T12:10:21Z"}}}