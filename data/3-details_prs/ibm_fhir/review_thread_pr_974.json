{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA3NTQ3Nzcx", "number": 974, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yM1QyMDozNzo1MFrOD1dxzA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yNFQxMzoyNDo0MlrOD1xeXw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU3Mzg5MDA0OnYy", "diffSide": "RIGHT", "path": "fhir-persistence-jdbc/src/main/java/com/ibm/fhir/persistence/jdbc/impl/FHIRPersistenceJDBCImpl.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yM1QyMDozNzo1MFrOGK7F5w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yM1QyMDozNzo1MFrOGK7F5w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDEwNzExMQ==", "bodyText": "the changes here are mostly just for style:  by moving the exception cases to the top, i reduced the main code block by two levels of indentation", "url": "https://github.com/IBM/FHIR/pull/974#discussion_r414107111", "createdAt": "2020-04-23T20:37:50Z", "author": {"login": "lmsurpre"}, "path": "fhir-persistence-jdbc/src/main/java/com/ibm/fhir/persistence/jdbc/impl/FHIRPersistenceJDBCImpl.java", "diffHunk": "@@ -567,75 +567,77 @@ private ResourceDAO getResourceDao() {\n         try {\n             existingResourceDTO = this.getResourceDao().read(logicalId, resourceType.getSimpleName());\n \n-            if (existingResourceDTO != null) {\n-                if (existingResourceDTO.isDeleted()) {\n-                    existingResource = this.convertResourceDTO(existingResourceDTO, resourceType, null);\n-                    resourceBuilder = existingResource.toBuilder();\n-\n-                    SingleResourceResult<T> result = new SingleResourceResult.Builder<T>()\n-                            .success(true)\n-                            .resource(existingResource)\n-                            .build();\n+            if (existingResourceDTO == null) {\n+                throw new FHIRPersistenceResourceNotFoundException(\"resource does not exist: \" + \n+                        resourceType.getSimpleName() + \":\" + logicalId);\n+            }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "02eeff5c120a98d7072f10f06a417ad3f1dcc7a9"}, "originalPosition": 16}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU3NjgwMDk0OnYy", "diffSide": "RIGHT", "path": "fhir-persistence-jdbc/src/main/java/com/ibm/fhir/persistence/jdbc/impl/FHIRPersistenceJDBCImpl.java", "isResolved": true, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yNFQxMjowOToyNFrOGLUpoQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yNFQxMzoyNDowM1rOGLXggQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDUyNTg1Nw==", "bodyText": "2 \":\" seems a little bit strange, can we change to\nresourceType.getSimpleName() + \":\" + logicalId\" + \"does not exist.\"\nor use the same style as the other warning info of the following codes.", "url": "https://github.com/IBM/FHIR/pull/974#discussion_r414525857", "createdAt": "2020-04-24T12:09:24Z", "author": {"login": "albertwang-ibm"}, "path": "fhir-persistence-jdbc/src/main/java/com/ibm/fhir/persistence/jdbc/impl/FHIRPersistenceJDBCImpl.java", "diffHunk": "@@ -567,75 +567,77 @@ private ResourceDAO getResourceDao() {\n         try {\n             existingResourceDTO = this.getResourceDao().read(logicalId, resourceType.getSimpleName());\n \n-            if (existingResourceDTO != null) {\n-                if (existingResourceDTO.isDeleted()) {\n-                    existingResource = this.convertResourceDTO(existingResourceDTO, resourceType, null);\n-                    resourceBuilder = existingResource.toBuilder();\n-\n-                    SingleResourceResult<T> result = new SingleResourceResult.Builder<T>()\n-                            .success(true)\n-                            .resource(existingResource)\n-                            .build();\n+            if (existingResourceDTO == null) {\n+                throw new FHIRPersistenceResourceNotFoundException(\"resource does not exist: \" + \n+                        resourceType.getSimpleName() + \":\" + logicalId);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "02eeff5c120a98d7072f10f06a417ad3f1dcc7a9"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDUzMDgzNw==", "bodyText": "Adding to Albert's comments... we should bracket the values in the message.", "url": "https://github.com/IBM/FHIR/pull/974#discussion_r414530837", "createdAt": "2020-04-24T12:17:43Z", "author": {"login": "prb112"}, "path": "fhir-persistence-jdbc/src/main/java/com/ibm/fhir/persistence/jdbc/impl/FHIRPersistenceJDBCImpl.java", "diffHunk": "@@ -567,75 +567,77 @@ private ResourceDAO getResourceDao() {\n         try {\n             existingResourceDTO = this.getResourceDao().read(logicalId, resourceType.getSimpleName());\n \n-            if (existingResourceDTO != null) {\n-                if (existingResourceDTO.isDeleted()) {\n-                    existingResource = this.convertResourceDTO(existingResourceDTO, resourceType, null);\n-                    resourceBuilder = existingResource.toBuilder();\n-\n-                    SingleResourceResult<T> result = new SingleResourceResult.Builder<T>()\n-                            .success(true)\n-                            .resource(existingResource)\n-                            .build();\n+            if (existingResourceDTO == null) {\n+                throw new FHIRPersistenceResourceNotFoundException(\"resource does not exist: \" + \n+                        resourceType.getSimpleName() + \":\" + logicalId);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDUyNTg1Nw=="}, "originalCommit": {"oid": "02eeff5c120a98d7072f10f06a417ad3f1dcc7a9"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDU3MTEzNA==", "bodyText": "My PR didn't actually change the error message from before, but I agree with these comments and will address now.", "url": "https://github.com/IBM/FHIR/pull/974#discussion_r414571134", "createdAt": "2020-04-24T13:21:50Z", "author": {"login": "lmsurpre"}, "path": "fhir-persistence-jdbc/src/main/java/com/ibm/fhir/persistence/jdbc/impl/FHIRPersistenceJDBCImpl.java", "diffHunk": "@@ -567,75 +567,77 @@ private ResourceDAO getResourceDao() {\n         try {\n             existingResourceDTO = this.getResourceDao().read(logicalId, resourceType.getSimpleName());\n \n-            if (existingResourceDTO != null) {\n-                if (existingResourceDTO.isDeleted()) {\n-                    existingResource = this.convertResourceDTO(existingResourceDTO, resourceType, null);\n-                    resourceBuilder = existingResource.toBuilder();\n-\n-                    SingleResourceResult<T> result = new SingleResourceResult.Builder<T>()\n-                            .success(true)\n-                            .resource(existingResource)\n-                            .build();\n+            if (existingResourceDTO == null) {\n+                throw new FHIRPersistenceResourceNotFoundException(\"resource does not exist: \" + \n+                        resourceType.getSimpleName() + \":\" + logicalId);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDUyNTg1Nw=="}, "originalCommit": {"oid": "02eeff5c120a98d7072f10f06a417ad3f1dcc7a9"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDU3MjY3Mw==", "bodyText": "I think I'll just change it to \"resource does not exist: \" + resourceType.getSimpleName() + \"/\" + logicalId)\nI usually like to bracket the values in ' but in this case the values can't contain spaces", "url": "https://github.com/IBM/FHIR/pull/974#discussion_r414572673", "createdAt": "2020-04-24T13:24:03Z", "author": {"login": "lmsurpre"}, "path": "fhir-persistence-jdbc/src/main/java/com/ibm/fhir/persistence/jdbc/impl/FHIRPersistenceJDBCImpl.java", "diffHunk": "@@ -567,75 +567,77 @@ private ResourceDAO getResourceDao() {\n         try {\n             existingResourceDTO = this.getResourceDao().read(logicalId, resourceType.getSimpleName());\n \n-            if (existingResourceDTO != null) {\n-                if (existingResourceDTO.isDeleted()) {\n-                    existingResource = this.convertResourceDTO(existingResourceDTO, resourceType, null);\n-                    resourceBuilder = existingResource.toBuilder();\n-\n-                    SingleResourceResult<T> result = new SingleResourceResult.Builder<T>()\n-                            .success(true)\n-                            .resource(existingResource)\n-                            .build();\n+            if (existingResourceDTO == null) {\n+                throw new FHIRPersistenceResourceNotFoundException(\"resource does not exist: \" + \n+                        resourceType.getSimpleName() + \":\" + logicalId);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDUyNTg1Nw=="}, "originalCommit": {"oid": "02eeff5c120a98d7072f10f06a417ad3f1dcc7a9"}, "originalPosition": 15}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU3Njg3MDk3OnYy", "diffSide": "RIGHT", "path": "fhir-persistence-jdbc/src/main/java/com/ibm/fhir/persistence/jdbc/impl/FHIRPersistenceJDBCImpl.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yNFQxMjoyNjozMlrOGLVR8g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yNFQxMzoyNToyOFrOGLXknA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDUzNjE3OA==", "bodyText": "wrong method name", "url": "https://github.com/IBM/FHIR/pull/974#discussion_r414536178", "createdAt": "2020-04-24T12:26:32Z", "author": {"login": "prb112"}, "path": "fhir-persistence-jdbc/src/main/java/com/ibm/fhir/persistence/jdbc/impl/FHIRPersistenceJDBCImpl.java", "diffHunk": "@@ -893,8 +902,7 @@ private ResourceDAO getResourceDao() {\n      * @throws IOException\n      */\n     protected List<Resource> buildSortedFhirResources(FHIRPersistenceContext context, Class<? extends Resource> resourceType, List<Long> sortedIdList,\n-                                                      List<String> elements)\n-                            throws FHIRException, FHIRPersistenceException, IOException {\n+            List<String> elements) throws FHIRException, FHIRPersistenceException, IOException {\n         final String METHOD_NAME = \"buildFhirResource\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "02eeff5c120a98d7072f10f06a417ad3f1dcc7a9"}, "originalPosition": 185}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDU3MzcyNA==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    final String METHOD_NAME = \"buildFhirResource\";\n          \n          \n            \n                    final String METHOD_NAME = \"buildSortedFhirResources\";", "url": "https://github.com/IBM/FHIR/pull/974#discussion_r414573724", "createdAt": "2020-04-24T13:25:28Z", "author": {"login": "lmsurpre"}, "path": "fhir-persistence-jdbc/src/main/java/com/ibm/fhir/persistence/jdbc/impl/FHIRPersistenceJDBCImpl.java", "diffHunk": "@@ -893,8 +902,7 @@ private ResourceDAO getResourceDao() {\n      * @throws IOException\n      */\n     protected List<Resource> buildSortedFhirResources(FHIRPersistenceContext context, Class<? extends Resource> resourceType, List<Long> sortedIdList,\n-                                                      List<String> elements)\n-                            throws FHIRException, FHIRPersistenceException, IOException {\n+            List<String> elements) throws FHIRException, FHIRPersistenceException, IOException {\n         final String METHOD_NAME = \"buildFhirResource\";", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDUzNjE3OA=="}, "originalCommit": {"oid": "02eeff5c120a98d7072f10f06a417ad3f1dcc7a9"}, "originalPosition": 185}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU3NzExNzExOnYy", "diffSide": "RIGHT", "path": "fhir-persistence-jdbc/src/main/java/com/ibm/fhir/persistence/jdbc/impl/FHIRPersistenceJDBCImpl.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yNFQxMzoyNDo0MlrOGLXiZw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yNFQxMzoyNDo0MlrOGLXiZw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDU3MzE1OQ==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                                    resourceType.getSimpleName() + \":\" + logicalId);\n          \n          \n            \n                                    resourceType.getSimpleName() + \"/\" + logicalId);", "url": "https://github.com/IBM/FHIR/pull/974#discussion_r414573159", "createdAt": "2020-04-24T13:24:42Z", "author": {"login": "lmsurpre"}, "path": "fhir-persistence-jdbc/src/main/java/com/ibm/fhir/persistence/jdbc/impl/FHIRPersistenceJDBCImpl.java", "diffHunk": "@@ -567,75 +567,77 @@ private ResourceDAO getResourceDao() {\n         try {\n             existingResourceDTO = this.getResourceDao().read(logicalId, resourceType.getSimpleName());\n \n-            if (existingResourceDTO != null) {\n-                if (existingResourceDTO.isDeleted()) {\n-                    existingResource = this.convertResourceDTO(existingResourceDTO, resourceType, null);\n-                    resourceBuilder = existingResource.toBuilder();\n-\n-                    SingleResourceResult<T> result = new SingleResourceResult.Builder<T>()\n-                            .success(true)\n-                            .resource(existingResource)\n-                            .build();\n+            if (existingResourceDTO == null) {\n+                throw new FHIRPersistenceResourceNotFoundException(\"resource does not exist: \" + \n+                        resourceType.getSimpleName() + \":\" + logicalId);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "02eeff5c120a98d7072f10f06a417ad3f1dcc7a9"}, "originalPosition": 15}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4976, "cost": 1, "resetAt": "2021-11-13T12:10:21Z"}}}