{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY4MjE1MTEw", "number": 647, "reviewThreads": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOVQyMTo0NjowMlrODbuvbg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOVQyMTo1MjowMlrODbu2lg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMwNDAzOTUwOnYy", "diffSide": "RIGHT", "path": "fhir-operation-bulkdata/pom.xml", "isResolved": true, "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOVQyMTo0NjowMlrOFjYoQA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0zMFQxODozNTo0MFrOFj1ghA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjY0ODAwMA==", "bodyText": "I think this should be removed.", "url": "https://github.com/IBM/FHIR/pull/647#discussion_r372648000", "createdAt": "2020-01-29T21:46:02Z", "author": {"login": "prb112"}, "path": "fhir-operation-bulkdata/pom.xml", "diffHunk": "@@ -34,5 +34,10 @@\n             <artifactId>jsonassert</artifactId>\n             <scope>test</scope>\n         </dependency>\n+        <dependency>\n+            <groupId>${project.groupId}</groupId>\n+            <artifactId>fhir-server</artifactId>\n+            <version>${project.version}</version>\n+        </dependency>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c4eda51617704a4f98a28ffc94b5a96ad88de6be"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Mjk2MjgxOA==", "bodyText": "this is added for being able to use the util function there to read config from server.xml", "url": "https://github.com/IBM/FHIR/pull/647#discussion_r372962818", "createdAt": "2020-01-30T13:59:51Z", "author": {"login": "albertwang-ibm"}, "path": "fhir-operation-bulkdata/pom.xml", "diffHunk": "@@ -34,5 +34,10 @@\n             <artifactId>jsonassert</artifactId>\n             <scope>test</scope>\n         </dependency>\n+        <dependency>\n+            <groupId>${project.groupId}</groupId>\n+            <artifactId>fhir-server</artifactId>\n+            <version>${project.version}</version>\n+        </dependency>", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjY0ODAwMA=="}, "originalCommit": {"oid": "c4eda51617704a4f98a28ffc94b5a96ad88de6be"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzEwODQyNQ==", "bodyText": "changed to use fhir server config.", "url": "https://github.com/IBM/FHIR/pull/647#discussion_r373108425", "createdAt": "2020-01-30T18:09:29Z", "author": {"login": "albertwang-ibm"}, "path": "fhir-operation-bulkdata/pom.xml", "diffHunk": "@@ -34,5 +34,10 @@\n             <artifactId>jsonassert</artifactId>\n             <scope>test</scope>\n         </dependency>\n+        <dependency>\n+            <groupId>${project.groupId}</groupId>\n+            <artifactId>fhir-server</artifactId>\n+            <version>${project.version}</version>\n+        </dependency>", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjY0ODAwMA=="}, "originalCommit": {"oid": "c4eda51617704a4f98a28ffc94b5a96ad88de6be"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzExNTAxNA==", "bodyText": "pom.xml needs to be updated - remove fhir-server", "url": "https://github.com/IBM/FHIR/pull/647#discussion_r373115014", "createdAt": "2020-01-30T18:23:08Z", "author": {"login": "prb112"}, "path": "fhir-operation-bulkdata/pom.xml", "diffHunk": "@@ -34,5 +34,10 @@\n             <artifactId>jsonassert</artifactId>\n             <scope>test</scope>\n         </dependency>\n+        <dependency>\n+            <groupId>${project.groupId}</groupId>\n+            <artifactId>fhir-server</artifactId>\n+            <version>${project.version}</version>\n+        </dependency>", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjY0ODAwMA=="}, "originalCommit": {"oid": "c4eda51617704a4f98a28ffc94b5a96ad88de6be"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzEyMTE1Ng==", "bodyText": "it's removed from the pom", "url": "https://github.com/IBM/FHIR/pull/647#discussion_r373121156", "createdAt": "2020-01-30T18:35:40Z", "author": {"login": "albertwang-ibm"}, "path": "fhir-operation-bulkdata/pom.xml", "diffHunk": "@@ -34,5 +34,10 @@\n             <artifactId>jsonassert</artifactId>\n             <scope>test</scope>\n         </dependency>\n+        <dependency>\n+            <groupId>${project.groupId}</groupId>\n+            <artifactId>fhir-server</artifactId>\n+            <version>${project.version}</version>\n+        </dependency>", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjY0ODAwMA=="}, "originalCommit": {"oid": "c4eda51617704a4f98a28ffc94b5a96ad88de6be"}, "originalPosition": 8}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMwNDA0MDg1OnYy", "diffSide": "RIGHT", "path": "fhir-operation-bulkdata/src/main/java/com/ibm/fhir/operation/bulkdata/BulkDataConstants.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOVQyMTo0NjoyNlrOFjYpBA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0zMFQxODowOTo0MFrOFj0vCw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjY0ODE5Ng==", "bodyText": "Pull this value from the tenant configuration for bulkdata or pull from the property group.", "url": "https://github.com/IBM/FHIR/pull/647#discussion_r372648196", "createdAt": "2020-01-29T21:46:26Z", "author": {"login": "prb112"}, "path": "fhir-operation-bulkdata/src/main/java/com/ibm/fhir/operation/bulkdata/BulkDataConstants.java", "diffHunk": "@@ -31,6 +36,10 @@\n     public static final String PARAM_GROUP_ID = \"groupId\";\n     public static final String PARAM_JOB = \"job\";\n \n+    // Encryption key used for JavaBatch Job ID\n+    public static final SecretKeySpec BATCHJOBID_ENCRYPTION_KEY =\n+            BulkDataConfigUtil.getBatchJobIdEncryptionKey(FHIRServerUtils.getJNDIValue(\"config/bulkDataBatchJobIdEncryptionKey\", null));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c4eda51617704a4f98a28ffc94b5a96ad88de6be"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Mjk1MTc3Nw==", "bodyText": "I don't think this need to be tenant specific. so I didn't put it into bulkdata.json or any of the per tenant config files. I considered server.xml or server.env, and thought server.xml is the better place to put this tenant independent config.", "url": "https://github.com/IBM/FHIR/pull/647#discussion_r372951777", "createdAt": "2020-01-30T13:39:27Z", "author": {"login": "albertwang-ibm"}, "path": "fhir-operation-bulkdata/src/main/java/com/ibm/fhir/operation/bulkdata/BulkDataConstants.java", "diffHunk": "@@ -31,6 +36,10 @@\n     public static final String PARAM_GROUP_ID = \"groupId\";\n     public static final String PARAM_JOB = \"job\";\n \n+    // Encryption key used for JavaBatch Job ID\n+    public static final SecretKeySpec BATCHJOBID_ENCRYPTION_KEY =\n+            BulkDataConfigUtil.getBatchJobIdEncryptionKey(FHIRServerUtils.getJNDIValue(\"config/bulkDataBatchJobIdEncryptionKey\", null));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjY0ODE5Ng=="}, "originalCommit": {"oid": "c4eda51617704a4f98a28ffc94b5a96ad88de6be"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzEwODQ5MQ==", "bodyText": "changed to use fhir server config.", "url": "https://github.com/IBM/FHIR/pull/647#discussion_r373108491", "createdAt": "2020-01-30T18:09:40Z", "author": {"login": "albertwang-ibm"}, "path": "fhir-operation-bulkdata/src/main/java/com/ibm/fhir/operation/bulkdata/BulkDataConstants.java", "diffHunk": "@@ -31,6 +36,10 @@\n     public static final String PARAM_GROUP_ID = \"groupId\";\n     public static final String PARAM_JOB = \"job\";\n \n+    // Encryption key used for JavaBatch Job ID\n+    public static final SecretKeySpec BATCHJOBID_ENCRYPTION_KEY =\n+            BulkDataConfigUtil.getBatchJobIdEncryptionKey(FHIRServerUtils.getJNDIValue(\"config/bulkDataBatchJobIdEncryptionKey\", null));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjY0ODE5Ng=="}, "originalCommit": {"oid": "c4eda51617704a4f98a28ffc94b5a96ad88de6be"}, "originalPosition": 18}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMwNDA0NjA3OnYy", "diffSide": "RIGHT", "path": "fhir-operation-bulkdata/src/main/java/com/ibm/fhir/operation/bulkdata/util/BulkDataUtil.java", "isResolved": true, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOVQyMTo0ODowNlrOFjYsGw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0zMFQxODoxMDoxMVrOFj0v8A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjY0ODk4Nw==", "bodyText": "so it will default through to the normal job id?", "url": "https://github.com/IBM/FHIR/pull/647#discussion_r372648987", "createdAt": "2020-01-29T21:48:06Z", "author": {"login": "prb112"}, "path": "fhir-operation-bulkdata/src/main/java/com/ibm/fhir/operation/bulkdata/util/BulkDataUtil.java", "diffHunk": "@@ -284,4 +287,37 @@ public static String checkAndValidateJob(Parameters parameters) throws FHIROpera\n \n         throw new FHIROperationException(\"no job identifier is passed\");\n     }\n+\n+\n+    public static String encryptBatchJobId(String strToEncrypt, SecretKeySpec key) {\n+        // Encrypt and UrlEncode the batch job id.\n+        if (key == null) {\n+            return strToEncrypt;\n+        } else {\n+            try\n+            {\n+                Cipher cp = Cipher.getInstance(\"AES/ECB/PKCS5Padding\");\n+                cp.init(Cipher.ENCRYPT_MODE, key);\n+                return java.net.URLEncoder.encode(Base64.getEncoder().encodeToString(cp.doFinal(strToEncrypt.getBytes(\"UTF-8\"))), StandardCharsets.UTF_8.name());\n+            } catch (Exception e) {\n+                return strToEncrypt;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c4eda51617704a4f98a28ffc94b5a96ad88de6be"}, "originalPosition": 98}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjY0OTI1OA==", "bodyText": "I think we should remove '+' and '=' before URL encoding", "url": "https://github.com/IBM/FHIR/pull/647#discussion_r372649258", "createdAt": "2020-01-29T21:48:40Z", "author": {"login": "prb112"}, "path": "fhir-operation-bulkdata/src/main/java/com/ibm/fhir/operation/bulkdata/util/BulkDataUtil.java", "diffHunk": "@@ -284,4 +287,37 @@ public static String checkAndValidateJob(Parameters parameters) throws FHIROpera\n \n         throw new FHIROperationException(\"no job identifier is passed\");\n     }\n+\n+\n+    public static String encryptBatchJobId(String strToEncrypt, SecretKeySpec key) {\n+        // Encrypt and UrlEncode the batch job id.\n+        if (key == null) {\n+            return strToEncrypt;\n+        } else {\n+            try\n+            {\n+                Cipher cp = Cipher.getInstance(\"AES/ECB/PKCS5Padding\");\n+                cp.init(Cipher.ENCRYPT_MODE, key);\n+                return java.net.URLEncoder.encode(Base64.getEncoder().encodeToString(cp.doFinal(strToEncrypt.getBytes(\"UTF-8\"))), StandardCharsets.UTF_8.name());\n+            } catch (Exception e) {\n+                return strToEncrypt;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjY0ODk4Nw=="}, "originalCommit": {"oid": "c4eda51617704a4f98a28ffc94b5a96ad88de6be"}, "originalPosition": 98}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Mjk1NTYzMw==", "bodyText": "yes, if the encryption key is not configured in server.xml, then the id will not be encrypted.\nen, if remove, how can we bring back the the '+' and '=' before decryption later when receiving the pulling request ...", "url": "https://github.com/IBM/FHIR/pull/647#discussion_r372955633", "createdAt": "2020-01-30T13:46:47Z", "author": {"login": "albertwang-ibm"}, "path": "fhir-operation-bulkdata/src/main/java/com/ibm/fhir/operation/bulkdata/util/BulkDataUtil.java", "diffHunk": "@@ -284,4 +287,37 @@ public static String checkAndValidateJob(Parameters parameters) throws FHIROpera\n \n         throw new FHIROperationException(\"no job identifier is passed\");\n     }\n+\n+\n+    public static String encryptBatchJobId(String strToEncrypt, SecretKeySpec key) {\n+        // Encrypt and UrlEncode the batch job id.\n+        if (key == null) {\n+            return strToEncrypt;\n+        } else {\n+            try\n+            {\n+                Cipher cp = Cipher.getInstance(\"AES/ECB/PKCS5Padding\");\n+                cp.init(Cipher.ENCRYPT_MODE, key);\n+                return java.net.URLEncoder.encode(Base64.getEncoder().encodeToString(cp.doFinal(strToEncrypt.getBytes(\"UTF-8\"))), StandardCharsets.UTF_8.name());\n+            } catch (Exception e) {\n+                return strToEncrypt;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjY0ODk4Nw=="}, "originalCommit": {"oid": "c4eda51617704a4f98a28ffc94b5a96ad88de6be"}, "originalPosition": 98}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzEwODcyMA==", "bodyText": "changed to use fhir server config.", "url": "https://github.com/IBM/FHIR/pull/647#discussion_r373108720", "createdAt": "2020-01-30T18:10:11Z", "author": {"login": "albertwang-ibm"}, "path": "fhir-operation-bulkdata/src/main/java/com/ibm/fhir/operation/bulkdata/util/BulkDataUtil.java", "diffHunk": "@@ -284,4 +287,37 @@ public static String checkAndValidateJob(Parameters parameters) throws FHIROpera\n \n         throw new FHIROperationException(\"no job identifier is passed\");\n     }\n+\n+\n+    public static String encryptBatchJobId(String strToEncrypt, SecretKeySpec key) {\n+        // Encrypt and UrlEncode the batch job id.\n+        if (key == null) {\n+            return strToEncrypt;\n+        } else {\n+            try\n+            {\n+                Cipher cp = Cipher.getInstance(\"AES/ECB/PKCS5Padding\");\n+                cp.init(Cipher.ENCRYPT_MODE, key);\n+                return java.net.URLEncoder.encode(Base64.getEncoder().encodeToString(cp.doFinal(strToEncrypt.getBytes(\"UTF-8\"))), StandardCharsets.UTF_8.name());\n+            } catch (Exception e) {\n+                return strToEncrypt;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjY0ODk4Nw=="}, "originalCommit": {"oid": "c4eda51617704a4f98a28ffc94b5a96ad88de6be"}, "originalPosition": 98}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMwNDA0ODE2OnYy", "diffSide": "RIGHT", "path": "fhir-operation-bulkdata/src/main/java/com/ibm/fhir/operation/bulkdata/util/BulkDataUtil.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOVQyMTo0ODo0OFrOFjYtdQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0zMFQxODoxMDoyOFrOFj0wZg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjY0OTMzMw==", "bodyText": "worthy of a comment", "url": "https://github.com/IBM/FHIR/pull/647#discussion_r372649333", "createdAt": "2020-01-29T21:48:48Z", "author": {"login": "prb112"}, "path": "fhir-operation-bulkdata/src/main/java/com/ibm/fhir/operation/bulkdata/util/BulkDataUtil.java", "diffHunk": "@@ -284,4 +287,37 @@ public static String checkAndValidateJob(Parameters parameters) throws FHIROpera\n \n         throw new FHIROperationException(\"no job identifier is passed\");\n     }\n+\n+\n+    public static String encryptBatchJobId(String strToEncrypt, SecretKeySpec key) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c4eda51617704a4f98a28ffc94b5a96ad88de6be"}, "originalPosition": 87}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Mjk1NjEzNQ==", "bodyText": "let me add, I thought it's straight forward, so I didn't.", "url": "https://github.com/IBM/FHIR/pull/647#discussion_r372956135", "createdAt": "2020-01-30T13:47:44Z", "author": {"login": "albertwang-ibm"}, "path": "fhir-operation-bulkdata/src/main/java/com/ibm/fhir/operation/bulkdata/util/BulkDataUtil.java", "diffHunk": "@@ -284,4 +287,37 @@ public static String checkAndValidateJob(Parameters parameters) throws FHIROpera\n \n         throw new FHIROperationException(\"no job identifier is passed\");\n     }\n+\n+\n+    public static String encryptBatchJobId(String strToEncrypt, SecretKeySpec key) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjY0OTMzMw=="}, "originalCommit": {"oid": "c4eda51617704a4f98a28ffc94b5a96ad88de6be"}, "originalPosition": 87}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzEwODgzOA==", "bodyText": "done", "url": "https://github.com/IBM/FHIR/pull/647#discussion_r373108838", "createdAt": "2020-01-30T18:10:28Z", "author": {"login": "albertwang-ibm"}, "path": "fhir-operation-bulkdata/src/main/java/com/ibm/fhir/operation/bulkdata/util/BulkDataUtil.java", "diffHunk": "@@ -284,4 +287,37 @@ public static String checkAndValidateJob(Parameters parameters) throws FHIROpera\n \n         throw new FHIROperationException(\"no job identifier is passed\");\n     }\n+\n+\n+    public static String encryptBatchJobId(String strToEncrypt, SecretKeySpec key) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjY0OTMzMw=="}, "originalCommit": {"oid": "c4eda51617704a4f98a28ffc94b5a96ad88de6be"}, "originalPosition": 87}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMwNDA0OTEzOnYy", "diffSide": "RIGHT", "path": "fhir-operation-bulkdata/src/main/java/com/ibm/fhir/operation/bulkdata/util/BulkDataUtil.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOVQyMTo0OTowN1rOFjYuFg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0zMFQxODoxMDo1MlrOFj0xPA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjY0OTQ5NA==", "bodyText": "Worthy of a comment", "url": "https://github.com/IBM/FHIR/pull/647#discussion_r372649494", "createdAt": "2020-01-29T21:49:07Z", "author": {"login": "prb112"}, "path": "fhir-operation-bulkdata/src/main/java/com/ibm/fhir/operation/bulkdata/util/BulkDataUtil.java", "diffHunk": "@@ -284,4 +287,37 @@ public static String checkAndValidateJob(Parameters parameters) throws FHIROpera\n \n         throw new FHIROperationException(\"no job identifier is passed\");\n     }\n+\n+\n+    public static String encryptBatchJobId(String strToEncrypt, SecretKeySpec key) {\n+        // Encrypt and UrlEncode the batch job id.\n+        if (key == null) {\n+            return strToEncrypt;\n+        } else {\n+            try\n+            {\n+                Cipher cp = Cipher.getInstance(\"AES/ECB/PKCS5Padding\");\n+                cp.init(Cipher.ENCRYPT_MODE, key);\n+                return java.net.URLEncoder.encode(Base64.getEncoder().encodeToString(cp.doFinal(strToEncrypt.getBytes(\"UTF-8\"))), StandardCharsets.UTF_8.name());\n+            } catch (Exception e) {\n+                return strToEncrypt;\n+            }\n+        }\n+    }\n+\n+    public static String decryptBatchJobId(String strToDecrypt, SecretKeySpec key) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c4eda51617704a4f98a28ffc94b5a96ad88de6be"}, "originalPosition": 103}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Mjk1NjE3OA==", "bodyText": "let me add one, I thought it's straight forward, so I didn't.", "url": "https://github.com/IBM/FHIR/pull/647#discussion_r372956178", "createdAt": "2020-01-30T13:47:49Z", "author": {"login": "albertwang-ibm"}, "path": "fhir-operation-bulkdata/src/main/java/com/ibm/fhir/operation/bulkdata/util/BulkDataUtil.java", "diffHunk": "@@ -284,4 +287,37 @@ public static String checkAndValidateJob(Parameters parameters) throws FHIROpera\n \n         throw new FHIROperationException(\"no job identifier is passed\");\n     }\n+\n+\n+    public static String encryptBatchJobId(String strToEncrypt, SecretKeySpec key) {\n+        // Encrypt and UrlEncode the batch job id.\n+        if (key == null) {\n+            return strToEncrypt;\n+        } else {\n+            try\n+            {\n+                Cipher cp = Cipher.getInstance(\"AES/ECB/PKCS5Padding\");\n+                cp.init(Cipher.ENCRYPT_MODE, key);\n+                return java.net.URLEncoder.encode(Base64.getEncoder().encodeToString(cp.doFinal(strToEncrypt.getBytes(\"UTF-8\"))), StandardCharsets.UTF_8.name());\n+            } catch (Exception e) {\n+                return strToEncrypt;\n+            }\n+        }\n+    }\n+\n+    public static String decryptBatchJobId(String strToDecrypt, SecretKeySpec key) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjY0OTQ5NA=="}, "originalCommit": {"oid": "c4eda51617704a4f98a28ffc94b5a96ad88de6be"}, "originalPosition": 103}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzEwOTA1Mg==", "bodyText": "done", "url": "https://github.com/IBM/FHIR/pull/647#discussion_r373109052", "createdAt": "2020-01-30T18:10:52Z", "author": {"login": "albertwang-ibm"}, "path": "fhir-operation-bulkdata/src/main/java/com/ibm/fhir/operation/bulkdata/util/BulkDataUtil.java", "diffHunk": "@@ -284,4 +287,37 @@ public static String checkAndValidateJob(Parameters parameters) throws FHIROpera\n \n         throw new FHIROperationException(\"no job identifier is passed\");\n     }\n+\n+\n+    public static String encryptBatchJobId(String strToEncrypt, SecretKeySpec key) {\n+        // Encrypt and UrlEncode the batch job id.\n+        if (key == null) {\n+            return strToEncrypt;\n+        } else {\n+            try\n+            {\n+                Cipher cp = Cipher.getInstance(\"AES/ECB/PKCS5Padding\");\n+                cp.init(Cipher.ENCRYPT_MODE, key);\n+                return java.net.URLEncoder.encode(Base64.getEncoder().encodeToString(cp.doFinal(strToEncrypt.getBytes(\"UTF-8\"))), StandardCharsets.UTF_8.name());\n+            } catch (Exception e) {\n+                return strToEncrypt;\n+            }\n+        }\n+    }\n+\n+    public static String decryptBatchJobId(String strToDecrypt, SecretKeySpec key) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjY0OTQ5NA=="}, "originalCommit": {"oid": "c4eda51617704a4f98a28ffc94b5a96ad88de6be"}, "originalPosition": 103}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMwNDA1MzA3OnYy", "diffSide": "RIGHT", "path": "fhir-operation-bulkdata/src/main/java/com/ibm/fhir/operation/bulkdata/util/BulkDataUtil.java", "isResolved": true, "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOVQyMTo1MDoyMlrOFjYwgw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0zMFQxODozNDozN1rOFj1eoA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjY1MDExNQ==", "bodyText": "is this the lightest weight cipher?  it doesn't need to be strong.", "url": "https://github.com/IBM/FHIR/pull/647#discussion_r372650115", "createdAt": "2020-01-29T21:50:22Z", "author": {"login": "prb112"}, "path": "fhir-operation-bulkdata/src/main/java/com/ibm/fhir/operation/bulkdata/util/BulkDataUtil.java", "diffHunk": "@@ -284,4 +287,37 @@ public static String checkAndValidateJob(Parameters parameters) throws FHIROpera\n \n         throw new FHIROperationException(\"no job identifier is passed\");\n     }\n+\n+\n+    public static String encryptBatchJobId(String strToEncrypt, SecretKeySpec key) {\n+        // Encrypt and UrlEncode the batch job id.\n+        if (key == null) {\n+            return strToEncrypt;\n+        } else {\n+            try\n+            {\n+                Cipher cp = Cipher.getInstance(\"AES/ECB/PKCS5Padding\");\n+                cp.init(Cipher.ENCRYPT_MODE, key);\n+                return java.net.URLEncoder.encode(Base64.getEncoder().encodeToString(cp.doFinal(strToEncrypt.getBytes(\"UTF-8\"))), StandardCharsets.UTF_8.name());\n+            } catch (Exception e) {\n+                return strToEncrypt;\n+            }\n+        }\n+    }\n+\n+    public static String decryptBatchJobId(String strToDecrypt, SecretKeySpec key) {\n+        // Decrypt to get the batch job id\n+        if (key == null) {\n+            return strToDecrypt;\n+        } else {\n+            try\n+            {\n+                Cipher cp = Cipher.getInstance(\"AES/ECB/PKCS5PADDING\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c4eda51617704a4f98a28ffc94b5a96ad88de6be"}, "originalPosition": 110}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjY1MDQxNg==", "bodyText": "Where is the URL decode? shouldn't this be symmetric, or are you relying on the Liberty runtime to previously decode", "url": "https://github.com/IBM/FHIR/pull/647#discussion_r372650416", "createdAt": "2020-01-29T21:51:02Z", "author": {"login": "prb112"}, "path": "fhir-operation-bulkdata/src/main/java/com/ibm/fhir/operation/bulkdata/util/BulkDataUtil.java", "diffHunk": "@@ -284,4 +287,37 @@ public static String checkAndValidateJob(Parameters parameters) throws FHIROpera\n \n         throw new FHIROperationException(\"no job identifier is passed\");\n     }\n+\n+\n+    public static String encryptBatchJobId(String strToEncrypt, SecretKeySpec key) {\n+        // Encrypt and UrlEncode the batch job id.\n+        if (key == null) {\n+            return strToEncrypt;\n+        } else {\n+            try\n+            {\n+                Cipher cp = Cipher.getInstance(\"AES/ECB/PKCS5Padding\");\n+                cp.init(Cipher.ENCRYPT_MODE, key);\n+                return java.net.URLEncoder.encode(Base64.getEncoder().encodeToString(cp.doFinal(strToEncrypt.getBytes(\"UTF-8\"))), StandardCharsets.UTF_8.name());\n+            } catch (Exception e) {\n+                return strToEncrypt;\n+            }\n+        }\n+    }\n+\n+    public static String decryptBatchJobId(String strToDecrypt, SecretKeySpec key) {\n+        // Decrypt to get the batch job id\n+        if (key == null) {\n+            return strToDecrypt;\n+        } else {\n+            try\n+            {\n+                Cipher cp = Cipher.getInstance(\"AES/ECB/PKCS5PADDING\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjY1MDExNQ=="}, "originalCommit": {"oid": "c4eda51617704a4f98a28ffc94b5a96ad88de6be"}, "originalPosition": 110}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjY1MDUyMQ==", "bodyText": "maybe add a comment", "url": "https://github.com/IBM/FHIR/pull/647#discussion_r372650521", "createdAt": "2020-01-29T21:51:13Z", "author": {"login": "prb112"}, "path": "fhir-operation-bulkdata/src/main/java/com/ibm/fhir/operation/bulkdata/util/BulkDataUtil.java", "diffHunk": "@@ -284,4 +287,37 @@ public static String checkAndValidateJob(Parameters parameters) throws FHIROpera\n \n         throw new FHIROperationException(\"no job identifier is passed\");\n     }\n+\n+\n+    public static String encryptBatchJobId(String strToEncrypt, SecretKeySpec key) {\n+        // Encrypt and UrlEncode the batch job id.\n+        if (key == null) {\n+            return strToEncrypt;\n+        } else {\n+            try\n+            {\n+                Cipher cp = Cipher.getInstance(\"AES/ECB/PKCS5Padding\");\n+                cp.init(Cipher.ENCRYPT_MODE, key);\n+                return java.net.URLEncoder.encode(Base64.getEncoder().encodeToString(cp.doFinal(strToEncrypt.getBytes(\"UTF-8\"))), StandardCharsets.UTF_8.name());\n+            } catch (Exception e) {\n+                return strToEncrypt;\n+            }\n+        }\n+    }\n+\n+    public static String decryptBatchJobId(String strToDecrypt, SecretKeySpec key) {\n+        // Decrypt to get the batch job id\n+        if (key == null) {\n+            return strToDecrypt;\n+        } else {\n+            try\n+            {\n+                Cipher cp = Cipher.getInstance(\"AES/ECB/PKCS5PADDING\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjY1MDExNQ=="}, "originalCommit": {"oid": "c4eda51617704a4f98a28ffc94b5a96ad88de6be"}, "originalPosition": 110}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Mjk1OTg3NQ==", "bodyText": "yes, this is lightest weight cipher, and I didn't add salt to it to make the config simpler, otherwise, we will need config for both the key and salt.\nyes, liberty run time or the rest framework did the url decoding automatically, I added decoding in this function before, and found it didn't work, and then through debugging, I found it's already decoded, double decode the encrypted job id caused error, so I removed the url decode from this function.\nYes, will add comment for this.", "url": "https://github.com/IBM/FHIR/pull/647#discussion_r372959875", "createdAt": "2020-01-30T13:54:33Z", "author": {"login": "albertwang-ibm"}, "path": "fhir-operation-bulkdata/src/main/java/com/ibm/fhir/operation/bulkdata/util/BulkDataUtil.java", "diffHunk": "@@ -284,4 +287,37 @@ public static String checkAndValidateJob(Parameters parameters) throws FHIROpera\n \n         throw new FHIROperationException(\"no job identifier is passed\");\n     }\n+\n+\n+    public static String encryptBatchJobId(String strToEncrypt, SecretKeySpec key) {\n+        // Encrypt and UrlEncode the batch job id.\n+        if (key == null) {\n+            return strToEncrypt;\n+        } else {\n+            try\n+            {\n+                Cipher cp = Cipher.getInstance(\"AES/ECB/PKCS5Padding\");\n+                cp.init(Cipher.ENCRYPT_MODE, key);\n+                return java.net.URLEncoder.encode(Base64.getEncoder().encodeToString(cp.doFinal(strToEncrypt.getBytes(\"UTF-8\"))), StandardCharsets.UTF_8.name());\n+            } catch (Exception e) {\n+                return strToEncrypt;\n+            }\n+        }\n+    }\n+\n+    public static String decryptBatchJobId(String strToDecrypt, SecretKeySpec key) {\n+        // Decrypt to get the batch job id\n+        if (key == null) {\n+            return strToDecrypt;\n+        } else {\n+            try\n+            {\n+                Cipher cp = Cipher.getInstance(\"AES/ECB/PKCS5PADDING\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjY1MDExNQ=="}, "originalCommit": {"oid": "c4eda51617704a4f98a28ffc94b5a96ad88de6be"}, "originalPosition": 110}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzExMjg5Mw==", "bodyText": "great confirmation, I think adding the comment is the only part left?", "url": "https://github.com/IBM/FHIR/pull/647#discussion_r373112893", "createdAt": "2020-01-30T18:19:01Z", "author": {"login": "prb112"}, "path": "fhir-operation-bulkdata/src/main/java/com/ibm/fhir/operation/bulkdata/util/BulkDataUtil.java", "diffHunk": "@@ -284,4 +287,37 @@ public static String checkAndValidateJob(Parameters parameters) throws FHIROpera\n \n         throw new FHIROperationException(\"no job identifier is passed\");\n     }\n+\n+\n+    public static String encryptBatchJobId(String strToEncrypt, SecretKeySpec key) {\n+        // Encrypt and UrlEncode the batch job id.\n+        if (key == null) {\n+            return strToEncrypt;\n+        } else {\n+            try\n+            {\n+                Cipher cp = Cipher.getInstance(\"AES/ECB/PKCS5Padding\");\n+                cp.init(Cipher.ENCRYPT_MODE, key);\n+                return java.net.URLEncoder.encode(Base64.getEncoder().encodeToString(cp.doFinal(strToEncrypt.getBytes(\"UTF-8\"))), StandardCharsets.UTF_8.name());\n+            } catch (Exception e) {\n+                return strToEncrypt;\n+            }\n+        }\n+    }\n+\n+    public static String decryptBatchJobId(String strToDecrypt, SecretKeySpec key) {\n+        // Decrypt to get the batch job id\n+        if (key == null) {\n+            return strToDecrypt;\n+        } else {\n+            try\n+            {\n+                Cipher cp = Cipher.getInstance(\"AES/ECB/PKCS5PADDING\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjY1MDExNQ=="}, "originalCommit": {"oid": "c4eda51617704a4f98a28ffc94b5a96ad88de6be"}, "originalPosition": 110}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzEyMDY3Mg==", "bodyText": "added commenats", "url": "https://github.com/IBM/FHIR/pull/647#discussion_r373120672", "createdAt": "2020-01-30T18:34:37Z", "author": {"login": "albertwang-ibm"}, "path": "fhir-operation-bulkdata/src/main/java/com/ibm/fhir/operation/bulkdata/util/BulkDataUtil.java", "diffHunk": "@@ -284,4 +287,37 @@ public static String checkAndValidateJob(Parameters parameters) throws FHIROpera\n \n         throw new FHIROperationException(\"no job identifier is passed\");\n     }\n+\n+\n+    public static String encryptBatchJobId(String strToEncrypt, SecretKeySpec key) {\n+        // Encrypt and UrlEncode the batch job id.\n+        if (key == null) {\n+            return strToEncrypt;\n+        } else {\n+            try\n+            {\n+                Cipher cp = Cipher.getInstance(\"AES/ECB/PKCS5Padding\");\n+                cp.init(Cipher.ENCRYPT_MODE, key);\n+                return java.net.URLEncoder.encode(Base64.getEncoder().encodeToString(cp.doFinal(strToEncrypt.getBytes(\"UTF-8\"))), StandardCharsets.UTF_8.name());\n+            } catch (Exception e) {\n+                return strToEncrypt;\n+            }\n+        }\n+    }\n+\n+    public static String decryptBatchJobId(String strToDecrypt, SecretKeySpec key) {\n+        // Decrypt to get the batch job id\n+        if (key == null) {\n+            return strToDecrypt;\n+        } else {\n+            try\n+            {\n+                Cipher cp = Cipher.getInstance(\"AES/ECB/PKCS5PADDING\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjY1MDExNQ=="}, "originalCommit": {"oid": "c4eda51617704a4f98a28ffc94b5a96ad88de6be"}, "originalPosition": 110}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMwNDA1NzgyOnYy", "diffSide": "RIGHT", "path": "fhir-server/liberty-config/server.xml", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOVQyMTo1MjowMlrOFjYzaw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0zMFQxODoxMToxM1rOFj0x4w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjY1MDg1OQ==", "bodyText": "I think this should go into the properties file separate from JNDI", "url": "https://github.com/IBM/FHIR/pull/647#discussion_r372650859", "createdAt": "2020-01-29T21:52:02Z", "author": {"login": "prb112"}, "path": "fhir-server/liberty-config/server.xml", "diffHunk": "@@ -199,4 +199,7 @@\n         </application-bnd>\n     </webApplication>\n     <include optional=\"true\" location=\"${server.config.dir}/batchDs.xml\"/>\n+    \n+    <!-- The key used for encryption of the internal JavaBatch Job instance/execution id which is used in bulkdata APIs  -->\n+    <jndiEntry jndiName=\"config/bulkdatajobencryptionkey\" value=\"change-password\"/>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c4eda51617704a4f98a28ffc94b5a96ad88de6be"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Mjk2MjAwMg==", "bodyText": "I didn't put it into any of the tenant config files because I want the same key to be used for all the tenants. I considered either server.xml or server.env, and I thought server.xml seems a better choice for me.", "url": "https://github.com/IBM/FHIR/pull/647#discussion_r372962002", "createdAt": "2020-01-30T13:58:33Z", "author": {"login": "albertwang-ibm"}, "path": "fhir-server/liberty-config/server.xml", "diffHunk": "@@ -199,4 +199,7 @@\n         </application-bnd>\n     </webApplication>\n     <include optional=\"true\" location=\"${server.config.dir}/batchDs.xml\"/>\n+    \n+    <!-- The key used for encryption of the internal JavaBatch Job instance/execution id which is used in bulkdata APIs  -->\n+    <jndiEntry jndiName=\"config/bulkdatajobencryptionkey\" value=\"change-password\"/>", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjY1MDg1OQ=="}, "originalCommit": {"oid": "c4eda51617704a4f98a28ffc94b5a96ad88de6be"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzEwOTIxOQ==", "bodyText": "changed to use fhir server config.", "url": "https://github.com/IBM/FHIR/pull/647#discussion_r373109219", "createdAt": "2020-01-30T18:11:13Z", "author": {"login": "albertwang-ibm"}, "path": "fhir-server/liberty-config/server.xml", "diffHunk": "@@ -199,4 +199,7 @@\n         </application-bnd>\n     </webApplication>\n     <include optional=\"true\" location=\"${server.config.dir}/batchDs.xml\"/>\n+    \n+    <!-- The key used for encryption of the internal JavaBatch Job instance/execution id which is used in bulkdata APIs  -->\n+    <jndiEntry jndiName=\"config/bulkdatajobencryptionkey\" value=\"change-password\"/>", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjY1MDg1OQ=="}, "originalCommit": {"oid": "c4eda51617704a4f98a28ffc94b5a96ad88de6be"}, "originalPosition": 6}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 242, "cost": 1, "resetAt": "2021-11-12T20:44:06Z"}}}