{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDEwNDEwNDcy", "number": 998, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOFQyMzo0MDo0NFrOD3bBrQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOFQyMzo0MTowOVrOD3bCFA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU5NDQxMDY5OnYy", "diffSide": "LEFT", "path": "fhir-server-webapp/src/main/webapp/WEB-INF/web.xml", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOFQyMzo0MDo0NFrOGNq9Ng==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOVQxNzo0NjoyM1rOGOKEmw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjk4ODQ3MA==", "bodyText": "This is pretty explicit whitelisting.  What happens with websockets? What happens with OPTIONS?  are there any behavior changes?", "url": "https://github.com/IBM/FHIR/pull/998#discussion_r416988470", "createdAt": "2020-04-28T23:40:44Z", "author": {"login": "prb112"}, "path": "fhir-server-webapp/src/main/webapp/WEB-INF/web.xml", "diffHunk": "@@ -18,30 +18,6 @@\n         <url-pattern>/*</url-pattern>\n     </servlet-mapping>\n \n-    <!-- Security definitions for the web app -->\n-    <security-role>\n-        <role-name>FHIRUsers</role-name>\n-    </security-role>\n-    <security-constraint>\n-        <web-resource-collection>\n-            <web-resource-name>FHIR REST API</web-resource-name>\n-            <url-pattern>/*</url-pattern>\n-            <http-method>GET</http-method>\n-            <http-method>POST</http-method>\n-            <http-method>PUT</http-method>\n-            <http-method>PATCH</http-method>\n-            <http-method>DELETE</http-method>\n-            <http-method>HEAD</http-method>\n-            <http-method>TRACE</http-method>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "77982d3a75da13d5462fc28a74732d900d48abdb"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzQ5ODI2Nw==", "bodyText": "Websockets seems to work the same (with the default config at least).  OPTIONS also worked the same with the default config (no auth required), but had some interesting behavior when I added the mpJwt config:  it still returned HTTP 200 and listed the allowed methods, but it also included a WWW-Authenticate header with value Bearer realm=\"MP-JWT\", error=\"invalid_token\" when I invoked it without a jwt.", "url": "https://github.com/IBM/FHIR/pull/998#discussion_r417498267", "createdAt": "2020-04-29T17:46:23Z", "author": {"login": "lmsurpre"}, "path": "fhir-server-webapp/src/main/webapp/WEB-INF/web.xml", "diffHunk": "@@ -18,30 +18,6 @@\n         <url-pattern>/*</url-pattern>\n     </servlet-mapping>\n \n-    <!-- Security definitions for the web app -->\n-    <security-role>\n-        <role-name>FHIRUsers</role-name>\n-    </security-role>\n-    <security-constraint>\n-        <web-resource-collection>\n-            <web-resource-name>FHIR REST API</web-resource-name>\n-            <url-pattern>/*</url-pattern>\n-            <http-method>GET</http-method>\n-            <http-method>POST</http-method>\n-            <http-method>PUT</http-method>\n-            <http-method>PATCH</http-method>\n-            <http-method>DELETE</http-method>\n-            <http-method>HEAD</http-method>\n-            <http-method>TRACE</http-method>", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjk4ODQ3MA=="}, "originalCommit": {"oid": "77982d3a75da13d5462fc28a74732d900d48abdb"}, "originalPosition": 18}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU5NDQxMTcyOnYy", "diffSide": "RIGHT", "path": "fhir-server/liberty-config/configDropins/disabled/jwtRP.xml", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOFQyMzo0MTowOVrOGNq9yg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOVQxMzoyNTo1MFrOGN-quw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjk4ODYxOA==", "bodyText": "posted a message about implications for opening up... is this cached?", "url": "https://github.com/IBM/FHIR/pull/998#discussion_r416988618", "createdAt": "2020-04-28T23:41:09Z", "author": {"login": "prb112"}, "path": "fhir-server/liberty-config/configDropins/disabled/jwtRP.xml", "diffHunk": "@@ -0,0 +1,32 @@\n+<server description=\"fhir-server\">\n+\n+    <!-- Enable features -->\n+    <featureManager>\n+        <!-- mpJwt-1.1 is already enabled in the default server.xml, but it doesn't hurt to repeat it here -->\n+        <feature>mpJwt-1.1</feature>\n+    </featureManager>\n+\n+    <!-- Override the application-bnd binding of the main webapp -->\n+    <webApplication contextRoot=\"fhir-server/api/v4\" id=\"fhir-server-webapp\" location=\"fhir-server.war\" name=\"fhir-server-webapp\">\n+        <application-bnd>\n+            <security-role id=\"users\" name=\"FHIRUsers\">\n+                <group name=\"JwtUsers\" access-id=\"group:https://localhost:9443/oauth2/endpoint/oauth2-provider/FHIRUsers\"/>\n+            </security-role>\n+        </application-bnd>\n+    </webApplication>\n+\n+    <!-- The MP JWT configuration that injects the caller's JWT into a\n+         ResourceScoped bean for inspection. -->\n+    <mpJwt id=\"jwtConsumer\"\n+           keyName=\"libertyop\"\n+           userNameAttribute=\"sub\"\n+           groupNameAttribute=\"groupIds\"\n+           issuer=\"https://localhost:9443/oauth2/endpoint/oauth2-provider,https://host.docker.internal:9443/oauth2/endpoint/oauth2-provider\"\n+           authFilterRef=\"filter\"/>\n+\n+    <authFilter id=\"filter\">\n+        <requestUrl urlPattern=\"/fhir-server\" />\n+        <requestUrl matchType=\"notContain\" urlPattern=\"/fhir-server/api/v4/metadata\" />", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "77982d3a75da13d5462fc28a74732d900d48abdb"}, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzMxMTQxOQ==", "bodyText": "we have #734 for caching of metadata\nit doesn't connect to the database, but it does read the config (both the tenant config and the default config), and programatically builds up the capabilitystatement, which can take some.", "url": "https://github.com/IBM/FHIR/pull/998#discussion_r417311419", "createdAt": "2020-04-29T13:25:50Z", "author": {"login": "lmsurpre"}, "path": "fhir-server/liberty-config/configDropins/disabled/jwtRP.xml", "diffHunk": "@@ -0,0 +1,32 @@\n+<server description=\"fhir-server\">\n+\n+    <!-- Enable features -->\n+    <featureManager>\n+        <!-- mpJwt-1.1 is already enabled in the default server.xml, but it doesn't hurt to repeat it here -->\n+        <feature>mpJwt-1.1</feature>\n+    </featureManager>\n+\n+    <!-- Override the application-bnd binding of the main webapp -->\n+    <webApplication contextRoot=\"fhir-server/api/v4\" id=\"fhir-server-webapp\" location=\"fhir-server.war\" name=\"fhir-server-webapp\">\n+        <application-bnd>\n+            <security-role id=\"users\" name=\"FHIRUsers\">\n+                <group name=\"JwtUsers\" access-id=\"group:https://localhost:9443/oauth2/endpoint/oauth2-provider/FHIRUsers\"/>\n+            </security-role>\n+        </application-bnd>\n+    </webApplication>\n+\n+    <!-- The MP JWT configuration that injects the caller's JWT into a\n+         ResourceScoped bean for inspection. -->\n+    <mpJwt id=\"jwtConsumer\"\n+           keyName=\"libertyop\"\n+           userNameAttribute=\"sub\"\n+           groupNameAttribute=\"groupIds\"\n+           issuer=\"https://localhost:9443/oauth2/endpoint/oauth2-provider,https://host.docker.internal:9443/oauth2/endpoint/oauth2-provider\"\n+           authFilterRef=\"filter\"/>\n+\n+    <authFilter id=\"filter\">\n+        <requestUrl urlPattern=\"/fhir-server\" />\n+        <requestUrl matchType=\"notContain\" urlPattern=\"/fhir-server/api/v4/metadata\" />", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjk4ODYxOA=="}, "originalCommit": {"oid": "77982d3a75da13d5462fc28a74732d900d48abdb"}, "originalPosition": 29}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 20, "cost": 1, "resetAt": "2021-11-12T20:44:06Z"}}}