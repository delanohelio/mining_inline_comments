{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTMzNzYyNjYz", "number": 1804, "title": "IBM FHIR Server audit does not log bundles correctly. #1803", "bodyText": "Signed-off-by: Paul Bastide pbastide@us.ibm.com", "createdAt": "2020-12-07T15:38:15Z", "url": "https://github.com/IBM/FHIR/pull/1804", "merged": true, "mergeCommit": {"oid": "6525cd3de69eeb1e881c6dc0a7beef16d426a19a"}, "closed": true, "closedAt": "2020-12-07T17:31:49Z", "author": {"login": "prb112"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdj3ZOdgH2gAyNTMzNzYyNjYzOjZkMDBlMmM4ZWM0MTIwNzJhMzRiMGZmNTlhOTM3MDk5MjU5MzgzMmY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdj4S45AH2gAyNTMzNzYyNjYzOjA1NjAyZjkzMDZiZjI5Nzk1Mjc2NDk3MTliMDJkZTI1ZTFiMmJhNGY=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "6d00e2c8ec412072a34b0ff59a9370992593832f", "author": {"user": {"login": "prb112", "name": "Paul Bastide"}}, "url": "https://github.com/IBM/FHIR/commit/6d00e2c8ec412072a34b0ff59a9370992593832f", "committedDate": "2020-12-07T15:36:55Z", "message": "IBM FHIR Server audit does not log bundles correctly. #1803\n\nSigned-off-by: Paul Bastide <pbastide@us.ibm.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ2MjkwMDk1", "url": "https://github.com/IBM/FHIR/pull/1804#pullrequestreview-546290095", "createdAt": "2020-12-07T15:59:57Z", "commit": {"oid": "6d00e2c8ec412072a34b0ff59a9370992593832f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wN1QxNTo1OTo1N1rOIAt0Hg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wN1QxNTo1OTo1N1rOIAt0Hg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzYyMTUzNA==", "bodyText": "I know it's not part of the change, but is this the best way to get the name of the host? Do we ensure that HOSTNAME is part of the environment?  On Windows, COMPUTERNAME might be more appropriate. Let me know if you think we need a ticket for this.", "url": "https://github.com/IBM/FHIR/pull/1804#discussion_r537621534", "createdAt": "2020-12-07T15:59:57Z", "author": {"login": "punktilious"}, "path": "fhir-audit/src/main/java/com/ibm/fhir/audit/logging/impl/WhcAuditCadfLogService.java", "diffHunk": "@@ -82,7 +82,7 @@\n     private static CadfResource observerRsrc =\n             new CadfResource.Builder(\"fhir-server\", ResourceType.compute_node)\n                             .geolocation(new CadfGeolocation.Builder(geoCity, geoState, geoCountry, null).build())\n-                            .name(\"Fhir Audit\")\n+                            .name(\"IBM FHIR Server - Audit\")\n                             .host(System.getenv(\"HOSTNAME\"))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6d00e2c8ec412072a34b0ff59a9370992593832f"}, "originalPosition": 6}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ2MjkyMjc3", "url": "https://github.com/IBM/FHIR/pull/1804#pullrequestreview-546292277", "createdAt": "2020-12-07T16:02:13Z", "commit": {"oid": "6d00e2c8ec412072a34b0ff59a9370992593832f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wN1QxNjowMjoxM1rOIAt7Lg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wN1QxNjowMjoxM1rOIAt7Lg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzYyMzM0Mg==", "bodyText": "String != String. Shouldn't this use !equals(...)?", "url": "https://github.com/IBM/FHIR/pull/1804#discussion_r537623342", "createdAt": "2020-12-07T16:02:13Z", "author": {"login": "punktilious"}, "path": "fhir-audit/src/main/java/com/ibm/fhir/audit/logging/impl/WhcAuditCadfLogService.java", "diffHunk": "@@ -197,8 +196,10 @@ public static CadfEvent createCadfEvent(AuditLogEntry logEntry)\n         Outcome cadfEventOutCome;\n \n         // Cadf does't log config, so skip\n-        if ((logEntry.getEventType() != AuditLogEventType.FHIR_CONFIGDATA.value()) && logEntry.getContext() != null\n-                && logEntry.getContext().getAction() != null && logEntry.getContext().getApiParameters() != null) {\n+        if ((logEntry.getEventType() != AuditLogEventType.FHIR_CONFIGDATA.value())", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6d00e2c8ec412072a34b0ff59a9370992593832f"}, "originalPosition": 32}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f2814bf66b821939d42e92031358cc0f5ffbb413", "author": {"user": {"login": "prb112", "name": "Paul Bastide"}}, "url": "https://github.com/IBM/FHIR/commit/f2814bf66b821939d42e92031358cc0f5ffbb413", "committedDate": "2020-12-07T16:30:36Z", "message": "fix: per code review changed the compare, and added an additional ignore\nfor the metadata endpoints\n\nSigned-off-by: Paul Bastide <pbastide@us.ibm.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ2MzIyOTk4", "url": "https://github.com/IBM/FHIR/pull/1804#pullrequestreview-546322998", "createdAt": "2020-12-07T16:34:09Z", "commit": {"oid": "f2814bf66b821939d42e92031358cc0f5ffbb413"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wN1QxNjozNDowOVrOIAvdRA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wN1QxNjozNDowOVrOIAvdRA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzY0ODQ1Mg==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    // Skip over the actual logging, int his case, we're deciding by default\n          \n          \n            \n                    // Skip over the actual logging, in this case, we're deciding by default", "url": "https://github.com/IBM/FHIR/pull/1804#discussion_r537648452", "createdAt": "2020-12-07T16:34:09Z", "author": {"login": "lmsurpre"}, "path": "fhir-server/src/main/java/com/ibm/fhir/server/util/RestAuditLogger.java", "diffHunk": "@@ -311,6 +313,21 @@ public static void logBundle(HttpServletRequest request, Bundle bundle, Date sta\n                 .resourcesUpdated(updateCount).build());\n         entry.setDescription(\"FHIR Bundle request\");\n \n+        // Previously we didn't set the Action which caused the logEntry to\n+        // Skip over the actual logging, int his case, we're deciding by default", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f2814bf66b821939d42e92031358cc0f5ffbb413"}, "originalPosition": 47}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ2MzI3MDM0", "url": "https://github.com/IBM/FHIR/pull/1804#pullrequestreview-546327034", "createdAt": "2020-12-07T16:38:32Z", "commit": {"oid": "f2814bf66b821939d42e92031358cc0f5ffbb413"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "05602f9306bf2979527649719b02de25e1b2ba4f", "author": {"user": {"login": "prb112", "name": "Paul Bastide"}}, "url": "https://github.com/IBM/FHIR/commit/05602f9306bf2979527649719b02de25e1b2ba4f", "committedDate": "2020-12-07T16:39:54Z", "message": "Update fhir-server/src/main/java/com/ibm/fhir/server/util/RestAuditLogger.java\r\n\r\nSigned-off-by: Paul Bastide <pbastide@us.ibm.com>\n\nCo-authored-by: Lee Surprenant <lmsurpre@us.ibm.com>"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 811, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}