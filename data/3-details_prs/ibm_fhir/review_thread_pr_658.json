{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY5MDkxNjY3", "number": 658, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0zMFQxNDo0MjowMFrODb8Ffw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0zMFQxNDo0MjowMFrODb8Ffw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMwNjIyNTkxOnYy", "diffSide": "RIGHT", "path": "fhir-persistence-jdbc/src/main/java/com/ibm/fhir/persistence/jdbc/util/QuerySegmentAggregator.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0zMFQxNDo0MjowMFrOFjtXiQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0zMFQxNTozMDo1M1rOFjvRQQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Mjk4Nzc4NQ==", "bodyText": "If we know we have no data, should it just be SELECT 0 or some such?", "url": "https://github.com/IBM/FHIR/pull/658#discussion_r372987785", "createdAt": "2020-01-30T14:42:00Z", "author": {"login": "lmsurpre"}, "path": "fhir-persistence-jdbc/src/main/java/com/ibm/fhir/persistence/jdbc/util/QuerySegmentAggregator.java", "diffHunk": "@@ -240,6 +240,12 @@ protected SqlQueryData buildSystemLevelQuery(String selectRoot, String subSelect\n \n         // Processes through EACH register parameter extracting the integer value\n         Map<String, Integer> resourceNameMap = resourceDao.readAllResourceTypeNames();\n+        if (resourceNameMap.size() == 0) {\n+            // Special condition where we have no registered resources and therefore no data.\n+            // This is only used in COUNT\n+            queryString.append(\"SELECT LR.LOGICAL_RESOURCE_ID AS CNT FROM LOGICAL_RESOURCES LR\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0305dfb24f682532068919c01824b4b80520d704"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzAwMjMxNg==", "bodyText": "since it's a nested SELECT SELECT it ends up being a pain in the butt to do VALUES() since we don't really want to return a value.", "url": "https://github.com/IBM/FHIR/pull/658#discussion_r373002316", "createdAt": "2020-01-30T15:04:46Z", "author": {"login": "prb112"}, "path": "fhir-persistence-jdbc/src/main/java/com/ibm/fhir/persistence/jdbc/util/QuerySegmentAggregator.java", "diffHunk": "@@ -240,6 +240,12 @@ protected SqlQueryData buildSystemLevelQuery(String selectRoot, String subSelect\n \n         // Processes through EACH register parameter extracting the integer value\n         Map<String, Integer> resourceNameMap = resourceDao.readAllResourceTypeNames();\n+        if (resourceNameMap.size() == 0) {\n+            // Special condition where we have no registered resources and therefore no data.\n+            // This is only used in COUNT\n+            queryString.append(\"SELECT LR.LOGICAL_RESOURCE_ID AS CNT FROM LOGICAL_RESOURCES LR\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Mjk4Nzc4NQ=="}, "originalCommit": {"oid": "0305dfb24f682532068919c01824b4b80520d704"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzAxODk0NQ==", "bodyText": "yeah, i almost suggested defining and throwing a checked exception so that we don't even attempt the query, but I guess the above is ok.  marking it approved.", "url": "https://github.com/IBM/FHIR/pull/658#discussion_r373018945", "createdAt": "2020-01-30T15:30:53Z", "author": {"login": "lmsurpre"}, "path": "fhir-persistence-jdbc/src/main/java/com/ibm/fhir/persistence/jdbc/util/QuerySegmentAggregator.java", "diffHunk": "@@ -240,6 +240,12 @@ protected SqlQueryData buildSystemLevelQuery(String selectRoot, String subSelect\n \n         // Processes through EACH register parameter extracting the integer value\n         Map<String, Integer> resourceNameMap = resourceDao.readAllResourceTypeNames();\n+        if (resourceNameMap.size() == 0) {\n+            // Special condition where we have no registered resources and therefore no data.\n+            // This is only used in COUNT\n+            queryString.append(\"SELECT LR.LOGICAL_RESOURCE_ID AS CNT FROM LOGICAL_RESOURCES LR\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Mjk4Nzc4NQ=="}, "originalCommit": {"oid": "0305dfb24f682532068919c01824b4b80520d704"}, "originalPosition": 7}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 246, "cost": 1, "resetAt": "2021-11-12T20:44:06Z"}}}