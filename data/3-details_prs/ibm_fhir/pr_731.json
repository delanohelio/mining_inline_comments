{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzgwMzkxNTIx", "number": 731, "title": "issues #747 and #748 - batch/transaction processing edits and error handling improvement", "bodyText": "Updated bundle processing such that:\n1. 'batch' requests return with 200 OK when one or more of the entries\nfails (check each entry for its response status).\n2. 'transaction' requests return a single OperationOutcome in case of\nfailure.  I normalize whatever the normal status code would be into\neither 400 (client error) or 500 (server error).\nAlso, I removed FHIRHttpException.  Instead of setting the HTTP Status code whenever we\nthrow, we will set just the OperationOutcome.issue.type and map those to\nthe desired HTTP status codes in a single spot (currently\nIssueTypeToHttpStatusMapper).\nThis should help prepare us better for both #17 (due to fewer spots to\nadd logging) and #194 (replacing thrown exceptions with returned\nOperationOutcome) in the future.\nSigned-off-by: Lee Surprenant lmsurpre@us.ibm.com", "createdAt": "2020-02-26T16:46:50Z", "url": "https://github.com/IBM/FHIR/pull/731", "merged": true, "mergeCommit": {"oid": "d4d667fcde68db965a46b0faffae6c6c36adb0a1"}, "closed": true, "closedAt": "2020-03-03T20:58:26Z", "author": {"login": "lmsurpre"}, "timelineItems": {"totalCount": 20, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcIKF4WgBqjMwNzQ2ODg2Nzk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcKIRv0gH2gAyMzgwMzkxNTIxOmE4YjNmOTA1Yjk2MDE4NDc3YTU5ZWI3OWQ0ODFlODI5NjA1MTFmN2I=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "09b84834f647362c3b83a49ab08a4ded82892be2", "author": {"user": {"login": "lmsurpre", "name": "Lee Surprenant"}}, "url": "https://github.com/IBM/FHIR/commit/09b84834f647362c3b83a49ab08a4ded82892be2", "committedDate": "2020-02-26T16:46:34Z", "message": "Reduce reliance on FHIRHttpException\n\nWith these changes, we should be in a better position to remove\nFHIRHttpException. Instead of setting the HTTP Status code whenever we\nthrow, we will set just the OperationOutcome.issue.type and map those to\nthe desired HTTP status codes in a single spot (currently\nIssueTypeToHttpStatusMapper).\n\nThese changes should help prepare us better for both #17 (fewer spots to\nadd logging) and #194 (replacing thrown exceptions with returned\nOperationOutcome)\n\nSigned-off-by: Lee Surprenant <lmsurpre@us.ibm.com>"}, "afterCommit": {"oid": "8172df4cecf1d3eedfb0b3525d701d1e8e409bcc", "author": {"user": {"login": "lmsurpre", "name": "Lee Surprenant"}}, "url": "https://github.com/IBM/FHIR/commit/8172df4cecf1d3eedfb0b3525d701d1e8e409bcc", "committedDate": "2020-02-26T17:22:17Z", "message": "Reduce reliance on FHIRHttpException\n\nWith these changes, we should be in a better position to remove\nFHIRHttpException. Instead of setting the HTTP Status code whenever we\nthrow, we will set just the OperationOutcome.issue.type and map those to\nthe desired HTTP status codes in a single spot (currently\nIssueTypeToHttpStatusMapper).\n\nThese changes should help prepare us better for both #17 (fewer spots to\nadd logging) and #194 (replacing thrown exceptions with returned\nOperationOutcome)\n\nSigned-off-by: Lee Surprenant <lmsurpre@us.ibm.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "8172df4cecf1d3eedfb0b3525d701d1e8e409bcc", "author": {"user": {"login": "lmsurpre", "name": "Lee Surprenant"}}, "url": "https://github.com/IBM/FHIR/commit/8172df4cecf1d3eedfb0b3525d701d1e8e409bcc", "committedDate": "2020-02-26T17:22:17Z", "message": "Reduce reliance on FHIRHttpException\n\nWith these changes, we should be in a better position to remove\nFHIRHttpException. Instead of setting the HTTP Status code whenever we\nthrow, we will set just the OperationOutcome.issue.type and map those to\nthe desired HTTP status codes in a single spot (currently\nIssueTypeToHttpStatusMapper).\n\nThese changes should help prepare us better for both #17 (fewer spots to\nadd logging) and #194 (replacing thrown exceptions with returned\nOperationOutcome)\n\nSigned-off-by: Lee Surprenant <lmsurpre@us.ibm.com>"}, "afterCommit": {"oid": "f72f6504799036868a81813629ffa14f3202d25b", "author": {"user": {"login": "lmsurpre", "name": "Lee Surprenant"}}, "url": "https://github.com/IBM/FHIR/commit/f72f6504799036868a81813629ffa14f3202d25b", "committedDate": "2020-02-26T17:24:08Z", "message": "Reduce reliance on FHIRHttpException\n\nWith these changes, we should be in a better position to remove\nFHIRHttpException. Instead of setting the HTTP Status code whenever we\nthrow, we will set just the OperationOutcome.issue.type and map those to\nthe desired HTTP status codes in a single spot (currently\nIssueTypeToHttpStatusMapper).\n\nThese changes should help prepare us better for both #17 (fewer spots to\nadd logging) and #194 (replacing thrown exceptions with returned\nOperationOutcome)\n\nSigned-off-by: Lee Surprenant <lmsurpre@us.ibm.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY1MTQyMzc0", "url": "https://github.com/IBM/FHIR/pull/731#pullrequestreview-365142374", "createdAt": "2020-02-26T18:35:11Z", "commit": {"oid": "f72f6504799036868a81813629ffa14f3202d25b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNlQxODozNToxMVrOFu3R5A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNlQxODozNToxMVrOFu3R5A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDY4NDUxNg==", "bodyText": "is this method used anywhere else? is it in FHIRUtil because you think it will be? it might be more containable to add it to this class.", "url": "https://github.com/IBM/FHIR/pull/731#discussion_r384684516", "createdAt": "2020-02-26T18:35:11Z", "author": {"login": "prb112"}, "path": "fhir-server/src/main/java/com/ibm/fhir/server/util/IssueTypeToHttpStatusMapper.java", "diffHunk": "@@ -36,15 +43,20 @@\n             for (Issue issue : issues) {\n                 IssueType code = issue.getCode();\n                 if (code != null && code.getValue() != null) {\n-                    return issueTypeToResponseCode(IssueType.ValueSet.from(code.getValue()));\n+                    ValueSet issueType = IssueType.ValueSet.from(code.getValue());\n+                    // Special case for IssueType CONFLICT which can be either an HTTP 409 (Conflict) or HTTP 412 (Precondition failed)\n+                    if (issueType == IssueType.ValueSet.CONFLICT &&\n+                            FHIRUtil.getExtensionStringValue(code, EXTENSION_URL_HTTP_FAILED_PRECONDITION) != null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f72f6504799036868a81813629ffa14f3202d25b"}, "originalPosition": 24}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY1MTQzMTM1", "url": "https://github.com/IBM/FHIR/pull/731#pullrequestreview-365143135", "createdAt": "2020-02-26T18:36:18Z", "commit": {"oid": "f72f6504799036868a81813629ffa14f3202d25b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNlQxODozNjoxOFrOFu3UVQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNlQxODozNjoxOFrOFu3UVQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDY4NTE0MQ==", "bodyText": "any reason to 'lock' it down?", "url": "https://github.com/IBM/FHIR/pull/731#discussion_r384685141", "createdAt": "2020-02-26T18:36:18Z", "author": {"login": "prb112"}, "path": "fhir-server/src/main/java/com/ibm/fhir/server/util/IssueTypeToHttpStatusMapper.java", "diffHunk": "@@ -36,15 +43,20 @@\n             for (Issue issue : issues) {\n                 IssueType code = issue.getCode();\n                 if (code != null && code.getValue() != null) {\n-                    return issueTypeToResponseCode(IssueType.ValueSet.from(code.getValue()));\n+                    ValueSet issueType = IssueType.ValueSet.from(code.getValue());\n+                    // Special case for IssueType CONFLICT which can be either an HTTP 409 (Conflict) or HTTP 412 (Precondition failed)\n+                    if (issueType == IssueType.ValueSet.CONFLICT &&\n+                            FHIRUtil.getExtensionStringValue(code, EXTENSION_URL_HTTP_FAILED_PRECONDITION) != null) {\n+                        return Status.PRECONDITION_FAILED;\n+                    }\n+                    return issueTypeToResponseCode(issueType);\n                 }\n             }\n         }\n-        \n         return Status.INTERNAL_SERVER_ERROR;\n     }\n     \n-    public static Status issueTypeToResponseCode(IssueType.ValueSet value) {\n+    private static Status issueTypeToResponseCode(IssueType.ValueSet value) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f72f6504799036868a81813629ffa14f3202d25b"}, "originalPosition": 36}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY1MTQzODUy", "url": "https://github.com/IBM/FHIR/pull/731#pullrequestreview-365143852", "createdAt": "2020-02-26T18:37:29Z", "commit": {"oid": "f72f6504799036868a81813629ffa14f3202d25b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNlQxODozNzoyOVrOFu3WcA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNlQxODozNzoyOVrOFu3WcA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDY4NTY4MA==", "bodyText": "Confirming... this changed due to the IssueType mapping", "url": "https://github.com/IBM/FHIR/pull/731#discussion_r384685680", "createdAt": "2020-02-26T18:37:29Z", "author": {"login": "prb112"}, "path": "fhir-server-test/src/test/java/com/ibm/fhir/server/test/ServerSpecTest.java", "diffHunk": "@@ -299,7 +299,7 @@ public void testUpdatePatientVersionAwareError3() throws Exception {\n                         .request()\n                         .header(\"If-Match\", ifMatchValue)\n                         .put(entity, Response.class);\n-        assertResponse(response, Response.Status.CONFLICT.getStatusCode());\n+        assertResponse(response, Response.Status.PRECONDITION_FAILED.getStatusCode());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f72f6504799036868a81813629ffa14f3202d25b"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY1MTQ1MDQ2", "url": "https://github.com/IBM/FHIR/pull/731#pullrequestreview-365145046", "createdAt": "2020-02-26T18:39:12Z", "commit": {"oid": "f72f6504799036868a81813629ffa14f3202d25b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNlQxODozOToxMlrOFu3aGA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNlQxODozOToxMlrOFu3aGA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDY4NjYxNg==", "bodyText": "do you need the capabilityStatement instance? immediately responding with it seems preferred", "url": "https://github.com/IBM/FHIR/pull/731#discussion_r384686616", "createdAt": "2020-02-26T18:39:12Z", "author": {"login": "prb112"}, "path": "fhir-server/src/main/java/com/ibm/fhir/server/resources/FHIRResource.java", "diffHunk": "@@ -249,23 +249,21 @@ public FHIRResource() throws Exception {\n     public Response metadata() throws ClassNotFoundException {\n         log.entering(this.getClass().getName(), \"metadata()\");\n         Date startTime = new Date();\n-        Response.Status status = Response.Status.INTERNAL_SERVER_ERROR;\n         String errMsg = \"Caught exception while processing 'metadata' request.\";\n \n         try {\n             checkInitComplete();\n \n-            status = Response.Status.OK;\n-            RestAuditLogger.logMetadata(httpServletRequest, startTime, new Date(), status);\n+            CapabilityStatement capabilityStatement = getCapabilityStatement();\n+            RestAuditLogger.logMetadata(httpServletRequest, startTime, new Date(), Response.Status.OK);\n \n-            return Response.ok().entity(getCapabilityStatement()).build();\n-        } catch (FHIRHttpException e) {\n+            return Response.ok().entity(capabilityStatement).build();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f72f6504799036868a81813629ffa14f3202d25b"}, "originalPosition": 17}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY1MTQ2Njg0", "url": "https://github.com/IBM/FHIR/pull/731#pullrequestreview-365146684", "createdAt": "2020-02-26T18:41:36Z", "commit": {"oid": "f72f6504799036868a81813629ffa14f3202d25b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNlQxODo0MTozN1rOFu3fJg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNlQxODo0MTozN1rOFu3fJg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDY4NzkxMA==", "bodyText": "very helpful comment", "url": "https://github.com/IBM/FHIR/pull/731#discussion_r384687910", "createdAt": "2020-02-26T18:41:37Z", "author": {"login": "prb112"}, "path": "fhir-server/src/main/java/com/ibm/fhir/server/resources/FHIRResource.java", "diffHunk": "@@ -673,9 +645,8 @@ public Response delete(@PathParam(\"type\") String type, @PathParam(\"id\") String i\n                 response = addHeaders(response, ior.getResource());\n             }\n             return response.build();\n-        } catch (FHIRHttpException e) {\n-            return exceptionResponse(e);\n         } catch (FHIRPersistenceResourceNotFoundException e) {\n+            // Overwrite the exception response status because we want NOT_FOUND to be success for delete", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f72f6504799036868a81813629ffa14f3202d25b"}, "originalPosition": 211}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY1MTQ4NzE2", "url": "https://github.com/IBM/FHIR/pull/731#pullrequestreview-365148716", "createdAt": "2020-02-26T18:44:40Z", "commit": {"oid": "f72f6504799036868a81813629ffa14f3202d25b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY1MjgwMzQ5", "url": "https://github.com/IBM/FHIR/pull/731#pullrequestreview-365280349", "createdAt": "2020-02-26T22:09:01Z", "commit": {"oid": "f72f6504799036868a81813629ffa14f3202d25b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNlQyMjowOTowMVrOFu-Kwg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNlQyMjowOTowMVrOFu-Kwg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDc5NzM3OA==", "bodyText": "Should this use the new getValueAsEnumConstant method?", "url": "https://github.com/IBM/FHIR/pull/731#discussion_r384797378", "createdAt": "2020-02-26T22:09:01Z", "author": {"login": "JohnTimm"}, "path": "fhir-server/src/main/java/com/ibm/fhir/server/util/IssueTypeToHttpStatusMapper.java", "diffHunk": "@@ -36,15 +43,20 @@\n             for (Issue issue : issues) {\n                 IssueType code = issue.getCode();\n                 if (code != null && code.getValue() != null) {\n-                    return issueTypeToResponseCode(IssueType.ValueSet.from(code.getValue()));\n+                    ValueSet issueType = IssueType.ValueSet.from(code.getValue());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f72f6504799036868a81813629ffa14f3202d25b"}, "originalPosition": 21}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "879ac6f270f1cf9c7bd8e3160b4d782328f8ff65", "author": {"user": {"login": "lmsurpre", "name": "Lee Surprenant"}}, "url": "https://github.com/IBM/FHIR/commit/879ac6f270f1cf9c7bd8e3160b4d782328f8ff65", "committedDate": "2020-02-27T14:33:19Z", "message": "Reduce reliance on FHIRHttpException\n\nWith these changes, we should be in a better position to remove\nFHIRHttpException. Instead of setting the HTTP Status code whenever we\nthrow, we will set just the OperationOutcome.issue.type and map those to\nthe desired HTTP status codes in a single spot (currently\nIssueTypeToHttpStatusMapper).\n\nThese changes should help prepare us better for both #17 (fewer spots to\nadd logging) and #194 (replacing thrown exceptions with returned\nOperationOutcome)\n\nSigned-off-by: Lee Surprenant <lmsurpre@us.ibm.com>"}, "afterCommit": {"oid": "35472d931362ce89f61175d34cc3fa51788551a0", "author": {"user": {"login": "lmsurpre", "name": "Lee Surprenant"}}, "url": "https://github.com/IBM/FHIR/commit/35472d931362ce89f61175d34cc3fa51788551a0", "committedDate": "2020-02-27T14:33:46Z", "message": "Reduce reliance on FHIRHttpException\n\nWith these changes, we should be in a better position to remove\nFHIRHttpException. Instead of setting the HTTP Status code whenever we\nthrow, we will set just the OperationOutcome.issue.type and map those to\nthe desired HTTP status codes in a single spot (currently\nIssueTypeToHttpStatusMapper).\n\nThese changes should help prepare us better for both #17 (fewer spots to\nadd logging) and #194 (replacing thrown exceptions with returned\nOperationOutcome)\n\nSigned-off-by: Lee Surprenant <lmsurpre@us.ibm.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f72f6504799036868a81813629ffa14f3202d25b", "author": {"user": {"login": "lmsurpre", "name": "Lee Surprenant"}}, "url": "https://github.com/IBM/FHIR/commit/f72f6504799036868a81813629ffa14f3202d25b", "committedDate": "2020-02-26T17:24:08Z", "message": "Reduce reliance on FHIRHttpException\n\nWith these changes, we should be in a better position to remove\nFHIRHttpException. Instead of setting the HTTP Status code whenever we\nthrow, we will set just the OperationOutcome.issue.type and map those to\nthe desired HTTP status codes in a single spot (currently\nIssueTypeToHttpStatusMapper).\n\nThese changes should help prepare us better for both #17 (fewer spots to\nadd logging) and #194 (replacing thrown exceptions with returned\nOperationOutcome)\n\nSigned-off-by: Lee Surprenant <lmsurpre@us.ibm.com>"}, "afterCommit": {"oid": "879ac6f270f1cf9c7bd8e3160b4d782328f8ff65", "author": {"user": {"login": "lmsurpre", "name": "Lee Surprenant"}}, "url": "https://github.com/IBM/FHIR/commit/879ac6f270f1cf9c7bd8e3160b4d782328f8ff65", "committedDate": "2020-02-27T14:33:19Z", "message": "Reduce reliance on FHIRHttpException\n\nWith these changes, we should be in a better position to remove\nFHIRHttpException. Instead of setting the HTTP Status code whenever we\nthrow, we will set just the OperationOutcome.issue.type and map those to\nthe desired HTTP status codes in a single spot (currently\nIssueTypeToHttpStatusMapper).\n\nThese changes should help prepare us better for both #17 (fewer spots to\nadd logging) and #194 (replacing thrown exceptions with returned\nOperationOutcome)\n\nSigned-off-by: Lee Surprenant <lmsurpre@us.ibm.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6dba05b1b1e32304b7a645fe3526492495f30a2f", "author": {"user": {"login": "lmsurpre", "name": "Lee Surprenant"}}, "url": "https://github.com/IBM/FHIR/commit/6dba05b1b1e32304b7a645fe3526492495f30a2f", "committedDate": "2020-03-02T15:04:40Z", "message": "Reduce reliance on FHIRHttpException\n\nWith these changes, we should be in a better position to remove\nFHIRHttpException. Instead of setting the HTTP Status code whenever we\nthrow, we will set just the OperationOutcome.issue.type and map those to\nthe desired HTTP status codes in a single spot (currently\nIssueTypeToHttpStatusMapper).\n\nThese changes should help prepare us better for both #17 (fewer spots to\nadd logging) and #194 (replacing thrown exceptions with returned\nOperationOutcome)\n\nSigned-off-by: Lee Surprenant <lmsurpre@us.ibm.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dc1a6d23df1ea8840e589d76a975a57132a7752f", "author": {"user": {"login": "lmsurpre", "name": "Lee Surprenant"}}, "url": "https://github.com/IBM/FHIR/commit/dc1a6d23df1ea8840e589d76a975a57132a7752f", "committedDate": "2020-03-03T16:42:09Z", "message": "issues #747 and #748 - batch/transaction processing edits\n\nUpdated bundle processing such that:\n1. 'batch' requests return with 200 OK when one or more of the entries\nfails (check each entry for its response status).\n2. 'transaction' requests return a single OperationOutcome in case of\nfailure.  I normalize whatever the normal status code would be into\neither 400 (client error) or 500 (server error).\n\nI also finished removing all usage of FHIRHttpException. To do it, I had\nto introduced a new extension,\n`http://ibm.com/fhir/extension/not-supported-detail` to disambiguate\nnot-supported interactions from not-supported resource types.\n\nSigned-off-by: Lee Surprenant <lmsurpre@us.ibm.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "35472d931362ce89f61175d34cc3fa51788551a0", "author": {"user": {"login": "lmsurpre", "name": "Lee Surprenant"}}, "url": "https://github.com/IBM/FHIR/commit/35472d931362ce89f61175d34cc3fa51788551a0", "committedDate": "2020-02-27T14:33:46Z", "message": "Reduce reliance on FHIRHttpException\n\nWith these changes, we should be in a better position to remove\nFHIRHttpException. Instead of setting the HTTP Status code whenever we\nthrow, we will set just the OperationOutcome.issue.type and map those to\nthe desired HTTP status codes in a single spot (currently\nIssueTypeToHttpStatusMapper).\n\nThese changes should help prepare us better for both #17 (fewer spots to\nadd logging) and #194 (replacing thrown exceptions with returned\nOperationOutcome)\n\nSigned-off-by: Lee Surprenant <lmsurpre@us.ibm.com>"}, "afterCommit": {"oid": "dc1a6d23df1ea8840e589d76a975a57132a7752f", "author": {"user": {"login": "lmsurpre", "name": "Lee Surprenant"}}, "url": "https://github.com/IBM/FHIR/commit/dc1a6d23df1ea8840e589d76a975a57132a7752f", "committedDate": "2020-03-03T16:42:09Z", "message": "issues #747 and #748 - batch/transaction processing edits\n\nUpdated bundle processing such that:\n1. 'batch' requests return with 200 OK when one or more of the entries\nfails (check each entry for its response status).\n2. 'transaction' requests return a single OperationOutcome in case of\nfailure.  I normalize whatever the normal status code would be into\neither 400 (client error) or 500 (server error).\n\nI also finished removing all usage of FHIRHttpException. To do it, I had\nto introduced a new extension,\n`http://ibm.com/fhir/extension/not-supported-detail` to disambiguate\nnot-supported interactions from not-supported resource types.\n\nSigned-off-by: Lee Surprenant <lmsurpre@us.ibm.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY4MjY2MTEw", "url": "https://github.com/IBM/FHIR/pull/731#pullrequestreview-368266110", "createdAt": "2020-03-03T19:36:02Z", "commit": {"oid": "dc1a6d23df1ea8840e589d76a975a57132a7752f"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY4Mjc3NDIy", "url": "https://github.com/IBM/FHIR/pull/731#pullrequestreview-368277422", "createdAt": "2020-03-03T19:53:05Z", "commit": {"oid": "dc1a6d23df1ea8840e589d76a975a57132a7752f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wM1QxOTo1MzowNVrOFxURNQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wM1QxOTo1MzowNVrOFxURNQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzI1NjYyOQ==", "bodyText": "Essentially 460 is duplicate - just a different origin.  Perhaps refactor into an intermediate method.", "url": "https://github.com/IBM/FHIR/pull/731#discussion_r387256629", "createdAt": "2020-03-03T19:53:05Z", "author": {"login": "prb112"}, "path": "fhir-model/src/main/java/com/ibm/fhir/model/util/FHIRUtil.java", "diffHunk": "@@ -433,7 +438,8 @@ public static String getExtensionStringValue(Resource resource, String extension\n             if (DomainResource.class.isAssignableFrom(resource.getClass())) {\n                 DomainResource dr = (DomainResource) resource;\n                 for (Extension ext : dr.getExtension()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dc1a6d23df1ea8840e589d76a975a57132a7752f"}, "originalPosition": 39}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY4Mjc4MTY5", "url": "https://github.com/IBM/FHIR/pull/731#pullrequestreview-368278169", "createdAt": "2020-03-03T19:54:11Z", "commit": {"oid": "dc1a6d23df1ea8840e589d76a975a57132a7752f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wM1QxOTo1NDoxMVrOFxUTkg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wM1QxOTo1NDoxMVrOFxUTkg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzI1NzIzNA==", "bodyText": "Please update copyright", "url": "https://github.com/IBM/FHIR/pull/731#discussion_r387257234", "createdAt": "2020-03-03T19:54:11Z", "author": {"login": "prb112"}, "path": "fhir-server/src/main/java/com/ibm/fhir/server/exception/FHIRRestBundledRequestException.java", "diffHunk": "@@ -6,14 +6,10 @@\n \n package com.ibm.fhir.server.exception;\n \n-import java.util.Collection;\n-\n-import javax.ws.rs.core.Response.Status;\n-\n+import com.ibm.fhir.exception.FHIROperationException;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dc1a6d23df1ea8840e589d76a975a57132a7752f"}, "originalPosition": 8}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY4Mjc4NTA2", "url": "https://github.com/IBM/FHIR/pull/731#pullrequestreview-368278506", "createdAt": "2020-03-03T19:54:42Z", "commit": {"oid": "dc1a6d23df1ea8840e589d76a975a57132a7752f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wM1QxOTo1NDo0MlrOFxUUhQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wM1QxOTo1NDo0MlrOFxUUhQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzI1NzQ3Nw==", "bodyText": "please update copyright", "url": "https://github.com/IBM/FHIR/pull/731#discussion_r387257477", "createdAt": "2020-03-03T19:54:42Z", "author": {"login": "prb112"}, "path": "fhir-server/src/main/java/com/ibm/fhir/server/util/IssueTypeToHttpStatusMapper.java", "diffHunk": "@@ -14,8 +14,20 @@\n import com.ibm.fhir.model.resource.OperationOutcome;\n import com.ibm.fhir.model.resource.OperationOutcome.Issue;\n import com.ibm.fhir.model.type.code.IssueType;\n+import com.ibm.fhir.model.util.FHIRUtil;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dc1a6d23df1ea8840e589d76a975a57132a7752f"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY4MjgxNDIz", "url": "https://github.com/IBM/FHIR/pull/731#pullrequestreview-368281423", "createdAt": "2020-03-03T19:58:56Z", "commit": {"oid": "dc1a6d23df1ea8840e589d76a975a57132a7752f"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a8b3f905b96018477a59eb79d481e82960511f7b", "author": {"user": {"login": "lmsurpre", "name": "Lee Surprenant"}}, "url": "https://github.com/IBM/FHIR/commit/a8b3f905b96018477a59eb79d481e82960511f7b", "committedDate": "2020-03-03T20:23:57Z", "message": "Updates per PR feedback\n\nUpdated copyrights and factored out common method as suggested.\n\nAlso removed an unused private test method and reduced scope of\nunnecessary `status` variables in the JAXRS-annotated methods...now we\nonly use that approach on the `doX` methods.\n\nSigned-off-by: Lee Surprenant <lmsurpre@us.ibm.com>"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 710, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}