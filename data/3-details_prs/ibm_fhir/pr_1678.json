{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE3NDQ3NzU4", "number": 1678, "title": "issue #1673 - change default ordering for resource searches", "bodyText": "Note: I'm opening this PR against Mike's branch for #1218 instead of master because I was already under that branch when I made the change.  If needed, I can cherry-pick it into a new branch off master, but my assumption is that we'll merge Mike's PR soon anyway and so it doesn't matter much.\nPreviously, we used a default sort of RESOURCE_ID ASC (the row identifier of the resource version being returned).\nWhile investigating #1673, I noticed that removing this sort took this query from 10 seconds down to 3-4 seconds.\nHowever, having some sort order is important, so that we get consistent page results.\nUpon further inspection, I found that changing the default sort to LOGICAL_RESOURCE_ID (the row identifier of the logical resource row being returned)\nyielded a similar performance boost and so this is the proposed change.", "createdAt": "2020-11-09T03:51:59Z", "url": "https://github.com/IBM/FHIR/pull/1678", "merged": true, "mergeCommit": {"oid": "9e38e6a395e6c6dd163a773d4c13a6748a719ec1"}, "closed": true, "closedAt": "2020-11-09T20:14:33Z", "author": {"login": "lmsurpre"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdasiNHgH2gAyNTE3NDQ3NzU4OjhkZTdjNjkxNTQyZDcyNzJjZDM2NDQ3MmE1NTE2Njg2MzY1MDA4NmE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABda2320gFqTUyNjM5ODA0MA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "8de7c691542d7272cd364472a55166863650086a", "author": {"user": {"login": "lmsurpre", "name": "Lee Surprenant"}}, "url": "https://github.com/IBM/FHIR/commit/8de7c691542d7272cd364472a55166863650086a", "committedDate": "2020-11-09T03:52:27Z", "message": "issue #1673 - change default ordering\n\nPreviously, we used a default sort of RESOURCE_ID ASC (the row identifier of the resource version being returned).\nWhile investigating #1673, I noticed that removing this sort took this query from 10 seconds down to 3-4 seconds.\n\nHowever, having *some* sort order is important, so that we get consistent page results.\nUpon further inspection, I found that changing the default sort to LOGICAL_RESOURCE_ID (the row identifier of the logical resource row being returned)\nyielded a similar performance boost and so this is the proposed change.\n\nSigned-off-by: Lee Surprenant <lmsurpre@us.ibm.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f32704795401ff16a5dce06d5bbba63d2b960e4a", "author": {"user": {"login": "lmsurpre", "name": "Lee Surprenant"}}, "url": "https://github.com/IBM/FHIR/commit/f32704795401ff16a5dce06d5bbba63d2b960e4a", "committedDate": "2020-11-09T03:44:53Z", "message": "issue #1673 - change default ordering\n\nPreviously, we used a default sort of RESOURCE_ID ASC (the row identifier of the resource version being returned).\nWhile investigating #1673, I noticed that removing this sort took this query from 10 seconds down to 3-4 seconds.\n\nHowever, having *some* sort order is important, so that we get consistent page results.\nUpon further inspection, I found that changing the default sort to LOGICAL_RESOURCE_ID (the row identifier of the logical resource row being returned)\nyielded a similar performance boost and so this is the proposed change."}, "afterCommit": {"oid": "8de7c691542d7272cd364472a55166863650086a", "author": {"user": {"login": "lmsurpre", "name": "Lee Surprenant"}}, "url": "https://github.com/IBM/FHIR/commit/8de7c691542d7272cd364472a55166863650086a", "committedDate": "2020-11-09T03:52:27Z", "message": "issue #1673 - change default ordering\n\nPreviously, we used a default sort of RESOURCE_ID ASC (the row identifier of the resource version being returned).\nWhile investigating #1673, I noticed that removing this sort took this query from 10 seconds down to 3-4 seconds.\n\nHowever, having *some* sort order is important, so that we get consistent page results.\nUpon further inspection, I found that changing the default sort to LOGICAL_RESOURCE_ID (the row identifier of the logical resource row being returned)\nyielded a similar performance boost and so this is the proposed change.\n\nSigned-off-by: Lee Surprenant <lmsurpre@us.ibm.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI2MjY3NTg5", "url": "https://github.com/IBM/FHIR/pull/1678#pullrequestreview-526267589", "createdAt": "2020-11-09T13:42:49Z", "commit": {"oid": "8de7c691542d7272cd364472a55166863650086a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wOVQxMzo0Mjo0OVrOHvvdjg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wOVQxMzo0Mjo0OVrOHvvdjg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTgyMjczNA==", "bodyText": "just noticing this line, should it be updated?", "url": "https://github.com/IBM/FHIR/pull/1678#discussion_r519822734", "createdAt": "2020-11-09T13:42:49Z", "author": {"login": "prb112"}, "path": "fhir-persistence-jdbc/src/main/java/com/ibm/fhir/persistence/jdbc/JDBCConstants.java", "diffHunk": "@@ -96,7 +96,7 @@\n     public static final String ASCENDING = \"ASC\";\n     public static final String DESCENDING = \"DESC\";\n \n-    public static final String DEFAULT_ORDERING = \" ORDER BY RESOURCE_ID ASC \";\n+    public static final String DEFAULT_ORDERING = \" ORDER BY LOGICAL_RESOURCE_ID ASC \";\n     public static final String DEFAULT_ORDERING_WITH_TABLE = \" ORDER BY R.RESOURCE_ID ASC \";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8de7c691542d7272cd364472a55166863650086a"}, "originalPosition": 6}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI2MjY3ODIz", "url": "https://github.com/IBM/FHIR/pull/1678#pullrequestreview-526267823", "createdAt": "2020-11-09T13:43:06Z", "commit": {"oid": "8de7c691542d7272cd364472a55166863650086a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wOVQxMzo0MzowNlrOHvveLQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wOVQxMzo0MzowNlrOHvveLQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTgyMjg5Mw==", "bodyText": "just noticing this line, should it be updated?", "url": "https://github.com/IBM/FHIR/pull/1678#discussion_r519822893", "createdAt": "2020-11-09T13:43:06Z", "author": {"login": "prb112"}, "path": "fhir-persistence-jdbc/src/main/java/com/ibm/fhir/persistence/jdbc/JDBCConstants.java", "diffHunk": "@@ -96,7 +96,7 @@\n     public static final String ASCENDING = \"ASC\";\n     public static final String DESCENDING = \"DESC\";\n \n-    public static final String DEFAULT_ORDERING = \" ORDER BY RESOURCE_ID ASC \";\n+    public static final String DEFAULT_ORDERING = \" ORDER BY LOGICAL_RESOURCE_ID ASC \";\n     public static final String DEFAULT_ORDERING_WITH_TABLE = \" ORDER BY R.RESOURCE_ID ASC \";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8de7c691542d7272cd364472a55166863650086a"}, "originalPosition": 6}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI2MjY3ODg0", "url": "https://github.com/IBM/FHIR/pull/1678#pullrequestreview-526267884", "createdAt": "2020-11-09T13:43:10Z", "commit": {"oid": "8de7c691542d7272cd364472a55166863650086a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI2Mzk4MDQw", "url": "https://github.com/IBM/FHIR/pull/1678#pullrequestreview-526398040", "createdAt": "2020-11-09T15:55:09Z", "commit": {"oid": "8de7c691542d7272cd364472a55166863650086a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 759, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}