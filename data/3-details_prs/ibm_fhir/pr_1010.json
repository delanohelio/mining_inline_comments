{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDEyMTc3NTIy", "number": 1010, "title": "Issue 1004", "bodyText": "Prepopulate Resource Types and Specification Parameters Name Table #1004\n\n- Update to support prepopulation with specific values\n- Fixed issues in execute/add batch in the Prepopuation\n- Prepopulate ParameterNames and ResourceTypes\n- Refactor Main to remove random AddStatic values\n- Update to Support Derby and DerbyFhirDatabase and DerbyBootstrapper", "createdAt": "2020-05-01T15:33:13Z", "url": "https://github.com/IBM/FHIR/pull/1010", "merged": true, "mergeCommit": {"oid": "48f73949bd19d7a0e888ea1d224f199b7d61fcae"}, "closed": true, "closedAt": "2020-05-01T18:31:04Z", "author": {"login": "prb112"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABccycw7AH2gAyNDEyMTc3NTIyOjkyOWM4Yjk3MjY2ZmFjMTNjMmQ3NWIwYThkZWFlZjM5MjNhNGEyYzg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcdFv03gFqTQwNDMxMzA1MA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "929c8b97266fac13c2d75b0a8deaef3923a4a2c8", "author": {"user": {"login": "prb112", "name": "Paul Bastide"}}, "url": "https://github.com/IBM/FHIR/commit/929c8b97266fac13c2d75b0a8deaef3923a4a2c8", "committedDate": "2020-04-30T19:42:38Z", "message": "Prepopulate Resource Types and Specification Parameters Name Table #1004\n\n- Raise start of sequences to 20000 to support a range of custom\nparameter names/codes stored in the db.\n- Refactor PopulateResourceTypes to work with multi-tenant or single\ntenant stores\n- Refactor Main to support both Resource Types and Parameter Names cache\n\nSigned-off-by: Paul Bastide <pbastide@us.ibm.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a4cf8c634be0f89045c9ef514106a4a45a96532a", "author": {"user": {"login": "prb112", "name": "Paul Bastide"}}, "url": "https://github.com/IBM/FHIR/commit/a4cf8c634be0f89045c9ef514106a4a45a96532a", "committedDate": "2020-05-01T14:17:41Z", "message": "Prepopulate Resource Types and Specification Parameters Name Table #1004\n\n- Update to support prepopulation with specific values\n- Fixed issues in execute/add batch in the Prepopuation\n- Prepopulate ParameterNames and ResourceTypes\n- Refactor Main to remove random AddStatic values\n- Update to Support Derby and DerbyFhirDatabase and DerbyBootstrapper\n\nSigned-off-by: Paul Bastide <pbastide@us.ibm.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA0MjcxNDk1", "url": "https://github.com/IBM/FHIR/pull/1010#pullrequestreview-404271495", "createdAt": "2020-05-01T16:55:57Z", "commit": {"oid": "a4cf8c634be0f89045c9ef514106a4a45a96532a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wMVQxNjo1NTo1N1rOGPPOoA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wMVQxNjo1NTo1N1rOGPPOoA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODYzMTMyOA==", "bodyText": "why 20000 and not 10000?", "url": "https://github.com/IBM/FHIR/pull/1010#discussion_r418631328", "createdAt": "2020-05-01T16:55:57Z", "author": {"login": "lmsurpre"}, "path": "fhir-database-utils/src/main/java/com/ibm/fhir/database/utils/common/CommonDatabaseAdapter.java", "diffHunk": "@@ -424,14 +424,14 @@ public void runStatement(IDatabaseStatement stmt) {\n     public void createSequence(String schemaName, String sequenceName, int cache) {\n         /*\n          * <CODE>CREATE SEQUENCE fhir_sequence\n-             AS BIGINT\n-     START WITH 1000\n-          CACHE 1000\n-       NO CYCLE;</CODE>\n-    */\n+         * AS BIGINT\n+         * START WITH 20000", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a4cf8c634be0f89045c9ef514106a4a45a96532a"}, "originalPosition": 10}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA0Mjk4MTYx", "url": "https://github.com/IBM/FHIR/pull/1010#pullrequestreview-404298161", "createdAt": "2020-05-01T17:45:00Z", "commit": {"oid": "a4cf8c634be0f89045c9ef514106a4a45a96532a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wMVQxNzo0NTowMFrOGPQnRw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wMVQxNzo0NTowMFrOGPQnRw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODY1NDAyMw==", "bodyText": "I guess this wasn't so important, after all?", "url": "https://github.com/IBM/FHIR/pull/1010#discussion_r418654023", "createdAt": "2020-05-01T17:45:00Z", "author": {"login": "lmsurpre"}, "path": "fhir-persistence-schema/src/main/java/com/ibm/fhir/schema/app/Main.java", "diffHunk": "@@ -1045,21 +1035,30 @@ protected void allocateTenant() {\n     }\n \n     /**\n-     * Populate all the static tables we need\n-     *\n-     * @param gen\n-     * @param tenantKey\n+     * populates for the given tenantId the RESOURCE_TYPE table.\n+     * \n+     * @implNote if you update this method, be sure to update\n+     *           DerbyBootstrapper.populateResourceTypeAndParameterNameTableEntries\n+     *           and DerbyFhirDatabase.populateResourceTypeAndParameterNameTableEntries\n+     *           The reason is there are three different ways of managing the transaction.\n+     * @param tenantId the mt_id that is used to setup the partition.\n+     *                 passing in null signals not multi-tenant.\n      */\n-    protected void populateStaticTables(FhirSchemaGenerator gen, String tenantKey) {\n-        IDatabaseAdapter adapter = getDbAdapter(connectionPool);\n+    protected void populateResourceTypeAndParameterNameTableEntries(Integer tenantId) {\n         try (ITransaction tx = TransactionFactory.openTransaction(connectionPool)) {\n-            try {\n-                // Very important. Establish the value of the session variable so that we\n-                // pass the row permission predicate\n-                Db2SetTenantVariable cmd = new Db2SetTenantVariable(adminSchemaName, tenantName, tenantKey);\n-                adapter.runStatement(cmd);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a4cf8c634be0f89045c9ef514106a4a45a96532a"}, "originalPosition": 78}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA0MzA5MzM2", "url": "https://github.com/IBM/FHIR/pull/1010#pullrequestreview-404309336", "createdAt": "2020-05-01T18:04:54Z", "commit": {"oid": "a4cf8c634be0f89045c9ef514106a4a45a96532a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wMVQxODowNDo1NFrOGPRL5Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wMVQxODowNDo1NFrOGPRL5Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODY2MzM5Nw==", "bodyText": "yikes, this old description was awful", "url": "https://github.com/IBM/FHIR/pull/1010#discussion_r418663397", "createdAt": "2020-05-01T18:04:54Z", "author": {"login": "lmsurpre"}, "path": "fhir-persistence-schema/src/main/resources/add_parameter_name.sql", "diffHunk": "@@ -5,11 +5,7 @@\n -------------------------------------------------------------------------------\n \n -- ----------------------------------------------------------------------------\n--- Procedure to add a resource version and its associated parameters. These\n--- parameters only ever point to the latest version of a resource, never to\n--- previous versions, which are kept to support history queries.\n--- Parameters must be loaded into the parameters_gtt global temporary table\n--- prior to this procedure being called", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a4cf8c634be0f89045c9ef514106a4a45a96532a"}, "originalPosition": 8}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA0MzA5ODg4", "url": "https://github.com/IBM/FHIR/pull/1010#pullrequestreview-404309888", "createdAt": "2020-05-01T18:05:54Z", "commit": {"oid": "a4cf8c634be0f89045c9ef514106a4a45a96532a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wMVQxODowNTo1NFrOGPRNfg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wMVQxODowNTo1NFrOGPRNfg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODY2MzgwNg==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            # This class maintains a version agnostic mapping and ordering of resources to LOGICAL_IDs. \n          \n          \n            \n            # This file maintains a version agnostic mapping and ordering of parameter names (codes)\n          \n          \n            \n            # to identifiers for pre-populating the PARAMETER_NAMES table.", "url": "https://github.com/IBM/FHIR/pull/1010#discussion_r418663806", "createdAt": "2020-05-01T18:05:54Z", "author": {"login": "lmsurpre"}, "path": "fhir-persistence-schema/src/main/resources/parameter_names.properties", "diffHunk": "@@ -0,0 +1,453 @@\n+# This class maintains a version agnostic mapping and ordering of resources to LOGICAL_IDs. ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a4cf8c634be0f89045c9ef514106a4a45a96532a"}, "originalPosition": 1}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f2a454a05d1b421ac21cda713ebbb79293b212b2", "author": {"user": {"login": "prb112", "name": "Paul Bastide"}}, "url": "https://github.com/IBM/FHIR/commit/f2a454a05d1b421ac21cda713ebbb79293b212b2", "committedDate": "2020-05-01T18:07:37Z", "message": "Update fhir-persistence-schema/src/main/resources/parameter_names.properties\r\n\r\nSigned-off-by: Paul Bastide <pbastide@us.ibm.com>\n\nCo-authored-by: Lee Surprenant <lmsurpre@us.ibm.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA0MzEzMDUw", "url": "https://github.com/IBM/FHIR/pull/1010#pullrequestreview-404313050", "createdAt": "2020-05-01T18:11:39Z", "commit": {"oid": "f2a454a05d1b421ac21cda713ebbb79293b212b2"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 425, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}