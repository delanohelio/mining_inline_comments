{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk1ODIzMDAw", "number": 869, "reviewThreads": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMFQxOTozMTo1MlrODs0q6g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMlQxMzo1ODowMFrODt90uw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ4MzI2ODkwOnYy", "diffSide": "RIGHT", "path": "fhir-server-test/src/test/java/com/ibm/fhir/server/test/BundleTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMFQxOTozMTo1MlrOF95EPg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMFQxOTozMTo1MlrOF95EPg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDQ0MjQzMA==", "bodyText": "this is the only real change in this file, all the others are just formats like removing empty spaces at the line ends.", "url": "https://github.com/IBM/FHIR/pull/869#discussion_r400442430", "createdAt": "2020-03-30T19:31:52Z", "author": {"login": "albertwang-ibm"}, "path": "fhir-server-test/src/test/java/com/ibm/fhir/server/test/BundleTest.java", "diffHunk": "@@ -2209,8 +2209,7 @@ public void testBatchConditionalDeletes() throws Exception {\n         assertResponseBundle(responseBundle, BundleType.BATCH_RESPONSE, 4);\n         assertGoodGetResponse(responseBundle.getEntry().get(0), Status.OK.getStatusCode(), HTTPReturnPreference.MINIMAL);\n         assertGoodGetResponse(responseBundle.getEntry().get(1), Status.NO_CONTENT.getStatusCode(), HTTPReturnPreference.MINIMAL);\n-        assertBadResponse(responseBundle.getEntry().get(2), Status.PRECONDITION_FAILED.getStatusCode(),\n-                \"returned multiple matches\");\n+        assertGoodGetResponse(responseBundle.getEntry().get(2), Status.NO_CONTENT.getStatusCode(), HTTPReturnPreference.MINIMAL);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8ec11924798594357a2603d7c09b4135fcd200f9"}, "originalPosition": 652}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ5MTk1OTgzOnYy", "diffSide": "RIGHT", "path": "fhir-server-test/src/test/java/com/ibm/fhir/server/test/BundleTest.java", "isResolved": true, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMVQxODoyMjoxOFrOF_NDiQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMVQyMzo1MjoxOVrOF_WpRA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTgxODUwNQ==", "bodyText": "should it be a 412 to be more consistent with the fhir spec?", "url": "https://github.com/IBM/FHIR/pull/869#discussion_r401818505", "createdAt": "2020-04-01T18:22:18Z", "author": {"login": "lmsurpre"}, "path": "fhir-server-test/src/test/java/com/ibm/fhir/server/test/BundleTest.java", "diffHunk": "@@ -2209,8 +2209,22 @@ public void testBatchConditionalDeletes() throws Exception {\n         assertResponseBundle(responseBundle, BundleType.BATCH_RESPONSE, 4);\n         assertGoodGetResponse(responseBundle.getEntry().get(0), Status.OK.getStatusCode(), HTTPReturnPreference.MINIMAL);\n         assertGoodGetResponse(responseBundle.getEntry().get(1), Status.NO_CONTENT.getStatusCode(), HTTPReturnPreference.MINIMAL);\n-        assertBadResponse(responseBundle.getEntry().get(2), Status.PRECONDITION_FAILED.getStatusCode(),\n-                \"returned multiple matches\");\n+\n+        // A search that results in multiple matches:\n+        // (1) if matches > FHIRConstants.FHIR_CONDITIONAL_DELETE_MAX_NUMBER_DEFAULT, then result in a 400 status code.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "27e7f1ab2797531f384a51a5ebe23f5c256848de"}, "originalPosition": 664}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTgyMjM1MQ==", "bodyText": "Multiple matches: A server may choose to delete all the matching resources, or it may choose to return a 412 Precondition Failed error indicating the client's criteria were not selective enough. A server indicates whether it can delete multiple resources in its Capability Statement (.rest.resource.conditionalDelete)", "url": "https://github.com/IBM/FHIR/pull/869#discussion_r401822351", "createdAt": "2020-04-01T18:28:45Z", "author": {"login": "lmsurpre"}, "path": "fhir-server-test/src/test/java/com/ibm/fhir/server/test/BundleTest.java", "diffHunk": "@@ -2209,8 +2209,22 @@ public void testBatchConditionalDeletes() throws Exception {\n         assertResponseBundle(responseBundle, BundleType.BATCH_RESPONSE, 4);\n         assertGoodGetResponse(responseBundle.getEntry().get(0), Status.OK.getStatusCode(), HTTPReturnPreference.MINIMAL);\n         assertGoodGetResponse(responseBundle.getEntry().get(1), Status.NO_CONTENT.getStatusCode(), HTTPReturnPreference.MINIMAL);\n-        assertBadResponse(responseBundle.getEntry().get(2), Status.PRECONDITION_FAILED.getStatusCode(),\n-                \"returned multiple matches\");\n+\n+        // A search that results in multiple matches:\n+        // (1) if matches > FHIRConstants.FHIR_CONDITIONAL_DELETE_MAX_NUMBER_DEFAULT, then result in a 400 status code.", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTgxODUwNQ=="}, "originalCommit": {"oid": "27e7f1ab2797531f384a51a5ebe23f5c256848de"}, "originalPosition": 664}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTk1MzQ2OQ==", "bodyText": "I choose not to use 412 just because I thought 412 means we don't support multiple matches at all. but we does support. anyway, I'm ok to change to use 412 instead.", "url": "https://github.com/IBM/FHIR/pull/869#discussion_r401953469", "createdAt": "2020-04-01T22:45:07Z", "author": {"login": "albertwang-ibm"}, "path": "fhir-server-test/src/test/java/com/ibm/fhir/server/test/BundleTest.java", "diffHunk": "@@ -2209,8 +2209,22 @@ public void testBatchConditionalDeletes() throws Exception {\n         assertResponseBundle(responseBundle, BundleType.BATCH_RESPONSE, 4);\n         assertGoodGetResponse(responseBundle.getEntry().get(0), Status.OK.getStatusCode(), HTTPReturnPreference.MINIMAL);\n         assertGoodGetResponse(responseBundle.getEntry().get(1), Status.NO_CONTENT.getStatusCode(), HTTPReturnPreference.MINIMAL);\n-        assertBadResponse(responseBundle.getEntry().get(2), Status.PRECONDITION_FAILED.getStatusCode(),\n-                \"returned multiple matches\");\n+\n+        // A search that results in multiple matches:\n+        // (1) if matches > FHIRConstants.FHIR_CONDITIONAL_DELETE_MAX_NUMBER_DEFAULT, then result in a 400 status code.", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTgxODUwNQ=="}, "originalCommit": {"oid": "27e7f1ab2797531f384a51a5ebe23f5c256848de"}, "originalPosition": 664}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTk3NTYyMA==", "bodyText": "done", "url": "https://github.com/IBM/FHIR/pull/869#discussion_r401975620", "createdAt": "2020-04-01T23:52:19Z", "author": {"login": "albertwang-ibm"}, "path": "fhir-server-test/src/test/java/com/ibm/fhir/server/test/BundleTest.java", "diffHunk": "@@ -2209,8 +2209,22 @@ public void testBatchConditionalDeletes() throws Exception {\n         assertResponseBundle(responseBundle, BundleType.BATCH_RESPONSE, 4);\n         assertGoodGetResponse(responseBundle.getEntry().get(0), Status.OK.getStatusCode(), HTTPReturnPreference.MINIMAL);\n         assertGoodGetResponse(responseBundle.getEntry().get(1), Status.NO_CONTENT.getStatusCode(), HTTPReturnPreference.MINIMAL);\n-        assertBadResponse(responseBundle.getEntry().get(2), Status.PRECONDITION_FAILED.getStatusCode(),\n-                \"returned multiple matches\");\n+\n+        // A search that results in multiple matches:\n+        // (1) if matches > FHIRConstants.FHIR_CONDITIONAL_DELETE_MAX_NUMBER_DEFAULT, then result in a 400 status code.", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTgxODUwNQ=="}, "originalCommit": {"oid": "27e7f1ab2797531f384a51a5ebe23f5c256848de"}, "originalPosition": 664}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ5MTk4NzA4OnYy", "diffSide": "RIGHT", "path": "fhir-server-test/src/test/java/com/ibm/fhir/server/test/DeleteTest.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMVQxODoyOTo0MVrOF_NU6A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMVQyMzo1MjoyOFrOF_WpZQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTgyMjk1Mg==", "bodyText": "should it be a 412 to be more consistent with the fhir spec?", "url": "https://github.com/IBM/FHIR/pull/869#discussion_r401822952", "createdAt": "2020-04-01T18:29:41Z", "author": {"login": "lmsurpre"}, "path": "fhir-server-test/src/test/java/com/ibm/fhir/server/test/DeleteTest.java", "diffHunk": "@@ -430,17 +435,31 @@ public void testConditionalDeleteResource() throws Exception {\n         } else {\n             assertResponse(response.getResponse(), Response.Status.METHOD_NOT_ALLOWED.getStatusCode());\n         }\n-        \n-        // A search that results in multiple matches should result in a 412 status code.\n+\n+        // A search that results in multiple matches:\n+        // (1) if matches > FHIRConstants.FHIR_CONDITIONAL_DELETE_MAX_NUMBER_DEFAULT, then result in a 400 status code.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "27e7f1ab2797531f384a51a5ebe23f5c256848de"}, "originalPosition": 81}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTk1MzU5Mg==", "bodyText": "yes, I'm Ok to change to use 412.", "url": "https://github.com/IBM/FHIR/pull/869#discussion_r401953592", "createdAt": "2020-04-01T22:45:29Z", "author": {"login": "albertwang-ibm"}, "path": "fhir-server-test/src/test/java/com/ibm/fhir/server/test/DeleteTest.java", "diffHunk": "@@ -430,17 +435,31 @@ public void testConditionalDeleteResource() throws Exception {\n         } else {\n             assertResponse(response.getResponse(), Response.Status.METHOD_NOT_ALLOWED.getStatusCode());\n         }\n-        \n-        // A search that results in multiple matches should result in a 412 status code.\n+\n+        // A search that results in multiple matches:\n+        // (1) if matches > FHIRConstants.FHIR_CONDITIONAL_DELETE_MAX_NUMBER_DEFAULT, then result in a 400 status code.", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTgyMjk1Mg=="}, "originalCommit": {"oid": "27e7f1ab2797531f384a51a5ebe23f5c256848de"}, "originalPosition": 81}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTk3NTY1Mw==", "bodyText": "done", "url": "https://github.com/IBM/FHIR/pull/869#discussion_r401975653", "createdAt": "2020-04-01T23:52:28Z", "author": {"login": "albertwang-ibm"}, "path": "fhir-server-test/src/test/java/com/ibm/fhir/server/test/DeleteTest.java", "diffHunk": "@@ -430,17 +435,31 @@ public void testConditionalDeleteResource() throws Exception {\n         } else {\n             assertResponse(response.getResponse(), Response.Status.METHOD_NOT_ALLOWED.getStatusCode());\n         }\n-        \n-        // A search that results in multiple matches should result in a 412 status code.\n+\n+        // A search that results in multiple matches:\n+        // (1) if matches > FHIRConstants.FHIR_CONDITIONAL_DELETE_MAX_NUMBER_DEFAULT, then result in a 400 status code.", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTgyMjk1Mg=="}, "originalCommit": {"oid": "27e7f1ab2797531f384a51a5ebe23f5c256848de"}, "originalPosition": 81}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ5MTk5MjYxOnYy", "diffSide": "RIGHT", "path": "docs/src/pages/guides/FHIRServerUsersGuide.md", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMVQxODozMToxMlrOF_NYYA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMVQyMzo1MjozOVrOF_WprQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTgyMzg0MA==", "bodyText": "because you use FHIRConfigHelper to look up the value of the config property, I think this means it is both tenant-specific and dynamic\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            |`fhirServer/core/conditionalDeleteMaxNumber`|N|N|\n          \n          \n            \n            |`fhirServer/core/conditionalDeleteMaxNumber`|Y|Y|", "url": "https://github.com/IBM/FHIR/pull/869#discussion_r401823840", "createdAt": "2020-04-01T18:31:12Z", "author": {"login": "lmsurpre"}, "path": "docs/src/pages/guides/FHIRServerUsersGuide.md", "diffHunk": "@@ -1420,6 +1422,7 @@ must restart the server for that change to take effect.\n |`fhirServer/core/defaultHandling`|Y|Y|\n |`fhirServer/core/allowClientHandlingPref`|Y|Y|\n |`fhirServer/core/checkReferenceTypes`|N|N|\n+|`fhirServer/core/conditionalDeleteMaxNumber`|N|N|", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "27e7f1ab2797531f384a51a5ebe23f5c256848de"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTk1Mzg1Mg==", "bodyText": "good catch, actually I was not sure about this.", "url": "https://github.com/IBM/FHIR/pull/869#discussion_r401953852", "createdAt": "2020-04-01T22:46:15Z", "author": {"login": "albertwang-ibm"}, "path": "docs/src/pages/guides/FHIRServerUsersGuide.md", "diffHunk": "@@ -1420,6 +1422,7 @@ must restart the server for that change to take effect.\n |`fhirServer/core/defaultHandling`|Y|Y|\n |`fhirServer/core/allowClientHandlingPref`|Y|Y|\n |`fhirServer/core/checkReferenceTypes`|N|N|\n+|`fhirServer/core/conditionalDeleteMaxNumber`|N|N|", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTgyMzg0MA=="}, "originalCommit": {"oid": "27e7f1ab2797531f384a51a5ebe23f5c256848de"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTk3NTcyNQ==", "bodyText": "done", "url": "https://github.com/IBM/FHIR/pull/869#discussion_r401975725", "createdAt": "2020-04-01T23:52:39Z", "author": {"login": "albertwang-ibm"}, "path": "docs/src/pages/guides/FHIRServerUsersGuide.md", "diffHunk": "@@ -1420,6 +1422,7 @@ must restart the server for that change to take effect.\n |`fhirServer/core/defaultHandling`|Y|Y|\n |`fhirServer/core/allowClientHandlingPref`|Y|Y|\n |`fhirServer/core/checkReferenceTypes`|N|N|\n+|`fhirServer/core/conditionalDeleteMaxNumber`|N|N|", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTgyMzg0MA=="}, "originalCommit": {"oid": "27e7f1ab2797531f384a51a5ebe23f5c256848de"}, "originalPosition": 20}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ5MTk5MzU3OnYy", "diffSide": "RIGHT", "path": "fhir-server/src/main/java/com/ibm/fhir/server/util/FHIRRestHelper.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMVQxODozMToyOVrOF_NY8Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMVQyMzowMToyMVrOF_Vp4w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTgyMzk4NQ==", "bodyText": "because you use FHIRConfigHelper to look it up, I think this means it is tenant-specific", "url": "https://github.com/IBM/FHIR/pull/869#discussion_r401823985", "createdAt": "2020-04-01T18:31:29Z", "author": {"login": "lmsurpre"}, "path": "fhir-server/src/main/java/com/ibm/fhir/server/util/FHIRRestHelper.java", "diffHunk": "@@ -499,26 +503,28 @@ public FHIRRestOperationResponse doDelete(String type, String id, String searchQ\n             // resource to be deleted. Otherwise, we'll use the id value to identify the resource\n             // to be deleted.\n             Resource resourceToDelete = null;\n+            Bundle responseBundle = null;\n+\n             if (searchQueryString != null) {\n+                int searchPageSize = FHIRConfigHelper.getIntProperty(FHIRConfiguration.PROPERTY_CONDITIONAL_DELETE_MAX_NUMBER, FHIRConstants.FHIR_CONDITIONAL_DELETE_MAX_NUMBER_DEFAULT);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "27e7f1ab2797531f384a51a5ebe23f5c256848de"}, "originalPosition": 43}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTk1OTM5NQ==", "bodyText": "yes, I agree. just was a little bit confused about the document.", "url": "https://github.com/IBM/FHIR/pull/869#discussion_r401959395", "createdAt": "2020-04-01T23:01:21Z", "author": {"login": "albertwang-ibm"}, "path": "fhir-server/src/main/java/com/ibm/fhir/server/util/FHIRRestHelper.java", "diffHunk": "@@ -499,26 +503,28 @@ public FHIRRestOperationResponse doDelete(String type, String id, String searchQ\n             // resource to be deleted. Otherwise, we'll use the id value to identify the resource\n             // to be deleted.\n             Resource resourceToDelete = null;\n+            Bundle responseBundle = null;\n+\n             if (searchQueryString != null) {\n+                int searchPageSize = FHIRConfigHelper.getIntProperty(FHIRConfiguration.PROPERTY_CONDITIONAL_DELETE_MAX_NUMBER, FHIRConstants.FHIR_CONDITIONAL_DELETE_MAX_NUMBER_DEFAULT);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTgyMzk4NQ=="}, "originalCommit": {"oid": "27e7f1ab2797531f384a51a5ebe23f5c256848de"}, "originalPosition": 43}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ5MzIwMDAyOnYy", "diffSide": "RIGHT", "path": "fhir-bulkimportexport-webapp/src/main/java/com/ibm/fhir/bulkexport/system/ChunkWriter.java", "isResolved": true, "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMlQwMjoxMTozM1rOF_Y6nQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMlQxNDozMToyMFrOF_uEKA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjAxMjgyOQ==", "bodyText": "Is this the part that you mentioned only works on Amazon S3 and not COS?  Or that's something else?", "url": "https://github.com/IBM/FHIR/pull/869#discussion_r402012829", "createdAt": "2020-04-02T02:11:33Z", "author": {"login": "lmsurpre"}, "path": "fhir-bulkimportexport-webapp/src/main/java/com/ibm/fhir/bulkexport/system/ChunkWriter.java", "diffHunk": "@@ -154,11 +158,18 @@ private void pushFhirJsonsToCos(InputStream in, int dataLength) throws Exception\n             if (cosBucketPathPrefix != null && cosBucketPathPrefix.trim().length() > 0) {\n                 itemName = cosBucketPathPrefix + \"/\" + ResourceTypes.get(chunkData.getIndexOfCurrentResourceType())\n                             + \"_\" + chunkData.getPartNum() + \".ndjson\";\n+                if (isExportPublic) {\n+                    // Set expiration time to 2 hours(7200 seconds).\n+                    metadata.setExpirationTime(Date.from(Instant.now().plusSeconds(7200)));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "45c9225519841c2905f62134698740401f1dd613"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjI5NzQxNg==", "bodyText": "yes, correct. IBM COS doesn't support object level expiration time, it only supports bucket level with policy setting which is well documented in IBM COS document, but IBM COS doesn't complaint if you set it even though it doesn't take effect at all.\nI have moved the codes into a separated if (isExportPublic) to avoid confusing - the old codes worked for S3 without any problem which I verified using my Amazon acount and also verified it didn't work in IBM COS;  I think this is because the meta object was really used only when cosClient.putObject is called later, I moved it just for the purpose of avoiding confusing of why do we change the meta after the request is created with the meta as a parameter.  and still, it works for S3 only.", "url": "https://github.com/IBM/FHIR/pull/869#discussion_r402297416", "createdAt": "2020-04-02T13:06:44Z", "author": {"login": "albertwang-ibm"}, "path": "fhir-bulkimportexport-webapp/src/main/java/com/ibm/fhir/bulkexport/system/ChunkWriter.java", "diffHunk": "@@ -154,11 +158,18 @@ private void pushFhirJsonsToCos(InputStream in, int dataLength) throws Exception\n             if (cosBucketPathPrefix != null && cosBucketPathPrefix.trim().length() > 0) {\n                 itemName = cosBucketPathPrefix + \"/\" + ResourceTypes.get(chunkData.getIndexOfCurrentResourceType())\n                             + \"_\" + chunkData.getPartNum() + \".ndjson\";\n+                if (isExportPublic) {\n+                    // Set expiration time to 2 hours(7200 seconds).\n+                    metadata.setExpirationTime(Date.from(Instant.now().plusSeconds(7200)));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjAxMjgyOQ=="}, "originalCommit": {"oid": "45c9225519841c2905f62134698740401f1dd613"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjMzMDU3Nw==", "bodyText": "Thanks for the explanation...mind adding a quick comment in the code to indicate that IBM COS doesn't honor this (but also doesn't fail on it)?", "url": "https://github.com/IBM/FHIR/pull/869#discussion_r402330577", "createdAt": "2020-04-02T13:53:20Z", "author": {"login": "lmsurpre"}, "path": "fhir-bulkimportexport-webapp/src/main/java/com/ibm/fhir/bulkexport/system/ChunkWriter.java", "diffHunk": "@@ -154,11 +158,18 @@ private void pushFhirJsonsToCos(InputStream in, int dataLength) throws Exception\n             if (cosBucketPathPrefix != null && cosBucketPathPrefix.trim().length() > 0) {\n                 itemName = cosBucketPathPrefix + \"/\" + ResourceTypes.get(chunkData.getIndexOfCurrentResourceType())\n                             + \"_\" + chunkData.getPartNum() + \".ndjson\";\n+                if (isExportPublic) {\n+                    // Set expiration time to 2 hours(7200 seconds).\n+                    metadata.setExpirationTime(Date.from(Instant.now().plusSeconds(7200)));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjAxMjgyOQ=="}, "originalCommit": {"oid": "45c9225519841c2905f62134698740401f1dd613"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjM1MTM2NA==", "bodyText": "sure, good point!", "url": "https://github.com/IBM/FHIR/pull/869#discussion_r402351364", "createdAt": "2020-04-02T14:21:07Z", "author": {"login": "albertwang-ibm"}, "path": "fhir-bulkimportexport-webapp/src/main/java/com/ibm/fhir/bulkexport/system/ChunkWriter.java", "diffHunk": "@@ -154,11 +158,18 @@ private void pushFhirJsonsToCos(InputStream in, int dataLength) throws Exception\n             if (cosBucketPathPrefix != null && cosBucketPathPrefix.trim().length() > 0) {\n                 itemName = cosBucketPathPrefix + \"/\" + ResourceTypes.get(chunkData.getIndexOfCurrentResourceType())\n                             + \"_\" + chunkData.getPartNum() + \".ndjson\";\n+                if (isExportPublic) {\n+                    // Set expiration time to 2 hours(7200 seconds).\n+                    metadata.setExpirationTime(Date.from(Instant.now().plusSeconds(7200)));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjAxMjgyOQ=="}, "originalCommit": {"oid": "45c9225519841c2905f62134698740401f1dd613"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjM1OTMzNg==", "bodyText": "done", "url": "https://github.com/IBM/FHIR/pull/869#discussion_r402359336", "createdAt": "2020-04-02T14:31:20Z", "author": {"login": "albertwang-ibm"}, "path": "fhir-bulkimportexport-webapp/src/main/java/com/ibm/fhir/bulkexport/system/ChunkWriter.java", "diffHunk": "@@ -154,11 +158,18 @@ private void pushFhirJsonsToCos(InputStream in, int dataLength) throws Exception\n             if (cosBucketPathPrefix != null && cosBucketPathPrefix.trim().length() > 0) {\n                 itemName = cosBucketPathPrefix + \"/\" + ResourceTypes.get(chunkData.getIndexOfCurrentResourceType())\n                             + \"_\" + chunkData.getPartNum() + \".ndjson\";\n+                if (isExportPublic) {\n+                    // Set expiration time to 2 hours(7200 seconds).\n+                    metadata.setExpirationTime(Date.from(Instant.now().plusSeconds(7200)));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjAxMjgyOQ=="}, "originalCommit": {"oid": "45c9225519841c2905f62134698740401f1dd613"}, "originalPosition": 24}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ5MzIwMjE2OnYy", "diffSide": "RIGHT", "path": "docs/src/pages/guides/FHIRServerUsersGuide.md", "isResolved": true, "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMlQwMjoxMjo0OVrOF_Y76A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMlQxNDozMTowMlrOF_uDXA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjAxMzE2MA==", "bodyText": "does \"cos\" cover all S3-compatible object stores or just the IBM Cloud one?", "url": "https://github.com/IBM/FHIR/pull/869#discussion_r402013160", "createdAt": "2020-04-02T02:12:49Z", "author": {"login": "lmsurpre"}, "path": "docs/src/pages/guides/FHIRServerUsersGuide.md", "diffHunk": "@@ -1368,6 +1327,22 @@ This section contains reference information about each of the configuration prop\n |`fhirServer/audit/serviceProperties/geoState`|string|The Geo State configure for CADF audit logging service.|\n |`fhirServer/audit/serviceProperties/geoCounty`|string|The Geo Country configure for CADF audit logging service.|\n |`fhirServer/search/useBoundingRadius`|boolean|True, the bounding area is a Radius, else the bounding area is a box.|\n+|`fhirServer/bulkdata/applicationName`| string|Fixed value, always set to fhir-bulkimportexport-webapp |\n+|`fhirServer/bulkdata/moduleName`|string| Fixed value, always set to fhir-bulkimportexport.war |\n+|`fhirServer/bulkdata/jobParameters/cos.bucket.name`|string|Object store bucket name |\n+|`fhirServer/bulkdata/jobParameters/cos.location`|Object store location |\n+|`fhirServer/bulkdata/jobParameters/cos.endpointurl`| Object store end point url |\n+|`fhirServer/bulkdata/jobParameters/credential.ibm`| If use IBM credential, \"Y\" or \"N\" |\n+|`fhirServer/bulkdata/jobParameters/cos.api.key`|string|API key for accessing IBM COS |\n+|`fhirServer/bulkdata/jobParameters/cos.srvinst.id`|string|Service instance Id for accessing IBM COS |\n+|`fhirServer/bulkdata/implementation_type`|string|\"cos\" or \"dummy\" which matches the desired bulk operation implementation type |", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "45c9225519841c2905f62134698740401f1dd613"}, "originalPosition": 82}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjI5ODgzMQ==", "bodyText": "I think the answer is all, let me change the description a little bit.\nIBM COS client SDK is forked from Amazon S3 SDK.", "url": "https://github.com/IBM/FHIR/pull/869#discussion_r402298831", "createdAt": "2020-04-02T13:08:56Z", "author": {"login": "albertwang-ibm"}, "path": "docs/src/pages/guides/FHIRServerUsersGuide.md", "diffHunk": "@@ -1368,6 +1327,22 @@ This section contains reference information about each of the configuration prop\n |`fhirServer/audit/serviceProperties/geoState`|string|The Geo State configure for CADF audit logging service.|\n |`fhirServer/audit/serviceProperties/geoCounty`|string|The Geo Country configure for CADF audit logging service.|\n |`fhirServer/search/useBoundingRadius`|boolean|True, the bounding area is a Radius, else the bounding area is a box.|\n+|`fhirServer/bulkdata/applicationName`| string|Fixed value, always set to fhir-bulkimportexport-webapp |\n+|`fhirServer/bulkdata/moduleName`|string| Fixed value, always set to fhir-bulkimportexport.war |\n+|`fhirServer/bulkdata/jobParameters/cos.bucket.name`|string|Object store bucket name |\n+|`fhirServer/bulkdata/jobParameters/cos.location`|Object store location |\n+|`fhirServer/bulkdata/jobParameters/cos.endpointurl`| Object store end point url |\n+|`fhirServer/bulkdata/jobParameters/credential.ibm`| If use IBM credential, \"Y\" or \"N\" |\n+|`fhirServer/bulkdata/jobParameters/cos.api.key`|string|API key for accessing IBM COS |\n+|`fhirServer/bulkdata/jobParameters/cos.srvinst.id`|string|Service instance Id for accessing IBM COS |\n+|`fhirServer/bulkdata/implementation_type`|string|\"cos\" or \"dummy\" which matches the desired bulk operation implementation type |", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjAxMzE2MA=="}, "originalCommit": {"oid": "45c9225519841c2905f62134698740401f1dd613"}, "originalPosition": 82}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjMwODIwMQ==", "bodyText": "done", "url": "https://github.com/IBM/FHIR/pull/869#discussion_r402308201", "createdAt": "2020-04-02T13:23:11Z", "author": {"login": "albertwang-ibm"}, "path": "docs/src/pages/guides/FHIRServerUsersGuide.md", "diffHunk": "@@ -1368,6 +1327,22 @@ This section contains reference information about each of the configuration prop\n |`fhirServer/audit/serviceProperties/geoState`|string|The Geo State configure for CADF audit logging service.|\n |`fhirServer/audit/serviceProperties/geoCounty`|string|The Geo Country configure for CADF audit logging service.|\n |`fhirServer/search/useBoundingRadius`|boolean|True, the bounding area is a Radius, else the bounding area is a box.|\n+|`fhirServer/bulkdata/applicationName`| string|Fixed value, always set to fhir-bulkimportexport-webapp |\n+|`fhirServer/bulkdata/moduleName`|string| Fixed value, always set to fhir-bulkimportexport.war |\n+|`fhirServer/bulkdata/jobParameters/cos.bucket.name`|string|Object store bucket name |\n+|`fhirServer/bulkdata/jobParameters/cos.location`|Object store location |\n+|`fhirServer/bulkdata/jobParameters/cos.endpointurl`| Object store end point url |\n+|`fhirServer/bulkdata/jobParameters/credential.ibm`| If use IBM credential, \"Y\" or \"N\" |\n+|`fhirServer/bulkdata/jobParameters/cos.api.key`|string|API key for accessing IBM COS |\n+|`fhirServer/bulkdata/jobParameters/cos.srvinst.id`|string|Service instance Id for accessing IBM COS |\n+|`fhirServer/bulkdata/implementation_type`|string|\"cos\" or \"dummy\" which matches the desired bulk operation implementation type |", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjAxMzE2MA=="}, "originalCommit": {"oid": "45c9225519841c2905f62134698740401f1dd613"}, "originalPosition": 82}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjMzMzAxNQ==", "bodyText": "I think we should say this in the \"description\" column of this row. Something like this:\n\nUse \"cos\" for any S3-compatible object store", "url": "https://github.com/IBM/FHIR/pull/869#discussion_r402333015", "createdAt": "2020-04-02T13:56:28Z", "author": {"login": "lmsurpre"}, "path": "docs/src/pages/guides/FHIRServerUsersGuide.md", "diffHunk": "@@ -1368,6 +1327,22 @@ This section contains reference information about each of the configuration prop\n |`fhirServer/audit/serviceProperties/geoState`|string|The Geo State configure for CADF audit logging service.|\n |`fhirServer/audit/serviceProperties/geoCounty`|string|The Geo Country configure for CADF audit logging service.|\n |`fhirServer/search/useBoundingRadius`|boolean|True, the bounding area is a Radius, else the bounding area is a box.|\n+|`fhirServer/bulkdata/applicationName`| string|Fixed value, always set to fhir-bulkimportexport-webapp |\n+|`fhirServer/bulkdata/moduleName`|string| Fixed value, always set to fhir-bulkimportexport.war |\n+|`fhirServer/bulkdata/jobParameters/cos.bucket.name`|string|Object store bucket name |\n+|`fhirServer/bulkdata/jobParameters/cos.location`|Object store location |\n+|`fhirServer/bulkdata/jobParameters/cos.endpointurl`| Object store end point url |\n+|`fhirServer/bulkdata/jobParameters/credential.ibm`| If use IBM credential, \"Y\" or \"N\" |\n+|`fhirServer/bulkdata/jobParameters/cos.api.key`|string|API key for accessing IBM COS |\n+|`fhirServer/bulkdata/jobParameters/cos.srvinst.id`|string|Service instance Id for accessing IBM COS |\n+|`fhirServer/bulkdata/implementation_type`|string|\"cos\" or \"dummy\" which matches the desired bulk operation implementation type |", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjAxMzE2MA=="}, "originalCommit": {"oid": "45c9225519841c2905f62134698740401f1dd613"}, "originalPosition": 82}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjM1ODA1Ng==", "bodyText": "en, interesting, seems my change doesn't show up here. I changed to \"  \"cos\" (Any Amazon S3-compatible object stores including IBM COS) or \"dummy\" which matches the desired bulk operation implementation type \".     but I do think your description is better, let me change to it.", "url": "https://github.com/IBM/FHIR/pull/869#discussion_r402358056", "createdAt": "2020-04-02T14:29:43Z", "author": {"login": "albertwang-ibm"}, "path": "docs/src/pages/guides/FHIRServerUsersGuide.md", "diffHunk": "@@ -1368,6 +1327,22 @@ This section contains reference information about each of the configuration prop\n |`fhirServer/audit/serviceProperties/geoState`|string|The Geo State configure for CADF audit logging service.|\n |`fhirServer/audit/serviceProperties/geoCounty`|string|The Geo Country configure for CADF audit logging service.|\n |`fhirServer/search/useBoundingRadius`|boolean|True, the bounding area is a Radius, else the bounding area is a box.|\n+|`fhirServer/bulkdata/applicationName`| string|Fixed value, always set to fhir-bulkimportexport-webapp |\n+|`fhirServer/bulkdata/moduleName`|string| Fixed value, always set to fhir-bulkimportexport.war |\n+|`fhirServer/bulkdata/jobParameters/cos.bucket.name`|string|Object store bucket name |\n+|`fhirServer/bulkdata/jobParameters/cos.location`|Object store location |\n+|`fhirServer/bulkdata/jobParameters/cos.endpointurl`| Object store end point url |\n+|`fhirServer/bulkdata/jobParameters/credential.ibm`| If use IBM credential, \"Y\" or \"N\" |\n+|`fhirServer/bulkdata/jobParameters/cos.api.key`|string|API key for accessing IBM COS |\n+|`fhirServer/bulkdata/jobParameters/cos.srvinst.id`|string|Service instance Id for accessing IBM COS |\n+|`fhirServer/bulkdata/implementation_type`|string|\"cos\" or \"dummy\" which matches the desired bulk operation implementation type |", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjAxMzE2MA=="}, "originalCommit": {"oid": "45c9225519841c2905f62134698740401f1dd613"}, "originalPosition": 82}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjM1OTEzMg==", "bodyText": "done", "url": "https://github.com/IBM/FHIR/pull/869#discussion_r402359132", "createdAt": "2020-04-02T14:31:02Z", "author": {"login": "albertwang-ibm"}, "path": "docs/src/pages/guides/FHIRServerUsersGuide.md", "diffHunk": "@@ -1368,6 +1327,22 @@ This section contains reference information about each of the configuration prop\n |`fhirServer/audit/serviceProperties/geoState`|string|The Geo State configure for CADF audit logging service.|\n |`fhirServer/audit/serviceProperties/geoCounty`|string|The Geo Country configure for CADF audit logging service.|\n |`fhirServer/search/useBoundingRadius`|boolean|True, the bounding area is a Radius, else the bounding area is a box.|\n+|`fhirServer/bulkdata/applicationName`| string|Fixed value, always set to fhir-bulkimportexport-webapp |\n+|`fhirServer/bulkdata/moduleName`|string| Fixed value, always set to fhir-bulkimportexport.war |\n+|`fhirServer/bulkdata/jobParameters/cos.bucket.name`|string|Object store bucket name |\n+|`fhirServer/bulkdata/jobParameters/cos.location`|Object store location |\n+|`fhirServer/bulkdata/jobParameters/cos.endpointurl`| Object store end point url |\n+|`fhirServer/bulkdata/jobParameters/credential.ibm`| If use IBM credential, \"Y\" or \"N\" |\n+|`fhirServer/bulkdata/jobParameters/cos.api.key`|string|API key for accessing IBM COS |\n+|`fhirServer/bulkdata/jobParameters/cos.srvinst.id`|string|Service instance Id for accessing IBM COS |\n+|`fhirServer/bulkdata/implementation_type`|string|\"cos\" or \"dummy\" which matches the desired bulk operation implementation type |", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjAxMzE2MA=="}, "originalCommit": {"oid": "45c9225519841c2905f62134698740401f1dd613"}, "originalPosition": 82}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ5MzIxNTYwOnYy", "diffSide": "LEFT", "path": "docs/src/pages/guides/FHIRServerUsersGuide.md", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMlQwMjoyMDoyNVrOF_ZDeA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMlQwMjoyMDoyNVrOF_ZDeA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjAxNTA5Ng==", "bodyText": "I agree its best to move these to the reference table in section 5; good call", "url": "https://github.com/IBM/FHIR/pull/869#discussion_r402015096", "createdAt": "2020-04-02T02:20:25Z", "author": {"login": "lmsurpre"}, "path": "docs/src/pages/guides/FHIRServerUsersGuide.md", "diffHunk": "@@ -1143,50 +1143,7 @@ The *fhir-bulkimportexport-webapp* module is a wrapper for the whole BulkData we\n     </webApplication>\n ```\n \n-BulkData web application writes the exported FHIR resources to an IBM Cloud Object Storage (COS) or Amazon S3 bucket, as configured in the per-tenant bulkdata.json configuration file. The bulkdata.json file is stored in the tenant configuration directory of each fhir-server instance. The following is a bulkdata.json which is configured to export the FHIR resources into fhir-bulkdata-sample bucket of IBM COS:\n-\n-```json\n-{\n-  \"applicationName\": \"fhir-bulkimportexport-webapp\",\n-  \"moduleName\": \"fhir-bulkimportexport.war\",\n-  \"jobParameters\": {\n-    \"cos.bucket.name\": \"fhir-bulkdata-sample\",\n-    \"cos.location\": \"us\",\n-    \"cos.endpointurl\": \"https://s3.us-south.cloud-object-storage.appdomain.cloud\",\n-    \"cos.credential.ibm\": \"Y\",\n-    \"cos.api.key\": \"xxxxxxxxxxxxxxxxxxxxxxx\",\n-    \"cos.srvinst.id\": \"xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx\",\n-  },\n-  \"implementation_type\": \"cos\",\n-  \"batch-uri\": \"https://localhost:9443/ibm/api/batch/jobinstances\",\n-  \"batch-user\": \"fhiradmin\",\n-  \"batch-user-password\": \"xxxxxxxxxxxx\",\n-  \"batch-truststore\" : \"resources/security/fhirTruststore.jks\",\n-  \"batch-truststore-password\" : \"xxxxxxxxxxxx\",\n-  \"serverHostname\" : \"localhost:9443\",\n-  \"contextRoot\" : \"/fhir-server/api/v4\"\n-}\n-```\n-The following configured parameters are:\n-\n-|Parameter Name   | Description|\n-|--------------| ------------|\n-|`applicationName`| fixed value, always set to fhir-bulkimportexport-webapp |\n-|`moduleName`| fixed value, always set to fhir-bulkimportexport.war |\n-|`jobParameters.cos.bucket.name`| object store bucket name |\n-|`jobParameters.cos.location`| object store location |\n-|`jobParameters.cos.endpointurl`| object store end point url |\n-|`jobParameters.credential.ibm`| if use IBM credential |\n-|`jobParameters.cos.api.key`| api key for accessing IBM COS |\n-|`jobParameters.cos.srvinst.id`| service instance Id for accessing IBM COS |\n-|`implementation_type`| cos or dummy which matches the desired bulk operation implementation type |\n-|`batch-uri`| the URL to access the FHIR server hosting the batch web application |\n-|`batch-user`| user for submitting JavaBatch job |\n-|`batch-user-password`| password for above batch user |\n-|`batch-truststore`| trust store for JavaBatch job submission |\n-|`batch-truststore-password`| password for above trust store |\n-|`serverHostname`| host name part of the server generated polling location url |\n-|`contextRoot`| context root part of the server generated polling location url |", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "45c9225519841c2905f62134698740401f1dd613"}, "originalPosition": 47}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ5MzIxOTEzOnYy", "diffSide": "LEFT", "path": "docs/src/pages/guides/FHIRServerUsersGuide.md", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMlQwMjoyMjo1MFrOF_ZFnA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMlQxMzoyMzowMVrOF_q74w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjAxNTY0NA==", "bodyText": "I agree this content is outdated; now the config data exists in fhir-server-config.json instead of a separate bulkdata.json.\nHowever, I think maybe we should leave a sample config here just to illustrate the properties (and refer to section 5 for the full list of properties).", "url": "https://github.com/IBM/FHIR/pull/869#discussion_r402015644", "createdAt": "2020-04-02T02:22:50Z", "author": {"login": "lmsurpre"}, "path": "docs/src/pages/guides/FHIRServerUsersGuide.md", "diffHunk": "@@ -1143,50 +1143,7 @@ The *fhir-bulkimportexport-webapp* module is a wrapper for the whole BulkData we\n     </webApplication>\n ```\n \n-BulkData web application writes the exported FHIR resources to an IBM Cloud Object Storage (COS) or Amazon S3 bucket, as configured in the per-tenant bulkdata.json configuration file. The bulkdata.json file is stored in the tenant configuration directory of each fhir-server instance. The following is a bulkdata.json which is configured to export the FHIR resources into fhir-bulkdata-sample bucket of IBM COS:\n-\n-```json\n-{\n-  \"applicationName\": \"fhir-bulkimportexport-webapp\",\n-  \"moduleName\": \"fhir-bulkimportexport.war\",\n-  \"jobParameters\": {\n-    \"cos.bucket.name\": \"fhir-bulkdata-sample\",\n-    \"cos.location\": \"us\",\n-    \"cos.endpointurl\": \"https://s3.us-south.cloud-object-storage.appdomain.cloud\",\n-    \"cos.credential.ibm\": \"Y\",\n-    \"cos.api.key\": \"xxxxxxxxxxxxxxxxxxxxxxx\",\n-    \"cos.srvinst.id\": \"xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx\",\n-  },\n-  \"implementation_type\": \"cos\",\n-  \"batch-uri\": \"https://localhost:9443/ibm/api/batch/jobinstances\",\n-  \"batch-user\": \"fhiradmin\",\n-  \"batch-user-password\": \"xxxxxxxxxxxx\",\n-  \"batch-truststore\" : \"resources/security/fhirTruststore.jks\",\n-  \"batch-truststore-password\" : \"xxxxxxxxxxxx\",\n-  \"serverHostname\" : \"localhost:9443\",\n-  \"contextRoot\" : \"/fhir-server/api/v4\"\n-}\n-```", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "45c9225519841c2905f62134698740401f1dd613"}, "originalPosition": 27}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjMwMjM4NQ==", "bodyText": "good point, let me add one", "url": "https://github.com/IBM/FHIR/pull/869#discussion_r402302385", "createdAt": "2020-04-02T13:14:30Z", "author": {"login": "albertwang-ibm"}, "path": "docs/src/pages/guides/FHIRServerUsersGuide.md", "diffHunk": "@@ -1143,50 +1143,7 @@ The *fhir-bulkimportexport-webapp* module is a wrapper for the whole BulkData we\n     </webApplication>\n ```\n \n-BulkData web application writes the exported FHIR resources to an IBM Cloud Object Storage (COS) or Amazon S3 bucket, as configured in the per-tenant bulkdata.json configuration file. The bulkdata.json file is stored in the tenant configuration directory of each fhir-server instance. The following is a bulkdata.json which is configured to export the FHIR resources into fhir-bulkdata-sample bucket of IBM COS:\n-\n-```json\n-{\n-  \"applicationName\": \"fhir-bulkimportexport-webapp\",\n-  \"moduleName\": \"fhir-bulkimportexport.war\",\n-  \"jobParameters\": {\n-    \"cos.bucket.name\": \"fhir-bulkdata-sample\",\n-    \"cos.location\": \"us\",\n-    \"cos.endpointurl\": \"https://s3.us-south.cloud-object-storage.appdomain.cloud\",\n-    \"cos.credential.ibm\": \"Y\",\n-    \"cos.api.key\": \"xxxxxxxxxxxxxxxxxxxxxxx\",\n-    \"cos.srvinst.id\": \"xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx\",\n-  },\n-  \"implementation_type\": \"cos\",\n-  \"batch-uri\": \"https://localhost:9443/ibm/api/batch/jobinstances\",\n-  \"batch-user\": \"fhiradmin\",\n-  \"batch-user-password\": \"xxxxxxxxxxxx\",\n-  \"batch-truststore\" : \"resources/security/fhirTruststore.jks\",\n-  \"batch-truststore-password\" : \"xxxxxxxxxxxx\",\n-  \"serverHostname\" : \"localhost:9443\",\n-  \"contextRoot\" : \"/fhir-server/api/v4\"\n-}\n-```", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjAxNTY0NA=="}, "originalCommit": {"oid": "45c9225519841c2905f62134698740401f1dd613"}, "originalPosition": 27}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjMwODA2Nw==", "bodyText": "done", "url": "https://github.com/IBM/FHIR/pull/869#discussion_r402308067", "createdAt": "2020-04-02T13:23:01Z", "author": {"login": "albertwang-ibm"}, "path": "docs/src/pages/guides/FHIRServerUsersGuide.md", "diffHunk": "@@ -1143,50 +1143,7 @@ The *fhir-bulkimportexport-webapp* module is a wrapper for the whole BulkData we\n     </webApplication>\n ```\n \n-BulkData web application writes the exported FHIR resources to an IBM Cloud Object Storage (COS) or Amazon S3 bucket, as configured in the per-tenant bulkdata.json configuration file. The bulkdata.json file is stored in the tenant configuration directory of each fhir-server instance. The following is a bulkdata.json which is configured to export the FHIR resources into fhir-bulkdata-sample bucket of IBM COS:\n-\n-```json\n-{\n-  \"applicationName\": \"fhir-bulkimportexport-webapp\",\n-  \"moduleName\": \"fhir-bulkimportexport.war\",\n-  \"jobParameters\": {\n-    \"cos.bucket.name\": \"fhir-bulkdata-sample\",\n-    \"cos.location\": \"us\",\n-    \"cos.endpointurl\": \"https://s3.us-south.cloud-object-storage.appdomain.cloud\",\n-    \"cos.credential.ibm\": \"Y\",\n-    \"cos.api.key\": \"xxxxxxxxxxxxxxxxxxxxxxx\",\n-    \"cos.srvinst.id\": \"xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx\",\n-  },\n-  \"implementation_type\": \"cos\",\n-  \"batch-uri\": \"https://localhost:9443/ibm/api/batch/jobinstances\",\n-  \"batch-user\": \"fhiradmin\",\n-  \"batch-user-password\": \"xxxxxxxxxxxx\",\n-  \"batch-truststore\" : \"resources/security/fhirTruststore.jks\",\n-  \"batch-truststore-password\" : \"xxxxxxxxxxxx\",\n-  \"serverHostname\" : \"localhost:9443\",\n-  \"contextRoot\" : \"/fhir-server/api/v4\"\n-}\n-```", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjAxNTY0NA=="}, "originalCommit": {"oid": "45c9225519841c2905f62134698740401f1dd613"}, "originalPosition": 27}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ5NTI1NDM1OnYy", "diffSide": "RIGHT", "path": "docs/src/pages/guides/FHIRServerUsersGuide.md", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMlQxMzo1ODowMFrOF_sh1Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMlQxNDoyNjowOVrOF_t0Cg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjMzNDE2NQ==", "bodyText": "Should we add the other bulkdata properties here too?  Do any of them have a \"default value\"?", "url": "https://github.com/IBM/FHIR/pull/869#discussion_r402334165", "createdAt": "2020-04-02T13:58:00Z", "author": {"login": "lmsurpre"}, "path": "docs/src/pages/guides/FHIRServerUsersGuide.md", "diffHunk": "@@ -1399,6 +1375,7 @@ This section contains reference information about each of the configuration prop\n |`fhirServer/audit/serviceProperties/geoCity`|Dallas|\n |`fhirServer/audit/serviceProperties/geoState`|TX|\n |`fhirServer/audit/serviceProperties/geoCounty`|US|\n+|`fhirServer/bulkdata/isExportPublic`|true|", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "45c9225519841c2905f62134698740401f1dd613"}, "originalPosition": 105}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjM1NTIxMA==", "bodyText": "The others are either with fixed values, or bucket configuration or password or encryption key, so I didn't add them here.", "url": "https://github.com/IBM/FHIR/pull/869#discussion_r402355210", "createdAt": "2020-04-02T14:26:09Z", "author": {"login": "albertwang-ibm"}, "path": "docs/src/pages/guides/FHIRServerUsersGuide.md", "diffHunk": "@@ -1399,6 +1375,7 @@ This section contains reference information about each of the configuration prop\n |`fhirServer/audit/serviceProperties/geoCity`|Dallas|\n |`fhirServer/audit/serviceProperties/geoState`|TX|\n |`fhirServer/audit/serviceProperties/geoCounty`|US|\n+|`fhirServer/bulkdata/isExportPublic`|true|", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjMzNDE2NQ=="}, "originalCommit": {"oid": "45c9225519841c2905f62134698740401f1dd613"}, "originalPosition": 105}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 152, "cost": 1, "resetAt": "2021-11-12T20:44:06Z"}}}