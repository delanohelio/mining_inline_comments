{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM4Njk5OTQx", "number": 1274, "title": "issue #1242 add minio to pipeline", "bodyText": "Added bulkdata minio support and also enabled bulkdata integration test with minio in build pipleline:\n(1) Added new per tenant server configure \"isCosClientUseFhirServerTrustStore\" for bulkdata jobs to allow S3/IBMCOS client to use fhirserver truststore to access S3 service, so for minio service using server self signed cert, we just need to import it into fhirserver truststore.\n(2) Enhanced bulkdata integration tests.\n- Added support for tenant and datastore.\n- Added minio download url verification with new settings in test.properties.\n(3) Enabled bulkdata integration test with minio in build pipleline\n- Added minio docker container.\n- Enabled SSL for minio service by using self signed cert.\n- Imported the self signed cert into truststore of fhirserver and integration test client.\n- Added sample import ndjson to minio test bucket.\n(4) Upgrade IBMCOS SDK from 2.6.1 to 2.6.2.\n(5) Updated user guide for the new \"isCosClientUseFhirServerTrustStore\" server setting.\nSigned-off-by: Albert Wang xuwang@us.ibm.com", "createdAt": "2020-06-23T16:59:41Z", "url": "https://github.com/IBM/FHIR/pull/1274", "merged": true, "mergeCommit": {"oid": "1f19caf1344b84adc8bef6cef718a0d5d81b22e0"}, "closed": true, "closedAt": "2020-06-28T02:12:43Z", "author": {"login": "albertwang-ibm"}, "timelineItems": {"totalCount": 52, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcuIdz4AH2gAyNDM4Njk5OTQxOmE0NTRlOGMxMjc2NDVlNjUwMTFkNmViMWU0NjIzMzkzMTJiZjZiOTA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcvhC9EgH2gAyNDM4Njk5OTQxOmU2MGU4MmM4ZWEyODRhYTlmZWVjODY2YjQwZWEyYzM3MDY3ZTgzZjU=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "a454e8c127645e65011d6eb1e462339312bf6b90", "author": {"user": {"login": "albertwang-ibm", "name": "Albert(Xu) Wang"}}, "url": "https://github.com/IBM/FHIR/commit/a454e8c127645e65011d6eb1e462339312bf6b90", "committedDate": "2020-06-23T16:58:24Z", "message": "issue #1242 initial code drop\n\nSigned-off-by: Albert Wang <xuwang@us.ibm.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c0043213e272598b6a010833b48daa37eaa2fcb2", "author": {"user": {"login": "albertwang-ibm", "name": "Albert(Xu) Wang"}}, "url": "https://github.com/IBM/FHIR/commit/c0043213e272598b6a010833b48daa37eaa2fcb2", "committedDate": "2020-06-23T17:31:50Z", "message": "issue #1242 add cert directory with -p\n\nSigned-off-by: Albert Wang <xuwang@us.ibm.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dfac8e2251d2ea69b46e13964876e74562087e5b", "author": {"user": {"login": "albertwang-ibm", "name": "Albert(Xu) Wang"}}, "url": "https://github.com/IBM/FHIR/commit/dfac8e2251d2ea69b46e13964876e74562087e5b", "committedDate": "2020-06-23T18:07:28Z", "message": "issue #1242 enable minio export test\n\nSigned-off-by: Albert Wang <xuwang@us.ibm.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9a6f76ebbc57a558600c814191610a4d0de75dc0", "author": {"user": {"login": "albertwang-ibm", "name": "Albert(Xu) Wang"}}, "url": "https://github.com/IBM/FHIR/commit/9a6f76ebbc57a558600c814191610a4d0de75dc0", "committedDate": "2020-06-23T19:05:07Z", "message": "issue #1242 update fhirtruststore to include minio cert\n\nSigned-off-by: Albert Wang <xuwang@us.ibm.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "427f503994023cffafe211398a89eeee8fe80149", "author": {"user": {"login": "albertwang-ibm", "name": "Albert(Xu) Wang"}}, "url": "https://github.com/IBM/FHIR/commit/427f503994023cffafe211398a89eeee8fe80149", "committedDate": "2020-06-24T00:35:48Z", "message": "issue #1242 update minio docker composer\n\nSigned-off-by: Albert Wang <xuwang@us.ibm.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "345c6ff8ca9ac56bf2b087d459fdde5bf6dbb448", "author": {"user": {"login": "albertwang-ibm", "name": "Albert(Xu) Wang"}}, "url": "https://github.com/IBM/FHIR/commit/345c6ff8ca9ac56bf2b087d459fdde5bf6dbb448", "committedDate": "2020-06-24T02:27:24Z", "message": "issue #1242 enable minio bulkdata export tests for db2 only\n\nSigned-off-by: Albert Wang <xuwang@us.ibm.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4eeab7ce8347b296783b1e22b01f2d66ea0ae29d", "author": {"user": {"login": "albertwang-ibm", "name": "Albert(Xu) Wang"}}, "url": "https://github.com/IBM/FHIR/commit/4eeab7ce8347b296783b1e22b01f2d66ea0ae29d", "committedDate": "2020-06-24T02:28:25Z", "message": "issue #1242 disable bulkdata export tests by default\n\nSigned-off-by: Albert Wang <xuwang@us.ibm.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8f7439aaaf3897d8bb4429afc3a6498503a7a9cd", "author": {"user": {"login": "albertwang-ibm", "name": "Albert(Xu) Wang"}}, "url": "https://github.com/IBM/FHIR/commit/8f7439aaaf3897d8bb4429afc3a6498503a7a9cd", "committedDate": "2020-06-24T18:22:34Z", "message": "issue #1242 use fhirserver key/cert for minio\n\nSigned-off-by: Albert Wang <xuwang@us.ibm.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bdc6f4a5874bacced9a0bdb3181838871eb86f35", "author": {"user": {"login": "albertwang-ibm", "name": "Albert(Xu) Wang"}}, "url": "https://github.com/IBM/FHIR/commit/bdc6f4a5874bacced9a0bdb3181838871eb86f35", "committedDate": "2020-06-25T00:28:04Z", "message": "issue #1242 per tenant truststore config and bulkdata tests enhancement\n\nSigned-off-by: Albert Wang <xuwang@us.ibm.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0c621581f7de03e14f9451f5c759fdd693e14256", "author": {"user": {"login": "albertwang-ibm", "name": "Albert(Xu) Wang"}}, "url": "https://github.com/IBM/FHIR/commit/0c621581f7de03e14f9451f5c759fdd693e14256", "committedDate": "2020-06-25T01:19:44Z", "message": "issue #1242 fix test minio bucket dir\n\nSigned-off-by: Albert Wang <xuwang@us.ibm.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "df04fbdbbc5a9cf23df00f7a40398d6efc3c7517", "author": {"user": {"login": "albertwang-ibm", "name": "Albert(Xu) Wang"}}, "url": "https://github.com/IBM/FHIR/commit/df04fbdbbc5a9cf23df00f7a40398d6efc3c7517", "committedDate": "2020-06-25T02:10:45Z", "message": "issue #1242 minor updates\n\nSigned-off-by: Albert Wang <xuwang@us.ibm.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c5eef0f533745cd4d53b81c9846c5ce56772159a", "author": {"user": {"login": "albertwang-ibm", "name": "Albert(Xu) Wang"}}, "url": "https://github.com/IBM/FHIR/commit/c5eef0f533745cd4d53b81c9846c5ce56772159a", "committedDate": "2020-06-25T02:54:54Z", "message": "issue #1242 update compose dependency\n\nSigned-off-by: Albert Wang <xuwang@us.ibm.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "459bd2519734a9b9adaae9e790f379cf06fdb886", "author": {"user": {"login": "albertwang-ibm", "name": "Albert(Xu) Wang"}}, "url": "https://github.com/IBM/FHIR/commit/459bd2519734a9b9adaae9e790f379cf06fdb886", "committedDate": "2020-06-25T03:06:42Z", "message": "issue #1242 change minio hostname in test server config\n\nSigned-off-by: Albert Wang <xuwang@us.ibm.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "932109348dc32785f5d0d822ee9cd8ee31057d2b", "author": {"user": {"login": "albertwang-ibm", "name": "Albert(Xu) Wang"}}, "url": "https://github.com/IBM/FHIR/commit/932109348dc32785f5d0d822ee9cd8ee31057d2b", "committedDate": "2020-06-25T10:50:19Z", "message": "issue #1242 change ports of minio\n\nSigned-off-by: Albert Wang <xuwang@us.ibm.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "148c6356f58e425858b17a102c14bc7d69cff4d6", "author": {"user": {"login": "albertwang-ibm", "name": "Albert(Xu) Wang"}}, "url": "https://github.com/IBM/FHIR/commit/148c6356f58e425858b17a102c14bc7d69cff4d6", "committedDate": "2020-06-25T11:25:33Z", "message": "issue #1242 update minio port in server config\n\nSigned-off-by: Albert Wang <xuwang@us.ibm.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dc229b2cb9da978a7a7491549be3f2ee42917a7f", "author": {"user": {"login": "albertwang-ibm", "name": "Albert(Xu) Wang"}}, "url": "https://github.com/IBM/FHIR/commit/dc229b2cb9da978a7a7491549be3f2ee42917a7f", "committedDate": "2020-06-25T13:19:16Z", "message": "issue #1242 new key/cert for ibmfhirminio\n\nSigned-off-by: Albert Wang <xuwang@us.ibm.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "77c66aac3315503d3ed52e6c13e5ea5df9d11bc2", "author": {"user": {"login": "albertwang-ibm", "name": "Albert(Xu) Wang"}}, "url": "https://github.com/IBM/FHIR/commit/77c66aac3315503d3ed52e6c13e5ea5df9d11bc2", "committedDate": "2020-06-25T13:41:11Z", "message": "issue #1242 rename minio service to ibmfhirminio\n\nSigned-off-by: Albert Wang <xuwang@us.ibm.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "877060acda9ad3f446ef3ec397a0ae9f56fab2c4", "author": {"user": {"login": "albertwang-ibm", "name": "Albert(Xu) Wang"}}, "url": "https://github.com/IBM/FHIR/commit/877060acda9ad3f446ef3ec397a0ae9f56fab2c4", "committedDate": "2020-06-25T13:59:04Z", "message": "issue #1242 change minio pull service name to ibmfhirminio\n\nSigned-off-by: Albert Wang <xuwang@us.ibm.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3856577e83d74df68a162ed69de56ddc3b7fe978", "author": {"user": {"login": "albertwang-ibm", "name": "Albert(Xu) Wang"}}, "url": "https://github.com/IBM/FHIR/commit/3856577e83d74df68a162ed69de56ddc3b7fe978", "committedDate": "2020-06-25T15:55:56Z", "message": "issue #1242 change minio data dir\n\nSigned-off-by: Albert Wang <xuwang@us.ibm.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "018dbeb22e0902db36fade5c82bdd80e16b79dd6", "author": {"user": {"login": "albertwang-ibm", "name": "Albert(Xu) Wang"}}, "url": "https://github.com/IBM/FHIR/commit/018dbeb22e0902db36fade5c82bdd80e16b79dd6", "committedDate": "2020-06-25T17:34:13Z", "message": "issue #1242 change minio data dir to under minio\n\nSigned-off-by: Albert Wang <xuwang@us.ibm.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ac0de8af16008c186abcab64ec6d13da7d9ed56b", "author": {"user": {"login": "albertwang-ibm", "name": "Albert(Xu) Wang"}}, "url": "https://github.com/IBM/FHIR/commit/ac0de8af16008c186abcab64ec6d13da7d9ed56b", "committedDate": "2020-06-25T18:03:03Z", "message": "Merge pull request #1285 from IBM/master\n\nsync with master"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "757a2de3ba524c8e82685c2195977cf57d10f9cd", "author": {"user": {"login": "albertwang-ibm", "name": "Albert(Xu) Wang"}}, "url": "https://github.com/IBM/FHIR/commit/757a2de3ba524c8e82685c2195977cf57d10f9cd", "committedDate": "2020-06-25T19:31:16Z", "message": "issue #1242 update integration tests with download link check\n\nSigned-off-by: Albert Wang <xuwang@us.ibm.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "104ad3248053cc86526a31427e677f2b55055034", "author": {"user": {"login": "albertwang-ibm", "name": "Albert(Xu) Wang"}}, "url": "https://github.com/IBM/FHIR/commit/104ad3248053cc86526a31427e677f2b55055034", "committedDate": "2020-06-25T23:26:09Z", "message": "issue #1242 fix service dependency\n\nSigned-off-by: Albert Wang <xuwang@us.ibm.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d0e02a910f4978da40ef2e52f5d36a3014ccb871", "author": {"user": {"login": "albertwang-ibm", "name": "Albert(Xu) Wang"}}, "url": "https://github.com/IBM/FHIR/commit/d0e02a910f4978da40ef2e52f5d36a3014ccb871", "committedDate": "2020-06-26T11:45:24Z", "message": "issue #1242 replace tab with space and reorg import\n\nSigned-off-by: Albert Wang <xuwang@us.ibm.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "98a381f9d4ca4c443b660b5cdcbac0739445e3b9", "author": {"user": {"login": "albertwang-ibm", "name": "Albert(Xu) Wang"}}, "url": "https://github.com/IBM/FHIR/commit/98a381f9d4ca4c443b660b5cdcbac0739445e3b9", "committedDate": "2020-06-26T11:56:15Z", "message": "issue #1242 update IBMCOS SDK to 2.6.2\n\nSigned-off-by: Albert Wang <xuwang@us.ibm.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a2088bc8b6bb3d5527406d5eb5b52e3dd513da7c", "author": {"user": {"login": "albertwang-ibm", "name": "Albert(Xu) Wang"}}, "url": "https://github.com/IBM/FHIR/commit/a2088bc8b6bb3d5527406d5eb5b52e3dd513da7c", "committedDate": "2020-06-26T13:32:36Z", "message": "issue #1242 map miniohostname to localhost to allow build machine access\n\nSigned-off-by: Albert Wang <xuwang@us.ibm.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "01cd70bac22b23d63e1e1c0534c6fab547411593", "author": {"user": {"login": "albertwang-ibm", "name": "Albert(Xu) Wang"}}, "url": "https://github.com/IBM/FHIR/commit/01cd70bac22b23d63e1e1c0534c6fab547411593", "committedDate": "2020-06-26T14:14:49Z", "message": "issue #1242 update user guide for the new COS truststore config\n\nSigned-off-by: Albert Wang <xuwang@us.ibm.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM4Mzg3NTc3", "url": "https://github.com/IBM/FHIR/pull/1274#pullrequestreview-438387577", "createdAt": "2020-06-26T15:24:56Z", "commit": {"oid": "01cd70bac22b23d63e1e1c0534c6fab547411593"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQxNToyNDo1NlrOGplCUA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQxNToyNDo1NlrOGplCUA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjI1MTYwMA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            # Indicate that we expect to connect to the minio service on port 8443\n          \n          \n            \n            # Indicate that we expect to connect to the minio service on port 9000", "url": "https://github.com/IBM/FHIR/pull/1274#discussion_r446251600", "createdAt": "2020-06-26T15:24:56Z", "author": {"login": "prb112"}, "path": "build/docker/minio/Dockerfile", "diffHunk": "@@ -0,0 +1,15 @@\n+# ----------------------------------------------------------------------------\n+# (C) Copyright IBM Corp. 2019, 2020\n+#\n+# SPDX-License-Identifier: Apache-2.0\n+# ----------------------------------------------------------------------------\n+\n+FROM minio/minio\n+\n+# Indicate that we expect to connect to the minio service on port 8443", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "01cd70bac22b23d63e1e1c0534c6fab547411593"}, "originalPosition": 9}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM4MzkxNzYw", "url": "https://github.com/IBM/FHIR/pull/1274#pullrequestreview-438391760", "createdAt": "2020-06-26T15:30:19Z", "commit": {"oid": "01cd70bac22b23d63e1e1c0534c6fab547411593"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQxNTozMDoxOVrOGplOsg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQxNTozMDoxOVrOGplOsg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjI1NDc3MA==", "bodyText": "Shouldn't we remove the test data in /fhir-server-test/src/test/resources/testdata/import-operation/test-import.ndjson ? or copy from there to here.  Then there will be one place to update.", "url": "https://github.com/IBM/FHIR/pull/1274#discussion_r446254770", "createdAt": "2020-06-26T15:30:19Z", "author": {"login": "prb112"}, "path": "build/docker/minio/test-import.ndjson", "diffHunk": "@@ -0,0 +1,3 @@\n+{\"resourceType\":\"Patient\",\"id\":\"72b0d93c-93d0-43d9-94a8-d5154ce07152\",\"meta\":{\"versionId\":\"1\",\"lastUpdated\":\"2020-04-17T00:09:36.910431Z\"},\"name\":[{\"family\":\"Doe\",\"given\":[\"import-1\"]}],\"telecom\":[{\"system\":\"phone\",\"value\":\"555-1122\",\"use\":\"home\"}],\"birthDate\":\"1970-01-01\"}\n+{\"resourceType\":\"Patient\",\"id\":\"72b0d93c-93d0-43d9-94a8-d5154ce07153\",\"meta\":{\"versionId\":\"1\",\"lastUpdated\":\"2020-04-17T00:09:36.910431Z\"},\"name\":[{\"family\":\"Doe\",\"given\":[\"import-2\"]}],\"telecom\":[{\"system\":\"phone\",\"value\":\"555-1122\",\"use\":\"home\"}],\"birthDate\":\"1970-01-01\"}\n+{\"resourceType\":\"Patient\",\"id\":\"72b0d93c-93d0-43d9-94a8-d5154ce07154\",\"meta\":{\"versionId\":\"1\",\"lastUpdated\":\"2020-04-17T00:09:36.910431Z\"},\"name\":[{\"family\":\"Doe\",\"given\":[\"import-3\"]}],\"telecom\":[{\"system\":\"phone\",\"value\":\"555-1122\",\"use\":\"home\"}],\"birthDate\":\"1970-01-01\"}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "01cd70bac22b23d63e1e1c0534c6fab547411593"}, "originalPosition": 3}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM4Mzk2NjUw", "url": "https://github.com/IBM/FHIR/pull/1274#pullrequestreview-438396650", "createdAt": "2020-06-26T15:36:34Z", "commit": {"oid": "01cd70bac22b23d63e1e1c0534c6fab547411593"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQxNTozNjozNFrOGplcrA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQxNTozNjozNFrOGplcrA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjI1ODM0OA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            |`fhirServer/bulkdata/isCosClientUseFhirServerTrustStore`|boolean| If use fhir server TrustStore to access S3/IBMCOS service |\n          \n          \n            \n            |`fhirServer/bulkdata/isCosClientUseFhirServerTrustStore`|boolean| If the COS Client should use the IBM FHIR Server's TrustStore to access S3/IBMCOS service |\n          \n      \n    \n    \n  \n\nSeparately, this property is pretty long, it might be best to summarize it to a short property and easier to understand.\nisCosClientUseFhirServerTrustStore\n->\nuseDefaultTrustStore", "url": "https://github.com/IBM/FHIR/pull/1274#discussion_r446258348", "createdAt": "2020-06-26T15:36:34Z", "author": {"login": "prb112"}, "path": "docs/src/pages/guides/FHIRServerUsersGuide.md", "diffHunk": "@@ -1489,6 +1489,7 @@ This section contains reference information about each of the configuration prop\n |`fhirServer/bulkdata/cosFileMaxResources`|int|The maximum number of FHIR resources per COS file, \"-1\" means no limit, the default value is 500000 |\n |`fhirServer/bulkdata/cosFileMaxSize`|int|The maximum COS file size in bytes, \"-1\" means no limit, the default value is 209715200 (200M) |\n |`fhirServer/bulkdata/patientExportPageSize`|int| The search page size for patient/group export, the default value is 200 |\n+|`fhirServer/bulkdata/isCosClientUseFhirServerTrustStore`|boolean| If use fhir server TrustStore to access S3/IBMCOS service |", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "01cd70bac22b23d63e1e1c0534c6fab547411593"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM4Mzk2Nzkx", "url": "https://github.com/IBM/FHIR/pull/1274#pullrequestreview-438396791", "createdAt": "2020-06-26T15:36:44Z", "commit": {"oid": "01cd70bac22b23d63e1e1c0534c6fab547411593"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQxNTozNjo0NFrOGpldGg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQxNTozNjo0NFrOGpldGg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjI1ODQ1OA==", "bodyText": "Different name? useDefaultTrustStore", "url": "https://github.com/IBM/FHIR/pull/1274#discussion_r446258458", "createdAt": "2020-06-26T15:36:44Z", "author": {"login": "prb112"}, "path": "docs/src/pages/guides/FHIRServerUsersGuide.md", "diffHunk": "@@ -1538,6 +1539,7 @@ This section contains reference information about each of the configuration prop\n |`fhirServer/bulkdata/cosFileMaxResources`|500000|\n |`fhirServer/bulkdata/cosFileMaxSize`|209715200|\n |`fhirServer/bulkdata/patientExportPageSize`|200|\n+|`fhirServer/bulkdata/isCosClientUseFhirServerTrustStore`|false|", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "01cd70bac22b23d63e1e1c0534c6fab547411593"}, "originalPosition": 12}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM4Mzk2ODU0", "url": "https://github.com/IBM/FHIR/pull/1274#pullrequestreview-438396854", "createdAt": "2020-06-26T15:36:48Z", "commit": {"oid": "01cd70bac22b23d63e1e1c0534c6fab547411593"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQxNTozNjo0OVrOGpldQA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQxNTozNjo0OVrOGpldQA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjI1ODQ5Ng==", "bodyText": "Different name? useDefaultTrustStore", "url": "https://github.com/IBM/FHIR/pull/1274#discussion_r446258496", "createdAt": "2020-06-26T15:36:49Z", "author": {"login": "prb112"}, "path": "docs/src/pages/guides/FHIRServerUsersGuide.md", "diffHunk": "@@ -1605,6 +1607,7 @@ must restart the server for that change to take effect.\n |`fhirServer/bulkdata/cosFileMaxResources`|Y|Y|\n |`fhirServer/bulkdata/cosFileMaxSize`|Y|Y|\n |`fhirServer/bulkdata/patientExportPageSize`|Y|Y|\n+|`fhirServer/bulkdata/isCosClientUseFhirServerTrustStore`|Y|Y|", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "01cd70bac22b23d63e1e1c0534c6fab547411593"}, "originalPosition": 20}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM4Mzk3OTk4", "url": "https://github.com/IBM/FHIR/pull/1274#pullrequestreview-438397998", "createdAt": "2020-06-26T15:38:26Z", "commit": {"oid": "01cd70bac22b23d63e1e1c0534c6fab547411593"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQxNTozODoyNlrOGplghw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQxNTozODoyNlrOGplghw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjI1OTMzNQ==", "bodyText": "maybe pull directly from ${WORKSPACE}/fhir-server-test/src/test/resources/testdata/import-operation/test-import.ndjson", "url": "https://github.com/IBM/FHIR/pull/1274#discussion_r446259335", "createdAt": "2020-06-26T15:38:26Z", "author": {"login": "prb112"}, "path": "build/pre-integration-test-docker.sh", "diffHunk": "@@ -36,6 +42,14 @@ echo \"Deploying the Db2 schema...\"\n # Note: this adds the tenant key to the server config file so make sure thats set up first\n ./deploySchemaAndTenant.sh\n \n+mkdir -p minio/miniodata/fhirbulkdata\n+cp ./minio/test-import.ndjson ./minio/miniodata/fhirbulkdata", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "01cd70bac22b23d63e1e1c0534c6fab547411593"}, "originalPosition": 18}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM4Mzk4OTEx", "url": "https://github.com/IBM/FHIR/pull/1274#pullrequestreview-438398911", "createdAt": "2020-06-26T15:39:42Z", "commit": {"oid": "01cd70bac22b23d63e1e1c0534c6fab547411593"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQxNTozOTo0MlrOGpljTA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQxNTozOTo0MlrOGpljTA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjI2MDA0NA==", "bodyText": "isUse is hard to read\nI suggest just using use\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        String cosEndpointUrl, String cosLocation, boolean isUseFhirServerTrustStore) {\n          \n          \n            \n                        String cosEndpointUrl, String cosLocation, boolean useFhirServerTrustStore) {", "url": "https://github.com/IBM/FHIR/pull/1274#discussion_r446260044", "createdAt": "2020-06-26T15:39:42Z", "author": {"login": "prb112"}, "path": "fhir-bulkimportexport-webapp/src/main/java/com/ibm/fhir/jbatch/bulkdata/common/BulkDataUtils.java", "diffHunk": "@@ -107,7 +110,7 @@ public static String startPartUpload(AmazonS3 cosClient, String bucketName, Stri\n     }\n \n     public static AmazonS3 getCosClient(String cosCredentialIbm, String cosApiKeyProperty, String cosSrvinstId,\n-            String cosEndpointUrl, String cosLocation) {\n+            String cosEndpointUrl, String cosLocation, boolean isUseFhirServerTrustStore) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "01cd70bac22b23d63e1e1c0534c6fab547411593"}, "originalPosition": 15}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM4Mzk5MTU0", "url": "https://github.com/IBM/FHIR/pull/1274#pullrequestreview-438399154", "createdAt": "2020-06-26T15:40:02Z", "commit": {"oid": "01cd70bac22b23d63e1e1c0534c6fab547411593"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQxNTo0MDowMlrOGplkFA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQxNTo0MDowMlrOGplkFA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjI2MDI0NA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    if (isUseFhirServerTrustStore) {\n          \n          \n            \n                    if (useFhirServerTrustStore) {", "url": "https://github.com/IBM/FHIR/pull/1274#discussion_r446260244", "createdAt": "2020-06-26T15:40:02Z", "author": {"login": "prb112"}, "path": "fhir-bulkimportexport-webapp/src/main/java/com/ibm/fhir/jbatch/bulkdata/common/BulkDataUtils.java", "diffHunk": "@@ -121,6 +124,14 @@ public static AmazonS3 getCosClient(String cosCredentialIbm, String cosApiKeyPro\n                 .withTcpKeepAlive(true)\n                 .withSocketTimeout(Constants.COS_SOCKET_TIMEOUT);\n \n+        if (isUseFhirServerTrustStore) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "01cd70bac22b23d63e1e1c0534c6fab547411593"}, "originalPosition": 23}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM4Mzk5OTQ4", "url": "https://github.com/IBM/FHIR/pull/1274#pullrequestreview-438399948", "createdAt": "2020-06-26T15:41:09Z", "commit": {"oid": "01cd70bac22b23d63e1e1c0534c6fab547411593"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQxNTo0MTowOVrOGplmdg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQxNTo0MTowOVrOGplmdg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjI2MDg1NA==", "bodyText": "this variable is hard to read.\nuseFhirServerTrustStore and update the FHIRConfiguration", "url": "https://github.com/IBM/FHIR/pull/1274#discussion_r446260854", "createdAt": "2020-06-26T15:41:09Z", "author": {"login": "prb112"}, "path": "fhir-bulkimportexport-webapp/src/main/java/com/ibm/fhir/jbatch/bulkdata/export/system/ChunkWriter.java", "diffHunk": "@@ -209,6 +199,17 @@ public void writeItems(List<java.lang.Object> arg0) throws Exception {\n     @Override\n     public void open(Serializable checkpoint) throws Exception  {\n         isExportPublic = FHIRConfigHelper.getBooleanProperty(FHIRConfiguration.PROPERTY_BULKDATA_BATCHJOB_ISEXPORTPUBLIC, true);\n-\n+        boolean isCosClientUseFhirServerTrustStore = FHIRConfigHelper\n+            .getBooleanProperty(FHIRConfiguration.PROPERTY_BULKDATA_BATCHJOB_ISCOSCLIENTUSEFHIRSERVERTRUSTSTORE, false);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "01cd70bac22b23d63e1e1c0534c6fab547411593"}, "originalPosition": 23}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM4NDAxMzky", "url": "https://github.com/IBM/FHIR/pull/1274#pullrequestreview-438401392", "createdAt": "2020-06-26T15:43:03Z", "commit": {"oid": "01cd70bac22b23d63e1e1c0534c6fab547411593"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQxNTo0MzowM1rOGplqww==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQxNTo0MzowM1rOGplqww==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjI2MTk1NQ==", "bodyText": "consistent with my other comment, it's hard to read", "url": "https://github.com/IBM/FHIR/pull/1274#discussion_r446261955", "createdAt": "2020-06-26T15:43:03Z", "author": {"login": "prb112"}, "path": "fhir-bulkimportexport-webapp/src/main/java/com/ibm/fhir/jbatch/bulkdata/load/ChunkReader.java", "diffHunk": "@@ -156,7 +173,23 @@ public Object readItem() throws Exception {\n     public void open(Serializable checkpoint) throws Exception {\n         if (BulkImportDataSourceStorageType.from(dataSourceStorageType).equals(BulkImportDataSourceStorageType.AWSS3)\n                 || BulkImportDataSourceStorageType.from(dataSourceStorageType).equals(BulkImportDataSourceStorageType.IBMCOS)) {\n-            cosClient = BulkDataUtils.getCosClient(cosCredentialIbm, cosApiKeyProperty, cosSrvinstId, cosEndpointUrl, cosLocation);\n+\n+            if (fhirTenant == null) {\n+                fhirTenant = \"default\";\n+                logger.info(\"open: Set tenant to default!\");\n+            }\n+            if (fhirDatastoreId == null) {\n+                fhirDatastoreId = Constants.DEFAULT_FHIR_TENANT;\n+                logger.info(\"open: Set DatastoreId to default!\");\n+            }\n+\n+            FHIRRequestContext.set(new FHIRRequestContext(fhirTenant, fhirDatastoreId));\n+            boolean isCosClientUseFhirServerTrustStore = FHIRConfigHelper\n+                .getBooleanProperty(FHIRConfiguration.PROPERTY_BULKDATA_BATCHJOB_ISCOSCLIENTUSEFHIRSERVERTRUSTSTORE, false);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "01cd70bac22b23d63e1e1c0534c6fab547411593"}, "originalPosition": 48}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM4NDAyMzUz", "url": "https://github.com/IBM/FHIR/pull/1274#pullrequestreview-438402353", "createdAt": "2020-06-26T15:44:21Z", "commit": {"oid": "01cd70bac22b23d63e1e1c0534c6fab547411593"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQxNTo0NDoyMVrOGpltYQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQxNTo0NDoyMVrOGpltYQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjI2MjYyNQ==", "bodyText": "this is fixed, or configurable?", "url": "https://github.com/IBM/FHIR/pull/1274#discussion_r446262625", "createdAt": "2020-06-26T15:44:21Z", "author": {"login": "prb112"}, "path": "fhir-bulkimportexport-webapp/src/main/java/com/ibm/fhir/jbatch/bulkdata/load/ChunkWriter.java", "diffHunk": "@@ -286,4 +263,33 @@ private void pushImportOperationOutcomes2COS(ImportTransientUserData chunkData)\n             chunkData.getBufferStreamForImportError().reset();\n         }\n     }\n+    \n+    @Override\n+    public void open(Serializable checkpoint) throws Exception {\n+        if (fhirValidation != null) {\n+            isValidationOn = fhirValidation.equalsIgnoreCase(\"Y\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "01cd70bac22b23d63e1e1c0534c6fab547411593"}, "originalPosition": 76}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM4NDA2MTUx", "url": "https://github.com/IBM/FHIR/pull/1274#pullrequestreview-438406151", "createdAt": "2020-06-26T15:49:32Z", "commit": {"oid": "01cd70bac22b23d63e1e1c0534c6fab547411593"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQxNTo0OTozMlrOGpl4wg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQxNTo0OTozMlrOGpl4wg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjI2NTUzOA==", "bodyText": "hard to consume the constant name.   use/is - select one\nisCosClientUseFhirServerTrustStore should be simplified", "url": "https://github.com/IBM/FHIR/pull/1274#discussion_r446265538", "createdAt": "2020-06-26T15:49:32Z", "author": {"login": "prb112"}, "path": "fhir-config/src/main/java/com/ibm/fhir/config/FHIRConfiguration.java", "diffHunk": "@@ -96,6 +96,8 @@\n     public static final String PROPERTY_BULKDATA_BATCHJOB_BATCHTRUSTSTORE = \"fhirServer/bulkdata/batch-truststore\";\n     public static final String PROPERTY_BULKDATA_BATCHJOB_BATCHTRUSTSTOREPWD = \"fhirServer/bulkdata/batch-truststore-password\";\n     public static final String PROPERTY_BULKDATA_BATCHJOB_ISEXPORTPUBLIC = \"fhirServer/bulkdata/isExportPublic\";\n+    public static final String PROPERTY_BULKDATA_BATCHJOB_ISCOSCLIENTUSEFHIRSERVERTRUSTSTORE = \"fhirServer/bulkdata/isCosClientUseFhirServerTrustStore\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "01cd70bac22b23d63e1e1c0534c6fab547411593"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM4NDA5MjM0", "url": "https://github.com/IBM/FHIR/pull/1274#pullrequestreview-438409234", "createdAt": "2020-06-26T15:53:47Z", "commit": {"oid": "01cd70bac22b23d63e1e1c0534c6fab547411593"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQxNTo1Mzo0N1rOGpmCCQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQxNTo1Mzo0N1rOGpmCCQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjI2NzkxMw==", "bodyText": "Why do you have to specify the tenantName/DatastoreId?", "url": "https://github.com/IBM/FHIR/pull/1274#discussion_r446267913", "createdAt": "2020-06-26T15:53:47Z", "author": {"login": "prb112"}, "path": "fhir-server-test/src/test/java/com/ibm/fhir/server/test/bulkdata/ExportOperationTest.java", "diffHunk": "@@ -55,19 +56,29 @@\n     public static final String BASE_VALID_URL = \"/$export\";\n     public static final String BASE_VALID_STATUS_URL = \"/$bulkdata-status\";\n     public static final String FORMAT = \"application/fhir+ndjson\";\n+    private final String tenantName = \"default\";\n+    private final String dataStoreId = \"default\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "01cd70bac22b23d63e1e1c0534c6fab547411593"}, "originalPosition": 13}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6d346a86c8195acb50533c17172916071d97b9cc", "author": {"user": {"login": "albertwang-ibm", "name": "Albert(Xu) Wang"}}, "url": "https://github.com/IBM/FHIR/commit/6d346a86c8195acb50533c17172916071d97b9cc", "committedDate": "2020-06-26T16:07:35Z", "message": "issue #1242 updates per review comments\n\nSigned-off-by: Albert Wang <xuwang@us.ibm.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM4NDU3MzA4", "url": "https://github.com/IBM/FHIR/pull/1274#pullrequestreview-438457308", "createdAt": "2020-06-26T17:04:22Z", "commit": {"oid": "6d346a86c8195acb50533c17172916071d97b9cc"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM4NDc4ODA4", "url": "https://github.com/IBM/FHIR/pull/1274#pullrequestreview-438478808", "createdAt": "2020-06-26T17:38:57Z", "commit": {"oid": "6d346a86c8195acb50533c17172916071d97b9cc"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQxNzozODo1N1rOGppSew==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQxNzozODo1N1rOGppSew==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjMyMTI3NQ==", "bodyText": "I think I'd rather see this default to true.  I think its much simpler to have a single trustStore used by the whole server.  Then we should make sure our sample configs don't have trustStore settings sprinkled all over.", "url": "https://github.com/IBM/FHIR/pull/1274#discussion_r446321275", "createdAt": "2020-06-26T17:38:57Z", "author": {"login": "lmsurpre"}, "path": "docs/src/pages/guides/FHIRServerUsersGuide.md", "diffHunk": "@@ -1538,6 +1539,7 @@ This section contains reference information about each of the configuration prop\n |`fhirServer/bulkdata/cosFileMaxResources`|500000|\n |`fhirServer/bulkdata/cosFileMaxSize`|209715200|\n |`fhirServer/bulkdata/patientExportPageSize`|200|\n+|`fhirServer/bulkdata/useFhirServerTrustStore`|false|", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6d346a86c8195acb50533c17172916071d97b9cc"}, "originalPosition": 12}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM4NDc5NTU1", "url": "https://github.com/IBM/FHIR/pull/1274#pullrequestreview-438479555", "createdAt": "2020-06-26T17:40:10Z", "commit": {"oid": "6d346a86c8195acb50533c17172916071d97b9cc"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQxNzo0MDoxMFrOGppU0Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQxNzo0MDoxMFrOGppU0Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjMyMTg3Mw==", "bodyText": "how were we passing these before?  does adding them here fix an issue we had?", "url": "https://github.com/IBM/FHIR/pull/1274#discussion_r446321873", "createdAt": "2020-06-26T17:40:10Z", "author": {"login": "lmsurpre"}, "path": "fhir-bulkimportexport-webapp/src/main/java/META-INF/batch-jobs/FhirBulkImportChunkJob.xml", "diffHunk": "@@ -14,6 +14,8 @@\n         <chunk checkpoint-policy=\"item\" item-count=\"#{jobProperties['fhir.cosreadsperdbbatch']}\">\n             <reader ref=\"com.ibm.fhir.jbatch.bulkdata.load.ChunkReader\">\n                 <properties>\n+                    <property name=\"fhir.tenant\" value=\"#{jobParameters['fhir.tenant']}\"/>\n+                    <property name=\"fhir.datastoreid\" value=\"#{jobParameters['fhir.datastoreid']}\"/>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6d346a86c8195acb50533c17172916071d97b9cc"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM4NDgwMTQz", "url": "https://github.com/IBM/FHIR/pull/1274#pullrequestreview-438480143", "createdAt": "2020-06-26T17:41:11Z", "commit": {"oid": "6d346a86c8195acb50533c17172916071d97b9cc"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQxNzo0MToxMVrOGppWig==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQxNzo0MToxMVrOGppWig==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjMyMjMxNA==", "bodyText": "I'd prefer to make the default true", "url": "https://github.com/IBM/FHIR/pull/1274#discussion_r446322314", "createdAt": "2020-06-26T17:41:11Z", "author": {"login": "lmsurpre"}, "path": "fhir-bulkimportexport-webapp/src/main/java/com/ibm/fhir/jbatch/bulkdata/export/system/ChunkWriter.java", "diffHunk": "@@ -209,6 +199,17 @@ public void writeItems(List<java.lang.Object> arg0) throws Exception {\n     @Override\n     public void open(Serializable checkpoint) throws Exception  {\n         isExportPublic = FHIRConfigHelper.getBooleanProperty(FHIRConfiguration.PROPERTY_BULKDATA_BATCHJOB_ISEXPORTPUBLIC, true);\n-\n+        boolean isCosClientUseFhirServerTrustStore = FHIRConfigHelper\n+            .getBooleanProperty(FHIRConfiguration.PROPERTY_BULKDATA_BATCHJOB_USEFHIRSERVERTRUSTSTORE, false);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6d346a86c8195acb50533c17172916071d97b9cc"}, "originalPosition": 23}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM4NDgwODA5", "url": "https://github.com/IBM/FHIR/pull/1274#pullrequestreview-438480809", "createdAt": "2020-06-26T17:41:53Z", "commit": {"oid": "6d346a86c8195acb50533c17172916071d97b9cc"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQxNzo0MTo1M1rOGppYJw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQxNzo0MTo1M1rOGppYJw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjMyMjcyNw==", "bodyText": "I'd prefer to make the default true", "url": "https://github.com/IBM/FHIR/pull/1274#discussion_r446322727", "createdAt": "2020-06-26T17:41:53Z", "author": {"login": "lmsurpre"}, "path": "fhir-bulkimportexport-webapp/src/main/java/com/ibm/fhir/jbatch/bulkdata/load/ChunkWriter.java", "diffHunk": "@@ -286,4 +263,33 @@ private void pushImportOperationOutcomes2COS(ImportTransientUserData chunkData)\n             chunkData.getBufferStreamForImportError().reset();\n         }\n     }\n+    \n+    @Override\n+    public void open(Serializable checkpoint) throws Exception {\n+        if (fhirValidation != null) {\n+            isValidationOn = fhirValidation.equalsIgnoreCase(\"Y\");\n+        }\n+        if (fhirTenant == null) {\n+            fhirTenant = \"default\";\n+            logger.info(\"open: Set tenant to default!\");\n+        }\n+        if (fhirDatastoreId == null) {\n+            fhirDatastoreId = Constants.DEFAULT_FHIR_TENANT;\n+            logger.info(\"open: Set DatastoreId to default!\");\n+        }\n+\n+        FHIRRequestContext.set(new FHIRRequestContext(fhirTenant, fhirDatastoreId));\n+        boolean isCosClientUseFhirServerTrustStore = FHIRConfigHelper\n+            .getBooleanProperty(FHIRConfiguration.PROPERTY_BULKDATA_BATCHJOB_USEFHIRSERVERTRUSTSTORE, false);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6d346a86c8195acb50533c17172916071d97b9cc"}, "originalPosition": 89}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM4NDgyNDI4", "url": "https://github.com/IBM/FHIR/pull/1274#pullrequestreview-438482428", "createdAt": "2020-06-26T17:44:32Z", "commit": {"oid": "6d346a86c8195acb50533c17172916071d97b9cc"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQxNzo0NDozMlrOGppdFg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQxNzo0NDozMlrOGppdFg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjMyMzk5MA==", "bodyText": "I think I'd prefer to make the default true.", "url": "https://github.com/IBM/FHIR/pull/1274#discussion_r446323990", "createdAt": "2020-06-26T17:44:32Z", "author": {"login": "lmsurpre"}, "path": "fhir-server/liberty-config/config/default/fhir-server-config.json", "diffHunk": "@@ -145,7 +145,8 @@\n             \"isExportPublic\": true,\n             \"cosFileMaxResources\": 500000,\n             \"cosFileMaxSize\": 209715200,\n-            \"validBaseUrls\": []\n+            \"validBaseUrls\": [],\n+            \"useFhirServerTrustStore\": false", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6d346a86c8195acb50533c17172916071d97b9cc"}, "originalPosition": 6}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM4NDg1OTEw", "url": "https://github.com/IBM/FHIR/pull/1274#pullrequestreview-438485910", "createdAt": "2020-06-26T17:50:15Z", "commit": {"oid": "6d346a86c8195acb50533c17172916071d97b9cc"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQxNzo1MDoxNVrOGppnnQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQxNzo1MDoxNVrOGppnnQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjMyNjY4NQ==", "bodyText": "why client2 ?", "url": "https://github.com/IBM/FHIR/pull/1274#discussion_r446326685", "createdAt": "2020-06-26T17:50:15Z", "author": {"login": "lmsurpre"}, "path": "fhir-server-test/src/test/java/com/ibm/fhir/server/test/bulkdata/ExportOperationTest.java", "diffHunk": "@@ -153,7 +167,53 @@ public WebTarget addQueryParameter(WebTarget target, String header, String val)\n     public Response doGet(String path, String mimeType) {\n         WebTarget target = getWebTarget();\n         target = target.path(path);\n-        return target.request(mimeType).get(Response.class);\n+        return target.request(mimeType)\n+                .header(\"X-FHIR-TENANT-ID\", tenantName)\n+                .header(\"X-FHIR-DSID\", dataStoreId)\n+                .get(Response.class);\n+    }\n+    \n+    private void verifyDownloadUrl(String downloadUrl) {\n+        // Minio doesn't support file level ACL using which we make can make the published file public, so we have to \n+        // get the token first, and then use the token to download the file. \n+        if (isUseMinio) {\n+            downloadUrl = downloadUrl.substring(8);\n+            String minioHost = downloadUrl.substring(0, downloadUrl.indexOf(\"/\"));\n+            String minioFilePath = downloadUrl.substring(minioHost.length());\n+            \n+            // If using minio in build pipeline, then we have to change the host name to \"localhost\" to all the\n+            // build machine to access the minio server via it.\n+            if (isUseMinioInBuildPipeline) {\n+                String[] minioHostArray = minioHost.split(\":\");\n+                minioHostArray[0] = \"localhost\";\n+                minioHost = String.join(\":\", minioHostArray);\n+            }\n+            \n+            String minioAuthUrl = \"https://\" + minioHost + \"/minio/webrpc\";\n+            String minioAuthRequestBody = \"{\\\"id\\\":1,\\\"jsonrpc\\\":\\\"2.0\\\",\\\"params\\\":{\\\"username\\\":\\\"\" \n+                + minioUserName  + \"\\\",\\\"password\\\":\\\"\" + minioPassword + \"\\\"},\\\"method\\\":\\\"Web.Login\\\"}\";\n+            \n+            WebTarget client2 = ClientBuilder.newBuilder().trustStore(client.getTrustStore()).build().target(minioAuthUrl);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6d346a86c8195acb50533c17172916071d97b9cc"}, "originalPosition": 82}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM4NDg3MDk5", "url": "https://github.com/IBM/FHIR/pull/1274#pullrequestreview-438487099", "createdAt": "2020-06-26T17:52:15Z", "commit": {"oid": "6d346a86c8195acb50533c17172916071d97b9cc"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQxNzo1MjoxNVrOGpprMg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQxNzo1MjoxNVrOGpprMg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjMyNzYwMg==", "bodyText": "this would be a good limitation for us to document if we ever advertise our support for Minio", "url": "https://github.com/IBM/FHIR/pull/1274#discussion_r446327602", "createdAt": "2020-06-26T17:52:15Z", "author": {"login": "lmsurpre"}, "path": "fhir-server-test/src/test/java/com/ibm/fhir/server/test/bulkdata/ExportOperationTest.java", "diffHunk": "@@ -153,7 +167,53 @@ public WebTarget addQueryParameter(WebTarget target, String header, String val)\n     public Response doGet(String path, String mimeType) {\n         WebTarget target = getWebTarget();\n         target = target.path(path);\n-        return target.request(mimeType).get(Response.class);\n+        return target.request(mimeType)\n+                .header(\"X-FHIR-TENANT-ID\", tenantName)\n+                .header(\"X-FHIR-DSID\", dataStoreId)\n+                .get(Response.class);\n+    }\n+    \n+    private void verifyDownloadUrl(String downloadUrl) {\n+        // Minio doesn't support file level ACL using which we make can make the published file public, so we have to \n+        // get the token first, and then use the token to download the file. ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6d346a86c8195acb50533c17172916071d97b9cc"}, "originalPosition": 64}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM4NDg5NTQ2", "url": "https://github.com/IBM/FHIR/pull/1274#pullrequestreview-438489546", "createdAt": "2020-06-26T17:56:08Z", "commit": {"oid": "6d346a86c8195acb50533c17172916071d97b9cc"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQxNzo1NjowOFrOGppyfQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQxNzo1NjowOFrOGppyfQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjMyOTQ2OQ==", "bodyText": "I'm still not sure how I feel about expanding our use of test.properties.  That properties file was originally just the client properties (used to instantiate FHIRClient).  I guess its OK though.", "url": "https://github.com/IBM/FHIR/pull/1274#discussion_r446329469", "createdAt": "2020-06-26T17:56:08Z", "author": {"login": "lmsurpre"}, "path": "fhir-server-test/src/test/java/com/ibm/fhir/server/test/bulkdata/ExportOperationTest.java", "diffHunk": "@@ -55,19 +56,29 @@\n     public static final String BASE_VALID_URL = \"/$export\";\n     public static final String BASE_VALID_STATUS_URL = \"/$bulkdata-status\";\n     public static final String FORMAT = \"application/fhir+ndjson\";\n+    private final String tenantName = \"default\";\n+    private final String dataStoreId = \"default\";\n \n     // Disabled by default\n     private static boolean ON = false;\n+    private static boolean isUseMinio = false;\n+    private static boolean isUseMinioInBuildPipeline = false;\n \n     public static final boolean DEBUG = false;\n     private String exportStatusUrl;\n     private String savedPatientId, savedPatientId2;\n     private String savedGroupId, savedGroupId2;\n-\n+    private String minioUserName;\n+    private String minioPassword;\n+  \n     @BeforeClass\n     public void setup() throws Exception {\n         Properties testProperties = TestUtil.readTestProperties(\"test.properties\");\n         ON = Boolean.parseBoolean(testProperties.getProperty(\"test.bulkdata.export.enabled\", \"false\"));\n+        isUseMinio = Boolean.parseBoolean(testProperties.getProperty(\"test.bulkdata.useminio\", \"false\"));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6d346a86c8195acb50533c17172916071d97b9cc"}, "originalPosition": 32}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ab5908940fca2a94127a956531f4546459ceea75", "author": {"user": {"login": "albertwang-ibm", "name": "Albert(Xu) Wang"}}, "url": "https://github.com/IBM/FHIR/commit/ab5908940fca2a94127a956531f4546459ceea75", "committedDate": "2020-06-28T00:07:44Z", "message": "issue #1242 update user guide about minio support\n\nSigned-off-by: Albert Wang <xuwang@us.ibm.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e60e82c8ea284aa9feec866b40ea2c37067e83f5", "author": {"user": {"login": "albertwang-ibm", "name": "Albert(Xu) Wang"}}, "url": "https://github.com/IBM/FHIR/commit/e60e82c8ea284aa9feec866b40ea2c37067e83f5", "committedDate": "2020-06-28T00:10:37Z", "message": "issue #1242 user guide minor updates\n\nSigned-off-by: Albert Wang <xuwang@us.ibm.com>"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 331, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}