{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTA2MjQ4NDY0", "number": 1599, "title": "Issue #1594 - fix overwriting of validate warnings in bundle processing", "bodyText": "Signed-off-by: Mike Schroeder mschroed@us.ibm.com", "createdAt": "2020-10-19T20:11:02Z", "url": "https://github.com/IBM/FHIR/pull/1599", "merged": true, "mergeCommit": {"oid": "3c1b11ee3fe354297e3436697b359613d311da80"}, "closed": true, "closedAt": "2020-10-20T15:33:41Z", "author": {"login": "michaelwschroeder"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdUJ7W3AH2gAyNTA2MjQ4NDY0OjdmODA2YTM3MjBhMGY1ZmY4NDIwZTQ5NGFmYTU4MGNhZTFhMTg1Mjg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdUaGTMAFqTUxMjgxNzAzNw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "7f806a3720a0f5ff8420e494afa580cae1a18528", "author": {"user": {"login": "michaelwschroeder", "name": "Michael W Schroeder"}}, "url": "https://github.com/IBM/FHIR/commit/7f806a3720a0f5ff8420e494afa580cae1a18528", "committedDate": "2020-10-19T20:09:42Z", "message": "Issue #1594 - fix overwriting of validate warnings in bundle processing\n\nSigned-off-by: Mike Schroeder <mschroed@us.ibm.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTEyMTMwNjQ0", "url": "https://github.com/IBM/FHIR/pull/1599#pullrequestreview-512130644", "createdAt": "2020-10-19T20:23:46Z", "commit": {"oid": "7f806a3720a0f5ff8420e494afa580cae1a18528"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xOVQyMDoyMzo0NlrOHkgSCw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xOVQyMDoyMzo0NlrOHkgSCw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODAzOTY5MQ==", "bodyText": "Since OperationOutcome overrides equals, I think this is OK.  we're not comparing two pointers necessarily.\nConfirming (I also double checked this)", "url": "https://github.com/IBM/FHIR/pull/1599#discussion_r508039691", "createdAt": "2020-10-19T20:23:46Z", "author": {"login": "prb112"}, "path": "fhir-server/src/main/java/com/ibm/fhir/server/util/FHIRRestHelper.java", "diffHunk": "@@ -2330,7 +2330,19 @@ private String getAbsoluteUri(String baseUri, String relativeUri) {\n             if (HTTPReturnPreference.REPRESENTATION.equals(FHIRRequestContext.get().getReturnPreference())) {\n                 bundleEntryBuilder.resource(resource);\n             } else if (HTTPReturnPreference.OPERATION_OUTCOME.equals(FHIRRequestContext.get().getReturnPreference())) {\n-                bundleEntryBuilder.resource(operationOutcome);\n+                OperationOutcome responseEntryOutcome = (OperationOutcome)responseEntry.getResource();\n+                if (responseEntryOutcome != null && !responseEntryOutcome.equals(FHIRUtil.ALL_OK)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7f806a3720a0f5ff8420e494afa580cae1a18528"}, "originalPosition": 281}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTEyMTMyMTA4", "url": "https://github.com/IBM/FHIR/pull/1599#pullrequestreview-512132108", "createdAt": "2020-10-19T20:25:51Z", "commit": {"oid": "7f806a3720a0f5ff8420e494afa580cae1a18528"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xOVQyMDoyNTo1MVrOHkgWsQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xOVQyMDoyNTo1MVrOHkgWsQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODA0MDg4MQ==", "bodyText": "slight question here, should ALL_OK still be added along with the warning... Technically it's accepted.", "url": "https://github.com/IBM/FHIR/pull/1599#discussion_r508040881", "createdAt": "2020-10-19T20:25:51Z", "author": {"login": "prb112"}, "path": "fhir-server/src/main/java/com/ibm/fhir/server/util/FHIRRestHelper.java", "diffHunk": "@@ -2330,7 +2330,19 @@ private String getAbsoluteUri(String baseUri, String relativeUri) {\n             if (HTTPReturnPreference.REPRESENTATION.equals(FHIRRequestContext.get().getReturnPreference())) {\n                 bundleEntryBuilder.resource(resource);\n             } else if (HTTPReturnPreference.OPERATION_OUTCOME.equals(FHIRRequestContext.get().getReturnPreference())) {\n-                bundleEntryBuilder.resource(operationOutcome);\n+                OperationOutcome responseEntryOutcome = (OperationOutcome)responseEntry.getResource();\n+                if (responseEntryOutcome != null && !responseEntryOutcome.equals(FHIRUtil.ALL_OK)) {\n+                    if (operationOutcome.equals(FHIRUtil.ALL_OK)) {\n+                        bundleEntryBuilder.resource(responseEntryOutcome);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7f806a3720a0f5ff8420e494afa580cae1a18528"}, "originalPosition": 283}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTEyMTg2Njg4", "url": "https://github.com/IBM/FHIR/pull/1599#pullrequestreview-512186688", "createdAt": "2020-10-19T21:53:04Z", "commit": {"oid": "7f806a3720a0f5ff8420e494afa580cae1a18528"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xOVQyMTo1MzowNFrOHkjBhQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xOVQyMTo1MzowNFrOHkjBhQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODA4NDYxMw==", "bodyText": "Does it matter whether the request was a batch vs a transaction?\nI know for failed transaction requests we send back a single OperationOutcome (vs. sending one-per-resource in batch)...just want to make sure this logic works for both bundle types.", "url": "https://github.com/IBM/FHIR/pull/1599#discussion_r508084613", "createdAt": "2020-10-19T21:53:04Z", "author": {"login": "lmsurpre"}, "path": "fhir-server/src/main/java/com/ibm/fhir/server/util/FHIRRestHelper.java", "diffHunk": "@@ -2330,7 +2330,19 @@ private String getAbsoluteUri(String baseUri, String relativeUri) {\n             if (HTTPReturnPreference.REPRESENTATION.equals(FHIRRequestContext.get().getReturnPreference())) {\n                 bundleEntryBuilder.resource(resource);\n             } else if (HTTPReturnPreference.OPERATION_OUTCOME.equals(FHIRRequestContext.get().getReturnPreference())) {\n-                bundleEntryBuilder.resource(operationOutcome);\n+                OperationOutcome responseEntryOutcome = (OperationOutcome)responseEntry.getResource();\n+                if (responseEntryOutcome != null && !responseEntryOutcome.equals(FHIRUtil.ALL_OK)) {\n+                    if (operationOutcome.equals(FHIRUtil.ALL_OK)) {\n+                        bundleEntryBuilder.resource(responseEntryOutcome);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7f806a3720a0f5ff8420e494afa580cae1a18528"}, "originalPosition": 283}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTEyODE3MDM3", "url": "https://github.com/IBM/FHIR/pull/1599#pullrequestreview-512817037", "createdAt": "2020-10-20T15:00:09Z", "commit": {"oid": "7f806a3720a0f5ff8420e494afa580cae1a18528"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 895, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}