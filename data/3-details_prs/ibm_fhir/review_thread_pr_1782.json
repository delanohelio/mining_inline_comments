{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTMxNzkwNDAw", "number": 1782, "reviewThreads": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wM1QxMzo0ODo1OVrOFAQD-w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wM1QxNToyMTo0N1rOFATk0A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM1ODA3NDgzOnYy", "diffSide": "RIGHT", "path": "fhir-database-utils/src/main/java/com/ibm/fhir/database/utils/version/VersionHistoryService.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wM1QxMzo0ODo1OVrOH-ch1w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wM1QxMzo0ODo1OVrOH-ch1w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTI0MTE3NQ==", "bodyText": "Going forward this would always ensure the schemaname is uppercase in the VHS table", "url": "https://github.com/IBM/FHIR/pull/1782#discussion_r535241175", "createdAt": "2020-12-03T13:48:59Z", "author": {"login": "prb112"}, "path": "fhir-database-utils/src/main/java/com/ibm/fhir/database/utils/version/VersionHistoryService.java", "diffHunk": "@@ -126,7 +126,7 @@ public void insertVersionHistoriesInTx(Collection<TypeNameVersion> versionHistor\n      * @param version\n      */\n     public void insertVersionHistoryInTx(String objectSchema, String objectType, String objectName, int version) {\n-        AddVersionDAO dao = new AddVersionDAO(adminSchemaName, objectSchema, objectType, objectName, version);\n+        AddVersionDAO dao = new AddVersionDAO(adminSchemaName, objectSchema.toUpperCase(), objectType, objectName, version);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8bf9ddc286424e68d2cfb03eb6d40d7d81532de8"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM1ODA3NjAyOnYy", "diffSide": "RIGHT", "path": "fhir-database-utils/src/main/java/com/ibm/fhir/database/utils/version/VersionHistoryService.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wM1QxMzo0OToxNFrOH-cifw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wM1QxMzo0OToxNFrOH-cifw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTI0MTM0Mw==", "bodyText": "Make sure we are forcing any incoming applies to be uppercase", "url": "https://github.com/IBM/FHIR/pull/1782#discussion_r535241343", "createdAt": "2020-12-03T13:49:14Z", "author": {"login": "prb112"}, "path": "fhir-database-utils/src/main/java/com/ibm/fhir/database/utils/version/VersionHistoryService.java", "diffHunk": "@@ -204,7 +204,7 @@ public void addVersion(String objectSchema, String objectType, String objectName\n \n     @Override\n     public boolean applies(String objectSchema, String objectType, String objectName, int changeVersion) {\n-        String key = objectSchema + \":\" + objectType + \":\" + objectName;\n+        String key = objectSchema.toUpperCase() + \":\" + objectType + \":\" + objectName;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8bf9ddc286424e68d2cfb03eb6d40d7d81532de8"}, "originalPosition": 14}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM1ODA3NzQ2OnYy", "diffSide": "RIGHT", "path": "fhir-database-utils/src/main/java/com/ibm/fhir/database/utils/version/GetLatestVersionDAO.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wM1QxMzo0OTozMVrOH-cjRw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wM1QxNjowNDoyOFrOH-kLtw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTI0MTU0Mw==", "bodyText": "I threw this in as uppercase for consistency", "url": "https://github.com/IBM/FHIR/pull/1782#discussion_r535241543", "createdAt": "2020-12-03T13:49:31Z", "author": {"login": "prb112"}, "path": "fhir-database-utils/src/main/java/com/ibm/fhir/database/utils/version/GetLatestVersionDAO.java", "diffHunk": "@@ -59,7 +59,7 @@ public GetLatestVersionDAO(String adminSchemaName, String schemaName) {\n             ps.setString(2, schemaName);\n             ResultSet rs = ps.executeQuery();\n             while (rs.next()) {\n-                String schema = rs.getString(1);\n+                String schema = rs.getString(1).toUpperCase();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8bf9ddc286424e68d2cfb03eb6d40d7d81532de8"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTM2MDM3Mw==", "bodyText": "Performance note: using WHERE UPPER(my_col) = ... can have performance implications because it often means that you can't use an index (on my_col). But in this case, it's unlikely to have a significant impact, because the row counts are relatively low.", "url": "https://github.com/IBM/FHIR/pull/1782#discussion_r535360373", "createdAt": "2020-12-03T15:56:42Z", "author": {"login": "punktilious"}, "path": "fhir-database-utils/src/main/java/com/ibm/fhir/database/utils/version/GetLatestVersionDAO.java", "diffHunk": "@@ -59,7 +59,7 @@ public GetLatestVersionDAO(String adminSchemaName, String schemaName) {\n             ps.setString(2, schemaName);\n             ResultSet rs = ps.executeQuery();\n             while (rs.next()) {\n-                String schema = rs.getString(1);\n+                String schema = rs.getString(1).toUpperCase();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTI0MTU0Mw=="}, "originalCommit": {"oid": "8bf9ddc286424e68d2cfb03eb6d40d7d81532de8"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTM2NjU4Mw==", "bodyText": "good point.", "url": "https://github.com/IBM/FHIR/pull/1782#discussion_r535366583", "createdAt": "2020-12-03T16:04:28Z", "author": {"login": "prb112"}, "path": "fhir-database-utils/src/main/java/com/ibm/fhir/database/utils/version/GetLatestVersionDAO.java", "diffHunk": "@@ -59,7 +59,7 @@ public GetLatestVersionDAO(String adminSchemaName, String schemaName) {\n             ps.setString(2, schemaName);\n             ResultSet rs = ps.executeQuery();\n             while (rs.next()) {\n-                String schema = rs.getString(1);\n+                String schema = rs.getString(1).toUpperCase();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTI0MTU0Mw=="}, "originalCommit": {"oid": "8bf9ddc286424e68d2cfb03eb6d40d7d81532de8"}, "originalPosition": 14}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM1ODA3ODQ2OnYy", "diffSide": "RIGHT", "path": "fhir-database-utils/src/main/java/com/ibm/fhir/database/utils/version/GetLatestVersionDAO.java", "isResolved": false, "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wM1QxMzo0OTo0NFrOH-cj5w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wM1QxNjowNDowMVrOH-kKMw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTI0MTcwMw==", "bodyText": "I wrapped this in ucase for backwards compatiblity", "url": "https://github.com/IBM/FHIR/pull/1782#discussion_r535241703", "createdAt": "2020-12-03T13:49:44Z", "author": {"login": "prb112"}, "path": "fhir-database-utils/src/main/java/com/ibm/fhir/database/utils/version/GetLatestVersionDAO.java", "diffHunk": "@@ -50,7 +50,7 @@ public GetLatestVersionDAO(String adminSchemaName, String schemaName) {\n         final String cols = DataDefinitionUtil.join(SchemaConstants.SCHEMA_NAME, SchemaConstants.OBJECT_TYPE, SchemaConstants.OBJECT_NAME);\n         final String sql = \"SELECT \" + cols\n                 + \", max(\" + SchemaConstants.VERSION + \") FROM \" + tbl\n-                + \" WHERE \" + SchemaConstants.SCHEMA_NAME + \" IN (?, ?) \"\n+                + \" WHERE UCASE(\" + SchemaConstants.SCHEMA_NAME + \") IN (UCASE(?), UCASE(?)) \"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8bf9ddc286424e68d2cfb03eb6d40d7d81532de8"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTI1NTU4OA==", "bodyText": "swapped to  UPPER", "url": "https://github.com/IBM/FHIR/pull/1782#discussion_r535255588", "createdAt": "2020-12-03T14:08:45Z", "author": {"login": "prb112"}, "path": "fhir-database-utils/src/main/java/com/ibm/fhir/database/utils/version/GetLatestVersionDAO.java", "diffHunk": "@@ -50,7 +50,7 @@ public GetLatestVersionDAO(String adminSchemaName, String schemaName) {\n         final String cols = DataDefinitionUtil.join(SchemaConstants.SCHEMA_NAME, SchemaConstants.OBJECT_TYPE, SchemaConstants.OBJECT_NAME);\n         final String sql = \"SELECT \" + cols\n                 + \", max(\" + SchemaConstants.VERSION + \") FROM \" + tbl\n-                + \" WHERE \" + SchemaConstants.SCHEMA_NAME + \" IN (?, ?) \"\n+                + \" WHERE UCASE(\" + SchemaConstants.SCHEMA_NAME + \") IN (UCASE(?), UCASE(?)) \"", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTI0MTcwMw=="}, "originalCommit": {"oid": "8bf9ddc286424e68d2cfb03eb6d40d7d81532de8"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTI1NTgyMg==", "bodyText": "I don't think you should UCASE(?) the args like that...because it suggests you don't know what case the args are. We should be making sure the args are upper-case before that (because it's probably important for equals and HashMap lookups in other places). The first place I'd force case is when we parse the CLI argument in Main.", "url": "https://github.com/IBM/FHIR/pull/1782#discussion_r535255822", "createdAt": "2020-12-03T14:09:03Z", "author": {"login": "punktilious"}, "path": "fhir-database-utils/src/main/java/com/ibm/fhir/database/utils/version/GetLatestVersionDAO.java", "diffHunk": "@@ -50,7 +50,7 @@ public GetLatestVersionDAO(String adminSchemaName, String schemaName) {\n         final String cols = DataDefinitionUtil.join(SchemaConstants.SCHEMA_NAME, SchemaConstants.OBJECT_TYPE, SchemaConstants.OBJECT_NAME);\n         final String sql = \"SELECT \" + cols\n                 + \", max(\" + SchemaConstants.VERSION + \") FROM \" + tbl\n-                + \" WHERE \" + SchemaConstants.SCHEMA_NAME + \" IN (?, ?) \"\n+                + \" WHERE UCASE(\" + SchemaConstants.SCHEMA_NAME + \") IN (UCASE(?), UCASE(?)) \"", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTI0MTcwMw=="}, "originalCommit": {"oid": "8bf9ddc286424e68d2cfb03eb6d40d7d81532de8"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTI2Mjg2OA==", "bodyText": "OK -  I sort of agree, However there is an inconsistency across versions I'd like too account for,  also schema names in postgres tend  to be lowercase versus uppercase  in db2.", "url": "https://github.com/IBM/FHIR/pull/1782#discussion_r535262868", "createdAt": "2020-12-03T14:17:58Z", "author": {"login": "prb112"}, "path": "fhir-database-utils/src/main/java/com/ibm/fhir/database/utils/version/GetLatestVersionDAO.java", "diffHunk": "@@ -50,7 +50,7 @@ public GetLatestVersionDAO(String adminSchemaName, String schemaName) {\n         final String cols = DataDefinitionUtil.join(SchemaConstants.SCHEMA_NAME, SchemaConstants.OBJECT_TYPE, SchemaConstants.OBJECT_NAME);\n         final String sql = \"SELECT \" + cols\n                 + \", max(\" + SchemaConstants.VERSION + \") FROM \" + tbl\n-                + \" WHERE \" + SchemaConstants.SCHEMA_NAME + \" IN (?, ?) \"\n+                + \" WHERE UCASE(\" + SchemaConstants.SCHEMA_NAME + \") IN (UCASE(?), UCASE(?)) \"", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTI0MTcwMw=="}, "originalCommit": {"oid": "8bf9ddc286424e68d2cfb03eb6d40d7d81532de8"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTM1MTQ3Nw==", "bodyText": "I was thinking normalizing casing here was critical for backwards compatibility.  If there is an existing version history service value thats been saved as lowercase, we need the new uppercase schema name to match it, right?", "url": "https://github.com/IBM/FHIR/pull/1782#discussion_r535351477", "createdAt": "2020-12-03T15:47:18Z", "author": {"login": "lmsurpre"}, "path": "fhir-database-utils/src/main/java/com/ibm/fhir/database/utils/version/GetLatestVersionDAO.java", "diffHunk": "@@ -50,7 +50,7 @@ public GetLatestVersionDAO(String adminSchemaName, String schemaName) {\n         final String cols = DataDefinitionUtil.join(SchemaConstants.SCHEMA_NAME, SchemaConstants.OBJECT_TYPE, SchemaConstants.OBJECT_NAME);\n         final String sql = \"SELECT \" + cols\n                 + \", max(\" + SchemaConstants.VERSION + \") FROM \" + tbl\n-                + \" WHERE \" + SchemaConstants.SCHEMA_NAME + \" IN (?, ?) \"\n+                + \" WHERE UCASE(\" + SchemaConstants.SCHEMA_NAME + \") IN (UCASE(?), UCASE(?)) \"", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTI0MTcwMw=="}, "originalCommit": {"oid": "8bf9ddc286424e68d2cfb03eb6d40d7d81532de8"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTM2NjE5NQ==", "bodyText": "Correct, I do that when we process the result sets down further on in", "url": "https://github.com/IBM/FHIR/pull/1782#discussion_r535366195", "createdAt": "2020-12-03T16:04:01Z", "author": {"login": "prb112"}, "path": "fhir-database-utils/src/main/java/com/ibm/fhir/database/utils/version/GetLatestVersionDAO.java", "diffHunk": "@@ -50,7 +50,7 @@ public GetLatestVersionDAO(String adminSchemaName, String schemaName) {\n         final String cols = DataDefinitionUtil.join(SchemaConstants.SCHEMA_NAME, SchemaConstants.OBJECT_TYPE, SchemaConstants.OBJECT_NAME);\n         final String sql = \"SELECT \" + cols\n                 + \", max(\" + SchemaConstants.VERSION + \") FROM \" + tbl\n-                + \" WHERE \" + SchemaConstants.SCHEMA_NAME + \" IN (?, ?) \"\n+                + \" WHERE UCASE(\" + SchemaConstants.SCHEMA_NAME + \") IN (UCASE(?), UCASE(?)) \"", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTI0MTcwMw=="}, "originalCommit": {"oid": "8bf9ddc286424e68d2cfb03eb6d40d7d81532de8"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM1ODY1MDQwOnYy", "diffSide": "LEFT", "path": "fhir-persistence-schema/src/main/java/com/ibm/fhir/schema/app/Main.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wM1QxNToyMTo0N1rOH-hqWw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wM1QxNjo1ODozNFrOH-m-gg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTMyNTI3NQ==", "bodyText": "I removed it as it was never used", "url": "https://github.com/IBM/FHIR/pull/1782#discussion_r535325275", "createdAt": "2020-12-03T15:21:47Z", "author": {"login": "prb112"}, "path": "fhir-persistence-schema/src/main/java/com/ibm/fhir/schema/app/Main.java", "diffHunk": "@@ -146,11 +138,6 @@\n     private boolean dropJavaBatchSchema = false;\n     private boolean grantJavaBatchSchema = false;\n \n-    // By default, the dryRun option is OFF, and FALSE\n-    // When overridden, it simulates the actions.\n-    @SuppressWarnings(\"unused\")\n-    private boolean dryRun = false;\n-", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c2193720060c03214cfab6924175a7a0b7854894"}, "originalPosition": 36}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTQxMjM1NA==", "bodyText": "sounds good, though I'd still like to add it back in at some point!", "url": "https://github.com/IBM/FHIR/pull/1782#discussion_r535412354", "createdAt": "2020-12-03T16:58:34Z", "author": {"login": "lmsurpre"}, "path": "fhir-persistence-schema/src/main/java/com/ibm/fhir/schema/app/Main.java", "diffHunk": "@@ -146,11 +138,6 @@\n     private boolean dropJavaBatchSchema = false;\n     private boolean grantJavaBatchSchema = false;\n \n-    // By default, the dryRun option is OFF, and FALSE\n-    // When overridden, it simulates the actions.\n-    @SuppressWarnings(\"unused\")\n-    private boolean dryRun = false;\n-", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTMyNTI3NQ=="}, "originalCommit": {"oid": "c2193720060c03214cfab6924175a7a0b7854894"}, "originalPosition": 36}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4649, "cost": 1, "resetAt": "2021-11-13T12:10:21Z"}}}