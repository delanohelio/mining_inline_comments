{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk0OTUwMDQx", "number": 862, "reviewThreads": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yN1QyMDoyNzoyOVrODsN7EA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMFQwMTo1MTo0NlrODsfKCg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ3NjkyMDQ4OnYy", "diffSide": "RIGHT", "path": "fhir-database-utils/src/main/java/com/ibm/fhir/database/utils/derby/DerbyServerPropertiesMgr.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yN1QyMDoyNzoyOVrOF9A0ZA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yN1QyMDoyNzoyOVrOF9A0ZA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTUyMDg2OA==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                public static void setServerProperties (boolean isDebug) {\n          \n          \n            \n                public static void setServerProperties(boolean isDebug) {", "url": "https://github.com/IBM/FHIR/pull/862#discussion_r399520868", "createdAt": "2020-03-27T20:27:29Z", "author": {"login": "prb112"}, "path": "fhir-database-utils/src/main/java/com/ibm/fhir/database/utils/derby/DerbyServerPropertiesMgr.java", "diffHunk": "@@ -0,0 +1,29 @@\n+/*\n+ * (C) Copyright IBM Corp. 2020\n+ *\n+ * SPDX-License-Identifier: Apache-2.0\n+ */\n+\n+package com.ibm.fhir.database.utils.derby;\n+\n+import java.util.Properties;\n+\n+\n+/**\n+ * Server properties for embedded derby which is used in unit tests and server integration tests,\n+ * equal to setting in derby.properties.\n+ */\n+public class DerbyServerPropertiesMgr {\n+    public static void setServerProperties (boolean isDebug) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bc2824999e5be15164a716946b8ed7ac7f15adef"}, "originalPosition": 17}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ3NjkyODMwOnYy", "diffSide": "RIGHT", "path": "fhir-server/src/main/java/com/ibm/fhir/server/listener/FHIRServletContextListener.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yN1QyMDozMDoxM1rOF9A5Vw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yOFQwMToxNDo1MlrOF9FqFA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTUyMjEzNQ==", "bodyText": "it's not really a constant at this point. let's just pass in the boolean value and a comment on line 149....", "url": "https://github.com/IBM/FHIR/pull/862#discussion_r399522135", "createdAt": "2020-03-27T20:30:13Z", "author": {"login": "prb112"}, "path": "fhir-server/src/main/java/com/ibm/fhir/server/listener/FHIRServletContextListener.java", "diffHunk": "@@ -140,8 +141,13 @@ public void contextInitialized(ServletContextEvent event) {\n      */\n     private void bootstrapDerbyDatabases(PropertyGroup fhirConfig) throws Exception {\n         Boolean performDbBootstrap = fhirConfig.getBooleanProperty(PROPERTY_JDBC_BOOTSTRAP_DB, Boolean.FALSE);\n+        // Controls if we run derby in debugging mode which enables more logs.\n+        boolean DEBUG = false;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bc2824999e5be15164a716946b8ed7ac7f15adef"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTU4ODgyNA==", "bodyText": "agreed, thanks!", "url": "https://github.com/IBM/FHIR/pull/862#discussion_r399588824", "createdAt": "2020-03-28T00:03:14Z", "author": {"login": "albertwang-ibm"}, "path": "fhir-server/src/main/java/com/ibm/fhir/server/listener/FHIRServletContextListener.java", "diffHunk": "@@ -140,8 +141,13 @@ public void contextInitialized(ServletContextEvent event) {\n      */\n     private void bootstrapDerbyDatabases(PropertyGroup fhirConfig) throws Exception {\n         Boolean performDbBootstrap = fhirConfig.getBooleanProperty(PROPERTY_JDBC_BOOTSTRAP_DB, Boolean.FALSE);\n+        // Controls if we run derby in debugging mode which enables more logs.\n+        boolean DEBUG = false;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTUyMjEzNQ=="}, "originalCommit": {"oid": "bc2824999e5be15164a716946b8ed7ac7f15adef"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTYwMDE0OA==", "bodyText": "done", "url": "https://github.com/IBM/FHIR/pull/862#discussion_r399600148", "createdAt": "2020-03-28T01:14:52Z", "author": {"login": "albertwang-ibm"}, "path": "fhir-server/src/main/java/com/ibm/fhir/server/listener/FHIRServletContextListener.java", "diffHunk": "@@ -140,8 +141,13 @@ public void contextInitialized(ServletContextEvent event) {\n      */\n     private void bootstrapDerbyDatabases(PropertyGroup fhirConfig) throws Exception {\n         Boolean performDbBootstrap = fhirConfig.getBooleanProperty(PROPERTY_JDBC_BOOTSTRAP_DB, Boolean.FALSE);\n+        // Controls if we run derby in debugging mode which enables more logs.\n+        boolean DEBUG = false;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTUyMjEzNQ=="}, "originalCommit": {"oid": "bc2824999e5be15164a716946b8ed7ac7f15adef"}, "originalPosition": 22}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ3NjkzMTQ3OnYy", "diffSide": "RIGHT", "path": "fhir-database-utils/src/main/java/com/ibm/fhir/database/utils/derby/DerbyServerPropertiesMgr.java", "isResolved": true, "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yN1QyMDozMToyOVrOF9A7hg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMFQxMjoyOTowOVrOF9nV0g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTUyMjY5NA==", "bodyText": "does Derby automatically write this out when it's set on System.getProperties?", "url": "https://github.com/IBM/FHIR/pull/862#discussion_r399522694", "createdAt": "2020-03-27T20:31:29Z", "author": {"login": "prb112"}, "path": "fhir-database-utils/src/main/java/com/ibm/fhir/database/utils/derby/DerbyServerPropertiesMgr.java", "diffHunk": "@@ -0,0 +1,29 @@\n+/*\n+ * (C) Copyright IBM Corp. 2020\n+ *\n+ * SPDX-License-Identifier: Apache-2.0\n+ */\n+\n+package com.ibm.fhir.database.utils.derby;\n+\n+import java.util.Properties;\n+\n+\n+/**\n+ * Server properties for embedded derby which is used in unit tests and server integration tests,\n+ * equal to setting in derby.properties.\n+ */\n+public class DerbyServerPropertiesMgr {\n+    public static void setServerProperties (boolean isDebug) {\n+        Properties sysProperties = System.getProperties();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bc2824999e5be15164a716946b8ed7ac7f15adef"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTU4ODk1Ng==", "bodyText": "no, it doesn't.", "url": "https://github.com/IBM/FHIR/pull/862#discussion_r399588956", "createdAt": "2020-03-28T00:03:49Z", "author": {"login": "albertwang-ibm"}, "path": "fhir-database-utils/src/main/java/com/ibm/fhir/database/utils/derby/DerbyServerPropertiesMgr.java", "diffHunk": "@@ -0,0 +1,29 @@\n+/*\n+ * (C) Copyright IBM Corp. 2020\n+ *\n+ * SPDX-License-Identifier: Apache-2.0\n+ */\n+\n+package com.ibm.fhir.database.utils.derby;\n+\n+import java.util.Properties;\n+\n+\n+/**\n+ * Server properties for embedded derby which is used in unit tests and server integration tests,\n+ * equal to setting in derby.properties.\n+ */\n+public class DerbyServerPropertiesMgr {\n+    public static void setServerProperties (boolean isDebug) {\n+        Properties sysProperties = System.getProperties();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTUyMjY5NA=="}, "originalCommit": {"oid": "bc2824999e5be15164a716946b8ed7ac7f15adef"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDA5Nzg2MQ==", "bodyText": "How does this write out? ...\nThe prior code uses a PrintWriter, and now it uses System.getProperties.\ntry (PrintWriter out = new PrintWriter(DERBY_PROPERTIES)){ \nIs very different from System.getProperties", "url": "https://github.com/IBM/FHIR/pull/862#discussion_r400097861", "createdAt": "2020-03-30T10:49:32Z", "author": {"login": "prb112"}, "path": "fhir-database-utils/src/main/java/com/ibm/fhir/database/utils/derby/DerbyServerPropertiesMgr.java", "diffHunk": "@@ -0,0 +1,29 @@\n+/*\n+ * (C) Copyright IBM Corp. 2020\n+ *\n+ * SPDX-License-Identifier: Apache-2.0\n+ */\n+\n+package com.ibm.fhir.database.utils.derby;\n+\n+import java.util.Properties;\n+\n+\n+/**\n+ * Server properties for embedded derby which is used in unit tests and server integration tests,\n+ * equal to setting in derby.properties.\n+ */\n+public class DerbyServerPropertiesMgr {\n+    public static void setServerProperties (boolean isDebug) {\n+        Properties sysProperties = System.getProperties();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTUyMjY5NA=="}, "originalCommit": {"oid": "bc2824999e5be15164a716946b8ed7ac7f15adef"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDE0NTkwOQ==", "bodyText": "yes, you are correct. I had used the perperties file because I did find this way at that time, now I found this way is much easier and don't have to associate with any directory.", "url": "https://github.com/IBM/FHIR/pull/862#discussion_r400145909", "createdAt": "2020-03-30T12:19:01Z", "author": {"login": "albertwang-ibm"}, "path": "fhir-database-utils/src/main/java/com/ibm/fhir/database/utils/derby/DerbyServerPropertiesMgr.java", "diffHunk": "@@ -0,0 +1,29 @@\n+/*\n+ * (C) Copyright IBM Corp. 2020\n+ *\n+ * SPDX-License-Identifier: Apache-2.0\n+ */\n+\n+package com.ibm.fhir.database.utils.derby;\n+\n+import java.util.Properties;\n+\n+\n+/**\n+ * Server properties for embedded derby which is used in unit tests and server integration tests,\n+ * equal to setting in derby.properties.\n+ */\n+public class DerbyServerPropertiesMgr {\n+    public static void setServerProperties (boolean isDebug) {\n+        Properties sysProperties = System.getProperties();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTUyMjY5NA=="}, "originalCommit": {"oid": "bc2824999e5be15164a716946b8ed7ac7f15adef"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDE1MjAxOA==", "bodyText": "Excellent.  thanks", "url": "https://github.com/IBM/FHIR/pull/862#discussion_r400152018", "createdAt": "2020-03-30T12:29:09Z", "author": {"login": "prb112"}, "path": "fhir-database-utils/src/main/java/com/ibm/fhir/database/utils/derby/DerbyServerPropertiesMgr.java", "diffHunk": "@@ -0,0 +1,29 @@\n+/*\n+ * (C) Copyright IBM Corp. 2020\n+ *\n+ * SPDX-License-Identifier: Apache-2.0\n+ */\n+\n+package com.ibm.fhir.database.utils.derby;\n+\n+import java.util.Properties;\n+\n+\n+/**\n+ * Server properties for embedded derby which is used in unit tests and server integration tests,\n+ * equal to setting in derby.properties.\n+ */\n+public class DerbyServerPropertiesMgr {\n+    public static void setServerProperties (boolean isDebug) {\n+        Properties sysProperties = System.getProperties();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTUyMjY5NA=="}, "originalCommit": {"oid": "bc2824999e5be15164a716946b8ed7ac7f15adef"}, "originalPosition": 18}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ3NjkzNDQ4OnYy", "diffSide": "LEFT", "path": "fhir-database-utils/src/main/java/com/ibm/fhir/database/utils/derby/DerbyMaster.java", "isResolved": true, "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yN1QyMDozMjozNVrOF9A9fg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMFQxMDo1NjowM1rOF9kQkw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTUyMzE5OA==", "bodyText": "I take it the translator already does the class name lookup?  otherwise if it doesn't I think this should be done on line 53. it's the general jdbc driver class loading pattern", "url": "https://github.com/IBM/FHIR/pull/862#discussion_r399523198", "createdAt": "2020-03-27T20:32:35Z", "author": {"login": "prb112"}, "path": "fhir-database-utils/src/main/java/com/ibm/fhir/database/utils/derby/DerbyMaster.java", "diffHunk": "@@ -56,22 +51,7 @@\n     public DerbyMaster(String database) {\n         this.database = database;\n \n-        try (PrintWriter out = new PrintWriter(DERBY_PROPERTIES)){\n-            Class.forName(DERBY_TRANSLATOR.getDriverClassName());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6a4d3e8d180dbcbe4085b27762ac91bd500f3514"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTU5NzkwMA==", "bodyText": "yeah, it's interesting that removing this has been working well. checking if this is really needed here ....", "url": "https://github.com/IBM/FHIR/pull/862#discussion_r399597900", "createdAt": "2020-03-28T00:57:29Z", "author": {"login": "albertwang-ibm"}, "path": "fhir-database-utils/src/main/java/com/ibm/fhir/database/utils/derby/DerbyMaster.java", "diffHunk": "@@ -56,22 +51,7 @@\n     public DerbyMaster(String database) {\n         this.database = database;\n \n-        try (PrintWriter out = new PrintWriter(DERBY_PROPERTIES)){\n-            Class.forName(DERBY_TRANSLATOR.getDriverClassName());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTUyMzE5OA=="}, "originalCommit": {"oid": "6a4d3e8d180dbcbe4085b27762ac91bd500f3514"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTU5OTAyOQ==", "bodyText": "did some search, JDBC 4.0 (and after) drivers that are found in your class path are automatically loaded, only JDBC drivers older than 4.0 have to be loaded by Class.forName.\nI will keep it just in case JDBC older drivers are/(will be) still used...", "url": "https://github.com/IBM/FHIR/pull/862#discussion_r399599029", "createdAt": "2020-03-28T01:06:14Z", "author": {"login": "albertwang-ibm"}, "path": "fhir-database-utils/src/main/java/com/ibm/fhir/database/utils/derby/DerbyMaster.java", "diffHunk": "@@ -56,22 +51,7 @@\n     public DerbyMaster(String database) {\n         this.database = database;\n \n-        try (PrintWriter out = new PrintWriter(DERBY_PROPERTIES)){\n-            Class.forName(DERBY_TRANSLATOR.getDriverClassName());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTUyMzE5OA=="}, "originalCommit": {"oid": "6a4d3e8d180dbcbe4085b27762ac91bd500f3514"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTYwMDIzMg==", "bodyText": "added it back with comment even thought I believe it's not really needed now", "url": "https://github.com/IBM/FHIR/pull/862#discussion_r399600232", "createdAt": "2020-03-28T01:15:33Z", "author": {"login": "albertwang-ibm"}, "path": "fhir-database-utils/src/main/java/com/ibm/fhir/database/utils/derby/DerbyMaster.java", "diffHunk": "@@ -56,22 +51,7 @@\n     public DerbyMaster(String database) {\n         this.database = database;\n \n-        try (PrintWriter out = new PrintWriter(DERBY_PROPERTIES)){\n-            Class.forName(DERBY_TRANSLATOR.getDriverClassName());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTUyMzE5OA=="}, "originalCommit": {"oid": "6a4d3e8d180dbcbe4085b27762ac91bd500f3514"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDEwMTUyMw==", "bodyText": "it's best to maintain a consistent pattern - it's in FhirDbDaoImpl too", "url": "https://github.com/IBM/FHIR/pull/862#discussion_r400101523", "createdAt": "2020-03-30T10:56:03Z", "author": {"login": "prb112"}, "path": "fhir-database-utils/src/main/java/com/ibm/fhir/database/utils/derby/DerbyMaster.java", "diffHunk": "@@ -56,22 +51,7 @@\n     public DerbyMaster(String database) {\n         this.database = database;\n \n-        try (PrintWriter out = new PrintWriter(DERBY_PROPERTIES)){\n-            Class.forName(DERBY_TRANSLATOR.getDriverClassName());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTUyMzE5OA=="}, "originalCommit": {"oid": "6a4d3e8d180dbcbe4085b27762ac91bd500f3514"}, "originalPosition": 25}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ3OTc0NDEwOnYy", "diffSide": "RIGHT", "path": "fhir-server/src/main/java/com/ibm/fhir/server/listener/FHIRServletContextListener.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMFQwMTo1MTo0NlrOF9XX0A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMFQwMTo1MTo0NlrOF9XX0A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTg5MDM4NA==", "bodyText": "Is this actually needed?  Isn't \"false\" the default?\nOr I guess you add this here just to make it easy to turn on should we want to turn it on?", "url": "https://github.com/IBM/FHIR/pull/862#discussion_r399890384", "createdAt": "2020-03-30T01:51:46Z", "author": {"login": "lmsurpre"}, "path": "fhir-server/src/main/java/com/ibm/fhir/server/listener/FHIRServletContextListener.java", "diffHunk": "@@ -142,6 +143,10 @@ private void bootstrapDerbyDatabases(PropertyGroup fhirConfig) throws Exception\n         Boolean performDbBootstrap = fhirConfig.getBooleanProperty(PROPERTY_JDBC_BOOTSTRAP_DB, Boolean.FALSE);\n         if (performDbBootstrap) {\n             log.info(\"Performing Derby database bootstrapping...\");\n+\n+            // Start derby with debug off by default.\n+            DerbyServerPropertiesMgr.setServerProperties(false);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0a9d5c89869e281bfc99f2a7a0ea27231f0dda31"}, "originalPosition": 23}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 148, "cost": 1, "resetAt": "2021-11-12T20:44:06Z"}}}