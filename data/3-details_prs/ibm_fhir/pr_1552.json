{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDk2MzY3NzMz", "number": 1552, "title": "issue-1517 - Support for variables in JSON configuration files like 'fhir-server-config.json'", "bodyText": "Use Apache Commons Text\u2019s StringSubstitutor in ConfigurationService\u2019s loadConfiguration method to replace variables in JSON configuration files with the values of the respective envirnoment variables.", "createdAt": "2020-10-01T15:54:10Z", "url": "https://github.com/IBM/FHIR/pull/1552", "merged": true, "mergeCommit": {"oid": "da391f71ae2e8e4edeceecadaf9f27e86bd51687"}, "closed": true, "closedAt": "2020-10-06T15:52:50Z", "author": {"login": "holger-stenzhorn"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdOU9CqgFqTUwMDU3NDIzNQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdP6dB1AFqTUwMzExNjM0NQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAwNTc0MjM1", "url": "https://github.com/IBM/FHIR/pull/1552#pullrequestreview-500574235", "createdAt": "2020-10-01T17:36:57Z", "commit": {"oid": "685793711e97f879e408d18e75c6c2f8e27c3d46"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMVQxNzozNjo1N1rOHbUkXg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMVQxNzozNjo1N1rOHbUkXg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODQxMDU5MA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    <dependency>\n          \n          \n            \n                        <groupId>com.google.code.gson</groupId>\n          \n          \n            \n                        <artifactId>gson</artifactId>\n          \n          \n            \n                    </dependency>\n          \n      \n    \n    \n  \n\nduplicate declaration as on line 44", "url": "https://github.com/IBM/FHIR/pull/1552#discussion_r498410590", "createdAt": "2020-10-01T17:36:57Z", "author": {"login": "prb112"}, "path": "fhir-config/pom.xml", "diffHunk": "@@ -25,9 +25,35 @@\n             <artifactId>testng</artifactId>\n             <scope>test</scope>\n         </dependency>\n+        <dependency>\n+            <groupId>org.powermock</groupId>\n+            <artifactId>powermock-module-testng</artifactId>\n+            <version>1.7.4</version>\n+            <scope>test</scope>\n+        </dependency>\n+        <dependency>\n+            <groupId>org.powermock</groupId>\n+            <artifactId>powermock-api-mockito</artifactId>\n+            <version>1.7.4</version>\n+            <scope>test</scope>\n+        </dependency>\n+        <dependency>\n+            <groupId>com.google.code.gson</groupId>\n+            <artifactId>gson</artifactId>\n+        </dependency>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "685793711e97f879e408d18e75c6c2f8e27c3d46"}, "originalPosition": 19}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAwNTc4NDYz", "url": "https://github.com/IBM/FHIR/pull/1552#pullrequestreview-500578463", "createdAt": "2020-10-01T17:42:33Z", "commit": {"oid": "685793711e97f879e408d18e75c6c2f8e27c3d46"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMVQxNzo0MjozM1rOHbUwLg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMVQxNzo0MjozM1rOHbUwLg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODQxMzYxNA==", "bodyText": "I think as a pattern we should probably prefix with something...\na small addition so it does something like this\nSystem.getenv().entrySet().stream().filter(es -> es.getKey().startsWith(\"FHIR.\")).collect(Collectors.toMap(Map.Entry::getKey, Map.Entry::getValue))", "url": "https://github.com/IBM/FHIR/pull/1552#discussion_r498413614", "createdAt": "2020-10-01T17:42:33Z", "author": {"login": "prb112"}, "path": "fhir-config/src/main/java/com/ibm/fhir/config/ConfigurationService.java", "diffHunk": "@@ -53,7 +58,9 @@ public static PropertyGroup loadConfiguration(String filename) throws Exception\n      *            an InputStream to the input JSON file\n      */\n     public static PropertyGroup loadConfiguration(InputStream is) throws Exception {\n-        try (JsonReader reader = JSON_READER_FACTORY.createReader(is)) {\n+        String templatedJson = IOUtils.toString(is, StandardCharsets.UTF_8);\n+        String resolvedJson = StringSubstitutor.replace(templatedJson, System.getenv());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "685793711e97f879e408d18e75c6c2f8e27c3d46"}, "originalPosition": 23}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAwNTc5Njg1", "url": "https://github.com/IBM/FHIR/pull/1552#pullrequestreview-500579685", "createdAt": "2020-10-01T17:44:06Z", "commit": {"oid": "685793711e97f879e408d18e75c6c2f8e27c3d46"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMVQxNzo0NDowNlrOHbUz4g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMVQxNzo0NDowNlrOHbUz4g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODQxNDU2Mg==", "bodyText": "note, we should probably change the copyright year to 2020", "url": "https://github.com/IBM/FHIR/pull/1552#discussion_r498414562", "createdAt": "2020-10-01T17:44:06Z", "author": {"login": "prb112"}, "path": "fhir-config/src/main/java/com/ibm/fhir/config/ConfigurationService.java", "diffHunk": "@@ -6,11 +6,16 @@\n \n package com.ibm.fhir.config;\n \n+import org.apache.commons.io.IOUtils;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "685793711e97f879e408d18e75c6c2f8e27c3d46"}, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6e1b4ea4ccbb0e8421fc67ef536963564a07d994", "author": {"user": {"login": "holger-stenzhorn", "name": "Holger Stenzhorn"}}, "url": "https://github.com/IBM/FHIR/commit/6e1b4ea4ccbb0e8421fc67ef536963564a07d994", "committedDate": "2020-10-03T17:14:08Z", "message": "issue-1517 - Support for variables in JSON configuration files like 'fhir-server-config.json'\n\nUse Apache Commons Text\u2019s StringSubstitutor in ConfigurationService\u2019s loadConfiguration method to replace variables in JSON configuration files with the values of the respective envirnoment variables.\n\nSigned-off-by: Holger Stenzhorn <holger.stenzhorn@uks.eu>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5a3ab31478e055fc4db1cceaf9401ef80390d9ee", "author": {"user": {"login": "holger-stenzhorn", "name": "Holger Stenzhorn"}}, "url": "https://github.com/IBM/FHIR/commit/5a3ab31478e055fc4db1cceaf9401ef80390d9ee", "committedDate": "2020-10-03T17:14:08Z", "message": "Remove duplicate declaration of Maven dependency\n\nCo-authored-by: Paul Bastide <paul@bastide.org>\nSigned-off-by: Holger Stenzhorn <holger.stenzhorn@uks.eu>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a5b93c450016d7a20d4b4565b6e7380d9e845203", "author": {"user": {"login": "holger-stenzhorn", "name": "Holger Stenzhorn"}}, "url": "https://github.com/IBM/FHIR/commit/a5b93c450016d7a20d4b4565b6e7380d9e845203", "committedDate": "2020-10-03T17:14:08Z", "message": "Update ConfigurationService.java\n\nChanged copyright years to current one\n\nSigned-off-by: Holger Stenzhorn <holger.stenzhorn@uks.eu>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c3741e71b27a848772a300deb84549f7a7fd1a47", "author": {"user": {"login": "holger-stenzhorn", "name": "Holger Stenzhorn"}}, "url": "https://github.com/IBM/FHIR/commit/c3741e71b27a848772a300deb84549f7a7fd1a47", "committedDate": "2020-10-03T17:14:08Z", "message": "Fix ConfigurationServiceTest failing on Java 11\n\nThe initial commit used PowerMock 1.7.4 which is not compatible with Java 11 and this still applies for (current) 2.0.7. Luckily Mockito 3.5.13 provides the needed functionality out-of-the-box.\n\nSigned-off-by: Holger Stenzhorn <holger.stenzhorn@uks.eu>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAzMDY5MTA5", "url": "https://github.com/IBM/FHIR/pull/1552#pullrequestreview-503069109", "createdAt": "2020-10-06T15:06:47Z", "commit": {"oid": "c3741e71b27a848772a300deb84549f7a7fd1a47"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAzMDcwMTMy", "url": "https://github.com/IBM/FHIR/pull/1552#pullrequestreview-503070132", "createdAt": "2020-10-06T15:07:47Z", "commit": {"oid": "c3741e71b27a848772a300deb84549f7a7fd1a47"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAzMTE2MzQ1", "url": "https://github.com/IBM/FHIR/pull/1552#pullrequestreview-503116345", "createdAt": "2020-10-06T15:52:18Z", "commit": {"oid": "c3741e71b27a848772a300deb84549f7a7fd1a47"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 860, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}