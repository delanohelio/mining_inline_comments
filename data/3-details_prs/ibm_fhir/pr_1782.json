{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTMxNzkwNDAw", "number": 1782, "title": "fix: version history is case sensitive, and fails when customers chan\u2026", "bodyText": "\u2026ge the case sensisitivity of their schema names\nSigned-off-by: Paul Bastide pbastide@us.ibm.com", "createdAt": "2020-12-03T13:48:00Z", "url": "https://github.com/IBM/FHIR/pull/1782", "merged": true, "mergeCommit": {"oid": "960c4252008eb155e746b17417a61952c9134a68"}, "closed": true, "closedAt": "2020-12-03T17:07:35Z", "author": {"login": "prb112"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdijbzDAH2gAyNTMxNzkwNDAwOjhiZjlkZGMyODY0MjRlNjhkMmNmYjAzZWI2ZDQwZDdkODE1MzJkZTg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdimSnPgFqTU0NDE4NTQyMQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "8bf9ddc286424e68d2cfb03eb6d40d7d81532de8", "author": {"user": {"login": "prb112", "name": "Paul Bastide"}}, "url": "https://github.com/IBM/FHIR/commit/8bf9ddc286424e68d2cfb03eb6d40d7d81532de8", "committedDate": "2020-12-03T13:47:42Z", "message": "fix: version history is case sensitive, and fails when customers change the case sensisitivity of their schema names\n\nSigned-off-by: Paul Bastide <pbastide@us.ibm.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQzOTY5MDEy", "url": "https://github.com/IBM/FHIR/pull/1782#pullrequestreview-543969012", "createdAt": "2020-12-03T13:48:59Z", "commit": {"oid": "8bf9ddc286424e68d2cfb03eb6d40d7d81532de8"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wM1QxMzo0ODo1OVrOH-ch1w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wM1QxMzo0ODo1OVrOH-ch1w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTI0MTE3NQ==", "bodyText": "Going forward this would always ensure the schemaname is uppercase in the VHS table", "url": "https://github.com/IBM/FHIR/pull/1782#discussion_r535241175", "createdAt": "2020-12-03T13:48:59Z", "author": {"login": "prb112"}, "path": "fhir-database-utils/src/main/java/com/ibm/fhir/database/utils/version/VersionHistoryService.java", "diffHunk": "@@ -126,7 +126,7 @@ public void insertVersionHistoriesInTx(Collection<TypeNameVersion> versionHistor\n      * @param version\n      */\n     public void insertVersionHistoryInTx(String objectSchema, String objectType, String objectName, int version) {\n-        AddVersionDAO dao = new AddVersionDAO(adminSchemaName, objectSchema, objectType, objectName, version);\n+        AddVersionDAO dao = new AddVersionDAO(adminSchemaName, objectSchema.toUpperCase(), objectType, objectName, version);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8bf9ddc286424e68d2cfb03eb6d40d7d81532de8"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQzOTY5MjIw", "url": "https://github.com/IBM/FHIR/pull/1782#pullrequestreview-543969220", "createdAt": "2020-12-03T13:49:13Z", "commit": {"oid": "8bf9ddc286424e68d2cfb03eb6d40d7d81532de8"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wM1QxMzo0OToxNFrOH-cifw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wM1QxMzo0OToxNFrOH-cifw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTI0MTM0Mw==", "bodyText": "Make sure we are forcing any incoming applies to be uppercase", "url": "https://github.com/IBM/FHIR/pull/1782#discussion_r535241343", "createdAt": "2020-12-03T13:49:14Z", "author": {"login": "prb112"}, "path": "fhir-database-utils/src/main/java/com/ibm/fhir/database/utils/version/VersionHistoryService.java", "diffHunk": "@@ -204,7 +204,7 @@ public void addVersion(String objectSchema, String objectType, String objectName\n \n     @Override\n     public boolean applies(String objectSchema, String objectType, String objectName, int changeVersion) {\n-        String key = objectSchema + \":\" + objectType + \":\" + objectName;\n+        String key = objectSchema.toUpperCase() + \":\" + objectType + \":\" + objectName;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8bf9ddc286424e68d2cfb03eb6d40d7d81532de8"}, "originalPosition": 14}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQzOTY5NDU2", "url": "https://github.com/IBM/FHIR/pull/1782#pullrequestreview-543969456", "createdAt": "2020-12-03T13:49:30Z", "commit": {"oid": "8bf9ddc286424e68d2cfb03eb6d40d7d81532de8"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wM1QxMzo0OTozMVrOH-cjRw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wM1QxMzo0OTozMVrOH-cjRw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTI0MTU0Mw==", "bodyText": "I threw this in as uppercase for consistency", "url": "https://github.com/IBM/FHIR/pull/1782#discussion_r535241543", "createdAt": "2020-12-03T13:49:31Z", "author": {"login": "prb112"}, "path": "fhir-database-utils/src/main/java/com/ibm/fhir/database/utils/version/GetLatestVersionDAO.java", "diffHunk": "@@ -59,7 +59,7 @@ public GetLatestVersionDAO(String adminSchemaName, String schemaName) {\n             ps.setString(2, schemaName);\n             ResultSet rs = ps.executeQuery();\n             while (rs.next()) {\n-                String schema = rs.getString(1);\n+                String schema = rs.getString(1).toUpperCase();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8bf9ddc286424e68d2cfb03eb6d40d7d81532de8"}, "originalPosition": 14}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQzOTY5Njcz", "url": "https://github.com/IBM/FHIR/pull/1782#pullrequestreview-543969673", "createdAt": "2020-12-03T13:49:44Z", "commit": {"oid": "8bf9ddc286424e68d2cfb03eb6d40d7d81532de8"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wM1QxMzo0OTo0NFrOH-cj5w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wM1QxMzo0OTo0NFrOH-cj5w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTI0MTcwMw==", "bodyText": "I wrapped this in ucase for backwards compatiblity", "url": "https://github.com/IBM/FHIR/pull/1782#discussion_r535241703", "createdAt": "2020-12-03T13:49:44Z", "author": {"login": "prb112"}, "path": "fhir-database-utils/src/main/java/com/ibm/fhir/database/utils/version/GetLatestVersionDAO.java", "diffHunk": "@@ -50,7 +50,7 @@ public GetLatestVersionDAO(String adminSchemaName, String schemaName) {\n         final String cols = DataDefinitionUtil.join(SchemaConstants.SCHEMA_NAME, SchemaConstants.OBJECT_TYPE, SchemaConstants.OBJECT_NAME);\n         final String sql = \"SELECT \" + cols\n                 + \", max(\" + SchemaConstants.VERSION + \") FROM \" + tbl\n-                + \" WHERE \" + SchemaConstants.SCHEMA_NAME + \" IN (?, ?) \"\n+                + \" WHERE UCASE(\" + SchemaConstants.SCHEMA_NAME + \") IN (UCASE(?), UCASE(?)) \"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8bf9ddc286424e68d2cfb03eb6d40d7d81532de8"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "26cad98be093c512954df38ec1fcc1a6b218eaa9", "author": {"user": {"login": "prb112", "name": "Paul Bastide"}}, "url": "https://github.com/IBM/FHIR/commit/26cad98be093c512954df38ec1fcc1a6b218eaa9", "committedDate": "2020-12-03T14:07:05Z", "message": "fix: ucase is changed to upper\n\nSigned-off-by: Paul Bastide <pbastide@us.ibm.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c2193720060c03214cfab6924175a7a0b7854894", "author": {"user": {"login": "prb112", "name": "Paul Bastide"}}, "url": "https://github.com/IBM/FHIR/commit/c2193720060c03214cfab6924175a7a0b7854894", "committedDate": "2020-12-03T15:20:01Z", "message": "fix: schema issue\n\nSigned-off-by: Paul Bastide <pbastide@us.ibm.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ0MDY0NjI0", "url": "https://github.com/IBM/FHIR/pull/1782#pullrequestreview-544064624", "createdAt": "2020-12-03T15:21:47Z", "commit": {"oid": "c2193720060c03214cfab6924175a7a0b7854894"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wM1QxNToyMTo0N1rOH-hqWw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wM1QxNToyMTo0N1rOH-hqWw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTMyNTI3NQ==", "bodyText": "I removed it as it was never used", "url": "https://github.com/IBM/FHIR/pull/1782#discussion_r535325275", "createdAt": "2020-12-03T15:21:47Z", "author": {"login": "prb112"}, "path": "fhir-persistence-schema/src/main/java/com/ibm/fhir/schema/app/Main.java", "diffHunk": "@@ -146,11 +138,6 @@\n     private boolean dropJavaBatchSchema = false;\n     private boolean grantJavaBatchSchema = false;\n \n-    // By default, the dryRun option is OFF, and FALSE\n-    // When overridden, it simulates the actions.\n-    @SuppressWarnings(\"unused\")\n-    private boolean dryRun = false;\n-", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c2193720060c03214cfab6924175a7a0b7854894"}, "originalPosition": 36}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6833eb59b53e0764547500c9329ecddf6e9ca700", "author": {"user": {"login": "prb112", "name": "Paul Bastide"}}, "url": "https://github.com/IBM/FHIR/commit/6833eb59b53e0764547500c9329ecddf6e9ca700", "committedDate": "2020-12-03T15:28:06Z", "message": "Merge branch 'master' into fix-sp-fun"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ0MTU5MTgz", "url": "https://github.com/IBM/FHIR/pull/1782#pullrequestreview-544159183", "createdAt": "2020-12-03T16:39:55Z", "commit": {"oid": "6833eb59b53e0764547500c9329ecddf6e9ca700"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ0MTg1NDIx", "url": "https://github.com/IBM/FHIR/pull/1782#pullrequestreview-544185421", "createdAt": "2020-12-03T17:07:23Z", "commit": {"oid": "6833eb59b53e0764547500c9329ecddf6e9ca700"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 799, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}