{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY4MTk0NTYx", "number": 1416, "title": "Issue 1413 - improve error response for unsupported modifiers", "bodyText": "uncomment the chained_missing search tests from the fhir-persistence module\nupdate FHIRPersistenceJDBCImpl.checkModifiers to throw a FHIRPersistenceNotSupportedException for chained params with a modifier\noverride these search tests in the fhir-persistence-jdbc concrete subtypes and add an exception expectation\n\nseparately, i found and opened issue #1415, documented the current limitation, and made a similar \"fix\":\n\nadd a search test to AbstractWholeSystemSearchTest\nupdate FHIRPersistenceJDBCImpl.checkModifiers to throw a FHIRPersistenceNotSupportedException for whole-system search params with the missing modifier\noverride that search test in JDBCWholeSystemSearchTest to expect that exception\n\nfinally,\n\nadded javadoc for Element.is (and Resource.is)\nadded issue of type NOT_SUPPORTED to FHIRPersistenceNotSupportedException for unsupported modifiers\nadded not-supported-detail extension for requests to unsupported\nresource type endpoints and flipped logic in IssueTypeToHttpStatusMapper\nso that only NOT_SUPPORTED issues with the \"resource\" extension are\nturned into 404 (NOT_FOUND) errors", "createdAt": "2020-08-14T21:40:24Z", "url": "https://github.com/IBM/FHIR/pull/1416", "merged": true, "mergeCommit": {"oid": "20c8907514987ffdfe4c34285ab710255af673cf"}, "closed": true, "closedAt": "2020-08-18T14:00:25Z", "author": {"login": "lmsurpre"}, "timelineItems": {"totalCount": 15, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc-6B2VAH2gAyNDY4MTk0NTYxOjZjNWY0NGY3NGZiZTQ4MTY4NjFhOWMwOWI1MWJhOWRjNzA2YmE4NTc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdAHenugFqTQ2OTQ4NDM3Mw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "6c5f44f74fbe4816861a9c09b51ba9dc706ba857", "author": {"user": {"login": "lmsurpre", "name": "Lee Surprenant"}}, "url": "https://github.com/IBM/FHIR/commit/6c5f44f74fbe4816861a9c09b51ba9dc706ba857", "committedDate": "2020-08-14T19:45:54Z", "message": "issue #1413 - improve error message for unsupported modifiers and test it\n\n1. uncomment the chained_missing search tests from the fhir-persistence module\n2. update FHIRPersistenceJDBCImpl.checkModifiers to throw a FHIRPersistenceNotSupportedException for chained params with a modifier\n3. override these search tests in the fhir-persistence-jdbc concrete subtypes and add an exception expectation\n\nseparately, i found and opened issue #1415 and made a similar fix:\n4. add a search test to AbstractWholeSystemSearchTest\n5. update FHIRPersistenceJDBCImpl.checkModifiers to throw a FHIRPersistenceNotSupportedException for whole-system search params with the missing modifier\n6. override that search test in JDBCWholeSystemSearchTest to expect that exception\n\nSigned-off-by: Lee Surprenant <lmsurpre@us.ibm.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "12a1dfb4ac98b15cc053de2fd9455832f8326b0e", "author": {"user": {"login": "lmsurpre", "name": "Lee Surprenant"}}, "url": "https://github.com/IBM/FHIR/commit/12a1dfb4ac98b15cc053de2fd9455832f8326b0e", "committedDate": "2020-08-15T20:43:22Z", "message": "issue #1413 - set NOT_SUPPORTED and return 400 for unsupported modifiers\n\n1. added javadoc for Element.is\n\n2. added issue of type NOT_SUPPORTED to\nFHIRPersistenceNotSupportedException for unsupported modifiers\n\n3. added not-supported-detail extension for requests to unsupported\nresource type endpoints and flipped logic in IssueTypeToHttpStatusMapper\nso that only NOT_SUPPORTED issues with the \"resource\" extension are\nturned into 404 (NOT_FOUND) errors\n\nSigned-off-by: Lee Surprenant <lmsurpre@us.ibm.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "9c0ff0167751064e6fdf2de553d79f6f3f0c88c7", "author": {"user": {"login": "lmsurpre", "name": "Lee Surprenant"}}, "url": "https://github.com/IBM/FHIR/commit/9c0ff0167751064e6fdf2de553d79f6f3f0c88c7", "committedDate": "2020-08-14T21:37:09Z", "message": "issue #1413 - set NOT_SUPPORTED and return 400 for unsupported modifiers\n\n1. added javadoc for Element.is\n\n2. added issue of type NOT_SUPPORTED to\nFHIRPersistenceNotSupportedException for unsupported modifiers\n\n3. added not-supported-detail extension for requests to unsupported\nresource type endpoints and flipped logic in IssueTypeToHttpStatusMapper\nso that only NOT_SUPPORTED issues with the \"resource\" extension are\nturned into 404 (NOT_FOUND) errors\n\nSigned-off-by: Lee Surprenant <lmsurpre@us.ibm.com>"}, "afterCommit": {"oid": "12a1dfb4ac98b15cc053de2fd9455832f8326b0e", "author": {"user": {"login": "lmsurpre", "name": "Lee Surprenant"}}, "url": "https://github.com/IBM/FHIR/commit/12a1dfb4ac98b15cc053de2fd9455832f8326b0e", "committedDate": "2020-08-15T20:43:22Z", "message": "issue #1413 - set NOT_SUPPORTED and return 400 for unsupported modifiers\n\n1. added javadoc for Element.is\n\n2. added issue of type NOT_SUPPORTED to\nFHIRPersistenceNotSupportedException for unsupported modifiers\n\n3. added not-supported-detail extension for requests to unsupported\nresource type endpoints and flipped logic in IssueTypeToHttpStatusMapper\nso that only NOT_SUPPORTED issues with the \"resource\" extension are\nturned into 404 (NOT_FOUND) errors\n\nSigned-off-by: Lee Surprenant <lmsurpre@us.ibm.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY5Mzg1MjIw", "url": "https://github.com/IBM/FHIR/pull/1416#pullrequestreview-469385220", "createdAt": "2020-08-18T12:22:52Z", "commit": {"oid": "12a1dfb4ac98b15cc053de2fd9455832f8326b0e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOFQxMjoyMjo1MlrOHCQ6KQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOFQxMjoyMjo1MlrOHCQ6KQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjEzNjIzMw==", "bodyText": "this is our internal Status... not HTTPStatus (removed my prior comment)", "url": "https://github.com/IBM/FHIR/pull/1416#discussion_r472136233", "createdAt": "2020-08-18T12:22:52Z", "author": {"login": "prb112"}, "path": "fhir-server/src/main/java/com/ibm/fhir/server/util/IssueTypeToHttpStatusMapper.java", "diffHunk": "@@ -54,16 +54,16 @@\n                             FHIRUtil.getExtensionStringValue(code, EXTENSION_URL_HTTP_FAILED_PRECONDITION) != null) {\n                         return Status.PRECONDITION_FAILED;\n                     } else if (issueType == IssueType.ValueSet.NOT_SUPPORTED &&\n-                            \"interaction\".equals(FHIRUtil.getExtensionStringValue(code, EXTENSION_URL_NOT_SUPPORTED_DETAIL))) {\n-                        return Status.BAD_REQUEST;\n+                            \"resource\".equals(FHIRUtil.getExtensionStringValue(code, EXTENSION_URL_NOT_SUPPORTED_DETAIL))) {\n+                        return Status.NOT_FOUND;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "12a1dfb4ac98b15cc053de2fd9455832f8326b0e"}, "originalPosition": 25}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY5Mzg5MTQ5", "url": "https://github.com/IBM/FHIR/pull/1416#pullrequestreview-469389149", "createdAt": "2020-08-18T12:24:39Z", "commit": {"oid": "12a1dfb4ac98b15cc053de2fd9455832f8326b0e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOFQxMjoyNDozOVrOHCQ91g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOFQxMjoyNDozOVrOHCQ91g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjEzNzE3NA==", "bodyText": "Copyright", "url": "https://github.com/IBM/FHIR/pull/1416#discussion_r472137174", "createdAt": "2020-08-18T12:24:39Z", "author": {"login": "prb112"}, "path": "fhir-search/src/main/java/com/ibm/fhir/search/parameters/QueryParameter.java", "diffHunk": "@@ -19,7 +19,7 @@\n import com.ibm.fhir.search.SearchConstants.Type;\n \n /**\n- * general type of parameter. \n+ * general type of parameter.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "12a1dfb4ac98b15cc053de2fd9455832f8326b0e"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY5Mzk0ODQ5", "url": "https://github.com/IBM/FHIR/pull/1416#pullrequestreview-469394849", "createdAt": "2020-08-18T12:27:15Z", "commit": {"oid": "12a1dfb4ac98b15cc053de2fd9455832f8326b0e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOFQxMjoyNzoxNVrOHCRD8A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOFQxMjoyNzoxNVrOHCRD8A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjEzODczNg==", "bodyText": "there is a high amount of duplication, just a small suggestion to push it down into the method buildUnsupportedResourceTypeException and make it a void method.", "url": "https://github.com/IBM/FHIR/pull/1416#discussion_r472138736", "createdAt": "2020-08-18T12:27:15Z", "author": {"login": "prb112"}, "path": "fhir-server/src/main/java/com/ibm/fhir/server/util/FHIRRestHelper.java", "diffHunk": "@@ -913,7 +914,7 @@ public Bundle doSearch(String type, String compartment, String compartmentId,\n             // Check to see if it's supported, else, throw a bad request.\n             // If this is removed, it'll result in nullpointer when processing the request\n             if (!ModelSupport.isResourceType(type)) {\n-                throw buildUnsupportedResourceTypeException(type, IssueType.NOT_SUPPORTED);\n+                throw buildUnsupportedResourceTypeException(type);\n             }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "12a1dfb4ac98b15cc053de2fd9455832f8326b0e"}, "originalPosition": 50}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY5Mzk3NTg2", "url": "https://github.com/IBM/FHIR/pull/1416#pullrequestreview-469397586", "createdAt": "2020-08-18T12:28:29Z", "commit": {"oid": "12a1dfb4ac98b15cc053de2fd9455832f8326b0e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOFQxMjoyODoyOVrOHCRGfw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOFQxMjoyODoyOVrOHCRGfw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjEzOTM5MQ==", "bodyText": "Copyright", "url": "https://github.com/IBM/FHIR/pull/1416#discussion_r472139391", "createdAt": "2020-08-18T12:28:29Z", "author": {"login": "prb112"}, "path": "fhir-persistence/src/test/java/com/ibm/fhir/persistence/search/test/AbstractSearchURITest.java", "diffHunk": "@@ -21,14 +21,16 @@\n \n /**\n  * <a href=\"https://hl7.org/fhir/r4/search.html#uri\">FHIR Specification: Search - uri</a>\n- * ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "12a1dfb4ac98b15cc053de2fd9455832f8326b0e"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY5Mzk5MjEx", "url": "https://github.com/IBM/FHIR/pull/1416#pullrequestreview-469399211", "createdAt": "2020-08-18T12:29:14Z", "commit": {"oid": "12a1dfb4ac98b15cc053de2fd9455832f8326b0e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOFQxMjoyOToxNFrOHCRICg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOFQxMjoyOToxNFrOHCRICg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjEzOTc4Ng==", "bodyText": "Copyright", "url": "https://github.com/IBM/FHIR/pull/1416#discussion_r472139786", "createdAt": "2020-08-18T12:29:14Z", "author": {"login": "prb112"}, "path": "fhir-persistence/src/test/java/com/ibm/fhir/persistence/search/test/AbstractSearchStringTest.java", "diffHunk": "@@ -26,103 +26,99 @@\n  */\n public abstract class AbstractSearchStringTest extends AbstractPLSearchTest {\n \n+    @Override", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "12a1dfb4ac98b15cc053de2fd9455832f8326b0e"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY5Mzk5OTM1", "url": "https://github.com/IBM/FHIR/pull/1416#pullrequestreview-469399935", "createdAt": "2020-08-18T12:29:33Z", "commit": {"oid": "12a1dfb4ac98b15cc053de2fd9455832f8326b0e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOFQxMjoyOTozM1rOHCRIww==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOFQxMjoyOTozM1rOHCRIww==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjEzOTk3MQ==", "bodyText": "Copyright", "url": "https://github.com/IBM/FHIR/pull/1416#discussion_r472139971", "createdAt": "2020-08-18T12:29:33Z", "author": {"login": "prb112"}, "path": "fhir-persistence/src/test/java/com/ibm/fhir/persistence/search/test/AbstractSearchReferenceTest.java", "diffHunk": "@@ -24,30 +24,32 @@\n  */\n public abstract class AbstractSearchReferenceTest extends AbstractPLSearchTest {\n \n+    @Override\n     protected Basic getBasicResource() throws Exception {\n         return TestUtil.readExampleResource(\"json/ibm/basic/BasicReference.json\");\n     }\n \n+    @Override\n     protected void setTenant() throws Exception {\n         FHIRRequestContext.get().setTenantId(\"reference\");\n     }\n \n     @Test\n     public void testSearchReference_Reference_relative() throws Exception {\n-        // Reference by id really only works when the system knows which resource type(s) \n+        // Reference by id really only works when the system knows which resource type(s)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "12a1dfb4ac98b15cc053de2fd9455832f8326b0e"}, "originalPosition": 17}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY5NDAyMDcy", "url": "https://github.com/IBM/FHIR/pull/1416#pullrequestreview-469402072", "createdAt": "2020-08-18T12:30:31Z", "commit": {"oid": "12a1dfb4ac98b15cc053de2fd9455832f8326b0e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOFQxMjozMDozMVrOHCRLHA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOFQxMjozMDozMVrOHCRLHA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjE0MDU3Mg==", "bodyText": "Copyright", "url": "https://github.com/IBM/FHIR/pull/1416#discussion_r472140572", "createdAt": "2020-08-18T12:30:31Z", "author": {"login": "prb112"}, "path": "fhir-persistence/src/test/java/com/ibm/fhir/persistence/search/test/AbstractSearchDateTest.java", "diffHunk": "@@ -26,22 +26,24 @@\n  * - Date</a> Tests\n  */\n public abstract class AbstractSearchDateTest extends AbstractPLSearchTest {\n+    @Override\n     protected Basic getBasicResource() throws Exception {\n         return TestUtil.readExampleResource(\"json/ibm/basic/BasicDate.json\");\n     }\n+    @Override", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "12a1dfb4ac98b15cc053de2fd9455832f8326b0e"}, "originalPosition": 8}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY5NDA1NjY0", "url": "https://github.com/IBM/FHIR/pull/1416#pullrequestreview-469405664", "createdAt": "2020-08-18T12:32:10Z", "commit": {"oid": "12a1dfb4ac98b15cc053de2fd9455832f8326b0e"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY5NDE5NzI5", "url": "https://github.com/IBM/FHIR/pull/1416#pullrequestreview-469419729", "createdAt": "2020-08-18T12:46:59Z", "commit": {"oid": "12a1dfb4ac98b15cc053de2fd9455832f8326b0e"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fd0a9e477d6b9cbcd8eb38650240450ff2c573d5", "author": {"user": {"login": "lmsurpre", "name": "Lee Surprenant"}}, "url": "https://github.com/IBM/FHIR/commit/fd0a9e477d6b9cbcd8eb38650240450ff2c573d5", "committedDate": "2020-08-18T12:51:43Z", "message": "update copyrights\n\nSigned-off-by: Lee Surprenant <lmsurpre@us.ibm.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "949e694f13e21ee21b1a9e88854b3e4c2bf5fb0f", "author": {"user": {"login": "lmsurpre", "name": "Lee Surprenant"}}, "url": "https://github.com/IBM/FHIR/commit/949e694f13e21ee21b1a9e88854b3e4c2bf5fb0f", "committedDate": "2020-08-18T12:50:17Z", "message": "update copyrights\n\nSigned-off-by: Lee Surprenant <lmsurpre@us.ibm.com>"}, "afterCommit": {"oid": "fd0a9e477d6b9cbcd8eb38650240450ff2c573d5", "author": {"user": {"login": "lmsurpre", "name": "Lee Surprenant"}}, "url": "https://github.com/IBM/FHIR/commit/fd0a9e477d6b9cbcd8eb38650240450ff2c573d5", "committedDate": "2020-08-18T12:51:43Z", "message": "update copyrights\n\nSigned-off-by: Lee Surprenant <lmsurpre@us.ibm.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY5NDg0Mzcz", "url": "https://github.com/IBM/FHIR/pull/1416#pullrequestreview-469484373", "createdAt": "2020-08-18T14:00:01Z", "commit": {"oid": "fd0a9e477d6b9cbcd8eb38650240450ff2c573d5"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1390, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}