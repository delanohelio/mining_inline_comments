{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY2ODUwNTI5", "number": 1411, "title": "issue #693 - Add language code validation and update resource examples", "bodyText": "Signed-off-by: Troy Biesterfeld tbieste@us.ibm.com\nThis change adds validation of language codes against BCP-47 during FHIR resource object construction. Most of the files changed are in fhir-example, which is due to changing language codes generated by fhir-examples-generator from random strings to valid BCP-47 codes.", "createdAt": "2020-08-12T15:34:34Z", "url": "https://github.com/IBM/FHIR/pull/1411", "merged": true, "mergeCommit": {"oid": "e00f246eb651f33a4530f03feaddd834c4a73fbf"}, "closed": true, "closedAt": "2020-08-13T20:07:58Z", "author": {"login": "tbieste"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc-NLp8gH2gAyNDY2ODUwNTI5OjM0NmQ1NjdlOWU4MmMxNmFkOTQ2NzE2YzNhY2E3ZjBjOTlhMDllMGI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc-lrc0AFqTQ2NzA4OTg0NQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "346d567e9e82c16ad946716c3aca7f0c99a09e0b", "author": {"user": {"login": "tbieste", "name": "Troy Biesterfeld"}}, "url": "https://github.com/IBM/FHIR/commit/346d567e9e82c16ad946716c3aca7f0c99a09e0b", "committedDate": "2020-08-12T15:30:53Z", "message": "issue #693 - Add language code validation and update resource examples\n\nSigned-off-by: Troy Biesterfeld <tbieste@us.ibm.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY2MDgxOTIw", "url": "https://github.com/IBM/FHIR/pull/1411#pullrequestreview-466081920", "createdAt": "2020-08-12T16:29:41Z", "commit": {"oid": "346d567e9e82c16ad946716c3aca7f0c99a09e0b"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMlQxNjoyOTo0MVrOG_pMng==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMlQxNjoyOTo0MVrOG_pMng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTM4ODQ0Ng==", "bodyText": "should check that the maxValueSet does not have concepts, and if it does, do not generate the value set syntax check", "url": "https://github.com/IBM/FHIR/pull/1411#discussion_r469388446", "createdAt": "2020-08-12T16:29:41Z", "author": {"login": "michaelwschroeder"}, "path": "fhir-tools/src/main/java/com/ibm/fhir/tools/CodeGenerator.java", "diffHunk": "@@ -1132,6 +1134,31 @@ private void generateClass(JsonObject structureDefinition, List<String> paths, C\n                 }\n             }\n \n+            // Handle code/coding/codeableconcept fields with required (or maxValueSet) binding to syntax-based value set\n+            for (JsonObject elementDefinition : elementDefinitions) {\n+                String basePath = elementDefinition.getJsonObject(\"base\").getString(\"path\");\n+                if (elementDefinition.getString(\"path\").equals(basePath)) {\n+                    String elementName = getElementName(elementDefinition, path);\n+                    String fieldName = getFieldName(elementName);\n+                    String fieldType = getFieldType(structureDefinition, elementDefinition, false);\n+                    if (\"Code\".equals(fieldType) || \"Coding\".equals(fieldType) || \"CodeableConcept\".equals(fieldType)) {\n+                        JsonObject binding = getBinding(elementDefinition);\n+                        if (binding != null && binding.containsKey(\"valueSet\") && binding.containsKey(\"strength\")) {\n+                            String valueSet = binding.getString(\"valueSet\").split(\"\\\\|\")[0];\n+                            if (!\"required\".equals(binding.getString(\"strength\")) || hasConcepts(valueSet)) {\n+                                valueSet = getMaxValueSet(binding);\n+                                valueSet = (valueSet != null) ? valueSet.split(\"\\\\|\")[0] : valueSet;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "346d567e9e82c16ad946716c3aca7f0c99a09e0b"}, "originalPosition": 26}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e12194a144520db96314113b3bbd39f39b14c1f1", "author": {"user": {"login": "tbieste", "name": "Troy Biesterfeld"}}, "url": "https://github.com/IBM/FHIR/commit/e12194a144520db96314113b3bbd39f39b14c1f1", "committedDate": "2020-08-12T16:36:32Z", "message": "issue #693 - Updates after code review\n\nSigned-off-by: Troy Biesterfeld <tbieste@us.ibm.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY2OTE2MTk5", "url": "https://github.com/IBM/FHIR/pull/1411#pullrequestreview-466916199", "createdAt": "2020-08-13T16:17:34Z", "commit": {"oid": "e12194a144520db96314113b3bbd39f39b14c1f1"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QxNjoxNzozNFrOHASwog==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QxNjoxNzozNFrOHASwog==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDA2OTQxMA==", "bodyText": "pretty minor, but you could consider making \"en-US\" a constant since its used 3 times here...or potentially even make the Code.of(\"en-US\") the constant and re-use it", "url": "https://github.com/IBM/FHIR/pull/1411#discussion_r470069410", "createdAt": "2020-08-13T16:17:34Z", "author": {"login": "lmsurpre"}, "path": "fhir-examples-generator/src/main/java/com/ibm/fhir/examples/CompleteMockDataCreator.java", "diffHunk": "@@ -186,8 +197,27 @@ public CompleteMockDataCreator() throws IOException {\n                     /////////////////\n                     // Special values\n                     /////////////////\n+                    // Must be a valid BCP-47 code (Code)\n+                    if ((builder instanceof Attachment.Builder && \"language\".equals(method.getName()))\n+                            || (builder instanceof CodeSystem.Concept.Designation.Builder && \"language\".equals(method.getName()))\n+                            || (builder instanceof Resource.Builder && \"language\".equals(method.getName()))\n+                            || (builder instanceof ValueSet.Compose.Include.Concept.Designation.Builder && \"language\".equals(method.getName()))) {\n+                        argument = Code.of(\"en-US\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e12194a144520db96314113b3bbd39f39b14c1f1"}, "originalPosition": 57}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY2OTE2NTgy", "url": "https://github.com/IBM/FHIR/pull/1411#pullrequestreview-466916582", "createdAt": "2020-08-13T16:18:04Z", "commit": {"oid": "e12194a144520db96314113b3bbd39f39b14c1f1"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QxNjoxODowNFrOHASxuA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QxNjoxODowNFrOHASxuA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDA2OTY4OA==", "bodyText": "\ud83e\udd47", "url": "https://github.com/IBM/FHIR/pull/1411#discussion_r470069688", "createdAt": "2020-08-13T16:18:04Z", "author": {"login": "lmsurpre"}, "path": "fhir-examples-generator/src/main/java/com/ibm/fhir/examples/plugin/ExamplesPlugin.java", "diffHunk": "@@ -62,7 +62,7 @@ public void execute() throws MojoExecutionException, MojoFailureException {\n         String definitionsDir = baseDir + \"/definitions\";\n \n         // Only runs for the fhir-model project, short-circuits otherwise.\n-        if (mavenProject.getArtifactId().contains(\"fhir-model\")) {\n+        if (mavenProject.getArtifactId().contains(\"fhir-examples-generator\")) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e12194a144520db96314113b3bbd39f39b14c1f1"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY2OTE3Njkw", "url": "https://github.com/IBM/FHIR/pull/1411#pullrequestreview-466917690", "createdAt": "2020-08-13T16:19:34Z", "commit": {"oid": "e12194a144520db96314113b3bbd39f39b14c1f1"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4b27573e0c65e8eb2c8d09acc7be4f7330683693", "author": {"user": {"login": "tbieste", "name": "Troy Biesterfeld"}}, "url": "https://github.com/IBM/FHIR/commit/4b27573e0c65e8eb2c8d09acc7be4f7330683693", "committedDate": "2020-08-13T16:27:38Z", "message": "issue #693 - Updates after code review\n\nSigned-off-by: Troy Biesterfeld <tbieste@us.ibm.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY3MDg5ODQ1", "url": "https://github.com/IBM/FHIR/pull/1411#pullrequestreview-467089845", "createdAt": "2020-08-13T20:03:20Z", "commit": {"oid": "4b27573e0c65e8eb2c8d09acc7be4f7330683693"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1384, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}