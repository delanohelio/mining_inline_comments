{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM1NDAyNjM5", "number": 1234, "title": "Issue 876 - Postgres SQL Automation", "bodyText": "Issue 876 - Postgres SQL Automation", "createdAt": "2020-06-16T18:44:02Z", "url": "https://github.com/IBM/FHIR/pull/1234", "merged": true, "mergeCommit": {"oid": "3665893d826aa75e6a9d0e61d440bcc0ede942ad"}, "closed": true, "closedAt": "2020-06-23T14:10:17Z", "author": {"login": "prb112"}, "timelineItems": {"totalCount": 21, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcrhCdpgH2gAyNDM1NDAyNjM5OmFjYTlkNWVkMGViMmQzYjhjYzZmZGNiYmJkZWQwY2JmNjM1MDBiMTc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcuFu5igFqTQzNTc5OTY3Mg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "aca9d5ed0eb2d3b8cc6fdcbbbded0cbf63500b17", "author": {"user": {"login": "prb112", "name": "Paul Bastide"}}, "url": "https://github.com/IBM/FHIR/commit/aca9d5ed0eb2d3b8cc6fdcbbbded0cbf63500b17", "committedDate": "2020-06-15T13:54:23Z", "message": "Merge pull request #16 from IBM/master\n\nSync up"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "71225ccfc46d64ecebc31409c48c1997f8ef833d", "author": {"user": {"login": "prb112", "name": "Paul Bastide"}}, "url": "https://github.com/IBM/FHIR/commit/71225ccfc46d64ecebc31409c48c1997f8ef833d", "committedDate": "2020-06-16T17:46:29Z", "message": "Merge pull request #17 from IBM/master\n\nMerge"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1286af4c03262cbf500701f6c8fbdba8e0c77fa6", "author": {"user": {"login": "prb112", "name": "Paul Bastide"}}, "url": "https://github.com/IBM/FHIR/commit/1286af4c03262cbf500701f6c8fbdba8e0c77fa6", "committedDate": "2020-06-16T18:45:26Z", "message": "Issue 876b (#19)\n\n* Introduce Persistence Layer Automation Framework #876\n\nSigned-off-by: Paul Bastide <pbastide@us.ibm.com>\n\n* Postgres SQL Automation\n\nSigned-off-by: Paul Bastide <pbastide@us.ibm.com>\n\n* Fix Files\n\nSigned-off-by: Paul Bastide <pbastide@us.ibm.com>\n\n* Fix Files\n\nSigned-off-by: Paul Bastide <pbastide@us.ibm.com>\n\n* Fix Files\n\nSigned-off-by: Paul Bastide <pbastide@us.ibm.com>\n\n* Fix\n\nSigned-off-by: Paul Bastide <pbastide@us.ibm.com>\n\n* Fix\n\nSigned-off-by: Paul Bastide <pbastide@us.ibm.com>\n\n* Update\n\nSigned-off-by: Paul Bastide <pbastide@us.ibm.com>\n\n* Update\n\nSigned-off-by: Paul Bastide <pbastide@us.ibm.com>\n\n* Update\n\nSigned-off-by: Paul Bastide <pbastide@us.ibm.com>\n\n* fix\n\nSigned-off-by: Paul Bastide <pbastide@us.ibm.com>\n\n* Fix\n\nSigned-off-by: Paul Bastide <pbastide@us.ibm.com>\n\n* Fix\n\nSigned-off-by: Paul Bastide <pbastide@us.ibm.com>\n\n* Fix\n\nSigned-off-by: Paul Bastide <pbastide@us.ibm.com>\n\n* Fix\n\nSigned-off-by: Paul Bastide <pbastide@us.ibm.com>\n\n* Fix\n\nSigned-off-by: Paul Bastide <pbastide@us.ibm.com>\n\n* Fix\n\nSigned-off-by: Paul Bastide <pbastide@us.ibm.com>\n\n* Fixup\n\nSigned-off-by: Paul Bastide <pbastide@us.ibm.com>\n\n* Fixup\n\nSigned-off-by: Paul Bastide <pbastide@us.ibm.com>\n\n* Fixup\n\nSigned-off-by: Paul Bastide <pbastide@us.ibm.com>\n\n* Fixup\n\nSigned-off-by: Paul Bastide <pbastide@us.ibm.com>\n\n* Fix\n\nSigned-off-by: Paul Bastide <pbastide@us.ibm.com>\n\n* Postgres Fix\n\nSigned-off-by: Paul Bastide <pbastide@us.ibm.com>\n\n* Postgres Fix\n\nSigned-off-by: Paul Bastide <pbastide@us.ibm.com>\n\n* Update postgres\n\nSigned-off-by: Paul Bastide <pbastide@us.ibm.com>\n\n* Update postgres\n\nSigned-off-by: Paul Bastide <pbastide@us.ibm.com>\n\n* Fix for Postgres Build\n\nSigned-off-by: Paul Bastide <pbastide@us.ibm.com>\n\n* Fix for multistore\n\nSigned-off-by: Paul Bastide <pbastide@us.ibm.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMxODMxNjA4", "url": "https://github.com/IBM/FHIR/pull/1234#pullrequestreview-431831608", "createdAt": "2020-06-16T19:36:25Z", "commit": {"oid": "1286af4c03262cbf500701f6c8fbdba8e0c77fa6"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMxODM0OTcz", "url": "https://github.com/IBM/FHIR/pull/1234#pullrequestreview-431834973", "createdAt": "2020-06-16T19:41:33Z", "commit": {"oid": "1286af4c03262cbf500701f6c8fbdba8e0c77fa6"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQxOTo0MTozM1rOGkqfSg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQxOTo0MTozM1rOGkqfSg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTA5ODA1OA==", "bodyText": "no?\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            |bin/gather-logs.sh|Gathers the logs for the build, no|\n          \n          \n            \n            |bin/gather-logs.sh|Gathers the logs from the build|", "url": "https://github.com/IBM/FHIR/pull/1234#discussion_r441098058", "createdAt": "2020-06-16T19:41:33Z", "author": {"login": "lmsurpre"}, "path": "build/persistence/README.md", "diffHunk": "@@ -0,0 +1,51 @@\n+# End-to-End Automation Framework for Pesistence Layer Integration Tests\n+\n+This document outlines the end-to-end persistence automation framework. \n+\n+The automation runs with these steps: \n+\n+- **Checkout source code** - Checks out the git code and populates the `github` environment variables.\n+- **Set up java** - Downloads and setup java based on the matrix values `matrix.java`.\n+- **Setup prerequisites** - This step builds the required artifacts necessary to test the build with the persistence layer. \n+- **Server Integration Tests - Additional Persistence Layers** - The step executes the pre-integration-docker, then integration-test-docker and runs the post-integration-docker scripts.\n+- **Gather error logs** - This step only runs upon an error condition. \n+- **Upload logs** - The step uploads the results of the integration tests and the error condition logs are posted to the job. \n+\n+The GitHub Action is parameterized with a matrix for each new persistence layer added. Each additional entry in the array ends up greating a multiple of the automation steps which must complete successfully for the workflow. For instance, postgres is parameterized and executes a job for each persistence layer value in the matrix (one java x one persistence = 1 workflow job). \n+\n+``` yaml\n+    strategy:\n+    matrix:\n+        java: [ 'openjdk11' ]\n+        persistence: [ 'postgres' ]\n+    fail-fast: false\n+```\n+\n+Each persistence layer that is tested as part of the framework uses the default build files and the files that match the persistence name added to the `persistence.yml`.\n+\n+|Filename|Purpose|\n+|----------|----------------|\n+|bin/gather-logs.sh|Gathers the logs for the build, no|", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1286af4c03262cbf500701f6c8fbdba8e0c77fa6"}, "originalPosition": 28}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMxODQ0ODkw", "url": "https://github.com/IBM/FHIR/pull/1234#pullrequestreview-431844890", "createdAt": "2020-06-16T19:56:20Z", "commit": {"oid": "1286af4c03262cbf500701f6c8fbdba8e0c77fa6"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQxOTo1NjoyMFrOGkq96Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQxOTo1NjoyMFrOGkq96Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTEwNTg5Nw==", "bodyText": "as per albert's comment, this doesn't seem to match the user created in build/persistence/postgres/resources/db.sql ...how does it work?", "url": "https://github.com/IBM/FHIR/pull/1234#discussion_r441105897", "createdAt": "2020-06-16T19:56:20Z", "author": {"login": "lmsurpre"}, "path": "fhir-server/liberty-config/config/default/fhir-server-config-postgresql.json", "diffHunk": "@@ -30,10 +30,10 @@\n                 \"default\": {\n                     \"type\": \"postgresql\",\n                     \"connectionProperties\": {\n-                        \"serverName\": \"localhost\",\n+                        \"serverName\": \"postgres_postgres_1\",\n                         \"portNumber\": 5432,\n-                        \"databaseName\": \"fhirdata\",\n-                        \"user\": \"fhirserver\",\n+                        \"databaseName\": \"fhirdb\",\n+                        \"user\": \"fhiradmin\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1286af4c03262cbf500701f6c8fbdba8e0c77fa6"}, "originalPosition": 10}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMxODQ4MTQ3", "url": "https://github.com/IBM/FHIR/pull/1234#pullrequestreview-431848147", "createdAt": "2020-06-16T20:00:52Z", "commit": {"oid": "1286af4c03262cbf500701f6c8fbdba8e0c77fa6"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQyMDowMDo1M1rOGkrHdw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQyMDowMDo1M1rOGkrHdw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTEwODM0Mw==", "bodyText": "does this set a password?", "url": "https://github.com/IBM/FHIR/pull/1234#discussion_r441108343", "createdAt": "2020-06-16T20:00:53Z", "author": {"login": "lmsurpre"}, "path": "build/persistence/postgres/Dockerfile", "diffHunk": "@@ -0,0 +1,32 @@\n+###############################################################################\n+# (C) Copyright IBM Corp. 2020\n+#\n+# SPDX-License-Identifier: Apache-2.0\n+###############################################################################\n+\n+FROM postgres:12.3-alpine\n+\n+# Hard Coded environment values\n+ENV POSTGRES_DB fhirdb\n+ENV POSTGRES_USER postgres\n+ENV PGDATA /db/data\n+ENV LANG en_US.utf8\n+\n+# Create a working data directory\n+RUN mkdir -p /db/data && chown -R postgres:postgres /db\n+VOLUME /db/data\n+WORKDIR /db\n+\n+# Open up the port\n+EXPOSE 5432\n+\n+# Load Build Information\n+COPY --chown=postgres:postgres resources/db.sql /docker-entrypoint-initdb.d/db.sql\n+COPY --chown=postgres:postgres resources/docker-entrypoint.sh /docker-entrypoint.sh\n+RUN chmod 755 /docker-entrypoint.sh\n+\n+# Add the fhiradmin user\n+RUN addgroup -S fhir && adduser -S fhiradmin -G fhir\n+RUN echo \"fhiradmin:fhir\" | chpasswd", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1286af4c03262cbf500701f6c8fbdba8e0c77fa6"}, "originalPosition": 30}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "03e91c2b9c956446d021d871f99d90592b5692f6", "author": {"user": {"login": "prb112", "name": "Paul Bastide"}}, "url": "https://github.com/IBM/FHIR/commit/03e91c2b9c956446d021d871f99d90592b5692f6", "committedDate": "2020-06-17T20:07:06Z", "message": "Apply suggestions from code review\n\nSigned-off-by: Paul Bastide <pbastide@us.ibm.com>\n\nCo-authored-by: Lee Surprenant <lmsurpre@us.ibm.com>\nSigned-off-by: Paul Bastide <pbastide@us.ibm.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1c11c5377120054b343559e3f9ab476e5e57b1c6", "author": {"user": {"login": "prb112", "name": "Paul Bastide"}}, "url": "https://github.com/IBM/FHIR/commit/1c11c5377120054b343559e3f9ab476e5e57b1c6", "committedDate": "2020-06-17T20:12:57Z", "message": "Fix up per code-review\n\nSigned-off-by: Paul Bastide <pbastide@us.ibm.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "57dc8ff6d0d37c8384887e2461dbec1c978c35c5", "author": {"user": {"login": "prb112", "name": "Paul Bastide"}}, "url": "https://github.com/IBM/FHIR/commit/57dc8ff6d0d37c8384887e2461dbec1c978c35c5", "committedDate": "2020-06-17T20:24:46Z", "message": "Fix up per code-review\n\nSigned-off-by: Paul Bastide <pbastide@us.ibm.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9e16a6d59c805b08a160f8d4c91ec883a0850470", "author": {"user": {"login": "prb112", "name": "Paul Bastide"}}, "url": "https://github.com/IBM/FHIR/commit/9e16a6d59c805b08a160f8d4c91ec883a0850470", "committedDate": "2020-06-17T23:37:40Z", "message": "Fix up per code-review\n\nSigned-off-by: Paul Bastide <pbastide@us.ibm.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fc3412605df060ae990e24d60b6163775cd4502d", "author": {"user": {"login": "prb112", "name": "Paul Bastide"}}, "url": "https://github.com/IBM/FHIR/commit/fc3412605df060ae990e24d60b6163775cd4502d", "committedDate": "2020-06-18T00:09:41Z", "message": "Fix up per code-review\n\nSigned-off-by: Paul Bastide <pbastide@us.ibm.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e9ccdac2d1a546a82ec3a55ec60352c773a604fe", "author": {"user": {"login": "prb112", "name": "Paul Bastide"}}, "url": "https://github.com/IBM/FHIR/commit/e9ccdac2d1a546a82ec3a55ec60352c773a604fe", "committedDate": "2020-06-18T00:55:11Z", "message": "Fix up per code-review\n\nSigned-off-by: Paul Bastide <pbastide@us.ibm.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "aba7a71f77404ea77beb3db649f87e8eec7e201e", "author": {"user": {"login": "prb112", "name": "Paul Bastide"}}, "url": "https://github.com/IBM/FHIR/commit/aba7a71f77404ea77beb3db649f87e8eec7e201e", "committedDate": "2020-06-19T17:51:03Z", "message": "Fix per code review\n\nSigned-off-by: Paul Bastide <pbastide@us.ibm.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cac1fdfce5ffcf0e6c1a863cc4ce9f4f25a6f85d", "author": {"user": {"login": "prb112", "name": "Paul Bastide"}}, "url": "https://github.com/IBM/FHIR/commit/cac1fdfce5ffcf0e6c1a863cc4ce9f4f25a6f85d", "committedDate": "2020-06-19T18:59:56Z", "message": "Fix\n\nSigned-off-by: Paul Bastide <pbastide@us.ibm.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a189c7d5ef954c707e04d2e33f302fc505478c59", "author": {"user": {"login": "prb112", "name": "Paul Bastide"}}, "url": "https://github.com/IBM/FHIR/commit/a189c7d5ef954c707e04d2e33f302fc505478c59", "committedDate": "2020-06-20T00:20:12Z", "message": "Fix\n\nSigned-off-by: Paul Bastide <pbastide@us.ibm.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM0Mzk1ODYy", "url": "https://github.com/IBM/FHIR/pull/1234#pullrequestreview-434395862", "createdAt": "2020-06-20T02:24:04Z", "commit": {"oid": "a189c7d5ef954c707e04d2e33f302fc505478c59"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMFQwMjoyNDowNVrOGmkRZQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMFQwMjoyNDowNVrOGmkRZQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzA5MzM0OQ==", "bodyText": "should \"persistence\" be \"<persistence>\" (or similar) to indicate that its a placeholder for a specific persistence impl (postgres in this case)?", "url": "https://github.com/IBM/FHIR/pull/1234#discussion_r443093349", "createdAt": "2020-06-20T02:24:05Z", "author": {"login": "lmsurpre"}, "path": "build/persistence/README.md", "diffHunk": "@@ -0,0 +1,51 @@\n+# End-to-End Automation Framework for Pesistence Layer Integration Tests\n+\n+This document outlines the end-to-end persistence automation framework. \n+\n+The automation runs with these steps: \n+\n+- **Checkout source code** - Checks out the git code and populates the `github` environment variables.\n+- **Set up java** - Downloads and setup java based on the matrix values `matrix.java`.\n+- **Setup prerequisites** - This step builds the required artifacts necessary to test the build with the persistence layer. \n+- **Server Integration Tests - Additional Persistence Layers** - The step executes the pre-integration-docker, then integration-test-docker and runs the post-integration-docker scripts.\n+- **Gather error logs** - This step only runs upon an error condition. \n+- **Upload logs** - The step uploads the results of the integration tests and the error condition logs are posted to the job. \n+\n+The GitHub Action is parameterized with a matrix for each new persistence layer added. Each additional entry in the array ends up greating a multiple of the automation steps which must complete successfully for the workflow. For instance, postgres is parameterized and executes a job for each persistence layer value in the matrix (one java x one persistence = 1 workflow job). \n+\n+``` yaml\n+    strategy:\n+    matrix:\n+        java: [ 'openjdk11' ]\n+        persistence: [ 'postgres' ]\n+    fail-fast: false\n+```\n+\n+Each persistence layer that is tested as part of the framework uses the default build files and the files that match the persistence name added to the `persistence.yml`.\n+\n+|Filename|Purpose|\n+|----------|----------------|\n+|bin/gather-logs.sh|Gathers the logs from the build|\n+|bin/integration-test.sh|Run after the tests complete to release resources and package tests results|\n+|persistence/integration-test.sh|Overrides bin/integration-test.sh, replacing the prior test behavior.|\n+|bin/pre-integration-test.sh|Call the pre-integration-test step for `persistence`|\n+|persistence/pre-integration-test.sh|Run before integration-test.sh to startup image and services for the integration testing|\n+|bin/post-integration-test.sh|Call the post-integration-test step for `persistence`|\n+|persistence/post-integration-test.sh|Run after integration-test.sh to stop image and services from the integration testing|\n+|persistence/Dockerfile|The Docker file used in development and end-to-end tests|\n+|persistence/docker-compose.yml|The Docker Compose file used with the end-to-end tests|\n+|persistence/resources| Stores files used to support the end-to-end tests. |\n+|persistence/README.md|Describes the relevant details for this persistence layer.|\n+|persistence/.gitignore|Ignores files related to the persistence layer's tests|\n+|`README.md`|This file describing the framework|", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a189c7d5ef954c707e04d2e33f302fc505478c59"}, "originalPosition": 40}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3a5749f86c0b3a2f658b3bf3ec0ad58b86fb2840", "author": {"user": {"login": "prb112", "name": "Paul Bastide"}}, "url": "https://github.com/IBM/FHIR/commit/3a5749f86c0b3a2f658b3bf3ec0ad58b86fb2840", "committedDate": "2020-06-22T14:59:16Z", "message": "Fix per review\n\nSigned-off-by: Paul Bastide <pbastide@us.ibm.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "28a30a319894b36f232d3380d53110779a34dc10", "author": {"user": {"login": "prb112", "name": "Paul Bastide"}}, "url": "https://github.com/IBM/FHIR/commit/28a30a319894b36f232d3380d53110779a34dc10", "committedDate": "2020-06-23T13:38:33Z", "message": "Add Ci-Skip Flag\n\nSigned-off-by: Paul Bastide <pbastide@us.ibm.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e376c0a1f56c82765e0030122804eed14f944af5", "author": {"user": {"login": "prb112", "name": "Paul Bastide"}}, "url": "https://github.com/IBM/FHIR/commit/e376c0a1f56c82765e0030122804eed14f944af5", "committedDate": "2020-06-23T13:45:45Z", "message": "Fix Readme.md\n\nSigned-off-by: Paul Bastide <pbastide@us.ibm.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM1Nzk5Njcy", "url": "https://github.com/IBM/FHIR/pull/1234#pullrequestreview-435799672", "createdAt": "2020-06-23T13:47:21Z", "commit": {"oid": "e376c0a1f56c82765e0030122804eed14f944af5"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 281, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}