{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDEyMTc3NTIy", "number": 1010, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wMVQxNjo1NTo1N1rOD4a9jg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wMVQxODowNTo1NFrOD4cNQg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYwNDg4NTkwOnYy", "diffSide": "RIGHT", "path": "fhir-database-utils/src/main/java/com/ibm/fhir/database/utils/common/CommonDatabaseAdapter.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wMVQxNjo1NTo1N1rOGPPOoA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wMVQxODowOToxOFrOGPRTRw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODYzMTMyOA==", "bodyText": "why 20000 and not 10000?", "url": "https://github.com/IBM/FHIR/pull/1010#discussion_r418631328", "createdAt": "2020-05-01T16:55:57Z", "author": {"login": "lmsurpre"}, "path": "fhir-database-utils/src/main/java/com/ibm/fhir/database/utils/common/CommonDatabaseAdapter.java", "diffHunk": "@@ -424,14 +424,14 @@ public void runStatement(IDatabaseStatement stmt) {\n     public void createSequence(String schemaName, String sequenceName, int cache) {\n         /*\n          * <CODE>CREATE SEQUENCE fhir_sequence\n-             AS BIGINT\n-     START WITH 1000\n-          CACHE 1000\n-       NO CYCLE;</CODE>\n-    */\n+         * AS BIGINT\n+         * START WITH 20000", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a4cf8c634be0f89045c9ef514106a4a45a96532a"}, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODY2Mjk3Mw==", "bodyText": "plenty of space then, for any expansions we need based on sequences", "url": "https://github.com/IBM/FHIR/pull/1010#discussion_r418662973", "createdAt": "2020-05-01T18:04:00Z", "author": {"login": "prb112"}, "path": "fhir-database-utils/src/main/java/com/ibm/fhir/database/utils/common/CommonDatabaseAdapter.java", "diffHunk": "@@ -424,14 +424,14 @@ public void runStatement(IDatabaseStatement stmt) {\n     public void createSequence(String schemaName, String sequenceName, int cache) {\n         /*\n          * <CODE>CREATE SEQUENCE fhir_sequence\n-             AS BIGINT\n-     START WITH 1000\n-          CACHE 1000\n-       NO CYCLE;</CODE>\n-    */\n+         * AS BIGINT\n+         * START WITH 20000", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODYzMTMyOA=="}, "originalCommit": {"oid": "a4cf8c634be0f89045c9ef514106a4a45a96532a"}, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODY2NTI4Nw==", "bodyText": "ok, was just curious", "url": "https://github.com/IBM/FHIR/pull/1010#discussion_r418665287", "createdAt": "2020-05-01T18:09:18Z", "author": {"login": "lmsurpre"}, "path": "fhir-database-utils/src/main/java/com/ibm/fhir/database/utils/common/CommonDatabaseAdapter.java", "diffHunk": "@@ -424,14 +424,14 @@ public void runStatement(IDatabaseStatement stmt) {\n     public void createSequence(String schemaName, String sequenceName, int cache) {\n         /*\n          * <CODE>CREATE SEQUENCE fhir_sequence\n-             AS BIGINT\n-     START WITH 1000\n-          CACHE 1000\n-       NO CYCLE;</CODE>\n-    */\n+         * AS BIGINT\n+         * START WITH 20000", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODYzMTMyOA=="}, "originalCommit": {"oid": "a4cf8c634be0f89045c9ef514106a4a45a96532a"}, "originalPosition": 10}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYwNTAyODE2OnYy", "diffSide": "LEFT", "path": "fhir-persistence-schema/src/main/java/com/ibm/fhir/schema/app/Main.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wMVQxNzo0NTowMFrOGPQnRw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wMVQxODowNTowN1rOGPRMLA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODY1NDAyMw==", "bodyText": "I guess this wasn't so important, after all?", "url": "https://github.com/IBM/FHIR/pull/1010#discussion_r418654023", "createdAt": "2020-05-01T17:45:00Z", "author": {"login": "lmsurpre"}, "path": "fhir-persistence-schema/src/main/java/com/ibm/fhir/schema/app/Main.java", "diffHunk": "@@ -1045,21 +1035,30 @@ protected void allocateTenant() {\n     }\n \n     /**\n-     * Populate all the static tables we need\n-     *\n-     * @param gen\n-     * @param tenantKey\n+     * populates for the given tenantId the RESOURCE_TYPE table.\n+     * \n+     * @implNote if you update this method, be sure to update\n+     *           DerbyBootstrapper.populateResourceTypeAndParameterNameTableEntries\n+     *           and DerbyFhirDatabase.populateResourceTypeAndParameterNameTableEntries\n+     *           The reason is there are three different ways of managing the transaction.\n+     * @param tenantId the mt_id that is used to setup the partition.\n+     *                 passing in null signals not multi-tenant.\n      */\n-    protected void populateStaticTables(FhirSchemaGenerator gen, String tenantKey) {\n-        IDatabaseAdapter adapter = getDbAdapter(connectionPool);\n+    protected void populateResourceTypeAndParameterNameTableEntries(Integer tenantId) {\n         try (ITransaction tx = TransactionFactory.openTransaction(connectionPool)) {\n-            try {\n-                // Very important. Establish the value of the session variable so that we\n-                // pass the row permission predicate\n-                Db2SetTenantVariable cmd = new Db2SetTenantVariable(adminSchemaName, tenantName, tenantKey);\n-                adapter.runStatement(cmd);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a4cf8c634be0f89045c9ef514106a4a45a96532a"}, "originalPosition": 78}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODY2MzQ2OA==", "bodyText": "Yes, since I removed the method", "url": "https://github.com/IBM/FHIR/pull/1010#discussion_r418663468", "createdAt": "2020-05-01T18:05:07Z", "author": {"login": "prb112"}, "path": "fhir-persistence-schema/src/main/java/com/ibm/fhir/schema/app/Main.java", "diffHunk": "@@ -1045,21 +1035,30 @@ protected void allocateTenant() {\n     }\n \n     /**\n-     * Populate all the static tables we need\n-     *\n-     * @param gen\n-     * @param tenantKey\n+     * populates for the given tenantId the RESOURCE_TYPE table.\n+     * \n+     * @implNote if you update this method, be sure to update\n+     *           DerbyBootstrapper.populateResourceTypeAndParameterNameTableEntries\n+     *           and DerbyFhirDatabase.populateResourceTypeAndParameterNameTableEntries\n+     *           The reason is there are three different ways of managing the transaction.\n+     * @param tenantId the mt_id that is used to setup the partition.\n+     *                 passing in null signals not multi-tenant.\n      */\n-    protected void populateStaticTables(FhirSchemaGenerator gen, String tenantKey) {\n-        IDatabaseAdapter adapter = getDbAdapter(connectionPool);\n+    protected void populateResourceTypeAndParameterNameTableEntries(Integer tenantId) {\n         try (ITransaction tx = TransactionFactory.openTransaction(connectionPool)) {\n-            try {\n-                // Very important. Establish the value of the session variable so that we\n-                // pass the row permission predicate\n-                Db2SetTenantVariable cmd = new Db2SetTenantVariable(adminSchemaName, tenantName, tenantKey);\n-                adapter.runStatement(cmd);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODY1NDAyMw=="}, "originalCommit": {"oid": "a4cf8c634be0f89045c9ef514106a4a45a96532a"}, "originalPosition": 78}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYwNTA4NzQzOnYy", "diffSide": "LEFT", "path": "fhir-persistence-schema/src/main/resources/add_parameter_name.sql", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wMVQxODowNDo1NFrOGPRL5Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wMVQxODowNToxNVrOGPRMYQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODY2MzM5Nw==", "bodyText": "yikes, this old description was awful", "url": "https://github.com/IBM/FHIR/pull/1010#discussion_r418663397", "createdAt": "2020-05-01T18:04:54Z", "author": {"login": "lmsurpre"}, "path": "fhir-persistence-schema/src/main/resources/add_parameter_name.sql", "diffHunk": "@@ -5,11 +5,7 @@\n -------------------------------------------------------------------------------\n \n -- ----------------------------------------------------------------------------\n--- Procedure to add a resource version and its associated parameters. These\n--- parameters only ever point to the latest version of a resource, never to\n--- previous versions, which are kept to support history queries.\n--- Parameters must be loaded into the parameters_gtt global temporary table\n--- prior to this procedure being called", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a4cf8c634be0f89045c9ef514106a4a45a96532a"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODY2MzUyMQ==", "bodyText": "very inaccurate", "url": "https://github.com/IBM/FHIR/pull/1010#discussion_r418663521", "createdAt": "2020-05-01T18:05:15Z", "author": {"login": "prb112"}, "path": "fhir-persistence-schema/src/main/resources/add_parameter_name.sql", "diffHunk": "@@ -5,11 +5,7 @@\n -------------------------------------------------------------------------------\n \n -- ----------------------------------------------------------------------------\n--- Procedure to add a resource version and its associated parameters. These\n--- parameters only ever point to the latest version of a resource, never to\n--- previous versions, which are kept to support history queries.\n--- Parameters must be loaded into the parameters_gtt global temporary table\n--- prior to this procedure being called", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODY2MzM5Nw=="}, "originalCommit": {"oid": "a4cf8c634be0f89045c9ef514106a4a45a96532a"}, "originalPosition": 8}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYwNTA4OTk0OnYy", "diffSide": "RIGHT", "path": "fhir-persistence-schema/src/main/resources/parameter_names.properties", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wMVQxODowNTo1NFrOGPRNfg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wMVQxODowNTo1NFrOGPRNfg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODY2MzgwNg==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            # This class maintains a version agnostic mapping and ordering of resources to LOGICAL_IDs. \n          \n          \n            \n            # This file maintains a version agnostic mapping and ordering of parameter names (codes)\n          \n          \n            \n            # to identifiers for pre-populating the PARAMETER_NAMES table.", "url": "https://github.com/IBM/FHIR/pull/1010#discussion_r418663806", "createdAt": "2020-05-01T18:05:54Z", "author": {"login": "lmsurpre"}, "path": "fhir-persistence-schema/src/main/resources/parameter_names.properties", "diffHunk": "@@ -0,0 +1,453 @@\n+# This class maintains a version agnostic mapping and ordering of resources to LOGICAL_IDs. ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a4cf8c634be0f89045c9ef514106a4a45a96532a"}, "originalPosition": 1}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 31, "cost": 1, "resetAt": "2021-11-12T20:44:06Z"}}}