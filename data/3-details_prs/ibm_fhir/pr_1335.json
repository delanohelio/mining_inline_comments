{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDUwNDY5MjI5", "number": 1335, "title": "Issue #1327 Improve execution plans for search", "bodyText": "", "createdAt": "2020-07-16T19:57:17Z", "url": "https://github.com/IBM/FHIR/pull/1335", "merged": true, "mergeCommit": {"oid": "6e2a54a5b0ca97aa5983128dae7f472a04e4d2f4"}, "closed": true, "closedAt": "2020-07-16T20:44:46Z", "author": {"login": "punktilious"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc1j35aAH2gAyNDUwNDY5MjI5OjIzMGI1ZGZmMTY3NTQzNTI4OWZiOTkzOTg3N2Y1MDhlOWExNTc1MGI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc1lcmuAFqTQ1MDIwMDYwNA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "230b5dff1675435289fb9939877f508e9a15750b", "author": {"user": {"login": "punktilious", "name": "Robin Arnold"}}, "url": "https://github.com/IBM/FHIR/commit/230b5dff1675435289fb9939877f508e9a15750b", "committedDate": "2020-07-16T18:51:48Z", "message": "issue #1327 replace EXISTS with top level DISTINCT for better search execution plans\n\nSigned-off-by: Robin Arnold <robin.arnold23@ibm.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cfa1bc1df851224a02440b8b9fb2d01b5242a718", "author": {"user": {"login": "punktilious", "name": "Robin Arnold"}}, "url": "https://github.com/IBM/FHIR/commit/cfa1bc1df851224a02440b8b9fb2d01b5242a718", "committedDate": "2020-07-16T18:54:01Z", "message": "Merge remote-tracking branch 'origin/master' into issue-1327b"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cf852a9a056465d8f61412388e108c02d75125eb", "author": {"user": {"login": "punktilious", "name": "Robin Arnold"}}, "url": "https://github.com/IBM/FHIR/commit/cf852a9a056465d8f61412388e108c02d75125eb", "committedDate": "2020-07-16T19:53:52Z", "message": "issue #1327 reordered LR and R joins in system search to match parameter order\n\nSigned-off-by: Robin Arnold <robin.arnold23@ibm.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUwMTczNDI5", "url": "https://github.com/IBM/FHIR/pull/1335#pullrequestreview-450173429", "createdAt": "2020-07-16T20:00:19Z", "commit": {"oid": "cf852a9a056465d8f61412388e108c02d75125eb"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNlQyMDowMDoxOVrOGy6sTA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNlQyMDowMDoxOVrOGy6sTA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjA0MzU5Ng==", "bodyText": "I'm ok with it left there, probably should wrap in is loggable fine and log.fine", "url": "https://github.com/IBM/FHIR/pull/1335#discussion_r456043596", "createdAt": "2020-07-16T20:00:19Z", "author": {"login": "prb112"}, "path": "fhir-persistence-jdbc/src/main/java/com/ibm/fhir/persistence/jdbc/util/JDBCQueryBuilder.java", "diffHunk": "@@ -648,8 +648,13 @@ protected SqlQueryData processChainedReferenceParm(QueryParameter queryParm) thr\n             } else {\n                 // This logic processes the LAST parameter in the chain.\n                 // Build this piece: CPx.PARAMETER_NAME_ID = x AND CPx.STR_VALUE = ?\n+                if (chainedParmVar == null) {\n+                    chainedParmVar            = CP + 1;\n+                }\n                 Class<?> chainedResourceType = ModelSupport.getResourceType(resourceTypeName);\n                 SqlQueryData sqlQueryData = buildQueryParm(chainedResourceType, currentParm, chainedParmVar);\n+\n+                // log.info(\"chained sqlQueryData[\" + chainedParmVar + \"] = \" + sqlQueryData.getQueryString());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cf852a9a056465d8f61412388e108c02d75125eb"}, "originalPosition": 28}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUwMTczODE5", "url": "https://github.com/IBM/FHIR/pull/1335#pullrequestreview-450173819", "createdAt": "2020-07-16T20:00:55Z", "commit": {"oid": "cf852a9a056465d8f61412388e108c02d75125eb"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNlQyMDowMDo1NVrOGy6thg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNlQyMDowMDo1NVrOGy6thg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjA0MzkxMA==", "bodyText": "Copyright 2019", "url": "https://github.com/IBM/FHIR/pull/1335#discussion_r456043910", "createdAt": "2020-07-16T20:00:55Z", "author": {"login": "prb112"}, "path": "fhir-persistence-jdbc/src/main/java/com/ibm/fhir/persistence/jdbc/util/type/LocationParmBehaviorUtil.java", "diffHunk": "@@ -46,7 +46,7 @@ public LocationParmBehaviorUtil() {\n      * @param boundingAreas\n      */\n     public void buildLocationSearchQuery(String populateNameIdSubSegment, StringBuilder whereClauseSegment,\n-            List<Object> bindVariables, List<Bounding> boundingAreas) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cf852a9a056465d8f61412388e108c02d75125eb"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUwMTc0MDc2", "url": "https://github.com/IBM/FHIR/pull/1335#pullrequestreview-450174076", "createdAt": "2020-07-16T20:01:19Z", "commit": {"oid": "cf852a9a056465d8f61412388e108c02d75125eb"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNlQyMDowMToxOVrOGy6uKA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNlQyMDowMToxOVrOGy6uKA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjA0NDA3Mg==", "bodyText": "2020 copyright", "url": "https://github.com/IBM/FHIR/pull/1335#discussion_r456044072", "createdAt": "2020-07-16T20:01:19Z", "author": {"login": "prb112"}, "path": "fhir-persistence-jdbc/src/test/java/com/ibm/fhir/persistence/jdbc/test/util/LocationParmBehaviorUtilTest.java", "diffHunk": "@@ -37,7 +39,7 @@ private void runTestBoundingBox(List<Object> expectedBindVariables, String expec\n         List<Object> actualBindVariables = new ArrayList<>();\n \n         LocationParmBehaviorUtil util = new LocationParmBehaviorUtil();\n-        util.buildQueryForBoundingBox(actualWhereClauseSegment, actualBindVariables, boundingBox);\n+        util.buildQueryForBoundingBox(actualWhereClauseSegment, actualBindVariables, boundingBox, JDBCConstants.PARAMETER_TABLE_ALIAS);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cf852a9a056465d8f61412388e108c02d75125eb"}, "originalPosition": 14}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUwMTc0NjY3", "url": "https://github.com/IBM/FHIR/pull/1335#pullrequestreview-450174667", "createdAt": "2020-07-16T20:02:13Z", "commit": {"oid": "cf852a9a056465d8f61412388e108c02d75125eb"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNlQyMDowMjoxM1rOGy6v9Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNlQyMDowMjoxM1rOGy6v9Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjA0NDUzMw==", "bodyText": "Copyright", "url": "https://github.com/IBM/FHIR/pull/1335#discussion_r456044533", "createdAt": "2020-07-16T20:02:13Z", "author": {"login": "prb112"}, "path": "fhir-persistence/src/main/java/com/ibm/fhir/persistence/util/AbstractQueryBuilder.java", "diffHunk": "@@ -233,7 +233,7 @@ protected T1 buildQueryParm(Class<?> resourceType, QueryParameter queryParm)\n      * @return T1 - A query segment related to a LocationPosition\n      * @throws FHIRPersistenceException\n      */\n-    protected T1 processLocationPosition(List<QueryParameter> queryParameters) throws FHIRPersistenceException {\n+    protected T1 processLocationPosition(List<QueryParameter> queryParameters, String paramTableAlias) throws FHIRPersistenceException {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cf852a9a056465d8f61412388e108c02d75125eb"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0a5454373edc69ca6ee6a707ecc0757b4ab6f59e", "author": {"user": {"login": "punktilious", "name": "Robin Arnold"}}, "url": "https://github.com/IBM/FHIR/commit/0a5454373edc69ca6ee6a707ecc0757b4ab6f59e", "committedDate": "2020-07-16T20:16:11Z", "message": "issue #1327 copyright and logging per review\n\nSigned-off-by: Robin Arnold <robin.arnold23@ibm.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUwMjAwNjA0", "url": "https://github.com/IBM/FHIR/pull/1335#pullrequestreview-450200604", "createdAt": "2020-07-16T20:41:48Z", "commit": {"oid": "0a5454373edc69ca6ee6a707ecc0757b4ab6f59e"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1338, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}