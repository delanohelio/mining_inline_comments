{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDI0NDMxNjM2", "number": 1160, "reviewThreads": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOFQxMzoyNToxN1rOEAgYOg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOFQxMzoyOTowMlrOEAgd8A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY4OTY1OTQ2OnYy", "diffSide": "RIGHT", "path": "fhir-bulkimportexport-webapp/src/main/java/com/ibm/fhir/bulkexport/group/ChunkReader.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOFQxMzoyNToxN1rOGb07dA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOFQxNDowNjoxOFrOGb2wHQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTgzMTkyNA==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    Patients = fhirPersistence.search(persistenceContext, Patient.class).getResource();\n          \n          \n            \n                    patients = fhirPersistence.search(persistenceContext, Patient.class).getResource();", "url": "https://github.com/IBM/FHIR/pull/1160#discussion_r431831924", "createdAt": "2020-05-28T13:25:17Z", "author": {"login": "prb112"}, "path": "fhir-bulkimportexport-webapp/src/main/java/com/ibm/fhir/bulkexport/group/ChunkReader.java", "diffHunk": "@@ -96,6 +97,25 @@ private Group findGroupByID(String fhirTenant, String fhirDatastoreId, String gr\n         }\n     }\n \n+    private List<Resource> patientIdsToPatients(List<String> patientIds) throws Exception {\n+        FHIRSearchContext searchContext;\n+        FHIRPersistenceContext persistenceContext;\n+        List<Resource> Patients;\n+        Map<String, List<String>> queryParameters = new HashMap<>();\n+\n+        queryParameters.put(\"_id\", patientIds);\n+        searchContext = SearchUtil.parseQueryParameters(Patient.class, queryParameters);\n+        searchContext.setPageSize(pageSize);\n+        FHIRTransactionHelper txn = new FHIRTransactionHelper(fhirPersistence.getTransaction());\n+\n+        txn.enroll();\n+        persistenceContext = FHIRPersistenceContextFactory.createPersistenceContext(null, searchContext);\n+        Patients = fhirPersistence.search(persistenceContext, Patient.class).getResource();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5ae344be7d83326e7af880a7775f1418ac01eb0b"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTg2MTc4OQ==", "bodyText": "done", "url": "https://github.com/IBM/FHIR/pull/1160#discussion_r431861789", "createdAt": "2020-05-28T14:06:18Z", "author": {"login": "albertwang-ibm"}, "path": "fhir-bulkimportexport-webapp/src/main/java/com/ibm/fhir/bulkexport/group/ChunkReader.java", "diffHunk": "@@ -96,6 +97,25 @@ private Group findGroupByID(String fhirTenant, String fhirDatastoreId, String gr\n         }\n     }\n \n+    private List<Resource> patientIdsToPatients(List<String> patientIds) throws Exception {\n+        FHIRSearchContext searchContext;\n+        FHIRPersistenceContext persistenceContext;\n+        List<Resource> Patients;\n+        Map<String, List<String>> queryParameters = new HashMap<>();\n+\n+        queryParameters.put(\"_id\", patientIds);\n+        searchContext = SearchUtil.parseQueryParameters(Patient.class, queryParameters);\n+        searchContext.setPageSize(pageSize);\n+        FHIRTransactionHelper txn = new FHIRTransactionHelper(fhirPersistence.getTransaction());\n+\n+        txn.enroll();\n+        persistenceContext = FHIRPersistenceContextFactory.createPersistenceContext(null, searchContext);\n+        Patients = fhirPersistence.search(persistenceContext, Patient.class).getResource();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTgzMTkyNA=="}, "originalCommit": {"oid": "5ae344be7d83326e7af880a7775f1418ac01eb0b"}, "originalPosition": 25}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY4OTY1OTk5OnYy", "diffSide": "RIGHT", "path": "fhir-bulkimportexport-webapp/src/main/java/com/ibm/fhir/bulkexport/group/ChunkReader.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOFQxMzoyNToyNlrOGb072A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOFQxNDowNjoyN1rOGb2wiQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTgzMjAyNA==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    List<Resource> Patients;\n          \n          \n            \n                    List<Resource> patients;", "url": "https://github.com/IBM/FHIR/pull/1160#discussion_r431832024", "createdAt": "2020-05-28T13:25:26Z", "author": {"login": "prb112"}, "path": "fhir-bulkimportexport-webapp/src/main/java/com/ibm/fhir/bulkexport/group/ChunkReader.java", "diffHunk": "@@ -96,6 +97,25 @@ private Group findGroupByID(String fhirTenant, String fhirDatastoreId, String gr\n         }\n     }\n \n+    private List<Resource> patientIdsToPatients(List<String> patientIds) throws Exception {\n+        FHIRSearchContext searchContext;\n+        FHIRPersistenceContext persistenceContext;\n+        List<Resource> Patients;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5ae344be7d83326e7af880a7775f1418ac01eb0b"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTg2MTg5Nw==", "bodyText": "done", "url": "https://github.com/IBM/FHIR/pull/1160#discussion_r431861897", "createdAt": "2020-05-28T14:06:27Z", "author": {"login": "albertwang-ibm"}, "path": "fhir-bulkimportexport-webapp/src/main/java/com/ibm/fhir/bulkexport/group/ChunkReader.java", "diffHunk": "@@ -96,6 +97,25 @@ private Group findGroupByID(String fhirTenant, String fhirDatastoreId, String gr\n         }\n     }\n \n+    private List<Resource> patientIdsToPatients(List<String> patientIds) throws Exception {\n+        FHIRSearchContext searchContext;\n+        FHIRPersistenceContext persistenceContext;\n+        List<Resource> Patients;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTgzMjAyNA=="}, "originalCommit": {"oid": "5ae344be7d83326e7af880a7775f1418ac01eb0b"}, "originalPosition": 15}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY4OTY2MDQzOnYy", "diffSide": "RIGHT", "path": "fhir-bulkimportexport-webapp/src/main/java/com/ibm/fhir/bulkexport/group/ChunkReader.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOFQxMzoyNTozNlrOGb08Pg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOFQxMzoyNTozNlrOGb08Pg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTgzMjEyNg==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    return Patients;\n          \n          \n            \n                    return patients;", "url": "https://github.com/IBM/FHIR/pull/1160#discussion_r431832126", "createdAt": "2020-05-28T13:25:36Z", "author": {"login": "prb112"}, "path": "fhir-bulkimportexport-webapp/src/main/java/com/ibm/fhir/bulkexport/group/ChunkReader.java", "diffHunk": "@@ -96,6 +97,25 @@ private Group findGroupByID(String fhirTenant, String fhirDatastoreId, String gr\n         }\n     }\n \n+    private List<Resource> patientIdsToPatients(List<String> patientIds) throws Exception {\n+        FHIRSearchContext searchContext;\n+        FHIRPersistenceContext persistenceContext;\n+        List<Resource> Patients;\n+        Map<String, List<String>> queryParameters = new HashMap<>();\n+\n+        queryParameters.put(\"_id\", patientIds);\n+        searchContext = SearchUtil.parseQueryParameters(Patient.class, queryParameters);\n+        searchContext.setPageSize(pageSize);\n+        FHIRTransactionHelper txn = new FHIRTransactionHelper(fhirPersistence.getTransaction());\n+\n+        txn.enroll();\n+        persistenceContext = FHIRPersistenceContextFactory.createPersistenceContext(null, searchContext);\n+        Patients = fhirPersistence.search(persistenceContext, Patient.class).getResource();\n+        txn.unenroll();\n+\n+        return Patients;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5ae344be7d83326e7af880a7775f1418ac01eb0b"}, "originalPosition": 28}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY4OTY2MjQ3OnYy", "diffSide": "RIGHT", "path": "fhir-bulkimportexport-webapp/src/main/java/com/ibm/fhir/bulkexport/group/ChunkReader.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOFQxMzoyNjowNFrOGb09mg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOFQxNDowNjo0MlrOGb2xLQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTgzMjQ3NA==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                                List <Resource> resources = patientIdsToPatients(patientIds);\n          \n          \n            \n                                List<Resource> resources = patientIdsToPatients(patientIds);", "url": "https://github.com/IBM/FHIR/pull/1160#discussion_r431832474", "createdAt": "2020-05-28T13:26:04Z", "author": {"login": "prb112"}, "path": "fhir-bulkimportexport-webapp/src/main/java/com/ibm/fhir/bulkexport/group/ChunkReader.java", "diffHunk": "@@ -135,7 +155,14 @@ public Object readItem() throws Exception {\n             List<String> patientIds = patientPageMembers.stream().filter(patientRef -> patientRef != null).map(patientRef\n                     -> patientRef.getEntity().getReference().getValue().substring(8)).collect(Collectors.toList());\n             if (patientIds != null && patientIds.size() > 0) {\n-                fillChunkDataBuffer(patientIds);\n+                if (fhirResourceType.equalsIgnoreCase(\"patient\")) {\n+                    List <Resource> resources = patientIdsToPatients(patientIds);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5ae344be7d83326e7af880a7775f1418ac01eb0b"}, "originalPosition": 40}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTg2MjA2MQ==", "bodyText": "done", "url": "https://github.com/IBM/FHIR/pull/1160#discussion_r431862061", "createdAt": "2020-05-28T14:06:42Z", "author": {"login": "albertwang-ibm"}, "path": "fhir-bulkimportexport-webapp/src/main/java/com/ibm/fhir/bulkexport/group/ChunkReader.java", "diffHunk": "@@ -135,7 +155,14 @@ public Object readItem() throws Exception {\n             List<String> patientIds = patientPageMembers.stream().filter(patientRef -> patientRef != null).map(patientRef\n                     -> patientRef.getEntity().getReference().getValue().substring(8)).collect(Collectors.toList());\n             if (patientIds != null && patientIds.size() > 0) {\n-                fillChunkDataBuffer(patientIds);\n+                if (fhirResourceType.equalsIgnoreCase(\"patient\")) {\n+                    List <Resource> resources = patientIdsToPatients(patientIds);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTgzMjQ3NA=="}, "originalCommit": {"oid": "5ae344be7d83326e7af880a7775f1418ac01eb0b"}, "originalPosition": 40}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY4OTY2NTQ1OnYy", "diffSide": "RIGHT", "path": "fhir-bulkimportexport-webapp/src/main/java/com/ibm/fhir/bulkexport/patient/ChunkReader.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOFQxMzoyNjo0OVrOGb0_iQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOFQxNDowNjo0OVrOGb2xjA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTgzMjk2OQ==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                protected\n          \n          \n            \n                String fhirResourceType;\n          \n          \n            \n                protected String fhirResourceType;", "url": "https://github.com/IBM/FHIR/pull/1160#discussion_r431832969", "createdAt": "2020-05-28T13:26:49Z", "author": {"login": "prb112"}, "path": "fhir-bulkimportexport-webapp/src/main/java/com/ibm/fhir/bulkexport/patient/ChunkReader.java", "diffHunk": "@@ -88,6 +88,7 @@\n      */\n     @Inject\n     @BatchProperty(name = Constants.PARTITION_RESOURCE_TYPE)\n+    protected\n     String fhirResourceType;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5ae344be7d83326e7af880a7775f1418ac01eb0b"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTg2MjE1Ng==", "bodyText": "done", "url": "https://github.com/IBM/FHIR/pull/1160#discussion_r431862156", "createdAt": "2020-05-28T14:06:49Z", "author": {"login": "albertwang-ibm"}, "path": "fhir-bulkimportexport-webapp/src/main/java/com/ibm/fhir/bulkexport/patient/ChunkReader.java", "diffHunk": "@@ -88,6 +88,7 @@\n      */\n     @Inject\n     @BatchProperty(name = Constants.PARTITION_RESOURCE_TYPE)\n+    protected\n     String fhirResourceType;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTgzMjk2OQ=="}, "originalCommit": {"oid": "5ae344be7d83326e7af880a7775f1418ac01eb0b"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY4OTY3NDA4OnYy", "diffSide": "RIGHT", "path": "fhir-bulkimportexport-webapp/src/main/java/com/ibm/fhir/bulkexport/patient/ChunkReader.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOFQxMzoyOTowMlrOGb1FRA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOFQxNDowNjo1OVrOGb2yDQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTgzNDQzNg==", "bodyText": "This may be candidate to go in a common class as it's consistent with some of the code in group", "url": "https://github.com/IBM/FHIR/pull/1160#discussion_r431834436", "createdAt": "2020-05-28T13:29:02Z", "author": {"login": "prb112"}, "path": "fhir-bulkimportexport-webapp/src/main/java/com/ibm/fhir/bulkexport/patient/ChunkReader.java", "diffHunk": "@@ -269,7 +300,11 @@ public Object readItem() throws Exception {\n \n             List<String> patientIds = resources.stream().filter(item -> item.getId() != null).map(item -> item.getId()).collect(Collectors.toList());\n             if (patientIds != null && patientIds.size() > 0) {\n-                fillChunkDataBuffer(patientIds);\n+                if (fhirResourceType.equalsIgnoreCase(\"patient\")) {\n+                    fillChunkPatientDataBuffer(resources);\n+                } else {\n+                    fillChunkDataBuffer(patientIds);\n+                }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5ae344be7d83326e7af880a7775f1418ac01eb0b"}, "originalPosition": 54}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTgzNDY3NQ==", "bodyText": "No need to refactor here, just a thought going forward", "url": "https://github.com/IBM/FHIR/pull/1160#discussion_r431834675", "createdAt": "2020-05-28T13:29:24Z", "author": {"login": "prb112"}, "path": "fhir-bulkimportexport-webapp/src/main/java/com/ibm/fhir/bulkexport/patient/ChunkReader.java", "diffHunk": "@@ -269,7 +300,11 @@ public Object readItem() throws Exception {\n \n             List<String> patientIds = resources.stream().filter(item -> item.getId() != null).map(item -> item.getId()).collect(Collectors.toList());\n             if (patientIds != null && patientIds.size() > 0) {\n-                fillChunkDataBuffer(patientIds);\n+                if (fhirResourceType.equalsIgnoreCase(\"patient\")) {\n+                    fillChunkPatientDataBuffer(resources);\n+                } else {\n+                    fillChunkDataBuffer(patientIds);\n+                }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTgzNDQzNg=="}, "originalCommit": {"oid": "5ae344be7d83326e7af880a7775f1418ac01eb0b"}, "originalPosition": 54}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTg2MjI4NQ==", "bodyText": "also done", "url": "https://github.com/IBM/FHIR/pull/1160#discussion_r431862285", "createdAt": "2020-05-28T14:06:59Z", "author": {"login": "albertwang-ibm"}, "path": "fhir-bulkimportexport-webapp/src/main/java/com/ibm/fhir/bulkexport/patient/ChunkReader.java", "diffHunk": "@@ -269,7 +300,11 @@ public Object readItem() throws Exception {\n \n             List<String> patientIds = resources.stream().filter(item -> item.getId() != null).map(item -> item.getId()).collect(Collectors.toList());\n             if (patientIds != null && patientIds.size() > 0) {\n-                fillChunkDataBuffer(patientIds);\n+                if (fhirResourceType.equalsIgnoreCase(\"patient\")) {\n+                    fillChunkPatientDataBuffer(resources);\n+                } else {\n+                    fillChunkDataBuffer(patientIds);\n+                }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTgzNDQzNg=="}, "originalCommit": {"oid": "5ae344be7d83326e7af880a7775f1418ac01eb0b"}, "originalPosition": 54}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4861, "cost": 1, "resetAt": "2021-11-13T12:10:21Z"}}}