{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE2MjI2NDUx", "number": 1066, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMVQxNzoyMDo1NFrOD7VR_w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMVQxODoyMDoyMFrOD7Wifw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYzNTQxMjQ3OnYy", "diffSide": "RIGHT", "path": "fhir-persistence-schema/src/main/java/com/ibm/fhir/schema/app/Main.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMVQxNzoyMDo1NFrOGTl5GQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMVQxODoyODowMlrOGToOhQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzE5Njk1Mw==", "bodyText": "DB2 SQL Error: SQLCODE=-104, SQLSTATE=42601, SQLERRMC=;;enant_salt || ?, 2));END-OF-STATEMENT\nPossibly double end of statement problem? maybe only occurs on Windows versus Mac?", "url": "https://github.com/IBM/FHIR/pull/1066#discussion_r423196953", "createdAt": "2020-05-11T17:20:54Z", "author": {"login": "prb112"}, "path": "fhir-persistence-schema/src/main/java/com/ibm/fhir/schema/app/Main.java", "diffHunk": "@@ -893,7 +893,7 @@ protected void checkIfTenantNameAndTenantKeyExists(Db2Adapter adapter, String te\n                 final String sql =\n                         \"SELECT t.tenant_status FROM fhir_admin.tenants t WHERE t.tenant_name = ? \"\n                                 + \"AND EXISTS (SELECT 1 FROM fhir_admin.tenant_keys tk WHERE tk.mt_id = t.mt_id \"\n-                                + \"AND tk.tenant_hash = sysibm.hash(tk.tenant_salt || ?, 2));\";\n+                                + \"AND tk.tenant_hash = sysibm.hash(tk.tenant_salt || ?, 2))\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4ab183454b1158267934b144b57278b610f27d45"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzIzMDEzOQ==", "bodyText": "wouldn't our windows e2e test have caught this?  if not, why not?", "url": "https://github.com/IBM/FHIR/pull/1066#discussion_r423230139", "createdAt": "2020-05-11T18:18:58Z", "author": {"login": "lmsurpre"}, "path": "fhir-persistence-schema/src/main/java/com/ibm/fhir/schema/app/Main.java", "diffHunk": "@@ -893,7 +893,7 @@ protected void checkIfTenantNameAndTenantKeyExists(Db2Adapter adapter, String te\n                 final String sql =\n                         \"SELECT t.tenant_status FROM fhir_admin.tenants t WHERE t.tenant_name = ? \"\n                                 + \"AND EXISTS (SELECT 1 FROM fhir_admin.tenant_keys tk WHERE tk.mt_id = t.mt_id \"\n-                                + \"AND tk.tenant_hash = sysibm.hash(tk.tenant_salt || ?, 2));\";\n+                                + \"AND tk.tenant_hash = sysibm.hash(tk.tenant_salt || ?, 2))\";", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzE5Njk1Mw=="}, "originalCommit": {"oid": "4ab183454b1158267934b144b57278b610f27d45"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzIzNTIwNQ==", "bodyText": "I thought so too.\nI did send a new cli jar to Frances and it worked.", "url": "https://github.com/IBM/FHIR/pull/1066#discussion_r423235205", "createdAt": "2020-05-11T18:28:02Z", "author": {"login": "prb112"}, "path": "fhir-persistence-schema/src/main/java/com/ibm/fhir/schema/app/Main.java", "diffHunk": "@@ -893,7 +893,7 @@ protected void checkIfTenantNameAndTenantKeyExists(Db2Adapter adapter, String te\n                 final String sql =\n                         \"SELECT t.tenant_status FROM fhir_admin.tenants t WHERE t.tenant_name = ? \"\n                                 + \"AND EXISTS (SELECT 1 FROM fhir_admin.tenant_keys tk WHERE tk.mt_id = t.mt_id \"\n-                                + \"AND tk.tenant_hash = sysibm.hash(tk.tenant_salt || ?, 2));\";\n+                                + \"AND tk.tenant_hash = sysibm.hash(tk.tenant_salt || ?, 2))\";", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzE5Njk1Mw=="}, "originalCommit": {"oid": "4ab183454b1158267934b144b57278b610f27d45"}, "originalPosition": 14}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYzNTYxODU1OnYy", "diffSide": "RIGHT", "path": "fhir-persistence-jdbc/src/main/java/com/ibm/fhir/persistence/jdbc/util/DerbyBootstrapper.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMVQxODoyMDoyMFrOGTn9Yw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMVQxODoyODoxMlrOGToO1w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzIzMDgxOQ==", "bodyText": "should it be newDb = (x == null || x == 0)?", "url": "https://github.com/IBM/FHIR/pull/1066#discussion_r423230819", "createdAt": "2020-05-11T18:20:20Z", "author": {"login": "lmsurpre"}, "path": "fhir-persistence-jdbc/src/main/java/com/ibm/fhir/persistence/jdbc/util/DerbyBootstrapper.java", "diffHunk": "@@ -111,12 +111,12 @@ public static void bootstrap(Connection connection, String adminSchemaName, Stri\n         // Current version history for the database. This is used by applyWithHistory\n         // to determine which updates to apply and to record the new changes as they\n         // are applied\n-        VersionHistoryService vhs = new VersionHistoryService(adminSchemaName, dataSchemaName);\n+        VersionHistoryService vhs = new VersionHistoryService(adminSchemaName, dataSchemaName, OAUTH_SCHEMANAME);\n         vhs.setTarget(adapter);\n         vhs.init();\n \n         // Use the version history service to determine if this table existed before we run `applyWithHistory`\n-        boolean newDb = vhs.getVersion(dataSchemaName, DatabaseObjectType.TABLE.name(), \"PARAMETER_NAMES\") == null;\n+        boolean newDb = vhs.getVersion(dataSchemaName, DatabaseObjectType.TABLE.name(), \"PARAMETER_NAMES\") == 0;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cbf63b0cea6ec3f28ce2345f17db7c4486160f2c"}, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzIzNTI4Nw==", "bodyText": "fixed", "url": "https://github.com/IBM/FHIR/pull/1066#discussion_r423235287", "createdAt": "2020-05-11T18:28:12Z", "author": {"login": "prb112"}, "path": "fhir-persistence-jdbc/src/main/java/com/ibm/fhir/persistence/jdbc/util/DerbyBootstrapper.java", "diffHunk": "@@ -111,12 +111,12 @@ public static void bootstrap(Connection connection, String adminSchemaName, Stri\n         // Current version history for the database. This is used by applyWithHistory\n         // to determine which updates to apply and to record the new changes as they\n         // are applied\n-        VersionHistoryService vhs = new VersionHistoryService(adminSchemaName, dataSchemaName);\n+        VersionHistoryService vhs = new VersionHistoryService(adminSchemaName, dataSchemaName, OAUTH_SCHEMANAME);\n         vhs.setTarget(adapter);\n         vhs.init();\n \n         // Use the version history service to determine if this table existed before we run `applyWithHistory`\n-        boolean newDb = vhs.getVersion(dataSchemaName, DatabaseObjectType.TABLE.name(), \"PARAMETER_NAMES\") == null;\n+        boolean newDb = vhs.getVersion(dataSchemaName, DatabaseObjectType.TABLE.name(), \"PARAMETER_NAMES\") == 0;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzIzMDgxOQ=="}, "originalCommit": {"oid": "cbf63b0cea6ec3f28ce2345f17db7c4486160f2c"}, "originalPosition": 11}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 64, "cost": 1, "resetAt": "2021-11-12T20:44:06Z"}}}