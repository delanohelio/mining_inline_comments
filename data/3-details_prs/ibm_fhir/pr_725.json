{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc5NTY1NDc2", "number": 725, "title": " issue #723 #728 upgrade COS client and fix Base64BinaryTest ", "bodyText": "For issue #723, According to:\n(1) https://stackoverflow.com/questions/45624175/amazons3-getting-warning-s3abortableinputstreamnot-all-bytes-were-read-from-t, we should call s3ObjectInputStream.abort() to prevent the warning.\n(2) aws/aws-sdk-java#1657, I found the old COS client was not with the correct version of aws s3 client codes, so upgrade COS client from 2.1.0 to 2.6.1 (the most current version now.) and the httpclient is also upgraded accordingly.\nFor issue #728:\n(1) Moved FHIRModelConfig.setCheckReferences(false) to FhirServerTestBase.\n(2) changed the type of \"who\" in testCreateParameters of Base64BinaryTest to \"Patient\".", "createdAt": "2020-02-25T12:57:01Z", "url": "https://github.com/IBM/FHIR/pull/725", "merged": true, "mergeCommit": {"oid": "beb7308642c6b4b42adf39215fb321a1fb1f0da9"}, "closed": true, "closedAt": "2020-02-25T20:06:21Z", "author": {"login": "albertwang-ibm"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcHomxLAH2gAyMzc5NTY1NDc2OjkwNjRkOWQ1YzkyMDc0ODliYmMzMjBjMThjYjYxN2IwOWFjM2ZjMzU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcH3tjMgFqTM2NDQwNzI2Mw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "9064d9d5c9207489bbc320c18cb617b09ac3fc35", "author": {"user": {"login": "albertwang-ibm", "name": "Albert(Xu) Wang"}}, "url": "https://github.com/IBM/FHIR/commit/9064d9d5c9207489bbc320c18cb617b09ac3fc35", "committedDate": "2020-02-25T02:22:06Z", "message": "Merge pull request #724 from IBM/issue-723\n\nIssue 723"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "eaf2beb7ee7af5ac84cdd17cd2dc1e565d316f18", "author": {"user": {"login": "albertwang-ibm", "name": "Albert(Xu) Wang"}}, "url": "https://github.com/IBM/FHIR/commit/eaf2beb7ee7af5ac84cdd17cd2dc1e565d316f18", "committedDate": "2020-02-25T12:50:17Z", "message": "issue #723 upgrade COS client and abort objectinputstream\n\nSigned-off-by: Albert Wang <xuwang@us.ibm.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY0MTUzNjUz", "url": "https://github.com/IBM/FHIR/pull/725#pullrequestreview-364153653", "createdAt": "2020-02-25T13:50:32Z", "commit": {"oid": "eaf2beb7ee7af5ac84cdd17cd2dc1e565d316f18"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQxMzo1MDozMlrOFuGv_Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQxMzo1MDozMlrOFuGv_Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mzg4OTQwNQ==", "bodyText": "Is abort for exception handling logic? if so, why is it in the main try?", "url": "https://github.com/IBM/FHIR/pull/725#discussion_r383889405", "createdAt": "2020-02-25T13:50:32Z", "author": {"login": "prb112"}, "path": "fhir-bulkimportexport-webapp/src/main/java/com/ibm/fhir/bulkcommon/BulkDataUtils.java", "diffHunk": "@@ -157,8 +158,11 @@ public static int readFhirResourceFromObjectStore(AmazonS3 cosClient, String buc\n            int numOfLinesToSkip, List<Resource> fhirResources) {\n         int exported;\n         S3Object item = cosClient.getObject(new GetObjectRequest(bucketName, itemName));\n-        try (BufferedReader resReader = new BufferedReader(new InputStreamReader(item.getObjectContent()))) {\n+        try (S3ObjectInputStream s3InStream = item.getObjectContent();\n+             BufferedReader resReader = new BufferedReader(new InputStreamReader(s3InStream))) {\n             exported = getFhirResourceFromBufferReader(resReader, numOfLinesToSkip, fhirResources);\n+            // Notify s3 client to abort and prevent the server from keeping on sending data.\n+            s3InStream.abort();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "eaf2beb7ee7af5ac84cdd17cd2dc1e565d316f18"}, "originalPosition": 17}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY0MTcxNjY4", "url": "https://github.com/IBM/FHIR/pull/725#pullrequestreview-364171668", "createdAt": "2020-02-25T14:15:06Z", "commit": {"oid": "eaf2beb7ee7af5ac84cdd17cd2dc1e565d316f18"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQxNDoxNTowNlrOFuHoPg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQxNDoxNTowNlrOFuHoPg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzkwMzgwNg==", "bodyText": "FYI, I looked at the dependency trees:\n+- com.ibm.cos:ibm-cos-java-sdk:jar:2.1.0:compile\n[INFO] |  +- com.ibm.cos:ibm-cos-java-sdk-s3:jar:2.1.0:compile\n[INFO] |  |  +- (com.ibm.cos:ibm-cos-java-sdk-kms:jar:2.1.0:compile - omitted for duplicate)\n[INFO] |  |  - (com.ibm.cos:ibm-cos-java-sdk-core:jar:2.1.0:compile - omitted for duplicate)\n[INFO] |  +- com.ibm.cos:ibm-cos-java-sdk-kms:jar:2.1.0:compile\n[INFO] |  |  - (com.ibm.cos:ibm-cos-java-sdk-core:jar:2.1.0:compile - omitted for duplicate)\n[INFO] |  - com.ibm.cos:ibm-cos-java-sdk-core:jar:2.1.0:compile\n[INFO] |     +- (commons-logging:commons-logging:jar:1.1.3:compile - omitted for conflict with 1.2)\n[INFO] |     +- (org.apache.httpcomponents:httpclient:jar:4.5.6:compile - version managed from 4.5.2; omitted for duplicate)\n[INFO] |     +- software.amazon.ion:ion-java:jar:1.0.2:compile\n[INFO] |     +- com.fasterxml.jackson.core:jackson-databind:jar:2.6.6:compile\n[INFO] |     |  +- com.fasterxml.jackson.core:jackson-annotations:jar:2.6.0:compile\n[INFO] |     |  - com.fasterxml.jackson.core:jackson-core:jar:2.6.6:compile\n[INFO] |     +- com.fasterxml.jackson.dataformat:jackson-dataformat-cbor:jar:2.6.6:compile\n[INFO] |     |  - (com.fasterxml.jackson.core:jackson-core:jar:2.6.6:compile - omitted for duplicate)\n[INFO] |     +- (org.apache.httpcomponents:httpasyncclient:jar:4.1.3:compile - omitted for conflict with 4.1.4)\n[INFO] |     - joda-time:joda-time:jar:2.8.1:compile\n+- com.ibm.cos:ibm-cos-java-sdk:jar:2.6.1:compile\n[INFO] |  +- com.ibm.cos:ibm-cos-java-sdk-s3:jar:2.6.1:compile\n[INFO] |  |  +- (com.ibm.cos:ibm-cos-java-sdk-kms:jar:2.6.1:compile - omitted for duplicate)\n[INFO] |  |  - (com.ibm.cos:ibm-cos-java-sdk-core:jar:2.6.1:compile - omitted for duplicate)\n[INFO] |  +- com.ibm.cos:ibm-cos-java-sdk-kms:jar:2.6.1:compile\n[INFO] |  |  - (com.ibm.cos:ibm-cos-java-sdk-core:jar:2.6.1:compile - omitted for duplicate)\n[INFO] |  - com.ibm.cos:ibm-cos-java-sdk-core:jar:2.6.1:compile\n[INFO] |     +- (commons-logging:commons-logging:jar:1.1.3:compile - omitted for conflict with 1.2)\n[INFO] |     +- (org.apache.httpcomponents:httpclient:jar:4.5.6:compile - version managed from 4.5.9; omitted for duplicate)\n[INFO] |     +- software.amazon.ion:ion-java:jar:1.2.0:compile\n[INFO] |     +- com.fasterxml.jackson.core:jackson-databind:jar:2.10.2:compile\n[INFO] |     |  +- com.fasterxml.jackson.core:jackson-annotations:jar:2.10.2:compile\n[INFO] |     |  - com.fasterxml.jackson.core:jackson-core:jar:2.10.2:compile\n[INFO] |     +- com.fasterxml.jackson.dataformat:jackson-dataformat-cbor:jar:2.10.0:compile\n[INFO] |     |  - (com.fasterxml.jackson.core:jackson-core:jar:2.10.0:compile - omitted for conflict with 2.10.2)\n[INFO] |     - joda-time:joda-time:jar:2.8.2:compile", "url": "https://github.com/IBM/FHIR/pull/725#discussion_r383903806", "createdAt": "2020-02-25T14:15:06Z", "author": {"login": "prb112"}, "path": "fhir-parent/pom.xml", "diffHunk": "@@ -285,7 +285,7 @@\n             <dependency>\n                 <groupId>com.ibm.cos</groupId>\n                 <artifactId>ibm-cos-java-sdk</artifactId>\n-                <version>2.1.0</version>\n+                <version>2.6.1</version>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "eaf2beb7ee7af5ac84cdd17cd2dc1e565d316f18"}, "originalPosition": 14}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY0MTcyNjc1", "url": "https://github.com/IBM/FHIR/pull/725#pullrequestreview-364172675", "createdAt": "2020-02-25T14:16:28Z", "commit": {"oid": "eaf2beb7ee7af5ac84cdd17cd2dc1e565d316f18"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9708c774a4451212c96cde6355a7645faf3ec5ae", "author": {"user": {"login": "albertwang-ibm", "name": "Albert(Xu) Wang"}}, "url": "https://github.com/IBM/FHIR/commit/9708c774a4451212c96cde6355a7645faf3ec5ae", "committedDate": "2020-02-25T18:41:04Z", "message": "issue #728 test changes\n\nSigned-off-by: Albert Wang <xuwang@us.ibm.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2785ae9ca2bb948c7fce1a12c3c84a39821c2fec", "author": {"user": {"login": "albertwang-ibm", "name": "Albert(Xu) Wang"}}, "url": "https://github.com/IBM/FHIR/commit/2785ae9ca2bb948c7fce1a12c3c84a39821c2fec", "committedDate": "2020-02-25T18:59:13Z", "message": "issue #728 fix reference verification error for Bast64BinaryTest\n\nSigned-off-by: Albert Wang <xuwang@us.ibm.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY0NDA3MjYz", "url": "https://github.com/IBM/FHIR/pull/725#pullrequestreview-364407263", "createdAt": "2020-02-25T19:58:05Z", "commit": {"oid": "2785ae9ca2bb948c7fce1a12c3c84a39821c2fec"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 707, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}