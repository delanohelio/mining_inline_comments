{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM4Njk5OTQx", "number": 1274, "reviewThreads": {"totalCount": 21, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQxNToyNDo1NlrOEJLBwQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQxNzo1NjowOFrOEJN8rg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc4MDUzMzEzOnYy", "diffSide": "RIGHT", "path": "build/docker/minio/Dockerfile", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQxNToyNDo1NlrOGplCUA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQxNTozNDo1OVrOGplZGw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjI1MTYwMA==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            # Indicate that we expect to connect to the minio service on port 8443\n          \n          \n            \n            # Indicate that we expect to connect to the minio service on port 9000", "url": "https://github.com/IBM/FHIR/pull/1274#discussion_r446251600", "createdAt": "2020-06-26T15:24:56Z", "author": {"login": "prb112"}, "path": "build/docker/minio/Dockerfile", "diffHunk": "@@ -0,0 +1,15 @@\n+# ----------------------------------------------------------------------------\n+# (C) Copyright IBM Corp. 2019, 2020\n+#\n+# SPDX-License-Identifier: Apache-2.0\n+# ----------------------------------------------------------------------------\n+\n+FROM minio/minio\n+\n+# Indicate that we expect to connect to the minio service on port 8443", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "01cd70bac22b23d63e1e1c0534c6fab547411593"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjI1NzQzNQ==", "bodyText": "good catch, forgot to change this accordingly", "url": "https://github.com/IBM/FHIR/pull/1274#discussion_r446257435", "createdAt": "2020-06-26T15:34:59Z", "author": {"login": "albertwang-ibm"}, "path": "build/docker/minio/Dockerfile", "diffHunk": "@@ -0,0 +1,15 @@\n+# ----------------------------------------------------------------------------\n+# (C) Copyright IBM Corp. 2019, 2020\n+#\n+# SPDX-License-Identifier: Apache-2.0\n+# ----------------------------------------------------------------------------\n+\n+FROM minio/minio\n+\n+# Indicate that we expect to connect to the minio service on port 8443", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjI1MTYwMA=="}, "originalCommit": {"oid": "01cd70bac22b23d63e1e1c0534c6fab547411593"}, "originalPosition": 9}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc4MDU1MjI5OnYy", "diffSide": "RIGHT", "path": "build/docker/minio/test-import.ndjson", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQxNTozMDoxOVrOGplOsg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQxNTozNDozN1rOGplYRg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjI1NDc3MA==", "bodyText": "Shouldn't we remove the test data in /fhir-server-test/src/test/resources/testdata/import-operation/test-import.ndjson ? or copy from there to here.  Then there will be one place to update.", "url": "https://github.com/IBM/FHIR/pull/1274#discussion_r446254770", "createdAt": "2020-06-26T15:30:19Z", "author": {"login": "prb112"}, "path": "build/docker/minio/test-import.ndjson", "diffHunk": "@@ -0,0 +1,3 @@\n+{\"resourceType\":\"Patient\",\"id\":\"72b0d93c-93d0-43d9-94a8-d5154ce07152\",\"meta\":{\"versionId\":\"1\",\"lastUpdated\":\"2020-04-17T00:09:36.910431Z\"},\"name\":[{\"family\":\"Doe\",\"given\":[\"import-1\"]}],\"telecom\":[{\"system\":\"phone\",\"value\":\"555-1122\",\"use\":\"home\"}],\"birthDate\":\"1970-01-01\"}\n+{\"resourceType\":\"Patient\",\"id\":\"72b0d93c-93d0-43d9-94a8-d5154ce07153\",\"meta\":{\"versionId\":\"1\",\"lastUpdated\":\"2020-04-17T00:09:36.910431Z\"},\"name\":[{\"family\":\"Doe\",\"given\":[\"import-2\"]}],\"telecom\":[{\"system\":\"phone\",\"value\":\"555-1122\",\"use\":\"home\"}],\"birthDate\":\"1970-01-01\"}\n+{\"resourceType\":\"Patient\",\"id\":\"72b0d93c-93d0-43d9-94a8-d5154ce07154\",\"meta\":{\"versionId\":\"1\",\"lastUpdated\":\"2020-04-17T00:09:36.910431Z\"},\"name\":[{\"family\":\"Doe\",\"given\":[\"import-3\"]}],\"telecom\":[{\"system\":\"phone\",\"value\":\"555-1122\",\"use\":\"home\"}],\"birthDate\":\"1970-01-01\"}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "01cd70bac22b23d63e1e1c0534c6fab547411593"}, "originalPosition": 3}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjI1NzIyMg==", "bodyText": "ha, good point. I can reuse it!", "url": "https://github.com/IBM/FHIR/pull/1274#discussion_r446257222", "createdAt": "2020-06-26T15:34:37Z", "author": {"login": "albertwang-ibm"}, "path": "build/docker/minio/test-import.ndjson", "diffHunk": "@@ -0,0 +1,3 @@\n+{\"resourceType\":\"Patient\",\"id\":\"72b0d93c-93d0-43d9-94a8-d5154ce07152\",\"meta\":{\"versionId\":\"1\",\"lastUpdated\":\"2020-04-17T00:09:36.910431Z\"},\"name\":[{\"family\":\"Doe\",\"given\":[\"import-1\"]}],\"telecom\":[{\"system\":\"phone\",\"value\":\"555-1122\",\"use\":\"home\"}],\"birthDate\":\"1970-01-01\"}\n+{\"resourceType\":\"Patient\",\"id\":\"72b0d93c-93d0-43d9-94a8-d5154ce07153\",\"meta\":{\"versionId\":\"1\",\"lastUpdated\":\"2020-04-17T00:09:36.910431Z\"},\"name\":[{\"family\":\"Doe\",\"given\":[\"import-2\"]}],\"telecom\":[{\"system\":\"phone\",\"value\":\"555-1122\",\"use\":\"home\"}],\"birthDate\":\"1970-01-01\"}\n+{\"resourceType\":\"Patient\",\"id\":\"72b0d93c-93d0-43d9-94a8-d5154ce07154\",\"meta\":{\"versionId\":\"1\",\"lastUpdated\":\"2020-04-17T00:09:36.910431Z\"},\"name\":[{\"family\":\"Doe\",\"given\":[\"import-3\"]}],\"telecom\":[{\"system\":\"phone\",\"value\":\"555-1122\",\"use\":\"home\"}],\"birthDate\":\"1970-01-01\"}", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjI1NDc3MA=="}, "originalCommit": {"oid": "01cd70bac22b23d63e1e1c0534c6fab547411593"}, "originalPosition": 3}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc4MDU3Mzg0OnYy", "diffSide": "RIGHT", "path": "docs/src/pages/guides/FHIRServerUsersGuide.md", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQxNTozNjozNFrOGplcrA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQxNTozOToxNVrOGpliaQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjI1ODM0OA==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            |`fhirServer/bulkdata/isCosClientUseFhirServerTrustStore`|boolean| If use fhir server TrustStore to access S3/IBMCOS service |\n          \n          \n            \n            |`fhirServer/bulkdata/isCosClientUseFhirServerTrustStore`|boolean| If the COS Client should use the IBM FHIR Server's TrustStore to access S3/IBMCOS service |\n          \n      \n    \n    \n  \n\nSeparately, this property is pretty long, it might be best to summarize it to a short property and easier to understand.\nisCosClientUseFhirServerTrustStore\n->\nuseDefaultTrustStore", "url": "https://github.com/IBM/FHIR/pull/1274#discussion_r446258348", "createdAt": "2020-06-26T15:36:34Z", "author": {"login": "prb112"}, "path": "docs/src/pages/guides/FHIRServerUsersGuide.md", "diffHunk": "@@ -1489,6 +1489,7 @@ This section contains reference information about each of the configuration prop\n |`fhirServer/bulkdata/cosFileMaxResources`|int|The maximum number of FHIR resources per COS file, \"-1\" means no limit, the default value is 500000 |\n |`fhirServer/bulkdata/cosFileMaxSize`|int|The maximum COS file size in bytes, \"-1\" means no limit, the default value is 209715200 (200M) |\n |`fhirServer/bulkdata/patientExportPageSize`|int| The search page size for patient/group export, the default value is 200 |\n+|`fhirServer/bulkdata/isCosClientUseFhirServerTrustStore`|boolean| If use fhir server TrustStore to access S3/IBMCOS service |", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "01cd70bac22b23d63e1e1c0534c6fab547411593"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjI1OTgxNw==", "bodyText": "make sense, let  me change it together with the doc.", "url": "https://github.com/IBM/FHIR/pull/1274#discussion_r446259817", "createdAt": "2020-06-26T15:39:15Z", "author": {"login": "albertwang-ibm"}, "path": "docs/src/pages/guides/FHIRServerUsersGuide.md", "diffHunk": "@@ -1489,6 +1489,7 @@ This section contains reference information about each of the configuration prop\n |`fhirServer/bulkdata/cosFileMaxResources`|int|The maximum number of FHIR resources per COS file, \"-1\" means no limit, the default value is 500000 |\n |`fhirServer/bulkdata/cosFileMaxSize`|int|The maximum COS file size in bytes, \"-1\" means no limit, the default value is 209715200 (200M) |\n |`fhirServer/bulkdata/patientExportPageSize`|int| The search page size for patient/group export, the default value is 200 |\n+|`fhirServer/bulkdata/isCosClientUseFhirServerTrustStore`|boolean| If use fhir server TrustStore to access S3/IBMCOS service |", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjI1ODM0OA=="}, "originalCommit": {"oid": "01cd70bac22b23d63e1e1c0534c6fab547411593"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc4MDU3NDQ3OnYy", "diffSide": "RIGHT", "path": "docs/src/pages/guides/FHIRServerUsersGuide.md", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQxNTozNjo0NFrOGpldGg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQxNTozNjo0NFrOGpldGg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjI1ODQ1OA==", "bodyText": "Different name? useDefaultTrustStore", "url": "https://github.com/IBM/FHIR/pull/1274#discussion_r446258458", "createdAt": "2020-06-26T15:36:44Z", "author": {"login": "prb112"}, "path": "docs/src/pages/guides/FHIRServerUsersGuide.md", "diffHunk": "@@ -1538,6 +1539,7 @@ This section contains reference information about each of the configuration prop\n |`fhirServer/bulkdata/cosFileMaxResources`|500000|\n |`fhirServer/bulkdata/cosFileMaxSize`|209715200|\n |`fhirServer/bulkdata/patientExportPageSize`|200|\n+|`fhirServer/bulkdata/isCosClientUseFhirServerTrustStore`|false|", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "01cd70bac22b23d63e1e1c0534c6fab547411593"}, "originalPosition": 12}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc4MDU3NDY4OnYy", "diffSide": "RIGHT", "path": "docs/src/pages/guides/FHIRServerUsersGuide.md", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQxNTozNjo0OVrOGpldQA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQxNTozNjo0OVrOGpldQA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjI1ODQ5Ng==", "bodyText": "Different name? useDefaultTrustStore", "url": "https://github.com/IBM/FHIR/pull/1274#discussion_r446258496", "createdAt": "2020-06-26T15:36:49Z", "author": {"login": "prb112"}, "path": "docs/src/pages/guides/FHIRServerUsersGuide.md", "diffHunk": "@@ -1605,6 +1607,7 @@ must restart the server for that change to take effect.\n |`fhirServer/bulkdata/cosFileMaxResources`|Y|Y|\n |`fhirServer/bulkdata/cosFileMaxSize`|Y|Y|\n |`fhirServer/bulkdata/patientExportPageSize`|Y|Y|\n+|`fhirServer/bulkdata/isCosClientUseFhirServerTrustStore`|Y|Y|", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "01cd70bac22b23d63e1e1c0534c6fab547411593"}, "originalPosition": 20}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc4MDU3OTk0OnYy", "diffSide": "RIGHT", "path": "build/pre-integration-test-docker.sh", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQxNTozODoyNlrOGplghw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQxNTozODoyNlrOGplghw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjI1OTMzNQ==", "bodyText": "maybe pull directly from ${WORKSPACE}/fhir-server-test/src/test/resources/testdata/import-operation/test-import.ndjson", "url": "https://github.com/IBM/FHIR/pull/1274#discussion_r446259335", "createdAt": "2020-06-26T15:38:26Z", "author": {"login": "prb112"}, "path": "build/pre-integration-test-docker.sh", "diffHunk": "@@ -36,6 +42,14 @@ echo \"Deploying the Db2 schema...\"\n # Note: this adds the tenant key to the server config file so make sure thats set up first\n ./deploySchemaAndTenant.sh\n \n+mkdir -p minio/miniodata/fhirbulkdata\n+cp ./minio/test-import.ndjson ./minio/miniodata/fhirbulkdata", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "01cd70bac22b23d63e1e1c0534c6fab547411593"}, "originalPosition": 18}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc4MDU4NDQzOnYy", "diffSide": "RIGHT", "path": "fhir-bulkimportexport-webapp/src/main/java/com/ibm/fhir/jbatch/bulkdata/common/BulkDataUtils.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQxNTozOTo0MlrOGpljTA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQxNTozOTo0MlrOGpljTA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjI2MDA0NA==", "bodyText": "isUse is hard to read\nI suggest just using use\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        String cosEndpointUrl, String cosLocation, boolean isUseFhirServerTrustStore) {\n          \n          \n            \n                        String cosEndpointUrl, String cosLocation, boolean useFhirServerTrustStore) {", "url": "https://github.com/IBM/FHIR/pull/1274#discussion_r446260044", "createdAt": "2020-06-26T15:39:42Z", "author": {"login": "prb112"}, "path": "fhir-bulkimportexport-webapp/src/main/java/com/ibm/fhir/jbatch/bulkdata/common/BulkDataUtils.java", "diffHunk": "@@ -107,7 +110,7 @@ public static String startPartUpload(AmazonS3 cosClient, String bucketName, Stri\n     }\n \n     public static AmazonS3 getCosClient(String cosCredentialIbm, String cosApiKeyProperty, String cosSrvinstId,\n-            String cosEndpointUrl, String cosLocation) {\n+            String cosEndpointUrl, String cosLocation, boolean isUseFhirServerTrustStore) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "01cd70bac22b23d63e1e1c0534c6fab547411593"}, "originalPosition": 15}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc4MDU4NTcwOnYy", "diffSide": "RIGHT", "path": "fhir-bulkimportexport-webapp/src/main/java/com/ibm/fhir/jbatch/bulkdata/common/BulkDataUtils.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQxNTo0MDowMlrOGplkFA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQxNTo0MDowMlrOGplkFA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjI2MDI0NA==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    if (isUseFhirServerTrustStore) {\n          \n          \n            \n                    if (useFhirServerTrustStore) {", "url": "https://github.com/IBM/FHIR/pull/1274#discussion_r446260244", "createdAt": "2020-06-26T15:40:02Z", "author": {"login": "prb112"}, "path": "fhir-bulkimportexport-webapp/src/main/java/com/ibm/fhir/jbatch/bulkdata/common/BulkDataUtils.java", "diffHunk": "@@ -121,6 +124,14 @@ public static AmazonS3 getCosClient(String cosCredentialIbm, String cosApiKeyPro\n                 .withTcpKeepAlive(true)\n                 .withSocketTimeout(Constants.COS_SOCKET_TIMEOUT);\n \n+        if (isUseFhirServerTrustStore) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "01cd70bac22b23d63e1e1c0534c6fab547411593"}, "originalPosition": 23}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc4MDU4OTQ2OnYy", "diffSide": "RIGHT", "path": "fhir-bulkimportexport-webapp/src/main/java/com/ibm/fhir/jbatch/bulkdata/export/system/ChunkWriter.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQxNTo0MTowOVrOGplmdg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQxNTo0MTowOVrOGplmdg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjI2MDg1NA==", "bodyText": "this variable is hard to read.\nuseFhirServerTrustStore and update the FHIRConfiguration", "url": "https://github.com/IBM/FHIR/pull/1274#discussion_r446260854", "createdAt": "2020-06-26T15:41:09Z", "author": {"login": "prb112"}, "path": "fhir-bulkimportexport-webapp/src/main/java/com/ibm/fhir/jbatch/bulkdata/export/system/ChunkWriter.java", "diffHunk": "@@ -209,6 +199,17 @@ public void writeItems(List<java.lang.Object> arg0) throws Exception {\n     @Override\n     public void open(Serializable checkpoint) throws Exception  {\n         isExportPublic = FHIRConfigHelper.getBooleanProperty(FHIRConfiguration.PROPERTY_BULKDATA_BATCHJOB_ISEXPORTPUBLIC, true);\n-\n+        boolean isCosClientUseFhirServerTrustStore = FHIRConfigHelper\n+            .getBooleanProperty(FHIRConfiguration.PROPERTY_BULKDATA_BATCHJOB_ISCOSCLIENTUSEFHIRSERVERTRUSTSTORE, false);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "01cd70bac22b23d63e1e1c0534c6fab547411593"}, "originalPosition": 23}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc4MDU5NjUwOnYy", "diffSide": "RIGHT", "path": "fhir-bulkimportexport-webapp/src/main/java/com/ibm/fhir/jbatch/bulkdata/load/ChunkReader.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQxNTo0MzowM1rOGplqww==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQxNTo0MzowM1rOGplqww==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjI2MTk1NQ==", "bodyText": "consistent with my other comment, it's hard to read", "url": "https://github.com/IBM/FHIR/pull/1274#discussion_r446261955", "createdAt": "2020-06-26T15:43:03Z", "author": {"login": "prb112"}, "path": "fhir-bulkimportexport-webapp/src/main/java/com/ibm/fhir/jbatch/bulkdata/load/ChunkReader.java", "diffHunk": "@@ -156,7 +173,23 @@ public Object readItem() throws Exception {\n     public void open(Serializable checkpoint) throws Exception {\n         if (BulkImportDataSourceStorageType.from(dataSourceStorageType).equals(BulkImportDataSourceStorageType.AWSS3)\n                 || BulkImportDataSourceStorageType.from(dataSourceStorageType).equals(BulkImportDataSourceStorageType.IBMCOS)) {\n-            cosClient = BulkDataUtils.getCosClient(cosCredentialIbm, cosApiKeyProperty, cosSrvinstId, cosEndpointUrl, cosLocation);\n+\n+            if (fhirTenant == null) {\n+                fhirTenant = \"default\";\n+                logger.info(\"open: Set tenant to default!\");\n+            }\n+            if (fhirDatastoreId == null) {\n+                fhirDatastoreId = Constants.DEFAULT_FHIR_TENANT;\n+                logger.info(\"open: Set DatastoreId to default!\");\n+            }\n+\n+            FHIRRequestContext.set(new FHIRRequestContext(fhirTenant, fhirDatastoreId));\n+            boolean isCosClientUseFhirServerTrustStore = FHIRConfigHelper\n+                .getBooleanProperty(FHIRConfiguration.PROPERTY_BULKDATA_BATCHJOB_ISCOSCLIENTUSEFHIRSERVERTRUSTSTORE, false);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "01cd70bac22b23d63e1e1c0534c6fab547411593"}, "originalPosition": 48}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc4MDYwMDQyOnYy", "diffSide": "RIGHT", "path": "fhir-bulkimportexport-webapp/src/main/java/com/ibm/fhir/jbatch/bulkdata/load/ChunkWriter.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQxNTo0NDoyMVrOGpltYQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQxNTo1MDoxNFrOGpl6RQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjI2MjYyNQ==", "bodyText": "this is fixed, or configurable?", "url": "https://github.com/IBM/FHIR/pull/1274#discussion_r446262625", "createdAt": "2020-06-26T15:44:21Z", "author": {"login": "prb112"}, "path": "fhir-bulkimportexport-webapp/src/main/java/com/ibm/fhir/jbatch/bulkdata/load/ChunkWriter.java", "diffHunk": "@@ -286,4 +263,33 @@ private void pushImportOperationOutcomes2COS(ImportTransientUserData chunkData)\n             chunkData.getBufferStreamForImportError().reset();\n         }\n     }\n+    \n+    @Override\n+    public void open(Serializable checkpoint) throws Exception {\n+        if (fhirValidation != null) {\n+            isValidationOn = fhirValidation.equalsIgnoreCase(\"Y\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "01cd70bac22b23d63e1e1c0534c6fab547411593"}, "originalPosition": 76}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjI2NTkyNQ==", "bodyText": "this is configurable through job parameter, if without setting in job parameter, then the default value false is used at present.\nI don't think we need to add it to the job parameter of the job operation, I think we can simply change the default value to true directly if need instead of adding a new config.", "url": "https://github.com/IBM/FHIR/pull/1274#discussion_r446265925", "createdAt": "2020-06-26T15:50:14Z", "author": {"login": "albertwang-ibm"}, "path": "fhir-bulkimportexport-webapp/src/main/java/com/ibm/fhir/jbatch/bulkdata/load/ChunkWriter.java", "diffHunk": "@@ -286,4 +263,33 @@ private void pushImportOperationOutcomes2COS(ImportTransientUserData chunkData)\n             chunkData.getBufferStreamForImportError().reset();\n         }\n     }\n+    \n+    @Override\n+    public void open(Serializable checkpoint) throws Exception {\n+        if (fhirValidation != null) {\n+            isValidationOn = fhirValidation.equalsIgnoreCase(\"Y\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjI2MjYyNQ=="}, "originalCommit": {"oid": "01cd70bac22b23d63e1e1c0534c6fab547411593"}, "originalPosition": 76}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc4MDYxODU0OnYy", "diffSide": "RIGHT", "path": "fhir-config/src/main/java/com/ibm/fhir/config/FHIRConfiguration.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQxNTo0OTozMlrOGpl4wg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQxNTo1MDo1MFrOGpl7lg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjI2NTUzOA==", "bodyText": "hard to consume the constant name.   use/is - select one\nisCosClientUseFhirServerTrustStore should be simplified", "url": "https://github.com/IBM/FHIR/pull/1274#discussion_r446265538", "createdAt": "2020-06-26T15:49:32Z", "author": {"login": "prb112"}, "path": "fhir-config/src/main/java/com/ibm/fhir/config/FHIRConfiguration.java", "diffHunk": "@@ -96,6 +96,8 @@\n     public static final String PROPERTY_BULKDATA_BATCHJOB_BATCHTRUSTSTORE = \"fhirServer/bulkdata/batch-truststore\";\n     public static final String PROPERTY_BULKDATA_BATCHJOB_BATCHTRUSTSTOREPWD = \"fhirServer/bulkdata/batch-truststore-password\";\n     public static final String PROPERTY_BULKDATA_BATCHJOB_ISEXPORTPUBLIC = \"fhirServer/bulkdata/isExportPublic\";\n+    public static final String PROPERTY_BULKDATA_BATCHJOB_ISCOSCLIENTUSEFHIRSERVERTRUSTSTORE = \"fhirServer/bulkdata/isCosClientUseFhirServerTrustStore\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "01cd70bac22b23d63e1e1c0534c6fab547411593"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjI2NjI2Mg==", "bodyText": "will change them all to useFhirServerTrustStore :)", "url": "https://github.com/IBM/FHIR/pull/1274#discussion_r446266262", "createdAt": "2020-06-26T15:50:50Z", "author": {"login": "albertwang-ibm"}, "path": "fhir-config/src/main/java/com/ibm/fhir/config/FHIRConfiguration.java", "diffHunk": "@@ -96,6 +96,8 @@\n     public static final String PROPERTY_BULKDATA_BATCHJOB_BATCHTRUSTSTORE = \"fhirServer/bulkdata/batch-truststore\";\n     public static final String PROPERTY_BULKDATA_BATCHJOB_BATCHTRUSTSTOREPWD = \"fhirServer/bulkdata/batch-truststore-password\";\n     public static final String PROPERTY_BULKDATA_BATCHJOB_ISEXPORTPUBLIC = \"fhirServer/bulkdata/isExportPublic\";\n+    public static final String PROPERTY_BULKDATA_BATCHJOB_ISCOSCLIENTUSEFHIRSERVERTRUSTSTORE = \"fhirServer/bulkdata/isCosClientUseFhirServerTrustStore\";", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjI2NTUzOA=="}, "originalCommit": {"oid": "01cd70bac22b23d63e1e1c0534c6fab547411593"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc4MDYzMzkzOnYy", "diffSide": "RIGHT", "path": "fhir-server-test/src/test/java/com/ibm/fhir/server/test/bulkdata/ExportOperationTest.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQxNTo1Mzo0N1rOGpmCCQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQxNTo1OTo0N1rOGpmP1g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjI2NzkxMw==", "bodyText": "Why do you have to specify the tenantName/DatastoreId?", "url": "https://github.com/IBM/FHIR/pull/1274#discussion_r446267913", "createdAt": "2020-06-26T15:53:47Z", "author": {"login": "prb112"}, "path": "fhir-server-test/src/test/java/com/ibm/fhir/server/test/bulkdata/ExportOperationTest.java", "diffHunk": "@@ -55,19 +56,29 @@\n     public static final String BASE_VALID_URL = \"/$export\";\n     public static final String BASE_VALID_STATUS_URL = \"/$bulkdata-status\";\n     public static final String FORMAT = \"application/fhir+ndjson\";\n+    private final String tenantName = \"default\";\n+    private final String dataStoreId = \"default\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "01cd70bac22b23d63e1e1c0534c6fab547411593"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjI3MTQ0Ng==", "bodyText": "this is used for my local tests to make sure the per tenant configures for bulkdata working correctly.  example, I used \"default\" + \"default\", \"postgresql\" + \"default\" etc in my tests.", "url": "https://github.com/IBM/FHIR/pull/1274#discussion_r446271446", "createdAt": "2020-06-26T15:59:47Z", "author": {"login": "albertwang-ibm"}, "path": "fhir-server-test/src/test/java/com/ibm/fhir/server/test/bulkdata/ExportOperationTest.java", "diffHunk": "@@ -55,19 +56,29 @@\n     public static final String BASE_VALID_URL = \"/$export\";\n     public static final String BASE_VALID_STATUS_URL = \"/$bulkdata-status\";\n     public static final String FORMAT = \"application/fhir+ndjson\";\n+    private final String tenantName = \"default\";\n+    private final String dataStoreId = \"default\";", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjI2NzkxMw=="}, "originalCommit": {"oid": "01cd70bac22b23d63e1e1c0534c6fab547411593"}, "originalPosition": 13}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc4MDk2MDYwOnYy", "diffSide": "RIGHT", "path": "docs/src/pages/guides/FHIRServerUsersGuide.md", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQxNzozODo1N1rOGppSew==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yN1QyMzo1Njo1N1rOGp5HYg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjMyMTI3NQ==", "bodyText": "I think I'd rather see this default to true.  I think its much simpler to have a single trustStore used by the whole server.  Then we should make sure our sample configs don't have trustStore settings sprinkled all over.", "url": "https://github.com/IBM/FHIR/pull/1274#discussion_r446321275", "createdAt": "2020-06-26T17:38:57Z", "author": {"login": "lmsurpre"}, "path": "docs/src/pages/guides/FHIRServerUsersGuide.md", "diffHunk": "@@ -1538,6 +1539,7 @@ This section contains reference information about each of the configuration prop\n |`fhirServer/bulkdata/cosFileMaxResources`|500000|\n |`fhirServer/bulkdata/cosFileMaxSize`|209715200|\n |`fhirServer/bulkdata/patientExportPageSize`|200|\n+|`fhirServer/bulkdata/useFhirServerTrustStore`|false|", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6d346a86c8195acb50533c17172916071d97b9cc"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjU4MDU3OA==", "bodyText": "we can not, set to true will fail S3/IBM COS. because there is no public CAs in our truststore.", "url": "https://github.com/IBM/FHIR/pull/1274#discussion_r446580578", "createdAt": "2020-06-27T23:56:57Z", "author": {"login": "albertwang-ibm"}, "path": "docs/src/pages/guides/FHIRServerUsersGuide.md", "diffHunk": "@@ -1538,6 +1539,7 @@ This section contains reference information about each of the configuration prop\n |`fhirServer/bulkdata/cosFileMaxResources`|500000|\n |`fhirServer/bulkdata/cosFileMaxSize`|209715200|\n |`fhirServer/bulkdata/patientExportPageSize`|200|\n+|`fhirServer/bulkdata/useFhirServerTrustStore`|false|", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjMyMTI3NQ=="}, "originalCommit": {"oid": "6d346a86c8195acb50533c17172916071d97b9cc"}, "originalPosition": 12}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc4MDk2NDM3OnYy", "diffSide": "RIGHT", "path": "fhir-bulkimportexport-webapp/src/main/java/META-INF/batch-jobs/FhirBulkImportChunkJob.xml", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQxNzo0MDoxMFrOGppU0Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yN1QyMzo1ODowOVrOGp5Hqw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjMyMTg3Mw==", "bodyText": "how were we passing these before?  does adding them here fix an issue we had?", "url": "https://github.com/IBM/FHIR/pull/1274#discussion_r446321873", "createdAt": "2020-06-26T17:40:10Z", "author": {"login": "lmsurpre"}, "path": "fhir-bulkimportexport-webapp/src/main/java/META-INF/batch-jobs/FhirBulkImportChunkJob.xml", "diffHunk": "@@ -14,6 +14,8 @@\n         <chunk checkpoint-policy=\"item\" item-count=\"#{jobProperties['fhir.cosreadsperdbbatch']}\">\n             <reader ref=\"com.ibm.fhir.jbatch.bulkdata.load.ChunkReader\">\n                 <properties>\n+                    <property name=\"fhir.tenant\" value=\"#{jobParameters['fhir.tenant']}\"/>\n+                    <property name=\"fhir.datastoreid\" value=\"#{jobParameters['fhir.datastoreid']}\"/>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6d346a86c8195acb50533c17172916071d97b9cc"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjU4MDY1MQ==", "bodyText": "this is for supporting the new per tenant config, not needed before.", "url": "https://github.com/IBM/FHIR/pull/1274#discussion_r446580651", "createdAt": "2020-06-27T23:58:09Z", "author": {"login": "albertwang-ibm"}, "path": "fhir-bulkimportexport-webapp/src/main/java/META-INF/batch-jobs/FhirBulkImportChunkJob.xml", "diffHunk": "@@ -14,6 +14,8 @@\n         <chunk checkpoint-policy=\"item\" item-count=\"#{jobProperties['fhir.cosreadsperdbbatch']}\">\n             <reader ref=\"com.ibm.fhir.jbatch.bulkdata.load.ChunkReader\">\n                 <properties>\n+                    <property name=\"fhir.tenant\" value=\"#{jobParameters['fhir.tenant']}\"/>\n+                    <property name=\"fhir.datastoreid\" value=\"#{jobParameters['fhir.datastoreid']}\"/>", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjMyMTg3Mw=="}, "originalCommit": {"oid": "6d346a86c8195acb50533c17172916071d97b9cc"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc4MDk2NzMxOnYy", "diffSide": "RIGHT", "path": "fhir-bulkimportexport-webapp/src/main/java/com/ibm/fhir/jbatch/bulkdata/export/system/ChunkWriter.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQxNzo0MToxMVrOGppWig==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yN1QyMzo1ODozMlrOGp5HvQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjMyMjMxNA==", "bodyText": "I'd prefer to make the default true", "url": "https://github.com/IBM/FHIR/pull/1274#discussion_r446322314", "createdAt": "2020-06-26T17:41:11Z", "author": {"login": "lmsurpre"}, "path": "fhir-bulkimportexport-webapp/src/main/java/com/ibm/fhir/jbatch/bulkdata/export/system/ChunkWriter.java", "diffHunk": "@@ -209,6 +199,17 @@ public void writeItems(List<java.lang.Object> arg0) throws Exception {\n     @Override\n     public void open(Serializable checkpoint) throws Exception  {\n         isExportPublic = FHIRConfigHelper.getBooleanProperty(FHIRConfiguration.PROPERTY_BULKDATA_BATCHJOB_ISEXPORTPUBLIC, true);\n-\n+        boolean isCosClientUseFhirServerTrustStore = FHIRConfigHelper\n+            .getBooleanProperty(FHIRConfiguration.PROPERTY_BULKDATA_BATCHJOB_USEFHIRSERVERTRUSTSTORE, false);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6d346a86c8195acb50533c17172916071d97b9cc"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjU4MDY2OQ==", "bodyText": "as mentioned above, we can not.", "url": "https://github.com/IBM/FHIR/pull/1274#discussion_r446580669", "createdAt": "2020-06-27T23:58:32Z", "author": {"login": "albertwang-ibm"}, "path": "fhir-bulkimportexport-webapp/src/main/java/com/ibm/fhir/jbatch/bulkdata/export/system/ChunkWriter.java", "diffHunk": "@@ -209,6 +199,17 @@ public void writeItems(List<java.lang.Object> arg0) throws Exception {\n     @Override\n     public void open(Serializable checkpoint) throws Exception  {\n         isExportPublic = FHIRConfigHelper.getBooleanProperty(FHIRConfiguration.PROPERTY_BULKDATA_BATCHJOB_ISEXPORTPUBLIC, true);\n-\n+        boolean isCosClientUseFhirServerTrustStore = FHIRConfigHelper\n+            .getBooleanProperty(FHIRConfiguration.PROPERTY_BULKDATA_BATCHJOB_USEFHIRSERVERTRUSTSTORE, false);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjMyMjMxNA=="}, "originalCommit": {"oid": "6d346a86c8195acb50533c17172916071d97b9cc"}, "originalPosition": 23}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc4MDk3MDEwOnYy", "diffSide": "RIGHT", "path": "fhir-bulkimportexport-webapp/src/main/java/com/ibm/fhir/jbatch/bulkdata/load/ChunkWriter.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQxNzo0MTo1M1rOGppYJw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yN1QyMzo1OTozM1rOGp5IAw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjMyMjcyNw==", "bodyText": "I'd prefer to make the default true", "url": "https://github.com/IBM/FHIR/pull/1274#discussion_r446322727", "createdAt": "2020-06-26T17:41:53Z", "author": {"login": "lmsurpre"}, "path": "fhir-bulkimportexport-webapp/src/main/java/com/ibm/fhir/jbatch/bulkdata/load/ChunkWriter.java", "diffHunk": "@@ -286,4 +263,33 @@ private void pushImportOperationOutcomes2COS(ImportTransientUserData chunkData)\n             chunkData.getBufferStreamForImportError().reset();\n         }\n     }\n+    \n+    @Override\n+    public void open(Serializable checkpoint) throws Exception {\n+        if (fhirValidation != null) {\n+            isValidationOn = fhirValidation.equalsIgnoreCase(\"Y\");\n+        }\n+        if (fhirTenant == null) {\n+            fhirTenant = \"default\";\n+            logger.info(\"open: Set tenant to default!\");\n+        }\n+        if (fhirDatastoreId == null) {\n+            fhirDatastoreId = Constants.DEFAULT_FHIR_TENANT;\n+            logger.info(\"open: Set DatastoreId to default!\");\n+        }\n+\n+        FHIRRequestContext.set(new FHIRRequestContext(fhirTenant, fhirDatastoreId));\n+        boolean isCosClientUseFhirServerTrustStore = FHIRConfigHelper\n+            .getBooleanProperty(FHIRConfiguration.PROPERTY_BULKDATA_BATCHJOB_USEFHIRSERVERTRUSTSTORE, false);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6d346a86c8195acb50533c17172916071d97b9cc"}, "originalPosition": 89}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjU4MDczOQ==", "bodyText": "as mentioned above, this will break S3 and IBM COS services which use public CAs instead of self signed certs.", "url": "https://github.com/IBM/FHIR/pull/1274#discussion_r446580739", "createdAt": "2020-06-27T23:59:33Z", "author": {"login": "albertwang-ibm"}, "path": "fhir-bulkimportexport-webapp/src/main/java/com/ibm/fhir/jbatch/bulkdata/load/ChunkWriter.java", "diffHunk": "@@ -286,4 +263,33 @@ private void pushImportOperationOutcomes2COS(ImportTransientUserData chunkData)\n             chunkData.getBufferStreamForImportError().reset();\n         }\n     }\n+    \n+    @Override\n+    public void open(Serializable checkpoint) throws Exception {\n+        if (fhirValidation != null) {\n+            isValidationOn = fhirValidation.equalsIgnoreCase(\"Y\");\n+        }\n+        if (fhirTenant == null) {\n+            fhirTenant = \"default\";\n+            logger.info(\"open: Set tenant to default!\");\n+        }\n+        if (fhirDatastoreId == null) {\n+            fhirDatastoreId = Constants.DEFAULT_FHIR_TENANT;\n+            logger.info(\"open: Set DatastoreId to default!\");\n+        }\n+\n+        FHIRRequestContext.set(new FHIRRequestContext(fhirTenant, fhirDatastoreId));\n+        boolean isCosClientUseFhirServerTrustStore = FHIRConfigHelper\n+            .getBooleanProperty(FHIRConfiguration.PROPERTY_BULKDATA_BATCHJOB_USEFHIRSERVERTRUSTSTORE, false);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjMyMjcyNw=="}, "originalCommit": {"oid": "6d346a86c8195acb50533c17172916071d97b9cc"}, "originalPosition": 89}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc4MDk3NzgwOnYy", "diffSide": "RIGHT", "path": "fhir-server/liberty-config/config/default/fhir-server-config.json", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQxNzo0NDozMlrOGppdFg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yN1QyMzo1OTo0NFrOGp5ICA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjMyMzk5MA==", "bodyText": "I think I'd prefer to make the default true.", "url": "https://github.com/IBM/FHIR/pull/1274#discussion_r446323990", "createdAt": "2020-06-26T17:44:32Z", "author": {"login": "lmsurpre"}, "path": "fhir-server/liberty-config/config/default/fhir-server-config.json", "diffHunk": "@@ -145,7 +145,8 @@\n             \"isExportPublic\": true,\n             \"cosFileMaxResources\": 500000,\n             \"cosFileMaxSize\": 209715200,\n-            \"validBaseUrls\": []\n+            \"validBaseUrls\": [],\n+            \"useFhirServerTrustStore\": false", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6d346a86c8195acb50533c17172916071d97b9cc"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjU4MDc0NA==", "bodyText": "same", "url": "https://github.com/IBM/FHIR/pull/1274#discussion_r446580744", "createdAt": "2020-06-27T23:59:44Z", "author": {"login": "albertwang-ibm"}, "path": "fhir-server/liberty-config/config/default/fhir-server-config.json", "diffHunk": "@@ -145,7 +145,8 @@\n             \"isExportPublic\": true,\n             \"cosFileMaxResources\": 500000,\n             \"cosFileMaxSize\": 209715200,\n-            \"validBaseUrls\": []\n+            \"validBaseUrls\": [],\n+            \"useFhirServerTrustStore\": false", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjMyMzk5MA=="}, "originalCommit": {"oid": "6d346a86c8195acb50533c17172916071d97b9cc"}, "originalPosition": 6}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc4MDk5NDY1OnYy", "diffSide": "RIGHT", "path": "fhir-server-test/src/test/java/com/ibm/fhir/server/test/bulkdata/ExportOperationTest.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQxNzo1MDoxNVrOGppnnQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yOFQwMDowMDowOFrOGp5IRQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjMyNjY4NQ==", "bodyText": "why client2 ?", "url": "https://github.com/IBM/FHIR/pull/1274#discussion_r446326685", "createdAt": "2020-06-26T17:50:15Z", "author": {"login": "lmsurpre"}, "path": "fhir-server-test/src/test/java/com/ibm/fhir/server/test/bulkdata/ExportOperationTest.java", "diffHunk": "@@ -153,7 +167,53 @@ public WebTarget addQueryParameter(WebTarget target, String header, String val)\n     public Response doGet(String path, String mimeType) {\n         WebTarget target = getWebTarget();\n         target = target.path(path);\n-        return target.request(mimeType).get(Response.class);\n+        return target.request(mimeType)\n+                .header(\"X-FHIR-TENANT-ID\", tenantName)\n+                .header(\"X-FHIR-DSID\", dataStoreId)\n+                .get(Response.class);\n+    }\n+    \n+    private void verifyDownloadUrl(String downloadUrl) {\n+        // Minio doesn't support file level ACL using which we make can make the published file public, so we have to \n+        // get the token first, and then use the token to download the file. \n+        if (isUseMinio) {\n+            downloadUrl = downloadUrl.substring(8);\n+            String minioHost = downloadUrl.substring(0, downloadUrl.indexOf(\"/\"));\n+            String minioFilePath = downloadUrl.substring(minioHost.length());\n+            \n+            // If using minio in build pipeline, then we have to change the host name to \"localhost\" to all the\n+            // build machine to access the minio server via it.\n+            if (isUseMinioInBuildPipeline) {\n+                String[] minioHostArray = minioHost.split(\":\");\n+                minioHostArray[0] = \"localhost\";\n+                minioHost = String.join(\":\", minioHostArray);\n+            }\n+            \n+            String minioAuthUrl = \"https://\" + minioHost + \"/minio/webrpc\";\n+            String minioAuthRequestBody = \"{\\\"id\\\":1,\\\"jsonrpc\\\":\\\"2.0\\\",\\\"params\\\":{\\\"username\\\":\\\"\" \n+                + minioUserName  + \"\\\",\\\"password\\\":\\\"\" + minioPassword + \"\\\"},\\\"method\\\":\\\"Web.Login\\\"}\";\n+            \n+            WebTarget client2 = ClientBuilder.newBuilder().trustStore(client.getTrustStore()).build().target(minioAuthUrl);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6d346a86c8195acb50533c17172916071d97b9cc"}, "originalPosition": 82}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjU4MDgwNQ==", "bodyText": "the default test client", "url": "https://github.com/IBM/FHIR/pull/1274#discussion_r446580805", "createdAt": "2020-06-28T00:00:08Z", "author": {"login": "albertwang-ibm"}, "path": "fhir-server-test/src/test/java/com/ibm/fhir/server/test/bulkdata/ExportOperationTest.java", "diffHunk": "@@ -153,7 +167,53 @@ public WebTarget addQueryParameter(WebTarget target, String header, String val)\n     public Response doGet(String path, String mimeType) {\n         WebTarget target = getWebTarget();\n         target = target.path(path);\n-        return target.request(mimeType).get(Response.class);\n+        return target.request(mimeType)\n+                .header(\"X-FHIR-TENANT-ID\", tenantName)\n+                .header(\"X-FHIR-DSID\", dataStoreId)\n+                .get(Response.class);\n+    }\n+    \n+    private void verifyDownloadUrl(String downloadUrl) {\n+        // Minio doesn't support file level ACL using which we make can make the published file public, so we have to \n+        // get the token first, and then use the token to download the file. \n+        if (isUseMinio) {\n+            downloadUrl = downloadUrl.substring(8);\n+            String minioHost = downloadUrl.substring(0, downloadUrl.indexOf(\"/\"));\n+            String minioFilePath = downloadUrl.substring(minioHost.length());\n+            \n+            // If using minio in build pipeline, then we have to change the host name to \"localhost\" to all the\n+            // build machine to access the minio server via it.\n+            if (isUseMinioInBuildPipeline) {\n+                String[] minioHostArray = minioHost.split(\":\");\n+                minioHostArray[0] = \"localhost\";\n+                minioHost = String.join(\":\", minioHostArray);\n+            }\n+            \n+            String minioAuthUrl = \"https://\" + minioHost + \"/minio/webrpc\";\n+            String minioAuthRequestBody = \"{\\\"id\\\":1,\\\"jsonrpc\\\":\\\"2.0\\\",\\\"params\\\":{\\\"username\\\":\\\"\" \n+                + minioUserName  + \"\\\",\\\"password\\\":\\\"\" + minioPassword + \"\\\"},\\\"method\\\":\\\"Web.Login\\\"}\";\n+            \n+            WebTarget client2 = ClientBuilder.newBuilder().trustStore(client.getTrustStore()).build().target(minioAuthUrl);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjMyNjY4NQ=="}, "originalCommit": {"oid": "6d346a86c8195acb50533c17172916071d97b9cc"}, "originalPosition": 82}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc4MTAwMDQxOnYy", "diffSide": "RIGHT", "path": "fhir-server-test/src/test/java/com/ibm/fhir/server/test/bulkdata/ExportOperationTest.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQxNzo1MjoxNVrOGpprMg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yOFQwMDoxMDo1OVrOGp5L0Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjMyNzYwMg==", "bodyText": "this would be a good limitation for us to document if we ever advertise our support for Minio", "url": "https://github.com/IBM/FHIR/pull/1274#discussion_r446327602", "createdAt": "2020-06-26T17:52:15Z", "author": {"login": "lmsurpre"}, "path": "fhir-server-test/src/test/java/com/ibm/fhir/server/test/bulkdata/ExportOperationTest.java", "diffHunk": "@@ -153,7 +167,53 @@ public WebTarget addQueryParameter(WebTarget target, String header, String val)\n     public Response doGet(String path, String mimeType) {\n         WebTarget target = getWebTarget();\n         target = target.path(path);\n-        return target.request(mimeType).get(Response.class);\n+        return target.request(mimeType)\n+                .header(\"X-FHIR-TENANT-ID\", tenantName)\n+                .header(\"X-FHIR-DSID\", dataStoreId)\n+                .get(Response.class);\n+    }\n+    \n+    private void verifyDownloadUrl(String downloadUrl) {\n+        // Minio doesn't support file level ACL using which we make can make the published file public, so we have to \n+        // get the token first, and then use the token to download the file. ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6d346a86c8195acb50533c17172916071d97b9cc"}, "originalPosition": 64}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjU4MTcxMw==", "bodyText": "updated user guide.", "url": "https://github.com/IBM/FHIR/pull/1274#discussion_r446581713", "createdAt": "2020-06-28T00:10:59Z", "author": {"login": "albertwang-ibm"}, "path": "fhir-server-test/src/test/java/com/ibm/fhir/server/test/bulkdata/ExportOperationTest.java", "diffHunk": "@@ -153,7 +167,53 @@ public WebTarget addQueryParameter(WebTarget target, String header, String val)\n     public Response doGet(String path, String mimeType) {\n         WebTarget target = getWebTarget();\n         target = target.path(path);\n-        return target.request(mimeType).get(Response.class);\n+        return target.request(mimeType)\n+                .header(\"X-FHIR-TENANT-ID\", tenantName)\n+                .header(\"X-FHIR-DSID\", dataStoreId)\n+                .get(Response.class);\n+    }\n+    \n+    private void verifyDownloadUrl(String downloadUrl) {\n+        // Minio doesn't support file level ACL using which we make can make the published file public, so we have to \n+        // get the token first, and then use the token to download the file. ", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjMyNzYwMg=="}, "originalCommit": {"oid": "6d346a86c8195acb50533c17172916071d97b9cc"}, "originalPosition": 64}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc4MTAxMTY2OnYy", "diffSide": "RIGHT", "path": "fhir-server-test/src/test/java/com/ibm/fhir/server/test/bulkdata/ExportOperationTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQxNzo1NjowOFrOGppyfQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQxNzo1NjowOFrOGppyfQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjMyOTQ2OQ==", "bodyText": "I'm still not sure how I feel about expanding our use of test.properties.  That properties file was originally just the client properties (used to instantiate FHIRClient).  I guess its OK though.", "url": "https://github.com/IBM/FHIR/pull/1274#discussion_r446329469", "createdAt": "2020-06-26T17:56:08Z", "author": {"login": "lmsurpre"}, "path": "fhir-server-test/src/test/java/com/ibm/fhir/server/test/bulkdata/ExportOperationTest.java", "diffHunk": "@@ -55,19 +56,29 @@\n     public static final String BASE_VALID_URL = \"/$export\";\n     public static final String BASE_VALID_STATUS_URL = \"/$bulkdata-status\";\n     public static final String FORMAT = \"application/fhir+ndjson\";\n+    private final String tenantName = \"default\";\n+    private final String dataStoreId = \"default\";\n \n     // Disabled by default\n     private static boolean ON = false;\n+    private static boolean isUseMinio = false;\n+    private static boolean isUseMinioInBuildPipeline = false;\n \n     public static final boolean DEBUG = false;\n     private String exportStatusUrl;\n     private String savedPatientId, savedPatientId2;\n     private String savedGroupId, savedGroupId2;\n-\n+    private String minioUserName;\n+    private String minioPassword;\n+  \n     @BeforeClass\n     public void setup() throws Exception {\n         Properties testProperties = TestUtil.readTestProperties(\"test.properties\");\n         ON = Boolean.parseBoolean(testProperties.getProperty(\"test.bulkdata.export.enabled\", \"false\"));\n+        isUseMinio = Boolean.parseBoolean(testProperties.getProperty(\"test.bulkdata.useminio\", \"false\"));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6d346a86c8195acb50533c17172916071d97b9cc"}, "originalPosition": 32}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4944, "cost": 1, "resetAt": "2021-11-13T12:10:21Z"}}}