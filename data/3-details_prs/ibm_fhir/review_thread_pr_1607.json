{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTA2ODk0MzY3", "number": 1607, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMVQxMzoyNzozOVrOEwP4MQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMVQxMzozMTozMlrOEwQDuw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE5MDI3MjQ5OnYy", "diffSide": "LEFT", "path": "fhir-database-utils/src/main/java/com/ibm/fhir/database/utils/postgresql/PostgreSqlTranslator.java", "isResolved": true, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMVQxMzoyNzozOVrOHlr-dQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMVQxNDowODoxOVrOHluXfQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTI3OTg2MQ==", "bodyText": "Maybe this should be an OR with\n42883 | undefined_function\n42P01 | undefined_table\n42P02 | undefined_parameter\n42704 | undefined_object", "url": "https://github.com/IBM/FHIR/pull/1607#discussion_r509279861", "createdAt": "2020-10-21T13:27:39Z", "author": {"login": "prb112"}, "path": "fhir-database-utils/src/main/java/com/ibm/fhir/database/utils/postgresql/PostgreSqlTranslator.java", "diffHunk": "@@ -113,7 +113,7 @@ public boolean isDuplicateSchema(SQLException x) {\n \n     @Override\n     public boolean isUndefinedName(SQLException x) {\n-        return \"42X05\".equals(x.getSQLState());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2ca04e41a866de3c261888d55a9c7f08f0f9bb99"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTI5MTg5NQ==", "bodyText": "empirically I found the 42704 is what we got back for undefined functions, tables, and indexes.  not sure how to reconcile that with the provided list, but its easy-enough for me to or them", "url": "https://github.com/IBM/FHIR/pull/1607#discussion_r509291895", "createdAt": "2020-10-21T13:40:09Z", "author": {"login": "lmsurpre"}, "path": "fhir-database-utils/src/main/java/com/ibm/fhir/database/utils/postgresql/PostgreSqlTranslator.java", "diffHunk": "@@ -113,7 +113,7 @@ public boolean isDuplicateSchema(SQLException x) {\n \n     @Override\n     public boolean isUndefinedName(SQLException x) {\n-        return \"42X05\".equals(x.getSQLState());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTI3OTg2MQ=="}, "originalCommit": {"oid": "2ca04e41a866de3c261888d55a9c7f08f0f9bb99"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTI5NjkwNg==", "bodyText": "I wasn't sure if we should or not, it was more of a check-in, not necessarily that we had to or-then", "url": "https://github.com/IBM/FHIR/pull/1607#discussion_r509296906", "createdAt": "2020-10-21T13:45:44Z", "author": {"login": "prb112"}, "path": "fhir-database-utils/src/main/java/com/ibm/fhir/database/utils/postgresql/PostgreSqlTranslator.java", "diffHunk": "@@ -113,7 +113,7 @@ public boolean isDuplicateSchema(SQLException x) {\n \n     @Override\n     public boolean isUndefinedName(SQLException x) {\n-        return \"42X05\".equals(x.getSQLState());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTI3OTg2MQ=="}, "originalCommit": {"oid": "2ca04e41a866de3c261888d55a9c7f08f0f9bb99"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTMxOTAzNw==", "bodyText": "ok, i went ahead and added them", "url": "https://github.com/IBM/FHIR/pull/1607#discussion_r509319037", "createdAt": "2020-10-21T14:08:19Z", "author": {"login": "lmsurpre"}, "path": "fhir-database-utils/src/main/java/com/ibm/fhir/database/utils/postgresql/PostgreSqlTranslator.java", "diffHunk": "@@ -113,7 +113,7 @@ public boolean isDuplicateSchema(SQLException x) {\n \n     @Override\n     public boolean isUndefinedName(SQLException x) {\n-        return \"42X05\".equals(x.getSQLState());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTI3OTg2MQ=="}, "originalCommit": {"oid": "2ca04e41a866de3c261888d55a9c7f08f0f9bb99"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE5MDI4MDM2OnYy", "diffSide": "RIGHT", "path": "fhir-persistence-schema/README.md", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMVQxMzoyODo1OVrOHlsD6w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMVQxNDoxMTo1MFrOHlui4g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTI4MTI1OQ==", "bodyText": "maybe we should add all three in this example, or mention in a comment below this update that you can use --drop-schema-oauth and jbatch?", "url": "https://github.com/IBM/FHIR/pull/1607#discussion_r509281259", "createdAt": "2020-10-21T13:28:59Z", "author": {"login": "prb112"}, "path": "fhir-persistence-schema/README.md", "diffHunk": "@@ -85,7 +85,7 @@ The following sections include common values for `OPTIONS`.\n ```\n --prop-file db2.properties\n --schema-name FHIRDATA\n---drop-schema\n+--drop-schema-fhir\n --drop-admin\n --confirm-drop\n ```", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2ca04e41a866de3c261888d55a9c7f08f0f9bb99"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTI5NTAzMw==", "bodyText": "sure, I can add the comment", "url": "https://github.com/IBM/FHIR/pull/1607#discussion_r509295033", "createdAt": "2020-10-21T13:44:06Z", "author": {"login": "lmsurpre"}, "path": "fhir-persistence-schema/README.md", "diffHunk": "@@ -85,7 +85,7 @@ The following sections include common values for `OPTIONS`.\n ```\n --prop-file db2.properties\n --schema-name FHIRDATA\n---drop-schema\n+--drop-schema-fhir\n --drop-admin\n --confirm-drop\n ```", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTI4MTI1OQ=="}, "originalCommit": {"oid": "2ca04e41a866de3c261888d55a9c7f08f0f9bb99"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTMyMTk1NA==", "bodyText": "ended up adding two different subsections; one for dropping just the fhir schema and one for dropping them all", "url": "https://github.com/IBM/FHIR/pull/1607#discussion_r509321954", "createdAt": "2020-10-21T14:11:50Z", "author": {"login": "lmsurpre"}, "path": "fhir-persistence-schema/README.md", "diffHunk": "@@ -85,7 +85,7 @@ The following sections include common values for `OPTIONS`.\n ```\n --prop-file db2.properties\n --schema-name FHIRDATA\n---drop-schema\n+--drop-schema-fhir\n --drop-admin\n --confirm-drop\n ```", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTI4MTI1OQ=="}, "originalCommit": {"oid": "2ca04e41a866de3c261888d55a9c7f08f0f9bb99"}, "originalPosition": 8}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE5MDI5MjUwOnYy", "diffSide": "RIGHT", "path": "fhir-persistence-schema/src/main/java/com/ibm/fhir/schema/app/Main.java", "isResolved": true, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMVQxMzozMDoxOVrOHlsLxA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMVQxMzo0NDo1OVrOHls9TA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTI4MzI2OA==", "bodyText": "is the adminDrop implicit here? what if we just call dropAdmin", "url": "https://github.com/IBM/FHIR/pull/1607#discussion_r509283268", "createdAt": "2020-10-21T13:30:19Z", "author": {"login": "prb112"}, "path": "fhir-persistence-schema/src/main/java/com/ibm/fhir/schema/app/Main.java", "diffHunk": "@@ -424,7 +423,7 @@ protected void dropSchema() {\n                     JdbcTarget target = new JdbcTarget(c);\n                     IDatabaseAdapter adapter = getDbAdapter(dbType, target);\n \n-                    if (this.dropSchema) {\n+                    if (dropFhirSchema || dropOauthSchema || dropJavaBatchSchema) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2ca04e41a866de3c261888d55a9c7f08f0f9bb99"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTI4OTgyOQ==", "bodyText": "dropAdmin is covered separately in the if case just below this", "url": "https://github.com/IBM/FHIR/pull/1607#discussion_r509289829", "createdAt": "2020-10-21T13:37:29Z", "author": {"login": "lmsurpre"}, "path": "fhir-persistence-schema/src/main/java/com/ibm/fhir/schema/app/Main.java", "diffHunk": "@@ -424,7 +423,7 @@ protected void dropSchema() {\n                     JdbcTarget target = new JdbcTarget(c);\n                     IDatabaseAdapter adapter = getDbAdapter(dbType, target);\n \n-                    if (this.dropSchema) {\n+                    if (dropFhirSchema || dropOauthSchema || dropJavaBatchSchema) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTI4MzI2OA=="}, "originalCommit": {"oid": "2ca04e41a866de3c261888d55a9c7f08f0f9bb99"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTI5NDE2MQ==", "bodyText": "I think we should (later) revisit the whole option control logic in this Main...too much entropy.", "url": "https://github.com/IBM/FHIR/pull/1607#discussion_r509294161", "createdAt": "2020-10-21T13:42:56Z", "author": {"login": "punktilious"}, "path": "fhir-persistence-schema/src/main/java/com/ibm/fhir/schema/app/Main.java", "diffHunk": "@@ -424,7 +423,7 @@ protected void dropSchema() {\n                     JdbcTarget target = new JdbcTarget(c);\n                     IDatabaseAdapter adapter = getDbAdapter(dbType, target);\n \n-                    if (this.dropSchema) {\n+                    if (dropFhirSchema || dropOauthSchema || dropJavaBatchSchema) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTI4MzI2OA=="}, "originalCommit": {"oid": "2ca04e41a866de3c261888d55a9c7f08f0f9bb99"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTI5NTk0OA==", "bodyText": "+1 on Robin's comment.  it's definitely growing", "url": "https://github.com/IBM/FHIR/pull/1607#discussion_r509295948", "createdAt": "2020-10-21T13:44:59Z", "author": {"login": "prb112"}, "path": "fhir-persistence-schema/src/main/java/com/ibm/fhir/schema/app/Main.java", "diffHunk": "@@ -424,7 +423,7 @@ protected void dropSchema() {\n                     JdbcTarget target = new JdbcTarget(c);\n                     IDatabaseAdapter adapter = getDbAdapter(dbType, target);\n \n-                    if (this.dropSchema) {\n+                    if (dropFhirSchema || dropOauthSchema || dropJavaBatchSchema) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTI4MzI2OA=="}, "originalCommit": {"oid": "2ca04e41a866de3c261888d55a9c7f08f0f9bb99"}, "originalPosition": 13}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE5MDMwMjAzOnYy", "diffSide": "RIGHT", "path": "fhir-persistence-schema/src/main/java/com/ibm/fhir/schema/app/Main.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMVQxMzozMTozMlrOHlsR5w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMVQxMzozMTozMlrOHlsR5w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTI4NDgzOQ==", "bodyText": "See 426", "url": "https://github.com/IBM/FHIR/pull/1607#discussion_r509284839", "createdAt": "2020-10-21T13:31:32Z", "author": {"login": "prb112"}, "path": "fhir-persistence-schema/src/main/java/com/ibm/fhir/schema/app/Main.java", "diffHunk": "@@ -1387,20 +1385,13 @@ protected void process() {\n \n         if (addKeyForTenant != null) {\n             addTenantKey();\n-        } else if (this.dropSchema) {\n+        } else if (this.dropAdmin || this.dropFhirSchema || this.dropJavaBatchSchema || this.dropOauthSchema) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2ca04e41a866de3c261888d55a9c7f08f0f9bb99"}, "originalPosition": 224}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4748, "cost": 1, "resetAt": "2021-11-13T12:10:21Z"}}}