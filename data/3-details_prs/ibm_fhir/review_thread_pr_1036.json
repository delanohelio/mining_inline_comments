{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE0MjQyNzg5", "number": 1036, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNlQxNzo1NToyOFrOD57iUQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNlQxNzo1NToyOFrOD57iUQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYyMDcwODY1OnYy", "diffSide": "RIGHT", "path": "fhir-persistence-jdbc/src/main/java/com/ibm/fhir/persistence/jdbc/dao/impl/FHIRDbDAOImpl.java", "isResolved": true, "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNlQxNzo1NToyOFrOGRewKw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNlQxODowMTozM1rOGRe_iw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDk4MjgyNw==", "bodyText": "should we handle dsPG == null situation?", "url": "https://github.com/IBM/FHIR/pull/1036#discussion_r420982827", "createdAt": "2020-05-06T17:55:28Z", "author": {"login": "albertwang-ibm"}, "path": "fhir-persistence-jdbc/src/main/java/com/ibm/fhir/persistence/jdbc/dao/impl/FHIRDbDAOImpl.java", "diffHunk": "@@ -247,6 +222,67 @@ public Connection getConnection() throws FHIRPersistenceDBConnectException {\n         }\n     }\n \n+    /**\n+     * this feature is executes row access control\n+     * \n+     * @param connection\n+     * @throws Exception\n+     */\n+    public void executeRowAccessFeature(Connection connection) throws Exception {\n+        // For the multi-tenant feature, configure the connection for the tenant by setting the sv_tenant_id.\n+        String tenantName = FHIRRequestContext.get().getTenantId();\n+        String tenantKey = null;\n+        String dsId = FHIRRequestContext.get().getDataStoreId();\n+        boolean multiTenantFeature = false;\n+\n+        // Retrieve the property group pertaining to the specified datastore.\n+        // Find and set the tenantKey for the request, otherwise subsequent pulls from the pool\n+        // miss the tenantKey.\n+        String dsPropertyName = FHIRConfiguration.PROPERTY_DATASOURCES + \"/\" + dsId;\n+        PropertyGroup dsPG = FHIRConfigHelper.getPropertyGroup(dsPropertyName);\n+        if (dsPG != null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6fece5b82ae7f814b60ab62ec64059a9eccc3bd7"}, "originalPosition": 82}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDk4NTY4OA==", "bodyText": "let me add a log", "url": "https://github.com/IBM/FHIR/pull/1036#discussion_r420985688", "createdAt": "2020-05-06T17:59:50Z", "author": {"login": "prb112"}, "path": "fhir-persistence-jdbc/src/main/java/com/ibm/fhir/persistence/jdbc/dao/impl/FHIRDbDAOImpl.java", "diffHunk": "@@ -247,6 +222,67 @@ public Connection getConnection() throws FHIRPersistenceDBConnectException {\n         }\n     }\n \n+    /**\n+     * this feature is executes row access control\n+     * \n+     * @param connection\n+     * @throws Exception\n+     */\n+    public void executeRowAccessFeature(Connection connection) throws Exception {\n+        // For the multi-tenant feature, configure the connection for the tenant by setting the sv_tenant_id.\n+        String tenantName = FHIRRequestContext.get().getTenantId();\n+        String tenantKey = null;\n+        String dsId = FHIRRequestContext.get().getDataStoreId();\n+        boolean multiTenantFeature = false;\n+\n+        // Retrieve the property group pertaining to the specified datastore.\n+        // Find and set the tenantKey for the request, otherwise subsequent pulls from the pool\n+        // miss the tenantKey.\n+        String dsPropertyName = FHIRConfiguration.PROPERTY_DATASOURCES + \"/\" + dsId;\n+        PropertyGroup dsPG = FHIRConfigHelper.getPropertyGroup(dsPropertyName);\n+        if (dsPG != null) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDk4MjgyNw=="}, "originalCommit": {"oid": "6fece5b82ae7f814b60ab62ec64059a9eccc3bd7"}, "originalPosition": 82}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDk4NjQ1MQ==", "bodyText": "and maybe a exception?", "url": "https://github.com/IBM/FHIR/pull/1036#discussion_r420986451", "createdAt": "2020-05-06T18:01:04Z", "author": {"login": "albertwang-ibm"}, "path": "fhir-persistence-jdbc/src/main/java/com/ibm/fhir/persistence/jdbc/dao/impl/FHIRDbDAOImpl.java", "diffHunk": "@@ -247,6 +222,67 @@ public Connection getConnection() throws FHIRPersistenceDBConnectException {\n         }\n     }\n \n+    /**\n+     * this feature is executes row access control\n+     * \n+     * @param connection\n+     * @throws Exception\n+     */\n+    public void executeRowAccessFeature(Connection connection) throws Exception {\n+        // For the multi-tenant feature, configure the connection for the tenant by setting the sv_tenant_id.\n+        String tenantName = FHIRRequestContext.get().getTenantId();\n+        String tenantKey = null;\n+        String dsId = FHIRRequestContext.get().getDataStoreId();\n+        boolean multiTenantFeature = false;\n+\n+        // Retrieve the property group pertaining to the specified datastore.\n+        // Find and set the tenantKey for the request, otherwise subsequent pulls from the pool\n+        // miss the tenantKey.\n+        String dsPropertyName = FHIRConfiguration.PROPERTY_DATASOURCES + \"/\" + dsId;\n+        PropertyGroup dsPG = FHIRConfigHelper.getPropertyGroup(dsPropertyName);\n+        if (dsPG != null) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDk4MjgyNw=="}, "originalCommit": {"oid": "6fece5b82ae7f814b60ab62ec64059a9eccc3bd7"}, "originalPosition": 82}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDk4NjUxNg==", "bodyText": "fixed, it's a good idea", "url": "https://github.com/IBM/FHIR/pull/1036#discussion_r420986516", "createdAt": "2020-05-06T18:01:08Z", "author": {"login": "prb112"}, "path": "fhir-persistence-jdbc/src/main/java/com/ibm/fhir/persistence/jdbc/dao/impl/FHIRDbDAOImpl.java", "diffHunk": "@@ -247,6 +222,67 @@ public Connection getConnection() throws FHIRPersistenceDBConnectException {\n         }\n     }\n \n+    /**\n+     * this feature is executes row access control\n+     * \n+     * @param connection\n+     * @throws Exception\n+     */\n+    public void executeRowAccessFeature(Connection connection) throws Exception {\n+        // For the multi-tenant feature, configure the connection for the tenant by setting the sv_tenant_id.\n+        String tenantName = FHIRRequestContext.get().getTenantId();\n+        String tenantKey = null;\n+        String dsId = FHIRRequestContext.get().getDataStoreId();\n+        boolean multiTenantFeature = false;\n+\n+        // Retrieve the property group pertaining to the specified datastore.\n+        // Find and set the tenantKey for the request, otherwise subsequent pulls from the pool\n+        // miss the tenantKey.\n+        String dsPropertyName = FHIRConfiguration.PROPERTY_DATASOURCES + \"/\" + dsId;\n+        PropertyGroup dsPG = FHIRConfigHelper.getPropertyGroup(dsPropertyName);\n+        if (dsPG != null) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDk4MjgyNw=="}, "originalCommit": {"oid": "6fece5b82ae7f814b60ab62ec64059a9eccc3bd7"}, "originalPosition": 82}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDk4Njc2Mw==", "bodyText": "cool, thanks!", "url": "https://github.com/IBM/FHIR/pull/1036#discussion_r420986763", "createdAt": "2020-05-06T18:01:33Z", "author": {"login": "albertwang-ibm"}, "path": "fhir-persistence-jdbc/src/main/java/com/ibm/fhir/persistence/jdbc/dao/impl/FHIRDbDAOImpl.java", "diffHunk": "@@ -247,6 +222,67 @@ public Connection getConnection() throws FHIRPersistenceDBConnectException {\n         }\n     }\n \n+    /**\n+     * this feature is executes row access control\n+     * \n+     * @param connection\n+     * @throws Exception\n+     */\n+    public void executeRowAccessFeature(Connection connection) throws Exception {\n+        // For the multi-tenant feature, configure the connection for the tenant by setting the sv_tenant_id.\n+        String tenantName = FHIRRequestContext.get().getTenantId();\n+        String tenantKey = null;\n+        String dsId = FHIRRequestContext.get().getDataStoreId();\n+        boolean multiTenantFeature = false;\n+\n+        // Retrieve the property group pertaining to the specified datastore.\n+        // Find and set the tenantKey for the request, otherwise subsequent pulls from the pool\n+        // miss the tenantKey.\n+        String dsPropertyName = FHIRConfiguration.PROPERTY_DATASOURCES + \"/\" + dsId;\n+        PropertyGroup dsPG = FHIRConfigHelper.getPropertyGroup(dsPropertyName);\n+        if (dsPG != null) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDk4MjgyNw=="}, "originalCommit": {"oid": "6fece5b82ae7f814b60ab62ec64059a9eccc3bd7"}, "originalPosition": 82}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 52, "cost": 1, "resetAt": "2021-11-12T20:44:06Z"}}}