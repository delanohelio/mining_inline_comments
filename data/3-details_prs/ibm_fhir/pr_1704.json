{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE5ODkyNDA1", "number": 1704, "title": "IBM FHIR Schema Tool - Docker Container and Brief Documentation", "bodyText": "IBM FHIR Schema Tool - Docker Container and Brief Documentation\nAutomation to come in separate PR", "createdAt": "2020-11-12T13:40:17Z", "url": "https://github.com/IBM/FHIR/pull/1704", "merged": true, "mergeCommit": {"oid": "f6f329d3087c954f8888bbfbdbbcffb0729381a4"}, "closed": true, "closedAt": "2020-11-19T01:04:24Z", "author": {"login": "prb112"}, "timelineItems": {"totalCount": 16, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdbyb2mAH2gAyNTE5ODkyNDA1OjIyODIwN2Q4YjgzNzA2MTIwOWUyY2QyOTc3MDkxODEwNTc0ODBmZTk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABddPQUDAH2gAyNTE5ODkyNDA1OjFlZjVlNTRkYTdkZDQxN2QyNzczY2QwMDZmNjg5NmU4MWM1YmQxYTU=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "228207d8b837061209e2cd297709181057480fe9", "author": {"user": {"login": "prb112", "name": "Paul Bastide"}}, "url": "https://github.com/IBM/FHIR/commit/228207d8b837061209e2cd297709181057480fe9", "committedDate": "2020-11-12T13:18:52Z", "message": "feat: a new docker image for ibm-fhir-schematool #1650\n\nSigned-off-by: Paul Bastide <pbastide@us.ibm.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b9425ecbf9c8d8d7e73fa7b260d0c46a71beb1dd", "author": {"user": {"login": "prb112", "name": "Paul Bastide"}}, "url": "https://github.com/IBM/FHIR/commit/b9425ecbf9c8d8d7e73fa7b260d0c46a71beb1dd", "committedDate": "2020-11-12T13:21:23Z", "message": "doc: add documentation for development of the ibm-fhir-schematool\n\nSigned-off-by: Paul Bastide <pbastide@us.ibm.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI5MTUxOTc1", "url": "https://github.com/IBM/FHIR/pull/1704#pullrequestreview-529151975", "createdAt": "2020-11-12T14:40:39Z", "commit": {"oid": "b9425ecbf9c8d8d7e73fa7b260d0c46a71beb1dd"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMlQxNDo0MDozOVrOHx94Bw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMlQxNDo0MDozOVrOHx94Bw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjE1NjAzOQ==", "bodyText": "is it worth explicitly listing the postgresql properties?\n  --prop \"sslmode=verify-full\"\n  --prop \"sslrootcert=./postgres.cert\"", "url": "https://github.com/IBM/FHIR/pull/1704#discussion_r522156039", "createdAt": "2020-11-12T14:40:39Z", "author": {"login": "lmsurpre"}, "path": "fhir-install/src/main/docker/ibm-fhir-schematool/README.md", "diffHunk": "@@ -0,0 +1,182 @@\n+---\n+layout: default\n+title:  IBM FHIR Server - Schema Tool\n+date:   2020-11-11\n+permalink: /ibm-fhir-server-schema-tool/\n+---\n+\n+# IBM FHIR Server - Schema Tool\n+\n+The IBM FHIR Server Schema Tool is designed to create and update the IBM FHIR Server's schema idempotently.\n+\n+The tool supports the following flows in one image: \n+\n+* Onboarding - create SQL schemas, populate the SQL objects, grant permissions to the database user. For db2, the tool sets up a single tenant and tenant key. \n+* Offboarding - removes the schema, on Db2, if no other tenants, it deallocates the tenants\n+* Custom - executes a single fhir-persistence-schema cli action\n+* Debug - outputs debug information\n+\n+# **Use**\n+\n+The solution should set the variables as Environment Variables or mounted into the workarea folder as a volume which contains the persistence.json file.\n+\n+## **Environment Variables**\n+The following environment variables:\n+\n+| Name           | Purpose  |\n+|----------------|----------|\n+| ENV_SKIP       | Stop the container from making any changes, and passes through with a successful state change: `[empty|true|false]`|\n+| ENV_TOOL_INPUT | Encoded String, base64, of the json|\n+| ENV_TOOL_DEBUG | Flags the debug |\n+\n+## Configuration Commandline\n+The following is read from the properties file:\n+\n+| Name       | Purpose  |\n+|------------|----------|\n+| tool.behavior | Switches from the Onboarding BEHAVIOR to Offboarding BEHAVIOR flow: `[onboard|offboard|debug|custom]`. |\n+| db.type | The database type - `[postgres|db2]` |\n+| db.host | The database server hostname|\n+| db.port | The database server port|\n+| db.database | The name of the database|\n+| user | A username with connect and admin permissions on the target database|\n+| password | The user password for connecting to the database|\n+| sslConnection | true or anything else, true triggers JDBC to use ssl, an example --prop sslConnection=true (db2) |\n+| ssl | true or anything else, true triggers JDBC to use ssl, an example --prop ssl=true (postgres) |\n+| tenant.key | the tenant key is a generated key, or used to set a specific value |\n+| tenant.name | the tenant name is typically default |\n+| schema.name.oauth | uses the default or custom |\n+| schema.name.fhir | defaults to fhirdata |\n+| schema.name.batch | uses the default or custom |\n+| grant.to | grants access to a specific user (which is going to run the application) |\n+\n+Further, any property supported by the [fhir-persistence-schema](https://github.com/IBM/FHIR/blob/master/fhir-persistence-schema/README.md) module is put into the file and mounted to the system.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b9425ecbf9c8d8d7e73fa7b260d0c46a71beb1dd"}, "originalPosition": 53}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3a1979cbadb3a13415814ef440c94aa6cf3b3d68", "author": {"user": {"login": "prb112", "name": "Paul Bastide"}}, "url": "https://github.com/IBM/FHIR/commit/3a1979cbadb3a13415814ef440c94aa6cf3b3d68", "committedDate": "2020-11-13T13:48:32Z", "message": "feat: add support for ssl certificate for postgres\n\nSigned-off-by: Paul Bastide <pbastide@us.ibm.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f554c120c6c8ca278a9931469a769072273de371", "author": {"user": {"login": "prb112", "name": "Paul Bastide"}}, "url": "https://github.com/IBM/FHIR/commit/f554c120c6c8ca278a9931469a769072273de371", "committedDate": "2020-11-13T14:12:18Z", "message": "feat: add support for environment variable\n\nSigned-off-by: Paul Bastide <pbastide@us.ibm.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5347e7f3373fb073df770c13cf19b85b3f639d90", "author": {"user": {"login": "prb112", "name": "Paul Bastide"}}, "url": "https://github.com/IBM/FHIR/commit/5347e7f3373fb073df770c13cf19b85b3f639d90", "committedDate": "2020-11-13T15:42:39Z", "message": "fix: remove bad spacking\n\nSigned-off-by: Paul Bastide <pbastide@us.ibm.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c5b3af8060d24d9968d0b2e9bbf3d2f5e6520d2b", "author": {"user": {"login": "prb112", "name": "Paul Bastide"}}, "url": "https://github.com/IBM/FHIR/commit/c5b3af8060d24d9968d0b2e9bbf3d2f5e6520d2b", "committedDate": "2020-11-13T21:11:10Z", "message": "fix: per code review and testing with ibm cloud and ssl certificates, also implement base64 encoded or plain-text encoded\n\nSigned-off-by: Paul Bastide <pbastide@us.ibm.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "271a0b8a35edc891e7f2166e1b8edf969c1a8a4c", "author": {"user": {"login": "prb112", "name": "Paul Bastide"}}, "url": "https://github.com/IBM/FHIR/commit/271a0b8a35edc891e7f2166e1b8edf969c1a8a4c", "committedDate": "2020-11-16T19:45:47Z", "message": "feat: add run-as user\n\nSigned-off-by: Paul Bastide <pbastide@us.ibm.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c90468f2349cb62e56a5692d86f20f53c6214c53", "author": {"user": {"login": "prb112", "name": "Paul Bastide"}}, "url": "https://github.com/IBM/FHIR/commit/c90468f2349cb62e56a5692d86f20f53c6214c53", "committedDate": "2020-11-16T19:52:04Z", "message": "doc: changes to readability\n\nSigned-off-by: Paul Bastide <pbastide@us.ibm.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6b5e5b462e2404df8df2fe215f63af5f23279c57", "author": {"user": {"login": "prb112", "name": "Paul Bastide"}}, "url": "https://github.com/IBM/FHIR/commit/6b5e5b462e2404df8df2fe215f63af5f23279c57", "committedDate": "2020-11-16T19:52:47Z", "message": "build.sh updates\n\nSigned-off-by: Paul Bastide <pbastide@us.ibm.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMxODQ1NzQ5", "url": "https://github.com/IBM/FHIR/pull/1704#pullrequestreview-531845749", "createdAt": "2020-11-16T22:39:55Z", "commit": {"oid": "6b5e5b462e2404df8df2fe215f63af5f23279c57"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNlQyMjozOTo1NVrOH0YtdA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNlQyMjozOTo1NVrOH0YtdA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDY5Mjg1Mg==", "bodyText": "Is this file picked up and used some place?   I might have expected this type of info in our wiki rather than with the docker artifacts.", "url": "https://github.com/IBM/FHIR/pull/1704#discussion_r524692852", "createdAt": "2020-11-16T22:39:55Z", "author": {"login": "lmsurpre"}, "path": "fhir-install/src/main/docker/ibm-fhir-schematool/DEVELOPMENT.md", "diffHunk": "@@ -0,0 +1,80 @@\n+---\n+layout: default\n+title:  IBM FHIR Server - Schema Tool - Development\n+date:   2020-11-11\n+permalink: /ibm-fhir-server-schema-tool-development/\n+---\n+\n+# Development", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6b5e5b462e2404df8df2fe215f63af5f23279c57"}, "originalPosition": 8}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMxODQ3MjAw", "url": "https://github.com/IBM/FHIR/pull/1704#pullrequestreview-531847200", "createdAt": "2020-11-16T22:42:37Z", "commit": {"oid": "6b5e5b462e2404df8df2fe215f63af5f23279c57"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNlQyMjo0MjozN1rOH0Y4jQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNlQyMjo0MjozN1rOH0Y4jQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDY5NTY5Mw==", "bodyText": "it can be any path to a valid cert, right?", "url": "https://github.com/IBM/FHIR/pull/1704#discussion_r524695693", "createdAt": "2020-11-16T22:42:37Z", "author": {"login": "lmsurpre"}, "path": "fhir-install/src/main/docker/ibm-fhir-schematool/README.md", "diffHunk": "@@ -0,0 +1,182 @@\n+# IBM FHIR Server - Schema Tool\n+\n+The IBM FHIR Server Schema Tool is designed to create and update the IBM FHIR Server's schema idempotently.\n+\n+The tool supports the following flows in one image: \n+\n+* Onboarding - create SQL schemas, populate the SQL objects, grant permissions to the database user. For db2, the tool sets up a single tenant and tenant key. \n+* Offboarding - removes the schema, on Db2, if no other tenants, it deallocates the tenants\n+* Custom - executes a single fhir-persistence-schema cli action\n+* Debug - outputs debug information\n+\n+# **Use**\n+\n+The solution should set the variables as Environment Variables or mounted into the workarea folder as a volume which contains the persistence.json file.\n+\n+## **Environment Variables**\n+The following environment variables:\n+\n+| Name           | Purpose  |\n+|----------------|----------|\n+| ENV_SKIP       | Stop the container from making any changes, and passes through with a successful state change: `[empty\\|true\\|false]`|\n+| ENV_TOOL_INPUT | Encoded String, in most circumstances base64 encoded or well escaped text, of the json|\n+| ENV_TOOL_DEBUG | Flags the debug |\n+\n+## Configuration Commandline\n+The following is read from the properties file:\n+\n+| Name       | Purpose  |\n+|------------|----------|\n+| tool.behavior | Switches from the Onboarding BEHAVIOR to Offboarding BEHAVIOR flow: `[onboard\\|offboard\\|debug\\|custom]`. |\n+| db.type | The database type - `[postgresql\\|db2]` |\n+| db.host | The database server hostname|\n+| db.port | The database server port|\n+| db.database | The name of the database|\n+| user | A username with connect and admin permissions on the target database|\n+| password | The user password for connecting to the database|\n+| sslConnection | true or anything else, true triggers JDBC to use ssl, an example --prop sslConnection=true (db2) |\n+| ssl | true or anything else, true triggers JDBC to use ssl, an example --prop ssl=true (postgres) |\n+| tenant.key | the tenant key is a generated key, or used to set a specific value |\n+| tenant.name | the tenant name is typically default |\n+| schema.name.oauth | uses the default or custom |\n+| schema.name.fhir | defaults to fhirdata |\n+| schema.name.batch | uses the default or custom |\n+| grant.to | grants access to a specific user (which is going to run the application) |\n+| sslmode | For Postgres, you can set verify-full |\n+| sslrootcert | For Postgres, you must set as /opt/schematool/workarea/db.cert |", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6b5e5b462e2404df8df2fe215f63af5f23279c57"}, "originalPosition": 46}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMxODQ3NzMy", "url": "https://github.com/IBM/FHIR/pull/1704#pullrequestreview-531847732", "createdAt": "2020-11-16T22:43:38Z", "commit": {"oid": "6b5e5b462e2404df8df2fe215f63af5f23279c57"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNlQyMjo0MzozOFrOH0Y8lg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNlQyMjo0MzozOFrOH0Y8lg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDY5NjcyNg==", "bodyText": "I never set this one when interacting with the IBM Cloud Databases for Postgresql.  I think you can choose either this one or sslrootcert...does that sound right?", "url": "https://github.com/IBM/FHIR/pull/1704#discussion_r524696726", "createdAt": "2020-11-16T22:43:38Z", "author": {"login": "lmsurpre"}, "path": "fhir-install/src/main/docker/ibm-fhir-schematool/README.md", "diffHunk": "@@ -0,0 +1,182 @@\n+# IBM FHIR Server - Schema Tool\n+\n+The IBM FHIR Server Schema Tool is designed to create and update the IBM FHIR Server's schema idempotently.\n+\n+The tool supports the following flows in one image: \n+\n+* Onboarding - create SQL schemas, populate the SQL objects, grant permissions to the database user. For db2, the tool sets up a single tenant and tenant key. \n+* Offboarding - removes the schema, on Db2, if no other tenants, it deallocates the tenants\n+* Custom - executes a single fhir-persistence-schema cli action\n+* Debug - outputs debug information\n+\n+# **Use**\n+\n+The solution should set the variables as Environment Variables or mounted into the workarea folder as a volume which contains the persistence.json file.\n+\n+## **Environment Variables**\n+The following environment variables:\n+\n+| Name           | Purpose  |\n+|----------------|----------|\n+| ENV_SKIP       | Stop the container from making any changes, and passes through with a successful state change: `[empty\\|true\\|false]`|\n+| ENV_TOOL_INPUT | Encoded String, in most circumstances base64 encoded or well escaped text, of the json|\n+| ENV_TOOL_DEBUG | Flags the debug |\n+\n+## Configuration Commandline\n+The following is read from the properties file:\n+\n+| Name       | Purpose  |\n+|------------|----------|\n+| tool.behavior | Switches from the Onboarding BEHAVIOR to Offboarding BEHAVIOR flow: `[onboard\\|offboard\\|debug\\|custom]`. |\n+| db.type | The database type - `[postgresql\\|db2]` |\n+| db.host | The database server hostname|\n+| db.port | The database server port|\n+| db.database | The name of the database|\n+| user | A username with connect and admin permissions on the target database|\n+| password | The user password for connecting to the database|\n+| sslConnection | true or anything else, true triggers JDBC to use ssl, an example --prop sslConnection=true (db2) |\n+| ssl | true or anything else, true triggers JDBC to use ssl, an example --prop ssl=true (postgres) |\n+| tenant.key | the tenant key is a generated key, or used to set a specific value |\n+| tenant.name | the tenant name is typically default |\n+| schema.name.oauth | uses the default or custom |\n+| schema.name.fhir | defaults to fhirdata |\n+| schema.name.batch | uses the default or custom |\n+| grant.to | grants access to a specific user (which is going to run the application) |\n+| sslmode | For Postgres, you can set verify-full |\n+| sslrootcert | For Postgres, you must set as /opt/schematool/workarea/db.cert |\n+| db.cert | For Postgres, you must set as a base64 encoding of the certificate |", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6b5e5b462e2404df8df2fe215f63af5f23279c57"}, "originalPosition": 47}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMxODQ4MTM5", "url": "https://github.com/IBM/FHIR/pull/1704#pullrequestreview-531848139", "createdAt": "2020-11-16T22:44:25Z", "commit": {"oid": "6b5e5b462e2404df8df2fe215f63af5f23279c57"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNlQyMjo0NDoyNVrOH0Y_0g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNlQyMjo0NDoyNVrOH0Y_0g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDY5NzU1NA==", "bodyText": "we'll need to remember to keep the version references in this script up-to-date.  maybe use your curl trick to get the latest version from the github api?", "url": "https://github.com/IBM/FHIR/pull/1704#discussion_r524697554", "createdAt": "2020-11-16T22:44:25Z", "author": {"login": "lmsurpre"}, "path": "fhir-install/src/main/docker/ibm-fhir-schematool/build.sh", "diffHunk": "@@ -0,0 +1,22 @@\n+#!/usr/bin/env bash\n+\n+# ----------------------------------------------------------------------------\n+# (C) Copyright IBM Corp. 2020\n+#\n+# SPDX-License-Identifier: Apache-2.0\n+# ----------------------------------------------------------------------------\n+\n+set -e -o pipefail\n+\n+##############################################################################\n+\n+docker build --build-arg FHIR_VERSION=4.5.0 -t ibm-fhir-schematool:latest .", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6b5e5b462e2404df8df2fe215f63af5f23279c57"}, "originalPosition": 13}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMxODQ5Nzkw", "url": "https://github.com/IBM/FHIR/pull/1704#pullrequestreview-531849790", "createdAt": "2020-11-16T22:47:38Z", "commit": {"oid": "6b5e5b462e2404df8df2fe215f63af5f23279c57"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1ef5e54da7dd417d2773cd006f6896e81c5bd1a5", "author": {"user": {"login": "prb112", "name": "Paul Bastide"}}, "url": "https://github.com/IBM/FHIR/commit/1ef5e54da7dd417d2773cd006f6896e81c5bd1a5", "committedDate": "2020-11-17T01:27:26Z", "message": "ci: add automation hooks and build\n\nSigned-off-by: Paul Bastide <pbastide@us.ibm.com>"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 769, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}