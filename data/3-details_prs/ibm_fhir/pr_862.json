{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk0OTUwMDQx", "number": 862, "title": "issue #853 use system properties instead of derby.properties", "bodyText": "Changed to use system properties, tested and found this works well with all derby embedded related unit tests and server integration tests.\nSigned-off-by: Albert Wang xuwang@us.ibm.com", "createdAt": "2020-03-27T20:13:17Z", "url": "https://github.com/IBM/FHIR/pull/862", "merged": true, "mergeCommit": {"oid": "1fdfc91b479ccd153e5fef3b704d0ce80f8c6272"}, "closed": true, "closedAt": "2020-03-30T12:19:12Z", "author": {"login": "albertwang-ibm"}, "timelineItems": {"totalCount": 13, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcR2fejgH2gAyMzk0OTUwMDQxOmJjMjgyNDk5OWU1YmUxNTE2NGE3MTY5NDZiOGVkN2FjN2YxNWFkZWY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcSkjVpAFqTM4MzQ4OTM1NQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "bc2824999e5be15164a716946b8ed7ac7f15adef", "author": {"user": {"login": "albertwang-ibm", "name": "Albert(Xu) Wang"}}, "url": "https://github.com/IBM/FHIR/commit/bc2824999e5be15164a716946b8ed7ac7f15adef", "committedDate": "2020-03-27T20:12:03Z", "message": "issue #853 use system properties instead of derby.properties\n\nSigned-off-by: Albert Wang <xuwang@us.ibm.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgzMTc4MjA3", "url": "https://github.com/IBM/FHIR/pull/862#pullrequestreview-383178207", "createdAt": "2020-03-27T20:27:29Z", "commit": {"oid": "bc2824999e5be15164a716946b8ed7ac7f15adef"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yN1QyMDoyNzoyOVrOF9A0ZA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yN1QyMDoyNzoyOVrOF9A0ZA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTUyMDg2OA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                public static void setServerProperties (boolean isDebug) {\n          \n          \n            \n                public static void setServerProperties(boolean isDebug) {", "url": "https://github.com/IBM/FHIR/pull/862#discussion_r399520868", "createdAt": "2020-03-27T20:27:29Z", "author": {"login": "prb112"}, "path": "fhir-database-utils/src/main/java/com/ibm/fhir/database/utils/derby/DerbyServerPropertiesMgr.java", "diffHunk": "@@ -0,0 +1,29 @@\n+/*\n+ * (C) Copyright IBM Corp. 2020\n+ *\n+ * SPDX-License-Identifier: Apache-2.0\n+ */\n+\n+package com.ibm.fhir.database.utils.derby;\n+\n+import java.util.Properties;\n+\n+\n+/**\n+ * Server properties for embedded derby which is used in unit tests and server integration tests,\n+ * equal to setting in derby.properties.\n+ */\n+public class DerbyServerPropertiesMgr {\n+    public static void setServerProperties (boolean isDebug) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bc2824999e5be15164a716946b8ed7ac7f15adef"}, "originalPosition": 17}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6a4d3e8d180dbcbe4085b27762ac91bd500f3514", "author": {"user": {"login": "albertwang-ibm", "name": "Albert(Xu) Wang"}}, "url": "https://github.com/IBM/FHIR/commit/6a4d3e8d180dbcbe4085b27762ac91bd500f3514", "committedDate": "2020-03-27T20:29:12Z", "message": "Update fhir-database-utils/src/main/java/com/ibm/fhir/database/utils/derby/DerbyServerPropertiesMgr.java\r\n\r\nSigned-off-by: Albert Wang <xuwang@us.ibm.com>\n\nCo-Authored-By: Paul Bastide <pbastide@us.ibm.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgzMTc5NzY4", "url": "https://github.com/IBM/FHIR/pull/862#pullrequestreview-383179768", "createdAt": "2020-03-27T20:30:13Z", "commit": {"oid": "bc2824999e5be15164a716946b8ed7ac7f15adef"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yN1QyMDozMDoxM1rOF9A5Vw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yN1QyMDozMDoxM1rOF9A5Vw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTUyMjEzNQ==", "bodyText": "it's not really a constant at this point. let's just pass in the boolean value and a comment on line 149....", "url": "https://github.com/IBM/FHIR/pull/862#discussion_r399522135", "createdAt": "2020-03-27T20:30:13Z", "author": {"login": "prb112"}, "path": "fhir-server/src/main/java/com/ibm/fhir/server/listener/FHIRServletContextListener.java", "diffHunk": "@@ -140,8 +141,13 @@ public void contextInitialized(ServletContextEvent event) {\n      */\n     private void bootstrapDerbyDatabases(PropertyGroup fhirConfig) throws Exception {\n         Boolean performDbBootstrap = fhirConfig.getBooleanProperty(PROPERTY_JDBC_BOOTSTRAP_DB, Boolean.FALSE);\n+        // Controls if we run derby in debugging mode which enables more logs.\n+        boolean DEBUG = false;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bc2824999e5be15164a716946b8ed7ac7f15adef"}, "originalPosition": 22}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgzMTgwNTMw", "url": "https://github.com/IBM/FHIR/pull/862#pullrequestreview-383180530", "createdAt": "2020-03-27T20:31:28Z", "commit": {"oid": "bc2824999e5be15164a716946b8ed7ac7f15adef"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yN1QyMDozMToyOVrOF9A7hg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yN1QyMDozMToyOVrOF9A7hg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTUyMjY5NA==", "bodyText": "does Derby automatically write this out when it's set on System.getProperties?", "url": "https://github.com/IBM/FHIR/pull/862#discussion_r399522694", "createdAt": "2020-03-27T20:31:29Z", "author": {"login": "prb112"}, "path": "fhir-database-utils/src/main/java/com/ibm/fhir/database/utils/derby/DerbyServerPropertiesMgr.java", "diffHunk": "@@ -0,0 +1,29 @@\n+/*\n+ * (C) Copyright IBM Corp. 2020\n+ *\n+ * SPDX-License-Identifier: Apache-2.0\n+ */\n+\n+package com.ibm.fhir.database.utils.derby;\n+\n+import java.util.Properties;\n+\n+\n+/**\n+ * Server properties for embedded derby which is used in unit tests and server integration tests,\n+ * equal to setting in derby.properties.\n+ */\n+public class DerbyServerPropertiesMgr {\n+    public static void setServerProperties (boolean isDebug) {\n+        Properties sysProperties = System.getProperties();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bc2824999e5be15164a716946b8ed7ac7f15adef"}, "originalPosition": 18}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgzMTgxMTI4", "url": "https://github.com/IBM/FHIR/pull/862#pullrequestreview-383181128", "createdAt": "2020-03-27T20:32:35Z", "commit": {"oid": "6a4d3e8d180dbcbe4085b27762ac91bd500f3514"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yN1QyMDozMjozNVrOF9A9fg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yN1QyMDozMjozNVrOF9A9fg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTUyMzE5OA==", "bodyText": "I take it the translator already does the class name lookup?  otherwise if it doesn't I think this should be done on line 53. it's the general jdbc driver class loading pattern", "url": "https://github.com/IBM/FHIR/pull/862#discussion_r399523198", "createdAt": "2020-03-27T20:32:35Z", "author": {"login": "prb112"}, "path": "fhir-database-utils/src/main/java/com/ibm/fhir/database/utils/derby/DerbyMaster.java", "diffHunk": "@@ -56,22 +51,7 @@\n     public DerbyMaster(String database) {\n         this.database = database;\n \n-        try (PrintWriter out = new PrintWriter(DERBY_PROPERTIES)){\n-            Class.forName(DERBY_TRANSLATOR.getDriverClassName());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6a4d3e8d180dbcbe4085b27762ac91bd500f3514"}, "originalPosition": 25}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c7029290e67114a233485fb3c24f04872acd7679", "author": {"user": {"login": "albertwang-ibm", "name": "Albert(Xu) Wang"}}, "url": "https://github.com/IBM/FHIR/commit/c7029290e67114a233485fb3c24f04872acd7679", "committedDate": "2020-03-28T01:12:52Z", "message": "issue #853 minor changes per review comments\n\nSigned-off-by: Albert Wang <xuwang@us.ibm.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "22d2a92fd8c413d12357b300b9a58325d3aa1d7f", "author": {"user": {"login": "albertwang-ibm", "name": "Albert(Xu) Wang"}}, "url": "https://github.com/IBM/FHIR/commit/22d2a92fd8c413d12357b300b9a58325d3aa1d7f", "committedDate": "2020-03-28T01:13:25Z", "message": "Merge branch 'Albert-Master-New' of git@github.com:IBM/FHIR.git into Albert-Master-New"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0fe9d184319abd93deb53a118c8db3aa738c165f", "author": {"user": {"login": "albertwang-ibm", "name": "Albert(Xu) Wang"}}, "url": "https://github.com/IBM/FHIR/commit/0fe9d184319abd93deb53a118c8db3aa738c165f", "committedDate": "2020-03-28T01:18:12Z", "message": "Merge branch 'master' into Albert-Master-New"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "22349ca73430795bf0e2bf105bc4f490448dafd4", "author": {"user": {"login": "albertwang-ibm", "name": "Albert(Xu) Wang"}}, "url": "https://github.com/IBM/FHIR/commit/22349ca73430795bf0e2bf105bc4f490448dafd4", "committedDate": "2020-03-28T01:38:33Z", "message": "issue #853 change derby directory\n\nSigned-off-by: Albert Wang <xuwang@us.ibm.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0a9d5c89869e281bfc99f2a7a0ea27231f0dda31", "author": {"user": {"login": "albertwang-ibm", "name": "Albert(Xu) Wang"}}, "url": "https://github.com/IBM/FHIR/commit/0a9d5c89869e281bfc99f2a7a0ea27231f0dda31", "committedDate": "2020-03-28T01:44:33Z", "message": "issue #853 minor update of comment\n\nSigned-off-by: Albert Wang <xuwang@us.ibm.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgzNDg5MzI4", "url": "https://github.com/IBM/FHIR/pull/862#pullrequestreview-383489328", "createdAt": "2020-03-30T01:51:46Z", "commit": {"oid": "0a9d5c89869e281bfc99f2a7a0ea27231f0dda31"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMFQwMTo1MTo0NlrOF9XX0A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMFQwMTo1MTo0NlrOF9XX0A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTg5MDM4NA==", "bodyText": "Is this actually needed?  Isn't \"false\" the default?\nOr I guess you add this here just to make it easy to turn on should we want to turn it on?", "url": "https://github.com/IBM/FHIR/pull/862#discussion_r399890384", "createdAt": "2020-03-30T01:51:46Z", "author": {"login": "lmsurpre"}, "path": "fhir-server/src/main/java/com/ibm/fhir/server/listener/FHIRServletContextListener.java", "diffHunk": "@@ -142,6 +143,10 @@ private void bootstrapDerbyDatabases(PropertyGroup fhirConfig) throws Exception\n         Boolean performDbBootstrap = fhirConfig.getBooleanProperty(PROPERTY_JDBC_BOOTSTRAP_DB, Boolean.FALSE);\n         if (performDbBootstrap) {\n             log.info(\"Performing Derby database bootstrapping...\");\n+\n+            // Start derby with debug off by default.\n+            DerbyServerPropertiesMgr.setServerProperties(false);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0a9d5c89869e281bfc99f2a7a0ea27231f0dda31"}, "originalPosition": 23}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgzNDg5MzU1", "url": "https://github.com/IBM/FHIR/pull/862#pullrequestreview-383489355", "createdAt": "2020-03-30T01:51:54Z", "commit": {"oid": "0a9d5c89869e281bfc99f2a7a0ea27231f0dda31"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 554, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}